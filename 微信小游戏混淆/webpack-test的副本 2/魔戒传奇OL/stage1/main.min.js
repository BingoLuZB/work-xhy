var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n["throw"](e))}catch(t){a(t)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(s,r)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(s=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,a=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(n){i=[6,n],a=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,a,s,r,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},foxgame;!function(e){var t=function(){function e(){}return e.ON_PLAYER_LOGIN_OK=999999,e.Login_Success_Msg=999997,e.NetWork_Closed_Msg=999998,e.NetWork_Connect_Error_Msg=999993,e.NetWork_Connect_TimeOut_Msg=999992,e.MainOrBattleSceneObjectsShow=999996,e.MainOrBattleSceneObjectsHide=999995,e.SwitchSceneType_Msg=999994,e.UICanHideSomethingForDrawLess=999989,e.UIRestoreHideSomethingForDrawLess=999987,e.MODULE_SHOW=1000001,e.MODULE_CLOSE=1000002,e.MODULE_DISPOSE=1000003,e.LOAD_RES=1000004,e.ALERT=1000005,e.MAIN_SCENE_CLICK=1000011,e.BATTLE_SCENE_CLICK=1000012,e.MainSceneMap_LOADED=1000015,e.BattleScene1_LOADED=1000016,e.Regist_Window_Class=1000017,e.Login_Need_Loaded=1000018,e.Set_Pay_Item=1000019,e.REFRESH_PLAYERDATA=1e5,e.REFRESH_GIFT=100001,e.SELECTSERVER=100003,e.REFRESH_FIGHTCOUNT=100004,e.REFRESH_SKILLCHANGE=100005,e.BOTTOM_NOTICE_EQUIP=100007,e.BOTTOM_NOTICE_PACKAGE=100008,e.BOTTOM_NOTICE_SKILL=100009,e.MAIN_NOTICE_GIFT=100011,e.MAIN_NOTICE_ACTIVITY=100013,e.MAIN_NOTICE_CHAT=101014,e.MAIN_NOTICE_RAID=100020,e.REFRESH_CDKEY=100015,e.REFRESH_PAY=100016,e.FIGHTFB_GOTO=100017,e.REFRESH_WANBA=100018,e.CHECK_SOUND=100019,e.BOTTOM_SELECTANI=100021,e.SET_expBarProgress=100022,e.SHOW_EQUIP_SELECT=200003,e.UPDATE_EQUIPINFO=200100,e.UPDATE_EQUIP_PACKAGE=200101,e.UPDATE_ITEM_PACKAGE=200102,e.SHOW_EQUIP_SELECT_MULTIPLE=200200,e.UPDATE_EQUIP_SELECT_MULTIPLE_LIST=200201,e.UPDATE_TITLE_SELECT_LIST=200202,e.UPDATE_FORGE_MAIN_SMELTVALUE=200203,e.UPDATE_RAID_NOTICE=200300,e.UPDATE_PRIVATECHAT_NOTICE=200400,e.BROADCAST_MESSAGE=200401,e.ACTIVE_TASK=200500,e.ACTIVE_REWARD=200501,e.NEWBEE_LEIJIDEGNLU=200502,e.REFRESH_BATTLE_PLAYER_INFO=300006,e.REFRESH_NEXTPROMPTANI=300007,e.REFRESH_BATTLEHINTANI=300008,e.BATTLE_INFO_NORMAL=300010,e.BATTLE_INFO_CHALLENGE=300011,e.BATTLE_MAP_REFRESH=300012,e.BATTLE_POP_INFO=300013,e.BATTLE_POP_SHOW=300014,e.BATTLE_POP_HIDE=300015,e.BATTLE_VESTIGES_INFO=400001,e.DAILY_COPY_INFO=500101,e.TIAO_ZHAN_BOSS_VISIBLE=400111,e.REWARDREFRESH=100050,e.NEWBEEOPENMENU=100051,e.NEWBEEFORFIGHTCONTROLER=100052,e.CHA_YOU_LIAO_QIE=100053,e.ACTIVITY_ITEM_SEND=100056,e.ACTIVITY_TASK_DO=100057,e.SHOP_NOTICE_MAINBOTTON=100058,e.WING_NOTICE_0831=100059,e.WING_NOTICE_CHAR=100060,e.REWARD_CHANGE_3=100061,e.ARENA_CHALLENGE_COUNT=100062,e.SKILL_UP_SHOW_TIP=100066,e.AUTO_FIGHT_BOSS=100067,e.AUTO_FIGHT_BOSS_CHANGE=100068,e.FORCE_PILIANG_COUNTS=100069,e.NEW_FUNCTION_OPEN=100070,e.QUICK_GET_REWARD=100071,e.CLOSE_THE_98=100072,e.UP_WING_STAR_INFO=100074,e.NEW_AREN_UI_REFRESH=100075,e.NEW_AREN_UI_REFRESH_SULPCOUNT=100076,e.NEW_AREN_UI_REFRESH_DEFENDER=100077,e.NEW_AREN_RANK_UI_REFRESH=100078,e.NEW_AREN_BEGIN_PROTECT_5S=100079,e.NEW_AREN_REFRESH_POINT=100080,e.NEW_NOTICE_TASK_OPEN_ACTIVITY=100081,e.TWELVE_PALACE_REFRESH_BATTLE_BUTTON=100082,e.TWELVE_PALACE_REFRESH_BATTLE_PLAYER=100083,e.TWELVE_PALACE_REFRESH_BATTLE_TARGET=100084,e.TWELVE_PALACE_HIDE_BATTLE_BUTTON=100085,e.UNION_SIEGE_ENTER_BATTLE_SCENE=100086,e.UNION_SIEGE_EXIT_BATTLE_SCENE=100087,e.CHANGE_BATTLE_SCENE=111111,e.WELCOME_PANEL_CLOSE=100088,e.MAINCITY_CLICK_MAP=100089,e.MAINCITY_MAINROLE_CREATE=100090,e.PLAYER_LEVEL_UP=100091,e.CS_UNION_SIEGE_EXIT_BATTLE_SCENE=100092,e.CLOSE_PANEL=100093,e}();e.MsgCMD=t,__reflect(t.prototype,"foxgame.MsgCMD")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isSkinReady=!1,e.isDataReady=!1,e.isTouchClose=!1,e.onCloseFun=null,e._sourceArr=null,e.setScaled=!1,e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.show=function(e){void 0===e&&(e=null)},i.prototype.close=function(){if(null!=this.maskUI&&null!=this.maskUI.parent&&(this.maskUI.parent.removeChild(this.maskUI),this.maskUI.graphics.clear(),this.maskUI=null),e.NewJueweiController.getInstance().updateNobilityData(),this._sourceArr){for(var t=0,i=this._sourceArr.length;i>t;)t+=1;this._sourceArr=null}},i.prototype.clear=function(){},i.prototype.dispose=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isInit=!0,this.initMaskUI();var e=this.backBtn;null!=e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.yaoshanchu,this)},i.prototype.initMaskUI=function(){0!=this.isTouchClose&&(null==this.maskUI&&(this.maskUI=new egret.Sprite,this.maskUI.touchEnabled=!0),this.isTouchClose?this.maskUI.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchMaskCloseHandler,this):this.maskUI.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchMaskCloseHandler,this),this.addChildAt(this.maskUI,0),this.maskUI.graphics.clear(),this.maskUI.graphics.beginFill(0,.001),this.maskUI.graphics.drawRect(-this.x,-this.y,this.stage.stageWidth,e.Global.stageHeight),this.maskUI.graphics.endFill())},i.prototype.touchMaskCloseHandler=function(e){null!=this.onCloseFun&&this.onCloseFun()},i.prototype.setIsTouchClose=function(e){this.isTouchClose=e},i.prototype.setOnCloseFun=function(e){this.onCloseFun=e},i.prototype.yaoshanchu=function(t){var i=e.PopUpManager.instance.getName(this);e.PopUpManager.instance.removePopUp(i)},i.prototype.backHandler=function(){this.yaoshanchu(null)},i.prototype.resizePosition=function(){var e=ScreenAdaptation.instance.screenWidth,t=ScreenAdaptation.instance.screenHeight;this.x=e-this.scaleX*this.width>>1,this.y=t-this.scaleY*this.height>>1},i.prototype.doScreenAdaptation=function(){return this.setScaled=!0,void this.resizePosition()},i}(eui.Component);e.ViewControler=t,__reflect(t.prototype,"foxgame.ViewControler")}(foxgame||(foxgame={}));var starlingswf;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getTextField=function(e){return this.getChildByName(e)},t.prototype.getMovie=function(e){return this.getChildByName(e)},t.prototype.getSprite=function(e){return this.getChildByName(e)},t.prototype.getImage=function(e){return this.getChildByName(e)},t}(egret.DisplayObjectContainer);e.SwfSprite=t,__reflect(t.prototype,"starlingswf.SwfSprite")}(starlingswf||(starlingswf={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.PopUpModel,this.textPanel=new e.TextPromptPanel,this.textPanel2=new e.TextPromptPanel2,this.floatPanel2=new e.FloatPanel2}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showTextPanel=function(t,i,n,o,a,s,r,l,h,c,u){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===l&&(l=null),void 0===h&&(h=20),void 0===c&&(c=!0),void 0===u&&(u=!0),t==e.LanguageUtils.instance.getValue("BAGNOTENOUGH")&&(Log.trace("背包已满"),App.SoundManager().playEffect("bagisfull_mp3")),this.textPanel.showPanel(t,i,n,o,a,s,r,l,h,c,u)},t.prototype.showTextPanel2=function(e,t,i,n,o,a,s,r,l,h){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===l&&(l=20),void 0===h&&(h=!0),this.textPanel2.showPanel(e,t,i,n,o,a,s,r,l,h)},t.prototype.showFloatTextPanel1=function(t){var i=e.ObjectPoolManager.instance.get("FloatPromptPanel1");i.showPanel(t)},t.prototype.showItemFloatText=function(e){this.floatPanel2.addItem(e)},t.prototype.collectFloatPanel=function(t){e.ObjectPoolManager.instance.add(t)},t}();e.PopUpController=t,__reflect(t.prototype,"foxgame.PopUpController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this._sysTime=0,this.roleDataList=[],this.baptizekey=!1,this.demonKeeFigth=0,this.fightValue=0,this.rewardinfo=!1,this.isFirstPowerBlo=!1,this.len=0,this.len1=0,this.len2=0,this.denglutongbu=!1,this.roleDataDic=new Object,this.roleDataList=[],this.skillBagMap=new e.HashMap}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new e.PlayerService),this._instance},enumerable:!0,configurable:!0}),t.prototype.registerListener=function(){e.Message.instance.add(e.Code.PLAYER_INFO_SYNC_S,this),e.Message.instance.add(e.Code.ROLE_INFO_SYNC_S,this),e.Message.instance.add(e.Code.SKILL_INFO_SYNC_S,this),e.Message.instance.add(e.Code.SKILL_BAG_S,this),e.Message.instance.add(e.Code.STATE_INFO_SYNC_S,this),e.Message.instance.add(e.Code.PLAYER_AWARD_S,this),e.Message.instance.add(e.Code.PLAYER_CONSUME_S,this),e.Message.instance.add(e.Code.ATTRIBUTE_CHANGE_NOTICE,this),e.Message.instance.add(e.Code.MAINMISSION_LIST_S,this),e.Message.instance.add(e.Code.USE_CDK_S,this),e.Message.instance.add(e.Code.NOTICE_PUSH,this),e.Message.instance.add(e.Code.TITLE_SYNC_S,this),e.Message.instance.add(e.Code.CURRENCY_CHANGE_PUSH,this),e.Message.instance.add(e.MsgCMD.WING_NOTICE_0831,this),e.Message.instance.add(e.Code.EQUIP_CELL_SYNC,this),e.Message.instance.add(e.Code.DATA_NOTIFY_S,this)},t.prototype.clear=function(){this.playerInfo=null,this.mainRoleInfo=null,this.roleDataDic={},this.playerStateInfo=null,this.missionList=null,this.skillInfos=null,this.skillBagMap.clear(),this.othersRoleEntity=null,this.othersRoleEquips&&(this.othersRoleEquips.clear(),this.othersRoleEquips=null),this.fightValue=0},Object.defineProperty(t.prototype,"sysTime",{get:function(){return this._sysTime+egret.getTimer()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.playerInfo&&this.playerInfo.getLevel()||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blueInfo",{get:function(){return this.playerInfo&&this.playerInfo.getQqBlueInfo()||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vipLevel",{get:function(){return this.playerInfo.getVipLevel()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playerId",{get:function(){return this.playerInfo&&this.playerInfo.getPlayerId()},enumerable:!0,configurable:!0}),t.prototype.getRoleVO=function(t){var i=e.JsonDataManager.instance.roleTemplate;return i[t]},t.prototype.getRoleLevelExp=function(t){var i=e.JsonDataManager.instance.roleLevelTemplate,n=i[t];return null==n&&(n=i[t-1]),n},t.prototype.getMission=function(t){var i=e.DataManager.instance.getData("mission");return i?i.get(t):null},t.prototype.getVipPrivilege=function(t){var i=e.DataManager.instance.getData("vipPrivilege");return i?i.get(t):null},t.prototype.getRoleEntityByRoleTypeAndProf=function(e,t){void 0===t&&(t=0);var i,n=null;for(var a in this.roleDataDic)if(i=this.roleDataDic[parseInt(a)],i&&i.type==e&&(e==o.MAIN_ROLE||i.profession==t)){n=i;break}return n},t.prototype.getRoleDataByRoleId=function(e){var t=this.roleDataDic[e];return t},t.prototype.getRoleDataByProfession=function(e){var t;for(var i in this.roleDataDic)if(this.roleDataDic[i].profession==e)return t=this.roleDataDic[i];return t},t.prototype.getPlayerTitleVO=function(t){var i=e.DataManager.instance.getData("PlayerTitle"),n=null;return i&&(n=i.get(t)),n},t.prototype.getRewardVOById=function(t){var i,n=e.DataManager.instance.getData("reward");return n&&(i=n.get(t)),i},t.prototype.getColorByPlayerTitleType=function(e){var t;return 1==e?t=49407:2==e?t=15675647:3==e&&(t=16744192),t},t.prototype.getRoleSkillById=function(e){if(this.skillInfos)for(var t=this.skillInfos.length,i=0;t>i;i++)if(this.skillInfos[i].getId()==e)return this.skillInfos[i];return null},t.prototype.getRoleSkillBag=function(e){return this.skillBagMap.get(e)},t.prototype.checkFightValue=function(t,i){var n=this;null!=this.fightValueScroll&&(egret.Tween.removeTweens(this.fightValueScroll),0!=this.fightValueScroll.alpha&&this.fightValueScroll.parent.removeChild(this.fightValueScroll)),this.fightValueScroll=null,this.fightValueScroll=new e.MainFightValueScroll,this.fightValueScroll.init(t,i),e.GamePlatform.isQQdating?(this.fightValueScroll.x=.5*ScreenAdaptation.instance.screenWidth,this.fightValueScroll.y=.4*ScreenAdaptation.instance.screenHeight):(this.fightValueScroll.x=.5*ScreenAdaptation.instance.uiWidth,this.fightValueScroll.y=.4*ScreenAdaptation.instance.uiHeight),this.fightValueScroll.scaleX=this.fightValueScroll.scaleY=0,this.fightValueScroll.alpha=1,this.fightValueScroll.anchorOffsetX=.5*this.fightValueScroll.width,this.fightValueScroll.anchorOffsetY=.4*this.fightValueScroll.height,null==this.fightValueScroll.parent&&(e.Global.topLayer.addChild(this.fightValueScroll),egret.Tween.get(this.fightValueScroll).to({scaleX:1,scaleY:1},150).wait(1100).to({y:.4*ScreenAdaptation.instance.uiHeight-150},1e3).to({alpha:0},200).call(function(){n.fightValueScroll.parent.removeChild(n.fightValueScroll),egret.Tween.removeTweens(n.fightValueScroll)}))},t.prototype.reportPlayerInfoUpdate=function(t){var i={code:"updatePlayer",serverId:e.Global.serverId,data:t,serverName:e.Global.serverName,user_id:e.UserInfo.platform.uid,role_name:e.UserInfo.platform.username,level:t.getLevel(),roleid:this.mainRoleInfo.getRoleId(),name:this.mainRoleInfo.getName(),vip:t.getVipLevel(),fight:this.mainRoleInfo.getFight(),money:t.getCoin(),gold:t.getGold().toFixed(2),platformUrl:e.Global.globalConfig.platformUrl};e.UserInfo.platform.reportData_legend(i)},t.prototype.getRoleid=function(){return this.mainRoleInfo.getRoleId()+""},t.prototype.playLevelUp=function(i,n){if(e.Global.isInit){var o=this.playerInfo.getLevel();this.playLevelUpAnimation(),App.SoundManager().playEffect("sound_levelUp_mp3"),e.ModuleOpenController.getInstance().autoShowPanel(o),e.MainControler.instance.updateModuleOpen(o);var a=new e.MainLvUp;if(a.init(o.toString()),e.GamePlatform.isQQdating?(a.x=.5*ScreenAdaptation.instance.screenWidth,a.y=.5*ScreenAdaptation.instance.screenWidth-100):(a.x=.5*ScreenAdaptation.instance.uiWidth,a.y=.5*ScreenAdaptation.instance.uiHeight-100),a.scaleX=a.scaleY=0,a.anchorOffsetX=.5*a.width,a.anchorOffsetY=.5*a.height,e.Global.topLayer.addChild(a),TweenMax.to(a,.15,{scaleX:1,scaleY:1,onComplete:function(){TweenMax.to(a,.45,{onComplete:function(){TweenMax.to(a,.725,{y:.5*ScreenAdaptation.instance.uiHeight-200,onComplete:function(){TweenMax.to(a,.25,{alpha:0,onComplete:function(){a.parent.removeChild(a),TweenMax.killTweensOf(a),a.dispose,a=null}})}})}})}}),"wx_xinghe"==window.GJlenged_chanel){updateSelfInfo_wxgame_xinghe();var s=t.instance;updateRoleInfo_wxgame_xinghe("levelup",e.Global.serverId,e.Global.serverName,e.Global.playerId+"",s.mainRoleInfo.getName(),s.level,s.vipLevel,s.mainRoleInfo.getFight())}e.MainSceneManager.instance.mainRoleLvlUp(),50==o&&e.MainSceneManager.instance.mainRoleRef();var r=[25,55,65,80,90,100];-1!=r.indexOf(o)&&e.Message.instance.send(e.MsgCMD.NEW_FUNCTION_OPEN);var l=e.JsonDataManager.instance.allModuleOpenMsg[e.ModuleOpenId.YEWAIPK];i<l.level&&n>=l.level&&e.FieldPKController.getInstance().requestPanelInfo()}e.Message.instance.send(e.MsgCMD.PLAYER_LEVEL_UP,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.PLAYER_INFO_SYNC_S:this.len++,Log.trace("玩家信息："+this.len),this.player_info_sync(i);break;case e.Code.ROLE_INFO_SYNC_S:if(this.len1++,Log.trace("角色同步："+this.len1),this.role_info_sync(i),"qqgame"==window.GJlenged_chanel){var n=Math.floor(this.getFight()/1e4)+"";QQFightRank(n)}break;case e.Code.SKILL_INFO_SYNC_S:this.len2++,Log.trace("技能同步："+this.len2),this.skill_info_sync(i);break;case e.Code.SKILL_BAG_S:this.skill_bag_s(i);break;case e.Code.STATE_INFO_SYNC_S:this.state_info_sync_s(i);break;case e.Code.PLAYER_AWARD_S:this.player_award_s(i);break;case e.Code.PLAYER_CONSUME_S:this.player_consume_s(i);break;case e.Code.ATTRIBUTE_CHANGE_NOTICE:this.attribute_change_notice(i);break;case e.Code.MAINMISSION_LIST_S:this.mission_list(i);break;case e.Code.USE_CDK_S:this.use_cdk_s(i);break;case e.Code.NOTICE_PUSH:this.notice_push(i);break;case e.Code.TITLE_SYNC_S:this.title_sync_s(i);break;case e.MsgCMD.WING_NOTICE_0831:this.function1();break;case e.Code.EQUIP_CELL_SYNC:this.equipCellsInfo=i,this.equip_cells_sync(i),e.ActivityController.getIntance().checkEquipCellRed();break;case e.Code.DATA_NOTIFY_S:e.ActivityController.getIntance().chongzhichenggong(),this.showRechargeAni();var o=i;this.rechargeOK(o);break;case e.Code.CURRENCY_CHANGE_PUSH:this.updateCurrency(i)}},t.prototype.rechargeOK=function(t){var i=t.getProductId(),n=e.JsonDataManager.instance.rechargeProductIdTemplate[i];if(n)switch(n.activityId){case e.activityDaTingType.chengzhangjijin:e.ActivityController.getIntance().sendMessageToSeverByChengZhangJiJin();break;case e.activityDaTingType.jubaopen:e.JuBaoPenController.getInstance().sendMessageForJuBaoPenInfo()}"QQVip"==e.UserInfo.platform.chanel&&e.ShareWanbaControler.getInstance().sendWAN_BA_RECHARGE_INFO_C()},t.prototype.updateCurrency=function(t){if(null!=this.playerInfo){var i=this.playerInfo.getCoin(),n=this.playerInfo.getGold(),o=t.getCoin(),a=t.getGold();o!=i&&(this.playerInfo.setCoin(o),App.MessageCenter.dispatch(MessageCode.REFRESH_COIN),e.MainBottomControler.instance.refreshCharacterIconOperate()),a!=n&&(this.playerInfo.setGold(a),App.MessageCenter.dispatch(MessageCode.REFRESH_GOLD),e.MainBottomControler.instance.refreshCharacterIconOperate())}},t.prototype.showRechargeAni=function(){var t=e.LanguageUtils.instance.getValue("RECHARGEMONEYSUCESS");e.PopUpController.getInstance().showTextPanel(t)},t.prototype.player_info_sync=function(i){var n=-1,o=-1;this.playerInfo&&(n=this.playerInfo.getLevel(),o=this.playerInfo.getVipLevel()),this.playerInfo=i.getPlayerInfos()[0];var a=this.playerInfo.getLevel(),s=this.playerInfo.getVipLevel();e.ModuleOpenController.getInstance().setmodulepart(t.instance.playerInfo.getToturialStep()),this.refreshWindow(e.RedPointId.Func_Player_Attr_Change),60==a&&e.NewArenaControler.Ins.requestAreaData();var r=!1;if(a>n&&-1!=n&&(this.playLevelUp(n,a),e.MainBottomControler.instance.refreshCharacterIconOperate(e.RedPointId.Func_Player_Attr_Change),r=!0,-1!=String(getGlobalConfig().serverUrl).indexOf("rxdjapi"))){var l={code:"userstatus",datatype:3,role_name:e.UserInfo.platform.username,user_id:e.UserInfo.platform.uid,serverId:e.Global.serverId,serverName:e.Global.serverName,level:this.playerInfo.getLevel(),name:this.roleName,fightvalue:this.fightValue,money:this.playerInfo.getGold(),vip:this.playerInfo.getVipLevel(),roleid:this.playerInfo.getPlayerId(),platformUrl:e.Global.globalConfig.platformUrl};e.UserInfo.platform.reportData_legend(l)}s>o&&-1!=o&&(e.MainBottomControler.instance.refreshCharacterIconOperate(e.RedPointId.Func_Player_Attr_Change),r=!0),r&&this.reportPlayerInfoUpdate(this.playerInfo),e.Message.instance.send(e.Code.REFRESH_PLAYER_MANAGER,{playerId:this.playerInfo.getPlayerId()})},t.prototype.role_info_sync=function(t){var i,n=t.getRoleInfos(),a=this.fightValue,s=n.length;this.demonKeeFigth=Number(t.getDemonKeeFigthValue());for(var r=0;s>r;r++)n[r].getType()==o.MAIN_ROLE&&(this.mainRoleInfo=null,this.mainRoleInfo=n[r]),i=this.getRoleDataByRoleId(n[r].getRoleId()),i?i.setRoleInfo(n[r]):(i=new e.RoleData,i.setRoleInfo(n[r]),this.roleDataDic[n[r].getRoleId()]=i,this.roleDataList.push(i),this.roleDataList.sort(this.sortFunction)),i.type==o.MAIN_ROLE&&(this.mainRoleData=i);if(this.fightValue=this.getFight(),0==this.isFirstPowerBlo){this.isFirstPowerBlo=!0;var l={code:"getFirstPower",datatype:1,serverId:e.Global.serverId,serverName:e.Global.serverName,level:this.playerInfo.getLevel(),name:n[0].getName(),playerid:n[0].getRoleId(),fightvalue:this.fightValue};e.UserInfo.platform.reportData_legend(l)}if(a>0&&this.fightValue!=a&&this.checkFightValue(a,this.fightValue),e.ActivityController.getIntance().checkzhanli(),!this.denglutongbu){this.roleName=n[0].getName(),this.denglutongbu=!0;var h={code:"userstatus",datatype:3,role_name:e.UserInfo.platform.username,user_id:e.UserInfo.platform.uid,serverId:e.Global.serverId,serverName:e.Global.serverName,level:this.playerInfo.getLevel(),name:n[0].getName(),playerid:n[0].getRoleId(),fightvalue:this.fightValue,money:this.playerInfo.getGold(),vip:this.playerInfo.getVipLevel(),roleid:this.playerInfo.getPlayerId(),platformUrl:e.Global.globalConfig.platformUrl};e.UserInfo.platform.reportData_legend(h),"wx_xinghe"==window.GJlenged_chanel&&updateRoleInfo_wxgame_xinghe("online",e.Global.serverId,e.Global.serverName,e.Global.playerId+"",this.mainRoleInfo.getName(),this.level,this.vipLevel,this.mainRoleInfo.getFight())}this.refreshWindow(e.RedPointId.Func_Role_Attr_Change)},t.prototype.setfight=function(e){var t=this.fightValue;this.fightValue=Number(this.getFight())+Number(e),this.fightValue!=t&&this.checkFightValue(this.getFight(),this.fightValue)},t.prototype.getFight=function(){for(var e,t=this.getRoleDataList(),i=0,n=t.length,o=0;n>o;o++)e=t[o],i+=Number(e.fight);return i+=this.demonKeeFigth},t.prototype.equip_cells_sync=function(t){var i=t,n=i.getRoleId(),o=this.getRoleDataByRoleId(n);o?o.setRoleEquipCellInfo(i):(o=new e.RoleData,this.roleDataDic[n]=o,this.roleDataList.push(o),this.roleDataList.sort(this.sortFunction),o.setRoleEquipCellInfo(i)),this.refreshWindow(e.RedPointId.Func_Role_Equip_Change)},t.prototype.skill_info_sync=function(e){this.skillInfos?this.skillInfos=this.skillInfos.concat(e.skillInfos):this.skillInfos=e.skillInfos},t.prototype.skill_bag_s=function(t){this.skillBagMap.put(t.roleId,t),this.mainRoleInfo&&this.mainRoleInfo.getRoleId()==t.roleId&&e.Message.instance.send(e.MsgCMD.BOTTOM_NOTICE_SKILL,this.idleSkill(t)?1:0)},t.prototype.idleSkill=function(e){for(var t,i=1;3>=i;i++)if(t=e["skillId"+i],t&&t.length>0&&t.indexOf(0)>-1)return!0;return!1},t.prototype.state_info_sync_s=function(t){var i=0;this.playerStateInfo?(this.playerStateInfo.getMusicOn()!=t.getMusicOn()&&(i=1),this.playerStateInfo.getSoundOn()!=t.getSoundOn()&&(i+=2)):i=3;var n=this.playerStateInfo&&this.playerStateInfo.getCurBattleMap()||0;this.playerStateInfo=t,e.BattleService.instance.nextBattleTime=1e3*this.playerStateInfo.getNextBattleTime(),i>0&&e.Message.instance.send(e.MsgCMD.CHECK_SOUND,i),n!=this.playerStateInfo.getCurBattleMap()&&e.Message.instance.send(e.MsgCMD.BATTLE_MAP_REFRESH)},t.prototype.player_consume_s=function(t){this.setPlayerInfo(t.attrInfo),this.refreshWindow(e.RedPointId.Func_Player_Attr_Change)},t.prototype.player_award_s=function(t){this.takeTipsOnReward(t),this.setPlayerInfo(t.getRewards()),this.refreshWindow(e.RedPointId.Func_Player_Attr_Change)},t.prototype.takeTipsOnReward=function(t){if(1!=e.UnionController.getInstance().isInBonFire&&1!=e.FactionBattleController.getInstance().isFactionMap){for(var i,n,o,a=t.getRewards().getShowItems(),s=a.length,r=[],l=(e.LanguageUtils.instance.getValue("HUODE")+":",e.JsonDataManager.instance.itemTemplate),h=0;s>h;h++)n=a[h],o=n.getItemId(),1004!=o&&1023!=o&&(i=l[o],r.push(a[h]));this.settaextani(r)}},t.prototype.settaextani=function(t){if(e.MainBottomControler.PageState!=e.SceneType.MainCity)for(var i,n,o,a,s=t.length,r=e.JsonDataManager.instance.itemTemplate,l=0;s>l;l++)i=t[l],o=r[i.getItemId()],null!=o&&(n=[],a=e.LanguageUtils.instance.getValue("HUODE")+":",n.push({text:a,style:{textColor:15655878}}),n.push({text:o.name,style:{textColor:e.ColorUtils.instance.getColorByQuality(o.quality)}}),n.push({text:" x "+i.getItemCount(),style:{textColor:15655878}}),e.PopUpController.getInstance().showItemFloatText(n))},t.prototype.attribute_change_notice=function(t){if(this.baptizekey)return void(this.baptizekey=!1);for(var i,n,o,a,s,r=t.getAttribute(),l=r.length,h=[],c=0,u=0;l>u;u++)i=r[u],n=i.getAttrId(),o=i.getAttrValue(),o>0?(c=2,a=e.LanguageUtils.instance.getValue("ATT_"+n)+" + "+e.GlobalUtil.getAttrValueStr(n,o)):(c=3,a=e.LanguageUtils.instance.getValue("ATT_"+n)+" "+e.GlobalUtil.getAttrValueStr(n,o)),s=e.ColorUtils.instance.getAttrColorById(n),h[u]={text:a,color:s,type:c};e.TextAniManager.instance.addTexts(h,c)},t.prototype.playLevelUpAnimation=function(){for(var t,i,n=e.BattleScene.instance.actorList,o=n.length,a=0;o>a;a++)t=n[a],i=new e.FoxAni(t.effectHeightNode),i.setPlayComplete(this.levelUpPlayBack,this,i),i.play("levelUp","ani",1)},t.prototype.levelUpPlayBack=function(e){e.clear()},t.prototype.mission_list=function(t){this.missionList&&(this.missionList.length=0,this.missionList=null),this.missionList=t.infos,e.Message.instance.send(e.MsgCMD.NEW_NOTICE_TASK_OPEN_ACTIVITY,t.infos),e.MainControler.instance.refreshTask()},t.prototype.checkGift=function(){if(this.missionList){for(var t=!1,i=this.missionList.length,n=0;i>n;n++)if(this.missionList[n].getTag()){t=!0;break}e.Message.instance.send(e.MsgCMD.MAIN_NOTICE_GIFT,t?1:0)}},t.prototype.use_cdk_s=function(t){if(0!=t.status){var i="";switch(t.status){case 1:i="CDKeyNumNotExist";break;case 2:i="CDKeyNumNoOpenUse";break;case 3:i="CDKeyNumExpire";break;case 4:i="CDKeyNumAlreadyUse";break;case 5:i="CDKeyNumPlatformNotRight";break;case 6:i="CDKeyNumSameKeyUsed"}return void(""!=i&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue(i)))}e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("WEAK_CDK_TIP_SEND"))},t.prototype.notice_push=function(e){for(var t=e.notices,i=t.length,n=0;i>n;n++)switch(t[n].noticeType){case a.NEW_MSG:break;case a.GIFT_NEW_MSG:this.checkGift();break;case a.ALLIANCE_BOSS_OPEN:break;case a.TEAM_BATTLE_SIGNUP:}},t.prototype.title_sync_s=function(e){this.titleInfo&&(this.titleInfo=null),this.titleInfo=e.titleInfo},t.prototype.refreshWindow=function(t){void 0===t&&(t=e.RedPointId.FUNC_MOST_MAINLY);var i=this.roleDataList.length;if(0!=i){for(var n,o=0;i>o;o++)if(n=this.roleDataList[o],null==n.getRoleEquipCellInfo())return;e.Message.instance.send(e.MsgCMD.REFRESH_PLAYERDATA,t)}},t.prototype.setPlayerInfo=function(e){e&&(this.mainRoleInfo&&(e.level&&this.mainRoleInfo.setLevel(e.level),e.exp&&this.mainRoleInfo.setExp(e.exp)),this.playerInfo&&(e.vipLevel&&this.playerInfo.setVipLevel(e.vipLevel),e.smeltValue&&this.playerInfo.setSmeltValue(e.smeltValue),e.signature&&this.playerInfo.setSignature(e.signature),e.honorValue&&this.playerInfo.setHonorValue(e.honorValue),e.reputationValue&&this.playerInfo.setReputationValue(e.reputationValue)))},t.prototype.function1=function(){if(t.instance.mainRoleInfo){var i=new e.RoleData,n=t.instance.mainRoleInfo;i.setRoleInfo(n)}},t.prototype.getRoleIdByEquipId=function(e){var t,i,n,o;for(var a in this.roleDataDic)if(t=this.roleDataDic[a],null!=t){i=t.roleInfo.getEquips(),o=i.length;for(var s=0;o>s;s++)if(n=i[s],e==Number(n.getEquipId()))return t.roleInfo.getRoleId()}return-1},t.prototype.getEquipInfoByRoleIdAndPart=function(t,i){var n,o,a,s,r;for(var l in this.roleDataDic)if(n=this.roleDataDic[parseInt(l)],null!=n&&(a=n.roleInfo.getEquips(),r=a.length,t==n.roleInfo.getRoleId())){for(var h=0;r>h;h++)if(a[h].getPart()==i){o=a[h],s=e.BagController.getInstance().getEquipInfoById(o.getEquipId());break}if(null!=s)break}return s},t.prototype.getRoleDataList=function(){return this.roleDataList},t.prototype.sortFunction=function(e,t){return e.roleId<t.roleId?-1:e.roleId==t.roleId?0:e.roleId>t.roleId?1:void 0},t.prototype.isPlayerSelfsRoleInfo=function(e,t){void 0===t&&(t=null);var i=!1;for(var n in this.roleDataDic)if(~~n==e){i=!0;break}return i},t}();e.PlayerService=t,__reflect(t.prototype,"foxgame.PlayerService",["foxgame.IMessage"]);var i;!function(e){e[e.PROFESSION0=0]="PROFESSION0",e[e.PROFESSION1=1]="PROFESSION1",e[e.PROFESSION2=2]="PROFESSION2",e[e.PROFESSION3=3]="PROFESSION3"}(i=e.ProfessionType||(e.ProfessionType={}));var n;!function(e){e[e.MAN=1]="MAN",e[e.WOMAN=2]="WOMAN"}(n=e.RoleSexType||(e.RoleSexType={}));var o;!function(e){e[e.MAIN_ROLE=1]="MAIN_ROLE",e[e.MERCENARY=2]="MERCENARY",e[e.MONSTER=3]="MONSTER",e[e.BEAUTY=4]="BEAUTY",e[e.CALLBEAST=5]="CALLBEAST"}(o=e.RoleType||(e.RoleType={}));var a;!function(e){e[e.NEW_MSG=2]="NEW_MSG",e[e.GIFT_NEW_MSG=3]="GIFT_NEW_MSG",e[e.ALLIANCE_BOSS_OPEN=4]="ALLIANCE_BOSS_OPEN",e[e.TEAM_BATTLE_SIGNUP=5]="TEAM_BATTLE_SIGNUP"}(a=e.NoticeType||(e.NoticeType={}));var s;!function(e){e[e.OFFENCE=1]="OFFENCE",e[e.DEFENCE=2]="DEFENCE"}(s=e.FightRoleType||(e.FightRoleType={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i,n,o){void 0===n&&(n=null),void 0===o&&(o=!0);var a=t.call(this)||this;return a._isInit=!1,a._isMask=!0,a._isMaskDown=!1,a.isTouchClose=!1,a._maskGapBottom=0,a._maskShowBeforeOrAfter=!0,a._maskHasDone=!1,a.isShowBackBtn=!0,a.isShowTween=!1,a._setEffect=!0,a.registerTick=!1,a.isCallHideSceneObjectsWhenClose=!0,a.removeForward=!1,a.destroyCount=0,a.isTextureCache=!1,a.isLoadComplete=!1,a.adaptionType=0,a.isHideBattle=!1,a.canHideBattle=!0,a.setScaled=!1,a.skinUrl=i,a.isDestroy=o,a._layer=LayerType.UILAYER,a._isCenter=!0,e.Global&&e.Global.globalConfig&&(a.isTextureCache=e.Global.globalConfig.uiDefaultCache),e.Global.isWeChatXiaoChengXuBranch&&(a.isDestroy=!0,a.isTextureCache=!1),a}return __extends(i,t),i.prototype.init=function(){App.LittleLoading().showLoading("BasePanel "+(this.skinUrl||""));var t=this,i=function(){App.LittleLoading().hideLoading("BasePanel "+(t.skinUrl||"")),StageFrameControl.instance.removePanel(t)},n=function(){try{t._isInit=!0,t.ui=new e.BaseComponent(t.skinUrl),t.ui.setBackFun(t.uiComplete.bind(t))}catch(n){i(),console.error("BasePanel init initSkin error"),console.error(n)}};if(null!=this.groupName&&""!=this.groupName)try{App.getResourceUtils().loadGroup(this.groupName,function(){n()},function(e,t){var i=e||0,n=t||1;App.LittleLoading().setProgress(i/n)},this)}catch(o){i(),console.error("BasePanel init loadGroup error"),console.error(o)}else n()},i.prototype.uiComplete=function(){return App.LittleLoading().hideLoading("BasePanel "+(this.skinUrl||"")),null==this.parent?(Log.trace("BasePanel uiComplete parent == null"),void this.closeFunc()):(this.isLoadComplete=!0,this.addChild(this.ui),this.addDestroyRercord(),this.initHook(),this.addListener(),void this.showComplete())},i.prototype.addDestroyRercord=function(){this.isDestroy&&this.destroyCount++},i.prototype.addListener=function(){var e=this.ui.closeBtn;null!=e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},i.prototype.resizePosition=function(){if(this.isCenter){var e=ScreenAdaptation.instance.screenWidth,t=ScreenAdaptation.instance.screenHeight;this.x=e-this.ui.scaleX*this.ui.width>>1,this.y=t-this.ui.scaleY*this.ui.height>>1}},i.prototype.doScreenAdaptation=function(){return ScreenAdaptation.instance.uiWidth<this.width&&(this.ui.scaleX=ScreenAdaptation.instance.uiWidth/this.width,this.ui.scaleY=this.scaleX),void this.resizePosition()},i.prototype.getScale=function(){return this.ui.scaleX},i.prototype.show=function(){return Log.trace("BasePanel show: "+this.skinUrl),null==this.parent?(e.MainControler.instance.addTouTiaoCount(this),StageFrameControl.instance.addPanel(this,this.layer),0==this._isInit?void this.init():void this.showComplete()):void 0
},i.prototype.showUp=function(){StageFrameControl.instance.addPanel(this,this.layer)},i.prototype.showComplete=function(){this.isCenter&&(this.x=e.Global.stageWidth-this.ui.scaleX*this.width>>1,this.y=e.Global.stageHeight-this.ui.scaleY*this.height>>1),this.initParams(),this.refresh(),this.showHook(),this.resizeHook(),this.registerTick&&(egret.startTick(this.tickHandler,this),this.tickHandler(egret.getTimer())),this.visible=!0,this.isShowTween?(this.ui.x=e.Global.stageWidth,TweenMax.to(this.ui,.5,{x:0,onComplete:function(){TweenMax.killTweensOf(this.ui),this.isCallHideSceneObjectsWhenClose&&e.Message.instance.send(e.MsgCMD.MainOrBattleSceneObjectsHide,this.ui),(this.ui.scaleX>1||this.ui.scaleY>1)&&this.resizePosition(),StageFrameControl.instance.doCheckMaskAndBackBtn(this)}.bind(this)})):(this.ui.x=0,this.isCallHideSceneObjectsWhenClose&&e.Message.instance.send(e.MsgCMD.MainOrBattleSceneObjectsHide,this.ui),(this.ui.scaleX>1||this.ui.scaleY>1)&&this.resizePosition()),this._setEffect&&App.SoundManager().playEffect("sound_openWindow_mp3"),this.checkHideBattle()},i.prototype.initHook=function(){},i.prototype.initParams=function(){},i.prototype.refresh=function(){},i.prototype.showHook=function(){},i.prototype.tickHandler=function(e){return 0!=this.getIsShow()?(this.tickHook(e),!1):void 0},i.prototype.tickHook=function(e){},i.prototype.backHandler=function(){this.close()},i.prototype.close=function(){var t=this;Log.trace("BasePanel close: "+this.skinUrl),null!=this.parent&&(this.isCallHideSceneObjectsWhenClose&&e.Message.instance.send(e.MsgCMD.MainOrBattleSceneObjectsShow,this.ui),this.isShowTween&&this.getIsShow()?(null!=this.parent&&StageFrameControl.instance.doRemoveMaskAndBackBtn(this),TweenMax.to(this.ui,.3,{x:e.Global.stageWidth+this.ui.width*this.scaleX,onComplete:function(){TweenMax.killTweensOf(t.ui),t.closeFunc()}})):this.closeFunc(),this._setEffect&&(e.MainControler.instance.getSoundStatus()&&App.SoundManager().setSoundStatus(!0),App.SoundManager().playEffect("sound_closeWindow_mp3")))},i.prototype.closeFunc=function(){null!=this.parent&&(e.MainControler.instance.subtractTouTiaoCount(this),StageFrameControl.instance.removePanel(this)),this.registerTick&&egret.stopTick(this.tickHandler,this),this.destroyRES(),this.destroyRESHook(),this.destroy(),this.closeHook(),e.Global.globalConfig.isDebug,this.checkShowBattle()},i.prototype.closeHook=function(){},i.prototype.resizeHandler=function(e){0!=this.getIsShow()&&this.resizeHook()},i.prototype.resizeHook=function(){this.isCenter&&(this.x=e.Global.stageWidth-this.ui.scaleX*this.width>>1,this.y=e.Global.stageHeight-this.ui.scaleY*this.height>>1)},i.prototype.destroy=function(){0!=this.isDestroy&&0!=this.getIsInit()&&(this._isInit=!1,this.isLoadComplete=!1,this.readyDestroy(),null!=this.ui&&(null!=this.ui.parent&&this.removeChild(this.ui),this.ui.removeChildren(),this.ui.setBackFun(null),this.ui=null))},i.prototype.destroyRESHook=function(){},i.prototype.destroyRES=function(){if(0==this.isDestroy)return void Log.trace("BasePanel RES cached not destroy, skinUrl: "+this.skinUrl);if(this.groupName,!this.getIsInit()||!this.ui)return void Log.trace("BasePanel RES not init, skinUrl: "+this.skinUrl);var t=!1;if(t=this.ui.doTransform){if(this.getIsInit()&&this.ui){Log.trace("#####close BasePanel begin transform, skinUrl: "+this.skinUrl);var i=egret.getTimer();e.GlobalUtil.doTransformDisplayObjectContainerDestroyBitmapRes(this.ui,this.isTextureCache);var n=egret.getTimer()-i;Log.trace("#####close BasePanel end transform, cost time: "+n)}}else if(this.getIsInit()&&this.ui){Log.trace("#####destroy res BasePanel, skinUrl: "+this.skinUrl);var o=AssetAdapter.getInstance().getBaseComponentUiResArray(this.ui.name);if(o){for(var a in o)o[a]&&e.GlobalUtil.destroyRes(a,!this.isTextureCache);AssetAdapter.getInstance().resetEmptyBaseComponentUiResArray(this.ui.name)}}},i.prototype.readyDestroy=function(){},i.prototype.freeSelf=function(){StageFrameControl.instance.freePanel(this)},i.prototype.getIsInit=function(){return this._isInit},i.prototype.getIsShow=function(){return null!=this.parent&&this.isLoadComplete},Object.defineProperty(i.prototype,"isMask",{get:function(){return this._isMask},set:function(e){this._isMask=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isMaskdown",{get:function(){return this._isMaskDown},set:function(e){this._isMaskDown=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maskGapBottom",{get:function(){return this._maskGapBottom},enumerable:!0,configurable:!0}),i.prototype.setMaskGapBottom=function(e){this._maskGapBottom=e},Object.defineProperty(i.prototype,"maskShowBeforeOrAfter",{get:function(){return this._maskShowBeforeOrAfter},enumerable:!0,configurable:!0}),i.prototype.setMaskShowBeforeOrAfter=function(e){this._maskShowBeforeOrAfter=e},Object.defineProperty(i.prototype,"maskHasDone",{get:function(){return this._maskHasDone},enumerable:!0,configurable:!0}),i.prototype.setMaskHasDone=function(e){this._maskHasDone=e},i.prototype.getRemoveForward=function(){return this.removeForward},i.prototype.setRemoveForward=function(e){this.removeForward=e},Object.defineProperty(i.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCenter",{get:function(){return this._isCenter},set:function(e){this._isCenter=e},enumerable:!0,configurable:!0}),i.prototype.addChild=function(e){return null!=e?(t.prototype.addChild.call(this,e),e):void 0},Object.defineProperty(i.prototype,"width",{get:function(){return this.ui?this.ui.width:1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.ui?this.ui.height:1},enumerable:!0,configurable:!0}),i.prototype.getIsShowBackBtn=function(){return this.isShowBackBtn},i.prototype.setIsShowBackBtn=function(e){this.isShowBackBtn=e},i.prototype.getIsShowTween=function(){return this.isShowTween},i.prototype.setIsShowTween=function(e){this.isShowTween=e,this.isShowTween&&(this._maskShowBeforeOrAfter=!1)},i.prototype.setEffect=function(e){this._setEffect=e},i.prototype.setRegisterTick=function(e){this.registerTick=e},i.prototype.setIsTouchClose=function(e){this.isTouchClose=e},i.prototype.getIsTouchClose=function(){return this.isTouchClose},i.prototype.getSkinUrl=function(){return this.skinUrl},i.prototype.getGroupName=function(){return this.groupName},i.prototype.setIsResDestroy=function(e){this.isDestroy=e},i.prototype.setIsTextureCache=function(t){this.isTextureCache=t,e.Global.isWeChatXiaoChengXuBranch&&(this.isDestroy=!0,this.isTextureCache=!1)},i.prototype.getUiBaseName=function(){return this.ui?this.ui.name:this.skinUrl||"getUiBaseName"},i.prototype.checkHideBattle=function(){this.canHideBattle&&this.width>=e.Global.stageWidth&&this.height>=e.Global.stageHeight&&(this.isHideBattle=!0,this.hideBattle())},i.prototype.checkShowBattle=function(){this.isHideBattle&&(this.isHideBattle=!1,this.showBattle())},i.prototype.hideBattle=function(){var e=StageFrameControl.instance.getScrollViewport();Log.trace("hidebattle : skin="+this.skinUrl),e.hideSrc=e.hideSrc||{},e.hideSrc[this.skinUrl]=e.hideSrc[this.skinUrl]&&e.hideSrc[this.skinUrl]++||1,e.visible=!1},i.prototype.showBattle=function(){var e=StageFrameControl.instance.getScrollViewport();Log.trace("showbattle : skin="+this.skinUrl),e.hideSrc[this.skinUrl]<=1?(delete e.hideSrc[this.skinUrl],0==Object.keys(e.hideSrc).length&&(e.visible=!0,Log.trace("showbattle : done"))):e.hideSrc[this.skinUrl]--},i}(egret.DisplayObjectContainer);e.BasePanel=t,__reflect(t.prototype,"foxgame.BasePanel")}(foxgame||(foxgame={}));var BaseClass=function(){function e(){}return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this;if(!i._instance){var n=e.length;0==n?i._instance=new i:1==n?i._instance=new i(e[0]):2==n?i._instance=new i(e[0],e[1]):3==n?i._instance=new i(e[0],e[1],e[2]):4==n?i._instance=new i(e[0],e[1],e[2],e[3]):5==n&&(i._instance=new i(e[0],e[1],e[2],e[3],e[4]))}return i._instance},e}();__reflect(BaseClass.prototype,"BaseClass");var BaseSound=function(){function e(){}return e.prototype.init=function(){this._cache={},this._loadingCache=new Array,App.TimerManager().doTimer(6e4,0,this.dealSoundTimer,this)},e.prototype.dealSoundTimer=function(){for(var e=egret.getTimer(),t=Object.keys(this._cache),i=0,n=t.length;n>i;i++){var o=t[i];this.checkCanClear(o)&&e-this._cache[o]>=SoundManager.CLEAR_TIME&&(Log.trace(o+"已clear"),delete this._cache[o],GlobalUtil.destroyRes(o))}},e.prototype.getSound=function(e){var t=e;t.indexOf("_mp3")<=0&&(t+="_mp3");var i=RES.getRes(t);if(i)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),App.getResourceUtils().getResAsync(t,this.onResourceLoadComplete,this)}return i},e.prototype.onResourceLoadComplete=function(e,t){if(null!=t){var i=t;i.indexOf("_mp3")<=0&&(i+="_mp3");var n=this._loadingCache.indexOf(i);-1!=n&&(this._loadingCache.splice(n,1),this._cache[i]=egret.getTimer(),this.loadedPlay(i))}},e.prototype.loadedPlay=function(e){},e.prototype.checkCanClear=function(e){return!0},e}();__reflect(BaseSound.prototype,"BaseSound");var starlingswf;!function(e){var t=function(t){function i(e,i,n,o){var a=t.call(this)||this;return a._isPlay=!1,a.loop=!0,a._completeFunction=null,a._frames=e,a._labels=i,a._displayObjects=n,a._startFrame=0,a._endFrame=a._frames.length-1,a._ownerSwf=o,a.setCurrentFrame(0),a.play(),a}return __extends(i,t),i.prototype.update=function(){if(this._isPlay)if(this._currentFrame>this._endFrame){if(this.hasCompleteListener()&&this.dispatchEventWith(egret.Event.COMPLETE),this._currentFrame=this._startFrame,!this.loop)return void(this._ownerSwf&&this.stop(!1));if(this._startFrame==this._endFrame)return void(this._ownerSwf&&this.stop(!1));this.setCurrentFrame(this._startFrame)}else this.setCurrentFrame(this._currentFrame),this._currentFrame+=1},i.prototype.setCurrentFrame=function(t){this.$children.length=0,this._currentFrame=t,this.__frameInfos=this._frames[this._currentFrame];for(var i,n,o,a,s=this.__frameInfos.length,r=0;s>r;r++)i=this.__frameInfos[r],a=i[10],n=this._displayObjects[i[0]][a],n.skewX=i[6],n.skewY=i[7],n.alpha=i[8],n.name=i[9],n.x=i[2],n.y=i[3],i[1]==e.Swf.dataKey_Scale9?(n.width=i[11],n.height=i[12]):(n.scaleX=i[4],n.scaleY=i[5]),this.$children.push(n),n.$parent=this,i[1]==e.Swf.dataKey_TextField&&(o=n,o.width=i[11],o.height=i[12],o.textColor=i[14],o.size=i[15],o.textAlign=i[16],i[19]&&"\r"!=i[19]&&""!=i[19]&&(o.text=i[19]))},i.prototype.getCurrentFrame=function(){return this._currentFrame},i.prototype.play=function(){this._isPlay=!0,this._ownerSwf.swfUpdateManager.addSwfAnimation(this);var t,i,n;for(t in this._displayObjects)if(0==t.indexOf(e.Swf.dataKey_MovieClip)){i=this._displayObjects[t],n=i.length;for(var o=0;n>o;o++)i[o].play()}},i.prototype.stop=function(t){if(void 0===t&&(t=!0),this._isPlay=!1,this._ownerSwf.swfUpdateManager.removeSwfAnimation(this),t){var i,n,o;for(i in this._displayObjects)if(0==i.indexOf(e.Swf.dataKey_MovieClip)){n=this._displayObjects[i],o=n.length;for(var a=0;o>a;a++)n[a].stop(t)}}},i.prototype.gotoAndStop=function(e,t){void 0===t&&(t=!0),this.goTo(e),this.stop(t)},i.prototype.gotoAndPlay=function(e){this.goTo(e),this.play()},i.prototype.goTo=function(e){if("string"==typeof e){var t=this.getLabelData(e);this._currentLabel=t[0],this._currentFrame=this._startFrame=t[1],this._endFrame=t[2]}else"number"==typeof e&&(this._currentFrame=this._startFrame=e,this._endFrame=this._frames.length-1);this.setCurrentFrame(this._currentFrame)},i.prototype.getLabelData=function(e){for(var t,i=this._labels.length,n=0;i>n;n++)if(t=this._labels[n],t[0]==e)return t;return null},i.prototype.isPlay=function(){return this._isPlay},i.prototype.totalFrames=function(){return this._frames.length},i.prototype.currentLabel=function(){return this._currentLabel},i.prototype.labels=function(){for(var e=this._labels.length,t=[],i=0;e>i;i++)t.push(this._labels[i][0]);return t},i.prototype.hasCompleteListener=function(){return this.hasEventListener(egret.Event.COMPLETE)},i.prototype.hasLabel=function(e){var t=this.labels();return!(-1==t.indexOf(e))},i.prototype.getLabelStartFrame=function(e){return this.getLabelData(e)[1]},i.prototype.getLabelEndFrame=function(e){return this.getLabelData(e)[2]},i}(e.SwfSprite);e.SwfMovieClip=t,__reflect(t.prototype,"starlingswf.SwfMovieClip",["starlingswf.ISwfAnimation"])}(starlingswf||(starlingswf={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.scalePercent=1.1,t.scaleTime=50,t.isNeedResetAnchor=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"ResetAnchor",{get:function(){return this.isNeedResetAnchor},set:function(e){this.isNeedResetAnchor=e},enumerable:!0,configurable:!0}),t.prototype.onTouchBegin=function(t){e.prototype.onTouchBegin.call(this,t),egret.Tween.removeTweens(this),egret.Tween.get(this).to({scaleX:this.sca_x*this.scalePercent,scaleY:this.sca_y*this.scalePercent},this.scaleTime)},t.prototype.buttonReleased=function(){e.prototype.buttonReleased.call(this),this.resetUI()},t.prototype.resetUI=function(){egret.Tween.removeTweens(this),this.scaleX=this.sca_x,this.scaleY=this.sca_y,this.x=this.old_x,this.y=this.old_y},t.prototype.$onAddToStage=function(t,i){if(e.prototype.$onAddToStage.call(this,t,i),1==this.isNeedResetAnchor){var n=.5*this.width-this.anchorOffsetX,o=.5*this.height-this.anchorOffsetY;this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height,this.x=this.x+n,this.y=this.y+o}this.recordUIData(),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},t.prototype.$onRemoveFromStage=function(){egret.Tween.removeTweens(this),this.isNeedResetAnchor=!0,this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),e.prototype.$onRemoveFromStage.call(this)},t.prototype.recordUIData=function(){this.sca_x=this.scaleX,this.sca_y=this.scaleY,this.old_x=this.x,this.old_y=this.y},t.prototype.onTouchEnd=function(e){this.resetUI()},t}(eui.Button);e.CommonAniButton=t,__reflect(t.prototype,"foxgame.CommonAniButton")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i,n,o,a,s){void 0===n&&(n=e.BattleState.NORMAL_SEARCH),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===s&&(s=!1);var r=t.call(this,i,a,s)||this;return r.state=e.BattleState.NORMAL_SEARCH,r.tag="",r.state=n,r.tag=o,r}return __extends(i,t),i.CHANGE_STATE="CHANGE_STATE",i}(egret.Event);__reflect(t.prototype,"BattleStateEvent");var i=e.RoleType,n=e.PopUpController,o=function(){function e(e){this.offence=e.getBattleData().getOffence(),this.defence=e.getBattleData().getDefence(),this.battleType=e.getBattleType(),this.result=e.getFightResult(),this.awards=e.getAward(),this.mapId=e.getMapId(),this.winningTimes=e.getWinningTimes()}return e}();e.DefinedBattleInfo=o,__reflect(o.prototype,"foxgame.DefinedBattleInfo");var a=function(){function a(){this.actorList=[],this.enemyList=null,this.finishedFilmActors=null,this.monsterCrowdList=[],this.crowdPosIdx=0,this.isOnPathFindingCrowd=!1,this.mainActor=null,this.delayTimeIdxArray=[],this.isMainRoleOK=!1,this.isMonsterCrowdOK=!1,this.isMapTiledOK=!1,this.isAssembleFinishOK=!1,this.isFirstStartedBattle=!1,this.isMonsterCrowdChanged=!1,this.curBattleMapId=0,this.moveBgBattleMapId=0,this.BattleOffenceStartIdx=1e4,this.BattleDefenceStartIdx=1e3,this.BattleNpcMonsterStartIdx=2e3,this.BattleNpcPlayerStartIdx=3e3,this.backupPveMainActorPos=new egret.Point,this.lastMapFieldPKRequestType=0,this.npcPlayerAndMonsterList=[],this.followRectW=200,this.followRectH=500,this.lastMvCenterX=0,this.lastMvCenterY=0,this.droItemList=[],this.stageWidth=e.Global.designWidth,this.stageHeight=e.Global.designHeight,this.lastCheckTimestamp=0,this.lastRequestBattleTimestamp=0,this.lastRequestBattleFrameIdx=0,this._delayRequestNormalBattleHandler=null,this._delayRequestNormalBattleTime=2e3,this.enterPoint=[],this.doorPos=[],this.onDoorState=!1,this.doorNode=[],this.flyEffectList=[],this.stateNode=new egret.DisplayObjectContainer,this.stateTimerList=[],this.crowdsInfoTable={},this.crowdsMapId=0,this.centerActor=null,this.loserLayer=null,this.tipLabel=null,this.tipLabelTimer=0,this.viewLayer=null,this.viewLayerTimer=0,this._battleInfoIndex=0,this._twelvePalaceIdList=[],this._twelvePalaceTypeList=[],this._twelvePalaceOwnIdList=[],this._twelvePalaceTargetIdList=[],this._twelvePalaceUnionName={},this._twelvePalacePlayerId=0,this._twelvePalaceTargetId=0,this._twelvePalaceTargetType=0,this._twelvePalacePlayerList=[],this._twelvePalaceBattling=!1,this._twelvePalaceBtn_1=null,this._twelvePalaceBtn_2=null,this._twelvePalaceActorShow=0,this._twelvePalaceAlive=!0,this._twelvePalaceBattleResult=null,this.sceneBase=null,this.requestTimer=null,this._noAwardTimer=null,this.isInit=!1,this.ruinsTimepanel=new eui.Component,this.fightCount=0,this.state=e.BattleState.NORMAL_SEARCH,e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),e.Message.instance.add(e.MsgCMD.Login_Success_Msg,this),e.Message.instance.add(e.MsgCMD.NetWork_Closed_Msg,this),e.Message.instance.add(e.MsgCMD.BATTLE_INFO_NORMAL,this),e.Message.instance.add(e.MsgCMD.BATTLE_INFO_CHALLENGE,this),e.Message.instance.add(e.MsgCMD.BATTLE_MAP_REFRESH,this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_INFO,this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_SHOW,this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_HIDE,this),e.Message.instance.add(e.MsgCMD.BATTLE_VESTIGES_INFO,this),e.Message.instance.add(e.Code.BP_BATTLE_MAP_CROWD_MONSTER_INFO_S_VALUE,this),e.Message.instance.add(e.Code.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_S_VALUE,this),e.Message.instance.add(e.Code.PK_INFO_S,this),e.Message.instance.add(e.Code.PK_REFRESH_OPPONENT_S,this),e.Message.instance.add(e.Code.SYNC_TWELVE_PALACE_SCENE_INFO,this),e.Message.instance.add(e.Code.SCENE_PLAYER_ENTER_RESPONSE,this),e.Message.instance.add(e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC,this),e.Message.instance.add(e.Code.SYNC_TWELVE_PALACE_SCENE_RESULT_INFO,this),e.Message.instance.add(e.Code.SCENE_PLAYER_RELIVE_RESPONSE,this),e.Message.instance.add(e.Code.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_INFO_SYNC,this),e.Message.instance.add(e.Code.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_RESULT_SYNC,this),this.backupPveMainActorPos.x=0,this.backupPveMainActorPos.y=0,this.stateNode.addEventListener(t.CHANGE_STATE,this.onStateChange,this),this.sceneBase=new e.Scene_Base}return Object.defineProperty(a,"instance",{get:function(){return this._instance||(this._instance=new a),this._instance},enumerable:!0,configurable:!0}),a.prototype.getNormalBattleOnCreate=function(){this.isAssembleFinishOK=!0,this.isMonsterCrowdOK||this.sendRequestBattleMapMonsterCrowdInfo(),this.randomMoveTimer||(this.randomMoveTimer=new egret.Timer(2e3),this.randomMoveTimer.addEventListener(egret.TimerEvent.TIMER,this.onRandomMoveUpdate,this),this.randomMoveTimer.start())},a.prototype.findTheActorByRoleData=function(t){if(t.type!=i.MAIN_ROLE&&t.type!=i.MERCENARY)return null;for(var n=e.PlayerService.instance.playerInfo.getPlayerId(),o=0;o<this.actorList.length;++o){var a=this.actorList[o];if(a.roleBelongPlayerId==n&&a.roleType==t.type&&a.roleItemId==t.itemId)return a}if(this.enemyList)for(var o=0;o<this.enemyList.length;++o){var a=this.enemyList[o];if(a.roleBelongPlayerId==n&&a.roleType==t.type&&a.roleItemId==t.itemId)return a}return null},a.prototype.changeSelfActorTitleImg=function(e){for(var t=e.getTitleInfo().getUseTitleInfo(),n={},o=this.actorList.length,a=0;o>a;++a){var s=this.actorList[a];if(s.roleType==i.MAIN_ROLE||s.roleType==i.MERCENARY){n[s.roleId]=0;for(var r=null,l=0;l<t.length;++l)if(r=t[l],r.getRoleId()==s.roleId){n[s.roleId]=r.getTitleId();break}}}for(var a=0;o>a;++a){var s=this.actorList[a];(s.roleType==i.MAIN_ROLE||s.roleType==i.MERCENARY)&&s.createAndChangeTitle(n[s.roleId])}},a.prototype.changeSelfActorShowPlayerBasicInfo=function(e){if(this.actorList&&this.actorList.length>0)for(var t=0;t<this.actorList.length;t++)if(egret.is(this.actorList[t],"foxgame.ActorInScene_Role")){var i=this.actorList[t];i.updataPlayerDuanPic(e),i.updateUnionName(e.getUnionName()),i.refreshArmor(e)}},a.prototype.updatePlayerActors=function(){var t=0,n=0;if(this.actorList.length>0)t=this.actorList[0].x,n=this.actorList[0].y;else if(0!=this.doorPos.length)t=this.doorPos[0][0],n=this.doorPos[0][1];else if(this.monsterCrowdList.length>0){var o=this.monsterCrowdList[0];t=o.posX,n=o.posY}for(var a=!1,s=e.PlayerService.instance.getRoleDataList(),r=this.actorList.length,l=e.PlayerService.instance.playerInfo.getPlayerId(),h=0;h<s.length;h++){var c=s[h],u=this.findTheActorByRoleData(c);if(u){var p=u,g=p.updateActorRoleLook(c);g&&(a=!0),this.sceneBase.inUse||(p.curHp<=0?p.visible=!1:p.visible=!0)}else{if(a=!0,c.type==i.MAIN_ROLE||c.type==i.MERCENARY){var d=new e.ActorInScene_Role(c);d.setModelControllerEnable(!0),this.actorList[r]=d,d.simpleInitPosition(t,n,null),d.roleId=c.roleId,d.roleBelongPlayerId=l,d.roleItemId=c.itemId,e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(d,this.BattleOffenceStartIdx+r)}0==t&&0==n&&(this.actorList[r].visible=!1),r++}}this.actorList.length>0&&(this.setMainActor(),this.isMainRoleOK=!0,this.currentBattle&&this.enemyList&&this.enemyList.length>0&&(this.currentBattle.battleType==e.BattleType.BATTLE_PVE_BOSS||this.currentBattle.battleType==e.BattleType.BATTLE_CHALLENGE||this.currentBattle.battleType==e.BattleType.BOSS_PLUNDER_SINGLE||this.currentBattle.battleType==e.BattleType.DAY_COPY||this.currentBattle.battleType==e.BattleType.GHOST_TOWER)||a&&this.moveBG())},a.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:if(i&&"fightValueChange"==i)return;this.onMsgBattlePlayerRefresh(i);break;case e.Code.BP_BATTLE_MAP_CROWD_MONSTER_INFO_S_VALUE:this.onMsgBattleCrowdsInfo(i);break;case e.MsgCMD.Login_Success_Msg:if(this.state==e.BattleState.NONE)break;this.currentBattle?this.interruptCurrentBattle():this.changeState(e.BattleState.NORMAL_SEARCH,"断线重连后恢复自动打小怪"),this.isFirstStartedBattle=!1;break;case e.MsgCMD.NetWork_Closed_Msg:break;case e.Code.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_S_VALUE:this.onBattleMapNpcPlayersInfo(i);break;case e.Code.PK_REFRESH_OPPONENT_S:case e.Code.PK_INFO_S:this.sendRequestBattleMapPkNpcPlayerInfo();break;case e.MsgCMD.BATTLE_VESTIGES_INFO:this.onMsgBattleInfoyiji();break;case e.MsgCMD.BATTLE_INFO_NORMAL:this.onMsgBattleInfoNormal();break;case e.MsgCMD.BATTLE_INFO_CHALLENGE:this.onMsgBattleInfoChallenge(null);break;case e.MsgCMD.BATTLE_MAP_REFRESH:this.onMsgBattleMapRefresh(i);break;case e.MsgCMD.BATTLE_POP_INFO:this.onMsgBattlePopInfo(i);break;case e.MsgCMD.BATTLE_POP_SHOW:break;case e.MsgCMD.BATTLE_POP_HIDE:this.onMsgBattlePopHide(i);break;case e.Code.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_INFO_SYNC:this.onMsgSceneInfoKFbossPalace(i);break;case e.Code.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_RESULT_SYNC:this.onMsgSceneResultKFbossPalace(i);break;case e.Code.SYNC_TWELVE_PALACE_SCENE_INFO:this.onMsgSceneInfoTwelvePalace(i);break;case e.Code.SCENE_PLAYER_ENTER_RESPONSE:e.Global.goBattleBtnswitch=!1,this.onMsgSceneChangeResponse(i);break;case e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC:this.onMsgBattleInfoUpdateResponse(i);break;case e.Code.SYNC_TWELVE_PALACE_SCENE_RESULT_INFO:this.onMsgSceneResultTwelvePalace(i);break;case e.Code.SCENE_PLAYER_RELIVE_RESPONSE:this.onMsgScenePlayerReliveResponse(i)}},a.prototype.initTiledMap=function(){this.isMapTiledOK=!0,StageFrameControl.instance.setScrollEnabled(!1),this.stageWidth=ScreenAdaptation.instance.screenWidth,this.stageHeight=ScreenAdaptation.instance.screenHeight,this.followRectW=Math.floor(.48*this.stageWidth),this.followRectH=Math.floor(.48*this.stageHeight)},a.prototype.processCurPosIdxMonsterCrowdWhenFightResult=function(){if(!this.monsterCrowdList||this.crowdPosIdx<0||this.crowdPosIdx>=this.monsterCrowdList.length)return egret.warn("processCurPosIdxMonsterCrowdWhenFightResult crowdPosIdx invalid:"+this.crowdPosIdx),null;var e=this.crowdPosIdx,t=this.monsterCrowdList[e];this.currentBattle.result>0?t.die():(t.relive(),--e,0>e&&(e=this.monsterCrowdList.length-1),this.crowdPosIdx=e)},a.prototype.stopActorListTweenAction=function(){for(var e=0;e<this.actorList.length;++e){var t=this.actorList[e];t.stopMove(!0)}},a.prototype.stopMapCrowdMonsterTweenAction=function(e,t){void 0===t&&(t=!0);for(var i=0;i<e.monsterList.length;++i){var n=e.monsterList[i];n.stopMove(t)}},a.prototype.pauseMonsterCrowd=function(){this.randomMoveTimer.stop();for(var e=0;e<this.monsterCrowdList.length;++e)for(var t=0;t<this.monsterCrowdList[e].monsterList.length;++t){var i=this.monsterCrowdList[e].monsterList[t];i.visible=!1}this.isShowMapSwitchEffect(!1)},a.prototype.continueMonsterCrowd=function(){this.randomMoveTimer.start();for(var e=0;e<this.monsterCrowdList.length;++e){var t=this.monsterCrowdList[e];if(t.isAlive)for(var i=0;i<t.monsterList.length;++i){this.monsterCrowdList[e].monsterList[i]}}this.isShowMapSwitchEffect(!0)},a.prototype.revertActorListPvePosition=function(){var e=this.mainActor.x,t=this.mainActor.y;this.mainActor.x=this.backupPveMainActorPos.x,this.mainActor.y=this.backupPveMainActorPos.y;for(var i=1;i<this.actorList.length;++i){var n=this.actorList[i];n.x=this.mainActor.x+(n.x-e),n.y=this.mainActor.y+(n.y-t)}this.moveBG()},a.prototype.requestMapPkTypeOneOffencesDffencesPositionInfo=function(e){for(var t=[],i=0;i<this.actorList.length;i++)t.push(Math.floor(this.actorList[i].x)),t.push(Math.floor(this.actorList[i].y));e.setOffencesXy(t);var n=this.crowdPosIdx;this.currentBattle&&(++n,n>=this.monsterCrowdList.length&&(n=this.monsterCrowdList.length-1));for(var o=this.monsterCrowdList[n],a=[],s=0;s<o.monsterList.length;++s){var r=o.monsterList[s];a.push(Math.floor(r.x)),a.push(Math.floor(r.y))}e.setDffencesXy(a)},a.prototype.gotoChallengeBattle=function(t){this.pauseMonsterCrowd(),this.stopActorListTweenAction(),this.mainActor&&this.state>e.BattleState.NORMAL_START&&this.state<e.BattleState.NORMAL_END&&(this.backupPveMainActorPos.x=this.mainActor.x,this.backupPveMainActorPos.y=this.mainActor.y),this.changeNpcPlayerMonsterFighting(!1),this.setNpcPlayerMonsterVisible(!1),this.preloadSLT(this.curBattleMapId)},a.prototype.gotoyiji=function(t,i,n){return this.state<=e.BattleState.NORMAL_START||this.state>=e.BattleState.NORMAL_OVER?void e.GameUtils.MSG_TIP("正在战斗中..."):(e.Message.instance.send(e.MsgCMD.CLOSE_PANEL,0,!1),this.backupPveMainActorPos.x=this.backupPveMainActorPos.y=0,e.MapViewportGroupManager.instance.mapView.setBattleMapPicVisible(!1),this.ruinsTime=Math.abs(n),this.crowdPosIdx=t,this.ruinsTimepanel.skinName="RuinsTime",this.ruinsTimepanel.timeBLabel.text=this.dateBysign(this.ruinsTime),e.Global.uiLayer.addChild(this.ruinsTimepanel),this.ruinsTimepanel.x=egret.MainContext.instance.stage.stageWidth-266,this.ruinsTimepanel.y=60,this.ruinsTimeEvent=new egret.Timer(1e3),this.ruinsTimeEvent.addEventListener(egret.TimerEvent.TIMER,this.onRefreshRuinsTime,this),this.ruinsTimeEvent.start(),this.setViewLayer(!1),this.refreshCenterActor(),this.pauseMonsterCrowd(),this.revertActorListPvePosition(),this.checkUpdateCurBattleMap(i),void this.changeState(e.BattleState.YIJI_MOVE,"刷遗迹"))},a.prototype.onRefreshRuinsTime=function(e){this.ruinsTime+=1e3,this.ruinsTimepanel.timeBLabel.text=this.dateBysign(this.ruinsTime)},a.prototype.setruinsTime=function(e){this.ruinsTime=Math.abs(e)},a.prototype.dateBysign=function(e){if(0==e)return"00m00m00";var t="",i=(e-e%36e5)/36e5;e=Math.floor(e/1e3-60*i*60);var n=Math.floor(e-e%60)/60,o=Math.floor(e-60*n);return t+=i>0?i+"m":"00m",t+=n>=10?n+"m":"0"+n+"m",t+=o>=10?o:"0"+o},a.prototype.gotoNormalBattle=function(t){void 0===t&&(t=0),e.MainControler.instance.bossFightCopyVisible(!0),e.MainControler.instance.bossFightBloodVisible(!0,!1,0),e.MapViewportGroupManager.instance.mapView.setBattleMapPicVisible(!1),this.setViewLayer(!1),this.mainActor&&(this.mainActor.isDead=!1),this.refreshCenterActor(),0==t?(this.revertActorListPvePosition(),this.curBattleMapId=0,this.checkUpdateCurBattleMap()):1==t?this.revertActorListPvePosition():2==t&&(this.curBattleMapId=0,this.checkUpdateCurBattleMap()),this.continueMonsterCrowd(),this.isMonsterCrowdChanged=!1,this.changeNpcPlayerMonsterFighting(!0)},a.prototype.doFightMonsterCrowd=function(e){if(!this.monsterCrowdList||this.crowdPosIdx<0||this.crowdPosIdx>=this.monsterCrowdList.length)return egret.warn("doFightMonsterCrowd crowdPosIdx invalid:"+this.crowdPosIdx),null;var t=this.monsterCrowdList[this.crowdPosIdx];if(t.fight(),1==this.crowdPosIdx){var i=t.monsterList[0];if(0==i.curHp&&1==i.maxHp){var n=e.getBattleData().getDefence()[0];this.updateMonsterCrowdSomeInfo(n.getCurHp(),n.getMaxHp())}}},a.prototype.onRandomMoveUpdate=function(t){this.isMainRoleOK&&this.isMonsterCrowdOK&&this.isMapTiledOK&&this.isAssembleFinishOK&&this.state>e.BattleState.NORMAL_START&&this.state<e.BattleState.NORMAL_OVER&&(this.randomMoveNotFightingAliveMonsterCrowd(),this.reliveMonsterCrowdByTimerAtClient())},a.prototype.randomMoveNotFightingAliveMonsterCrowd=function(){for(var e=this.monsterCrowdList.length,t=0;e>t;++t){var i=this.monsterCrowdList[t];!i.isAlive||i.isFighting||i.isRandomMoving||i.randomMoveTask()}},a.prototype.reliveMonsterCrowdByTimerAtClient=function(){for(var e=this.monsterCrowdList.length,t=0;e>t;++t){var i=this.monsterCrowdList[t];if(0==i.isAlive){var n=egret.getTimer();n-i.iDieTime>15e3&&i.relive()}}},a.prototype.sendRequestBattleMapMonsterCrowdInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRequestMapNearByMonsterInfo");t.setPosIdx(0),e.Message.instance.send(e.Code.BP_REQUEST_BATTLE_MAP_CROWD_MONSTER_INFO_C_VALUE,t,!0)},a.prototype.randomActorListPositionAroundMainActor=function(){for(var t=this.mainActor.x,i=this.mainActor.y,n=50*(.5+Math.random()),o=1;o<this.actorList.length;++o){var a=n*e.GameUtils.randomNegetive()*(.5+Math.random()),s=n*e.GameUtils.randomNegetive()*(.5+Math.random());this.actorList[o].x=Math.floor(t+a),this.actorList[o].y=Math.floor(i+s)}},a.prototype.checkMonsterCrowdVisible=function(){for(var e=StageFrameControl.instance.getScrollViewport(),t=this.monsterCrowdList.length,i=0;t>i;++i){var n=this.monsterCrowdList[i];if(0==n.isFighting&&n.isAlive)for(var o=n.monsterList.length,a=0;o>a;++a){var s=n.monsterList[a];s.x>=e.scrollH&&s.x<=e.scrollH+this.stageWidth&&s.y>=e.scrollV&&s.y<=e.scrollV+this.stageHeight&&this.randomMoveTimer.running?s.visible=!0:(s.visible=!1,n.stopMonsterInvisible(s))}}},a.prototype.updateMonsterCrowdSomeInfo=function(e,t){for(var i=this.monsterCrowdList.length,n=0;i>n;++n)if(0==this.monsterCrowdList[n].isFighting)for(var o=this.monsterCrowdList[n].monsterList.length,a=0;o>a;++a){var s=this.monsterCrowdList[n].monsterList[a];s.curHp=e,s.maxHp=t}},a.prototype.cleanMonsterCrowd=function(){for(var t=this.monsterCrowdList.length,i=0;t>i;++i){this.stopMapCrowdMonsterTweenAction(this.monsterCrowdList[i],!1);for(var n=this.monsterCrowdList[i].monsterList.length,o=0;n>o;++o){var a=this.monsterCrowdList[i].monsterList[o];a.deleteThis(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.getChildIndex(a)>=0?e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.removeChild(a):console.log("cleanMonsterCrowd BattleUnitNode removeChild invalid")}}this.monsterCrowdList.splice(0,t),this.monsterCrowdList=[]},a.prototype.getBattleMapMonsterNextCrowdPosIdx=function(){var e=this.crowdPosIdx+1;return e>=this.monsterCrowdList.length&&(e=this.monsterCrowdList.length-2),e},a.prototype.sendRequestBattleMapPkNpcPlayerInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRequestMapPkOtherNpcPlayersInfo");t.setBattleMapId(this.curBattleMapId),e.Message.instance.send(e.Code.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_C_VALUE,t,!0)},a.prototype.stopMapPkOtherNpcPlayerTweenAction=function(e,t){void 0===t&&(t=!0),e.npcPlayer&&e.npcPlayer.stopMove(t),e.npcMonster&&e.npcMonster.stopMove(t)},a.prototype.changeNpcPlayerMonsterFighting=function(e){for(var t=this.npcPlayerAndMonsterList.length,i=0;t>i;++i){var n=this.npcPlayerAndMonsterList[i];
n.changeFightState(e),this.stopMapPkOtherNpcPlayerTweenAction(n)}},a.prototype.destroyNpcPlayerMonster=function(){console.warn("destroyNpcPlayerMonster");for(var e=this.npcPlayerAndMonsterList.length,t=0;e>t;++t){var i=this.npcPlayerAndMonsterList[t];i.destroyResModelController()}},a.prototype.restoreNpcPlayerMonster=function(){Log.trace("雄霸天下 恢复挂机战斗");for(var e=this.npcPlayerAndMonsterList.length,t=0;e>t;++t){var i=this.npcPlayerAndMonsterList[t];i.restoreResModelController()}},a.prototype.checkNpcPlayerMonsterVisible=function(){for(var e=StageFrameControl.instance.getScrollViewport(),t=this.npcPlayerAndMonsterList.length,i=0;t>i;++i){var n=this.npcPlayerAndMonsterList[i];if(0==n.isPvpFighting&&n.isPveFighting){var o=n.npcPlayer;o.x>=e.scrollH&&o.x<=e.scrollH+this.stageWidth&&o.y>=e.scrollV&&o.y<=e.scrollV+this.stageHeight&&this.randomMoveTimer.running?(n.setVisible(!0),n.doFight(!0)):n.setVisible(!1)}}},a.prototype.setNpcPlayerMonsterVisible=function(e){for(var t=this.npcPlayerAndMonsterList.length,i=0;t>i;++i){var n=this.npcPlayerAndMonsterList[i];n.setVisible(e)}},a.prototype.cleanNpcPlayers=function(){for(var t=this.npcPlayerAndMonsterList.length,i=0;t>i;++i){var n=this.npcPlayerAndMonsterList[i];this.stopMapPkOtherNpcPlayerTweenAction(n,!1),n.npcMonster.deleteThis(),n.npcPlayer.deleteThis(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.getChildIndex(n.npcMonster)>=0&&e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.removeChild(n.npcMonster),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.getChildIndex(n.npcPlayer)>=0&&e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.removeChild(n.npcPlayer)}this.npcPlayerAndMonsterList.splice(0,t),this.npcPlayerAndMonsterList=[]},a.prototype.findMapPkOtherNpcPlayerByPlayerId=function(e){for(var t=null,i=this.npcPlayerAndMonsterList.length,n=0;i>n;++n){var o=this.npcPlayerAndMonsterList[n];if(o.iPlayerId==e){t=o;break}}return t},a.prototype.onBattleMapNpcPlayersInfo=function(t){var i=t;this.cleanNpcPlayers();for(var n=[],o=i.getNpcPlayers().length,a=0;o>a;++a){var s=i.getNpcPlayers()[a],r=this.findMapPkOtherNpcPlayerByPlayerId(s.getITruePlayerId());if(r){n.push(r);var l=this.npcPlayerAndMonsterList.indexOf(r);this.npcPlayerAndMonsterList.splice(l,1);var h=e.BattleService.instance.makeRoleDataFromPlayerSnapshot(s.getPlayerSnapshotInfo());r.npcPlayer.updateActorRoleLook(h),r.rdata=h;var c=s.getPlayerSnapshotInfo().getTitleInfo();if(c){for(var u=c.getUseTitleInfo(),p=0,g=0;g<u.length;++g){var d=u[g];if(h.roleId==d.getRoleId()){p=d.getTitleId();break}}r.npcPlayer.createAndChangeTitle(p)}}else{var f=new e.MapPkOtherNpcPlayer;f.posIdx=s.getPosIdx(),f.posNpcX=s.getPosNpcX(),f.posNpcY=s.getPosNpcY(),f.posMonsterX=s.getPosMonsterX(),f.posMonsterY=s.getPosMonsterY(),f.iUseSkillId=s.getIUseSkillId();var m=new e.ActorInScene_Monster(null,null);m.setModelControllerEnable(!0),m.simpleInitPosition(f.posMonsterX,f.posMonsterY),m.simpleInitFromMonsterId(s.getIMonsterId()),m.roleId=s.getIMonsterId(),f.npcMonster=m,e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(m,this.BattleNpcMonsterStartIdx+a),f.iPlayerId=s.getITruePlayerId();var h=e.BattleService.instance.makeRoleDataFromPlayerSnapshot(s.getPlayerSnapshotInfo()),y=new e.ActorInScene_Role(h);y.setModelControllerEnable(!0),y.simpleInitPosition(f.posNpcX,f.posNpcY,null),y.roleId=h.roleId,y.roleItemId=h.itemId,e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(y,this.BattleNpcPlayerStartIdx+a),f.npcPlayer=y,f.rdata=h;var c=s.getPlayerSnapshotInfo().getTitleInfo();if(c){for(var u=c.getUseTitleInfo(),p=0,g=0;g<u.length;++g){var d=u[g];if(h.roleId==d.getRoleId()){p=d.getTitleId();break}}f.npcPlayer.createAndChangeTitle(p)}n.push(f)}}this.cleanNpcPlayers(),this.npcPlayerAndMonsterList=n,this.state==e.BattleState.NONE&&this.setNpcPlayerMonsterVisible(!1)},a.prototype.checkUpdateCurBattleMap=function(t){void 0===t&&(t=null);var i=t||e.PlayerService.instance.playerStateInfo.getCurBattleMap();if(this.curBattleMapId!=i){var n=e.JsonDataManager.instance.mapTemplate,o=n[i];if(!o)return void Log.trace("checkUpdateCurBattleMap no mapinfo: "+i);if(o){this.curBattleMapId=i;var a=o.mapJump.split(",");this.enterPoint=[],this.enterPoint.push(Number(a[0])),this.enterPoint.push(Number(a[1])),this.mainActor&&0==this.mainActor.x&&0==this.mainActor.y&&(this.mainActor.x=this.enterPoint[0],this.mainActor.y=this.enterPoint[1],this.refreshCenterActor(),this.moveBG(),this.randomActorListPositionAroundMainActor())}this.moveBgBattleMapId=this.curBattleMapId;var s,r=o.battleIcon,l=r.split("/");if(l.length>=2){var h=l[1].split(".");s=h[0]}null!=o&&e.MapViewportGroupManager.instance.mapView.setBattleBG(s,o),this.moveBG(),this.checkMapSwitchPointAddSwitchEffect(this.curBattleMapId),this.refreshCrowdsByMapId(this.curBattleMapId)}},a.prototype.interruptCurrentBattle=function(){var t=!1;this.currentBattle&&this.currentBattle.battleType!=e.BattleType.BATTLE_PVE_MONSTER&&this.currentBattle.battleType!=e.BattleType.RUINS_BATTLE_TYPE&&(t=!0,this.stopActorListTweenAction());this.currentBattle.result;this.releaseBattleRes(),this.resetTwelvePalace(),this.state>e.BattleState.CHALLENGE_START&&this.state<e.BattleState.CHALLENGE_OVER&&(this.currentBattle&&this.currentBattle.battleType!=e.BattleType.BATTLE_PVE_MONSTER,this.gotoNormalBattle()),t&&this.changeState(e.BattleState.NORMAL_SEARCH,"打断当前战斗")},a.prototype.quitFuBen=function(){if(this.currentBattle)if(this.currentBattle.battleType==e.BattleType.BATTLE_CHALLENGE){var t=e.RequestFightManager.instance.getBattleId(),i=HawkProtocolManager.newBuilder("JsProto.HPBossPlunderFightCannelReq");i.setId(t),e.Message.instance.send(e.Code.BP_BOSS_CANNEL_FIGHT_C,i,!0)}else if(this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER){var n=e.WorldSceneType.OldMonsterBattleMap,o=1,s=e.MainControler.instance.sceneType||e.WorldSceneType.TwelvePalaceBossBattleMap,r=e.MainControler.instance.sceneId||1;a.instance.sendMsgSceneChangeRequest(n,o,s,r)}else if(this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER){var n=e.WorldSceneType.OldMonsterBattleMap,o=1,s=e.MainControler.instance.sceneType||e.WorldSceneType.CrossServerBossBattleMap,r=e.MainControler.instance.sceneId||1;a.instance.sendMsgSceneChangeRequest(n,o,s,r)}else{var i=HawkProtocolManager.newBuilder("JsProto.ExitBattleFightReq");i.setBattleType(this.currentBattle.battleType),e.Message.instance.send(e.Code.EXIT_BATTLE_C,i,!0)}},a.prototype.CanTiaoZhan=function(e){this.canT=!0},a.prototype.autoPveBossFight=function(){if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER&&this.fightCount>=e.Global.killMonsterNum&&e.Global.isAutoFightBoss){var t=e.JsonDataManager.instance.mapTemplate,i=t[e.PlayerService.instance.playerStateInfo.getCurBattleMap()],n=i.limitLevel;if(e.PlayerService.instance.mainRoleInfo.getLevel()<n)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("MAPBOSSFIGHTTIPS",n)),e.Message.instance.send(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,!0),void e.MainControler.instance.setAutoBossBtnState(!1);if(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan,null,2),!this.canT)return void e.Message.instance.send(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,!0);this.canT=!1,e.MainControler.instance.jingjiPvpChangeUI(),this.fightCount=-1,e.Global.killMonsterNum=Math.floor(Math.max(e.PlayerService.instance.level/15-1,0)+1),e.MainControler.instance.setBossFightCountProgress(this.fightCount,e.Global.killMonsterNum),e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_PVE_BOSS,this.currentBattle.mapId)}},a.prototype.filterFunctionForUnit=function(e,t,i){return e.visible?!0:!1},a.prototype.compareFunctionForUnit=function(e,t){return e.visible||t.visible?0==e.isDead&&t.isDead?1:e.isDead&&0==t.isDead?-1:e.y>t.y?1:e.y<t.y?-1:0:0},a.prototype.findActorByFightRole=function(t){for(var n=null,o=e.PlayerService.instance.playerInfo.getPlayerId(),a=this.actorList.length,s=0;a>s;++s){var r=this.actorList[s];if(r.roleType==t.getRole().getType()&&r.roleType==i.MAIN_ROLE&&o==t.getRole().getPlayerId()){n=r;break}if(r.roleType==t.getRole().getType()&&r.roleType==i.MERCENARY&&r.roleItemId==t.getRole().getRoleItemId()&&o==t.getRole().getPlayerId()){n=r;break}if(r.roleType==t.getRole().getType()&&r.roleType==i.CALLBEAST){var l=t.getRole().getMonsterId(),h=t.getRole().getPlayerId();if(h==r.roleBelongPlayerId){if(l>391e3&&392e3>l&&r.roleId>391e3&&r.roleId<392e3){n=r;break}if(l>392e3&&393e3>l&&r.roleId>392e3&&r.roleId<393e3){n=r;break}}}else if(r.roleType==t.getRole().getType()&&i.BEAUTY==t.getRole().getType()){var h=t.getRole().getPlayerId();if(h==r.roleBelongPlayerId){var l=t.getRole().getMonsterId();l>=393001&&393007>=l&&(n=r)}}}return n},a.prototype.findMonsterByFightRoleFromCrowd=function(e,t,i){if(!this.monsterCrowdList||0>t||t>=this.monsterCrowdList.length)return egret.warn("findMonsterByFightRoleFromCrowd crowdIdx invalid:"+t),null;var n=null,o=this.monsterCrowdList[t],a=o.monsterList.length;return 0>i||i>=a?(egret.warn("findMonsterByFightRoleFromCrowd monsterIdx invalid:"+i),null):n=o.monsterList[i]},a.prototype.UpdateActorsByFilms=function(t){var n=[],o=0,a=0;o=this.actorList.length,a=t.offence.length;for(var s=0;a>s;++s){var r=t.offence[s],l=this.findActorByFightRole(r);if(l)n[s]=l,l.roleBelongPlayerId=r.getRole().getPlayerId(),l.updateBattleData(r,this.currentBattleData);else{var h=r.getRole().getType();if(h==i.MAIN_ROLE||h==i.MERCENARY){var c=new e.ActorInScene_Role(null);c.pvpFightInit(r,this.currentBattleData),c.setModelControllerEnable(!0),c.roleItemId=r.getRole().getRoleItemId(),c.roleBelongPlayerId=r.getRole().getPlayerId(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(c,this.BattleOffenceStartIdx+s),n[s]=c}else{var u=new e.ActorInScene_Monster(r,this.currentBattleData);u.setModelControllerEnable(!0),u.roleBelongPlayerId=r.getRole().getPlayerId(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(u,this.BattleOffenceStartIdx+s),u.roleId=r.getRole().getMonsterId(),n[s]=u}}}if(this.actorList=n,this.sortActorList(),null==this.enemyList)for(this.enemyList=[],o=0,a=t.defence.length;a>o;o++)if(t.battleType==e.BattleType.BATTLE_PVE_MONSTER||t.battleType==e.BattleType.RUINS_BATTLE_TYPE){var p=this.findMonsterByFightRoleFromCrowd(t.defence[o],this.crowdPosIdx,o);p&&(p.updateBattleData(t.defence[o],this.currentBattleData),this.enemyList[o]=p)}else if(t.battleType==e.BattleType.BATTLE_PVP_ARENA||t.battleType==e.BattleType.BATTLE_MAP_PK||t.battleType==e.BattleType.FRIEND_PK_BATTLE||t.battleType==e.BattleType.ENEMY_PK_BATTLE||t.battleType==e.BattleType.CS_ARENA_DAN||t.battleType==e.BattleType.CS_ARENA_PRELIMINARY){var c=new e.ActorInScene_Role(null);c.pvpFightInit(t.defence[o],this.currentBattleData),c.setModelControllerEnable(!0),this.enemyList[o]=c,e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(this.enemyList[o],o)}else{var g=t.defence[o];if(g.getRole().getPlayerId()>0){var c=new e.ActorInScene_Role(null);c.pvpFightInit(t.defence[o],this.currentBattleData),c.setModelControllerEnable(!0),this.enemyList[o]=c}else this.enemyList[o]=new e.ActorInScene_Monster(t.defence[o],this.currentBattleData),this.enemyList[o].setModelControllerEnable(!0);e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(this.enemyList[o],o)}},a.prototype.chanageMapByBattleFilm=function(){if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER)this.checkUpdateCurBattleMap();else if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_BOSS)e.MapViewportGroupManager.instance.mapView.setBattleMapPicVisible(!0),this.checkUpdateCurBattleMap();else if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.RUINS_BATTLE_TYPE)this.checkUpdateCurBattleMap(this.currentBattle.mapId);else if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_MAP_PK&&1==this.lastMapFieldPKRequestType)e.MapViewportGroupManager.instance.mapView.setBattleMapPicVisible(!0),this.checkUpdateCurBattleMap();else if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVP_CAMP)e.MapViewportGroupManager.instance.mapView.setBattleMapPicVisible(!0),this.checkUpdateCurBattleMap(this.currentBattle.mapId);else{var t=e.JsonDataManager.instance.mapTemplate,i=this.currentBattle.mapId,n=t[i].bossMapID,o=t[n],a=o.battleIcon,s=a.split("/"),r=void 0;if(s.length>=2){var l=s[1].split(".");r=l[0]}this.moveBgBattleMapId=n,r&&e.MapViewportGroupManager.instance.mapView.setBattleBG(r,o);var h=null;this.centerActor&&(h=new egret.Point(this.centerActor.x,this.centerActor.y))}e.MainControler.instance.refreshPKPlayer()},a.prototype.moveToNextMonsterCrowd=function(){if(this.crowdPosIdx<0||this.crowdPosIdx>=this.monsterCrowdList.length)return void Log.trace("crowd monster not found,monsterCrowdList "+this.monsterCrowdList.length+",idx "+this.crowdPosIdx);this.crowdPosIdx++;var t=!1;this.crowdPosIdx>=this.monsterCrowdList.length&&(this.crowdPosIdx=0,t=!0);var i=this.monsterCrowdList[this.crowdPosIdx],n=new egret.Point;if(n.x=i.posX,n.y=i.posY,t){var o=this.mainActor.getPosition(),a=egret.Point.distance(o,n);a>this.stageWidth&&(this.backupPveMainActorPos.x=n.x,this.backupPveMainActorPos.y=n.y,this.revertActorListPvePosition())}this.refreshCenterActor(),this.mainActor.visible=!0;var s=new egret.Point;s.x=this.mainActor.x,s.y=this.mainActor.y;var r=egret.Point.distance(n,s);if(r>20){var l=Math.floor(r/1.5),h=(n.x-s.x)*l/r+s.x;h=Math.floor(h);var c=(n.y-s.y)*l/r+s.y;c=Math.floor(c),n.x=h,n.y=c}this.mainActor.moveToWorldPos_byLine(n,this.onMoveToMonsterCrowd,!0,this),this.delayTimeIdxArray[0]=0;for(var u=100*(.5+Math.random()),p=0;p<this.actorList.length;++p){var g=this.actorList[p];if(g!=this.mainActor){g.visible=!0,g.stopMove(!0);var d=new egret.Point;d.x=n.x+u*e.GameUtils.randomNegetive()*(.5+Math.random()),d.y=n.y+u*e.GameUtils.randomNegetive()*(.5+Math.random()),d.x=Math.floor(d.x),d.y=Math.floor(d.y);var f=600*(.5+Math.random());this.delayTimeIdxArray[p]=egret.setTimeout(this.delayMoveAction,this,f,[this.actorList[p],d,p])}}this.isOnPathFindingCrowd=!0},a.prototype.delayTwMoveAction=function(e,t,i,n,o,a){void 0===n&&(n=!1),void 0===o&&(o=null),void 0===a&&(a=null),this.isOnPathFindingCrowd&&e.moveToWorldPos_byLine(t,null,!0)},a.prototype.delayMoveAction=function(e){var t=e[0],i=e[1],n=e[2];this.isOnPathFindingCrowd&&t.moveToWorldPos_byLine(i,null,!0);var o=this.delayTimeIdxArray[n];egret.clearTimeout(o)},a.prototype.onMoveToMonsterCrowd=function(){if(this.state==e.BattleState.NORMAL_SEARCH){this.isOnPathFindingCrowd=!1;for(var t=1;t<this.actorList.length;++t)this.actorList[t].stopMove(!1);this.getNormalBattleInfo(null)}},a.prototype.onFighting=function(){if(!this.currentBattle){if(this.currentBattle=null,this.state==e.BattleState.NORMAL_SEARCH)return;return void this.changeState(e.BattleState.NORMAL_SEARCH,"继续打小怪")}var t=!1;if(this.finishedFilmActors.length>=this.currentBattle.offence.length+this.currentBattle.defence.length)t=!0;else if(this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER){var i=!0;if(i)for(var n in this.actorList){var o=this.actorList[n];if(o.isInBattle||0!=o.iDelayFinishCount){i=!1;break}}if(i)for(var n in this.enemyList){var o=this.enemyList[n];if(o.isInBattle||0!=o.iDelayFinishCount){i=!1;break}}i&&(t=!0)}else if(this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER||this.currentBattle.battleType==e.BattleType.RUINS_BATTLE_TYPE){var i=!0;if(i)for(var n in this.actorList){var o=this.actorList[n];if(o.isInBattle&&null!=o.filmActions){i=!1;break}}if(i)for(var n in this.enemyList){var o=this.enemyList[n];if(o.isInBattle&&null!=o.filmActions){i=!1;break}}i&&(t=!0)}if(t){if((this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER)&&!this._twelvePalaceBattleResult)return;return void(this.state==e.BattleState.NORMAL_BATTLING?this.changeState(e.BattleState.NORMAL_DROP,"战报播放完毕"):this.state==e.BattleState.CHALLENGE_BATTLING?this.changeState(e.BattleState.CHALLENGE_DROP,"战报播放完毕"):this.state==e.BattleState.YIJI_BATTLE&&this.changeState(e.BattleState.YIJI_DROP,"战报播放完毕"))}for(var n=0;n<this.actorList.length;n++)this.actorList[n].battleFrameUpdate();e.MainBottomControler.instance.refreshHpBar(this.calcRoleToltalHpPercent(this.actorList)),(this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER)&&this.refreshTwelvePalacePlayerDetail();for(var n=0;n<this.enemyList.length;n++)this.enemyList[n].battleFrameUpdate()},a.prototype.calcRoleToltalHpPercent=function(t){for(var i=t.length,n=0,o=0,a=0;i>a;a++){var s=t[a];if(s instanceof e.ActorInScene_Role){var r=s.curHp,l=s.maxHp;n+=Number(r),o+=Number(l)}}return n/o},a.prototype.createDropItemInMap=function(t){null!=this.currentBattleData&&this.droItemList.push(e.DropItem.addDropItem(t))},a.prototype.dropAward=function(t,i,n,o){var a=this;void 0===o&&(o=null);var s=0,r=80,l=0,h=0,c=n.x,u=n.y;t==e.BattleType.BATTLE_MAP_PK;for(var p=i.length,g=1,d=1;p>=d;d++)if(d*d>=p){g=d;break}var f=Math.ceil(p/g),m=f*r+(f-1)*s,y=g,I=y*r+(y-1)*s;l=m/2>c?0:c+m/2>e.Global.battleMapWidth?e.Global.battleMapWidth-m:c-m/2,c=l+m/2,h=I/2>u?0:u+I/2>e.Global.battleMapHeight?e.Global.battleMapHeight-I:u-I/2,u=h+I/2,this.droItemList=[];for(var v=p,_=0,T=function(e){var t=Math.floor(e/g),n=t%2==0?e%g:g-1-e%g,p=l+t*(s+r)+r/2,d=h+n*(s+r)+r/2,f=i[e],m={itemid:f.getItemId(),countNum:f.getCount(),oriPos:new egret.Point(c,u),dstPos:new egret.Point(p,d),callback:function(){_++,o&&_==v&&o()}.bind(C)},y=egret.setTimeout(function(e){a.removeFromStateTimerList(y),a.createDropItemInMap(e)},C,0,m);C.addToStateTimerList(y)},C=this,d=0;p>d;d++)T(d)},a.prototype.clientTimeFrameDeltCheck=function(){var t=!0,i=e.Global.globalConfig.isDebug,n=egret.getTimer(),o=App.TimerManager().frameCount,a=n-this.lastRequestBattleTimestamp,s=o-this.lastRequestBattleFrameIdx;return 1500>=a&&(console.error("BattleScene deltTimems too short"),(i||0>=a)&&(t=!1)),30>=s&&(console.error("BattleScene deltFrames too short"),i&&(t=!1)),t&&(this.lastRequestBattleTimestamp=n,this.lastRequestBattleFrameIdx=o),t},a.prototype.getNormalBattleInfo=function(t){if(void 0===t&&(t=null),this.state==e.BattleState.NORMAL_SEARCH){var i=this.clientTimeFrameDeltCheck();if(!i){this._delayRequestNormalBattleHandler&&(clearTimeout(this._delayRequestNormalBattleHandler),this._delayRequestNormalBattleHandler=null);var n=this;return void(this._delayRequestNormalBattleHandler=setTimeout(function(){n._delayRequestNormalBattleHandler=null,n.getNormalBattleInfo(t)},this._delayRequestNormalBattleTime))}this.stopTimerRequestNormal();var o=HawkProtocolManager.newBuilder("JsProto.HPMapBattleRequest");o.setBattleType(e.BattleType.BATTLE_PVE_MONSTER),o.setBattleArgs(this.curBattleMapId);var a=this.monsterCrowdList[this.crowdPosIdx];a.fight();var s=[];if(null==t)for(var r=0;r<this.actorList.length;r++)s.push(Math.floor(this.actorList[r].x)),s.push(Math.floor(this.actorList[r].y));else s=t;o.setXy(s),Log.trace("坐标:"+s);for(var l=[],h=0;h<a.monsterList.length;++h){var c=a.monsterList[h];l.push(Math.floor(c.x)),l.push(Math.floor(c.y))}o.setMonsterCrowdIdx(this.crowdPosIdx),o.setMonsterXy(l),e.Message.instance.send(e.Code.MAP_BATTLE_REQUEST_C,o,!0),e.BattleService.instance.clearBattleInfo("NORMAL"),this.startTimerRequestNormal()}},a.prototype.startTimerRequestNormal=function(){this.stopTimerRequestNormal(),this.requestTimer=setTimeout(this.getNormalBattleInfo.bind(this),2e3)},a.prototype.stopTimerRequestNormal=function(){this.requestTimer&&(clearTimeout(this.requestTimer),this.requestTimer=null)},a.prototype.releaseBattleRes=function(){if(!this.currentBattle)return void console.log("releaseBattleRes currentBattle null");for(var t=e.PlayerService.instance.playerInfo.getPlayerId(),i=[],n=0;n<this.actorList.length;n++){var o=this.actorList[n];o.roleBelongPlayerId==t?(o.stopMove(!0),o.cleanBuffList(),o.cleanAllEffectState(),o.visible=!0,i.push(o)):(o.deleteThis(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.getChildIndex(o)>=0?e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.removeChild(o):console.log("releaseBattleRes BattleUnitNode removeChild invalid"))}if(null!=this.enemyList){if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER)this.processCurPosIdxMonsterCrowdWhenFightResult();else for(var n=0;n<this.enemyList.length;n++){var o=this.enemyList[n];o.roleBelongPlayerId==t?(o.stopMove(!0),o.cleanBuffList(),o.cleanAllEffectState(),o.visible=!0,i.push(o)):(o.deleteThis(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.getChildIndex(o)>=0?e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.removeChild(o):console.log("releaseBattleRes BattleUnitNode removeChild invalid"))}this.enemyList.splice(0,this.enemyList.length)}this.actorList=i,this.enemyList=null,this.currentBattleData=null,this.currentBattle=null,this.finishedFilmActors.splice(0,this.finishedFilmActors.length),this.finishedFilmActors=[],e.MapViewportGroupManager.instance.sceneView.SkillCasterNode.removeChildren(),e.MapViewportGroupManager.instance.sceneView.SkillNode.removeChildren();for(var n=0;n<this.droItemList.length;n++){var a=this.droItemList[n];a.dispose(!1),this.droItemList[n]=null}this.droItemList=[],e.MapViewportGroupManager.instance.sceneView.uiTextNode.removeChildren()},a.prototype.getUnitById=function(e){if(this.sceneBase&&this.sceneBase.inUse)return this.sceneBase.findActorByUnitId(e);for(var t=0;t<this.actorList.length;t++)if(this.actorList[t].fightRoleData&&this.actorList[t].fightRoleData.getId()==e)return this.actorList[t];if(!this.enemyList)return egret.warn("getUnitById when enemyList has been empty"),null;for(var t=0;t<this.enemyList.length;t++)if(this.enemyList[t]&&this.enemyList[t].fightRoleData&&this.enemyList[t].fightRoleData.getId()==e)return this.enemyList[t];return null},a.prototype.moveBG=function(t,i,n){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=!1),2==e.MainBottomControler.PageState&&this.actorList.length>0){var o=this.actorList[0].x,a=this.actorList[0].y;if(t&&i&&(o=t,a=i),!n&&Math.abs(o-this.lastMvCenterX)<1&&Math.abs(a-this.lastMvCenterY)<1)return;this.lastMvCenterX=o,this.lastMvCenterY=a;var s=o,r=a,l=StageFrameControl.instance.getScrollViewport(),h=e.MapViewportGroupManager.instance.mapView,c=l.scrollH;o<c+this.followRectW?c=o-this.followRectW:o>c+(this.stageWidth-this.followRectW)&&(c=o-(this.stageWidth-this.followRectW)),a<l.scrollV+this.followRectH?l.scrollV=a-this.followRectH:a>l.scrollV+(this.stageHeight-this.followRectH)&&(l.scrollV=a-(this.stageHeight-this.followRectH));var u=e.Global.battleMapWidth,p=e.Global.battleMapHeight,g=e.JsonDataManager.instance.mapTemplate;if(g[this.moveBgBattleMapId]){var d=g[this.moveBgBattleMapId];u=d.mapXGrid*e.Global.mainMapTileWidth,p=d.mapYGrid*e.Global.mainMapTileWidth}c>u-this.stageWidth?c=u-this.stageWidth:0>c&&(c=0),l.scrollV>p-this.stageHeight?l.scrollV=p-this.stageHeight:l.scrollV<0&&(l.scrollV=0),e.GamePlatform.isQQdating&&h.width<h.stage.stageWidth&&(c=h.width-h.stage.stageWidth>>1),l.scrollH=c,e.MapViewportGroupManager.instance.mapView.onMoveBattleMapPic(s,r)}},a.prototype.getBattleMoveBgMapSize=function(){var t=new egret.Point,i=e.Global.battleMapWidth,n=e.Global.battleMapHeight,o=e.JsonDataManager.instance.mapTemplate;if(o[this.moveBgBattleMapId]){var a=o[this.moveBgBattleMapId];i=a.mapXGrid*e.Global.mainMapTileWidth,n=a.mapYGrid*e.Global.mainMapTileWidth}return t.x=i,t.y=n,t},a.prototype.checkMapSwitchPointAddSwitchEffect=function(t){var i=e.JsonDataManager.instance.mapTemplate,n=i[t];if(!n)return void Log.trace("checkMapSwitchPointAddSwitchEffect no mapinfo: "+t);for(var o=n.mapJump.match(/,/g).length,a=n.mapJump.split(","),s=[],r=0,l=0;(o+1)/2>l;l++){for(var h=[],c=r;r+1>=c;c++)h.push(1*a[c]);r+=2,s.push(h)}this.doorPos=s;for(var u=0;u<s.length;u++){var p=this.doorNode[u];if(!p){p=new egret.DisplayObjectContainer,p.name="battleMapDoorNode",this.doorNode[u]=p;var g=new e.FoxAni(p);g.play("movestand","movestand",-1),e.MapViewportGroupManager.instance.mapView.mBattleGroup.addChild(p)}2>u?(p.x=s[u][0],p.y=s[u][1],p.visible=!0):p.visible=!1}for(;u<this.doorNode.length;u++)this.doorNode[u].visible=!1},a.prototype.isShowMapSwitchEffect=function(e){if(this.doorNode.length>0)for(var t=0;2>t;t++)this.doorNode[t].visible=e},a.prototype.createFlyEffect=function(t){var i=t.actorList,n=t.flyCallback,o=t.landPointList,a=t.landCallback;if(0==i.length)return n&&n(),void(a&&a());for(var s=e.MapViewportGroupManager.instance.sceneView,r=function(t){var r=i[t],h=l.flyEffectList[t];h||(h=new egret.DisplayObjectContainer,s.addChild(h),l.flyEffectList[t]=h);var c=r.x-i[0].x,u=r.y-i[0].y,p=o[0].x+c,g=o[0].y+u;o[t]&&(p=o[t].x,g=o[t].y),egret.Tween.removeTweens(r),egret.Tween.get(r).call(function(){h.x=r.x,h.y=r.y;var t=new e.FoxAni(h);t.setPlayComplete(function(){t.dispose()},this),t.play("skill201_1","skill201_1",1)},l).to({y:r.y-100},100,egret.Ease.sineIn).call(function(){r.visible=!1,e.TextureCache.getInstance().releaseCache(e.ReleaseType.LEAST_RECENTLY_USED,10485760)},l).wait(750).call(function(e){0==e&&n&&n()},l,[t]).to({x:p,y:g-143},0).call(function(e){r.visible=!0,0==e&&this.moveBG(p,g)},l,[t]).to({y:g},100,egret.Ease.sineOut).call(function(){h.x=r.x,h.y=r.y;var t=new e.FoxAni(h);t.setPlayComplete(function(){t.dispose()},this),t.play("skill201_1","skill201_1",1)},l).wait(500).call(function(e){0==e&&a&&a()},l,[t])},l=this,h=0;h<i.length;h++)r(h)},a.prototype.preloadSLT=function(t){var i=e.JsonDataManager.instance.mapTemplate,n=i[t]&&i[t].mapNextId,o=n&&i[n];if(o){var a,s=o.battleIcon,r=s.split("/");if(r.length>=2){var l=r[1].split(".");a=l[0]}a&&(RES.createGroup("preMap_"+a,[a+"_slt_jpg"]),App.getResourceUtils().loadGroup("preMap_"+a,null,null,e.Global.LoadMapPreviewMoHuSuoLueTuPicPriority))}},a.prototype.showEfficiencyUp=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),t!=i){var n=e.JsonDataManager.instance.mapTemplate,o=n[t],a=n[i];o&&a&&(e.EfficiencyUpController.getInstance().showPanel(),e.EfficiencyUpController.getInstance().setModelData({oldMapInfo:o,newMapInfo:a}))}},a.prototype.onUpdate=function(t){if(!this.sceneBase.inUse){var i=egret.getTimer();i-this.lastCheckTimestamp>330&&e.MainBottomControler.PageState==e.SceneType.Field&&(this.checkMonsterCrowdVisible(),this.checkNpcPlayerMonsterVisible(),this.lastCheckTimestamp=i,e.MainControler.instance.inBattle&&this.sortBattleUnit()),this.state==e.BattleState.NORMAL_BATTLING?this.onFighting():this.state==e.BattleState.CHALLENGE_BATTLING?this.onFighting():this.state==e.BattleState.YIJI_BATTLE&&this.onFighting()}},a.prototype.changeState=function(e,i){void 0===i&&(i="");var n=new t(t.CHANGE_STATE,e,i);this.stateNode.dispatchEvent(n)},a.prototype.onStateChange=function(t){switch(this.clearStateTimerList(),this.state){case e.BattleState.NORMAL_SEARCH:this.interruptStateNormalSearch();break;case e.BattleState.CHALLENGE_DROP:this.interruptStateChallengeDrop();break;case e.BattleState.NONE:this.interruptStateNone()}switch(this.state=e.BattleState.NONE,t.state){case e.BattleState.NORMAL_SEARCH:this.changeToStateNormalSearch();break;case e.BattleState.NORMAL_BATTLING:this.changeToStateNormalBattling();break;case e.BattleState.YIJI_BATTLE:e.MainControler.instance.bossFightBloodVisible(!1,!1,0),this.state=e.BattleState.YIJI_BATTLE;break;case e.BattleState.NORMAL_DROP:this.changeToStateNormalDrop();break;case e.BattleState.NORMAL_END:this.changeToStateNormalEnd();break;case e.BattleState.CHALLENGE_TRANS:this.changeToStateChallengeTrans();break;case e.BattleState.CHALLENGE_BATTLING:this.changeToStateChallengeBattling();break;case e.BattleState.YIJI_MOVE:e.MainControler.instance.bossFightBloodVisible(!1,!1,0),this.changeToStateyijimove();break;case e.BattleState.CHALLENGE_DROP:this.changeToStateChallengeDrop();break;case e.BattleState.YIJI_DROP:this.changeToStateyijiDrop();break;case e.BattleState.CHALLENGE_POP:this.changeToStateChallengePop();break;case e.BattleState.YIJI_POP:this.changeToStateyijiPop();break;case e.BattleState.CHALLENGE_END:this.changeToStateChallengeEnd();break;case e.BattleState.YIJI_END:this.changeToStateyijiEnd();break;case e.BattleState.CHALLENGE_DOOR:this.changeToStateChallengeDoor();break;case e.BattleState.NONE:this.changeToStateNone()}},a.prototype.opendialogue=function(t,i){var n=this,o=new eui.Component;this.ruinsTimeEvent.stop();var a=function(){egret.Tween.removeTweens(o),o.fetch_button0.removeEventListener(egret.TouchEvent.TOUCH_TAP,a,n),e.Global.uiLayer.removeChild(o),o=null,n.ruinsTimeEvent.start(),i(),a=null};o.skinName="Ruinsdialog",o.width=egret.MainContext.instance.stage.stageWidth,o.height=egret.MainContext.instance.stage.stageHeight;var s=e.PlayerService.instance.getRoleVO(this.actorList[0].fightRoleData.getRole().getRoleItemId());o.npc_image.source=1==s.sex?"guideMission_n_208_png":"guideMission_n_204_png",o.fetch_button0.addEventListener(egret.TouchEvent.TOUCH_TAP,a,this),o.fetch_time_label0.text="5s",o.mission_text_label0.textFlow=(new egret.HtmlTextParser).parser(t),e.Global.uiLayer.addChild(o),egret.Tween.get(o,{}).wait(1e3).call(function(){o.fetch_time_label0.text="4s"}).wait(1e3).call(function(){o.fetch_time_label0.text="3s"}).wait(1e3).call(function(){o.fetch_time_label0.text="2s"}).wait(1e3).call(function(){o.fetch_time_label0.text="1s"}).wait(1e3).call(function(){o.fetch_time_label0.text="0s",o.fetch_button0.removeEventListener(egret.TouchEvent.TOUCH_TAP,a,n),a()})},a.prototype.changeToStateyijimove=function(){var t=this;if(this.state=e.BattleState.YIJI_MOVE,e.BossBloodGroup.getInstance().close(),this.crowdPosIdx>=5)return this.releaseBattleRes(),this.gotoNormalBattle(),this.ruinsTimeEvent.removeEventListener(egret.TimerEvent.TIMER,this.onRefreshRuinsTime,this),e.Global.uiLayer.removeChild(this.ruinsTimepanel),this.ruinsTimeEvent=null,this.changeState(e.BattleState.NORMAL_SEARCH,"遗迹通关，切回普通挂机"),void e.UnionController.getInstance().showyijipanel();e.UnionController.getInstance().sendEXPLORE_VESTIGES_BEGIN_TIME_C();var i=function(){if(t.isMainRoleOK&&t.isMonsterCrowdOK&&t.isMapTiledOK&&t.isAssembleFinishOK){if(t.crowdPosIdx<0||t.crowdPosIdx>=t.monsterCrowdList.length)return void Log.trace("crowd monster not found,monsterCrowdList "+t.monsterCrowdList.length+",idx "+t.crowdPosIdx);var i=t.monsterCrowdList[t.crowdPosIdx],n=new egret.Point;n.x=i.posX,n.y=i.posY,t.refreshCenterActor();var o=new egret.Point;o.x=t.actorList[0].x,o.y=t.actorList[0].y;var a=egret.Point.distance(n,o);if(a>20){var s=Math.floor(a/1.5),r=(n.x-o.x)*s/a+o.x;r=Math.floor(r);var l=(n.y-o.y)*s/a+o.y;l=Math.floor(l),n.x=r,n.y=l}t.mainActor.moveToWorldPos_byLine(n,function(){if(t.state==e.BattleState.YIJI_MOVE){t.isOnPathFindingCrowd=!1;for(var i=1;i<t.actorList.length;++i)t.actorList[i].stopMove(!1);if(t.state==e.BattleState.YIJI_MOVE){t.stopTimerRequestNormal();var n=t.monsterCrowdList[t.crowdPosIdx];n.fight(),e.BattleService.instance.clearBattleInfo("YIJI"),t.opendialogue(e.LanguageUtils.instance.getValue("YIJIMESSAGE"+(t.crowdPosIdx+1)),function(){for(var i=[],n=0;n<t.actorList.length;n++)i.push(Math.floor(t.actorList[n].x)),i.push(Math.floor(t.actorList[n].y));
e.UnionController.getInstance().sendEXPLORE_VESTIGES_OF_ANCIENT_GODS_C(i)})}}},!0,t),t.delayTimeIdxArray[0]=0;for(var h=100*(.5+Math.random()),c=0;c<t.actorList.length;++c){var u=t.actorList[c];if(u!=t.mainActor){u.visible=!0,u.stopMove(!0);var p=new egret.Point;p.x=n.x+h*e.GameUtils.randomNegetive()*(.5+Math.random()),p.y=n.y+h*e.GameUtils.randomNegetive()*(.5+Math.random()),p.x=Math.floor(p.x),p.y=Math.floor(p.y);var g=600*(.5+Math.random());t.delayTimeIdxArray[c]=egret.setTimeout(t.delayMoveAction,t,g,[t.actorList[c],p,c])}}t.isOnPathFindingCrowd=!0}};return 0==this.crowdPosIdx?void this.opendialogue(e.LanguageUtils.instance.getValue("YIJIMESSAGE0"),i):void i()},a.prototype.changeToStateNormalSearch=function(){this.state=e.BattleState.NORMAL_SEARCH,this.checkAutoPveBossFight(),this.isMainRoleOK&&this.isMonsterCrowdOK&&this.isMapTiledOK&&this.isAssembleFinishOK&&this.moveToNextMonsterCrowd()},a.prototype.interruptStateNormalSearch=function(){for(var e=0;e<this.actorList.length;e++){var t=this.actorList[e];t.stopMove()}},a.prototype.changeToStateNormalBattling=function(){this.state=e.BattleState.NORMAL_BATTLING},a.prototype.interruptStateNormalBattling=function(){},a.prototype.changeToStateNormalDrop=function(){if(this.state=e.BattleState.NORMAL_DROP,null!=this.currentBattleData.getDropItem()&&0!=this.currentBattleData.getDropItem().length&&this.currentBattle){var t=this.finishedFilmActors[this.finishedFilmActors.length-1].getPosition();this.dropAward(this.currentBattle.battleType,this.currentBattleData.getDropItem(),t,function(){this.state==e.BattleState.NORMAL_DROP&&(this.droItemList.length<=0||this.pickUpItem())}.bind(this))}else this.changeState(e.BattleState.NORMAL_END,"没有掉落");this.fightCount++,e.Message.instance.send(e.MsgCMD.QUICK_GET_REWARD)},a.prototype.interruptStateNormalDrop=function(){},a.prototype.changeToStateNormalEnd=function(){this.state=e.BattleState.NORMAL_END,this.releaseBattleRes(),this.changeState(e.BattleState.NORMAL_SEARCH,"继续打小怪")},a.prototype.changeToStateyijiEnd=function(){this.state=e.BattleState.YIJI_MOVE,this.releaseBattleRes(),this.changeState(e.BattleState.YIJI_MOVE,"继续刷遗迹")},a.prototype.interruptStateNormalEnd=function(){},a.prototype.changeToStateChallengeTrans=function(){if(this.state=e.BattleState.CHALLENGE_TRANS,this.isOnPathFindingCrowd=!1,this.currentBattle)if(this.currentBattle.battleType==e.BattleType.BATTLE_CHALLENGE||this.currentBattle.battleType==e.BattleType.BOSS_PLUNDER_SINGLE||this.currentBattle.battleType==e.BattleType.BATTLE_UNION_BOSS||this.currentBattle.battleType==e.BattleType.GHOST_TOWER){var t=e.RequestFightManager.instance.getRequestOwnerName();"无"!=t&&""!=t?e.MainControler.instance.bossFightPvpVisible(!1):e.MainControler.instance.bossFightBloodVisible(!1,!1,0)}else this.currentBattle.battleType==e.BattleType.DAY_COPY?e.MainControler.instance.bossFightCopyVisible():this.currentBattle.battleType==e.BattleType.BATTLE_PVP_ARENA?(e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.jingjiPvpChangeUI()):this.currentBattle.battleType==e.BattleType.CS_ARENA_DAN||this.currentBattle.battleType==e.BattleType.CS_ARENA_PRELIMINARY?(e.KFController.getInstance().showSmackDownPanel(),e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.kuafuFightVisible()):this.currentBattle.battleType==e.BattleType.LEGENDARY_EMPIRE?e.MainControler.instance.bossFightBloodVisible(!1,!1,this.currentBattle.battleType):this.currentBattle.battleType==e.BattleType.PRISONER_LVEDUO||this.currentBattle.battleType==e.BattleType.PRISONER_REWENZHI?e.MainControler.instance.jingjiPvpChangeUI():this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER?e.MainControler.instance.bossFightBloodVisible(!1,!1,0):this.currentBattle.battleType==e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER&&(e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.jingjiPvpChangeUI());for(var i=[],n={},o=0;o<this.currentBattle.offence.length;o++){var a=this.currentBattle.offence[o],s=this.findActorByFightRole(a);if(s&&0!=a.getActions().length)for(var r=0;r<this.actorList.length;r++)if(s==this.actorList[r]){n[i.length]={x:a.getInitPos().getX(),y:a.getInitPos().getY()},i.push(s);break}}this.createFlyEffect({actorList:i,landPointList:n,flyCallback:function(){this.chanageMapByBattleFilm()}.bind(this),landCallback:function(){if(this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER?(this.createTwelvePalaceActor(this.currentBattleData),this.showTwelvePalaceBattlePanel()):this.UpdateActorsByFilms(this.currentBattle),this.currentBattle)if(this.currentBattle.battleType==e.BattleType.BATTLE_CHALLENGE||this.currentBattle.battleType==e.BattleType.BOSS_PLUNDER_SINGLE||this.currentBattle.battleType==e.BattleType.BATTLE_UNION_BOSS||this.currentBattle.battleType==e.BattleType.GHOST_TOWER){var t=e.RequestFightManager.instance.getRequestOwnerName();"无"!=t&&""!=t?(e.MainControler.instance.bossFightBloodVisible(!0,!0,0),e.MainControler.instance.bossFightPvpVisible(!1)):e.MainControler.instance.bossFightBloodVisible(!1,!1,0)}else this.currentBattle.battleType==e.BattleType.DAY_COPY?e.MainControler.instance.bossFightCopyVisible():this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER?e.MainControler.instance.inBattle&&(e.MainControler.instance.bossFightCopyVisible(!0),e.MainControler.instance.bossFightBloodVisible(!0,!1,this.currentBattle.battleType)):this.currentBattle.battleType==e.BattleType.BATTLE_PVP_ARENA?(e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.jingjiPvpChangeUI()):this.currentBattle.battleType==e.BattleType.LEGENDARY_EMPIRE?e.MainControler.instance.bossFightBloodVisible(!1,!1,this.currentBattle.battleType):this.currentBattle.battleType==e.BattleType.PRISONER_LVEDUO||this.currentBattle.battleType==e.BattleType.PRISONER_REWENZHI?e.MainControler.instance.jingjiPvpChangeUI():(this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER)&&(e.MainControler.instance.bossFightBloodVisible(!1,!1,0),this.checkTwelvePalaceType());this.changeState(e.BattleState.CHALLENGE_BATTLING,"飞升结束")}.bind(this)})},a.prototype.interruptStateChallengeTrans=function(){},a.prototype.changeToStateChallengeBattling=function(){this.state=e.BattleState.CHALLENGE_BATTLING},a.prototype.interruptStateChallengeBattling=function(){},a.prototype.changeToStateyijiDrop=function(){if(this.state=e.BattleState.YIJI_DROP,null!=this.currentBattleData.getDropItem()&&0!=this.currentBattleData.getDropItem().length&&this.currentBattle){var t=this.finishedFilmActors[this.finishedFilmActors.length-1].getPosition();this.dropAward(this.currentBattle.battleType,this.currentBattleData.getDropItem(),t,function(){this.state==e.BattleState.YIJI_DROP&&(this.droItemList.length<=0||this.pickUpItem())}.bind(this))}else this.changeState(e.BattleState.YIJI_POP,"没有掉落")},a.prototype.changeToStateChallengeDrop=function(){var t=this;if(this.state=e.BattleState.CHALLENGE_DROP,this.setViewLayer(!1),this.currentBattle&&0==this.currentBattle.result&&this.currentBattle.battleType==e.BattleType.BATTLE_MAP_PK&&this.setLoserLayer(!0),null!=this.currentBattleData.getDropItem()&&0!=this.currentBattleData.getDropItem().length&&this.currentBattle){var i=this.finishedFilmActors[this.finishedFilmActors.length-1].getPosition();this.dropAward(this.currentBattle.battleType,this.currentBattleData.getDropItem(),i,function(){if(this.state==e.BattleState.CHALLENGE_DROP&&!(this.droItemList.length<=0)){if(this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_BOSS&&this.currentBattle.mapId>30){this.actorList[0].visible=!0;var t=new egret.Point;t.x=this.actorList[0].x-50,t.y=this.actorList[0].y-80,1==this.currentBattle.result?this.setTipLabel("哈哈哈，满地好东西真开心！"):this.setTipLabel("被干掉了，好不甘心");for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];egret.Tween.get(n).wait(10*i+1200).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({x:t.x,y:t.y},350,egret.Ease.backIn).call(function(t){this.state==e.BattleState.CHALLENGE_DROP&&this.droItemList[t]&&(this.droItemList[t].visible=!1)},this,[i]).wait(700).call(function(t){if(this.state==e.BattleState.CHALLENGE_DROP&&t+1==this.droItemList.length){for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];n.dispose(!1)}this.droItemList=[],this.changeState(e.BattleState.CHALLENGE_POP,"一键拾取完毕")}},this,[i])}}else if(this.currentBattle.battleType==e.BattleType.BATTLE_MAP_PK){var t=new egret.Point;1==this.currentBattle.result?(t.x=this.actorList[0].x-50,t.y=this.actorList[0].y-80,this.setTipLabel("哈哈哈，满地好东西真开心！")):(t.x=this.enemyList[0].x-50,t.y=this.enemyList[0].y-80,this.setTipLabel("被干掉了，好不甘心"));for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];egret.Tween.get(n).wait(10*i+1200).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({x:t.x,y:t.y},350,egret.Ease.backIn).call(function(t){this.state==e.BattleState.CHALLENGE_DROP&&this.droItemList[t]&&(this.droItemList[t].visible=!1)},this,[i]).wait(700).call(function(t){if(this.state==e.BattleState.CHALLENGE_DROP&&t+1==this.droItemList.length){for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];n.dispose(!1)}this.droItemList=[],this.changeState(e.BattleState.CHALLENGE_POP,"一键拾取完毕")}},this,[i])}}else if(this.currentBattle.battleType==e.BattleType.DAY_COPY){this.actorList[0].visible=!0;var t=new egret.Point;t.x=this.actorList[0].x-50,t.y=this.actorList[0].y-80;for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];egret.Tween.get(n).wait(10*i+1200).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({x:t.x,y:t.y},350,egret.Ease.backIn).call(function(t){this.state==e.BattleState.CHALLENGE_DROP&&this.droItemList[t]&&(this.droItemList[t].visible=!1)},this,[i]).wait(700).call(function(t){if(this.state==e.BattleState.CHALLENGE_DROP&&t+1==this.droItemList.length){for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];n.dispose(!1)}this.droItemList=[],this.changeState(e.BattleState.CHALLENGE_POP,"一键拾取完毕")}},this,[i])}}else if(this.currentBattle.battleType==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||this.currentBattle.battleType==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||this.currentBattle.battleType==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER){var o=null;this._twelvePalaceBattleResult&&this._twelvePalaceBattleResult.player&&(o=this.getMainActorByPlayerId(this._twelvePalaceBattleResult.player));var t=new egret.Point;o?(t.x=o.x-50,t.y=o.y-80):(t.x=this.actorList[0].x-50,t.y=this.actorList[0].y-80);for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];egret.Tween.get(n).wait(10*i+1200).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({x:t.x,y:t.y},350,egret.Ease.backIn).call(function(t){this.state==e.BattleState.CHALLENGE_DROP&&this.droItemList[t]&&(this.droItemList[t].visible=!1)},this,[i]).wait(700).call(function(t){if(this.state==e.BattleState.CHALLENGE_DROP&&t+1==this.droItemList.length){for(var i=0;i<this.droItemList.length;i++){var n=this.droItemList[i];n.dispose(!1)}this.droItemList=[],this.changeState(e.BattleState.CHALLENGE_POP,"一键拾取完毕")}},this,[i])}}else this.pickUpItem();this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER&&e.MainControler.instance.inBattle&&e.MainControler.instance.mainOrBattleState(!0)}}.bind(this))}else this._noAwardTimer&&(egret.clearTimeout(this._noAwardTimer),this._noAwardTimer=null),this._noAwardTimer=egret.setTimeout(function(){t._noAwardTimer=null,t.changeState(e.BattleState.CHALLENGE_POP,"没有掉落")},this,800);(this.currentBattle.battleType==e.BattleType.BOSS_PLUNDER_SINGLE||this.currentBattle.battleType==e.BattleType.BATTLE_CHALLENGE)&&e.PlayerService.instance.level>=Number(e.GlobalConfig.instance.getValue("WANBA_QLD_AD_LIMIT_LEVEL"))&&e.WanbaQQVideoAdController.getInstance().sendMessageWanbaAdReq(),e.Message.instance.send(e.MsgCMD.QUICK_GET_REWARD)},a.prototype.interruptStateChallengeDrop=function(){e.LogUtil.getInstance().log("BattleScene","打断挑战掉落状态"),this._noAwardTimer&&(egret.clearTimeout(this._noAwardTimer),this._noAwardTimer=null),this.setLoserLayer(!1)},a.prototype.changeToStateyijiPop=function(){if(!this.currentBattle)return void egret.warn("currentBattle null");this.state=e.BattleState.YIJI_POP;var t=new o(this.currentBattleData);1==t.result?(this.crowdPosIdx++,t.awards&&e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:t.awards,mapId:t.mapId,saodang:!0,battleType:e.BattleType.RUINS_BATTLE_TYPE}})):e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||(e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER),this.releaseBattleRes(),this.gotoNormalBattle(),e.BossBloodGroup.getInstance().close(),this.ruinsTimeEvent.removeEventListener(egret.TimerEvent.TIMER,this.onRefreshRuinsTime,this),this.ruinsTimeEvent=null,e.Global.uiLayer.removeChild(this.ruinsTimepanel),e.UnionController.getInstance().showyijipanel(),this.changeState(e.BattleState.NORMAL_SEARCH,"遗迹战斗失败，切回普通挂机"))},a.prototype.changeToStateChallengePop=function(){if(!this.currentBattle)return void egret.warn("currentBattle null");this.state=e.BattleState.CHALLENGE_POP,1==App.GuideUtils().canShow&&(App.GuideUtils().canShow=0);var t=!1;this.currentBattle&&this.currentBattle.battleType!=e.BattleType.BATTLE_PVE_MONSTER&&(t=this.onMsgBattlePopInfo({battleInfo:new o(this.currentBattleData)})),t||this.changeState(e.BattleState.CHALLENGE_END,"不需要弹弹窗")},a.prototype.interruptStateChallengePop=function(){},a.prototype.changeToStateChallengeEnd=function(){this.state=e.BattleState.CHALLENGE_END;var t=!1;t=this.currentBattle.battleType==e.BattleType.BATTLE_PVP_CAMP,this.releaseBattleRes(),this.resetTwelvePalace();var i=!1;if(this.curBattleMapId!=e.PlayerService.instance.playerStateInfo.getCurBattleMap()){var n=e.JsonDataManager.instance.mapTemplate,o=n[this.curBattleMapId];if(o){var a=n[o.mapNextId];a&&""!=a.icon&&""!=o.icon&&o.icon!=a.icon&&(i=!0)}}if(i)this.crowdPosIdx=0,this.changeState(e.BattleState.CHALLENGE_DOOR,"需要切换地图,走传送门");else if(t)this.gotoNormalBattle(),this.changeState(e.BattleState.NORMAL_SEARCH,"不需要切换地图");else{var s=this.curBattleMapId;this.gotoNormalBattle();var r=this.curBattleMapId;this.showEfficiencyUp(s,r),this.changeState(e.BattleState.NORMAL_SEARCH,"不需要切换地图")}},a.prototype.interruptStateChallengeEnd=function(){},a.prototype.changeToStateChallengeDoor=function(){this.state=e.BattleState.CHALLENGE_DOOR;var t=this.doorPos[1][0],i=this.doorPos[1][1];this.createFlyEffect({actorList:this.actorList,landPointList:{0:{x:this.doorPos[3][0],y:this.doorPos[3][1]}},flyCallback:function(){this.state==e.BattleState.CHALLENGE_DOOR&&this.gotoNormalBattle(1)}.bind(this),landCallback:function(){if(this.state==e.BattleState.CHALLENGE_DOOR){var n=new egret.Point(t+30,i+30);this.mainActor.moveToWorldPos_byLine(n,null,!0,null);var o=egret.Point.distance(this.mainActor.getPosition(),n),a=o/.28+1.5,s=egret.setTimeout(function(){this.removeFromStateTimerList(s);var t=this.curBattleMapId;this.gotoNormalBattle(2);var i=this.curBattleMapId;this.showEfficiencyUp(t,i),this.mainActor.x=this.doorPos[0][0]+30,this.mainActor.y=this.doorPos[0][1]+43,this.changeState(e.BattleState.NORMAL_SEARCH,"传送门结束")},this,a);this.addToStateTimerList(s)}}.bind(this)})},a.prototype.interruptStateChallengeDoor=function(){},a.prototype.onMsgBattleInfoNormal=function(){if(this.stopTimerRequestNormal(),this.state==e.BattleState.NORMAL_SEARCH){var t=e.BattleService.instance.getBattleInfo("NORMAL");t&&(this.doFightMonsterCrowd(t),this.currentBattle=new o(t),this.currentBattleData=t,this.finishedFilmActors=[],this.UpdateActorsByFilms(this.currentBattle),this.checkUpdateCurBattleMap(),this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER&&e.MainControler.instance.inBattle&&(e.MainControler.instance.bossFightCopyVisible(!0),e.MainControler.instance.bossFightBloodVisible(!0,!1,this.currentBattle.battleType)),this.changeState(e.BattleState.NORMAL_BATTLING,"接收到普通战报"))}},a.prototype.onMsgBattleInfoyiji=function(){this.stopTimerRequestNormal();var t=e.BattleService.instance.getBattleInfo("YIJI");t&&(this.stopActorListTweenAction(),this.releaseBattleRes(),e.MainControler.instance.mainOrBattleState(!1),this.doFightMonsterCrowd(t),this.currentBattle=new o(t),this.currentBattleData=t,this.finishedFilmActors=[],this.UpdateActorsByFilms(this.currentBattle),this.changeState(e.BattleState.YIJI_BATTLE,"不需要飞升跳转到战斗地图"))},a.prototype.onMsgBattleInfoChallenge=function(t){this.stopTimerRequestNormal();var i=t||e.BattleService.instance.getBattleInfo("CHALLENGE");if(i){var n=this.currentBattle&&this.currentBattle.battleType||0;this.stopActorListTweenAction(),this.releaseBattleRes(),e.MainControler.instance.mainOrBattleState(!1),i.getBattleData().getDefence()[0].getRole().getPlayerId()>0?this.ownName=i.getBattleData().getDefence()[0].getRole().getName():this.ownName="",e.RequestFightManager.instance.setRequestOwnerName(this.ownName),this.gotoChallengeBattle(i),this.currentBattle=new o(i),this.currentBattleData=i,this.finishedFilmActors=[],this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVE_BOSS?(this.setTipLabel("一股强大的气息正在靠近"),this.setViewLayer(!0),this.UpdateActorsByFilms(this.currentBattle),this.chanageMapByBattleFilm(),this.changeState(e.BattleState.CHALLENGE_BATTLING,"不需要飞升跳转到战斗地图")):this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_MAP_PK?(this.setTipLabel("狭路相逢，爆红名抢元宝"),this.UpdateActorsByFilms(this.currentBattle),this.chanageMapByBattleFilm(),this.changeState(e.BattleState.CHALLENGE_BATTLING,"不需要飞升跳转到战斗地图")):this.currentBattle&&this.currentBattle.battleType==e.BattleType.BATTLE_PVP_CAMP?(this.setTipLabel("狭路相逢，胜利得战功"),this.UpdateActorsByFilms(this.currentBattle),this.chanageMapByBattleFilm(),this.changeState(e.BattleState.CHALLENGE_BATTLING,"不需要飞升跳转到战斗地图")):this.currentBattle&&(n==e.BattleType.BATTLE_PVP_ARENA&&this.currentBattle.battleType==e.BattleType.BATTLE_PVP_ARENA||n==e.BattleType.DAY_COPY&&this.currentBattle.battleType==e.BattleType.DAY_COPY||n==e.BattleType.BOSS_PLUNDER_SINGLE&&this.currentBattle.battleType==e.BattleType.BOSS_PLUNDER_SINGLE||n==e.BattleType.BATTLE_UNION_BOSS&&this.currentBattle.battleType==e.BattleType.BATTLE_UNION_BOSS||n==e.BattleType.BATTLE_CHALLENGE&&this.currentBattle.battleType==e.BattleType.BATTLE_CHALLENGE||n==e.BattleType.GHOST_TOWER&&this.currentBattle.battleType==e.BattleType.GHOST_TOWER||n==e.BattleType.LEGENDARY_EMPIRE&&this.currentBattle.battleType==e.BattleType.LEGENDARY_EMPIRE)?(this.UpdateActorsByFilms(this.currentBattle),this.chanageMapByBattleFilm(),this.changeState(e.BattleState.CHALLENGE_BATTLING,"下一关不需要飞升跳转到战斗地图")):this.changeState(e.BattleState.CHALLENGE_TRANS,"需要飞升跳转到战斗地图")}},a.prototype.onMsgBattlePlayerRefresh=function(e){this.updatePlayerActors()},a.prototype.onMsgBattleMapRefresh=function(e){0==this.curBattleMapId&&this.checkUpdateCurBattleMap()},a.prototype.onMsgBattlePopHide=function(t){return this.state==e.BattleState.YIJI_POP?void this.changeState(e.BattleState.YIJI_END,"继续刷遗迹"):void(this.state==e.BattleState.CHALLENGE_POP&&(t.next||this.changeState(e.BattleState.CHALLENGE_END,"接收到战斗弹窗隐藏")))},a.prototype.onMsgBattleCrowdsInfo=function(t){var i=t,n=i.getBattleMapId();this.crowdsInfoTable[n]=i,this.refreshCrowdsByMapId(this.curBattleMapId)&&this.state==e.BattleState.NORMAL_SEARCH&&this.moveToNextMonsterCrowd()},a.prototype.onMsgSceneInfoKFbossPalace=function(t){Log.trace("接受跨服boss场景信息",t);var i=t.getSceneInfo();this._twelvePalaceIdList=i.getSceneObjIdArray(),this._twelvePalaceTypeList=i.getSceneObjTypeArray(),this._twelvePalaceOwnIdList=i.getSceneObjOwnIdArray(),this._twelvePalaceTargetIdList=t.getSceneObjFightTargetIdArray(),this._twelvePalaceUnionName={};var n=t.getUnionNames();for(var o in this._twelvePalaceTypeList){var a=this._twelvePalaceTypeList[o];if(a==e.SceneObjectType.ObjTypePlayer){var s=this._twelvePalaceOwnIdList[o],r=n[o];this._twelvePalaceUnionName[s]=r}}var l=t.getPalacePlayerId();this._twelvePalacePlayerId&&this._twelvePalacePlayerId==l||(this._twelvePalacePlayerId=l,this._twelvePalacePlayerList=[]),this.currentBattle&&this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER&&this.checkTwelvePalaceType()},a.prototype.onMsgSceneInfoTwelvePalace=function(t){Log.trace("接收到十二宫场景信息",t);var i=t.getSceneInfo();this._twelvePalaceIdList=i.getSceneObjIdArray(),this._twelvePalaceTypeList=i.getSceneObjTypeArray(),this._twelvePalaceOwnIdList=i.getSceneObjOwnIdArray(),this._twelvePalaceTargetIdList=t.getSceneObjFightTargetIdArray(),this._twelvePalaceUnionName={};var n=t.getUnionNames();for(var o in this._twelvePalaceTypeList){var a=this._twelvePalaceTypeList[o];if(a==e.SceneObjectType.ObjTypePlayer){var s=this._twelvePalaceOwnIdList[o],r=n[o];this._twelvePalaceUnionName[s]=r}}var l=t.getPalacePlayerId();this._twelvePalacePlayerId&&this._twelvePalacePlayerId==l||(this._twelvePalacePlayerId=l,this._twelvePalacePlayerList=[]),!this.currentBattle||this.currentBattle.battleType!=e.BattleType.BOSS_TWELVE_PALACE_FIGHT&&this.currentBattle.battleType!=e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER&&this.currentBattle.battleType!=e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||this.checkTwelvePalaceType()},a.prototype.onMsgSceneChangeResponse=function(t){Log.trace("接收到客户端请求进入离开场景消息",t);var i=t.getRet();0==i?(e.MainControler.instance.sceneType=t.getSceneType(),e.MainControler.instance.sceneId=t.getTargetSceneId(),e.MainControler.instance.sceneType==e.WorldSceneType.TwelvePalaceBossBattleMap?e.TwelvePalaceController.getInstance().hidePanel():e.MainControler.instance.sceneType==e.WorldSceneType.CrossServerBossBattleMap?e.NewBossMainControler.getIntance().closepanel():!this.currentBattle||this.currentBattle.battleType!=e.BattleType.BOSS_TWELVE_PALACE_FIGHT&&this.currentBattle.battleType!=e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER&&this.currentBattle.battleType!=e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER?this.currentBattle&&this.currentBattle.battleType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER&&(e.BossBloodGroup.getInstance().close(),a.instance.interruptCurrentBattle(),e.MainControler.instance.bossFightBloodVisible(!0,!1,0),e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.KUAFUBOSS)):(e.BossBloodGroup.getInstance().close(),a.instance.interruptCurrentBattle(),e.MainControler.instance.bossFightBloodVisible(!0,!1,0),e.TwelvePalaceController.getInstance().showPanel(3,!1))):4==i?n.getInstance().showTextPanel("您已占领其他星宫，是否放弃？",this,function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGiveUpHoldPalaceReq"),i=e.PlayerService.instance.playerInfo.getPlayerId();t.setPlayerId(i),e.Message.instance.send(e.Code.TWELVE_PALACE_GIVE_UP_C,t,!0)}):1==i?n.getInstance().showFloatTextPanel1("星宫不存在"):2==i?n.getInstance().showFloatTextPanel1("星宫未开启"):3==i?n.getInstance().showFloatTextPanel1("当前房间人数过多，请选择其他房间"):5==i?n.getInstance().showFloatTextPanel1(t.getSceneType()==e.WorldSceneType.CrossServerBossBattleMap?"BOSS已被击杀":"该星宫不在可进入状态"):6==i&&n.getInstance().showFloatTextPanel1("次数不足")},a.prototype.onMsgBattleInfoUpdateResponse=function(t){Log.trace("接收到服务器推送战斗胶片",t.getBattleInfo().getBattleType());var i=t.getSceneType();if(i==e.WorldSceneType.TwelvePalaceBossBattleMap||i==e.WorldSceneType.CrossServerBossBattleMap){if(this._battleInfoIndex=t.getPlayIdx(),this._twelvePalaceBattling){var n=t.getBattleInfo();this.createTwelvePalaceActor(n),this.currentBattle=new o(n),this.currentBattleData=n,this.finishedFilmActors=[]}else 1==e.MainBottomControler.PageState&&e.Message.instance.send(e.MsgCMD.NEWBEEFORFIGHTCONTROLER,2),this.onMsgBattleInfoChallenge(t.getBattleInfo()),this._twelvePalaceAlive=!0,this._twelvePalaceBattling=!0,this._twelvePalaceBattleResult=null;this.refreshTarget()}},a.prototype.onMsgSceneResultKFbossPalace=function(t){Log.trace("接受到服务器推送跨服boss结果",t);var i=t.getResultType(),o=t.getSubRet(),a=e.PlayerService.instance.playerInfo.getPlayerId();switch(i){case 1:break;case 2:var s=null,r=null;1==o?a==t.getPlayerId2()?(s=t.getPlayerName1(),r="你反击<font color='#21ff03'>"+s+"</font>失败了，被夺走了归属权"):a==t.getPlayerId1()&&(r="你挑战<font color='#21ff03'>"+t.getPlayerName2()+"</font>胜利了，获得归属权"):2==o&&(a==t.getPlayerId1()?(Log.trace("~-------------------------~"),Log.trace("~---归属者死亡PlayerName1："+t.getPlayerName1(),"归属者死亡PlayerName2："+t.getPlayerName2()),r="你反击<font color='#21ff03'>"+t.getPlayerName2()+"</font>胜利了，守住了归属权",Log.trace("~-----------:"+t.getPlayerName2()),Log.trace("~-------------------------~")):a==t.getPlayerId2()&&(s=t.getPlayerName1(),r="你挑战<font color='#21ff03'>"+s+"</font>失败了")),r&&n.getInstance().showFloatTextPanel1(r),s&&(this._twelvePalaceAlive=!1,e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this._twelvePalaceAlive,sceneId:e.MainControler.instance.sceneId,battleType:e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER}));break;case 3:var l=t.getPlayerName1(),h=!1;a==t.getPlayerId1()&&(h=!0);var s=null,c=null,u=t.getPlayerId2();if(u){var p=e.JsonDataManager.instance.monster[u];s=p.name,c=p.iconPath}if(1==o){var g=e.PlayerService.instance.getRoleVO(this.actorList[0].fightRoleData.getRole().getRoleItemId()),d=void 0;g&&(d=g.icon),e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,null),this.currentBattleData.setDropItem(t.getDropItem()),this._twelvePalaceBattleResult={data:{mine:h,player:l,enemy:s,enemyIcon:c,icon:d,twelvePalaceId:t.getResultType(),result:o,award:t.getAward()},player:t.getPlayerId1()}}else 2==o?a==t.getPlayerId1()&&(this._twelvePalaceAlive=!1,e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this._twelvePalaceAlive,sceneId:e.MainControler.instance.sceneId,battleType:e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER})):3==o&&(e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,null),this.currentBattleData.setDropItem([]),this._twelvePalaceBattleResult={data:{player:l,enemy:s,enemyIcon:c,twelvePalaceId:t.getResultType(),result:o},player:t.getPlayerId1()})}},a.prototype.onMsgSceneResultTwelvePalace=function(t){Log.trace("接收到服务器推送战斗结果",t);var i=t.getResultType(),o=t.getSubRet(),a=e.PlayerService.instance.playerInfo.getPlayerId();switch(i){case 1:break;case 2:var s=null,r=null;1==o?a==t.getPlayerId2()?(s=t.getPlayerName1(),r="<font color='#21ff03'>"+s+"</font>击败了你"):a==t.getPlayerId1()&&(r="挑战成功"):2==o&&(a==t.getPlayerId1()?r=t.getPlayerName2()+"挑战你失败了":a==t.getPlayerId2()&&(s=t.getPlayerName1(),r="挑战失败")),r&&n.getInstance().showFloatTextPanel1(r),s&&(this._twelvePalaceAlive=!1,e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this._twelvePalaceAlive,sceneId:e.MainControler.instance.sceneId}));break;case 3:var l=t.getPlayerName1(),h=!1;a==t.getPlayerId1()&&(h=!0);var s=null,c=null,u=t.getPlayerId2();if(u){var p=e.JsonDataManager.instance.monster[u];s=p.name,c=p.iconPath}var g="";if(e.MainControler.instance.sceneId){var d=e.JsonDataManager.instance.twelvePalaceTemplate[e.MainControler.instance.sceneId];g=d.name}1==o?(e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,null),this.currentBattleData.setDropItem(t.getDropItem()),this._twelvePalaceBattleResult={data:{mine:h,player:l,enemy:s,enemyIcon:c,palace:g,twelvePalaceId:t.getPalaceType(),result:o,award:t.getAward()},player:t.getPlayerId1()}):2==o?a==t.getPlayerId1()&&(this._twelvePalaceAlive=!1,e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this._twelvePalaceAlive,sceneId:e.MainControler.instance.sceneId})):3==o&&(e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,null),this.currentBattleData.setDropItem([]),this._twelvePalaceBattleResult={data:{player:l,enemy:s,enemyIcon:c,palace:g,twelvePalaceId:t.getPalaceType(),result:o},player:t.getPlayerId1()})}},a.prototype.onMsgScenePlayerReliveResponse=function(t){if(Log.trace("接收到服务器推送复活结果",t),0==t.getRet()){var i=e.PlayerService.instance.playerInfo.getPlayerId(),n=t.getPlayerId();if(n==i)if(t.getSceneType()==e.WorldSceneType.TwelvePalaceBossBattleMap){this._twelvePalaceAlive=!0,this.checkTwelvePalaceType();var o=t.getSubSceId();e.TwelvePalaceController.getInstance().refreshChallengeCountByType(o,t.getReduceCnt());for(var a=0;a<this.actorList.length;a++){var s=this.actorList[a];s.roleBelongPlayerId==i&&(s.isDead=!1,s.visible=!0)}for(var a=0;a<this.enemyList.length;a++){var s=this.enemyList[a];s.roleBelongPlayerId==i&&(s.isDead=!1,s.visible=!0)}}else if(t.getSceneType()==e.WorldSceneType.CrossServerBossBattleMap){this._twelvePalaceAlive=!0,this.checkTwelvePalaceType();var o=t.getSubSceId()}}},a.prototype.sendMsgSceneChangeRequest=function(t,i,n,o){var a=HawkProtocolManager.newBuilder("JsProto.HPChangeWorldSceneC");a.setSceneType(t),a.setTargetSceneId(i),a.setLeaveSceneType(n),a.setLeaveSceneId(o),e.Message.instance.send(e.Code.SCENE_PLAYER_ENTER_REQUEST,a,!0),Log.trace("发送玩家进入场景请求"),Log.trace(a)},a.prototype.sendMsgBattleInfoUpdateRequest=function(t){if(e.MainControler.instance.sceneType==e.WorldSceneType.TwelvePalaceBossBattleMap){var i=HawkProtocolManager.newBuilder("JsProto.HPSceneBattleMergeInfoUpdateRequest"),n=e.MainControler.instance.sceneType||0,o=e.MainControler.instance.sceneId||0;i.setSceneType(n),i.setSceneId(o);var a=window.loginServerTime+egret.getTimer()-window.loginEgretTime;i.setServerTimeStamp(a),i.setCurPlayingIdx(this._battleInfoIndex),i.setHopeTimeLong(10);var s=[],r=[];this.getOffenceAndDeffenceList(t,s,r),i.setOffenceIdArray(s),i.setDeffenceIdArray(r);var l=HawkProtocolManager.newBuilder("JsProto.HPMapBattleRequest"),h=e.BattleType.BOSS_TWELVE_PALACE_FIGHT;h=1==t?e.BattleType.BOSS_TWELVE_PALACE_FIGHT:2==t?e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER:e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER,l.setBattleType(h),l.setBattleArgs(this._twelvePalacePlayerId),l.setMonsterCrowdIdx(this.crowdPosIdx),i.setBattleRequest(l),e.Message.instance.send(e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_REQUEST,i,!0)}else if(e.MainControler.instance.sceneType==e.WorldSceneType.CrossServerBossBattleMap){var i=HawkProtocolManager.newBuilder("JsProto.HPCrossServerBossPlunderFightReq"),n=e.MainControler.instance.sceneType||0,o=e.MainControler.instance.sceneId||0;i.setSceneId(o),i.setTargetId(this._twelvePalacePlayerId),i.setTargetType(t),e.Message.instance.send(e.Code.BP_REQUEST_CROSS_SERVER_PLUNDER_BOSS_FIGHT_C,i,!0),Log.trace("发送攻击请求:",e.Code.BP_REQUEST_CROSS_SERVER_PLUNDER_BOSS_FIGHT_C,t)}Log.trace("发送玩家更新战斗胶片请求")},a.prototype.sendMsgScenePlayerReliveRequest=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPScenePlayerRequestRelive"),i=e.MainControler.instance.sceneType||0,n=e.MainControler.instance.sceneId||0;t.setSceneType(i),t.setSubSceId(n);var o=Number(e.Global.newServerId);t.setPlayerServerId(o);var a=e.PlayerService.instance.playerInfo.getPlayerId();t.setPlayerId(a),t.setReliveLvl(0),e.Message.instance.send(e.Code.SCENE_PLAYER_RELIVE_REQUEST,t,!0),Log.trace("发送玩家复活请求"),Log.trace(t)},a.prototype.getOffenceAndDeffenceList=function(t,i,n){var o=this._twelvePalaceIdList.length;if(1==t)for(var a=0;o>a;a++)this._twelvePalaceTypeList[a]==e.SceneObjectType.ObjTypeMonster&&n.push(this._twelvePalaceIdList[a]);
else if(2==t)for(var a=0;o>a;a++)this._twelvePalaceTypeList[a]==e.SceneObjectType.ObjTypePlayer&&this._twelvePalaceOwnIdList[a]==this._twelvePalacePlayerId&&n.push(this._twelvePalaceIdList[a]);else if(3==t)for(var a=0;o>a;a++)this._twelvePalaceTypeList[a]==e.SceneObjectType.ObjTypeMonster&&this._twelvePalaceOwnIdList[a]==this._twelvePalacePlayerId&&n.push(this._twelvePalaceIdList[a])},a.prototype.checkTwelvePalaceType=function(){this._twelvePalaceTargetId=0,this._twelvePalaceTargetType=0;for(var t=e.PlayerService.instance.playerInfo.getPlayerId(),i=null,n=this._twelvePalaceIdList.length,o=0,a=0;n>a;a++)if(this._twelvePalaceTypeList[a]==e.SceneObjectType.ObjTypePlayer&&this._twelvePalaceOwnIdList[a]==t){i=this._twelvePalaceTargetIdList[a];break}if(null!=i)for(var a=0;n>a;a++)if(this._twelvePalaceIdList[a]==i){if(this._twelvePalaceTargetId=this._twelvePalaceOwnIdList[a],this._twelvePalaceTargetType=this._twelvePalaceTypeList[a],this._twelvePalaceTypeList[a]==e.SceneObjectType.ObjTypeMonster){if(t==this._twelvePalacePlayerId){o=1;break}o=2;break}if(t==this._twelvePalacePlayerId){o=4;break}if(this._twelvePalaceOwnIdList[a]==this._twelvePalacePlayerId){o=3;break}}this._twelvePalaceAlive&&e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this._twelvePalaceAlive,type:o,battleType:this.currentBattle&&this.currentBattle.battleType}),this.refreshTarget()},a.prototype.pickUpItem=function(){if(0==this.droItemList.length)return void(this.state==e.BattleState.NORMAL_DROP?this.changeState(e.BattleState.NORMAL_END,"捡起全部道具"):this.state==e.BattleState.CHALLENGE_DROP?this.changeState(e.BattleState.CHALLENGE_POP,"捡起全部道具"):this.state==e.BattleState.YIJI_DROP&&this.changeState(e.BattleState.YIJI_POP,"捡起全部道具"));var t=new egret.Point;t.x=this.droItemList[0].x+this.droItemList[0].width/2,t.y=this.droItemList[0].y+this.droItemList[0].height/2;var i=this.droItemList.length<=1;this.actorList[0].visible=!0,this.actorList[0].moveToWorldPos_byLine(t,function(){(this.state==e.BattleState.CHALLENGE_DROP||this.state==e.BattleState.NORMAL_DROP||this.state==e.BattleState.YIJI_DROP)&&(a.instance.droItemList[0].dispose(!0),a.instance.droItemList.shift(),this.pickUpItem())},i,this);var n=!0;this.currentBattle&&this.currentBattle.battleType!=e.BattleType.BATTLE_PVE_MONSTER&&(n=!1);var o=new egret.Point;o.x=this.actorList[0].x,o.y=this.actorList[0].y;var s=o.x,r=o.y,l=egret.Point.distance(t,o);if(l>20){var h=Math.floor(l/2);s=(t.x-o.x)*h/l+o.x,s=Math.floor(s),r=(t.y-o.y)*h/l+o.y,r=Math.floor(r)}for(var c=1;c<this.actorList.length;c++)this.actorList[c].freeWalkForWait(s,r,n)},a.prototype.refreshCrowdsByMapId=function(t){if(this.crowdsMapId==t)return!1;var i=this.crowdsInfoTable[t];if(!i)return!1;this.crowdsMapId=t,this.cleanMonsterCrowd();for(var n=i.getMonsterCrowdArray().length,o=0;n>o;++o){var a=i.getMonsterCrowdArray()[o],s=new e.MapCrowdMonster;s.mapId=this.crowdsMapId,s.posIdx=a.getPosIdx(),s.posX=a.getPosX(),s.posY=a.getPosY();for(var r=s.getRandomPoint(a.getMonsterCount()),l=0;l<a.getMonsterCount();++l){var h=new e.ActorInScene_Monster(null,null);h.setModelControllerEnable(!0),h.simpleInitPosition(r[l].x,r[l].y),h.simpleInitFromMonsterId(a.getMonsterIdArray()[l]),s.monsterList.push(h),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChildAt(h,this.BattleDefenceStartIdx+o*l)}this.monsterCrowdList.push(s)}return this.isMonsterCrowdOK=!0,this.isMonsterCrowdChanged=!0,this.sendRequestBattleMapPkNpcPlayerInfo(),this.randomMoveNotFightingAliveMonsterCrowd(),!0},a.prototype.addToStateTimerList=function(e){this.stateTimerList.push(e)},a.prototype.removeFromStateTimerList=function(e){egret.clearTimeout(e),this.stateTimerList.splice(this.stateTimerList.indexOf(e),1)},a.prototype.clearStateTimerList=function(){for(var e=0;e<this.stateTimerList.length;e++){var t=this.stateTimerList[e];egret.clearTimeout(t)}this.stateTimerList.splice(0,this.stateTimerList.length),this.stateTimerList=[]},a.prototype.refreshCenterActor=function(){if(this.mainActor&&!this.mainActor.isDead)this.centerActor&&this.centerActor==this.mainActor||(this.centerActor=this.mainActor);else if(this.centerActor&&!this.centerActor.isDead);else{for(var t=e.PlayerService.instance.playerInfo.getPlayerId(),n=0;n<this.actorList.length;n++){var o=this.actorList[n];if(!o.isDead&&o.roleBelongPlayerId==t&&o.roleType!=i.CALLBEAST)return void(this.centerActor=o)}for(var n=0;n<this.actorList.length;n++){var o=this.actorList[n];if(!o.isDead&&o.roleBelongPlayerId!=t&&o.roleType!=i.CALLBEAST)return void(this.centerActor=o)}}},a.prototype.setMainActor=function(){if(!this.mainActor){var t=e.PlayerService.instance.playerInfo.getPlayerId();for(var n in this.actorList){var o=this.actorList[n];if(o.roleType==i.MAIN_ROLE&&o.roleBelongPlayerId==t)return this.mainActor=o,void e.LogUtil.getInstance().log("BattleScene","设置主角成功 roleId="+this.mainActor.roleId+" roleName="+this.mainActor.roleName+" roleItemId="+this.mainActor.roleItemId)}e.LogUtil.getInstance().log("BattleScene","设置主角失败")}},a.prototype.sortActorList=function(){if(this.actorList&&0!=this.actorList.length)for(var e=0;e<this.actorList.length;e++){var t=this.actorList[e];if(t.roleType==i.MAIN_ROLE&&0!=e){this.actorList.splice(e,1),this.actorList.splice(0,0,t);break}}},a.prototype.checkAutoPveBossFight=function(){if(this.fightCount>=e.Global.killMonsterNum&&e.Global.isAutoFightBoss){var t=e.JsonDataManager.instance.mapTemplate,i=t[e.PlayerService.instance.playerStateInfo.getCurBattleMap()],n=i.limitLevel;if(e.PlayerService.instance.mainRoleInfo.getLevel()<n)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("MAPBOSSFIGHTTIPS",n)),e.Message.instance.send(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,!0),void e.MainControler.instance.setAutoBossBtnState(!1);if(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan,null,2),!this.canT)return void e.Message.instance.send(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,!0);this.canT=!1,e.MainControler.instance.jingjiPvpChangeUI(),this.fightCount=0,e.Global.killMonsterNum=Math.floor(Math.max(e.PlayerService.instance.level/15-1,0)+1),e.MainControler.instance.setBossFightCountProgress(this.fightCount,e.Global.killMonsterNum),e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_PVE_BOSS,this.curBattleMapId)}},a.prototype.setTipLabel=function(t){t?(this.tipLabel||(this.tipLabel=new eui.Label,this.tipLabel.textColor=16508632,this.tipLabel.size=22,this.tipLabel.bold=!0,this.tipLabel.textAlign="center",this.tipLabel.y=220,e.Global.uiLayer.addChild(this.tipLabel)),0!=this.tipLabelTimer&&(egret.clearTimeout(this.tipLabelTimer),this.tipLabelTimer=0),this.tipLabel.text=t,this.tipLabel.x=this.stageWidth/2-this.tipLabel.width/2,this.tipLabel.visible=!0,this.tipLabelTimer=egret.setTimeout(function(){this.tipLabel.visible=!1,this.tipLabelTimer=0},this,2e3)):this.tipLabel&&(0!=this.tipLabelTimer&&(egret.clearTimeout(this.tipLabelTimer),this.tipLabelTimer=0),this.tipLabel.visible=!1)},a.prototype.setLoserLayer=function(e){e?this.loserLayer&&(this.loserLayer.visible=!0):this.loserLayer&&(this.loserLayer.visible=!1)},a.prototype.setViewLayer=function(t){t?(this.viewLayer||(this.viewLayer=new eui.Image("battle_view_png"),this.viewLayer.scaleX=this.stageWidth/512,this.viewLayer.scaleY=this.stageHeight/512,e.Global.uiLayer.addChild(this.viewLayer)),0!=this.viewLayerTimer&&(egret.clearTimeout(this.viewLayerTimer),this.viewLayerTimer=0),this.viewLayer.visible=!0,this.viewLayerTimer=egret.setTimeout(function(){this.viewLayer.visible=!1,this.viewLayerTimer=0},this,2e3)):this.viewLayer&&(0!=this.viewLayerTimer&&(egret.clearTimeout(this.viewLayerTimer),this.viewLayerTimer=0),this.viewLayer.visible=!1)},a.prototype.sortBattleUnit=function(){for(var t={},i=e.MapViewportGroupManager.instance.sceneView.BattleUnitNode,n=0;n<i.$children.length;n++){var o=i.$children[n];if(o.visible){var a=(o.isDead&&0||1e4)+o.y+.01*n;t[a]=o}}var s=Object.keys(t);s.sort();for(var n=0;n<s.length;n++){var a=s[n],o=t[a];i.setChildIndex(o,n)}},a.prototype.createTwelvePalaceActor=function(t){this._twelvePalaceActorShow=0;var n=e.PlayerService.instance.playerInfo.getPlayerId(),o=t.getBattleData(),a=o.getOffence(),s=[];for(var r in a){var l=a[r],h=this.getActorByFightRole(l);Log.trace("-----创建新角色5 "+l.getRole().getName()),h?h.refreshAction(l):(h=this.createActorByFightRole(l),n==h.roleBelongPlayerId?h.hpBar.setActroType(i.MAIN_ROLE):h.hpBar.setActroType(i.MONSTER)),h.roleBelongPlayerId==n||h.roleBelongPlayerId==this._twelvePalacePlayerId||0==h.roleBelongPlayerId?h.setModelControllerEnable(!0):this._twelvePalaceActorShow<5?(h.setModelControllerEnable(!0),this._twelvePalaceActorShow++):h.setModelControllerEnable(!1),s.push(h)}var c=o.getDefence(),u=[];for(var r in c){var l=c[r],h=this.getActorByFightRole(l);h?h.refreshAction(l):(h=this.createActorByFightRole(l),n==h.roleBelongPlayerId?h.hpBar.setActroType(i.MAIN_ROLE):h.hpBar.setActroType(i.MONSTER)),h.roleBelongPlayerId==n||h.roleBelongPlayerId==this._twelvePalacePlayerId||0==h.roleBelongPlayerId?h.setModelControllerEnable(!0):this._twelvePalaceActorShow<5?(h.setModelControllerEnable(!0),this._twelvePalaceActorShow++):h.setModelControllerEnable(!1),u.push(h)}for(var r in this.actorList){var h=this.actorList[r];this.deleteActor(h)||s.push(h)}for(var r in this.enemyList){var h=this.enemyList[r];this.deleteActor(h)||s.push(h)}this.actorList=s,this.enemyList=u,this.sortActorList(),this.refreshCenterActor()},a.prototype.getActorByFightRole=function(e){var t=e.getRole().getPlayerId(),n=e.getRole().getType();if(this.actorList&&this.actorList.length>0)for(var o=0;o<this.actorList.length;++o){var a=this.actorList[o];if(a.roleBelongPlayerId==t&&a.roleType==n)switch(n){case i.MAIN_ROLE:return this.actorList.splice(o,1),a;case i.MERCENARY:if(a.roleItemId==e.getRole().getRoleItemId())return this.actorList.splice(o,1),a;break;case i.MONSTER:if(a.roleId==e.getRole().getMonsterId())return this.actorList.splice(o,1),a;break;case i.CALLBEAST:if(a.roleId==e.getRole().getMonsterId())return this.actorList.splice(o,1),a;break;case i.BEAUTY:if(a.roleId==e.getRole().getMonsterId())return this.actorList.splice(o,1),a}}if(this.enemyList&&this.enemyList.length>0)for(var o=0;o<this.enemyList.length;++o){var a=this.enemyList[o];if(a.roleBelongPlayerId==t&&a.roleType==n)switch(n){case i.MAIN_ROLE:return this.enemyList.splice(o,1),a;case i.MERCENARY:if(a.roleItemId==e.getRole().getRoleItemId())return this.enemyList.splice(o,1),a;break;case i.MONSTER:if(a.roleId==e.getRole().getMonsterId())return this.enemyList.splice(o,1),a;break;case i.CALLBEAST:if(a.roleId==e.getRole().getMonsterId())return this.enemyList.splice(o,1),a;break;case i.BEAUTY:if(a.roleId==e.getRole().getMonsterId())return this.enemyList.splice(o,1),a}}return null},a.prototype.createActorByFightRole=function(t){var n=t.getRole().getPlayerId(),o=t.getRole().getType(),a=null;switch(o){case i.MAIN_ROLE:a=new e.ActorInScene_Role(null),a.pvpFightInit(t,this.currentBattleData),a.setModelControllerEnable(!0),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChild(a),a.roleItemId=t.getRole().getRoleItemId(),a.roleBelongPlayerId=n;break;case i.MERCENARY:a=new e.ActorInScene_Role(null),a.pvpFightInit(t,this.currentBattleData),a.setModelControllerEnable(!0),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChild(a),a.roleItemId=t.getRole().getRoleItemId(),a.roleBelongPlayerId=n;break;case i.MONSTER:a=new e.ActorInScene_Monster(t,this.currentBattleData),a.setModelControllerEnable(!0),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChild(a),a.roleId=t.getRole().getMonsterId(),a.roleBelongPlayerId=n;break;case i.CALLBEAST:a=new e.ActorInScene_Monster(t,this.currentBattleData),a.setModelControllerEnable(!0),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChild(a),a.roleId=t.getRole().getMonsterId(),a.roleBelongPlayerId=n;break;case i.BEAUTY:a=new e.ActorInScene_Monster(t,this.currentBattleData),a.setModelControllerEnable(!0),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.addChild(a),a.roleId=t.getRole().getMonsterId(),a.roleBelongPlayerId=n}return a},a.prototype.deleteActor=function(t){var i=e.PlayerService.instance.playerInfo.getPlayerId();return i==t.roleBelongPlayerId?(t.visible=!1,!1):(Log.trace("-----释放旧角色 "+t.roleName),t.deleteThis(),e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.getChildIndex(t)>=0?e.MapViewportGroupManager.instance.sceneView.BattleUnitNode.removeChild(t):egret.warn("releaseBattleRes BattleUnitNode removeChild invalid"),!0)},a.prototype.getMainActorByPlayerId=function(e){if(this.actorList&&this.actorList.length>0)for(var t=0;t<this.actorList.length;++t){var n=this.actorList[t];if(n.roleBelongPlayerId==e&&n.roleType==i.MAIN_ROLE)return n}if(this.enemyList&&this.enemyList.length>0)for(var t=0;t<this.enemyList.length;++t){var n=this.enemyList[t];if(n.roleBelongPlayerId==e&&n.roleType==i.MAIN_ROLE)return n}return null},a.prototype.refreshTwelvePalacaBtn=function(t){if(!this._twelvePalaceBtn_1){var i=new eui.Button;i.skinName="NormalButton1_148x50",i.x=this.stageWidth/2-150-74,i.y=this.stageHeight/2+150,i.scaleX=1.2,i.scaleY=1.2,e.Global.uiLayer.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.sendMsgBattleInfoUpdateRequest(1)},this),i.labelDisplay.size=20,this._twelvePalaceBtn_1=i}if(!this._twelvePalaceBtn_2){var n=new eui.Button;n.skinName="NormalButton1_148x50",n.x=this.stageWidth/2+150-74,n.y=this.stageHeight/2+150,n.scaleX=1.2,n.scaleY=1.2,e.Global.uiLayer.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.sendMsgBattleInfoUpdateRequest(2)},this),n.labelDisplay.size=20,this._twelvePalaceBtn_2=n}switch(t){case 1:this._twelvePalaceBtn_1.currentState="down",this._twelvePalaceBtn_1.labelDisplay.text="正在攻击boss",this._twelvePalaceBtn_1.touchEnabled=!1,this._twelvePalaceBtn_1.visible=!0,this._twelvePalaceBtn_2.currentState="disabled",this._twelvePalaceBtn_2.labelDisplay.text="我是归属者",this._twelvePalaceBtn_2.touchEnabled=!1,this._twelvePalaceBtn_2.visible=!0;break;case 2:this._twelvePalaceBtn_1.currentState="down",this._twelvePalaceBtn_1.labelDisplay.text="正在攻击boss",this._twelvePalaceBtn_1.touchEnabled=!1,this._twelvePalaceBtn_1.visible=!0,this._twelvePalaceBtn_2.currentState="up",this._twelvePalaceBtn_2.labelDisplay.text="攻击归属者",this._twelvePalaceBtn_2.touchEnabled=!0,this._twelvePalaceBtn_2.visible=!0;break;case 3:this._twelvePalaceBtn_1.currentState="disabled",this._twelvePalaceBtn_1.labelDisplay.text="攻击boss",this._twelvePalaceBtn_1.touchEnabled=!1,this._twelvePalaceBtn_1.visible=!0,this._twelvePalaceBtn_2.currentState="down",this._twelvePalaceBtn_2.labelDisplay.text="正在攻击归属者",this._twelvePalaceBtn_2.touchEnabled=!1,this._twelvePalaceBtn_2.visible=!0;break;case 4:this._twelvePalaceBtn_1.currentState="disabled",this._twelvePalaceBtn_1.labelDisplay.text="攻击boss",this._twelvePalaceBtn_1.touchEnabled=!1,this._twelvePalaceBtn_1.visible=!0,this._twelvePalaceBtn_2.currentState="disabled",this._twelvePalaceBtn_2.labelDisplay.text="我是归属者",this._twelvePalaceBtn_2.touchEnabled=!1,this._twelvePalaceBtn_2.visible=!0}},a.prototype.resetTwelvePalace=function(){this._battleInfoIndex=0,this._twelvePalaceIdList=[],this._twelvePalaceTypeList=[],this._twelvePalaceOwnIdList=[],this._twelvePalaceTargetIdList=[],this._twelvePalaceUnionName={},this._twelvePalacePlayerId=0,this._twelvePalacePlayerList=[],this._twelvePalaceBattling=!1,this._twelvePalaceBtn_1&&(this._twelvePalaceBtn_1.visible=!1),this._twelvePalaceBtn_2&&(this._twelvePalaceBtn_2.visible=!1),this.hideTwelvePalaceBattlePanel()},a.prototype.showTwelvePalaceBattlePanel=function(){e.TwelvePalaceBattlePanel.getInstance().show()},a.prototype.hideTwelvePalaceBattlePanel=function(){e.TwelvePalaceBattlePanel.getInstance().close()},a.prototype.showTwelvePalacePlayerDetail=function(t){if(this._twelvePalaceBattling&&!(this._twelvePalacePlayerList.length>0)){if(this.actorList&&this.actorList.length>0)for(var n=0;n<this.actorList.length;++n){var o=this.actorList[n];o.fightRoleData.getRole().getPlayerId()==t&&this._twelvePalacePlayerList.push(o)}if(this.enemyList&&this.enemyList.length>0)for(var n=0;n<this.enemyList.length;++n){var o=this.enemyList[n];o.fightRoleData.getRole().getPlayerId()==t&&this._twelvePalacePlayerList.push(o)}var a=null,s=null,r=null,l=0;for(var n in this._twelvePalacePlayerList){var h=this._twelvePalacePlayerList[n];if(h.fightRoleData.getRole().getType()==i.MAIN_ROLE){a=h.fightRoleData.getRole().getName(),s=h.fightRoleData.getRole().getLevel();var c=h.fightRoleData.getRole().getRoleItemId(),u=e.PlayerService.instance.getRoleVO(c);u&&(r=u.icon)}l+=Number(h.fightRoleData.getRole().getMaxHp())}}},a.prototype.refreshTwelvePalacePlayerDetail=function(){var t={};for(var n in this.actorList){var o=this.actorList[n],a=o.roleBelongPlayerId;if(!(0>=a)&&(t[a]?(t[a].curHp+=Number(o.curHp),t[a].maxHp+=Number(o.maxHp)):t[a]={curHp:Number(o.curHp),maxHp:Number(o.maxHp)},o.fightRoleData&&o.fightRoleData.getRole().getType()==i.MAIN_ROLE)){t[a].name=o.fightRoleData.getRole().getName();var s=o.fightRoleData.getRole().getRoleItemId(),r=e.PlayerService.instance.getRoleVO(s);r&&(t[a].icon=r.icon),t[a].union=this._twelvePalaceUnionName[a]}}for(var n in this.enemyList){var o=this.enemyList[n],a=o.roleBelongPlayerId;if(!(0>=a)&&(t[a]?(t[a].curHp+=Number(o.curHp),t[a].maxHp+=Number(o.maxHp)):t[a]={curHp:0,maxHp:0},o.fightRoleData&&o.fightRoleData.getRole().getType()==i.MAIN_ROLE)){t[a].name=o.fightRoleData.getRole().getName();var s=o.fightRoleData.getRole().getRoleItemId(),r=e.PlayerService.instance.getRoleVO(s);r&&(t[a].icon=r.icon),t[a].union=this._twelvePalaceUnionName[a]}}e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_PLAYER,{blood:t,player:this._twelvePalacePlayerId})},a.prototype.refreshTarget=function(){var t={name:null,icon:null,x:null,y:null,width:null,height:null};if(this._twelvePalaceTargetId&&this._twelvePalaceTargetType){if(this._twelvePalaceTargetType==i.MAIN_ROLE){for(var n in this.actorList){var o=this.actorList[n];if(o.roleType!=this._twelvePalaceTargetType||o.roleBelongPlayerId!=this._twelvePalaceTargetId);else{t.name=o.roleName;var a=o.fightRoleData.getRole().getRoleItemId(),s=e.PlayerService.instance.getRoleVO(a);s&&(t.icon=s.icon),t.width=85,t.height=80,t.x=70,t.y=70}}for(var n in this.enemyList){var o=this.enemyList[n];if(o.roleType!=this._twelvePalaceTargetType||o.roleBelongPlayerId!=this._twelvePalaceTargetId);else{t.name=o.roleName;var a=o.fightRoleData.getRole().getRoleItemId(),s=e.PlayerService.instance.getRoleVO(a);s&&(t.icon=s.icon),t.width=85,t.height=80,t.x=70,t.y=70}}}else if(this._twelvePalaceTargetType==i.MONSTER){var r=e.JsonDataManager.instance.monster[this._twelvePalaceTargetId];t.name=r.name,t.icon=r.iconPath,t.width=90,t.height=99,t.x=75,t.y=75}t.name&&t.icon&&e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_TARGET,t)}},a.prototype.onMsgBattlePopInfo=function(t){e.MainBottomControler.instance.setMaincityvisible(!0);var i=!1,n=t.battleInfo;switch(n.battleType){case e.BattleType.BATTLE_PVE_BOSS:1==n.result?n.awards&&(e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:n.awards,mapId:n.mapId,saodang:!0,battleType:e.BattleType.BATTLE_PVE_BOSS}}),e.Message.instance.send(e.MsgCMD.BATTLE_POP_SHOW),i=!0):(e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER),e.MainControler.instance.setAutoBossBtnState(!1));break;case e.BattleType.BATTLE_PVP_ARENA:e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.NEW_AREA_UI,data:4}),1==n.result?e.GameUtils.MSG_TIP("挑战胜利"):(e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER),Log.trace("竞技场挑战失败")),i=!0;break;case e.BattleType.BATTLE_PVE_ELITE_BOSS:1==n.result?Log.trace("报错了，需要程序处理"):e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.BATTLE_MAP_PK:if(1==n.result){var o=n.awards;e.FieldPKController.getInstance().showResultPanel(1,o.getCoin(),o.getExp(),o.getHonorValue()),App.SoundManager().playEffect("sound_openWin_mp3")}else{var o=n.awards;e.FieldPKController.getInstance().showResultPanel(0,o.getCoin(),o.getExp(),o.getHonorValue()),App.SoundManager().playEffect("sound_openDefeat_mp3")}break;case e.BattleType.BATTLE_PVP_CAMP:if(1==n.result){var o=n.awards;e.FactionBattleController.getInstance().showBattleResultPanel(1),App.SoundManager().playEffect("sound_openWin_mp3")}else{var o=n.awards;e.FactionBattleController.getInstance().showBattleResultPanel(0),App.SoundManager().playEffect("sound_openDefeat_mp3")}break;case e.BattleType.FRIEND_PK_BATTLE:1==n.result||e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.ENEMY_PK_BATTLE:1==n.result||e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.DAY_COPY:if(1==n.result){if(n.awards){var a=!1;switch(e.EquipDungenManager.instance.getFightType()){case e.FuBenType.personBossType:a=!0;break;default:a=!1}e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:n.awards,mapId:n.mapId,saodang:a,battleType:e.BattleType.DAY_COPY}}),e.Message.instance.send(e.MsgCMD.BATTLE_POP_SHOW),i=!0}}else e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.BOSS_PLUNDER_SINGLE:1==n.result?n.awards&&e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:n.awards,mapId:n.mapId,saodang:!0,battleType:e.BattleType.BOSS_PLUNDER_SINGLE}}):e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.BATTLE_PVE_FIVE_BOSS3:1==n.result||e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.BATTLE_PVE_FIVE_BOSS4:1==n.result||e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.BATTLE_UNION_BOSS:e.UnionController.getInstance().showBossPanel(),e.UnionController.getInstance().showBossResultPanel(),e.UnionController.getInstance().closeBossTimePanel(),i=!0;break;case e.BattleType.BATTLE_CHALLENGE:if(1==n.result){var s=e.RequestFightManager.instance.getRequestOwnerName();if("无"!=s&&""!=s||0!=e.BattleService.instance.getdefencePlayerId()){var r=e.RequestFightManager.instance.getRequestFightType();if(r==e.BattleType.BATTLE_CHALLENGE){var l=e.RequestFightManager.instance.getRequestFightMapId();e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,l)}}n.awards&&e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:n.awards,mapId:n.mapId,saodang:!0,battleType:e.BattleType.BATTLE_CHALLENGE}})}else e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.GHOST_TOWER:e.ClimbingController.getInstance().show(),2==e.ClimbingController.getInstance().resultData.result?e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER):(e.Message.instance.send(e.MsgCMD.BATTLE_POP_SHOW),i=!0,e.ClimbingController.getInstance().showResultView()),e.UnionController.getInstance().closeBossTimePanel();break;case e.BattleType.LEGENDARY_EMPIRE:break;case e.BattleType.PRISONER_LVEDUO:1==n.result?e.PrisonerController.getInstance().showPanel("lveduo"):e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.PRISONER_REWENZHI:1==n.result?e.PrisonerController.getInstance().showPanel("fuchou"):e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTLOSECONTROLER)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER);break;case e.BattleType.CS_ARENA_DAN:case e.BattleType.CS_ARENA_PRELIMINARY:i=!0,e.KFController.getInstance().showPanel(),e.KFController.getInstance().showBattleResultPanel(n);break;case e.BattleType.BOSS_TWELVE_PALACE_FIGHT:case e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER:case e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER:this._twelvePalaceBattleResult&&(i=!0,e.TwelvePalaceResultPanel.getInstance().showPanel(1,this._twelvePalaceBattleResult.data));break;case e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER:this._twelvePalaceBattleResult&&(i=!0,e.KFPalaceResultPanel.getInstance().showPanel(1,this._twelvePalaceBattleResult.data));break;case e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER:var h=e.TwelvePalaceController.getInstance().challengeOccupiedBattle;if(h){i=!0;var c=h.getOpponentName(),u=h.getOpponentItemId(),p=e.PlayerService.instance.getRoleVO(u),g=p&&p.icon||null,d=h.getPalaceName(),f=n.result;e.TwelvePalaceResultPanel.getInstance().showPanel(2,{enemy:c,enemyIcon:g,palace:d,result:f})}}return e.BossBloodGroup.getInstance().getIsShow()&&0==e.WorldBossController.getInstance().isBoss&&e.BossBloodGroup.getInstance().close(),e.NewBossControler.getIntance().getDetailPanelIsShow()&&e.NewBossControler.getIntance().closeDetailPanel(),i},a.prototype.showLegendResult=function(){e.LegendController.getInstance().getFightResult()?e.LegendController.getInstance().showVictoryPanel():(e.LegendController.getInstance().showMainPanel(),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER))},a.prototype.interruptStateNone=function(){e.Message.instance.add(e.MsgCMD.BATTLE_MAP_REFRESH,this);for(var t=0;t<this.actorList.length;t++){var i=this.actorList[t];i.visible=!0}this.setNpcPlayerMonsterVisible(!0)},a.prototype.changeToStateNone=function(){this.state=e.BattleState.NONE,e.Message.instance.remove(e.MsgCMD.BATTLE_MAP_REFRESH,this),this.stopActorListTweenAction(),this.releaseBattleRes(),this.gotoChallengeBattle(null);for(var t=0;t<this.actorList.length;t++){var i=this.actorList[t];i.visible=!1}for(var t=0;t<this.doorNode.length;t++){var n=this.doorNode[t];n.visible=!1}this.setNpcPlayerMonsterVisible(!1)},a.prototype.isInChallengeBattle=function(){return this.state>e.BattleState.NORMAL_START&&this.state<e.BattleState.NORMAL_OVER?!1:!0},a.prototype.resetBackPos=function(){this.backupPveMainActorPos.x=0,this.backupPveMainActorPos.y=0},a}();e.BattleScene=a,__reflect(a.prototype,"foxgame.BattleScene",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.wealInfo={},this.mainSceneNpcTemplate=[],this.monstertalkTemplate={},this.preloadTempList=[["Language",this.initLanguageTemplate],["Global",this.initGlobalTemplate],["Role",this.initRoleTemplate],["CharName",this.initNameTemplate],["ServerList",this.initServerListTemplate],["QQServerList",this.initQQServerListTemplate]],this.tempList=[["Equip",this.initEquipTemplate],["EquipmentUpgrade",this.initEquipmentUpgradeTemplate],["EquipLinkAttOfSuit",this.initEquipLinkAttTemplate],["ShopItems",this.initToolShopTemplate],["EquipLinkAttOfLevel",this.initEquipLinkAttOfLevel],["EquipLinkAttOfCount",this.initEquipLinkAttOfCount],["PKRankPrize",this.initPKRankPrizeTemplate],["PKFixedPrize",this.initPKPrizeTemplate],["RankAward",this.initRankAward],["ArenaShop",this.initArenalShop],["VipPrivilegeDes",this.initVipPrivilege],["VipGifts",this.initVipGift],["VipWelfare",this.initDailyVipGift],["Rank",this.initRankTemplate],["ServerRankAward",this.initRankRewardTemplate],["Marquee",this.initMarquee],["Treasure",this.initSearchTreasureTemplate],["Achievement",this.initAchievement],["Help",this.initHelpTemplate],["AccLogin",this.initAccLogin],["EverydaySign",this.initEveryDaySign],["EverydayReSignCostGold",this.initEveryDayReSignCostGold],["ActiveReward",this.initActiviReward],["ActiveTask",this.initActiviTask],["VipPrivilege",this.initNewVipPrivilege],["FirstPay",this.initFirstRechargeRewardTemplate],["RechargeConfig",this.initRechargeTemplate],["ErrorCode",this.initErrorCode],["NobilityMission",this.initNobilityMission],["Nobility",this.initNobility],["Map",this.initMapTemplate],["FightDefeat",this.initFightDefeat],["Item",this.initItemTemplate],["Monster",this.initMonster],["ModelOpen",this.initModuleOpen],["ActivityTime",this.initActivityTime],["AccRecharge2",this.initAccRecharge2],["ContinueRecharge",this.ContinueRecharge],["GuideInfo",this.initGuide],["NationalWelfare",this.initNationalWelfare],["RechargeRankings",this.initRechargeRankings],["OpenServerGift",this.initOpenServerGift],["GrowFund",this.initGrowFund],["Title",this.initMedalTitle],["TitleLevel",this.initMedalTitleLevel],["StandardActivity",this.initStandardActivity],["StandardAcRankAward",this.initStandardAcRankAward],["TitleQuality",this.initMedalTitleQuality],["Mail",this.initMailTemplate],["Strengthen",this.initStrengthen],["StrengthenLevelRate",this.initStrengthenLevelRate],["StrengthenQualityRate",this.initStrengthenQualityRate],["PartStarUpgrade",this.initPartStarUpgrade],["UnionSkill",this.initUnionSkill],["Union",this.initUnion],["UnionBoss",this.initUnionBossTemplate],["UnionPosition",this.initUnionPosition],["UnionLimits",this.initUnionLimits],["UnionActivity",this.initUnionActivity],["UnionBossHarmRankAward",this.initUnionBossHarmRankAwardTemplate],["GhostTower",this.initClimbingInfo],["WanFa",this.initWanFaTemplate],["Model",this.initModelTemplate],["SkillEffect",this.initSkillEffectTemplate],["RareAttr",this.initRareAttrTemplate],["RareAttrStar",this.initRareAttrStarTemplate],["SpecialRing",this.initSpecialTemplate],["Soul",this.initSoulTemplate],["SoulGroove",this.initSoulGrooveTemplate],["HuntingSoul",this.initHuntSoulTemplate],["EquipGodInlay",this.initGodlyEquipInlayTemplate],["GodlyEquip",this.initGodlyEquipTemplate],["AttDef",this.initAttDefTemplate],["RoleLevelExp",this.initRoleLevelTemplate],["PartStone",this.initPartStoneTemplate],["PartStoneAtt",this.initPartStoneAttTemplate],["PartStoneAttBuf",this.initPartStoneAttBufTemplate],["MainMission",this.initMissionTemplate],["WingsUpStar",this.initWingsUpStarTemplate],["Wings",this.initWingsTemplate],["SkillLevel",this.initSkillTemplate],["Effect",this.initEffectTemplate],["BuffNew",this.initBuffTemplate],["SupremacyAward",this.initLegendAward],["SupremacyShopping",this.initLegendShop],["SupremacyMap",this.initLegendMap],["SupremacyBuff",this.initLegendBuff],["RechargeConfig_1758",this.initrecharge1758],["WorldBossTime",this.initWorldBossTemplate],["WorldBossAwards",this.initWorldBossAwardTemplate],["PrisonerInfo",this.initPrisonerInfoTemplate],["fashion",this.initfashionTemplate],["CSShop",this.initCSShop],["CSSegmentAward",this.initCSSegmentAward],["CSPreliminaryAward",this.initCSPreliminaryAward],["CSFinalsAward",this.initCSFinalsAward],["CSWorshipAward",this.initCSWorshipAward],["CSTime",this.initCSTime],["keelUpgrade",this.initdragonboneuplevelTemplate],["keelRisingStar",this.initdragonboneupstarTemplate],["keelWard",this.initDragonGuardTemplate],["keelExp",this.initDragonEssenceTemplate],["keelStatr",this.initDragonBallupstarTemplate],["DragonBone",this.initDragonBoneTemplate],["DragonArmour",this.initDragonArmorTemplate],["PassiveSkill",this.initDragonArmorSkillTemplate],["DragonArmourSkillStone",this.initDragonArmorSkillStoneTemplate],["DragonArmourGuard",this.initDragonArmorGuardTemplate],["DragonHoard",this.initdragongodtreasureItemTemplate],["NaturalValue",this.initdragongodTreasureNaturalValueTemplate],["TwelvePalace",this.initTwelvePalaceTemplate],["DemonKeeBaby",this.initdemonKeeBabyTemplate],["DemonKeeFly",this.initdemonKeeFlyTemplate],["DemonKeeDote",this.initdemonKeeDoteTemplate],["DemonKeeStar",this.initdemonKeeStarTemplate],["DemonKeeLevel",this.initdemonKeeBabyupTemplate],["DemonKeeAward",this.initdemonKeeAwardTemplate],["DemonKeeSkill",this.initdemonKeeSkillTemplate],["DemonKeeEquip",this.initdemonKeeEquipTemplate],["DemonKeeAttr",this.initdemonKeeAttrTemplate],["UnionSiegeScene",this.initUSScene],["UnionSiegeIntegralAward",this.initUSIntegralAward],["UnionSiegeIntegralRankAward",this.initUSIntegralRankAward],["UnionSiegePersonalRankAward",this.initUSPersonalRankAward],["UnionSiegePosAward",this.initUSPosAward],["UnionSiegePos",this.initUSPos],["UnionSiegeEquip",this.initUSEquip],["CSUnionSiegeIntegralAward",this.initUSCSIntegralAward],["CSUnionSiegeIntegralRankAward",this.initUSCSIntegralRankAward],["CSUnionSiegePersonalRankAward",this.initUSCSPersonalRankAward],["CSUnionSiegePosAward",this.initUSCSPosAward],["GuideMission",this.initGuideMission],["GuideMissionRobot",this.initGuideMissionRobot],["GuideMissionMainCityRobot",this.initGuideMissionMainCityRobot],["MainSceneNpc",this.initMainSceneNpc],["Monstertalk",this.initMonstertalk],["RechargeConfig_jinjun",this.initRechargeConfig_jinjunTemplate],["RechargeConfig_haiwan",this.initRechargeConfig_haiwanTemplate],["RechargeConfig_wanba",this.initRechargeConfig_wanbaTemplate],["WanbaShareIn",this.initWanbaShareInTemplate],["RechargeConfig_wanbaquleduo",this.initRechargeConfig_wanbaQLDTemplate],["RechargeConfig_ziyunmoribanji",this.initRechargeConfig_ziyunmoribanjiTemplate],["PrivilegeCard",this.initPrivilegeCardTemplate],["ZillionaireInfo",this.initdafuwengMap],["godheadLevel",this.initgodheadLevel],["godheadHieron",this.initgodheadHieron],["godheaddata",this.initgodheaddata],["RechargeConfig_xyw",this.initRechageXYW],["RechargeConfig_jiuxiu",this.initRechageJiuXiu],["godheadActivation",this.initgodheadActivation],["WanBaQQPay",this.initWanbaQQPayTemplate],["RedQuenching",this.initRedQuenching],["AlchemyReward",this.initAlchemyRewardTemplate],["CampStrongpoint",this.initCampStrongpoint],["CampSourceInfo",this.initCampSourceInfo],["CSCampPlayerRankAward",this.initCampRankAward],["CSShareTask",this.initShareTasktemplate],["QQHallGrowUpGift",this.initQQHallGrowUpGift],["TTGameShare",this.initTTgameShareIn],["BOSSLimitCfg",this.initBossLimitCfg],["RebateRedPack",this.initMfsqRP]]
}return t.prototype.initQQHallGrowUpGift=function(t){var i,n=t.length;this.qqHallGrowUpGiftTemplate={};for(var o=0;n>o;o++){i=t[o];var a=new e.QQHallGrowUpGiftVo;a.id=i.id,a.levelCond=i.levelCond,a.desc=i.desc,a.award=[];for(var s=i.award.split(","),r=s.length,l=0;r>l;l++)a.award.push(s[l]);this.qqHallGrowUpGiftTemplate[a.id]=a}},t.prototype.initTTgameShareIn=function(t){var i,n=t.length;this.ttgameShareInTemplate={};for(var o=0;n>o;o++){i=t[o];var a=new e.TTgameShareInVo;a.type=i.type,a.id=i.id,a.shareInCount=i.shareInCount,a.desc=i.desc,a.award=[];for(var s=i.award.split(","),r=s.length,l=0;r>l;l++)a.award.push(s[l]);this.ttgameShareInTemplate[a.id]=a}},t.prototype.initBossLimitCfg=function(t){var i,n=t.length;this.bossLimitCfg={};for(var o=0;n>o;o++){i=t[o];var a=new e.BOSSLimitVO;a.mapId=i.mapGroupId,a.frequency=i.frequency,a.times=i.times,this.bossLimitCfg[a.mapId]=a}},t.prototype.initMfsqRP=function(t){var i,n=t.length;this.mfsqHBVOArray=[];for(var o=0;n>o;o++){i=t[o];var a=new e.MfsqHBVO;a.stageId=Number(i.tagId),a.price=Number(i.price),a.productId=i.productId,a.awards=i.awards,a.bgImg=i.bgImg,a.id=o+1,this.mfsqHBVOArray.push(a)}},t.prototype.initShareTasktemplate=function(t){var i,n=t.length;this.shareTaskInfoTemplate={},this.shareTaskTypeTemplate={};for(var o=0;n>o;o++){i=t[o];var a=new e.ShareTaskVO;a.id=i.id,a.taskType=i.taskType,a.typeCond=i.typeCond,a.numCond=i.numCond,a.relationPanelId=i.relationPanelId,a.desc=i.desc,a.award=[];for(var s=i.award.split(","),r=s.length,l=0;r>l;l++)a.award.push(s[l]);this.shareTaskTypeTemplate[a.taskType]||(this.shareTaskTypeTemplate[a.taskType]=[]),this.shareTaskTypeTemplate[a.taskType].push(a),this.shareTaskInfoTemplate[a.id]=a}console.log(this.shareTaskTypeTemplate)},t.prototype.initCampRankAward=function(t){var i,n=t.length;this.campRankAwardTemplate=[];for(var o=0;n>o;o++){i=t[o];var a=new e.CampRankAwardVO;a.rankStart=i.rankStart,a.rankEnd=i.rankEnd,a.awards=[];for(var s=i.awards.toString().split(","),r=0;r<s.length;r++)a.awards.push(s[r]);this.campRankAwardTemplate.push(a)}},t.prototype.initCampSourceInfo=function(t){var i,n=t.length;this.campSourceInfoTemplate={};for(var o=0;n>o;o++){i=t[o];var a=new e.CampSourceVO;a.id=i.id,a.name=i.name,a.flagIcon=i.flagIcon,a.wordIcon=i.wordIcon,a.judianIcon=i.judianIcon,a.smallIcon=i.smallIcon,this.campSourceInfoTemplate[a.id]=a}},t.prototype.initCampStrongpoint=function(t){var i;t.length;this.campStrongpointTemplate={};for(var n=0;n<t.length;n++){i=t[n];var o=new e.CampStrongpointVO;o.id=i.id,o.name=i.name,o.initType=i.initType,o.connectId=[];for(var a=i.connectId.split(","),s=0;s<a.length;s++)o.connectId.push(Number(a[s]));o.holdBaseValue=Number(i.holdBaseValue),o.holdPlayerMultiple=Number(i.holdPlayerMultiple),o.garrisonPlayerValue=Number(i.garrisonPlayerValue),o.progress=Number(i.progress),o.icon=i.icon,this.campStrongpointTemplate[o.id]=o}},t.prototype.initRedQuenching=function(t){var i;t.length;this.redQuenching={};for(var n=0;n<t.length;n++){i=t[n];var o=new e.RedQuenchingVO;o.level=i.level,o.sucRate=i.sucRate,o.costRedNum=i.costRedNum,o.protectionCost=i.protectionCost,o.washLimitUp=i.washLimitUp,o.changeAtt=i.changeAtt,o.nameEvolve=i.nameEvolve,o.special=i.special,this.redQuenching[o.level]=o}},t.prototype.initAlchemyRewardTemplate=function(t){var i;t.length;this.AlchemyRewardTemplate={};for(var n in t){i=t[n];var o=new e.AlchemyRewardVO;o.maxValue=Number(i.maxValue),o.minValue=Number(i.minValue);for(var a=String(i.openAward).split(","),s=0;s<a.length;s++)o.openAward.push(new e.AttributeVO(a[s]));this.AlchemyRewardTemplate[n]=o}},t.prototype.initWanbaQQPayTemplate=function(t){var i;t.length;this.WanbaQQPayTemplate={};for(var n in t){i=t[n];var o=new e.WanbaQQSVIPVO;o.id=i.id;for(var a=String(i.award).split(","),s=0;s<a.length;s++)o.award.push(new e.AttributeVO(a[s]));this.WanbaQQPayTemplate[o.id]=o}},t.prototype.initgodheadActivation=function(t){var i;t.length;this.GodheadActivationTemplate={};for(var n in t){i=t[n];var o=new e.GodheadActivationVO;o.type=i.type,o.state=i.state;for(var a=String(i.cost).split(","),s=0;s<a.length;s++)o.cost.push(new e.AttributeVO(a[s]));this.GodheadActivationTemplate[o.type+"_"+o.state]=o}},t.prototype.initgodheaddata=function(t){var i;t.length;this.GodheaddataTemplate={};for(var n in t){i=t[n];var o=new e.GodheaddataVO;o.icon=i.icon,o.positionId=i.positionId,o.quality=Number(i.quality),o.tips=i.tips,o.type=Number(i.type),o.condition=i.condition,this.GodheaddataTemplate[n]=o}},t.prototype.initgodheadHieron=function(t){var i;t.length;this.GodheadHieronTemplate={};for(var n in t){i=t[n];var o=new e.GodheadHieronVO;o.godname=i.godname,o.icon=i.icon,o.id=Number(i.id),o.name=i.name,o.quality=Number(i.quality),o.tips=String(i.tips),o.type=Number(i.type),o.score=i.score,this.GodheadHieronTemplate[n]=o}},t.prototype.initgodheadLevel=function(t){var i;t.length;this.GodheadLevelTemplate={};for(var n in t){i=t[n];var o=new e.GodheadLevelVO;o.level=Number(i.level),o.type=Number(i.type),o.name=i.name,o.positionId=i.positionId;var a=i.attr.split(","),s=void 0;o.attrTypeList=[],o.attrValueList=[];for(var r=0;r<a.length;r++)s=a[r].split("_"),o.attrTypeList.push(Number(s[0])),o.attrValueList.push(Number(s[1]));for(var l=String(i.cost).split(","),h=0;h<l.length;h++){var c=new e.AttributeVO(l[h]);o.cost.push(c)}this.GodheadLevelTemplate[n]=o}},t.prototype.initRechageXYW=function(t){this.rechargeConfig_xiyouwang={};for(var i=0,n=t;i<n.length;i++){var o=n[i],a=new e.RechargeXYWVO;a.id=o.id,a.productId=o.productId,a.rechargeId=o.rechargeId,this.rechargeConfig_xiyouwang[a.productId]=a}},t.prototype.initRechageJiuXiu=function(t){this.rechargeConfig_jiuxiu={};for(var i=0,n=t;i<n.length;i++){var o=n[i],a=new e.RechargeJiuXiuVo;a.id=o.id,a.productId=o.productId,a.rechargeId=o.rechargeId,this.rechargeConfig_jiuxiu[a.productId]=a}},t.prototype.initdafuwengMap=function(t){var i;t.length;this.dafuwengMap={};for(var n in t){i=t[n];var o=new e.DafuwengTip;o.refreshTime=String(i.refreshTime).split(","),o.versionId=i.versionId;for(var a=String(i.recharge).split(","),s=0;s<a.length;s++){var r=String(a[s]).split("_");o.recharge.push(r)}this.dafuwengMap[o.versionId]=o}},t.prototype.initPrivilegeCardTemplate=function(t){var i;t.length;this.privilegeCardTemplate={};for(var n in t){i=t[n];var o=new e.PrivilegeVO;o.name=i.name,o.money=Number(i.money),o.type=Number(i.type);for(var a=i.dailyAward.split(","),s=0;s<a.length;s++){var r=new e.AttributeVO(a[s]);o.dailyAward.push(r)}o.productId=i.productId,o.tips=String(i.tips).split("&"),o.logo=i.logo,o.title=i.title,o.logotext=i.logotext,o.attr1=i.attr1,o.attr2=i.attr2,o.attr3=i.attr3,this.privilegeCardTemplate[n]=o}this.privilegeCardTemplate.find=function(e){for(var t=Object.keys(this),i=0;i<t.length;i++){var n=t[i],o=this[n];if(o.type==e)return o}return null}},t.prototype.initRechargeConfig_haiwanTemplate=function(t){var i,n,o=t.length;this.RechargeConfig_haiwanTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.RechargehaiwanVO,n.name=i.name,n.RechargeId=i.RechargeId,n.money=i.money,n.id=i.id,n.desc=i.desc,this.RechargeConfig_haiwanTemplate[n.RechargeId]=n},t.prototype.initRechargeConfig_wanbaQLDTemplate=function(t){var i,n,o=t.length;this.rechargeConfig_wanbaQLDTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.RechargeWanbaVO,n.rechargeId=i.rechargeId,n.productId=i.productId,n.id=Number(i.id),n.rewardstarmoney=i.rewardstarmoney,n.zoneid=i.zoneid,n.productName=i.productName,this.rechargeConfig_wanbaQLDTemplate[""+n.productId+n.zoneid]=n},t.prototype.initRechargeConfig_ziyunmoribanjiTemplate=function(t){var i,n,o=t.length;this.rechargeConfig_ziyunmoribanjiTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.RechargeWanbaVO,n.rechargeId=i.rechargeId,n.productId=i.productId,n.id=Number(i.id),n.rewardstarmoney=i.rewardstarmoney,n.zoneid=i.zoneid,n.productName=i.productName,this.rechargeConfig_ziyunmoribanjiTemplate[""+n.productId+n.zoneid]=n},t.prototype.initRechargeConfig_wanbaTemplate=function(t){var i,n,o=t.length;this.rechargeConfig_wanbaTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.RechargeWanbaVO,n.rechargeId=i.rechargeId,n.productId=i.productId,n.id=Number(i.id),n.rewardstarmoney=i.rewardstarmoney,n.zoneid=i.zoneid,n.productName=i.productName,this.rechargeConfig_wanbaTemplate[""+n.productId+n.zoneid]=n},t.prototype.initRechargeConfig_jinjunTemplate=function(t){var i,n,o=t.length;this.RechargeConfig_jinjunTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.RechargeljinjunVO,n.name=i.name,n.RechargeId=i.RechargeId,n.money=i.money,n.id=i.id,n.desc=i.desc,this.RechargeConfig_jinjunTemplate[n.RechargeId]=n},t.prototype.initdemonKeeAttrTemplate=function(t){var i,n,o=t.length;this.demonKeeAttrTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeAttrVO,n.name=i.name,n.count=Number(i.count),n.type=Number(i.type),n.tips=i.tips;var s=i.attr.split(","),r=void 0;n.attrTypeList=[],n.attrValueList=[];for(var l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.demonKeeAttrTemplate[a]=n}},t.prototype.initdemonKeeEquipTemplate=function(t){var i,n,o=t.length;this.demonKeeEquipTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeEquipVO,n.equipId=Number(i.equipId),n.level=Number(i.level),n.name=i.name,n.type=Number(i.type),n.siteType=Number(i.siteType),n.cost=[];var s=i.attr.split(","),r=void 0;n.attrTypeList=[],n.attrValueList=[];for(var l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.demonKeeEquipTemplate[n.equipId]=n}},t.prototype.initdemonKeeSkillTemplate=function(t){var i,n,o=t.length;this.demonKeeSkillTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeSkillVO,n.id=Number(i.id),n.level=Number(i.level),n.name=i.name,n.score=i.score,n.icon=i.icon;var s=n.icon.split("/"),r=s[1].split(".");0==r[0].indexOf("skillicon")?n.icon=r[0]+"_png":n.icon="skillicon"+r[0]+"_png",n.tips=i.tips,n.condition=i.condition,n.attrTypeList=[],n.attrValueList=[];for(var l=i.attr.split(","),h=void 0,c=0;c<l.length;c++)h=l[c].split("_"),n.attrTypeList.push(Number(h[0])),n.attrValueList.push(Number(h[1]));this.demonKeeSkillTemplate[n.id+"_"+n.level]=n}},t.prototype.initdemonKeeAwardTemplate=function(t){var i,n,o=t.length;this.demonKeeAwardTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeAwardVO,n.level=i.level,n.award=[];for(var s=i.award.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);n.award.push(l)}this.demonKeeAwardTemplate[n.level]=n}},t.prototype.initdemonKeeBabyupTemplate=function(t){var i,n,o=t.length;this.demonKeeBabyupTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeLevelVO,n.level=Number(i.level),n.costGolds=new e.AttributeVO(i.costGolds),n.value=Number(i.value),n.starLevel=Number(i.starLevel);var s=i.attr.split(","),r=void 0;n.attrTypeList=[],n.attrValueList=[];for(var l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));n.costAward=new e.AttributeVO(i.costAward),this.demonKeeBabyupTemplate[a]=n}},t.prototype.initdemonKeeStarTemplate=function(t){var i,n,o=t.length;this.demonKeeStarTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeStarVO,n.prompt=i.prompt,n.value=Number(i.value),n.probability=Number(i.probability);var s=i.condition.split("_");n.condition=[],n.condition.push(Number(s[0])),n.condition.push(Number(s[1])),this.demonKeeStarTemplate[a]=n}this.demonKeeStarTemplate.getdemonKeeStarBycondition=function(e){for(var t=Object.keys(this),i=0;i<t.length;i++){var n=t[i],o=this[n];if(o.condition&&o.condition[0]<=e&&o.condition[1]>=e)return o}}},t.prototype.initdemonKeeDoteTemplate=function(t){var i,n,o=t.length;this.demonKeeDoteTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeDoteVO;var s=i.attr.split(","),r=void 0;n.attrTypeList=[],n.attrValueList=[];for(var l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));n.heartLevel=Number(i.heartLevel),n.level=Number(i.level),n.likability=Number(i.likability),this.demonKeeDoteTemplate[a]=n}},t.prototype.initdemonKeeFlyTemplate=function(t){var i,n,o=t.length;this.demonKeeFlyTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeFlyVO,n.level=Number(i.level),n.name=i.name,n.modelId=i.modelId,n.petId=Number(i.petId);var s=i.initiativeSkill.split("_");n.initiativeSkillid=Number(s[0]),n.initiativeSkillvalue=Number(s[1]);var r=i.talentSkill.split("_");if(n.talentSkillid=Number(r[0]),n.talentSkillvalue=Number(r[1]),n.skilltipid=[],n.skilltipvalue=[],i.Skilltip)for(var l=i.Skilltip.split(","),h=[],c=0;c<l.length;c++)h=l[c].split("_"),n.skilltipid.push(Number(h[0])),n.skilltipvalue.push(Number(h[1]));n.cost=[],n.activationSkillid=[],n.activationSkillvalue=[];for(var u=i.activationSkill.split(","),p=[],g=0;g<u.length;g++)p=u[g].split("_"),n.activationSkillid.push(Number(p[0])),n.activationSkillvalue.push(Number(p[1]));for(var d=i.cost.split(","),f=void 0,g=0;g<d.length;g++)f=new e.AttributeVO(d[g]),n.cost.push(f);this.demonKeeFlyTemplate[a]=n}},t.prototype.initdemonKeeBabyTemplate=function(t){var i,n,o=t.length;this.demonKeeBabyTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DemonKeeBabyVO,n.head=i.head;var s=n.head.split("/"),r=s[1].split(".");n.head=r[0]+"_png",n.petId=Number(i.petId),n.name=i.name;var l=i.initiativeSkill.split("_");n.initiativeSkillid=Number(l[0]),n.initiativeSkillvalue=Number(l[1]);var h=i.talent.split("_");n.talentid=Number(h[0]),n.talentvalue=Number(h[1]),n["const"]=new e.AttributeVO(i.consume),n.skillsid=[],n.skillsvalue=[];for(var c=[],u=i.skills.split(","),p=0;p<u.length;p++)c=u[p].split("_"),n.skillsid.push(Number(c[0])),n.skillsvalue.push(Number(c[1]));this.demonKeeBabyTemplate[n.petId]=n}},t.prototype.initdragongodTreasureNaturalValueTemplate=function(t){var i,n,o=t.length;this.dragongodTreasureNaturalValueTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.DragongodTreasureNaturalVO,n.naturalValue=Number(i.naturalValue),n.naturalAward=new e.AttributeVO(i.naturalAward),this.dragongodTreasureNaturalValueTemplate[a]=n},t.prototype.initdragongodtreasureItemTemplate=function(t){var i,n,o=t.length;this.dragongodtreasureItemTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DragongodTreasureItemVO,n.level=Number(i.level),n.displayProps=[];for(var s=i.displayProps.split(","),r=void 0,l=0;l<s.length;l++)r=new e.AttributeVO(s[l]),n.displayProps.push(r);this.dragongodtreasureItemTemplate[n.level]=n}},t.prototype.initDragonBallupstarTemplate=function(t){var i,n,o=t.length;this.dragonBallupstarTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.DragonBallUpStarVO,n.level=Number(i.level),n.cost=new e.AttributeVO(i.cost),n.itemCraft=new e.AttributeVO(i.itemCraft),this.dragonBallupstarTemplate[n.level]=n},t.prototype.initDragonBoneTemplate=function(t){var i,n,o=t.length;this.dragonBoneTemplate={},this.dragonBoneByPartAndLvTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DragonBoneVO,n.id=Number(i.id),n.part=Number(i.part),n.partName=i.partName,n.level=Number(i.level),n.attrTypeList=[],n.attrValueList=[];for(var s=i.equipAttr.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.dragonBoneTemplate[n.id]=n,this.dragonBoneByPartAndLvTemplate[n.part+"_"+n.level]=n}},t.prototype.initDragonEssenceTemplate=function(t){var i,n,o=t.length;this.dragonEssenceTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.DragonEssenceVO,n.ID=i.id,n.exp=Number(i.exp),this.dragonEssenceTemplate[n.ID]=n},t.prototype.initDragonGuardTemplate=function(t){var i,n,o=t.length;this.dragonGuardTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.DragonGuardVO,n.wardLevel=Number(i.wardLevel),n.keelLevel=Number(i.keelLevel),n.effect1=i.effect1,n.effect2=i.effect2,n.attrTypeList=[],n.attrValueList=[];for(var s=i.attr.split(","),r=0;r<s.length;r++){var l=s[r].split("_");n.attrTypeList.push(Number(l[0])),n.attrValueList.push(Number(l[1]))}this.dragonGuardTemplate[n.wardLevel]=n}},t.prototype.initdragonboneupstarTemplate=function(t){var i,n,o=t.length;this.dragonboneupstarTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.DragonBoneUpStarVO,n.level=Number(i.level),n.addRate=Number(i.addRate),n.levelUpCost=new e.AttributeVO(i.levelUpCost),this.dragonboneupstarTemplate[n.level]=n},t.prototype.initdragonboneuplevelTemplate=function(t){var i,n,o=t.length;this.dragonboneuplevelTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.DragonBoneUpLevelVO,n.ID=Number(i.id),n.level=Number(i.level),n.levelupExp=Number(i.levelupExp),n.devourExp=Number(i.devourExp),this.dragonboneuplevelTemplate[n.level]=n},t.prototype.initfashionTemplate=function(t){var i,n,o=t.length;this.fashionTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.FashionVO,n.ID=Number(i.id),n.name=i.name,n.level=Number(i.level),n.siteType=i.siteType,n.equipId=Number(i.equipId),n.cost=new e.AttributeVO(i.cost),n.modelId=[];var s=i.modelId.split(",");n.modelId.push(s[0]),n.modelId.push(s[1]),n.attrTypeList=[],n.attrValueList=[];for(var r=i.attr.split(","),l=0;l<r.length;l++){var h=r[l].split("_");n.attrTypeList.push(Number(h[0])),n.attrValueList.push(Number(h[1]))}i.modelId.split(",");this.fashionTemplate[n.ID]=n}this.fashionTemplate.getFashionInfoByEquipId=function(e){for(var t=Object.keys(this),i=0;i<t.length;i++){var n=t[i],o=this[n];if(o.equipId==e)return o}},this.fashionTemplate.getFashionInfoByEquipIdAndlevel=function(e,t){for(var i=Object.keys(this),n=0;n<i.length;n++){var o=i[n],a=this[o];if(a.equipId==e&&a.level==t)return a}}},t.prototype.initPrisonerInfoTemplate=function(t){var i,n,o=t.length;this.prisonerAwardTemPlate=[];for(var a=0;o>a;a++){i=t[a],n=new e.PrisonerVO,n.id=Number(i.id),n.weight=Number(i.weight),n.resourceModel=i.resourceModel,n.icon=i.icon;var s=n.icon.split("/"),r=s[1].split(".");n.icon=r[0]+"_png",n.awardList=[];for(var l=i.awards.split(","),h=void 0,c=0;c<l.length;c++)h=new e.AttributeVO(l[c]),n.awardList.push(h);var u=i.plunderAwards.split(","),p=void 0;n.plunderAwardsList=[];for(var c=0;c<u.length;c++)p=new e.AttributeVO(u[c]),n.plunderAwardsList.push(p);var g=i.vengeanceAwards.split(","),d=void 0;n.vengeanceAwardsList=[];for(var c=0;c<g.length;c++)d=new e.AttributeVO(g[c]),n.vengeanceAwardsList.push(d);this.prisonerAwardTemPlate[n.id-1]=n}},t.prototype.initWorldBossAwardTemplate=function(t){var i,n,o=t.length;this.worldBossAwardTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.WorldBossAwardVO,n.rank=Number(i.rank),n.awardList=[];for(var s=i.awards.split(","),r=void 0,l=0;l<s.length;l++)r=new e.AttributeVO(s[l]),n.awardList.push(r);this.worldBossAwardTemplate[n.rank]=n}},t.prototype.initWorldBossTemplate=function(t){var i,n,o=t.length;this.worldBossTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.WorldBossVO,n.id=Number(i.id),n.startTime=i.openHour,n.endTime=i.endTime,n.duration=Number(i.duration),n.lastKillAwards=[];for(var s=i.lastKillAwards.split(","),r=void 0,l=0;l<s.length;l++)r=new e.AttributeVO(s[l]),n.lastKillAwards.push(r);this.worldBossTemplate[n.id]=n}},t.prototype.initLegendBuff=function(t){var i=t.length;this.legendBuffData={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.LegendBuffVO,n.icon=a.icon,n.typeId=a.typeId,this.legendBuffData[n.typeId]=n}},t.prototype.initLegendMap=function(t){var i=t.length;this.legendMap=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.LegendMapVO,n.mapId=a.mapId,n.name=a.name,n.icon=a.icon,n.icon1=a.icon1,this.legendMap.push(n)}},t.prototype.initLegendShop=function(t){var i=t.length;this.legendShop=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.LegendShopVO,n.itemID=a.itemID,n.price=a.price,n.priceType=a.priceType,this.legendShop.push(n)}},t.prototype.initLegendAward=function(t){var i=t.length;this.legendAward={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.LegendAwardVO,n.checkpointNumber=a.checkpointNumber,n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));this.legendAward[n.checkpointNumber]=n}},t.prototype.initBuffTemplate=function(t){this.buffTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.BuffVO,n.id=Number(i.id),n.name=i.name,n.gain=Number(i.gain),n.visible=Number(i.visible),n.effectId=Number(i.effectId),n.privority=Number(i.privority),this.buffTemplate[n.id]=n},t.prototype.initEffectTemplate=function(t){this.effectTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.EffectVO,n.id=Number(i.id),n.effectType=Number(i.effectType),n.prefix=i.prefix,n.frames=Number(i.frames),n.scale=Number(i.scale),n.position=Number(i.position),n.direction=Number(i.direction),n.posX=Number(i.posX),n.posY=Number(i.posY),this.effectTemplate[n.id]=n},t.prototype.initSkillTemplate=function(t){this.skillTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){if(i=t[a],n=new e.SkillLevelVO,n.skillType=Number(i.skillType),n.openLevel=Number(i.openLevel),n.level=Number(i.level),n.upgradeCost=Number(i.upgradeCost),n.skillName=i.skillName,n.icon=i.icon,n.icon){var s=n.icon.split("/");if(s[1]){var r=s[1].split(".");0==r[0].indexOf("skillicon")?n.icon=r[0]+"_png":n.icon="skillicon"+r[0]+"_png"}else n.icon=""}n.effectId=Number(i.effectId),n.skillDesc=i.skillDesc,n.effectName=i.effectName,n.skillTarget=Number(i.skillTarget),n.skillBuffid=Number(i.skillBuffid),n.scriptId=Number(i.scriptId),n.params=[];for(var l=i.params.split(","),h=0;h<l.length;h++)n.params.push(Number(l[h]));n.attackType=Number(i.attackType),n.attackShow=Number(i.attackShow),n.commonCd=Number(i.commonCd),n.skillDist=Number(i.skillDist),n.isGlobal=Number(i.isGlobal),n.preCD=Number(i.preCD),this.skillTemplate[n.skillType+"_"+n.level]=n}},t.prototype.initSkillEffectTemplate=function(t){this.skillEffectTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.SkillEffectVO,n.id=Number(i.id),n.skillTitle=i.skillTitle,n.skillTitleTime=Number(i.skillTitleTime),n.skillType=Number(i.skillType),n.castAnim=Number(i.castAnim),n.castDuration=Number(i.castDuration),n.castEffect=Number(i.castEffect),n.castEffectTime=Number(i.castEffectTime),n.castEffectDestoryTime=Number(i.castEffectDestoryTime),n.bullet=Number(i.bullet),n.bulletEffect=Number(i.bulletEffect),n.isBulletReverse=Number(i.isBulletReverse),n.bulletEffectDelayTime=Number(i.bulletEffectDelayTime),n.hitEffect=Number(i.hitEffect),n.hitEffectDelayTime=Number(i.hitEffectDelayTime),n.hitEffectDestoryTime=Number(i.hitEffectDestoryTime),n.explosionPointEffect=Number(i.explosionPointEffect),n.explosionDelay=Number(i.explosionDelay),n.explosionDestoryTime=Number(i.explosionDestoryTime),n.hitAnim=Number(i.hitAnim),n.skillEndDelayTime=Number(i.skillEndDelayTime),n.skillSoundDelayTime=Number(i.skillSoundDelayTime),n.soundPath=i.soundPath+"_mp3",this.skillEffectTemplate[n.id]=n},t.prototype.initWingsTemplate=function(t){this.wingTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.WingVO,n.id=Number(i.id),n.level=Number(i.level),n.name=i.name,n.model=Number(i.model),n.exp=Number(i.exp),n.baseCost=new e.AttributeVO(i.baseCost),n.advncedCost=new e.AttributeVO(i.advncedCost),n.replaceCost=new e.AttributeVO(i.replaceCost),n.attrTypeList=[],n.attrValueList=[];for(var s=i.attr.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.wingTemplate[n.id+"_"+n.level]=n}},t.prototype.initWingsUpStarTemplate=function(t){this.wingUpStarTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.WingUpStarVO,n.star=Number(i.star),n.cost=new e.AttributeVO(i.cost),n.limit=Number(i.limit),n.replaceCost=new e.AttributeVO(i.replaceCost),n.leftTypeList=[],n.leftValueList=[];for(var s=i.left.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.leftTypeList.push(Number(r[0])),n.leftValueList.push(Number(r[1]));n.rightTypeList=[],n.rightValueList=[],s=i.right.split(",");for(var l=0;l<s.length;l++)r=s[l].split("_"),n.rightTypeList.push(Number(r[0])),n.rightValueList.push(Number(r[1]));this.wingUpStarTemplate[n.star]=n}},t.prototype.initMissionTemplate=function(t){this.mainMissionTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.MainMissionVO,n.id=Number(i.id),n.name=i.name,n.type=Number(i.type),n.awardAttr=new e.AttributeVO(i.award),n.cond=Number(i.cond),n.skipType=Number(i.skipType),n.orderId=Number(i.orderId),this.mainMissionTemplate[n.id]=n},t.prototype.initPartStoneAttBufTemplate=function(t){this.partStoneAttBufTemplate=[];for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.PartStoneAttBufVO,n.level=Number(i.level),n.attrTypeList=[],n.attrValueList=[];for(var s=i.att.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.partStoneAttBufTemplate.push(n)}},t.prototype.initPartStoneAttTemplate=function(t){this.partStoneAttTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.PartStoneAttVO,n.id=Number(i.id),n.stoneIndex=Number(i.stoneIndex),n.level=Number(i.level),n.costAttribute=new e.AttributeVO(i.cost),n.attrTypeList=[],n.attrValueList=[];for(var s=i.att.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.partStoneAttTemplate[n.id+"_"+n.stoneIndex+"_"+n.level]=n}},t.prototype.initPartStoneTemplate=function(t){this.partStoneTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.PartStoneVO,n.id=Number(i.id),n.stone1Id=Number(i.stone1Id),n.stone2Id=Number(i.stone2Id),n.stone3Id=Number(i.stone3Id),n.stone4Id=Number(i.stone4Id),this.partStoneTemplate[n.id]=n},t.prototype.initRoleLevelTemplate=function(t){this.roleLevelTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.RoleLevelVO,n.level=Number(i.level),n.exp=Number(i.exp),this.roleLevelTemplate[n.level]=n},t.prototype.initLanguageTemplate=function(e){this.languageTemplate={};for(var t,i=e.length,n=0;i>n;n++)t=e[n],this.languageTemplate[t.key]=t.value},t.prototype.initPreloadTemplate=function(){var t;t=RES.getRes("preloadData");for(var i,n,o,a,s=new JSZip(t),r=this.preloadTempList.length,l=0;r>l;l++){i=this.preloadTempList[l],o=i[0],a=i[1],n=null;var h=s.file(o+".json");if(null!=h){try{n=JSON.parse(h.asText())}catch(c){e.MtaUtils.notifyEvent("notify",{msg:"initPreloadTemplateError json: "+o}),e.FundebugUtils.notify("initPreloadTemplateError","json: "+o,c),console.error(c)}n?a.call(this,n):console.error("initPreloadTemplateError json: "+o),console.log("解析表格 "+o)}}e.GlobalUtil.destroyRes("preloadData",!0,!1)},t.prototype.loadingTemp=function(t){null==t&&console.log("resData null");var i=new JSZip(t);null==i&&console.log("zip null ");for(var n,o,a,s,r=this.preloadTempList.length,l=0;r>l;l++){n=this.preloadTempList[l],a=n[0],s=n[1],o=null;var h=i.file(a+".json");if(null==h&&console.log("jsonData 是空的"),null!=h){try{o=JSON.parse(h.asText())}catch(c){e.MtaUtils.notifyEvent("notify",{msg:"initPreloadTemplateError json: "+a}),e.FundebugUtils.notify("initPreloadTemplateError","json: "+a,c),console.error(c)}o?s.call(this,o):console.error("initPreloadTemplateError json: "+a),console.log("解析表格 "+a)}}e.GlobalUtil.destroyRes("preloadData",!0,!1)},t.prototype.initGlobalTemplate=function(e){this.globalTemplate={};for(var t,i=e.length,n=0;i>n;n++)t=e[n],this.globalTemplate[t.key]=t.value},t.prototype.initEquipTemplate=function(t){this.equipTemplate={},this.equipByPartTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.EquipVO,n.id=Number(i.id),n.partName=i.partName,n.name=i.name,n.part=Number(i.part),n.rareGroupId=Number(i.rareGroupId);for(var s=i.part.split(","),r=0;r<s.length;r++)n.partList.push(Number(s[r]));n.quality=Number(i.quality),n.level=Number(i.level),n.profession=Number(i.profession),n.smeltGain=Number(i.smeltGain),n.forgeSmeltNeed=Number(i.forgeSmeltNeed),n.washCoinCost=Number(i.washCoinCost),n.decomposeable=i.decomposeable;var l=i.equipAttr.split(","),h=void 0;n.attrTypeList=[],n.attrValueList=[];for(var r=0;r<l.length;r++)h=l[r].split("_"),n.attrTypeList.push(Number(h[0])),n.attrValueList.push(Number(h[1])),n.attrAddMiniValueList.push(Number(h[2])),n.attrAddMaxValueList.push(Number(h[3]));n.starLevel=Number(i.starLevel),n.suitId=Number(i.suitId),n.evolutionStuff=i.evolution;for(var c=i.decompose?i.decompose:"",u=c.split(","),r=0;r<u.length;r++)n.decomposeList.push(new e.AttributeVO(u[r]));n.evolutionId=Number(i.evolutionTargetId);for(var p=i.modelId?i.modelId:"",g=p.split(","),r=0;r<g.length;r++)n.modelIdList[r]=Number(g[r]);this.equipTemplate[n.id]=n;for(var d=void 0,f=void 0,m=0;m<n.partList.length;m++)f=n.partList[m],d=this.equipByPartTemplate[f],null==d&&(d=[],this.equipByPartTemplate[f]=d),d.push(n)}},t.prototype.initAttDefTemplate=function(t){this.attDefTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.AttDefVO,n.attId=Number(i.attId),n.score=Number(i.score),n.relation=Number(i.relation),n.numType=Number(i.numType),n.gemColor=Number(i.gemColor),n.equipColor=Number(i.equipColor),n.equipValueColor=Number(i.equipValueColor),this.attDefTemplate[n.attId]=n},t.prototype.initGodlyEquipTemplate=function(t){this.godlyEquipTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.GodlyEquipVO,n.id=Number(i.id),n.image=i.image,n.level=Number(i.level),n.costNum=Number(i.costNum),null!=i.costAttr&&(n.costAttVO=new e.AttributeVO(i.costAttr)),n.nextId=Number(i.nextId),this.godlyEquipTemplate[n.id]=n},t.prototype.initGodlyEquipInlayTemplate=function(t){this.godlyEquipInlayTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.GodlyEquipInlayVO,n.partId=Number(i.partId),n.inlayLevel=Number(i.inlayLevel),n.costVO=new e.AttributeVO(i.cost),n.rate=Number(i.rate)/1e4,n.rateStr=(Number(i.rate)-1e4)/100+"%",this.godlyEquipInlayTemplate[n.partId+"_"+n.inlayLevel]=n},t.prototype.initHuntSoulTemplate=function(t){this.soulHuntTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.SoulHuntVO,n.id=Number(i.id),n.consume=Number(i.consume.split("_")[2]),this.soulHuntTemplate[n.id]=n},t.prototype.initSoulGrooveTemplate=function(t){this.soulGrooveTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.SoulGrooveVO,n.id=Number(i.id),n.vip=Number(i.vip),n.level=Number(i.level),n.gold=Number(i.gold),n.coin=Number(i.coin),n.soulTips=String(i.soulTips),this.soulGrooveTemplate[n.id]=n},t.prototype.initSoulTemplate=function(t){this.soulTemplate={},this.multipleKeySoulTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.SoulVO,n.id=Number(i.id),n.name=i.name,n.type=Number(i.type),n.profession=Number(i.profession),n.degree=Number(i.degree),n.quality=Number(i.quality),n.attrTypeList=[],n.attrValueList=[];for(var s=i.attrs.split(","),r=s.length,l=void 0,h=0;r>h;h++)l=s[h].split("_"),n.attrTypeList.push(Number(l[0])),n.attrValueList.push(Number(l[1]));n.consumeAttrVO=new e.AttributeVO(i.upConsume),n.smeltAttrVO=new e.AttributeVO(i.smeltResult),n.score=Number(i.score),this.soulTemplate[n.id]=n,this.multipleKeySoulTemplate[n.type+"_"+n.quality+"_"+n.degree]=n}},t.prototype.initSpecialTemplate=function(t){this.specialRingTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.SpecialRingVO,n.id=Number(i.id),n.name=i.name,n.quality=Number(i.quality),n.icon=i.icon,n.type=Number(i.type),n.level=Number(i.level),n.needLevel=Number(i.needLevel);var s=i.levelupCost.split("_");n.costId=Number(s[1]),n.costNum=Number(s[2]);var r=i.attrs.split(","),l=void 0;n.attrTypeList=[],n.attrValueList=[];for(var h=0;h<r.length;h++)l=r[h].split("_"),n.attrTypeList.push(Number(l[0])),n.attrValueList.push(Number(l[1]));this.specialRingTemplate[n.type+"_"+n.level]=n}},t.prototype.initRareAttrTemplate=function(t){this.rareAttrTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.RareAttrVO,n.group=Number(i.group),n.attId=Number(i.attId),n.intensifyMaxVal=Number(i.intensifyMaxVal);var s=this.rareAttrTemplate[n.group];null==s&&(s=[],this.rareAttrTemplate[n.group]=s),s.push(n)}},t.prototype.initRareAttrStarTemplate=function(t){this.rareAttrStarTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.RareAttrStarVO,n.attId=Number(i.attId),n.star=Number(i.star),this.rareAttrStarTemplate[n.attId]=n},t.prototype.initModelTemplate=function(t){this.modelTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)n=t[a],i=new e.ModelVO,i.id=Number(n.id),i.name=n.name,i.dx=Number(n.dx),i.dy=Number(n.dy),i.effectType=Number(n.effectType),i.replaceModelId=Number(n.replaceModelId),i.uiModel=n.uiModel,this.modelTemplate[i.id]=i
},t.prototype.initWanFaTemplate=function(t){this.wanfaTemplate=[];for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.WanFaVO,n.id=Number(i.id),n.nameImg=i.name,n.describe=i.describe,n.describe1=i.describe1,n.type=Number(i.type),n.countType=Number(i.countType),n.award=new e.AttributeVO(i.award),n.background=i.background,this.wanfaTemplate.push(n)},t.prototype.initUnionBossHarmRankAwardTemplate=function(t){this.unionBossHarmRankAwardTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.UnionBossHarmRankVO,n.rank=Number(i.rank),n.awardVO=new e.AttributeVO(i.award),this.unionBossHarmRankAwardTemplate[n.rank]=n},t.prototype.initClimbingInfo=function(t){for(var i,n=[],o=t.length,a=0;o>a;){var s=t[a];i=new e.ClimbingPanelVO,i.id=~~s.id,i.mapId=~~s.mapId,i.firstAward=s.firstAward.split(","),i.dailyAward=s.dailyAward.split(","),n.push(i),a+=1}e.ClimbingController.getInstance().climbingData=n},t.prototype.initUnionActivity=function(t){this.unionActivity={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.UnionActivityVO,i.type=Number(a.type),i.name=a.name,i.dailyCount=Number(a.dailyCount),i.cost=a.cost.split("_"),i.awardDes=a.awardDes,i.award=[];for(var s=a.award.split(";"),r=0;r<s.length;r++){for(var l=s[r].split(","),h=[],c=0;c<l.length;c++){var u=l[c].split("_");h.push(u)}i.award.push(h)}this.unionActivity[i.type]=i}},t.prototype.initUnionLimits=function(t){this.unionlimis=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.UnionLimitsVO,i.posId=Number(a.posId);var s=a.limits;i.limits=s.split(","),this.unionlimis.push(i)}},t.prototype.initUnionPosition=function(t){this.unionPostion=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.UnionPositionVO,i.posId=Number(a.posId),i.posNum=Number(a.posNum),i.unionLevel=Number(a.unionLevel);var s=a.posAttr;i.posAttr=s.split("_"),this.unionPostion.push(i)}},t.prototype.initUnion=function(t){this.unionData={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.UnionVO,i.level=Number(a.level),i.exp=Number(a.exp),i.popSize=Number(a.popSize),this.unionData[i.level]=i}},t.prototype.initUnionSkill=function(t){this.unionPersonalSkill={},this.unionPublicSkill={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.UnionSkillVO,i.id=Number(a.id),i.level=a.level,i.name=a.name,i.isPublic=a.isPublic,i.icon=a.icon,i.type=Number(a.type),i.levelUpCost=[];for(var s=a.levelUpCost.split(","),r=0;r<s.length;r++){var l=s[r].split("_");i.levelUpCost.push(l)}i.attr=[];for(var h=a.attr.split(","),r=0;r<h.length;r++){var c=h[r].split("_");i.attr.push(c)}0==i.isPublic?this.unionPersonalSkill[i.id]=i:this.unionPublicSkill[i.id]=i}},t.prototype.initPartStarUpgrade=function(t){this.partStarUpgrade={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.PartStarUpgradeVO,i.level=a.level,i.levelLimit=Number(a.levelLimit),i.addRate=Number(a.addRate),i.levelUpCost=[];for(var s=a.levelUpCost.split(","),r=0;r<s.length;r++){var l=s[r].split("_");i.levelUpCost.push(l)}this.partStarUpgrade[i.level]=i}},t.prototype.initStrengthenQualityRate=function(t){this.strengthenQualityRate={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.StrengthenQualityRateVO,i.quality=Number(a.quality),i.rate=Number(a.rate),this.strengthenQualityRate[i.quality]=i}},t.prototype.initStrengthenLevelRate=function(t){this.strengthenLevelRate={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.StrengthenLevelRateVO,i.level=Number(a.level),i.rate=Number(a.rate),this.strengthenLevelRate[i.level]=i}},t.prototype.initStrengthen=function(t){this.strengthen={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.StrengthenVO,i.id=Number(a.id),i.level=Number(a.level),i.levelLimit=Number(a.levelLimit);var s=a.levelUpCost;i.levelUpCost=s.split("_");var r=a.goldCost;i.goldCost=r.split("_");for(var l=10,h=1;l>=h;h++)i["propertiesCloaks"+h]=[],i["propertiesCloaks"+h]=a["propertiesCloaks"+h].split("_");this.strengthen[i.id]=i}},t.prototype.initMedalTitleQuality=function(t){this.medalTitleQuality={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.MedalTitleQualityVO,i.id=Number(a.id),i.quality=a.quality,i.star=a.star,i.cost=[];for(var s=a.cost.split(","),r=0;r<s.length;r++){var l=s[r];i.cost.push(l.split("_"))}i.icon=a.icon,i.attrAddition=a.attrAddition,i.successRate=a.successRate,this.medalTitleQuality[i.id]=i}},t.prototype.initStandardAcRankAward=function(t){this.StandardAcRankAwardArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.StandardAcRankAwardVO,i.activityId=Number(a.activityId),i.rank=Number(a.rank),i.days=Number(a.days),i.titleIcon=a.titleIcon,i.type=Number(a.type);for(var s=a.award.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.StandardAcRankAwardArr.push(i)}},t.prototype.initStandardActivity=function(t){this.StandardActivityArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.StandardActivityVO,i.id=Number(a.id),i.days=Number(a.days),i.cond=Number(a.cond),i.targetType=Number(a.targetType),i.stageId=Number(a.stageId),i.imgSource=a.imgSource;for(var s=a.award.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.StandardActivityArr.push(i)}},t.prototype.initMedalTitleLevel=function(t){this.medalTitleLevel=[],this.medalTitleLevelByModelIdAndLevel={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.MedalLevelVO,i.id=Number(a.id),i.modelId=a.modelId,i.level=a.level,i.cost=new e.AttributeVO(a.cost),i.attrTypeList=[],i.attrValueList=[];for(var s=a.attr.split(","),r=0;r<s.length;r++){var l=s[r].split("_");i.attrTypeList.push(Number(l[0])),i.attrValueList.push(Number(l[1]))}this.medalTitleLevel.push(i),this.medalTitleLevelByModelIdAndLevel[i.modelId+"_"+i.level]=i}},t.prototype.initMedalTitle=function(t){this.medalTitle=[],this.medalTemplate={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.MedalVO,i.id=Number(a.id),i.des=a.des,i.title=a.title,i.minGrade=Math.round(Number(a.minGrade)),i.maxGrade=Math.round(Number(a.maxGrade)),i.animation=a.animation,i.icon1=a.icon1,i.icon2=a.icon2,i.prof=a.prof,this.medalTitle.push(i),this.medalTemplate[i.id]=i}},t.prototype.initGrowFund=function(t){this.GrowFundArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.GrowFundVO,i.id=Number(a.id),i.level=Number(a.level);for(var s=a.awards.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.GrowFundArr.push(i)}},t.prototype.initOpenServerGift=function(t){this.openServerGiftArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.OpenServerGiftVO,i.id=Number(a.id),i.stageId=a.stageId,i.days=Number(a.days),i.buyCount=Number(a.buyCount),i.originalPrice=Number(a.originalPrice),i.presentPrice=Number(a.presentPrice);for(var s=a.awards.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.openServerGiftArr.push(i)}},t.prototype.initRechargeRankings=function(t){this.rechargeRankingsArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.RechargeRankingsVO,i.id=Number(a.id),i.stageId=a.stageId,i.ranking=Number(a.ranking);for(var s=a.awards.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.rechargeRankingsArr.push(i)}},t.prototype.initNationalWelfare=function(t){this.quanminfuliArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.NationalWelfareVO,i.id=Number(a.id),i.stageId=a.stageId,i.days=Number(a.day),i.buyCount=Number(a.buyCount),i.originalPrice=Number(a.originalPrice),i.presentPrice=Number(a.presentPrice);for(var s=a.awards.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.quanminfuliArr.push(i)}},t.prototype.initGuide=function(t){var i,n,o={},a=0,s=t.length,r=0,l=0;for(this.initguidetemp={};s>a;){for(n=t[a],i=new e.GuideInfoVO,n.stepInfo=n.stepInfo.split(","),r=0,l=n.stepInfo.length;l>r;r+=1)n.stepInfo[r]=JSON.parse(n.stepInfo[r]);for(n.name=n.name.split(","),r=0,l=n.name.length;l>r;r+=1)n.name[r]=JSON.parse(n.name[r]);i.stepInfo=n.stepInfo,i.id=~~n.id,i.level=~~n.level,i.step=~~n.step,i.name=n.name,i.voiceName=n.voiceName,i.whetherOpen=n.whetherOpen,i.mission=Number(n.mission),this.initguidetemp[i.mission]=i,o[i.id]=i,a+=1}App.GuideUtils().initConfig(o)},t.prototype.ContinueRecharge=function(t){this.coutinueRechargeArr=[],this.coutinueItemArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];if(i=new e.ContinueRechargeVO,Number(-1==a.id))this.coutinueItemArr.awardStr=a.awards;else{i.id=Number(a.id),i.stageId=a.stageId,i.day=Number(a.day);for(var s=a.awards.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.coutinueRechargeArr.push(i)}}},t.prototype.initAccRecharge2=function(t){this.accRecharge2Arr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.AccRecharge2VO,i.id=Number(a.id),i.stageId=a.stageId,i.sum=Number(a.sum);for(var s=a.awards.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.awards.push(l)}this.accRecharge2Arr.push(i)}},t.prototype.initActivityTime=function(t){this.activityTimeArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.ActivityTimeVO,i.id=Number(a.activityId),i.activityId=a.activityId,i.stageId=Number(a.stageId),i.startTime=a.startTime,i.endTime=a.endTime,i.closeTime=a.closeTime,i.openPlace=Number(a.openPlace),i.ImgSource=a.ImgSource,i.serverid=a.serverid,this.activityTimeArr.push(i)}},t.prototype.initModuleOpen=function(t){this.moduleOpen=[],this.allModuleOpenMsg={};for(var i=t.length,n=0;i>n;n++){var o=t[n],a=new e.ModuleOpenVO;a.level=Number(o.level),a.bgPath=o.bgPath,a.icon=o.icon,a.skipType=Number(o.skipType),a.id=Number(o.id),a.vipLimit=Number(o.vipLimit),a.showOpenTip=Number(o.showOpenTip),a.sort=Number(o.sort),a.type=Number(o.type),a.award=String(o.awards),a.describe=String(o.describe),a.showOpenTip&&this.moduleOpen.push(a),this.allModuleOpenMsg[a.type]=a}this.moduleOpen=this.moduleOpen.sort(function(e,t){return e.level-t.level})},t.prototype.initFightDefeat=function(t){this.fightDefeatArr=[];for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.FightDefeatVO,i.typeId=Number(a.typeId),i.name=a.name,i.iconStr=a.icon,i.skipType=Number(a.skipType),i.turnId=Number(a.turnId),this.fightDefeatArr.push(i)}},t.prototype.initMonster=function(t){this.monster={};for(var i=t.length,n=0;i>n;n++){var o=t[n],a=new e.MonsterVO;a.id=Number(o.id),a.name=o.name,a.level=Number(o.level),a.iconPath=o.icon;var s=a.iconPath.split("/"),r=s[1].split(".");a.iconPath=r[0]+"_png",a.type=Number(o.type),a.modelId=Number(o.modelId),a.effectType=Number(o.effectType),a.modelScale=Number(o.modelScale),a.skills=o.skills,a.hp=o.hp,a.isBoss=Number(o.isBoss),a.standbyAnimation=o.standbyAnimation,this.monster[a.id]=a}},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.initMailTemplate=function(t){this.mailTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.MailVO,n.id=Number(i.mailid),n.title=i.title,n.content=i.content,this.mailTemplate[n.id]=n},t.prototype.initItemTemplate=function(t){this.itemTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){i=t[a],n=new e.ItemVO,n.id=Number(i.id),n.name=i.name,n.type=Number(i.type),n.levelLimit=Number(i.levelLimit),n.profLimit=Number(i.profLimit),n.price=Number(i.price),n.containItem=i.containItem,n.icon=i.icon,n.isRecovery=Number(i.alchemyState),n.alchemyValue=Number(i.alchemyValue);var s=n.icon.split("/"),r=s[1].split(".");if(0==r[0].indexOf("item")?n.icon=r[0]+"_png":n.icon="item"+r[0]+"_png",n.desc=i.desc,n.quality=Number(i.quality),n.pageGoTo=Number(i.skipPage),i.getWay){var l=i.getWay.split(",");n.getWayList=[];for(var h=0;h<l.length;h++)n.getWayList[h]=Number(l[h])}n.iconAnimName=i.iconAnimName,n.qualityAnimName=i.qualityAnimName,null!=i.vipLevel&&(n.vipLevel=Number(i.vipLevel)),null!=i.goldNumber&&(n.goldNumber=Number(i.goldNumber)),this.itemTemplate[n.id]=n}},t.prototype.initMapTemplate=function(t){this.mapTemplate={},this.mapByGroupAndLevelTemplate={},this.mapByGroupTemplate={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];if(i=new e.MapVO,i.id=Number(a.id),i.bossId=Number(a.bossId),i.name=a.name,i.bossMapID=Number(a.bossMapID),i.icon=a.icon,i.monsterLevelRange=Number(a.monsterLevelRange),i.dropRate=Number(a.monsterLevelRange),i.mapGroup=Number(a.mapGroup),i.limitLevel=Number(a.limitLevel),i.maxLevelLimit=Number(a.maxLevelLimit),i.battleIcon=a.battleIcon,i.extraCost=new e.AttributeVO(a.extraCost),i.extraCost2=new e.AttributeVO(a.extraCost2),i.zoomRatio=Number(a.zoomRatio),i.rotation=Number(a.rotation),i.standbyAnimation=a.standbyAnimation,i.mapJump=a.mapJump,i.mapNextId=Number(a.nextMapId),i.avgExpPerHour=Number(a.avgExpPerHour),i.avgCoinPerHour=Number(a.avgCoinPerHour),i.fixedDrop=[],a.fixedDrop)for(var s=a.fixedDrop.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]);i.fixedDrop.push(l)}if(i.dropPreview=[],a.dropPreview)for(var h=a.dropPreview.split(","),r=0;r<h.length;r++){var c=new e.AttributeVO(h[r]);i.dropPreview.push(c)}var u=a.mapLattices.split(",");i.mapXGrid=Number(u[0]),i.mapYGrid=Number(u[1]),this.mapTemplate[i.id]=i;var p=this.mapByGroupAndLevelTemplate[i.mapGroup+"_"+i.limitLevel];null==p&&(p=[],this.mapByGroupAndLevelTemplate[i.mapGroup+"_"+i.limitLevel]=p),p.push(i),p=this.mapByGroupTemplate[i.mapGroup],null==p&&(p=[],this.mapByGroupTemplate[i.mapGroup]=p),p.push(i)}},t.prototype.initNobilityMission=function(t){this.nobilityMission={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.JueweiMissionVO,i.id=Number(a.id),i.name=a.name,i.type=Number(a.type),i.cond=Number(a.cond),i.skipType=Number(a.skipType),this.nobilityMission[i.id]=i}},t.prototype.initNobility=function(t){this.nobility={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.JueweiVO,i.level=a.id,i.chopPath=a.chopPath,i.name=a.name,i.namelevel=a.namelevel,i.type=a.type,i.intervalLv=a.intervalLv,i.attrs=[];for(var s=a.attrs.split(","),r=0;r<s.length;r++){var l=s[r].split("_");i.attrs[r]=[],i.attrs[r].push(Number(l[0])),i.attrs[r].push(Number(l[1]))}if(i.missions=[],a.missions)for(var h=a.missions.split(","),r=0;r<h.length;r++)i.missions[r]=Number(h[r]);i.awards=[];for(var c=a.awards.split(","),r=0;r<c.length;r++){var l=c[r].split("_");i.awards[r]=[],i.awards[r].push(Number(l[0])),i.awards[r].push(Number(l[1])),i.awards[r].push(Number(l[2]))}this.nobility[i.level]=i}},t.prototype.initRechargeTemplate=function(t){this.firstRechargeTemplate=[],this.rechargeTemplate=[],this.limitTimesTemplate=[],this.mfsqRechargeTemplate=[],this.rechargeProductIdTemplate=new Object;var i,n,o=t.length;this.xianshiXianGouTemplate=[];for(var a=0;o>a;a++)i=t[a],n=new e.RechargeVO,n.id=Number(i.id),n.type=Number(i.type),n.amount=Number(i.amount),n.addNum=Number(i.addNum),n.costMoney=Number(i.costMoney),n.exhibition1=String(i.exhibition1),n.exhibition2=String(i.exhibition2),n.exhibition3=String(i.exhibition3),n.valid="true"==i.valid,n.productId=i.productId,n.productName=i.productName,n.activityId=Number(i.activityId),n.icon=i.icon,n.costdt=i.costdt,this.rechargeProductIdTemplate[n.productId]=n,0==n.type?this.rechargeTemplate.push(n):3==n.type?this.firstRechargeTemplate.push(n):4==n.type?this.fundTemplate=n:6==n.type?this.jubappenGoldTemplate=n:7==n.type?this.jubappenExpTemplate=n:8==n.type?this.jubappenMoneyTemplate=n:12==n.type?this.xianshiXianGouTemplate.push(n):14==n.type?this.limitTimesTemplate.push(n):15==n.type&&this.mfsqRechargeTemplate.push(n)},t.prototype.initrecharge1758=function(t){this.recharge1758Template=new Object;for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.Recharge1758VO,n.id=Number(i.id),n.productId=i.productId,n.appKey=i.appKey,n.rechargeId=Number(i.rechargeId),this.recharge1758Template[n.productId+"_"+n.appKey]=n},t.prototype.initErrorCode=function(e){this.errorCode={};for(var t=e.length,i=0;t>i;i++){var n=e[i],o=n.errorCode,a=n.errorMsg;this.errorCode[o]={},this.errorCode[o]=a}},t.prototype.initFirstRechargeRewardTemplate=function(t){this.firstRechargeRewardTemplate={};for(var i,n,o,a,s=t.length,r=0;s>r;r++){i=t[r],n=new e.FirstRechargeRewardVO,n.profession=Number(i.prof),n.rewardList=[],o=i.prize.split(",");for(var l=0;l<o.length;l++)a=new e.AttributeVO(o[l]),n.rewardList.push(a);this.firstRechargeRewardTemplate[n.profession]=n}},t.prototype.initNewVipPrivilege=function(t){this.vipTemplate={};for(var i,n=0;n<t.length;n++){i=new e.VipVO,i.vipLevel=Number(t[n].vipLevel),i.bagContainers=Number(t[n].bagContainers),i.needRechargeGold=Number(t[n].needRechargeGold),i.copperMoneyAdded=Number(t[n].copperMoneyAdded),i.experienceAddition=Number(t[n].experienceAddition),i.palaceChallengeTimes=Number(t[n].palaceChallengeTimes),i.buyPalaceChallengeTimes=Number(t[n].buyPalaceChallengeTimes),i.palaceBossBattleTimes=Number(t[n].palaceBossBattleTimes),i.buyPalaceBossBattleTimes=Number(t[n].buyPalaceBossBattleTimes);var o=t[n].copyTimes.split(","),a=void 0,s=o.length;i.copyTimes=[];for(var r=0;s>r;r++)a=o[r].split("_"),i.copyTimes[r]=[],i.copyTimes[r].push(Number(a[0])),i.copyTimes[r].push(Number(a[1])),i.copyTimes[r].push(Number(a[2]));i.copyBuyTimes=[];var l=t[n].copyBuyTimes.split("_");i.copyBuyTimes.push(Number(l[0])),i.copyBuyTimes.push(Number(l[1])),i.copyBuyTimes.push(Number(l[2])),i.copyBuyTimes.push(Number(l[3])),i.fight=Number(t[n].fight),this.vipTemplate[i.vipLevel]=i}},t.prototype.initHelpTemplate=function(e){this.helpTemplate={};for(var t,i=e.length,n=0;i>n;n++)t=e[n],this.helpTemplate[t.key]=t.value},t.prototype.initAchievement=function(t){this.achievement={};for(var i,n=t.length,o=0;n>o;o++){var a=t[o];i=new e.AchievementVO,i.id=a.id,i.targetType=t[o].targetType,i.name=t[o].name,i.moduleType=t[o].moduleType,i.award=t[o].award.split("_"),i.cond=t[o].cond,this.achievement[i.id]=i}},t.prototype.initAccLogin=function(e){this.wealInfo.login=e},t.prototype.initEveryDaySign=function(e){this.wealInfo.signed=e},t.prototype.initEveryDayReSignCostGold=function(e){this.wealInfo.resigned=e},t.prototype.initActiviReward=function(e){this.wealInfo.taskAward=e},t.prototype.initActiviTask=function(e){this.wealInfo.task=e},t.prototype.initMarquee=function(t){this.noticeMarquee={};for(var i,n=t.length,o=null,a=0;n>a;a++)o=t[a],i=new e.MarqueeVO,i.typeId=o.typeId,i.text=o.text,i.pos=o.pos&&o.pos.split(",")||[],this.noticeMarquee[i.typeId]=i},t.prototype.initSearchTreasureTemplate=function(t){this.searchTreasureTemplate=[];for(var i,n,o,a,s,r=t.length,l=0;r>l;l++){i=t[l],n=new e.SearchTreasureVO,n.stageId=Number(i.stageId),n.minLevel=Number(i.minLevelLimit),n.maxLevel=Number(i.maxLevelLimit),n.rewardList=[],o=i.previewReward.split(","),a=o.length;for(var h=0;a>h;h++)s=new e.AttributeVO(o[h]),n.rewardList.push(s);null==this.searchTreasureTemplate[n.stageId]&&(this.searchTreasureTemplate[n.stageId]=[]),this.searchTreasureTemplate[n.stageId].push(n)}},t.prototype.initConfigData=function(){for(var t,i,n,o=this.tempList.length,a=new JSZip(RES.getRes("mainData")),s=0;o>s;s++){t=String(this.tempList[s][0]),i=this.tempList[s][1],Log.trace(t+":表"),n=null;try{a.file(t+".json")&&(n=JSON.parse(a.file(t+".json").asText()))}catch(r){e.MtaUtils.notifyEvent("notify",{msg:"initConfigDataError json: "+t}),e.FundebugUtils.notify("initConfigDataError","json: "+t,r),console.error(r)}n?i.call(this,n):console.error("initConfigDataError json: "+t)}e.GlobalUtil.destroyGroup("dataConfigGroup")},t.prototype.initToolShopTemplate=function(t){this.toolShopTemplate={};var i,n,o,a=t.length;for(n=0;a>n;++n)o=t[n],i=new e.ToolShopVO,i.init(o),this.toolShopTemplate[i.itemID]=i},t.prototype.initEquipmentUpgradeTemplate=function(t){this.equipmentUpgradeTemplate={},this.equipmentUpgradeByPartTemplate={};var i,n,o,a,s,r,l,h,c,u=t.length,p=this.equipTemplate;for(n=0;u>n;n++){for(o=t[n],i=new e.EquipmentUpgradeVO,i.id=Number(o.id),r=o.cost.split(","),h=r.length,i.costList=[],l=0;h>l;l++)c=new e.AttributeVO(r[l]),i.costList.push(c);i.nextId=Number(o.nextId),i.level=Number(o.level),this.equipmentUpgradeTemplate[i.id]=i,a=p[i.id],s=a.partList[0],null==this.equipmentUpgradeByPartTemplate[s]&&(this.equipmentUpgradeByPartTemplate[s]=[]),this.equipmentUpgradeByPartTemplate[s].push(i)}},t.prototype.initEquipLinkAttTemplate=function(t){this.equipLinkTemplate={};var i,n,o,a,s,r,l,h=t.length;for(i=0;h>i;i++){for(o=t[i],n=new e.EquipLinkAttVO,n.level=Number(o.level),s=o.att.split(","),a=s.length,n.attTypeList=[],n.attValueList=[],r=0;a>r;r++)l=s[r].split("_"),n.attTypeList.push(Number(l[0])),n.attValueList.push(Number(l[1]));this.equipLinkTemplate[n.level]=n}},t.prototype.initEquipLinkAttOfLevel=function(t){this.equipGongMingLevelTemplate={};for(var i,n,o,a,s=t.length,r=0;s>r;r++){i=t[r],n=new e.EquipGongMingLevelVO,n.level=Number(i.level),n.profession=Number(i.profession),n.attrTypeList=[],n.attrValueList=[],o=i.att.split(",");for(var l=0;l<o.length;l++)a=o[l].split("_"),n.attrTypeList.push(Number(a[0])),n.attrValueList.push(Number(a[1]));this.equipGongMingLevelTemplate[n.level+"_"+n.profession]=n}this.redEquip_levelTemplete={},s=t.length;for(var r=0;s>r;r++){var h=t[r],c=h.profession+"_"+h.level;this.redEquip_levelTemplete[c]=h.att}},t.prototype.initEquipLinkAttOfCount=function(t){this.equipGongMingLinkTemplate={};for(var i,n,o,a,s=t.length,r=0;s>r;r++){i=t[r],n=new e.EquipGongMingLinkVO,n.count=Number(i.count),n.profession=Number(i.profession),n.attrTypeList=[],n.attrValueList=[],o=i.att.split(",");for(var l=0;l<o.length;l++)a=o[l].split("_"),n.attrTypeList.push(Number(a[0])),n.attrValueList.push(Number(a[1]));this.equipGongMingLinkTemplate[n.count+"_"+n.profession]=n}this.redEquip_countTemplete={},s=t.length;for(var r=0;s>r;r++){var h=t[r],c=h.profession+"_"+h.count;this.redEquip_countTemplete[c]=h.att}},t.prototype.initServerListTemplate=function(e){this.serverListTemplate=[],this.serverListGroupTemplate=[];for(var t,i,n=e.length,o=0;n>o;o++)t=e[o],i=new ServerListVo,i.gameid=t.gameid,i.serverId=Number(t.serverId),i.tab=Number(t.tab),i.group=Number(t.group),i.serverName=Number(t.serverName),this.serverListGroupTemplate[i.gameid+","+i.tab+","+i.group]=i.group,this.serverListTemplate[i.gameid+"_"+i.serverId]=i},t.prototype.initQQServerListTemplate=function(e){this.qqServerListTemplate=[];for(var t,i,n=e.length,o=0;n>o;o++)t=e[o],i=new QQServerListVo,i.gameid=t.gameid,i.serverId=Number(t.serverId),this.qqServerListTemplate[i.gameid]=i},t.prototype.initPKRankPrizeTemplate=function(t){this.PKRankPrizeTemplate={};for(var i,n,o,a,s,r,l=t.length,h=0;l>h;h++){for(i=t[h],n=new e.PKRankPrizeVO,n.rank=Number(i.rank),n.prizeList=[],a=i.prize.split(","),r=a.length,s=0;r>s;s++)o=new e.AttributeVO(a[s]),n.prizeList.push(o);this.PKRankPrizeTemplate[n.rank]=n}},t.prototype.initPKPrizeTemplate=function(t){this.PKPrizeTemplate={};for(var i,n,o,a,s,r,l=t.length,h=0;l>h;h++){for(i=t[h],n=new e.PKPrizeVO,n.level=Number(i.enemyLvl),n.prizeList=[],a=i.prize.split(","),r=a.length,s=0;r>s;s++)o=new e.AttributeVO(a[s]),n.prizeList.push(o);this.PKPrizeTemplate[n.level]=n}},t.prototype.initRankAward=function(e){this.aren_RankAwardTemplate=e.concat()},t.prototype.initArenalShop=function(e){this.aren_ShopTemplate=e.concat()},t.prototype.initNameTemplate=function(t){this.nameTemplate=[];for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.NameVO,n.id=Number(i.id),n.firstName=i.firstName,n.manName=i.manName,n.womanName=i.womanName,this.nameTemplate.push(n)},t.prototype.initVipGift=function(t){this.vipGift=[];var i,n,o,a=t.length;for(n=0;a>n;++n){o=t[n],i=new e.VipGiftVO,i.id=o.id,i.vipLevel=o.vipLevel,i.thePrice=o.thePrice,i.presentPrice=o.presentPrice;for(var s=[],r=o.awards.split(","),l=void 0,h=0;h<r.length;++h)l=new e.AttributeVO(r[h]),s.push(l);i.awards=s,this.vipGift.push(i)}},t.prototype.initDailyVipGift=function(t){this.vipDailyGift=[];var i,n,o,a=t.length;for(n=0;a>n;++n){o=t[n],i=new e.VipGiftVO,i.id=o.id,i.vipLevel=o.vipLevel;for(var s=[],r=o.awardStr.split(","),l=void 0,h=0;h<r.length;++h)l=new e.AttributeVO(r[h]),s.push(l);i.awards=s,this.vipDailyGift.push(i)}},t.prototype.initVipPrivilege=function(t){this.vipPrivilegeTemplate=[];var i,n,o,a=t.length;for(n=0;a>n;++n)o=t[n],i=new e.VipPrivilegeDecVO,i.VipLevel=Number(o.VipLevel),i.Description1=o.Description1,i.Description2=o.Description2,i.Description3=o.Description3,i.Description4=o.Description4,i.Description5=o.Description5,i.Description6=o.Description6,i.Description7=o.Description7,i.Description8=o.Description8,i.Description9=o.Description9,i.Description10=o.Description10,i.Description11=o.Description11,i.Description12=o.Description12,i.Description13=o.Description13,i.Description14=o.Description14,i.Description15=o.Description15,this.vipPrivilegeTemplate.push(i)},t.prototype.initRoleTemplate=function(t){if(null==this.roleTemplate){this.roleTemplate={},this.roleByProfessionAndSexTemplate={};for(var i,n,o=t.length,a=0;o>a;a++)i=t[a],n=new e.RoleVO,n.id=Number(i.id),n.profession=Number(i.profession),n.sex=Number(i.sex),n.level=Number(i.level),n.exp=Number(i.exp),n.name=i.name,n.skills=i.skills,n.icon=i.icon+"_png",n.icon2=i.icon2+"_jpg",n.proIcon=i.proIcon,n.defaultModel=i.defaultModel,n.seatLevel=i.seatLevel,this.roleTemplate[n.id]=n,this.roleByProfessionAndSexTemplate[n.profession+"_"+n.sex]=n}},t.prototype.initRankTemplate=function(t){this.rankListTemplate=[],this.rankByTypeTemplate={};for(var i,n,o=t.length,a=0;o>a;a++){if(i=t[a],n=new e.RankVO,n.type=Number(i.type),n.name=i.name,n.medalUrl=i.medalUrl,n.medalUrl){var s=n.medalUrl.split("/"),r=s[1].split(".");0==r[0].indexOf("medal")?n.medalUrl=r[0]+"_png":n.medalUrl="medal"+r[0]+"_png"}this.rankListTemplate.push(n),this.rankByTypeTemplate[n.type]=n}},t.prototype.initRankRewardTemplate=function(t){this.rankRewardTemplate={};for(var i,n,o,a,s,r=t.length,l=0;r>l;l++){i=t[l],n=new e.RankRewardVO,n.type=Number(i.type),n.rank=Number(i.rank),n.rewardList=[],a=i.award.split(","),s=a.length;for(var h=0;s>h;h++)o=new e.AttributeVO(a[h]),n.rewardList.push(o);null==this.rankRewardTemplate[n.type]&&(this.rankRewardTemplate[n.type]=[]),this.rankRewardTemplate[n.type].push(n)}},t.prototype.initUnionBossTemplate=function(t){this.unionBossTemplate1=[],this.unionBossTemplate2={};for(var i,n,o,a,s=t.length,r=0;s>r;r++){i=t[r],n=new e.UnionBossVO,n.id=Number(i.id),n.bossId=Number(i.bossId),n.killAward=[],o=i.killAward.split(",");for(var l=0;l<o.length;l++)a=new e.AttributeVO(o[l]),n.killAward.push(a);n.challengeAward=[],o=i.challengeAward.split(",");for(var l=0;l<o.length;l++)a=new e.AttributeVO(o[l]),n.challengeAward.push(a);this.unionBossTemplate1.push(n),this.unionBossTemplate2[n.bossId]=n}},t.prototype.initCSShop=function(t){var i=t.length;this.csShop=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.CSShopVO,n.itemID=a.itemID,n.price=a.price,this.csShop.push(n)}},t.prototype.initCSSegmentAward=function(t){var i=t.length;this.csSegmentAward=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.CSSegmentAwardVO,n.segment=a.segment,n.awards=[];for(var s=a.awards.split(","),r=0;r<s.length;r++)n.awards.push(s[r].split("_"));this.csSegmentAward.push(n)}},t.prototype.initCSPreliminaryAward=function(t){var i=t.length;this.csPreliminaryAward=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.CSPreliminaryAwardVO,n.rankStart=a.rankStart,n.rankEnd=a.rankEnd,n.id=a.id,n.awards=[];for(var s=a.awards.split(","),r=0;r<s.length;r++)n.awards.push(s[r].split("_"));this.csPreliminaryAward.push(n)}},t.prototype.initCSFinalsAward=function(t){var i=t.length;this.csFinalsAward=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.CSFinalsAwardVO,n.rankEnd=a.rankEnd,n.rankStart=a.rankStart,n.id=a.id,n.awards=[];for(var s=a.awards.split(","),r=0;r<s.length;r++)n.awards.push(s[r].split("_"));this.csFinalsAward.push(n)}},t.prototype.initCSWorshipAward=function(t){var i=t.length;this.csWorshipAward=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.CSWorshipAwardVO,n.day=a.day,n.awards=a.awards.split("_"),n.firstServerAwards=[];for(var s=a.firstServerAwards.split(","),r=0;r<s.length;r++)n.firstServerAwards.push(s[r].split("_"));this.csWorshipAward.push(n)}},t.prototype.initCSTime=function(t){var i=t.length;this.csTime=[];for(var n,o=0;i>o;o++){var a=t[o];n=new e.CSTimeVO,n.top8OpenTime=a.top8OpenTime.split(":"),n.top4OpenTime=a.top4OpenTime.split(":"),n.top2OpenTime=a.top2OpenTime.split(":"),n.top1OpenTime=a.top1OpenTime.split(":"),this.csTime.push(n)}},t.prototype.initDragonArmorTemplate=function(t){var i=t.length;this.dragonArmorTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.DragonArmourVO,n.id=a.id,n.name=a.name,n.part=Number(a.part),n.attrTypeList=[],n.attrValueList=[];for(var s=a.attr.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));for(var h=a.decompose?a.decompose:"",c=h.split(","),u=0;u<c.length;u++)n.decompose.push(new e.AttributeVO(c[u]));this.dragonArmorTemplate[n.id]=n}},t.prototype.initDragonArmorSkillTemplate=function(t){var i=t.length;this.dragonArmorSkillTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.DragonArmourSkillVO,n.id=a.id,n.name=a.name,n.depict=a.depict,n.quality=a.quality,n.icon=a.icon,n.animation=a.animation,n.score=Number(a.score),this.dragonArmorSkillTemplate[n.id]=n}},t.prototype.initDragonArmorSkillStoneTemplate=function(t){var i=t.length;this.dragonArmorSkillStoneTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.DragonArmourSkillStoneVO,n.id=a.id,n.name=a.name;var s=a.part.split(",");n.part=[];for(var r=0;r<s.length;r++)n.part.push(Number(s[r]));n.skillId=a.skillId,this.dragonArmorSkillStoneTemplate[n.id]=n}},t.prototype.initDragonArmorGuardTemplate=function(t){var i=t.length;this.dragonArmorGuardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.DragonArmourGuardVO,n.id=a.id,n.level=a.level,n.levelUpCost=a.levelUpCost.split("_"),n.attrTypeList=[],n.attrValueList=[];for(var s=a.attr.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));n.effect1=a.effect1,n.effect2=a.effect2,this.dragonArmorGuardTemplate[n.id]=n}},t.prototype.initTwelvePalaceTemplate=function(t){var i,n,o=t.length;this.twelvePalaceTemplate={};for(var a=0;o>a;a++)i=t[a],n=new e.TwelvePalaceVO,n.id=Number(i.id),n.mapId=Number(i.mapId),n.name=i.name,n.award=i.award,n.showAWD=i.showAWD,this.twelvePalaceTemplate[n.id]=n;this.twelvePalaceTemplate.getFashionInfoByMapId=function(e){for(var t=Object.keys(this),i=0;i<t.length;i++){var n=t[i],o=this[n];if(o.mapId==e)return o}}},t.prototype.initUSScene=function(t){var i=t.length;this.usSceneTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USSceneVO,n.sceneId=Number(a.sceneId),n.mapId=Number(a.mapId),n.integralLimit=Number(a.integralLimit),n.name=a.name,this.usSceneTemplate[o+1]=n}},t.prototype.initUSIntegralAward=function(t){var i=t.length;this.usIntegralAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USIntegralAwardVO,n.integral=Number(a.integral),n.award=[];for(var s=a.award.split("_"),r=0;r<s.length;r++)n.award.push(s[r]);n.name=a.name,n.icon=a.icon,n.quality=Number(a.quality),n.color=a.color,this.usIntegralAwardTemplate[o+1]=n}},t.prototype.initUSIntegralRankAward=function(t){var i=t.length;this.usIntegralRankAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USIntegralRankAwardVO,n.rank=Number(a.rank),n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));this.usIntegralRankAwardTemplate[n.rank]=n}},t.prototype.initUSPersonalRankAward=function(t){var i=t.length;this.usPersonalRankAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USPersonalRankAwardVO,n.rank=Number(a.rank),n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));this.usPersonalRankAwardTemplate[n.rank]=n}},t.prototype.initUSPosAward=function(t){var i=t.length;this.usPosAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USPosAwardVO,n.posId=Number(a.posId),n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));n.name=a.name,this.usPosAwardTemplate[n.posId]=n}},t.prototype.initUSPos=function(t){var i=t.length;this.usPosTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USPosVO,n.posId=Number(a.posId),n.name=a.name,n.unionPos=[];for(var s=a.unionPos.split(","),r=0;r<s.length;r++)n.unionPos.push(a.unionPos);
this.usPosTemplate[n.posId]=n}},t.prototype.initUSEquip=function(t){var i=t.length;this.usEquipTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USEquipVO,n.itemId=a.itemId,n.attrTypeList=[],n.attrValueList=[];for(var s=a.attr.split(","),r=void 0,l=0;l<s.length;l++)r=s[l].split("_"),n.attrTypeList.push(Number(r[0])),n.attrValueList.push(Number(r[1]));this.usEquipTemplate[n.itemId]=n}},t.prototype.initUSCSIntegralAward=function(t){var i=t.length;this.usCSIntegralAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USIntegralAwardVO,n.integral=Number(a.integral),n.award=[];for(var s=a.award.split("_"),r=0;r<s.length;r++)n.award.push(s[r]);n.name=a.name,n.icon=a.icon,n.quality=Number(a.quality),n.color=a.color,this.usCSIntegralAwardTemplate[o+1]=n}},t.prototype.initUSCSIntegralRankAward=function(t){var i=t.length;this.usCSIntegralRankAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USIntegralRankAwardVO,n.rank=Number(a.rank),n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));this.usCSIntegralRankAwardTemplate[n.rank]=n}},t.prototype.initUSCSPersonalRankAward=function(t){var i=t.length;this.usCSPersonalRankAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USPersonalRankAwardVO,n.rank=Number(a.rank),n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));this.usCSPersonalRankAwardTemplate[n.rank]=n}},t.prototype.initUSCSPosAward=function(t){var i=t.length;this.usCSPosAwardTemplate={};for(var n,o=0;i>o;o++){var a=t[o];n=new e.USPosAwardVO,n.posId=Number(a.posId),n.award=[];for(var s=a.award.split(","),r=0;r<s.length;r++)n.award.push(s[r].split("_"));n.name=a.name,this.usCSPosAwardTemplate[n.posId]=n}},t.prototype.initGuideMission=function(t){this.guideMissionTemplate={};for(var i=0;i<t.length;i++){var n=new e.GuideMissionVO(t[i]);this.guideMissionTemplate[n.QuestId]=n}},t.prototype.initGuideMissionRobot=function(t){this.guideMissionRobotTemplate={};for(var i=0;i<t.length;i++){var n=new e.GuideMissionRobotVO(t[i]);this.guideMissionRobotTemplate[n.map]=this.guideMissionRobotTemplate[n.map]||{},this.guideMissionRobotTemplate[n.map][n.group]=this.guideMissionRobotTemplate[n.map][n.group]||[],this.guideMissionRobotTemplate[n.map][n.group].push(n)}},t.prototype.initGuideMissionMainCityRobot=function(t){this.guideMissionMainCityRobotTemplate={};for(var i=0;i<t.length;i++){var n=new e.GuideMissionMainCityRobotVO(t[i]);this.guideMissionMainCityRobotTemplate[n.group]=this.guideMissionMainCityRobotTemplate[n.group]||[],this.guideMissionMainCityRobotTemplate[n.group].push(n)}},t.prototype.initMainSceneNpc=function(t){this.mainSceneNpcTemplate=[];for(var i=0;i<t.length;i++){var n=new e.MainSceneNpcVO(t[i]);this.mainSceneNpcTemplate.push(n)}e.MapViewportGroupManager.instance.sceneView.createNpc()},t.prototype.initMonstertalk=function(t){for(var i=0;i<t.length;i++){var n=new e.MonstertalkVO(t[i]);this.monstertalkTemplate[n.mapId]=n}},t.prototype.initWanbaShareInTemplate=function(t){var i,n,o=t.length;this.WanbaShareInTemplate={};for(var a=0;o>a;a++){i=t[a],n=new e.WanbaShareInVO,n.shareInCount=Number(i.shareInCount),n.id=Number(i.id);for(var s=i.award.split(","),r=void 0,l=0;l<s.length;l++)s[l]&&(r=new e.AttributeVO(s[l]),n.award.push(r));this.WanbaShareInTemplate[n.shareInCount]=n}},t}();e.JsonDataManager=t,__reflect(t.prototype,"foxgame.JsonDataManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.loadList=[]}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.isResLoaded=function(e){return RES.getRes(e)},t.prototype.isResLoadeds=function(e,t){for(var i=1;t>=i;i++)for(var n=1;t>=n;n++)if(!RES.getRes(e+"_"+i+"_"+n+"_jpg"))return!1;return!0},t.prototype.loadGroupComplete=function(e){this.compFunc(null,e)},t.prototype.loadTileMapPicRes=function(t){var i=t,n=e.Global.LoadMapBattleScenePicPriority;t.indexOf("Scene_new_")>-1&&(n=e.Global.LoadMapMainScenePicPriority),RES.createGroup(t,[i],!0),App.getResourceUtils().loadGroup(t,this.loadGroupComplete,null,this,n)},t.prototype.destroyMapPicRes=function(t){try{RES.isGroupLoaded(t)&&e.GlobalUtil.destroyRes(t)}catch(i){}},t.prototype.setImage=function(t){t.image.source&&"string"==typeof t.image.source;var i=t.image.name;t.image.name=t.name,t.image.source=t.name,t.image.visible=!0,i&&""!=i&&i!=t.name&&RES.isGroupLoaded(i)&&e.GlobalUtil.destroyRes(i)},t.prototype.setImageAsync=function(e){try{if(!e||!e.name)return;var t=this.loadList.indexOf(e);0>t&&(this.loadList.push(e),this.loadTileMapPicRes(e.name))}catch(i){Log.trace("exception: "+i.toString()),console.error(i)}},t.prototype.compFunc=function(e,t){for(var i=this.loadList.length,n=0;i>n;){var o=this.loadList[n];if(o.name!=t)n++;else{this.setImage(o);var a=this.loadList.splice(n,1);a=null,i--}}},t.prototype.removeFromLoadList=function(e){var t=this.loadList.indexOf(e);t>=0&&this.loadList.splice(t,1)},t}();e.LoadMapPicManager=t,__reflect(t.prototype,"foxgame.LoadMapPicManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.beauty=null,this.monster1=null,this.monster2=null}return e.prototype.destroy=function(){this.beauty&&(this.beauty=null),this.monster1&&(this.monster1=null),this.monster2&&(this.monster2=null)},e.prototype.delayMovePos=function(e){this.beauty&&this.beauty.delayMovePos(e),this.monster1&&this.monster1.delayMovePos(e),this.monster2&&this.monster2.delayMovePos(e)},e}();__reflect(t.prototype,"PetGroup");var i=function(){function i(){this.mainPetRole=new t,this.m_frameTime=0,this.canUpdate=!1,this.resultData=null,this.skillTestId=null,this.skillTestPosX=null,this.skillTestPosY=null,this.skillTestPosition=null,this.mDestMarkNode=null,this.mDestMark=null,this.waitNode=new egret.DisplayObjectContainer,this.mainRoleUseSkillTimes=0,this.mainRoleUseSkillCD=1500,this.canMoveBg=!0,this.followRectW=200,this.followRectH=500,this.lastMvCenterX=0,this.lastMvCenterY=0,this.showOnce=!1,e.MapViewportGroupManager.instance.mapGroup.addChild(this.waitNode)}return Object.defineProperty(i,"instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.init=function(){return this.canUpdate?void(e.MapViewportGroupManager.instance.mapView&&null==e.MapViewportGroupManager.instance.mapView.mainTiledMap&&this.resultData&&(e.MapViewportGroupManager.instance.mapView.mainTiledMap=new e.TiledMap(this.resultData))):(StageFrameControl.instance.setScrollEnabled(!1),this.followRectW=Math.floor(.48*ScreenAdaptation.instance.mapWidth),this.followRectH=Math.floor(.48*ScreenAdaptation.instance.mapHeight),this.mainOtherRole=new e.HashMap,this.mainOtherPetRole=new e.HashMap,App.getResourceUtils().getResAsync("MainSceneMap",this.onRes,this),e.MapViewportGroupManager.instance.mapView.getMainMapMohuSuoLueTu(),e.Global.rootScroller.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.unlock,this),void e.Global.rootScroller.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this))},i.prototype.onRes=function(t){e.MapViewportGroupManager.instance.mapView?e.MapViewportGroupManager.instance.mapView.mainTiledMap=new e.TiledMap(t):this.resultData=t,this.canUpdate=!0},i.prototype.clear=function(){this.canUpdate=!1,this.mainRole.destroy(),this.mainRole=null;for(var e=0;e<this.mainOtherRole.keys.length;e++)this.mainOtherRole.get(this.mainOtherRole.keys[e]).destroy();this.mainOtherRole.clear(),this.mainPetRole.destroy();for(var e=0;e<this.mainOtherPetRole.keys.length;e++)this.mainOtherPetRole.get(this.mainOtherPetRole.keys[e]).destroy();this.mainOtherPetRole.clear()},i.prototype.onUpdate=function(t){if(0!=this.canUpdate){if(1==e.MainBottomControler.PageState){var n=StageFrameControl.instance.getScrollViewport();n.anchorOffsetX=0,n.anchorOffsetY=0}if(this.mainRole){if(e.MapSceneService.instance.mainPlayerData.InfoChange&&(e.MapSceneService.instance.mainPlayerData.EquipInfoChange?(this.mainRole.changeActionController(this.mainRole,e.MapSceneService.instance.mainPlayerData.playerInfo),this.mainRole.setHpWidget(e.MapSceneService.instance.mainPlayerData.playerInfo),this.refreshPet(e.MapSceneService.instance.mainPlayerData)):e.MapSceneService.instance.mainPlayerData.haloChange?(this.mainRole.changehalo(),e.MapSceneService.instance.mainPlayerData.haloChange=!1):e.MapSceneService.instance.mainPlayerData.armorHaloChange?(this.mainRole.changeArmorHalo(),e.MapSceneService.instance.mainPlayerData.armorHaloChange=!1):this.mainRole.showPlayerBasicInfo(this.mainRole,e.MapSceneService.instance.mainPlayerData.playerInfo),e.MapSceneService.instance.mainPlayerData.InfoChange=!1),-1==e.Global.firstvipLevel)e.Global.firstvipLevel=e.PlayerService.instance.playerInfo.getVipLevel();else{var o=e.PlayerService.instance.playerInfo.getVipLevel();e.Global.firstvipLevel!=o&&(e.Global.firstvipLevel=o,this.mainRole.showPlayerBasicInfo(this.mainRole,e.MapSceneService.instance.mainPlayerData.playerInfo))}this.mainRole.mActionController&&this.mainRole.mActionController.desAction!=e.EnumManager.ACTION_TYPE.ACTION_RUN&&null!=this.mDestMarkNode&&null!=this.mDestMark&&(this.mDestMark.stop(),this.mDestMarkNode.visible=!1),null!=this.mainRole&&this.mainRole.Excecute()}else if(e.MapSceneService.instance.mainPlayerData){var a=e.CommonUtils.randomPeopleMainSceneClientBornPos();this.mainRole=new e.People(e.MapViewportGroupManager.instance.sceneView.MainScenePeopleNode,e.MapSceneService.instance.mainPlayerData,a,!0,e.MapViewportGroupManager.instance.sceneView.MSceneSkillNode,e.MapViewportGroupManager.instance.mapView.mainTiledMap),e.Message.instance.send(e.MsgCMD.MAINCITY_MAINROLE_CREATE,this),1==e.MainBottomControler.PageState&&this.setScrollCenterToPeople(this.mainRole),egret.Tween.get(this.waitNode).wait(2e3).call(function(){try{this.refreshPet(e.MapSceneService.instance.mainPlayerData)}catch(t){egret.warn("延迟加载神兽宠物失败"),console.error(t)}},this)}if(0==this.getNotShowOtherPeopleFlag()){var s=egret.getTimer();if(s-this.m_frameTime>1e3){this.m_frameTime=s;for(var r=0;r<e.MapSceneService.instance.otherPlayerRenderQueue.length;r++){var l=e.MapSceneService.instance.otherPlayerRenderQueue[r];if(null==e.MapSceneService.instance.otherPlayerDatas.get(l))e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("no this people data");else{var h=e.MapSceneService.instance.otherPlayerDatas.get(l),c=this.mainOtherRole.get(l);if(null==c){var u=e.CommonUtils.randomModelObjectOneDirection(),p=new e.People(e.MapViewportGroupManager.instance.sceneView.MainScenePeopleNode,h,h.curPos,!1,e.MapViewportGroupManager.instance.sceneView.MSceneSkillNode,e.MapViewportGroupManager.instance.mapView.mainTiledMap);p.mActionController&&p.mActionController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_IDLE,u),this.mainOtherRole.put(l,p),egret.Tween.get(this.waitNode).wait(2e3).call(function(e){try{this.refreshPet(e)}catch(t){Log.trace("延迟加载其他玩家的神兽宠物失败"),console.error(t)}},this,[h])}}}}for(var r=0;r<e.MapSceneService.instance.otherPlayerRenderQueue.length;r++){var g=e.MapSceneService.instance.otherPlayerRenderQueue[r];if(null==e.MapSceneService.instance.otherPlayerDatas.get(g))e.Global.logLevel>e.Global.logLevelInfo&&Log.trace(g+"hava no data");else{var h=e.MapSceneService.instance.otherPlayerDatas.get(g),d=i.instance.mainOtherRole.get(g),f=i.instance.mainOtherPetRole.get(g);if(null!=d){if(d.initModel(),null!=h.tarPos&&h.tarPos.getX()>0&&h.tarPos.getY()>0){var m=new egret.Point(h.tarPos.getX(),h.tarPos.getY());d.MovePos(m),f&&f.delayMovePos(m);var y=e.MapSceneService.instance.otherPlayerDatas.remove(g);y=null,h.tarPos=null,e.MapSceneService.instance.otherPlayerDatas.put(g,h)}1==h.InfoChange&&(h.EquipInfoChange?(d.changeActionController(d,h.playerInfo),this.refreshPet(h)):d.showPlayerBasicInfo(d,h.playerInfo),h.InfoChange=!1),d.Excecute()}}}}for(var I=e.MapViewportGroupManager.instance.sceneView.MainScenePeopleNode,v=I.numChildren,r=0;v>r;++r){var _=I.getChildAt(r);if(_.name){var T=_.name.indexOf("pet_");if(0==T){var C=_.name.substring(4);if((null==this.mainOtherPetRole.get(C)||null==this.mainOtherRole.get(C))&&e.MapSceneService.instance.mainPlayerData.playerInfo.getPlayerId().toString()!=C){I.removeChildAt(r);break}}}}}},i.prototype.getNotShowOtherPeopleFlag=function(){return null!=e.PlayerService.instance.playerStateInfo,!1},i.prototype.initMainPeople=function(){},i.prototype.onChoosePlayer=function(t){if(e.MapSceneService.instance.mainPlayerData.playerId==t){var i=e.MapSceneService.instance.mainPlayerData.playerInfo.getRoleItemId(),n=e.CommonUtils.getProfessionIdByRoleItemId(i),o=e.MapSceneService.instance.mainPlayerData.playerInfo.getPlayerLevel();e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("我使用buff技能"),this.mainRoleUseSkill(t,!1,n,o)}else if(null==this.mainOtherRole.get(t))e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("no player");else{var i=(this.mainOtherRole.get(t),e.MapSceneService.instance.mainPlayerData.playerInfo.getRoleItemId()),n=e.CommonUtils.getProfessionIdByRoleItemId(i),o=e.MapSceneService.instance.mainPlayerData.playerInfo.getPlayerLevel();e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("我向别人使用技能"),this.mainRole.StopTW(),this.mainRoleUseSkill(t,!0,n,o)}},i.prototype.mainRoleUseSkill=function(t,i,n,o){if(!(egret.getTimer()-this.mainRoleUseSkillTimes<this.mainRoleUseSkillCD)){this.mainRoleUseSkillTimes=egret.getTimer();var a=0;if(a=this.skillTestId,null!=a&&0!=a||(a=i?e.CommonUtils.randomAttackSkillByOccuAndLevel(n,o):e.CommonUtils.randomDefenceSkillByOccuAndLevel(n,o)),0!=a&&null!=a){var s=e.JsonDataManager.instance.skillTemplate,r=s[a],l=HawkProtocolManager.newBuilder("JsProto.HPMapPlayerVisit");l.setVisitType(1),l.setTargetId(t);var h=[parseInt(r.skillType),parseInt(r.level)];l.setParams(h),e.Message.instance.send(e.Code.MAP_PLAYER_VISIT,l,!0)}}},i.prototype.resetMapPosToCenter=function(t){void 0===t&&(t=0);var i=ScreenAdaptation.instance.mapWidth,n=ScreenAdaptation.instance.mapHeight;0!=t&&(n=3*n/4,i/=2);var o=new egret.Point(i/2,n/2),a=e.MapViewportGroupManager.instance.rootGroup.globalToLocal(o.x,o.y),s=new egret.Point(this.mainRole.x,this.mainRole.y),r=!1,l=new egret.Point(a.x-s.x,a.y-s.y);egret.Point.distance(a,s)<1&&(r=!0);new egret.Point(e.MapViewportGroupManager.instance.rootGroup.scrollH,e.MapViewportGroupManager.instance.rootGroup.scrollV);l=this.clampMapPos(l)},i.prototype.clampMapPos=function(t){new egret.Point(0,0),new egret.Point(e.MapViewportGroupManager.instance.rootGroup.contentWidth-ScreenAdaptation.instance.mapWidth,e.MapViewportGroupManager.instance.rootGroup.contentHeight-ScreenAdaptation.instance.mapHeight)},i.prototype.removeFromPlayerId=function(e){var t=this.mainOtherRole.get(e);t&&t.destroy(),t=null;var i=this.mainOtherRole.remove(e);i=null},i.prototype.setScrollCenterToPeople=function(e){var t=e.x,i=e.y,n=StageFrameControl.instance.getScrollViewport(),o=ScreenAdaptation.instance.mapWidth,a=ScreenAdaptation.instance.mapHeight,s=t-o/2,r=i-a/2;s>n.contentWidth-o?s=n.contentWidth-o:0>s&&(s=0),r>n.contentHeight-a?r=n.contentHeight-a:0>r&&(r=0),n.scrollH=s,n.scrollV=r},i.prototype.onReceivePlayerCastSkill=function(t){if(2!=e.MainBottomControler.PageState&&null!=t){var i=t.getAttacker(),n=t.getTargetId(),o=t.getSkillId();this.otherPlayerUseSkill(i,n,o)}},i.prototype.onReceivePlayerCastBuff=function(t){if(2!=e.MainBottomControler.PageState&&null!=t){var i=t.getPlayerId(),n=t.getBuffId();this.otherPlayerUseBuff(i,n)}},i.prototype.otherPlayerUseSkill=function(e,t,i){if(null!=this.mainOtherRole.get(e)&&this.mainRole.playerInfo.playerId!=e){var n=[],o=null;if(this.mainRole.playerInfo.playerId==t)o=this.mainRole;else{if(null==this.mainOtherRole.get(t))return;o=this.mainOtherRole.get(t)}n.push(o);var a=this.mainOtherRole.get(e);a.stopMove()}},i.prototype.otherPlayerUseBuff=function(e,t){null!=this.mainOtherRole.get(e)&&this.mainOtherRole.get(e).showBuff(t)},i.prototype.setMainBG=function(){},i.prototype.mainRoleLvlUp=function(){null!=this.mainRole&&e.EffectUtils.playUnitLevelUp(this.mainRole)},i.prototype.mainRoleRef=function(){e.MapSceneService.instance.mainPlayerData.playerInfo.setPlayerLevel(50),this.mainRole.showPlayerBasicInfo(this.mainRole,e.MapSceneService.instance.mainPlayerData.playerInfo)},i.prototype.moveBG=function(){if(1==e.MainBottomControler.PageState||!this.mainRole){var t=e.Global.mainMapWidth/2,i=e.Global.mainMapHeight/2;null!=this.mainRole&&(t=this.mainRole.x,i=this.mainRole.y);var n=new egret.Point;n.x=t,n.y=i;var o=StageFrameControl.instance.getScrollViewport(),a=ScreenAdaptation.instance.mapWidth,s=ScreenAdaptation.instance.mapHeight;t<o.scrollH+this.followRectW?o.scrollH=t-this.followRectW:t>o.scrollH+(a-this.followRectW)&&(o.scrollH=t-(a-this.followRectW)),i<o.scrollV+this.followRectH?o.scrollV=i-this.followRectH:i>o.scrollV+(s-this.followRectH)&&(o.scrollV=i-(s-this.followRectH)),o.scrollH>e.Global.mainMapWidth-a?o.scrollH=e.Global.mainMapWidth-a:o.scrollH<0&&(o.scrollH=0),o.scrollV>e.Global.mainMapHeight-s?o.scrollV=e.Global.mainMapHeight-s:o.scrollV<0&&(o.scrollV=0),e.MapViewportGroupManager.instance.mapView.onMoveMainCityMapPic(n)}},i.prototype.touchBegin=function(){this.moveBeginTime=egret.getTimer()},i.prototype.unlock=function(){egret.getTimer()-this.moveBeginTime>500&&1==e.MainBottomControler.PageState&&this.canMoveBg&&(this.canMoveBg=!1)},i.prototype.showHideMainSceneObjects=function(t){e.MapViewportGroupManager.instance.sceneView.MainRoot.visible=t},i.prototype.refreshMainRoleDuanTitle=function(){this.mainRole&&this.mainRole.setDuanWeiTitle(e.MapSceneService.instance.mainPlayerData.playerInfo)},i.prototype.refreshPet=function(i){var n=null,o=i.playerId,a={x:0,y:0};if(a.x=i.curPos.getX(),a.y=i.curPos.getY(),o==e.PlayerService.instance.playerInfo.getPlayerId())n=this.mainPetRole,a.x=this.mainRole.curPos.x,a.y=this.mainRole.curPos.y;else{n=this.mainOtherPetRole.get(o),n||(n=new t,this.mainOtherPetRole.put(o,n));var s=this.mainOtherRole.get(o);s&&(a.x=s.curPos.x,a.y=s.curPos.y)}var r=e.MapViewportGroupManager.instance.sceneView.MainScenePeopleNode,l=e.MapViewportGroupManager.instance.sceneView.MSceneSkillNode,h=e.MapViewportGroupManager.instance.mapView.mainTiledMap,c=[];c.push({key:"beauty",itemId:i.playerInfo.getPetCurrentId()||0,name:"妖姬"}),c.push({key:"monster1",itemId:i.playerInfo.getMcId1()||0,name:"神兽"}),c.push({key:"monster2",itemId:i.playerInfo.getMcId2()||0,name:"神兽"});for(var u=0;u<c.length;u++){var p=c[u].itemId,g=c[u].key,d=c[u].name,f=n[g];if(p>0){f?f.changeActionController(p):(f=new e.PetPeople({parentNode:r,playerId:i.playerId,ownerName:i.playerInfo.getPlayerName(),petName:d,itemId:p,curPos:a,sceneContainer:l,tileMap:h}),a.x++,a.y++,n[g]=f);var m=e.CommonUtils.randomModelObjectOneDirection();f.mActionController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_IDLE,m)}else f&&(f.destroy(),n[g]=null)}},i}();e.MainSceneManager=i,__reflect(i.prototype,"foxgame.MainSceneManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=e.MsgCMD,i=function(i){function n(){var e=i.call(this)||this;return e._doAddDrawMainSceneMap=!1,e._doAddDrawBattleSceneMap=!1,e._stopUpdateOldMainCity=!1,e._stopUpdateOldBattle=!1,e.isNetworkLoginedGameSvrOk=!1,e.iLastHeartBeatCheckTimestamp=0,e}return __extends(n,i),Object.defineProperty(n,"instance",{get:function(){return this._instance||(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.init=function(i,o,a){this._rootGroup=a,this._sceneGroup=i,this._mapGroup=o,this.timer=new egret.Timer(n.mapViewTicker),e.Message.instance.add(t.Login_Success_Msg,this)},Object.defineProperty(n.prototype,"sceneGroup",{get:function(){return this._sceneGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mapGroup",{get:function(){return this._mapGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rootGroup",{get:function(){return this._rootGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mapView",{get:function(){return this._mapView},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sceneView",{get:function(){return this._sceneView},enumerable:!0,configurable:!0}),n.prototype.initMap=function(){if(!this._mapView){this.timer.addEventListener(egret.TimerEvent.TIMER,this.onUpdate,this),this.timer.start();var i=this.rootGroup.parent;i.bounces=!1,i.throwSpeed=.2,this._mapView=new e.MapView,this._mapGroup.addChild(this._mapView),this._sceneView=new e.SceneView,this._sceneGroup.touchThrough=!1,this._sceneGroup.touchEnabled=!1,this._sceneView.touchEnabled=!1,this._sceneGroup.addChild(this._sceneView),e.Message.instance.add(t.MainOrBattleSceneObjectsHide,this),e.Message.instance.add(t.MainOrBattleSceneObjectsShow,this),e.Message.instance.add(t.SwitchSceneType_Msg,this),e.Message.instance.add(t.NetWork_Closed_Msg,this),e.MainSceneManager.instance.init(),e.BattleScene.instance.initTiledMap(),e.Message.instance.send(t.SwitchSceneType_Msg,e.SceneType.Field)}},n.prototype.recvMsg=function(i,n){if(i==t.Login_Success_Msg)this.isNetworkLoginedGameSvrOk=!0;else if(i==t.NetWork_Closed_Msg)this.isNetworkLoginedGameSvrOk=!1;else if(i==t.MainOrBattleSceneObjectsHide){var o=n;o!=e.MainControler.instance&&o.width>=400&&o.height>=500&&(this.sceneView.showHideMainOrBattleSceneObjects(!1),e.Message.instance.send(t.UICanHideSomethingForDrawLess,n))}else i==t.MainOrBattleSceneObjectsShow?(this.sceneView.showHideMainOrBattleSceneObjects(!0),e.Message.instance.send(t.UIRestoreHideSomethingForDrawLess,n)):i==t.SwitchSceneType_Msg&&this.sceneView.switchPageShowHideType(n)},n.prototype.setStopUpdateOldMainCity=function(e){this._stopUpdateOldMainCity=e},n.prototype.setStopUpdateOldBattle=function(e){this._stopUpdateOldBattle=e},n.prototype.doDestroyOldMainCityMap=function(){e.CommonUtils.destroyMainMapPic(n.instance.mapView),n.instance.sceneView.hideAndUnloadNpc()},n.prototype.doRestoreOldMainCityMap=function(){n.instance.sceneView.loadAndShowNpc()},n.prototype.doDestroyOldBattleMap=function(){e.CommonUtils.destroyBattleMapPic(n.instance.mapView,n.instance.mapView.getOldBattleBgStr(),n.instance.mapView.getOldMapVoObj())},n.prototype.doRestoreOldBattleMap=function(){},n.prototype.doDestroyOldMainCityObjects=function(){e.MapSceneService.instance.forceHideMainPlayerRoleMainScene(),e.MapSceneService.instance.forceHideOtherPlayerMainScene()},n.prototype.doRestoreOldMainCityObjects=function(){e.MapSceneService.instance.forceShowChangeMainPlayer(),e.MapSceneService.instance.forceShowChangeOtherPlayer()},n.prototype.doDestroyOldBattleObjects=function(){e.BattleScene.instance.destroyNpcPlayerMonster()},n.prototype.doRestoreOldBattleObjects=function(){e.BattleScene.instance.restoreNpcPlayerMonster()},n.prototype.setOldMainCityRootVisible=function(e){this.mapView.mMainGroup.visible=e,this.sceneView.MainRoot.visible=e},n.prototype.setOldBattleRootVisible=function(e){this.mapView.mBattleGroup.visible=e,this.sceneView.BattleRoot.visible=e},n.prototype.drawTile=function(){},n.prototype.clear=function(){this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onUpdate,this),this.timer.stop(),this._mapView.clear(),this._sceneView.clear(),e.MainSceneManager.instance.clear(),e.MainSceneManager.instance.clear()},n.prototype.onUpdate=function(t){this.isNetworkLoginedGameSvrOk,this._mapView.width<this._mapView.stage.stageWidth||this._mapView.height<this._mapView.stage.stageHeight?(this._mapView.onUpdate(!0),this._sceneView.onUpdate(!0)):(this._mapView.onUpdate(!1),this._sceneView.onUpdate(!1)),this._stopUpdateOldBattle||e.BattleScene.instance.onUpdate(t),this._stopUpdateOldMainCity||e.MainSceneManager.instance.onUpdate(t),0==this._doAddDrawMainSceneMap&&e.MainSceneManager.instance.canUpdate&&(this._doAddDrawMainSceneMap=!0,e.Global.isRelease||this._mapView.drawMainTile()),0==this._doAddDrawBattleSceneMap&&(this._doAddDrawBattleSceneMap=!0,e.Global.isRelease||this._mapView.drawBattleTile())},n.mapViewTicker=1e3/30,n}(egret.HashObject);e.MapViewportGroupManager=i,__reflect(i.prototype,"foxgame.MapViewportGroupManager",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;i.skinName=t;var n=t.lastIndexOf("/"),o=t;return n>0&&(o=t.substr(n+1).toLowerCase(),o=o.replace(".exml","")),i.name=o,i}return __extends(t,e),t.prototype.setBackFun=function(e){this.backFun=e,this.backFun&&this.skinName&&this.backFun()},t.prototype.skinComplete=function(e,t){void 0===t&&(t=null)},t}(eui.Component);e.BaseComponent=t,__reflect(t.prototype,"foxgame.BaseComponent")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.clsMap=new e.HashMap,this.moduleMap=new e.HashMap,e.Message.instance.add(e.MsgCMD.MODULE_SHOW,this),e.Message.instance.add(e.MsgCMD.MODULE_CLOSE,this),e.Message.instance.add(e.MsgCMD.MODULE_DISPOSE,this),e.Message.instance.add(e.MsgCMD.CHECK_SOUND,this),e.Message.instance.add(e.Code.LOGIN_S,this),e.Message.instance.add(e.Code.PLAYER_KICKOUT_S,this),e.Message.instance.add(e.MsgCMD.Regist_Window_Class,this),this.initCls()}return t.prototype.registCls=function(e,t){this.clsMap.put(e,t)},t.prototype.initCls=function(){this.clsMap.put(e.WindowName.LOADING,"foxgame.LoadingControler"),this.clsMap.put(e.WindowName.LOGIN,"foxgame.LoginControler"),this.clsMap.put(e.WindowName.MAIN,"foxgame.MainControler"),this.clsMap.put(e.WindowName.CREATE,"foxgame.CreateControler"),this.clsMap.put(e.WindowName.SELECTSERVER,"foxgame.SelectServerControler"),this.clsMap.put(e.WindowName.SHOP_MAIN,"foxgame.NewShopMainControler"),this.clsMap.put(e.WindowName.NEW_SHOPBUY,"foxgame.NewShopBuyCountControler"),this.clsMap.put(e.WindowName.RAID_MAIN,"foxgame.RaidMainControler"),this.clsMap.put(e.WindowName.PACKAGE_SELL_EQUIPS,"foxgame.PackageSellEquipsControler"),this.clsMap.put(e.WindowName.FIGHTMAP,"foxgame.FightMapControler"),this.clsMap.put(e.WindowName.JUEWEI,"foxgame.JueweiMainControler"),this.clsMap.put(e.WindowName.DAILYDUNGEON,"foxgame.DailyDungeonControler"),this.clsMap.put(e.WindowName.GEMDUNGEON,"foxgame.GemDungenControler"),this.clsMap.put(e.WindowName.FEATHERDUNGEON,"foxgame.FeatherDungenControler"),this.clsMap.put(e.WindowName.PRERINGDUNGEON,"foxgame.PreRingDungenControler"),this.clsMap.put(e.WindowName.EQUIP_INFO,"foxgame.CharacterEquipInfoController"),this.clsMap.put(e.WindowName.COMMANDTOOLS,"foxgame.CommandToolsController"),this.clsMap.put(e.WindowName.FIGHTOFFLINE,"foxgame.FightOffLineControler"),this.clsMap.put(e.WindowName.WEAPON_SMELT,"foxgame.WeaponSmeltManager"),this.clsMap.put(e.WindowName.WING_SYSTEM_BUY_ITEM,"foxgame.WingBuyItemPanel"),this.clsMap.put(e.WindowName.EQUIP_SELECT,"foxgame.EquipSelectControler"),this.clsMap.put(e.WindowName.EQUIP_SELECT_MULTIPLE,"foxgame.EquipSelectMultipleControler"),this.clsMap.put(e.WindowName.ACTIVITY_CONTENT,"foxgame.ActivityContentControler"),this.clsMap.put(e.WindowName.HELP_MAIN,"foxgame.HelpControler"),this.clsMap.put(e.WindowName.HELP_TIP,"foxgame.HelpTipControler"),this.clsMap.put(e.WindowName.ITEM_INFO,"foxgame.ItemInfoControler"),this.clsMap.put(e.WindowName.GEM_UPGRADE,"foxgame.GemUpgradeControler"),this.clsMap.put(e.WindowName.EQUIP_EXTEND,"foxgame.EquipExtendControler"),this.clsMap.put(e.WindowName.EQUIP_FUSION,"foxgame.EquipFusionControler"),this.clsMap.put(e.WindowName.PROF_RANK,"foxgame.ProfRankControler"),this.clsMap.put(e.WindowName.ARENA_RECORD,"foxgame.ArenaRecordControler"),this.clsMap.put(e.WindowName.COMPOUND_BOOK,"foxgame.RankUpBookCompoundControler"),this.clsMap.put(e.WindowName.MERCENARY_RANK_UP,"foxgame.MercenaryRankUpControler"),this.clsMap.put(e.WindowName.MERCENARY_AURA,"foxgame.MercenaryAuraControler"),this.clsMap.put(e.WindowName.TEAM_BATTLE,"foxgame.TeamBattleControler"),this.clsMap.put(e.WindowName.TEAM_BATTLE_MANAGE,"foxgame.TeamBattleManageControler"),this.clsMap.put(e.WindowName.EQUIP_SELECT_SWALLOW,"foxgame.EquipSelectSwallowControler"),this.clsMap.put(e.WindowName.ACTIVITY_DOUBLE_PAY,"foxgame.DoublePayControler"),this.clsMap.put(e.WindowName.ACTIVITY_EXPEDITION_RANK,"foxgame.ActivityExpeditionRankPanel"),this.clsMap.put(e.WindowName.ACTIVITY_EXPEDITION_DONATE,"foxgame.ActivityExpeditionDonatePanel"),this.clsMap.put(e.WindowName.DOUBLE_SELECT,"foxgame.DoublePaySelectControler"),this.clsMap.put(e.WindowName.FIGHTREWARD,"foxgame.FightRewardControler"),this.clsMap.put(e.WindowName.WORDS_EXCHANGE,"foxgame.WordsExchangeControler"),this.clsMap.put(e.WindowName.BOSS_MAIN,"foxgame.NewBossMainControler"),this.clsMap.put(e.WindowName.BOSS_HOME_MAIN,"foxgame.NewBossHomeMainControler"),this.clsMap.put(e.WindowName.BOSS_ITEM_FIGHTDETAIL,"foxgame.NewBossFightDetailItemControler"),this.clsMap.put(e.WindowName.WORLD_BOSS_FINAL,"foxgame.WorldBossFinalPage"),this.clsMap.put(e.WindowName.FIGHTPKCONTROLER,"foxgame.FightPKControler"),this.clsMap.put(e.WindowName.FIGHTLOSECONTROLER,"foxgame.CommonFailUI"),this.clsMap.put(e.WindowName.FIGHTRESULTWIN,"foxgame.DailyDungeonResultWin"),this.clsMap.put(e.WindowName.FIGHTBOSSRESULTWIN,"foxgame.BossFightResultWin"),this.clsMap.put(e.WindowName.GEM_PROGRESS,"foxgame.GemProgressView"),this.clsMap.put(e.WindowName.AC_CUMULATIVE_RECHARGE,"foxgame.AccumulativeRechargeControler"),this.clsMap.put(e.WindowName.NEW_AREA_UI,"foxgame.AreaMainUI"),this.clsMap.put(e.WindowName.NEW_AREA_RANK_UI,"foxgame.ArenaRankUI"),this.clsMap.put(e.WindowName.NEW_AREA_LOG_UI,"foxgame.AreaLogUI"),this.clsMap.put(e.WindowName.NEW_AREN_SHAOP_UI,"foxgame.ArenShopUI"),this.clsMap.put(e.WindowName.COMMON_HELP_UI,"foxgame.CommonHelpUI"),this.clsMap.put(e.WindowName.PURE_TEXT_TIPS,"foxgame.PureTextTips"),this.clsMap.put(e.WindowName.PURE_TEXT_TIPS2,"foxgame.PureTextTips2")},t.prototype.recvMsg=function(t,i){t==e.MsgCMD.MODULE_SHOW?this.onShow(i):t==e.MsgCMD.MODULE_CLOSE?this.onClose(i):t==e.MsgCMD.MODULE_DISPOSE?this.onDispose(i):t==e.Code.LOGIN_S?e.Message.instance.send(e.MsgCMD.Login_Success_Msg):t==e.Code.PLAYER_KICKOUT_S?(e.Global.isKickOut=!0,this.playerKickOut(i)):t==e.MsgCMD.CHECK_SOUND?this.checkSound(i):t==e.MsgCMD.Regist_Window_Class&&this.registCls(i.winname,i.clsname)},t.prototype.playerKickOut=function(t){var n="";switch(t.reason){case i.DUPLICATE_LOGIN:n="@DuplicateLogin";break;case i.SERVER_SHUTDOWN:n="@ServerShutDown";break;case i.LOGIN_FORBIDEN:n="@LoginForbiden";break;case i.KICKED_OUT:n="@HasKickedOut"}if("@HasKickedOut"==n)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("JSJC_TIRENGXT"),null,null,null,null,null,null,null,20,!1);if(n){var o=e.LanguageUtils.instance.getValue("ACCOUNTKICKOUT");e.PopUpController.getInstance().showTextPanel(o,this,this.relogin)}},t.prototype.relogin=function(){e.LoginController.instance.connectServer()},t.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e.UserInfo.init(),[4,e.Message.instance.initProtocol()];case 1:return t.sent(),e.MessageManager.instance.registerMessage(),e.LoginController.instance.showLoginPanel(),e.MainControler.instance.initMsg(),[2]}})})},t.prototype.gameData=function(){},t.prototype.checkSound=function(t){var i=e.PlayerService.instance.playerStateInfo;if(i)1==(1&t)&&(i.getMusicOn()?e.SoundManager.instance.play("general",e.Global.MAX_INT,!0):e.SoundManager.instance.remove("general",!0),isLocalStorage()&&egret.localStorage.setItem("gjgame_music",i.getMusicOn().toString())),2==(2&t)&&(i.getSoundOn()||e.SoundManager.instance.remove("click"),isLocalStorage()&&egret.localStorage.setItem("gjgame_sound",i.getSoundOn().toString()));else{var n=isLocalStorage()?egret.localStorage.getItem("gjgame_music"):"1";n=n?n:"1",n="2","1"==n?e.SoundManager.instance.play("general",e.Global.MAX_INT,!0):e.SoundManager.instance.remove("general",!0);var o=isLocalStorage()?egret.localStorage.getItem("gjgame_sound"):"1";o=o?o:"1","0"==o&&e.SoundManager.instance.remove("click")}},t.prototype.checkSound2=function(e){this.checkSound(e)},t.prototype.onShow=function(t){var i,n=null;t.hasOwnProperty("windowName")?(i=t.windowName,t.hasOwnProperty("data")&&(n=t.data)):i=t.toString();
var o=this.moduleMap.get(i);if(!o){var a=this.clsMap.get(i);if(a)if(i==e.WindowName.MAIN)e.MainControler.instance.create(),o=e.MainControler.instance,o&&this.moduleMap.put(i,o);else{var s=egret.getDefinitionByName(a);s&&(o=new s,o&&this.moduleMap.put(i,o))}}o&&(n?o.show(n):o.show())},t.prototype.onClose=function(e){var t=e.toString(),i=this.moduleMap.get(t);i&&i.close()},t.prototype.onDispose=function(t){var i=t.toString(),n=this.moduleMap.remove(i);n=null,e.PopUpManager.instance.removePopUp(i),e.PopUpManager.instance.removeWindow(i)},t}();e.MainModule=t,__reflect(t.prototype,"foxgame.MainModule",["foxgame.IMessage"]);var i;!function(e){e[e.DUPLICATE_LOGIN=1]="DUPLICATE_LOGIN",e[e.SERVER_SHUTDOWN=2]="SERVER_SHUTDOWN",e[e.LOGIN_FORBIDEN=3]="LOGIN_FORBIDEN",e[e.KICKED_OUT=4]="KICKED_OUT",e[e.SERVER_RESTART=5]="SERVER_RESTART"}(i=e.kickReason||(e.kickReason={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.TREASURE_HUNT=76]="TREASURE_HUNT",e[e.JUBAOPEN=37]="JUBAOPEN",e[e.TONGJINZHU=38]="TONGJINZHU",e[e.ZAJINDAN=39]="ZAJINDAN",e[e.HUIKUI=46]="HUIKUI",e[e.ZHAUNPAN=24]="ZHAUNPAN",e[e.DAFUWENG=71]="DAFUWENG",e[e.RECHARGE_REBATE=72]="RECHARGE_REBATE",e[e.ZEROPACKAGE=73]="ZEROPACKAGE",e[e.WB_ADD_RECHARGE=77]="WB_ADD_RECHARGE",e[e.WB_ADD_LOGIN=78]="WB_ADD_LOGIN",e[e.XUNBAOZHEKOU=79]="XUNBAOZHEKOU",e[e.ADVERTISING=80]="ADVERTISING",e[e.MEIRICHONGZHI=81]="MEIRICHONGZHI",e[e.KUAFUCHONGZHI=92]="KUAFUCHONGZHI",e[e.KUAFUXIAOFEI=93]="KUAFUXIAOFEI",e[e.KUAFUZHANLI=94]="KUAFUZHANLI",e[e.KUAFUDENGJI=95]="KUAFUDENGJI",e[e.MFSQHONGBAO=96]="MFSQHONGBAO"}(t=e.ActivityId||(e.ActivityId={}));var i;!function(e){e[e.LEIJICHONGZHI=41]="LEIJICHONGZHI",e[e.CHAOZHILIBAO=44]="CHAOZHILIBAO",e[e.ZHAOCAJINBAO=45]="ZHAOCAJINBAO",e[e.XIAOFEIZENGLI=42]="XIAOFEIZENGLI",e[e.DENGLUZENGLI=43]="DENGLUZENGLI"}(i=e.ActivityKuangHuanId||(e.ActivityKuangHuanId={}));var n;!function(e){e[e.QUANMINKUANGHUAN=46]="QUANMINKUANGHUAN",e[e.MEIRILEICHONG=47]="MEIRILEICHONG",e[e.XIANGOULIBAO=48]="XIANGOULIBAO",e[e.ZAIXIANJIANGLI=49]="ZAIXIANJIANGLI"}(n=e.ActivityHuikuiId||(e.ActivityHuikuiId={}));var o;!function(e){e[e.YIYUAN=1]="YIYUAN",e[e.SANYUAN=3]="SANYUAN"}(o=e.NewXianGouType||(e.NewXianGouType={}));var a=function(){function o(){this.currentCreate=0,this.previousTime_1=0,this.preTimes=0,this.model=new e.ActivityModel,this.panel=new e.ActivityPanel(this.model),this.laborDayPanel=new e.ActivityLaborDayPanel(this.model),this.advertisingPanel=new e.ActivityAdvertisingPanel(this.model),this.daBiaoPaiMingPanel=new e.ActivityDaBiaoPaiHangView(this.model),this.sharePanel=new e.ActivityShareView(this.model),this.tongjinzhuPanel=new e.ActivityTongJinZhuView(this.model),this.zajindanPanel=new e.ActivityZaJinDanView(this.model),this.huikuiPanel=new e.ActivityHuiKuiMainView(this.model),this.dafuwengPanel=new e.DaFuWengPanel(this.model),this.dafuwengRankPanel=new e.DaFuWengRankPanel(this.model),this.dafanlipanel=new e.DaFanLiPanel(this.model),this.ZeroPackage=new e.ZeroPackagePanel(this.model),this.kuafubangdanPanel=new e.ActivityKuaFuBangDanMainView(this.model),this.newXianGouBuyPanel=new e.NewXianGouBuyMain(this.model),this.meiRiChongZhiPanel=new e.ActivityMeiRiChongZhiView(this.model),this.mfsqFriendRank=new e.MfsqFrienRankView}return o.prototype.getHuoDongFirstShow=function(){return this.huodongFirstShow},o.prototype.setHuoDongFirstShow=function(e){this.huodongFirstShow=e},o.prototype.setMessageToSeverAll=function(){this.panel.getIsShow()||this.setHuoDongFirstShow(!0),this.sendMessageToSeverByHuodongLiebiao()},o.prototype.sendMessageByHuodongChooseIsNotShow=function(){if(!this.panel.getIsShow()){this.meirixianliFirstShow=!0,this.chengzhangjijinFirstShow=!0,this.chongzhichenggong(),this.goldChange();var n=this.model.getRedPointArr(),o=new Object;this.model.checkActivityHas(e.activityDaTingType.dabiaohuodong)?this.sendMessageToSeverByDaBiaoHuoDong():(o=n[e.activityDaTingType.dabiaohuodong],o&&o.value&&(o.value=!1)),this.model.checkActivityHas(e.activityDaTingType.zajindan)?this.sendMessageToSeverByZaJinDan():this.model.callBackPointByzajindan(!1),this.model.checkActivityHas(e.activityDaTingType.tongjinzhu)?this.sendMessageToSeverByTongJinZhu():this.model.callBackPointBytongjinzhu(!1),this.model.checkActivityHas(t.DAFUWENG)?this.sendmessageDafuWenginfo():this.model.callBackPointByDafuweng(!1),this.model.checkActivityHas(t.HUIKUI)?(this.sendmessagetoServerByHuiKuiZaiXian(),this.sendmessagetoServerByHuiKuiXianGou(),this.sendmessagetoServerByHuiKuiKuangHuan(),this.sendmessagetoServerByHuiKuiLeiChong()):e.ActivityBarController.getInstance().setHuiKuiRedPoint(!1),this.model.checkActivityHas(i.LEIJICHONGZHI)&&this.ActivityLaborDaySendMsgByLeiJiChongZhi(),this.model.checkActivityHas(i.DENGLUZENGLI)&&this.ActivityLaborDaySendMsgByDengLuJiangLi(),this.model.checkActivityHas(i.CHAOZHILIBAO)&&this.ActivityLaborDaySendMsgByChaoZhiLiBao(),this.model.checkActivityHas(i.XIAOFEIZENGLI)&&this.ActivityLaborDaySendMsgByXiaoFeiZengLi(),this.model.checkActivityHas(i.ZHAOCAJINBAO)&&this.ActivityLaborDaySendMsgByZhaoCaiJinBao()}},o.getIntance=function(){return this._intance||(this._intance=new o),this._intance},o.prototype.openzeropackagepanel=function(){this.ZeroPackage.showpanel()},o.prototype.registerMsg=function(t){t.add(e.Code.ACC_RECHARGE2_INFO_S,this),t.add(e.Code.GET_ACC_RECHARGE2_AWARD_S,this),t.add(e.Code.CONTINUE_RECHARGE_INFO_S,this),t.add(e.Code.GET_CONTINUE_RECHARGE_AWARD_S,this),t.add(e.Code.OPEN_ACTIVITY_SYNC_S,this),t.add(e.Code.OPEN_ACTIVITY_PEOPLE_WELFARE_S,this),t.add(e.Code.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_S,this),t.add(e.Code.OPEN_RECHARGE_RANKINGS_S,this),t.add(e.Code.OPEN_TEST_S,this),t.add(e.Code.OPEN_DISCOUNT_ACTIVITY_BUY_S,this),t.add(e.Code.STANDARD_ACTIVITY_INFO_S,this),t.add(e.Code.DAY_RECHARGE_AWARD_S,this),t.add(e.Code.GET_DAY_RECHARGE_AWARD_S,this),t.add(e.Code.GROW_FUND_S,this),t.add(e.Code.GET_GROW_FUND_S,this),t.add(e.Code.BUY_GROW_FUND_S,this),t.add(e.Code.STANDARD_ACTIVITY_REWARD_S,this),t.add(e.Code.ACTIVITY_ERRORNO_S,this),t.add(e.Code.SHARE_WECHAT_REWARD_S,this),t.add(e.Code.GAME_SHANRING_S,this),t.add(e.Code.GAME_SHANRING_SHOW_S,this),t.add(e.Code.GAME_INVITATIONS_S,this),t.add(e.Code.POKE_PIGIN_UP_S,this),t.add(e.Code.GAME_FOLLOW_GET_STATE_S,this),t.add(e.Code.GAME_FOLLOW_GET_AWARD_S,this),t.add(e.Code.POKE_PIGIN_INFO_S,this),t.add(e.Code.SMASH_GOLD_EGGS_S,this),t.add(e.Code.SMASH_GOLD_EGGS_BREAK_S,this),t.add(e.Code.SMASH_GOLD_EGGS_RECEIVE_S,this),t.add(e.Code.MAY_DAY_ACC_REHARGE_INFO_S,this),t.add(e.Code.MAY_DAY_ACC_REHARGE_GET_S,this),t.add(e.Code.MAY_DAY_LOGIN_INFO_S,this),t.add(e.Code.MAY_DAY_LOGIN_GET_S,this),t.add(e.Code.MAY_DAY_CONSUME_GOLD_INFO_S,this),t.add(e.Code.MAY_DAY_CONSUME_GOLD_GET_S,this),t.add(e.Code.MAY_DAY_GIFT_INFO_S,this),t.add(e.Code.MAY_DAY_GIFT_GET_S,this),t.add(e.Code.MAY_DAY_DOUBLEUP_GOLD_INFO_S,this),t.add(e.Code.MAY_DAY_DOUBLEUP_GOLD_AWARD_S,this),t.add(e.Code.MAY_DAY_DOUBLEUP_GOLD_LOG_S,this),t.add(e.Code.DAILY_ACC_RECHARGE_INFO_S,this),t.add(e.Code.DAILY_ACC_RECHARGE_AWARD_S,this),t.add(e.Code.ONLINE_AWARD_INFO_S,this),t.add(e.Code.GET_ONLINE_AWARD_S,this),t.add(e.Code.LIMIT_BUY_GIFT_INFO_S,this),t.add(e.Code.BUY_LIMIT_BUY_GIFT_S,this),t.add(e.Code.GENERAL_REVELRY_INFO_S,this),t.add(e.Code.GENERAL_REVELRY_AWARD_S,this),t.add(e.Code.CYCLE_CONSUME_GOLDS_INFO_S,this),t.add(e.Code.CYCLE_CONSUME_GOLDS_AWARD_S,this),t.add(e.Code.CONSUM_GOLDS_RANK_INFO_S,this),t.add(e.Code.DafuWeng_Info_S,this),t.add(e.Code.DafuWeng_Rank_S,this),t.add(e.Code.GET_ALON_DAILY_RECHARGE_S,this),t.add(e.Code.ALON_DAILY_RECHARGE_S,this),t.add(e.Code.DafuWeng_Refresh_Times_S,this),t.add(e.Code.DafuWeng_Cast_S,this),t.add(e.Code.DafuWeng_Award_S,this),t.add(e.Code.RECHARGE_REBATE_S,this),t.add(e.Code.ZERO_PACKATE_S,this),t.add(e.Code.ZERO_PACKATE_BUY_S,this),t.add(e.Code.FUNCTION_INIT_INFO_S,this),t.add(e.Code.FUNCTION_INIT_STATUS_S,this),t.add(e.Code.CS_RANK_PLAYER_INFO_S,this),t.add(e.Code.ROLE_LIMIT_TIME_GIFT_S,this),t.add(e.Code.GET_SERVER_DATETIME_S,this),t.add(e.Code.GET_ROLE_LIMIT_TIME_GIFT_S,this),App.MessageCenter.addListener(MessageCode.REFRESH_GOLD,this.goldChange,this)},o.prototype.goldChange=function(){var n=this.model.getRedPointArr(),o=new Object;this.model.checkActivityHas(e.activityDaTingType.allPlayerfuli)?this.sendMessageToSeverByQuanMinFuLi():(o=n[e.activityDaTingType.allPlayerfuli],o&&o.value&&(o.value=!1)),this.model.checkActivityHas(e.activityDaTingType.lianxuchongzhihongli)?this.sendMessageToSeverBylianxuchongzhihongli():(o=n[e.activityDaTingType.lianxuchongzhihongli],o&&o.value&&(o.value=!1)),this.model.checkActivityHas(e.activityDaTingType.kaifulibao)?this.sendMessageToSeverByKaiFuLiBao():(o=n[e.activityDaTingType.kaifulibao],o&&o.value&&(o.value=!1)),this.model.checkActivityHas(t.HUIKUI)&&(this.sendmessagetoServerByHuiKuiXianGou(),this.sendmessagetoServerByHuiKuiLeiChong()),this.model.checkActivityHas(i.LEIJICHONGZHI)&&this.ActivityLaborDaySendMsgByLeiJiChongZhi(),this.model.checkActivityHas(i.XIAOFEIZENGLI)&&this.ActivityLaborDaySendMsgByXiaoFeiZengLi(),this.model.checkActivityHas(e.activityDaTingType.shuijingshop)&&e.ActivityXianShiController.getIntance().goldChange()},o.prototype.recvMsg=function(t,n){var o=this;switch(t){case e.Code.ZERO_PACKATE_BUY_S:this.model.setZERO_PACKATE_BUY_S(n),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.LIBAO0YUAN,!n.getDisplayStatus());break;case e.Code.ZERO_PACKATE_S:this.model.setZERO_PACKATE_S(n),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.LIBAO0YUAN,!n.getDisplayStatus());break;case e.Code.RECHARGE_REBATE_S:this.model.setRECHARGE_REBATE_S(n),this.dafanlipanel.showpanel();break;case e.Code.ACC_RECHARGE2_INFO_S:this.model.leijiChongZhi(n),this.panel.getIsShow()&&this.panel.leijichongzhiShow();break;case e.Code.GET_ACC_RECHARGE2_AWARD_S:this.model.setLeiJiChongZhiAward(n);break;case e.Code.CYCLE_CONSUME_GOLDS_AWARD_S:this.model.setLeiJiXiaoHaoAward(n);break;case e.Code.CONTINUE_RECHARGE_INFO_S:this.model.lianxuChongZhi(n),this.panel.getIsShow()&&this.panel.lianxuchongzhiShow();break;case e.Code.GET_CONTINUE_RECHARGE_AWARD_S:this.model.setlianChongFanLiAward(n);break;case e.Code.OPEN_ACTIVITY_SYNC_S:this.model.setListData(n),this.panel.getIsShow()||(this.panel.changeBottomVisible(),null!=n&&this.sendMessageByHuodongChooseIsNotShow());break;case e.Code.OPEN_ACTIVITY_PEOPLE_WELFARE_S:this.model.quanminfuli(n),this.panel.getIsShow()&&this.panel.quanminfuliShow();break;case e.Code.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_S:this.model.setQuanMinFuLiAward(n);break;case e.Code.OPEN_RECHARGE_RANKINGS_S:this.model.chongzhipaiming(n),this.panel.getIsShow()&&this.panel.chongzhipaimingShow();break;case e.Code.OPEN_TEST_S:this.model.kaifulibao(n),this.panel.getIsShow()&&this.panel.kaifulibaoShow();break;case e.Code.OPEN_DISCOUNT_ACTIVITY_BUY_S:this.model.setKaiFuLiBao(n);break;case e.Code.STANDARD_ACTIVITY_INFO_S:this.model.dabiaohuodong(n),this.panel.getIsShow()&&this.panel.dabiaohuodongShow();break;case e.Code.DAY_RECHARGE_AWARD_S:this.model.meirixianli(n),this.panel.getIsShow()&&this.panel.meirixianliShow();break;case e.Code.SHARE_WECHAT_REWARD_S:this.model.setshareData(n);break;case e.Code.GAME_SHANRING_S:this.model.setsharingData(n);break;case e.Code.GAME_SHANRING_SHOW_S:this.model.setinviteData(n),this.sharePanel.updateView(n);break;case e.Code.GAME_INVITATIONS_S:this.model.setgetData(n),this.sharePanel.updategetView(n);break;case e.Code.GET_DAY_RECHARGE_AWARD_S:this.model.setMeiRiXianLi(n);break;case e.Code.GROW_FUND_S:this.model.chengzhangjijin(n),this.panel.getIsShow()&&this.panel.chengzhangjijinShow();break;case e.Code.GET_GROW_FUND_S:this.model.setChengZhangJiJinAward(n);break;case e.Code.BUY_GROW_FUND_S:this.model.setChengZhangJiJinAward(n);break;case e.Code.STANDARD_ACTIVITY_REWARD_S:this.model.setDaBiaoHuoDongAward(n);break;case e.Code.ACTIVITY_ERRORNO_S:var a=n;switch(a.getActivityId()){case e.activityDaTingType.leijichongzhi:case e.activityDaTingType.lianxuchongzhi:case e.activityDaTingType.allPlayerfuli:case e.activityDaTingType.chongzhipaiming:case e.activityDaTingType.kaifulibao:case e.activityDaTingType.dabiaohuodong:return}if(a.getErrorNo()>0){var s="";e.PopUpController.getInstance().showFloatTextPanel1(s)}break;case e.Code.POKE_PIGIN_UP_S:this.model.setTongJinZhuData(n);break;case e.Code.GAME_FOLLOW_GET_STATE_S:this.sharePanel.updateFollowView(n);break;case e.Code.POKE_PIGIN_INFO_S:var r=this.tongjinzhuPanel.getIsShow();r&&this.sendMessageToSeverByTongJinZhu();break;case e.Code.SMASH_GOLD_EGGS_S:this.model.setZaJinDanData(n);break;case e.Code.SMASH_GOLD_EGGS_BREAK_S:var l=this.zajindanPanel.getIsShow(),h=n;if(h.getErrorNo()>0)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SMASH_GOLD_BUZHU"));l&&this.sendMessageToSeverByZaJinDan();break;case e.Code.SMASH_GOLD_EGGS_RECEIVE_S:var c=this.zajindanPanel.getIsShow();c&&this.sendMessageToSeverByZaJinDan();break;case e.Code.MAY_DAY_ACC_REHARGE_INFO_S:this.model.setLaborDayLeiJiChongZhiData(n),this.laborDayPanel.getIsShow()&&this.laborDayPanel.getCurrentScence()==i.LEIJICHONGZHI&&this.laborDayPanel.leijichongzhiPanelShow();break;case e.Code.MAY_DAY_ACC_REHARGE_GET_S:this.model.setLeiJiChongZhiLaborDayAward(n);break;case e.Code.MAY_DAY_LOGIN_INFO_S:this.model.setDengLuJiangLiLaborDayData(n),this.laborDayPanel.getIsShow()&&this.laborDayPanel.denglujiangliPanelShow();break;case e.Code.MAY_DAY_LOGIN_GET_S:this.model.setDengLuJiangLiLaborDayAward(n);break;case e.Code.MAY_DAY_CONSUME_GOLD_INFO_S:this.model.setLeiJiXiaoFeiLaborDayData(n),this.laborDayPanel.getIsShow()&&this.laborDayPanel.getCurrentScence()==i.XIAOFEIZENGLI&&this.laborDayPanel.leijixiaofeiPanelShow();break;case e.Code.MAY_DAY_CONSUME_GOLD_GET_S:this.model.setLeiJiXiaoFeiLaborDayAward(n);break;case e.Code.MAY_DAY_GIFT_INFO_S:this.model.setChaoZhiLiBaoLaborDayData(n),this.laborDayPanel.getIsShow()&&this.laborDayPanel.chaozhilibaoPanelShow();break;case e.Code.MAY_DAY_GIFT_GET_S:this.model.setChaoZhiLiBaoLaborDayAward(n);break;case e.Code.MAY_DAY_DOUBLEUP_GOLD_INFO_S:this.model.setZhaoCaiJinBaoLaborDayData(n),this.laborDayPanel.getIsShow()&&this.laborDayPanel.getCurrentScence()==i.ZHAOCAJINBAO&&this.laborDayPanel.zhaocaijinbaoPanelShow();break;case e.Code.MAY_DAY_DOUBLEUP_GOLD_AWARD_S:this.model.setZhaoCaiJinBaoLaborDayAward(n);break;case e.Code.MAY_DAY_DOUBLEUP_GOLD_LOG_S:this.model.setLaborDayLog(n),this.laborDayPanel.getIsShow()&&this.laborDayPanel.zhaocaijinbaoLogShow();break;case e.Code.DAILY_ACC_RECHARGE_INFO_S:this.model.setHuiKuiLeiChongData(n),this.huikuiPanel.getIsShow()&&this.huikuiPanel.showleichongView();break;case e.Code.DAILY_ACC_RECHARGE_AWARD_S:this.model.setHuiKuiLeiChongAwardData(n);break;case e.Code.ONLINE_AWARD_INFO_S:this.model.setHuiKuiZaiXianData(n),this.huikuiPanel.getIsShow()&&this.huikuiPanel.showZaiXianJiangLiView();break;case e.Code.GET_ONLINE_AWARD_S:this.model.setHuiKuiZaiXianAwardData(n);break;case e.Code.GET_ALON_DAILY_RECHARGE_S:0==n.errorNo&&this.sendMessageToMeiRiChongzhi();break;case e.Code.LIMIT_BUY_GIFT_INFO_S:this.model.setHuiKuiXianGouData(n),this.huikuiPanel.getIsShow()&&this.huikuiPanel.showXianGouLiBaoView();break;case e.Code.BUY_LIMIT_BUY_GIFT_S:this.model.setHuiKuiLiBaoAwardData(n);break;case e.Code.GENERAL_REVELRY_INFO_S:this.model.setHuiKuiKuangHuanData(n),this.huikuiPanel.getIsShow()&&this.huikuiPanel.showkuanghuanView();break;case e.Code.CYCLE_CONSUME_GOLDS_INFO_S:this.model.setleichongxiaohao(n),this.panel.getIsShow()&&this.panel.showLeiChongXiaoHao();break;case e.Code.CONSUM_GOLDS_RANK_INFO_S:this.model.setxiaofeipaihang(n),this.panel.getIsShow()&&this.panel.showxiaofeipaihang();break;case e.Code.GENERAL_REVELRY_AWARD_S:this.model.setHuiKuiKuangHuanAwardData(n);break;case e.Code.DafuWeng_Info_S:this.model.setDafuWengInfoData(n),this.sendmessageDafuWengRefreshTimes();break;case e.Code.DafuWeng_Rank_S:this.model.setDafuwengRankData(n);break;case e.Code.DafuWeng_Refresh_Times_S:this.model.setDafuWengRefreshTimeData(n);break;case e.Code.DafuWeng_Cast_S:var u=this.dafuwengPanel.getIsShow(),p=n;if(p.getErrorNo()>0){this.dafuwengPanel.setTouzhi(!0);var g=this.model.getDafuwengInfoData(),d=g.getTimes();return this.model.havaGetdafuwengAwards?e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAFUWENG_HADAWARD")):0>=d?e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAFUWENG_CAST")):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAFUWENG_CAST_FAST"))}u&&this.dafuwengPanel.createTouziMC(p.getDropNumber());break;case e.Code.DafuWeng_Award_S:var f=this.dafuwengPanel.getIsShow();f&&this.dafuwengPanel.setTouzhi(!0);var m=n;if(m.getErrorNo()>0)return;var y=m.getRankInfo(),I=e.PlayerService.instance.playerId;y.forEach(function(e){e.getPlayerId()==I&&(f&&o.dafuwengPanel.checkCurPosAward(e.getId()),78==e.getId()&&(o.model.havaGetdafuwengAwards=!0))});break;case e.Code.FUNCTION_INIT_INFO_S:this.model.setAdvertisingInfoData(n);break;case e.Code.CS_RANK_PLAYER_INFO_S:this.model.setKuaFuBandanData(n);break;case e.Code.ALON_DAILY_RECHARGE_S:this.model.setMeiRiChongZhiData(n);break;case e.Code.ROLE_LIMIT_TIME_GIFT_S:this.model.setNewXianShiGiftData(n);break;case e.Code.GET_SERVER_DATETIME_S:console.log("获取时间"),this.model.setServerCurrentData(n);break;case e.Code.GET_ROLE_LIMIT_TIME_GIFT_S:var v=n;0!=v.getErrorNo()&&console.log("错误码 "+v.getErrorNo());break;case e.Code.FUNCTION_INIT_STATUS_S:}},o.prototype.sendHPInitGroomReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPInitGroomReq");e.Message.instance.send(e.Code.FUNCTION_INIT_INFO_C,t,!0)},o.prototype.sendHPInitGroomStatusReq=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPInitGroomStatusReq");n.setId(t),n.setStatus(i),e.Message.instance.send(e.Code.FUNCTION_INIT_STATUS_C,n,!0)},o.prototype.sendMessageToSeverByLeiJiChongZhi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccRecharge2Info");e.Message.instance.send(e.Code.ACC_RECHARGE2_INFO_C,t,!0)},o.prototype.sendMessageToMeiRiChongzhi=function(){var t=HawkProtocolManager.newBuilder("JsProto.DailyAccRechargeInfoReq");e.Message.instance.send(e.Code.ALON_DAILY_RECHARGE_C,t,!0)},o.prototype.sendMessageToSeverByLianXuChongZhi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPContinueRechargeInfo");e.Message.instance.send(e.Code.CONTINUE_RECHARGE_INFO_C,t,!0)},o.prototype.sendMessageToSeverByQuanMinFuLi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPOpenPeopleWelfareInfoReq");e.Message.instance.send(e.Code.OPEN_ACTIVITY_PEOPLE_WELFARE_C,t,!0)},o.prototype.sendMessageToSeverByChongZhiPaiMing=function(){var t=HawkProtocolManager.newBuilder("JsProto.RechargeRankReq");e.Message.instance.send(e.Code.OPEN_RECHARGE_RANKINGS_C,t,!0)},o.prototype.sendMessageToSeverByKaiFuLiBao=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPOpenPackageInfoReq");e.Message.instance.send(e.Code.OPEN_TEST_C,t,!0)},o.prototype.sendMessageToSeverByDaBiaoHuoDong=function(){var t=HawkProtocolManager.newBuilder("JsProto.StandardActivityInfoReq");e.Message.instance.send(e.Code.STANDARD_ACTIVITY_INFO_C,t,!0)},o.prototype.sendMessageToSeverBylianxuchongzhihongli=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccRecharge2Info");e.Message.instance.send(e.Code.CYCLE_CONSUME_GOLDS_INFO_C,t,!0)},o.prototype.sendMessageToSeverByxiaofeipaiming=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPConsumeGoldsRankInfoReq");e.Message.instance.send(e.Code.CONSUM_GOLDS_RANK_INFO_C,t,!0)},o.prototype.sendMessageToSeverByLeiJiLingQu=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPGetAccRecharge2Award");i.setAwardCfgId(t),e.Message.instance.send(e.Code.GET_ACC_RECHARGE2_AWARD_C,i,!0)},o.prototype.sendMessageToSeverByLeiJiXiaoHaoAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPGetAccRecharge2Award");i.setAwardCfgId(t),e.Message.instance.send(e.Code.CYCLE_CONSUME_GOLDS_AWARD_C,i,!0)},o.prototype.sendMessageToSeverByLaborDayLeiJiLingQu=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPGetAccRecharge2Award");i.setAwardCfgId(t),e.Message.instance.send(e.Code.MAY_DAY_ACC_REHARGE_GET_C,i,!0)},o.prototype.sendMessageToSeverByLaborDayLeiJiXiaoFei=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPGetAccRecharge2Award");i.setAwardCfgId(t),e.Message.instance.send(e.Code.MAY_DAY_CONSUME_GOLD_GET_C,i,!0)},o.prototype.sendZERO_PACKATE_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPZeroPackageInfoRep");e.Message.instance.send(e.Code.ZERO_PACKATE_C,t,!0)},o.prototype.sendMessageToSeverByLaborDayZhaoCaiJinBao=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRandomGetGoldsAwardReq");e.Message.instance.send(e.Code.MAY_DAY_DOUBLEUP_GOLD_AWARD_C,t,!0)},o.prototype.sendMessageToSeverByLaborDayChaoZhiLiBao=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPActivityGiftAwardBuyReq");i.setId(t),e.Message.instance.send(e.Code.MAY_DAY_GIFT_GET_C,i,!0)},o.prototype.sendMessageToSeverByLaborDayDengLuJiangLi=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPAccLoginAwards");i.setRewwardDay(t),e.Message.instance.send(e.Code.MAY_DAY_LOGIN_GET_C,i,!0)},o.prototype.sendMessageToSeverByMeiRiXianLi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccRechargeInfo");e.Message.instance.send(e.Code.DAY_RECHARGE_AWARD_C,t,!0)},o.prototype.sendMessageToSeverByChengZhangJiJin=function(){e.Message.instance.send(e.Code.GROW_FUND_C,HawkProtocolManager.emptyProtocol(),!0)},o.prototype.sendmessageToServerByShareandInvite=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPSharingInvitationsReq");e.Message.instance.send(e.Code.SHARE_WECHAT_REWARD_C,t,!0)},o.prototype.sendmessageToServerBySharing=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGameSharingInfoReq");e.Message.instance.send(e.Code.GAME_SHANRING_C,t,!0)},o.prototype.sendmessageToServerByInvite=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGameInvitationsShowReq");e.Message.instance.send(e.Code.GAME_SHANRING_SHOW_C,t,!0)},o.prototype.sendmessageToServerByGet=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGameInvitationsReq");e.Message.instance.send(e.Code.GAME_INVITATIONS_C,t,!0)},o.prototype.sendRECHARGE_REBATE_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRechargeRebateRep");e.Message.instance.send(e.Code.RECHARGE_REBATE_C,t,!0)},o.prototype.sendMessageToSeverByKuaFuBangdan=function(t){console.log("活动id "+t);var i=HawkProtocolManager.newBuilder("JsProto.HPCSRankInfoReq");i.setActivityId(t),e.Message.instance.send(e.Code.CS_RANK_PLAYER_INFO_C,i,!0)},o.prototype.sendMessageToSeverByHuodongLiebiao=function(){e.Message.instance.send(e.Code.GET_ACTIVITY_LIST_C,HawkProtocolManager.emptyProtocol(),!0)},o.prototype.showsharePanel=function(){this.sendmessageToServerByShareandInvite(),this.sharePanel.show()},o.prototype.showPanel=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=0),o.getIntance().setHuoDongFirstShow(!1),t&&(this.model.setGuildIndex(i),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JIJIN,!0)),this.panel.show(),this.sendMessageToSeverByHuodongLiebiao()},o.prototype.showMeiRiXianLiPanel=function(){this.sendMessageToSeverByMeiRiXianLi()},o.prototype.isMeiRiXianLiPanelFirstShow=function(){return this.meirixianliFirstShow},o.prototype.setMeiRiXianLiFirstShow=function(e){this.meirixianliFirstShow=e},o.prototype.showJingJiPaiHangPanel=function(e){void 0===e&&(e=0),this.model.setZhanLiType(e),this.daBiaoPaiMingPanel.show()},o.prototype.getViewScallV=function(){return this.model.get_reflush()},o.prototype.get51ViewScallV=function(){return this.model.get_51reflush()},o.prototype.showTipsByItemOrEquip=function(t,i,n){switch(i){case e.ItemType.EQUIP:var o=e.JsonDataManager.instance.equipTemplate[t];e.TipsController.getInstance().showEquipTips({equipId:o.id});break;case e.ItemType.SOUL:e.TipsController.getInstance().showSoulTips(t);break;case e.ItemType.SKILLSTONE:e.TipsController.getInstance().showDragonArmorSkillTips(t);break;default:e.TipsController.getInstance().showItemTips(t,n)}},o.prototype.getCollection=function(){return this.model.collection},o.prototype.getKuaFuBangdanCollection=function(){return this.model.kuafuBangDanCollection},o.prototype.getCollection_chengzhangjijin=function(){return this.model.collection_chengzhangjijin},o.prototype.getCollection_bottom=function(){return this.model.collection_bottom},o.prototype.getkuafubangdanCollection_bottom=function(){return this.model.bangdanCollection_bottom},o.prototype.getCollection_dabiao=function(){return this.model.collection_dabiao},o.prototype.getCollection_kaifu=function(){return this.model.collection_kaifu},o.prototype.getCollection_lianxuchongzhi=function(){return this.model.collection_lianxuchongzhi},o.prototype.getCollection_quanminfuli=function(){return this.model.collection_quanminfuli},o.prototype.getCollection_leijixiaohao=function(){return this.model.collection_leijixiaohao},o.prototype.getCollection_xiaohaopaiming=function(){return this.model.collection_xiaohaopaiming},o.prototype.getLeiJiChongZhiData=function(){return this.model.getleijiChongZhi()},o.prototype.getLeiJiXiaoHaoData=function(){return this.model.getleichongxiaohao()},o.prototype.getLaborDayLeiJiChongZhiData=function(){return this.model.getLaborDayLeiJiChongZhiData()},o.prototype.getLaborDayLeiJiXiaoFeiData=function(){return this.model.getLeiJiXiaoFeiLaborDayData()},o.prototype.getLaborDayDengluJiangLiData=function(){return this.model.getDengLuJiangLiLaborDayData()},o.prototype.getKaiFuLiBaoData=function(){return this.model.getKaiFuLiBao()},o.prototype.getChongZhiPaiMingData=function(){return this.model.getChongZhiPaiMing()},o.prototype.getChengZhangJiJinData=function(){return this.model.getChengnZhangJiJin()},o.prototype.getLianXuChongZhiData=function(){return this.model.getlianxuChongZhi()},o.prototype.setArrAwardRank=function(e){this.model.setArrAwardRank(e)},o.prototype.getArrAwardRank=function(){return this.model.getArrAwardRank()},o.prototype.getCreateNum=function(){return this.currentCreate},o.prototype.setCreateNum=function(e){this.currentCreate=e},o.prototype.getModelForDaBiao=function(){return this.model},o.prototype.showAdvertising=function(){this.advertisingPanel.getIsShow()||this.advertisingPanel.show()},o.prototype.chongzhichenggong=function(){var t=this.model.getRedPointArr(),i=new Object;this.model.checkActivityHas(e.activityDaTingType.leijichongzhi)?this.sendMessageToSeverByLeiJiChongZhi():(i=t[e.activityDaTingType.leijichongzhi],i&&i.value&&(i.value=!1)),this.model.checkActivityHas(e.activityDaTingType.lianxuchongzhi)?this.sendMessageToSeverByLianXuChongZhi():(i=t[e.activityDaTingType.lianxuchongzhi],i&&i.value&&(i.value=!1)),this.model.checkActivityHas(e.activityDaTingType.chongzhipaiming)?this.sendMessageToSeverByChongZhiPaiMing():(i=t[e.activityDaTingType.chongzhipaiming],i&&i.value&&(i.value=!1)),this.model.checkActivityHas(e.activityDaTingType.meirixianli)&&this.sendMessageToSeverByMeiRiXianLi()},o.prototype.getRedPointArr=function(){return this.model.getRedPointArr()},o.prototype.showLibao=function(){this.panel.getIsShow()||this.panel.show(),this.panel.getIsShow()&&(this.panel.viewOpenByGuid(e.activityDaTingType.kaifulibao),this.panel.kaifulibaoShow())},o.prototype.checkQiangHuaDaBiao=function(){this.model.checkQiangHuaDaBiao()},o.prototype.checkWingJinJie=function(){this.model.checkWingJinJie()},o.prototype.checkEquipCellRed=function(){this.model.checkEquipCellRed()},o.prototype.checkzhanli=function(){this.model.checkzhanli()},o.prototype.getActivityById=function(e){return this.model.getActivityById(e)},o.prototype.showTongJinZhuPanel=function(){this.tongjinzhuPanel.canshow=!0,this.tongjinzhuPanel.getIsShow()||(App.LittleLoading().showLoading("ActivityController showTongJinZhuPanel"),this.tongjinzhuPanel.show(),this.sendMessageToSeverByTongJinZhu(),App.LittleLoading().hideLoading("ActivityController showTongJinZhuPanel"))},o.prototype.showDafuwengPanel=function(){this.dafuwengPanel.getIsShow()||(App.LittleLoading().showLoading("ActivityController showDafuwengPanel"),this.dafuwengPanel.show(),this.sendmessageDafuWenginfo(),App.LittleLoading().hideLoading("ActivityController showDafuwengPanel"))},o.prototype.showKuafuBanDanPanel=function(){this.kuafubangdanPanel.show()},o.prototype.showKFchongzhipaiming=function(){this.kuafubangdanPanel.kfchongzhipaimingShow()},o.prototype.showKFXiaoFeipaiming=function(){this.kuafubangdanPanel.kfXiaoFeipaimingShow()},o.prototype.showKFZhanLipaiming=function(){this.kuafubangdanPanel.kfZhanLipaimingShow()},o.prototype.showKFDengjipaiming=function(){this.kuafubangdanPanel.kfDengjipaimingShow()},o.prototype.showNewXianGouPanel=function(e){this.newXianGouBuyPanel.show()},o.prototype.showMeiRiChongZhiView=function(){this.meiRiChongZhiPanel.show()},o.prototype.mfsqfrienduiView=function(){this.mfsqFriendRank.show()},o.prototype.newXianshiUicounDown=function(e){egret.clearInterval(this.timer);var t=Math.floor(e/1e3);t>0?this.timer=egret.setInterval(function(){1>=t?(egret.clearInterval(this.timer),this.repetServerTime()):t>1&&(t--,this.countDownOpt(t))},this,1e3):(console.log("时间正好等于0了"),this.repetServerTime())},o.prototype.repetServerTime=function(){this.timeZero=egret.setInterval(function(){egret.clearInterval(this.timeZero),o.getIntance().sendMessageToNewXianShiData()},this,3e3)},o.prototype.cleanXianShiCountDown=function(){egret.clearInterval(this.timer)},o.prototype.countDownOpt=function(e){var t=Math.floor(e/86400),i=Math.floor((e-24*t*3600)/3600),n=Math.floor((e-24*t*3600-3600*i)/60),o=e-24*t*3600-3600*i-60*n,a=i+"时"+n+"分"+o+"秒";this.newXianGouBuyPanel.getIsShow()&&this.newXianGouBuyPanel.remainTime(a)},o.prototype.showDafuwengRankPanel=function(){this.dafuwengRankPanel.getIsShow()||(App.LittleLoading().showLoading("ActivityController showDafuwengRankPanel"),this.sendmessageDafuWengRankInfo(),this.dafuwengRankPanel.show(),App.LittleLoading().hideLoading("ActivityController showDafuwengRankPanel"))},o.prototype.showZaJinDanPanel=function(){this.zajindanPanel.canshow=!0,this.zajindanPanel.getIsShow()||(App.LittleLoading().showLoading("ActivityController showZaJinDanPanel"),this.zajindanPanel.show(),this.sendMessageToSeverByZaJinDan(),App.LittleLoading().hideLoading("ActivityController showZaJinDanPanel"))},o.prototype.showkuanghuanPanel=function(){this.laborDayPanel.getIsShow()||(App.LittleLoading().showLoading("ActivityController showkuanghuanPanel"),this.laborDayPanel.show(),App.LittleLoading().hideLoading("ActivityController showkuanghuanPanel"))},o.prototype.getKuangHuangScenceIndex=function(){return this.laborDayPanel.getIsShow()?this.laborDayPanel.getCurrentScence():void 0},o.prototype.sendmessageDafuWenginfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPZillionaireInfoReq");e.Message.instance.send(e.Code.DafuWeng_Info_C,t,!0)},o.prototype.sendmessageDafuWengRankInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPZillionaireRankReq");e.Message.instance.send(e.Code.DafuWeng_Rank_C,t,!0)},o.prototype.sendmessageDafuWengRefreshTimes=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPZillionaireRefreshTimesReq");e.Message.instance.send(e.Code.DafuWeng_Refresh_Times_C,t,!0)},o.prototype.sendMessageToNewXianShiData=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRoleLimitGiftReq");e.Message.instance.send(e.Code.ROLE_LIMIT_TIME_GIFT_C,t,!0)},o.prototype.senMessageToGetServerTime=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDetServerDateTimeReq");e.Message.instance.send(e.Code.GET_SERVER_DATETIME_C,t,!0)},o.prototype.senMessageToGetGift=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRoleLimitGiftReq");e.Message.instance.send(e.Code.GET_ROLE_LIMIT_TIME_GIFT_C,t,!0)},o.prototype.sendmessageDafuWengCast=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPZillionaireCastReq");e.Message.instance.send(e.Code.DafuWeng_Cast_C,t,!0)},o.prototype.sendmessageDafuwengAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPZillionaireAwardReq");e.Message.instance.send(e.Code.DafuWeng_Award_C,t,!0)
},o.prototype.sendMessageToSeverByTongJinZhu=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPPokePigreq");e.Message.instance.send(e.Code.POKE_PIGIN_UP_C,t,!0)},o.prototype.sendMessageToSeverByTongJinZhuBuy=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPPokePigInforeq");e.Message.instance.send(e.Code.POKE_PIGIN_INFO_C,t,!0)},o.prototype.sendMessageToSeverByZaJinDan=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPSmashGoldEggsReq");e.Message.instance.send(e.Code.SMASH_GOLD_EGGS_C,t,!0)},o.prototype.sendMessageToSeverByZaJinDan_smash=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPSmashGoldEggsBreakReq");n.setOnekey(t),n.setPositionNumber(i),e.Message.instance.send(e.Code.SMASH_GOLD_EGGS_BREAK_C,n,!0)},o.prototype.sendMessageToSeverByZaJinDan_award=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPSmashGoldEggsReceiveReq");e.Message.instance.send(e.Code.SMASH_GOLD_EGGS_RECEIVE_C,t,!0)},o.prototype.ActivityLaborDaySendMsg=function(e){switch(e){case i.DENGLUZENGLI:this.ActivityLaborDaySendMsgByDengLuJiangLi();break;case i.CHAOZHILIBAO:this.ActivityLaborDaySendMsgByChaoZhiLiBao();break;case i.LEIJICHONGZHI:this.ActivityLaborDaySendMsgByLeiJiChongZhi();break;case i.XIAOFEIZENGLI:this.ActivityLaborDaySendMsgByXiaoFeiZengLi();break;case i.ZHAOCAJINBAO:this.ActivityLaborDaySendMsgByZhaoCaiJinBao()}},o.prototype.ActivityHuiKuiSendMsg=function(e){switch(e){case n.ZAIXIANJIANGLI:o.getIntance().sendmessagetoServerByHuiKuiZaiXian();break;case n.QUANMINKUANGHUAN:o.getIntance().sendmessagetoServerByHuiKuiKuangHuan();break;case n.MEIRILEICHONG:o.getIntance().sendmessagetoServerByHuiKuiLeiChong();break;case n.XIANGOULIBAO:o.getIntance().sendmessagetoServerByHuiKuiXianGou()}},o.prototype.ActivityLaborDaySendMsgByLeiJiChongZhi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccRecharge2Info");e.Message.instance.send(e.Code.MAY_DAY_ACC_REHARGE_INFO_C,t,!0)},o.prototype.ActivityLaborDaySendMsgByDengLuJiangLi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccLoginInfo");e.Message.instance.send(e.Code.MAY_DAY_LOGIN_INFO_C,t,!0)},o.prototype.ActivityLaborDaySendMsgByXiaoFeiZengLi=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccRecharge2Info");e.Message.instance.send(e.Code.MAY_DAY_CONSUME_GOLD_INFO_C,t,!0)},o.prototype.ActivityLaborDaySendMsgByZhaoCaiJinBao=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRandomGetGoldsInfoReq");e.Message.instance.send(e.Code.MAY_DAY_DOUBLEUP_GOLD_INFO_C,t,!0)},o.prototype.ActivityLaborDaySendMsgByChaoZhiLiBao=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPActivityGiftAwardInfoReq");e.Message.instance.send(e.Code.MAY_DAY_GIFT_INFO_C,t,!0)},o.prototype.stopMc=function(e){this.laborDayPanel.zhaoCaiJinBaostopMc(e)},o.prototype.playMc=function(){this.laborDayPanel.zhaoCaiJinBaoplayMc()},o.prototype.LaoHuStop=function(){this.laborDayPanel.LaoHuStop()},o.prototype.showHuiKuiPanel=function(){this.huikuiPanel.show()},o.prototype.sendmessagetoServerByHuiKuiLeiChong=function(){var t=HawkProtocolManager.newBuilder("JsProto.DailyAccRechargeInfoReq");e.Message.instance.send(e.Code.DAILY_ACC_RECHARGE_INFO_C,t,!0)},o.prototype.sendMessageToSeverByMeiRiChongZhiGetAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetDailyAccRechargeAwardReq");i.setCfgId(t),e.Message.instance.send(e.Code.GET_ALON_DAILY_RECHARGE_C,i,!0)},o.prototype.sendMessageToSeverByHuiKuiLeiChongGetAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetDailyAccRechargeAwardReq");i.setCfgId(t),e.Message.instance.send(e.Code.DAILY_ACC_RECHARGE_AWARD_C,i,!0)},o.prototype.sendmessagetoServerByHuiKuiZaiXian=function(){var t=HawkProtocolManager.newBuilder("JsProto.OnlineAwardInfoReq");e.Message.instance.send(e.Code.ONLINE_AWARD_INFO_C,t,!0)},o.prototype.sendMessageToSeverByHuiKuiZaiXianGetAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetOnlineAwardReq");i.setCfgId(t),e.Message.instance.send(e.Code.GET_ONLINE_AWARD_C,i,!0)},o.prototype.sendmessagetoServerByHuiKuiXianGou=function(){var t=HawkProtocolManager.newBuilder("JsProto.LimitBuyGiftInfoReq");e.Message.instance.send(e.Code.LIMIT_BUY_GIFT_INFO_C,t,!0)},o.prototype.sendMessageToSeverByHuiKuiLiBaoGetAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.BuyLimitBuyGiftReq");i.setCfgId(t),e.Message.instance.send(e.Code.BUY_LIMIT_BUY_GIFT_C,i,!0)},o.prototype.sendmessagetoServerByHuiKuiKuangHuan=function(){var t=HawkProtocolManager.newBuilder("JsProto.GeneralRevelryInfoReq");e.Message.instance.send(e.Code.GENERAL_REVELRY_INFO_C,t,!0)},o.prototype.sendMessageToSeverByHuiKuiKuangHuanGetAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetGeneralRevelryAwardReq");i.setCfgId(t),e.Message.instance.send(e.Code.GENERAL_REVELRY_AWARD_C,i,!0)},o.prototype.onTickDafuwengRefreshTimes=function(e){this.currentDafuwengTime=e,egret.startTick(this.tickDafuweng,this)},o.prototype.tickDafuweng=function(t){var i=t-this.preTimes;return i>=1e3&&(this.preTimes=t,this.currentDafuwengTime-=1e3),0==Math.ceil(this.currentDafuwengTime/1e3)&&(egret.stopTick(this.tickDafuweng,this),this.model.dafuwengRefreshBoolState||e.ActivityBarController.getInstance().setDafuwengRedPoint(!0),o.getIntance().sendmessageDafuWengRefreshTimes()),!0},o.prototype.onTickToHuiKuiZaiXian=function(e,t){this.currentHuiKuiTime=e,this.allHuiKuiTime=t,egret.startTick(this.onTick,this)},o.prototype.onTick=function(t){var i=t-this.previousTime;if(i>1e3){this.previousTime=t;var n=0,o=this.allHuiKuiTime.length;for(n;o>n;n++){this.allHuiKuiTime[n];if(t/1e3>=this.currentHuiKuiTime){egret.stopTick(this.onTick,this),e.ActivityBarController.getInstance().setHuiKuiRedPoint(!0);break}}this.currentHuiKuiTime++}return!0},o.prototype.changeBtnRedVis=function(){this.panel.getIsShow()&&this.panel.checkBtnRedVisible()},o.prototype.checkServerOpenCloseActivityBtns=function(){var e=this.model.getListData();e&&this.model.setListData(e)},o.prototype.getXianShiListData=function(){return this.model.getxianshiListData()},o.prototype.sendRoleLimitGiftReq=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPGetRoleLimitGiftReq");i.setMoney(t),e.Message.instance.send(e.Code.GET_ROLE_LIMIT_TIME_GIFT_C,i,!0)},o.prototype.getJijinshow=function(){return this.model.getJijinshow()},o.prototype.getModel=function(){return this.model},o}();e.ActivityController=a,__reflect(a.prototype,"foxgame.ActivityController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.scene=null,n.actorManager=null,n.dropManager=null,n.mapManager=null,n.sceneManager=null,n.playerManager=null,n.screenWidth=0,n.screenHeight=0,n.designWidth=0,n.designHeight=0,n.scene=i.scene,n.actorManager=i.actorManager,n.dropManager=i.dropManager,n.mapManager=i.mapManager,n.sceneManager=i.sceneManager,n.playerManager=i.playerManager,n.screenWidth=e.Global.stageWidth,n.screenHeight=e.Global.stageHeight,n.designWidth=e.Global.SCREEN_WIDTH,n.designHeight=e.Global.SCREEN_HEIGHT,n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.resize()},i.prototype.init=function(){},i.prototype.show=function(e){void 0===e&&(e=null)},i.prototype.hide=function(e){void 0===e&&(e=null)},i.prototype.dispose=function(){this.hide(),this.parent&&this.parent.removeChild(this)},i.prototype.refresh=function(e){void 0===e&&(e=null)},i.prototype.resize=function(){},i.prototype.recvMsg=function(e,t){},i.prototype.onSwitch=function(e){},i.prototype.onStopMove=function(){},i.prototype.onHpChange=function(e){},i.prototype.onClickMap=function(e,t){},i.prototype.onMainActor=function(){},i}(eui.Component);e.BattleUI_Base=t,__reflect(t.prototype,"foxgame.BattleUI_Base",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){this.scene=null,this.actorManager=null,this.dropManager=null,this.mapManager=null,this.sceneManager=null,this.playerManager=null,this.battleType=null,this.battleInfo=null,this.listening=!1,this.scene=e.scene,this.actorManager=e.actorManager,this.dropManager=e.dropManager,this.mapManager=e.mapManager,this.sceneManager=e.sceneManager,this.playerManager=e.playerManager}return e.prototype.addListener=function(){this.listening||(this.listening=!0)},e.prototype.removeListener=function(){this.listening&&(this.listening=!1)},e.prototype.recvMsg=function(e,t){},e.prototype.onStateChange=function(e){},e.prototype.interruptState=function(e){},e.prototype.changeToState=function(e,t){},e.prototype.handleBattleInfo=function(e){},e.prototype.interruptBattle=function(){},e.prototype.releaseBattleRes=function(){this.actorManager.deleteActorForOther()},e.prototype.changeToScene=function(e){var t=this.sceneManager.sceneType,i=this.sceneManager.sceneId,n=this.scene.getStateManagerBySceneType(t,i);n.removeListener();var o=e.getSceneType(),a=e.getTargetSceneId(),s=this.scene.getStateManagerBySceneType(o,a);s.addListener(),this.sceneManager.setSceneTypeAndSceneId(o,a)},e.prototype.changeBattleMap=function(e,t){},e.prototype.setMainUIVisible=function(e){},e.prototype.setBattleUIVisible=function(e){},e.prototype.onTimeSwitchOver=function(e){},e.prototype.onTimerStopMove=function(){},e.prototype.getHpColorByBattleType=function(e,t,i){return""},e.prototype.onSelfDeath=function(e){},e.prototype.onSelfRelive=function(){},e}();e.StateManager_Base=t,__reflect(t.prototype,"foxgame.StateManager_Base",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.isTick=t,t&&(i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addedToStageHandler,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeFromStageHandler,i)),i}return __extends(t,e),t.prototype.addedToStageHandler=function(e){egret.startTick(this.tickHandler,this)},t.prototype.tickHandler=function(e){return this.tickHook(e),this.curTime=e,!0},t.prototype.tickHook=function(e){},t.prototype.removeFromStageHandler=function(e){egret.stopTick(this.tickHandler,this)},t.prototype.getcurTime=function(){return this.curTime},t}(eui.ItemRenderer);e.ItemRenderer1=t,__reflect(t.prototype,"foxgame.ItemRenderer1")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.JUESE=0]="JUESE",e[e.BEIBAO=1]="BEIBAO",e[e.CHIBANG=2]="CHIBANG",e[e.DUANZAO=3]="DUANZAO"}(t=e.MainBottomRedPoints||(e.MainBottomRedPoints={}));var i;!function(e){e[e.MainCity=1]="MainCity",e[e.Field=2]="Field"}(i=e.SceneType||(e.SceneType={}));var n=function(t){function n(){var e=t.call(this)||this;return e.timer1=null,e.equipNoticeInfo=0,e.lastRequestRankTime=egret.getTimer(),e.lastPanel=null,e._preX=0,e.len2=0,e.len1=0,e.len=0,n.instance&&(n.instance=null),n.instance=e,e.touchEnabled=!1,e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.uiCompHandler(),this.checkBagStatus(),this.refreshWeaponIconOperate();var i=this.localToGlobal();this.bagPosition=new egret.Point(i.x+this.group2.x,e.Global.stageHeight-(this.getBounds().height-this.group2.y)),this.redBallGroup.mask=this.redBallMask,this.blueBallGroup.mask=this.blueBallMask,e.UnionController.getInstance().setMessageToSeverAll(),App.MessageCenter.addListener(MessageCode.REFRESH_COIN,this.refreshWingRedTip,this),n.instance.setJueWeiRedImgVisble(e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_NOBILITY))},n.prototype.refreshHpBar=function(e){this.redBallMask&&(this.redBallMask.height=this.redBallGroup.height*e)},n.prototype.uiCompHandler=function(){this.initView(),this.noticeMap=null,this.noticeMap=new e.HashMap,e.Message.instance.add(e.MsgCMD.BOTTOM_NOTICE_EQUIP,this),e.Message.instance.add(e.MsgCMD.BOTTOM_NOTICE_PACKAGE,this),e.Message.instance.add(e.MsgCMD.BOTTOM_NOTICE_SKILL,this),e.Message.instance.add(e.MsgCMD.FIGHTFB_GOTO,this),e.Message.instance.add(e.MsgCMD.NEWBEEFORFIGHTCONTROLER,this),e.Message.instance.add(e.Code.SHOP_COIN_S,this),this.jueWeiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.equipPageBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.packagePageBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.unionBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.heroPageBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.wingBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),e.Message.instance.add(e.MsgCMD.SHOP_NOTICE_MAINBOTTON,this),this.timer1=new egret.Timer(100,0),this.timer1.addEventListener(egret.TimerEvent.TIMER,this.timercallback1,this),this.timer1.start()},n.prototype.timercallback1=function(){try{this.isInit&&(this.timer1.stop(),this.noticeMap.put(e.MsgCMD.WING_NOTICE_0831,0),this.setNotice(),this.timer1.removeEventListener(egret.TimerEvent.TIMER,this.timercallback1,this),e.Message.instance.add(e.MsgCMD.WING_NOTICE_0831,this))}catch(t){Log.trace("exception: "+t.toString()),console.error(t)}},n.prototype.show=function(){e.Message.instance.add(e.MsgCMD.NEWBEEFORFIGHTCONTROLER,this),e.Message.instance.add(e.MsgCMD.BOTTOM_NOTICE_EQUIP,this),e.Message.instance.add(e.MsgCMD.BOTTOM_NOTICE_PACKAGE,this),this.checkBagStatus()},n.prototype.update=function(e){},n.prototype.checkBagStatus=function(){if(0!=this.isInit){this.bagRedImg.visible=e.BagController.getInstance().getModel().getEnableBox();var t=e.BagController.getInstance().getFreeCellCount();if(0>=t)this.fullImg.visible=!0,this.bagNumGroup.visible=!1;else{var i=e.BagController.getInstance().checkBagMinCellCount();0==i?(this.bagCountLabel.text=t+"",this.fullImg.visible=!1,this.bagNumGroup.visible=!0):(this.fullImg.visible=!1,this.bagNumGroup.visible=!1)}}},n.prototype.close=function(){},n.prototype.dispose=function(){e.Message.instance.remove(e.MsgCMD.BOTTOM_NOTICE_EQUIP,this),e.Message.instance.remove(e.MsgCMD.BOTTOM_NOTICE_PACKAGE,this),e.Message.instance.remove(e.MsgCMD.FIGHTFB_GOTO,this),e.Message.instance.remove(e.MsgCMD.NEWBEEFORFIGHTCONTROLER,this),e.Message.instance.remove(e.MsgCMD.BOTTOM_SELECTANI,this),e.Message.instance.remove(e.MsgCMD.SET_expBarProgress,this),this.equipNotice.clear(),this.packageNotice.clear()},n.prototype.initView=function(){function t(t,i){return e.GameUtils.numberToString(100*t/i%100)+"%"}this.expBarProgress.touchEnabled=!1,this._rebBallAni=new e.FoxAni(this.redBallGroup),this._rebBallAni.play("red_ball"),this._blueBallAni=new e.FoxAni(this.blueBallGroup),this._blueBallAni.play("blue_ball");var i=new e.FoxAni(this.jeuweigroup);i.play("jeuweimovie"),e.Message.instance.add(e.MsgCMD.BOTTOM_SELECTANI,this),e.Message.instance.add(e.MsgCMD.SET_expBarProgress,this),this.equipNotice.visible=!1,this.packageNotice.visible=!1,this.setNotice(),this.expBarProgress.maximum=this.expBarProgress.thumb.width,this.expBarProgress.minimum=0,this.expBarProgress.labelFunction=t,e.MainControler.instance.initMainCityVisible(!0)},n.prototype.recvMsg=function(t,o){if(t==e.MsgCMD.FIGHTFB_GOTO?this.gotoHandler(o):t==e.MsgCMD.SET_expBarProgress?this.setExpBarProgress(o):(this.noticeMap.put(t,o),this.isInit&&this.setNotice()),t==e.MsgCMD.NEWBEEFORFIGHTCONTROLER)if(1==o)n.PageState=i.MainCity,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,i.MainCity),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.MAIN_SCENE_CLICK),e.MainControler.instance.initMainCityVisible(!1),e.MainSceneManager.instance.canMoveBg=!0,e.MainSceneManager.instance.moveBG();else if(2==o){var a=StageFrameControl.instance.getScrollViewport();e.MapViewportGroupManager.instance.sceneView.scH=a.scrollH,e.MapViewportGroupManager.instance.sceneView.scV=a.scrollV,n.PageState=i.Field,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,i.Field),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHT),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.BATTLE_SCENE_CLICK),e.MainControler.instance.initMainCityVisible(!0)}},n.prototype.setMaincityvisible=function(t){e.MainControler.instance.initMainCityVisible(t)},n.prototype.setExpBarProgress=function(e){this.expBarProgress.value=e*this.expBarProgress.maximum},n.prototype.setNotice=function(){if(null!=this.noticeMap){var t;for(var i in this.noticeMap)if(this.noticeMap.hasOwnProperty(i)&&(t=this.noticeMap.remove(i),i==e.MsgCMD.BOTTOM_NOTICE_EQUIP.toString()||i==e.MsgCMD.WING_NOTICE_0831.toString())){i==e.MsgCMD.BOTTOM_NOTICE_EQUIP.toString()&&(this.equipNoticeInfo=t);var n=this.setWingNoticeVisible(),o=0;1==this.equipNoticeInfo||1==n||1==o?this.equipNotice.setData():this.equipNotice.clear()}}},n.prototype.gotoHandler=function(t){switch(t){case 2:e.CharacterController.getInstance().showPanel();break;case 6:var o=StageFrameControl.instance.getScrollViewport();e.MapViewportGroupManager.instance.sceneView.scH=o.scrollH,e.MapViewportGroupManager.instance.sceneView.scV=o.scrollV,n.PageState=i.Field,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,i.Field),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHT),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.BATTLE_SCENE_CLICK),e.MainControler.instance.initMainCityVisible(!0)}},n.prototype.mainInToFuBen=function(){n.PageState==i.MainCity&&(n.PageState=i.Field,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,i.Field),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHT),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.BATTLE_SCENE_CLICK),e.MainControler.instance.initMainCityVisible(!0))},n.prototype.closeLastPanel=function(t){if(this.lastPanel)switch(this.lastPanel){case"CharacterController":e.CharacterController.getInstance().closePanel();break;case"BagController":e.BagController.getInstance().closePanel();break;case"SmeltController":e.SmeltController.getInstance().getPanel().close();break;case"WingController":e.BeautyController.getInstance().closePanel(),e.WingController.getInstance().closeWingView();break;case"ShopMainControler":e.ShopMainControler.getInstance().closePanel()}this.lastPanel=t},n.prototype.btnClick=function(t){var i=t.target;e.PlayerService.instance.mainRoleInfo;switch(i){case this.equipPageBtn:if(e.CharacterController.getInstance().getPanel().getIsShow())return;this.closeLastPanel("CharacterController"),e.CharacterController.getInstance().showPanel();break;case this.packagePageBtn:e.BagController.getInstance().getPanelIsShow()||(this.closeLastPanel("BagController"),e.BagController.getInstance().showPanel());break;case this.heroPageBtn:e.SmeltController.getInstance().getPanel().getIsShow()||(this.closeLastPanel("SmeltController"),e.SmeltController.getInstance().showPanel(e.SMELTTAPS.QIANGHUA));break;case this.wingBtn:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHIBANG))e.WingController.getInstance().getIsShow()||e.BeautyController.getInstance().getIsShow()||(this.closeLastPanel("WingController"),e.WingController.getInstance().showWingPanel());else{var n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHIBANG);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WINGOPEN",n))}break;case this.shopBtn:if(e.ShopMainControler.getInstance().getPanelIsShow())return;this.closeLastPanel("ShopMainControler"),e.ShopMainControler.getInstance().showPanel();break;case this.unionBtn:e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.GONGHUI);if(e.UnionController.getInstance().getPanelIsShow())return;this.closeLastPanel("UnionController"),e.UnionController.getInstance().openView(),33==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()));break;case this.jueWeiBtn:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.JUEWEI))e.NewJueweiController.getInstance().showPanel();else{var o=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.JUEWEI);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JUEWEIOPEN",o))}}},n.prototype.gotoField=function(){n.PageState=i.Field,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,i.Field),e.MainControler.instance.refreshPKPlayer(),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHT),e.BattleScene.instance.moveBG(),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.BATTLE_SCENE_CLICK),e.MainControler.instance.initMainCityVisible(!0)},n.prototype.setWingNoticeVisible=function(){if(e.PlayerService.instance.mainRoleInfo){var t=e.PlayerService.instance.playerInfo.getLevel();if(!(t<e.Global.WingOpenLimited))return 0}},n.prototype.getRoleGroup=function(){return this.group1},n.prototype.getBagGroup=function(){return this.group2},n.prototype.getheroGroup=function(){return this.group4},n.prototype.getWingGroup=function(){return this.group3},n.prototype.getUnionGroup=function(){return this.unionBtn},n.prototype.getWingGroupPoint=function(){var e=this.getWingGroup().localToGlobal(this.getWingGroup().width>>1,this.getWingGroup().height>>1);return e},n.prototype.gettheroGroupPoint=function(){var e=this.getheroGroup().localToGlobal(this.getheroGroup().width>>1,this.getheroGroup().height>>1);return e},n.prototype.getRoleGroupPoint=function(){var e=this.getRoleGroup().localToGlobal(this.getRoleGroup().width>>1,this.getRoleGroup().height>>1);return e},n.prototype.getBagPoint=function(){var e=this.getBagGroup().localToGlobal(this.getBagGroup().width>>1,this.getBagGroup().height>>1);return e},n.prototype.getBagGlobalPos=function(){var t=this.packagePageBtn.parent.localToGlobal(this.packagePageBtn.x,this.packagePageBtn.y);return t.x-=this.packagePageBtn.width/2,t.y-=this.packagePageBtn.height/2,t.y-=e.Global.heightChangeValue/2,t},n.prototype.getunionBtnPoint=function(){var e=this.getUnionGroup().localToGlobal(this.getUnionGroup().width>>1,this.getUnionGroup().height>>1);return e},n.prototype.refreshCharacterIconOperate=function(t){void 0===t&&(t=e.RedPointId.FUNC_MOST_MAINLY),0!=this.isInit&&(e.CharacterController.getInstance().isPanelShow()||(this.characterRedImg.visible=e.CharacterController.getInstance().checkOperate()))},n.prototype.refreshWeaponIconOperate=function(){0!=this.isInit&&(e.SmeltController.getInstance().getPanel().getIsShow()||(this.weaponRedTip.visible=e.SmeltController.getInstance().checkWeaponSysRedPoint()))},n.prototype.setUnionRedImgVisible=function(t){if(0!=this.isInit){this.unionRedTip.visible=t;var i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.GONGHUI,!1);i||(this.unionRedTip.visible=!1)}},n.prototype.setJueWeiRedImgVisble=function(t){0!=this.isInit&&(e.PlayerService.instance.playerInfo.getLevel()<10||(this.jueweiRedTip.visible=t))},n.prototype.refreshBagStatus=function(){this.checkBagStatus()},n.prototype.refreshWingRedTip=function(){0!=this.isInit&&(e.WingController.getInstance().getIsShow()||e.BeautyController.getInstance().getIsShow()||(this.wingRedTip.visible=e.WingController.getInstance().getOperate()||e.BeautyController.getInstance().redpoint()))},n.prototype.getJueWeiBtnPoint=function(){var e=this.jueWeiBtn.localToGlobal(this.jueWeiBtn.anchorOffsetX,this.jueWeiBtn.anchorOffsetY);return e},n.PageState=i.Field,n}(e.ViewControler);e.MainBottomControler=n,__reflect(n.prototype,"foxgame.MainBottomControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.skinName=t,i}return __extends(t,e),t.prototype.showPanel=function(){},t.prototype.refreshPanel=function(){},t}(eui.Component);e.BaseSharePanel=t,__reflect(t.prototype,"foxgame.BaseSharePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.put=function(e,t){this[e]=t},t.prototype.get=function(e){return this[e]},t.prototype.remove=function(e){var t=this[e];return t&&(this[e]=null,delete this[e]),t},t.prototype.contains=function(e){return null!=this[e]},t.prototype.keys=function(){var e=Object.keys(this),t=e.indexOf("_hashCode");return t>-1&&e.splice(t,1),t=e.indexOf("$hashCode"),t>-1&&e.splice(t,1),e},t.prototype.clear=function(){for(var e=this.keys(),t=e.length,i=0;t>i;i++){var n=this.remove(e[i]);n=null}},t}(egret.HashObject);e.HashMap=t,__reflect(t.prototype,"foxgame.HashMap")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.showBuff=null,this.list=[]}return e}();e.BuffList=t,__reflect(t.prototype,"foxgame.BuffList");var i=function(i){function n(){var n=i.call(this)||this;return n.iUnitHeight=e.Global.actorInSceneShadowModelHeight,n.modelLoadedFlag=!1,n.iCurTitleId=0,n.moveSpeed=.28,n.iDelayFinishCount=0,n.buffList=new t,n.roleLevel=0,n.roleSex=0,n.roleId=0,n.roleItemId=0,n.roleBelongPlayerId=0,n.serverId=0,n.lastHpUiUpdateTime=0,n.lastNameUiUpdateTime=0,n.lastCheckBodyBoundsTime=0,n.isBOSS=!1,n.stopMoveTime=0,n.onHpChange=null,n.curPos=new egret.Point,n.showByNeed=!0,n.showByDistance=!0,n.block=!1,n.blockVisible={},n.effectEnable=!0,n.moveChannel=null,n.isFreeWalk=!1,n.simpleConstructorInit(),n.maxMp=100,n.curMp=n.maxMp,n.direction=e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT,n.tiledMap=e.MapViewportGroupManager.instance.mapView.battleTitleMap,n}return __extends(n,i),n.prototype.simpleConstructorInit=function(){this.bodyNode=new egret.DisplayObjectContainer,this.bodyNode.name="bodyNode",this.effectHeightNode=new egret.DisplayObjectContainer,this.effectHeightNode.name="effectHeightNode",this.moveTextNode=new egret.DisplayObjectContainer,this.moveTextNode.name="moveTextNode",this.nameContainer=new egret.DisplayObjectContainer,this.nameContainer.name="nameContainer",this.bodyClip=new egret.MovieClip,this.bodyClip.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),this.halo=new egret.DisplayObjectContainer,this.addChild(this.halo),this.addChild(this.bodyNode),this.bodyNode.addChild(this.bodyClip),this.armorHalo=new egret.DisplayObjectContainer,this.bodyNode.addChild(this.armorHalo),this.armorHalo.y=-50,this.addChild(this.effectHeightNode),this.addChild(this.moveTextNode),this.addChild(this.nameContainer),this.nameContainer.y=-60,this.nameContainer.visible=!1,this.createShadow()},n.prototype.otherConstructorInit=function(){this.effectLowerNode=new egret.DisplayObjectContainer,this.effectLowerNode.name="effectLowerNode",this.addChildAt(this.effectLowerNode,0),this.weaponClip=new egret.MovieClip,this.weaponClip.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WEAPON),this.wingClip=new egret.MovieClip,this.wingClip.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WING),this.bodyNode.addChild(this.weaponClip),this.bodyNode.addChild(this.wingClip)},n.prototype.initializeNormalAttribute=function(){},n.prototype.createShadow=function(){if(null==this.shadowImg){this.shadowImg=new eui.Image,this.shadowImg.name="shadowImg";var e=RES.getRes("u_shadow2_png");e&&(this.shadowImg.texture=e,this.shadowImg.anchorOffsetX=this.shadowImg.width/2,this.shadowImg.anchorOffsetY=this.shadowImg.height/2,this.shadowImg.scaleX=this.shadowImg.scaleY=.5,this.addChild(this.shadowImg))}},n.prototype.updateHpWidget=function(t){if(void 0===t&&(t=!0),0==t){var i=egret.getTimer(),n=i-this.lastHpUiUpdateTime;if(100>n)return;this.lastHpUiUpdateTime=i}var o=this.curHp/1e4,a=this.maxHp/1e4;a>=100?o>=100?this.hpTextField.text=Math.floor(o)+e.LanguageUtils.instance.getValue("WAN")+"/"+Math.floor(a)+e.LanguageUtils.instance.getValue("WAN"):this.hpTextField.text=this.curHp+"/"+Math.floor(a)+e.LanguageUtils.instance.getValue("WAN"):this.hpTextField.text=this.curHp+"/"+this.maxHp,1!=this.maxHp||0!=this.curHp||this.isDead||(this.hpTextField.text="???/???"),this.hpTextField.strokeColor=0,this.hpTextField.stroke=1,this.hpTextField.textColor=15655878,this.hpTextField.size=18,this.hpTextField.fontFamily="宋体",this.hpTextField.anchorOffsetX=this.hpTextField.width/2-20;var s=-115;if(this.bodyClip&&this.bodyClip.getBounds()){var r=this.iUnitHeight;s=0-r+40}this.hpTextField.y=s,s+=25,this.hpBar.anchorOffsetX=this.hpBar.width/2,this.hpBar.anchorOffsetY=this.hpBar.height/2,this.hpBar.y=s,this.hpBar.visible=!0,1!=this.maxHp||0!=this.curHp||this.isDead?(this.maxHp<=0&&(this.maxHp=1),this.hpBar.setHpData(this.curHp/this.maxHp)):this.hpBar.setHpData(1),this.isBOSS&&e.BossBloodGroup.getInstance().setCurHP(this.curHp),this.onHpChange&&this.onHpChange(this)},n.prototype.updateNameLab=function(t){if(void 0===t&&(t=!0),0==t){var i=egret.getTimer(),n=i-this.lastNameUiUpdateTime;if(100>n)return;this.lastNameUiUpdateTime=i}this.nameTextField.text=""+this.roleName,this.nameTextField.strokeColor=0,this.nameTextField.stroke=1,this.nameTextField.textColor=15655878,this.nameTextField.size=18,this.nameTextField.fontFamily="宋体",this.isBOSS&&(this.nameTextField.textColor=16711680),this.blueInfo&&this.blueInfo.getIsBlueVip()&&(this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY)?e.Global.setBlueFont(this.blueTextField,this.blueInfo.getBlueVipLevel(),this.blueInfo.getIsBlueYearVip(),this.blueInfo.getIsSuperBlueVip()):(this.blueTextField.text="0",this.blueTextField.font="");var o=-90;if(this.bodyClip&&this.bodyClip.getBounds()){var a=this.bodyClip.getBounds().height*this.bodyClip.scaleY;a>this.iUnitHeight&&this.iUnitHeight==e.Global.actorInSceneShadowModelHeight&&(this.iUnitHeight=Math.min(200,a),this.roleType==e.RoleType.BEAUTY&&(this.iUnitHeight=e.Global.actorInSceneShadowModelHeight)),o=0-this.iUnitHeight+15}this.blueInfo&&1==this.blueInfo.getIsBlueYearVip()?this.blueWidth=40:this.blueWidth=20,this.nameTextField.anchorOffsetX=this.nameTextField.width/2,this.nameTextField.y=o,this.blueTextField.y=o+1,this.blueTextField.x=this.nameTextField.x-(this.nameTextField.width>>1)-this.blueWidth},n.prototype.createAndChangeTitle=function(t){if(this.iCurTitleId!=t){if(this.iCurTitleId=t,t>0){if(!this.titleGroup){this.titleGroup=new eui.Group,this.titleGroup.touchEnabled=!1,this.titleGroup.touchChildren=!1,this.titleImg=new eui.Image,this.titleGroup.addChild(this.titleImg),this.nameContainer.addChild(this.titleGroup);var i=-185;this.iUnitHeight>0&&(i=0-this.iUnitHeight-30),this.titleGroup.y=i}this.titleAnim||(this.titleAnim=new e.FoxAni(this.titleGroup),this.titleAnim.frameRate=6);var n=e.JsonDataManager.instance.medalTemplate[t];if(!n)return this.iCurTitleId=0,void egret.warn("createAndChangeTitle medalVO not exist, titleId:"+t);null!=n.animation?this.titleAnim.play(n.animation,"ani",-1):null!=n.icon1&&(null!=this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),App.getResourceUtils().getResAsync(n.icon1+"_png",function(e){this.titleImg&&(this.titleImg.source="",this.titleImg.source=n.icon1+"_png",this.titleImg.x=-e.textureWidth>>1,this.titleImg.y=-e.textureHeight>>1)},this)),this.titleGroup.visible=!0}else this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleImg&&(this.titleImg.source=""),this.titleGroup&&(this.titleGroup.visible=!1);this.iUnitHeight=e.Global.actorInSceneShadowModelHeight,this.checkBodyClipBoundsChange()}},n.prototype.setTitleImg=function(e){if(this&&this.titleImg){if(!e)return void egret.warn("ActorInScene_Base setTitleImg res texture null");this.titleImg.source=e,this.titleImg.x=-e.textureWidth>>1,this.titleImg.y=-e.textureHeight>>1}},n.prototype.updateTitleImgYHeight=function(){this.unionNameTF&&this.unionNameTF.text&&(this.unionNameTF.y=this.nameTextField.y-this.unionNameTF.height-8),this.titleGroup&&(this.titleGroup.y=this.nameTextField.y-50,this.unionNameTF&&this.unionNameTF.text&&(this.titleGroup.y=this.unionNameTF.y-50)),this.blueInfo&&this.blueInfo.getIsBlueVip()&&(this.blueTextField.x=this.nameTextField.x-(this.nameTextField.width>>1)-this.blueWidth),this.duanWeiPic&&(this.duanWeiPic.y=this.nameTextField.y+(this.nameTextField.height-17>>1)-11,this.blueInfo&&this.blueInfo.getIsBlueVip()?this.duanWeiPic.x=this.blueTextField.x-18-this.blueWidth:this.duanWeiPic.x=this.nameTextField.x-(this.nameTextField.width>>1)-50)},n.prototype.getPosition=function(){return this.curPos.x=this.x,this.curPos.y=this.y,this.curPos},n.prototype.setStateIdle=function(){this.actorState=e.EnumManager.ACTION_TYPE.ACTION_IDLE,this.stopMoveVoice(),this.modelController&&this.modelController.updateAction(this.actorState,this.direction)
},n.prototype.setStateRun=function(t){this.actorState=e.EnumManager.ACTION_TYPE.ACTION_RUN,this.playMoveVoice(),this.modelController&&this.modelController.updateAction(this.actorState,this.direction)},n.prototype.resetEffectState=function(e){1==e&&(this.bodyClip.filters=null)},n.prototype.tweenToResetEffect=function(e,t){this.tw=egret.Tween.get(this),this.tw.wait(e),this.tw.call(this.resetEffectState,this,[t])},n.prototype.cleanAllEffectState=function(){this.resetEffectState(1)},n.prototype.hideThis=function(){this.visible=!1},n.prototype.setStateDead=function(){var t=this;this.isDead=!0,this.actorState=e.EnumManager.ACTION_TYPE.ACTION_DEATH,this.stopMoveVoice();var i=egret.setTimeout(function(){egret.clearTimeout(i),t.isDead&&(t.visible=!1,t.cleanBuffList(),t.cleanAllEffectState(),e.BattleScene.instance.sceneBase&&e.BattleScene.instance.sceneBase.inUse?e.BattleScene.instance.sceneBase.onActorDead(t):t==e.BattleScene.instance.centerActor&&e.BattleScene.instance.refreshCenterActor())},this,200)},n.prototype.stopFreeWalk=function(e,t){this.isFreeWalk=e},n.prototype.freeWalkForWait=function(e,t,i){if(void 0===i&&(i=!1),!this.isFreeWalk){var n=300*Math.random(),o=300*Math.random(),a=e,s=t,r=Math.random();.25>r?(a+=Math.max(100,n),s+=Math.max(100,o)):.5>r?(a+=-1*Math.max(100,n),s+=Math.max(100,o)):.75>r?(a+=Math.max(100,n),s+=-1*Math.max(100,o)):1>r&&(a+=-1*Math.max(100,n),s+=-1*Math.max(100,o)),this.isFreeWalk=!0;var l=new egret.Point(Math.floor((this.x+a)/2),Math.floor((this.y+s)/2));i&&(l.x=e,l.y=t),this.moveToWorldPos_byLine(l,this.stopFreeWalk,!0,this,[!1])}},n.prototype.onTweenPosChange=function(){e.BattleScene.instance.moveBG(this.x,this.y)},n.prototype.checkBodyClipBoundsChange=function(){if(this.bodyClip&&this.bodyClip.getBounds()){var t=this.bodyClip.getBounds().height*this.bodyClip.scaleY;this.iUnitHeight==e.Global.actorInSceneShadowModelHeight&&t<=e.Global.actorInSceneShadowModelHeight&&(t=e.Global.actorInSceneShadowModelHeight),this.iUnitHeight<t&&(this.iUnitHeight=Math.min(200,t),this.roleType==e.RoleType.BEAUTY&&(this.iUnitHeight=e.Global.actorInSceneShadowModelHeight),this.updateNameLab(),this.updateHpWidget(),this.updateTitleImgYHeight())}},n.prototype.setModelHeight=function(e){this.iUnitHeight=e,this.updateNameLab(),this.updateHpWidget(),this.updateTitleImgYHeight()},n.prototype.moveToWorldPos_byLine=function(t,i,n,o,a){void 0===n&&(n=!1),void 0===o&&(o=null),void 0===a&&(a=null),this.stopMove(!1),this.setTweenObject();var s=egret.Point.distance(this.getPosition(),t);this.direction=e.Astar.instance.judgeNextDirection(this.getPosition(),t);var r=["moveToWorldPos_byLine tween call me"];this.tw.call(this.setStateRun,this,r).to({x:t.x,y:t.y},s/this.moveSpeed),i&&(o?(a=a?a.concat(r):r,this.tw.call(i,o,a)):this.tw.call(i,this)),n&&this.tw.call(this.stopMove,this,[!0,egret.getTimer()])},n.prototype.delayMoveToWorldPos_byLine=function(e,t,i,n,o,a,s){void 0===o&&(o=!1),void 0===a&&(a=null),void 0===s&&(s=null),this.tw=egret.Tween.get(this),this.tw.wait(e),t?this.tw.call(t,a,[this,i,n,o,a,s]):this.tw.call(this.moveToWorldPos_byLine,this,[i,n,o,a,s])},n.prototype.moveToWorldPos_byLinePath=function(t){this.setTweenObject(),this.actorState=e.EnumManager.ACTION_TYPE.ACTION_RUN;for(var i,n,o=this.getPosition(),a=0;a<t.length;a++)if(n=t[a],i=egret.Point.distance(o,n),!(0>=i)){this.direction=e.Astar.instance.judgeNextDirection(o,n);var s=["moveToWorldPos_byLine tween call me"];this.tw.call(this.setStateRun,this,s).to({x:n.x,y:n.y},i/this.moveSpeed),o=t[a]}this.tw.call(function(){},this),this.tw.call(this.stopMove,this,[!0,egret.getTimer()])},n.prototype.moveToTilePos_byAStar=function(t,i){void 0===i&&(i=null);var n=this.getPosition(),o=this.tiledMap.SpaceToTiled(n),a=this.tiledMap.SpaceToTiled(t),s=e.Astar.instance.findPath(o,a,this.tiledMap);this.setTweenObject(),this.actorState=e.EnumManager.ACTION_TYPE.ACTION_RUN,this.modelController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_RUN,this.direction);for(var r,l,h=o,c=1;c<s.length;c++){l=this.tiledMap.TiledToSpace(s[c]),r=egret.Point.distance(this.tiledMap.SpaceToTiled(h),l),this.direction=e.Astar.instance.judgeNextDirection(h,s[c]);var u=["moveToWorldPos_byLine tween call me"];this.tw.call(this.setStateRun,this,u).to({x:l.x,y:l.y},r/this.moveSpeed),h=s[c]}this.tw.call(this.stopMove,this,[!0,egret.getTimer()])},n.prototype.moveToPos_forceMove=function(t){var i=e.BattleScene.instance.getBattleMoveBgMapSize(),n=e.Global.stageWidth/4,o=e.Global.stageHeight/4;t.x<n&&(t.x=n),t.y<o&&(t.y=o),t.x>i.x-n&&(t.x=i.x-n),t.y>i.y-o&&(t.y=i.y-o);var a=egret.Point.distance(this.getPosition(),t);this.setTweenObject(),this.tw.to({x:t.x,y:t.y},a/(2*this.moveSpeed)),this.tw.call(this.setStateIdle,this)},n.prototype.stopMove=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=egret.getTimer()),t<this.stopMoveTime||(this.stopMoveTime=egret.getTimer(),null!=this.tw&&(this.tw.pause(),this.tw=null),egret.Tween.pauseTweens(this),egret.Tween.removeTweens(this),e&&this.setStateIdle())},n.prototype.getBattleKeepTime=function(){return egret.getTimer()-this.battleStarTime},n.prototype.playAni=function(t){this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.upStarAni=new e.FoxAni(this.halo),this.upStarAni.play(t,"ani")},n.prototype.playArmorAni=function(t){this.armorAni&&(this.armorAni.clear(),this.armorAni=null),""!=t&&null!=t&&(this.armorAni=new e.FoxAni(this.armorHalo),this.armorAni.play(t,"ani"))},n.prototype.updateBattleData=function(t,i){if(this.x=t.getInitPos().getX(),this.y=t.getInitPos().getY(),this.fightRoleData=t,this.simpleRole=t.getRole(),this.battleStarTime=egret.getTimer(),null!=this.fightRoleData.getActions()&&this.fightRoleData.getActions().length>0?(this.filmActions=this.fightRoleData.getActions(),this.isInBattle=!0):(this.isInBattle=!1,this.iDelayFinishCount=0,this.battleFilmOver()),this.maxHp=Number(t.getMaxHp()),this.curHp=Number(t.getCurHp()),this.roleLevel=t.getRole().getLevel(),this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY||this.roleType==e.RoleType.BEAUTY)this.roleName=t.getRole().getName(),this.blueInfo=t.getRole().getQqBlueInfo();else{var n="Lv"+this.roleLevel+" "+t.getRole().getName();this.roleName=n}this.shadowImg.visible=!0;var o=t.getRole();if(o.getWardLevel()){var a=e.JsonDataManager.instance.dragonGuardTemplate[o.getWardLevel()],s=o.getWardLevel();(null==o.getWardLevel()||0==o.getWardState())&&(s=0),0==s?(this.shadowImg.visible=!0,this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null)):(this.playAni(a.effect2),this.shadowImg.visible=!1)}if(o.getDragonArmourGuardLevel()){var r=e.JsonDataManager.instance.dragonArmorGuardTemplate[o.getDragonArmourGuardLevel()];o.getDragonArmourGuardLevel()&&1==o.getDragonArmourShowGuard()?this.playArmorAni(r.effect2):this.playArmorAni("")}this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,t.getRole().getRoleItemId()),this.isFreeWalk=!1,this.curHp<=0?(this.setStateDead(),this.visible=!1):(this.visible=!0,this.isDead=!1),this.hpBar||(this.hpBar=new e.BattleHPBar(e.RoleType.MONSTER),this.nameContainer.addChild(this.hpBar));var l=t.getRole().getMonsterId();if(l){var h=e.JsonDataManager.instance.monster[l];if(this.hpBar.setActroType(e.RoleType.MONSTER),(5==t.getRole().getType()||4==t.getRole().getType())&&this.hpBar.setActroType(e.RoleType.MAIN_ROLE),t.getRole().getType()==e.RoleType.BEAUTY){this.updateHpWidget();var c=e.ActionUtils.CreateActionInfoByMonsterId(l);this.modelController&&this.modelController.refreshAction(c)}if(h&&"0"!=String(h.isBoss)){this.isBOSS=!0,this.bodyClip.scaleX=h.modelScale,this.bodyClip.scaleY=h.modelScale,this.hpBar.scaleX=1.5,this.hpBar.scaleY=1.2,this.nameTextField.y=this.nameTextField.y-30,this.hpTextField.y=this.hpTextField.y-30,this.bossRing||(this.bossRing=new e.FoxAni(this),this.bossRing.anchorCenter=!0),i.getBattleType()==e.BattleType.BATTLE_PVE_BOSS?this.bossRing.play("gkBOSSgh","ani",-1):this.bossRing.play("BOSSgh","ani",-1),this.setChildIndex(this.bossRing.mcObject,0);var u=this.fightRoleData.getRole().getMonsterId(),p=i.getBattleType();switch(p){case e.BattleType.BATTLE_UNION_BOSS:e.BossBloodGroup.getInstance().showPanel(u,this.curHp,!1,!1);break;case e.BattleType.GHOST_TOWER:e.BossBloodGroup.getInstance().showPanel(u,this.curHp,!1);break;case e.BattleType.RUINS_BATTLE_TYPE:e.BossBloodGroup.getInstance().showPanel(u,this.curHp,!1,!1);break;default:p!=e.BattleType.BATTLE_PVE_BOSS&&p!=e.BattleType.DAY_COPY&&e.BossBloodGroup.getInstance().showPanel(u,this.curHp)}}}else this.hpBar.setActroType(e.RoleType.MAIN_ROLE);if(parseInt(t.getFightRoleType().toString())==e.FightRoleType.OFFENCE){this.hpBar.setActroType(e.RoleType.MAIN_ROLE);e.PlayerService.instance.playerInfo.getPlayerId();t.getRole().getPlayerId()>0&&this.createAndChangeTitle(t.getRole().getTitleId())}else e.FightRoleType.DEFENCE==parseInt(t.getFightRoleType().toString())&&(this.hpBar.setActroType(e.RoleType.MONSTER),(this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY)&&this.createAndChangeTitle(t.getRole().getTitleId()));this.updateHpWidget(!0)},n.prototype.battleFrameUpdate=function(){if(this.isInBattle&&this.filmActions){if(this.nameContainer.visible=!0,this.filmActions.length<=0)return void(this.iDelayFinishCount>5?(this.isInBattle=!1,this.iDelayFinishCount=0,this.battleFilmOver()):this.iDelayFinishCount++);if(this.filmActions[0].getTimestamp()*e.Global.battleSpeedRatio<=this.getBattleKeepTime()){this.currentAtion=this.filmActions.shift();var t=this.curHp,i=this.maxHp;this.curHp=Number(this.currentAtion.getCurHp()),this.maxHp=Number(this.currentAtion.getMaxHp()),this.curHp<=0?this.setStateDead():this.hpBar.visible=!0,(this.curHp!=t||this.maxHp!=i)&&(this.updateNameLab(!1),this.updateHpWidget(!1)),this.isBOSS&&e.BossBloodGroup.getInstance().setCurHP(this.curHp),null!=this.currentAtion.getMove()&&this.filmProcess_moveTo(),null!=this.currentAtion.getHurt()&&this.filmProcess_hurt(),this.filmProcess_buff(),null!=this.currentAtion.getSkill()&&this.filmProcess_skill()}}},n.prototype.battleFilmOver=function(){if(e.BattleScene.instance.finishedFilmActors&&e.BattleScene.instance.finishedFilmActors.push(this),(this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY)&&this.roleSex>0&&this.curHp<=0){var t="maleDie";this.roleSex>1&&(t="femaleDie"),1!=e.MainBottomControler.PageState&&App.SoundManager().playBattleSkillEffect(t)}},n.prototype.filmProcess_moveTo=function(){this.actorState==e.EnumManager.ACTION_TYPE.ACTION_RUN&&this.stopMove();var t=this.currentAtion.getMove();if(this.moveSpeed=t.getISpeed()/100,t.getIsForcePush())this.moveSpeed=this.moveSpeed/2,this.moveToPos_forceMove(new egret.Point(t.getMovePath()[0],t.getMovePath()[1]));else{for(var i=t.getMovePath(),n=new Array,o=0;o<i.length;o+=2)n.push(new egret.Point(i[o],i[o+1]));this.moveToWorldPos_byLinePath(n)}},n.prototype.filmProcess_skill=function(){for(var t=this,i=e.SkillActionManager.instance,n=this.currentAtion.getSkill(),o=n.getSkillId(),a=[],s=[],r=0;r<n.getTargets().length;r++){var l=n.getTargets()[r],h=e.BattleScene.instance.getUnitById(l);h&&(a.push(h),s.push(l))}var c=0;1302==o&&(c=1);var u=i.SkillEffectCfg[o];if(u){if(a.length>0){if(!this)throw new Error("this null filmProcess_skill skillId： "+o);if(!a[0])throw new Error("targets[0] null filmProcess_skill skillId： "+o);this.direction=e.Astar.instance.judgeNextDirection(this.getPosition(),a[0].getPosition())}var p=a.length>0?a[0].getPosition():null;i.playCasterAction(u,this,p);var g=~~u.castEffect,d=~~u.hitEffect,f=~~u.bulletEffect,m=0;if(0==u.bullet&&(m=f,f=0),0!=g)var y=egret.setTimeout(function(){egret.clearTimeout(y),i.playCasterEffect(g,t,null);try{if(t.roleSex>0&&u.soundPath){var n=""+t.roleSex,o=u.soundPath.replace("[gender]",n);1!=e.MainBottomControler.PageState&&App.SoundManager().playBattleSkillEffect(o)}}catch(a){Log.trace(a)}},this,u.castEffectTime);this.tw=egret.Tween.get(this),this.tw.wait(u.bulletEffectDelayTime),1==u.bullet?this.tw.call(i.playBallisticEffectByUnit,i,[f,d,this,s,null]):this.tw.call(i.playActionEffectByUnit,i,[d,this,s,null]),m>0&&this.tw.call(i.playActionEffectByUnit,i,[m,this,s,null])}},n.prototype.filmProcess_hurt=function(t){void 0===t&&(t=0);var i,n=this.currentAtion.getHurt();n.getFromRoleId();switch(n.getEffect()){case e.SkillEffect.SKILL_HARM:0!=n.getAttrValue()&&(i=new e.BattleMoveText(this.getPosition(),n.getAttrValue().toString(),e.SkillEffect.SKILL_HARM,0,t));break;case e.SkillEffect.MISS_DMG:i=new e.BattleMoveText(this.getPosition(),n.getAttrValue().toString(),e.SkillEffect.MISS_DMG,0,t);break;case e.SkillEffect.CRIT_DMG:if(0!=n.getAttrValue()){var o=Math.abs(n.getAttrValue());i=new e.BattleMoveText(this.getPosition(),o.toString(),e.SkillEffect.CRIT_DMG,0,t)}break;case e.SkillEffect.ADD_HP:i=new e.BattleMoveText(this.getPosition(),n.getAttrValue().toString(),e.SkillEffect.ADD_HP,0,t);break;case e.SkillEffect.RECOVER:this.bodyNode.visible=!0,this.shadowImg.visible=!0,this.nameTextField.visible=!0,this.visible=!0,this.isDead=!1,this.updateHpWidget();break;case e.SkillEffect.MABI:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.MABI,0,t);break;case e.SkillEffect.WUDI:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.WUDI,0,t);break;case e.SkillEffect.HUTIDUN:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.HUTIDUN,0,t);break;case e.SkillEffect.DEADLY_DMG:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.DEADLY_DMG,0,t);break;case e.SkillEffect.SHEN_JUAN:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.SHEN_JUAN,0,t);break;case e.SkillEffect.SHEN_JUAN:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.SHEN_JUAN,0,t);break;case e.SkillEffect.ZAI_SHENG:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.ZAI_SHENG,0,t);break;case e.SkillEffect.ZHEN_SHE:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.ZHEN_SHE,0,t);break;case e.SkillEffect.FAN_JI:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.FAN_JI,0,t);break;case e.SkillEffect.BU_QU:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.BU_QU,0,t);break;case e.SkillEffect.ZI_BAO:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.ZI_BAO,0,t);break;case e.SkillEffect.SI_ZHOU:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.SI_ZHOU,0,t);break;case e.SkillEffect.PO_JIA:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.PO_JIA,0,t);break;case e.SkillEffect.SHI_XUE:i=new e.BattleMoveText(new egret.Point(this.x,this.y-40),n.getAttrValue().toString(),e.SkillEffect.SHI_XUE,0,t);break;default:Log.trace("HurtAction无法解析的伤害类型 hurteffect : "+n.getEffect())}e.SkillActionManager.instance.hurtSkillAction(n,this)},n.prototype.filmProcess_buff=function(){var t=this.currentAtion.getBuff();if(t){var i=t.getBuffId();if(i==e.FightBuff.PARALYZED||i==e.FightBuff.PROTECTIVE_SHIELD)return void new e.BattleMoveText(new egret.Point(this.x,this.y-40),"",i,1);if(i==e.FightBuff.DMG_IMMUNITY)return this.bodyNode.visible=!0,this.shadowImg.visible=!0,this.nameTextField.visible=!0,this.visible=!0,this.isDead=!1,this.updateHpWidget(),void new e.BattleMoveText(new egret.Point(this.x,this.y-40),"",i,1)}var n=null;t&&(n=e.Buff.createBuffByAction(t),this.buffList.list.push(n),n.index=this.buffList.list.length-1);for(var o=this.buffList.list.length,a=o;a--;){var s=this.buffList.list[a];s.update(this)&&(this.buffList.showBuff==s&&(this.buffList.showBuff=null),s==n&&(n=null),this.buffList.list.splice(a,1))}n&&(this.buffList.showBuff=n,this.buffList.showBuff.show(this)),o=this.buffList.list.length;for(var r=0;o>r;++r){var s=this.buffList.list[r];s.index=r}null==this.buffList.showBuff&&o>0&&(this.buffList.showBuff=this.buffList.list[o-1])},n.prototype.cleanBuffList=function(){var e=this.buffList.list.length;if(!(0>=e)){for(var t=0;e>t;++t){var i=this.buffList.list[t];i.stopBuffEffect(this)}this.buffList.list.splice(0,this.buffList.list.length),this.buffList.list=[],this.buffList.showBuff=null}},n.prototype.playSkillTarget=function(t,i,n,o,a){for(var s=this,r=e.SkillActionManager.instance,l=[],h=0;h<i.length;h++);var c=r.SkillEffectCfg[t];if(!c)return void console.error("playSkillTarget no effectInfo, skillId: "+t);if(i.length>0){if(!this)throw new Error("this null playSkillTarget skillId： "+t);if(!i[0])throw new Error("targets[0] null playSkillTarget skillId： "+t);this.direction=e.Astar.instance.judgeNextDirection(this.getPosition(),i[0].getPosition())}var u=i.length>0?i[0].getPosition():null;r.playCasterAction(c,this,u);var p=~~c.castEffect,g=~~c.hitEffect,d=~~c.bulletEffect,f=0;if(0==c.bullet&&(f=d,d=0),0!=p)var m=egret.setTimeout(function(){egret.clearTimeout(m),r.playCasterEffect(p,s,null);try{if(s.roleSex>0&&c.soundPath){var t=""+s.roleSex,i=c.soundPath.replace("[gender]",t);1!=e.MainBottomControler.PageState&&s.effectEnable&&s.showByDistance&&App.SoundManager().playBattleSkillEffect(i)}}catch(n){Log.trace(n)}},this,c.castEffectTime);this.tw=egret.Tween.get(this),this.tw.wait(c.bulletEffectDelayTime),1==c.bullet?this.tw.call(r.playBallisticEffectByTargets,r,[d,g,this,i,null,this,null]):this.tw.call(r.playActionEffectByTargets,r,[g,this,i,null,this,null]),f>0&&this.tw.call(r.playActionEffectByUnit,r,[f,this,l,null]),null!=n&&null!=o&&this.tw.call(n,o,a)},n.prototype.deleteThis=function(){null!=this.tw&&(this.tw.pause(),this.tw=null),egret.Tween.pauseTweens(this),egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this),null!=this.modelController&&(this.modelController.release(),this.modelController=null),this.filmActions=null,this.currentAtion=null,this.fightRoleData=null,this.simpleRole=null,this.cleanBuffList(),this.cleanAllEffectState(),this.bossRing&&(this.bossRing.dispose(),this.bossRing=null),egret.Tween.pauseTweens(this.bodyNode),egret.Tween.removeTweens(this.bodyNode),egret.Tween.pauseTweens(this.moveTextNode),egret.Tween.removeTweens(this.moveTextNode),egret.Tween.pauseTweens(this.nameContainer),egret.Tween.removeTweens(this.nameContainer),this.effectLowerNode&&(egret.Tween.pauseTweens(this.effectLowerNode),egret.Tween.removeTweens(this.effectLowerNode)),this.effectHeightNode&&(egret.Tween.pauseTweens(this.effectHeightNode),egret.Tween.removeTweens(this.effectHeightNode)),this.titleGroup&&(this.titleGroup.removeChildren(),this.titleImg&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.titleImg,"titleImg",!1,e.CharacterController.getInstance().getPanel().getUiBaseName()),this.titleImg.source=null),this.titleAnim&&this.titleAnim.clear(),this.titleImg=null,this.titleAnim=null,this.titleGroup=null),this.duanWeiPic&&(this.duanWeiPic.parent.removeChild(this.duanWeiPic),this.duanWeiPic.source=null,this.duanWeiPic=null),this.bodyNode.removeChildren(),this.moveTextNode.removeChildren(),this.nameContainer.removeChildren(),this.effectLowerNode&&this.effectLowerNode.removeChildren(),this.effectHeightNode&&this.effectHeightNode.removeChildren(),this.armorAni&&(this.armorAni.clear(),this.armorAni=null),this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.removeChildren()},n.prototype.setTweenObject=function(){e.BattleScene.instance.centerActor&&e.BattleScene.instance.centerActor==this?this.tw=egret.Tween.get(this,{onChange:this.onTweenPosChange,onChangeObj:this}):this.tw=egret.Tween.get(this)},n.prototype.refreshAction=function(e){if(this.fightRoleData=e,this.simpleRole=e.getRole(),this.battleStarTime=egret.getTimer(),null!=this.fightRoleData.getActions()&&this.fightRoleData.getActions().length>0)this.isDead&&(this.isDead=!1,this.x=e.getInitPos().getX(),this.y=e.getInitPos().getY(),this.visible=!0),this.cleanBuffList(),this.cleanAllEffectState(),this.filmActions=this.fightRoleData.getActions(),this.isInBattle=!0;else{if(!this.isDead){var t=Number(e.getCurHp());0>=t&&this.setStateDead()}this.isInBattle=!1,this.iDelayFinishCount=0,this.battleFilmOver()}},n.prototype.filterAction=function(t){if(this.filmActions&&this.filmActions.length>0){for(var i=[],n=0;n<this.filmActions.length;n++){var o=this.filmActions[n],a=o.getTimestamp()*e.Global.battleSpeedRatio;a>t&&i.push(o)}this.filmActions=i}},n.prototype.setModelControllerEnable=function(t){if(t){if(!this.modelController){var i=this.simpleRole;!i&&this.fightRoleData&&(i=this.fightRoleData.getRole()),i&&(this.modelController=e.ActionUtils.CreateBattleUnitBySimpleRole(i,this.bodyNode),this.modelController.onCharLoaded=this.modelLoaded.bind(this))}}else null!=this.modelController?(this.modelController.release(),this.modelController=null):this.iUnitHeight==e.Global.actorInSceneShadowModelHeight&&this.setModelHeight(e.Global.actorInSceneShadowModelHeight)},n.prototype.modelLoaded=function(t){this.modelLoadedFlag||(this.modelLoadedFlag=!0,this.iUnitHeight=e.Global.actorInSceneShadowModelHeight,this.checkBodyClipBoundsChange())},n.prototype.showName=function(){this.nameContainer.visible=!0},n.prototype.updateFromSimpleRole=function(e){},n.prototype.updataDuanByPlayerLevel=function(e){},n.prototype.moveToPosByLine=function(t,i,n,o){this.stopMove(!1);var a=egret.Point.distance(this.getPosition(),t),s=e.Astar.instance.judgeNextDirection(this.getPosition(),t);(this.actorState!=e.EnumManager.ACTION_TYPE.ACTION_RUN||s!=this.direction)&&(this.direction=s,this.setStateRun(null)),this.setTweenObject(),this.tw.to({x:t.x,y:t.y},a/this.moveSpeed),i&&this.tw.call(i,n,o),this.tw.call(function(e,t){this.stopMove(e,t)},this,[!0,egret.getTimer()])},n.prototype.showBossRing=function(t){this.bossRing||(this.bossRing=new e.FoxAni(this),this.bossRing.anchorCenter=!0),t==e.BattleType.BATTLE_PVE_BOSS?this.bossRing.play("gkBOSSgh","ani",-1):this.bossRing.play("BOSSgh","ani",-1),this.setChildIndex(this.bossRing.mcObject,0)},n.prototype.showNameTitle=function(){var e=this.modelLoaded;this.modelLoaded=function(t){e.call(this,t),this.hpBar.visible=!1}.bind(this),this.hpBar.visible=!1,this.updateHpWidget=function(){},this.hpTextField.visible=!1,this.nameTextField.visible=!0,this.titleGroup&&(this.titleGroup.visible=!0),this.nameContainer.y+=20,this.nameContainer.visible=!0},n.prototype.playMoveVoice=function(){if(1!=e.MainBottomControler.PageState&&this.visible&&this.roleType==e.RoleType.MAIN_ROLE){var t=e.PlayerService.instance.playerInfo.getPlayerId();this.roleBelongPlayerId==t&&(this.moveChannel||(this.moveChannel=App.SoundManager().playEffectLoop("actorMove_mp3")))}},n.prototype.stopMoveVoice=function(){if(this.roleType==e.RoleType.MAIN_ROLE){var t=e.PlayerService.instance.playerInfo.getPlayerId();this.roleBelongPlayerId==t&&this.moveChannel&&(this.moveChannel.stop(),this.moveChannel=null)}},n.prototype.setBlock=function(e){e!=this.block&&(this.block=e,this.block?(this.bodyNode?(this.blockVisible.bodyNode=this.bodyNode.visible,this.bodyNode.visible=!1):this.blockVisible.bodyNode=!0,this.halo?(this.blockVisible.halo=this.halo.visible,this.halo.visible=!1):this.blockVisible.halo=!0,this.effectHeightNode?(this.blockVisible.effectHeightNode=this.effectHeightNode.visible,this.effectHeightNode.visible=!1):this.blockVisible.effectHeightNode=!0,this.shadowImg?(this.blockVisible.shadowImg=this.shadowImg.visible,this.shadowImg.visible=!1):this.blockVisible.shadowImg=!0,this.bossRing&&this.bossRing.mcObject?(this.blockVisible.bossRing=this.bossRing.mcObject.visible,this.bossRing.mcObject.visible=!1):this.blockVisible.bossRing=!0,this.moveTextNode?(this.blockVisible.moveTextNode=this.moveTextNode.visible,this.moveTextNode.visible=!1):this.blockVisible.moveTextNode=!0,this.effectLowerNode?(this.blockVisible.effectLowerNode=this.effectLowerNode.visible,this.effectLowerNode.visible=!1):this.blockVisible.effectLowerNode=!0,this.nameContainer&&this.titleGroup?(this.blockVisible.titleGroup=this.titleGroup.visible,this.titleGroup.visible=!1):this.blockVisible.titleGroup=!0):(this.bodyNode&&(this.bodyNode.visible=!!this.blockVisible.bodyNode),this.halo&&(this.halo.visible=!!this.blockVisible.halo),this.effectHeightNode&&(this.effectHeightNode.visible=!!this.blockVisible.effectHeightNode),this.shadowImg&&(this.shadowImg.visible=!!this.blockVisible.shadowImg),this.bossRing&&this.bossRing.mcObject&&(this.bossRing.mcObject.visible=!!this.blockVisible.bossRing),this.moveTextNode&&(this.moveTextNode.visible=!!this.blockVisible.moveTextNode),this.effectLowerNode&&(this.effectLowerNode.visible=!!this.effectLowerNode.moveTextNode),this.nameContainer&&this.titleGroup&&(this.titleGroup.visible=!!this.blockVisible.titleGroup)))},n}(egret.DisplayObjectContainer);e.ActorInScene_Base=i,__reflect(i.prototype,"foxgame.ActorInScene_Base")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.prototype.init=function(t){this.id=parseInt(t.id),this.name=t.name,this.bossMapID=parseInt(t.bossMapID),this.bossId=parseInt(t.bossId),this.icon=t.icon,this.monsterLevelRange=parseInt(t.monsterLevelRange),this.dropRate=parseInt(t.dropRate),this.mapGroup=parseInt(t.mapGroup),this.limitLevel=parseInt(t.limitLevel),this.battleIcon=t.battleIcon,this.zoomRatio=parseInt(t.zoomRatio),this.rotation=parseInt(t.rotation),this.extraCost=new e.AttributeVO(t.extraCost),this.extraCost2=new e.AttributeVO(t.extraCost2),this.fixedDrop=[];for(var i,n=t.fixedDrop.split(","),o=0;o<n.length;++o)i=new e.AttributeVO(n[o]),this.fixedDrop.push(i);this.dropPreview=[];for(var a,s=t.dropPreview.split(","),o=0;o<s.length;o++)a=new e.AttributeVO(s[o]),this.dropPreview.push(a);var r=t.mapLattices.split(",");this.mapXGrid=~~r[0],this.mapYGrid=~~r[1],this.mapJump=t.mapJump,this.avgExpPerHour=parseInt(t.avgExpPerHour),this.avgCoinPerHour=parseInt(t.avgCoinPerHour)},t}();e.MapVO=t,__reflect(t.prototype,"foxgame.MapVO")}(foxgame||(foxgame={}));var Platform=function(){function e(){}return e.prototype.init=function(){},e}();__reflect(Platform.prototype,"Platform");var foxgame;!function(e){var t=function(){function e(){}return e.HEART_BEAT=3,e.ERROR=4,e.RECHARGE_REQUEST=5,e.RECHARGE_RESPONSE=6,e.SYNC_START_C=1005,e.SYNC_START_S=1006,e.LEGENDS_UPREMACY_INFO_C=95011,e.LEGENDS_UPREMACY_INFO_S=95012,e.LEGENDS_UPREMACY_CHALLENGE_C=95013,e.LEGENDS_UPREMACY_CHALLENGE_S=95014,e.LEGENDS_UPREMACY_BUFF_BUY_C=95015,e.LEGENDS_UPREMACY_BUFF_BUY_S=95016,e.LEGENDS_UPREMACY_PACKAGE_C=95017,e.LEGENDS_UPREMACY_PACKAGE_S=95018,e.LEGENDS_UPREMACY_AWARD_C=95019,e.LEGENDS_UPREMACY_AWARD_S=95020,e.LEGENDS_UPREMACY_RESET_C=95021,e.LEGENDS_UPREMACY_RESET_S=95022,e.LEGENDS_UPREMACY_RESET_BUY_C=95023,e.LEGENDS_UPREMACY_RESET_BUY_S=95024,e.LEGENDS_UPREMACY_RESURRECTION_BUY_C=95027,e.LEGENDS_UPREMACY_RESURRECTION_BUY_S=95028,e.LEGENDS_UPREMACY_BUFF_INFO_S=95029,e.ESCORT_PRISONER_INFO_C=95030,e.ESCORT_PRISONER_INFO_S=95031,e.START_ESCORT_PRISONER_C=95032,e.START_ESCORT_PRISONER_S=95033,e.ESCORT_PRISONER_ACCESS_AWAY_C=95034,e.ESCORT_PRISONER_ACCESS_AWAY_S=95035,e.ESCORT_PRISONER_RECEIVE_AWARD_INFO_C=95036,e.ESCORT_PRISONER_RECEIVE_AWARD_INFO_S=95037,e.ESCORT_PRISONER_RECEIVE_AWARD_C=95038,e.ESCORT_PRISONER_RECEIVE_AWARD_S=95039,e.ESCORT_PRISONER_REFRESH_QUALITY_C=95040,e.ESCORT_PRISONER_REFRESH_QUALITY_S=95041,e.ESCORT_PRISONER_ONE_REFRESH_C=95042,e.ESCORT_PRISONER_ONE_REFRESH_S=95043,e.ESCORT_PRISONER_LOG_INFO_C=95044,e.ESCORT_PRISONER_LOG_INFO_S=95045,e.ESCORT_PRISONER_VENGEANCE_C=95046,e.ESCORT_PRISONER_VENGEANCE_S=95047,e.ESCORT_PRISONER_PLUNDER_C=95048,e.ESCORT_PRISONER_PLUNDER_S=95049,e.ESCORT_QUICKLY_PRISONER_C=95050,e.ESCORT_QUICKLY_PRISONER_S=95051,e.ESCORT_ANOTHER_BATCH_C=95052,e.ESCORT_ANOTHER_BATCH_S=95053,e.CHECK_CDK_CAN_USE_C=16009,e.CHECK_CDK_CAN_USE_S=16010,e.SHARE_WECHAT_REWARD_C=82111,e.SHARE_WECHAT_REWARD_S=82112,e.GAME_SHANRING_C=82113,e.GAME_SHANRING_S=82114,e.GAME_FOLLOW_GET_STATE_C=82119,e.GAME_FOLLOW_GET_STATE_S=82120,e.CHANNEL_ATTENTION_AWARD_C=96542,e.GAME_FOLLOW_GET_AWARD_C=82121,e.GAME_FOLLOW_GET_AWARD_S=82122,e.GAME_SHANRING_SHOW_C=82115,e.GAME_SHANRING_SHOW_S=82116,e.GAME_INVITATIONS_C=82117,e.GAME_INVITATIONS_S=82118,e.PLAYER_KICKOUT_S=100,e.PUSH_CHAT_S=101,e.MARQUEE_PUSH=136,e.PLAYER_INFO_SYNC_S=102,e.ROLE_INFO_SYNC_S=103,e.ITEM_INFO_SYNC_S=104,e.EQUIP_INFO_SYNC_S=105,e.EQUIP_SYNC_FINISH_S=122,e.SKILL_INFO_SYNC_S=106,e.STATE_INFO_SYNC_S=107,e.ASSEMBLE_FINISH_S=108,e.RED_POINT_SYNC_S=96001,e.PLAYER_AWARD_S=109,e.PLAYER_CONSUME_S=110,e.BATTLE_INFO_SYNC_S=111,e.BATTLE_OFFLINE_ACCOUNT_S=112,e.MAP_STATISTICS_SYNC_S=113,e.SYSTEM_PROMPT=115,e.NOTICE_PUSH=116,e.ATTRIBUTE_CHANGE_NOTICE=117,e.DATA_NOTIFY_S=119,e.SKILL_BAG_S=120,e.TITLE_SYNC_S=121,e.CHANGE_TITLE_C_VALUE=206,e.TITLE_ACTIVE_C_VALUE=92001,e.TITLE_ACTIVE_S=92002,e.TITLE_QUALITY_UP_C_VALUE=92003,e.TITLE_QUALITY_UP_S=92004,e.ROLE_RING_INFO_S=123,e.CLIENT_SETTING_PUSH=125,e.PLAYER_AREA_SYNC=126,e.ELEMENT_INFO_SYNC_S=127,e.GAMEING_STATE_S=128,e.SYS_EVENT_PUSH=129,e.WING_SYNC_S=131,e.PET_SYNC_S=133,e.BACKDOOR_LIST=134,e.BACKDOOR_OPEN=135,e.BACKDOOR_OPEN_S=139,e.TIME_PLAY_METHOD_PUSH=138,e.SEND_CHAT_C=200,e.SEND_CHAT_S=201,e.RECORD_TUTORIAL_STEP=210,e.MAP_BATTLE_REQUEST_C=211,e.EXIT_BATTLE_C=215,e.EXIT_BATTLE_S=216,e.LOGIN_C=1e3,e.LOGIN_S=1001,e.PLAYER_MOVE=1010,e.MAP_PLAYER_ENTER=1011,e.MAP_PLAYER_INFO_SYNC=1012,e.MAP_PLAYER_POS_SYNC=1013,e.MAP_PLAYER_MOVE=1014,e.MAP_PLAYER_LEAVE=1015,e.MAP_PLAYER_VISIT=1016,e.MAP_PLAYER_CAST_SKILL=1017,e.MAP_PLAYER_CAST_BUFF=1018,e.DOWNLOAD_REWARD_C=1019,e.DOWNLOAD_REWARD_S=1020,e.ITEM_USE_C=3001,e.ITEM_USE_S_VALUE=3002,e.ITEM_SELL_C=3003,e.GEM_ONE_KEY_LEVELUP=3004,e.NOBILITY_NOBILITY_INFO_C=91001,e.NOBILITY_NOBILITY_INFO_S=91002,e.NOBILITY_REWARD_C=91003,e.NOBILITY_REWARD_S=91004,e.NOBILITY_LEVEL_UP_C=91005,e.NOBILITY_LEVEL_UP_S=91006,e.SKILL_CHANGE_ORDER_C=4003,e.SKILL_CHANGE_ORDER_S=4004,e.SKILL_LEVELUP_C=4001,e.SKILL_LEVELUP_S=4002,e.EQUIP_DRESS_C=5001,e.EQUIP_DRESS_S=5002,e.EQUIP_BAPTIZE_C=5009,e.EQUIP_BAPTIZE_S=5010,e.EQUIP_DECOMPOSE_C=5035,e.EQUIP_DECOMPOSE_S=5036,e.EQUIP_EVOLUTION_C=5037,e.EQUIP_EVOLUTION_S=5038,e.EQUIP_LOCK_C=5041,e.EQUIP_LOCK_S=5042,e.EQUIP_DRESS_ONE_KEY_C=5045,e.EQUIP_DRESS_ONE_KEY_S=5046,e.EQUIP_CELL_SYNC=5051,e.EQUIP_CELL_UPLEVEL_C=5052,e.EQUIP_CELL_UPLEVEL_S=5053,e.EQUIP_CELL_ONE_KEY_C=5054,e.EQUIP_CELL_ONE_KEY_S_VALUE=5055,e.GEM_SYSTEM_UP_LEVEL=5056,e.EQUIP_GOD_INLAY_C=5057,e.EQUIP_GOD_INLAY_S=5058,e.EQUIP_GOD_EVOLUTION_C=5059,e.EQUIP_GOD_EVOLUTION_S=5060,e.EQUIP_GOD_COMPOUND_C=5061,e.EQUIP_GOD_COMPOUND_S=5062,e.RED_EQUIP_QUENCHING_C=5065,e.RED_EQUIP_QUENCHING_S=5066,e.ROLE_CREATE_C=6002,e.ROLE_CREATE_S=6003,e.ROLE_CREATE_OTHER_C=6015,e.ARENA_DEFENDER_LIST_C=8001,e.ARENA_DEFENDER_LIST_SYNC_S=8002,e.REPLACE_DEFENDER_LIST_C=8003,e.REPLACE_DEFENDER_LIST_S=8004,e.BUY_CHALLENGE_TIMES_C=8005,e.BUY_CHALLENGE_TIMES_S=8006,e.ARENA_RANKING_LIST_C=8007,e.ARENA_RANKING_LIST_S=8008,e.CHALLENGE_DEFENDER_C=8009,e.CHALLENGE_DEFENDER_S=8010,e.SEE_OTHER_PLAYER_INFO_C=8011,e.SEE_OTHER_PLAYER_INFO_S=8012,e.SEE_MERCENARY_INFO_C=8013,e.SEE_MERCENARY_INFO_S=8014,e.ARENA_RECORD_C=8017,e.ARENA_RECORD_S=8018,e.ARENA_SHOP_BUYITEM_C=8019,e.ARENA_SHOP_BUYITEM_S=8020,e.UNION_CREATE_C=9001,e.UNION_CREATE_S=9002,e.UNION_OPER_C=9003,e.UNION_OPER_S=9004,e.UNION_MEMBER_C=9005,e.UNION_MEMBER_S=9006,e.UNION_NOTICE_C=9007,e.UNION_NOTICE_S=9008,e.UNION_SET_JOIN_LIMIT_C=9009,e.UNION_SET_JOIN_LIMIT_S=9010,e.UNION_PROMPT_MSG_S=9011,e.UNION_SHOP_C=9013,e.UNION_SHOP_S=9014,e.UNION_SHOP_BUY_C=9015,e.UNION_JOIN_LIST_C=9016,e.UNION_JOIN_LIST_S=9017,e.UNION_JOIN_REQ_C=9018,e.UNION_JOIN_REQ_S=9019,e.UNION_ENTER_C=9020,e.UNION_ENTER_S=9021,e.UNION_BOSSHARM_S=9022,e.UNION_FIND_C=9023,e.UNION_AUTO_FIGHT_C=9025,e.BOSS_VITALITY_SYNC_S=9028,e.UNION_SHOP_REFRESH_C=9029,e.UNION_ATTACK_RESULT_S=9030,e.UNION_GET_ACTIVITY_C=9033,e.UNION_GET_ACTIVITY_S=9034,e.UNION_DO_ACTIVITY_C=9035,e.UNION_DO_ACTIVITY_S=9036,e.UNION_SKILL_INFO_C=9037,e.UNION_SKILL_INFO_S=9038,e.UNION_SKILL_LEVEL_UP_C=9039,e.UNION_SKILL_LEVEL_UP_S=9040,e.UNION_BOSS_OPEN_AWARD=9040,e.UNION_BATTLE_CALL_C=9043,e.UNION_BATTLE_CALL_S=9044,e.UNION_BATTLE_HARMS_C=9045,e.UNION_BATTLE_HARMS_S=9046,e.UNION_BATTLE_ATTACK_C=9047,e.UNION_BATTLE_ATTACK_S=9048,e.UNION_REQ_INFO_C=9048,e.UNION_REQ_INFO_S=9049,e.UNION_RELEASE_RECRUIT_C=9051,e.UNION_RELEASE_RECRUIT_S=9052,e.UNION_BONFIRE_ENTER_C=9055,e.UNION_BONFIRE_ENTER_S=9056,e.UNION_BONFIRE_EXIT_C=9057,e.UNION_BONFIRE_EXIT_S=9058,e.UNION_BONFIRE_MEM_CHANGE_S=9059,e.UNION_BONFIRE_EXP_AWARD_S=9060,e.UNION_BONFIRE_AWARD_ADD_S=9061,e.UNION_BONFIRE_HAPPY_C=9062,e.UNION_BONFIRE_HAPPY_S=9063,e.UNION_SIEGE_INFO_C=9101,e.UNION_SIEGE_INFO_S=9102,e.UNION_SIEGE_LAST_WAR_C=9103,e.UNION_SIEGE_LAST_WAR_S=9104,e.UNION_SIEGE_POSITION_C=9105,e.UNION_SIEGE_POSITION_S=9106,e.UNION_SIEGE_MY_POSITION_C=9107,e.UNION_SIEGE_MY_POSITION_S=9108,e.UNION_SIEGE_SCENE_INFO_S=9110,e.UNION_SIEGE_BATTLE_PROGRESS_S=9112,e.UNION_SIEGE_MINING_FLAG_C=9113,e.UNION_SIEGE_FLAG_STATE_S=9114,e.UNION_SIEGE_BATTLE_RESULT_S=9115,e.UNION_SIEGE_CHALLENGE_NPC_C=9117,e.SHOP_C=10001,e.SHOP_S=10002,e.SHOP_COIN_C=10003,e.SHOP_COIN_S=10004,e.SHOP_LEGENDARYMART_C=10005,e.SHOP_LEGENDARYMART_S=10006,e.BATTLE_FAST_FIGHT_C=11001,e.BATTLE_FAST_FIGHT_S=11002,e.BUY_FAST_FIGHT_TIMES_C=11003,e.BUY_FAST_FIGHT_TIMES_S=11004,e.BUY_BOSS_FIGHT_TIMES_C=11005,e.BUY_BOSS_FIGHT_TIMES_S=11006,e.BOSS_WIPE_C=11007,e.BOSS_WIPE_S=11008,e.BUY_ELITE_FIGHT_TIMES_C=11009,e.BUY_ELITE_FIGHT_TIMES_S=11010,e.BUY_FIELDORKEY_FIGHT_TIMES_C=11017,e.BUY_FIELDORKEY_FIGHT_TIMES_S=11018,e.MAINMISSION_LIST_S=12002,e.MAINMISSION_BONUS_C_VALUE=12003,e.MAINMISSION_BONUS_S_VALUE=12004,e.MAIL_INFO_C=13001,e.MAIL_INFO_S=13002,e.MAIL_GET_C=13003,e.MAIL_GET_S=13004,e.MAIL_READ_C=13007,e.MAIL_READ_S=13008,e.USE_CDK_C=16001,e.USE_CDK_S=16002,e.LVL_GIFT_SYNC=16005,e.DRAW_LVL_GIFT=16006,e.NEWLY_GIFT_SYNC=16007,e.DRAW_NEWLY_GIFT=16008,e.HONOR_SHOP_BUY_C=19003,e.HONOR_SHOP_BUY_S=19004,e.HONOR_SHOP_REFRESH_C=19005,e.HONOR_SHOP_REFRESH_S=19006,e.ACHIEVEMENT_INFO_S=93001,e.ACHIEVEMENT_AWARD_C=93002,e.ACHIEVEMENT_AWARD_S=93003,e.BP_BOSS_LIST_C=11020,e.BP_BOSS_LIST_S=11021,e.BP_BOSS_CANNEL_FIGHT_C=11024,e.BP_BOSS_CLEAN_CD_C=11022,e.BP_BOSS_CLEAN_CD_S=11023,e.BP_REQUEST_BATTLE_MAP_CROWD_MONSTER_INFO_C_VALUE=11025,e.BP_BATTLE_MAP_CROWD_MONSTER_INFO_S_VALUE=11026,e.BP_BOSS_BE_PLUNDER_NOTIFY_S=11027,e.BP_BOSS_BE_PLUNDER_RESULT_S=11028,e.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_C_VALUE=11029,e.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_S_VALUE=11030,e.PK_INFO_C=31001,e.PK_INFO_S=31002,e.PK_LOG_C=31003,e.PK_LOG_S=31004,e.PK_PVALUE_CLEAN_C=31005,e.PK_PVALUE_CLEAN_S=31006,e.PK_REFRESH_OPPONENT_C=31007,e.PK_REFRESH_OPPONENT_S=31008,e.PK_FIGHT_C=31009,e.PK_FIGHT_S=31010,e.PK_SEARCH_PINFO_C=31011,e.PK_SEARCH_PINFO_S=31012,e.WING_LEVEL_UP_C=38001,e.WING_LEVEL_UP_S=38002,e.WING_RANK_C=38003,e.WING_RANK_S=38004,e.WING_EVOLUTION_C=38013,e.WING_EVOLUTION_S=38014,e.WING_STAR_UP_C=38015,e.WING_STAR_UP_S=38016,e.PET_LEVEL_UP_C=38009,e.PET_LEVEL_UP_S=38010,e.PET_SHOW_ID_C=38011,e.PET_SHOW_ID_S=38012,e.ACTIVE_INFO_SYNC_C=39001,e.ACTIVE_INFO_SYNC_S=39002,e.ACTIVE_GET_REWARD_C=39003,e.ACTIVE_GET_REWARD_S=39004,e.ACTIVE_DAILY_TASK_REWARD_C=39005,e.ACTIVE_DAILY_TASK_REWARD_S=39006,e.GET_ACTIVITY_LIST_C=80001,e.OPEN_ACTIVITY_SYNC_S=80002,e.ACTIVITY_LUACFG_DOWNLOAD_LIST_C=80003,e.ACTIVITY_LUACFG_DOWNLOAD_LIST_S=80004,e.DAY_RECHARGE_AWARD_C=80205,e.DAY_RECHARGE_AWARD_S=80206,e.GET_DAY_RECHARGE_AWARD_C=80207,e.GET_DAY_RECHARGE_AWARD_S=80208,e.CONTINUE_RECHARGE_INFO_C=80301,e.CONTINUE_RECHARGE_INFO_S=80302,e.GET_CONTINUE_RECHARGE_AWARD_C=80303,e.GET_CONTINUE_RECHARGE_AWARD_S=80304,e.VIP_WELFARE_INFO_C=81201,e.VIP_WELFARE_INFO_S=81202,e.VIP_WELFARE_AWARD_C=81203,e.VIP_WELFARE_AWARD_S=81204,e.ACC_LOGIN_INFO_C=81601,e.ACC_LOGIN_INFO_S=81602,e.ACC_LOGIN_AWARDS_C=81603,e.ACC_LOGIN_AWARDS_S=81604,e.OPEN_ACTIVITY_PEOPLE_WELFARE_C=82909,e.OPEN_ACTIVITY_PEOPLE_WELFARE_S=82910,e.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_C=82911,e.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_S=82912,e.ACTIVITY_ERRORNO_S=83001,e.EVERYDAY_SIGN_INFO_C=83401,e.EVERYDAY_SIGN_INFO_S=83402,e.EVERYDAY_SIGN_AWARD_C=83403,e.EVERYDAY_SIGN_AWARD_S=83404,e.OPEN_TEST_C=83409,e.OPEN_TEST_S=83410,e.OPEN_DISCOUNT_ACTIVITY_BUY_C=83411,e.OPEN_DISCOUNT_ACTIVITY_BUY_S=83412,e.GROW_FUND_C=83701,e.GROW_FUND_S=83702,e.GET_GROW_FUND_C=83703,e.GET_GROW_FUND_S=83704,e.BUY_GROW_FUND_C=83705,e.BUY_GROW_FUND_S=83706,e.VIP_GIFTS_INFO_C=83901,e.VIP_GIFTS_INFO_S=83902,e.BUY_VIP_GIFT_C=83903,e.BUY_VIP_GIFT_S=83904,e.ACC_RECHARGE2_INFO_C=84201,e.ACC_RECHARGE2_INFO_S=84202,e.GET_ACC_RECHARGE2_AWARD_C=84203,e.GET_ACC_RECHARGE2_AWARD_S=84204,e.OPEN_RECHARGE_RANKINGS_C=80435,e.OPEN_RECHARGE_RANKINGS_S=80436,e.RANK_C=84901,e.RANK_S=84902,e.SERVER_RANK_LIST_INFO_C=84809,e.SERVER_RANK_LIST_INFO_S=84810,e.ONLINE_AWARD_INFO_C=84710,e.ONLINE_AWARD_INFO_S=84711,e.GET_ONLINE_AWARD_C=84712,e.GET_ONLINE_AWARD_S=84713,e.DAILY_ACC_RECHARGE_INFO_C=84714,e.DAILY_ACC_RECHARGE_INFO_S=84715,e.DAILY_ACC_RECHARGE_AWARD_C=84716,e.DAILY_ACC_RECHARGE_AWARD_S=84717,e.GENERAL_REVELRY_INFO_C=84718,e.GENERAL_REVELRY_INFO_S=84719,e.GENERAL_REVELRY_AWARD_C=84720,e.GENERAL_REVELRY_AWARD_S=84721,e.LIMIT_BUY_GIFT_INFO_C=84722,e.LIMIT_BUY_GIFT_INFO_S=84723,e.BUY_LIMIT_BUY_GIFT_C=84724,e.BUY_LIMIT_BUY_GIFT_S=84725,e.RING_SYNTHESIS_C=85005,e.RING_SYNTHESIS_S=85006,e.STANDARD_ACTIVITY_INFO_C=89101,e.STANDARD_ACTIVITY_INFO_S=89102,e.STANDARD_ACTIVITY_REWARD_C=89103,e.STANDARD_ACTIVITY_REWARD_S=89104,e.OPEN_GOLOD_BOX_BUY_C=89105,e.OPEN_GOLOD_BOX_BUY_S=89106,e.OPEN_GOLOD_BOX_C=89107,e.OPEN_GOLOD_BOX_S=89108,e.OPEN_GOLOD_BOX_INFO_C=89109,e.OPEN_GOLOD_BOX_INFO_S=89110,e.POKE_PIGIN_UP_C=89111,e.POKE_PIGIN_UP_S=89112,e.POKE_PIGIN_INFO_C=89113,e.POKE_PIGIN_INFO_S=89114,e.SMASH_GOLD_EGGS_C=89115,e.SMASH_GOLD_EGGS_S=89116,e.SMASH_GOLD_EGGS_BREAK_C=89117,e.SMASH_GOLD_EGGS_BREAK_S=89118,e.SMASH_GOLD_EGGS_RECEIVE_C=89119,e.SMASH_GOLD_EGGS_RECEIVE_S=89120,e.MAY_DAY_ACC_REHARGE_INFO_C=89121,e.MAY_DAY_ACC_REHARGE_INFO_S=89122,e.MAY_DAY_ACC_REHARGE_GET_C=89123,e.MAY_DAY_ACC_REHARGE_GET_S=89124,e.MAY_DAY_CONSUME_GOLD_INFO_C=89125,e.MAY_DAY_CONSUME_GOLD_INFO_S=89126,e.MAY_DAY_CONSUME_GOLD_GET_C=89127,e.MAY_DAY_CONSUME_GOLD_GET_S=89128,e.MAY_DAY_LOGIN_INFO_C=89129,e.MAY_DAY_LOGIN_INFO_S=89130,e.MAY_DAY_LOGIN_GET_C=89131,e.MAY_DAY_LOGIN_GET_S=89132,e.MAY_DAY_GIFT_INFO_C=89133,e.MAY_DAY_GIFT_INFO_S=89134,e.MAY_DAY_GIFT_GET_C=89135,e.MAY_DAY_GIFT_GET_S=89136,e.MAY_DAY_DOUBLEUP_GOLD_INFO_C=89137,e.MAY_DAY_DOUBLEUP_GOLD_INFO_S=89138,e.MAY_DAY_DOUBLEUP_GOLD_AWARD_C=89139,e.MAY_DAY_DOUBLEUP_GOLD_AWARD_S=89140,e.MAY_DAY_DOUBLEUP_GOLD_LOG_S=89141,e.READ_PACKAGE_GOLDS_INFO_C=89142,e.READ_PACKAGE_GOLDS_INFO_S=89143,e.READ_PACKAGE_LOG_INFO_S=89144,e.READ_PACKAGE_ROB_C=89145,e.READ_PACKAGE_ROB_S=89146,e.READ_PACKAGE_ROB_INFO_S=89147,e.CYCLE_CONSUME_GOLDS_INFO_C=89148,e.CYCLE_CONSUME_GOLDS_INFO_S=89149,e.CYCLE_CONSUME_GOLDS_AWARD_C=89150,e.CYCLE_CONSUME_GOLDS_AWARD_S=89151,e.CONSUM_GOLDS_RANK_INFO_C=89152,e.CONSUM_GOLDS_RANK_INFO_S=89153,e.SOUL_SOUL_INFO_C=90001,e.SOUL_SOUL_INFO_S=90002,e.SOUL_APPARE_OR_REPLACE_C=90003,e.SOUL_APPARE_OR_REPLACE_S=90004,e.SOUL_DEGREE_UP_C=90005,e.SOUL_DEGREE_UP_S=90006,e.SOUL_HUNTING_INFO_C=90007,e.SOUL_HUNTING_INFO_S=90008,e.SOUL_HUNTING_C=90009,e.SOUL_HUNTING_S=90010,e.SOUL_OPEN_GROOVE_C=90015,e.SOUL_OPEN_GROOVE_S=90016,e.SOUL_LIGHT_ORANGE_C=90011,e.SOUL_LIGHT_ORANGE_S=90012,e.SOUL_SMELT_C=90013,e.SOUL_SMELT_S=90014,e.TREASURE_HUNT_C=89001,e.TREASURE_HUNT_S=89002,e.TREASURE_HUNT_LOG_C=89003,e.TREASURE_HUNT_LOG_S=89004,e.CURRENCY_CHANGE_PUSH=137,e.UNION_BOSS_INFO_C=9053,e.UNION_BOSS_INFO_S=9054,e.UNION_BOSS_HARMS_C=9045,e.UNION_BOSS_HARMS_S=9046,e.UNION_CHALLENGE_BOSS_C=9041,e.UNION_CHALLENGE_BOSS_S=9042,e.UNION_GET_KILL_BOSS_AWARD_C=9043,e.UNION_GET_KILL_BOSS_AWARD_S=9044,e.GHOST_TOWER_INFO_C=94001,e.GHOST_TOWER_INFO_S=94002,e.GHOST_TOWER_CHALLENGE_C=94003,e.GHOST_TOWER_CHALLENGE_S=94004,e.GHOST_TOWER_HELP_PLAYER_C=94005,e.GHOST_TOWER_HELP_PLAYER_S=94006,e.GHOST_TOWER_DAILY_REWARD_C=94007,e.GHOST_TOWER_DAILY_REWARD_S=94008,e.CONRNUCONPIA_INFO_C=95054,e.CONRNUCONPIA_INFO_S=95055,e.CONRNUCONPIA_AWARD_C=95056,e.CONRNUCONPIA_AWARD_S=95057,e.FETCH_WORLD_BOSS_INFO_C=23001,e.FETCH_WORLD_BOSS_INFO_S=23002,e.ENTER_WORLD_BOSS_C=23003,e.ENTER_WORLD_BOSS_S=23004,e.WORLD_BOSS_UNION_ENCOURAGE_C=23005,e.WORLD_BOSS_INVITE_UNION_MEM_C=23007,e.WORLD_BOSS_INVITE_UNION_MEM_S=23008,e.WORLD_BOSS_FIGHT_PUTH_S=23009,e.WORLD_BOSS_END_PUSH_S=23010,e.LEAVE_WORLD_BOSS_C=23011,e.LEAVE_WORLD_BOSS_S=23012,e.WORLD_BOSS_TIME_S=23013,e.PLAYER_FASHION_INFO_C=95058,e.PLAYER_FASHION_INFO_S=95059,e.FASHION_ACTIVATE_C=95060,e.FASHION_ACTIVATE_S=95061,e.FASHION_WEAR_INFO_C=95062,e.FASHION_WEAR_INFO_S=95063,e.FASHION_ROLE_INFO_S=95208,e.CS_ARENA_INFO_C=27001,e.CS_ARENA_INFO_S=27002,e.CS_MATCH_OPPONENT_C=27003,e.CS_MATCH_OPPONENT_S=27004,e.CS_CHALLENGE_C=27005,e.CS_CHALLENGE_S=27006,e.CS_ARENA_RANK_INFO_C=27007,e.CS_ARENA_RANK_INFO_S=27008,e.CS_ARENA_BET_C=27009,e.CS_ARENA_BET_S=27010,e.CS_ARENA_POPULAR_C=27011,e.CS_ARENA_POPULAR_S=27012,e.CS_ARENA_MY_BET_C=27013,e.CS_ARENA_MY_BET_S=27014,e.CS_ARENA_MY_FIGHT_C=27015,e.CS_ARENA_MY_FIGHT_S=27016,e.CS_ARENA_OTHER_FIGHT_C=27017,e.CS_ARENA_OTHER_FIGHT_S=27018,e.CS_ARENA_WORSHIP_C=27019,e.CS_ARENA_WORSHIP_S=27020,e.CS_ARENA_PINNACLE_SHOP_BUY_C=27021,e.CS_ARENA_PINNACLE_SHOP_BUY_S=27022,e.CS_ARENA_CANCEL_MATCH_C=27023,e.CS_ARENA_CANCEL_MATCH_S=27024,e.CS_ARENA_THUMBS_UP_C=27025,e.CS_ARENA_THUMBS_UP_S=27026,e.CS_ARENA_MATCH_TIMES_BUY_C=27027,e.CS_ARENA_MATCH_TIMES_BUY_S=27028,e.CS_ARENA_SEASON_STAGE_CHANGE_S=27109,e.CS_ARENA_PINNACLE_COIN_SYNC=27029,e.DRAGON_BONE_INFO_C=95064,e.DRAGON_BONE_INFO_S=95065,e.DRAGON_BONE_WEAR_C=95066,e.DRAGON_BONE_WEAR_S=95067,e.DRAGON_BONE_UPDRADE_C=95068,e.DRAGON_BONE_UPDRADE_S=95069,e.DRAGON_BONE_RISING_STAR_C=95070,e.DRAGON_BONE_RISING_STAR_S=95071,e.DRAGON_BONE_WARD_C=95072,e.DRAGON_BONE_WARD_S=95073,e.DRAGON_BONE_COMBINED_STAR_C=95074,e.DRAGON_BONE_COMBINED_STAR_S=95075,e.DRAGON_INFO_SYNC_S=95076,e.DRAGON_BONE_UPDATE_S=95077,e.DRAGON_BONE_DELETE_S=95078,e.DRAGON_BONE_LOCK_C=95079,e.DRAGON_BONE_LOCK_S=95080,e.DRAGON_BONE_WARDSYNC_S=95081,e.DRAGON_ARMOUR_BAG_INFO_S=95100,e.DRAGON_ARMOUR_INFO_C=95101,e.DRAGON_ARMOUR_INFO_S=95102,e.DRAGON_ARMOUR_DRESS_C=95103,e.DRAGON_ARMOUR_DRESS_S=95104,e.DRAGON_ARMOUR_ENGRAVE_C=95105,e.DRAGON_ARMOUR_ENGRAVE_S=95106,e.DRAGON_ARMOUR_QUENCHING_C=95107,e.DRAGON_ARMOUR_QUENCHING_S=95108,e.DRAGON_ARMOUR_LOCK_C=95109,e.DRAGON_ARMOUR_LOCK_S=95110,e.DRAGON_ARMOUR_SHOW_GUARD_C=95111,e.DRAGON_ARMOUR_SHOW_GUARD_S=95112,e.DRAGON_ARMOUR_OPEN_PORE_C=95113,e.DRAGON_ARMOUR_OPEN_PORE_S=95114,e.DRAGON_ARMOUR_ADD_S=95115,e.DRAGON_HOARD_INFO_C=95116,e.DRAGON_HOARD_INFO_S=95117,e.NATURAL_VALUE_AWARD_C=95118,e.NATURAL_VALUE_AWARD_S=95119,e.DRAGON_HOARD_AWARD_C=95120,e.DRAGON_HOARD_AWARD_S=95121,e.OPEN_DRAGON_HOARD_C=95122,e.OPEN_DRAGON_HOARD_S=95123,e.DRAGON_HOARD_LOG_C=95124,e.DRAGON_HOARD_LOG_S=95125,e.DRAGON_ARMOUR_YU_ENGRAVE_C=95126,e.DRAGON_ARMOUR_YU_ENGRAVE_S=95127,e.TURNTABLE_LOTTERY_INFO_C=95200,e.TURNTABLE_LOTTERYy_INFO_S=95201,e.TURNTABLE_COUNT_AWARD_C=95204,e.TURNTABLE_COUNT_AWARD_S=95205,e.TURNTABLE_LOTTERY_DO_C=95202,e.TURNTABLE_LOTTERY_DO_S=95203,e.TURNTABLE_LOTTERY_LOG_C=95206,e.TURNTABLE_LOTTERY_LOG_S=95207,e.TWELVE_PALACE_INFO_C=96100,e.TWELVE_PALACE_INFO_S=96101,e.ONE_PALACE_INFO_C=96102,e.ONE_PALACE_INFO_S=96103,e.PALACE_STATE_CHANGE_S=96104,e.BUY_PALACE_CHALLENGE_NUM_C=96105,e.BUY_PALACE_CHALLENGE_NUM_S=96106,e.TWELVE_PALACE_GIVE_UP_C=96109,e.TWELVE_PALACE_GIVE_UP_S=96110,e.DEMON_KEE_INFO_C=95300,e.DEMON_KEE_INFO_S=95301,e.DEMON_KEE_UPGRADE_C=95302,e.DEMON_KEE_UPGRADE_S=95303,e.DEMON_KEE_DOTE_ON_C=95304,e.DEMON_KEE_DOTE_ON_S=95305,e.DEMON_KEE_ROCKET_C=95306,e.DEMON_KEE_ROCKET_S=95307,e.DEMON_KEE_BOGGART_C=95308,e.DEMON_KEE_BOGGART_S=95309,e.DEMON_KEE_AWARD_C=95310,e.DEMON_KEE_AWARD_S=95311,e.DEMON_KEE_EQUIP_C=95312,e.DEMON_KEE_EQUIP_S=95313,e.DEMON_KEE_LOCK_C=95316,e.DEMON_KEE_LOCK_S=95317,e.DEMON_KEE_FREE_C=95318,e.DEMON_KEE_FREE_S=95319,e.DEMON_KEE_EQUIP_INFO_S=95314,e.DEMON_KEE_EQUIP_UPDATE_S=95315,e.TWELVE_PALACE_CHALLENGE_OCCUPIED_C=96107,e.TWELVE_PALACE_CHALLENGE_OCCUPIED_S=96108,e.SCENE_BATTLE_MERGE_INFO_UPDATE_REQUEST=250,e.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC=260,e.SYNC_TWELVE_PALACE_SCENE_INFO=1101,e.SYNC_TWELVE_PALACE_SCENE_RESULT_INFO=1102,e.SCENE_PLAYER_ENTER_REQUEST=1110,e.SCENE_PLAYER_ENTER_RESPONSE=1111,e.SCENE_PLAYER_CONFIRM_ENTER_C=1114,e.SCENE_PLAYER_RELIVE_REQUEST=1112,e.SCENE_PLAYER_RELIVE_RESPONSE=1113,e.SCENE_PLAYER_ENTER=1120,e.SCENE_PLAYER_LEAVE=1121,e.SCENE_MONSTER_ENTER=1122,e.SCENE_MONSTER_LEAVE=1123,e.SCENE_OBJECT_ID_SYNC=1124,e.SCENE_OBJECT_DEATH=1125,e.SCENE_PLAYER_INFO_SYNC=1030,e.SCENE_MONSTER_INFO_SYNC=1031,e.SCENE_OBJECT_MOVE_REQUEST=1040,e.SCENE_OBJECT_MOVE_RESPONSE=1041,e.BP_REQUEST_CROSS_SERVER_PLUNDER_BOSS_FIGHT_C=11040,e.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_INFO_SYNC=11044,e.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_RESULT_SYNC=11045,e.SCENE_OBJECT_MOVE_SYNC=1042,e.SCENE_OBJECT_POS_SYNC=1043,e.DAILY_FIRST_CHARGE_INFO_C=96221,e.DAILY_FIRST_CHARGE_INFO_S=96222,e.DAILY_FIRST_CHARGE_AWARD_C=96223,e.DAILY_FIRST_CHARGE_AWARD_S=96224,e.SEVENDAYS_REBATE_INFO_C=96201,e.SEVENDAYS_REBATE_INFO_S=96202,e.SEVENDAYS_REBATE_AWARD_C=96203,e.SEVENDAYS_REBATE_AWARD_S=96204,e.CARNIVAL_FUND_INFO_C=96205,e.CARNIVAL_FUND_INFO_S=96206,e.CARNIVAL_FUND_AWARD_C=96207,e.CARNIVAL_FUND_AWARD_S=96208,e.PREFERENTIAL_INFO_C=96209,e.PREFERENTIAL_INFO_S=96210,e.PREFERENTIAL_AWARD_C=96211,e.PREFERENTIAL_AWARD_S=96212,e.DELUXE_ATTENDANCE_INFO_C=96213,e.DELUXE_ATTENDANCE_INFO_S=96214,e.DELUXE_ATTENDANCE_AWARD_C=96215,e.DELUXE_ATTENDANCE_AWARD_S=96216,e.GLASS_SHOP_NOLIMIT_INFO_C=96217,e.GLASS_SHOP_NOLIMIT_INFO_S=96218,e.GLASS_SHOP_NOLIMIT_BUY_C=96219,e.GLASS_SHOP_NOLIMIT_BUY_S=96220,e.GLASS_SHOP_LIMIT_INFO_C=96225,e.GLASS_SHOP_LIMIT_INFO_S=96226,e.GLASS_SHOP_LIMIT_BUY_C=96227,e.GLASS_SHOP_LIMIT_BUY_S=96228,e.FUNCTION_OPEN_INFO_C=96233,e.FUNCTION_OPEN_INFO_S=96234,e.FUNCTION_OPEN_AWARDS_C=96235,e.FUNCTION_OPEN_AWARDS_S=96236,e.LEVEL_PACKAGE_INFO_C=96229,e.LEVEL_PACKAGE_INFO_S=96230,e.DRAW_LEVEL_PACKAGE_C=96231,e.DRAW_LEVEL_PACKAGE_S=96232,e.CS_BOSS_RED_NOT_S=96537,e.MISSION_LEAD_C=96538,e.MISSION_LEAD_S=96539,e.MISSION_LEAD_FINISH_C=96540,e.MISSION_LEAD_FINISH_S=96541,e.REFRESH_PLAYER_MANAGER=96542,e.WANBA_INFO_C=1021,e.WANBA_INFO_S=1022,e.WANBA_SHARE_IN_SUCC_C=1023,e.WANBA_SHARE_IN_SUCC_S=1024,e.WANBA_AWARD_C=1025,e.WANBA_AWARD_S=1026,e.WANBA_VIP_PACKAGE_C=96543,e.WANBA_VIP_PACKAGE_S=96544,e.WANBA_VIP_DAY_AWARDS_C=96545,e.WANBA_VIP_DAY_AWARDS_S=96546,e.WANBA_VIP_DAY_BUY_C=96547,e.WANBA_VIP_DAY_BUY_S=96548,e.WANBA_VIP_PACKAGE_INFO_C=96549,e.WANBA_VIP_PACKAGE_INFO_S=96550,e.DafuWeng_Info_C=96551,e.DafuWeng_Info_S=96552,e.DafuWeng_Refresh_Times_C=96553,e.DafuWeng_Refresh_Times_S=96554,e.DafuWeng_Cast_C=96555,e.DafuWeng_Cast_S=96556,e.DafuWeng_Rank_C=96557,e.DafuWeng_Rank_S=96558,e.DafuWeng_Award_C=96559,e.DafuWeng_Award_S=965510,e.RECHARGE_REBATE_C=96560,e.RECHARGE_REBATE_S=96561,e.PRIVILEGE_CARD_INFO_C=85101,e.PRIVILEGE_CARD_INFO_S=85102,e.PRIVILEGE_CARD_AWARD_C=85103,e.PRIVILEGE_CARD_AWARD_S=85104,e.ZERO_PACKATE_C=96562,e.ZERO_PACKATE_S=96563,e.ZERO_PACKATE_BUY_C=96564,e.ZERO_PACKATE_BUY_S=96565,e.WANBA_QQ_VIP_DAILY_GIFT_STATUS_C=96566,e.WANBA_QQ_VIP_DAILY_GIFT_STATUS_S=96567,e.WANBA_QQ_VIP_DAILY_GIFT_AWARD_C=96568,e.WANBA_QQ_VIP_DAILY_GIFT_AWARD_S=96569,e.LITMIT_TIMES_RECHARGE_C=96570,e.LITMIT_TIMES_RECHARGE_S=96571,e.TREASURE_OF_ANCIENT_GOD_INFO_C=96600,e.TREASURE_OF_ANCIENT_GOD_INFO_S=96601,e.OPEN_TREASURE_OF_ANCIENT_GOD_C=96602,e.OPEN_TREASURE_OF_ANCIENT_GOD_S=96603,e.GODHEAD_INFO_C=965672,e.GODHEAD_INFO_S=965673,e.GODHEAD_ACTIVATE_UPGRAD_C=965674,e.GODHEAD_ACTIVATE_UPGRAD_S=965675,e.GODHEAD_ACTIVATE_HIERON_C=965676,e.GODHEAD_ACTIVATE_HIERON_S=965677,e.GET_XINYUE_PRIVILEGE_DAILY_GIFT_C=96572,e.GET_XINYUE_PRIVILEGE_DAILY_GIFT_S=96573,e.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_C=96574,e.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_S=96575,e.WANBA_QLD_AD_C=96576,e.WANBA_QLD_AD_S=96577,e.WANBA_QLD_AD_AWARD_C=96578,e.WANBA_QLD_AD_AWARD_S=96579,e.VESTIGES_OF_ANCIENT_GODS_INFO_C=96604,e.VESTIGES_OF_ANCIENT_GODS_INFO_S=96605,e.EXPLORE_VESTIGES_OF_ANCIENT_GODS_C=96606,e.EXPLORE_VESTIGES_OF_ANCIENT_GODS_S=96607,e.EXPLORE_VESTIGES_BEGIN_TIME_C=96608,e.EXPLORE_VESTIGES_BEGIN_TIME_S=96609,e.CHAT_IDENTIFYING_CODE_S=217,e.CHAT_IDENTIFYING_CODE_C=218,e.WAN_BA_QQ_BUY_C=96610,e.ALCHEMY_ITME_C=96611,e.ALCHEMY_ITME_S=96612,e.CAMP_INFO_C=97e3,e.CAMP_INFO_S=97001,e.CAMP_SIGN_UP_C=97002,e.CAMP_SIGN_UP_S=97003,e.CAMP_ENTER_C=97004,e.CAMP_ENTER_S=97005,e.CAMP_LOG_C=97006,e.CAMP_LOG_S=97007,e.CAMP_OURS_C=97008,e.CAMP_OURS_S=97009,e.CAMP_GARRISON_C=97010,e.CAMP_GARRISON_S=97011,e.CAMP_CHALLENGE_C=97012,e.CAMP_CHALLENGE_S=97013,e.CAMP_OPEN_TREASURE_C=97014,e.CAMP_OPEN_TREASURE_S=97015,e.CAMP_BATTLE_ACHIEVEMENT_S=97016,e.CAMP_STRONG_POINT_S=97018,e.CAMP_BATTLE_RESULT_S=97019,e.CAMP_TREASURE_INFO_C=97020,e.CAMP_TREASURE_INFO_S=97021,e.CAMP_LEAVE_C=97022,e.CAMP_LEAVE_S=97023,e.WAN_BA_RECHARGE_INFO_C=96613,e.WAN_BA_RECHARGE_INFO_S=96614,e.WAN_BA_RECHARGE_DRAW_C=96615,e.WAN_BA_RECHARGE_DRAW_S=96616,e.WAN_BA_LOGIN_INF_C=96617,e.WAN_BA_LOGIN_INF_S=96618,e.WAN_BA_LOGIN_DRAW_C=96619,e.WAN_BA_LOGIN_DRAW_S=96620,e.CS_SHARE_IN_SUCC_C=82130,e.CS_SHARE_IN_SUCC_S=82131,e.CS_SHARE_INFO_C=82132,e.CS_SHARE_INFO_S=82133,e.CS_GET_SHARE_AWARD_C=82134,e.CS_GET_SHARE_AWARD_S=82135,e.CS_SHARE_CHANGE_S=82136,e.ITME_GIFTS_GET_C=96621,e.ITME_GIFTS_GET_S=96622,e.TREASURE_SALE_C=96623,e.TREASURE_SALE_S=96624,e.FUNCTION_INIT_INFO_C=96625,e.FUNCTION_INIT_INFO_S=96626,e.FUNCTION_INIT_STATUS_C=96627,e.FUNCTION_INIT_STATUS_S=96628,e.QQ_BLUE_PRIVILEGE_INFO_C=96580,e.QQ_BLUE_PRIVILEGE_INFO_S=96581,e.QQ_BLUE_PRIVILEGE_GIFT_C=96582,e.QQ_BLUE_PRIVILEGE_GIFT_S=96583,e.QQ_HALL_PRIVILEGE_INFO_C=96584,e.QQ_HALL_PRIVILEGE_INFO_S=96585,e.QQ_HALL_PRIVILEGE_GIFT_C=96586,e.QQ_HALL_PRIVILEGE_GIFT_S=96587,e.JRTT_SHARE_INFO_C=82146,e.JRTT_SHARE_INFO_S=82147,e.JRTT_SHARE_SUCC_C=82148,e.JRTT_SHARE_SUCC_S=82149,e.JRTT_SHARE_AWARD_C=82150,e.JRTT_SHARE_AWARD_S=82151,e.VISITOR_LIMIT_INFO_C=96629,e.VISITOR_LIMIT_INFO_S=96630,e.add_LOGIN_TIMES_C=96631,e.add_LOGIN_TIMES_S=96632,e.MOTH_ADD_MB_C=96633,e.MOTH_ADD_MB_S=96634,e.OPEN_GAME_ZI_YUAN_C=96637,e.OPEN_GAME_ZI_YUAN_S=96638,e.OPEM_GAME_ZI_YUAN_PULL_C=96639,e.OPEN_GAME_ZI_YUAN_PULL_S=96640,e.ACHIEVEMENT_ONE_AWARD_C=93004,e.ACHIEVEMENT_ONE_AWARD_S=93005,e.CS_RANK_PLAYER_INFO_C=96702,e.CS_RANK_PLAYER_INFO_S=96703,e.CHANNEL_CRETIFICATION_AWARDS_C=96712,e.CHANNEL_CRETIFICATION_AWARDS_S=96713,e.ITEM_LIMTI_GIFT_GET_C=96710,e.ITEM_LIMIT_GIFT_GET_S=96711,e.GET_SERVER_DATETIME_C=96714,e.GET_SERVER_DATETIME_S=96715,e.ROLE_LIMIT_TIME_GIFT_C=96716,e.ROLE_LIMIT_TIME_GIFT_S=96717,e.GET_ROLE_LIMIT_TIME_GIFT_C=96718,e.GET_ROLE_LIMIT_TIME_GIFT_S=96719,e.ALON_DAILY_RECHARGE_C=96720,e.ALON_DAILY_RECHARGE_S=96721,e.GET_ALON_DAILY_RECHARGE_C=96722,e.GET_ALON_DAILY_RECHARGE_S=96723,e.RED_RECHARGE_ITEM_C=96724,e.RED_RECHARGE_ITEM_S=96725,e.REBATE_RED_PACK_C=95726,e.REBATE_RED_PACK_S=95727,e
}();e.Code=t,__reflect(t.prototype,"foxgame.Code")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.array_hasValue=function(e,t){for(var i=0;i<e.length;i++)if(t==e[i])return!0;return!1},t.getProfessionIdByRoleItemId=function(t){var i=1,n=e.JsonDataManager.instance.roleTemplate,o=n[t];return null!=o&&(i=o.profession),i},t.getRoleSexFromRoleItemId=function(t,i){var n=0;return(t==e.RoleType.MAIN_ROLE||t==e.RoleType.MERCENARY)&&(i>0&&4>i?n=1:i>3&&7>i&&(n=2)),n},t.randomAttackSkillByOccuAndLevel=function(e,t){return-1},t.randomDefenceSkillByOccuAndLevel=function(e,t){return-1},t.randomPosForRunUnit=function(e){var t=1,i=e["moster"+t],n=[];return n.push(new egret.Point(i[0].x,i[0].y)),n.push(new egret.Point(i[1].x,i[1].y)),n.push(new egret.Point(i[2].x,i[2].y)),n},t.randomPosForMercenary=function(e){var t=new egret.Point;return t.x=Math.random()+.5,t.y=Math.random()+.5,t.x>1&&(t.x=t.x-.5),t.y>1&&(t.y=t.y-.5),1==e&&(t.y=0-t.y),t},t.randomModelObjectOneDirection=function(){var t=Math.floor(8*Math.random())+1;return(1>t||t>8)&&(console.error("randomModelObjectOneDirection invalid direction:"+t),t=e.EnumManager.DIRECTION_ENUM.DIR_DOWN),t},t.randomPeopleMainSceneClientBornPos=function(){var t=new egret.Point;return t.x=7+e.GameUtils.randomNegetive()*(Math.random()+.2)*1,t.y=206+e.GameUtils.randomNegetive()*(Math.random()+.2)*1,t},t.sortestPos=function(e,t){return t.sort(function(t,i){return egret.Point.distance(t,e)<egret.Point.distance(e,i)?1:-1}),t},t.getRewardByString=function(e){var t=[];if(null!=e)for(var i=e.split(","),n=0;n<i.length;n++){var o=i[n],a=o.split("_");t.push({type:a[0],itemId:a[1],count:a[2]})}return t},t.getMainMapLoadOrder=function(i,n){var o=StageFrameControl.instance.getScrollViewport(),a=o.scrollH,s=o.scrollV,r=a+e.Global.stageWidth,l=s+e.Global.stageHeight,h=e.Global.mainMapWidth,c=e.Global.mainMapHeight,u=a-e.Global.mainMapTileWidth;0>u&&(u=0);var p=s-e.Global.mainMapTileHeight;0>p&&(p=0);var g=r+e.Global.mainMapTileWidth;g>h&&(g=h);var d=l+e.Global.mainMapTileHeight;d>c&&(d=c);for(var f=Math.floor(u/e.Global.mainMapTileWidth)+1,m=Math.floor(p/e.Global.mainMapTileHeight)+1,y=Math.floor(g/e.Global.mainMapTileWidth),I=Math.floor(d/e.Global.mainMapTileHeight),v=1;v<=e.Global.mainMapMaxX;v++)for(var _=1;_<=e.Global.mainMapMaxY;_++)v>=f&&y>=v&&_>=m&&I>=_?t.setMainPic(v,_,n):t.setMainPic(v,_,n,!0)},t.setMainPic=function(t,i,n,o){void 0===o&&(o=!1);var a=(i-1)*e.Global.mainMapMaxX+t-1,s=n.mainMapPicArray[a];o?s.setImageTexture(n["mainBG_"+i+"_"+t],""):s.setImageTexture(n["mainBG_"+i+"_"+t],"main_scene_1_"+(a+1)+"_jpg")},t.destroyMainMapPic=function(i){for(var n=1;n<=e.Global.mainMapMaxX;n++)for(var o=1;o<=e.Global.mainMapMaxY;o++)t.setMainPic(n,o,i,!0)},t.setBattleMapPic=function(i,n,o,a,s){var r=StageFrameControl.instance.getScrollViewport(),l=r.scrollH,h=r.scrollV,c=l+e.Global.stageWidth,u=h+e.Global.stageHeight,p=e.Global.battleMapWidth,g=e.Global.battleMapHeight;p=s.mapXGrid*e.Global.mainMapTileWidth,g=s.mapYGrid*e.Global.mainMapTileHeight;var d=l-e.Global.mainMapTileWidth;0>d&&(d=0);var f=h-e.Global.mainMapTileHeight;0>f&&(f=0);var m=c+e.Global.mainMapTileWidth;m>p&&(m=p);var y=u+e.Global.mainMapTileHeight;y>g&&(y=g);for(var I=Math.floor(d/e.Global.mainMapTileWidth)+1,v=Math.floor(f/e.Global.mainMapTileHeight)+1,_=Math.floor(m/e.Global.mainMapTileWidth),T=Math.floor(y/e.Global.mainMapTileHeight),C=1;C<=e.Global.battleMapMaxX;C++)for(var A=1;A<=e.Global.battleMapMaxY;A++)C>=I&&_>=C&&A>=v&&T>=A?t.setBattlePic(C,A,o,a,s):t.setBattlePic(C,A,o,a,s,!0)},t.setBattlePic=function(t,i,n,o,a,s){void 0===s&&(s=!1),0>=t&&(t=1),t>=e.Global.battleMapMaxX&&(t=e.Global.battleMapMaxX),0>=i&&(i=1),i>=e.Global.battleMapMaxY&&(i=e.Global.battleMapMaxY);var r=(i-1)*e.Global.battleMapMaxX+t-1,l=n.battleMapPicArray[r];if(s)l.setImageTexture(n["battleBG_"+i+"_"+t],"");else{var h=(i-1)*a.mapXGrid+t;l.setImageTexture(n["battleBG_"+i+"_"+t],o+"_1_"+h+"_jpg")}},t.destroyBattleMapPic=function(i,n,o){for(var a=1;a<=e.Global.battleMapMaxX;a++)for(var s=1;s<=e.Global.battleMapMaxY;s++)t.setBattlePic(a,s,i,n,o,!0);if(o&&n)for(var a=1;a<=o.mapXGrid;a++)for(var s=1;s<=o.mapYGrid;s++){var r=(s-1)*o.mapXGrid+a,l=n+"_1_"+r;e.LoadMapPicManager.instance.destroyMapPicRes(l)}},t}();e.CommonUtils=t,__reflect(t.prototype,"foxgame.CommonUtils")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.WHITE=16777215]="WHITE",e[e.GREEN=195872]="GREEN",e[e.BLUE=3838442]="BLUE",e[e.PURPLE=12197109]="PURPLE",e[e.ORANGE=16364834]="ORANGE"}(t=e.qualityColor||(e.qualityColor={}));var i;!function(e){e[e.Load_Code_Splash=0]="Load_Code_Splash",e[e.Load_In_Login_Frame=1]="Load_In_Login_Frame",e[e.Load_In_Main_Load_Frame=2]="Load_In_Main_Load_Frame",e[e.Load_In_Create_Character_Frame=3]="Load_In_Create_Character_Frame",e[e.Load_In_Battle_Scene_Frame=4]="Load_In_Battle_Scene_Frame",e[e.Load_In_Main_Scene_Frame=5]="Load_In_Main_Scene_Frame"}(i=e.LoadStep||(e.LoadStep={}));var n;!function(e){e[e.PLAYER_LEVEL_ONE=1]="PLAYER_LEVEL_ONE",e[e.PLAYER_LEVEL_TEN=10]="PLAYER_LEVEL_TEN",e[e.PLAYER_LEVEL_TWENTY=25]="PLAYER_LEVEL_TWENTY",e[e.PLAYER_LEVEL_THIRTY=30]="PLAYER_LEVEL_THIRTY",e[e.PLAYER_LEVEL_FORTYFIVE=45]="PLAYER_LEVEL_FORTYFIVE",e[e.PLAYER_LEVEL_FIFTYFIVE=55]="PLAYER_LEVEL_FIFTYFIVE",e[e.PLAYER_LEVEL_SIXTY=60]="PLAYER_LEVEL_SIXTY",e[e.TASK_ID_600014=600014]="TASK_ID_600014",e[e.TASK_ID_600015=600020]="TASK_ID_600015",e[e.TASK_ID_600019=600022]="TASK_ID_600019",e[e.TASK_ID_600025=600028]="TASK_ID_600025",e[e.TASK_ID_600022=600026]="TASK_ID_600022",e[e.TASK_ID_600017=600018]="TASK_ID_600017",e[e.TASK_ID_600016=600016]="TASK_ID_600016",e[e.TASK_ID_600023=600028]="TASK_ID_600023",e[e.TASK_ID_600023_K=600023]="TASK_ID_600023_K",e[e.TASK_ID_600025_K=600025]="TASK_ID_600025_K",e[e.TASK_ID_600032_K=600032]="TASK_ID_600032_K",e[e.TASK_ID_600038_K=600038]="TASK_ID_600038_K",e[e.TASK_ID_600029_K=600029]="TASK_ID_600029_K"}(n=e.MainUiGuideValue||(e.MainUiGuideValue={}));var o=function(){function e(){}return Object.defineProperty(e,"stageHeight",{get:function(){return this._stageHeight},set:function(e){this._stageHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"heightChangeValue",{get:function(){return this._heightChangeValue},enumerable:!0,configurable:!0}),e.setReqJsonP=function(e){var t="";t="wx360game"!=window.GJlenged_chanel?e.split("?(")[1]:e.split("(")[1];var i=t.substring(0,t.length-1);return JSON.parse(i)},e.setBlueFont=function(e,t,i,n){i?e.font=n?"font_lanzuan_haohua_nianfei_fnt":"font_lanzuan_putong_nianfei_fnt":e.font=n?"font_lanzuan_haohua_fnt":"font_lanzuan_putong_fnt",e.text=t+""},Object.defineProperty(e,"globalConfig",{get:function(){return getGlobalConfig()},enumerable:!0,configurable:!0}),e.isDebugTextureCache=!1,e.isNoPreloadingPanel=!0,e.isUsingIndexHtmlShowPreLoadingUI=!1,e.isNewPuidRegisterNoLoginPanel=!0,e.mainSceneButtonY=1048,e.padddingY=1023,e.SCREEN_WIDTH=640,e.SCREEN_HEIGHT=1136,e.tdy=0,e.isRelease=!0,e.isAppStoreReview=!1,e.isWeChatXiaoChengXuBranch=!1,e.resRootPath="resource/assets2/",e.newResRootPath="resource/assets2/",e.autoLoadMainGroup=!0,e.serverId="1",e.serverName="",e.newServerId="1",e.serverHost="203.195.176.30",e.serverPort=9595,e.wsproxy="",e.wsValid=!0,e.isInit=!1,e.iLoadStep=0,e.MAX_INT=2147483647,e.isNewPlayer=!1,e.actorInSceneShadowModelHeight=120,e.areanFightLimit=1500,e.areanFightRecored=0,e.isNewbeeHeroStep=!1,e.isNewBeeGuildStep=!1,e.isNewBeeAreanStep=!1,e.WingOpenLimited=200,e.isNewBeeWingdStep=!1,e.hasPassNewbeeHeroStep=!1,e.hasPassNewBeeGuildStep=!1,e.hasPassNewBeeWingStep=!1,e.isShowFightOffLine=!1,e.isShowFightGiftControler=!1,e.actionCacheResMaxDirectionNumber=2,e.goBattleBtnswitch=!1,e.LoadMainLoadingUIGroupPriority=101,e.LoadMainUIResPriority=100,e.LoadFoxAniResPriority=-100,e.LoadModelActionAniResPriority=100,e.LoadCreateRoleResPriority=50,e.LoadMapPreviewMoHuSuoLueTuPicPriority=80,e.LoadMapMainScenePicPriority=-10,e.LoadMapBattleScenePicPriority=20,e.LoadModelActionAniMainScenePlayerResPriority=-2,e.LoadModelActionAniMainSceneResPriority=-15,e.LoadFoxAniBattleSkillResPriority=-5,e.LoadBattleSkillSoundResPriority=-500,e.serverOld=137,e.serverOld_yyb=124,e.serverOld_qld=1e3,e.serverOld_xqwd=249,e.serverOld_zyxcx=9,e.xqwdOld_xqwd=333,e.xqwdNew_xqwd=512,e.serverOld_fd=540,e.serverOld_xqh5=359,e.serverOld_zyxcxNum=88,e.serverNew_zyxcxNum=130,e.gdserverpfh5="quickh5gd",e.gdserverpfapp="quickappgd",e.isYouGuSDK=!1,e.ygsdk="yougu",e.isLowMobileDevice=!1,e.designWidth=640,e.designHeight=1136,e.stageWidth=e.designWidth,e._stageHeight=e.designHeight,e._heightChangeValue=0,e.mainBtnsPanelMaskGapBottom=100,e.EquipMaxEnhanceLevel=200,e.BuyPackageCount=10,e.BuyPackageCost=50,e.BuildGodlyEquipmentCost=5e3,e.WordRecycleRewardId=15,e.GemPunchOpenLevel=10,e.EmbedGemOpenLevel=10,e.BaptizeOpenLevel=10,e.GodlyLevelMax=20,e.EquipPartWeight=[0,2,2,0,1,1,3,4,4,2,3],e.MercenaryEnterLevel=15,e.MercenaryOpenLevel=[15,20,25],e.WING_SYSTEM_OPEN_LEVEL=20,e.QMGJItemIDs=[10002,10003,10004,10005,10006,10007],e.CompoundEquipCost=2e3,e.GodlyAttIdByPart=[[],[0,1001,1002,1003,1004,1005,1006,1007,1008,1009,1010],[0,2001,2104,2006,2008,2009,2010,2103,2007,2005,2002]],e.BuyFastFightPrice=[30,50,50,90,90,120,120,150,150],e.BuyBossFightPrice=[50,100,100,200],e.BuyBossMapPrice=[30,50,90,120,120,150,180,180,200],e.PlayerMaxLevel=200,e.RoleTrainCommonCost=500,e.RoleTrainGoldNormalCost=20,e.RoleTrainGoldMediumCost=60,e.RoleTrainGoldSeniorCost=200,e.CreateRegimentTeamCost=50,e.CampAutoRegisterVip=4,e.CampWarReportMax=30,e.CampWarBasicRep=10,e.CampWarBasicCoin=30,e.CampWarFightLimit=2e3,e.openGuildNeedLevel=12,e.openCreateGuildNeedLevel=18,e.ChatCoolTime=4,e.TeamBattleFightLimit=1500,e.ArenaFightLimit=15e4,e.NEXTDAYGIFT="haReceived",e.isAutoFightBoss=!1,e.isBossBtnVisible=!1,e.iGoldItemID=1002,e.iDiamonItemID=1001,e.logLeveldebug=1,e.logLevelInfo=2,e.logLevelWarn=3,e.logLevel=e.logLeveldebug,e.xukongToggleMinId=2001,e.xukongToggleMaxId=2010,e.isKickOut=!0,e.mainMapTileWidth=512,e.mainMapTileHeight=512,e.mainMapMaxX=10,e.mainMapMaxY=7,e.mainMapWidth=e.mainMapMaxX*e.mainMapTileWidth,e.mainMapHeight=e.mainMapMaxY*e.mainMapTileHeight,e.battleMapMaxX=12,e.battleMapMaxY=8,e.battleMapWidth=e.battleMapMaxX*e.mainMapTileWidth,e.battleMapHeight=e.battleMapMaxY*e.mainMapTileHeight,e.EquipQualityNoticeLevel=40,e.battleSpeedRatio=1.2,e.modelSizeScale=1,e.firstvipLevel=-1,e.mineOpenLevel=10,e.quickFightOpenLevel=20,e.guildOpenLevel=30,e.treasureOpenLevel=25,e.petOpenLevel=40,e.skillUpOpenLevel=30,e.halfMonsterOpenLevel=35,e.specialringOpenLevel=50,e.zhanchangfuben=60,e.chongwufuben=40,e.jingmaifuben=85,e.yewaifuben=65,e.isYiDongPay=!1,e.killMonsterNum=9,e.GuideBattleStartIdForPlayer=500501,e.GuideMainSceneStartIdForPlayer=500514,e.GuideAllEndIdForPlayer=500519,e.GuideBattleStartIdForAI=500501,e.GuideAllEndIdForAI=500514,e.GuideSkillIdForPlayer=500506,e}();e.Global=o,__reflect(o.prototype,"foxgame.Global")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.JUEWEI=1]="JUEWEI",e[e.CHIBANG=2]="CHIBANG",e[e.GERENBOSS=3]="GERENBOSS",e[e.ZHUANGBEIFUBEN=4]="ZHUANGBEIFUBEN",e[e.ZHUANGBEISHENGXING=5]="ZHUANGBEISHENGXING",e[e.YEWAIPK=6]="YEWAIPK",e[e.BAOSHIFUBEN=7]="BAOSHIFUBEN",e[e.GONGHUI=8]="GONGHUI",e[e.JINGJICHANG=9]="JINGJICHANG",e[e.TEJIEFUEBN=10]="TEJIEFUEBN",e[e.YOUMINGTA=11]="YOUMINGTA",e[e.TWELVEPALACE=12]="TWELVEPALACE",e[e.CHUANQIBAYE=13]="CHUANQIBAYE",e[e.BAYEZHUANGBEI=14]="BAYEZHUANGBEI",e[e.HUNYI=15]="HUNYI",e[e.SHENQI=16]="SHENQI",e[e.KFBOSS=17]="KFBOSS",e[e.QUENECHING=18]="QUENECHING",e[e.KUAFULIANSAI=19]="KUAFULIANSAI",e[e.DRAGOGODTREASURE=20]="DRAGOGODTREASURE",e[e.YAOJI=21]="YAOJI",e[e.SHENGE=22]="SHENGE",e[e.YUMAOFUBEN=23]="YUMAOFUBEN",e[e.YEWAIBOSS=24]="YEWAIBOSS",e[e.BOSSZHIJIA=25]="BOSSZHIJIA",e[e.DIYIGEHUOBAN=26]="DIYIGEHUOBAN",e[e.DIERGEHUOBAN=27]="DIERGEHUOBAN",e[e.HUNLUANSHENYUAN=28]="HUNLUANSHENYUAN",e[e.PAIHANGBANG=29]="PAIHANGBANG",e[e.SHIJIEBOSS=30]="SHIJIEBOSS",e[e.YAJIEQIUTU=31]="YAJIEQIUTU",e[e.DRAGONBONE=32]="DRAGONBONE"}(t=e.ModuleOpenId||(e.ModuleOpenId={}));var i=function(){function t(){}return t.getAttrValueStr=function(t,i){var n,o,a=e.JsonDataManager.instance.attDefTemplate;for(var s in a)if(o=a[s],o.attId==t){if(o.attId==e.AttDefType.ATT_DIZZINESS_TIME||o.attId==e.AttDefType.ATT_RELIVE_BUFF_TIME)return i/1e3+e.LanguageUtils.instance.getValue("MIAO");o.numType==e.AttDefNumType.INT?n=i.toString():o.numType==e.AttDefNumType.NUMBER&&(n=i/100+"%");break}return n},t.getScore=function(e,t,i,n,o,a,s,r){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=!1),void 0===r&&(r=-1);var l=0;return l+=this.calculateScore(e,t),null!=i&&null!=n&&(l+=this.calculateScore(i,n)),null!=o&&null!=a&&(l+=this.calculateScore(o,a)),s&&(l+=300*r),Math.floor(l)},t.calculateScore=function(t,i){for(var n,o=t.length,a=0,s=e.JsonDataManager.instance.attDefTemplate,r=0;o>r;r++)n=s[t[r]],a+=i[r]*n.score;return a},t.getTimeString=function(t,i){void 0===i&&(i=1),t=Math.floor(t);var n="",o=3600,a=60,s=Math.floor(t/o),r=Math.floor((t-s*o)/a),l=t-s*o-r*a;if(1==i)s>0&&(n+=10>s?"0"+s:s,n+=e.LanguageUtils.instance.getValue("SHI")),n+=10>r?"0"+r:r,n+=e.LanguageUtils.instance.getValue("FEN"),n+=10>l?"0"+l:l,n+=e.LanguageUtils.instance.getValue("MIAO");else if(2==i)n+=10>s?"0"+s:s,n+=":",n+=10>r?"0"+r:r,n+=":",n+=10>l?"0"+l:l;else if(4==i)n+=10>r?"0"+r:r,n+=":",n+=10>l?"0"+l:l;else if(3==i){var h=!0;h&&0==s||(n+=10>s?"0"+s:s,n+=":",h=!1),h&&0==r||(n+=10>r?"0"+r:r,n+=":",h=!1),n+=10>l?"0"+l:l}return n},t.secondsToTimeSimple=function(e,t,i,n){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===n&&(n=!0);var o=Math.floor(e/86400),a=i?Math.floor(e%86400/3600):Math.floor(e/3600),s=i?Math.floor(e%86400%3600/60):Math.floor(e%3600/60),r=i?Math.floor(e%86400%3600%60):Math.floor(e%3600%60),l=o+"天",h=a+"时",c=s+"分",u=r+"秒";return i&&0!=o||(l=""),t||(n&&(0!=r&&(s+=1),c=s+"分"),u=""),0==a&&(h="",0==s&&(c="")),n||(c=""),l+h+c+u},t.getFormatAttText=function(i,n,o){void 0===o&&(o=1);var a,s,r,l,h,c,u,p=new Array,g=i.length;for(s=0;g>s;s++){c=i[s],u=n[s];var d=void 0;d=(s+1)%o==0?"\n":"",r=e.LanguageUtils.instance.getValue("ATT_"+c)+": ",l=e.ColorUtils.instance.getAttrColorById(c),a={text:r,style:{textColor:l}},p.push(a),r=t.getAttrValueStr(c,u)+d,h=e.ColorUtils.instance.getAttrValueColorById(c),a={text:r,style:{textColor:h}},p.push(a)}return p},t.getUnitString=function(t,i){void 0===i&&(i=1);var n=1e4,o=String(t/n*100);if(1==i){if(1e4>t)return t+"";if(t>=1e4&&1e6>t){var a=(parseInt(o)/100).toFixed(2).indexOf(".00")>-1?(t/n).toFixed(0):(parseInt(o)/100).toFixed(2),s=t>=n?a+e.LanguageUtils.instance.getValue("WAN"):t+"";return s}if(t>=1e6&&1e7>t){var a=(parseInt(o)/100).toFixed(1).indexOf(".0")>-1?(t/n).toFixed(0):(parseInt(o)/100).toFixed(1),r=t>=n?a+e.LanguageUtils.instance.getValue("WAN"):t+"";return r}if(t>=1e7){var l=t>=n?(t/n).toFixed(0)+e.LanguageUtils.instance.getValue("WAN"):t+"";return l}}else if(1e6>t)return t+"";var h=t>=n?Math.floor(t/n)+e.LanguageUtils.instance.getValue("WAN"):t+"";return h},t.calcFloat=function(e,t){var i=0,n=e.toString(),o=t.toString();return void 0!=n.split(".")[1]&&(i+=n.split(".")[1].length),void 0!=o.split(".")[1]&&(i+=o.split(".")[1].length),Number(n.replace(".",""))*Number(o.replace(".",""))/Math.pow(10,i)},t.checkModuleOpen=function(t,i){void 0===i&&(i=!1);var n=e.JsonDataManager.instance.allModuleOpenMsg,o=e.PlayerService.instance.level,a=e.PlayerService.instance.vipLevel,s=n[t];if(o>=s.level||0!=s.vipLimit&&a>=s.vipLimit)return!0;if(i){var r=void 0;r=0==s.vipLimit?s.level+"":s.level+"或VIP等级达到"+s.vipLimit,e.PopUpController.getInstance().showFloatTextPanel1("此功能模块开启需要等级达到"+r+"级")}return!1},t.getModuleOpenLevel=function(t){var i=e.JsonDataManager.instance.allModuleOpenMsg,n=i[t];return n.level},t.createMaterialProTextFlow=function(e,t,i,n,o){void 0===i&&(i=0),void 0===n&&(n=!0),void 0===o&&(o=16777215);var a;a=e>=t?65280:16711680;var s=[];switch(i){case 0:s=["",""];break;case 1:s=["(",")"]}var r=[{text:s[0],style:{textColor:o}},{text:this.getUnitString(e)+"",style:{textColor:a}},{text:"/"+this.getUnitString(t)+s[1],style:{textColor:o}}],l="<font color="+o+">"+s[0]+"</font><font color="+a+">"+this.getUnitString(e)+"</font><font color="+o+">/"+(this.getUnitString(t)+s[1])+"</font>";return n?r:l},t.cleanUpMovieClipDataFactory=function(e){},t.sectionToChinese=function(e){var t="个十百千万@#%亿^&~",i="零一二三四五六七八九",n=(e+"").split(""),o=[];if(n.length>12)return void console.error("too big");if("0"===String(e))return"零";for(var a=0,s=n.length-1;s>=a;a++)(1==s||5==s||9==s)&&0==a?"1"!=n[a]&&o.push(i.charAt(Number(n[a]))):o.push(i.charAt(Number(n[a]))),a!=s&&o.push(t.charAt(s-a));return o.join("").replace(/零([十百千万亿@#%^&~])/g,function(e,i,o){if(o=t.indexOf(i),-1!=o){if("亿"==i)return i;if("万"==i)return i;if("0"==n[s-o])return"零"}return""}).replace(/零+/g,"零").replace(/零([万亿])/g,function(e,t){return t}).replace(/亿[万千百]/g,"亿").replace(/[零]$/,"").replace(/[@#%^&~]/g,function(e){return{"@":"十","#":"百","%":"千","^":"十","&":"百","~":"千"}[e]}).replace(/([亿万])([一-九])/g,function(e,i,o,a){return a=t.indexOf(i),-1!=a&&"0"==n[s-a]?i+"零"+o:e})},t.cleanUpMovieClipDataFactoryTested=function(e){if(e){if(e.$mcDataCache){var t=Object.keys(e.$mcDataCache);for(var i in t){var n=e.$mcDataCache[t[i]];n&&(n.$mcData&&(n.$mcData.events=null,n.$mcData.frames=null,n.$mcData.labels=null),n.$mcData=null,n.textureData=null,n.spriteSheet=null,n.frames=null,n.labels=null,n.events=null,delete e.$mcDataCache[t[i]],n=null)}t=null}e.clearCache(),e.mcDataSet=null,e.$spriteSheet=null,e.texture=null}},t.cleanUpMovieClip=function(e){},t.isResOrAssetsMangerOk=function(){var e=!1;return e=t.isAssetsManagerJs?!1:t.ResourceInstance&&t.ResourceInstance.resConfig,!0},t.getResOrAssetsManagerRawResItem=function(e){var i=null;return t.isAssetsManagerJs||(i=t.ResourceInstance.resConfig.getRawResourceItem(e)),i},t.getResOrAssetsManagerGroupItemsByName=function(e){var i=null;t.isAssetsManagerJs||(i=t.ResourceInstance.resConfig.groupDic[e])},t.warningDestroyRes=function(t){e.TextureCache.getInstance().destroyRes(t)},t.destroyGroup=function(t){var i=function(e){},n=RES.destroyRes(t);if(e.Global.isWeChatXiaoChengXuBranch)return egret.assert(!1,"trunk is not xiaochengxu banben"),!0;var o=n;return i(o),o},t.destroyRes=function(t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!0),e.TextureCache.getInstance().destroyRes(t,i,n)},t.destroyEuiImageRes=function(e){if(e&&e.source)if(e.source instanceof egret.Texture);else{var i=""+e.source;t.destroyRes(i)}},t.doTransformDisplayObjectContainerDestroyBitmapResNotUse=function(e){console.warn("废弃的，不能调用")},t.doTransformDisplayObjectContainerDestroyBitmapRes=function(e,i){void 0===i&&(i=!0);var n=t.transformDisplayObjectContainerFetchBitmapSource(e);t.transformResIdArrayDoConditionalDestroy(n,i)},t.doTransformEuiComponentUniqueDestroyBitmapRes=function(e,i,n,o){Log.trace("#####close "+i+" begin transform");var a=egret.getTimer(),s=t.transformDisplayObjectContainerFetchBitmapSource(e),r=t.arrayUnique(s);t.transformResIdArrayDoConditionalDestroy(r,n);var l=AssetAdapter.getInstance().getBaseComponentUiResArray(o);if(l)for(var h in r){var c=r[h];l[c]&&(l[c]=!1)}var u=egret.getTimer()-a;Log.trace("#####close "+i+" end transform, cost time: "+u)},t.transformDisplayObjectContainerFetchBitmapSource2=function(e){var t=0;if(e instanceof egret.DisplayObjectContainer){t=e.numChildren;for(var i=0;t>i;++i){var n=e.getChildAt(i);if(n instanceof eui.Image){var o=n;if(o.source instanceof egret.Texture);else{var a=o.source;o.source="",o.source=a}}(n instanceof eui.Button||n instanceof eui.ToggleButton)&&this.transformDisplayObjectContainerFetchBitmapSource2(n)}}},t.transformDisplayObjectContainerFetchBitmapSource=function(e){var i=[],n=0;if(e instanceof egret.DisplayObjectContainer){n=e.numChildren;for(var o=0;n>o;++o){var a=e.getChildAt(o);if(a instanceof eui.Button||a instanceof eui.ToggleButton){var s=t.transformDisplayObjectContainerFetchBitmapSource(a),r=[];if(a.skin)for(var l=!1,h=1;4>h;h++)if(a.skin["_Image"+h]){var c=a.skin["_Image"+h]._source;l||-1==s.indexOf(c)?r.push(c):l=!0}i=i.concat(s),i=i.concat(r)}else if(a instanceof egret.DisplayObjectContainer){var s=t.transformDisplayObjectContainerFetchBitmapSource(a);i=i.concat(s)}else if(a instanceof eui.Image){var u=a;if(u.sourceList)i=i.concat(u.sourceList),u.sourceList=[];else{var p=t.getEuiImageSourceStringByCondition(u);p&&i.push(p)}}}}if(0>=n&&e instanceof eui.Image){var u=e;if(u.sourceList)i=i.concat(u.sourceList),u.sourceList=[];else{var p=t.getEuiImageSourceStringByCondition(u);p&&i.push(p)}}return i},t.getEuiImageSourceStringByCondition=function(e){var i="",n=e.source;if(n instanceof egret.Texture);else{var o=1,a=1;if(e.$bitmapData&&(o=e.$bitmapData.width,a=e.$bitmapData.height),e.texture&&(o=e.texture.textureWidth,a=e.texture.textureWidth),n){var s=t.isResOrAssetsMangerOk()&&t.ResourceInstance.resConfig.keyMap&&t.ResourceInstance.resConfig.keyMap[n];if(s&&s.url){var r=t.isForceCachecKeyWordsResId(s.url);r||(i=n)}else i=n}}return i},t.arrayUnique=function(e){for(var t=[],i={},n=e.length,o=0;n>o;++o){var a=e[o];i[a]||(i[a]=!0,t.push(a))}return t},t.isForceCachecKeyWordsResId=function(e){for(var i=!1,n=t.ForceCachedResUrlKeyWordsArray.length,o=0;n>o;++o){var a=t.ForceCachedResUrlKeyWordsArray[o];if(e.indexOf(a)>=0){i=!0;break}}return i},t.transformResIdArrayDoConditionalDestroy=function(e,i){void 0===i&&(i=!0);for(var n=e.length,o=0;n>o;++o){var a=e[o];if("ui_char31202"==a);Log.trace("resId: "+a),RES.hasRes(a)||Log.trace("config not has resId: "+a);t.destroyRes(a,!i)}},t.reBuildExmlSkinEuiComponent=function(e){e.removeChildren();var t=e.skinName;e.skinName=null,e.skinName=t},t.showErrorCodeMsg=function(t){var i=e.JsonDataManager.instance.errorCode,n=i[t];return void 0!=n?14==t?void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):void e.GameUtils.MSG_TIP(n):void 0},t.speedLoadResGroupAtLoginPanel=function(){var e=setTimeout(function(){clearTimeout(e),App.getResourceUtils().pilfererLoadGroup("speedLoadAtLoginPanelCombineGroup",["dataConfigGroup","battleBasicGroup"],-10)},1e3)},t.speedLoadResGroupAtCreateCharacterPanel=function(){var e=setTimeout(function(){clearTimeout(e),App.getResourceUtils().pilfererLoadGroup("speedLoadAtCreateCharacterPanelCombineGroup",["commonBasicNotInPreloadingGroup","battleFontGroup","activityBarGroup"],-200)},1500)},t.notifyGlobalPreLoadingProgress=function(e,t,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=""),window.notifyGlobalPreLoadingProgress&&"function"==typeof window.notifyGlobalPreLoadingProgress){var o={progress:e/t*100,itemLoaded:e,itemTotal:t,goFinish:!1,resVersion:""};i&&(o.goFinish=!0),n&&(o.resVersion=n),window.notifyGlobalPreLoadingProgress(o)}},t.getColor=function(){for(var e="0,1,2,3,4,5,6,7,8,9.f",t=e.split(","),i="0x",n=0;6>n;n++)i+=t[Math.floor(Math.random()*t.length)];return Number(i)},t.grayFilter=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],t.blackShadowFilter=[new egret.DropShadowFilter(2,45,0,1,2,2)],t.isAssetsManagerJs=!1,t.__cacheRawResItems={},t.ForceCachedResUrlKeyWordsArray=["/common/","/item/","/font/","shangdianzongdi_png"],t}();e.GlobalUtil=i,__reflect(i.prototype,"foxgame.GlobalUtil");var n=function(){function e(e){this.resName=e,this.startTime=egret.getTimer(),egret.startTick(this.onTickDestroyRes,this)}return e.prototype.onTickDestroyRes=function(e){var t=!1,n=e-this.startTime;return n>500&&(t=!0),t&&(i.warningDestroyRes(this.resName),egret.stopTick(this.onTickDestroyRes,this)),!1},e}();e.DestroyResClass=n,__reflect(n.prototype,"foxgame.DestroyResClass")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="KFMobaiSkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.initUI=function(){this.awdList=[this.awd_0,this.awd_1,this.awd_2,this.awd_3,this.awd_4],this.showAwdInfoTxt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("CSARENA_29")),this.titleAni=new e.FoxAni(this.aniGroup),this.titleAni.play("medal_10064","ani",-1),this.desTxt.text=e.LanguageUtils.instance.getValue("CSARENA_44")},i.prototype.addLister=function(){this.showAwdInfoTxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.mobaiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.firstAvatar.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removeLister=function(){this.showAwdInfoTxt.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.mobaiBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.firstAvatar.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.refreshUI=function(){e.LanguageUtils.instance.getValue("CSARENA_1");this.refreshBetweenTime(),this.refreshAwdList(),this.refreshGroup_1()},i.prototype.clickHandler=function(t){switch(t.target){case this.showAwdInfoTxt:e.KFController.getInstance().showMobaiAwardInfoPanel();break;case this.mobaiBtn:e.KFController.getInstance().sendWorship();break;case this.firstAvatar:var i=this.model.FirstPlayer;if(null==i)return;e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,i.getPlayerIdentify())}},i.prototype.refreshBetweenTime=function(){var t=this.model.CsArenaInfo;this.battleTime.text=e.LanguageUtils.instance.getValue("CSARENA_40")+this.model.timeToDate(t.getWoshipBeginTime(),t.getWoshipEndTime())},i.prototype.refreshGroup_1=function(){var e=!1;if(null!=this.model.FirstPlayer&&(e=!0),this.group_1.visible=e,this.mobaiBtn.visible=!this.model.IsWoship&&0!=this.model.CurStage&&3!=this.model.CurStage,this.redPoint.visible=this.model.mobaiRedPointPreCondition(),this.noFirstPlayer.visible=this.noFirstPlayer1.visible=!e,e){var t=this.model.FirstPlayerAvatar,i=this.model.FirstPlayer;this.firstAvatar.setAvatar(t.getRoleItemId(),t.getClothingId(),t.getWeaponId(),t.getWingId(),Number(t.getFashionClothesId()),Number(t.getFashionWeaponId()),Number(t.getFashionWingId()),Number(t.getDragonArmourGuardLevel()),Number(t.getDragonBoneGuardLevel())),this.winName.text=this.model.getRoleName(i.getPlayerName(),i.getServerId())}else this.setShaderAni()},i.prototype.setShaderAni=function(){var e="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",t="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nuniform float customUniform;\nvoid main(void) {\nvec2 uvs = vTextureCoord.xy;\nvec4 fg = texture2D(uSampler, vTextureCoord);\nfg.rgb += sin(customUniform + uvs.x * 4. + uvs.y * 4.) * 0.2;\ngl_FragColor = fg * vColor;\n}";this.customFilter1=new egret.CustomFilter(e,t,{customUniform:0}),this.noFirstPlayer.filters=[this.customFilter1]},i.prototype.tickHook=function(){null!=this.customFilter1&&(this.customFilter1.uniforms.customUniform+=.1,this.customFilter1.uniforms.customUniform>2*Math.PI&&(this.customFilter1.uniforms.customUniform=0))},i.prototype.refreshAwdList=function(){for(var t=null==this.model.DayOfWeek?1:this.model.DayOfWeek,i=e.JsonDataManager.instance.csWorshipAward,n=0;n<i.length;n++)if(i[n].day==t){for(var o=i[n].firstServerAwards,a=0;a<o.length;a++)this.awdList[a].setItem(Number(o[a][1]),Number(o[a][2]));break}},i.prototype.closeUI=function(){this.removeLister(),this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.firstAvatar&&this.firstAvatar.cleanAvatarRes("KuaFuMoBaiAvatar",e.KFController.getInstance().getKFMainPanelBaseUiName())},i}(eui.Component);e.KFMobaiPanel=t,__reflect(t.prototype,"foxgame.KFMobaiPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.FIGHT=0]="FIGHT",e[e.EQUIP_FURNACE=1]="EQUIP_FURNACE",e[e.EQUIP_INTENSIFY=2]="EQUIP_INTENSIFY",e[e.EQUIP_SOPHISTICATION=3]="EQUIP_SOPHISTICATION",e[e.EQUIP_UP_STAR=4]="EQUIP_UP_STAR",e[e.WING_SYSTEM=5]="WING_SYSTEM",e[e.WING_SYSTEM_UP_STAR=6]="WING_SYSTEM_UP_STAR",e[e.SKILL=7]="SKILL",e[e.PERSONAL_BOSS=8]="PERSONAL_BOSS",e[e.GEM=9]="GEM",e[e.FIELDPK=10]="FIELDPK",e[e.FIELD_BOSS=11]="FIELD_BOSS",e[e.JINGJICHANG=12]="JINGJICHANG",e[e.SEARCHTREASURE=13]="SEARCHTREASURE",e[e.PACKAGE=14]="PACKAGE",e[e.CHAT=15]="CHAT",e[e.UNIONPANEL=16]="UNIONPANEL",e[e.SHOP_MAIN=17]="SHOP_MAIN",e[e.BUY_COIN=18]="BUY_COIN",e[e.RECHARGE=19]="RECHARGE",e[e.BOSS_MAIN=20]="BOSS_MAIN",e[e.ELITE_BOSS=21]="ELITE_BOSS",e[e.GODLYEQUIP=24]="GODLYEQUIP",e[e.SOULUPGRADEPANEL=25]="SOULUPGRADEPANEL",e[e.JUEWEI=27]="JUEWEI",e[e.CHARACTEROPENPANEL=28]="CHARACTEROPENPANEL",e[e.VIP=29]="VIP",e[e.ACHIEVEMENT=30]="ACHIEVEMENT",e[e.RANK=31]="RANK",e[e.WEALPANEL=32]="WEALPANEL",e[e.EVERYDAY_TASK=33]="EVERYDAY_TASK",e[e.CLIMBING=36]="CLIMBING",e[e.EQUIPMENTDUNGEON=34]="EQUIPMENTDUNGEON",e[e.PERSONAL_EQUIP=41]="PERSONAL_EQUIP",e[e.GONGMING=42]="GONGMING",e[e.FIRST_RECHARGE=43]="FIRST_RECHARGE",e[e.LEGEN_WEAPON=44]="LEGEN_WEAPON",e[e.ZHUANGBEIFUBEN=45]="ZHUANGBEIFUBEN",e[e.GUSHENMIBAO=46]="GUSHENMIBAO",e[e.TEJIEFUBEN=47]="TEJIEFUBEN",e[e.CHUANQIbAYE=49]="CHUANQIbAYE",e[e.YAJIEQIUTU=51]="YAJIEQIUTU",e[e.DRAGONGODTREASURE=53]="DRAGONGODTREASURE",e[e.YAOJI=54]="YAOJI",e[e.KUAFUBOSS=55]="KUAFUBOSS",e[e.LONGGUZHUANBEI=56]="LONGGUZHUANBEI",e[e.LONGGUSHENGIXNG=57]="LONGGUSHENGIXNG",e[e.YAOJIFEISHENG=58]="YAOJIFEISHENG",e[e.YAOJIQINMIDU=59]="YAOJIQINMIDU",e[e.SHENZHUANGSHENGJI=60]="SHENZHUANGSHENGJI",e[e.GODHOODPANEL=61]="GODHOODPANEL",e[e.TONGJINZHU=62]="TONGJINZHU",e[e.KUANGHUAN=63]="KUANGHUAN",e[e.DAFUWONG=64]="DAFUWONG",e[e.ZHUANPAN=65]="ZHUANPAN",e[e.DAFANLI=66]="DAFANLI",e[e.LIBAO=67]="LIBAO",e[e.HUIKUI=68]="HUIKUI",e[e.ZAJINDAD=69]="ZAJINDAD"}(t=e.NameCode||(e.NameCode={}));var i=function(){function i(){}return i.prototype.skipTo=function(i){var n=new Object;if(void 0!=i)switch(i){case t.FIGHT:e.PopUpManager.instance.removeAll(),e.NewJueweiController.getInstance().getPanel().getIsShow()&&e.NewJueweiController.getInstance().closePanel(),e.CharacterController.getInstance().getPanel().getIsShow()&&e.CharacterController.getInstance().closePanel(),e.MainControler.instance.checkGuanKaBossCanFight();break;case t.EQUIP_FURNACE:e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT);break;case t.EQUIP_INTENSIFY:e.SmeltController.getInstance().showPanel(e.SMELTTAPS.QIANGHUA);break;case t.EQUIP_SOPHISTICATION:e.SmeltController.getInstance().showPanel(e.SMELTTAPS.SHENZHUANGXILIAN);break;case t.EQUIP_UP_STAR:e.SmeltController.getInstance().showPanel(e.SMELTTAPS.SHENGXING);break;case t.SHENZHUANGSHENGJI:e.SmeltController.getInstance().showPanel(e.SMELTTAPS.SHENZHUANGSHENGJI);break;case t.WING_SYSTEM:e.WingController.getInstance().showWingPanel();break;case t.WING_SYSTEM_UP_STAR:e.WingController.getInstance().showWingStarPanel();break;case t.SKILL:e.NewJueweiController.getInstance().closePanel(),e.CharacterController.getInstance().showPanel(e.CharacterPanelViewType.SKILLVIEW);break;case t.PERSONAL_BOSS:n.tab=1,e.NewBossMainControler.getIntance().showPanel(n);break;case t.GEM:e.NewJueweiController.getInstance().closePanel(),e.CharacterController.getInstance().showPanel(e.CharacterPanelViewType.GEMVIEW);break;
case t.FIELDPK:e.FieldPKController.getInstance().showPKPanel();break;case t.FIELD_BOSS:n.tab=2,e.NewBossMainControler.getIntance().showPanel(n);break;case t.JINGJICHANG:var o=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.JINGJICHANG,!1);if(0==o){var a=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.JINGJICHANG));e.PopUpController.getInstance().showFloatTextPanel1(a)}else e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.NEW_AREA_UI});break;case t.SEARCHTREASURE:e.SearchTreasureController.getInstance().showPanel();break;case t.PACKAGE:e.BagController.getInstance().showPanel();break;case t.CHAT:e.NewChatControler.getInstance().showPanel();break;case t.SHOP_MAIN:e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.SHOP_MAIN),e.ShopMainControler.getInstance().showPanel();break;case t.RECHARGE:e.RechargeController.getInstance().showPanel();break;case t.BOSS_MAIN:n.tab=4,e.NewBossMainControler.getIntance().showPanel(n);break;case t.ELITE_BOSS:n.tab=3,e.NewBossMainControler.getIntance().showPanel(n);break;case t.KUAFUBOSS:n.tab=5,e.NewBossMainControler.getIntance().showPanel(n);break;case t.GODLYEQUIP:e.GodlyEquipController.getInstance().showPanel();break;case t.SOULUPGRADEPANEL:e.SoulController.getInstance().showSoulPanel();break;case t.JUEWEI:e.NewJueweiController.getInstance().showPanel();break;case t.CHARACTEROPENPANEL:e.CharacterOpenController.getInstance().showPanel();break;case t.VIP:e.CreateNewVipController.instance.showPanel();break;case t.ACHIEVEMENT:e.AchievementController.getInstance().showPanel();break;case t.RANK:e.RankController.getInstance().showRankPanel();break;case t.WEALPANEL:e.WealPanelController.getInstance().showWealPanel();break;case t.EVERYDAY_TASK:e.WealPanelController.getInstance().showWealPanel();break;case t.EQUIPMENTDUNGEON:e.FuBenController.getInstance().showPanel(e.FuBenType.EquipType);break;case t.PERSONAL_EQUIP:e.NewJueweiController.getInstance().closePanel(),e.CharacterController.getInstance().showPanel();break;case t.GONGMING:e.GongMingController.getInstance().showPanel(e.GongMingController.getInstance().getRoleData());break;case t.BUY_COIN:e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.SHOP_MAIN);break;case t.FIRST_RECHARGE:e.RechargeController.getInstance().showPanel();break;case t.ZHUANGBEIFUBEN:e.FuBenController.getInstance().showPanel(e.FuBenType.EquipType);break;case t.TEJIEFUBEN:e.FuBenController.getInstance().showPanel(e.FuBenType.SpecialRingType);break;case t.UNIONPANEL:e.UnionController.getInstance().openView();break;case t.CLIMBING:e.WanFaController.getInstance().showPanel();break;case t.CHUANQIbAYE:e.LegendController.getInstance().showMainPanel();break;case t.DRAGONGODTREASURE:e.DragongodTreasureController.getInstance().showpanel();break;case t.YAOJI:e.BeautyController.getInstance().showpanel();break;case t.LONGGUZHUANBEI:e.DragonboneController.getInstance().showpanel();break;case t.LONGGUSHENGIXNG:e.DragonboneController.getInstance().getPanel().showupstar();break;case t.YAOJIFEISHENG:e.BeautyController.getInstance().showillusionpanel();break;case t.YAOJIQINMIDU:e.BeautyController.getInstance().showpanel(2);break;case t.GUSHENMIBAO:e.GoldTreasureController.getInstance().showpanel();break;case t.GODHOODPANEL:e.GodHoodConttroller.getInstance().showpanel();break;case t.TONGJINZHU:e.ActivityController.getIntance().showTongJinZhuPanel();break;case t.KUANGHUAN:e.ActivityController.getIntance().showkuanghuanPanel();break;case t.DAFUWONG:e.ActivityController.getIntance().showDafuwengPanel();break;case t.ZHUANPAN:e.zhuanPanControler.getInstance().showPanel();break;case t.DAFANLI:e.ActivityController.getIntance().sendRECHARGE_REBATE_C();break;case t.LIBAO:e.ActivityController.getIntance().showLibao();break;case t.HUIKUI:e.ActivityController.getIntance().showHuiKuiPanel();break;case t.ZAJINDAD:e.ActivityController.getIntance().showZaJinDanPanel();break;default:Log.trace("无码")}},i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i}();e.SkipCodeDataHandler=i,__reflect(i.prototype,"foxgame.SkipCodeDataHandler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.test=100]="test"}(t=e.appIdType||(e.appIdType={}));var i=function(){function t(){}return t.init=function(){this.urlParams=this.parseUrl()||{},this.giftId=this.getGiftId(),this.platform=new e.GamePlatform,this.platform.isTest=this.isTest(),this.platform.baseUrl=e.Global.globalConfig.serverUrl,(e.Global.globalConfig.isShenHeZhong||window.isCmsdkShenHe)&&(this.platform.baseUrl=e.Global.globalConfig.serverUrlShenHe),this.platform.isTest},t.isTest=function(){return this.urlParams.test?!0:!1},t.enableWSProxy=function(){return this.urlParams.wsp?!0:!1},t.getGiftId=function(){var e=window.location.href.split("giftId=")[1];return void 0==e?"":e},t.testWSProxy=function(){return this.urlParams.test_wsp?!0:!1},t.isQzone=function(){return navigator.userAgent.match(/qzone/i)?!0:!1},t.isAndroid=function(){return navigator.userAgent.match(/(Android)[\s\/]+([\d.]+)/)?!0:!1},t.isIpad=function(){return navigator.userAgent.match(/(iPad).*OS\s([\d_]+)/)?!0:!1},t.isIphone=function(){return!this.isIpad()&&navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)?!0:!1},t.isIpod=function(){return this.isIpod()||this.isIphone()||!navigator.userAgent.match(/(iPod).*OS\s([\d_]+)/)?!1:!0},t.isMQQBrowser=function(){return navigator.userAgent.match(/MQQBrowser/i)?!0:!1},t.isWeixin=function(){return navigator.userAgent.match(/MicroMessenger/i)?!0:!1},t.parseUrl=function(e,t){var i="";egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(i=e?e:window.location.href);var n={};if(t=t||"?",i.indexOf(t)<0)return n;for(var o=i.split(t)[1].split("&"),a=0;a<o.length;a++){var s=o[a].replace(/#.*$/g,"").split("=");s[1]||(s[1]=""),n[s[0]]=s[1]}return n},t.urlParams=null,t}();e.UserInfo=i,__reflect(i.prototype,"foxgame.UserInfo")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.UILAYER="uilayer",e.TOPLAYER="toplayer",e.NEWBEEGUIDELAYER="newBeeGuideLayer",e.LOADING="loading",e.LOGIN="login",e.CREATE="create",e.MAIN="main",e.FIGHT="fight",e.MAIN_BOTTOM="main_bottom",e.FIGHTMAP="fightmap",e.DAILYDUNGEON="DailyDungeon",e.GEMDUNGEON="GemDungeon",e.FEATHERDUNGEON="FeatherDungeon",e.PRERINGDUNGEON="PreRingDungeon",e.FIGHTPKCONTROLER="FightPKControler",e.JUEWEI="jueweiControler",e.FIGHTOFFLINE="fightoffline",e.FIGHTREWARD="fightreward",e.ARENA_MAIN="arenamain",e.ARENA_RECORD="arenarecord",e.SHOP_MAIN="shop_main",e.NEW_SHOPBUY="newShop_buy",e.RAID_MAIN="raidmain",e.WEAPON_SMELT="weaponSmelt",e.WING_SYSTEM="wingSystem",e.WING_SYSTEM_UP_STAR="WING_SYSTEM_UP_STAR",e.WING_SYSTEM_BUY_ITEM="WING_SYSTEM_BUY_ITEM",e.WING_SYSTEM_BUY_ITEM_NORMAL="WING_SYSTEM_BUY_ITEM_NORMAL",e.PACKAGE_SELL_EQUIPS="packagesellequips",e.EQUIP_INFO="equipinfo",e.COMMANDTOOLS="commandtools",e.EMAIL_TEAM_BATTLE_RESULT="emailteambattleresult",e.EMAIL_TEAM_BATTLE_ROUND="emailteambattleround",e.EQUIP_SELECT="equipselect",e.GEM_PROGRESS="GEM_PROGRESS",e.EQUIP_EXTEND="equipextend",e.EQUIP_FUSION="equipfusion",e.EQUIP_SELECT_MULTIPLE="equipselectmultiple",e.EQUIP_SELECT_SWALLOW="equipselectswallow",e.ACTIVITY_DOUBLE_PAY="activity_double_pay",e.ACTIVITY_CONTENT="activity_content",e.HELP_MAIN="help_main",e.HELP_TIP="help_tip",e.ITEM_INFO="iteminfo",e.GEM_UPGRADE="gemupgrade",e.PROF_RANK="profrank",e.SELECTSERVER="selectserver",e.COMPOUND_BOOK="compoundbook",e.MERCENARY_RANK_UP="mercenaryrankup",e.MERCENARY_AURA="mercenaryaura",e.TEAM_BATTLE="teambattle",e.TEAM_BATTLE_MANAGE="teambattlemanage",e.CAMP_WAR_RANK="campwarrank",e.ACTIVITY_EXPEDITION_RANK="expeditionrank",e.ACTIVITY_EXPEDITION_DONATE="expeditiondonate",e.CAMP_WAR_MAIN="campwarmain",e.CAMP_WAR_SELF_SUMMARY="campwarselfsummary",e.DOUBLE_SELECT="double_select",e.WORDS_EXCHANGE="wordsexchange",e.BOSS_MAIN="boss_main",e.BOSS_HOME_MAIN="boss_home_main",e.BOSS_ITEM_FIGHTDETAIL="BOSS_DETAIL_ITEM",e.WORLD_BOSS_FINAL="world_boss_final",e.FIGHTLOSECONTROLER="FightLoseControler",e.FIGHTRESULTWIN="DailyDungeonResultWin",e.FIGHTBOSSRESULTWIN="BossFightResultWin",e.AC_CUMULATIVE_RECHARGE="CumulativeRecharge",e.WELCOME_ROOT_LAYER="WelcomeRootLayer",e.NEW_AREA_UI="NEW_AREA_UI",e.NEW_AREA_RANK_UI="NEW_AREA_RANK_UI",e.NEW_AREA_LOG_UI="NEW_AREA_LOG_UI",e.NEW_AREN_SHAOP_UI="NEW_AREN_SHAOP_UI",e.NEW_AREN_BATTLE_SUCESS_UI="NEW_AREN_BATTLE_SUCESS_UI",e.COMMON_HELP_UI="COMMON_HELP_UI",e.PURE_TEXT_TIPS="PURE_TEXT_TIPS",e.PURE_TEXT_TIPS2="PURE_TEXT_TIPS2",e.SYSTEM_EMAIL_UI="SYSTEM_EMAIL_UI",e}();e.WindowName=t,__reflect(t.prototype,"foxgame.WindowName")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var i=e.call(this)||this;return i.lineSpacing=t.LINE_SPACING_DEFAULT,i.horizontalSpacing=3,i.lineFeedIndexAry=[],i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.groupClick,i),i}return __extends(t,e),t.prototype.groupClick=function(e){Log.trace(e.target.name)},t.prototype.$setWidth=function(t){return this.globleWidth=t,e.prototype.$setWidth.call(this,t),!0},t.prototype.refresh=function(){this.removeChildren(),this.reLine(),this.layoutLines()},t.prototype.reLine=function(){var e=this.msgCompentList,t=this.globleWidth,i=0;this.lineComList=[],this.lineComList[i]=[];for(var n=t,o=0;o<e.length;o++){var a=e[o];if(a instanceof eui.Label&&"\n"==a.text)i++,this.lineComList[i]=[],n=t;else{var s;if(s=a instanceof eui.Label?a.textWidth:a.width,this.lineComList[i].length>0&&(s+=this.horizontalSpacing),!this.autoLineFeed(a,e))if(s>n){if(a instanceof eui.Label){var r=void 0;a.textFlow[0]&&(r=a.textFlow[0].style);var l=Math.floor(n/s*100)/100,h=Math.floor(a.text.length*l),c=a.text.substr(0,h),u=a.text.substr(h,a.text.length);a.text=c,a.textFlow[0].style=r,this.lineComList[i].push(a);var p=new eui.Label;p.text=u,""!=a.name&&(p.name=a.name),p.textFlow[0].style=r,e.splice(o+1,0,p),this.lineFeedIndexAry.push(o),i++,this.lineComList[i]=[],this.lineComList[i].push(p),n=t-s;continue}i++,this.lineComList[i]=[],this.lineComList[i].push(a),n=t-s}else this.lineComList[i].push(a),n-=s}}},t.prototype.autoLineFeed=function(e,t){for(var i=0;i<this.lineFeedIndexAry.length;i++)if(t.indexOf(e)==this.lineFeedIndexAry[i]+1)return!0;return!1},t.prototype.createNewText=function(e){var i=t.newChatTxtLabel();return i.textFlow=new Array({text:e,style:{textColor:16777215}}),i},t.prototype.layoutLines=function(){for(var e=0,t=0;t<this.lineComList.length;t++)if(this.lineComList[t]&&this.lineComList[t].length>0){for(var i=this.lineComList[t],n=this.calLineHeight(i),o=0,a=0;a<i.length;a++){var s=i[a];a>0&&(o+=this.horizontalSpacing),s.x=o,s instanceof eui.Label?s.y=e+n-this.lineSpacing-s.height:s.y=e+n-this.lineSpacing-(n-this.lineSpacing)/2-s.height/2,this.addChild(s),o+=s.width,Log.trace(o)}e+=n,this.globleHeight=e,this.height=this.globleHeight}},t.prototype.calLineHeight=function(e){for(var t=0,i=0;i<e.length;i++){var n=e[i];if(n instanceof eui.Label){var o=this.globleWidth;if(n.textWidth<=o)n.width=n.textWidth,n.height=n.textHeight;else{n.width=o;var a=Math.ceil(n.textWidth/o);n.height=n.textHeight*a+n.lineSpacing*(a-1)}}t=n.height+this.lineSpacing>t?n.height+this.lineSpacing:t}return t},t.newChatTxtLabel=function(){var e=new eui.Label;return e.verticalAlign=egret.VerticalAlign.BOTTOM,e.lineSpacing=t.LINE_SPACING_DEFAULT,e.size=t.TEXT_SIZE_DEFAULT,e},t.newChatImg=function(){var e=new eui.Image;return e.height=t.IMG_HEIGHT_DEFAULT,e},t.LINE_SPACING_DEFAULT=6,t.TEXT_SIZE_DEFAULT=25,t.IMG_HEIGHT_DEFAULT=30,t}(eui.Group);e.ChatBubble=t,__reflect(t.prototype,"foxgame.ChatBubble")}(foxgame||(foxgame={}));var ClickButton=function(e){function t(){var t=e.call(this)||this;return t._boo=0,t}return __extends(t,e),t.prototype.initView=function(e,t){void 0===t&&(t=null),this.sp=new eui.Group,this.addChild(this.sp),this.bg=new eui.Image,this.bg.source=RES.getRes(e),this.sp.addChild(this.bg),t&&(this.title=new eui.Image,this.title.source=RES.getRes(t),null==this.title.source&&(this.title.source=RES.getRes(t)),this.title.x=this.bg.width-this.title.width>>1,this.title.y=this.bg.height-this.title.height>>1,this.sp.addChild(this.title),this.sp.width=this.title.width,this.sp.height=this.title.height),this.noScaleX=this.sp.x,this.noScaleY=this.sp.y},t.prototype.setClick=function(e){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickEvent,this),this.onClick=e},t.prototype.onClickEvent=function(){var e=this;if(!this._boo){var t=egret.setTimeout(function(){egret.clearTimeout(t),t=null,e._boo=0},this,200);this._boo=1;var i=this.sp.width-.8*this.sp.width>>1,n=this.sp.height-.8*this.sp.height>>1;this.tw=egret.Tween.get(this.sp),this.tw.to({scaleX:.7,scaleY:.7,x:i,y:n},60).to({scaleX:1,scaleY:1,x:this.noScaleX,y:this.noScaleY},40).call(this.onClickHandler,this)}},t.prototype.onClickHandler=function(){this.onClick()},t.prototype.distory=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickEvent,this),egret.Tween.removeTweens(this.tw),this.onClick=this.tw=null,this.sp.removeChildren(),this.noScaleX=this.noScaleY=this.bg=this.title=null,this.removeChildren(),this.sp=null},t}(egret.DisplayObjectContainer);__reflect(ClickButton.prototype,"ClickButton");var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="skins.common.CommonButtonSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){this.setButtonSkin(),this.setLabel()},t.prototype.setButtonSkin=function(e,t,i){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this.upSkinName=e,this.downSkinName=t,this.disabledSkinName=i},t.prototype.setLabel=function(e,t,i,n){void 0===e&&(e=""),void 0===t&&(t=!1),void 0===i&&(i=26),void 0===n&&(n=16777215),this._buttonLabelText=e,this._buttonLabelBold=t,this._buttonLabelSize=i,this._buttonLabelColor=n,this.updateButtonLabel()},Object.defineProperty(t.prototype,"upSkinName",{get:function(){return this._upSkinName},set:function(e){e!=this._upSkinName&&(this._upSkinName=e,this.upSkin&&(this.upSkin.source=e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"downSkinName",{get:function(){return this._downSkinName},set:function(e){e!=this._downSkinName&&(this._downSkinName=e,this.downSkin&&(this.downSkin.source=e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabledSkinName",{get:function(){return this._disabledSkinName},set:function(e){e!=this._disabledSkinName&&(this._disabledSkinName=e,this.disabledSkin&&(this.disabledSkin.source=e))},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i),i==this.upSkin?this.upSkin.source=this._upSkinName:i==this.downSkin?this.downSkin.source=this._downSkinName:i==this.disabledSkin?this.disabledSkin.source=this._disabledSkinName:i==this.labelDisplay?this.labelDisplay=null:i==this.buttonLabel&&this.updateButtonLabel()},t.prototype.updateButtonLabel=function(){this.buttonLabel&&(this.buttonLabel.text=this._buttonLabelText,this.buttonLabel.size=this._buttonLabelSize,this.buttonLabel.textColor=this._buttonLabelColor)},t}(eui.Button);e.CommonButton=t,__reflect(t.prototype,"foxgame.CommonButton")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.Button);e.CommonButton2=t,__reflect(t.prototype,"foxgame.CommonButton2")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isSkinReady=!1,e.skinName="skins.common.CommonNoticeSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.isSkinReady=!0},i.prototype.setData=function(t,i,n){void 0===t&&(t="global_tips_tishidian_png"),void 0===i&&(i="PointAni"),void 0===n&&(n=-1),this.isSkinReady&&(this.noticeImage.source=t,!this.effectAni&&i&&""!=i&&(this.effectAni=new e.FoxAni(this.effectGroup),this.effectAni.play(i)),this.visible=!0,0>n?this.num.visible=!1:this.num.visible=!0,this.num.text=n.toString())},i.prototype.clear=function(){this.num.text="",this.noticeImage.source="",this.effectAni&&(this.effectAni.dispose(),this.effectAni=null),this.visible=!1},i}(eui.Component);e.CommonNotice=t,__reflect(t.prototype,"foxgame.CommonNotice")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.myGroupName="",e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(i,t),i.prototype.onRemoveFromStage=function(e){var t=i.radioButtonHash.get(this.myGroupName);if(t)for(var n=0;n<t.length;++n)t[n]==this&&t.splice(n,1)},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.buttonAsset.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this)},i.prototype.setAssets=function(e,t){this.unselectSource=e,this.selectSource=t},Object.defineProperty(i.prototype,"selected",{get:function(){return this.isSelect},set:function(e){this.isSelect=e,this.updateStatus(),this.isSelect&&this.setOtherButtonUnSelect()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupName",{set:function(e){this.myGroupName=e;var t=i.radioButtonHash.get(e);t||(t=[]),-1==t.indexOf(this)&&(t.push(this),i.radioButtonHash.put(e,t))},enumerable:!0,configurable:!0}),i.prototype.addTouchCallback=function(e,t){this.touchCallBackFun=e,this.touchCallBackObject=t},Object.defineProperty(i.prototype,"buttonId",{get:function(){return this._buttonId},set:function(e){this._buttonId=e},enumerable:!0,configurable:!0}),i.prototype.updateStatus=function(){this.isSelect?this.buttonAsset.texture=RES.getRes(this.selectSource):this.buttonAsset.texture=RES.getRes(this.unselectSource)},i.prototype.onTouchHandler=function(e){""!=this.myGroupName&&(this.selected=!0,this.setOtherButtonUnSelect()),this.touchCallBackFun&&this.touchCallBackObject&&this.touchCallBackFun.call(this.touchCallBackObject,this)},i.prototype.setOtherButtonUnSelect=function(){var e=i.radioButtonHash.get(this.myGroupName);if(e)for(var t=0;t<e.length;++t)e[t]!=this&&(e[t].selected=!1)},i.radioButtonHash=new e.HashMap,i}(eui.Component);e.CommonRadioButton=t,__reflect(t.prototype,"foxgame.CommonRadioButton")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._isInit=!1,t._windowType=1,t}return __extends(t,e),t.prototype.setWindowType=function(e){this._windowType=e,this.updateWindowStyle()},t.prototype.setSize=function(e,t){void 0===e&&(e=640),void 0===t&&(t=960),this.width=e,this.height=t},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this._isInit=!0,this.titleLabel.text=this._titleText,this.updateWindowStyle()},Object.defineProperty(t.prototype,"titleText",{set:function(e){e!=this._titleText&&(this._titleText=e,this.titleLabel&&(this.titleLabel.text=this._titleText))},enumerable:!0,configurable:!0}),t.prototype.setBgPos=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.bgAsset&&(this.bgAsset.x=e,this.bgAsset.y=t)},Object.defineProperty(t.prototype,"background",{set:function(e){this.bgAsset.source=e},enumerable:!0,configurable:!0}),t.prototype.updateWindowStyle=function(){this._isInit&&(1==this._windowType?(this.btnBox0.visible=!0,this.btnBox1.visible=!0):2==this._windowType?(this.btnBox0.visible=!1,this.btnBox1.visible=!1):3==this._windowType&&(this.titleBg.visible=!1,this.titleLabel.visible=!1))},t}(eui.Component);e.CommonWindow=t,__reflect(t.prototype,"foxgame.CommonWindow")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CommonWindowNew",t}return __extends(t,e),t}(eui.Component);e.CommonWindowNew=t,__reflect(t.prototype,"foxgame.CommonWindowNew")}(foxgame||(foxgame={}));var foxgame;!function(e){var t,i=function(i){function n(){var t=i.call(this)||this;t.$bounces=!0,t.horizontalScrollBar=null,t.verticalScrollBar=null,t.curIndex=0,t.pageTrigCoef=.15;var n=new e.PageTouchScroll(t.horizontalUpdateHandler,t.horizontalEndHandler,t),o=new eui.sys.TouchScroll(t.verticalUpdateHandler,t.verticalEndHanlder,t);return t.$Scroller={0:"auto",1:"auto",2:null,3:0,4:0,5:!1,6:!1,7:!1,8:n,9:o,10:null,11:!1,12:!1},t}return __extends(n,i),Object.defineProperty(n.prototype,"bounces",{get:function(){return this.$bounces},set:function(e){this.$bounces=!!e;var t=this.$Scroller[8];t&&(t.$bounces=this.$bounces);var i=this.$Scroller[9];i&&(i.$bounces=this.$bounces)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"throwSpeed",{get:function(){return this.$Scroller[8].$scrollFactor},set:function(e){e=+e,0>e&&(e=0),this.$Scroller[8].$scrollFactor=e,this.$Scroller[9].$scrollFactor=e},enumerable:!0,configurable:!0}),n.prototype.$getThrowInfo=function(e,i){return t?(t.currentPos=e,t.toPos=i):t=new eui.ScrollerThrowEvent(eui.ScrollerThrowEvent.THROW,!1,!1,e,i),t},Object.defineProperty(n.prototype,"scrollPolicyV",{get:function(){return this.$Scroller[0]},set:function(e){var t=this.$Scroller;t[0]!=e&&(t[0]=e,this.checkScrollPolicy())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scrollPolicyH",{get:function(){return this.$Scroller[1]},set:function(e){var t=this.$Scroller;t[1]!=e&&(t[1]=e,this.checkScrollPolicy())},enumerable:!0,configurable:!0}),n.prototype.stopAnimation=function(){var e=this.$Scroller,t=e[9],i=e[8];t.animation.isPlaying?eui.UIEvent.dispatchUIEvent(this,eui.UIEvent.CHANGE_END):i.animation.isPlaying&&eui.UIEvent.dispatchUIEvent(this,eui.UIEvent.CHANGE_END),t.stop(),i.stop();var n=this.verticalScrollBar,o=this.horizontalScrollBar;n&&n.autoVisibility&&(n.visible=!1),o&&o.autoVisibility&&(o.visible=!1)},Object.defineProperty(n.prototype,"viewport",{get:function(){return this.$Scroller[10]},set:function(e){var t=this.$Scroller;e!=t[10]&&(this.uninstallViewport(),t[10]=e,t[11]=!1,this.installViewport())},enumerable:!0,configurable:!0}),n.prototype.installViewport=function(){var e=this.viewport;e&&(this.addChildAt(e,0),e.scrollEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBeginCapture,this,!0),e.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEndCapture,this,!0),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTapCapture,this,!0),e.addEventListener(egret.Event.REMOVED,this.onViewPortRemove,this)),this.horizontalScrollBar&&(this.horizontalScrollBar.viewport=e),this.verticalScrollBar&&(this.verticalScrollBar.viewport=e)},n.prototype.uninstallViewport=function(){this.horizontalScrollBar&&(this.horizontalScrollBar.viewport=null),this.verticalScrollBar&&(this.verticalScrollBar.viewport=null);var e=this.viewport;e&&(e.scrollEnabled=!1,e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBeginCapture,this,!0),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEndCapture,this,!0),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTapCapture,this,!0),e.removeEventListener(egret.Event.REMOVED,this.onViewPortRemove,this),0==this.$Scroller[11]&&this.removeChild(e))},n.prototype.onViewPortRemove=function(e){e.target==this.viewport&&(this.$Scroller[11]=!0,this.viewport=null)},n.prototype.setSkin=function(e){i.prototype.setSkin.call(this,e);var t=this.viewport;t&&this.addChildAt(t,0)},n.prototype.onTouchBeginCapture=function(e){this.$Scroller[12]=!1;var t=this.checkScrollPolicy();t&&this.onTouchBegin(e)},n.prototype.onTouchEndCapture=function(e){this.$Scroller[12]&&(e.stopPropagation(),this.onTouchEnd(e))},n.prototype.onTouchTapCapture=function(e){this.$Scroller[12]&&e.stopPropagation()},n.prototype.checkScrollPolicy=function(){var e=this.$Scroller,t=e[10];if(!t)return!1;var i,n=t.$UIComponent;switch(e[1]){case"auto":i=t.contentWidth>n[10]?!0:!1;break;case"on":i=!0;break;case"off":i=!1}e[6]=i;var o;switch(e[0]){case"auto":o=t.contentHeight>n[11]?!0:!1;break;case"on":o=!0;break;case"off":o=!1}return e[7]=o,i||o},n.prototype.onTouchBegin=function(e){if(!e.isDefaultPrevented()&&this.checkScrollPolicy()){this.downTarget=e.target;var t=this.$Scroller;this.stopAnimation(),t[3]=e.$stageX,t[4]=e.$stageY,t[6]&&t[8].start(e.$stageX),t[7]&&t[9].start(e.$stageY);var i=this.$stage;this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveListeners,this)}},n.prototype.onTouchMove=function(e){if(!e.isDefaultPrevented()){var t=this.$Scroller;if(!t[5]){if(Math.abs(t[3]-e.$stageX)<n.scrollThreshold)var i=!1;else i=!0;if(Math.abs(t[4]-e.$stageY)<n.scrollThreshold)var o=!1;else o=!0;if(!i&&!o)return;if(i&&"off"==t[1])return;if(o&&"off"==t[0])return;t[12]=!0,t[5]=!0,this.dispatchCancelEvent(e);var a=this.horizontalScrollBar,s=this.verticalScrollBar;a&&a.autoVisibility&&t[6]&&(a.visible=!0),s&&s.autoVisibility&&t[7]&&(s.visible=!0),t[2]&&t[2].reset(),eui.UIEvent.dispatchUIEvent(this,eui.UIEvent.CHANGE_START),this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)}e.preventDefault();var r=t[10],l=r.$UIComponent;t[6]&&t[8].update(e.$stageX,r.contentWidth-l[10],r.scrollH),t[7]&&t[9].update(e.$stageY,r.contentHeight-l[11],r.scrollV)}},n.prototype.onTouchCancel=function(e){this.$Scroller[5]||this.onRemoveListeners()},n.prototype.dispatchCancelEvent=function(e){var t=this.$Scroller[10];if(t){for(var i=new egret.TouchEvent(egret.TouchEvent.TOUCH_CANCEL,e.bubbles,e.cancelable),n=this.downTarget,o=this.$getPropagationList(n),a=o.length,s=.5*o.length,r=-1,l=0;a>l;l++)if(o[l]===t){r=l;break}o.splice(0,r+1),s-=r+1,this.$dispatchPropagationEvent(i,o,s),egret.Event.release(i)}},n.prototype.onTouchEnd=function(e){var t=this.$Scroller;t[5]=!1,this.onRemoveListeners();var i=t[10],n=i.$UIComponent;if(t[8].isStarted()){var o=this.pageList[this.curIndex],a=e.$stageX-t[3],s=Math.abs(a),r=0;Math.abs(a)>=o.width*this.pageTrigCoef&&(r=0-a/s),this.changePage(r)}t[9].isStarted()&&t[9].finish(i.scrollV,i.contentHeight-n[11])},n.prototype.changePage=function(e){var t=this.$Scroller,i=this.curIndex+e,o=this.curIndex;i>=0&&i<this.pageList.length&&(this.curIndex=i),this.curIndex!=o&&eui.UIEvent.dispatchUIEvent(this,n.PAGE_CHAGED_EVENT);var a=this.leftList[this.curIndex];t[8].finishMove(a,500)},n.prototype.onRemoveListeners=function(){var e=this.$stage;this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0),e.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,!0),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveListeners,this)},n.prototype.horizontalUpdateHandler=function(e){this.dispatchEventWith(egret.Event.CHANGE),this.$Scroller[10].scrollH=e},n.prototype.verticalUpdateHandler=function(e){this.dispatchEventWith(egret.Event.CHANGE),this.$Scroller[10].scrollV=e},n.prototype.horizontalEndHandler=function(){this.$Scroller[9].isPlaying()||this.onChangeEnd()},n.prototype.verticalEndHanlder=function(){this.$Scroller[8].isPlaying()||this.onChangeEnd()},n.prototype.onChangeEnd=function(){var e=this.$Scroller,t=this.horizontalScrollBar,i=this.verticalScrollBar;(t&&t.visible||i&&i.visible)&&(e[2]||(e[2]=new egret.Timer(200,1),e[2].addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onAutoHideTimer,this)),e[2].reset(),e[2].start()),eui.UIEvent.dispatchUIEvent(this,eui.UIEvent.CHANGE_END)},n.prototype.onAutoHideTimer=function(e){var t=this.horizontalScrollBar,i=this.verticalScrollBar;t&&t.autoVisibility&&(t.visible=!1),i&&i.autoVisibility&&(i.visible=!1)},n.prototype.updateDisplayList=function(e,t){i.prototype.updateDisplayList.call(this,e,t);var n=this.viewport;n&&(n.setLayoutBoundsSize(e,t),n.setLayoutBoundsPosition(0,0))},n.prototype.partAdded=function(e,t){i.prototype.partAdded.call(this,e,t),t==this.horizontalScrollBar?(this.horizontalScrollBar.touchChildren=!1,this.horizontalScrollBar.touchEnabled=!1,this.horizontalScrollBar.viewport=this.viewport,this.horizontalScrollBar.autoVisibility&&(this.horizontalScrollBar.visible=!1)):t==this.verticalScrollBar&&(this.verticalScrollBar.touchChildren=!1,this.verticalScrollBar.touchEnabled=!1,this.verticalScrollBar.viewport=this.viewport,this.verticalScrollBar.autoVisibility&&(this.verticalScrollBar.visible=!1))},n.prototype.refresh=function(){if(this.pageList){if(this.curIndex>=this.pageList.length)return void console.error("scroller page index error, curIndex "+this.curIndex+" length "+this.pageList.length);var e=new eui.Group;this.leftList=[];for(var t=0,i=0;i<this.pageList.length;i++){var n=this.pageList[i];n.x=t,this.leftList[i]=n.x,t+=n.width,e.addChild(n)}e.width=t+this.pageList[this.pageList.length-1].width,e.height=this.pageList[0].height,this.viewport=e,this.viewport.scrollH=this.leftList[this.curIndex];var o=this.$Scroller[8];o&&(o.currentScrollPos=this.leftList[this.curIndex]),this.viewport.validateNow()}},n.prototype.clear=function(){this.pageList=null},n.PAGE_CHAGED_EVENT="page_scroller_page_change",n.scrollThreshold=5,n}(eui.Component);e.PageScroller=i,__reflect(i.prototype,"foxgame.PageScroller"),eui.registerProperty(i,"viewport","eui.IViewport",!0)}(foxgame||(foxgame={}));var foxgame;!function(e){function t(e){var t=e-1;return t*t*t+1}var i=4,n=[1,1.33,1.66,2],o=2.33,a=.02,s=.998,r=.95,l=Math.log(s),h=function(){function e(e,i,n){this.$scrollFactor=1,this.previousTime=0,this.velocity=0,this.previousVelocity=[],this.currentPosition=0,this.previousPosition=0,this.currentScrollPos=0,this.maxScrollPos=0,this.offsetPoint=0,this.$bounces=!0,this.started=!0,this.updateFunction=e,this.endFunction=i,this.target=n,this.animation=new eui.sys.Animation(this.onScrollingUpdate,this),this.animation.easerFunction=t}return e.prototype.isPlaying=function(){return this.animation.isPlaying},e.prototype.stop=function(){this.animation.stop(),egret.stopTick(this.onTick,this),this.started=!1},e.prototype.isStarted=function(){return this.started},e.prototype.start=function(e){this.started=!0,this.velocity=0,this.previousVelocity.length=0,this.previousTime=egret.getTimer(),this.previousPosition=this.currentPosition=e,this.offsetPoint=e,egret.startTick(this.onTick,this)},e.prototype.update=function(e,t,i){t=Math.max(t,0),this.currentPosition=e,this.maxScrollPos=t;var n=this.offsetPoint-e,o=n+i;this.offsetPoint=e,0>o&&(this.$bounces?o-=.5*n:o=0),o>t&&(this.$bounces?o-=.5*n:o=t),this.currentScrollPos=o,this.updateFunction.call(this.target,o)},e.prototype.finish=function(e,t){egret.stopTick(this.onTick,this),this.started=!1;for(var i=this.velocity*o,h=this.previousVelocity,c=h.length,u=o,p=0;c>p;p++){var g=n[p];i+=h[0]*g,u+=g}var d=i/u,f=Math.abs(d),m=0,y=0;if(f>a)if(y=e+(d-a)/l*2*this.$scrollFactor,0>y||y>t)for(y=e;Math.abs(d)>a;)y-=d,d*=0>y||y>t?s*r:s,m++;else m=Math.log(a/f)/l;else y=e;if(this.target.$getThrowInfo){var I=this.target.$getThrowInfo(e,y);y=I.toPos}m>0?(this.$bounces||(0>y?y=0:y>t&&(y=t)),this.throwTo(y,m)):this.finishScrolling()},e.prototype.onTick=function(e){var t=e-this.previousTime;if(t>10){var n=this.previousVelocity;n.length>=i&&n.shift(),this.velocity=(this.currentPosition-this.previousPosition)/t,n.push(this.velocity),this.previousTime=e,this.previousPosition=this.currentPosition}return!0},e.prototype.finishScrolling=function(e){var t=this.currentScrollPos,i=this.maxScrollPos,n=t;0>t&&(n=0),t>i&&(n=i),this.throwTo(n,300)},e.prototype.throwTo=function(e,t){void 0===t&&(t=500);var i=this.currentScrollPos;if(i==e)return void this.endFunction.call(this.target);var n=this.animation;n.duration=t,n.from=i,n.to=e,n.play()},e.prototype.onScrollingUpdate=function(e){this.currentScrollPos=e.currentValue,this.updateFunction.call(this.target,e.currentValue)},e.prototype.finishMove=function(e,t){void 0===t&&(t=500),egret.stopTick(this.onTick,this),this.started=!1,this.throwTo(e,t)},e}();e.PageTouchScroll=h,__reflect(h.prototype,"foxgame.PageTouchScroll")}(foxgame||(foxgame={}));var TabBarButton=function(e){function t(){return e.call(this)||this
}return __extends(t,e),Object.defineProperty(t.prototype,"data",{set:function(e){this.mydata=e,this.titleName&&(this.titleName.text=this.data.title)},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i),this.data&&i==this.titleName&&(this.titleName.text=this.data.title)},t}(eui.ItemRenderer);__reflect(TabBarButton.prototype,"TabBarButton");var TabBarContainer=function(e){function t(t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null);var o=e.call(this)||this;return t||(t="resource/skins/wealModule/compoment/TabBarSkin.exml"),i||(i="resource/skins/wealModule/WearTabbarButtonSkin.exml"),n||(n=TabBarButton),o._dp=new eui.ArrayCollection,o._views=[],o.skinName=t,o.tabBarItemRendererSkinName(i),o.tabBarItemRenderer(n),o}return __extends(t,e),t.prototype.initButtonSkin=function(e){this.skinName=e},t.prototype.onTabBarIndexChanged=function(e){this.viewStack.selectedIndex=this.tabBar.selectedIndex},t.prototype.setTabBarIndex=function(e){this.viewStack&&this.tabBar&&(0>e&&this.viewStack.length<=e?e=0:e,this.viewStack.selectedIndex=this.tabBar.selectedIndex=e)},t.prototype.partAdded=function(t,i){if(e.prototype.partAdded.call(this,t,i),i==this.tabBar)this.tabBar.itemRendererSkinName=this._tabBarItemRendererSkinName,this.tabBar.itemRenderer=this._tabBarItemRenderer,this.tabBar.dataProvider=this._dp,this.tabBar.addEventListener(egret.Event.CHANGE,this.onTabBarIndexChanged,this);else if(i==this.viewStack){for(var n=0,o=this._views.length;o>n;n++)this.viewStack.addChild(this._views[n]);this._views.length=0,this.tabBar.selectedIndex=0,this.viewStack.selectedIndex=0}},t.prototype.tabBarItemRendererSkinName=function(e){this._tabBarItemRendererSkinName=e,this.tabBar&&(this.tabBar.itemRendererSkinName=this._tabBarItemRendererSkinName)},t.prototype.tabBarItemRenderer=function(e){this._tabBarItemRenderer=e,this.tabBar&&(this.tabBar.itemRenderer=this._tabBarItemRenderer)},t.prototype.setScrollEnabled=function(e){this.viewStack.scrollEnabled=e},t.prototype.hideScrollerSource=function(){this.scroller.horizontalScrollBar.thumb.visible=!1,this.scroller.verticalScrollBar.thumb.visible=!1},t.prototype.showScrollerSource=function(){this.scroller.horizontalScrollBar.thumb.visible=!0,this.scroller.verticalScrollBar.thumb.visible=!0},t.prototype.addViewStackElement=function(e,t,i){this._dp.addItem({title:e,titleSelected:t}),this.viewStack?this.viewStack.addChild(i):this._views.push(i)},t.prototype.dispose=function(){this._dp&&(this._dp.removeAll(),this._dp=null),this.viewStack&&(this.viewStack.removeChildren(),this.viewStack=null,App.DisplayUtils().removeFromParent(this.viewStack)),this.tabBar&&(this.tabBar.removeEventListener(egret.Event.CHANGE,this.onTabBarIndexChanged,this),this.tabBar.removeChildren(),this.tabBar=null,App.DisplayUtils().removeFromParent(this.tabBar)),this.scroller&&(this.scroller.removeChildren(),this.scroller=null,App.DisplayUtils().removeFromParent(this.scroller)),this._views=null,this._tabBarItemRendererSkinName=this._tabBarItemRenderer=null},t}(eui.Component);__reflect(TabBarContainer.prototype,"TabBarContainer");var foxgame;!function(e){var t=function(){function t(t,i,n,o){void 0===n&&(n=null),void 0===o&&(o=null),this.defaultAction=e.EnumManager.ACTION_TYPE.ACTION_IDLE,this.defaultDirection=e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT,this.modelCfg=e.JsonDataManager.instance.modelTemplate,this.onCharLoaded=null,this.actionList=[],this.actionTable=t,this.mParent=i;var a=n,s=o;null==a&&(a=this.defaultAction),null==s&&(s=this.defaultDirection),this.updateAction(a,s)}return t.prototype.updateAction=function(t,i,n,o,a){if(void 0===n&&(n=-1),void 0===o&&(o=null),void 0===a&&(a=null),1==this.actionTable.length){var s=0;s=1}for(var r=i,s=0;s<this.actionTable.length;s++){var l=this.mParent.getChildByName("m"+this.actionTable[s].name),h=this.modelCfg[this.actionTable[s].modelId],c=this.modelCfg[this.actionTable[s].replaceModelId];h&&c&&(i==e.EnumManager.DIRECTION_ENUM.DIR_UP&&(r=e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),i==e.EnumManager.DIRECTION_ENUM.DIR_DOWN&&(r=e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT),App.DeviceUtils().IsLowCapabilitiesMobileDevice()&&(i==e.EnumManager.DIRECTION_ENUM.DIR_LEFT&&(r=e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT),i==e.EnumManager.DIRECTION_ENUM.DIR_RIGHT&&(r=e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT)));var u=this.getActionCache(this.actionTable[s].name);if(null!=u)this.actionTable[s].name.search("MainWeapon")>=0?t==e.EnumManager.ACTION_TYPE.ACTION_CASTER?u.playhas(e.EnumManager.ACTION_TYPE.ACTION_ATTACK,e.ActionDefine.instance.DirectionFip.get(r),n,o,a):t==e.EnumManager.ACTION_TYPE.ACTION_ATTACK?u.playhas(e.EnumManager.ACTION_TYPE.ACTION_CASTER,e.ActionDefine.instance.DirectionFip.get(r),n,o,a):u.playhas(t,e.ActionDefine.instance.DirectionFip.get(r),n,o,a):u.playhas(t,e.ActionDefine.instance.DirectionFip.get(r),n,o,a);else{var p=e.Global.LoadModelActionAniResPriority;this.mParent.parent.parent&&this.mParent.parent.parent.playerInfo&&(p=e.Global.LoadModelActionAniMainScenePlayerResPriority),u=new e.ActionCache(l),this.actionList.push(u),u.controller=this,u.modelId=this.actionTable[s].modelId,u.replaceModelId=this.actionTable[s].replaceModelId,null!=h&&null!=c&&u.play(this.actionTable[s].name,h.name,c.name,t,e.ActionDefine.instance.DirectionFip.get(r),n,o,a)}}for(var g=e.ActionDefine.instance.ZOrderMap.get(r),s=0;s<g.length;s++)this.mParent.getChildByName("m"+g[s])&&this.mParent.setChildIndex(this.mParent.getChildByName("m"+g[s]),s);this.desDirection=r,this.desAction=t,this.mParent.scaleX=e.ActionDefine.instance.DirectionFip.get(r)==r?1:-1},t.prototype.changeAction=function(e,t,i,n,o){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=-1),null!=this.actionTable&&(this.desAction!=e||this.desDirection!=t)&&this.updateAction(e,t,o,i,n)},t.prototype.getActionCache=function(e){try{for(var t=0;t<this.actionList.length;t++)if(this.actionList[t].getName()==e)return this.actionList[t]}catch(i){Log.trace("exception: "+i.toString()),console.error(i)}return null},t.prototype.release=function(){this.onCharLoaded=null,this.mParent=null;for(var e=0;e<this.actionTable.length;++e)this.actionTable[e]=null;this.actionTable.splice(0,this.actionTable.length),this.actionTable=null,this.desAction=null,this.desDirection=null;for(var e=0;e<this.actionList.length;e++)this.actionList[e].dispose();this.actionList.splice(0,this.actionList.length),this.actionList=null},t.prototype.refreshAction=function(e){for(var t=0;t<this.actionTable.length;++t)this.actionTable[t]=null;this.actionTable.splice(0,this.actionTable.length),this.actionTable=e;for(var t=0;t<this.actionList.length;t++)this.actionList[t].dispose();this.actionList.splice(0,this.actionList.length),this.actionList=[]},t}();e.ActionController=t,__reflect(t.prototype,"foxgame.ActionController")}(foxgame||(foxgame={}));var ResourceManager=function(){function e(){}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.loadConfig=function(e,t,i){},e}();__reflect(ResourceManager.prototype,"ResourceManager");var foxgame;!function(e){var t=function(){function t(){this.Action_Dir=[e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT,e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT,e.EnumManager.DIRECTION_ENUM.DIR_DOWN,e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT,e.EnumManager.DIRECTION_ENUM.DIR_LEFT,e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT,e.EnumManager.DIRECTION_ENUM.DIR_UP],this.DirectionSpeed=new e.HashMap,this.BattleDirectionSpeed=new e.HashMap,this.DirectionFip=new e.HashMap,this.LeaderAction=new e.HashMap,this.ActionParametersMap=new e.HashMap,this.ZOrderMap=new e.HashMap,this.EquipPartNames=new e.HashMap,this.LeaderAction.put(e.EnumManager.ACTION_TYPE.ACTION_IDLE,this.Action_Dir),this.LeaderAction.put(e.EnumManager.ACTION_TYPE.ACTION_RUN,this.Action_Dir),this.LeaderAction.put(e.EnumManager.ACTION_TYPE.ACTION_ATTACK,this.Action_Dir),this.LeaderAction.put(e.EnumManager.ACTION_TYPE.ACTION_CASTER,this.Action_Dir),this.LeaderAction.put(e.EnumManager.ACTION_TYPE.ACTION_DEATH,this.Action_Dir),this.LeaderAction.put(e.EnumManager.ACTION_TYPE.ACTION_FLY,this.Action_Dir),this.ActionParametersMap.put("action",this.LeaderAction),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,e.EnumManager.DIRECTION_ENUM.DIR_RIGHT),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT,e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN,e.EnumManager.DIRECTION_ENUM.DIR_DOWN),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT,e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_LEFT,e.EnumManager.DIRECTION_ENUM.DIR_RIGHT),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),this.DirectionFip.put(e.EnumManager.DIRECTION_ENUM.DIR_UP,e.EnumManager.DIRECTION_ENUM.DIR_UP);var t=210,i=1e3;this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_LEFT,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT,t/i),this.DirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_UP,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_LEFT,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT,t/i),this.BattleDirectionSpeed.put(e.EnumManager.DIRECTION_ENUM.DIR_UP,t/i),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_LEFT,["Chest","Wing","MainWeapon","OtherWeapon"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,["Chest","Wing","OtherWeapon","MainWeapon"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_UP,["OtherWeapon","MainWeapon","Chest","Wing"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT,["Chest","MainWeapon","OtherWeapon","Wing"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT,["Wing","Chest","OtherWeapon","MainWeapon"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN,["Wing","Chest","MainWeapon","OtherWeapon"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT,["Wing","Chest","MainWeapon","OtherWeapon"]),this.ZOrderMap.put(e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT,["Chest","MainWeapon","OtherWeapon","Wing"]),this.EquipPartNames.put(e.EquipPartType.WING,"Wing"),this.EquipPartNames.put(e.EquipPartType.WEAPON,"MainWeapon"),this.EquipPartNames.put(e.EquipPartType.CLOTHES,"Chest")}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();e.ActionDefine=t,__reflect(t.prototype,"foxgame.ActionDefine")}(foxgame||(foxgame={}));var GuideItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuideViewitem",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.ItemRenderer);__reflect(GuideItem.prototype,"GuideItem");var GuideMaskBackgroud=function(e){function t(){var t=e.call(this)||this;return t._stageWidth=0,t._stageHeight=0,t._bgs=new Array,t.touchEnabled=!0,t}return __extends(t,e),t.prototype.init=function(e,t){this._stageWidth=e,this._stageHeight=t},t.prototype.draw=function(e){this._deductRec=e,this.removeAllChild();var t=Math.max(e.x,0),i=Math.max(e.y,0),n=Math.min(e.x+e.width,this._stageWidth),o=Math.min(e.y+e.height,this._stageHeight);this.addBg(0,0,this._stageWidth,i),this.addBg(0,i,t,e.height),this.addBg(n,i,this._stageWidth-n,e.height),this.addBg(0,o,this._stageWidth,this._stageHeight-o),this.width=this._stageWidth,this.height=this._stageHeight},t.prototype.destroy=function(){this.removeChildren(),this._bgs=[]},t.prototype.removeAllChild=function(){for(;this.numChildren;){var e=this.removeChildAt(0);this._bgs.push(e)}},t.prototype.addBg=function(e,t,i,n){var o;this._bgs.length?(o=this._bgs.pop(),o.graphics.clear()):o=new egret.Shape,o.graphics.beginFill(0,.5),o.graphics.drawRect(e,t,i,n),o.graphics.endFill(),this.addChild(o)},t.prototype.hitTest=function(e,t,i){return this._deductRec&&this._deductRec.contains(e,t)?null:this},t}(egret.Sprite);__reflect(GuideMaskBackgroud.prototype,"GuideMaskBackgroud");var GuideUtils=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currPart=0,t.currStep=0,t.currlv=!1,t.currdbz=0,t.currxbz=0,t.canShow=0,t}return __extends(t,e),t.prototype.change_point=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0),(null!=this._ani||null!=this.view)&&("right"==e&&(this._ani.mcObject.x+=i,this.view.x+=i),"left"==e&&(this.view.x-=i,this._ani.mcObject.x-=i),"up"==t&&(this.view.y-=n,this._ani.mcObject.y-=n),"down"==t&&(this._ani.mcObject.y+=n,this.view.y+=n))},t.prototype.play_soung_guide=function(){var e=this.currlv?this.currdbz:this.currPart,t=this.configData[e];t&&0!=t.whetherOpen&&(App.SoundManager().setEffectVolume(1),App.SoundManager().playEffect(t.voiceName+"_mp3"))},t.prototype.groupComplete=function(){if(!(this.configData[this.targetPart].id<0)){var e=this.configData[this.targetPart].stepInfo[this.targetStep],t=this.configData[this.targetPart].name[this.targetStep];switch(null==this.view&&(this.view=new GuideView,this.view.initView()),this._ani&&(this._ani.clear(),this._ani=null),null==this._ani&&(this._ani=new foxgame.FoxAni(this._parent)),this._ani.offsetX=this.obj.x+(this.obj.width>>1),this._ani.offsetY=this.obj.y+(this.obj.height>>1),this._ani.play("guideff","guideff",-1),this.view.setData(this.obj,e.handDir,t.name),this._parent.addChild(this.view),this.view.anchorOffsetX=this.view.width>>1,this.view.anchorOffsetY=this.view.height>>1,e.handDir){case 1:this.view.x=this._ani.offsetX-(this.view.width>>1),this.view.y=this.obj.y+(this.obj.height>>1);break;case 2:this.view.x=this._ani.offsetX+this.view.width,this.view.y=this.obj.y+(this.obj.height>>1)}}},t.prototype.show=function(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this.targetPart=i,this.targetStep=n,this.currlv?(this.currdbz=i,this.currxbz=n):(this.currPart=i,this.currStep=n),this.obj=e,this._parent=t,this.groupComplete()},t.prototype.showicon=function(e){},t.prototype.hide=function(){null!=this.view&&null!=this.view.parent&&(this.view.parent.removeChild(this.view),this.view=null),this._ani&&(this._ani.remove(),this._ani=null)},t.prototype.isShow=function(){return null!=this.view&&null!=this.view.parent},t.prototype.initConfig=function(e){this.configData=e},t}(BaseClass);__reflect(GuideUtils.prototype,"GuideUtils");var GuideView=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=t.touchChildren=!1,t}return __extends(t,e),t.prototype.initView=function(){null==this._hand&&(this._hand=new GuideItem),this.addChild(this._hand)},t.prototype.onResize=function(){},t.prototype.setData=function(e,t,i){null!=e&&(this._hand.img.x=1==t?0:this._hand.width>>1,this._hand.img.scaleX=1==t?1:-1,this._hand.txt.text=i,this._hand.txt.x=1==t?0:45-(this._hand.width>>1))},t.prototype.distoryFunc=function(){},t.prototype.getArow=function(){return this._hand},t}(eui.Component);__reflect(GuideView.prototype,"GuideView");var LittleLoading=function(e){function t(){var t=e.call(this)||this;return t.content=null,t.speed=.6,t.progressLabel=null,t.loadingTimer=null,t.timeoutTimer=null,t.debugInfoWhoCallMe="",t}return __extends(t,e),t.prototype.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,foxgame.Global.stageWidth,foxgame.Global.stageHeight),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer),this.progressLabel=new egret.TextField,this.progressLabel.size=20,this.content.addChild(this.progressLabel)},t.prototype.addSource=function(){var e=RES.getRes("u_LoandingAni02_png");if(e){var t=new egret.Bitmap;t.texture=e,t.x=.5*-t.width,t.y=.5*-t.height,this.uiImageContainer.addChild(t)}},t.prototype.showLoading=function(e){var t=this;void 0===e&&(e=""),Log.trace("LittleLoading 显示加载 "+e),0==this.uiImageContainer.numChildren&&this.addSource(),this.loadingTimer&&(egret.clearTimeout(this.loadingTimer),this.loadingTimer=null),this.loadingTimer=egret.setTimeout(function(){t.getStage().addChild(t.content)},this,500),this.setProgress(0),App.TimerManager().doFrame(1,0,this.enterFrame,this),this.timeoutTimer&&(egret.clearTimeout(this.timeoutTimer),this.timeoutTimer=null),this.timeoutTimer=egret.setTimeout(function(){t.hideLoading("timeoutTimer")},this,8e3)},t.prototype.isShow=function(){return null!=this.content.parent},t.prototype.hideLoading=function(e){void 0===e&&(e=""),Log.trace("LittleLoading 隐藏加载 "+e),this.timeoutTimer&&(egret.clearTimeout(this.timeoutTimer),this.timeoutTimer=null),this.loadingTimer&&(egret.clearTimeout(this.loadingTimer),this.loadingTimer=null),this.content&&this.content.parent&&(this.getStage().removeChild(this.content),this.uiImageContainer.rotation=0),App.TimerManager().remove(this.enterFrame,this)},t.prototype.enterFrame=function(e){this.averageUtils.push(this.speed*e),this.uiImageContainer.rotation+=this.averageUtils.getValue()},t.prototype.getStage=function(){return egret.MainContext.instance.stage},t.prototype.setProgress=function(e){e>0&&1>=e?(this.progressLabel.text=Math.floor(100*e).toString()+"%",this.progressLabel.x=.5*this.content.width-.5*this.progressLabel.width,this.progressLabel.y=.5*this.content.height-.5*this.progressLabel.height):this.progressLabel.text=""},t}(BaseClass);__reflect(LittleLoading.prototype,"LittleLoading");var AverageUtils=function(){function e(e){void 0===e&&(e=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=e}return e.prototype.push=function(e){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(e),this.numSum+=e,this.numsLen++},e.prototype.getValue=function(){return this.numSum/this.numsLen},e.prototype.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},e}();__reflect(AverageUtils.prototype,"AverageUtils");var foxgame;!function(e){var t=function(){function e(e,t,i){void 0===i&&(i=1),this.name=e,this.modelId=t,null==i?this.replaceModelId=90001:this.replaceModelId=i}return e}();e.NameToModel=t,__reflect(t.prototype,"foxgame.NameToModel");var i=function(){function i(){}return i.CreateActionInfoFromMapPlayer=function(t,n,o,a){if(void 0===o&&(o=null),void 0===a&&(a=null),!t)return null;var s=new Array,r=Number(t.getFashionClothesId());r?s.push(i.CreateFashionClothes(r,t.getRoleItemId())):s.push(i.CreateChest(t.getEquipItemId(),t.getRoleItemId()));var l=Number(t.getFashionWeaponId());l?s.push(i.CreateFashionWeapon(l)):null!=i.CreateMainWeapon(t.getWeaponItemId(),t.getRoleItemId())&&s.push(i.CreateMainWeapon(t.getWeaponItemId(),t.getRoleItemId()));var h=Number(t.getFashionWingId());return h?s.push(i.CreateFashionWing(h)):t.getWingItemId()&&"0_0"!=t.getWingItemId()&&s.push(i.CreateWing(t.getWingItemId())),new e.ActionController(s,n.mBodyNode,o,a)},i.CreateChest=function(n,o){var a=e.JsonDataManager.instance.equipTemplate,s=a[n],r=null,l=null;if(null!=s){var h=void 0;switch(o){case 1:case 2:case 3:h=e.RoleSexType.MAN;break;case 4:case 5:case 6:h=e.RoleSexType.WOMAN}r=s.getModelId(h),l=i.getReplaceModelId(r)}else{var c=e.JsonDataManager.instance.roleTemplate,u=c[o];null!=u&&(r=u.defaultModel),l=i.getReplaceModelId(r)}return new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),r,l)},i.CreateMainWeapon=function(n,o){var a=e.JsonDataManager.instance.equipTemplate,s=a[n],r=null,l=null;if(s){var h=void 0;switch(o){case 1:case 2:case 3:h=e.RoleSexType.MAN;break;case 4:case 5:case 6:h=e.RoleSexType.WOMAN}return r=s.getModelId(),l=i.getReplaceModelId(r),new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WEAPON),r,l)}},i.CreateWing=function(n){var o=e.WingService.instance.getWingUpCfg(),a=o[n];return a?new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WING),a.model,i.getReplaceModelId(a.model)):null},i.CreateWelcomeRun=function(t,n){var o=[];return t.type==e.RoleType.MAIN_ROLE&&(null!=t.equipIds[0]?(o.push(i.CreateChest(t.equipIds[0],t.itemId)),null!=t.equipIds[1]&&o.push(i.CreateMainWeapon(t.equipIds[1],t.itemId))):o=i.CreateActionInfoByRoleId(t.itemId)),new e.ActionController(o,n)},i.IsRoleEntityActionControllerChanged=function(t,n){for(var o=!1,a=n.getEquipInfoByPart(e.EquipPartType.CLOTHES),s=n.getEquipInfoByPart(e.EquipPartType.WEAPON),r=(n.wingId,Number(n.roleInfo.getFashionClothesId())),l=Number(n.roleInfo.getFashionWeaponId()),h=Number(n.roleInfo.getFashionWingId()),c=null,u=null,p=null,g=0;g<t.length;++g){var d=t[g];d.name==e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES)?c=d:d.name==e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WEAPON)?u=d:d.name==e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WING)&&(p=d)}var f=null;if(f=r?i.CreateFashionClothes(r,n.itemId):a?i.CreateChest(a.getEquipId(),n.itemId):n.type==e.RoleType.CALLBEAST?i.CreateActionInfoByRoleId(n.roleId,n.type)[0]:i.CreateActionInfoByRoleId(n.itemId)[0],f.modelId!=c.modelId)return!0;var m=null;if(l?m=i.CreateFashionWeapon(l):s&&(m=i.CreateMainWeapon(s.getEquipId(),n.itemId)),null!=u&&null==m)return!0;if(null==u&&null!=m)return!0;if(u&&m&&u.modelId!=m.modelId)return!0;var y=null;if(h)y=i.CreateFashionWing(h);else if(n.wingId&&(n.type==e.RoleType.MAIN_ROLE||n.type==e.RoleType.MERCENARY)){var I=i.CreateWing(n.wingId);I&&(y=I)}return null!=p&&null==y?!0:null==p&&null!=y?!0:p&&y&&p.modelId!=y.modelId?!0:o},i.CreateRunUnitByRoleEntity=function(t,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null);var s=new Array,r=Number(t.roleInfo.getFashionClothesId());if(r)s.push(i.CreateFashionClothes(r,t.itemId));else if(t.isSelfRole&&null!=t.getEquipInfoByPart(e.EquipPartType.CLOTHES))s.push(i.CreateChest(t.getEquipInfoByPart(e.EquipPartType.CLOTHES).getEquipId(),t.itemId));else if(0==t.isSelfRole&&t.getRoleEquipByPart(e.EquipPartType.CLOTHES)){var l=t.getRoleEquipByPart(e.EquipPartType.CLOTHES);s.push(i.CreateChest(l.getEquipItemId(),t.itemId))}else s=t.type==e.RoleType.CALLBEAST?i.CreateActionInfoByRoleId(t.roleId,t.type):i.CreateActionInfoByRoleId(t.itemId);var h=Number(t.roleInfo.getFashionWeaponId());if(h)s.push(i.CreateFashionWeapon(h));else if(t.isSelfRole&&null!=t.getEquipInfoByPart(e.EquipPartType.WEAPON))s.push(i.CreateMainWeapon(t.getEquipInfoByPart(e.EquipPartType.WEAPON).getEquipId(),t.itemId));else if(0==t.isSelfRole&&t.getRoleEquipByPart(e.EquipPartType.WEAPON)){var l=t.getRoleEquipByPart(e.EquipPartType.WEAPON);s.push(i.CreateMainWeapon(l.getEquipItemId(),t.itemId))}var c=Number(t.roleInfo.getFashionWingId());if(c)s.push(i.CreateFashionWing(c));else if(t.wingId){var u=i.CreateWing(t.wingId);u&&s.push(u)}return new e.ActionController(s,n,o,a)},i.CreateBattleUnitBySimpleRole=function(t,n){var o=new Array;return parseInt(t.getType().toString())==e.RoleType.MAIN_ROLE?o=i.CreateActionInfoBySimpleRole(t,e.RoleType.MAIN_ROLE):parseInt(t.getType().toString())==e.RoleType.MERCENARY?o=i.CreateActionInfoBySimpleRole(t,e.RoleType.MERCENARY):parseInt(t.getType().toString())==e.RoleType.MONSTER?o=i.CreateActionInfoByMonsterId(t.getMonsterId()):parseInt(t.getType().toString())==e.RoleType.CALLBEAST?o=i.CreateActionInfoByMonsterId(t.getMonsterId()):parseInt(t.getType().toString())==e.RoleType.BEAUTY&&(o=i.CreateActionInfoByMonsterId(t.getMonsterId())),new e.ActionController(o,n)},i.CreateBattleUnitBySimpleRole1=function(t,n){var o=new Array;return parseInt(t.type)==e.RoleType.MAIN_ROLE?o=i.CreateActionInfoBySimpleRole1(t,e.RoleType.MAIN_ROLE):parseInt(t.type)==e.RoleType.MERCENARY?o=i.CreateActionInfoByRoleId(t.roleItemId):parseInt(t.type)==e.RoleType.MONSTER&&(o=i.CreateActionInfoByMonsterId(t.monsterId)),new e.ActionController(o,n)},i.CreateBattleUnitByMonsterId=function(t,n){var o=i.CreateActionInfoByMonsterId(t);return new e.ActionController(o,n)},i.CreateActionInfoBySimpleRole1=function(n,o){for(var a=new Array,s=e.JsonDataManager.instance.equipTemplate,r=!1,l=0;l<n.equipIds.length;l++){var h=n.equipIds[l],c=s[h];c&&(a.push(new t(e.ActionDefine.instance.EquipPartNames.get(c.bodyIndex),c.modelIdArray[n.roleItemId-1],i.getReplaceModelId(c.modelIdArray[n.roleItemId-1]))),c.bodyIndex==e.EquipPartType.CLOTHES&&(r=!0))}return r?a:a=i.CreateActionInfoByRoleId(n.roleItemId)},i.CreateActionInfoBySimpleRole=function(t,n){var o,a=new Array,s=e.JsonDataManager.instance.equipTemplate,r=null,l=null,h=null,c=t.getRoleItemId();switch(c){case 1:case 2:case 3:o=e.RoleSexType.MAN;break;case 4:case 5:case 6:o=e.RoleSexType.WOMAN}var u=Number(t.getFashionClothesId());u&&(r=this.CreateFashionClothes(u,c));var p=Number(t.getFashionWeaponId());p&&(l=this.CreateFashionWeapon(p));var g=Number(t.getFashionWingId());if(g&&(h=this.CreateFashionWing(g)),!r||!l){for(var d=null,f=null,m=t.getEquipIds(),y=0;y<m.length;y++){var I=m[y],v=s[I];v.partList[0]==e.EquipPartType.CLOTHES?d=I:v.partList[0]==e.EquipPartType.WEAPON&&(f=I)}!r&&d&&(r=i.CreateChest(d,c)),!l&&f&&(l=i.CreateMainWeapon(f,c))}if(r||(r=i.CreateActionNudeByRoleId(c)),!h){var _=t.getWingItemId();_&&"0_0"!=_&&(h=i.CreateWing(_))}return r&&a.push(r),l&&a.push(l),h&&a.push(h),a},i.CreateActionInfoByRoleId=function(n,o){void 0===o&&(o=1);var a=new Array,s=-1;if(o==e.RoleType.CALLBEAST){var r=e.JsonDataManager.instance.monster[n];null!=r&&(s=r.modelId)}else{var l=e.JsonDataManager.instance.roleTemplate,h=l[n];null!=h&&(s=h.defaultModel)}return a.push(new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),s,i.getReplaceModelId(s))),a},i.CreateActionNudeByRoleId=function(n){var o=e.JsonDataManager.instance.roleTemplate,a=o[n],s=null;return null!=a&&(s=a.defaultModel),new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),s,i.getReplaceModelId(s))},i.CreateActionInfoByMonsterId=function(n){var o=new Array,a=e.JsonDataManager.instance.monster[n],s=null,r=null;return null!=e.BattleService.instance.modelId?(s=e.BattleService.instance.modelId,r=i.getReplaceModelId(s)):null!=a&&(s=a.modelId,r=i.getReplaceModelId(a.modelId)),o.push(new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),s,r)),o},i.CreateActionInfoFromeMapPet=function(n,o){if(null!=n&&0!=n){var a=new Array,s=e.JsonDataManager.instance.monster,r=s[n];if(r){var l=i.getReplaceModelId(r.modelId);a.push(new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),r.modelId,l))}return new e.ActionController(a,o)}},i.getReplaceModelId=function(t){var i=e.JsonDataManager.instance.modelTemplate,n=i[t];if(n){var o=n.replaceModelId,a=i[o];return null==a?90001:e.ActionManager.instance.isResLoadeds(a.name)?o:90001}return 90001},i.CreateFashionClothes=function(n,o){var a=e.JsonDataManager.instance.fashionTemplate,s=a.getFashionInfoByEquipId(n);if(null!=s){var r=void 0;switch(o){case 1:case 2:case 3:r=e.RoleSexType.MAN;break;case 4:case 5:case 6:r=e.RoleSexType.WOMAN}var l=s.getModelId(r),h=i.getReplaceModelId(l);return new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),parseInt(l),h)}},i.CreateFashionWeapon=function(n){var o=e.JsonDataManager.instance.fashionTemplate,a=o.getFashionInfoByEquipId(n);if(null!=a){var s=a.getModelId(),r=i.getReplaceModelId(s);return new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WEAPON),parseInt(s),r)}},i.CreateFashionWing=function(n){var o=e.JsonDataManager.instance.fashionTemplate,a=o.getFashionInfoByEquipId(n);if(null!=a){var s=a.getModelId(),r=i.getReplaceModelId(s);return new t(e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WING),parseInt(s),r)}},i}();e.ActionUtils=i,__reflect(i.prototype,"foxgame.ActionUtils")}(foxgame||(foxgame={}));var SoundBg=function(e){function t(){var t=e.call(this)||this;return t._position=0,t._isPause=!1,t}return __extends(t,e),t.prototype._init=function(){this.init(),this._currBg=""},t.prototype.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._position=0,this._isPause=!1,this._currSoundChannel=null,this._currSound=null,this._currBg=""},t.prototype.play=function(e){var t=e;if(t.indexOf("_mp3")<=0&&(t+="_mp3"),this._currBg!=t){this.stop(),this._currBg=t;var i=this.getSound(t);i&&this.playSound(i)}},t.prototype.pause=function(e){if(void 0===e&&(e=null),this._currSoundChannel&&(this._isPause=!this._isPause,this._currSound)){null!=e&&(this._isPause=e);try{this._isPause?(this._position=this._currSoundChannel.position,this._currSoundChannel.stop()):(this._currSoundChannel.stop(),this._currSoundChannel=this._currSound.play(this._position),this._currSoundChannel.volume=this._volume)}catch(t){Log.trace("报错"),this._currBg=""}}},t.prototype.playSound=function(e){this._currSound=e;try{this._currSoundChannel=this._currSound.play(0)}catch(t){Log.trace("报错"),this._currBg=""}this._currSoundChannel.volume=this._volume},t.prototype.setVolume=function(e){this._volume=e,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},t.prototype.loadedPlay=function(e){var t=e;t.indexOf("_mp3")<=0&&(t+="_mp3"),this._currBg==t&&this.playSound(RES.getRes(t))},t.prototype.checkCanClear=function(e){var t=e;return t.indexOf("_mp3")<=0&&(t+="_mp3"),this._currBg!=t},t}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(e){function t(){var t=e.call(this)||this;return t.nowSound=[],t}return __extends(t,e),t.prototype._init=function(){this.init()},t.prototype.play=function(e,t){void 0===t&&(t=1);var i=e;i.indexOf("_mp3")<=0&&(i+="_mp3");var n=this.getSound(i);return n?this.playSound(n,t):null},t.prototype.stop=function(){if(this.nowSound.length>0){for(var e=0;e<this.nowSound.length;e++)this.nowSound[e].stop();this.nowSound.length=0}},t.prototype.pushnowSound=function(e){for(var t=!1,i=0;i<this.nowSound.length;i++)if(this.nowSound[i]==e){t=!0;break}0==t&&this.nowSound.push(e)},t.prototype.playSound=function(e,t){void 0===t&&(t=1);try{var i=e.play(0,t);return i.volume=this._volume,this.pushnowSound(i),i}catch(n){return Log.trace("报错"),null}},t.prototype.setVolume=function(e){this._volume=e},t.prototype.loadedPlay=function(e){var t=e;t.indexOf("_mp3")<=0&&(t+="_mp3"),this.playSound(RES.getRes(t))},t.prototype.playBattleSkill=function(e){var t=this.getBattleSkillSound(e);t&&this.playSound(t)},t.prototype.getBattleSkillSound=function(e){var t=e;t.indexOf("_mp3")<=0&&(t+="_mp3");var i=RES.getRes(t);if(i)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),RES.createGroup(t,[t]);var n=function(e){e.groupName==t&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,n,this),this.onResourceLoadComplete(RES.getRes(t),t))};RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,n,this),RES.loadGroup(t,Global.LoadBattleSkillSoundResPriority)}return i},t}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var PlayerService=foxgame.PlayerService,SoundManager=function(e){function t(){var t=e.call(this)||this;return t.soundStatus=!1,t}return __extends(t,e),t.prototype.init=function(){this.bgOn=!0,this.effectOn=!0,this.bgVolume=1,this.effectVolume=1,this.soundStatus=!0,this.bg=new SoundBg,this.bg._init(),this.bg.setVolume(this.bgVolume),this.effect=new SoundEffects,this.effect._init(),this.effect.setVolume(this.effectVolume)
},t.prototype.reSetSound=function(){if(egret.localStorage)if(isLocalStorage()){var e=egret.localStorage.getItem("gjgame_puid");this.bgVolume=parseFloat(egret.localStorage.getItem(e+"bgVolume"))||1,this.effectVolume=parseFloat(egret.localStorage.getItem(e+"effectVolume"))||1,egret.localStorage.getItem(e+"closeSound")?this.soundStatus="true"==egret.localStorage.getItem(e+"closeSound")?!0:!1:this.soundStatus=!0}else this.bgVolume=1,this.effectVolume=1,this.soundStatus=!0;else this.bgVolume=1,this.effectVolume=1,this.soundStatus=!0;this.setSoundStatus(this.soundStatus)},t.prototype.playEffect=function(e){return this.effectOn?this.effect.play(e):void 0},t.prototype.playBg=function(e){this.currBg=e,this.bgOn&&this.bg.play(e)},t.prototype.pauseBg=function(e){void 0===e&&(e=null),this.bgOn&&this.bg.pause(e)},t.prototype.stopBg=function(){this.bg.stop()},t.prototype.setEffectOn=function(e){this.effectOn=e,this.effect&&this.effect.stop()},t.prototype.getEffectOn=function(){return this.effectOn},t.prototype.setBgOn=function(e){this.bgOn=e,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},t.prototype.getBgOn=function(){return this.bgOn},t.prototype.setBgVolume=function(e){if(e=Math.min(e,1),e=Math.max(e,0),this.bgVolume=e,this.bg.setVolume(this.bgVolume),isLocalStorage()){var t=egret.localStorage.getItem("gjgame_puid");egret.localStorage.setItem(t+"effectVolume",this.effectVolume+"")}},t.prototype.setSoundStatus=function(e){if(this.soundStatus=e,this.setEffectOn(this.soundStatus),isLocalStorage()){var t=egret.localStorage.getItem("gjgame_puid");egret.localStorage.setItem(t+"closeSound",this.soundStatus+"")}},t.prototype.getCloseSound=function(){return this.soundStatus},t.prototype.getBgVolume=function(){return this.bgVolume},t.prototype.setEffectVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.effectVolume=e,this.effect.setVolume(this.effectVolume)},t.prototype.getEffectVolume=function(){return this.effectVolume},t.prototype.playBattleSkillEffect=function(e){this.effectOn&&this.effect.playBattleSkill(e)},t.prototype.playEffectLoop=function(e){return this.effectOn?this.effect.play(e,0):void 0},t.CLEAR_TIME=18e4,t}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var starlingswf;!function(e){var t=function(){function t(i,n,o){void 0===o&&(o=24),this._swfData=i,this._assetManager=n,this._createDisplayFuns=new Object,this._createDisplayFuns[t.dataKey_Sprite]=this.createSprite,this._createDisplayFuns[t.dataKey_MovieClip]=this.createMovie,this._createDisplayFuns[t.dataKey_Image]=this.createImage,this._createDisplayFuns[t.dataKey_Scale9]=this.createS9Image,this._createDisplayFuns[t.dataKey_ShapeImg]=this.createShapeImage,this._createDisplayFuns[t.dataKey_TextField]=this.createTextField,this.swfUpdateManager=e.SwfUpdateManager.createSwfUpdateManager(o)}return t.prototype.createSprite=function(i,n,o){void 0===n&&(n=null),void 0===o&&(o=null),null==o&&(o=this._swfData[t.dataKey_Sprite][i]);for(var a,s,r,l=new e.SwfSprite,h=o.length,c=0;h>c;c++)a=o[c],r=this._createDisplayFuns[a[1]],null!=r&&(s=r.apply(this,[a[0],a]),s.name=a[9],s.x=a[2],s.y=a[3],a[0]==t.dataKey_TextField,a[1]!=t.dataKey_Scale9&&a[1]!=t.dataKey_ShapeImg&&(s.scaleX=a[4],s.scaleY=a[5]),s.skewX=a[6],s.skewY=a[7],s.alpha=a[8],l.addChild(s));return l},t.prototype.createMovie=function(i,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var a,s,r,l,h,c=this._swfData[t.dataKey_MovieClip][i],u=c.objCount,p={};for(h in u){s=u[h][0],r=u[h][1],a=null==p[h]?[]:p[h];for(var g=0;r>g;g++)l=this._createDisplayFuns[s],null!=l&&a.push(l.apply(this,[h,null]));p[h]=a}var d;return d=null==o?new e.SwfMovieClip(c.frames,c.labels,p,this):new o(c.frames,c.labels,p,this),d.loop=c.loop,d},t.prototype.createImage=function(e,i){void 0===i&&(i=null);var n=this._swfData[t.dataKey_Image][e],o=this._assetManager.createBitmap(e);return o.anchorOffsetX=n[0],o.anchorOffsetY=n[1],o},t.prototype.getTexture=function(e){return this._assetManager.getTexture(e)},t.prototype.createS9Image=function(e,i){void 0===i&&(i=null);var n=this._swfData[t.dataKey_Scale9][e],o=this._assetManager.createBitmap(e);return o.scale9Grid=new egret.Rectangle(n[0],n[1],n[2],n[3]),null!=i&&(o.width=i[10],o.height=i[11]),o},t.prototype.createShapeImage=function(e,t){void 0===t&&(t=null);var i=this._assetManager.createBitmap(e);return i.fillMode=egret.BitmapFillMode.REPEAT,null!=t&&(i.width=t[10],i.height=t[11]),i},t.prototype.createTextField=function(e,t){void 0===t&&(t=null);var i=new egret.TextField;return null!=t&&(i.width=t[10],i.height=t[11],i.textColor=t[13],i.size=t[14],i.textAlign=t[15],i.text=t[18]),i},t.prototype.hasSprite=function(e){return null!=this._swfData[t.dataKey_Sprite][e]},t.prototype.hasMovieClip=function(e){return null!=this._swfData[t.dataKey_MovieClip][e]},t.prototype.hasImage=function(e){return null!=this._swfData[t.dataKey_Image][e]},t.prototype.hasS9Image=function(e){return null!=this._swfData[t.dataKey_Scale9][e]},t.prototype.hasShapeImage=function(e){return null!=this._swfData[t.dataKey_ShapeImg][e]},t.dataKey_Sprite="spr",t.dataKey_Image="img",t.dataKey_MovieClip="mc",t.dataKey_TextField="text",t.dataKey_Button="btn",t.dataKey_Scale9="s9",t.dataKey_ShapeImg="shapeImg",t.dataKey_Component="comp",t.dataKey_Particle="particle",t}();e.Swf=t,__reflect(t.prototype,"starlingswf.Swf")}(starlingswf||(starlingswf={}));var starlingswf;!function(e){var t=function(){function e(){this._sheets={},this._textures={}}return e.prototype.addSpriteSheet=function(e,t){this._sheets[e]=t},e.prototype.addTexture=function(e,t){this._textures[e]=t},e.prototype.createBitmap=function(e){var t=this.getTexture(e);if(null==t)return null;var i=new egret.Bitmap;return i.texture=t,i},e.prototype.getTexture=function(e){var t,i,n;for(n in this._sheets)if(i=this._sheets[n],t=i.getTexture(e),null!=t)break;return null==t&&(t=this._textures[e]),t},e}();e.SwfAssetManager=t,__reflect(t.prototype,"starlingswf.SwfAssetManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(e){var t=function(){function e(){}return e.createSwfUpdateManager=function(t){var i=new e;return i._animations=[],i._addQueue=[],i._removeQueue=[],i._currentTime=0,i.setFps(t),App.TimerManager().doFrame(1,0,i.update,i),i},e.prototype.clear=function(){this._addQueue.splice(0),this._removeQueue.splice(0),this._animations.splice(0)},e.prototype.stop=function(){this.clear(),App.TimerManager().remove(this.update,this)},e.prototype.play=function(){App.TimerManager().doFrame(1,0,this.update,this)},e.prototype.setFps=function(e){this._fps=e,this._fpsTime=1e3/e},e.prototype.addSwfAnimation=function(e){this._addQueue.push(e)},e.prototype.removeSwfAnimation=function(e){this._removeQueue.push(e);var t=this._addQueue.indexOf(e);-1!=t&&this._addQueue.splice(t,1)},e.prototype.updateAdd=function(){for(var e,t,i=this._addQueue.length,n=0;i>n;n++)t=this._addQueue.pop(),e=this._animations.indexOf(t),-1==e&&this._animations.push(t)},e.prototype.updateRemove=function(){for(var e,t,i=this._removeQueue.length,n=0;i>n;n++)t=this._removeQueue.pop(),e=this._animations.indexOf(t),-1!=e&&this._animations.splice(e,1)},e.prototype.update=function(e){if(this._currentTime+=e,!(this._currentTime<this._fpsTime)){this._currentTime-=this._fpsTime,this._update();for(var t=0;this._currentTime>this._fpsTime;)this._currentTime-=this._fpsTime,t++,4>t&&this._update()}},e.prototype._update=function(){this.updateRemove(),this.updateAdd();for(var e=this._animations.length,t=0;e>t;t++)this._animations[t].update()},e}();e.SwfUpdateManager=t,__reflect(t.prototype,"starlingswf.SwfUpdateManager")}(starlingswf||(starlingswf={}));var foxgame;!function(e){var t=function(){function t(){}return t.createBuffByAction=function(i){var n=new t,o=e.JsonDataManager.instance.buffTemplate,a=e.JsonDataManager.instance.effectTemplate,s=i.getBuffId(),r=o[s];if(null==r)throw new Error("无法找到的buffid："+s);n.endTime=i.getEndTime(),n.proiority=r.privority,n.id=s,n.isShow=!1;var l=r.effectId,h=a[l];return null!=h&&(n.effectInfo=h,n.prefix=h.prefix),n},t.prototype.stopBuffEffect=function(t){this.isShow&&e.EffectUtils.stop(null,this.spriteInfo,t),this.isShow=!1},t.prototype.update=function(e){try{return e.getBattleKeepTime()>=this.endTime?(this.isShow&&this.stopBuffEffect(e),!0):!1}catch(t){return console.error(t.toString()),!1}},t.effectPlayCallBackFunction=function(t){var i=null,n=null;t.hasOwnProperty("sprite")&&(i=t.sprite),t.hasOwnProperty("spriteInfo")&&(n=t.spriteInfo),e.EffectUtils.stop(i,n),i=null,n=null,t=null},t.prototype.show=function(i,n){if(void 0===n&&(n=!1),null!=this.effectInfo){var o=e.EffectUtils.create(i.effectHeightNode,this.effectInfo,!0,e.ActionDefine.instance.DirectionFip.get(i.direction));if(this.spriteInfo=o,this.isShow=!0,0==this.spriteInfo.effectType){var a=i.effectHeightNode;if(a.x=0,a.y=0,null!=a){a.scaleY=i.scaleY*this.effectInfo.scale,a.scaleX=2==e.ActionDefine.instance.DirectionFip.get(2)?i.scaleX*this.effectInfo.scale:-1*i.scaleX*this.effectInfo.scale,a.visible=!0;var s=e.NewBattleUtility.fixEffectPosition(new egret.Point(a.x,a.y),i,this.effectInfo.position,e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,parseInt(this.effectInfo.posX),parseInt(this.effectInfo.posY));a.x=s.x/i.scaleX,a.y=s.y/i.scaleX;var r={sprite:i.effectHeightNode,spriteInfo:this.spriteInfo};e.EffectUtils.play(i.effectHeightNode,this.spriteInfo,t.effectPlayCallBackFunction,r)}}else{var r={sprite:i,spriteInfo:this.spriteInfo};e.EffectUtils.play(i,this.spriteInfo,t.effectPlayCallBackFunction,r)}}},t.prototype.showPeople=function(i,n){if(void 0===n&&(n=!1),null!=this.effectInfo){var o=e.EffectUtils.create(i.mBuffEffect,this.effectInfo,!0,e.ActionDefine.instance.DirectionFip.get(i.getCurDirection()));if(this.spriteInfo=o,this.isShow=!0,0==this.spriteInfo.effectType){var a=i.mBuffEffect;if(a.x=0,a.y=0,null!=a){a.scaleY=i.scaleY*this.effectInfo.scale,a.scaleX=2==e.ActionDefine.instance.DirectionFip.get(2)?i.scaleX*this.effectInfo.scale:-1*i.scaleX*this.effectInfo.scale,a.visible=!0;var s=e.NewBattleUtility.fixEffectPosition(new egret.Point(a.x,a.y),i,this.effectInfo.position,e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,parseInt(this.effectInfo.posX),parseInt(this.effectInfo.posY));a.x=s.x/i.scaleX,a.y=s.y/i.scaleX;var r={sprite:i.mBuffEffect,spriteInfo:this.spriteInfo};e.EffectUtils.play(i.mBuffEffect,this.spriteInfo,t.effectPlayCallBackFunction,r)}}else{var r={sprite:i,spriteInfo:this.spriteInfo};e.EffectUtils.play(i,this.spriteInfo,t.effectPlayCallBackFunction,r)}}},t.prototype.stopBuffEffectPeople=function(t){this.isShow&&e.EffectUtils.stop(null,this.spriteInfo,t),this.isShow=!1},t.showBuffByBuffIdPeople=function(i,n,o){var a=new t,s=e.JsonDataManager.instance.buffTemplate,r=e.JsonDataManager.instance.effectTemplate,l=s[i];if(null!=l){a.endTime=o,a.proiority=l.priority,a.id=i,a.isShow=!1;var h=l.effectId,c=r[h];return null!=c&&(a.effectInfo=c,a.prefix=c.prefix),a.showPeople(n),egret.Tween.get(n.mBodyNode).wait(o).call(function(e){a.stopBuffEffectPeople(e)},a,[n]),a}return a},t}();e.Buff=t,__reflect(t.prototype,"foxgame.Buff")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.create=function(t,i,n,o){e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("创建一个特效"+n+"方向"+o);var a=null;return 0==i.effectType||8==i.effectType?(a=0==i.direction?e.SpriteFoxAniUtils.create(t,i.prefix,n,2):e.SpriteFoxAniUtils.create(t,i.prefix,n,o),a.effectType=i.effectType):(a=new e.SpriteInfo,a.effectType=i.effectType),a},t.play=function(t,i,n,o,a,s){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("播放了一个特效"),0==i.effectType)t.visible=!0,e.SpriteFoxAniUtils.play(t,i,o,a);else if(1==i.effectType){var r=t.bodyNode.getChildByName("mChest");null!=r&&(r.filters=[new egret.ColorMatrixFilter(e.NewBattleUtility.greenArray)],t.tweenToResetEffect(3e3,1))}else if(2==i.effectType){var l=t.bodyNode;null!=l&&(l.alpha=.5)}else if(3==i.effectType)var r=t.bodyNode.getChildByName("mChest");else if(4==i.effectType){var h=t.scaleX,c=t.scaleY,r=t.bodyNode.getChildByName("mChest");null!=r&&(r.scaleX=1.2*h,r.scaleY=1.2*c)}else if(5==i.effectType){var h=t.scaleX,c=t.scaleY,r=t.bodyNode.getChildByName("mChest");null!=r&&(r.scaleX=1.2*h,r.scaleY=1.2*c)}else if(6==i.effectType){Log.trace("狂暴技能表现");for(var u=s.effectHeightNode,p=egret.Tween.get(u),g=0;5>g;g++)p.call(function(e){e.scaleX+=.2,e.scaleY+=.2},p,[s]).wait(100)}else if(7==i.effectType)var r=t.mBodyNode.getChildByName("mChest");else 8==i.effectType&&(t.visible=!0,e.SpriteFoxAniUtils.play(t,i,o,a,s.mYanManPoint))},t.stop=function(t,i,n){void 0===t&&(t=null),void 0===n&&(n=null),e.Global.logLevel>e.Global.logLevelInfo,0==i.effectType?i.release():8==i.effectType?i.release():i.release()},t.playUnitLevelUp=function(i){e.Global.logLevel>e.Global.logLevelInfo&&Log.trace();var n=new egret.DisplayObjectContainer;n.name="playUnitLevelUp";var o=e.JsonDataManager.instance.effectTemplate,a=o[7],s=e.SpriteFoxAniUtils.create(n,a.prefix,!1,2);if(null!=s){n.scaleY=a.scale*i.scaleY,n.scaleX=a.scale*i.scaleX,i.addChild(n);var r=function(e){var i=null,n=null,o=null;e.hasOwnProperty("sprite")&&(i=e.sprite),e.hasOwnProperty("spriteInfo")&&(n=e.spriteInfo),e.hasOwnProperty("skillNode")&&(o=e.skillNode),t.stop(i,n),o.contains(i)&&o.removeChild(i),i=null},l={sprite:n,spriteInfo:s,skillNode:i};e.SpriteFoxAniUtils.play(n,s,r,l)}},t.playCSAni=function(i){var n=new egret.DisplayObjectContainer;n.name="playCSAni";var o=e.JsonDataManager.instance.effectTemplate,a=o[6],s=e.SpriteFoxAniUtils.create(n,a.prefix,!1,2);if(null!=s){n.scaleY=a.scale*i.scaleY,n.scaleX=a.scale*i.scaleX,i.addChild(n);var r=function(e){var i=null,n=null,o=null;e.hasOwnProperty("sprite")&&(i=e.sprite),e.hasOwnProperty("spriteInfo")&&(n=e.spriteInfo),e.hasOwnProperty("skillNode")&&(o=e.skillNode),t.stop(i,n),o.contains(i)&&o.removeChild(i),i=null},l={sprite:n,spriteInfo:s,skillNode:i};e.SpriteFoxAniUtils.play(n,s,r,l)}},t.playMapSwitchEffect=function(i,n,o){i.getChildByName(o)&&DisplayUtils.getInstance().removeFromParent(i.getChildByName(o));var a=new egret.DisplayObjectContainer,s=e.JsonDataManager.instance.effectTemplate,r=s[6],l=e.SpriteFoxAniUtils.create(a,r.prefix,!0,2);if(null!=l){a.scaleY=r.scale*i.scaleY,a.scaleX=r.scale*i.scaleX,a.x=n.x,a.y=n.y,a.name=o,i.addChild(a);var h=function(e){var i=null,n=null,o=null;e.hasOwnProperty("sprite")&&(i=e.sprite),e.hasOwnProperty("spriteInfo")&&(n=e.spriteInfo),e.hasOwnProperty("skillNode")&&(o=e.skillNode),t.stop(i,n),o.contains(i)&&o.removeChild(i),i=null},c={sprite:a,spriteInfo:l,skillNode:i};e.SpriteFoxAniUtils.play(a,l,h,c)}},t}();e.EffectUtils=t,__reflect(t.prototype,"foxgame.EffectUtils")}(foxgame||(foxgame={}));var StarlingSwfFactory=function(e){function t(){var t=e.call(this)||this;return t.swfAssetsManager=new starlingswf.SwfAssetManager,t.swfAssetsNames=new Array,t.swfAssets=new Array,t.swfData={},t}return __extends(t,e),t.prototype.addSwf=function(e,t,i){if(-1==this.swfAssetsNames.indexOf(e)){if(null==t||null==i)return void Log.trace("SWF加载失败:"+e);this.swfAssetsManager.addSpriteSheet(e,i);var n=new starlingswf.Swf(t,this.swfAssetsManager,24);n.name=e,StarlingSwfUtils.addSwf(n),this.swfAssetsNames.push(e),this.swfAssets.push(n)}},t.prototype.stopSwfs=function(e){for(var t=0,i=e.length;i>t;t++){var n=StarlingSwfUtils.getSwf(e[t]);n&&n.swfUpdateManager.stop()}},t.prototype.playSwfs=function(e){for(var t=0,i=e.length;i>t;t++){var n=StarlingSwfUtils.getSwf(e[t]);n&&n.swfUpdateManager.play()}},t.prototype.clearSwfs=function(){for(;this.swfAssets.length;)StarlingSwfUtils.removeSwf(this.swfAssets.pop());for(;this.swfAssetsNames.length;)this.swfAssetsNames.pop();this.swfAssetsManager=new starlingswf.SwfAssetManager},t.prototype.clear=function(){this.clearSwfs()},t.prototype.makeMc=function(e){var t=StarlingSwfUtils.createMovie("mc_"+e,null,StarlingSwfMovieClip);return null==t&&Log.trace("SWF创建失败: "+e),t},t.prototype.makeImage=function(e){return StarlingSwfUtils.createImage("img_"+e)},t.prototype.getTexture=function(e){return StarlingSwfUtils.getTexture("img_"+e)},t}(BaseClass);__reflect(StarlingSwfFactory.prototype,"StarlingSwfFactory");var StarlingSwfMovieClip=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a.frameActions={},a.preFrame=-1,a.addEventListener(egret.Event.REMOVED_FROM_STAGE,a.onRemove,a),a}return __extends(t,e),t.prototype.onRemove=function(){this.stop()},t.prototype.setFrameAction=function(e,t,i,n){void 0===n&&(n=null),this.frameActions[e]=[t,i,n]},t.prototype.setCompleteAction=function(e,t){this.complateFunc=e,this.complateObj=t,this.addEventListener(egret.Event.COMPLETE,this.onPlayend,this)},t.prototype.onPlayend=function(){this.complateFunc&&this.complateFunc.call(this.complateObj)},t.prototype.goToPlay=function(e){this.preFrame=-1,this.currFrameName=e,this.gotoAndPlay(e)},t.prototype.setCurrentFrame=function(t){e.prototype.setCurrentFrame.call(this,t);var i=this.getCurrentFrame();if(this.preFrame!=i&&(this.preFrame=i,this.frameActions&&this.frameActions[i])){var n=this.frameActions[i];n[2]?n[0].call(n[1],n[2]):n[0].call(n[1])}},t.prototype.dispose=function(){this.stop(),this.removeEventListener(egret.Event.COMPLETE,this.onPlayend,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),App.DisplayUtils().removeFromParent(this),this.complateFunc=null,this.complateObj=null,this.frameActions=null},t}(starlingswf.SwfMovieClip);__reflect(StarlingSwfMovieClip.prototype,"StarlingSwfMovieClip");var StarlingSwfUtils=function(){function e(){}return e.addSwf=function(t){e.swfList.push(t)},e.removeSwf=function(t){var i=e.swfList.indexOf(t);-1!=i&&e.swfList.splice(i,1)},e.createSprite=function(t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);for(var o=e.swfList.length,a=0;o>a;a++){var s=e.swfList[a];if(s.hasSprite(t))return s.createSprite(t,i,n)}return null},e.createImage=function(t,i){void 0===i&&(i=null);for(var n=e.swfList.length,o=0;n>o;o++){var a=e.swfList[o];if(a.hasImage(t))return a.createImage(t,i)}return null},e.getTexture=function(t){for(var i=e.swfList.length,n=0;i>n;n++){var o=e.swfList[n];if(o.hasImage(t))return o.getTexture(t)}return null},e.createMovie=function(t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);for(var o=e.swfList.length,a=0;o>a;a++){var s=e.swfList[a];if(s.hasMovieClip(t))return s.createMovie(t,i,n)}return null},e.createS9Image=function(t,i){void 0===i&&(i=null);for(var n=e.swfList.length,o=0;n>o;o++){var a=e.swfList[o];if(a.hasS9Image(t))return a.createS9Image(t,i)}return null},e.createShapeImage=function(t,i){void 0===i&&(i=null);for(var n=e.swfList.length,o=0;n>o;o++){var a=e.swfList[o];if(a.hasShapeImage(t))return a.createShapeImage(t,i)}return null},e.getSwf=function(t){for(var i=e.swfList.length,n=0;i>n;n++){var o=e.swfList[n];if(o.name==t)return o}return null},e.fixButton=function(t,i,n){e.firstAddBtn&&(e.firstAddBtn=!1,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.MainContext.instance.stage.addEventListener(egret.Event.LEAVE_STAGE,this.onTouchEnd,this));var o=new StarlingSwfButtonData;o.btn=t,o.onClick=i,o.thisObj=n,e.btnList.push(o),t.touchEnabled=!0,t.gotoAndStop(0),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnTouchBegin,t)},e.onBtnTouchBegin=function(t){for(var i=t.currentTarget,n=e.btnList.length,o=0;n>o;o++){var a=e.btnList[o];if(a.btn==i){a.touchStageX=t.stageX,a.touchStageY=t.stageY,i.gotoAndStop(1);break}}},e.onTouchEnd=function(t){for(var i=e.btnList.length,n=0;i>n;n++){var o=e.btnList[n];-1!=o.touchStageX&&(t.stageX&&Math.abs(o.touchStageX-t.stageX)<10&&Math.abs(o.touchStageY-t.stageY)<10&&o.onClick&&o.onClick.call(o.thisObj,t),o.touchStageX=-1,o.touchStageY=-1,o.btn.gotoAndStop(0))}},e.swfList=[],e.btnList=[],e.firstAddBtn=!0,e}();__reflect(StarlingSwfUtils.prototype,"StarlingSwfUtils");var StarlingSwfButtonData=function(){function e(){this.touchStageX=-1,this.touchStageY=-1}return e}();__reflect(StarlingSwfButtonData.prototype,"StarlingSwfButtonData");var DebugUtils=function(e){function t(){var t=e.call(this)||this;return t._threshold=3,t._startTimes={},t}return __extends(t,e),t.prototype.isOpen=function(e){this._isOpen=e},Object.defineProperty(t.prototype,"isDebug",{get:function(){return this._isOpen},enumerable:!0,configurable:!0}),t.prototype.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},t.prototype.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&Log.trace(e+": "+t),t},t.prototype.setThreshold=function(e){this._threshold=e},t}(BaseClass);__reflect(DebugUtils.prototype,"DebugUtils");var DeviceUtils=function(e){function t(){var t=e.call(this)||this;return t.cpu=2,t.memory=2,window.navigator&&window.navigator.hardwareConcurrency&&t.setCPU(window.navigator.hardwareConcurrency),window.navigator&&window.navigator.totalMemory&&t.setMemory(window.navigator.totalMemory),t}return __extends(t,e),t.prototype.IsHtml5=function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},t.prototype.IsNative=function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},t.prototype.IsMobile=function(){return egret.Capabilities.isMobile},t.prototype.IsPC=function(){return!egret.Capabilities.isMobile},t.prototype.IsQQBrowser=function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},t.prototype.IsIEBrowser=function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},t.prototype.IsFirefoxBrowser=function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},t.prototype.IsChromeBrowser=function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")},t.prototype.IsSafariBrowser=function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")},t.prototype.IsOperaBrowser=function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},t.prototype.IsLowCapabilitiesMobileDevice=function(){var e=!0;return(this.cpu<2||this.memory<2)&&(e=!0),e},t.prototype.setCPU=function(e){this.cpu=e},t.prototype.getCPU=function(){return this.cpu},t.prototype.setMemory=function(e){for(;e>1024;)e/=1024;this.memory=e},t.prototype.getMemory=function(){return this.memory},t}(BaseClass);__reflect(DeviceUtils.prototype,"DeviceUtils");var DisplayUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createBitmap=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.createEuiImage=function(e){var t=new eui.Image,i=RES.getRes(e);return t.source=i,t},t.prototype.removeFromParent=function(e){e&&e.parent&&e.parent.removeChild(e)},t}(BaseClass);__reflect(DisplayUtils.prototype,"DisplayUtils");var Log=function(){function e(){}return e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(Global.globalConfig.isDebug){for(var i=0;i<e.length;i++)e[i]="[DebugLog]"+e[i]+"\n";console.log.apply(console,e)}},e}();__reflect(Log.prototype,"Log");var MessageCenter=function(e){function t(t){var i=e.call(this)||this;return i.type=t,i.dict={},i.eVec=new Array,i.lastRunTime=0,0==i.type&&App.TimerManager().doFrame(1,0,i.run,i),i}return __extends(t,e),t.prototype.clear=function(){this.dict={},this.eVec.splice(0)},t.prototype.addListener=function(e,t,i){var n=this.dict[e];null==n&&(n=new Array,this.dict[e]=n);var o=0,a=n.length;for(o;a>o;o++)if(n[o][0]==t&&n[o][1]==i)return;n.push([t,i])},t.prototype.removeListener=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n=this.dict[e];if(null!=n){if(null==t&&null==i)this.dict[e]=null;else{var o=0,a=n.length;for(o;a>o;o++)if(n[o][0]==t&&n[o][1]==i){n.splice(o,1);break}}0==n.length&&(this.dict[e]=null,delete this.dict[e])}},t.prototype.removeAll=function(e){for(var t=Object.keys(this.dict),i=0,n=t.length;n>i;i++){for(var o=t[i],a=this.dict[o],s=0;s<a.length;s++)a[s][1]==e&&(a.splice(s,1),s--);0==a.length&&(this.dict[o]=null,delete this.dict[o])}},t.prototype.dispatch=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(null!=this.dict[e]){var n=ObjectPool.pop("MessageVo");n.type=e,n.param=t,0==this.type?this.eVec.push(n):1==this.type?this.dealMsg(n):Log.trace("MessageCenter未实现的类型")}},t.prototype.run=function(){var e=egret.getTimer(),t=e-this.lastRunTime>100;if(this.lastRunTime=e,t)for(;this.eVec.length>0;)this.dealMsg(this.eVec.shift());else for(;this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););},t.prototype.dealMsg=function(e){for(var t=this.dict[e.type],i=0,n=t.length,o=null;n>i;)o=t[i],o[0].apply(o[1],e.param),t.length!=n&&(n=t.length,i--),i++;e.dispose(),ObjectPool.push(e)},t}(BaseClass);__reflect(MessageCenter.prototype,"MessageCenter");var MessageVo=function(){function e(){}return e.prototype.dispose=function(){this.type=null,this.param=null},e}();__reflect(MessageVo.prototype,"MessageVo"),window.MessageVo=MessageVo;var ObjectPool=function(){function e(){this._objs=new Array}return e.prototype.pushObj=function(e){this._objs.push(e)},e.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},e.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},e.pop=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];e._content[t]||(e._content[t]=[]);var o=e._content[t];if(o.length)return o.pop();var a,s=egret.getDefinitionByName(t),r=i.length;return 0==r?a=new s:1==r?a=new s(i[0]):2==r?a=new s(i[0],i[1]):3==r?a=new s(i[0],i[1],i[2]):4==r?a=new s(i[0],i[1],i[2],i[3]):5==r&&(a=new s(i[0],i[1],i[2],i[3],i[4])),a.ObjectPoolKey=t,a},e.popWithExtraKey=function(t,i){e._content[t]||(e._content[t]=[]);var n,o=e._content[t];if(o.length)for(var a=0;a<o.length;a++)if(o[a].extraKey==i){n=o[a],o.splice(a,1);break}if(!n){var s=egret.getDefinitionByName(t);n=new s(i),n.extraKey=i,n.ObjectPoolKey=t}return n},e.push=function(t){if(null==t)return!1;var i=t.ObjectPoolKey;return e._content[i]?(e._content[i].push(t),!0):!1},e.clear=function(){e._content={}},e.clearClass=function(t,i){void 0===i&&(i=null);for(var n=e._content[t];n&&n.length;){var o=n.pop();i&&o[i](),o=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,i){var n=e._content[t];if(null!=n){var o=0,a=n.length;for(o;a>o;o++)n[o][i]()}},e._content={},e}();__reflect(ObjectPool.prototype,"ObjectPool");var ResourceUtils=function(){function e(){this._groupIndex=0,this.recordList=[],this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)}return e.prototype.addConfig=function(e,t,i){void 0===i&&(i=null),this._configs.push([e,t,i])},e.prototype.startLoadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},e.prototype.loadNextConfig=function(){var e=this;return 0==this._configs.length?(null!=this._onConfigComplete&&this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null)):(this.curParam=this._configs.shift(),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,function(t){console.log("加载配置表失败",e.curParam,t)},this),void this.loadConfig(this.curParam[0],this.curParam[1]))},e.prototype.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this);var t=this.curParam[2];null!=t&&t(e),this.loadNextConfig()},e.prototype.loadGroup=function(e,t,i,n,o){void 0===o&&(o=0);try{if(RES.isGroupLoaded(e))t&&n&&t.call(n,e);else{this._groups[e]=[t,i,n];try{RES.loadGroup(e,o)}catch(a){}}}catch(a){console.error(a)}},e.prototype.loadGroups=function(e,t,i,n,o){RES.createGroup(e,t,!0),this.loadGroup(e,i,n,o)},e.prototype.pilfererLoadGroup=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=-1);var n="pilferer_"+e;t||(t=[e]),RES.createGroup(n,t,!0),RES.loadGroup(n,foxgame.Global.LoadBattleSkillSoundResPriority)},e.prototype.onResourceLoadComplete=function(e){var t=e.groupName;if(this._groups[t]){var i=this._groups[t][0],n=this._groups[t][2];this._groups[t]=null,delete this._groups[t],null!=i&&i.call(n,t)}},e.prototype.onResourceLoadProgress=function(e){var t=e.groupName;if(this._groups[t]){var i=this._groups[t][1],n=this._groups[t][2];null!=i&&i.call(n,e.itemsLoaded,e.itemsTotal)}},e.prototype.onResourceLoadError=function(e){Log.trace(e.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(e)},e.prototype.loadResource=function(e,t,i,n,o){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null);var a=e.concat(t),s="loadGroup"+this._groupIndex++;RES.createGroup(s,a,!0),this._groups[s]=[i,n,o],RES.loadGroup(s)},e.prototype.setSourceVersion=function(e){this.sourceVersion=e},e.prototype.getSourceVersionByUrl=function(e){if(-1!=e.indexOf("?v="))return e;var t;return t=null==this.sourceVersion||null==this.sourceVersion[e]?Global.version:this.sourceVersion[e],e+="?v="+t},e.prototype.getResByUrl=function(e,t,i,n){e=this.getSourceVersionByUrl(e),RES.getResByUrl(e,t,i,n),this.recordList.push(e)},e.prototype.clearRecordRES=function(){for(var e,t,i=this.recordList.length,n=[],o=0;i>o;o++)t=this.recordList[o],e=GlobalUtil.destroyRes(t),0==e&&n.push(t);console.warn("clean getResByUrl resIds before LoginScene"),this.recordList=n},e.prototype.getResAsync=function(e,t,i){RES.getResAsync(e,function(e,n){t.call(i,e,n)},i)},e.prototype.loadConfig=function(e,t,i){e=this.getSourceVersionByUrl(e),RES.loadConfig(e,t)},e}();__reflect(ResourceUtils.prototype,"ResourceUtils");var TimerManager=function(e){function t(){var t=e.call(this)||this;return t._handlers=new Array,t._delHandlers=new Array,t._currTime=egret.getTimer(),t._currFrame=0,t._count=0,t._timeScale=1,t._totalTime=0,t._fps=30,egret.startTick(t.onEnterFrame,t),t}return __extends(t,e),t.prototype.setTimeScale=function(e){this._timeScale=e},t.prototype.onEnterFrame=function(e){this._currFrame++,this._totalTime+=e-this._currTime;var t=Math.min(Math.ceil(1e3*this._currFrame/this._totalTime),120);this._fps=t,this._currTime=egret.getTimer(),App.DebugUtils().start("TimerManager:");for(var i=0;i<this._count;i++){var n=this._handlers[i],o=n.userFrame?this._currFrame:this._currTime;o>=n.exeTime&&(App.DebugUtils().start(n.method.toString()),n.method.call(n.methodObj,(this._currTime-n.dealTime)*this._timeScale),App.DebugUtils().stop(n.method.toString()),n.dealTime=this._currTime,n.exeTime+=n.delay,n.repeat||(n.repeatCount>1?n.repeatCount--:(n.complateMethod&&n.complateMethod.apply(n.complateMethodObj),this._delHandlers.push(n))))}for(;this._delHandlers.length;){var n=this._delHandlers.pop();this.remove(n.method,n.methodObj)}return App.DebugUtils().stop("TimerManager:"),!1},t.prototype.create=function(e,t,i,n,o,a,s){if(!(0>t||0>i||null==n)){this.remove(n,o);var r=ObjectPool.pop("TimerHandler");r.userFrame=e,r.repeat=0==i,r.repeatCount=i,r.delay=t,r.method=n,r.methodObj=o,r.complateMethod=a,r.complateMethodObj=s,r.exeTime=t+(e?this._currFrame:this._currTime),r.dealTime=this._currTime,this._handlers.push(r),this._count++}},t.prototype.doTimer=function(e,t,i,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(!1,e,t,i,n,o,a)},t.prototype.doFrame=function(e,t,i,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(!0,e,t,i,n,o,a)},Object.defineProperty(t.prototype,"frameCount",{get:function(){return this._currFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),t.prototype.remove=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t){this._handlers.splice(i,1),ObjectPool.push(n),this._count--;
break}}},t.prototype.removeAll=function(e){for(var t=0;t<this._count;t++){var i=this._handlers[t];i.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(i),this._count--,t--)}},t.prototype.isExists=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t)return!0}return!1},t}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return e.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler"),window.TimerHandler=TimerHandler;var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.textAlpha=1,e.touchEnabled=!1,e}return __extends(i,t),i.prototype.setText=function(t,i,n,o){this.font=i,this.text=t,this.alpha=this.textAlpha,egret.callLater(function(t){var i=t.width>>1,n=t.height>>1;t.p1.x-=i,t.p1.y-=n,t.p2.x-=i,t.p2.y-=n,t.x=t.p1.x,t.y=t.p1.y,t.moveData=e.GameUtils.getMoveData(t.p1,t.p2,3)},this,this)},i.prototype.update=function(){if(this.moveData)this.moveData.isMove()?(this.x-=this.moveData.speedX,this.y-=this.moveData.speedY):(this.moveData=null,this.x=this.p2.x,this.y=this.p2.y);else if(this.textAlpha-=.1,this.alpha=this.textAlpha,this.textAlpha<=0)return!0;return!1},i.prototype.clear=function(){this.p1=null,this.p2=null,this.callBack=null,this.thisObject=null,this.moveData=null,this.textAlpha=1},i}(eui.BitmapLabel);e.FlyText=t,__reflect(t.prototype,"foxgame.FlyText")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.aniIndex=0,t.name="GuideFinger",t.touchEnabled=!1,t.touchChildren=!1,t.aniBmp=new egret.Bitmap(RES.getRes("u_guide_0_png")),t.addChild(t.aniBmp),t.aniData=[{name:"u_guide_0_png",x:20,y:20},{name:"u_guide_0_png",x:10,y:10},{name:"u_guide_0_png",x:5,y:5},{name:"u_guide_0_png",x:0,y:0},{name:"u_guide_1_png",x:0,y:0},{name:"u_guide_0_png",x:0,y:0},{name:"u_guide_1_png",x:0,y:0},{name:"u_guide_0_png",x:0,y:0},{name:"u_guide_0_png",x:5,y:5},{name:"u_guide_0_png",x:10,y:10},{name:"u_guide_0_png",x:20,y:20}],t}return __extends(t,e),t.prototype.runAni=function(){if(this.aniIndex>=0){this.aniIndex%=11;var e=this.aniData[this.aniIndex];this.aniBmp.texture=RES.getRes(e.name),this.aniBmp.x=e.x,this.aniBmp.y=e.y,this.aniIndex++}},t.prototype.dispose=function(){this.aniData=null,this.aniBmp=null},t}(egret.Sprite);e.GuideFinger=t,__reflect(t.prototype,"foxgame.GuideFinger")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.windowName="",e.touchProcess=!0,e.touchEnabled=!0,e.graphics.beginFill(0,.6),e.graphics.drawRect(0,0,10,10),e.graphics.endFill(),e}return __extends(i,t),i.prototype.setModalSize=function(t,i){this.width=t,this.height=i,this.graphics.clear(),this.graphics.beginFill(0,.6),this.graphics.drawRect(0,0,e.Global.stageWidth,e.Global.stageHeight),this.graphics.endFill()},i.prototype.setWindowName=function(e){this.windowName=e,this.windowName},i.prototype.onClick=function(t){this.touchProcess&&(this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.PopUpManager.instance.removePopUp(this.windowName),this.windowName="")},i}(egret.Sprite);e.Modal=t,__reflect(t.prototype,"foxgame.Modal")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.nowHeight=0,t.textLen=0,t.beijing=new eui.Image,t.touchEnabled=!1,t.touchChildren=!1,t.container=new egret.Sprite,t.tfList=[],t.timeList=[],t.bgArray=[],t}return __extends(t,e),t.prototype.setText=function(e,t,i,n,o,a,s,r){void 0===t&&(t=0),void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===r&&(r="center");var l,h,c;this.textLen=e.length;for(var u=0;u<this.textLen;u++);for(var u=0;u<this.textLen;u++)c=e[u],l=this.tfList[u],h=this.bgArray[u],l||(l=new egret.TextField,h=new eui.Image,2==c.type?h.source="shuxingtishengdishang_png":3==c.type?h.source="shuxingtishengdixia_png":h.source="diaoluowupinkuang_png",o>0?l.size=o:l.size=22,this.tfList[u]=l,this.timeList[u]=0,this.bgArray[u]=h),2==c.type?h.source="shuxingtishengdishang_png":3==c.type?h.source="shuxingtishengdixia_png":h.source="diaoluowupinkuang_png",l.text=c.text,l.textColor=c.color,l.bold=i,a>0&&(l.stroke=a,l.strokeColor=s),h.fillMode=egret.BitmapFillMode.SCALE,h.scale9Grid=new egret.Rectangle(6,6,20,20),h.x=0,1==t?(h.x=0,h.width=300,h.height=36,l.x=h.x+.5*(300-l.measuredWidth)):2==t||3==t?(h.width=223,h.x=0,h.height=36,l.x=h.x+.25*h.width):(h.x=0,h.width=300,h.height=36,l.x=h.x+.25*h.width),l.y=40*u,2==t||3==t?h.y=l.y-10:h.y=l.y-10,h.alpha=1,h.visible=!1,this.container.addChild(h),l.alpha=1,l.scaleX=3,l.visible=!1,l.textAlign=r,this.nowHeight+=40,this.container.addChild(l);this.addChild(this.container),this.time=egret.getTimer(),this.index=0},t.prototype.update=function(){var e,t,i=!1,n=!0,o=egret.getTimer();o-this.time>=50&&(this.time=o,this.index=Math.min(this.index+1,this.textLen-1));for(var a=this.index+1,s=0;a>s;s++)e=this.tfList[s],t=this.bgArray[s],e&&(e.visible=!0,t.visible=!0,1==e.scaleX?(0==this.timeList[s]&&(this.timeList[s]=o),o-this.timeList[s]>=1e3&&(e.alpha=Math.max(e.alpha-.1,0),t.alpha=Math.max(t.alpha-.1,0),0==e.alpha?i=!0:(i=!1,n=!1))):e.scaleX=Math.max(1,1));return i&&n},t.prototype.clear=function(){this.index=0,this.nowHeight=0;for(var e=this.tfList.length,t=0;e>t;t++)this.container.contains(this.tfList[t])&&(this.container.removeChild(this.tfList[t]),this.container.removeChild(this.bgArray[t])),this.timeList[t]=0},Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this.nowHeight},enumerable:!0,configurable:!0}),t}(eui.Group);e.MoreText=t,__reflect(t.prototype,"foxgame.MoreText")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t,i,n,o,a,s,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=!1),void 0===s&&(s=""),void 0===r&&(r=""),this.title=e,this.msg=t,this.callBack=i,this.thisObject=n,this.data=o,this.onlyOne=a,this.sure=s,this.cancel=r}return e}();e.AlertMsgEntity=t,__reflect(t.prototype,"foxgame.AlertMsgEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t,i,n,o,a,s,r,l){void 0===n&&(n=1),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===l&&(l=30);var h=e.call(this)||this;return h.callFrame=0,h.anchorX=.5,h.anchorY=.5,h.addPos=!0,h.frameRate=30,h.id=t,h.name=i,h.playCount=n,h.parent=o,h.data=a,h.playComplete=s,h.thisObject=r,h.frameRate=l,h}return __extends(t,e),t.prototype.dispose=function(){this.parent=null,this.data=null,this.thisObject=null,this.playComplete=null,this.playToFrame=null},t}(egret.HashObject);e.EffectEntity=t,__reflect(t.prototype,"foxgame.EffectEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.nextId=parseInt(e[1])},e}();e.GuideEntity=t,__reflect(t.prototype,"foxgame.GuideEntity",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t,i,n,o,a,s){this.distance=e,this.direction=t,this.scale=i,this.speed=n,this.speedX=o,this.speedY=a,this.angle=s}return e.prototype.isMove=function(){return this.distance-=this.speed,this.distance>0?!0:!1},e}();e.MoveDataEntity=t,__reflect(t.prototype,"foxgame.MoveDataEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t,i,n){void 0===n&&(n=""),this.parserCls=e,this.fileName=t,this.saveType=i,this.dataKey=n}return e}();e.ParserEntity=t,__reflect(t.prototype,"foxgame.ParserEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t,i,n){this.windowName=e,this.parentName=t,this.position=i,this.offset=n}return e.prototype.dispose=function(){this.offset=null,this.modal=null},e}();e.PopUpEntity=t,__reflect(t.prototype,"foxgame.PopUpEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.space=0,this.currentPlayCount=0,this.totalPlayCount=0,this.currentFrame=0,this.totalFrame=0,this.callFrame=0,this.curCallFrame=0,this.isCall=!1,this.startTime=0,this.frameTime=0,this.stopTime=0}return e.prototype.setData=function(e,t,i,n){void 0===n&&(n=0),this.space=e,this.totalFrame=t,this.totalPlayCount=i,this.callFrame=n,this.currentFrame=0,this.currentPlayCount=0,this.curCallFrame=0,this.isCall=!1,this.startTime=egret.getTimer()-this.space,this.frameTime=this.startTime,this.stopTime=0},e.prototype.play=function(){var e=egret.getTimer();this.stopTime>0?(e-=this.stopTime,this.startTime+=e,this.frameTime+=e,this.stopTime=0):(this.startTime=e-this.space,this.frameTime=this.startTime)},e.prototype.stop=function(){this.stopTime=egret.getTimer()},e.prototype.getFrame=function(){var e=egret.getTimer();if(e-this.frameTime>=this.space){var t=Math.floor((e-this.startTime)/this.space),i=Math.floor(t%this.totalFrame);this.currentFrame=0==i?this.totalFrame:i,this.currentPlayCount=Math.floor(t/this.totalFrame);var n=this.currentPlayCount*this.totalFrame+this.callFrame;n!=this.curCallFrame&&this.currentPlayCount<this.totalPlayCount&&(this.curCallFrame=n,this.isCall=!1),this.frameTime=e}return this.currentFrame},e}();e.SimpleAnimationEntity=t,__reflect(t.prototype,"foxgame.SimpleAnimationEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t,i){this.totalPlayCount=1,this.playCount=0,this.isLoad=!1,this.isPlay=!1,this.id=e,this.id.indexOf("_mp3")<=0&&(this.id=this.id+"_mp3"),this.callBack=t,this.thisObject=i,this.playCallBack=this.playComplete.bind(this)}return e.prototype.play=function(e,t){void 0===t&&(t=!1),e&&(this.totalPlayCount=e),this.isLoad&&this.isPlay&&!t||(this.isPlay=!0,this.checkLoad(t))},e.prototype.stop=function(){this.isPlay=!1,this.sound},e.prototype.dispose=function(){this.sound&&(this.sound=null),this.callBack=null,this.thisObject=null,this.playCallBack=null},e.prototype.checkLoad=function(e){this.isPlay&&(this.sound?(e&&(this.playCount=0),this.sound.play()):(this.sound=RES.getRes(this.id),this.sound?(this.isLoad=!0,this.sound.play()):(this.isLoad=!1,App.getResourceUtils().getResAsync(this.id,this.checkLoad,this))))},e.prototype.playComplete=function(){this.playCount++,this.playCount<this.totalPlayCount?this.sound.play():(this.playCount=0,this.isPlay=!1,this.callBack&&this.thisObject&&this.callBack.call(this.thisObject,this))},e}();e.SoundEntity=t,__reflect(t.prototype,"foxgame.SoundEntity")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t,i){this.window=e,this.control=t,this.isRemove=i}return e.prototype.dispose=function(){this.window=null,this.control=null},e}();e.WindowEntity=t,__reflect(t.prototype,"foxgame.WindowEntity")}(foxgame||(foxgame={}));var AssetAdapter=function(){function e(){this.asyncResArray={},this.syncResArray={},this.byUrlResArray={},this.baseComponentUiResArrayMap={},e.instance=this}return e.getInstance=function(){return e.instance},e.prototype.getParentBaseComponent=function(e){var t=null;if(e&&egret.is(e,"eui.Image"))for(var i=e;i.parent;){if(i.parent instanceof foxgame.BaseComponent){t=i.parent;break}i=i.parent}return t},e.prototype.getAsset=function(e,t,i,n){function o(o){t.call(i,o,e);var s=a.getParentBaseComponent(n);if(s&&s.name&&!s.doTransform){s.doTransform=!1,a.baseComponentUiResArrayMap[s.name]||(a.baseComponentUiResArrayMap[s.name]={});var r=a.baseComponentUiResArrayMap[s.name];r[e]||(r[e]=!0,foxgame.TextureCache.getInstance().increaseCnt(e,o,s.name))}else s&&(s.doTransform=!0),foxgame.TextureCache.getInstance().increaseCnt(e,o,null)}void 0===n&&(n=null);var a=this;if(RES.hasRes(e)){var s=RES.getRes(e);null!=s?(o(s),this.syncResArray[e]||(this.syncResArray[e]=!0)):(App.getResourceUtils().getResAsync(e,o,this),this.asyncResArray[e]||(this.asyncResArray[e]=!0))}else App.getResourceUtils().getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE),this.byUrlResArray[e]||(this.byUrlResArray[e]=!0)},e.prototype.resetEmptyBaseComponentUiResArray=function(e){this.baseComponentUiResArrayMap[e]={}},e.prototype.getBaseComponentUiResArray=function(e){return this.baseComponentUiResArrayMap[e]},e.prototype.printAssetResLoadInfo=function(){egret.warn("###asyncResArray###");for(var e=Object.keys(this.asyncResArray),t=0;t<e.length;t++)egret.warn(t+",   "+e[t]);egret.warn("###syncResArray###");for(var i=Object.keys(this.syncResArray),t=0;t<i.length;t++)egret.warn(t+",   "+i[t]);egret.warn("###byUrlResArray###");for(var n=Object.keys(this.byUrlResArray),t=0;t<n.length;t++)egret.warn(t+",   "+n[t])},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var r=e.split("/");r.pop();var l=r.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(l,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(n,generateJSON.paths[e])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Global=foxgame.Global,GlobalUtil=foxgame.GlobalUtil,PreloadingPanel=function(e){function t(t){var i=e.call(this)||this;return i.is_text=!1,i.oppoResUrl=getGlobalConfig().platformUrl,i.xX=0,i.xW=0,i.backFun=t,i}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.left=0,this.right=0},t.prototype.init=function(){-1!=String(getGlobalConfig().serverUrl).indexOf("test")&&(this.is_text=!0),this.movieClipData={jsonData:null,textureData:null},this.bgImg=new eui.Image,this.bgImg.name="bgImg",this.addChild(this.bgImg),this.label2=new eui.Label,this.label2.size=20,this.label2.textColor=16759296,this.addChild(this.label2),this.progressBarBg=new eui.Image,this.progressBarBg.name="progressBarBg",this.addChild(this.progressBarBg),this.progressBarMask=new eui.Image,this.progressBarMask.name="progressBarMask",this.progressBar=new eui.Image,this.progressBar.name="progressBar",this.addChild(this.progressBar),this.loadConfig(),App.MessageCenter.addListener("resizeWindowHandler",this.resizeWindowHandler,this)},t.prototype.resizeWindowHandler=function(e){var t=foxgame.Global.stageWidth;this.progressBarMask.x=this.progressBar.x=t-this.xW>>1,this.progressBarBg.x=t-this.progressBarBg.width>>1},t.prototype.loadConfig=function(){window.egret_quickgame?RES.getResByUrl(this.oppoResUrl+"/resource/preloadPanel/preloadPanelData.json",this.onConfigComplete,this,RES.ResourceItem.TYPE_JSON):RES.getResByUrl("resource/preloadPanel/preloadPanelData.json",this.onConfigComplete,this,RES.ResourceItem.TYPE_JSON)},t.prototype.onConfigComplete=function(e){var t=this,i=foxgame.Global.stageWidth;if(this.bgImg.x=i-343>>1,this.bgImg.y=250,this.label2.text="(资源加载中,不消耗流量...)",this.label2.size=18,this.label2.textColor=15059854,this.label2.x=(egret.MainContext.instance.stage.stageWidth>>1)-(this.label2.width>>1),this.label2.y=Number(e.label2Y)+55,this.xW=e.proBarWidth,this.progressBarBg.y=Number(e.proBarBgY)+110,this.progressBarMask.y=this.progressBar.y=Number(e.proBarY)+110,window.egret_quickgame){if("qqgame"==window.GJlenged_chanel)RES.getResByUrl(this.oppoResUrl+"/resource/loader/bgX2.jpg",this.imageComoplete2,this,RES.ResourceItem.TYPE_IMAGE);else if("ttgame"==window.GJlenged_chanel)RES.getResByUrl(this.oppoResUrl+"/resource/loader/bgX4.jpg",this.imageComoplete2,this,RES.ResourceItem.TYPE_IMAGE);else{if("dchwgame"==window.GJlenged_chanel)return this.label2.text="",RES.getResByUrl(this.oppoResUrl+"/resource/loader/hwgg.png",this.imageComoplete2,this,RES.ResourceItem.TYPE_IMAGE),void setTimeout(function(){t.bgImg.source="",t.label2.text="(资源加载中,不消耗流量...)",RES.getResByUrl(t.oppoResUrl+"/resource/loader/bgImg.jpg",t.imageComoplete2.bind(t),t,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(t.oppoResUrl+"/"+e.proBarBgUrl,t.imageComoplete1.bind(t),t,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(t.oppoResUrl+"/"+e.proBarUrl,t.imageComoplete.bind(t),t,RES.ResourceItem.TYPE_IMAGE)},1500);"newOppogame"==window.GJlenged_chanel?RES.getResByUrl(this.oppoResUrl+"/resource/loader/bgX5.jpg",this.imageComoplete2,this,RES.ResourceItem.TYPE_IMAGE):RES.getResByUrl(this.oppoResUrl+"/resource/loader/bgImg.jpg",this.imageComoplete2,this,RES.ResourceItem.TYPE_IMAGE)}RES.getResByUrl(this.oppoResUrl+"/"+e.proBarBgUrl,this.imageComoplete1,this,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(this.oppoResUrl+"/"+e.proBarUrl,this.imageComoplete,this,RES.ResourceItem.TYPE_IMAGE)}else foxgame.Global.isUsingIndexHtmlShowPreLoadingUI=!0;foxgame.Global.isUsingIndexHtmlShowPreLoadingUI&&(this.progressBarBg.visible=!1,this.progressBar.visible=!1,this.backFun())},t.prototype.imageComoplete2=function(e,t){if(null!=this.bgImg){var i=foxgame.Global.stageWidth,n=foxgame.Global.stageHeight;this.bgImg.source=e,"wx360game"==window.GJlenged_chanel&&(this.bgImg.width=i,this.bgImg.height=n),this.bgImg.y=n-this.bgImg.height>>1,this.bgImg.x=i-this.bgImg.width>>1}},t.prototype.imageComoplete1=function(e,t){var i=foxgame.Global.stageWidth;this.progressBarBg.source=e,this.progressBarBg.x=i-this.progressBarBg.width>>1},t.prototype.imageComoplete=function(e,t){var i=foxgame.Global.stageWidth;this.progressBarMask.source=this.progressBar.source=e,this.progressBarMask.x=this.progressBar.x=i-this.xW>>1,this.barWidth=e.textureWidth,this.xX=this.progressBar.x,this.backFun()},t.prototype.imageComoplete3=function(e,t){-1!=t.indexOf("png")?this.movieClipData.textureData=e:-1!=t.indexOf("png")&&(this.movieClipData.jsonData=e),this.movieClipData.jsonData&&this.movieClipData.textureData&&(this.mcFactory=new egret.MovieClipDataFactory(this.movieClipData.jsonData,this.movieClipData.textureData),this.mc=new egret.MovieClip(this.mcFactory.generateMovieClipData("ani")),this.addChild(this.mc),this.mc.y=this.progressBar.y,this.mc.x=this.progressBar.x)},t.prototype.setProgress=function(e,t){void 0===e&&(e=1),void 0===t&&(t=100);var i=t+2,n=Math.floor(e/i*100);"newOppogame"==window.GJlenged_chanel&&setLoadingProgress(0),e==t&&"newOppogame"==window.GJlenged_chanel&&loadingComplete(),this.progressBar.width=this.xW*(e/t),this.progressBarMask.width=this.xW/100*n,egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&window.notifyPreloadingProgress&&"function"==typeof window.notifyPreloadingProgress&&window.notifyPreloadingProgress(e,t)},t.prototype.removeTimer=function(){App.MessageCenter.removeListener("resizeWindowHandler",this.resizeWindowHandler,this)},t.prototype.cleanRes=function(){this.removeChildren(),foxgame.GlobalUtil.destroyEuiImageRes(this.bgImg),foxgame.GlobalUtil.destroyEuiImageRes(this.progressBarBg),foxgame.GlobalUtil.destroyEuiImageRes(this.progressBar),foxgame.GlobalUtil.destroyEuiImageRes(this.progressBarMask),App.getResourceUtils().clearRecordRES(),this.bgImg=null,this.progressBarBg=null,this.progressBar=null,this.progressBarMask=null,egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&window.notifyShowLoginPanel&&"function"==typeof window.notifyShowLoginPanel&&window.notifyShowLoginPanel()},t}(eui.Component);__reflect(PreloadingPanel.prototype,"PreloadingPanel");var foxgame;!function(e){var t=function(){function t(){this.resMgrTimestamp=egret.getTimer(),this.loadList=[],this.actionCacheMap=new e.HashMap,this.usingResActionCacheMap=new e.HashMap,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.loadComplete,this)}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){egret.startTick(this.resMgrTimerHandler,this),this.resMgrList=[],this.loadActionRes("UltimateModel"),this.loadActionRes("UltimateModelWeapon")},t.prototype.getSimpleDebugInfo=function(){var e="acFactoryCache: ",t=this.actionCacheMap.keys();for(var i in t)e=e+t[i]+" ";e+="<br/><br/>resIdHashCache: ";var n=this.usingResActionCacheMap.keys();for(var o in n)e=e+n[o]+" ";e+="<br/><br/>requestDestroyResId: ";for(var a in this.resMgrList)e=e+this.resMgrList[a]+" ";return e},t.prototype.addToUsingResActionCacheMap=function(t){var i=t.modelName+"_"+e.ActionDefine.instance.DirectionFip.get(t.curDirection),n=this.usingResActionCacheMap.get(i);if(n){var o=n.indexOf(t.hashCode);if(o>=0)return;n.push(t.hashCode)}else{n=[],n.push(t.hashCode),this.usingResActionCacheMap.put(i,n)}},t.prototype.removeFromUsingResActionCacheMapByResId=function(e,t){var i=this.usingResActionCacheMap.get(e);if(i){var n=i.indexOf(t);return n>=0?void i.splice(n,1):void 0}},t.prototype.removeFromUsingResActionCacheMap=function(t){var i=t.modelName+"_"+e.ActionDefine.instance.DirectionFip.get(t.curDirection);this.removeFromUsingResActionCacheMapByResId(i,t.hashCode)},t.prototype.isNoUsingInResActionCacheMap=function(e){var t=!1,i=this.usingResActionCacheMap.get(e);if(i)0==i.length&&(this.usingResActionCacheMap.remove(e),i=null,t=!0);else{var n=this.resMgrList.indexOf(e);n>=0&&this.resMgrList.splice(n,1)}return t},t.prototype.checkLoadedDirectionRes=function(t){var i=[],n=this.actionCacheMap.contains(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT);i.push(n);var o=this.actionCacheMap.contains(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT);i.push(o);var a=this.actionCacheMap.contains(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT);i.push(a);var s=this.actionCacheMap.contains(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT);i.push(s);var r=this.actionCacheMap.contains(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT);return i.push(r),i},t.prototype.destroyActionCacheRes=function(t,i){i[0]&&this.destroyActionResByDirection(t,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),i[1]&&this.destroyActionResByDirection(t,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),i[2]&&this.destroyActionResByDirection(t,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),i[3]&&this.destroyActionResByDirection(t,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),i[4]&&this.destroyActionResByDirection(t,e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT)},t.prototype.resMgrTimerHandler=function(e){if(!(e-this.resMgrTimestamp<2e3)){this.resMgrTimestamp=e;var t=1;if(0==t&&this.resMgrList.length>0){var i=this.resMgrList.slice(0)[0];this.isNoUsingInResActionCacheMap(i)&&(this.resMgrList.shift(),this.removeAcMCDFByDirectionResId(i),this.destroyActionResByDirectionResId(i),Log.trace("destroy ActionCache Res: "+i+", remain "+this.resMgrList.length))}else if(1==t&&this.resMgrList.length>0){Log.trace("resMgrTimerHandler resMgrList length: "+this.resMgrList.length);for(var n=egret.getTimer(),o=[],a=[].concat(this.resMgrList),s=0,r=a;s<r.length;s++){var i=r[s];this.isNoUsingInResActionCacheMap(i)?(this.removeAcMCDFByDirectionResId(i),this.destroyActionResByDirectionResId(i),console.warn("destroy ActionCache Res: "+i)):(this.usingResActionCacheMap.contains(i)||this.actionCacheMap.contains(i))&&o.push(i)}this.resMgrList=[],this.resMgrList=o;var l=egret.getTimer()-n;Log.trace("resMgrTimerHandler cost time: "+l+", left length: "+this.resMgrList.length)}return!1}},t.prototype.getAcFactory=function(e){var t=this.actionCacheMap.get(e);if(!t){var i=RES.getRes(e+"_json"),n=RES.getRes(e+"_png");if(null!=i&&null!=n){t=new egret.MovieClipDataFactory(i,n),this.actionCacheMap.put(e,t)}else egret.log("has not "+e)}return t},t.prototype.getAcData=function(e){var t=this.getAcFactory(e.modelName+"_"+e.curDirection);return t?t.generateMovieClipData(e.modelName+"_"+e.curDirection+"_"+e.curActionType):(egret.warn("getAcFactory null: "+e.modelName+"_"+e.curDirection+"_"+e.curActionType),null)},t.prototype.getReplaceModelAcData=function(e){var t=this.getAcFactory(e.replaceModelName+"_"+e.curDirection);return t?t.generateMovieClipData(e.replaceModelName+"_"+e.curDirection+"_"+e.curActionType):null},t.prototype.isResLoaded=function(e,t){return RES.getRes(e+"_"+t+"_json")&&RES.getRes(e+"_"+t+"_png")},t.prototype.isResLoadeds=function(t){return RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"_json")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"_png")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"_json")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"_png")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"_json")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"_png")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"_json")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"_png")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"_json")&&RES.getRes(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"_png")},t.prototype.loadActionRes=function(t){RES.createGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"Group",[t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"_json",t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"_png"],!0),RES.loadGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"Group",e.Global.LoadModelActionAniResPriority),RES.createGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"Group",[t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"_json",t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"_png"],!0),RES.loadGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"Group",e.Global.LoadModelActionAniResPriority),RES.createGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"Group",[t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"_json",t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"_png"],!0),RES.loadGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"Group",e.Global.LoadModelActionAniResPriority),RES.createGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"Group",[t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"_json",t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"_png"],!0),RES.loadGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"Group",e.Global.LoadModelActionAniResPriority),RES.createGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"Group",[t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"_json",t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"_png"],!0),RES.loadGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"Group",e.Global.LoadModelActionAniResPriority)},t.prototype.destroyActionRes=function(t){e.GlobalUtil.destroyGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT+"Group"),e.GlobalUtil.destroyGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT+"Group"),e.GlobalUtil.destroyGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT+"Group"),e.GlobalUtil.destroyGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN+"Group"),e.GlobalUtil.destroyGroup(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP+"Group")},t.prototype.loadActionResByDirection=function(t,i,n){void 0===n&&(n=e.Global.LoadModelActionAniResPriority),RES.createGroup(t+"_"+i+"Group",[t+"_"+i+"_json",t+"_"+i+"_png"],!0),RES.loadGroup(t+"_"+i+"Group",n)},t.prototype.destroyActionResByDirection=function(t,i){e.GlobalUtil.destroyGroup(t+"_"+i+"Group")},t.prototype.destroyActionResByDirectionResId=function(t){e.GlobalUtil.destroyGroup(t+"Group")},t.prototype.play=function(t){try{var i=t.modelName+"_"+e.ActionDefine.instance.DirectionFip.get(t.curDirection),n=this.resMgrList.indexOf(i);n>-1&&this.resMgrList.splice(n,1),this.addToUsingResActionCacheMap(t),t.reset(),t.$mcObject.movieClipData=this.getAcData(t),t.startPlay(t.modelName,t.modelId)}catch(o){Log.trace("exception: "+o.toString()),console.error(o)}},t.prototype.playAsync=function(t){try{var i=this.loadList.indexOf(t);0>i?this.loadList.push(t):(t.loadDirectionMaxNumber++,t.loadDirectionMaxNumber>e.Global.actionCacheResMaxDirectionNumber&&(t.loadDirectionMaxNumber=e.Global.actionCacheResMaxDirectionNumber)),this.loadActionResByDirection(t.modelName,t.curDirection,t.resGroupLoadPriority),t.loadDirectionMaxNumber<1&&(t.loadDirectionMaxNumber=1),this.addToUsingResActionCacheMap(t),t.reset(),t.$mcObject.movieClipData=this.getReplaceModelAcData(t),t.startPlay(t.replaceModelName,t.replaceModelId)}catch(n){Log.trace("exception: "+n.toString()),console.error(n)}},t.prototype.loadComplete=function(e){for(var t,i=this.loadList.length,n=0;i>n;)t=this.loadList[n],t.modelName+"_"+t.curDirection+"Group"==e.groupName&&(this.play(t),t.onLoaded(3)),null!=t.modelName&&t.modelName==e.groupName.substring(0,t.modelName.length)&&(t.loadDirectionNumber++,t.loadDirectionNumber>=t.loadDirectionMaxNumber)?(this.loadList.splice(n,1),i--):n++},t.prototype.clear=function(){this.actionCacheMap.clear(),this.actionCacheMap=null,this.loadList.splice(0,this.loadList.length),this.loadList=null,egret.stopTick(this.resMgrTimerHandler,this)},t.prototype.removeAcMCDFByDirectionResId=function(t){var i=this.actionCacheMap.remove(t);i&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(i),i=null},t.prototype.removeActionCache=function(t){var i=this.actionCacheMap.remove(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT);i&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(i),i=null;var n=this.actionCacheMap.remove(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT);n&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(n),n=null;var o=this.actionCacheMap.remove(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT);o&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(o),o=null;var a=this.actionCacheMap.remove(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN);a&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(a),a=null;var s=this.actionCacheMap.remove(t+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP);s&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(s),s=null},t.prototype.removeAcByResId=function(e,t){this.resMgrList.indexOf(e)<0&&this.resMgrList.push(e),this.removeFromUsingResActionCacheMapByResId(e,t)},t.prototype.removeAC=function(t){if(t&&t.modelName){var i=t.modelName+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT;this.removeAcByResId(i,t.hashCode),i=t.modelName+"_"+e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,this.removeAcByResId(i,t.hashCode),i=t.modelName+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT,this.removeAcByResId(i,t.hashCode),i=t.modelName+"_"+e.EnumManager.DIRECTION_ENUM.DIR_DOWN,this.removeAcByResId(i,t.hashCode),i=t.modelName+"_"+e.EnumManager.DIRECTION_ENUM.DIR_UP,this.removeAcByResId(i,t.hashCode)}else t.modelName="";var n=this.loadList.indexOf(t);n>=0&&this.loadList.splice(n,1)},t}();e.ActionManager=t,__reflect(t.prototype,"foxgame.ActionManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(e){this.bitmapText=null,this.fontCache=!0,this.parent=null,this.parent=e,this.bitmapText=new egret.BitmapText}return t.prototype.initAndShow=function(t,i){void 0===t&&(t="heiOutline24"),void 0===i&&(i=""),this.resId=t,this.text=i;var n=e.FontManager.instance;n.isResLoaded(this.resId)?n.show(this):n.showAsync(this)},t.prototype.show=function(){this.bitmapText.text=this.text,this.parent.addChild(this.bitmapText),this.parent.visible=!0},t.prototype.clear=function(){this.bitmapText&&(this.bitmapText.text=null,this.bitmapText.font=null),this.parent&&(this.parent.removeChildren(),this.parent.visible=!1)},t.prototype.dispose=function(){this.clear(),this.parent=null,this.bitmapText=null},t.prototype.removeFontCache=function(){e.FontManager.instance.removeFontFactory(this.resId)},t}();e.FoxFont=t,__reflect(t.prototype,"foxgame.FoxFont")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.monsterList=[],this.isFighting=!1,this.isAlive=!0,this.iDieTime=0,this.isRandomMoving=!1,this.finishRandomMovingTaskMonsterCount=0
}return t.prototype.stopMonsterInvisible=function(e){e.stopMove(),this.finishRandomMovingTaskMonsterCount++,this.finishRandomMovingTaskMonsterCount>=this.monsterList.length&&(this.isRandomMoving=!1)},t.prototype.onOneMonsterRandomMoveStop=function(e,t){e.stopMove(),this.finishRandomMovingTaskMonsterCount++,this.finishRandomMovingTaskMonsterCount>=this.monsterList.length&&(this.isRandomMoving=!1),e.x=t.x,e.y=t.y;var i=1e3*Math.random()+1e3;egret.Tween.get(e,{loop:!0}).wait(i).to({y:e.y+3},100).to({y:e.y},100)},t.prototype.randomNegetive=function(){var e=1,t=Math.random();return.5>t&&(e=-1),e},t.prototype.getRandomPoint=function(e,t){void 0===t&&(t=150);for(var i=[],n=[],o=[],a=0;e>a;a++)n.push(a),o.push(a);for(var a=0;e>a;++a){var s=new egret.Point,r=Math.floor(Math.random()*e)%n.length,l=n.splice(r,1)[0],h=t*(.5-Math.random())/e+2*t/e*(l-e/2+.5),c=t*(.5-Math.random());s.x=Math.floor(this.posX+h),s.y=Math.floor(this.posY+c),i.push(s)}return i},t.prototype.randomMoveTask=function(){if(this.isAlive&&!this.isFighting&&!this.isRandomMoving){var e=this.monsterList.length;if(e>0){this.isRandomMoving=!0,this.finishRandomMovingTaskMonsterCount=0;for(var t=this.getRandomPoint(e),i=0;e>i;++i){var n=this.monsterList[i];n.visible&&(n.moveSpeed=.14/(1+Math.random()),egret.Tween.pauseTweens(n),egret.Tween.removeTweens(n),n.moveToWorldPos_byLine(t[i],this.onOneMonsterRandomMoveStop,!1,this,[n,t[i]]))}}}},t.prototype.fight=function(){this.isFighting=!0;for(var t=0;t<this.monsterList.length;++t){var i=this.monsterList[t];i.stopMove()}if(Math.random()>.5){var n=e.JsonDataManager.instance.monstertalkTemplate[this.mapId];if(n){var o=Math.floor(n.content.length*Math.random());this.say(n.content[o])}}},t.prototype.die=function(){this.isAlive=!1,this.isFighting=!1,this.iDieTime=egret.getTimer();for(var e=0;e<this.monsterList.length;++e){var t=this.monsterList[e];t.stopMove(),t.visible=!1,t.nameContainer.visible=!1,t.cleanBuffList(),t.cleanAllEffectState()}this.silent()},t.prototype.relive=function(){this.isAlive=!0,this.isFighting=!1,this.iDieTime=0,this.isRandomMoving=!1;for(var e=0;e<this.monsterList.length;++e){var t=this.monsterList[e];t.stopMove(),t.visible=!0,t.curHp=t.maxHp,t.updateHpWidget(),t.cleanBuffList(),t.cleanAllEffectState()}},t.prototype.say=function(e){if(0!=this.monsterList.length){if(!this.word_group){this.word_group=new eui.Group,this.word_group.touchEnabled=!1,this.word_bg=new eui.Image,this.word_bg.source="battle_xiaoguaiwenben_png",this.word_bg.alpha=.5,this.word_bg.horizontalCenter=0,this.word_bg.verticalCenter=0,this.word_bg.scale9Grid=new egret.Rectangle(5,5,24,24),this.word_group.addChild(this.word_bg),this.word_content=new eui.Label,this.word_content.size=18,this.word_content.horizontalCenter=0,this.word_content.verticalCenter=0,this.word_group.addChild(this.word_content);var t=this.monsterList[0];this.word_group.y=-t.iUnitHeight-120,t.addChild(this.word_group)}this.word_content.text=e,this.word_content.width>200&&(this.word_content.width=200),this.word_bg.width=this.word_content.width+20,this.word_bg.height=this.word_content.height+20,this.word_group.x=-this.word_bg.width/2,this.word_group.visible=!0}},t.prototype.silent=function(){this.word_group&&(this.word_group.visible=!1)},t}();e.MapCrowdMonster=t,__reflect(t.prototype,"foxgame.MapCrowdMonster");var i=function(){function t(){this.isPveFighting=!0,this.isPvpFighting=!1,this.lastAutoPveFightTime=0,this.curAction=null,this.curDirection=null}return t.prototype.resetPosAndStandFaceToFace=function(){this.npcPlayer.x=this.posNpcX,this.npcPlayer.y=this.posNpcY,this.npcMonster.x=this.posMonsterX,this.npcMonster.y=this.posMonsterY,this.npcPlayer.direction=e.Astar.instance.judgeNextDirection(this.npcPlayer.getPosition(),this.npcMonster.getPosition()),this.npcMonster.direction=e.Astar.instance.judgeNextDirection(this.npcPlayer.getPosition(),this.npcMonster.getPosition()),this.npcPlayer.setStateIdle(),this.npcMonster.setStateIdle()},t.prototype.changeFightState=function(e){e?(this.isPveFighting=!0,this.isPvpFighting=!1):(this.isPveFighting=!1,this.isPvpFighting=!0)},t.prototype.monsterFight=function(e){this.npcMonster.modelController&&this.npcMonster.playSkillTarget(~~e[0],[this.npcPlayer],null,this,[])},t.prototype.doFight=function(t){if(t){var i=egret.getTimer(),n=i-this.lastAutoPveFightTime;if(800>n)return;this.lastAutoPveFightTime=i,this.npcPlayer.nameContainer.visible=!0,this.npcMonster.nameContainer.visible=!0,this.npcPlayer.checkBodyClipBoundsChange(),this.npcMonster.checkBodyClipBoundsChange(),this.npcPlayer.playSkillTarget(this.iUseSkillId,[this.npcMonster],null,this,[]);var o=e.JsonDataManager.instance.monster[this.npcMonster.roleId];if(o){var a=o.skills,s=a.split(",");if(s.length>0&&s[0]){var r=egret.Tween.get(this.npcMonster);r.wait(100),r.call(this.monsterFight,this,[s])}}}else this.npcMonster.stopMove(),this.npcPlayer.stopMove()},t.prototype.setVisible=function(e){this.npcPlayer.visible=e,this.npcMonster.visible=e,e||this.npcPlayer.modelController&&(this.curAction=this.npcPlayer.modelController.desAction,this.curDirection=this.npcPlayer.modelController.desDirection)},t.prototype.destroyResModelController=function(){this.npcPlayer.modelController&&(this.curAction=this.npcPlayer.modelController.desAction,this.curDirection=this.npcPlayer.modelController.desDirection,this.npcPlayer.modelController.release(),this.npcPlayer.modelController=null)},t.prototype.restoreResModelController=function(){this.rdata&&this.npcPlayer.updateActorRoleLook(this.rdata,this.curAction,this.curDirection)},t}();e.MapPkOtherNpcPlayer=i,__reflect(i.prototype,"foxgame.MapPkOtherNpcPlayer")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.mainParser=new e.MainParser,this.dataMap=new e.HashMap}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){var e=RES.getRes("config_data");e&&(this.configData=e.data)},t.prototype.getData=function(e){try{var t=this.dataMap.get(e);if(t)return t;var i=this.mainParser.getParser(e);if(i){if(this.configData){var n=this.configData[i.fileName+".txt"];n&&(1==i.saveType?(t=this.parserToMap(n,i),n=null,this.configData[i.fileName+".txt"]=""):2==i.saveType?(t=this.parserToList(n,i),n=null,this.configData[i.fileName+".txt"]=""):t=n,t&&this.dataMap.put(e,t))}}else if(e.indexOf("_json")>0){var o=RES.getRes(e);o&&this.dataMap.put(e,o)}return t}catch(a){Log.trace("exception: "+a.toString()),console.error(a)}return null},t.prototype.parserToMap=function(t,i){for(var n,o,a=new e.HashMap,s=t.split("\r\n"),r=s.length,l=1;r>l;l++)""!=s[l]&&(n=egret.getDefinitionByName(i.parserCls),o=new n,o.init(s[l].split("	")),a.put(o[i.dataKey],o));return a},t.prototype.parserToList=function(e,t){for(var i,n,o=[],a=e.split("\r\n"),s=a.length,r=1;s>r;r++)""!=a[r]&&(i=egret.getDefinitionByName(t.parserCls),n=new i,n.init(a[r].split("	")),o.push(n));return o},t}();e.DataManager=t,__reflect(t.prototype,"foxgame.DataManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.effectMap=new e.HashMap,this.parentMap=new e.HashMap,this.assetMap=new e.HashMap,this.aniPool=[]}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.create=function(t,i,n){var o;return this.aniPool.length>0?(o=this.aniPool.shift(),o.playComplete=t,o.playToFrame=i,o.thisObject=n):o=new e.SimpleAnimation(t,i,n),o},t.prototype.add=function(e){var t,i=this.create(this.playComplete,this.playToFrame,this);e.parent instanceof eui.Component&&this.assetMap.put(i.hashCode,t),e.offset&&(i.x=e.offset.x,i.y=e.offset.y),e.addPos||0==e.parent.numChildren?t?e.parent.addChild(t):e.parent.addChild(i):t?e.parent.addChildAt(t,0):e.parent.addChildAt(i,0);var n=this.parentMap.get(e.parent.hashCode);n||(n=[],this.parentMap.put(e.parent.hashCode,n)),n.push(e),this.effectMap.put(e.hashCode,i),this.effectMap.put(i.hashCode,e),i.play(e.id,e.name,e.frameRate,e.playCount,e.callFrame)},t.prototype.remove=function(e){var t=this.parentMap.remove(e.hashCode);if(t){for(;t.length>0;)this.removeEffect(t.shift());t=null}},t.prototype.removeAll=function(){var e;for(var t in this.parentMap){for(e=this.parentMap.remove(t);e.length>0;)this.removeEffect(e.shift(),!0);e=null}for(var i=this.aniPool.length,n=0;i>n;n++)this.aniPool[n].dispose(),this.aniPool[n]=null;this.aniPool.length=0},t.prototype.addPool=function(e){e.stop(),e.clear(),e.x=0,e.y=0,e.anchorOffsetX=0,e.anchorOffsetY=0,e.scaleX=1,e.scaleY=1,this.aniPool.push(e)},t.prototype.removeEffect=function(e,t){if(void 0===t&&(t=!1),e){var i=this.effectMap.remove(e.hashCode);if(i){i.stop();var n=this.effectMap.remove(i.hashCode);n=null;var o=this.assetMap.remove(i.hashCode);o?(e.parent.removeChild(o),o=null):i.parent&&i.parent.removeChild(i),t?i.dispose():this.addPool(i),i=null}e.dispose(),e=null}},t.prototype.playComplete=function(e){var t=this.effectMap.get(e.hashCode);if(t){var i=this.parentMap.get(t.parent.hashCode),n=i.indexOf(t);if(n>-1&&i.splice(n,1),i.length<=0){var o=this.parentMap.remove(t.parent.hashCode);o=null}t.playComplete&&(t.data?t.playComplete.call(t.thisObject,t.data):t.playComplete.call(t.thisObject)),this.removeEffect(t),i=null,t=null}},t.prototype.playToFrame=function(e){var t=this.effectMap.get(e.hashCode);t&&t.playToFrame&&(t.data?t.playToFrame.call(t.thisObject,t.data):t.playToFrame.call(t.thisObject))},t}();e.EffectManager=t,__reflect(t.prototype,"foxgame.EffectManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.ACTION_TYPE={ACTION_NONE:0,ACTION_IDLE:1,ACTION_WALK:2,ACTION_RUN:3,ACTION_ATTACK:4,ACTION_CASTER:5,ACTION_FLY:6,ACTION_DEATH:1},e.DIRECTION_ENUM={DIR_NONE:0,DIR_UP_RIGHT:1,DIR_RIGHT:2,DIR_DOWN_RIGHT:3,DIR_DOWN:4,DIR_DOWN_LEFT:5,DIR_LEFT:6,DIR_UP_LEFT:7,DIR_UP:8},e}();e.EnumManager=t,__reflect(t.prototype,"foxgame.EnumManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.loadList=[],this.fontMap=new e.HashMap}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getFont=function(e){var t=e.resId+"_fnt",i=e.resId;this.isResLoaded(i)||egret.warn("font resource has not loaded, "+i);var n=this.fontMap.get(i);if(!n){var o=RES.getRes(t);e.fontCache&&this.fontMap.put(e.resId,o)}return n},t.prototype.removeFontFactory=function(e){var t=this.fontMap.remove(e);t=null},t.prototype.getFontData=function(e){return this.getFont(e)},t.prototype.isResLoaded=function(e){return RES.getRes(e+"_fnt")},t.prototype.loadFontRes=function(e){RES.getRes(e+"_fnt")||(RES.createGroup(e+"_font",[e+"_fnt"]),RES.loadGroup(e+"_font"))},t.prototype.show=function(e){e.bitmapText.font=this.getFontData(e),e.show()},t.prototype.showAsync=function(e){this.loadList.push(e),this.loadFontRes(e.resId)},t.prototype.loadComplete=function(e){for(var t,i=this.loadList.length,n=0;i>n;)t=this.loadList[n],t.resId+"_font"!=e.groupName?n++:(this.show(t),this.loadList.splice(n,1),i--)},t}();e.FontManager=t,__reflect(t.prototype,"foxgame.FontManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i,n,o,a,s,r){void 0===r&&(r=null);var l=t.call(this)||this;if(l.isAlpha=!1,l.titleGroup=new egret.DisplayObjectContainer,l.mHowardGroup=null,l.frameTime=0,l.isInSafeArea=!1,l.moveChannel=null,l.scaleX=e.Global.modelSizeScale,l.scaleY=e.Global.modelSizeScale,l.playerInfo=n,l.init(),l.parentNode=i,l.curPos=o,l.sceneContainer=s,null!=r){l.tiledMap=r,l.tag=n.playerId,l.name="name"+l.tag;var h=l.tiledMap.TiledToSpace(o);l.x=h.x,l.y=h.y,l.initModel(),a?l.mPersonType=1:l.mPersonType=2,h=null;var c=l.parentNode.getChildByName(l.name);null!=c&&l.parentNode.removeChild(c),c=null,l.parentNode.addChild(l),l.showPlayerBasicInfo(l,n.playerInfo),l.mBuffEffect=new egret.DisplayObjectContainer,l.addChild(l.mBuffEffect),l.checkPlayerStatus(),l.moveEndIdle()}else{l.initModel();var c=l.parentNode.getChildByName(l.name);null!=c&&l.parentNode.removeChild(c),c=null,l.parentNode.addChild(l)}return l}return __extends(i,t),i.prototype.playAni=function(t){this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.upStarAni=new e.FoxAni(this.halo),this.upStarAni.play(t,"ani")},i.prototype.getCurDirection=function(){return this.fx},i.prototype.changehalo=function(){if(this.playerInfo.playerInfo){var t=e.JsonDataManager.instance.dragonGuardTemplate[this.playerInfo.playerInfo.getWardLevel()],i=1;(null==this.playerInfo.playerInfo.getWardLevel()||0==this.playerInfo.playerInfo.getWardState())&&(i=0),0==i?(this.mShadow&&(this.mShadow.visible=!0),this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null)):(this.playAni(t.effect2),this.mShadow&&(this.mShadow.visible=!1))}},i.prototype.changeArmorHalo=function(){if(this.playerInfo.playerInfo)if(this.playerInfo.playerInfo.getDragonArmourGuardLevel()&&1==this.playerInfo.playerInfo.getDragonArmourShowGuard()){var t=e.JsonDataManager.instance.dragonArmorGuardTemplate[this.playerInfo.playerInfo.getDragonArmourGuardLevel()];this.playArmorAni(t.effect2)}else this.playArmorAni("")},i.prototype.playArmorAni=function(t){this.armorAni&&(this.armorAni.clear(),this.armorAni=null),this.armorAni=new e.FoxAni(this.armorHalo),this.armorAni.play(t,"ani")},i.prototype.init=function(){this.MainNode=new egret.DisplayObjectContainer,this.halo=new egret.DisplayObjectContainer,this.addChild(this.halo),this.changehalo(),this.addChild(this.MainNode),this.mBodyNode=new egret.DisplayObjectContainer,this.MainNode.addChild(this.mBodyNode),this.armorHalo=new egret.DisplayObjectContainer,this.MainNode.addChild(this.armorHalo),this.armorHalo.y=-50,this.changeArmorHalo(),this.mChest=new egret.MovieClip,this.mChest.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),this.mMainWeapon=new egret.MovieClip,this.mMainWeapon.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WEAPON),this.mMainWeapon.touchEnabled=!1,this.mWing=new egret.MovieClip,this.mWing.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.WING),this.mWing.touchEnabled=!1,this.mBodyNode.addChild(this.mChest),this.mBodyNode.addChild(this.mMainWeapon),this.mBodyNode.addChild(this.mWing),this.mShadow=new egret.Bitmap;var t=RES.getRes("u_shadow2_png");t?(this.mShadow.texture=t,this.mShadow.anchorOffsetX=this.mShadow.width>>1,this.mShadow.anchorOffsetY=this.mShadow.height>>1):App.getResourceUtils().getResAsync("u_shadow2_png",this.loadend,this),this.mShadow.scaleX=this.mShadow.scaleY=.5,this.addChild(this.mShadow),null==this.hpTextField&&(this.hpTextField=new egret.TextField),null==this.hpBar&&(this.hpBar=new e.BattleHPBar(e.RoleType.MAIN_ROLE)),null==this.mName&&(this.mName=new egret.TextField,this.mName.stroke=1,this.mName.strokeColor=0),null==this.duanWeiPic&&(this.duanWeiPic=new eui.Image),null==this.unionNameTF&&(this.unionNameTF=new egret.TextField,this.unionNameTF.stroke=1,this.unionNameTF.strokeColor=0),this.MainNode.addChild(this.hpBar),this.MainNode.addChild(this.hpTextField),this.MainNode.addChild(this.mName),this.MainNode.addChild(this.duanWeiPic),this.MainNode.addChild(this.unionNameTF),this.MainNode.addChild(this.titleGroup),this.titleGroup.touchEnabled=!1,this.titleGroup.touchChildren=!1,this.mBodyNode.touchEnabled=!0,this.mBodyNode.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this)},i.prototype.initModel=function(){e.MainSceneManager.instance.showOnce&&this.playerInfo&&!this.mActionController&&(this.mActionController=e.ActionUtils.CreateActionInfoFromMapPlayer(this.playerInfo.playerInfo,this))},i.prototype.loadend=function(e){this.mShadow.texture=e,this.mShadow.anchorOffsetX=this.mShadow.width>>1,this.mShadow.anchorOffsetY=this.mShadow.height>>1},i.prototype.onChoose=function(t){e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("选中"),this.StopTW()},i.prototype.MovePos=function(t,i){void 0===i&&(i=null),this.playMoveVoice();var n,o=new egret.Point(this.x,this.y);e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("otiX:"+this.x+" oriY"+this.y),n=this.tiledMap.SpaceToTiled(o),e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("oriTiled X = "+n.x+" Y = "+n.y);var a=e.Astar.instance.findPath(n,t,this.tiledMap);if(null!=a){null!=this.tw?(this.tw.pause(),egret.Tween.removeTweens(this),this.tw=egret.Tween.get(this,{onChange:this.change,onChangeObj:this})):this.tw=egret.Tween.get(this,{onChange:this.change,onChangeObj:this});var s=function(){1==this.mPersonType&&this.sendMoveBeginPacket(n,t)};this.tw.call(s);for(var r=0,l=a.length;l>r;){var h=n,c=o;r>0&&(h=a[r-1],c=this.tiledMap.TiledToSpace(h));var u=a[r],p=e.Astar.instance.judgeNextDirection(h,u);r==a.length-1&&(this.fx=p);var g=this.tiledMap.TiledToSpace(u);e.Global.logLevel>e.Global.logLevelInfo&&(Log.trace("PATHX:"+g.x+" PATHY:"+g.y),Log.trace("ONEX:"+u.x+" ONEY:"+u.y));var d=egret.Point.distance(g,c),f=d/e.ActionDefine.instance.DirectionSpeed.get(p);this.tweenCallFunc(p,f,g),r++}var m=function(){this.changAction(1,this.fx),this.checkPlayerStatus(),this.sendMoveEndPacket(this.getCurTilePos()),egret.Tween.removeTweens(this),this.stopMoveVoice(),this.moveEndIdle()};this.tw.call(m,this),i&&this.tw.call(i,this)}},i.prototype.moveEndIdle=function(){var e=1e3*Math.random()+1e3;egret.Tween.get(this,{loop:!0}).wait(e).to({y:this.y+2},100).to({y:this.y},100)},i.prototype.tweenCallFunc=function(t,i,n){var o=this;this.tw.call(function(t){o.changAction(e.EnumManager.ACTION_TYPE.ACTION_RUN,t),o.checkPlayerStatus(),e.Global.logLevel>e.Global.logLevelInfo&&(Log.trace(t),Log.trace("....................x"+o.x+" y = "+o.y))},this,[t]).to({x:n.x,y:n.y},i)},i.prototype.sendMoveBeginPacket=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPPlayerMoveState");n.setState(1),n.setCurPosX(t.x),n.setCurPosY(t.y),n.setTarPosX(i.x),n.setTarPosY(i.y),e.Message.instance.send(e.Code.PLAYER_MOVE,n,!0)},i.prototype.StopTW=function(){this.tw&&(this.tw.pause(),egret.Tween.removeTweens(this),this.tw=egret.Tween.get(this));var e=1e3*Math.random()+1e3;egret.Tween.get(this,{loop:!0}).wait(e).to({y:this.y+2},100).to({y:this.y},100),null==this.fx&&this.mActionController&&(this.fx=this.mActionController.desDirection),this.changAction(1,this.fx)},i.prototype.changAction=function(t,i){if(this.initModel(),this.mActionController){if(i==e.EnumManager.DIRECTION_ENUM.DIR_DOWN){var n=0;n=1}this.mActionController.updateAction(t,i)}},i.prototype.changeActionController=function(t,i){var n=!1;if(t.mActionController||(n=!0),t.initModel(),!n||!t.mActionController){var o=null,a=null;t.mActionController&&(o=t.mActionController.desAction,a=t.mActionController.desDirection,null!=t.mActionController&&(t.mActionController.release(),t.mActionController=null)),t.playerInfo.playerInfo=i,t.mActionController=e.ActionUtils.CreateActionInfoFromMapPlayer(i,t,o,a)}},i.prototype.Excecute=function(){if(this.frameTime+=e.MapViewportGroupManager.mapViewTicker,1==this.mPersonType&&this.frameTime>1e4){var t=e.MapSceneService.instance.mainPlayerData.playerInfo.getRoleItemId(),i=e.CommonUtils.getProfessionIdByRoleItemId(t),n=e.MapSceneService.instance.mainPlayerData.playerInfo.getPlayerLevel(),o=[45,40,40];if(n>=o[i-1]){var a=[13,12,11],s=a[i-1];null!=s&&this.showBuff(s),this.frameTime=0}}},i.prototype.len=function(e){for(var t=e.split(""),i=0,n=0,o=t.length;o>n;)t[n].charCodeAt(0)<299?i++:i+=2,n++;return i},i.prototype.showPlayerBasicInfo=function(t,i){this.setHpWidget(i);this.mName.scaleX=1,this.mName.scaleY=1,this.mName.text=i.getPlayerName(),this.mName.y=this.hpTextField.y-25,this.mName.textColor=15655878,this.mName.size=18,this.mName.fontFamily="宋体",this.mName.anchorOffsetX=this.mName.width/2;var n=this.mName.y-this.mName.height/2;if(this.setDuanWeiTitle(i),this.setUnionName(i),this.unionNameTF.y=this.mName.y-this.unionNameTF.height-8,i.getTitleId()>0){var o=e.JsonDataManager.instance.medalTemplate[i.getTitleId()];this.titleGroup.removeChildren(),null!=o.animation?(null!=this.titleBmp&&this.titleBmp.parent&&this.titleBmp.parent.removeChild(this.titleBmp),this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleAnim=new e.FoxAni(this.titleGroup),this.titleAnim.frameRate=6,this.titleAnim.play(o.animation,"ani",-1)):null!=o.icon1&&(null!=this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleBmp=new eui.Image,this.titleGroup.addChild(this.titleBmp),App.getResourceUtils().getResAsync(o.icon1+"_png",function(e){this&&this.titleBmp&&(this.titleBmp.source=o.icon1+"_png",this.titleBmp.x=-e.textureWidth>>1,this.titleBmp.y=-e.textureHeight>>1)},this)),this.titleGroup.y=this.unionNameTF.y-55,this.titleGroup.visible=!0,n=this.titleGroup.y-10}1==this.mPersonType&&e.BattleScene.instance.changeSelfActorShowPlayerBasicInfo(i)},i.prototype.setUnionName=function(e){var t=e.getUnionName();null!=t?(this.unionNameTF.strokeColor=0,this.unionNameTF.stroke=1,this.unionNameTF.fontFamily="宋体",this.unionNameTF.size=18,this.unionNameTF.text=t,this.unionNameTF.textColor=1096691,this.unionNameTF.anchorOffsetX=this.unionNameTF.width>>1):(this.unionNameTF.height=0,this.unionNameTF.text="")},i.prototype.setDuanWeiTitle=function(t){var i=1==this.mPersonType?e.PlayerService.instance.mainRoleInfo.getLevel():t.getPlayerLevel();if(i>=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_LIMIT"))){var n=e.KFController.getInstance().getDuanByLevel(t.getSegmentStar());this.duanWeiPic.source=n>=0?"sceneDuan_"+n+"_png":""}else this.duanWeiPic.source="";this.duanWeiPic.y=this.mName.y+(this.mName.height-17>>1)-11,this.duanWeiPic.x=this.mName.x-(this.mName.width>>1)-50,this.duanWeiPic.scaleX=1,this.duanWeiPic.scaleY=1,this.duanWeiPic.touchEnabled=!1,1==this.mPersonType&&e.BattleScene.instance.changeSelfActorShowPlayerBasicInfo(e.MapSceneService.instance.mainPlayerData.playerInfo)},i.prototype.setHpWidget=function(t){var i=t.getCurHp(),n=t.getMaxHp(),o=i/1e4,a=n/1e4;a>100?o>100?this.hpTextField.text=Math.floor(o)+e.LanguageUtils.instance.getValue("WAN")+"/"+Math.floor(a)+e.LanguageUtils.instance.getValue("WAN"):this.hpTextField.text=i+"/"+Math.floor(a)+e.LanguageUtils.instance.getValue("WAN"):this.hpTextField.text=i+"/"+n,this.hpTextField.strokeColor=0,this.hpTextField.stroke=1,this.hpTextField.textColor=15655878,this.hpTextField.size=18,this.hpTextField.fontFamily="宋体",this.hpTextField.anchorOffsetX=this.hpTextField.width/2,this.hpBar.anchorOffsetX=this.hpBar.width/2,this.hpBar.anchorOffsetY=this.hpBar.height/2,this.hpBar.y=-114,this.hpBar.visible=!0,this.hpBar.setHpData(i/n),this.hpTextField.y=this.hpBar.y-25},i.prototype.sendMoveEndPacket=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPPlayerMoveState");i.setState(2),i.setCurPosX(t.x),i.setCurPosY(t.y),e.Message.instance.send(e.Code.PLAYER_MOVE,i,!0)},i.prototype.getCurTilePos=function(){return this.tiledMap.SpaceToTiled(new egret.Point(this.x,this.y))},i.prototype.change=function(){e.MainSceneManager.instance.moveBG()},i.prototype.checkPlayerStatus=function(){var t=this.tiledMap.SpaceToTiled(new egret.Point(this.x,this.y));this.tiledMap.isOpacity(t.x,t.y)?this.alpha=.7:this.alpha=1,this.tiledMap.isSafeArea(t.x,t.y)?(1!=this.isInSafeArea&&this==e.MainSceneManager.instance.mainRole&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("EnterSafeArea")),this.isInSafeArea=!0):(0!=this.isInSafeArea&&this==e.MainSceneManager.instance.mainRole&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("EnterUnsafeArea")),this.isInSafeArea=!1),t=null,e.MapViewportGroupManager.instance.sceneView.setMainScenePeopleIndex()},i.prototype.stopMove=function(){this.checkPlayerStatus(),this.StopTW(),1==this.mPersonType&&(e.MainSceneManager.instance.mainRole.curPos.x=this.getCurTilePos().x,e.MainSceneManager.instance.mainRole.curPos.y=this.getCurTilePos().y,this.sendMoveEndPacket(this.getCurTilePos()))},i.prototype.destroy=function(){null!=this.tw&&(this.tw.pause(),this.tw=null),egret.Tween.pauseTweens(this),egret.Tween.removeTweens(this),this.parent.removeChild(this),this.mActionController&&this.mActionController.release(),this.mActionController=null,this.curPos=null,this.fx=null,this.mPersonType=null,this.tiledMap=null,this.mName.parent.removeChild(this.mName),this.mName.text=null,this.mName=null,this.titleGroup&&(this.titleGroup.removeChildren(),this.titleBmp&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.titleBmp,"titleBmp",!1,e.CharacterController.getInstance().getPanel().getUiBaseName()),this.titleBmp.source=""),this.titleAnim&&this.titleAnim.clear(),this.titleBmp=null,this.titleAnim=null,this.titleGroup=null),this.duanWeiPic.parent.removeChild(this.duanWeiPic),this.duanWeiPic.source=null,this.duanWeiPic=null,this.unionNameTF.parent.removeChild(this.unionNameTF),this.unionNameTF.text=null,this.unionNameTF=null,this.mChest.parent.removeChild(this.mChest),this.mChest=null,this.mShadow.parent.removeChild(this.mShadow),this.mShadow=null,this.mHowardGroup=null,this.mHowardAni&&(this.mHowardAni.dispose(),this.mHowardAni=null),this.mBuffEffect.parent.removeChild(this.mBuffEffect),this.mBuffEffect=null,this.mMainWeapon.parent.removeChild(this.mMainWeapon),this.mMainWeapon=null,this.mWing.parent.removeChild(this.mWing),this.mWing=null,this.mBodyNode.removeChildren(),this.mBodyNode.parent.removeChild(this.mBodyNode),this.mBodyNode=null,this.MainNode.removeChildren(),this.MainNode.parent.removeChild(this.MainNode),this.MainNode=null,this.removeChildren()},i.prototype.showBuff=function(t){if(null!=this.LastBuff&&this.LastBuff.stopBuffEffectPeople(this),1==this.mPersonType){var i=HawkProtocolManager.newBuilder("JsProto.HPMapPlayerVisit");i.setVisitType(2),i.setParams([parseInt(t)]),e.Message.instance.send(e.Code.MAP_PLAYER_VISIT,i,!0)}this.LastBuff=e.Buff.showBuffByBuffIdPeople(t,this,1e3*(4*Math.random()+5))},i.prototype.playMoveVoice=function(){if(2!=e.MainBottomControler.PageState&&this.visible){var t=e.PlayerService.instance.playerInfo.getPlayerId();this.playerInfo.playerId==t&&(this.moveChannel||(this.moveChannel=App.SoundManager().playEffectLoop("actorMove_mp3")))}},i.prototype.stopMoveVoice=function(){var t=e.PlayerService.instance.playerInfo.getPlayerId();this.playerInfo.playerId==t&&this.moveChannel&&(this.moveChannel.stop(),this.moveChannel=null)},i.RecordHowardType=0,i.HeightTitle=0,i}(egret.DisplayObjectContainer);e.People=t,__reflect(t.prototype,"foxgame.People")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.combineGroup={},this.combineDict={},this.waitList=[],this.timer=new egret.Timer(30),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this)}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new e.LoadManager),this._instance},enumerable:!0,configurable:!0}),t.prototype.load=function(t,i,n,o){if(void 0===o&&(o=!0),this.groupName=t,this.callBack=i,this.thisObject=n,RES.isGroupLoaded(this.groupName)){var a=new RES.ResourceEvent(RES.ResourceEvent.GROUP_COMPLETE);return a.groupName=t,a.itemsLoaded=1,a.itemsTotal=1,void this.onResourceLoadComplete(a)}RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),o&&(RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.LOADING)),RES.loadGroup(this.groupName)},t.prototype.addWait=function(e){this.waitList.push(e),this.timer.running||this.timer.start()},t.prototype.loadCallBack=function(){this.thisObject&&this.callBack&&this.callBack.call(this.thisObject);var e=this.waitList.indexOf(this.groupName);e>-1&&this.waitList.splice(e,1),this.groupName="",this.thisObject=null,this.callBack=null},t.prototype.onResourceLoadComplete=function(t){if(t.groupName==this.groupName){var i=t.groupName,n=this.combineDict[i];if(n){delete this.combineDict[i];var o=this.combineGroup[n];o.loaded.push(i),o.loaded.length==o.total.length?(e.Message.instance.send(e.MsgCMD.LOAD_RES,{combine:n,combineTotal:o.total.length,combineLoaded:o.loaded.length,group:i,groupTotal:t.itemsTotal,groupLoaded:t.itemsLoaded,status:"complete"}),delete this.combineGroup[n]):e.Message.instance.send(e.MsgCMD.LOAD_RES,{combine:n,combineTotal:o.total.length,combineLoaded:o.loaded.length,group:i,groupTotal:t.itemsTotal,groupLoaded:t.itemsLoaded,status:"progress"})}else e.Message.instance.send(e.MsgCMD.LOAD_RES,{combine:null,combineTotal:null,combineLoaded:null,group:i,groupTotal:t.itemsTotal,groupLoaded:t.itemsLoaded,status:"complete"});RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.loadCallBack(),e.Message.instance.send(e.MsgCMD.MODULE_CLOSE,e.WindowName.LOADING)}"main"==t.groupName,this.onTimer(null)},t.prototype.onResourceLoadError=function(e){egret.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onItemLoadError=function(e){egret.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceProgress=function(t){if(t.groupName==this.groupName){var i=t.groupName,n=this.combineDict[i];if(n){var o=this.combineGroup[n];e.Message.instance.send(e.MsgCMD.LOAD_RES,{combine:n,combineTotal:o.total.length,combineLoaded:o.loaded.length,group:i,groupTotal:t.itemsTotal,groupLoaded:t.itemsLoaded,status:"progress"})}else e.Message.instance.send(e.MsgCMD.LOAD_RES,{combine:null,combineTotal:null,combineLoaded:null,group:i,groupTotal:t.itemsTotal,groupLoaded:t.itemsLoaded,status:"progress"})}},t.prototype.onTimer=function(e){this.groupName||(this.waitList.length>0?this.load(this.waitList[0],null,null,!0):this.timer.stop())},t.prototype.loadCombineGroup=function(e,t){if(this.getCombineGroup(e))return Log.trace("资源组"+e+"已经在加载"),!0;this.combineGroup[e]={loaded:[],total:[]};for(var i=0;i<t.length;i++){var n=t[i];this.combineDict[n]=e,this.combineGroup[e].total.push(n),this.addWait(n)}return!1},t.prototype.getCombineGroup=function(e){return null!=this.combineGroup[e]},t}();e.LoadManager=t,__reflect(t.prototype,"foxgame.LoadManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.isAlpha=!1,n.mName=new eui.Label,n.scaleX=1,n.scaleY=1,n.init(),n.parentNode=i.parentNode,n.sceneContainer=i.sceneContainer,n.tiledMap=i.tileMap,n.tag=i.playerId,n.name="pet_"+n.tag,n.showName=i.ownerName+"的"+i.petName,n.mActionController=e.ActionUtils.CreateActionInfoFromeMapPet(i.itemId,n.mBodyNode),n.mActionController.onCharLoaded=n.onModelLoaded.bind(n),n.setPos(i.curPos.x,i.curPos.y),n.parentNode.addChild(n),n.mName.textColor=15655878,n.mName.stroke=1,n.mName.strokeColor=0,n.mName.size=18,n.mName.fontFamily="宋体",n}return __extends(i,t),i.prototype.setPos=function(e,t){this.curPos=new egret.Point(e,t);var i=this.tiledMap.TiledToSpace(this.curPos);this.x=i.x,this.y=i.y},i.prototype.onModelLoaded=function(){if(!this.modelLoadedFlag){this.modelLoadedFlag=!0;var e=1*this.mChest.getBounds().height;this.mName.text=this.showName,this.mName.x=-this.mName.width/2,this.mName.y=-1*e}},i.prototype.init=function(){this.MainNode=new egret.DisplayObjectContainer,this.addChild(this.MainNode),this.mBodyNode=new egret.DisplayObjectContainer,this.MainNode.addChild(this.mBodyNode),this.mChest=new egret.MovieClip,this.mChest.name="m"+e.ActionDefine.instance.EquipPartNames.get(e.EquipPartType.CLOTHES),this.mBodyNode.addChild(this.mChest),this.mShadow=new egret.Bitmap;var t=RES.getRes("u_shadow2_png");t?(this.mShadow.texture=t,this.mShadow.anchorOffsetX=this.mShadow.width/2,this.mShadow.anchorOffsetY=this.mShadow.height/2):App.getResourceUtils().getResAsync("u_shadow2_png",this.loadend,this),this.mShadow.scaleX=this.mShadow.scaleY=.5,this.addChild(this.mShadow),this.MainNode.addChild(this.mName),this.delayTimeActionNode=new egret.DisplayObjectContainer,this.addChild(this.delayTimeActionNode)
},i.prototype.loadend=function(e){this.mShadow.texture=e,this.mShadow.anchorOffsetX=this.mShadow.width/2,this.mShadow.anchorOffsetY=this.mShadow.height/2},i.prototype.showPlayerBasicInfo=function(e){try{var t=1*this.mChest.getBounds().height;this.mName.size=20,this.mName.scaleX=.5,this.mName.scaleY=.5,this.mName.text=e.name,this.mName.y=-1*t,this.mName.anchorOffsetX=this.mName.width/2,this.mName.anchorOffsetY=this.mName.height/2;var i=e.id;if(i%30>=0&&30>i%30)if(i%=30,0==i)this.mName.text=e.name+"(十星)",this.mName.textColor=16414720;else if(i>0&&10>=i){var n=i;this.mName.text=e.name+"("+n+"星)",this.mName.textColor=5963520}else if(i>10&&20>=i){var n=i-10;this.mName.text=e.name+"("+n+"星)",this.mName.textColor=16776960}else if(i>20&&30>i){var n=i-20;this.mName.text=e.name+"("+n+"星)",this.mName.textColor=16414720}}catch(o){Log.trace("exception: "+o.toString()),console.error(o)}},i.prototype.delayMovePos=function(e){egret.Tween.get(this.delayTimeActionNode).wait(2e3*Math.random()+500).call(function(e){this.MovePos(e)},this,[e])},i.prototype.MovePos=function(t){var i=new egret.Point(this.x,this.y);e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("otiX:"+this.x+" oriY"+this.y);var n=this.tiledMap.SpaceToTiled(i);e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("oriTiled X = "+n.x+" Y = "+n.y),t=this.randPos(t);var o=e.Astar.instance.findPath(n,t,this.tiledMap);if(null!=o){null!=this.tw?(this.tw.pause(),egret.Tween.removeTweens(this),this.tw=egret.Tween.get(this)):this.tw=egret.Tween.get(this);for(var a=0;a<o.length;a++){var s=n,r=i;a>0&&(s=o[a-1],r=this.tiledMap.TiledToSpace(s));var l=o[a],h=e.Astar.instance.judgeNextDirection(s,l);a==o.length-1&&(this.fx=h);var c=this.tiledMap.TiledToSpace(l);e.Global.logLevel>e.Global.logLevelInfo&&(Log.trace("PATHX:"+c.x+" PATHY:"+c.y),Log.trace("ONEX:"+l.x+" ONEY:"+l.y));var u=egret.Point.distance(c,r),p=u/e.ActionDefine.instance.DirectionSpeed.get(h);this.tw.call(function(t){this.checkPlayerStatus(),this.changAction(e.EnumManager.ACTION_TYPE.ACTION_RUN,t),e.Global.logLevel>e.Global.logLevelInfo&&(Log.trace(t),Log.trace("....................x"+this.x+" y = "+this.y))},this,[h]).to({x:c.x,y:c.y},p)}var g=function(){this.changAction(1,this.fx),this.checkPlayerStatus()};this.tw.call(g)}},i.prototype.StopTW=function(){this.tw&&(this.tw.pause(),egret.Tween.removeTweens(this),this.tw=egret.Tween.get(this)),null==this.fx&&(this.fx=this.mActionController.desDirection),this.changAction(1,this.fx)},i.prototype.changAction=function(e,t){this.mActionController.updateAction(e,t)},i.prototype.changeActionController=function(t){null!=this.mActionController&&(this.mActionController.release(),this.mActionController=null),this.mActionController=e.ActionUtils.CreateActionInfoFromeMapPet(t,this.mBodyNode),this.mActionController.onCharLoaded=this.onModelLoaded.bind(this)},i.prototype.getCurTilePos=function(){return this.tiledMap.SpaceToTiled(new egret.Point(this.x,this.y))},i.prototype.checkPlayerStatus=function(){var t=this.tiledMap.SpaceToTiled(new egret.Point(this.x,this.y));this.tiledMap.isOpacity(t.x,t.y)?this.alpha=.7:this.alpha=1,t=null,e.MapViewportGroupManager.instance.sceneView.setMainScenePeopleIndex()},i.prototype.stopMove=function(){this.checkPlayerStatus(),this.StopTW()},i.prototype.destroy=function(){null!=this.tw&&(this.tw.pause(),this.tw=null,egret.Tween.removeTweens(this.delayTimeActionNode)),egret.Tween.pauseTweens(this),egret.Tween.removeTweens(this),this.parentNode.contains(this)&&this.parentNode.removeChild(this),this.parentNode.getChildIndex(this.delayTimeActionNode)>-1&&this.parentNode.removeChild(this.delayTimeActionNode),this.parentNode=null,this.delayTimeActionNode=null,null!=this.mActionController&&(this.mActionController.release(),this.mActionController=null),this.curPos=null,this.fx=null,this.tiledMap=null,this.petInfo=null,this.mName.parent.removeChild(this.mName),this.mName.text=null,this.mName=null,this.mChest.parent.removeChild(this.mChest),this.mChest=null,this.mShadow.parent.removeChild(this.mShadow),this.mShadow=null,this.mBodyNode.parent.removeChild(this.mBodyNode),this.mBodyNode=null,this.MainNode.parent.removeChild(this.MainNode),this.MainNode=null,this.removeChildren()},i.prototype.randPos=function(e){var t=this.tiledMap.TiledToSpace(e),i=34*Math.random(),n=64*Math.random(),o=4*Math.random(),a=null,s=null;1>o?(a=i,s=n):2>o?(a=-1*i,s=-1*n):3>o?(a=i,s=-1*n):(a=-1*i,s=n),t.x+=a,t.y+=s;var r=this.tiledMap.SpaceToTiled(t);return r},i}(egret.DisplayObjectContainer);e.PetPeople=t,__reflect(t.prototype,"foxgame.PetPeople")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.create=function(t,i,n,o){var a=new e.SpriteInfo;return a.init(t,i,n,o),a},t.play=function(e,t,i,n,o){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),null!=i&&(t.setComplete(i,n),i=null,n=null),t.playWithDirection(o)},t.stop=function(e){e.stop()},t}();e.SpriteFoxAniUtils=t,__reflect(t.prototype,"foxgame.SpriteFoxAniUtils")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.prototype.init=function(t,i,n,o){void 0===o&&(o=null),this.action=new e.FoxAni(t),this.action.setResGroupLoadPriority(e.Global.LoadFoxAniBattleSkillResPriority),this.action.cacheTimeMs=3e4,this.action.frameRate=14,this.id=i,this.isRepeat=n,this.direction=o,this.action.preload(this.id)},t.prototype.setComplete=function(e,t){void 0===t&&(t=null),this.data=t,this.callback=e,this.action.setPlayComplete(this.Complete,this)},t.prototype.Complete=function(){this.callback&&this.callback(this.data)},t.prototype.playWithDirection=function(e){void 0===e&&(e=null),this.id.search("_")>0?this.action.frameName=this.id:this.action.frameName=this.id+"_"+this.direction,this.isRepeat?this.action.play(this.id,this.id,-1):this.action.play(this.id,this.id,1)},t.prototype.play=function(){this.isRepeat?this.action.play(this.id,this.id,-1):this.action.play(this.id,this.id,1)},t.prototype.stop=function(){this.Complete(),this.release()},t.prototype.release=function(){this.action&&(this.action.stop(),this.action.dispose()),this.action=null},t}();e.SpriteInfo=t,__reflect(t.prototype,"foxgame.SpriteInfo")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.message=e.Message.instance}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.registerMessage=function(){e.MainUIController.getInstance().registerMsg(this.message),e.MainLoadingController.instance.registerMsg(this.message),this.registerLogin(),e.FieldPKController.getInstance().registerMsg(this.message),this.registerCreateCharacter(),this.registerRank(),e.OtherCharacterController.getInstance().registerMsg(this.message),this.registerChat(),this.registerVipLevelGift(),this.registerMarquee(),e.SearchTreasureController.getInstance().registerMsg(this.message),this.registerAchievement(),this.registerWealPanel(),this.registerJuewei(),this.registerWelcome(),this.registerRedPoint(),this.registerMedal(),this.registerShopMsg(),this.registerWingPanel(),this.registerWeapon(),this.registerBagTip(),e.BagController.getInstance().registerMsg(this.message),e.SoulController.getInstance().registerMsg(this.message),e.ActivityController.getIntance().registerMsg(this.message),e.QQdatingController.getInstance().registerMsg(this.message),e.TTShareController.getInstance().registerMsg(this.message),e.MailController.getInstance().registerMsg(this.message),e.EquipSmeltController.getInstance().registerMsg(this.message),e.UnionController.getInstance().registerMsg(this.message),e.ClimbingController.getInstance().registerMsg(this.message),e.LegendController.getInstance().registerMessage(this.message),e.WorldBossController.getInstance().registerMessage(this.message),e.SmeltController.getInstance().registerMsg(this.message),e.PrisonerController.getInstance().registerMsg(this.message),e.RedPacketController.getInstance().registerMsg(this.message),e.JuBaoPenController.getInstance().registerMsg(this.message),e.KFController.getInstance().registerMsg(this.message),e.DragonboneController.getInstance().registerMsg(this.message),e.DragonArmorController.getInstance().registerMsg(this.message),e.DragongodTreasureController.getInstance().registerMsg(this.message),e.CharacterController.getInstance().registerMsg(this.message),e.BeautyController.getInstance().registerMsg(this.message),e.FirstpayByDayControler.getInstance().registerMsg(this.message),e.ModuleOpenController.getInstance().registerMsg(this.message),e.TwelvePalaceController.getInstance().registerMsg(this.message),e.UnionSiegeController.getInstance().registerMsg(this.message),e.zhuanPanControler.getInstance().registerMsg(this.message),e.ActivityXianShiController.getIntance().registerMsg(this.message),e.ShareWanbaControler.getInstance().registerMsg(this.message),e.SuyiFollowControler.getInstance().registerMsg(this.message),e.PrivilegeController.getInstance().registerMsg(this.message),e.RechargeController.getInstance().registerMsg(this.message),e.GodHoodConttroller.getInstance().registerMsg(this.message),e.GoldTreasureController.getInstance().registerMsg(this.message),e.FactionBattleController.getInstance().registerMsg(this.message),e.WanbaQQVideoAdController.getInstance().registerMsg(this.message),e.ChannelShareController.getInstance().registerMsg(this.message),e.JadeRuyiListController.getInstance().registerMsg(this.message),e.WelcomeController.getInstance().registerMsg(this.message),e.MfsqRedPackController.getInstance().registerMsg(this.message)},t.prototype.registerWingPanel=function(){var t=e.WingController.getInstance();t.initView()},t.prototype.registerWealPanel=function(){var t=e.WealPanelController.getInstance();t.initView(),e.Message.instance.add(e.Code.USE_CDK_S,t),e.Message.instance.add(e.Code.ACC_LOGIN_INFO_S,t),e.Message.instance.add(e.Code.ACC_LOGIN_AWARDS_S,t),e.Message.instance.add(e.Code.EVERYDAY_SIGN_INFO_S,t),e.Message.instance.add(e.Code.EVERYDAY_SIGN_AWARD_S,t),e.Message.instance.add(e.Code.ACTIVE_INFO_SYNC_S,t),e.Message.instance.add(e.Code.ACTIVE_GET_REWARD_S,t),e.Message.instance.add(e.Code.ACTIVE_DAILY_TASK_REWARD_S,t),e.Message.instance.add(e.Code.LEVEL_PACKAGE_INFO_S,t),e.Message.instance.add(e.Code.DRAW_LEVEL_PACKAGE_S,t)},t.prototype.registerWeapon=function(){var t=e.SmeltController.getInstance();e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,t)},t.prototype.registerWelcome=function(){var t=e.WelcomeController.getInstance();this.message.add(e.Code.ROLE_CREATE_S,t)},t.prototype.registerMedal=function(){var t=e.MedalController.getInstance();this.message.add(e.Code.TITLE_SYNC_S,t),this.message.add(e.Code.TITLE_ACTIVE_S,t),this.message.add(e.Code.TITLE_QUALITY_UP_S,t)},t.prototype.registerBagTip=function(){var t=e.TipsController.getInstance();this.message.add(e.Code.ITEM_USE_S_VALUE,t),this.message.add(e.Code.ITEM_LIMIT_GIFT_GET_S,t)},t.prototype.registerShopMsg=function(){var t=e.ShopMainControler.getInstance();this.message.add(e.Code.SHOP_S,t),this.message.add(e.Code.SHOP_LEGENDARYMART_S,t),this.message.add(e.Code.PLAYER_AWARD_S,t),this.message.add(e.Code.SHOP_COIN_S,t)},t.prototype.registerRedPoint=function(){var t=e.RedPointController.getInstance();this.message.add(e.Code.RED_POINT_SYNC_S,t)},t.prototype.registerVipLevelGift=function(){var t=e.CreateNewVipController.instance;this.message.add(e.Code.BUY_VIP_GIFT_S,t),this.message.add(e.Code.VIP_GIFTS_INFO_S,t),this.message.add(e.Code.VIP_WELFARE_INFO_S,t),this.message.add(e.Code.VIP_WELFARE_AWARD_S,t)},t.prototype.registerJuewei=function(){var t=e.NewJueweiController.getInstance();this.message.add(e.Code.NOBILITY_NOBILITY_INFO_S,t),this.message.add(e.Code.NOBILITY_LEVEL_UP_S,t),this.message.add(e.Code.NOBILITY_REWARD_S,t)},t.prototype.registerLogin=function(){var t=e.LoginController.instance;this.message.add(e.Code.LOGIN_S,t),this.message.add(e.Code.ERROR,t)},t.prototype.registerChat=function(){var t=e.NewChatControler.getInstance();this.message.add(e.Code.PUSH_CHAT_S,t),this.message.add(e.Code.SEND_CHAT_S,t)},t.prototype.registerMarquee=function(){var t=e.MarqueeController.getInstance();this.message.add(e.Code.MARQUEE_PUSH,t)},t.prototype.registerAchievement=function(){var t=e.AchievementController.getInstance();this.message.add(e.Code.ACHIEVEMENT_INFO_S,t),this.message.add(e.Code.ACHIEVEMENT_AWARD_S,t),this.message.add(e.Code.ACHIEVEMENT_ONE_AWARD_S,t)},t.prototype.registerCreateCharacter=function(){var t=e.CreateCharacterController.instance;this.message.add(e.Code.ROLE_CREATE_S,t)},t.prototype.registerRank=function(){var t=e.RankController.getInstance();this.message.add(e.Code.RANK_S,t),this.message.add(e.Code.SERVER_RANK_LIST_INFO_S,t)},t}();e.MessageManager=t,__reflect(t.prototype,"foxgame.MessageManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.serverListItem2=[],this.rankItemList=[],this.chatOtherSayItem=[],this.chatOwnSayItem=[],this.chatNoticeItem=[],this.floatPanelList=[],this.floatPanelItem2List=[]}return t.prototype.add=function(t){if(t instanceof e.ServerListItem2)this.serverListItem2.push(t);else if(t instanceof e.ChatOtherSayItem)this.chatOtherSayItem.push(t);else if(t instanceof e.ChatOwnSayItem)this.chatOwnSayItem.push(t);else if(t instanceof e.ChatNoticeItem)this.chatNoticeItem.push(t);else if(t instanceof e.RankItem)this.rankItemList.push(t);else if(t instanceof e.FloatPromptPanel1)this.floatPanelList.push(t);else{if(!(t instanceof e.FloatPanelItem2))throw new Error("对象池存储对象类型错误");this.floatPanelItem2List.push(t)}null!=t.parent&&t.parent.removeChild(t)},t.prototype.get=function(t){if("ServerListItem2"==t)return this.serverListItem2.length>0?this.serverListItem2.pop():new e.ServerListItem2;if("RankItem"==t)return this.rankItemList.length>0?this.rankItemList.pop():new e.RankItem;if("ChatOtherSayItem"==t)return this.chatOtherSayItem.length>0?this.chatOtherSayItem.pop():new e.ChatOtherSayItem;if("ChatOwnSayItem"==t)return this.chatOwnSayItem.length>0?this.chatOwnSayItem.pop():new e.ChatOwnSayItem;if("ChatNoticeItem"==t)return this.chatNoticeItem.length>0?this.chatNoticeItem.pop():new e.ChatNoticeItem;if("FloatPromptPanel1"==t)return this.floatPanelList.length>0?this.floatPanelList.pop():new e.FloatPromptPanel1;if("FloatPanelItem2"==t)return this.floatPanelItem2List.length>0?this.floatPanelItem2List.pop():new e.FloatPanelItem2;throw new Error("对象池获取对象类型错误")},t.prototype.destroy=function(){},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();e.ObjectPoolManager=t,__reflect(t.prototype,"foxgame.ObjectPoolManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.laji={},this.windowMap=new e.HashMap,this.popUpMap=new e.HashMap,this.modalPool=[],this.windowMap.put(e.WindowName.UILAYER,new e.WindowEntity(e.Global.uiLayer,null,!1)),this.windowMap.put(e.WindowName.TOPLAYER,new e.WindowEntity(e.Global.topLayer,null,!1)),this.windowMap.put(e.WindowName.NEWBEEGUIDELAYER,new e.WindowEntity(e.Global.newBeeGuideLayer,null,!1))}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.addPopUp=function(t,i,n,o,a,s,r){void 0===i&&(i=e.WindowName.UILAYER),void 0===n&&(n=5),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===s&&(s=1),void 0===r&&(r=!0);try{var l=this.windowMap.get(t),h=this.windowMap.get(i);if(l&&h){if(this.hasPopUp(t))return void h.window.addChild(l.window);var c=new e.PopUpEntity(t,i,n,a);this.popUpMap.put(t,c),o&&this.addModal(c,s,r),l.window.name=t;h.window.width-l.window.width;l.window.setScaled?l.window.resizePosition():(l.window.x=ScreenAdaptation.instance.screenWidth-l.window.width>>1,l.window.y=ScreenAdaptation.instance.screenHeight-l.window.height>>1),h.window.addChild(l.window),e.Message.instance.send(e.MsgCMD.MainOrBattleSceneObjectsHide,l.window)}}catch(u){Log.trace("exception: "+u.toString()+", windowName: "+t),console.error(u)}},t.prototype.removePopUp=function(t){var i=this.popUpMap.remove(t);if(null!=i&&i instanceof e.PopUpEntity){var n=this.windowMap.get(i.windowName),o=this.windowMap.get(i.parentName);null!=n&&null!=o&&(n.window&&n.window.parent&&n.window.parent.removeChild(n.window),n.control instanceof e.ViewControler&&n.control.clear()),this.removeModal(i),i.dispose(),i=null,e.Message.instance.send(e.MsgCMD.MainOrBattleSceneObjectsShow,n.window)}},t.prototype.hasPopUp=function(e){return this.popUpMap.contains(e)},t.prototype.removeAll=function(){var t;for(var i in this.popUpMap)t=this.windowMap.get(i),null!=t&&t.isRemove&&this.removePopUp(i);e.Message.instance.send(e.MsgCMD.MainOrBattleSceneObjectsShow,t.window)},t.prototype.registerWindow=function(t,i,n,o){void 0===n&&(n=null),void 0===o&&(o=!0),this.windowMap.put(t,new e.WindowEntity(i,n,o)),this.laji[i]=t},t.prototype.getName=function(e){return this.laji[e]},t.prototype.removeWindow=function(t){var i=this.windowMap.remove(t);null!=i&&i instanceof e.WindowEntity&&(i.control instanceof e.ViewControler&&i.control.dispose(),i.dispose(),i=null)},t.prototype.getWindow=function(e){return this.windowMap.get(e)},t.prototype.resize=function(t){e.Global.tdy=t;var i,n,o;for(var a in this.popUpMap)if(i=this.popUpMap.get(a),i&&(n=this.windowMap.get(a),n&&(o=this.windowMap.get(i.parentName)))){var s=n.window instanceof e.ViewControler,r=n.window instanceof e.MainControler;s&&!r&&(n.window.y-=t/2),r&&n.window.doMyScreenAdaptation(t),i.modal&&i.modal.setModalSize(o.window.width,o.window.height),this.setPosition(n.window,i.position,i.offset,o.window.width,o.window.height),n.window.setScaled&&n.window.resizePosition()}},t.prototype.setPosition=function(e,t,i,n,o,a,s){if(void 0===a&&(a=3),void 0===s&&(s=3),0==t)e.x=0,e.y=0;else{var r=Math.floor(n/(s-1)),l=Math.floor(o/(a-1)),h=(t-1)%s,c=Math.floor((t-1)/s);e.x=Math.floor(h*r-h/(s-1)*e.width),e.y=Math.floor(c*l-c/(a-1)*e.height)}null!=i&&(e.x+=i.x,e.y+=i.y)},t.prototype.addModal=function(t,i,n){var o;o=this.modalPool.length>0?this.modalPool.shift():new e.Modal;var a=this.windowMap.get(t.parentName);a&&(o.setModalSize(a.window.width,a.window.height),o.setWindowName(n?t.windowName:""),o.alpha=i,a.window.addChild(o),t.modal=o)},t.prototype.removeModal=function(e){e.modal&&(e.modal.parent&&e.modal.parent.removeChild(e.modal),e.modal.setWindowName(""),this.modalPool.push(e.modal),e.modal=null)},t.prototype.setPopupModalEnable=function(e,t){var i=this.popUpMap.get(e);i&&i.modal&&(i.modal.touchProcess=t)},t}();e.PopUpManager=t,__reflect(t.prototype,"foxgame.PopUpManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.requestFightOwnerName="",this.canT=!1}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.clearRequestOwnerName=function(){this.requestFightType=-1},t.prototype.getRequestFightType=function(){return this.requestFightType},t.prototype.setRequestFightType=function(e){this.requestFightType=e},t.prototype.getRequestOwnerName=function(){return this.requestFightOwnerName},t.prototype.setRequestOwnerName=function(e){this.requestFightOwnerName=e},t.prototype.getRequestFightMapId=function(){return this.mapId},t.prototype.CanTiaoZhan=function(e){this.canT=!0},t.prototype.getBattleId=function(){return this.mapId},t.prototype.tiaoZhanBoss=function(t,i,n,o){if(void 0===n&&(n=""),void 0===o&&(o=0),t==e.BattleType.BATTLE_CHALLENGE||t==e.BattleType.BOSS_PLUNDER_SINGLE){if(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan,null,2),!this.canT)return;e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"RequestFightManager",tag:"tiaoZhanBoss",battleType:t})}e.BattleScene.instance.clientTimeFrameDeltCheck();this.requestFightType=t,this.requestFightOwnerName=n,this.mapId=i;var a=HawkProtocolManager.newBuilder("JsProto.HPMapBattleRequest");a.setBattleType(t),a.setBattleArgs(i),(t==e.BattleType.BATTLE_CHALLENGE||t==e.BattleType.BOSS_PLUNDER_SINGLE)&&o>0&&e.BattleService.instance.setCurrentChallengeType(o);for(var s=[],r=0;r<e.BattleScene.instance.actorList.length;r++)s.push(Math.floor(e.BattleScene.instance.actorList[r].x)),s.push(Math.floor(e.BattleScene.instance.actorList[r].y));a.setXy(s),a.setMonsterCrowdIdx(e.BattleScene.instance.getBattleMapMonsterNextCrowdPosIdx()),a.setMonsterXy([]),e.Message.instance.send(e.Code.MAP_BATTLE_REQUEST_C,a,!0),e.MainControler.instance.EnterFight(),e.PopUpManager.instance.hasPopUp(e.WindowName.BOSS_MAIN)&&e.PopUpManager.instance.removePopUp(e.WindowName.BOSS_MAIN),e.NewBossMainControler.getIntance().getIsShow()&&e.NewBossMainControler.getIntance().close(),e.FuBenController.getInstance().closePanel(),e.PopUpManager.instance.hasPopUp(e.WindowName.BOSS_HOME_MAIN)&&e.PopUpManager.instance.removePopUp(e.WindowName.BOSS_HOME_MAIN),e.NewBossHomeMainControler.getIntance().getIsShow()&&e.NewBossHomeMainControler.getIntance().close(),e.FuBenController.getInstance().closePanel(),e.MainControler.instance.mainOrBattleState(!1),this.canT=!1},t.prototype.doChanllenge=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPChallengeDefender");n.setDefendeRank(t),e.Message.instance.send(e.Code.CHALLENGE_DEFENDER_C,n,!0)},t.prototype.Battle_show=function(e,t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null)},t.prototype.battle_Attack=function(e){},t}();e.RequestFightManager=t,__reflect(t.prototype,"foxgame.RequestFightManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.SkillCfg=null,this.effectTemp=null,this.SkillEffectCfg=null,this.SkillCfg=e.JsonDataManager.instance.skillTemplate,this.effectTemp=e.JsonDataManager.instance.effectTemplate,this.SkillEffectCfg=e.JsonDataManager.instance.skillEffectTemplate}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.hurtSkillAction=function(t,i){var n=t.getSkillId(),o=this.SkillEffectCfg[n];if(null==o)return void Log.trace("没有找到技能："+n);var a=i.effectHeightNode,s=egret.Tween.get(a);s.wait(o.explosionDelay),s.call(this.playStrikeEffect,this,[o,i,e.MapViewportGroupManager.instance.sceneView.SkillNode])},t.changeActionCallbackFunction=function(t){t.modelController.changeAction(e.EnumManager.ACTION_TYPE.ACTION_IDLE,t.modelController.desDirection),t.lastAction=e.EnumManager.ACTION_TYPE.ACTION_IDLE,t.lastDirection=t.modelController.desDirection},t.prototype.playCasterAction=function(i,n,o){if(void 0===o&&(o=null),n.modelController){var a=n,s=i.castAnim;if(null!=o){var r=new egret.Point(n.x,n.y),l=e.NewBattleUtility.moveDirection(r,o,n.modelController.desDirection);n.modelController.changeAction(s,l,t.changeActionCallbackFunction,a,1)}else n.modelController.changeAction(s,n.modelController.desDirection,t.changeActionCallbackFunction,a,1)}},t.effectPlayCallBackFunction=function(t){var i=null,n=null,o=null;t.hasOwnProperty("sprite")&&(i=t.sprite),t.hasOwnProperty("spriteInfo")&&(n=t.spriteInfo),t.hasOwnProperty("skillNode")&&(o=t.skillNode),e.EffectUtils.stop(i,n),i.parent&&i.parent.removeChild(i),i=null,n=null,o=null,t=null},t.prototype.playStrikeEffect=function(i,n,o){void 0===o&&(o=null);var a=n.direction,s=i.explosionPointEffect,r=this.effectTemp[s];if(null!=r){var l=new egret.DisplayObjectContainer;l.name="playStrikeEffect";var h=e.EffectUtils.create(l,r,!1,e.ActionDefine.instance.DirectionFip.get(a));if(null!=h)if(l.scaleY=r.scale*n.scaleY,l.scaleX=e.ActionDefine.instance.DirectionFip.get(a)==a?r.scale*n.scaleX:-1*r.scale*n.scaleX,null!=o){o.addChild(l);var c=e.NewBattleUtility.fixEffectPosition(new egret.Point(n.x,n.y),n,r.position,n.modelController.desDirection,r.posX,r.posY);l.x=c.x,l.y=c.y;var u={sprite:l,spriteInfo:h,skillNode:o};e.EffectUtils.play(l,h,o,t.effectPlayCallBackFunction,u,n)}else l=null,h.release(),h=null;else l=null}},t.prototype.playCasterEffect=function(i,n,o){var a=n.direction,s=i,r=e.ActionDefine.instance.DirectionFip.get(a);s>=1e4&&(s+=r);var l=this.effectTemp[s];if(null==l)throw new Error("缺少技能释放特效:  "+s);var h=new egret.DisplayObjectContainer;h.name="playCasterEffect";var c=e.EffectUtils.create(h,l,!1,e.ActionDefine.instance.DirectionFip.get(a));if(null!=c){h.scaleY=l.scale*n.scaleY,h.scaleX=e.ActionDefine.instance.DirectionFip.get(a)==a?l.scale*n.scaleX:-1*l.scale*n.scaleX;var u=void 0;if(10020==i?(u=n.effectHeightNode,u.addChild(h),h.x=0,h.y=0):(u=e.MapViewportGroupManager.instance.sceneView.SkillCasterNode,u.addChild(h),h.x=n.x,h.y=n.y),null!=u){var p={sprite:h,spriteInfo:c,skillNode:u};e.EffectUtils.play(h,c,u,t.effectPlayCallBackFunction,p,n)}}else h=null;e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("播放施法特效"+l.prefix+"   施法特效的方向"+a)},t.prototype.playBallisticEffect=function(i,n,o,a,s){Log.trace("根据位置播放弹道");var r=n.modelController.desDirection,l=i.bulletEffect,h=this.effectTemp[l];if(null!=h)for(var c=e.NewBattleUtility.fixEffectPosition(new egret.Point(n.x,n.y),n,h.position,n.modelController.desDirection,h.posX,h.posY),u=0;u<a.length;u++){var p=new egret.DisplayObjectContainer,g=e.EffectUtils.create(p,h,!0,e.ActionDefine.instance.DirectionFip.get(r));if(null!=g){var d=a[u];p.scaleY=h.scale*n.scaleY,p.scaleX=e.ActionDefine.instance.DirectionFip.get(r)==r?h.scale*n.scaleX:-1*h.scale*n.scaleX;var f=new egret.DisplayObjectContainer;if(f.addChild(p),null!=o){o.addChild(f),f.x=c.x,f.y=c.y;var m={sprite:p,spriteInfo:g,skillNode:o};e.EffectUtils.play(p,g,o,t.effectPlayCallBackFunction,m,n);var y=egret.Tween.get(f),I=egret.Point.distance(new egret.Point(n.x,n.y),d)/e.NewBattleDefine.BulletServerSpeed;y.to({x:d.x,y:d.y},I).call(function(e,t,i,n,o){egret.Tween.pauseTweens(e),egret.Tween.removeTweens(e),e.removeChildren(),n.removeChild(e),i.stop(),o&&o()},[f,p,g,o,s])}}else p=null}},t.prototype.playBallisticEffectByUnit=function(i,n,o,a,s){if(o&&o.modelController){var r=this.effectTemp[i];if(null!=r)for(var l=e.NewBattleUtility.fixEffectPosition(new egret.Point(o.x,o.y),o,r.position,o.modelController.desDirection,r.posX,r.posY),h=e.MapViewportGroupManager.instance.sceneView.SkillNode,c=0;c<a.length;c++){var u=e.BattleScene.instance.getUnitById(a[c]);if(u){var p=new egret.DisplayObjectContainer,g=e.EffectUtils.create(p,r,!0,e.ActionDefine.instance.DirectionFip.get(o.direction));if(null!=g){p.scaleY=r.scale*o.scaleY,p.scaleX=e.ActionDefine.instance.DirectionFip.get(o.direction)==o.direction?r.scale*o.scaleX:-1*r.scale*o.scaleX;var d=new egret.DisplayObjectContainer;d.addChild(p);var f=null;h.addChild(d),d.x=l.x,d.y=l.y;var m={sprite:p,spriteInfo:g,skillNode:h};e.EffectUtils.play(p,g,h,t.effectPlayCallBackFunction,m,o),this.ballisticCallBack(d,n,o,u,p,g,h,s,f)}else p=null}else egret.warn("playBallisticEffectByUnit target has been invalid")}}},t.prototype.ballisticCallBack=function(i,n,o,a,s,r,l,h,c){if(null==a||null==a.modelController)return egret.Tween.pauseTweens(i),egret.Tween.removeTweens(i),i.removeChildren(),null!=i.parent&&l.removeChild(i),r.stop(),void(h&&h());var u=new egret.Point(i.x,i.y),p=t.instance.effectTemp[n],g=e.BodyPosition.Body;null!=p&&(g=p.position);var d=new egret.Point(a.x,a.y);if(d=e.NewBattleUtility.fixEffectPosition(d,a,g,a.modelController.desDirection,p.posX,p.posY),null!=c&&egret.Point.distance(d,u)<c/2)return egret.Tween.pauseTweens(i),egret.Tween.removeTweens(i),r.stop(),void t.instance.playHitEffect(n,o,s,l,i,h);c=e.NewBattleDefine.egretHeartTick*e.NewBattleDefine.BulletServerSpeed;var f=new egret.Point(d.x-u.x,d.y-u.y),m=egret.Point.distance(u,d);c>m&&(c=m),f.normalize(1);var y=new egret.Point(u.x+f.x*c,u.y+f.y*c),I=e.NewBattleUtility.calculateRotation(u,d);s.rotation=I;var v=egret.Tween.get(i);v.to({x:y.x,y:y.y},e.NewBattleDefine.egretHeartTick),v.call(this.ballisticCallBack,this,[i,n,o,a,s,r,l,h,c]),v=null},t.prototype.playActionEffectByUnit=function(i,n,o,a){var s=e.MapViewportGroupManager.instance.sceneView.SkillNode,r=this.effectTemp[i];if(null!=r&&(13==i&&(r.position=e.BodyPosition.Feet,r.posY=-20),null!=e.BattleScene.instance.enemyList))if(0==r.effectType){for(var l=[],h=0;h<o.length;h++){var c=e.BattleScene.instance.getUnitById(o[h]);if(c){var u=e.NewBattleUtility.fixEffectPosition(c.getPosition(),c,r.position,c.direction,r.posX,r.posY);l.push(u)}else egret.warn("playActionEffectByUnit target has been invalid")}this.playActionEffect(i,n,s,l,a)}else for(var h=0;h<o.length;h++){var c=e.BattleScene.instance.getUnitById(o[h]);if(c&&c.modelController){var p=e.EffectUtils.create(null,r,!1,e.ActionDefine.instance.DirectionFip.get(c.modelController.desDirection)),g={sprite:c,spriteInfo:p,skillNode:s};e.EffectUtils.play(c,p,s,t.effectPlayCallBackFunction,g,n)}else egret.warn("playActionEffectByUnit target has been invalid")}},t.prototype.playHitEffect=function(i,n,o,a,s,r){if(e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("受到攻击  弹道技能"),s.removeChildren(),s.parent&&s.parent.removeChild(s),null!=n&&null!=n.modelController){var l=this.effectTemp[i];o.removeChildren(),o.x=s.x,o.y=s.y;var h=e.EffectUtils.create(o,l,!1,2);if(null!=h)if(o.scaleY=l.scale*n.scaleY,o.scaleX=2==e.ActionDefine.instance.DirectionFip.get(2)?l.scale*n.scaleX:-1*l.scale*n.scaleX,null!=a){a.addChild(o);var c={sprite:o,spriteInfo:h,skillNode:a};e.EffectUtils.play(o,h,a,t.effectPlayCallBackFunction,c,n)}else o=null,h.release(),h=null}},t.prototype.playActionEffect=function(i,n,o,a,s){var r=this.effectTemp[i];if(null!=r&&null!=n&&null!=n.modelController)for(var l=(n.modelController.desDirection,0);l<a.length;l++){var h=new egret.DisplayObjectContainer,c=e.EffectUtils.create(h,r,!1,e.ActionDefine.instance.DirectionFip.get(n.modelController.desDirection));if(null==c)return void(h=null);h.scaleY=r.scale*n.scaleY,h.scaleX=r.scale*n.scaleX,h.x=a[l].x,h.y=a[l].y,o.addChild(h);var u={sprite:h,spriteInfo:c,skillNode:o};e.EffectUtils.play(h,c,o,t.effectPlayCallBackFunction,u,n)}},t.prototype.playBallisticEffectByTargets=function(i,n,o,a,s,r,l){if(o&&o.modelController){var h=this.effectTemp[i];if(null!=h)for(var c=new egret.Point(o.x,o.y),u=e.NewBattleUtility.fixEffectPosition(c,o,h.position,o.modelController.desDirection,h.posX,h.posY),p=e.MapViewportGroupManager.instance.sceneView.SkillNode,g=0;g<a.length;g++){var d=a[g];if(d){var f=new egret.DisplayObjectContainer,m=e.EffectUtils.create(f,h,!0,e.ActionDefine.instance.DirectionFip.get(o.direction));if(null!=m){f.scaleY=h.scale*o.scaleY,f.scaleX=e.ActionDefine.instance.DirectionFip.get(o.direction)==o.direction?h.scale*o.scaleX:-1*h.scale*o.scaleX;var y=new egret.DisplayObjectContainer;y.addChild(f);var I=null;p.addChild(y),y.x=u.x,y.y=u.y;var v={sprite:f,spriteInfo:m,skillNode:p};e.EffectUtils.play(f,m,p,t.effectPlayCallBackFunction,v,o),this.ballisticCallBack(y,n,o,d,f,m,p,s,I)}else f=null}else egret.warn("playBallisticEffectByTargets target has been invalid")}}},t.prototype.playActionEffectByTargets=function(i,n,o,a,s,r){var l=e.MapViewportGroupManager.instance.sceneView.SkillNode,h=this.effectTemp[i];if(null!=h)if(0==h.effectType){for(var c=[],u=0;u<o.length;u++){var p=o[u];if(p){var g=e.NewBattleUtility.fixEffectPosition(p.getPosition(),p,h.position,p.direction,h.posX,h.posY);c.push(g)}else egret.warn("playActionEffectByTargets target has been invalid")}this.playActionEffect(i,n,l,c,a)}else for(var u=0;u<o.length;u++){var p=o[u];if(p){var d=e.EffectUtils.create(null,h,!1,e.ActionDefine.instance.DirectionFip.get(p.modelController.desDirection)),f={sprite:p,spriteInfo:d,skillNode:l};e.EffectUtils.play(p,d,l,t.effectPlayCallBackFunction,f,n)}else egret.warn("playActionEffectByTargets target has been invalid")}},t}();e.SkillActionManager=t,__reflect(t.prototype,"foxgame.SkillActionManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.soundList=[],this.soundPool=new e.HashMap}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new e.SoundManager),this._instance
},enumerable:!0,configurable:!0}),t.prototype.play=function(t,i,n,o,a,s){if(void 0===n&&(n=!1),void 0===o&&(o=!1),n)this.bgSound||(this.bgSound=new e.SoundEntity(t,a,s)),this.bgSound.play(i,o);else{var r=void 0,l=this.soundPool.get(t);l&&l.length>0?r=l.shift():(a&&s||(a=this.defaultCallBack,s=this),r=new e.SoundEntity(t,a,s)),r.play(i,o),this.soundList.push(r)}},t.prototype.stop=function(e,t){if(void 0===t&&(t=!1),t)this.bgSound&&this.bgSound.stop();else for(var i=this.soundList.length,n=0;i>n;n++)this.soundList[n].id==e&&this.soundList[n].stop()},t.prototype.remove=function(e,t){if(void 0===t&&(t=!1),t)this.bgSound&&(this.bgSound.dispose(),this.bgSound=null);else for(var i=void 0,n=this.soundList.length,o=0;n>o;)i=this.soundList[o],i.id!=e?o++:(this.soundList.splice(o,1),i.dispose(),i=null,n--)},t.prototype.removeAll=function(){this.bgSound&&(this.bgSound.dispose(),this.bgSound=null);for(var e,t=this.soundList.length,i=0;t>i;i++)e=this.soundList[i],this.soundList.splice(i,1),e.dispose(),e=null;this.soundList.length=0;var n;for(var o in this.soundPool)if(n=this.soundPool.remove(o)){t=n.length;for(var i=0;t>i;i++)n[i].dispose(),n[i]=null;n=null}},t.prototype.defaultCallBack=function(e){if(this.bgSound!=e){var t=this.soundPool.get(e.id);t||(t=[],this.soundPool.put(e.id,t)),t.push(e)}},t}();e.SoundManager=t,__reflect(t.prototype,"foxgame.SoundManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.textList=[],this.textPool=[],this.moreTextList=[],this.moreTextPool=[],this.aniTimer=new egret.Timer(50),this.aniTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this)}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new e.TextAniManager),this._instance},enumerable:!0,configurable:!0}),t.prototype.addTexts=function(t,i){void 0===i&&(i=0);var n;n=this.moreTextPool.length>0?this.moreTextPool.shift():new e.MoreText,2==i||3==i?(n.setText(t,i,!0,!0,18,0,0,"left"),n.x=0,n.y=.7*(e.Global.stageHeight-n.contentHeight)):(n.setText(t,i,!0,!0,18),n.x=0,n.y=.5*(e.Global.stageHeight-n.contentHeight)+20),e.Global.uiLayer.addChild(n),this.moreTextList.push(n),this.aniTimer.running||this.aniTimer.start()},t.prototype.addText=function(t,i,n,o,a,s,r,l,h){void 0===s&&(s=null),void 0===r&&(r=3),void 0===l&&(l=null),void 0===h&&(h=null);var c;c=this.textPool.length>0?this.textPool.shift():new e.FlyText,c.p1=o,c.p2=a,c.callBack=l,c.thisObject=h,c.setText(t,i,n,r),s||(s=e.Global.uiLayer),s.addChild(c),this.textList.push(c),this.aniTimer.running||this.aniTimer.start()},t.prototype.removeText=function(e){e.parent&&e.parent.removeChild(e),e.callBack&&e.thisObject&&e.callBack.call(e.thisObject),e.clear(),this.textPool.push(e)},t.prototype.removeMoreText=function(t){e.Global.uiLayer.contains(t)&&e.Global.uiLayer.removeChild(t),t.clear(),this.moreTextPool.push(t)},t.prototype.onTimer=function(e){this.runText()&&this.runMoreText()&&this.aniTimer.stop()},t.prototype.runText=function(){for(var e,t=this.textList.length,i=0;t>i;)e=this.textList[i],e&&e.update()?(this.textList.splice(i,1),this.removeText(e),t--):i++;return 0>=t},t.prototype.runMoreText=function(){for(var e,t=this.moreTextList.length,i=0;t>i;)e=this.moreTextList[i],e&&e.update()?(this.moreTextList.splice(i,1),this.removeMoreText(e),t--):i++;return 0>=t},t}();e.TextAniManager=t,__reflect(t.prototype,"foxgame.TextAniManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.delayTime=30,this.recieveTime=-1}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.startTick=function(){this.stage.addEventListener(egret.Event.ENTER_FRAME,this.frameHandler,this),this.requestServerTime()},e.prototype.recvMsg=function(e,t){this.updateTime=egret.getTimer(),this.recieveTime=this.updateTime;var i=(this.updateTime-this.sendTime)/1e3;this._serverTime=t.time+i/2},e.prototype.requestServerTime=function(){this.sendTime=egret.getTimer(),this.recieveTime=-1},Object.defineProperty(e.prototype,"serverTime",{get:function(){return this._serverTime+=(egret.getTimer()-this.updateTime)/1e3,this.updateTime=egret.getTimer(),Math.floor(this._serverTime)},enumerable:!0,configurable:!0}),e.prototype.setTimerParent=function(e){this.stage=e},e.prototype.frameHandler=function(e){var t=egret.getTimer();-1!=this.recieveTime&&t-this.recieveTime>=this.delayTime&&this.requestServerTime()},e}();e.TimerManager=t,__reflect(t.prototype,"foxgame.TimerManager",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){this.m_gScore=0,this.m_hScore=0,this.m_inOpen=!1,this.m_inClose=!1,this.m_tilePos=e,this.m_parent=null}return e.prototype.fScore=function(){return this.m_gScore+this.m_hScore},e.prototype.isEqual=function(e){return this.m_tilePos.x==e.m_tilePos.x&&this.m_tilePos.y==e.m_tilePos.y?!0:!1},e.prototype.isEqualByPos=function(e){return this.m_tilePos.x==e.x&&this.m_tilePos.y==e.y?!0:!1},e.prototype.setInOpen=function(e){this.m_inOpen=e},e.prototype.setInClose=function(e){this.m_inClose=e},e}();e.AstarPathStep=t,__reflect(t.prototype,"foxgame.AstarPathStep");var i=function(){function i(){this.m_closeList=new e.HashMap}return Object.defineProperty(i,"instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.findPath=function(i,n,o){this.tileMap=o;var a=!1,s=egret.getTimer();if(egret.Point.distance(i,n)<.5)return e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("You're already there! :P"),null;if(1!=o.isPass(n.x,n.y))return e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("blocf or beyond the range"),null;this.m_openList||(this.m_openList=new Array),this.m_closeList.clear();var r=new t(n),l=new t(i);l.m_hScore=this.getHValue(l,r),this.insertAndSort(l);var h;do{egret.getTimer()-s;if(h=this.m_openList.shift(),h.setInClose(!0),h.setInOpen(!1),this.m_closeList.put(h.m_tilePos.x+"_"+h.m_tilePos.y,!0),h.isEqualByPos(n)){a=!0;break}for(var c=this.getAroundsNode(h.m_tilePos),u=0,p=c.length;p>u;u++){var g=c[u],d=new t(g),f=this.getGValue(h,d),m=this.getHValue(r,d);1==d.m_inOpen?f<d.m_gScore&&(d.m_gScore=f,d.m_hScore=m,d.m_parent=h,this.findAndSort(d)):(d.m_gScore=f,d.m_hScore=m,d.m_parent=h,this.insertAndSort(d))}}while(this.m_openList.length>0);if(a){var y=this.createPath(h);return this.m_openList.length=0,this.m_closeList.clear(),y}return this.m_openList.length=0,this.m_closeList.clear(),null},i.prototype.createPath=function(e){var t=new Array;do{if(null!=e.m_parent){var i=e.m_tilePos;t.push(i)}e=e.m_parent}while(null!=e);return t&&t.length&&t.reverse(),t},i.prototype.findAndSort=function(e){var t=this.m_openList.length;if(!(1>t))for(var i=e.fScore(),n=0;t>n;n++){var o=this.m_openList[n];0==e.isEqual(o)&&(i<=o.fScore()&&this.m_openList.splice(n,0,e),e.isEqual(o)&&this.m_openList.splice(n,1))}},i.prototype.getGValue=function(e,t){var n=e.m_tilePos,o=t.m_tilePos,a=0;return a=n.y==o.y?e.m_gScore+i.COST_HORIZONTAL:n.y+2==o.y||n.y-2==o.y?e.m_gScore+2*i.COST_VERTICAL:e.m_gScore+i.COST_DIAGONAL},i.prototype.getAroundsNode=function(e){var t=new Array,i=new egret.Point;i.x=e.x-1+e.y%2,i.y=e.y+1,this.isWalkable(i)&&0==this.isInClosed(i)&&t.push(i);var n=new egret.Point;n.x=e.x+e.y%2,n.y=e.y-1,this.isWalkable(n)&&0==this.isInClosed(n)&&t.push(n);var o=new egret.Point;o.x=e.x,o.y=e.y+2,this.isWalkable(o)&&0==this.isInClosed(o)&&t.push(o);var a=new egret.Point;a.x=e.x-1,a.y=e.y,this.isWalkable(a)&&0==this.isInClosed(a)&&t.push(a);var s=new egret.Point;s.x=e.x+1,s.y=e.y,this.isWalkable(s)&&0==this.isInClosed(s)&&t.push(s);var r=new egret.Point;r.x=e.x,r.y=e.y-2,this.isWalkable(r)&&0==this.isInClosed(r)&&t.push(r);var l=new egret.Point;l.x=e.x-1+e.y%2,l.y=e.y-1,this.isWalkable(l)&&0==this.isInClosed(l)&&t.push(l);var h=new egret.Point;return h.x=e.x+e.y%2,h.y=e.y+1,this.isWalkable(h)&&0==this.isInClosed(h)&&t.push(h),t},i.prototype.isInClosed=function(e){return this.m_closeList.get(e.x+"_"+e.y)?!0:!1},i.prototype.isWalkable=function(e){return this.tileMap.isPass(e.x,e.y)?!0:!1},i.prototype.getHValue=function(e,t){var n=t.m_tilePos.x*i.COST_HORIZONTAL+Math.floor(t.m_tilePos.y)%2*i.COST_HORIZONTAL/2,o=e.m_tilePos.x*i.COST_HORIZONTAL+Math.floor(e.m_tilePos.y)%2*i.COST_HORIZONTAL/2;return Math.abs(o-n)+Math.abs(e.m_tilePos.y-t.m_tilePos.y)*i.COST_VERTICAL},i.prototype.insertAndSort=function(e){e.setInOpen(!0);var t=e.fScore(),i=this.m_openList.length;if(0==i)this.m_openList.push(e);else for(var n=0,o=void 0;i>n;){if(o=this.m_openList[n],t<=o.fScore())return void this.m_openList.splice(n,0,e);n++}},i.prototype.judgeNextDirection=function(t,i){var n=new egret.Point(t.x-1,t.y);if(egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_LEFT;if(n.x=t.x,n.y=t.y-2,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_UP;if(n.x=t.x+1,n.y=t.y,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_RIGHT;if(n.x=t.x,n.y=t.y+2,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_DOWN;if(n.x=t.x-1+t.y%2,n.y=t.y-1,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT;if(n.x=t.x+t.y%2,n.y=t.y-1,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT;if(n.x=t.x+t.y%2,n.y=t.y+1,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT;if(n.x=t.x-1+t.y%2,n.y=t.y+1,egret.Point.distance(n,i)<.1)return e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT;var o=Math.atan2(t.y-i.y,t.x-i.x),a=180*o/Math.PI;return 20>=a&&a>=-20?e.EnumManager.DIRECTION_ENUM.DIR_LEFT:110>=a&&a>=70?e.EnumManager.DIRECTION_ENUM.DIR_UP:-170>=a||a>=170?e.EnumManager.DIRECTION_ENUM.DIR_RIGHT:-70>=a&&a>=-110?e.EnumManager.DIRECTION_ENUM.DIR_DOWN:70>a&&a>20?e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT:170>a&&a>110?e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT:-110>a&&a>-170?e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT:-20>a&&a>-70?e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT:e.EnumManager.DIRECTION_ENUM.DIR_DOWN},i.COST_HORIZONTAL=20,i.COST_VERTICAL=10,i.COST_DIAGONAL=12,i}();e.Astar=i,__reflect(i.prototype,"foxgame.Astar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=e.LoadMapPicManager,i=function(){function e(){this.image=null}return e.prototype.setImageTexture=function(e,i){if(e.source==i&&""!=i||""==i&&t.instance.removeFromLoadList(this),this.image=e,this.name=i,e.source==i&&""!=i){var n=!1;return RES.isGroupLoaded(i)||(n=!0),RES.getRes(i)||(n=!0),n&&RES.hasRes(this.name)&&t.instance.setImageAsync(this),0==e.visible&&(n=!0),void(e.visible=!0)}if(""==i){var o=e.source;return e.source="",e.visible=!1,void(o&&t.instance.destroyMapPicRes(""+o))}e.visible=!0;var a=t.instance;a.isResLoaded(this.name)?a.setImage(this):RES.hasRes(this.name)&&a.setImageAsync(this)},e}();e.MapPic=i,__reflect(i.prototype,"foxgame.MapPic")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(e){this.lineScene=new egret.Sprite,this.pointScene=new egret.Sprite,this.TILE_WIDTH=0,this.TILE_HEIGHT=0,this.MAP_WITDTH=0,this.MAP_HEIGHT=0,this.MAP_X=0,this.MAP_Y=0,this.mapData=null;for(var t=0,i=e.length;i>t;t++){var n=e[t];this.TILE_WIDTH=~~n.TileWidth,this.TILE_HEIGHT=~~n.TileHeight,this.MAP_WITDTH=~~n.MapWidth,this.MAP_HEIGHT=~~n.MapHeight,this.MAP_X=~~n.X,this.MAP_Y=~~n.Y;for(var o=n.data,a=new Array,s=o.split(","),r=0,l=0;l<this.MAP_Y;l++){a[l]=new Array;for(var h=0;h<this.MAP_X;h++)r>=s.length?a[l][h]=0:a[l][h]=s[r].trim(),r+=1}this.data=a,this.objectData=n.object}}return t.prototype.dispose=function(){this.TILE_WIDTH=0,this.TILE_HEIGHT=0,this.MAP_WITDTH=0,this.MAP_HEIGHT=0,this.data=null},t.prototype.isPass=function(t,i){try{var n=this.MAP_X,o=this.MAP_Y;return 0>t||t>=n||0>i||i>=o?!1:this.data[i][t]!=e.TiledMap.PATH_BARRIER?!0:!1}catch(a){return egret.warn("in IsPass "+a.toString()),!1}},t.prototype.isOpacity=function(t,i){var n=this.MAP_X,o=this.MAP_Y;return 0>t||t>=n||0>i||i>=o?!1:this.data[i][t]==e.TiledMap.PATH_TRANSLUCENCE},t.prototype.isSafeArea=function(t,i){var n=this.MAP_X,o=this.MAP_Y;return 0>t||t>=n||0>i||i>=o?!1:this.data[i][t]==e.TiledMap.PATH_SAFE_AREA},t.prototype.SpaceToTiled=function(t){var i=Math.floor(2*t.y/this.TILE_HEIGHT)*this.TILE_HEIGHT/2,n=Math.floor(2*t.x/this.TILE_WIDTH)*this.TILE_WIDTH/2;if(!e.Global.isRelease){var o=new egret.Shape;o.graphics.lineStyle(2,16711935),o.graphics.drawCircle(0,0,2),o.graphics.endFill();var a=new egret.TextField;a.text=n+","+i,a.x=n,a.y=i,this.pointScene.addChild(a),o.x=n,o.y=i,this.pointScene.addChild(o)}var s=new egret.Point,r=new egret.Point;if(Math.floor(2*t.y/this.TILE_HEIGHT)%2==0&&Math.floor(2*t.x/this.TILE_WIDTH)%2==0||Math.floor(2*t.y/this.TILE_HEIGHT)%2==1&&Math.floor(2*t.x/this.TILE_WIDTH)%2==1){if(!e.Global.isRelease){var l=new egret.Shape;l.graphics.lineStyle(2,16777215),l.graphics.drawCircle(0,0,2),l.graphics.endFill(),l.x=n+this.TILE_WIDTH/2,l.y=i+this.TILE_HEIGHT/2,this.pointScene.addChild(l)}s.x=n,s.y=i,r.x=n+this.TILE_WIDTH/2,r.y=i+this.TILE_HEIGHT/2}else{if(!e.Global.isRelease){var l=new egret.Shape;l.graphics.lineStyle(2,16777215),l.graphics.drawCircle(0,0,2),l.graphics.endFill(),l.x=n,l.y=i+this.TILE_HEIGHT/2,this.pointScene.addChild(l);var h=new egret.Shape;h.graphics.lineStyle(2,16777215),h.graphics.drawCircle(0,0,2),h.graphics.endFill(),h.x=n+this.TILE_WIDTH/2,h.y=i,this.pointScene.addChild(h)}s.x=n,s.y=i+this.TILE_HEIGHT/2,r.x=n+this.TILE_WIDTH/2,r.y=i}if(egret.Point.distance(s,t)<=egret.Point.distance(r,t)){if(!e.Global.isRelease){var o=new egret.Shape;o.graphics.lineStyle(2,16777215),o.graphics.drawCircle(0,0,2),o.graphics.endFill(),o.x=s.x,o.y=s.y,this.pointScene.addChild(o)}return new egret.Point(Math.round(s.x/this.TILE_WIDTH)-1,2*s.y/this.TILE_HEIGHT-1)}if(!e.Global.isRelease){var o=new egret.Shape;o.graphics.lineStyle(2,16777215),o.graphics.drawCircle(0,0,2),o.graphics.endFill(),o.x=r.x,o.y=r.y,this.pointScene.addChild(o)}return new egret.Point(Math.round(r.x/this.TILE_WIDTH)-1,2*r.y/this.TILE_HEIGHT-1)},t.prototype.TiledToSpace=function(e){var t=this.TILE_HEIGHT*(e.y+1)/2,i=(e.x+e.y%2/2+.5)*this.TILE_WIDTH;return new egret.Point(i,t)},t.prototype.drawTile=function(){for(var e=this.TILE_HEIGHT/2,t=this.TILE_WIDTH/2,i=Math.round(this.MAP_HEIGHT/this.TILE_HEIGHT*2),n=0;i>n;n++)this.line_A(t,0,0,e),this.line_A(0,this.MAP_HEIGHT-e,t,this.MAP_HEIGHT),e+=this.TILE_HEIGHT,t+=this.TILE_WIDTH},t.prototype.line_A=function(e,t,i,n){var o=new egret.Shape;o.graphics.lineStyle(1,65280),o.graphics.moveTo(e,t),o.graphics.lineTo(i,n),o.graphics.endFill(),this.lineScene.addChild(o)},t.prototype.drawPo=function(){for(var t=0;t<this.MAP_Y;t++)for(var i=0;i<this.MAP_X;i++){var n=this.data[t][i];if(~~n!=e.TiledMap.PATH_PASS){var o=new egret.Shape;~~n==e.TiledMap.PATH_BARRIER&&o.graphics.lineStyle(2,16711680),~~n==e.TiledMap.PATH_TRANSLUCENCE&&o.graphics.lineStyle(2,255),~~n==e.TiledMap.PATH_SAFE_AREA&&o.graphics.lineStyle(2,65280),o.graphics.drawCircle(0,0,6),o.graphics.endFill();var a=this.TiledToSpace(new egret.Point(i,t));o.x=a.x,o.y=a.y,this.pointScene.addChild(o)}}},t.PATH_UNKNOWN=-1,t.PATH_PASS=0,t.PATH_BARRIER=1,t.PATH_TRANSLUCENCE=2,t.PATH_SAFE_AREA=3,t}();e.TiledMap=t,__reflect(t.prototype,"foxgame.TiledMap")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.loadedGroups=[],this.loadList=[],this.aniFactoryMap=new e.HashMap,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.loadComplete,this),this.toDestroyResIdMap=new e.HashMap,this.usingResFoxAniMap=new e.HashMap,egret.startTick(this.onTickDestroyRes,this)}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onTickDestroyRes=function(e){for(var t=egret.getTimer(),i=this.toDestroyResIdMap.keys(),n=i.length,o=0;n>o;o++){var a=this.toDestroyResIdMap.get(i[o]);t>=a&&this.isNoUsingInResFoxAniMap(i[o])&&(this.removeAniFactory(i[o]),this.destroyAniRes(i[o]))}return i=null,!1},t.prototype.pushToDestroyQueue=function(e,t,i){if(i&&i.resId){this.removeFromUsingResFoxAniMap(i);var n=this.toDestroyResIdMap.get(e),o=egret.getTimer()+t;n?o>n&&this.toDestroyResIdMap.put(e,o):this.toDestroyResIdMap.put(e,o)}},t.prototype.getAniFactory=function(e){var t=e.resId,i=this.aniFactoryMap.get(t);if(!i){var n=RES.getRes(t+"_json"),o=RES.getRes(t+"_png");i=new egret.MovieClipDataFactory(n,o),e.aniCache&&this.aniFactoryMap.put(t,i)}return i},t.prototype.removeAniFactory=function(t){var i=this.aniFactoryMap.remove(t);i&&e.GlobalUtil.cleanUpMovieClipDataFactoryTested(i),i=null},t.prototype.getAniData=function(e){return this.getAniFactory(e).generateMovieClipData(e.mcName)},t.prototype.isResLoaded=function(e){var t=e+"_png",i=e+"_json";return RES.getRes(t)&&RES.getRes(i)},t.prototype.loadAniRes=function(t,i){if(void 0===i&&(i=e.Global.LoadFoxAniResPriority),-1==this.loadedGroups.indexOf(t)){var n=t+"_png",o=t+"_json";RES.createGroup(t,[n,o]),this.loadedGroups.push(t),RES.loadGroup(t,i)}this.toDestroyResIdMap.remove(t)},t.prototype.destroyAniRes=function(t){var i=this.loadedGroups.indexOf(t);i>-1&&this.loadedGroups.splice(i,1),e.GlobalUtil.destroyGroup(t),egret.warn("Fox AniManager destroyAniRes, resId: "+t),this.toDestroyResIdMap.remove(t)},t.prototype.addToUsingResFoxAniMap=function(e){var t=e.resId;if(t){this.toDestroyResIdMap.remove(t);var i=this.usingResFoxAniMap.get(t);if(i){var n=i.indexOf(e.hashCode);if(n>=0)return;i.push(e.hashCode)}else i=[],i.push(e.hashCode),this.usingResFoxAniMap.put(t,i)}},t.prototype.removeFromUsingResFoxAniMap=function(e){var t=e.resId,i=this.usingResFoxAniMap.get(t);if(i){var n=i.indexOf(e.hashCode);return n>=0?void i.splice(n,1):void egret.warn("removeFromUsingResFoxAniMap hashcode not exist in hashcodeArray, resId:"+t+", hashcode:"+e.hashCode)}egret.warn("removeFromUsingResFoxAniMap resId not exist in usingResFoxAniMap, resId:"+t)},t.prototype.isNoUsingInResFoxAniMap=function(e){var t=!1,i=this.usingResFoxAniMap.get(e);return i?0==i.length&&(this.usingResFoxAniMap.remove(e),i=null,t=!0):egret.warn("isNoUsingInResFoxAniMap resId not exist in usingResFoxAniMap, resId:"+e),t},t.prototype.play=function(e){if(e.resId){this.addToUsingResFoxAniMap(e),e.mcObject.movieClipData=this.getAniData(e);e.startPlay()}},t.prototype.playAsync=function(e){if(e.resId){this.addToUsingResFoxAniMap(e);var t=this.loadList.indexOf(e);0>t&&this.loadList.push(e),this.loadAniRes(e.resId,e.resGroupLoadPriority)}},t.prototype.loadComplete=function(e){for(var t,i=this.loadList.length,n=0;i>n;)t=this.loadList[n],t.resId!=e.groupName?n++:(this.play(t),this.loadList.splice(n,1),i--)},t.prototype.removeFA=function(e){for(var t=0;t<this.loadList.length;t++)if(this.loadList[t].hashCode==e.hashCode)return void this.loadList.splice(t,1)},t.prototype.getSimpleDebugInfo=function(){var e="",t=this.usingResFoxAniMap.keys();for(var i in t)e=e+t[i]+" ";return e},t}();e.AniManager=t,__reflect(t.prototype,"foxgame.AniManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e,t){this.data=e,this.spriteSheet=new egret.SpriteSheet(t)}return e.prototype.getTextureByFrame=function(e,t){var i=this.data.actions[e].frames[t];return this.getTexture(i)},e.prototype.getTexture=function(e){var t=this.spriteSheet.getTexture(e);if(!t){var i=this.data.frames[e];t=this.spriteSheet.createTexture(e,i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH)}return t},e.prototype.totalFrame=function(e){return this.data.actions[e].totalFrame},e.prototype.dispose=function(){this.data=null,this.spriteSheet=null},e}();e.AnimationCache=t,__reflect(t.prototype,"foxgame.AnimationCache",["foxgame.IDispose"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.BAYESHENGYA=0]="BAYESHENGYA",e[e.ZHUANGBEIDUANZAO=1]="ZHUANGBEIDUANZAO",e[e.YUYIJINJI=2]="YUYIJINJI",e[e.JINENG=3]="JINENG",e[e.BAOSHI=4]="BAOSHI",e[e.TEJIE=5]="TEJIE",e[e.SHENQI=6]="SHENQI",e[e.BAYEZHUANGBEI=7]="BAYEZHUANGBEI"}(t=e.AchievementTap||(e.AchievementTap={}));var i=function(){function t(){this.completeNum=0,this.unCompleteNum=0,this.model=new e.AchievementModel,this.panel=new e.AchievementPanel(this.model)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ACHIEVEMENT_INFO_S:this.model.isShowRedTip=void 0,this.model.initData(),this.achievementDataHandler(i),this.sortDataAry(),this.playEffect(),this.model.itemDataArySetCom(),e.ActivityBarController.getInstance().setAchievementRedTipVisible();break;case e.Code.ACHIEVEMENT_AWARD_S:break;case e.Code.ACHIEVEMENT_ONE_AWARD_S:}},t.prototype.achievementDataHandler=function(e){for(var t=e.getAchieveList().length,i=0;t>i;i++){var n=e.getAchieveList()[i],o=n.getModuelType()-1;!this.model.targetTypeProgress[n.targetType]&&n.targetType&&(this.model.targetTypeProgress[n.targetType]=n.progress),void 0==this.model.itemDataAry[o]&&(this.model.itemDataAry[o]=[]),-2!=n.nextTargetId&&this.findNineAchievement(e,n)}},t.prototype.findNineAchievement=function(t,i){for(var n=e.JsonDataManager.instance.achievement,o=0,a=0;100>=a;a++){var s=i.nextTargetId+a,r=this.model.targetTypeProgress[i.targetType];if(!n[s])break;if(!(Number(r)>=Number(n[s].cond)&&this.completeNum<5)){this.completeNum=0,o=a;break}this.completeNum++,1==this.completeNum&&(n[s]._serverSouce=!0);var l=n[s].moduleType-1;n[s]._state=1,this.model.itemDataAry[l].push(n[s]),void 0==this.model.isShowRedTip&&(this.model.isShowRedTip=!0)}for(var a=o;100>=a;a++){var s=i.nextTargetId+a,r=this.model.targetTypeProgress[i.targetType];if(!n[s])break;if(Number(r)<Number(n[s].cond)&&this.unCompleteNum<5){this.unCompleteNum++;var l=n[s].moduleType-1;n[s]._state=0,this.model.itemDataAry[l].push(n[s])}else if(this.unCompleteNum>=5){this.unCompleteNum=0;break}}},t.prototype.isShowRedTip=function(){return this.model.isShowRedTip},t.prototype.playEffect=function(){var e=this.model.itemDataAry.length;this.model.canPlay=!1;for(var t=0;e>t;t++)this.model.itemDataAry[t]&&this.model.itemDataAry[t][0]&&this.model.itemDataAry[t][0]._state&&(this.model.canPlay=!0)},t.prototype.sortDataAry=function(){for(var e=this.model.itemDataAry.length,t=0;e>t;t++){for(var i=this.model.itemDataAry[t],n=this.model.itemDataAry[t].length,o=[],a=[],s=0;n>s&&i[s];s++)i[s]._serverSouce?(o.push(i[s]),i.splice(s,1),s--):i[s]._state&&!i[s]._serverSouce&&(a.push(i[s]),i.splice(s,1),s--);this.model.itemDataAry[t]=o.concat(a,i)}},t.prototype.getCanPlay=function(){return this.model.canPlay},t.prototype.showPanel=function(e){void 0===e&&(e=0),App.LittleLoading().showLoading("AchievementController"),this.initItemListSource(e),this.panel.show(),App.LittleLoading().hideLoading("AchievementController")},t.prototype.getPanel=function(){return this.panel},t.prototype.initItemListSource=function(e){void 0===e&&(e=0),this.model.currentItemIndex=e;var t=e,i=this.model;i.itemDataAry[t].length;i.itemListAryCollection.source=i.itemDataAry[t],i.itemListAryCollection.refresh()},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t}();e.AchievementController=i,__reflect(i.prototype,"foxgame.AchievementController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.sendReqLastTime=0,e.timeout=200,e.skinName="ChengjiuItemSkin",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.getReward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.receiveReward,this),this.getReward0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.receiveReward,this),this.getReward1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onkeyGetHanlder,this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showTip,this)},i.prototype.showTip=function(){e.TipsController.getInstance().showItemTips(this.id,this.num)},i.prototype.receiveReward=function(t){var i=egret.getTimer(),n=i-this.sendReqLastTime;if(!(n<this.timeout)){this.sendReqLastTime=i;var o=HawkProtocolManager.newBuilder("JsProto.GetAchievementAwardReq");o.setTargetId(Number(this.achievementId)),e.Message.instance.send(e.Code.ACHIEVEMENT_AWARD_C,o,!0);var a=this.item.localToGlobal(),s=a;e.FlyController.getInstance().flyToBag(s,this.id)}},i.prototype.onkeyGetHanlder=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetAchievementOneWardReq");i.setModuleType(Number(this.moduleType)),e.Message.instance.send(e.Code.ACHIEVEMENT_ONE_AWARD_C,i,!0)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.getReward0.visible=!1,this.getReward1.visible=!1,this.rechargeAniGroup.visible=!1;var i,n=e.JsonDataManager.instance.achievement,o=(e.JsonDataManager.instance.itemTemplate,this.data),a=o.nextTargetId?o.nextTargetId:o.id,s=n[a];o.prigress&&(e.AchievementController.getInstance().model.currentProgress=o.prigress),this.showCurrentState(o._state),o._serverSouce&&(this.getReward.visible=!0,this.getReward.enabled=!0,this.completeLogo.visible=!1),this.achievementId=a,this.condition.text=s.name,i=s.award,this.moduleType=s.moduleType,this.id=Number(i[1]),this.num=Number(i[2]),this.item.setItem(Number(i[1]),Number(i[2]),!0,!1),this.getReward.visible==this.getReward.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1),this.data.quick&&this.showOnKeyGet()},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(console.log(this.rechargeAniGroup.visible),this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.showCurrentState=function(e){switch(e){case 0:this.unReceiveLogo.visible=!1,this.unCompleteLogo.visible=!0,this.completeLogo.visible=!1,this.getReward.visible=!1;break;case 1:this.unReceiveLogo.visible=!1,this.completeLogo.visible=!0,this.unCompleteLogo.visible=!1,this.getReward.visible=!1}},i.prototype.showOnKeyGet=function(){this.getReward0.visible=!0,this.getReward1.visible=!0,this.getReward.visible=!1,this.unCompleteLogo.visible=!1,this.completeLogo.visible=!1,this.unReceiveLogo.visible=!1,this.rechargeAniGroup.visible=!1},i}(eui.ItemRenderer);e.AchievementItem=t,__reflect(t.prototype,"foxgame.AchievementItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.observerList=[],this.itemListAryCollection=new eui.ArrayCollection,this.itemDataAry=[],this.itemHeight=129,this.itemVSpace=5,this.targetTypeProgress={},this.selecIconPosY=0,this.currentItemIndex=0,this.canPlay=!1}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.initData=function(){this.itemDataAry=[],this.targetTypeProgress={}},e.prototype.itemDataArySetCom=function(){this.updateView()},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e}();e.AchievementModel=t,__reflect(t.prototype,"foxgame.AchievementModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/chengjiu/ChengjiuSkin.exml","chengjiu")||this;return i.model=e,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.refresh=function(){this.ui.currency.refresh(),this.initRedTips(),this.updateList(),this.showRedTip()},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.itemList.dataProvider=this.model.itemListAryCollection,this.ui.itemList.itemRenderer=e.AchievementItem,this.ui.itemScroller.verticalScrollBar.autoVisibility=!1,this.ui.topScroller.horizontalScrollBar.autoVisibility=!1,this.ui.topScroller.verticalScrollBar.autoVisibility=!1,this.ui.topScroller.scrollPolicyV="ScrollPolicy.OFF",this.ui.topScroller.bounces=!1,this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeView,this),this.ui.turnLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftBtnClick,this),this.ui.turnRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightBtnClick,this);for(var t=0,i=this.getItemsAry().length;i>t;)this.getItemsAry()[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeList,this),t++;this.doScreenAdaptation()},i.prototype.closeHook=function(){this.scaleX=this.scaleY=1,this.x=this.y=0},i.prototype.closeView=function(){this.backHandler()},i.prototype.initRedTips=function(){for(var e=this.getRedTips().length,t=0;e>t;t++){var i=this.getRedTips()[t];i.visible=!1}},i.prototype.showRedTip=function(){for(var e=this.model.itemDataAry.length,t=0;e>t;t++){var i=this.model.itemDataAry[t];i[0]&&1==i[0]._state&&(this.getRedTips()[t].visible=!0)}},i.prototype.leftBtnClick=function(){this.ui.topScroller.viewport.scrollH=0},i.prototype.rightBtnClick=function(){this.model.lastPos||(this.model.lastPos=this.ui.item7.x+this.ui.item7.width),this.ui.topScroller.viewport.scrollH=this.model.lastPos-this.ui.topScroller.width},i.prototype.changeList=function(e){var t=e.target;this.getItemsAry()[this.model.currentItemIndex].enabled=!0,t.enabled=!1,this.ui.itemScroller.stopAnimation(),this.ui.itemScroller.viewport.scrollV=0;var i=this.getItemsAry().indexOf(e.target);this.model.itemDataAry[i]&&this.refreshList(i)},i.prototype.initParams=function(){this.initBtnState(),this.getItemsAry()[this.model.currentItemIndex].enabled=!1,this.ui.topScroller.viewport.scrollH=0},i.prototype.initBtnState=function(){for(var e=this.getItemsAry().length,t=0;e>t;t++){var i=this.getItemsAry()[t];i.enabled=!0}},i.prototype.updateList=function(){var e=this.model.currentItemIndex;this.refreshList(e)},i.prototype.refreshList=function(e){for(var t=this.model.itemDataAry[e].length,i=0;t>i;i++)0==i&&t>1&&1==this.model.itemDataAry[e][1]._state?this.model.itemDataAry[e][i].quick=!0:this.model.itemDataAry[e][i].quick=!1;this.model.itemListAryCollection.source=this.model.itemDataAry[e],this.model.currentItemIndex=e,this.model.itemListAryCollection.refresh()},i.prototype.readyDestroy=function(){this.ui.itemList.dataProvider=null},i.prototype.getItemsAry=function(){var e=[this.ui.item0,this.ui.item1,this.ui.item2,this.ui.item3,this.ui.item4,this.ui.item5,this.ui.item6,this.ui.item7];return e},i.prototype.getRedTips=function(){var e=[this.ui.redTip0,this.ui.redTip1,this.ui.redTip2,this.ui.redTip3,this.ui.redTip4,this.ui.redTip5,this.ui.redTip6,this.ui.redTip7];return e},i}(e.BasePanel);e.AchievementPanel=t,__reflect(t.prototype,"foxgame.AchievementPanel",["foxgame.IAchievement","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.AchievementVO=t,__reflect(t.prototype,"foxgame.AchievementVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.aniList=[],this.loadList=[],this.aniCacheMap=new e.HashMap,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.loadComplete,this),egret.startTick(this.tickHandler,this)}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.addAni=function(e){var t=this.isAniRes(e);return t&&-1==this.aniList.indexOf(e)&&this.aniList.push(e),t},t.prototype.getAnimationCache=function(t){var i=this.aniCacheMap.get(t);if(!i){var n=RES.getRes(t+"_json"),o=RES.getRes(t+"_png");i=new e.AnimationCache(n,o),this.aniCacheMap.put(t,i)}return i},t.prototype.removeAni=function(e){var t=this.aniList.indexOf(e);t>-1&&this.aniList.splice(t,1),t=this.loadList.indexOf(e),t>-1&&this.loadList.splice(t,1)},t.prototype.isAniRes=function(e){var t=e.resId(),i=t+"_png",n=t+"_json";return RES.getRes(i)&&RES.getRes(n)?!0:(RES.hasRes(t+"Group")||RES.createGroup(t+"Group",[i,n]),RES.loadGroup(t+"Group"),this.loadList.push(e),!1)},t.prototype.tickHandler=function(e){for(var t=this.aniList.length,i=0;t>i;)this.aniList[i].state()?(this.aniList[i].advanceTime(e),i++):(this.removeAni(this.aniList[i]),t--);return!0},t.prototype.loadComplete=function(e){for(var t,i=this.loadList.length,n=0;i>n;)t=this.loadList[n],t.resId()+"Group"!=e.groupName?n++:(t.complete(),this.loadList.splice(n,1),i--,this.aniList.push(t))
},t}();e.AnimationManager=t,__reflect(t.prototype,"foxgame.AnimationManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=e.stageId,this.sum=e.sum,this.awards=e.awards},e}();e.AccRecharge2VO=t,__reflect(t.prototype,"foxgame.AccRecharge2VO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=parseInt(e.stageId),this.sum=parseInt(e.level),this.awards=e(e.awards)},e}();e.AccRechargeVO=t,__reflect(t.prototype,"foxgame.AccRechargeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e.id),this.activityId=e.activityId,this.stageId=parseInt(e.stageId),this.startTime=e.startTime,this.endTime=e.endTime,this.closeTime=e.closeTime,this.serverid=e.serverid,this.openPlace=parseInt(e.openPlace),this.ImgSource=e(e.ImgSource)},e}();e.ActivityTimeVO=t,__reflect(t.prototype,"foxgame.ActivityTimeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=e.stageId,this.day=parseInt(e.day),this.awards=e(e.awards)},e}();e.ContinueRechargeVO=t,__reflect(t.prototype,"foxgame.ContinueRechargeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.level=parseInt(e.level),this.awards=e(e.awards)},e}();e.GrowFundVO=t,__reflect(t.prototype,"foxgame.GrowFundVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=e.stageId,this.days=parseInt(e.days),this.buyCount=parseInt(e.buyCount),this.originalPrice=parseInt(e.originalPrice),this.presentPrice=parseInt(e.presentPrice),this.awards=e(e.awards)},e}();e.NationalWelfareVO=t,__reflect(t.prototype,"foxgame.NationalWelfareVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=e.stageId,this.days=parseInt(e.days),this.buyCount=parseInt(e.buyCount),this.originalPrice=parseInt(e.originalPrice),this.presentPrice=parseInt(e.presentPrice),this.awards=e(e.awards)},e}();e.OpenServerGiftVO=t,__reflect(t.prototype,"foxgame.OpenServerGiftVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=e.stageId,this.ranking=parseInt(e.days),this.awards=e(e.awards)},e}();e.RechargeRankingsVO=t,__reflect(t.prototype,"foxgame.RechargeRankingsVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeRebateVO=t,__reflect(t.prototype,"foxgame.RechargeRebateVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.activityId=parseInt(e.activityId),this.rank=parseInt(e.rank),this.days=parseInt(e.days),this.awards=e(e.awards),this.type=parseInt(e.type),this.titleIcon=e.titleIcon},e}();e.StandardAcRankAwardVO=t,__reflect(t.prototype,"foxgame.StandardAcRankAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.awards=[]}return e.prototype.init=function(e){this.id=parseInt(e.id),this.stageId=parseInt(e.stageId),this.days=parseInt(e.days),this.targetType=parseInt(e.targetType),this.cond=parseInt(e.cond),this.imgSource=e.imgSource,this.awards=e(e.awards)},e}();e.StandardActivityVO=t,__reflect(t.prototype,"foxgame.StandardActivityVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ActivityHuiKuiButtonViewSkin",t}return __extends(t,e),t.prototype.initUI=function(){},t.prototype.setImg=function(e){switch(e){case"kuanghuan":this.icon.source="quanminkuanghuan_png";break;case"leichong":this.icon.source="meirileichong_png";break;case"libao":this.icon.source="xiangoulibao_png";break;case"zaixian":this.icon.source="zaixianjiangli_png"}},t.prototype.setRedVis=function(e){this.redPoint.visible=e},t.prototype.setLiang=function(e){this.liang.visible=e},t}(eui.Component);e.ActivityHuiKuiButtonView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiButtonView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.awardData=[],e.skinName="ActivityHuiKuiQuanMinKuangHuanItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data;var t=this.currentData.getAwards(),i=t.split(","),n=i.length;this.awardData=[];var o=0;for(o;n>o;o++){var a=new e.AttributeVO(i[o]);if(a){var s=this["item_"+(o+1)];s&&(s.setItem(a.id,a.value,!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.awardData.push(a),s.visible=!0)}}for(o;4>o;o++){var s=this["item_"+(o+1)];s&&(s.visible=!1)}this.currentData.getIsAward()?(this.lingquBtn.visible=!1,this.lingquImg.visible=!0):this.currentData.getCond()<=this.currentData.getProgress()?(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.enabled=!0,this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)):(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.enabled=!1);var r=this.currentData.getTargetType(),l="";switch(r){case 6:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANZHANLISTAR",this.currentData.getCond());break;case 8:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANZHANLISHENGXING",this.currentData.getCond());break;case 12:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANYEWAI",this.currentData.getCond());break;case 39:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANDENGLU",this.currentData.getCond());break;case 40:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANXUNBAO",this.currentData.getCond());break;case 41:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANZHANLIWING",this.currentData.getCond());break;case 42:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANZHANLIHONGZHUANG",this.currentData.getCond());break;case 43:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANZHANLIGEM",this.currentData.getCond());break;case 44:l=e.LanguageUtils.instance.getValue("HUIKUI_KUANGHUANZHANLIYEWAIWIN",this.currentData.getCond())}l+=" ("+this.currentData.getProgress()+"/"+this.currentData.getCond()+")",this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(l),this.lingquBtn.visible&&this.lingquBtn.enabled?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_1:i=this.awardData[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.awardData[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.awardData[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.awardData[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByHuiKuiKuangHuanGetAward(this.currentData.getCfgId())},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i}(eui.ItemRenderer);e.ActivityHuiKuiKuangHuanItemView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiKuangHuanItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.currentScene=0,i.skinName="ActivityHuiKuiQuanMinKuangHuanViewSkin",i._isShow=!1,i.issTop=!1,i.currentData=null,i._model=e,i}return __extends(i,t),i.getIntance=function(t){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i(t),this._intance},i.prototype.initP=function(){this._isShow=!1,this.issTop=!1,this.currentData=null},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this.list.dataProvider=null,this.top_huodongTime.textFlow=null,this.removeChildren(),i._intance=null},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI()},i.prototype.initUI=function(){this._isShow=!0,this.currentScene=0,this.scroll&&this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1,this.scroll.viewport.scrollV=0),this.showView()},i.prototype.getIsShow=function(){return this._isShow},i.prototype.setData=function(e){this.currentData=e,this.showView()},i.prototype.showBtnSelect=function(){this.dengluImg.visible=!1,this.xunbaoImg.visible=!1,this.zhanliImg.visible=!1,this.yewaiImg.visible=!1;var t=this.allData[this.currentScene],i=0,n=t.length,o=[],a=[];for(i;n>i;i++){var s=t[i];s.getIsAward()?o.push(s):a.push(s)}t=a.concat(o);var r=this.list;switch(this.currentScene){case 0:this.dengluImg.visible=!0,r.dataProvider=this._model.collection_HuiKuikuanghuan_denglu,r.itemRenderer=e.ActivityHuiKuiKuangHuanItemView,this._model.dataSource_HuiKuikuanghuan_denglu=t,this._model.collection_HuiKuikuanghuan_denglu.replaceAll(this._model.dataSource_HuiKuikuanghuan_denglu);break;case 1:r.dataProvider=this._model.collection_HuiKuikuanghuan_xunbao,r.itemRenderer=e.ActivityHuiKuiKuangHuanItemView,this._model.dataSource_HuiKuikuanghuan_xunbao=t,this._model.collection_HuiKuikuanghuan_xunbao.replaceAll(this._model.dataSource_HuiKuikuanghuan_xunbao),this.xunbaoImg.visible=!0;break;case 2:r.dataProvider=this._model.collection_HuiKuikuanghuan_zhanli,r.itemRenderer=e.ActivityHuiKuiKuangHuanItemView,this._model.dataSource_HuiKuikuanghuan_zhanli=t,this._model.collection_HuiKuikuanghuan_zhanli.replaceAll(this._model.dataSource_HuiKuikuanghuan_zhanli),this.zhanliImg.visible=!0;break;case 3:this.yewaiImg.visible=!0,r.dataProvider=this._model.collection_HuiKuikuanghuan_yewai,r.itemRenderer=e.ActivityHuiKuiKuangHuanItemView,this._model.dataSource_HuiKuikuanghuan_yewai=t,this._model.collection_HuiKuikuanghuan_yewai.replaceAll(this._model.dataSource_HuiKuikuanghuan_yewai)}},i.prototype.initListener=function(){this.dengluBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xunbaoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.zhanliBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.yewaiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showView=function(){if(this.currentData){if(this.initListener(),this.redPointArr=[!1,!1,!1,!1],this.currentData){this.allData=[[],[],[],[]];for(var e=this.currentData.getConfigInfo(),t=e.length,i=0;t>i;i++){var n=e[i];this.allData[n.getModule()-1].push(n),n.getIsAward()||n.getCond()<=n.getProgress()&&(this.redPointArr[n.getModule()-1]=!0)}var o=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(o),this.showBtnSelect()}this.checkRed()}},i.prototype.checkRed=function(){var e=0,t=this.redPointArr.length;for(e;t>e;e++)switch(e){case 3:this.redyewai.visible=this.redPointArr[e];break;case 2:this.redzhanli.visible=this.redPointArr[e];break;case 1:this.redxunbao.visible=this.redPointArr[e];break;case 0:this.reddenglu.visible=this.redPointArr[e]}},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.onClick=function(e){switch(e.target){case this.dengluBtn:if(0==this.currentScene)return;this.currentScene=0;break;case this.xunbaoBtn:if(1==this.currentScene)return;this.currentScene=1;break;case this.zhanliBtn:if(2==this.currentScene)return;this.currentScene=2;break;case this.yewaiBtn:if(3==this.currentScene)return;this.currentScene=3}this.showBtnSelect()},i}(eui.Component);e.ActivityHuiKuiKuangHuanView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiKuangHuanView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.awardData=[],e.skinName="ActivityHuiKuiMeiRiLeiChongItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data;var t=this.currentData.getAwards(),i=t.split(","),n=i.length;this.awardData=[];var o=0;for(o;n>o;o++){var a=new e.AttributeVO(i[o]);if(a){var s=this["item_"+(o+1)];s&&(s.setItem(a.id,a.value,!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.awardData.push(a),s.visible=!0)}}for(o;4>o;o++){var s=this["item_"+(o+1)];s&&(s.visible=!1)}var r=e.ActivityController.getIntance().getModelForDaBiao().getHuiKuiLeiChongData();this.currentData.getIsAward()?(this.lingquBtn.visible=!1,this.lingquImg.visible=!0):this.currentData.getCond()<=r.getRecharge()?(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.enabled=!0,this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)):(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.enabled=!1);var l=e.LanguageUtils.instance.getValue("LEIJICHONGZHI",this.currentData.getCond());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(l),this.lingquBtn.visible&&this.lingquBtn.enabled?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_1:i=this.awardData[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.awardData[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.awardData[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.awardData[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByHuiKuiLeiChongGetAward(this.currentData.getCfgId())},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i}(eui.ItemRenderer);e.ActivityHuiKuiLeiChongJiangLiItemView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiLeiChongJiangLiItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="ActivityHuiKuiMeiRiLeiChongViewSkin",i._isShow=!1,i.issTop=!1,i.currentData=null,i._model=e,i}return __extends(i,t),i.getIntance=function(t){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i(t),this._intance},i.prototype.initP=function(){this._isShow=!1,this.issTop=!1,this.currentData=null},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this.list.dataProvider=null,this.removeChildren(),i._intance=null},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scroll&&(this.scroll.verticalScrollBar.autoVisibility=!1,this.scroll.viewport.scrollV=0),this.initUI()},i.prototype.initUI=function(){this._isShow=!0,this.showView()},i.prototype.getIsShow=function(){return this._isShow},i.prototype.setData=function(e){this.currentData=e,this.showView()},i.prototype.showView=function(){if(this.currentData&&this.currentData){var t=this.currentData.getConfigInfo(),i=e.LanguageUtils.instance.getValue("JINRIYILEIJICHONGZHI",this.currentData.getRecharge());this.rechargedTxt.textFlow=(new egret.HtmlTextParser).parser(i),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var n=this.list;n.dataProvider=this._model.collection_HuiKuiLeiChong,n.itemRenderer=e.ActivityHuiKuiLeiChongJiangLiItemView;var o=0,a=t.length,s=[],r=[];for(o;a>o;o++){var l=t[o];l.getIsAward()?s.push(l):r.push(l)}t=r.concat(s),this._model.dataSource_HuiKuiLeiChong=t,this._model.collection_HuiKuiLeiChong.replaceAll(this._model.dataSource_HuiKuiLeiChong)}},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.buyClick()}},i.prototype.buyClick=function(){e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)},i}(eui.Component);e.ActivityHuiKuiLeiChongJiangLiView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiLeiChongJiangLiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.isInit=!1,t.isDataChanged=!1,t.skinName="ActivityHuiKuiMainBtnViewSkin",t}return __extends(t,e),t.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},t.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.initUI()},t.prototype.initUI=function(){this.obj=this.data,this.vo=this.obj.vo,this.redPoint.visible=this.obj.red;var e=this.obj.select;e?this.liang.visible=!0:this.liang.visible=!1,this.icon.source=this.vo.getImgSource()+"_png",this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.onClick=function(e){var t=this.obj.callBack;t&&t(this.vo.getActivityId())},t}(eui.ItemRenderer);e.ActivityHuiKuiMainBtnView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiMainBtnView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityHuiKui/ActivityHuiKuiMainViewSkin.exml",null)||this;return i.currentScence=0,i.currentSelect=0,i.model=e,i.setIsTextureCache(!0),i.model.registerObserver(i),i.setRegisterTick(!0),i.zaixianTime=0,i.currentScence=0,i}return __extends(i,t),i.prototype.panelChanged=function(){this.changeLiang(),this.getIsShow()&&(this.checkData(),this.refreshView())},i.prototype.refreshView=function(){this.model.dataSource_bottom_huikui=this.currentShowArr,this.model.collection_bottom_huikui.replaceAll(this.model.dataSource_bottom_huikui)},i.prototype.readyDestroy=function(){for(var e=this.ui.group,t=e.numChildren,i=0;t>i;++i){var n=e.getChildAt(i);n.cleanDataDelete&&n.cleanDataDelete()}e.removeChildren(),e=null,this.currentScence=0},i.prototype.closeHook=function(){this.model.setCurrentTypeHuiKui(0)},i.prototype.initHook=function(){this.doScreenAdaptation()},i.prototype.setViewRefresh=function(e){},i.prototype.initUI=function(){var t=this.model.getListData();if(null!=t){var i=t.getActivity();if(null!=i&&0!=i.length){this.ui.scroller.scrollPolicyH=eui.ScrollPolicy.AUTO,this.ui.scroller.horizontalScrollBar.autoVisibility=!1,this.ui.scroller.scrollPolicyV=eui.ScrollPolicy.OFF;var n=new eui.TileLayout;n.requestedColumnCount=0,n.requestedRowCount=1,n.horizontalGap=0,n.verticalGap=1,n.paddingLeft=0,n.paddingRight=0,this.ui.scroller.viewport.scrollH=0;var o=this.ui.list;o.dataProvider=this.model.collection_bottom_huikui,o.itemRenderer=e.ActivityHuiKuiMainBtnView,o.layout=n,this.checkData(),0!=this.currentShowArr.length&&this.showIndexScence(this.currentShowArr[0].vo.getActivityId()),this.refreshView(),e.ActivityBarController.getInstance().setHuiKuiEffect(!1)}}},i.prototype.checkData=function(){var t=this.model.getListData(),i=t.getActivity(),n=0,o=i.length,a=[];this.currentShowArr=[];var s=this.model.getHuiKuiRedPointData();for(n;o>n;n++){var r=i[n];if(r.getOpenPlace()==e.activityListType.huikui){a.push(r);var l=new Object;switch(l.vo=r,r.getActivityId()==this.model.getCurrentTypeHuiKui()?l.select=!0:l.select=!1,r.getActivityId()){case e.ActivityHuikuiId.QUANMINKUANGHUAN:l.red=s[0];break;case e.ActivityHuikuiId.MEIRILEICHONG:l.red=s[1];break;case e.ActivityHuikuiId.XIANGOULIBAO:l.red=s[2];break;case e.ActivityHuikuiId.ZAIXIANJIANGLI:l.red=s[3]}l.callBack=this.callBack.bind(this),this.currentShowArr.push(l)}}},i.prototype.callBack=function(e){this.model.setCurrentTypeHuiKui(e),this.showIndexScence(e),this.setSelect(e)},i.prototype.setSelect=function(e){if(this.currentSelect=0,this.currentShowArr&&this.currentShowArr.length>0)for(var t=this.currentShowArr.length,i=0;t>i;i++){var n=this.currentShowArr[i],o=n.vo;o&&o.getActivityId()==e?(this.currentSelect=e,n.select=!0):n.select=!1}this.refreshView()},i.prototype.showIndexScence=function(t){this.setSelect(t),this.currentScence!=t&&(this.currentScence=t,this.zaixianTime=0,e.ActivityController.getIntance().ActivityHuiKuiSendMsg(t))},i.prototype.showkuanghuanView=function(){if(this.currentScence==e.ActivityHuikuiId.QUANMINKUANGHUAN){var t=this.ui.group;t.removeChildren(),this.kuanghuanView=e.ActivityHuiKuiKuangHuanView.getIntance(this.model),this.kuanghuanView.initP();var i=this.model.getHuiKuiKuangHuanData();this.kuanghuanView.setData(i),t.addChild(this.kuanghuanView)}},i.prototype.showleichongView=function(){if(this.currentScence==e.ActivityHuikuiId.MEIRILEICHONG){var t=this.ui.group;t.removeChildren(),this.leichongView=e.ActivityHuiKuiLeiChongJiangLiView.getIntance(this.model),this.leichongView.initP();var i=this.model.getHuiKuiLeiChongData();this.leichongView.setData(i),t.addChild(this.leichongView)}},i.prototype.showZaiXianJiangLiView=function(){if(this.currentScence==e.ActivityHuikuiId.ZAIXIANJIANGLI){var t=this.ui.group;t.removeChildren(),this.zaixianjiangliView=e.ActivityHuiKuiZaiXianJiangView.getIntance(this.model),this.zaixianjiangliView.initP();var i=this.model.getHuiKuiZaiXianData();this.curDate||(this.curDate=new Date),this.zaixianTime=1e3*i.getAccOnlineTime(),this.zaixianjiangliView.setData(i),t.addChild(this.zaixianjiangliView)}},i.prototype.showXianGouLiBaoView=function(){if(this.currentScence==e.ActivityHuikuiId.XIANGOULIBAO){var t=this.ui.group;t.removeChildren(),this.xiangouLiBaoView=e.ActivityHuiKuiXianGouView.getIntance(this.model),this.xiangouLiBaoView.initP();var i=this.model.getHuiKuiXianGouData();this.xiangouLiBaoView.setData(i),t.addChild(this.xiangouLiBaoView)}},i.prototype.tickHook=function(e){if(this.zaixianjiangliView&&this.zaixianTime>0){var t=e-this.resultLastTime;if(1e3>t)return;this.resultLastTime=e,this.zaixianTime+=1e3;var i="",n=(this.zaixianTime-this.zaixianTime%36e5)/36e5;i+=10>n?"0"+n+":":n+":";var o=Math.floor((this.zaixianTime-1e3*n*60*60)/6e4);i+=10>o?"0"+o+":":o+":";var a=Math.floor((this.zaixianTime-1e3*n*60*60-1e3*o*60)/1e3);i+=10>a?"0"+a:a,this.zaixianjiangliView.setTimeStr(i)}},i.prototype.changeNumSp=function(e,t,i,n){},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.showHook=function(){this.initUI()},i.prototype.changeLiang=function(e){void 0===e&&(e=null);for(var t=[],i=this.model.getHuiKuiRedPointData(),n=t.length,o=0;n>o;o++){var a=t[o];e&&(a==e?a.setLiang(!0):a.setLiang(!1)),a.setRedVis(i[o])}},i}(e.BasePanel);e.ActivityHuiKuiMainView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiMainView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.awardData=[],e.skinName="ActivityHuiKuiXianGouLiBaoItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data,this.currentData.getVipLimit();var t=this.currentData.getItem();this.awardData=[];var i=new e.AttributeVO(t);if(i){var n=this.item_1;n&&(n.setItem(i.id,i.value,!0),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.awardData.push(i))}var o=this.currentData.getPriceEd(),a=new e.AttributeVO(o);1002==a.type?(this.icon1.source="tongqian_png",this.icon2.source="tongqian_png"):(this.icon1.source="yuanbao_png",this.icon2.source="yuanbao_png"),o=this.currentData.getCurrPrice();var s=new e.AttributeVO(o),r=this.currentData.getVipLimit();13==r?this.vip_img.source="xglb_quanmintehui_png":r>=23?this.vip_img.source="xglb_v23_png":this.vip_img.source="xglb_v"+r+"_png";e.ActivityController.getIntance().getModelForDaBiao().getHuiKuiZaiXianData();this.nowPrice.text=s.value+"",this.lastPrice.text=a.value+"",this.buyNums.text=this.currentData.getNum()-this.currentData.getBuyTimes()+"/"+this.currentData.getNum();var l=Math.round(s.value/a.value*10);this.currentData.getNum()-this.currentData.getBuyTimes()==0?(this.lingquBtn.label=e.LanguageUtils.instance.getValue("YIGOUMAI"),this.lingquBtn.touchEnabled=!1,this.lingquBtn.currentState="disabled"):(this.lingquBtn.label=e.LanguageUtils.instance.getValue("GOUMAI"),this.lingquBtn.currentState="up",this.lingquBtn.touchEnabled=!0),this.zhekou_img.source="huikui_"+l+"_png",this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:var o=e.PlayerService.instance.playerInfo.getCoin(),a=e.PlayerService.instance.playerInfo.getGold(),s=e.PlayerService.instance.playerInfo.getVipLevel(),r=new e.AttributeVO(this.currentData.getCurrPrice());if(1002==r.type){if(o<r.value)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JINBIBUZU"))}else{if(a<r.value)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");if(s<this.currentData.getVipLimit())return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_9"))}this.lingquAward();break;case this.item_1:i=this.awardData[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByHuiKuiLiBaoGetAward(this.currentData.getCfgId())},i}(eui.ItemRenderer);e.ActivityHuiKuiXianGouItemView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiXianGouItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="ActivityHuiKuiXianGouLiBaoViewSkin",i._isShow=!1,i.issTop=!1,i.currentData=null,i._model=e,i}return __extends(i,t),i.getIntance=function(t){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i(t),this._intance},i.prototype.initP=function(){this._isShow=!1,this.issTop=!1,this.currentData=null},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this.top_huodongTime.textFlow=null,this.list.dataProvider=null,this.removeChildren(),i._intance=null},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scroll&&(this.scroll.verticalScrollBar.autoVisibility=!1,this.scroll.viewport.scrollV=0),this.initUI()},i.prototype.initUI=function(){this._isShow=!0,this.showView()},i.prototype.getIsShow=function(){return this._isShow},i.prototype.setData=function(e){this.currentData=e,this.showView()},i.prototype.showView=function(){if(this.currentData&&this.currentData){var t=this.currentData.getGiftInfos(),i=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(i);var n=this.list;n.dataProvider=this._model.collection_HuiKuiXianGou,n.itemRenderer=e.ActivityHuiKuiXianGouItemView,this._model.dataSource_HuiKuiXianGou=t,this._model.collection_HuiKuiXianGou.replaceAll(this._model.dataSource_HuiKuiXianGou)}},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.setTimeStr=function(e){this.rechargedTxt.text=e},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.buyClick()}},i.prototype.buyClick=function(){e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)},i}(eui.Component);e.ActivityHuiKuiXianGouView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiXianGouView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.awardData=[],e.skinName="ActivityHuiKuiZaiXianItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data;var t=this.currentData.getAwards(),i=t.split(","),n=i.length;this.awardData=[];var o=0;for(o;n>o;o++){var a=new e.AttributeVO(i[o]);if(a){var s=this["item_"+(o+1)];s&&(s.setItem(a.id,a.value,!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.awardData.push(a))}}for(o;3>o;o++){var s=this["item_"+(o+1)];s&&(s.visible=!1)}var r=e.ActivityController.getIntance().getModelForDaBiao().getHuiKuiZaiXianData();this.currentData.getIsAward()?(this.lingquBtn.visible=!1,this.lingquImg.visible=!0,this.dailingqu.visible=!1):60*this.currentData.getCond()<=r.getAccOnlineTime()?(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)):(this.lingquBtn.visible=!1,this.lingquImg.visible=!1,this.dailingqu.visible=!0);var l=e.LanguageUtils.instance.getValue("ZAIXIANFENZHONG",this.currentData.getCond());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(l),l=e.LanguageUtils.instance.getValue("ZAIXIANLINGQU",this.currentData.getCond()),this.dailingqu.textFlow=(new egret.HtmlTextParser).parser(l),this.lingquBtn.visible&&this.lingquBtn.enabled?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_1:i=this.awardData[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);
break;case this.item_2:i=this.awardData[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.awardData[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.awardData[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByHuiKuiZaiXianGetAward(this.currentData.getCfgId())},i}(eui.ItemRenderer);e.ActivityHuiKuiZaiXianJiangItemView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiZaiXianJiangItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="ActivityHuiKuiZaiXianViewSkin",i._isShow=!1,i.issTop=!1,i.currentData=null,i._model=e,i}return __extends(i,t),i.getIntance=function(t){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i(t),this._intance},i.prototype.initP=function(){this._isShow=!1,this.issTop=!1,this.currentData=null},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this.list.dataProvider=null,this.removeChildren(),i._intance=null},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scroll&&(this.scroll.verticalScrollBar.autoVisibility=!1,this.scroll.viewport.scrollV=0),this.initUI()},i.prototype.initUI=function(){this._isShow=!0,this.showView()},i.prototype.getIsShow=function(){return this._isShow},i.prototype.setData=function(e){this.currentData=e,this.showView()},i.prototype.showView=function(){if(this.currentData&&this.currentData){var t=this.currentData.getConfigInfo(),i=this.list;i.dataProvider=this._model.collection_HuiKuiZaiXian,i.itemRenderer=e.ActivityHuiKuiZaiXianJiangItemView;var n=0,o=t.length,a=[],s=[];for(n;o>n;n++){var r=t[n];r.getIsAward()?a.push(r):s.push(r)}t=s.concat(a),this._model.dataSource_HuiKuiZaiXian=t,this._model.collection_HuiKuiZaiXian.replaceAll(this._model.dataSource_HuiKuiZaiXian)}},i.prototype.setTimeStr=function(e){this.rechargedTxt.text=e},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.buyClick()}},i.prototype.buyClick=function(){e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)},i}(eui.Component);e.ActivityHuiKuiZaiXianJiangView=t,__reflect(t.prototype,"foxgame.ActivityHuiKuiZaiXianJiangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentPage=0,e.currentSelect=0,e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.activityData=null,this.currentShowArr=null,this.btnSceneTypeArr=null,this.btnSceneDataArr=null,this.listData=null},i.prototype.setSelect=function(e){if(this.currentSelect=0,this.currentShowArr&&this.currentShowArr.length>0)for(var t=this.currentShowArr.length,i=0;t>i;i++){var n=this.currentShowArr[i],o=n.vo;o&&o.getActivityId()==e?(this.currentSelect=e,n.select=!0):n.select=!1}this.refresh()},i.prototype.updataView=function(t,i){if(void 0===t&&(t=null),this.model=e.ActivityController.getIntance().getModelForDaBiao(),this.listData=i,this.currentPage=0,this.callBackF=t,null!=this.listData){var n=this.listData.getActivity();if(null!=n&&0!=n.length){this.scrollBottom.scrollPolicyH=eui.ScrollPolicy.AUTO,this.scrollBottom.horizontalScrollBar.autoVisibility=!1,this.scrollBottom.scrollPolicyV=eui.ScrollPolicy.OFF;var o=new eui.TileLayout;o.requestedColumnCount=0,o.requestedRowCount=1,o.horizontalGap=-23,o.verticalGap=1,o.paddingLeft=-10,o.paddingRight=-10,this.scrollBottom.viewport.scrollH=0;var a=this.listBottom;a.dataProvider=e.ActivityController.getIntance().getkuafubangdanCollection_bottom(),a.itemRenderer=e.ActivityKuaFuMainBottomItemView,a.layout=o,this.activityData=this.listData.getActivity(),this.checkActivityData(),this.changeBtnXuanZhong(0),this.initUI(),this.checkBtnRedVisible()}}},i.prototype.changeViewByIndex=function(e){var t=this.currentShowArr,i=0,n=t.length,o=0;for(i;n>i;i++){var a=t[i];if(a){var s=a.vo;if(s.getActivityId()==e){o=i;break}}}this.changeBtnXuanZhong(o)},i.prototype.checkBtnRedVisible=function(){this.checkActivityData(),this.refresh()},i.prototype.refresh=function(){this.updataSceneBtn(),this.model.bangdanDataSource_bottom=this.currentShowArr,this.model.bangdanCollection_bottom.replaceAll(this.model.bangdanDataSource_bottom)},i.prototype.checkActivityData=function(){var t,i=this.activityData.length,n=[];this.currentShowArr=[],n=this.listData.getActivity();for(var o=0;i>o;o++)if(t=n[o],t.getOpenPlace()==e.activityListType.kuafubangdan){var a=new Object;a.vo=t,a.redPoint=this.checkRedPointVis(t.getActivityId()),t.getActivityId()==this.model.getCurrentType()?a.select=!0:a.select=!1,a.time=this.charStringBack(t.getStartTime(),t.getEndTime()),a.aVO=t,a.callBack=this.callBackF,this.currentShowArr.push(a),t.getActivityId()==e.activityDaTingType.kfchongzhipaihang?(this.model.chongzhiEndTime=t.getEndTime(),this.model.chongzhiCloseTime=t.getCloseTime()):t.getActivityId()==e.activityDaTingType.kfxiaofeipaihang?(this.model.xiaofeiEndTime=t.getEndTime(),this.model.xiaofeiCloseTime=t.getCloseTime()):t.getActivityId()==e.activityDaTingType.kfzhanlipaihang?(this.model.zhanliEndTime=t.getEndTime(),this.model.zhanliCloseTime=t.getCloseTime()):t.getActivityId()==e.activityDaTingType.kfdengjipaihang&&(this.model.dengjiEndTime=t.getEndTime(),this.model.dengjiCloseTime=t.getCloseTime())}},i.prototype.checkRedPointVis=function(e){var t=this.model.getRedPointArr(),i=t[""+e];return i?i.value:!1},i.prototype.setRedPoint=function(t,i){var n=this.currentShowArr[t].vo,o=e.ActivityController.getIntance().getRedPointArr(),a=!1,s=!1,r=!1;for(var l in o){var h=o[l];if(h.type==n.getActivityId()){a=h.value;break}}-1==i?t<this.currentPage?(a&&(s=a),this.redPoint_left.visible=s):t>=this.currentPage+4&&(a&&(r=a),this.redPoint_right.visible=r):this["redPoint_"+(i+1)].visible=a},i.prototype.updataSceneBtn=function(){var e=4,t=this.currentPage,i=e+t;if(!(i>this.currentShowArr.length)){this.btnSceneTypeArr=[],this.btnSceneDataArr=[];var n=this.currentShowArr.length,o=0;for(t=0;n>t;t++)t>=this.currentPage&&t<this.currentPage+4&&(this.changeBtnSource(o,t),o++)}},i.prototype.changeBtnSource=function(e,t){},i.prototype.initUI=function(){this.initListener()},i.prototype.initListener=function(){this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.changeViewOnLeftOrRight=function(e){var t=0;if(e>0){if(!(this.currentPage>=(this.currentShowArr.length-this.currentShowArr.length%4)/4)){if(e==(this.currentShowArr.length-this.currentShowArr.length%4)/4+1||4==this.currentShowArr.length)return;this.currentPage++}}else this.currentPage<=0||this.currentPage--;t=4*this.currentPage*(4/this.currentShowArr.length)*110,this.scrollBottom.viewport.scrollH=t},i.prototype.getSourceByBtn=function(e){return this.btnSceneDataArr&&this.btnSceneDataArr[e]?this.btnSceneDataArr[e].getImgSource():null},i.prototype.changeBtnXuanZhong=function(t){var i=this.currentShowArr[t].aVO;if(i){var n,o,a;i.getActivityId()==e.activityDaTingType.dabiaohuodong?a=""+e.activityDaTingType.dabiaohuodong:(o=i.getStartTime(),n=i.getEndTime(),console.log("结束的时间 "+i.getEndTime()),console.log("消失时间 "+i.getCloseTime()),this.model.kuafuEndTime=i.getEndTime(),this.model.kuafuCloseTime=i.getCloseTime(),a=this.charStringBack(o,n));for(var s=this.listData.getActivity().length,r=0;s>r;r++){var l=this.listData.getActivity()[r];l.getActivityId()==i.getActivityId()&&this.callBackF(i.getActivityId(),a)}}},i.prototype.onClick=function(e){switch(e.target){case this.leftBtn:Log.trace("leftBtn"),this.changeViewOnLeftOrRight(-1);break;case this.rightBtn:Log.trace("rightBtn"),this.changeViewOnLeftOrRight(1)}},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityKFBangdanMainBottom=t,__reflect(t.prototype,"foxgame.ActivityKFBangdanMainBottom")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFChongZhiPaiHangSkin",e}return __extends(i,t),i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.timeStr=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.updataView=function(e,t){void 0===t&&(t=""),this._data=e,this.timeStr=t,this.initUI()},i.prototype.setZhanshi=function(){this.top_huodongTime.text="活动已结束！"},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getKuaFuBangdanCollection(),t.itemRenderer=e.ActivityKuaFuPaiMingItemView,this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.timeStr),this._data.getRankTimes()<=0?this.myIndex.text="未上榜":this.myIndex.text=this._data.getRankTimes()+"",this.myMoney.text=this._data.getRankValue()+"元宝";var i=this._data.getThreeLimit();console.log("档位条件 "+i);var n=e.LanguageUtils.instance.getValue("KuaFuBangDanChongZhiLimit",i);this.titleMoney.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityKFChongZhiPaiHangView=t,__reflect(t.prototype,"foxgame.ActivityKFChongZhiPaiHangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFDengJiPaiHangSkin",e}return __extends(i,t),i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.timeStr=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.updataView=function(e,t){void 0===t&&(t=""),this._data=e,this.timeStr=t,this.initUI()},i.prototype.setZhanshi=function(){this.top_huodongTime.text="活动已结束！"},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getKuaFuBangdanCollection(),t.itemRenderer=e.ActivityKFDengJiPaiMingItemView,this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.timeStr),this._data.getRankTimes()<=0?this.myIndex.text="未上榜":this.myIndex.text=this._data.getRankTimes()+"",this.myMoney.text=this._data.getRankValue()+"";var i=this._data.getThreeLimit();console.log("档位条件 "+i);var n=e.LanguageUtils.instance.getValue("KuaFuBangDanDengJiLimit",i);this.titleMoney.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityKFDengJiPaiHangView=t,__reflect(t.prototype,"foxgame.ActivityKFDengJiPaiHangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFDengJiPaiMingItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curretnVo=this.data;var t="";if(0==this.curretnVo.getItmeId())this.icon.source="",this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=e.LanguageUtils.instance.getValue("ZANWU"),t=e.LanguageUtils.instance.getValue("KuaFuBangDanDengJi",0),this.money.textFlow=(new egret.HtmlTextParser).parser(t);else{var i=e.JsonDataManager.instance.roleTemplate,n=i[""+this.curretnVo.getItmeId()];this.icon.source=n.icon,this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=this.curretnVo.getName(),t=e.LanguageUtils.instance.getValue("KuaFuBangDanDengJi",this.curretnVo.getRankValue()),this.money.textFlow=(new egret.HtmlTextParser).parser(t)}this.itemVOArr=[];var o=this.curretnVo.getAwardstr().split(","),a=4,s=0;for(s;a>s;s++){var r=this["item_"+(s+1)],l=new e.AttributeVO(o[s]);if(s>o.length-1)break;r.visible=!0,r.setItem(l.id,l.value,!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(l)}for(s;a>s;s++){var r=this["item_"+(s+1)];r.visible=!1}},i.prototype.onClick=function(t){var i,n=this.itemVOArr;switch(t.target){case this.item_1:i=n[0];break;case this.item_2:i=n[1];break;case this.item_3:i=n[2];break;case this.item_4:i=n[3]}var o=e.JsonDataManager.instance.itemTemplate[i.id];e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,o.type,i.value)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityKFDengJiPaiMingItemView=t,__reflect(t.prototype,"foxgame.ActivityKFDengJiPaiMingItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFXiaoFeiPaiHangSkin",e}return __extends(i,t),i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.timeStr=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.updataView=function(e,t){void 0===t&&(t=""),this._data=e,this.timeStr=t,this.initUI()},i.prototype.setZhanshi=function(){this.top_huodongTime.text="活动已结束！"},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getKuaFuBangdanCollection(),t.itemRenderer=e.ActivityKFXiaoFeiPaiMingItemView,this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.timeStr),this._data.getRankTimes()<=0?this.myIndex.text="未上榜":this.myIndex.text=this._data.getRankTimes()+"",this.myMoney.text=this._data.getRankValue()+"元宝";var i=this._data.getThreeLimit();console.log("档位条件 "+i);var n=e.LanguageUtils.instance.getValue("KuaFuBangDanXiaoFeiLimit",i);this.titleMoney.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityKFXiaoFeiPaiHangView=t,__reflect(t.prototype,"foxgame.ActivityKFXiaoFeiPaiHangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFXiaoFeiPaiMingItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curretnVo=this.data;var t="";if(0==this.curretnVo.getItmeId())this.icon.source="",this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=e.LanguageUtils.instance.getValue("ZANWU"),t=e.LanguageUtils.instance.getValue("KuaFuBangDanXiaoFei",0),this.money.textFlow=(new egret.HtmlTextParser).parser(t);else{var i=e.JsonDataManager.instance.roleTemplate,n=i[""+this.curretnVo.getItmeId()];this.icon.source=n.icon,this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=this.curretnVo.getName(),t=e.LanguageUtils.instance.getValue("KuaFuBangDanXiaoFei",this.curretnVo.getRankValue()),this.money.textFlow=(new egret.HtmlTextParser).parser(t)}this.itemVOArr=[];var o=this.curretnVo.getAwardstr().split(","),a=4,s=0;for(s;a>s;s++){var r=this["item_"+(s+1)],l=new e.AttributeVO(o[s]);if(s>o.length-1)break;r.visible=!0,r.setItem(l.id,l.value,!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(l)}for(s;a>s;s++){var r=this["item_"+(s+1)];r.visible=!1}},i.prototype.onClick=function(t){var i,n=this.itemVOArr;switch(t.target){case this.item_1:i=n[0];break;case this.item_2:i=n[1];break;case this.item_3:i=n[2];break;case this.item_4:i=n[3]}var o=e.JsonDataManager.instance.itemTemplate[i.id];e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,o.type,i.value)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityKFXiaoFeiPaiMingItemView=t,__reflect(t.prototype,"foxgame.ActivityKFXiaoFeiPaiMingItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFZhanliPaiHangSkin",e}return __extends(i,t),i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.timeStr=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.updataView=function(e,t){void 0===t&&(t=""),this._data=e,this.timeStr=t,this.initUI()},i.prototype.setZhanshi=function(){this.top_huodongTime.text="活动已结束！"},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getKuaFuBangdanCollection(),t.itemRenderer=e.ActivityKFZhanLiPaiMingItemView,this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.timeStr),this._data.getRankTimes()<=0?this.myIndex.text="未上榜":this.myIndex.text=this._data.getRankTimes()+"",this.myMoney.text=this._data.getRankValue()+"";var i=this._data.getThreeLimit();console.log("档位条件 "+i);var n=e.LanguageUtils.instance.getValue("KuaFuBangDanZhanLiLimit",i);this.titleMoney.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityKFZhanliPaiHangView=t,__reflect(t.prototype,"foxgame.ActivityKFZhanliPaiHangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKFZhanLiPaiMingItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curretnVo=this.data;var t="";if(0==this.curretnVo.getItmeId())this.icon.source="",this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=e.LanguageUtils.instance.getValue("ZANWU"),t=e.LanguageUtils.instance.getValue("KuaFuBangDanZhanLi",0),this.money.textFlow=(new egret.HtmlTextParser).parser(t);else{var i=e.JsonDataManager.instance.roleTemplate,n=i[""+this.curretnVo.getItmeId()];this.icon.source=n.icon,this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=this.curretnVo.getName(),t=e.LanguageUtils.instance.getValue("KuaFuBangDanZhanLi",this.curretnVo.getRankValue()),this.money.textFlow=(new egret.HtmlTextParser).parser(t)}this.itemVOArr=[];var o=this.curretnVo.getAwardstr().split(","),a=4,s=0;for(s;a>s;s++){var r=this["item_"+(s+1)],l=new e.AttributeVO(o[s]);if(s>o.length-1)break;r.visible=!0,r.setItem(l.id,l.value,!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(l)}for(s;a>s;s++){var r=this["item_"+(s+1)];r.visible=!1}},i.prototype.onClick=function(t){var i,n=this.itemVOArr;switch(t.target){case this.item_1:i=n[0];break;case this.item_2:i=n[1];break;case this.item_3:i=n[2];break;case this.item_4:i=n[3]}var o=e.JsonDataManager.instance.itemTemplate[i.id];e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,o.type,i.value)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityKFZhanLiPaiMingItemView=t,__reflect(t.prototype,"foxgame.ActivityKFZhanLiPaiMingItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/kuafubangdan/ActivityKuaFuBangDanMainSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){this.ui.sceneGroup.removeChildren(),this.initListener(),this.ui.bottom_btnGroup.updataView(this.backFunForBottom.bind(this),this.model.getListData()),this.doScreenAdaptation()},i.prototype.checkBtnRedVisible=function(){this.getIsShow()&&this.ui.bottom_btnGroup.checkBtnRedVisible()},i.prototype.backFunForBottom=function(t,i){void 0===i&&(i=null),-1==this.model.getGuildIndex()&&(this.model.setCurrentKaiQiTime(i),this.model.kuafuBangDanCollection.source=null,this.currentType=t,this.model.setCurrentType(t),this.ui.bottom_btnGroup.setSelect(t),t<e.activityDaTingType.kfchongzhipaihang||t>e.activityDaTingType.kfdengjipaihang||e.ActivityController.getIntance().sendMessageToSeverByKuaFuBangdan(t))},i.prototype.initListener=function(){this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(e){this.backHandler()},i.prototype.showHook=function(){this.initUI()},i.prototype.refresh=function(){},i.prototype.kfchongzhipaimingShow=function(){if(this.currentType==e.activityDaTingType.kfchongzhipaihang){var t=this.model.getKuaFuBangDanPaiMing(),i=this.ui.sceneGroup,n=e.ActivityKFChongZhiPaiHangView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime()),console.log("当前时间--  "+t.getCurrentTime());var o=1e3*t.getCurrentTime();this.model.chongzhiEndTime<o&&o<=this.model.chongzhiCloseTime&&n.setZhanshi(),this.model.kuafuBangDanDataSouce=t.getCsRankInfo(),this.model.kuafuBangDanCollection.replaceAll(this.model.kuafuBangDanDataSouce)}},i.prototype.kfXiaoFeipaimingShow=function(){if(this.currentType==e.activityDaTingType.kfxiaofeipaihang){var t=this.model.getKuaFuBangDanPaiMing(),i=this.ui.sceneGroup,n=e.ActivityKFXiaoFeiPaiHangView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime()),console.log("当前时间--  "+t.getCurrentTime());var o=1e3*t.getCurrentTime();this.model.xiaofeiEndTime<o&&o<=this.model.xiaofeiCloseTime&&n.setZhanshi(),this.model.kuafuBangDanDataSouce=t.getCsRankInfo(),this.model.kuafuBangDanCollection.replaceAll(this.model.kuafuBangDanDataSouce)}},i.prototype.kfZhanLipaimingShow=function(){if(this.currentType==e.activityDaTingType.kfzhanlipaihang){var t=this.model.getKuaFuBangDanPaiMing(),i=this.ui.sceneGroup,n=e.ActivityKFZhanliPaiHangView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime()),console.log("当前时间--  "+t.getCurrentTime());var o=1e3*t.getCurrentTime();this.model.zhanliEndTime<o&&o<=this.model.zhanliCloseTime&&n.setZhanshi(),this.model.kuafuBangDanDataSouce=t.getCsRankInfo(),this.model.kuafuBangDanCollection.replaceAll(this.model.kuafuBangDanDataSouce)}},i.prototype.kfDengjipaimingShow=function(){if(this.currentType==e.activityDaTingType.kfdengjipaihang){var t=this.model.getKuaFuBangDanPaiMing(),i=this.ui.sceneGroup,n=e.ActivityKFDengJiPaiHangView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime()),console.log("当前时间--  "+t.getCurrentTime());var o=1e3*t.getCurrentTime();this.model.dengjiEndTime<o&&o<=this.model.dengjiCloseTime&&n.setZhanshi(),this.model.kuafuBangDanDataSouce=t.getCsRankInfo(),this.model.kuafuBangDanCollection.replaceAll(this.model.kuafuBangDanDataSouce)}},i.prototype.closeHook=function(){for(var e=this.group.numChildren,t=0;e>t;++t){var i=this.group.getChildAt(t);i.cleanDataDelete&&i.cleanDataDelete()}this.group.removeChildren(),this.group=null,this.scaleX=this.scaleY=1,this.x=this.y=0},i}(e.BasePanel);e.ActivityKuaFuBangDanMainView=t,__reflect(t.prototype,"foxgame.ActivityKuaFuBangDanMainView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="ActivityKuaFuBangDanMainBottomItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.redPoint.visible=!1,this.obj=this.data,this.vo=this.obj.vo;var t=this.obj.redPoint,i=this.obj.select;this.btn.source=this.vo.getImgSource()+"_png",i?this.btnselect.visible=!0:this.btnselect.visible=!1,this.redPoint.visible=t,this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i=this.obj.callBack;if(i){var n="";n=this.vo.getActivityId()==e.activityDaTingType.dabiaohuodong?""+e.activityDaTingType.dabiaohuodong:this.obj.time,i(this.vo.getActivityId(),n)}},i}(eui.ItemRenderer);e.ActivityKuaFuMainBottomItemView=t,__reflect(t.prototype,"foxgame.ActivityKuaFuMainBottomItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="ActivityLaborDayBtnItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.obj=this.data,this.vo=this.obj.vo,this.redPoint.visible=this.obj.red;var t=this.obj.select;t?this.btn.source=this.vo.getImgSource()+"xuanzhong_png":this.btn.source=this.vo.getImgSource()+"_png",this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(e){var t=this.obj.callBack;t&&t(this.vo.getActivityId())},i}(eui.ItemRenderer);e.ActivityLaborDayBtnItem=t,__reflect(t.prototype,"foxgame.ActivityLaborDayBtnItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityLaborDay/ActivityLaborDayChaoZhiLiBaoViewSkin.exml")||this;return i.currentStates=1,i._model=e,i.getisShow=!1,i.setBackFun(i.initUI.bind(i)),i}return __extends(i,t),i.prototype.updataView=function(){this.getisShow&&this.showView()},i.prototype.showView=function(){this.initListener(),this.currentData=this._model.getChaoZhiLiBaoLaborDayData();var t=e.LanguageUtils.instance.getValue("51KUANGHUAN_TEHUILIBAO");this.top_chongzhiTxt.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(i),this.chooseScence(this.currentStates)},i.prototype.initUI=function(){this.getisShow=!0,e.ActivityController.getIntance().getKuangHuangScenceIndex()!=e.ActivityKuangHuanId.CHAOZHILIBAO&&(this.currentStates=1),this.showView()},i.prototype.initListener=function(){this.shenqiGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.chuanshuoGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.laodongGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.longhunGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i;switch(t.target){case this.shenqiGroup:this.currentStates=2,this.chooseScence(2);break;case this.chuanshuoGroup:this.currentStates=3,this.chooseScence(3);break;case this.laodongGroup:this.currentStates=1,this.chooseScence(1);break;case this.longhunGroup:this.currentStates=4,this.chooseScence(4);break;case this.lingquBtn:var n=e.PlayerService.instance.playerInfo.getGold();if(n>=this.currentvo.getMoney()){var o=e.LanguageUtils.instance.getValue("XIAOHAOYUANBAOGOUMAILIBAO",this.currentvo.getMoney());
e.PopUpController.getInstance().showTextPanel(o,this,this.lingquAward)}else e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");break;case this.item_0:case this.item_1:case this.item_2:case this.item_3:case this.item_4:case this.item_5:case this.item_6:var a=t.target;i=e.JsonDataManager.instance.itemTemplate[a.itemId],e.ActivityController.getIntance().showTipsByItemOrEquip(a.itemId,i.type,a.num)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByLaborDayChaoZhiLiBao(this.currentvo.getId())},i.prototype.chooseScence=function(t){switch(t){case 1:this.laodongliang.visible=!0,this.chuanshuoliang.visible=!1,this.longhunliang.visible=!1,this.shenqiliang.visible=!1,this.currentvo=this.currentData.getAwardsInfo()[0];break;case 2:this.laodongliang.visible=!1,this.chuanshuoliang.visible=!1,this.longhunliang.visible=!1,this.shenqiliang.visible=!0,this.currentvo=this.currentData.getAwardsInfo()[1];break;case 3:this.laodongliang.visible=!1,this.chuanshuoliang.visible=!0,this.longhunliang.visible=!1,this.shenqiliang.visible=!1,this.currentvo=this.currentData.getAwardsInfo()[2];break;case 4:this.laodongliang.visible=!1,this.chuanshuoliang.visible=!1,this.longhunliang.visible=!0,this.shenqiliang.visible=!1,this.currentvo=this.currentData.getAwardsInfo()[3]}this.longhun_buyImg.visible=this.currentData.getAwardsInfo()[3].getState(),this.laodong_buyImg.visible=this.currentData.getAwardsInfo()[0].getState(),this.chuanshuo_buyImg.visible=this.currentData.getAwardsInfo()[2].getState(),this.shenqi_buyImg.visible=this.currentData.getAwardsInfo()[1].getState(),this.shenqiTxt.visible=this.shenqiliang.visible,this.longhunTxt.visible=this.longhunliang.visible,this.chuanshuoTxt.visible=this.chuanshuoliang.visible,this.laodongTxt.visible=this.laodongliang.visible,this.costTxt.text=this.currentvo.getMoney()+"",this.lingquBtn.visible=!this.currentvo.getState();for(var i=this.currentvo.getAwards().split(","),n=i.length,o=0;n>o;o++){var a=new e.AttributeVO(i[o]);if(a){var s=this["item_"+o];s&&(s.setItem(a.id,a.value,!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this))}}},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i}(e.BaseComponent);e.ActivityLaborDayChaoZhiLiBaoView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayChaoZhiLiBaoView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityLaborDayPanelModelOneItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.curretnVo=this.data,this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=4,i=0,n=e.ActivityController.getIntance().getLaborDayDengluJiangLiData(),o=n.getGotAwardCfgId();if(this.chongzhiVO=n,t=o.length,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,t>0)for(var a=0;t>a;a++)if(this.curretnVo.getId()==o[a]){this.dailingqu.visible=!1,this.lingquImg.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break}if(this.chongzhiVO.getLoginDays()>=this.curretnVo.getId()?(this.lingquImg.visible?this.lingquBtn.visible=!1:this.lingquBtn.visible=!0,this.dailingqu.visible=!1):(this.lingquBtn.visible=!1,this.dailingqu.visible=!0),this.curretnVo){var s=e.LanguageUtils.instance.getValue("LEIJIDENGLUHUODE",this.curretnVo.getId());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(s);var r=this.curretnVo.getAwards(),l=r.split(",");for(t=4,this.itemVOArr=[],i=0;t>i;i++){var h=this["item_"+(i+1)];if(i>l.length-1)break;var c=new e.AttributeVO(l[i]);h.visible=!0,h.setItem(c.id,c.value,!0),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(c)}for(i;t>i;i++){var h=this["item_"+(i+1)];h.visible=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)}},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:Log.trace("领取"),this.chongzhiVO.getLoginDays()>=this.curretnVo.getId()&&this.lingquAward();break;case this.item_1:i=this.itemVOArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.itemVOArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.itemVOArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.itemVOArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByLaborDayDengLuJiangLi(this.curretnVo.getId())},i}(eui.ItemRenderer);e.ActivityLaborDayDengLuJiangLiItemView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayDengLuJiangLiItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityLaborDay/ActivityLaborDayPanelModelOneViewSkin.exml")||this;return i._model=e,i.getisShow=!1,i.setBackFun(i.initUI.bind(i)),i}return __extends(i,t),i.prototype.updataView=function(){this.getisShow&&this.showView()},i.prototype.showView=function(){this.currentData=this._model.getDengLuJiangLiLaborDayData();var t=e.LanguageUtils.instance.getValue("51KUANGHUAN_DENGLUTITLE");this.top_chongzhiTxt.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(i);var n=this.list;n.dataProvider=this._model.collection_LaborDayDengLuJiangLi,n.itemRenderer=e.ActivityLaborDayDengLuJiangLiItemView;var o=0,a=this.currentData.getAwardsInfo().length,s=0,r=this.currentData.getGotAwardCfgId(),l=r.length,h=!1,c=[],u=[];for(o;a>o;o++){var p=this.currentData.getAwardsInfo()[o];for(h=!1,s=0;l>s;s++){var g=r[s];g==p.getId()&&(h=!0)}h?c.push(p):u.push(p)}this.currentData.setAwardsInfo(u.concat(c)),this._model.dataSource_LaborDayDengLuJiangLi=this.currentData.getAwardsInfo(),this._model.collection_LaborDayDengLuJiangLi.replaceAll(this._model.dataSource_LaborDayDengLuJiangLi)},i.prototype.initUI=function(){this.getisShow=!0,e.ActivityController.getIntance().getKuangHuangScenceIndex()!=e.ActivityKuangHuanId.DENGLUZENGLI&&(this.scroller.viewport.scrollV=0),this.showView()},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i}(e.BaseComponent);e.ActivityLaborDayDengLuJiangLiView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayDengLuJiangLiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityLaborDayPanelModelOneItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.curretnVo=this.data,this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=4,i=0,n=e.ActivityController.getIntance().getLaborDayLeiJiChongZhiData(),o=n.getGotAwardCfgId();if(this.chongzhiVO=n,t=o.length,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,t>0)for(var a=0;t>a;a++)if(this.curretnVo.getId()==o[a]){this.dailingqu.visible=!1,this.lingquImg.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break}if(this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?(this.lingquImg.visible?this.lingquBtn.visible=!1:this.lingquBtn.visible=!0,this.dailingqu.visible=!1):(this.lingquBtn.visible=!1,this.dailingqu.visible=!0),this.curretnVo){var s=e.LanguageUtils.instance.getValue("LEIJICHONGZHI",this.curretnVo.getStepNumber());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(s);var r=this.curretnVo.getAwards(),l=r.split(",");for(t=4,this.itemVOArr=[],i=0;t>i;i++){var h=this["item_"+(i+1)];if(i>l.length-1)break;var c=new e.AttributeVO(l[i]);h.visible=!0,h.setItem(c.id,c.value,!0),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(c)}for(i;t>i;i++){var h=this["item_"+(i+1)];h.visible=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)}},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?this.lingquAward():e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHONGZHIERDUBUZU"));break;case this.item_1:i=this.itemVOArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.itemVOArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.itemVOArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.itemVOArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){App.SoundManager().playEffect("sound_award_mp3"),e.ActivityController.getIntance().sendMessageToSeverByLaborDayLeiJiLingQu(this.curretnVo.getId())},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i}(eui.ItemRenderer);e.ActivityLaborDayLeiJiChongZhiItemView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayLeiJiChongZhiItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityLaborDay/ActivityLaborDayPanelModelOneViewSkin.exml")||this;return i._model=e,i.getisShow=!1,i.setBackFun(i.initUI.bind(i)),i}return __extends(i,t),i.prototype.updataView=function(){this.getisShow&&this.showView()},i.prototype.initUI=function(){this.getisShow=!0,e.ActivityController.getIntance().getKuangHuangScenceIndex()!=e.ActivityKuangHuanId.LEIJICHONGZHI&&(this.scroller.viewport.scrollV=0),this.showView()},i.prototype.showView=function(){this.currentData=this._model.getLaborDayLeiJiChongZhiData();var t=e.LanguageUtils.instance.getValue("51KUANGHUAN_YICHONGZHI",this.currentData.getAccRechargeGold());this.top_chongzhiTxt.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(i);var n=this.list;n.dataProvider=this._model.collection_LaborDayLeiJiChongZhi,n.itemRenderer=e.ActivityLaborDayLeiJiChongZhiItemView;var o=0,a=this.currentData.getAwardsInfo().length,s=0,r=this.currentData.getGotAwardCfgId(),l=r.length,h=!1,c=[],u=[];for(o;a>o;o++){var p=this.currentData.getAwardsInfo()[o];for(h=!1,s=0;l>s;s++){var g=r[s];g==p.getId()&&(h=!0)}h?c.push(p):u.push(p)}this.currentData.setAwardsInfo(u.concat(c)),this._model.dataSource_LaborDayLeiJiChongZhi=this.currentData.getAwardsInfo(),this._model.collection_LaborDayLeiJiChongZhi.replaceAll(this._model.dataSource_LaborDayLeiJiChongZhi)},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i}(e.BaseComponent);e.ActivityLaborDayLeiJiChongZhiView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayLeiJiChongZhiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityLaborDayPanelModelOneItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.curretnVo=this.data,this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=4,i=0,n=e.ActivityController.getIntance().getLaborDayLeiJiXiaoFeiData(),o=n.getGotAwardCfgId();if(this.chongzhiVO=n,t=o.length,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,t>0)for(var a=0;t>a;a++)if(this.curretnVo.getId()==o[a]){this.dailingqu.visible=!1,this.lingquImg.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break}if(this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?(this.lingquImg.visible?this.lingquBtn.visible=!1:this.lingquBtn.visible=!0,this.dailingqu.visible=!1):(this.lingquBtn.visible=!1,this.dailingqu.visible=!0),this.curretnVo){var s=e.LanguageUtils.instance.getValue("LEIJIXIAOFEIHUODE",this.curretnVo.getStepNumber());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(s);var r=this.curretnVo.getAwards(),l=r.split(",");for(t=4,this.itemVOArr=[],i=0;t>i;i++){var h=this["item_"+(i+1)];if(i>l.length-1)break;var c=new e.AttributeVO(l[i]);h.visible=!0,h.setItem(c.id,c.value,!0),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(c)}for(i;t>i;i++){var h=this["item_"+(i+1)];h.visible=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)}},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?this.lingquAward():e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHONGZHIERDUBUZU"));break;case this.item_1:i=this.itemVOArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.itemVOArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.itemVOArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.itemVOArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){App.SoundManager().playEffect("sound_award_mp3"),e.ActivityController.getIntance().sendMessageToSeverByLaborDayLeiJiXiaoFei(this.curretnVo.getId())},i}(eui.ItemRenderer);e.ActivityLaborDayLeiJiXiaoFeiItemView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayLeiJiXiaoFeiItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityLaborDay/ActivityLaborDayPanelModelOneViewSkin.exml")||this;return i._model=e,i.getisShow=!1,i.setBackFun(i.initUI.bind(i)),i}return __extends(i,t),i.prototype.updataView=function(){this.getisShow&&this.showView()},i.prototype.showView=function(){this.currentData=this._model.getLeiJiXiaoFeiLaborDayData();var t=e.LanguageUtils.instance.getValue("51KUANGHUAN_YIXIAOFEI",this.currentData.getAccRechargeGold());this.top_chongzhiTxt.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(i);var n=this.list;n.dataProvider=this._model.collection_LaborDayLeuiJiXiaoFei,n.itemRenderer=e.ActivityLaborDayLeiJiXiaoFeiItemView;var o=0,a=this.currentData.getAwardsInfo().length,s=0,r=this.currentData.getGotAwardCfgId(),l=r.length,h=!1,c=[],u=[];for(o;a>o;o++){var p=this.currentData.getAwardsInfo()[o];for(h=!1,s=0;l>s;s++){var g=r[s];g==p.getId()&&(h=!0)}h?c.push(p):u.push(p)}this.currentData.setAwardsInfo(u.concat(c)),this._model.dataSource_LaborDayLeiJiXiaoFei=this.currentData.getAwardsInfo(),this._model.collection_LaborDayLeuiJiXiaoFei.replaceAll(this._model.dataSource_LaborDayLeiJiXiaoFei)},i.prototype.initUI=function(){this.getisShow=!0,e.ActivityController.getIntance().getKuangHuangScenceIndex()!=e.ActivityKuangHuanId.XIAOFEIZENGLI&&(this.scroller.viewport.scrollV=0),this.showView()},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i}(e.BaseComponent);e.ActivityLaborDayLeiJiXiaoFeiView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayLeiJiXiaoFeiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ActivityLaborDayZhaoCaiJinBaoDengView",t._isShow=!1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUI()},t.prototype.initUI=function(){this._isShow=!0},t.prototype.getIsShow=function(){return this._isShow},t.prototype.showDeng=function(){this.state2.visible=!this.state2.visible},t}(eui.Component);e.ActivityLaborDayZhaoCaiJinBaoDengView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayZhaoCaiJinBaoDengView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.stopNum=0,e.skinName="ActivityLaborDayZhaoCaiJinBaoShuZiGroupViewSkin",e._isShow=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI()},i.prototype.initUI=function(){this._isShow=!0,this.itemArr=[],this.itemArr.push(this.item0,this.item1,this.item2,this.item3,this.item4,this.item5,this.item6)},i.prototype.getIsShow=function(){return this._isShow},i.prototype.playMc=function(t,i){var n=this.itemArr.length;n>=i&&(n=i),this.stopNum=0;for(var o=0;n>o;o++){var a=this.itemArr[o];a.issTop&&(this.stopNum+=1),a.playMc(t)}if(7==this.stopNum){e.ActivityController.getIntance().LaoHuStop();for(var o=0;n>o;o++){var a=this.itemArr[o];a.issTop=!1}this.stopNum=0}},i.prototype.stopMc=function(e){for(var t=this.checkGold(e.getWinningGolds()),i=this.itemArr.length,n=0;i>n;n++){var o=this.itemArr[n];o.stopMc(t[n])}},i.prototype.checkGold=function(e){for(var t=[0,0,0,0,0,0,0],i=e+"",n=i.split(""),o=t.length,a=t.length-n.length,s=0;o>s;s++)a>s||Number(n[s-a])&&(t[s]=Number(n[s-a]));return t},i}(eui.Component);e.ActivityLaborDayZhaoCaiJinBaoShuZiGroupView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayZhaoCaiJinBaoShuZiGroupView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ActivityLaborDayZhaoCaiJinBaoShuZiViewSkin",t._isShow=!1,t.issTop=!1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUI()},t.prototype.initUI=function(){this.txtArr=[],this.txtArr.push(this.txt0,this.txt1,this.txt2,this.txt3,this.txt4,this.txt5,this.txt6,this.txt7,this.txt8,this.txt9),this._isShow=!0},t.prototype.getIsShow=function(){return this._isShow},t.prototype.playMc=function(e){for(var t=this.txtArr.length,i=0;t>i;i++){var n=this.txtArr[i];if(n.y<-n.height&&(0==i?n.y=this.txtArr[9].y+n.height:n.y=this.txtArr[i-1].y+n.height),this.issTop)return;n.y-=e}},t.prototype.stopMc=function(e){var t=this.txtArr.length;this.txtArr[e].y=0;for(var i=0;t>i;i++){var n=this.txtArr[i];0==i?i!=e&&(n.y=this.txtArr[9].y+n.height):i!=e&&(n.y=this.txtArr[i-1].y+n.height)}this.issTop=!0},t}(eui.Component);e.ActivityLaborDayZhaoCaiJinBaoShuZiView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayZhaoCaiJinBaoShuZiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="ActivityLaborDayZhaoCaiJinBaoViewSkin",i._model=e,i.getisShow=!1,i}return __extends(i,t),i.prototype.updataViewNew=function(){this.getisShow&&this.initUI()},i.prototype.showLog=function(t){for(var i=t.getGoldsLog().length,n="",o="",a=0;i>a;a++){var s=t.getGoldsLog()[a];o=e.LanguageUtils.instance.getValue("WANJIAHUODEYUANBAO",s.getName(),s.getGolds(),s.getDoubleGolds()),n+=o+"\n"}this.messageTxt.textFlow=(new egret.HtmlTextParser).parser(n),this.scroller.viewport.scrollV=-this.messageGroup.height+this.messageTxt.height},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI()},i.prototype.initUI=function(){this.getisShow=!0,this.checkCishu(),this.currentData=this._model.getZhaoCaiJinBaoLaborDayData();var t=e.LanguageUtils.instance.getValue("51KUANGHUAN_ZHAOCAIJINBAO_VIP");this.top_chongzhiTxt.textFlow=(new egret.HtmlTextParser).parser(t),t=e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_GUIZE"),this.leftTxt.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.rightTxt.text=this.currentData.getGoldsNumber()+"",this.costTxt.text=this.currentData.getMaxGetGolds()+"",this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(i),this.shuziGroup.mask=this.maskImg,this.initListener(),this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.scrollPolicyV=eui.ScrollPolicy.AUTO,this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.messageTxt||(this.messageTxt=new eui.Label,this.messageTxt.size=18,this.messageGroup.addChild(this.messageTxt)),this.buyBtn.currentState="up",this.buyBtn.touchEnabled=!0},i.prototype.updataView=function(){this.currentData=this._model.getZhaoCaiJinBaoLaborDayData();var e=this.charStringBack(this.currentData.getStartTime(),this.currentData.getEndTime());this.rightTxt.text=this.currentData.getGoldsNumber()+"",this.costTxt.text=this.currentData.getMaxGetGolds()+"",this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(e)},i.prototype.initListener=function(){this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeview,this)},i.prototype.removeview=function(){TweenMax.killChildTweensOf(this.tw),this.tw=null},i.prototype.onClick=function(t){switch(t.target){case this.buyBtn:var i=e.PlayerService.instance.playerInfo.getGold(),n=e.PlayerService.instance.playerInfo.getVipLevel();if(i<this.currentData.getGoldsNumber())return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");if(!this.CheckCiShuByCishu(n,this.currentData.getFrequency())){for(var o=this.cishuAll.length,a=e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_CISHUYIMAN"),s=0;o>s;s++){var r=this.cishuAll[s];if(r.cishu==this.currentData.getFrequency()){a=10>n?e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_VIPBUZU",r.vipLevel):e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_CISHUYIMAN");break}n==r.vipLevel&&8==this.currentData.getFrequency()&&20>=n&&(a=7==n?e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_VIPBUZU",10):10==n?e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_CISHUYIMAN"):e.LanguageUtils.instance.getValue("52KUANGHUAN_ZHAOCAIJINBAO_VIPBUZU",r.vipLevel))}return void e.PopUpController.getInstance().showFloatTextPanel1(a)}this.buyBtn.touchEnabled=!this.buyBtn.touchEnabled,this.buyBtn.currentState="down",this.movPlay()}},i.prototype.checkCishu=function(){var t=e.GlobalConfig.instance.getValue("ZCJB_VIP_CHISHU"),i=t.split(",");this.cishuAll=[];for(var n=i.length,o=0;n>o;o++){var a=i[o],s=new Object,r=a.split("_");s.vipLevel=Number(r[0]),s.cishu=Number(r[1]),this.cishuAll.push(s)}},i.prototype.CheckCiShuByCishu=function(e,t){var i=this.cishuAll.length;if(4>t)return!0;for(var n=0;i>n;n++){var o=this.cishuAll[n];if(10==o.vipLevel&&e>=10&&8==t)return!1;if(o.cishu==t&&o.vipLevel<=e)return!0}return!1},i.prototype.movPlay=function(){e.ActivityController.getIntance().playMc(),this.tw=TweenMax.delayedCall(3,this.delayCall.bind(this))},i.prototype.delayCall=function(){e.ActivityController.getIntance().sendMessageToSeverByLaborDayZhaoCaiJinBao(),this.tw=null},i.prototype.playMc=function(e,t){this.shuziGroup.playMc(e,t)},i.prototype.stopMc=function(e){this.shuziGroup.stopMc(e)},i.prototype.dengPlay=function(){this.deng_left.showDeng(),this.deng_right.showDeng()},i.prototype.changeState=function(){this.buyBtn.currentState="up",this.buyBtn.touchEnabled=!this.buyBtn.touchEnabled},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i}(eui.Component);e.ActivityLaborDayZhaoCaiJinBaoView=t,__reflect(t.prototype,"foxgame.ActivityLaborDayZhaoCaiJinBaoView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.MfsqRedPackModel,this.panel=new e.MfsqRedPackView(this.model)}return t.prototype.registerMsg=function(t){t.add(e.Code.REBATE_RED_PACK_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.REBATE_RED_PACK_S:console.log("121212");var n=i;0==n.getErrorNo()?this.model.setMfsqInfoData(n):80104==n.getErrorNo()?e.MainControler.instance.hideMfsqHongbao(!1):console.log("协议有误！")}},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showView=function(){this.panel.show()},t.prototype.sendHongBaoReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPRebateRechargeReq");e.Message.instance.send(e.Code.REBATE_RED_PACK_C,t,!0)},t.prototype.payBtnDisabled=function(e){this.panel.payBtnDisabled(e)},t.prototype.ttt=function(){this.model.testArray=[6],this.panel.initUI()},t}();e.MfsqRedPackController=t,__reflect(t.prototype,"foxgame.MfsqRedPackController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MfsqRedPackItem",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)},t.prototype.dataChanged=function(){this.dataInfo=this.data,this.init()},t.prototype.init=function(){this.btnIndx=Number(this.dataInfo.moneyIndex);var e=this.dataInfo.redPoint;this.hbMoney.text=this.dataInfo.moneyLevel+"元红包";var t=this.dataInfo.selected;t?this.btn.currentState="down":this.btn.currentState="up",this.redImg.visible=e},t.prototype.btnClickHandler=function(){var e=this.dataInfo.callBack;e&&e(this.btnIndx)},t}(eui.ItemRenderer);e.MfsqRedPackItem=t,__reflect(t.prototype,"foxgame.MfsqRedPackItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.curentTabMoney=1,this.currentTabIndex=0,this.testArray=[],this.observerList=[],this.hbMoneyDataSource=[],this.hbMoneyDataCollection=new eui.ArrayCollection,this.hbMoneyDataCollection.source=this.hbMoneyDataSource}return t.prototype.setMfsqInfoData=function(t){this.hideRedPointArray=[],this.hideRedPointArray=t.getPrice();var i=this.getmfsqhbData().length;this.hideRedPointArray.length==i&&e.MainControler.instance.hideMfsqHongbao(!1),this.updateView()},t.prototype.getmfsqhbData=function(){this.mfsqHbInfoArray=[];for(var t=e.ActivityController.getIntance().getModel().mfsqStageId,i=e.JsonDataManager.instance.mfsqHBVOArray,n=0;n<i.length;n++)i[n].stageId==t&&this.mfsqHbInfoArray.push(i[n]);return this.sortHbLevel(this.mfsqHbInfoArray)},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChanged()},t.prototype.sortHbLevel=function(e){for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-1-t;i++){var n=e[i],o=e[i+1];if(n.price>o.price){var a=e[i];e[i]=e[i+1],e[i+1]=a}}return e},t}();e.MfsqRedPackModel=t,__reflect(t.prototype,"foxgame.MfsqRedPackModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/mfsqRedPack/MfsqRedPackSkin.exml")||this;return i.model=e,i.isMask=!0,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.panelChanged=function(){this.getIsShow&&this.initUI()},i.prototype.initHook=function(){this.ui.rechargeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rechargeHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.initUI(),this.tabInfoSwitch()},i.prototype.initUI=function(){this.moneyDataInfo=[],this.moneyIndexArray=[],this.moneyLevelArray=[],this.mfsqHbInfoArray=[],this.mfsqHbInfoArray=this.model.mfsqHbInfoArray;for(var t,i=0;i<this.mfsqHbInfoArray.length;i++){t=this.mfsqHbInfoArray[i];var n=new Object;n.moneyIndex=t.id,n.moneyLevel=t.price,n.redPoint=!0,n.selected=!1,n.hbbgImg=t.bgImg,n.callBack=this.tabInfoSwitch.bind(this);var o=this.model.hideRedPointArray;if(o.length>0)for(var a=0;a<o.length;a++)if(t.price==o[a]){n.redPoint=!1;break}this.moneyIndexArray.push(String(t.id)),this.moneyLevelArray.push(String(t.price)),this.moneyDataInfo.push(n)}this.ui.mfscroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.ui.mfscroller.horizontalScrollBar.autoVisibility=!1,this.ui.mfscroller.scrollPolicyV=eui.ScrollPolicy.OFF;var s=new eui.TileLayout;s.requestedColumnCount=0,s.requestedRowCount=1,s.horizontalGap=-6,this.ui.mfscroller.viewport.scrollH=0;var r=this.ui.list;r.dataProvider=this.model.hbMoneyDataCollection,r.itemRenderer=e.MfsqRedPackItem,r.layout=s,this.model.hbMoneyDataSource=this.moneyDataInfo,this.model.hbMoneyDataCollection.replaceAll(this.model.hbMoneyDataSource),e.MfsqRedPackController.getInstance().payBtnDisabled(this.moneyDataInfo[this.model.currentTabIndex].redPoint)},i.prototype.initUIOld=function(){this.moneyDataInfo=[],this.moneyIndexArray=[],this.moneyLevelArray=[];for(var t=e.GlobalConfig.instance.getValue("MFSQHONGBAO"),i=t.split(","),n=0;n<i.length;n++){var o=new Object,a=i[n].split("_"),s=a[0],r=a[1];o.moneyIndex=s,o.moneyLevel=r,o.redPoint=!0,o.selected=!1,o.callBack=this.tabInfoSwitch.bind(this);var l=this.model.hideRedPointArray;if(l.length>0)for(var h=0;h<l.length;h++)if(Number(r)==l[h]){o.redPoint=!1;break}this.moneyIndexArray.push(s),this.moneyLevelArray.push(r),this.moneyDataInfo.push(o)}this.ui.mfscroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.ui.mfscroller.horizontalScrollBar.autoVisibility=!1,this.ui.mfscroller.scrollPolicyV=eui.ScrollPolicy.OFF;
var c=new eui.TileLayout;c.requestedColumnCount=0,c.requestedRowCount=1,c.horizontalGap=-6,this.ui.mfscroller.viewport.scrollH=0;var u=this.ui.list;u.dataProvider=this.model.hbMoneyDataCollection,u.itemRenderer=e.MfsqRedPackItem,u.layout=c,this.model.hbMoneyDataSource=this.moneyDataInfo,this.model.hbMoneyDataCollection.replaceAll(this.model.hbMoneyDataSource),e.MfsqRedPackController.getInstance().payBtnDisabled(this.moneyDataInfo[this.model.currentTabIndex].redPoint)},i.prototype.tabInfoSwitch=function(t){void 0===t&&(t=-1);var i;if(-1==t){var n=this.moneyDataInfo[0];i=n,this.selecedTab(n,0)}else for(var o=0;o<this.moneyDataInfo.length;o++){var a=this.moneyDataInfo[o];a.moneyIndex==t?(i=a,this.selecedTab(a,o)):a.selected=!1}this.model.hbMoneyDataSource=this.moneyDataInfo,this.model.hbMoneyDataCollection.replaceAll(this.model.hbMoneyDataSource),e.MfsqRedPackController.getInstance().payBtnDisabled(i.redPoint)},i.prototype.selecedTab=function(e,t){e.selected=!0,this.ui.hbInfoBg.source=e.hbbgImg,this.model.curentTabMoney=e.moneyLevel,this.model.currentTabIndex=t},i.prototype.rechargeHandler=function(){var t,i=e.JsonDataManager.instance.mfsqRechargeTemplate,n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(a.costMoney==this.model.curentTabMoney){t=a;break}}var s={};s.goodsId=t.productId,s.productName=t.productName,s.orderMoney=t.costMoney,s.diamondNum=t.amount,s.giftDiamondNum=t.addNum,e.RechargeController.getInstance().setPayData(s);var r=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");r.setGoodsId(t.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,r,!0)},i.prototype.payBtnDisabled=function(e){this.ui.rechargeBtn.enabled=e},i.prototype.helpHandler=function(){e.HelpController.getInstance().showPanel("MFSQHONGBAO")},i}(e.BasePanel);e.MfsqRedPackView=t,__reflect(t.prototype,"foxgame.MfsqRedPackView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.tongguanguanka=1]="tongguanguanka",e[e.getlevel=2]="getlevel",e[e.equipByOne=3]="equipByOne",e[e.ronglianNum=4]="ronglianNum",e[e.equipQianghua=5]="equipQianghua",e[e.euqipUpStar=6]="euqipUpStar",e[e.chibangshengji=7]="chibangshengji",e[e.chibangshengxing=8]="chibangshengxing",e[e.roleSkillLevel=9]="roleSkillLevel",e[e.personBossTimes=10]="personBossTimes",e[e.baoshiLevelAll=11]="baoshiLevelAll",e[e.yewaiPkTimes=12]="yewaiPkTimes",e[e.jingjichangTimes=13]="jingjichangTimes",e[e.tiaozhanshenyuan=14]="tiaozhanshenyuan",e[e.skillAllLevel=15]="skillAllLevel",e[e.qianghuaallLevel=16]="qianghuaallLevel",e[e.wingUpLevel=17]="wingUpLevel",e[e.wingUpStar=18]="wingUpStar",e[e.baoshiAllLevel=19]="baoshiAllLevel",e[e.allZhanLi=20]="allZhanLi",e[e.bayeEquipAllLevel=21]="bayeEquipAllLevel",e[e.shenqiAllJie=22]="shenqiAllJie",e[e.shenqiAllFuWen=23]="shenqiAllFuWen",e[e.equipgongmingLevel=24]="equipgongmingLevel",e[e.hunyiAllLevel=25]="hunyiAllLevel",e[e.ringAllLevel=26]="ringAllLevel",e[e.shopDemonCost=27]="shopDemonCost",e[e.equipFuBenTimes=28]="equipFuBenTimes",e[e.baoshiFuBenTimes=29]="baoshiFuBenTimes",e[e.skillLevelUpTimes=30]="skillLevelUpTimes",e[e.worldChatTimes=31]="worldChatTimes",e[e.singleWingLevel=32]="singleWingLevel",e[e.shenzhuangzhuliang=33]="shenzhuangzhuliang",e[e.singleBaoshiLevel=34]="singleBaoshiLevel",e[e.euqipQiangHuaLevel=35]="euqipQiangHuaLevel",e[e.euqipUpStarLevel=36]="euqipUpStarLevel"}(t=e.activityDaBiaoType||(e.activityDaBiaoType={}));var i;!function(e){e[e.dating=1]="dating",e[e.huikui=7]="huikui",e[e.kuanghuan=8]="kuanghuan",e[e.xianshi=9]="xianshi",e[e.kuafubangdan=10]="kuafubangdan"}(i=e.activityListType||(e.activityListType={}));var n=function(){function i(){this.havaGetdafuwengAwards=!1,this.dabiaoHuoDongType=0,this.scrollV_num=0,this.kuafuEndTime=0,this.kuafuCloseTime=0,this.chongzhiEndTime=0,this.chongzhiCloseTime=0,this.xiaofeiEndTime=0,this.xiaofeiCloseTime=0,this.zhanliEndTime=0,this.zhanliCloseTime=0,this.dengjiEndTime=0,this.dengjiCloseTime=0,this.mfslSceneId="",this.guidIndex=-1,this._rechargeRebateData=null,this.dataSource=[],this.kuafuBangDanDataSouce=[],this.dataSource_chengzhangjijin=[],this.dataSource_dabiao=[],this.dataSource_bottom=[],this.dataSource_JuBaoPenAward_yuanbao=[],this.dataSource_JuBaoPenAward_exp=[],this.dataSource_JuBaoPenAward_tongbi=[],this.dataSource_tongjinzhu=[],this.dataSource_zajindan=[],this.dataSource_lianxuchongzhi=[],this.dataSource_quanminfuli=[],this.dataSource_LaborDayLeiJiChongZhi=[],this.dataSource_LaborDayDengLuJiangLi=[],this.dataSource_LaborDayLeiJiXiaoFei=[],this.dataSource_LaborDayChaoZhiLiBao=[],this.dataSource_HuiKuiLeiChong=[],this.dataSource_HuiKuiZaiXian=[],this.dataSource_HuiKuiXianGou=[],this.dataSource_HuiKuikuanghuan_denglu=[],this.dataSource_HuiKuikuanghuan_xunbao=[],this.dataSource_HuiKuikuanghuan_zhanli=[],this.dataSource_HuiKuikuanghuan_yewai=[],this.dataSource_leijixiaohao=[],this.dataSource_xiaohaopaiming=[],this.dataSource_bottom_labor=[],this.dataSource_bottom_huikui=[],this.datasource_dafuwengRank=[],this.advertisingDataList=[],this.bangdanDataSource_bottom=[],this.collection=new eui.ArrayCollection,this.collection.source=this.dataSource,this.kuafuBangDanCollection=new eui.ArrayCollection,this.kuafuBangDanCollection.source=this.kuafuBangDanDataSouce,this.collection_chengzhangjijin=new eui.ArrayCollection,this.collection_chengzhangjijin.source=this.dataSource_chengzhangjijin,this.collection_dabiao=new eui.ArrayCollection,this.collection_dabiao.source=this.dataSource_dabiao,this.collection_kaifu=new eui.ArrayCollection,this.collection_kaifu.source=this.dataSource_kaifu,this.collection_bottom=new eui.ArrayCollection,this.collection_bottom.source=this.dataSource_bottom,this.collection_bottom_labor=new eui.ArrayCollection,this.collection_bottom_labor.source=this.dataSource_bottom_labor,this.collection_paihang=new eui.ArrayCollection,this.collection_paihang.source=[],this.collection_JuBaoPenAward_yuanbao=new eui.ArrayCollection,this.collection_JuBaoPenAward_yuanbao.source=this.dataSource_JuBaoPenAward_yuanbao,this.collection_JuBaoPenAward_exp=new eui.ArrayCollection,this.collection_JuBaoPenAward_exp.source=this.dataSource_JuBaoPenAward_exp,this.collection_JuBaoPenAward_tongbi=new eui.ArrayCollection,this.collection_JuBaoPenAward_tongbi.source=this.dataSource_JuBaoPenAward_tongbi,this.collection_tongjinzhu=new eui.ArrayCollection,this.collection_tongjinzhu.source=this.dataSource_tongjinzhu,this.collection_zajindan=new eui.ArrayCollection,this.collection_zajindan.source=this.dataSource_zajindan,this.collection_lianxuchongzhi=new eui.ArrayCollection,this.collection_lianxuchongzhi.source=this.dataSource_lianxuchongzhi,this.collection_quanminfuli=new eui.ArrayCollection,this.collection_quanminfuli.source=this.dataSource_quanminfuli,this.collection_LaborDayLeiJiChongZhi=new eui.ArrayCollection,this.collection_LaborDayLeiJiChongZhi.source=this.dataSource_LaborDayLeiJiChongZhi,this.collection_LaborDayDengLuJiangLi=new eui.ArrayCollection,this.collection_LaborDayDengLuJiangLi.source=this.dataSource_LaborDayDengLuJiangLi,this.collection_LaborDayLeuiJiXiaoFei=new eui.ArrayCollection,this.collection_LaborDayLeuiJiXiaoFei.source=this.dataSource_LaborDayLeiJiXiaoFei,this.collection_LaborDayChaoZhiLiBao=new eui.ArrayCollection,this.collection_LaborDayChaoZhiLiBao.source=this.dataSource_LaborDayChaoZhiLiBao,this.collection_HuiKuiLeiChong=new eui.ArrayCollection,this.collection_HuiKuiLeiChong.source=this.dataSource_HuiKuiLeiChong,this.collection_HuiKuiZaiXian=new eui.ArrayCollection,this.collection_HuiKuiZaiXian.source=this.dataSource_HuiKuiZaiXian,this.collection_HuiKuiXianGou=new eui.ArrayCollection,this.collection_HuiKuiXianGou.source=this.dataSource_HuiKuiXianGou,this.collection_HuiKuikuanghuan_denglu=new eui.ArrayCollection,this.collection_HuiKuikuanghuan_denglu.source=this.dataSource_HuiKuikuanghuan_denglu,this.collection_HuiKuikuanghuan_xunbao=new eui.ArrayCollection,this.collection_HuiKuikuanghuan_xunbao.source=this.dataSource_HuiKuikuanghuan_xunbao,this.collection_HuiKuikuanghuan_zhanli=new eui.ArrayCollection,this.collection_HuiKuikuanghuan_zhanli.source=this.dataSource_HuiKuikuanghuan_zhanli,this.collection_HuiKuikuanghuan_yewai=new eui.ArrayCollection,this.collection_HuiKuikuanghuan_yewai.source=this.dataSource_HuiKuikuanghuan_yewai,this.collection_leijixiaohao=new eui.ArrayCollection,this.collection_leijixiaohao.source=this.dataSource_leijixiaohao,this.collection_xiaohaopaiming=new eui.ArrayCollection,this.collection_xiaohaopaiming.source=this.dataSource_xiaohaopaiming,this.collection_bottom_huikui=new eui.ArrayCollection,this.collection_bottom_huikui.source=this.dataSource_bottom_huikui,this.collection_dafuwengRank=new eui.ArrayCollection,this.collection_dafuwengRank.source=this.datasource_dafuwengRank,this.observerList=[],this.datingRedPointArr=[],this._huikuiRedPointArr=[!1,!1,!1,!1],this._kuanghuanRedPointArr=[!1,!1,!1,!1,!1],this.shenzhuangNum=e.BagController.getInstance().getTotalRedEquipCount(),this.xianshiActivityList=[],this._resultPoint=new egret.Point,this.bangdanCollection_bottom=new eui.ArrayCollection,this.bangdanCollection_bottom.source=this.bangdanDataSource_bottom,this.meirichongzhiCollection=new eui.ArrayCollection,this.meirichongzhiCollection.source=this.meirichongzhiDataSource}return i.prototype.setCurrentKaiQiTime=function(e){this.kaiQiShiJian=e},i.prototype.getCurrentKaiQiTime=function(){return this.kaiQiShiJian},i.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},i.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChanged()},i.prototype.leijiChongZhi=function(t){this._chongzhileiji=t;for(var i=!1,n=this._chongzhileiji.getAwardsInfo(),o=n.length,a=this._chongzhileiji.getAccRechargeGold(),s=this._chongzhileiji.getGotAwardCfgId(),r=s.length,l=[],h=[],c=0;o>c;c++){var u=n[c],p=u.getStepNumber();if(a>=p)for(var g=0;r>g;g++){if(s[g]==u.getId()){i=!1;break}i=!0}i?h.push(u):l.push(u)}h=h.concat(l),this._chongzhileiji.setAwardsInfo(h);var d=new Object;d.type=e.activityDaTingType.leijichongzhi,d.value=i,this.datingRedPointArr[""+e.activityDaTingType.leijichongzhi]=d,this.callBackPoint()},i.prototype.quanminfuli=function(t){this._quanminfuli=t;for(var i,n=this._quanminfuli.getInfos(),o=e.JsonDataManager.instance.quanminfuliArr,a=o.length,s=0,r=e.PlayerService.instance.playerInfo.getGold(),l=n.length,h=!1,c=0;l>c;c++)for(var u=n[c],p=0;a>p;p++)if(i=o[p],i.id==u.getId()&&(s=i.presentPrice,i.buyCount>u.getBuyNumber()&&r>=s)){h=!0;break}var g=new Object;g.type=e.activityDaTingType.allPlayerfuli,g.value=h,this.datingRedPointArr[""+e.activityDaTingType.allPlayerfuli]=g,this.callBackPoint()},i.prototype.dabiaohuodong=function(t){this._dabiaohuodong=t;this._dabiaohuodong.getProgressId();this.dabiaoHuoDongType=this._dabiaohuodong.getTargetType();var i=new Object;i.type=e.activityDaTingType.dabiaohuodong;var n=this._dabiaohuodong.getGearsAwardsInfo()[this._dabiaohuodong.getProgressId()-1],o=this._dabiaohuodong.getProgress(),a=Long.fromValue(n.getCond()),s=Long.fromValue(o);a.greaterThan(s)||1==this._dabiaohuodong.getReceiveStatus()?i.value=!1:i.value=!0,this.datingRedPointArr[""+e.activityDaTingType.dabiaohuodong]=i,this.callBackPoint()},i.prototype.setshareData=function(e){},i.prototype.setsharingData=function(e){},i.prototype.meirixianli=function(t){this._meirixianli=t,this.updateView();var i=e.ActivityController.getIntance().isMeiRiXianLiPanelFirstShow();i&&e.ActivityController.getIntance().setMeiRiXianLiFirstShow(!1);var n=!1,o=e.JsonDataManager.instance.AccRechargeArr;if(!o)return void console.warn("JsonDataManager.instance.AccRechargeArr undefined");var a=o[0],s=this._meirixianli.getGotAwardCfgId(),r=this._meirixianli.getAccRechargeGold();if(r>a.sum){for(var l=s.length,h=0;l>h;h++){var c=s[h];if(c==a.id)return}n=!0}var u=new Object;u.type=e.activityDaTingType.meirixianli,u.value=n,this.datingRedPointArr[""+e.activityDaTingType.meirixianli]=u,this.callBackPoint()},i.prototype.chengzhangjijin=function(t){this._chengzhangjijin=t,this.updateView();var i=!1;t.getIsBuy()&&t.getCanGetIds().length>0&&(i=!0);var n=new Object;n.type=e.activityDaTingType.chengzhangjijin,n.value=i,this.datingRedPointArr[""+e.activityDaTingType.chengzhangjijin]=n,this.callBackPoint(),e.ActivityBarController.getInstance().setChengZhangJiJinRedPoint(i)},i.prototype.chongzhipaiming=function(t){this._chongzhipaiming=t;var i=new Object;i.type=e.activityDaTingType.chongzhipaiming,i.value=!1,this.datingRedPointArr[""+e.activityDaTingType.chongzhipaiming]=i,this.callBackPoint()},i.prototype.kaifulibao=function(t){this._kaifulibao=t;for(var i=this._kaifulibao.getInfos(),n=e.JsonDataManager.instance.openServerGiftArr,o=i.length,a=n.length,s=0,r=e.PlayerService.instance.playerInfo.getGold(),l=!1,h=0;o>h;h++)for(var c=i[h],u=0;a>u;u++){var p=n[u];if(this._kaifulibao.getDays()==p.days&&c.getId()==p.id&&(s=p.presentPrice,r>=s&&c.getBuyCount()<p.buyCount)){l=!0;break}}var g=new Object;g.type=e.activityDaTingType.kaifulibao,g.value=l,this.datingRedPointArr[""+e.activityDaTingType.kaifulibao]=g,this.callBackPoint()},i.prototype.setListData=function(t){var i=e.JsonDataManager.instance.activityTimeArr,n=(i.length,t.getActivity(),t.getActivity()),o=n.length;this.xianshiActivityList=[];var a=!1,s=!1,r=!1,l=!1,h=!1,c=!1,u=!1,p=!1,g=!1,d=!1,f=!1,m=!1,y=!1;this.jijin_canshow=!1,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.LIBAO0YUAN,!1);for(var I=0;o>I;I++){var v=n[I];v&&v.getActivityId()==e.ActivityId.JUBAOPEN||(v&&v.getActivityId()==e.ActivityId.TONGJINZHU?a=!0:v&&v.getActivityId()==e.ActivityId.ZAJINDAN?s=!0:v&&v.getActivityId()==e.ActivityKuangHuanId.DENGLUZENGLI?r=!0:v&&7==v.getOpenPlace()?l=!0:v&&v.getActivityId()==e.ActivityId.ZHAUNPAN?h=!0:v&&v.getActivityId()==e.ActivityId.DAFUWENG?c=!0:v&&v.getActivityId()==e.ActivityId.RECHARGE_REBATE?u=!0:v&&v.getActivityId()==e.ActivityId.ZEROPACKAGE?e.ActivityController.getIntance().sendZERO_PACKATE_C():v&&v.getActivityId()==e.ActivityId.WB_ADD_RECHARGE?e.ShareWanbaControler.getInstance().sendWAN_BA_RECHARGE_INFO_C():v&&v.getActivityId()==e.ActivityId.WB_ADD_LOGIN?e.ShareWanbaControler.getInstance().sendWAN_BA_LOGIN_INF_C():v&&9==v.getOpenPlace()?(p=!0,this.xianshiActivityList.push(v)):v&&v.getActivityId()==e.activityDaTingType.chengzhangjijin?this.jijin_canshow=!0:v&&v.getActivityId()==e.ActivityId.XUNBAOZHEKOU?(d=!0,e.SearchTreasureController.getInstance().sendTreasureSale()):v&&v.getActivityId()==e.ActivityId.ADVERTISING?g=!0:v&&v.getActivityId()==e.ActivityId.KUAFUCHONGZHI||v.getActivityId()==e.ActivityId.KUAFUDENGJI||v.getActivityId()==e.ActivityId.KUAFUXIAOFEI||v.getActivityId()==e.ActivityId.KUAFUZHANLI?f=!0:v&&v.getActivityId()==e.ActivityId.MEIRICHONGZHI?(e.ActivityController.getIntance().sendMessageToMeiRiChongzhi(),m=!0):v&&v.getActivityId()==e.ActivityId.MFSQHONGBAO&&(e.MfsqRedPackController.getInstance().sendHongBaoReq(),this.mfsqStageId=v.getStageId(),y=!0))}if(this.jijin_canshow){var _=e.PlayerService.instance.missionList[0];_.getId()>e.MainUiGuideValue.TASK_ID_600032_K?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JIJIN,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JIJIN,!1)}else e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JIJIN,!1);p&&(e.ActivityXianShiController.getIntance().updataView(),e.ActivityXianShiController.getIntance().startGetData()),e.MainControler.instance.hideMfsqHongbao(y),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KUAFUBANGDAN,f),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.MEIRICHONGZHI,m),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.TONGJINZHU,a),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ZAJINDAN,s),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KUANGHUAN,r),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.HUIKUI,l),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ZHUANPAN,h),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.DAFUWENG,c),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.DAFANLI,u),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.CHANNELSHARING,"qqgame"==window.GJlenged_chanel),e.ActivityBarController.getInstance().getAdvertisingState(g);var T=e.ActivityBarController.getInstance().getpanel().getGroupList();d||(T[e.ActivityBtnType.XUNBAO].btn.$children[0].source="xunbaoxb_png");var C=!1,A=e.PlayerService.instance.missionList[0];A&&(A.getId()>e.MainUiGuideValue.TASK_ID_600022?C=!0:A.getId()==e.MainUiGuideValue.TASK_ID_600022&&A.getTag()&&(C=!0)),C?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XIANSHI,p):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XIANSHI,!1),this.listDataArr=t},i.prototype.getxianshiListData=function(){return this.xianshiActivityList},i.prototype.checkActivityHas=function(e){for(var t=this.getListData().getActivity(),i=t.length,n=0;i>n;n++){var o=t[n];if(o.getActivityId()==e)return!0}return!1},i.prototype.getActivityById=function(e){if(this.listDataArr){var t=this.listDataArr.getActivity();if(t&&t.length>0)for(var i=t.length,n=0;i>n;n++){var o=t[n];if(o.getActivityId()==e)return o}}return null},i.prototype.lianxuChongZhi=function(t){this._lianxuchongzhi=t;var i=this._lianxuchongzhi.getGotAwardCfgId(),n=this._lianxuchongzhi.getContinueRechargedays(),o=new Object;o.type=e.activityDaTingType.lianxuchongzhi,i[i.length-1]<n?o.value=!0:o.value=!1,this.datingRedPointArr[""+e.activityDaTingType.lianxuchongzhi]=o,this.callBackPoint()},i.prototype.setLeiJiChongZhiAward=function(t){App.SoundManager().playEffect("sound_award_mp3"),this._reflush=!0,e.ActivityController.getIntance().sendMessageToSeverByLeiJiChongZhi()},i.prototype.setLeiJiXiaoHaoAward=function(t){App.SoundManager().playEffect("sound_award_mp3"),this._reflush=!0,e.ActivityController.getIntance().sendMessageToSeverBylianxuchongzhihongli()},i.prototype.setLeiJiChongZhiLaborDayAward=function(t){App.SoundManager().playEffect("sound_award_mp3"),this._51reflush=!0,e.ActivityController.getIntance().ActivityLaborDaySendMsgByLeiJiChongZhi()},i.prototype.setLeiJiXiaoFeiLaborDayAward=function(t){App.SoundManager().playEffect("sound_award_mp3"),this._51reflush=!0,e.ActivityController.getIntance().ActivityLaborDaySendMsgByXiaoFeiZengLi()},i.prototype.setChaoZhiLiBaoLaborDayAward=function(t){this._51reflush=!0,e.ActivityController.getIntance().ActivityLaborDaySendMsgByChaoZhiLiBao()},i.prototype.setZhaoCaiJinBaoLaborDayAward=function(t){this._51reflush=!0,this._laborDayZhaoCaiJinBaoAward=t,e.ActivityController.getIntance().ActivityLaborDaySendMsgByZhaoCaiJinBao(),e.ActivityController.getIntance().stopMc(t)},i.prototype.getZhaoCaiJinBaoLaborDayAward=function(){return this._51reflush=!0,this._laborDayZhaoCaiJinBaoAward},i.prototype.setDengLuJiangLiLaborDayAward=function(t){App.SoundManager().playEffect("sound_award_mp3"),this._51reflush=!0,e.ActivityController.getIntance().ActivityLaborDaySendMsgByDengLuJiangLi()},i.prototype.setDengLuJiangLiLaborDayData=function(e){this._laborDayDengLuJiangLiData=e;var t=e.getLoginDays(),i=e.getAwardsInfo(),n=e.getGotAwardCfgId(),o=0,a=i.length,s=!1;for(o;a>o;o++){var r=i[o];if(t>=r.getId()){var l=0,h=n.length;for(s=!0,l;h>l;l++)if(n[l]==r.getId()){s=!1;break}if(s)break}}this._kuanghuanRedPointArr[4]=s,this.checkKuangHuanRedPoint()},i.prototype.setLeiJiXiaoFeiLaborDayData=function(e){this._laborDayLeiJiXiaoFeiData=e;var t=e.getAccRechargeGold(),i=e.getAwardsInfo(),n=e.getGotAwardCfgId(),o=0,a=i.length,s=!1;for(o;a>o;o++){var r=i[o];if(t>=r.getStepNumber()){var l=0,h=n.length;for(s=!0,l;h>l;l++)if(n[l]==r.getId()){s=!1;break}if(s)break}}this._kuanghuanRedPointArr[3]=s,this.checkKuangHuanRedPoint()},i.prototype.setChaoZhiLiBaoLaborDayData=function(e){this._laborDayChaoZhiLiBaoData=e;var t=e.getAwardsInfo(),i=0,n=t.length,o=!1;for(i;n>i;i++){var a=t[i];if(!a.getState()){o=!0;break}}this._kuanghuanRedPointArr[1]=o,this.checkKuangHuanRedPoint()},i.prototype.setZhaoCaiJinBaoLaborDayData=function(t){this._laborDayZhaoCaiJinBaoData=t;var i=e.PlayerService.instance.playerInfo.getVipLevel(),n=!1;this.CheckCiShuByCishu(i,t.getFrequency())&&(n=!0),this._kuanghuanRedPointArr[2]=n,this.checkKuangHuanRedPoint()},i.prototype.CheckCiShuByCishu=function(t,i){for(var n=e.GlobalConfig.instance.getValue("ZCJB_VIP_CHISHU"),o=n.split(","),a=[],s=o.length,r=0;s>r;r++){var l=o[r],h=new Object,c=l.split("_");h.vipLevel=Number(c[0]),h.cishu=Number(c[1]),a.push(h)}var u=a.length;if(4>i)return!0;for(var r=0;u>r;r++){var h=a[r];if(10==h.vipLevel&&t>=10&&8==i)return!1;if(h.cishu==i&&h.vipLevel<=t)return!0}return!1},i.prototype.setLaborDayLog=function(e){this._laborDayZhaoCaiJinBaoLog=e},i.prototype.getLaborDayLog=function(){return this._laborDayZhaoCaiJinBaoLog},i.prototype.setHuiKuiLeiChongData=function(e){this._huikuiLeiChongData=e;for(var t=e.getConfigInfo(),i=t.length,n=!1,o=0;i>o;o++){var a=t[o];if(a.getCond()<=e.getRecharge()&&!a.getIsAward()){n=!0;break}}this._huikuiRedPointArr[1]=n,this.checkHuiKuiRedPoint()},i.prototype.getHuiKuiLeiChongData=function(){return this._huikuiLeiChongData},i.prototype.setHuiKuiZaiXianData=function(t){this._huikuizaixianData=t;for(var i=t.getConfigInfo(),n=i.length,o=!1,a=!1,s=[],r=0;n>r;r++){var l=i[r];60*l.getCond()<=t.getAccOnlineTime()&&!l.getIsAward()?o=!0:s.push(l.getCond()),a=!0}a&&e.ActivityController.getIntance().onTickToHuiKuiZaiXian(t.getAccOnlineTime(),s),this._huikuiRedPointArr[3]=o,this.checkHuiKuiRedPoint()},i.prototype.setleichongxiaohao=function(t){this._leichongxiaohao=t;var i=!1,n=t.getAwardsInfo(),o=n.length,a=0,s=t.getGotAwardCfgId(),r=s.length,l=t.getAccRechargeGold();for(a;o>a;a++){var h=n[a],c=0;if(h.getStepNumber()>l)break;for(i=!0,c;r>c;c++){var u=s[c];if(u==h.getId()){i=!1;break}i=!0}if(i)break}var p=new Object;p.type=e.activityDaTingType.lianxuchongzhihongli,p.value=i,this.datingRedPointArr[""+e.activityDaTingType.lianxuchongzhihongli]=p,this.callBackPoint()},i.prototype.setxiaofeipaihang=function(e){this._xiaofeipaimingData=e},i.prototype.getxiaofeipaihang=function(){return this._xiaofeipaimingData},i.prototype.getleichongxiaohao=function(){return this._leichongxiaohao},i.prototype.getHuiKuiZaiXianData=function(){return this._huikuizaixianData},Object.defineProperty(i.prototype,"resultPoint",{get:function(){return this._resultPoint},set:function(e){this._resultPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"curTouziNum",{get:function(){return this._curTouziNum},set:function(e){this._curTouziNum=e},enumerable:!0,configurable:!0}),i.prototype.setHuiKuiXianGouData=function(t){this._huikuixiangoulibaoData=t;for(var i=t.getGiftInfos(),n=i.length,o=!1,a=e.PlayerService.instance.playerInfo.getVipLevel(),s=e.PlayerService.instance.playerInfo.getCoin(),r=e.PlayerService.instance.playerInfo.getGold(),l=0;n>l;l++){var h=i[l],c=!1;if(h.getNum()-h.getBuyTimes()!=0&&h.getVipLimit()<=a){var u=new e.AttributeVO(h.getCurrPrice());if(0==h.getVipLimit()){var p=h.getPriceEd(),g=new e.AttributeVO(p);c=1002==g.type?s>=u.value:r>=u.value}else c=r>=u.value}if(o=c)break}this._huikuiRedPointArr[2]=o,this.checkHuiKuiRedPoint()},i.prototype.getHuiKuiXianGouData=function(){return this._huikuixiangoulibaoData},i.prototype.setHuiKuiKuangHuanData=function(e){this._huikuiquanminkuanghuanData=e;for(var t=e.getConfigInfo(),i=t.length,n=!1,o=0;i>o;o++){var a=t[o];if(a.getCond()<=a.getProgress()&&!a.getIsAward()){n=!0;break}}this._huikuiRedPointArr[0]=n,this.checkHuiKuiRedPoint()},i.prototype.getHuiKuiRedPointData=function(){return this._huikuiRedPointArr},i.prototype.checkHuiKuiRedPoint=function(){for(var t=this._huikuiRedPointArr.length,i=0;t>i;i++){var n=this._huikuiRedPointArr[i];if(n)return e.ActivityBarController.getInstance().setHuiKuiRedPoint(!0),this.updateView()}e.ActivityBarController.getInstance().setHuiKuiRedPoint(!1),this.updateView()},i.prototype.getKuangHuanRedPointData=function(){return this._kuanghuanRedPointArr},i.prototype.checkKuangHuanRedPoint=function(){for(var t=this._kuanghuanRedPointArr.length,i=0;t>i;i++){var n=this._kuanghuanRedPointArr[i];if(n)return e.ActivityBarController.getInstance().setKuangHuanRedPoint(!0),this.updateView()}e.ActivityBarController.getInstance().setKuangHuanRedPoint(!1),this.updateView()},i.prototype.getHuiKuiKuangHuanData=function(){return this._huikuiquanminkuanghuanData},i.prototype.setHuiKuiLeiChongAwardData=function(t){App.SoundManager().playEffect("sound_award_mp3"),e.ActivityController.getIntance().sendmessagetoServerByHuiKuiLeiChong()},i.prototype.setHuiKuiZaiXianAwardData=function(t){App.SoundManager().playEffect("sound_award_mp3"),e.ActivityController.getIntance().sendmessagetoServerByHuiKuiZaiXian()},i.prototype.setHuiKuiLiBaoAwardData=function(t){e.ActivityController.getIntance().sendmessagetoServerByHuiKuiXianGou()},i.prototype.setHuiKuiKuangHuanAwardData=function(t){App.SoundManager().playEffect("sound_award_mp3"),e.ActivityController.getIntance().sendmessagetoServerByHuiKuiKuangHuan()},i.prototype.getZhaoCaiJinBaoLaborDayData=function(){return this._laborDayZhaoCaiJinBaoData},i.prototype.getChaoZhiLiBaoLaborDayData=function(){return this._laborDayChaoZhiLiBaoData},i.prototype.getLeiJiXiaoFeiLaborDayData=function(){return this._laborDayLeiJiXiaoFeiData},i.prototype.getDengLuJiangLiLaborDayData=function(){return this._laborDayDengLuJiangLiData},i.prototype.setQuanMinFuLiAward=function(t){this._reflush=!0,e.ActivityController.getIntance().sendMessageToSeverByQuanMinFuLi()},i.prototype.setlianChongFanLiAward=function(t){this._reflush=!0,e.ActivityController.getIntance().sendMessageToSeverByLianXuChongZhi()},i.prototype.setKaiFuLiBao=function(t){this._reflush=!0,e.ActivityController.getIntance().sendMessageToSeverByKaiFuLiBao()},i.prototype.setMeiRiXianLi=function(t){e.ActivityController.getIntance().sendMessageToSeverByMeiRiXianLi()},i.prototype.setinviteData=function(e){},i.prototype.setgetData=function(e){},i.prototype.setJuBaoPenData=function(t){this._jubaopen=t;var i=this._jubaopen.getSubStatuList().length;this.updateView();for(var n=0;i>n;n++){var o=this._jubaopen.getSubStatuList()[n];if(o.getState())for(var a=o.getContinueDays(),s=o.getInfos(),r=s.length,l=0;r>l;l++){var h=s[l];if(h.getDays()==a&&!h.getInfo())return e.ActivityBarController.getInstance().setJubaopenRedPoint(!0)}}e.ActivityBarController.getInstance().setJubaopenRedPoint(!1)},i.prototype.setChengZhangJiJinAward=function(t){App.SoundManager().playEffect("sound_award_mp3"),this._reflush=!0,e.ActivityController.getIntance().sendMessageToSeverByChengZhangJiJin()},i.prototype.setDaBiaoHuoDongAward=function(t){1==t.getResult()&&App.SoundManager().playEffect("sound_award_mp3"),e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong()},i.prototype.setTongJinZhuData=function(t){this._tongjinzhu=t;var i=this._tongjinzhu.getRemainderNumber(),n=!1;n=i>0?!0:!1,e.ActivityBarController.getInstance().setTongJinZhuRedPoint(n),this.updateView()},i.prototype.setZaJinDanData=function(t){this._zajindan=t;for(var i=this._zajindan.getEveryDaybreakNumber(),n=!0,o=this._zajindan.getBreakEggList(),a=o.length,s=0;a>s;s++){var r=o[s];if(!r.getAwards()||""==r.getAwards()){n=!1;break}}n=i>0?!0:!1,e.ActivityBarController.getInstance().setZaJinDanRedPoint(n),this.updateView()},i.prototype.setDafuWengInfoData=function(t){var i=this;if(0==t.getErrorNo()){1==t.getDropState()&&e.ActivityController.getIntance().sendmessageDafuwengAward();var n=t.getPlayerInfo();n.forEach(function(t){t.getPlayerId()==e.PlayerService.instance.playerId&&(78==t.getId()?i.havaGetdafuwengAwards=!0:i.havaGetdafuwengAwards=!1)}),this._dafuwengInfo=t;var o=t.getTimes(),a=!1;a=o>0&&!this.havaGetdafuwengAwards?!0:!1,e.ActivityBarController.getInstance().setDafuwengRedPoint(a),this.updateView()}},i.prototype.setDafuwengRankData=function(e){0==e.getErrorNo()&&(this._dafuwengRankData=e,this.updateView())},i.prototype.setDafuWengRefreshTimeData=function(t){this._dafuwengRefreshTimesData=t,this.dafuwengCurRefreshTimes=t.getRefreshTime(),this.dafuwengRefreshBoolState=t.getState(),e.ActivityController.getIntance().onTickDafuwengRefreshTimes(this.dafuwengCurRefreshTimes),this.updateView()},i.prototype.setLaborDayLeiJiChongZhiData=function(e){this._51reflush=!0,this._laborDayLeiJiChongZhiData=e;var t=e.getAccRechargeGold(),i=e.getAwardsInfo(),n=e.getGotAwardCfgId(),o=0,a=i.length,s=!1;for(o;a>o;o++){var r=i[o];if(t>=r.getStepNumber()){var l=0,h=n.length;for(s=!0,l;h>l;l++)if(n[l]==r.getId()){s=!1;break}if(s)break}}this._kuanghuanRedPointArr[0]=s,this.checkKuangHuanRedPoint()},i.prototype.setAdvertisingInfoData=function(e){this.advertisingDataList=[];for(var t,i=0;i<e.getGroomInfo().length;i++)t=e.getGroomInfo()[i],this.advertisingDataList.push(t);this.showAdvertisingPanel()},i.prototype.showAdvertisingPanel=function(){this.advertisingDataList.length>0&&e.ActivityController.getIntance().showAdvertising()},i.prototype.setKuaFuBandanData=function(t){if(0==t.getErrorNo()){this.kuafubangdanpaiming=t;var i=new Object;switch(i.type=e.activityDaTingType.kfchongzhipaihang,i.value=!1,t.getActivity()){case e.ActivityId.KUAFUCHONGZHI:e.ActivityController.getIntance().showKFchongzhipaiming();break;case e.ActivityId.KUAFUXIAOFEI:e.ActivityController.getIntance().showKFXiaoFeipaiming();break;case e.ActivityId.KUAFUZHANLI:e.ActivityController.getIntance().showKFZhanLipaiming();break;case e.ActivityId.KUAFUDENGJI:e.ActivityController.getIntance().showKFDengjipaiming()}}},i.prototype.setNewXianShiGiftData=function(t){this.newXianShiGiftData=t,console.log("时间：发送请求前"),e.ActivityController.getIntance().senMessageToGetServerTime(),console.log("时间：发送请求后")},i.prototype.setServerCurrentData=function(t){console.log("时间：---接收到数据---"),this.currentServerTime=t;var i=this.newXianShiGiftData.getDateTime(),n=t.getDateTime(),o=!0;this.newXianShiGiftData.getMoney()==e.NewXianGouType.YIYUAN?(this.currentXianGouType=e.NewXianGouType.YIYUAN,n>=i?e.ActivityController.getIntance().sendMessageToNewXianShiData():e.ActivityController.getIntance().newXianshiUicounDown(i-n)):this.newXianShiGiftData.getMoney()==e.NewXianGouType.SANYUAN&&(this.currentXianGouType=e.NewXianGouType.SANYUAN,n>=i||2==this.newXianShiGiftData.getState()?(e.ActivityController.getIntance().cleanXianShiCountDown(),o=!1):(e.ActivityBarController.getInstance().setNewXianShiIcon(),o=!0,e.ActivityController.getIntance().newXianshiUicounDown(i-n))),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.YIYUANXIANGOU,o),o&&e.ActivityBarController.getInstance().setNewXianGouEffect(!0),this.updateView()},i.prototype.getLaborDayLeiJiChongZhiData=function(){return this._laborDayLeiJiChongZhiData},i.prototype.getTongJinZhuData=function(){return this._tongjinzhu},i.prototype.getZaJinDanData=function(){return this._zajindan},i.prototype.get_reflush=function(){return this._reflush},i.prototype.getDafuwengInfoData=function(){return this._dafuwengInfo},i.prototype.getDafuwengRankData=function(){return this._dafuwengRankData},i.prototype.getDafuwengRefreshTimes=function(){return this._dafuwengRefreshTimesData},i.prototype.set_reflush=function(){this._reflush=!1},i.prototype.get_scrollV_num=function(){return this.scrollV_num},i.prototype.get_51reflush=function(){return this._51reflush},i.prototype.set_51reflush=function(){this._51reflush=!1},i.prototype.getLeiJiChongZhiTime=function(){return""},i.prototype.getJuBaoPenData=function(){return this._jubaopen},i.prototype.getleijiChongZhi=function(){return this._chongzhileiji},i.prototype.getlianxuChongZhi=function(){return this._lianxuchongzhi},i.prototype.getQuanminfuli=function(){return this._quanminfuli},i.prototype.getListData=function(){return this.listDataArr},i.prototype.getChongZhiPaiMing=function(){return this._chongzhipaiming},i.prototype.setMeiRiChongZhiData=function(e){this.meirichongzhiData=e,this.updateView()
},i.prototype.getMeirichongzhiData=function(){return this.meirichongzhiData},i.prototype.getKuaFuBangDanPaiMing=function(){return this.kuafubangdanpaiming},i.prototype.getKaiFuLiBao=function(){return this._kaifulibao},i.prototype.getDaBiaoHuoDong=function(){return this._dabiaohuodong},i.prototype.getMeiRiXianLi=function(){return this._meirixianli},i.prototype.getChengnZhangJiJin=function(){return this._chengzhangjijin},i.prototype.setZhanLiType=function(e){this._zhanliType=e},i.prototype.getZhanLiType=function(){return this._zhanliType},i.prototype.setArrAwardRank=function(e){this.arrAwardRank=e},i.prototype.getArrAwardRank=function(){return this.arrAwardRank},i.prototype.callBackPoint=function(){var t=e.ActivityController.getIntance().getHuoDongFirstShow(),i=e.ActivityBarController.getInstance();if(e.ActivityController.getIntance().changeBtnRedVis(),t)i.setHuoDongRed(!0);else{for(var n in this.datingRedPointArr){var o=this.datingRedPointArr[n];if(o.value){var a=this.checkBoo(o);if(a)return void i.setHuoDongRed(!0)}}i.setHuoDongRed(!1)}},i.prototype.callBackPointByzajindan=function(t){e.ActivityBarController.getInstance().setZaJinDanRedPoint(t)},i.prototype.callBackPointBytongjinzhu=function(t){e.ActivityBarController.getInstance().setTongJinZhuRedPoint(t)},i.prototype.callBackPointByjubaopen=function(t){e.ActivityBarController.getInstance().setJubaopenRedPoint(t)},i.prototype.callBackPointByDafuweng=function(t){e.ActivityBarController.getInstance().setDafuwengRedPoint(t)},i.prototype.getRedPointArr=function(){return this.datingRedPointArr},i.prototype.checkBoo=function(e){for(var t=this.listDataArr.getActivity(),i=t.length,n=0;i>n;n++){var o=t[n];if(o.getActivityId()==e.type)return!0}return!1},i.prototype.checkShenZhuangNum=function(i){this.shenzhuangNum<i&&this.dabiaoHuoDongType==t.shenzhuangzhuliang&&e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong()},i.prototype.checkQiangHuaDaBiao=function(){this.dabiaoHuoDongType==t.euqipQiangHuaLevel&&e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong()},i.prototype.checkWingJinJie=function(){this.dabiaoHuoDongType==t.singleWingLevel&&e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong()},i.prototype.checkEquipCellRed=function(){this.dabiaoHuoDongType==(t.euqipQiangHuaLevel||t.singleBaoshiLevel||t.euqipUpStarLevel)&&e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong()},i.prototype.checkzhanli=function(){this.dabiaoHuoDongType==t.allZhanLi&&e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong()},i.prototype.setAwardType=function(e){this.jubaopen_type=e},i.prototype.getAwardType=function(){return this.jubaopen_type},i.prototype.setCurrentType=function(e){this.currentTypeBottom=e},i.prototype.getCurrentType=function(){return this.currentTypeBottom},i.prototype.setCurrentTypeLaborDay=function(e){this.currentTypeBottom_laborDay=e},i.prototype.getCurrentTypeLaborDay=function(){return this.currentTypeBottom_laborDay},i.prototype.setCurrentTypeHuiKui=function(e){this.currentTypeBottom_HuiKui=e},i.prototype.getCurrentTypeHuiKui=function(){return this.currentTypeBottom_HuiKui},i.prototype.setGuildIndex=function(e){this.guidIndex=e},i.prototype.getGuildIndex=function(){return this.guidIndex},i.prototype.getJijinshow=function(){return this.jijin_canshow},i.prototype.setZERO_PACKATE_S=function(e){return 0!=e.getErrorNo()?(Log.trace("获取0元礼包数据失败"),void(this._ZeroPackageInfo=null)):(this._ZeroPackageInfo=e.getPackageInfo(),this._ZeroPackageInfo.sort(function(e,t){return e.getStatus()&&t.getStatus()||!e.getStatus()&&!t.getStatus()?e.getId()-t.getId():e.getStatus()?1:t.getStatus()?-1:void 0}),void this.updateView())},Object.defineProperty(i.prototype,"ZeroPackageInfo",{get:function(){return this._ZeroPackageInfo},enumerable:!0,configurable:!0}),i.prototype.setZERO_PACKATE_BUY_S=function(t){if(0!=t.getErrorNo())return void Log.trace("购买0元礼包数据失败");e.GameUtils.MSG_TIP("购买成功");for(var i=0;i<this._ZeroPackageInfo.length;i++)t.getId()==this._ZeroPackageInfo[i].getId()&&this._ZeroPackageInfo[i].setStatus(!0);this._ZeroPackageInfo.sort(function(e,t){return e.getStatus()&&t.getStatus()||!e.getStatus()&&!t.getStatus()?e.getId()-t.getId():e.getStatus()?1:t.getStatus()?-1:void 0}),this.updateView()},i.prototype.setRECHARGE_REBATE_S=function(e){return 0!=e.getErrorNo()?(Log.trace("获取大返利数据失败"),void(this._rechargeRebateData=null)):void(this._rechargeRebateData=e)},Object.defineProperty(i.prototype,"rechargeRebateData",{get:function(){return this._rechargeRebateData},enumerable:!0,configurable:!0}),i}();e.ActivityModel=n,__reflect(n.prototype,"foxgame.ActivityModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/newxiangou/NewXianGouBuyMainSkin.exml")||this;return i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.panelChanged=function(){this.getIsShow&&this.initUI()},i.prototype.initHook=function(){var e=this;this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.close()},this),this.ui.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyOrGetBtnHandler,this),this.ui.buyBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyOrGetBtnHandler,this),this.ui.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyOrGetBtnHandler,this),this.initUI()},i.prototype.initUI=function(){console.log("panel "+this.model.currentXianGouType+" panel"),this.awards=this.model.newXianShiGiftData.getAwards(),this.status=this.model.newXianShiGiftData.getState(),this.dateTime=this.model.newXianShiGiftData.getDateTime(),this.money=this.model.newXianShiGiftData.getMoney(),this.awardsArray=this.awards.split(",");for(var e=this.ui.giftGroup.numChildren,t=0;e>t;t++){var i=this.awardsArray[t].split("_"),n=Number(i[1]),o=Number(i[2]),a=this.ui.giftGroup.getChildAt(t);a.setItem(n,o,!0,!0),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemIconClickHandker,this)}this.switchshowGetBtn(),this.effectLingQu()},i.prototype.switchshowGetBtn=function(){0==this.status?(this.model.currentXianGouType==e.NewXianGouType.YIYUAN?(this.ui.bgImg.source="xianshi_box_1yuan_png",this.ui.buyBtn.visible=!0,this.ui.buyBtn1.visible=!1):this.model.currentXianGouType==e.NewXianGouType.SANYUAN&&(this.ui.bgImg.source="xianshi_box_3yuan_png",this.ui.buyBtn.visible=!1,this.ui.buyBtn1.visible=!0),this.ui.getBtn.visible=!1):1==this.status&&(this.model.currentXianGouType==e.NewXianGouType.YIYUAN?this.ui.bgImg.source="xianshi_box_1yuan_png":this.model.currentXianGouType==e.NewXianGouType.SANYUAN&&(this.ui.bgImg.source="xianshi_box_3yuan_png"),this.ui.buyBtn.visible=!1,this.ui.buyBtn1.visible=!1,this.ui.getBtn.visible=!0)},i.prototype.effectLingQu=function(){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),this.rechargeAni||(this.ui.rechargeAniGroup.scaleX=1.25,this.ui.rechargeAniGroup.scaleY=1.4,this.rechargeAni=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAni.play("GuideMission_start_game","GuideMission_start_game",-1))},i.prototype.remainTime=function(e){this.ui.countDown.text=e},i.prototype.itemIconClickHandker=function(t){var i=t.target,n=this.ui.giftGroup.getChildIndex(i),o=new e.AttributeVO(this.awardsArray[n]);o.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:o.id}):e.TipsController.getInstance().showItemTips(o.id,o.value)},i.prototype.buyAward=function(){var t,i=e.JsonDataManager.instance.xianshiXianGouTemplate,n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(a.costMoney==this.money){t=a;break}}var s={};s.goodsId=t.productId,s.productName=t.productName,s.orderMoney=t.costMoney,s.diamondNum=t.amount,s.giftDiamondNum=t.addNum,e.RechargeController.getInstance().setPayData(s);var r=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");r.setGoodsId(t.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,r,!0)},i.prototype.buyOrGetBtnHandler=function(t){var i=t.target;i==this.ui.buyBtn||i==this.ui.buyBtn1?this.buyAward():i==this.ui.getBtn&&(e.ActivityController.getIntance().cleanXianShiCountDown(),e.ActivityController.getIntance().sendRoleLimitGiftReq(this.money),this.close())},i}(e.BasePanel);e.NewXianGouBuyMain=t,__reflect(t.prototype,"foxgame.NewXianGouBuyMain",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/ActivityAdvertisingSkin.exml")||this;return i.model=e,i.setIsShowBackBtn(!1),i.layer=LayerType.UILAYER,i}return __extends(i,t),i.prototype.initHook=function(){this.info=this.model.advertisingDataList.shift(),this.ui.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.ui.img_bg1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOpenClick,this),this.ui.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBox,this)},i.prototype.showHook=function(){this.ui.img_bg.source=this.info.getName()},i.prototype.onCheckBox=function(t){e.ActivityController.getIntance().sendHPInitGroomStatusReq(this.info.getId(),this.ui.checkBoxBtn.selected)},i.prototype.onClose=function(e){this.close()},i.prototype.onOpenClick=function(t){var i=this.info.getId();-1!=i&&(this.layer=LayerType.UILAYER,this.close(),i==e.NameCode.SEARCHTREASURE&&(i=this.getSaleId()),e.SkipCodeDataHandler.getInstance().skipTo(i))},i.prototype.getSaleId=function(){var t=e.SearchTreasureController.getInstance().getmodel().saleList,i=e.NameCode.SEARCHTREASURE;for(var n in t)return Number(n)==e.SearchTreasureModel.XUNBAO?i=e.NameCode.SEARCHTREASURE:Number(n)==e.SearchTreasureModel.XUNBAO_LONGSHEN?i=e.NameCode.DRAGONGODTREASURE:Number(n)==e.SearchTreasureModel.XUNBAO_SHENMI&&(i=e.NameCode.GUSHENMIBAO),i;return i},i.prototype.closeHook=function(){this.model.showAdvertisingPanel()},i}(e.BasePanel);e.ActivityAdvertisingPanel=t,__reflect(t.prototype,"foxgame.ActivityAdvertisingPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityLaborDay/ActivityLaborDayMainViewSkin.exml","Activity_laborDay")||this;return i.speed=1,i.currentSelect=0,i.model=e,i.setRegisterTick(!0),i.zhaoCaiJinBaoPlayBoo=!1,i.lastTime=0,i.mcIsPlay=!1,i.currentIndex=0,i.model.registerObserver(i),i.dataisok=!1,i}return __extends(i,t),i.prototype.panelChanged=function(){this.dataisok=!0,this.getIsShow()&&(this.refreshNew(),this.zhaocaijinbaoView&&this.zhaocaijinbaoView.updataView())},i.prototype.getCurrentScence=function(){return this.currentScence},i.prototype.initUI=function(){this.zhaoCaiJinBaoPlayBoo=!1,this.lastTime=0,this.currentIndex=0,this.speed=1,this.indexTime=0,this.currentScence=0,this.model.set_51reflush();var t=this.model.getListData();if(null!=t){var i=t.getActivity();if(null!=i&&0!=i.length){this.ui.scroller.scrollPolicyH=eui.ScrollPolicy.AUTO,this.ui.scroller.horizontalScrollBar.autoVisibility=!1,this.ui.scroller.scrollPolicyV=eui.ScrollPolicy.OFF;var n=new eui.TileLayout;n.requestedColumnCount=0,n.requestedRowCount=1,n.horizontalGap=-23,n.verticalGap=1,n.paddingLeft=-10,n.paddingRight=-10,this.ui.scroller.viewport.scrollH=0;var o=this.ui.list;o.dataProvider=this.model.collection_bottom_labor,o.itemRenderer=e.ActivityLaborDayBtnItem,o.layout=n;var a=t.getActivity(),s=0,r=a.length,l=[];this.currentShowArr=[];var h=this.model.getKuangHuanRedPointData();for(s;r>s;s++){var c=a[s];if(c.getOpenPlace()==e.activityListType.kuanghuan){l.push(c);var u=new Object;switch(u.vo=c,c.getActivityId()==this.model.getCurrentTypeLaborDay()?u.select=!0:u.select=!1,c.getActivityId()){case e.ActivityKuangHuanId.LEIJICHONGZHI:u.red=h[0];break;case e.ActivityKuangHuanId.CHAOZHILIBAO:u.red=h[1];break;case e.ActivityKuangHuanId.ZHAOCAJINBAO:u.red=h[2];break;case e.ActivityKuangHuanId.XIAOFEIZENGLI:u.red=h[3];break;case e.ActivityKuangHuanId.DENGLUZENGLI:u.red=h[4]}u.callBack=this.callBack.bind(this),this.currentShowArr.push(u)}}this.currentShowArr.length<1||(this.showIndexScence(this.currentShowArr[0].vo.getActivityId()),this.refreshNew())}}},i.prototype.callBack=function(e){this.model.setCurrentTypeLaborDay(e),this.showIndexScence(e),this.setSelect(e)},i.prototype.setSelect=function(e){if(this.currentSelect=0,this.currentShowArr&&this.currentShowArr.length>0)for(var t=this.currentShowArr.length,i=0;t>i;i++){var n=this.currentShowArr[i],o=n.vo;o&&o.getActivityId()==e?(this.currentSelect=e,n.select=!0):n.select=!1}this.refreshNew()},i.prototype.showHook=function(){this.initListener(),this.initUI(),this.doScreenAdaptation()},i.prototype.initListener=function(){},i.prototype.onClick=function(t){switch(t.target){case this.ui.helpBtn:this.currentScence==e.ActivityKuangHuanId.ZHAOCAJINBAO&&e.HelpController.getInstance().showPanel("ZCSYBHELP")}},i.prototype.initParams=function(){},i.prototype.refreshNew=function(){var t=0,i=this.currentShowArr.length,n=this.model.getKuangHuanRedPointData();for(t;i>t;t++){var o=this.currentShowArr[t],a=o.vo;switch(a.getActivityId()){case e.ActivityKuangHuanId.LEIJICHONGZHI:o.red=n[0];break;case e.ActivityKuangHuanId.CHAOZHILIBAO:o.red=n[1];break;case e.ActivityKuangHuanId.ZHAOCAJINBAO:o.red=n[2];break;case e.ActivityKuangHuanId.XIAOFEIZENGLI:o.red=n[3];break;case e.ActivityKuangHuanId.DENGLUZENGLI:o.red=n[4]}}this.model.dataSource_bottom_labor=this.currentShowArr,this.model.collection_bottom_labor.replaceAll(this.model.dataSource_bottom_labor)},i.prototype.showIndexScence=function(t){this.setSelect(t),this.currentScence!=t&&(this.currentScence=t,this.zhaoCaiJinBaoPlayBoo=!1,this.mcIsPlay=!1,this.indexTime=0,e.ActivityController.getIntance().ActivityLaborDaySendMsg(t))},i.prototype.leijichongzhiPanelShow=function(){this.leijichongzhiView||(this.leijichongzhiView=new e.ActivityLaborDayLeiJiChongZhiView(this.model)),this.ui.group.removeChildren(),this.ui.group.addChild(this.leijichongzhiView),this.leijichongzhiView.updataView()},i.prototype.denglujiangliPanelShow=function(){this.denglujiangliView||(this.denglujiangliView=new e.ActivityLaborDayDengLuJiangLiView(this.model)),this.ui.group.removeChildren(),this.ui.group.addChild(this.denglujiangliView),this.denglujiangliView.updataView()},i.prototype.leijixiaofeiPanelShow=function(){this.leijixiaofeiView||(this.leijixiaofeiView=new e.ActivityLaborDayLeiJiXiaoFeiView(this.model)),this.ui.group.removeChildren(),this.ui.group.addChild(this.leijixiaofeiView),this.leijixiaofeiView.updataView()},i.prototype.chaozhilibaoPanelShow=function(){this.chaozhilibaoView||(this.chaozhilibaoView=new e.ActivityLaborDayChaoZhiLiBaoView(this.model)),this.ui.group.removeChildren(),this.ui.group.addChild(this.chaozhilibaoView),this.chaozhilibaoView.updataView()},i.prototype.zhaocaijinbaoPanelShow=function(){this.mcIsPlay||this.currentScence==e.ActivityKuangHuanId.ZHAOCAJINBAO&&(this.zhaocaijinbaoView||(this.zhaocaijinbaoView=new e.ActivityLaborDayZhaoCaiJinBaoView(this.model)),this.ui.group.removeChildren(),this.ui.group.addChild(this.zhaocaijinbaoView),this.zhaocaijinbaoView.updataViewNew())},i.prototype.zhaocaijinbaoLogShow=function(){this.zhaocaijinbaoView&&this.zhaocaijinbaoView.showLog(this.model.getLaborDayLog())},i.prototype.zhaoCaiJinBaostopMc=function(e){this.zhaocaijinbaoView&&this.zhaocaijinbaoView.stopMc(e)},i.prototype.closeHook=function(){this.zhaocaijinbaoView&&this.zhaocaijinbaoView.parent&&this.zhaocaijinbaoView.parent.removeChild(this.zhaocaijinbaoView),this.zhaocaijinbaoView=null,this.leijixiaofeiView&&this.leijixiaofeiView.parent&&this.leijixiaofeiView.parent.removeChild(this.leijixiaofeiView),this.leijixiaofeiView=null,this.leijichongzhiView&&this.leijichongzhiView.parent&&this.leijichongzhiView.parent.removeChild(this.leijichongzhiView),this.leijichongzhiView=null,this.chaozhilibaoView&&this.chaozhilibaoView.parent&&this.chaozhilibaoView.parent.removeChild(this.chaozhilibaoView),this.chaozhilibaoView=null,this.denglujiangliView&&this.denglujiangliView.parent&&this.denglujiangliView.parent.removeChild(this.denglujiangliView),this.denglujiangliView=null},i.prototype.zhaocaijinbaoDeng=function(){this.zhaocaijinbaoView&&this.zhaocaijinbaoView.dengPlay()},i.prototype.zhaoCaiJinBaoplayMc=function(){this.zhaoCaiJinBaoPlayBoo=!0},i.prototype.LaoHuStop=function(){this.zhaoCaiJinBaoPlayBoo=!1,this.mcIsPlay=!1,this.currentIndex=0,this.speed=1,this.indexTime=0,this.zhaocaijinbaoView.changeState()},i.prototype.tickHook=function(e){if(this.zhaoCaiJinBaoPlayBoo){var t=e-this.lastTime;if(500>t||(this.lastTime=e,this.zhaocaijinbaoDeng()),this.indexTime<20&&(this.currentIndex+=1,this.speed<100&&(this.speed+=1)),this.indexTime+=1,this.zhaocaijinbaoView.playMc(this.speed,this.currentIndex),this.mcIsPlay=!0,this.currentIndex>=150&&(this.model.getZhaoCaiJinBaoLaborDayAward()&&this.speed>0&&(this.speed<=1?this.speed=1:this.speed-=1),this.zhaocaijinbaoView)){var i=this.model.getZhaoCaiJinBaoLaborDayAward();i&&this.mcIsPlay&&this.zhaoCaiJinBaostopMc(i)}}},i}(e.BasePanel);e.ActivityLaborDayPanel=t,__reflect(t.prototype,"foxgame.ActivityLaborDayPanel",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/ActivityMainSkin.exml")||this;return i.setIsTextureCache(!1),i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){this.ui.sceneGroup.removeChildren(),this.initListener(),this.ui.bottom_btnGroup.updataView(this.backFunForBottom.bind(this),this.model.getListData()),this.doScreenAdaptation()},i.prototype.backFunForBottom=function(t,i){if(void 0===i&&(i=null),-1!=this.model.getGuildIndex())return void this.viewOpenByGuid(this.model.getGuildIndex());switch(this.model.setCurrentKaiQiTime(i),this.model.collection.source=null,this.currentType=t,this.model.setCurrentType(t),this.ui.bottom_btnGroup.setSelect(t),t){case e.activityDaTingType.leijichongzhi:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByLeiJiChongZhi();break;case e.activityDaTingType.lianxuchongzhi:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByLianXuChongZhi();break;case e.activityDaTingType.allPlayerfuli:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByQuanMinFuLi();break;case e.activityDaTingType.chongzhipaiming:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByChongZhiPaiMing();break;case e.activityDaTingType.kaifulibao:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByKaiFuLiBao();break;case e.activityDaTingType.dabiaohuodong:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByDaBiaoHuoDong();break;case e.activityDaTingType.lianxuchongzhihongli:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverBylianxuchongzhihongli();break;case e.activityDaTingType.xiaofeipaiming:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByxiaofeipaiming();break;case e.activityDaTingType.chengzhangjijin:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByChengZhangJiJin();break;case e.activityDaTingType.meirixianli:this.model.set_reflush(),e.ActivityController.getIntance().sendMessageToSeverByMeiRiXianLi();break;default:this.model.set_reflush(),this.ui.sceneGroup.removeChildren()}},i.prototype.checkBtnRedVisible=function(){this.getIsShow()&&this.ui.bottom_btnGroup.checkBtnRedVisible()},i.prototype.changeBottomVisible=function(){this.getIsShow()&&this.ui.bottom_btnGroup.updataView(this.backFunForBottom.bind(this),this.model.getListData())},i.prototype.backHandler=function(){this.close()},i.prototype.closeHook=function(){for(var e=this.group.numChildren,t=0;e>t;++t){var i=this.group.getChildAt(t);i.cleanDataDelete&&i.cleanDataDelete()}this.group.removeChildren(),this.group=null,this.scaleX=this.scaleY=1,this.x=this.y=0},i.prototype.leijichongzhiShow=function(){if(this.currentType==e.activityDaTingType.leijichongzhi){this.chongzhiData=this.model.getleijiChongZhi();var t=this.ui.sceneGroup,i=e.ActivityLeiJiChongZhiView.getIntance();t.removeChildren(),t.addChild(i);var n=this.chongzhiData.getAwardsInfo();i.updataView(this.chongzhiData,this.model.getCurrentKaiQiTime());var o=0,a=n.length,s=0,r=this.chongzhiData.getGotAwardCfgId(),l=r.length,h=!1,c=[],u=[];for(o;a>o;o++){var p=n[o];for(h=!1,s=0;l>s;s++){var g=r[s];g==p.getId()&&(h=!0)}h?c.push(p):u.push(p)}u=u.concat(c),this.model.dataSource=u,this.model.collection.replaceAll(this.model.dataSource)}},i.prototype.viewOpenByGuid=function(e){this.currentType=e,this.model.setGuildIndex(-1),this.ui.bottom_btnGroup.changeViewByIndex(e)},i.prototype.chengzhangjijinShow=function(){if(this.currentType==e.activityDaTingType.chengzhangjijin){var t=this.model.getChengnZhangJiJin(),i=this.ui.sceneGroup,n=e.ActivityChengZhangJiJingView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t);var o=e.JsonDataManager.instance.GrowFundArr,a=0,s=o.length,r=0,l=t.getGotCfgIds(),h=l.length,c=!1,u=[],p=[];for(a;s>a;a++){var g=o[a];for(c=!1,r=0;h>r;r++){var d=l[r];d==g.id&&(c=!0)}c?u.push(g):p.push(g)}o=p.concat(u),this.model.dataSource_chengzhangjijin=o,this.model.collection_chengzhangjijin.replaceAll(this.model.dataSource_chengzhangjijin)}},i.prototype.meirixianliShow=function(){if(this.currentType==e.activityDaTingType.meirixianli){var t=this.model.getMeiRiXianLi(),i=this.ui.sceneGroup,n=e.ActivityMeiRiXianLiView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.lianxuchongzhiShow=function(){if(this.currentType==e.activityDaTingType.lianxuchongzhi){var t=this.model.getlianxuChongZhi(),i=this.ui.sceneGroup,n=e.ActivityLianXuChongZhiView.getIntance();i.removeChildren(),i.addChild(n);var o=e.JsonDataManager.instance.coutinueRechargeArr;n.updataView(t,this.model.getCurrentKaiQiTime());var a=0,s=o.length,r=0,l=t.getGotAwardCfgId(),h=l.length,c=!1,u=[],p=[];for(a;s>a;a++){var g=o[a];for(c=!1,r=0;h>r;r++){var d=l[r];d==g.id&&(c=!0)}c?u.push(g):p.push(g)}o=p.concat(u),this.model.dataSource_lianxuchongzhi=o,this.model.collection_lianxuchongzhi.replaceAll(this.model.dataSource_lianxuchongzhi)}},i.prototype.quanminfuliShow=function(){if(this.currentType==e.activityDaTingType.allPlayerfuli){var t=this.model.getQuanminfuli(),i=this.ui.sceneGroup,n=e.ActivityQuanminfuliView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t);var o=t.getInfos();this.model.dataSource_quanminfuli=o,this.model.collection_quanminfuli.replaceAll(this.model.dataSource_quanminfuli)}},i.prototype.chongzhipaimingShow=function(){if(this.currentType==e.activityDaTingType.chongzhipaiming){var t=this.model.getChongZhiPaiMing(),i=this.ui.sceneGroup,n=e.ActivityChongZhiPaiMingView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime()),this.model.dataSource=t.getAwardsInfo(),this.model.collection.replaceAll(this.model.dataSource)}},i.prototype.kaifulibaoShow=function(){if(this.currentType==e.activityDaTingType.kaifulibao){var t=this.model.getKaiFuLiBao(),i=this.ui.sceneGroup,n=e.ActivityKaiFuLiBaoView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t);var o=t.getAwardsInfo();this.model.dataSource_kaifu=o,this.model.collection_kaifu.replaceAll(this.model.dataSource_kaifu)}},i.prototype.dabiaohuodongShow=function(){if(this.currentType==e.activityDaTingType.dabiaohuodong){var t=this.model.getDaBiaoHuoDong(),i=this.ui.sceneGroup,n=e.ActivityDaBiaoJingJiView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime())}},i.prototype.showLeiChongXiaoHao=function(){if(this.currentType==e.activityDaTingType.lianxuchongzhihongli){var t=this.model.getleichongxiaohao(),i=this.ui.sceneGroup;i.removeChildren();var n=e.ActivityLeiJiChongXiaoHaoView.getIntance();i.addChild(n);var o=0,a=t.getAwardsInfo().length,s=0,r=t.getGotAwardCfgId(),l=r.length,h=!1,c=[],u=[];for(o;a>o;o++){var p=t.getAwardsInfo()[o];for(h=!1,s=0;l>s;s++){var g=r[s];g==p.getId()&&(h=!0)}h?c.push(p):u.push(p)}t.setAwardsInfo(u.concat(c)),n.updataView(t,this.model.getCurrentKaiQiTime()),this.model.collection_leijixiaohao.replaceAll(t.getAwardsInfo())}},i.prototype.showxiaofeipaihang=function(){if(this.currentType==e.activityDaTingType.xiaofeipaiming){var t=this.model.getxiaofeipaihang(),i=this.ui.sceneGroup,n=e.ActivityXiaoFeiPaiMingView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t,this.model.getCurrentKaiQiTime()),this.model.collection_xiaohaopaiming.replaceAll(t.getAwardInfo())}},i.prototype.initListener=function(){this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(e){this.backHandler()},i.prototype.showQuestion=function(){},i.prototype.showHook=function(){this.initUI(),e.ActivityBarController.getInstance().setHuoDongEffect(!1)},i.prototype.initParams=function(){},i.prototype.refresh=function(){var t=e.BagController.getInstance().getTotalRedEquipCount();this.model.checkShenZhuangNum(t)},i.prototype.bagItemChanged=function(){this.refresh()},i}(e.BasePanel);e.ActivityPanel=t,__reflect(t.prototype,"foxgame.ActivityPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.curScroll_index=0,e.canShow=!1,e.isopen=!1,e.skinName="ActivityChengZhangJiJingSkin",e.dataisok=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.high1.text=e.GlobalConfig.instance.getValue("CZJIJING_BEISHU")+"tfh",this.high2.text=e.GlobalConfig.instance.getValue("CZJIJING_JIAZHI")+"wyb";var i=e.GlobalConfig.instance.getValue("CHENGZHANGJIJIN_PRICE");e.GamePlatform.isDragonEx?(this.jijinPrice.text=i+"d",this.labelDisplay.text=i+"DT购买"):e.GamePlatform.isDragonEx_qld?(this.jijinPrice.text=i+"b",this.labelDisplay.text=i+"元宝购买"):(this.jijinPrice.text=i+"y",this.labelDisplay.text="￥"+i+"购买")},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.initUI=function(t){this.initListener(),this.txt1.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GROWFUND")),this.listScroller.verticalScrollBar.autoVisibility=!1,!e.ActivityController.getIntance().getViewScallV(),1==t.getIsBuy()?this.buyBtn.enabled=!1:this.buyBtn.enabled=!0;var i=this.listgroup;i.dataProvider=e.ActivityController.getIntance().getCollection_chengzhangjijin(),i.itemRenderer=e.ActivityChengZhangJiJinItemView;var n=e.JsonDataManager.instance.GrowFundArr,o=0,a=0,s=n.length;if(this.curScroll_index=0,t.getCanGetIds().length>0)for(o=t.getCanGetIds()[0],a;s>a;a++){var r=n[a].id;if(o==r){this.curScroll_index=a;break}}},i.prototype.changeScrollV=function(e){},i.prototype.initListener=function(){this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.buyJiJin()}},i.prototype.buyJiJin=function(){var t=(e.PlayerService.instance.playerInfo.getRecharge(),e.JsonDataManager.instance.fundTemplate);this.chongzhi(t)},i.prototype.chongzhi=function(t){var i={};i.goodsId=t.productId,i.productName=t.productName,i.orderMoney=t.costMoney,i.diamondNum=t.amount,i.giftDiamondNum=t.addNum,e.RechargeController.getInstance().setPayData(i);var n=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");n.setGoodsId(t.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,n,!0)},i.prototype.updataView=function(e){this.isopen=!1,this.initUI(e)},i.prototype.getIsShow=function(){return null!=this.parent},i}(eui.Component);e.ActivityChengZhangJiJingView=t,__reflect(t.prototype,"foxgame.ActivityChengZhangJiJingView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityChengZhangJiJingItemSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.chongzhiVO=e.ActivityController.getIntance().getChengZhangJiJinData(),e.ActivityChengZhangJiJingView.getIntance().changeScrollV(1e3),this.curretnVo=this.data;var t=this.chongzhiVO.getCanGetIds(),i=(e.JsonDataManager.instance.GrowFundArr,t.length);this.lingquBtn.visible=!1;for(var n=0;i>n;n++)t[n]==this.curretnVo.id&&(this.lingquBtn.visible=!0);if(this.levelTxt.text=this.curretnVo.level+"",0==this.chongzhiVO.getIsBuy()){if(this.curretnVo.level>e.PlayerService.instance.playerInfo.getLevel()){this.lingquTxt.visible=!0;var o=this.curretnVo.level-e.PlayerService.instance.playerInfo.getLevel();this.lingquTxt.text=e.LanguageUtils.instance.getValue("HAICHAJIJILINGQU",o)}else this.lingquTxt.visible=!0,this.curretnVo.level<=e.PlayerService.instance.playerInfo.getLevel()&&(this.lingquTxt.visible=!1,this.lingquBtn.visible=!0,this.isCanBuy=!1);this.isCanBuy=!1}else{if(this.curretnVo.level>e.PlayerService.instance.playerInfo.getLevel()){this.lingquTxt.visible=!0;var o=this.curretnVo.level-e.PlayerService.instance.playerInfo.getLevel();this.lingquTxt.text=e.LanguageUtils.instance.getValue("HAICHAJIJILINGQU",o)}else this.lingquTxt.visible=!1,this.lingquBtn.visible=!0;this.isCanBuy=!0}this.yilingqu.visible=!1;var a=this.chongzhiVO.getGotCfgIds();i=a.length;for(var s=0;i>s;s++)if(a[s]==this.curretnVo.id){this.lingquBtn.visible=!1,this.yilingqu.visible=!0;break}this.lingquBtn.visible&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var r=this.curretnVo.awards;this.item_0.setItem(r[0].id,r[0].value,!0),this.item_1.setItem(r[1].id,r[1].value,!0),this.item_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.item_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i,n,o=this.curretnVo.awards;switch(t.target){case this.item_0:i=o[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_1:i=o[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.lingquBtn:if(this.isCanBuy)this.lingquAward();else{var a=e.LanguageUtils.instance.getValue("CHENGZHANGJIJINCANNOTBUY");e.PopUpController.getInstance().showFloatTextPanel1(a)}}},i.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGetGrowFund");t.setGetCfgId(this.curretnVo.id),e.Message.instance.send(e.Code.GET_GROW_FUND_C,t,!0)},i}(eui.ItemRenderer);e.ActivityChengZhangJiJinItemView=t,__reflect(t.prototype,"foxgame.ActivityChengZhangJiJinItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityChongZhiPaiMingItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curretnVo=this.data;var t,i=this.curretnVo.getListRechargeRankInfo();i.length;t=i[0];var n="";if(t){this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=t.getName(),n=e.LanguageUtils.instance.getValue("ChongZhiPaiMing1",t.getMoney()),this.money.textFlow=(new egret.HtmlTextParser).parser(n);var o=e.JsonDataManager.instance.roleTemplate,a=o[""+t.getItmeid()];this.icon.source=a.icon}else this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=e.LanguageUtils.instance.getValue("ZANWU"),n=e.LanguageUtils.instance.getValue("ChongZhiPaiMing1",0),this.money.textFlow=(new egret.HtmlTextParser).parser(n),this.icon.source=null;
this.itemVOArr=[];var s=this.curretnVo.getAwards().split(","),r=4,l=0;for(l;r>l;l++){var h=this["item_"+(l+1)],c=new e.AttributeVO(s[l]);if(l>s.length-1)break;h.visible=!0,h.setItem(c.id,c.value,!0),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(c)}for(l;r>l;l++){var h=this["item_"+(l+1)];h.visible=!1}},i.prototype.onClick=function(t){var i,n=this.itemVOArr;switch(t.target){case this.item_1:i=n[0];break;case this.item_2:i=n[1];break;case this.item_3:i=n[2];break;case this.item_4:i=n[3]}var o=e.JsonDataManager.instance.itemTemplate[i.id];e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,o.type,i.value)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityChongZhiPaiMingItemView=t,__reflect(t.prototype,"foxgame.ActivityChongZhiPaiMingItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityChongZhiPaiMingSkin",e}return __extends(i,t),i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.timeStr=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.updataView=function(e,t){void 0===t&&(t=""),this._data=e,this.timeStr=t,this.initUI()},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getCollection(),t.itemRenderer=e.ActivityChongZhiPaiMingItemView,this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.timeStr),this._data.getPlayerRanking()<0?this.myIndex.text="0":this.myIndex.text=this._data.getPlayerRanking()+"",this.myMoney.text=this._data.getRecharge()+e.LanguageUtils.instance.getValue("YUANBAO");var i=this._data.getAwardsInfo()[0],n=e.LanguageUtils.instance.getValue("ChongZhiPaiMing4",i.getGears());this.titleMoney.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityChongZhiPaiMingView=t,__reflect(t.prototype,"foxgame.ActivityChongZhiPaiMingView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityJingJiItemSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.chongzhiVO=this.data;for(var t=e.ActivityController.getIntance().getArrAwardRank(),i=t.length,n=0;i>n;n++){var o=t[n];if(o.getRank()==this.chongzhiVO.getRank()&&o.getType()==this.chongzhiVO.getType()){this.curretnVo=o;break}}if(this.curretnVo){var a=this.curretnVo.getAward().split(","),s=new e.AttributeVO(a[0]);if(this.itemIcon.setItem(s.id,s.value,!0),this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.chongzhiVO.getName().length<=1)return this.txt1.text=this.changeRankNum(),this.txt2.text=e.LanguageUtils.instance.getValue("ZANWU"),void(this.txt3.text="");this.txt1.text=this.changeRankNum(),this.txt2.text=this.chongzhiVO.getName(),this.txt3.text=this.chongzhiVO.getActivityProgress()+""}},i.prototype.changeRankNum=function(){var t="",i=this.chongzhiVO.getRank();t=i+"";for(var n="",o=0;o<t.length;o++){var a=e.LanguageUtils.instance.getValue("HANZINUMBER"+Number(t.charAt(o)));n+=a}return e.LanguageUtils.instance.getValue("MINGCI",n)},i.prototype.onClick=function(t){var i,n=this.curretnVo.getAward().split(","),o=new e.AttributeVO(n[0]);switch(t.target){case this.itemIcon:i=e.JsonDataManager.instance.itemTemplate[o.id],e.ActivityController.getIntance().showTipsByItemOrEquip(o.id,i.type,o.value)}},i}(eui.ItemRenderer);e.ActivityDaBiaoJingJiItemView=t,__reflect(t.prototype,"foxgame.ActivityDaBiaoJingJiItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.zhuangbeiqianghua=50]="zhuangbeiqianghua",e[e.shenyibang=3]="shenyibang",e[e.baoshibang=4]="baoshibang",e[e.tejiepaihang=51]="tejiepaihang",e[e.shenzhuangpaihang=53]="shenzhuangpaihang",e[e.zhaungbeishengxing=52]="zhaungbeishengxing",e[e.zhanlibang=1]="zhanlibang",e[e.zhanshenbang=6]="zhanshenbang",e[e.fashengbang=7]="fashengbang",e[e.daozunbang=8]="daozunbang"}(t=e.DaBiaoAtivityType||(e.DaBiaoAtivityType={}));var i;!function(e){e[e.chooseZhangJie=1]="chooseZhangJie",e[e.chooseLevel=2]="chooseLevel",e[e.chooseEquipNum=3]="chooseEquipNum",e[e.chooseRongLianNum=4]="chooseRongLianNum",e[e.qianghuaNum=5]="qianghuaNum",e[e.shengxingNum=6]="shengxingNum",e[e.chibangNum=7]="chibangNum",e[e.chibangshengxing=8]="chibangshengxing",e[e.rolegetLevel=9]="rolegetLevel",e[e.gerenbossNum=10]="gerenbossNum",e[e.baoshiNumLevel=11]="baoshiNumLevel",e[e.yewaipknum=12]="yewaipknum",e[e.jingjichangNum=13]="jingjichangNum",e[e.huoluanshenyuan=14]="huoluanshenyuan",e[e.jinengLevel=15]="jinengLevel",e[e.qianghuaLevel=16]="qianghuaLevel",e[e.chibangshengjieLevel=17]="chibangshengjieLevel",e[e.chibangStarNum=18]="chibangStarNum",e[e.baoshiLevel=19]="baoshiLevel",e[e.zhanliNum=20]="zhanliNum",e[e.bayezhaungbeiLevel=21]="bayezhaungbeiLevel",e[e.shenqijieshu=22]="shenqijieshu",e[e.shenqifuwenNum=23]="shenqifuwenNum",e[e.zhaungbeigongminglevel=24]="zhaungbeigongminglevel",e[e.hunyilevel=25]="hunyilevel",e[e.tejielevel=26]="tejielevel",e[e.shopBuyNum=27]="shopBuyNum",e[e.zhuangbeiFuBenNum=28]="zhuangbeiFuBenNum",e[e.baoshifubenNum=29]="baoshifubenNum",e[e.jinengshengjiNum=30]="jinengshengjiNum",e[e.shijieliaotianNum=31]="shijieliaotianNum",e[e.dangechibangLevel=32]="dangechibangLevel",e[e.shenzhuangshumu=33]="shenzhuangshumu",e[e.dangebaoshilevel=34]="dangebaoshilevel",e[e.zhaungbeiqianghualevel=35]="zhaungbeiqianghualevel",e[e.zhaungbeishengxinglevel=36]="zhaungbeishengxinglevel"}(i=e.DaBiaoHuoDongType||(e.DaBiaoHuoDongType={}));var n=function(t){function n(){var e=t.call(this)||this;return e.accRecharge2Arr=[],e.skinName="ActivityKaiFuJingJiSkin",e}return __extends(n,t),n.prototype.getIsShow=function(){return null!=this.parent},n.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new n,this._intance},n.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},n.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.accRecharge2Arr=null,this.arrAwardRank=null,this.zongzhanli=null,this.zhanshiData=null,this.fashiData=null,this.daoshiData=null,this.listgroup.removeChildren(),this.removeChildren(),n._intance=null},n.prototype.checkActivityData=function(){},n.prototype.updataSceneBtn=function(){},n.prototype.updataView=function(t,i){this._data=t,this.startTime=i,this.startTime==""+e.activityDaTingType.dabiaohuodong&&this.startTimeCheck(),this.initUI()},n.prototype.startTimeCheck=function(){var t=Number(this._data.getActivityTime()),i=new Date;i.setTime(t);var n,o,a=i.getFullYear(),s=i.getMonth()+1,r=i.getDate();n="00:00:00",o="23:59:59";var l=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",a,s,r,n,a,s,r,o);this.startTime=l},n.prototype.getBiaoData=function(){var t=[];this.arrAwardRank=[];var i=e.JsonDataManager.instance.StandardActivityArr,n=e.JsonDataManager.instance.StandardAcRankAwardArr;this.arrAwardRank=this._data.getActivityRankInfo()[0].getRankInfo();i.length,n.length;return e.ActivityController.getIntance().setArrAwardRank(this.arrAwardRank),t},n.prototype.initUI=function(){this.initListener(),this.timeTxt.textFlow=(new egret.HtmlTextParser).parser(this.startTime),this.accRecharge2Arr=this.getBiaoData(),this.imgTop.source=this._data.getGearsAwardsInfo()[0].getImgSource()+"_jpg",this.guizeTxt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("HUODONG_"+this._data.getTargetType())),this.listScroller1.verticalScrollBar.autoVisibility=!1,this.listScroller1.viewport.scrollH=0,this.listgroup1.removeChildren(),this.listScroller.verticalScrollBar.autoVisibility=!1,this.listScroller.viewport.scrollV=0;var t=this.listgroup;switch(t.dataProvider=e.ActivityController.getIntance().getCollection_dabiao(),this.checkZhanLiData(),this._data.getTargetType()){case i.zhanliNum:t.itemRenderer=e.ActivityDaBiaoZhanliItemView,this.zhanliChangeView();break;default:t.itemRenderer=e.ActivityDaBiaoJingJiItemView,this.changeViewNormal()}this.awardUIOnBottom()},n.prototype.changeViewNormal=function(){var t=(this._data.getActivityRankInfo(),this._data.getActivityRankInfo()[0].getRankInfo()[0]);this.paihangTxt.visible=!0,this.paihangTxt.touchEnabled=!0,this.paihangTxt.textFlow=(new egret.HtmlTextParser).parser("<a href = ''><u>"+this.paihangTxt.text+"</u></a>"),this.paihangTxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.titleIcon.source=this.arrAwardRank[0].getTitleIcon()+"_png";for(var i=this.arrAwardRank[0].getAward().split(","),n=(i.length,i.length),o=0;n>o;o++){var a=new e.AttributeVO(i[o]),s=new e.ItemIcon;s.setItem(a.id,a.value,!1),this.listgroup1.addChild(s),s.x=o*(s.width+15)+10,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}var r=e.ActivityController.getIntance().getModelForDaBiao(),l=this._data.getActivityRankInfo()[0].getRankInfo();if(t.getName()&&t.getName().length>=1){var h=this._data.getTargetType(),c="PHBZDJ_JINGJI_RULL_"+h;this.tiaojianNum.text=e.LanguageUtils.instance.getValue(c,l[0].getActivityProgress()),this.oneName.text=t.getName()}else this.tiaojianNum.text="",this.oneName.text=e.LanguageUtils.instance.getValue("ZANWU");r.dataSource_dabiao=l.slice(1),r.collection_dabiao.replaceAll(r.dataSource_dabiao)},n.prototype.awardUIOnBottom=function(){this._data.getGearsAwardsInfo()[0].getDays;for(var t,i=this._data.getTargetType(),n="ACTIVITY_JINGJI_RULL_"+i,o=this._data.getGearsAwardsInfo().length,a=this._data.getProgressId(),s=0;o>s;s++){t=this._data.getGearsAwardsInfo()[s],a==t.getId()&&(this.awardTxt.text=e.LanguageUtils.instance.getValue(n,t.getCond()));var r=new e.AttributeVO(t.getAward().split(",")[0]);this["item_"+(t.getId()-1)].setItem(r.id,r.value,!0),this["item_"+(t.getId()-1)].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}var l=this._data.getGearsAwardsInfo()[a-1],h=this._data.getProgress(),c=Long.fromString(l.getCond()),u=Long.fromValue(h);c.greaterThan(u)||1==this._data.getReceiveStatus()?(this.lingquBtn.enabled=!1,this.lingquBtn.touchEnabled=!1):(this.lingquBtn.touchEnabled=!0,this.lingquBtn.enabled=!0,this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)),this.expTiao.width=0,this.changeTiaoLength(c.toNumber(),u.toNumber(),a)},n.prototype.changeTiaoLength=function(e,t,i){var n,o,a=0;switch(t>=e?n=!0:(n=!1,o=t/e),i){case 1:a=n?this.tiaoX1.x-this.expTiao.x:(this.tiaoX1.x-this.expTiao.x)*o;break;case 2:a=n?this.tiaoX2.x-this.expTiao.x:this.tiaoX1.x-this.expTiao.x+(this.tiaoX2.x-this.tiaoX1.x)*o;break;case 3:a=n?468:this.tiaoX2.x-this.expTiao.x+(468-this.tiaoX2.x)*o}this.expTiao.width=a+8,this.expTiao.width>468&&(this.expTiao.width=468)},n.prototype.checkZhanLiData=function(){for(var e,t=this._data.getActivityRankInfo(),i=t.length,n=0;i>n;n++)switch(e=t[n],e.getRankType()){case 1:this.zongzhanli=e;break;case 2:this.zhanshiData=e;break;case 3:this.fashiData=e;break;case 4:this.daoshiData=e}},n.prototype.zhanliChangeView=function(){var t=(this._data.getActivityRankInfo(),this.zongzhanli.getRankInfo()[0]);this.titleIcon.source=this.arrAwardRank[0].getTitleIcon()+"_png";for(var i=this.arrAwardRank[0].getAward().split(","),n=(i.length,i.length),o=0;n>o;o++){var a=new e.AttributeVO(i[o]),s=new e.ItemIcon;s.setItem(a.id,a.value,!1),this.listgroup1.addChild(s),s.x=o*(s.width+15)+10,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.paihangTxt.visible=!0,this.paihangTxt.touchEnabled=!0,this.paihangTxt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("CHAKANZONGZHANLIPAIHANG")),this.paihangTxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var r=e.ActivityController.getIntance().getModelForDaBiao();if(t.getName()&&t.getName().length>1){var l=this._data.getTargetType(),h="PHBZDJ_JINGJI_RULL_"+l;this.tiaojianNum.text=e.LanguageUtils.instance.getValue(h,t.getActivityProgress()),this.oneName.text=t.getName()}else this.tiaojianNum.text="",this.oneName.text=e.LanguageUtils.instance.getValue("ZANWU");r.dataSource_dabiao=this.checkZhiYeData(),r.collection_dabiao.replaceAll(r.dataSource_dabiao)},n.prototype.checkZhiYeData=function(){var e=this.zhanshiData.getRankInfo()[0],t=this.fashiData.getRankInfo()[0],i=this.daoshiData.getRankInfo()[0],n=[];return e&&n.push(e),t&&n.push(t),i&&n.push(i),n},n.prototype.initListener=function(){},n.prototype.onClick=function(t){switch(t.target){case this.lingquBtn:return void this.lingquAward();case this.paihangTxt:return void this.openPaiMingView()}if(t.target){var i=t.target,n=e.JsonDataManager.instance.itemTemplate[i.itemId];e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},n.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.GetActivityProgressAwardReq");t.setActivityId(this._data.getActivityId()),e.Message.instance.send(e.Code.STANDARD_ACTIVITY_REWARD_C,t,!0)},n.prototype.openPaiMingView=function(){e.ActivityController.getIntance().showJingJiPaiHangPanel()},n.prototype.initView=function(){},n.prototype.recvMsg=function(t,i){t==e.MsgCMD.FIGHTFB_GOTO},n}(eui.Component);e.ActivityDaBiaoJingJiView=n,__reflect(n.prototype,"foxgame.ActivityDaBiaoJingJiView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityJingJiPaiHangItemSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curretnVo=this.data,this.descTxt.text=e.LanguageUtils.instance.getValue("MINGCI",this.curretnVo.getRank());var t=this.curretnVo.getProf(),i=e.JsonDataManager.instance.roleTemplate[t];i?this.icon.source=i.icon:this.icon.source="";var n=e.ActivityController.getIntance().getModelForDaBiao().getDaBiaoHuoDong(),o=n.getTargetType(),a="PHBZDJ_JINGJI_RULL_"+o;this.level.text=e.LanguageUtils.instance.getValue(a,this.curretnVo.getActivityProgress()),this.bossLevel.text=this.curretnVo.getLevel()+"",this.playername.text=this.curretnVo.getName(),this.vipNum.source="u_vip"+this.curretnVo.getVipLevel()+"_png";for(var s=n.getActivityRankInfo()[0].getRankInfo(),r=s.length,l=0;r>l;l++)if(s[l].getRank()==this.curretnVo.getRank()&&s[l].getType()==this.curretnVo.getType()){this.chongzhiVO=s[l];break}var h=this.curretnVo.getAward().split(",");r=h.length;for(var c=0;r>c;c++){var u=new e.AttributeVO(h[c]);this["item_"+(c+1)].setItem(u.id,u.value,!0),this["item_"+(c+1)].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.onClick=function(t){for(var i=this.chongzhiVO.getAward().split(","),n=i.length,o=[],a=0;n>a;a++){var s=new e.AttributeVO(i[a]);o.push(s)}var r;switch(t.target){case this.item_1:r=o[0];break;case this.item_2:r=o[1];break;case this.item_3:r=o[2];break;case this.item_4:r=o[3]}var l=e.JsonDataManager.instance.itemTemplate[r.id];e.ActivityController.getIntance().showTipsByItemOrEquip(r.id,l.type,r.value)},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityDaBiaoPaiHangItemView=t,__reflect(t.prototype,"foxgame.ActivityDaBiaoPaiHangItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/kaifujingji/ActivityJingJiPaiHangSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){this.ui.listScroller.verticalScrollBar.autoVisibility=!1,this.ui.listScroller.viewport.scrollV=0;var t=this.ui.listgroup;t.dataProvider=this.model.collection_paihang,t.itemRenderer=e.ActivityDaBiaoPaiHangItemView;var i=this.model.getDaBiaoHuoDong(),n=i.getActivityRankInfo(),o=0;n.length>1&&n[0].getRankInfo().length>1?(o=this.model.getZhanLiType(),0==o?o=1:o+=5):o=n[0].getRankInfo()[0].getType();var a="";switch(o){case e.DaBiaoAtivityType.baoshibang:a="bang_baoshi";break;case e.DaBiaoAtivityType.daozunbang:a="bang_daozun";break;case e.DaBiaoAtivityType.fashengbang:a="bang_fasheng";break;case e.DaBiaoAtivityType.shenyibang:a="bang_shenyi";break;case e.DaBiaoAtivityType.shenzhuangpaihang:a="bang_shenzhuang";break;case e.DaBiaoAtivityType.tejiepaihang:a="bang_tejie";break;case e.DaBiaoAtivityType.zhanlibang:a="bang_zhanli";break;case e.DaBiaoAtivityType.zhanshenbang:a="bang_zhansheng";break;case e.DaBiaoAtivityType.zhaungbeishengxing:a="bang_shengxing";break;case e.DaBiaoAtivityType.zhuangbeiqianghua:a="bang_qianghua"}this.ui.titleImg.source=a;var s=[],r=this.model.getZhanLiType(),l=n.length;n.length>1?r+=1:r=r;for(var h=0;l>h;h++){var c=n[h];if(c.getRankType()==r){s=c.getRankInfo().concat();break}}this.model.collection_paihang.replaceAll(s)},i.prototype.showHook=function(){this.initUI()},i}(e.BasePanel);e.ActivityDaBiaoPaiHangView=t,__reflect(t.prototype,"foxgame.ActivityDaBiaoPaiHangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityJingJiZhanLiItemSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){this.curretnVo=this.chongzhiVO=this.data;var t=this.curretnVo.getAward().split(","),i=new e.AttributeVO(t[0]);return this.txt1.text=this.changeRankNum(),0==t.length?(this.txt3.text="",void(this.txt2.text=e.LanguageUtils.instance.getValue("ZANWU"))):(this.itemIcon.setItem(i.id,i.value,!0),this.txt2.text=this.chongzhiVO.getName(),this.txt3.text=this.chongzhiVO.getActivityProgress()+"",this.paiming.textFlow=(new egret.HtmlTextParser).parser("<a href = ''><u>"+this.paiming.text+"</u></a>"),this.paiming.touchEnabled=!0,this.paiming.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),void this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this))},i.prototype.changeRankNum=function(){var t="",i=this.chongzhiVO.getRank();t=i+"";for(var n="",o=0;o<t.length;o++){var a=e.LanguageUtils.instance.getValue("HANZINUMBER"+Number(t.charAt(o)));n+=a}var s,r=0,l=this.chongzhiVO.getType();switch(r=this.chongzhiVO.getName().length>1?this.chongzhiVO.getProf():this.chongzhiVO.getProf()-1,l){case 6:s=e.LanguageUtils.instance.getValue("PROF_1"),this.currentType=1;break;case 7:s=e.LanguageUtils.instance.getValue("PROF_2"),this.currentType=2;break;case 8:s=e.LanguageUtils.instance.getValue("PROF_3"),this.currentType=3;break;default:this.currentType=0}return s+e.LanguageUtils.instance.getValue("MINGCI",n)},i.prototype.onClick=function(t){var i=this.curretnVo.getAward().split(","),n=new e.AttributeVO(i[0]);switch(t.target){case this.itemIcon:var o=e.JsonDataManager.instance.itemTemplate[n.id];e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,o.type,n.value);break;case this.paiming:e.ActivityController.getIntance().showJingJiPaiHangPanel(this.currentType)}},i}(eui.ItemRenderer);e.ActivityDaBiaoZhanliItemView=t,__reflect(t.prototype,"foxgame.ActivityDaBiaoZhanliItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKaiFuLiBaoItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.curretnVo=this.data,this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=this.curretnVo.getAwards().split(","),i=new e.AttributeVO(t[0]);this.curretnVo=this.data,this.item.setItem(i.id,i.value,!0),this.lastPrice.text=this.curretnVo.getOriginalPrice()+"",this.nowPrice.text=this.curretnVo.getPresentPrice()+"",this.buyCost=this.curretnVo.getPresentPrice();var n=0;this.curretnVo.getBuyCount()==this.curretnVo.getBuyNumber()?(this.buyBtn.touchEnabled=!1,this.buyBtn.enabled=!1,n=16711680):(this.buyBtn.touchEnabled=!0,this.buyBtn.enabled=!0,n=2227971),this.txtDesc.text=e.LanguageUtils.instance.getValue("ACTIVITY_CAN_BUY_TIMES",this.curretnVo.getBuyCount(),this.curretnVo.getBuyNumber()),this.txtDesc.textColor=n,this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.buyBtn.touchEnabled&&this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i=this.curretnVo.getAwards().split(","),n=new e.AttributeVO(i[0]);switch(t.target){case this.buyBtn:var o=e.PlayerService.instance.playerInfo.getGold();if(o<this.buyCost)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.lingquAward();break;case this.item:var a=e.JsonDataManager.instance.itemTemplate[n.id];e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,a.type,n.value)}},i.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPOpenPackageBuyReq");t.setId(this.curretnVo.getId()),e.Message.instance.send(e.Code.OPEN_DISCOUNT_ACTIVITY_BUY_C,t,!0)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityKaiFuLiBaoItemView=t,__reflect(t.prototype,"foxgame.ActivityKaiFuLiBaoItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKaiFuLiBaoSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.checkActivityData=function(){},i.prototype.updataSceneBtn=function(){},i.prototype.updataView=function(e){this._data=e,this.initUI()},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getCollection_kaifu(),t.itemRenderer=e.ActivityKaiFuLiBaoItemView},i.prototype.initListener=function(){},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.initView=function(){},i.prototype.recvMsg=function(t,i){t==e.MsgCMD.FIGHTFB_GOTO},i}(eui.Component);e.ActivityKaiFuLiBaoView=t,__reflect(t.prototype,"foxgame.ActivityKaiFuLiBaoView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKuaFuPaiMingItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curretnVo=this.data;var t="";if(0==this.curretnVo.getItmeId())this.icon.source="",this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=e.LanguageUtils.instance.getValue("ZANWU"),t=e.LanguageUtils.instance.getValue("KuaFuBangDanChongZhi",0),this.money.textFlow=(new egret.HtmlTextParser).parser(t);else{var i=e.JsonDataManager.instance.roleTemplate,n=i[""+this.curretnVo.getItmeId()];this.icon.source=n.icon,this.mingci.text=this.curretnVo.getRanking()+"",this.playerName.text=this.curretnVo.getName(),t=e.LanguageUtils.instance.getValue("KuaFuBangDanChongZhi",this.curretnVo.getRankValue()),this.money.textFlow=(new egret.HtmlTextParser).parser(t)}this.itemVOArr=[];var o=this.curretnVo.getAwardstr().split(","),a=4,s=0;for(s;a>s;s++){var r=this["item_"+(s+1)],l=new e.AttributeVO(o[s]);if(s>o.length-1)break;r.visible=!0,r.setItem(l.id,l.value,!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(l)}for(s;a>s;s++){var r=this["item_"+(s+1)];r.visible=!1}},i.prototype.onClick=function(t){var i,n=this.itemVOArr;switch(t.target){case this.item_1:i=n[0];break;case this.item_2:i=n[1];break;case this.item_3:i=n[2];break;case this.item_4:i=n[3]}var o=e.JsonDataManager.instance.itemTemplate[i.id];e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,o.type,i.value)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityKuaFuPaiMingItemView=t,__reflect(t.prototype,"foxgame.ActivityKuaFuPaiMingItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityLeiJiXiaoHaoItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=4,i=0,n=this.data,o=e.ActivityController.getIntance().getLeiJiXiaoHaoData(),a=o.getGotAwardCfgId();if(this.chongzhiVO=o,t=a.length,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.curretnVo=n,t>0)for(var s=0;t>s;s++)if(this.curretnVo.getId()==a[s]){this.dailingqu.visible=!1,this.lingquImg.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break}if(this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?(this.lingquImg.visible?this.lingquBtn.visible=!1:this.lingquBtn.visible=!0,this.dailingqu.visible=!1):(this.lingquBtn.visible=!1,this.dailingqu.visible=!0),this.curretnVo){var r=e.LanguageUtils.instance.getValue("LEIJIXIAOHAO",this.curretnVo.getStepNumber());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(r);var l=this.curretnVo.getAwards(),h=l.split(",");for(t=4,this.itemVOArr=[],i=0;t>i;i++){var c=this["item_"+(i+1)];if(i>h.length-1)break;var u=new e.AttributeVO(h[i]);c.visible=!0,c.setItem(u.id,u.value,!0),c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(u)}for(i;t>i;i++){var c=this["item_"+(i+1)];c.visible=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)}},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?this.lingquAward():e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHONGZHIERDUBUZU"));break;case this.item_1:i=this.itemVOArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.itemVOArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.itemVOArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.itemVOArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByLeiJiXiaoHaoAward(this.curretnVo.getId())},i}(eui.ItemRenderer);e.ActivityLeiChongXiaoHaoItemView=t,__reflect(t.prototype,"foxgame.ActivityLeiChongXiaoHaoItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityLeiJiXiaoHaoSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.currentKaiQiTime=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.checkActivityData=function(){},i.prototype.updataSceneBtn=function(){},i.prototype.updataView=function(e,t){this._data=e,this.currentKaiQiTime=t,this.initUI()},i.prototype.initUI=function(){this.initListener(),this.top_chongzhiTxt.text=this._data.getAccRechargeGold()+e.LanguageUtils.instance.getValue("YUANBAO"),this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.currentKaiQiTime),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getCollection_leijixiaohao(),t.itemRenderer=e.ActivityLeiChongXiaoHaoItemView},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.initView=function(){},i.prototype.recvMsg=function(t,i){t==e.MsgCMD.FIGHTFB_GOTO},i}(eui.Component);e.ActivityLeiJiChongXiaoHaoView=t,__reflect(t.prototype,"foxgame.ActivityLeiJiChongXiaoHaoView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;
return e.skinName="ActivityLeiJiChongZhiItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=4,i=0,n=this.data,o=e.ActivityController.getIntance().getLeiJiChongZhiData(),a=o.getGotAwardCfgId();if(this.chongzhiVO=o,t=a.length,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.curretnVo=n,t>0)for(var s=0;t>s;s++)if(this.curretnVo.getId()==a[s]){this.dailingqu.visible=!1,this.lingquImg.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break}if(this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?(this.lingquImg.visible?this.lingquBtn.visible=!1:this.lingquBtn.visible=!0,this.dailingqu.visible=!1):(this.lingquBtn.visible=!1,this.dailingqu.visible=!0),this.curretnVo){var r=e.LanguageUtils.instance.getValue("LEIJICHONGZHI",this.curretnVo.getStepNumber());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(r);var l=this.curretnVo.getAwards(),h=l.split(",");for(t=4,this.itemVOArr=[],i=0;t>i;i++){var c=this["item_"+(i+1)];if(i>h.length-1)break;var u=new e.AttributeVO(h[i]);c.visible=!0,c.setItem(u.id,u.value,!0),c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(u)}for(i;t>i;i++){var c=this["item_"+(i+1)];c.visible=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)}},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.chongzhiVO.getAccRechargeGold()>=this.curretnVo.getStepNumber()?this.lingquAward():e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHONGZHIERDUBUZU"));break;case this.item_1:i=this.itemVOArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],n.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.id,!1):e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.itemVOArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],n.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.id,!1):e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.itemVOArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],n.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.id,!1):e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.itemVOArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],n.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.id,!1):e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByLeiJiLingQu(this.curretnVo.getId())},i}(eui.ItemRenderer);e.ActivityLeiJiChongZhiitemView=t,__reflect(t.prototype,"foxgame.ActivityLeiJiChongZhiitemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityLeiJiChongZhiSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.currentKaiQiTime=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.checkActivityData=function(){},i.prototype.updataSceneBtn=function(){},i.prototype.updataView=function(e,t){this._data=e,this.currentKaiQiTime=t,this.initUI()},i.prototype.initUI=function(){this.initListener(),this.top_chongzhiTxt.text=this._data.getAccRechargeGold()+e.LanguageUtils.instance.getValue("YUANBAO"),this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.currentKaiQiTime),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getCollection(),t.itemRenderer=e.ActivityLeiJiChongZhiitemView},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.initView=function(){},i.prototype.recvMsg=function(t,i){t==e.MsgCMD.FIGHTFB_GOTO},i}(eui.Component);e.ActivityLeiJiChongZhiView=t,__reflect(t.prototype,"foxgame.ActivityLeiJiChongZhiView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;i.isInit=!1,i.isDataChanged=!1,i.skinName="ActivityLianXuChongZhiItemSkin";var n=e.ActivityController.getIntance().getCreateNum();return n++,e.ActivityController.getIntance().setCreateNum(n),Log.trace(n),i}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t,i=4,n=0;this.curretnVo=this.data;var o,a=e.ActivityController.getIntance().getLianXuChongZhiData(),s=a.getGotAwardCfgId();this.dailingqu.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1,a.getContinueRechargedays()>=this.curretnVo.day&&(this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.lingquImg.visible=!1,this.dailingqu.visible=!1),i=s.length;for(var r=0;i>r;r++)if(s[r]==this.curretnVo.id){o=s[r],this.lingquImg.visible=!0,this.lingquBtn.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.touchEnabled=!1;break}for(i=4,t=this.curretnVo.awards,n=0;i>n;n++){var l=this["item_"+(n+1)];if(t[n]){var h=t[n];if(n>t.length-1)break;l.visible=!0,l.setItem(h.id,h.value,!0),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}else l.visible=!1}var c=this.curretnVo.day.toString(),u=c.split("");this.curretnVo.day<10?(this.numImg.text=this.curretnVo.day+"",this.numImg.x=0,this.newImg&&(this.label_group.removeChild(this.newImg),this.newImg=null),this.label_img&&(this.label_group.removeChild(this.label_img),this.label_img=null)):this.curretnVo.day<100?(this.numImg.text=u[0],this.newImg||(this.newImg=new eui.BitmapLabel,this.newImg.font="numberFont1_fnt",this.label_group.addChild(this.newImg)),this.newImg.text=u[1],this.numImg.x=0,this.newImg.x=12,this.label_img&&(this.label_group.removeChild(this.label_img),this.label_img=null)):(this.newImg||(this.newImg=new eui.BitmapLabel,this.newImg.font="numberFont1_fnt",this.label_group.addChild(this.newImg)),this.numImg.text=u[0],this.newImg.text=u[1],this.numImg.x=0,this.newImg.x=12,this.label_img||(this.label_img=new eui.BitmapLabel,this.label_img.font="numberFont1_fnt",this.label_group.addChild(this.label_img)),this.label_img.text=u[2],this.label_img.x=24),this.lingquBtn.visible&&e.ActivityLianXuChongZhiView.getIntance().changeScrollV(this.itemIndex),this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n,o=this.curretnVo.awards;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_1:i=o[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=o[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=o[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=o[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGetContinueRechargeAward");t.setAwardCfgId(this.curretnVo.id),e.Message.instance.send(e.Code.GET_CONTINUE_RECHARGE_AWARD_C,t,!0),App.SoundManager().playEffect("sound_award_mp3")},i}(eui.ItemRenderer);e.ActivityLianXuChongZhiitemView=t,__reflect(t.prototype,"foxgame.ActivityLianXuChongZhiitemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.curScroll_index=0,e.isopen=!1,e.skinName="ActivityLianXuChongZhiSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.kaiqiTime=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.checkActivityData=function(){},i.prototype.updataSceneBtn=function(){},i.prototype.updataView=function(e,t){this.isopen=!1,this._data=e,this.kaiqiTime=t,this.initUI()},i.prototype.initUI=function(){this.curScroll_index=0,this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=e.GlobalConfig.instance.getValue("RETURN_INTEREST_MAXMONEY"),i=this.listgroup;i.dataProvider=e.ActivityController.getIntance().getCollection_lianxuchongzhi(),i.itemRenderer=e.ActivityLianXuChongZhiitemView,this.goldNum.text=t+"",e.GamePlatform.isDragonEx?this.normalImg.source="lianchong_di_dt_jpg":e.GamePlatform.isDragonEx_qld?this.normalImg.source="lianchong_di_yb_jpg":this.normalImg.source="lianchong_di_jpg",this.objArr=[];var n=e.JsonDataManager.instance.coutinueItemArr,o=n.awardStr;if(o.length>1){var a=o.split(","),s=0,r=a.length;for(s;r>s;s++){var l=a[s],h=l.split("_"),c=new Object;c.id=Number(h[1]),c.type=Number(h[0]),c.num=Number(h[2]);var u=this["item_"+s];u.visible=!0,u.setItem(c.id,c.num,!0),u.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.objArr.push(c)}if(10>r)for(s;10>s;s++){var u=this["item_"+s];u.visible=!1}}},i.prototype.cleanScroll=function(){this.curScroll_index=0},i.prototype.changeScrollV=function(t){this.isopen||((t<this.curScroll_index||0==this.curScroll_index)&&1e3!=t&&(this.curScroll_index=t,this.isopen=!0),this.itemIntance||(this.itemIntance=new e.ActivityLianXuChongZhiitemView),this.listScroller.viewport.scrollV=this.curScroll_index*this.itemIntance.height)},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.item_0:i=this.objArr[0];break;case this.item_1:i=this.objArr[1];break;case this.item_2:i=this.objArr[2];break;case this.item_3:i=this.objArr[3];break;case this.item_4:i=this.objArr[4];break;case this.item_5:i=this.objArr[5];break;case this.item_6:i=this.objArr[6];break;case this.item_7:i=this.objArr[7];break;case this.item_8:i=this.objArr[8];break;case this.item_9:i=this.objArr[9];break;default:return}n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityLianXuChongZhiView=t,__reflect(t.prototype,"foxgame.ActivityLianXuChongZhiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.monthCard=1]="monthCard",e[e.leijichongzhi=2]="leijichongzhi",e[e.lianxuchongzhi=3]="lianxuchongzhi",e[e.chongzhidanxiangbeishu=4]="chongzhidanxiangbeishu",e[e.guanzhuweixin=5]="guanzhuweixin",e[e.leijixiaofei=6]="leijixiaofei",e[e.zhongqiuhuanzi=7]="zhongqiuhuanzi",e[e.chongzhipaiming=8]="chongzhipaiming",e[e.chongzhidouble=9]="chongzhidouble",e[e.jiazhibaozang=10]="jiazhibaozang",e[e.kaifulibao=11]="kaifulibao",e[e.allPlayerfuli=12]="allPlayerfuli",e[e.jingyanNbei=13]="jingyanNbei",e[e.jingjichangNbei=14]="jingjichangNbei",e[e.zhuangbeidiaoluo=15]="zhuangbeidiaoluo",e[e.kuaisuzhandoudouble=16]="kuaisuzhandoudouble",e[e.rongliandouble=17]="rongliandouble",e[e.zhuangbeiselldouble=18]="zhuangbeiselldouble",e[e.dabiaohuodong=19]="dabiaohuodong",e[e.wanjiazhucetianshu=20]="wanjiazhucetianshu",e[e.meirichongzhifanli=21]="meirichongzhifanli",e[e.weekCard=24]="weekCard",e[e.yuanzhengwuzi=25]="yuanzhengwuzi",e[e.xianshixiangou=26]="xianshixiangou",e[e.leijidenglu=27]="leijidenglu",e[e.chongzhifanli2=28]="chongzhifanli2",e[e.baoshigongfang=29]="baoshigongfang",e[e.fengkuangzhuanlun=30]="fengkuangzhuanlun",e[e.luckbox=31]="luckbox",e[e.fiveStar=32]="fiveStar",e[e.haoyouyaoqing=33]="haoyouyaoqing",e[e.chuzuchedijia=34]="chuzuchedijia",e[e.xuedixunbao=35]="xuedixunbao",e[e.meirixianli=36]="meirixianli",e[e.jubaopen=37]="jubaopen",e[e.tongjinzhu=38]="tongjinzhu",e[e.zajindan=39]="zajindan",e[e.wanjiadenghuo=40]="wanjiadenghuo",e[e.caifujulebu=41]="caifujulebu",e[e.qianghongbao=42]="qianghongbao",e[e.liaotiancaidan=43]="liaotiancaidan",e[e.paihangxianli=44]="paihangxianli",e[e.zhongshencard=45]="zhongshencard",e[e.meiriqiandao=46]="meiriqiandao",e[e.zhanlipaihang=47]="zhanlipaihang",e[e.chengzhangjijin=22]="chengzhangjijin",e[e.shouchonglibao=49]="shouchonglibao",e[e.lianxuchongzhihongli=50]="lianxuchongzhihongli",e[e.viplibao=51]="viplibao",e[e.xiaofeipaiming=52]="xiaofeipaiming",e[e.yuanbaofanhuan=53]="yuanbaofanhuan",e[e.qitianfanli=54]="qitianfanli",e[e.kuanghuanjijin=55]="kuanghuanjijin",e[e.tehuilibao=56]="tehuilibao",e[e.haohuaqiandao=57]="haohuaqiandao",e[e.shuijingshop=58]="shuijingshop",e[e.shengwangdazao=59]="shengwangdazao",e[e.xiangoushangdian=60]="xiangoushangdian",e[e.hefumingrentang=61]="hefumingrentang",e[e.hefukuanghuan=62]="hefukuanghuan",e[e.hefuxiaofei=63]="hefuxiaofei",e[e.shandangceshifanzuanshi=64]="shandangceshifanzuanshi",e[e.qitianqiandao=65]="qitianqiandao",e[e.kaifuhuodong=66]="kaifuhuodong",e[e.tanchuanghuodong=67]="tanchuanghuodong",e[e.qifuhuodong=68]="qifuhuodong",e[e.meirileijixiaofei=69]="meirileijixiaofei",e[e.liuxiaolingbuff=70]="liuxiaolingbuff",e[e.dulileijixiaohao=71]="dulileijixiaohao",e[e.dulileijichongzhi=72]="dulileijichongzhi",e[e.luckzhuanpan=73]="luckzhuanpan",e[e.danyuechongzhileiji=74]="danyuechongzhileiji",e[e.wuyilaodongjie=75]="wuyilaodongjie",e[e.kfchongzhipaihang=92]="kfchongzhipaihang",e[e.kfxiaofeipaihang=93]="kfxiaofeipaihang",e[e.kfzhanlipaihang=94]="kfzhanlipaihang",e[e.kfdengjipaihang=95]="kfdengjipaihang"}(t=e.activityDaTingType||(e.activityDaTingType={}));var i=function(i){function n(){var e=i.call(this)||this;return e.currentPage=0,e.currentSelect=0,e}return __extends(n,i),n.prototype.onEventRemovedFromParent=function(e){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.activityData=null,this.currentShowArr=null,this.btnSceneTypeArr=null,this.btnSceneDataArr=null,this.listData=null},n.prototype.setSelect=function(e){if(this.currentSelect=0,this.currentShowArr&&this.currentShowArr.length>0)for(var t=this.currentShowArr.length,i=0;t>i;i++){var n=this.currentShowArr[i],o=n.vo;o&&o.getActivityId()==e?(this.currentSelect=e,n.select=!0):n.select=!1}this.refresh()},n.prototype.updataView=function(t,i){if(void 0===t&&(t=null),this.model=e.ActivityController.getIntance().getModelForDaBiao(),this.listData=i,this.currentPage=0,this.callBackF=t,null!=this.listData){var n=this.listData.getActivity();if(null!=n&&0!=n.length){this.scrollBottom.scrollPolicyH=eui.ScrollPolicy.AUTO,this.scrollBottom.horizontalScrollBar.autoVisibility=!1,this.scrollBottom.scrollPolicyV=eui.ScrollPolicy.OFF;var o=new eui.TileLayout;o.requestedColumnCount=0,o.requestedRowCount=1,o.horizontalGap=-23,o.verticalGap=1,o.paddingLeft=-10,o.paddingRight=-10,this.scrollBottom.viewport.scrollH=0;var a=this.listBottom;a.dataProvider=e.ActivityController.getIntance().getCollection_bottom(),a.itemRenderer=e.ActivityMainBottomItemView,a.layout=o,this.activityData=this.listData.getActivity(),this.checkActivityData(),this.changeBtnXuanZhong(0),this.initUI()}}},n.prototype.changeViewByIndex=function(e){var t=this.currentShowArr,i=0,n=t.length,o=0;for(i;n>i;i++){var a=t[i];if(a){var s=a.vo;if(s.getActivityId()==e){o=i;break}}}this.changeBtnXuanZhong(o)},n.prototype.checkBtnRedVisible=function(){this.checkActivityData(),this.refresh()},n.prototype.refresh=function(){this.updataSceneBtn(),this.model.dataSource_bottom=this.currentShowArr,this.model.collection_bottom.replaceAll(this.model.dataSource_bottom)},n.prototype.checkActivityData=function(){var t,i=this.activityData.length,n=[];this.currentShowArr=[],n=this.listData.getActivity();for(var o=0;i>o;o++)if(t=n[o],t.getOpenPlace()==e.activityListType.dating){var a=new Object;a.vo=t,a.redPoint=this.checkRedPointVis(t.getActivityId()),t.getActivityId()==this.model.getCurrentType()?a.select=!0:a.select=!1,a.time=this.charStringBack(t.getStartTime(),t.getEndTime()),a.aVO=t,a.callBack=this.callBackF,this.currentShowArr.push(a)}},n.prototype.checkRedPointVis=function(e){var t=this.model.getRedPointArr(),i=t[""+e];return i?i.value:!1},n.prototype.setRedPoint=function(t,i){var n=this.currentShowArr[t].vo,o=e.ActivityController.getIntance().getRedPointArr(),a=!1,s=!1,r=!1;for(var l in o){var h=o[l];if(h.type==n.getActivityId()){a=h.value;break}}-1==i?t<this.currentPage?(a&&(s=a),this.redPoint_left.visible=s):t>=this.currentPage+4&&(a&&(r=a),this.redPoint_right.visible=r):this["redPoint_"+(i+1)].visible=a},n.prototype.updataSceneBtn=function(){var e=4,t=this.currentPage,i=e+t;if(!(i>this.currentShowArr.length)){this.btnSceneTypeArr=[],this.btnSceneDataArr=[];var n=this.currentShowArr.length,o=0;for(t=0;n>t;t++)t>=this.currentPage&&t<this.currentPage+4&&(this.changeBtnSource(o,t),o++)}},n.prototype.changeBtnSource=function(e,t){},n.prototype.initUI=function(){this.initListener()},n.prototype.initListener=function(){this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.prototype.changeViewOnLeftOrRight=function(e){var t=0;if(e>0){if(!(this.currentPage>=(this.currentShowArr.length-this.currentShowArr.length%4)/4)){if(e==(this.currentShowArr.length-this.currentShowArr.length%4)/4+1||4==this.currentShowArr.length)return;this.currentPage++}}else this.currentPage<=0||this.currentPage--;t=4*this.currentPage*(4/this.currentShowArr.length)*110,this.scrollBottom.viewport.scrollH=t},n.prototype.getSourceByBtn=function(e){return this.btnSceneDataArr&&this.btnSceneDataArr[e]?this.btnSceneDataArr[e].getImgSource():null},n.prototype.changeBtnXuanZhong=function(e){var i=this.currentShowArr[e].aVO;if(i){var n,o,a;i.getActivityId()==t.dabiaohuodong?a=""+t.dabiaohuodong:(o=i.getStartTime(),n=i.getEndTime(),a=this.charStringBack(o,n));for(var s=this.listData.getActivity().length,r=0;s>r;r++){var l=this.listData.getActivity()[r];l.getActivityId()==i.getActivityId()&&this.callBackF(i.getActivityId(),a)}}},n.prototype.onClick=function(e){switch(e.target){case this.leftBtn:Log.trace("leftBtn"),this.changeViewOnLeftOrRight(-1);break;case this.rightBtn:Log.trace("rightBtn"),this.changeViewOnLeftOrRight(1)}},n.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},n}(eui.Component);e.ActivityMainBottom=i,__reflect(i.prototype,"foxgame.ActivityMainBottom")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="ActivityMainBottomItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.redPoint.visible=!1,this.obj=this.data,this.vo=this.obj.vo;var t=this.obj.redPoint,i=this.obj.select;i?this.btn.source=this.vo.getImgSource()+"xuanzhong_png":this.btn.source=this.vo.getImgSource()+"_png",this.redPoint.visible=t,this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i=this.obj.callBack;if(i){var n="";n=this.vo.getActivityId()==e.activityDaTingType.dabiaohuodong?""+e.activityDaTingType.dabiaohuodong:this.obj.time,i(this.vo.getActivityId(),n)}},i}(eui.ItemRenderer);e.ActivityMainBottomItemView=t,__reflect(t.prototype,"foxgame.ActivityMainBottomItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityMeiRiXianLiSkin",e.dataisok=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this.xianliData=null,this.removeChildren(),i._intance=null},i.prototype.initUI=function(t){this.initListener(),this.xianliData=t;var i=e.JsonDataManager.instance.AccRechargeArr;if(!i)return void console.warn("JsonDataManager.instance.AccRechargeArr undefined");var n=i.length,o=this.xianliData.getGotAwardCfgId();if(this.curretnVo=i[0],this.lingquimg.visible=!1,this.lingquBtn.visible=!0,this.curretnVo.sum>this.xianliData.getAccRechargeGold()&&0==o.length);else{n=o.length;for(var a=0;n>a;a++){var s=o[a];if(s==this.curretnVo.id){this.lingquBtn.visible=!1,this.lingquimg.visible=!0;break}}}this.txtdesc.text=this.xianliData.getAccRechargeGold()+e.LanguageUtils.instance.getValue("YUAN");var r=this.curretnVo.awards;n=r.length;for(var a=0;n>a;a++){var l=r[a],h=this["item_"+a];h.touchEnabled=!0,h.setItem(l.id,l.value,!0),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.updataView=function(e){this.initUI(e)},i.prototype.initListener=function(){this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i,n=this.curretnVo.awards;switch(t.target){case this.lingquBtn:if(this.curretnVo.sum>this.xianliData.getAccRechargeGold()){e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHONGZHIERDUBUZU"));e.PlayerService.instance.vipLevel;e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)}else this.lingquAward();break;case this.item_0:i=e.JsonDataManager.instance.itemTemplate[n[0].id],e.ActivityController.getIntance().showTipsByItemOrEquip(n[0].id,i.type,n[0].value);break;case this.item_1:i=e.JsonDataManager.instance.itemTemplate[n[1].id],e.ActivityController.getIntance().showTipsByItemOrEquip(n[1].id,i.type,n[1].value);break;case this.item_2:i=e.JsonDataManager.instance.itemTemplate[n[2].id],e.ActivityController.getIntance().showTipsByItemOrEquip(n[2].id,i.type,n[2].value);break;case this.item_3:i=e.JsonDataManager.instance.itemTemplate[n[3].id],e.ActivityController.getIntance().showTipsByItemOrEquip(n[3].id,i.type,n[3].value)}},i.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGetAccRechargeAward");t.setAwardCfgId(this.curretnVo.id),e.Message.instance.send(e.Code.GET_DAY_RECHARGE_AWARD_C,t,!0)},i}(eui.Component);e.ActivityMeiRiXianLiView=t,__reflect(t.prototype,"foxgame.ActivityMeiRiXianLiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="ActivityQuanminfuliItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.currentData=null},i.prototype.setItem=function(t){this.curretnVo=t,this.chongzhiVO=e.JsonDataManager.instance.quanminfuliArr},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.isDataChanged=!0,this.updataView()},i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);this.curretnVo=this.data;var t=new e.AttributeVO(this.curretnVo.getAwards());this.item.setItem(t.id,t.value,!0),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lastPrice.text=this.curretnVo.getOriginalPrice()+"",this.nowPrice.text=this.curretnVo.getPresentPrice()+"",this.buyCost=this.curretnVo.getPresentPrice();var i=0;this.curretnVo.getBuyCount()==this.curretnVo.getBuyNumber()?(this.buyBtn.enabled=!1,this.buyBtn.touchEnabled=!1,i=16711680):(this.buyBtn.enabled=!0,this.buyBtn.touchEnabled=!0,i=2227971),this.txtDesc.text=e.LanguageUtils.instance.getValue("ACTIVITY_CAN_BUY_TIMES",this.curretnVo.getBuyCount(),this.curretnVo.getBuyNumber()),this.txtDesc.textColor=i,this.buyBtn.touchEnabled?this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this):this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.buyBtn:var i=e.PlayerService.instance.playerInfo.getGold();if(i<this.buyCost)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.lingquAward();break;case this.item:var n=new e.AttributeVO(this.curretnVo.getAwards());e.ActivityController.getIntance().showTipsByItemOrEquip(this.item.itemId,n.type,n.value)}},i.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPOpenPeopleWelfareBuyReq");t.setId(this.curretnVo.getId()),e.Message.instance.send(e.Code.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_C,t,!0)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isInit=!0},i}(eui.ItemRenderer);e.ActivityQuanminfuliItemView=t,__reflect(t.prototype,"foxgame.ActivityQuanminfuliItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityQuanminfuliSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.quanminList.dataProvider=null},i.prototype.cleanDataDelete=function(){this.quanminList.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.quanminList.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this._data=e,this.initUI()},i.prototype.initUI=function(){this.quanminScroller.verticalScrollBar.autoVisibility=!1,this.quanminScroller.viewport.scrollV=0;var t=this.quanminList;t.dataProvider=e.ActivityController.getIntance().getCollection_quanminfuli(),t.itemRenderer=e.ActivityQuanminfuliItemView},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityQuanminfuliView=t,__reflect(t.prototype,"foxgame.ActivityQuanminfuliView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/share/ShareMainSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.initListener(),this.splitStr()},i.prototype.splitStr=function(){for(var t=e.GlobalConfig.instance.getValue("GAME_SHARING_INFO"),i=t.split(","),n=(i.length,0);n<this.getShareItemCells().length;n++){var o=this.getShareItemCells()[n],a=new e.AttributeVO(i[n]);o.setItem(a.id,a.value,!0,!0),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showTip,this)}for(var s=e.GlobalConfig.instance.getValue("FOLLOW_REWARD"),r=s.split(","),n=0;n<this.getFollowItems().length;n++){var o=this.getFollowItems()[n],a=new e.AttributeVO(r[n]);o.setItem(a.id,a.value,!0,!0),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showTip,this)}},i.prototype.initUI=function(){this.ui.ShareInvite.visible=!0,this.ui.invite.visible=!1,this.ui.followGroup.visible=!1,this.initBtnState(),this.ui.shareBtn1.enabled=!1,1==this.ui.invite.visible?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.initListener=function(){this.ui.inviteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.shareBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.shareToBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.followBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.followStateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(this.initBtnState(),t.target){case this.ui.inviteBtn:e.ActivityController.getIntance().sendmessageToServerByInvite(),this.ui.inviteBtn.enabled=!1,this.ui.invite.visible=!0,this.ui.ShareInvite.visible=!1,this.ui.followGroup.visible=!1;break;case this.ui.shareBtn1:this.ui.shareBtn1.enabled=!1,this.ui.ShareInvite.visible=!0,this.ui.invite.visible=!1,this.ui.followGroup.visible=!1;
break;case this.ui.shareToBtn:e.UserInfo.platform.callWechatShare({ip:e.Global.serverHost,port:e.Global.serverPort});break;case this.ui.lingquBtn:e.ActivityController.getIntance().sendmessageToServerByGet();break;case this.ui.followBtn:this.ui.followBtn.enabled=!1,this.ui.ShareInvite.visible=!1,this.ui.invite.visible=!1,this.ui.followGroup.visible=!0,this.sendGetFollowStateReq();break;case this.ui.followStateBtn:e.UserInfo.platform.follow(),this.close()}1==this.ui.invite.visible?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.initBtnState=function(){this.ui.shareBtn1.enabled=!0,this.ui.inviteBtn.enabled=!0,this.ui.followBtn.enabled=!0},i.prototype.updateFollowView=function(t){t.getState()?(this.ui.followText.text=e.LanguageUtils.instance.getValue("YIGUANZHU"),this.ui.followStateBtn.enabled=!1):e.UserInfo.platform.checkFollow(this.setFollowState.bind(this))},i.prototype.setFollowState=function(t){var i=0!=Number(t.follow);0==i||void 0==i?this.ui.followStateBtn.enabled=!0:(this.ui.followText.text=e.LanguageUtils.instance.getValue("YIGUANZHU"),this.ui.followStateBtn.enabled=!1,this.sendGetFollowRewardReq())},i.prototype.sendGetFollowStateReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGameFollowStateReq");e.Message.instance.send(e.Code.GAME_FOLLOW_GET_STATE_C,t,!0)},i.prototype.sendGetFollowRewardReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGameFollowRewardReq");e.Message.instance.send(e.Code.GAME_FOLLOW_GET_AWARD_C,t,!0)},i.prototype.updateView=function(t){this.ui.txttotal.text=t.getSumgolds()+e.LanguageUtils.instance.getValue("YUANBAO"),this.ui.txtcan.text=t.getGoldsNumber()+e.LanguageUtils.instance.getValue("YUANBAO"),this.ui.txtpeople.text=t.getNumber()+" "},i.prototype.updategetView=function(t){t.getErrorNo()>0?e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DANGMEIYOUKELINGQUYUANBAO")):(this.ui.txttotal.text=t.getSumgolds()+e.LanguageUtils.instance.getValue("YUANBAO"),this.ui.txtcan.text=t.getGoldsNumber()+e.LanguageUtils.instance.getValue("YUANBAO"),this.ui.txtpeople.text=t.getNumber()+" ")},i.prototype.sendShareReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGameSharingInfoReq");e.Message.instance.send(e.Code.GAME_SHANRING_C,t,!0)},i.prototype.showTip=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.refresh=function(){this.initUI()},i.prototype.getShareItemCells=function(){var e=[];return e.push(this.ui.itemCell0),e.push(this.ui.itemCell1),e.push(this.ui.itemCell2),e.push(this.ui.itemCell3),e},i.prototype.getFollowItems=function(){var e=[];return e.push(this.ui.itemCell4),e.push(this.ui.itemCell5),e.push(this.ui.itemCell6),e.push(this.ui.itemCell7),e},i}(e.BasePanel);e.ActivityShareView=t,__reflect(t.prototype,"foxgame.ActivityShareView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityXiaoFeiPaiMingItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){this.curretnVo=this.data,e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.mingci.text=this.curretnVo.getRank()+"";var t="";if(this.curretnVo.getName()){this.playerName.text=this.curretnVo.getName(),t=e.LanguageUtils.instance.getValue("ChongZhiPaiMing2",this.curretnVo.getGolds()),this.money.textFlow=(new egret.HtmlTextParser).parser(t);var i=e.JsonDataManager.instance.roleTemplate,n=i[""+this.curretnVo.getTimeId()];this.icon.source=n.icon}else this.mingci.text=this.curretnVo.getRank()+"",this.playerName.text=e.LanguageUtils.instance.getValue("ZANWU"),t=e.LanguageUtils.instance.getValue("ChongZhiPaiMing2",0),this.money.textFlow=(new egret.HtmlTextParser).parser(t),this.icon.source=null;this.itemVOArr=[];var o=this.curretnVo.getAward().split(","),a=4,s=0;for(s;a>s;s++){var r=this["item_"+(s+1)],l=new e.AttributeVO(o[s]);if(s>o.length-1)break;r.visible=!0,r.setItem(l.id,l.value,!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.itemVOArr.push(l)}for(s;a>s;s++){var r=this["item_"+(s+1)];r.visible=!1}},i.prototype.onClick=function(t){var i,n=this.itemVOArr;switch(t.target){case this.item_1:i=n[0];break;case this.item_2:i=n[1];break;case this.item_3:i=n[2];break;case this.item_4:i=n[3]}var o=e.JsonDataManager.instance.itemTemplate[i.id];e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,o.type,i.value)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ActivityXiaoFeiPaiMingItemView=t,__reflect(t.prototype,"foxgame.ActivityXiaoFeiPaiMingItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityXiaoFeiPaiMingSkin",e}return __extends(i,t),i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){this.listgroup.dataProvider=null},i.prototype.cleanDataDelete=function(){this.listgroup.dataProvider=null,this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.timeStr=null,this.top_huodongTime.textFlow=null,this.listgroup.removeChildren(),this.removeChildren(),i._intance=null},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.updataView=function(e,t){void 0===t&&(t=""),this._data=e,this.timeStr=t,this.initUI()},i.prototype.initUI=function(){this.initListener(),this.listScroller.verticalScrollBar.autoVisibility=!1,e.ActivityController.getIntance().getViewScallV()||(this.listScroller.viewport.scrollV=0);var t=this.listgroup;t.dataProvider=e.ActivityController.getIntance().getCollection_xiaohaopaiming(),t.itemRenderer=e.ActivityXiaoFeiPaiMingItemView,this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(this.timeStr),this._data.getRanking()<=0?this.myIndex.text="0":this.myIndex.text=this._data.getRanking()+"",this.myMoney.text=this._data.getGolds()+e.LanguageUtils.instance.getValue("YUANBAO");var i=this._data.getAwardInfo()[0],n=e.LanguageUtils.instance.getValue("ChongZhiPaiMing5",i.getGears());this.titleMoney.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.initListener=function(){this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityXiaoFeiPaiMingView=t,__reflect(t.prototype,"foxgame.ActivityXiaoFeiPaiMingView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="DaFanLiitem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){var t=this.data,i=e.ActivityController.getIntance().getModelForDaBiao().rechargeRebateData;this.lab_001.text=t.getMin()+"元-"+t.getMax()+"元",t.getMax()>=9999999&&(this.lab_001.text=t.getMin()+"元以上"),this.bitmap_001.text=t.getAwardNumber()+"%",this.ani&&(this.ani.clear(),this.ani=null),this.group_ani.removeChildren(),this.img_001.visible=!1,i.getMoney()>=t.getMin()&&i.getMoney()<=t.getMax()&&(this.ani=new e.FoxAni(this.group_ani),this.ani.play("fx_fanli","ani",-1),this.img_001.visible=!0)},i}(eui.ItemRenderer);e.DaFanLiitem=t,__reflect(t.prototype,"foxgame.DaFanLiitem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"DaFanLiPanel")||this;return i.model=e,i}return __extends(i,t),i.prototype.showpanel=function(){null!=this.model.rechargeRebateData&&(this.getIsShow()||this.show())},i.prototype.refresh=function(){var t=this.model.rechargeRebateData,i=this.getactivitytime(this.model.getListData().getActivity());this.ui.lab_004.textFlow=(new egret.HtmlTextParser).parser("<font color=0xFFE400>活动时间:</font><font color=0x21FF03>"+this.dateBysign(i.getStartTime())+"-"+this.dateBysign(i.getCloseTime())+"</font>"),this.ui.lab_005.textFlow=(new egret.HtmlTextParser).parser("<font color=0xFFE400>发奖时间:当日</font><font color=0x21FF03>23:59</font><font color=0xFFE400>邮件发放</font>"),this.ui.list.itemRenderer=e.DaFanLiitem,this.ui.list.dataProvider=this.collection,this.collection.source=t.getRechargeCfg(),this.collection.refresh(),this.ui.lab_001.text=t.getMoney()+"元",this.ui.lab_002.text=t.getAwardGolds()+""},i.prototype.dateBysign=function(e){var t,i=Math.abs(Number(e)),n=new Date(i),o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=n.getHours(),l=n.getMinutes();t=0==r?"0"+r:""+r;var h;return h=0==l?"0"+l:""+l,o+"年"+a+"月"+s+"日"+t+":"+h},i.prototype.getactivitytime=function(t){for(var i,n=0;n<t.length;n++)if(i=t[n],i.getActivityId()==e.ActivityId.RECHARGE_REBATE)return i;return null},i.prototype.showHook=function(){},i.prototype.initParams=function(){this.collection=new eui.ArrayCollection},i.prototype.initHook=function(){this.ui.btn_001.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)},i.prototype.clickBtn=function(t){switch(t.target){case this.ui.btn_001:e.RechargeController.getInstance().showPanel();break;case this.ui.helpBtn:}},i}(e.BasePanel);e.DaFanLiPanel=t,__reflect(t.prototype,"foxgame.DaFanLiPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.awardData=[],e.skinName="ActivityHuiKuiMeiRiLeiChongItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data;var t=this.currentData.getAwards(),i=t.split(","),n=i.length;this.awardData=[];var o=0;for(o;n>o;o++){var a=new e.AttributeVO(i[o]);if(a){var s=this["item_"+(o+1)];s&&(s.setItem(a.id,a.value,!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.awardData.push(a),s.visible=!0)}}for(o;4>o;o++){var s=this["item_"+(o+1)];s&&(s.visible=!1)}var r=e.ActivityController.getIntance().getModelForDaBiao().getMeirichongzhiData();this.currentData.getIsAward()?(this.lingquBtn.visible=!1,this.lingquImg.visible=!0):this.currentData.getCond()<=r.getRecharge()?(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.enabled=!0,this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)):(this.lingquBtn.visible=!0,this.lingquImg.visible=!1,this.lingquBtn.enabled=!1);var l=e.LanguageUtils.instance.getValue("LEIJICHONGZHI",this.currentData.getCond());this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(l),this.lingquBtn.visible&&this.lingquBtn.enabled?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_1:i=this.awardData[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_2:i=this.awardData[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_3:i=this.awardData[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value);break;case this.item_4:i=this.awardData[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,n.type,i.value)}},i.prototype.lingquAward=function(){e.ActivityController.getIntance().sendMessageToSeverByMeiRiChongZhiGetAward(this.currentData.getCfgId())},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i}(eui.ItemRenderer);e.ActivityMeiRiChongZhiJiangLiItemView=t,__reflect(t.prototype,"foxgame.ActivityMeiRiChongZhiJiangLiItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/meirichongzhi/ActivityMeiRiChongZhiSkin.exml")||this;return i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.panelChanged=function(){this.getIsShow&&this.showView()},i.prototype.showView=function(){var t=this.model.getMeirichongzhiData();if(0!=t.getConfigInfo().length){var i=this.ui.list;i.dataProvider=this.model.meirichongzhiCollection,i.itemRenderer=e.ActivityMeiRiChongZhiJiangLiItemView;var n=e.LanguageUtils.instance.getValue("JINRIYILEIJICHONGZHI",t.getRecharge());this.ui.rechargedTxt.textFlow=(new egret.HtmlTextParser).parser(n);var o=t.getConfigInfo(),a=0,s=o.length,r=[],l=[];for(a;s>a;a++){var h=o[a];h.getIsAward()?r.push(h):l.push(h)}o=l.concat(r),this.model.meirichongzhiDataSource=o,this.model.meirichongzhiCollection.replaceAll(this.model.meirichongzhiDataSource)}},i.prototype.initHook=function(){e.ActivityController.getIntance().sendMessageToMeiRiChongzhi(),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helphandler,this),this.showView()},i.prototype.helphandler=function(t){e.HelpController.getInstance().showPanel("MEIRICHONGZHIHELP")},i.prototype.closeHook=function(){},i}(e.BasePanel);e.ActivityMeiRiChongZhiView=t,__reflect(t.prototype,"foxgame.ActivityMeiRiChongZhiView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this,"resource/skins/activityNew/mfsqView/MfsqViewSkin.exml")||this}return __extends(i,t),i.prototype.initHook=function(){this.ui.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeUIHandler,this)},i.prototype.closeUIHandler=function(){this.close()},i.prototype.closeHook=function(){e.ActivityBarController.getInstance().closFriendRank()},i}(e.BasePanel);e.MfsqFrienRankView=t,__reflect(t.prototype,"foxgame.MfsqFrienRankView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityTongJinZhuIconViewSkin",e}return __extends(i,t),i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){},i.prototype.setItem=function(t,i){var n=t.getPokeNumber();i>=n?this.lingquImg.visible=!0:this.lingquImg.visible=!1,this.vo=new e.AttributeVO(t.getAwardsInfo());var o;switch(this.vo&&(o=e.JsonDataManager.instance.itemTemplate[this.vo.id]),n){case 3:this.img_liang.visible=!0,this.img_an.visible=!1,this.jiangImg.visible=!0,this.icon.setItem(this.vo.id,this.vo.value,!0),this.itemLabel.text="";break;default:this.img_liang.visible=!1,this.img_an.visible=!0,this.jiangImg.visible=!1,this.icon.setItem(this.vo.id,this.vo.value,!1);var a=e.LanguageUtils.instance.getValue("POKE_PIG",n);this.itemLabel.textFlow=(new egret.HtmlTextParser).parser(a)}this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.ActivityController.getIntance().showTipsByItemOrEquip(this.vo.id,this.vo.type,this.vo.value)},i.iconSize=68,i}(eui.Component);e.ActivityTongJinZhuIconView=t,__reflect(t.prototype,"foxgame.ActivityTongJinZhuIconView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityTongJinZhuItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){var t=this.data;this.awardVO=new e.AttributeVO(t);e.JsonDataManager.instance.itemTemplate[this.awardVO.id];this.icon.setItem(this.awardVO.id,this.awardVO.value,!0),this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.ActivityController.getIntance().showTipsByItemOrEquip(this.awardVO.id,this.awardVO.type,this.awardVO.value)},i}(eui.ItemRenderer);e.ActivityTongJinZhuItemView=t,__reflect(t.prototype,"foxgame.ActivityTongJinZhuItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/tongjinzhu/ActivityTongJinZhuViewSkin.exml","activity_tongjinzhu")||this;return i.currentTiaoW=253,i.model=e,i.viewisReady=!1,i.dataReady=!1,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.panelChanged=function(){this.dataReady=!0,this.viewisReady&&this.initUI()},i.prototype.refresh=function(){},i.prototype.readyDestroy=function(){this.ui.list.dataProvider=null},i.prototype.closeHook=function(){},i.prototype.initHook=function(){},i.prototype.setViewRefresh=function(e){},i.prototype.initUI=function(){var t=new eui.TileLayout;t.requestedColumnCount=0,t.requestedRowCount=1,t.paddingLeft=e.ItemIcon.horizontalOver,t.paddingRight=e.ItemIcon.horizontalOver,t.horizontalGap=10;var i=this.ui.list;i.dataProvider=this.model.collection_tongjinzhu,i.itemRenderer=e.ActivityTongJinZhuItemView,i.layout=t,this.data=this.model.getTongJinZhuData();var n=this.data.getPropInfo()[4].getAwardsInfo().split(",");this.model.dataSource_tongjinzhu=n,this.model.collection_tongjinzhu.replaceAll(this.model.dataSource_tongjinzhu),this.ui.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var o=this.ui.item_0;o.setItem(this.data.getPropInfo()[0],this.data.getPokeNumber());var a=this.ui.item_1;a.setItem(this.data.getPropInfo()[1],this.data.getPokeNumber());var s=this.ui.item_2;s.setItem(this.data.getPropInfo()[2],this.data.getPokeNumber());var r=this.ui.item_3;r.setItem(this.data.getPropInfo()[3],this.data.getPokeNumber());var l=this.charStringBack(this.data.getStartTime(),this.data.getCloseTime());this.ui.timeTxt.textFlow=(new egret.HtmlTextParser).parser(l),e.GamePlatform.isDragonEx?this.ui.titleValue.text=this.data.getRechargeStall()/30+"":e.GamePlatform.isDragonEx_qld?this.ui.titleValue.text=this.data.getRechargeStall()+"":this.ui.titleValue.text=this.data.getRechargeStall()+"",this.ui.awardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.changeNumSp(this.data.getRechargeNumber(),this.data.getRechargeStall(),this.data.getRemainderNumber(),this.data.getPokeNumber()),this.ui.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),Number(this.ui.pokeNumCut.text)<=3?this.ui.jiangliT.visible=!0:this.ui.jiangliT.visible=!1,e.GamePlatform.isDragonEx?this.ui.normalImg.source="miaoshubiaotou_dt_png":e.GamePlatform.isDragonEx_qld?this.ui.normalImg.source="miaoshubiaotou_yb_png":this.ui.normalImg.source="miaoshubiaotou_png"},i.prototype.changeNumSp=function(t,i,n,o){e.GamePlatform.isDragonEx?this.ui.proNum.text=t/30+"/"+i/30:e.GamePlatform.isDragonEx_qld?this.ui.proNum.text=t+"/"+i:this.ui.proNum.text=t+"/"+i,this.ui.changeTiao.width=t/i*this.currentTiaoW;var a=i-t;e.GamePlatform.isDragonEx?this.ui.rechargeLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("POKE_PIG_YUANG",a/30)):e.GamePlatform.isDragonEx_qld?this.ui.rechargeLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("POKE_PIG_YUANG",a)):this.ui.rechargeLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("POKE_PIG_YUANG",a)),this.ui.pokeNumLast.text=""+n,this.ui.pokeNumCut.text=""+o},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.showHook=function(){this.viewisReady=!0,this.dataReady&&this.initUI(),e.ActivityBarController.getInstance().setjinzhuEffect(!1)},i.prototype.onClick=function(t){switch(t.target){case this.ui.leftBtn:this.ui.scroller.viewport.scrollH=0;break;case this.ui.rightBtn:this.ui.scroller.viewport.scrollH=93*(this.model.getTongJinZhuData().getPropInfo()[4].getAwardsInfo().split(",").length-1);break;case this.ui.awardBtn:this.data.getRemainderNumber()>0?e.ActivityController.getIntance().sendMessageToSeverByTongJinZhuBuy():e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("POKE_PIG_BUZHU"));break;case this.ui.buyBtn:e.PlayerService.instance.vipLevel;e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)}},i}(e.BasePanel);e.ActivityTongJinZhuView=t,__reflect(t.prototype,"foxgame.ActivityTongJinZhuView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityZaJinDanDanitemViewSkin",e}return __extends(i,t),i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){},i.prototype.setItem=function(t,i){var n=t.getPositionNumber();this.current_index=n,this.current_cishu=i,t.getAwards()&&""!=t.getAwards()?(this.goodDan.visible=!1,this.breakDan.visible=!0,this.current_State="break",this.itemIcon.setItem(t.getAwards())):(this.goodDan.visible=!0,this.breakDan.visible=!1,this.current_State="good",this.dan.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)),this.danTips.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMASH_GOLD_YICHI"))},i.prototype.onClick=function(t){switch(t.target){case this.dan:this.current_cishu>0?this.zaDan():e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SMASH_GOLD_BUZHU"))}},i.prototype.zaDan=function(){var t=!1,i=this.current_index;e.ActivityController.getIntance().sendMessageToSeverByZaJinDan_smash(t,i)},i.iconSize=68,i}(eui.Component);e.ActivityZaJinDanDanItemnView=t,__reflect(t.prototype,"foxgame.ActivityZaJinDanDanItemnView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityZaJinDanIconViewSkin",e}return __extends(i,t),i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){},i.prototype.setItem=function(t){this.vo=new e.AttributeVO(t);var i;this.vo&&(i=e.JsonDataManager.instance.itemTemplate[this.vo.id]),this.img_liang.visible=!0,this.jiangImg.visible=!1;for(var n=e.ActivityController.getIntance().getModelForDaBiao().getZaJinDanData().getPopList(),o=n[4].getAwards().split(","),a=o.length,s=0;a>s;s++){var r=o[s];if(r==t){this.jiangImg.visible=!0;break}}this.icon.setItem(this.vo.id,this.vo.value,!0),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.ActivityController.getIntance().showTipsByItemOrEquip(this.vo.id,this.vo.type,this.vo.value)},i.iconSize=68,i}(eui.Component);e.ActivityZaJinDanIconView=t,__reflect(t.prototype,"foxgame.ActivityZaJinDanIconView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityZaJinDanItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){var t=this.data;this.awardVO=new e.AttributeVO(t);var i=e.JsonDataManager.instance.itemTemplate[this.awardVO.id];this.icon.source=i.icon,this.itemLabel.text=i.name,this.itemLabel.textColor=e.ColorUtils.instance.getColorByQuality(i.quality),this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.ActivityController.getIntance().showTipsByItemOrEquip(this.awardVO.id,this.awardVO.type,this.awardVO.value)},i}(eui.ItemRenderer);e.ActivityZaJinDanItemView=t,__reflect(t.prototype,"foxgame.ActivityZaJinDanItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityZaJinDanItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){var t=this.data;this.awardVO=new e.AttributeVO(t);e.JsonDataManager.instance.itemTemplate[this.awardVO.id];this.icon.setItem(this.awardVO.id,this.awardVO.value,!0),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.ActivityController.getIntance().showTipsByItemOrEquip(this.awardVO.id,this.awardVO.type,this.awardVO.value)},i}(eui.ItemRenderer);e.ActivityZaJinDanListItemView=t,__reflect(t.prototype,"foxgame.ActivityZaJinDanListItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/zajindan/ActivityZaJinDanViewSkin.exml","activity_zajindan")||this;return i.currentTiaoW=253,i.model=e,i.viewisReady=!1,i.dataReady=!1,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.panelChanged=function(){this.viewisReady&&this.initUI(),this.dataReady=!0},i.prototype.refresh=function(){},i.prototype.readyDestroy=function(){this.ui.list.dataProvider=null},i.prototype.closeHook=function(){},i.prototype.initHook=function(){},i.prototype.setViewRefresh=function(e){},i.prototype.initUI=function(){var t=new eui.TileLayout;t.requestedColumnCount=3,t.requestedRowCount=0,t.paddingLeft=e.ItemIcon.horizontalOver,t.paddingRight=e.ItemIcon.horizontalOver,t.horizontalGap=15,t.verticalGap=10;var i=this.ui.list;i.dataProvider=this.model.collection_zajindan,i.itemRenderer=e.ActivityZaJinDanListItemView,i.layout=t,this.data=this.model.getZaJinDanData();var n=this.data.getPopList()[4].getAwards().split(",");this.model.dataSource_zajindan=n,this.model.collection_zajindan.replaceAll(this.model.dataSource_zajindan);var o=this.ui.item_0,a=this.data.getEveryDaybreakNumber();o.setItem(this.data.getBreakEggList()[0],a);var s=this.ui.item_1;s.setItem(this.data.getBreakEggList()[1],a);var r=this.ui.item_2;r.setItem(this.data.getBreakEggList()[2],a),this.ui.tipsNum.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMASH_GOLD_QINGKONG"));var l=this.charStringBack(this.data.getStartTime(),this.data.getCloseTime());this.ui.timeTxt.textFlow=(new egret.HtmlTextParser).parser(l),this.ui.titleValue.text=this.data.getGooldStall()+"";for(var h,c=this.data.getPopList(),u=this.data.getSumNumber(),p=c.length,g=0;p>g;g++){var d=c[g];if(d.getStallNumber()>0){if(d.getStallNumber()>u){this.ui.itemAward.setItem(d.getAwards()),h=e.LanguageUtils.instance.getValue("SMASH_GOLD_EGGS",d.getStallNumber());break}g==p-2&&(this.ui.itemAward.setItem(d.getAwards()),h=e.LanguageUtils.instance.getValue("SMASH_GOLD_EGGS",d.getStallNumber()))}}this.ui.leijizadanTxt.textFlow=(new egret.HtmlTextParser).parser(h);var f=this.data.getGooldStall()-this.data.getGooldNumber();l=e.LanguageUtils.instance.getValue("SMASH_GOLD_YBAO",f),this.ui.rechargeLabel.textFlow=(new egret.HtmlTextParser).parser(l),this.ui.proNum.text=this.data.getGooldNumber()+"/"+this.data.getGooldStall(),this.ui.changeTiao.width=this.data.getGooldNumber()/this.data.getGooldStall()*this.currentTiaoW;var m=e.GlobalConfig.instance.getValue("SMASH_GOLD_EGGS_GOLDS_NUMBER");this.ui.lastNum.text=this.data.getEveryDaybreakNumber()+"",l=this.data.getTopLimitNumber()+"/"+m,l=e.LanguageUtils.instance.getValue("SMASH_GOLD_CHISHU",l),this.ui.todayNum.textFlow=(new egret.HtmlTextParser).parser(l),this.ui.awardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var y=this.data.getBreakEggList();p=3,this.isbreak=!0;for(var g=0;p>g;g++){var I=y[g];if(!I.getAwards()||""==I.getAwards()){this.isbreak=!1;break}}this.isbreak?this.ui.awardBtn.label=e.LanguageUtils.instance.getValue("YIJIANLINGQU"):this.ui.awardBtn.label=e.LanguageUtils.instance.getValue("YIJIANZADAN")},i.prototype.changeNumSp=function(t,i,n,o){this.ui.proNum.text=t+"/"+i,this.ui.changeTiao.width=t/i*this.currentTiaoW;var a=i-t;this.ui.rechargeLabel.text=e.LanguageUtils.instance.getValue("SMASH_GOLD_YBAO",a),this.ui.pokeNumLast.text=""+n,this.ui.pokeNumCut.text=""+o},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.showHook=function(){this.ui.scroller.horizontalScrollBar.autoVisibility=!1,this.ui.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.dataReady&&this.initUI(),this.viewisReady=!0,e.ActivityBarController.getInstance().setjindanEffect(!1)},i.prototype.onClick=function(t){switch(t.target){case this.ui.awardBtn:this.isbreak?e.ActivityController.getIntance().sendMessageToSeverByZaJinDan_award():e.ActivityController.getIntance().sendMessageToSeverByZaJinDan_smash(!0,0)}},i}(e.BasePanel);e.ActivityZaJinDanView=t,__reflect(t.prototype,"foxgame.ActivityZaJinDanView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ZeroPackageitem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_001.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buy,this),this.icon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.icon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)},i.prototype.click=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.buy=function(t){var i=e.PlayerService.instance.playerInfo.getGold();if(i<this.info.getGolds())return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var n=HawkProtocolManager.newBuilder("JsProto.HPZeroPackageBuyRep");n.setId(this.info.getId()),e.Message.instance.send(e.Code.ZERO_PACKATE_BUY_C,n,!0)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){this.info=this.data,this.lab_001.text=this.info.getName(),this.lab_003.text=this.info.getGolds()+"";for(var t=this.info.getAwards().split(","),i=[],n=0;n<t.length;n++)i.push(new e.AttributeVO(t[n]));this.icon1.setItem(i[0].id,i[0].value,!0),this.icon2.setItem(i[1].id,i[1].value,!0),this.btn_001.visible=!this.info.getStatus(),this.img_001.visible=this.info.getStatus(),this.lab_002.visible=!this.info.getStatus()},i}(eui.ItemRenderer);e.ZeroPackageItem=t,__reflect(t.prototype,"foxgame.ZeroPackageItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"ZeroPackageskin")||this;return i.model=e,i}return __extends(i,t),i.prototype.initParams=function(){this.collection=new eui.ArrayCollection},i.prototype.initHook=function(){this.model.registerObserver(this)},i.prototype.refresh=function(){this.ui.list.itemRenderer=e.ZeroPackageItem,this.ui.list.dataProvider=this.collection,this.collection.replaceAll(this.model.ZeroPackageInfo);var t=this.getactivitytime(this.model.getListData().getActivity());null==t.getStartTime()?this.ui.lab_001.visible=this.ui.lab_002.visible=!1:(this.ui.lab_001.visible=this.ui.lab_002.visible=!0,this.ui.lab_001.text=this.dateBysign(t.getStartTime())+"-\n",this.ui.lab_001.text+=this.dateBysign(t.getCloseTime()))},i.prototype.dateBysign=function(e){var t,i=Math.abs(Number(e)),n=new Date(i),o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=n.getHours(),l=n.getMinutes();
t=0==r?"0"+r:""+r;var h;return h=0==l?"0"+l:""+l,o+"年"+a+"月"+s+"日"+t+":"+h},i.prototype.getactivitytime=function(t){for(var i,n=0;n<t.length;n++)if(i=t[n],i.getActivityId()==e.ActivityId.ZEROPACKAGE)return i;return null},i.prototype.showpanel=function(){this.getIsShow()||this.show()},i.prototype.panelChanged=function(){this.getIsShow()&&this.refresh()},i}(e.BasePanel);e.ZeroPackagePanel=t,__reflect(t.prototype,"foxgame.ZeroPackagePanel",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityHaoHuaQianDaoItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=this.data,i=t.strAward.split(","),n=i.length,o=0;for(this.itemArrD=[],o;n>o;o++){var a=i[o],s=a.split("_"),r=this["item_"+o];r.visible=!0,r.setItem(Number(s[1]),Number(s[2]),!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=new Object;l.id=Number(s[1]),l.type=Number(s[0]),l.num=Number(s[2]),this.itemArrD.push(l)}if(4>n)for(o;4>o;o++){var r=this["item_"+o];r.visible=!1}var h="";h=e.LanguageUtils.instance.getValue("XianShiHuoDong_DeluxeAttendance_2",t.money.toFixed(1)),this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(h);var c=t.step;switch(h=Number(t.money)>=Number(c)?e.LanguageUtils.instance.getValue("XianShiHuoDong_DeluxeAttendance_4",t.times,t.limitTimes):e.LanguageUtils.instance.getValue("XianShiHuoDong_DeluxeAttendance_3",t.times,t.limitTimes),this.cishuTxt.textFlow=(new egret.HtmlTextParser).parser(h),this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.curretnVo=t,t.status){case 0:this.lingquImg.visible=!1,this.dailingqu.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break;case 1:this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0;break;case 2:this.lingquImg.visible=!0,this.dailingqu.visible=!1,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_2:i=this.itemArrD[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_3:i=this.itemArrD[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().ToGetHaoHuaQianDaoAwardForSever(this.data.money)},i}(eui.ItemRenderer);e.ActivityHaoHuaQianDaoItemView=t,__reflect(t.prototype,"foxgame.ActivityHaoHuaQianDaoItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentAward=0,e.skinName="ActivityHaoHuaQianDaoSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this._data=e,this.initUI()},i.prototype.initUI=function(){var t=e.ActivityXianShiController.getIntance().charStringBack(this._data.getStartTime(),this._data.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.list;i.dataProvider=e.ActivityXianShiController.getIntance().getHaoHuaColleon(),i.itemRenderer=e.ActivityHaoHuaQianDaoItemView;var n=this.checkItemderData();e.ActivityXianShiController.getIntance().getHaoHuaColleon().replaceAll(n),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.checkItemderData=function(){var e=[],t=[],i=[],n=[],o=this._data.getMoney(),a=this._data.getLimitTimes(),s=this._data.getTimes(),r=this._data.getStep(),l=this._data.getStatus(),h=this._data.getList(),c=0,u=o.length;for(c;u>c;c++){var p=new Object;p.money=o[c],p.limitTimes=a[c],p.times=s[c],p.step=r,p.status=l[c],p.strAward=h[c],1==l[c]?t.push(p):2==l[c]?n.push(p):i.push(p)}return e=t.concat(i,n)},i.prototype.getStrAward=function(e,t){var i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n],s=a.split("_");Number(s[3])==e&&i.push(a)}return i},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.lingquAward()}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().turnView(e.activityDaTingType.xiangoushangdian)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityHaoHuaQianDaoView=t,__reflect(t.prototype,"foxgame.ActivityHaoHuaQianDaoView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityKuangHuanJiJinItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),e.ActivityKuangHuanJiJinView.getIntance().changeScrollV(1e3);var t=this.data,i=t.strAward.split(","),n=i.length,o=0;for(this.itemArrD=[],o;n>o;o++){var a=i[o],s=a.split("_"),r=this["item_"+o];r.visible=!0,r.setItem(Number(s[1]),Number(s[2]),!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=new Object;l.id=Number(s[1]),l.type=Number(s[0]),l.num=Number(s[2]),this.itemArrD.push(l)}if(4>n)for(o;4>o;o++){var r=this["item_"+o];r.visible=!1}var h=t.curDay+1;switch(this.days.source="qitian_"+h+"_png",this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.curretnVo=t,t.status){case 0:this.lingquImg.visible=!1,this.dailingqu.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1,this.guoqi.visible=!1;break;case 1:this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.guoqi.visible=!1;break;case 2:this.lingquImg.visible=!0,this.dailingqu.visible=!1,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1,this.guoqi.visible=!1;break;case-1:this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1,this.guoqi.visible=!0}this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_2:i=this.itemArrD[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_3:i=this.itemArrD[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().ToGetKuangHuanJiJinAwardForSever(this.data.curDay+1)},i}(eui.ItemRenderer);e.ActivityKuangHuanJiJinItemView=t,__reflect(t.prototype,"foxgame.ActivityKuangHuanJiJinItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.curScroll_index=0,e.currentAward=0,e.isopen=!1,e.skinName="ActivityKuangHuanJiJinSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this.isopen=!1,this._data=e,this.initUI()},i.prototype.charStringBack=function(t){var i=new Date;i.setTime(t);var n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),s="";s=this._data.getIsOK()?"XianShiHuoDong_CarnivalFund_2":"XianShiHuoDong_CarnivalFund_1";var r=e.LanguageUtils.instance.getValue(s,n,o,a,"23:59");return r},i.prototype.initUI=function(){this.curScroll_index=0;var t=this.charStringBack(this._data.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(t),this.scroller.verticalScrollBar.autoVisibility=!1;var i=this.list;i.dataProvider=e.ActivityXianShiController.getIntance().getKuangHuanColleon(),i.itemRenderer=e.ActivityKuangHuanJiJinItemView;var n=this.checkItemderData();e.ActivityXianShiController.getIntance().getKuangHuanColleon().replaceAll(n),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var o=this._data.getShow(),a=o.split(","),s=0,r=a.length;for(this.currentItemIconArr=[],s;r>s;s++){var l=a[s],h=l.split("_"),c=this["item_"+s];c.visible=!0;var u=new Object;u.id=Number(h[1]),u.type=Number(h[0]),u.num=Number(h[2]),c.setItem(u.id,u.num,!0),c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.currentItemIconArr.push(u)}if(8>r)for(s;8>s;s++){var c=this["item_"+s];c.visible=!1}this.moneyTxt.text=e.GlobalConfig.instance.getValue("KHJJ_JIAGE_PEIZHI"),e.GamePlatform.isDragonEx?this.normalImg.source="yuanjiyishang_dt_png":e.GamePlatform.isDragonEx_qld?this.normalImg.source="yuanjiyishang_yb_png":this.normalImg.source="yuanjiyishang_png"},i.prototype.changeScrollV=function(t){this.isopen||((t<this.curScroll_index||0==this.curScroll_index)&&1e3!=t&&(this.curScroll_index=t,this.isopen=!0),this.itemIntance||(this.itemIntance=new e.ActivityKuangHuanJiJinItemView),this.scroller.viewport.scrollV=this.curScroll_index*this.itemIntance.height,this.isopen=!0)},i.prototype.setScrollV=function(e){this.curScroll_index=e},i.prototype.checkItemderData=function(){var e=[],t=[],i=[],n=[],o=this._data.getIsOK(),a=this._data.getStatus(),s=this._data.getList(),r=!1,l=0,h=0,c=a.length;for(l;c>l;l++){var u=new Object;h=0,r?h=0:1==a[l]&&(r=!0,h=1,this.curScroll_index=l),u.curIndex=h,u.isok=o,u.status=a[l],u.curDay=l,u.strAward=s[l],1==a[l]?t.push(u):2==a[l]||-1==a[l]?n.push(u):i.push(u)}return e=t.concat(i,n)},i.prototype.getStrAward=function(e,t){var i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n],s=a.split("_");Number(s[3])==e&&i.push(a)}return i},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.buyBtn:this.lingquAward();break;case this.item_0:i=this.currentItemIconArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.currentItemIconArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_2:i=this.currentItemIconArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_3:i=this.currentItemIconArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_4:i=this.currentItemIconArr[4],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_5:i=this.currentItemIconArr[5],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_6:i=this.currentItemIconArr[6],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_7:i=this.currentItemIconArr[7],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.lingquAward=function(){e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.fanliNum.text=e.GlobalConfig.instance.getValue("KHJJ_FANLI_BEISHU")+"bfl"},i}(eui.Component);e.ActivityKuangHuanJiJinView=t,__reflect(t.prototype,"foxgame.ActivityKuangHuanJiJinView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.nogetArr=["qizhi","qizhi","qizhiling"],e.currentType=0,e.numG=0,e.curType=0,e.skinName="ActivityQiTianBaoXiangSkin",e._isShow=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI()},i.prototype.initUI=function(){this._isShow=!0,e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.initListener()},i.prototype.initListener=function(){},i.prototype.onClick=function(e){this.callBack(this.numG)},i.prototype.getIsShow=function(){return this._isShow},i.prototype.getType=function(){return this.currentType},i.prototype.setType=function(e,t,i,n){this.currentType=e;var o="";n?(o=this.nogetArr[2],this.curType=2):(this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),o=this.nogetArr[0],this.curType=0),this.box.source=o+"_png",this.callBack=t,this.numG=i,this.days.source="qitian_"+(i+1)+"_png"},i.prototype.setSelect=function(e){e?(this.box.source=this.nogetArr[this.curType]+"xuan_png",this.box.scaleX=this.box.scaleY=1.2):(this.box.source=this.nogetArr[this.curType]+"_png",this.box.scaleX=this.box.scaleY=1)},i}(eui.Component);e.ActivityQiTianBaoXiangView=t,__reflect(t.prototype,"foxgame.ActivityQiTianBaoXiangView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityQiTianFanLiItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t="";switch(this.data.count){case 3:t=e.LanguageUtils.instance.getValue("XianShiHuoDong_SevenDaysRebate_1",this.data.count);break;case 5:t=e.LanguageUtils.instance.getValue("XianShiHuoDong_SevenDaysRebate_2",this.data.count);break;case 7:t=e.LanguageUtils.instance.getValue("XianShiHuoDong_SevenDaysRebate_3",this.data.count)}this.titleTxt.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.data,n=i.strAward.split(","),o=n.length,a=0;for(this.itemArrD=[],a;o>a;a++){var s=n[a],r=s.split("_"),l=this["item_"+a];l.visible=!0,l.setItem(Number(r[1]),Number(r[2]),!0),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var h=new Object;h.id=Number(r[1]),h.type=Number(r[0]),h.num=Number(r[2]),this.itemArrD.push(h)}if(4>o)for(a;4>a;a++){var l=this["item_"+a];l.visible=!1}switch(this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.curretnVo=i,i.status){case 0:this.lingquImg.visible=!1,this.dailingqu.visible=!0,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1;break;case 1:this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0;break;case 2:this.lingquImg.visible=!0,this.dailingqu.visible=!1,this.lingquBtn.visible=!1,this.lingquBtn.touchEnabled=!1}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),1==this.data.curIndex&&e.ActivityQiTianFanLiView.getIntance().setScrollV(this.itemIndex),e.ActivityQiTianFanLiView.getIntance().changeScrollV(),this.lingquBtn.visible==this.lingquBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:this.lingquAward();break;case this.item_0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_2:i=this.itemArrD[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_3:i=this.itemArrD[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().ToGetQiTianFanLiAwardForSever(!1,this.data.count)},i}(eui.ItemRenderer);e.ActivityQiTianFanLiItenView=t,__reflect(t.prototype,"foxgame.ActivityQiTianFanLiItenView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentAward=0,e.curScroll_index=0,e.isopen=!1,e.skinName="ActivityQiTianFanLiSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this.isopen=!1,this._data=e,this.initUI()},i.prototype.initUI=function(){this.checkBox();var t=e.ActivityXianShiController.getIntance().charStringBack(this._data.getStartTime(),this._data.getEndTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.list;i.dataProvider=e.ActivityXianShiController.getIntance().getQiTianColleon(),i.itemRenderer=e.ActivityQiTianFanLiItenView;var n=this.checkItemderData();e.ActivityXianShiController.getIntance().getQiTianColleon().replaceAll(n),this.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.chongzhiOnClick,this)},i.prototype.chongzhiOnClick=function(t){switch(t.target){case this.chongzhiBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.checkItemderData=function(){var e=[],t=[],i=[],n=[],o=this._data.getCountList(),a=this._data.getCountStatus(),s=this._data.getAwardCount(),r=s,l=!1,h=0,c=0,u=o.length;for(c;u>c;c++){var p=new Object;h=0,l||1==a[c]&&(l=!0,h=1),p.curIndex=h,p.count=o[c],p.status=a[c],p.strAward=r[c],1==a[c]?t.push(p):2==a[c]?n.push(p):i.push(p)}return e=t.concat(i,n)},i.prototype.getStrAward=function(e,t){var i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n],s=a.split("_");Number(s[3])==e&&i.push(a)}return i},i.prototype.checkBox=function(){var e=this._data.getDayStatus(),t=0,i=e.length,n=0,o=this._data.getDays(),a=!1,s=!1;for(t;i>t;t++){var r=this["box_"+t],l=e[t];t+1>this._data.getDays()&&(s=!0),r.setType(l,this.turnBack.bind(this),t,s),o>=t&&!a&&((1==l||t==o||1==o)&&(n=t,a=!0),n>o-1&&1!=o&&(n=o-1))}this.turnBack(n)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.turnBack=function(e){var t=0,i=this._data.getDayStatus().length;for(this.currentAward=e,t;i>t;t++){var n=this["box_"+t];if(t==e){n.setSelect(!0),this.awardSelect(t);var o=n.getType();switch(this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.buyBtn.visible=!1,this.buyBtn.touchEnabled=!1,o){case 0:this.lingquImg.visible=!1,this.dailingqu.visible=!0,this.buyBtn.visible=!1,this.buyBtn.touchEnabled=!1;break;case 1:this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.buyBtn.visible=!0,this.buyBtn.touchEnabled=!0;break;case 2:this.lingquImg.visible=!0,this.dailingqu.visible=!1,this.buyBtn.visible=!1,this.buyBtn.touchEnabled=!1}this.buyBtn.touchEnabled&&this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}else n.setSelect(!1)}this.buyBtn.visible==this.buyBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.awardSelect=function(e){var t=this._data.getAwardToday(),i=t[e].split(","),n=0,o=i.length,a=0;for(this.currentItemIconArr=[],n;o>n;n++){var s=i[n],r=this.checkAward(s),l=this["item"+a];l.setItem(r.id,r.num,!0),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.currentItemIconArr.push(r),a++}},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.item0:i=this.currentItemIconArr[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item1:i=this.currentItemIconArr[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item2:i=this.currentItemIconArr[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item3:i=this.currentItemIconArr[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.box_0:this.turnBack(0);break;case this.box_1:this.turnBack(1);break;case this.box_2:this.turnBack(2);break;case this.box_3:this.turnBack(3);break;case this.box_4:this.turnBack(4);break;case this.box_5:this.turnBack(5);break;case this.box_6:this.turnBack(6);break;case this.buyBtn:this.lingquAward()}},i.prototype.checkAward=function(e){var t=new Object,i=e.split("_");return t.type=Number(i[0]),t.id=Number(i[1]),t.num=Number(i[2]),t},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().ToGetQiTianFanLiAwardForSever(!0,this.currentAward+1)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),e.GamePlatform.isDragonEx?this.yuanLabel.text=e.GlobalConfig.instance.getValue("TTXS_CZ_QITIANJINGE")+"d":e.GamePlatform.isDragonEx_qld?this.yuanLabel.text=e.GlobalConfig.instance.getValue("TTXS_CZ_QITIANJINGE")+"b":this.yuanLabel.text=e.GlobalConfig.instance.getValue("TTXS_CZ_QITIANJINGE")+"y"},i.prototype.cleanScroll=function(){this.curScroll_index=0},i.prototype.changeScrollV=function(){this.isopen||(this.itemIntance||(this.itemIntance=new e.ActivityQiTianFanLiItenView),this.scroller.viewport.scrollV=this.curScroll_index*this.itemIntance.height,this.isopen=!0)},i.prototype.setScrollV=function(e){this.curScroll_index=e},i}(eui.Component);e.ActivityQiTianFanLiView=t,__reflect(t.prototype,"foxgame.ActivityQiTianFanLiView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityShuiJingShangDianItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=this.data,i=t.length,n=0;for(this.itemArrD=[],n;i>n;n++){var o=t[n],a=this["group_"+n];a.visible=!0;var s=this["item_"+n],r=o.getAward().split("_");s.setItem(Number(r[1]),Number(r[2]),!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=new Object;l.id=Number(r[1]),l.type=Number(r[0]),l.num=Number(r[2]),l.index=Number(o.getIndex()),this.itemArrD.push(l);var h=this["shuijingNum_"+n],c=this["goldNum_"+n],u=this["zheNum_"+n],p=this["zheImg_"+n],g=this["lingquBtn_"+n];h.text=o.getGlass()+"",c.text=o.getGold()+"",u.source="shangdian_0"+o.getSale()+"_png",p.source="shangdian_"+o.getSale()+"_png",g.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}if(2>i)for(n;2>n;n++){var a=this["group_"+n];a.visible=!1}},i.prototype.onClick=function(t){var i,n,o=e.ActivityXianShiController.getIntance().getShuiJingData(),a=o.getOnwedGlass(),s=this.data,r=e.PlayerService.instance.playerInfo.getGold();switch(t.target){case this.lingquBtn_0:if(a<s[0].getGlass())return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_5"));if(r<s[0].getGold())return e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.lingquAward(0);break;case this.lingquBtn_1:if(a<s[1].getGlass())return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_5"));if(r<s[1].getGold())return e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.lingquAward(1);break;case this.item_0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.lingquAward=function(t){var i=this.itemArrD[t];e.ActivityXianShiController.getIntance().ToGetShuiJingShangDianAwardForSever(i.index)},i}(eui.ItemRenderer);e.ActivityShuiJingShangDianItemView=t,__reflect(t.prototype,"foxgame.ActivityShuiJingShangDianItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentAward=0,e.skinName="ActivityShuiJingShangDianSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this._data=e,this.initUI()},i.prototype.initUI=function(){var t=this.list;t.dataProvider=e.ActivityXianShiController.getIntance().getShuiJingColleon(),t.itemRenderer=e.ActivityShuiJingShangDianItemView;var i=this.checkItemderData();e.ActivityXianShiController.getIntance().getShuiJingColleon().replaceAll(i),this.shuijingNum.text=this._data.getOnwedGlass()+"",this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.item.setItem(1028,1,!1)},i.prototype.charStringBack=function(t){var i=new Date;i.setTime(t);var n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),s="XianShiHuoDong_GlassShop_1",r=e.LanguageUtils.instance.getValue(s,n,o,a,"00:00");return r},i.prototype.checkItemderData=function(){var e=[],t=this._data.getList(),i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n];i.push(a),2==i.length&&(e.push(i),i=[])}return i.length>0&&e.push(i),e},i.prototype.getStrAward=function(e,t){var i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n],s=a.split("_");Number(s[3])==e&&i.push(a)}return i},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.lingquAward()}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().turnView(e.activityDaTingType.haohuaqiandao)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityShuiJingShangDianView=t,__reflect(t.prototype,"foxgame.ActivityShuiJingShangDianView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityTeHuiLiBaoItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null,null!=this.qualityAnimation&&(this.qualityAnimation.clear(),this.qualityAnimation=null,this.qualityAnimaGroup.visible=!1)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=this.data,i=t.strAward.split(","),n=i.length,o=0;for(this.itemArrD=[],o;n>o;o++){var a=i[o],s=a.split("_"),r=this["item_"+o];r.visible=!0,r.setItem(Number(s[1]),Number(s[2]),!0),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=new Object;l.id=Number(s[1]),l.type=Number(s[0]),l.num=Number(s[2]),this.itemArrD.push(l)}if(3>n)for(o;3>o;o++){var r=this["item_"+o];r.visible=!1}this.wenhao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var h="";if(e.GamePlatform.isDragonEx)switch(t.index){case 3:h="baiyinlibao_png";break;case 9:h="huangjinlibao_png";break;case 24:h="zuanshilibao_png"}else if(e.GamePlatform.isDragonEx_qld)switch(t.index){case 1:h="baiyinlibao_png";break;case 3:h="huangjinlibao_png";break;case 8:h="zuanshilibao_png"}else switch(t.index){case 1:h="yiyuanbao_png";break;case 3:h="sanyuanbao_png";break;case 8:h="bayuanbao_png"}switch(this.imgYuan.source=h,this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.curretnVo=t,t.status){case 0:this.lingquBtn.label="购买",this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.lingquBtn.enabled=!0,this.effectLingQu(!1);
break;case 1:this.lingquBtn.label="领取",this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!0,this.lingquBtn.enabled=!0,this.effectLingQu(!0);break;case 2:this.lingquBtn.label="购买",this.lingquBtn.visible=!0,this.lingquBtn.touchEnabled=!1,this.lingquBtn.enabled=!1,this.effectLingQu(!1)}this.lingquBtn.touchEnabled&&this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.qualityAnimation||(this.qualityAnimation=new e.FoxAni(this.qualityAnimaGroup),this.qualityAnimation.frameRate=10),this.qualityAnimation.play("qualityAnimation6","ani",-1),this.qualityAnimaGroup.visible=!0,this.cacheAsBitmap=!1,this.qualityAnimaGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.lingquBtn:0==this.data.status?this.buyAward():1==this.data.status&&this.lingquAward();break;case this.item_0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_2:i=this.itemArrD[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.wenhao:case this.qualityAnimaGroup:var o=this.checkRandomAward(),a=new Object;a.xy=this.parent.localToGlobal(this.x,this.y),e.ActivityXianShiController.getIntance().showTeHuiTips(o,a,this.data.index);break;case this.img:e.ActivityXianShiController.getIntance().showTeHuiTips(null,null,-1)}},i.prototype.checkRandomAward=function(){var e=0,t=this.data.random.split(","),i=t.length;for(this.itemArrR=[],e;i>e;e++){var n=t[e],o=n.split("_"),a=new Object;a.id=Number(o[1]),a.type=Number(o[0]),a.num=Number(o[2]),this.itemArrR.push(a)}return this.itemArrR},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().ToGetTeHuiAwardForSever(this.data.index)},i.prototype.buyAward=function(){var t,i=(e.PlayerService.instance.playerInfo.getRecharge(),e.JsonDataManager.instance.xianshiXianGouTemplate),n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(a.costMoney==this.data.index){t=a;break}}var s={};s.goodsId=t.productId,s.productName=t.productName,s.orderMoney=t.costMoney,s.diamondNum=t.amount,s.giftDiamondNum=t.addNum,e.RechargeController.getInstance().setPayData(s);var r=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");r.setGoodsId(t.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,r,!0)},i}(eui.ItemRenderer);e.ActivityTeHuiLiBaoItemView=t,__reflect(t.prototype,"foxgame.ActivityTeHuiLiBaoItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentAward=0,e.skinName="ActivityTeHuiLiBaoSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.tipsClose(),this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this._data=e,this.initUI()},i.prototype.initUI=function(){var t=this.list;t.dataProvider=e.ActivityXianShiController.getIntance().getTeHuiColleon(),t.itemRenderer=e.ActivityTeHuiLiBaoItemView;var i=this.checkItemderData();e.ActivityXianShiController.getIntance().getTeHuiColleon().replaceAll(i),this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.checkItemderData=function(){var e=[],t=this._data.getIndex(),i=this._data.getStatus(),n=this._data.getRandom(),o=this._data.getList(),a=0,s=t.length;for(a;s>a;a++){var r=new Object;r.index=t[a],r.status=i[a],r.random=n[a],r.strAward=o[a],e.push(r)}return e},i.prototype.getStrAward=function(e,t){var i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n],s=a.split("_");Number(s[3])==e&&i.push(a)}return i},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.lingquAward();break;case this.img:this.tipsClose()}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().ToGetQiTianFanLiAwardForSever(!0,this.currentAward+1)},i.prototype.showTips=function(e,t,i){if(this.tips.visible&&i==this.tips.getIndex())this.tipsClose();else if(null==e)this.tipsClose();else{this.tips.setItem(e,i);var n=t.xy;n=this.globalToLocal(n.x,n.y),this.tips.x=n.x+40,this.tips.y=n.y-70,this.tips.visible=!0}},i.prototype.tipsClose=function(){this.tips&&(this.tips.visible=!1)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityTeHuiLiBaoView=t,__reflect(t.prototype,"foxgame.ActivityTeHuiLiBaoView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityTeHuiTipsSkin",e}return __extends(i,t),i.prototype.initHook=function(){},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this.removeChildren(),i._intance=null},i.prototype.getIndex=function(){return this.curIndex},i.prototype.setItem=function(e,t){this.curIndex=t;var i=0,n=e.length;for(this.itemArrD=[],this.itemArrD=e,i;n>i;i++){var o=e[i],a=this["item_r"+i];a.visible=!0,a.setItem(o.id,o.num,!1),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}if(4>n)for(i;4>i;i++){var a=this["item_r"+i];a.visible=!1}},i.prototype.onClick=function(t){var i,n;switch(t.target){case this.item_r0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_r1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_r2:i=this.itemArrD[2],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_r3:i=this.itemArrD[3],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityTeHuiTips=t,__reflect(t.prototype,"foxgame.ActivityTeHuiTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityXianGouShangDianItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.chongzhiVO=null,this.curretnVo=null,this.itemVOArr=null},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this);var t=this.data,i=t.length,n=0;for(this.itemArrD=[],n;i>n;n++){var o=t[n],a=this["group_"+n];a.visible=!0;var s=this["item_"+n],r=o.getAward().split("_");s.setItem(Number(r[1]),Number(r[2]),!0),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=new Object;l.id=Number(r[1]),l.type=Number(r[0]),l.num=Number(r[2]),l.index=Number(o.getIndex()),this.itemArrD.push(l);var h=this["shuijingNum_"+n],c=this["goldNum_"+n],u=this["zheNum_"+n],p=this["zheImg_"+n],g=this["lingquBtn_"+n],d=this["cichu_"+n],f=e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_3",o.getTimes(),o.getLimit());d.textFlow=(new egret.HtmlTextParser).parser(f),h.text=o.getGlass()+"",c.text=o.getGold()+"",u.source="shangdian_0"+o.getSale()+"_png",p.source="shangdian_"+o.getSale()+"_png",g.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}if(2>i)for(n;2>n;n++){var a=this["group_"+n];a.visible=!1}},i.prototype.onClick=function(t){var i,n,o,a=e.ActivityXianShiController.getIntance().getXianGouData(),s=a.getOnwedGlass(),r=this.data,l=e.PlayerService.instance.playerInfo.getGold();switch(t.target){case this.lingquBtn_0:if(o=r[0].getTimes(),0>=o)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_4"));if(s<r[0].getGlass())return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_5"));if(l<r[0].getGold())return e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.lingquAward(0);break;case this.lingquBtn_1:if(o=r[1].getTimes(),0>=o)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_4"));if(s<r[1].getGlass())return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XianShiHuoDong_GlassShop_5"));if(l<r[1].getGold())return e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.lingquAward(1);break;case this.item_0:i=this.itemArrD[0],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num);break;case this.item_1:i=this.itemArrD[1],n=e.JsonDataManager.instance.itemTemplate[i.id],e.ActivityController.getIntance().showTipsByItemOrEquip(n.id,n.type,i.num)}},i.prototype.lingquAward=function(t){var i=this.itemArrD[t];e.ActivityXianShiController.getIntance().ToGetXianGouShangDianAwardForSever(i.index)},i}(eui.ItemRenderer);e.ActivityXianGouShangDianItemView=t,__reflect(t.prototype,"foxgame.ActivityXianGouShangDianItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentAward=0,e.skinName="ActivityXianGouShangDianSkin",e}return __extends(i,t),i.prototype.getIsShow=function(){return null!=this.parent},i.getIntance=function(){return this._intance?e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this._intance):this._intance=new i,this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,this.removeChildren(),i._intance=null},i.prototype.updataView=function(e){this._data=e,this.initUI()},i.prototype.initUI=function(){var t=this.charStringBack(this._data.getRefreshTime());this.top_huodongTime.textFlow=(new egret.HtmlTextParser).parser(t);var i=this.list;i.dataProvider=e.ActivityXianShiController.getIntance().getXianGouColleon(),i.itemRenderer=e.ActivityXianGouShangDianItemView;var n=this.checkItemderData();e.ActivityXianShiController.getIntance().getXianGouColleon().replaceAll(n),this.shuijingNum.text=this._data.getOnwedGlass()+"",this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.item.setItem(1028,1,!1)},i.prototype.charStringBack=function(t){var i=new Date;i.setTime(t);var n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),s="XianShiHuoDong_GlassShop_2",r=e.LanguageUtils.instance.getValue(s,n,o,a,"23:59");return r},i.prototype.checkItemderData=function(){var e=[],t=this._data.getList(),i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n];i.push(a),2==i.length&&(e.push(i),i=[])}return i.length>0&&e.push(i),e},i.prototype.getStrAward=function(e,t){var i=[],n=0,o=t.length;for(n;o>n;n++){var a=t[n],s=a.split("_");Number(s[3])==e&&i.push(a)}return i},i.prototype.onClick=function(e){switch(e.target){case this.buyBtn:this.lingquAward()}},i.prototype.lingquAward=function(){e.ActivityXianShiController.getIntance().turnView(e.activityDaTingType.haohuaqiandao)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityXianGouShangDianView=t,__reflect(t.prototype,"foxgame.ActivityXianGouShangDianView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentPage=0,e.currentSelect=0,e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this)},i.prototype.setSelect=function(e){if(this.currentSelect=0,this.currentShowArr&&this.currentShowArr.length>0)for(var t=this.currentShowArr.length,i=0;t>i;i++){var n=this.currentShowArr[i],o=n.vo;o&&o.getActivityId()==e?(this.currentSelect=e,n.select=!0):n.select=!1}this.refresh()},i.prototype.updataView=function(t,i,n){if(void 0===t&&(t=null),this.model=n,this.listData=i,this.currentPage=0,this.callBackF=t,null!=this.listData&&(this.activityData=this.listData,null!=this.activityData&&0!=this.activityData.length)){this.scrollBottom.scrollPolicyH=eui.ScrollPolicy.AUTO,this.scrollBottom.horizontalScrollBar.autoVisibility=!1,this.scrollBottom.scrollPolicyV=eui.ScrollPolicy.OFF;var o=new eui.TileLayout;o.requestedColumnCount=0,o.requestedRowCount=1,o.horizontalGap=-23,o.verticalGap=1,o.paddingLeft=-10,o.paddingRight=-10,this.scrollBottom.viewport.scrollH=0;var a=this.listBottom;a.dataProvider=this.model.collection_bottom,a.itemRenderer=e.ActivityMainBottomItemView,a.layout=o,this.checkActivityData(),this.changeBtnXuanZhong(0),this.initUI()}},i.prototype.checkBtnRedVisible=function(){this.checkActivityData(),this.refresh()},i.prototype.refresh=function(){this.updataSceneBtn(),this.model.dataSource_bottom=this.currentShowArr,this.model.collection_bottom.replaceAll(this.model.dataSource_bottom)},i.prototype.checkActivityData=function(){var t,i=this.activityData.length,n=[];this.currentShowArr=[],n=this.listData;for(var o=0;i>o;o++)if(t=n[o],t.getOpenPlace()==e.activityListType.xianshi){var a=new Object;a.vo=t,a.redPoint=this.checkRedPointVis(t.getActivityId()),t.getActivityId()==this.model.getCurrentType()?a.select=!0:a.select=!1,a.time=this.charStringBack(t.getStartTime(),t.getEndTime()),a.aVO=t,a.callBack=this.callBackF,this.currentShowArr.push(a)}},i.prototype.checkRedPointVis=function(t){var i=this.model.getRedPointArr(),n=!1;switch(t){case e.activityDaTingType.qitianfanli:n=i[0];break;case e.activityDaTingType.haohuaqiandao:n=i[1];break;case e.activityDaTingType.tehuilibao:n=i[2];break;case e.activityDaTingType.kuanghuanjijin:n=i[3];break;case e.activityDaTingType.shuijingshop:n=i[4];break;case e.activityDaTingType.xiangoushangdian:n=i[5]}return n},i.prototype.setRedPoint=function(t,i){var n=this.currentShowArr[t].vo,o=e.ActivityController.getIntance().getRedPointArr(),a=!1,s=!1,r=!1;for(var l in o){var h=o[l];if(h.type==n.getActivityId()){a=h.value;break}}-1==i?t<this.currentPage?(a&&(s=a),this.redPoint_left.visible=s):t>=this.currentPage+4&&(a&&(r=a),this.redPoint_right.visible=r):this["redPoint_"+(i+1)].visible=a},i.prototype.updataSceneBtn=function(){var e=4,t=this.currentPage,i=e+t;if(!(i>this.currentShowArr.length)){this.btnSceneTypeArr=[],this.btnSceneDataArr=[];var n=this.currentShowArr.length,o=0;for(t=0;n>t;t++)t>=this.currentPage&&t<this.currentPage+4&&(this.changeBtnSource(o,t),o++)}},i.prototype.changeBtnSource=function(e,t){},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.initListener()},i.prototype.initListener=function(){this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.changeViewOnLeftOrRight=function(e){var t=0;if(e>0){if(!(this.currentPage>=(this.currentShowArr.length-this.currentShowArr.length%4)/4)){if(e==(this.currentShowArr.length-this.currentShowArr.length%4)/4+1||4==this.currentShowArr.length)return;this.currentPage++}}else this.currentPage<=0||this.currentPage--;t=4*this.currentPage*(4/this.currentShowArr.length)*110,this.scrollBottom.viewport.scrollH=t},i.prototype.getSourceByBtn=function(e){return this.btnSceneDataArr&&this.btnSceneDataArr[e]?this.btnSceneDataArr[e].getImgSource():null},i.prototype.changeBtnXuanZhong=function(e){var t=this.currentShowArr[e].aVO;if(t)for(var i=this.listData.length,n=0;i>n;n++){var o=this.listData[n];o.getActivityId()==t.getActivityId()&&this.callBackF(t.getActivityId())}},i.prototype.onClick=function(e){switch(e.target){case this.leftBtn:Log.trace("leftBtn"),this.changeViewOnLeftOrRight(-1);break;case this.rightBtn:Log.trace("rightBtn"),this.changeViewOnLeftOrRight(1)}},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.Component);e.ActivityXianShiBottomBtnView=t,__reflect(t.prototype,"foxgame.ActivityXianShiBottomBtnView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.ActivityXianShiModel,this.panel=new e.ActivityXianShiPanel(this.model)}return t.getIntance=function(){return this._intance||(this._intance=new t),this._intance},t.prototype.registerMsg=function(t){t.add(e.Code.SEVENDAYS_REBATE_INFO_S,this),t.add(e.Code.SEVENDAYS_REBATE_AWARD_S,this),t.add(e.Code.DELUXE_ATTENDANCE_INFO_S,this),t.add(e.Code.DELUXE_ATTENDANCE_AWARD_S,this),t.add(e.Code.PREFERENTIAL_INFO_S,this),t.add(e.Code.PREFERENTIAL_AWARD_S,this),t.add(e.Code.CARNIVAL_FUND_INFO_S,this),t.add(e.Code.CARNIVAL_FUND_AWARD_S,this),t.add(e.Code.GLASS_SHOP_LIMIT_INFO_S,this),t.add(e.Code.GLASS_SHOP_LIMIT_BUY_S,this),t.add(e.Code.GLASS_SHOP_NOLIMIT_INFO_S,this),t.add(e.Code.GLASS_SHOP_NOLIMIT_BUY_S,this)},t.prototype.goldChange=function(){this.ToGetShuiJingShangDianDataForSever(),this.ToGetXianGouShangDianDataForSever()},t.prototype.updataView=function(){this.panel.getIsShow()&&this.panel.updateBottom_btn()},t.prototype.startGetData=function(){this.ToGetShuiJingShangDianDataForSever(),this.ToGetXianGouShangDianDataForSever(),this.ToGetQiTianFanLiDataForSever(),this.ToGetKuangHuanJiJinDataForSever(),this.ToGetHaoHuaQianDaoDataForSever(),this.ToGetTeHuiLiBaoDataForSever()},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.SEVENDAYS_REBATE_INFO_S:this.model.setQiTianData(i);break;case e.Code.SEVENDAYS_REBATE_AWARD_S:this.model.setQiTianAwardData(i);break;case e.Code.DELUXE_ATTENDANCE_INFO_S:this.model.setHaoHuaData(i);break;case e.Code.DELUXE_ATTENDANCE_AWARD_S:this.model.setHaoHuaAwardData(i);break;case e.Code.PREFERENTIAL_INFO_S:this.model.setTeHuiData(i);break;case e.Code.PREFERENTIAL_AWARD_S:this.model.setTeHuiAwardData(i);break;case e.Code.CARNIVAL_FUND_INFO_S:this.model.setKuangHuanData(i);break;case e.Code.CARNIVAL_FUND_AWARD_S:this.model.setKuangHuanAwardData(i);break;case e.Code.GLASS_SHOP_NOLIMIT_INFO_S:this.model.setShuiJingData(i);break;case e.Code.GLASS_SHOP_NOLIMIT_BUY_S:this.model.setShuiJingAwardData(i);break;case e.Code.GLASS_SHOP_LIMIT_INFO_S:this.model.setXianGouData(i);break;case e.Code.GLASS_SHOP_LIMIT_BUY_S:this.model.setXianGouAwardData(i)}},t.prototype.showPanel=function(){this.panel.getIsShow()||this.panel.show()},t.prototype.ToGetQiTianFanLiDataForSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.SevenDaysRebateInfoReq");e.Message.instance.send(e.Code.SEVENDAYS_REBATE_INFO_C,t,!0)},t.prototype.ToGetQiTianFanLiAwardForSever=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.SevenDaysRebateAwardReq");n.setIndex(i),n.setIsToday(t),e.Message.instance.send(e.Code.SEVENDAYS_REBATE_AWARD_C,n,!0)},t.prototype.ToGetHaoHuaQianDaoDataForSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.DeluxeAttendanceInfoReq");e.Message.instance.send(e.Code.DELUXE_ATTENDANCE_INFO_C,t,!0)},t.prototype.ToGetHaoHuaQianDaoAwardForSever=function(t){var i=HawkProtocolManager.newBuilder("JsProto.DeluxeAttendanceAwardReq");i.setMoney(t),e.Message.instance.send(e.Code.DELUXE_ATTENDANCE_AWARD_C,i,!0)},t.prototype.ToGetTeHuiLiBaoDataForSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.PreferentialInfoReq");e.Message.instance.send(e.Code.PREFERENTIAL_INFO_C,t,!0)},t.prototype.ToGetTeHuiAwardForSever=function(t){var i=HawkProtocolManager.newBuilder("JsProto.PreferentialAwardReq");i.setIndex(t),e.Message.instance.send(e.Code.PREFERENTIAL_AWARD_C,i,!0)},t.prototype.ToGetKuangHuanJiJinDataForSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.CarnivalFundInfoReq");e.Message.instance.send(e.Code.CARNIVAL_FUND_INFO_C,t,!0)},t.prototype.ToGetKuangHuanJiJinAwardForSever=function(t){var i=HawkProtocolManager.newBuilder("JsProto.CarnivalFundAwardReq");i.setIndex(t),e.Message.instance.send(e.Code.CARNIVAL_FUND_AWARD_C,i,!0)},t.prototype.ToGetShuiJingShangDianDataForSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.GlassShopNoLimitInfoReq");e.Message.instance.send(e.Code.GLASS_SHOP_NOLIMIT_INFO_C,t,!0)},t.prototype.ToGetShuiJingShangDianAwardForSever=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GlassShopNoLimitBuyReq");i.setItemId(t),e.Message.instance.send(e.Code.GLASS_SHOP_NOLIMIT_BUY_C,i,!0)},t.prototype.ToGetXianGouShangDianDataForSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.GlassShopLimitInfoReq");e.Message.instance.send(e.Code.GLASS_SHOP_LIMIT_INFO_C,t,!0)},t.prototype.ToGetXianGouShangDianAwardForSever=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GlassShopLimitBuyReq");i.setItemId(t),e.Message.instance.send(e.Code.GLASS_SHOP_LIMIT_BUY_C,i,!0)},t.prototype.showTeHuiTips=function(e,t,i){this.panel.getIsShow()&&this.panel.changeTeHuiTipsXY(e,t,i)},t.prototype.getShuiJingData=function(){return this.model.getShuiJingData()},t.prototype.getXianGouData=function(){return this.model.getXianGouData()},t.prototype.getQiTianColleon=function(){return this.model.collection_QiTian},t.prototype.getHaoHuaColleon=function(){return this.model.collection_HaoHua},t.prototype.getTeHuiColleon=function(){return this.model.collection_TeHui},t.prototype.getShuiJingColleon=function(){return this.model.collection_ShuiJing},t.prototype.getXianGouColleon=function(){return this.model.collection_XianGou},t.prototype.getKuangHuanColleon=function(){return this.model.collection_KuangHuan},t.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},t.prototype.turnView=function(e){this.panel.getIsShow()&&this.panel.turnView(e)},t.prototype.changeBtnRedVis=function(){this.panel.getIsShow()&&this.panel.checkBtnRedVisible()},t}();e.ActivityXianShiController=t,__reflect(t.prototype,"foxgame.ActivityXianShiController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.observerList=[],this.listDataArr=[],this.dataSource_bottom=[],this.collection_bottom=new eui.ArrayCollection,this.collection_bottom.source=this.dataSource_bottom,this.dataSource_QiTian=[],this.collection_QiTian=new eui.ArrayCollection,this.collection_QiTian.source=this.dataSource_QiTian,this.dataSource_HaoHua=[],this.collection_HaoHua=new eui.ArrayCollection,this.collection_HaoHua.source=this.dataSource_HaoHua,this.dataSource_TeHui=[],this.collection_TeHui=new eui.ArrayCollection,this.collection_TeHui.source=this.dataSource_TeHui,this.dataSource_KuangHuan=[],this.collection_KuangHuan=new eui.ArrayCollection,this.collection_KuangHuan.source=this.dataSource_KuangHuan,this.dataSource_ShuiJing=[],this.collection_ShuiJing=new eui.ArrayCollection,this.collection_ShuiJing.source=this.dataSource_ShuiJing,this.dataSource_XianGou=[],this.collection_XianGou=new eui.ArrayCollection,this.collection_XianGou.source=this.dataSource_XianGou,this.datingRedPointArr=[],this.redArr=[!1,!1,!1,!1,!1,!1],this.typeArr=[null,null,null,null,null,null]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChanged()},t.prototype.getListData=function(){return this.listDataArr=e.ActivityController.getIntance().getXianShiListData(),this.listDataArr},t.prototype.setCurrentType=function(e){this.currentTypeBottom=e},t.prototype.getCurrentType=function(){return this.currentTypeBottom},t.prototype.getRedPointArr=function(){return this.redArr},t.prototype.getTypeArr=function(){return this.typeArr},t.prototype.setQiTianData=function(e){this.data_qitianfanli=e;var t=!1,i=this.data_qitianfanli.getDayStatus(),n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(1==a){t=!0;break}}if(!t){var s=this.data_qitianfanli.getCountStatus();for(n=0,o=s.length,n;o>n;n++){var r=s[n];if(1==r){t=!0;break}}}this.redArr[0]=t,this.callBackPoint(),this.updateView()},t.prototype.setQiTianAwardData=function(t){0==t.getErrOrNo()?(e.ActivityXianShiController.getIntance().ToGetQiTianFanLiDataForSever(),App.SoundManager().playEffect("sound_award_mp3")):Log.trace("********七天返利领取奖励失败，服务端数据报错*********")},t.prototype.setHaoHuaData=function(e){this.data_haohuaqiandao=e;var t=!1,i=this.data_haohuaqiandao.getStatus(),n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(1==a){t=!0;break}}this.redArr[1]=t,this.callBackPoint(),this.updateView()},t.prototype.setHaoHuaAwardData=function(t){0==t.getErrorNo()?(e.ActivityXianShiController.getIntance().ToGetHaoHuaQianDaoDataForSever(),App.SoundManager().playEffect("sound_award_mp3")):Log.trace("********豪华奖励领取奖励失败，服务端数据报错*********")},t.prototype.setTeHuiData=function(e){this.data_tehuilibao=e;var t=!1,i=this.data_tehuilibao.getStatus(),n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(1==a){t=!0;break}}this.redArr[2]=t,this.callBackPoint(),this.updateView()},t.prototype.setTeHuiAwardData=function(t){0==t.getErrOrNo()?(e.ActivityXianShiController.getIntance().ToGetTeHuiLiBaoDataForSever(),App.SoundManager().playEffect("sound_award_mp3")):Log.trace("********特惠礼包领取奖励失败，服务端数据报错*********")},t.prototype.setKuangHuanData=function(e){this.data_kuanghuanjijin=e;var t=!1,i=this.data_kuanghuanjijin.getStatus(),n=0,o=i.length;for(n;o>n;n++){var a=i[n];if(1==a){t=!0;break}}this.redArr[3]=t,this.callBackPoint(),this.updateView()},t.prototype.setKuangHuanAwardData=function(t){0==t.getErrOrNo()?(e.ActivityXianShiController.getIntance().ToGetKuangHuanJiJinDataForSever(),App.SoundManager().playEffect("sound_award_mp3")):Log.trace("********狂欢基金领取奖励失败，服务端数据报错*********")},t.prototype.setShuiJingData=function(e){this.data_shuijingshangdian=e,this.updateView()},t.prototype.setShuiJingAwardData=function(t){0==t.getErrOrNo()?(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHOPBUYSUCCESS")),e.ActivityXianShiController.getIntance().ToGetShuiJingShangDianDataForSever()):Log.trace("********水晶商店购买商店失败，服务端数据报错*********")},t.prototype.setXianGouData=function(e){this.data_xiangoushangdian=e,this.updateView()},t.prototype.setXianGouAwardData=function(t){0==t.getErrOrNo()?(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHOPBUYSUCCESS")),e.ActivityXianShiController.getIntance().ToGetXianGouShangDianDataForSever()):Log.trace("********限购商店购买商店失败，服务端数据报错*********")},t.prototype.callBackPoint=function(){e.ActivityXianShiController.getIntance().changeBtnRedVis();var t=!1,i=0,n=this.redArr.length;for(i;n>i;i++){var o=this.redArr[i];if(o){t=!0;break}}e.ActivityBarController.getInstance().setXianShiRed(t)},t.prototype.getXianGouData=function(){return this.data_xiangoushangdian},t.prototype.getShuiJingData=function(){return this.data_shuijingshangdian},t.prototype.getKuangHuanData=function(){return this.data_kuanghuanjijin},t.prototype.getTeHuiData=function(){return this.data_tehuilibao},t.prototype.getHaoHuaData=function(){return this.data_haohuaqiandao},t.prototype.getQiTianData=function(){return this.data_qitianfanli},t}();e.ActivityXianShiModel=t,__reflect(t.prototype,"foxgame.ActivityXianShiModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityXianShi/ActivityXianShiMainSkin.exml","activityXianShiGroup",!1)||this;return i.speed=1,i.currentSelect=0,i.model=e,i.setIsTextureCache(!0),i.zhaoCaiJinBaoPlayBoo=!1,i.lastTime=0,i.mcIsPlay=!1,i.currentIndex=0,i.model.registerObserver(i),i.dataisok=!1,i.currentShowArr=[],i}return __extends(i,t),i.prototype.panelChanged=function(){this.dataisok=!0,this.getIsShow()&&this.refreshNew()},i.prototype.checkBtnRedVisible=function(){this.getIsShow()&&this.ui.bottom_btnGroup.checkBtnRedVisible()},i.prototype.getCurrentScence=function(){return this.currentScence},i.prototype.initUI=function(){this.ui.sceneGroup.removeChildren(),this.initListener(),this.updateBottom_btn(),this.doScreenAdaptation()},i.prototype.updateBottom_btn=function(){this.ui.bottom_btnGroup.updataView(this.backFunForBottom.bind(this),this.model.getListData(),this.model)},i.prototype.backFunForBottom=function(t,i){if(void 0===i&&(i=null),this.currentType=t,this.model.getCurrentType()==e.activityDaTingType.tehuilibao){var n=e.ActivityTeHuiLiBaoView.getIntance();n.tipsClose()}switch(this.model.setCurrentType(t),this.ui.bottom_btnGroup.setSelect(t),t){case e.activityDaTingType.qitianfanli:e.ActivityXianShiController.getIntance().ToGetQiTianFanLiDataForSever();break;case e.activityDaTingType.haohuaqiandao:e.ActivityXianShiController.getIntance().ToGetHaoHuaQianDaoDataForSever();break;case e.activityDaTingType.tehuilibao:e.ActivityXianShiController.getIntance().ToGetTeHuiLiBaoDataForSever();break;case e.activityDaTingType.kuanghuanjijin:e.ActivityXianShiController.getIntance().ToGetKuangHuanJiJinDataForSever();break;case e.activityDaTingType.shuijingshop:e.ActivityXianShiController.getIntance().ToGetShuiJingShangDianDataForSever();break;case e.activityDaTingType.xiangoushangdian:e.ActivityXianShiController.getIntance().ToGetXianGouShangDianDataForSever();break;default:this.ui.sceneGroup.removeChildren()}},i.prototype.turnView=function(e){this.backFunForBottom(e)},i.prototype.callBack=function(e){this.showIndexScence(e),this.setSelect(e)},i.prototype.setSelect=function(e){if(this.currentSelect=0,this.currentShowArr&&this.currentShowArr.length>0)for(var t=this.currentShowArr.length,i=0;t>i;i++){var n=this.currentShowArr[i],o=n.vo;o&&o.getActivityId()==e?(this.currentSelect=e,n.select=!0):n.select=!1}this.refreshNew()},i.prototype.showHook=function(){this.initListener(),this.initUI(),this.doScreenAdaptation()},i.prototype.initListener=function(){this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.helpBtn:this.currentScence==e.ActivityKuangHuanId.ZHAOCAJINBAO&&e.HelpController.getInstance().showPanel("ZCSYBHELP");case this.ui.closeBt:this.backHandler()}},i.prototype.initParams=function(){},i.prototype.refreshNew=function(){var t=this.model.getCurrentType();switch(t){case e.activityDaTingType.qitianfanli:this.changeQiTianFanLiView();break;case e.activityDaTingType.haohuaqiandao:this.changeHaoHuaQianDaoView();break;case e.activityDaTingType.tehuilibao:this.changeTeHuiLiBaoView();break;case e.activityDaTingType.kuanghuanjijin:this.changeKuangHuanJiJinView();
break;case e.activityDaTingType.shuijingshop:this.changeShuiJingShangDianView();break;case e.activityDaTingType.xiangoushangdian:this.changeXianGouShangDianView()}},i.prototype.changeQiTianFanLiView=function(){if(this.currentType==e.activityDaTingType.qitianfanli){var t=this.model.getQiTianData(),i=this.ui.sceneGroup,n=e.ActivityQiTianFanLiView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.changeHaoHuaQianDaoView=function(){if(this.currentType==e.activityDaTingType.haohuaqiandao){var t=this.model.getHaoHuaData(),i=this.ui.sceneGroup,n=e.ActivityHaoHuaQianDaoView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.getHaoHuaDataNum=function(){var e=this.model.getHaoHuaData();return e.getList().length},i.prototype.changeTeHuiLiBaoView=function(){if(this.currentType==e.activityDaTingType.tehuilibao){var t=this.model.getTeHuiData(),i=this.ui.sceneGroup,n=e.ActivityTeHuiLiBaoView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.changeTeHuiTipsXY=function(t,i,n){this.currentType==e.activityDaTingType.tehuilibao&&e.ActivityTeHuiLiBaoView.getIntance().getIsShow()&&e.ActivityTeHuiLiBaoView.getIntance().showTips(t,i,n)},i.prototype.changeKuangHuanJiJinView=function(){if(this.currentType==e.activityDaTingType.kuanghuanjijin){var t=this.model.getKuangHuanData(),i=this.ui.sceneGroup,n=e.ActivityKuangHuanJiJinView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.changeShuiJingShangDianView=function(){if(this.currentType==e.activityDaTingType.shuijingshop){var t=this.model.getShuiJingData(),i=this.ui.sceneGroup,n=e.ActivityShuiJingShangDianView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.changeXianGouShangDianView=function(){if(this.currentType==e.activityDaTingType.xiangoushangdian){var t=this.model.getXianGouData(),i=this.ui.sceneGroup,n=e.ActivityXianGouShangDianView.getIntance();i.removeChildren(),i.addChild(n),n.updataView(t)}},i.prototype.showIndexScence=function(e){this.setSelect(e),this.currentScence!=e&&(this.currentScence=e)},i.prototype.closeHook=function(){for(var e=this.ui.sceneGroup.numChildren,t=0;e>t;++t){var i=this.ui.sceneGroup.getChildAt(t);i.cleanDataDelete&&i.cleanDataDelete()}this.ui.sceneGroup.removeChildren(),this.scaleX=this.scaleY=1,this.x=this.y=0},i.prototype.zhaoCaiJinBaoplayMc=function(){this.zhaoCaiJinBaoPlayBoo=!0},i.prototype.LaoHuStop=function(){this.zhaoCaiJinBaoPlayBoo=!1,this.mcIsPlay=!1,this.currentIndex=0,this.speed=1,this.indexTime=0},i}(e.BasePanel);e.ActivityXianShiPanel=t,__reflect(t.prototype,"foxgame.ActivityXianShiPanel",["foxgame.IActivityXianShi","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.RANK=0]="RANK",e[e.XUNBAO=1]="XUNBAO",e[e.ACHIEVEMENT=2]="ACHIEVEMENT",e[e.FULI=3]="FULI",e[e.SHOP=4]="SHOP",e[e.REDPACKET=5]="REDPACKET",e[e.JUBAOPEN=6]="JUBAOPEN",e[e.TONGJINZHU=7]="TONGJINZHU",e[e.ZAJINDAN=8]="ZAJINDAN",e[e.SHARE=9]="SHARE",e[e.KUANGHUAN=10]="KUANGHUAN",e[e.HUIKUI=11]="HUIKUI",e[e.WORLDBOSS=12]="WORLDBOSS",e[e.BONFIRE=13]="BONFIRE",e[e.ACTIVITY=14]="ACTIVITY",e[e.KUAFULIANSAI=15]="KUAFULIANSAI",e[e.LIBAO0YUAN=16]="LIBAO0YUAN",e[e.WEIDUAN=17]="WEIDUAN",e[e.ZHUANPAN=18]="ZHUANPAN",e[e.TWELVEPALACE=19]="TWELVEPALACE",e[e.XIANSHI=20]="XIANSHI",e[e.SHACHENG=21]="SHACHENG",e[e.KFGONGCHENG=22]="KFGONGCHENG",e[e.JIJIN=23]="JIJIN",e[e.VIPTEQUAN=24]="VIPTEQUAN",e[e.WANBAKEFU=25]="WANBAKEFU",e[e.DAFUWENG=26]="DAFUWENG",e[e.PRIVILEGE=27]="PRIVILEGE",e[e.DAFANLI=28]="DAFANLI",e[e.QQVIP=29]="QQVIP",e[e.LIMITTIMESCHARGE=30]="LIMITTIMESCHARGE",e[e.QLDXJFL=31]="QLDXJFL",e[e.XINYUECLUB=32]="XINYUECLUB",e[e.AWFL=33]="AWFL",e[e.GDJC=34]="GDJC",e[e.QQVIPKAITONG=35]="QQVIPKAITONG",e[e.CAMPBATTLE=36]="CAMPBATTLE",e[e.PINGTAIFULI=37]="PINGTAIFULI",e[e.CHANNELSHARING=38]="CHANNELSHARING",e[e.LANZUAN=39]="LANZUAN",e[e.DATING=40]="DATING",e[e.TTSHARE=41]="TTSHARE",e[e.KUAFUBANGDAN=42]="KUAFUBANGDAN",e[e.REALNAME=43]="REALNAME",e[e.YIYUANXIANGOU=44]="YIYUANXIANGOU",e[e.MEIRICHONGZHI=45]="MEIRICHONGZHI",e[e.MFSQFRIENDRANK=46]="MFSQFRIENDRANK"}(t=e.ActivityBtnType||(e.ActivityBtnType={}));var i=function(){function i(){this.panelOldVisible=!1,this.model=new e.ActivityBarModel,this.panel=new e.ActivityBarPanel(this.model)}return i.getInstance=function(){return null==this.instance&&(this.instance=new i),this.instance},i.prototype.recvMsg=function(t,i){t==e.MsgCMD.UICanHideSomethingForDrawLess?this.panel.visible&&(this.panelOldVisible=this.panel.visible,this.panel.visible=!1):t==e.MsgCMD.UIRestoreHideSomethingForDrawLess&&(this.panel.visible=this.panelOldVisible)},i.prototype.kefuRedClose=function(){this.panel.kefuRedClose(!1)},i.prototype.showOrClosePanel=function(t){if(t){if(this.panel.getIsShow())return;this.panel.show(),e.Message.instance.add(e.MsgCMD.UICanHideSomethingForDrawLess,this),e.Message.instance.add(e.MsgCMD.UIRestoreHideSomethingForDrawLess,this),this.panelOldVisible=this.panel.visible,e.QQdatingController.getInstance().sendQQdatingInfo()}else this.panel.close(),e.Message.instance.remove(e.MsgCMD.UICanHideSomethingForDrawLess,this),e.Message.instance.remove(e.MsgCMD.UIRestoreHideSomethingForDrawLess,this),this.panelOldVisible=this.panel.visible},i.prototype.getshowguide=function(){return this.panel.guideshow()},i.prototype.closFriendRank=function(){this.panel.closemfsqFridenRankHanderl()},i.prototype.getSearchTreasureBtnPoint=function(){return this.panel.getSearchTreasureBtnPoint()},i.prototype.getachievementBtnPoint=function(){return this.panel.getachievementBtnPoint()},i.prototype.getActivityBtnPoint=function(){return this.panel.getActivityBtnPoint()},i.prototype.getJueWeiBtnPoint=function(){return this.panel.getJueWeiBtnPoint()},i.prototype.getLiansaiBtnPoint=function(){return this.panel.getLiansaiBtnPoint()},i.prototype.setAchievementRedTipVisible=function(){if(0!=this.panel.getIsShow()){var t=e.AchievementController.getInstance().isShowRedTip();this.panel.setAchievementRedTipVisible(t)}},i.prototype.setKuaFuSaiEffectVisible=function(){if(0!=this.panel.getIsShow()){var t=e.KFController.getInstance().isShowMainIconEffect();this.panel.kuaFuSaiEffect(t)}},i.prototype.setQQdatingred=function(){if(0!=this.panel.getIsShow()){var t=e.QQdatingController.getInstance().getModel().getQQdatingRedBlo();this.panel.qqdatingRed(t)}},i.prototype.setjubaopenEffect=function(e){0!=this.panel.getIsShow()&&this.panel.refreshJuBaoPenEffect(e)},i.prototype.setHuoDongEffect=function(e){0!=this.panel.getIsShow()&&this.panel.huodongEffect(e)},i.prototype.setHuoDongRed=function(e){0!=this.panel.getIsShow()&&this.panel.HdRedImg(e)},i.prototype.setjinzhuEffect=function(e){0!=this.panel.getIsShow()&&this.panel.jinzhuEffect(e)},i.prototype.setjindanEffect=function(e){0!=this.panel.getIsShow()&&this.panel.jindanEffect(e)},i.prototype.setDafuwengEffect=function(e){0!=this.panel.getIsShow()&&this.panel.dafuwengEffect(e)},i.prototype.setLimitTimesEffect=function(e){0!=this.panel.getIsShow()&&this.panel.limitTimesEffect(e)},i.prototype.getLimitTime=function(){return this.panel.limitTime},i.prototype.setdaFanLiEffect=function(e){0!=this.panel.getIsShow()&&this.panel.daFanLiEffect(e)},i.prototype.setKuangHuanEffect=function(e){0!=this.panel.getIsShow()&&this.panel.kuangHuanEffect(e)},i.prototype.setKuangHuanRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.kuanghuanRed(e)},i.prototype.setPrivilegeRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.privilegeRed(e)},i.prototype.setKuaFuSaiEffect=function(e){0!=this.panel.getIsShow()&&this.panel.kuaFuSaiEffect(e)},i.prototype.setCampbattleEffect=function(e){0!=this.panel.getIsShow()&&this.panel.setCampBattleEffect(e)},i.prototype.setdragongodtreasureEffectVisible=function(){if(0!=this.panel.getIsShow()){var t=e.DragongodTreasureController.getInstance().redpoint();this.panel.dragongodtreasureEffect(t)}},i.prototype.setdragongodtreasureEffect=function(e){0!=this.panel.getIsShow()&&this.panel.dragongodtreasureEffect(e)},i.prototype.refreshSearchTreasureRedPoint=function(){if(0!=this.panel.getIsShow()){var t=!1,i=e.ActivityController.getIntance().getActivityById(e.ActivityId.TREASURE_HUNT),n=e.PlayerService.instance.playerInfo.getGold(),o=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_2")),a=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_1")),s=e.BagController.getInstance().getCountByItemId(a.id);return null!=i&&(n>=o.value||s>=a.value)&&(t=!0),this.panel.refreshSearchTreasureRedPoint(t),t}},i.prototype.setNewXianShiIcon=function(){this.panel.setNewXianShiIcon()},i.prototype.setShopRedImgVisible=function(e){0!=this.panel.getIsShow()&&this.panel.setShopRedImgVisible(e)},i.prototype.setFuliRedImgVisible=function(e){0!=this.panel.getIsShow()&&this.panel.setFuLiRedImg(e)},i.prototype.setBtnStatus=function(i,n){if(i==t.ACTIVITY||i==t.FULI||i==t.HUIKUI||i==t.KUANGHUAN||i==t.TONGJINZHU||i==t.ZAJINDAN||i==t.SHARE||i==t.DAFUWENG||i==t.DAFANLI){var o=e.PlayerService.instance.missionList[0];n=o&&n&&(o.getId()>e.MainUiGuideValue.TASK_ID_600022||o.getId()==e.MainUiGuideValue.TASK_ID_600022&&o.getTag())?!0:!1}this.model.setBtnStatus(i,n)},i.prototype.setTongJinZhuRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.setTongJinZhuRedPoint(e)},i.prototype.setNewXianGouEffect=function(e){this.panel.setNewXianGouEffect(e)},i.prototype.setZaJinDanRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.setZaJinDanRedPoint(e)},i.prototype.setJubaopenRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.refreshJuBaoPenRed(e)},i.prototype.setDafuwengRedPoint=function(e){this.panel.getIsShow()&&this.panel.setDafuwengRedPoint(e)},i.prototype.setCampbattleRedPoint=function(e){this.panel.getIsShow()&&this.panel.setCampbattleRedPoint(e)},i.prototype.setChannelShareRedPoint=function(e){this.panel.getIsShow()&&this.panel.setChannelShareRedPoint(e)},i.prototype.setplatRedPoint=function(e){this.panel.getIsShow()&&this.panel.setplatRedPoint(e)},i.prototype.setChengZhangJiJinRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.setChengZhangJiJinRedPoint(e)},i.prototype.setHuiKuiEffect=function(e){0!=this.panel.getIsShow()&&this.panel.huikuiEffect(e)},i.prototype.setHuiKuiRedPoint=function(e){0!=this.panel.getIsShow()&&this.panel.huikuiRed(e)},i.prototype.checkOpenActivityShow=function(e){this.panel.checkOpenActivityShow(e)},i.prototype.getpanel=function(){return this.panel},i.prototype.setRedPacketRed=function(e){0!=this.panel.getIsShow()&&this.panel.redPacketRed(e)},i.prototype.setZhuanPanRed=function(e){0!=this.panel.getIsShow()&&this.panel.ZhuanPanRed(e)},i.prototype.setXianShiRed=function(e){0!=this.panel.getIsShow()&&this.panel.xianshiRed(e)},i.prototype.getAdvertisingState=function(e){},i.prototype.onMsgOpenTimePush=function(i){switch(i.getPlayType()){case e.TimePlayMethodType.UNION_SIEGE:i.getOpen()?(this.setBtnStatus(t.SHACHENG,!0),this.panel.refreshBtnEffect(t.SHACHENG,!0),this.panel.addBtnTimer(t.SHACHENG,i.getRemainingTime())):this.setBtnStatus(t.SHACHENG,!1)}},i.prototype.recordPF=function(e){this.model.channelPf=e},i.prototype.getPFName=function(){return this.model.channelPf},i.prototype.setRealNameStatus=function(e){this.panel.setRealNameBtnStatus(e)},i}();e.ActivityBarController=i,__reflect(i.prototype,"foxgame.ActivityBarController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this._huodongEffectState=!0,this._jinzhuEffectState=!0,this._jindanEffectState=!0,this._dafuwengEffectState=!0,this._limitTimesEffectState=!0,this._daFanLiEffectState=!0,this._baopenEffectState=!0,this._kuanghuanEffectState=!0,this._huikuiEffectState=!0,this._redPacketEffectState=!0,this._kuafusaiEffectState=!0,this._dragongodtreasureEffectState=!0,this.statusDic={},this.statusDic[e.ActivityBtnType.ACTIVITY]=!0,this.statusDic[e.ActivityBtnType.XUNBAO]=!0,this.statusDic[e.ActivityBtnType.FULI]=!0,this.statusDic[e.ActivityBtnType.JUBAOPEN]=!0,this.statusDic[e.ActivityBtnType.SHOP]=!0,this.statusDic[e.ActivityBtnType.ACHIEVEMENT]=!0,this.statusDic[e.ActivityBtnType.RANK]=!0,this.statusDic[e.ActivityBtnType.SHARE]=!0,this.statusDic[e.ActivityBtnType.ZAJINDAN]=!0,this.statusDic[e.ActivityBtnType.TONGJINZHU]=!0,this.statusDic[e.ActivityBtnType.KUANGHUAN]=!0,this.statusDic[e.ActivityBtnType.HUIKUI]=!0,this.statusDic[e.ActivityBtnType.WORLDBOSS]=!1,this.statusDic[e.ActivityBtnType.BONFIRE]=!1,this.statusDic[e.ActivityBtnType.REDPACKET]=!0,this.statusDic[e.ActivityBtnType.KUAFULIANSAI]=!0,this.statusDic[e.ActivityBtnType.LIBAO0YUAN]=!1,this.statusDic[e.ActivityBtnType.WEIDUAN]=!1,this.statusDic[e.ActivityBtnType.ZHUANPAN]=!1,this.statusDic[e.ActivityBtnType.TWELVEPALACE]=!1,this.statusDic[e.ActivityBtnType.XIANSHI]=!1,this.statusDic[e.ActivityBtnType.SHACHENG]=!1,this.statusDic[e.ActivityBtnType.KFGONGCHENG]=!1,this.statusDic[e.ActivityBtnType.JIJIN]=!1,this.statusDic[e.ActivityBtnType.VIPTEQUAN]=!1,this.statusDic[e.ActivityBtnType.WANBAKEFU]=!1,this.statusDic[e.ActivityBtnType.DAFUWENG]=!1,this.statusDic[e.ActivityBtnType.PRIVILEGE]=!0,this.statusDic[e.ActivityBtnType.DAFANLI]=!1,this.statusDic[e.ActivityBtnType.QQVIP]=!1,this.statusDic[e.ActivityBtnType.LIMITTIMESCHARGE]=!1,this.statusDic[e.ActivityBtnType.QLDXJFL]=!1,this.statusDic[e.ActivityBtnType.XINYUECLUB]=!1,this.statusDic[e.ActivityBtnType.AWFL]=!1,this.statusDic[e.ActivityBtnType.GDJC]=!1,this.statusDic[e.ActivityBtnType.QQVIPKAITONG]=!1,this.statusDic[e.ActivityBtnType.CAMPBATTLE]=!1,this.statusDic[e.ActivityBtnType.CHANNELSHARING]=!1,this.statusDic[e.ActivityBtnType.KUAFUBANGDAN]=!1,this.statusDic[e.ActivityBtnType.REALNAME]=!1,this.statusDic[e.ActivityBtnType.YIYUANXIANGOU]=!1,this.statusDic[e.ActivityBtnType.MEIRICHONGZHI]=!1,this.statusDic[e.ActivityBtnType.MFSQFRIENDRANK]=!1,this.observerList=[]}return t.prototype.setdragongodtreasureEffectState=function(e){this._dragongodtreasureEffectState=e},t.prototype.getdragongodtreasureEffectState=function(){return this._dragongodtreasureEffectState},t.prototype.setjinzhuEffectState=function(e){this._jinzhuEffectState=e},t.prototype.getjinzhuEffectState=function(){return this._jinzhuEffectState},t.prototype.setjindanEffectState=function(e){this._jindanEffectState=e},t.prototype.setdafuwengEffectState=function(e){this._dafuwengEffectState=e},t.prototype.setlimitTimesEffectState=function(e){this._limitTimesEffectState=e},t.prototype.setdaFanLiEffectState=function(e){this._daFanLiEffectState=e},t.prototype.getjindanEffectState=function(){return this._jindanEffectState},t.prototype.getlimitTimesEffectState=function(){return this._limitTimesEffectState},t.prototype.getdafuwengEffectState=function(){return this._dafuwengEffectState},t.prototype.getdaFanLiEffectState=function(){return this._daFanLiEffectState},t.prototype.setbaopenEffectState=function(e){this._baopenEffectState=e},t.prototype.getbaopenEffectState=function(){return this._baopenEffectState},t.prototype.setHuoDongEffectState=function(e){this._huodongEffectState=e},t.prototype.getHuoDongEffectState=function(){return this._huodongEffectState},t.prototype.setRedPacketEffectState=function(e){this._redPacketEffectState=e},t.prototype.getRedPacketEffectState=function(){return this._redPacketEffectState},t.prototype.setkuanghuanEffectState=function(e){this._kuanghuanEffectState=e},t.prototype.setkuafusaiEffectState=function(e){this._kuafusaiEffectState=e},t.prototype.getkuafusaiEffectState=function(){return this._kuafusaiEffectState},t.prototype.gethuikuiEffectState=function(){return this._huikuiEffectState},t.prototype.sethuikuiEffectState=function(e){this._huikuiEffectState=e},t.prototype.getkuanghuanEffectState=function(){return this._kuanghuanEffectState},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.setBtnStatus=function(e,t){this.statusDic[e]=t,this.update()},t.prototype.update=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.update()},t}();e.ActivityBarModel=t,__reflect(t.prototype,"foxgame.ActivityBarModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){this.type=e.type,this.btn=e.btn,this.source=e.source,this.handler=e.handler,this.index=e.index,this.ani=e.ani,this.red=e.red,this.time1=e.time,this.timeLabel=e.timeLabel,this.refreshEffectType=e.refreshEffectType||0,this.refreshRedType=e.refreshRedType||0,this.btnDiffY=e.btnDiffY||0,this.aniDiffY=e.aniDiffY||0,this.redDiffY=e.redDiffY||0,this.timeDiffY=e.timeDiffY||0}return e}();__reflect(t.prototype,"ActivityBtnGroup");var i=function(){function e(e,t){this.type=e,this.time2=t}return e}();__reflect(i.prototype,"ActivityBtnTimeData");var n=function(n){function o(e){var t=n.call(this,"resource/skins/activityBar/ActivityBarSkin.exml","activityBarGroup",!1)||this;return t.groupList=[],t.showList=[],t.refreshTimer=null,t.refreshTimeList=[],t.preTimes=0,t.isMask=!1,t.setIsShowBackBtn(!1),t.setRegisterTick(!0),t.setIsResDestroy(!1),t.isCenter=!1,t.isCallHideSceneObjectsWhenClose=!1,t.layer=LayerType.MAINUILAYER,t.model=e,t.model.registerObserver(t),t}return __extends(o,n),o.prototype.mfsqfrienduiMask=function(){},o.prototype.initHook=function(){this.mfsqfrienduiMask(),e.ActivityController.getIntance().setMessageToSeverAll(),e.ActivityXianShiController.getIntance().startGetData(),e.JuBaoPenController.getInstance().sendMessageForJuBaoPenInfo(),e.RechargeController.getInstance().sendMessageforLimitTimes();for(var i=[new t({type:e.ActivityBtnType.RANK,btn:this.ui.rankBtn,handler:this.rankHandler}),new t({type:e.ActivityBtnType.XUNBAO,btn:this.ui.searchTreasureBtn,handler:this.searchTreasureHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.ACHIEVEMENT,btn:this.ui.achievementBtn,handler:this.achievementHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.FULI,btn:this.ui.fuliBtn,handler:this.fuliHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.SHOP,btn:this.ui.shopBtn,handler:this.shopHandler,refreshRedType:1}),new t({type:e.ActivityBtnType.REDPACKET,btn:this.ui.redPacketBtn,handler:this.redPacketHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.JUBAOPEN,btn:this.ui.jubaopenBtn,handler:this.jubaopenHandler,refreshEffectType:2,refreshRedType:2,btnDiffY:3}),new t({type:e.ActivityBtnType.TONGJINZHU,btn:this.ui.tongjinzhuBtn,handler:this.tongjinzhuHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.ZAJINDAN,btn:this.ui.zajindanBtn,handler:this.zajindanHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.SHARE,btn:this.ui.shareBtn,handler:this.shareHandler}),new t({type:e.ActivityBtnType.KUANGHUAN,btn:this.ui.kuanghuanBtn,handler:this.kuanghuanHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.HUIKUI,btn:this.ui.huikuiBtn,handler:this.huikuiHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.WORLDBOSS,btn:this.ui.worldBossBtn,handler:this.worldBossHandler,refreshEffectType:1,btnDiffY:-6,aniDiffY:6,redDiffY:6,timeDiffY:6}),new t({type:e.ActivityBtnType.BONFIRE,btn:this.ui.bonFireBtn,handler:this.bonFireHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.ACTIVITY,btn:this.ui.activityBtn,handler:this.activityHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.KUAFULIANSAI,btn:this.ui.kuafuliansaiBtn,handler:this.kuafuliansaiHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.LIBAO0YUAN,btn:this.ui.dragongodtreasureBtn,handler:this.dragongodtreasureHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.WEIDUAN,btn:this.ui.weiduanBtn,handler:this.weiduanHandler}),new t({type:e.ActivityBtnType.ZHUANPAN,btn:this.ui.zhuanpanBtn,handler:this.zhuanpanHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.TWELVEPALACE,btn:this.ui.twelvePalaceBtn,handler:this.twelvePalaceHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.XIANSHI,btn:this.ui.xianshiBtn,handler:this.xianshiHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.SHACHENG,btn:this.ui.shachengBtn,handler:this.shachengHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.KFGONGCHENG,btn:this.ui.KFgongchengBtn,handler:this.gongchengHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.JIJIN,btn:this.ui.jijinBtn,handler:this.jijinHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.VIPTEQUAN,btn:this.ui.VIPTEQUANBtn,handler:this.vipHandler}),new t({type:e.ActivityBtnType.WANBAKEFU,btn:this.ui.kefubtn,handler:this.kefuHandler,refreshRedType:2}),new t({type:e.ActivityBtnType.DAFUWENG,btn:this.ui.dafuWengBtn,handler:this.dafuwengHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.PRIVILEGE,btn:this.ui.privilegeBtn,handler:this.privilegeHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.DAFANLI,btn:this.ui.daFanLi,handler:this.daFanLiHandler,refreshEffectType:2,refreshRedType:2}),new t({type:e.ActivityBtnType.QQVIP,btn:this.ui.qqvipbtn,handler:this.qqvipHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.LIMITTIMESCHARGE,btn:this.ui.limitCharge,handler:this.limitChargeHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.QLDXJFL,btn:this.ui.xianjindajiang,handler:this.xjdjHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.XINYUECLUB,btn:this.ui.xinyuetequan,handler:this.xytqHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.AWFL,btn:this.ui.aiwanfuliBtn,handler:this.tencentVideoHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.GDJC,btn:this.ui.gengduojingcaiBtn,handler:this.tencentVideoHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.QQVIPKAITONG,btn:this.ui.qqvipkt,handler:this.qqvipktHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.CAMPBATTLE,btn:this.ui.campBattleBtn,handler:this.campbattleHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.PINGTAIFULI,btn:this.ui.pingtaifuli,handler:this.pingtaifuliHandler,refreshRedType:1,refreshEffectType:1}),new t({type:e.ActivityBtnType.CHANNELSHARING,btn:this.ui.channelShareBtn,handler:this.channelShareHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.LANZUAN,btn:this.ui.blueBtn,handler:this.ttShareHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.DATING,btn:this.ui.datingBtn,handler:this.openDatingHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.TTSHARE,btn:this.ui.ttShareBtn,handler:this.ttShareHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.KUAFUBANGDAN,btn:this.ui.kuafubangdan,handler:this.kuaFuBangdanHandler}),new t({type:e.ActivityBtnType.REALNAME,btn:this.ui.realNameBtn,handler:this.by1758showRealNameCretHandler}),new t({type:e.ActivityBtnType.YIYUANXIANGOU,btn:this.ui.yiyuanbuy,handler:this.yiYuanBuyHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.MEIRICHONGZHI,btn:this.ui.meirichongzhiBtn,handler:this.meirichognzhiHandler,refreshEffectType:1}),new t({type:e.ActivityBtnType.MFSQFRIENDRANK,btn:this.ui.mfsqFridenRankBtn,handler:this.mfsqFridenRankHanderl,refreshEffectType:1})],n=0;n<i.length;n++){var o=i[n];o.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,o.handler,this),this.showList[n]=o.type,this.groupList[o.type]=o}this.ui.showBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHandler,this),this.ui.hideBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hideHandler,this),this.time=Number(e.GlobalConfig.instance.getValue("ACTIVITYBARTWEENTIME")),this.distance=Number(e.GlobalConfig.instance.getValue("ACTIVITYBARTWEENDIATANCE")),this.posY=100,e.Global.isWeChatXiaoChengXuBranch?this.posY=130:this.posY=100,e.GamePlatform.isQQdating&&(this.posY=0),ScreenAdaptation.instance.adaptActivityBar(this),this.startX=this.ui.btnGroup.x,this.endX=this.ui.btnGroup.x+this.distance,this.ui.showBtn.visible=!1,this.ui.hideBtn.visible=!0;var a;if(a="d7bcccfd2ab5dda771cdc9990d550687"==checkLogin().appKey?!1:-1!=e.UserInfo.platform.pfName.indexOf("1758"),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.SHARE,a),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.TTSHARE,"ttgame"==window.GJlenged_chanel),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.HUIKUI,!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.PRIVILEGE,!0),-1!=String(getGlobalConfig().serverUrl).indexOf("by1758")||"by1758"==egret.getOption("pf")){var s={code:"1758checkRealNameCert"};e.UserInfo.platform.reportData_legend(s)}e.GamePlatform.isDragonEx_qld&&(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.PINGTAIFULI,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.PRIVILEGE,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JUBAOPEN,!1)),egret.getOption("pf")&&-1!=egret.getOption("pf").indexOf("fdbt")&&e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JUBAOPEN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.LIBAO0YUAN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.PINGTAIFULI,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QQVIP,!e.WanbaVIPControler.getInstance().getmodel().qqvipstage),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.DAFANLI,!1);var r=1*e.PlayerService.instance.playerInfo.getLevel();if(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.WANBAKEFU,"qqgame"==checkPlatformStr()||2==getGlobalConfig().isfd||"1108023326"==getGlobalConfig().wanBaAppId&&"WX"!=e.UserInfo.platform.chanel||-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend.6deer.com")&&-1!=this.model.channelPf.indexOf("weChat")),"1108023326"==getGlobalConfig().wanBaAppId&&"WX"!=e.UserInfo.platform.chanel){e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QQVIPKAITONG,!1);var l=e.GameUtils.formatBrowserDeviceSystemInfo();HawkProtocolManager.newBuilder("JsProto.HPLogin");-1!=e.PlayerService.instance.puid.indexOf("wanba_ts")&&"H5.QZONE.PC"==l.split("#")[5]?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XINYUECLUB,!1):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XINYUECLUB,!0);var h=e.UserInfo.platform.getQQminiPlatForm();console.log("测试QQ平台入口 "+h),-1!=h.indexOf("sp")?(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.VIPTEQUAN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XINYUECLUB,!1)):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.VIPTEQUAN,!0),"QQLive"==e.UserInfo.platform.chanel&&(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.VIPTEQUAN,!1),"iOS"==egret.Capabilities.os?(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.GDJC,!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.AWFL,!1),this.setGDJCEffect(!0)):"Android"==egret.Capabilities.os&&(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.GDJC,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.AWFL,!0),this.setAWFLEffect(!0)))}else e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QQVIPKAITONG,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.VIPTEQUAN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XINYUECLUB,!1);r>=e.MainUiGuideValue.PLAYER_LEVEL_SIXTY?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.RANK,!0):-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.RANK,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.RANK,!1),r>=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_ICONOPEN"))?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KUAFULIANSAI,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KUAFULIANSAI,!1);var c=new Date;"iOS"!=egret.Capabilities.os&&"1108023326"==getGlobalConfig().wanBaAppId&&11==c.getDate()&&c.getMonth()+1==11?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QLDXJFL,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QLDXJFL,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.DATING,"QQdating"==getchannel()),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.SHACHENG,e.UnionSiegeController.getInstance().getModel().shachengopen),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.WEIDUAN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KFGONGCHENG,e.UnionSiegeController.getInstance().getModel().csshachengopen);var u=!1,p=e.PlayerService.instance.missionList[0];p&&(p.getId()>e.MainUiGuideValue.TASK_ID_600022?(u=!0,e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.FULI),e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.ACTIVITY),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XIANSHI,!0),p.getId()>e.MainUiGuideValue.TASK_ID_600032_K&&e.ActivityController.getIntance().getJijinshow()?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JIJIN,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.JIJIN,!1)):(p.getId()==e.MainUiGuideValue.TASK_ID_600022&&p.getTag()?(u=!0,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.FULI,!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ACTIVITY,!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ZHUANPAN,!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XIANSHI,!0)):(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.FULI,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ACTIVITY,!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ZHUANPAN,!0)),p.getId()>e.MainUiGuideValue.TASK_ID_600017||p.getId()==e.MainUiGuideValue.TASK_ID_600017&&p.getTag()?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XUNBAO,!0):-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XUNBAO,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XUNBAO,!1),p.getId()>e.MainUiGuideValue.TASK_ID_600015||p.getId()==e.MainUiGuideValue.TASK_ID_600015&&p.getTag()?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ACHIEVEMENT,!0):-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)?e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ACHIEVEMENT,!0):e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ACHIEVEMENT,!1))),u||(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.TONGJINZHU,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ZAJINDAN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KUANGHUAN,!1),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XIANSHI,!1))},o.prototype.guideshow=function(){if(41==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var t=this.ui.kuafuliansaiBtn;e.MainControler.instance.guidechange({x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height},t.parent,41,1,!0)}if(42==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var t=this.ui.searchTreasureBtn;e.MainControler.instance.guidechange({x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height},t.parent,42,1,!0)}},o.prototype.refresh=function(){for(var e,t,i,n=this.showList.length,o=0,a=0;n>a;a++)i=Boolean(this.model.statusDic[a]),t=this.showList[a],e=this.groupList[t],i?(e.index=o,this.refreshGroupPos(t,o),o++,e.btn.visible=!0):(e.btn.visible=!1,this.refreshBtnEffect(t,!1),this.refreshBtnRed(t,!1),this.refreshBtnTime(t,!1))
},o.prototype.mfsqFridenRankHanderl=function(){var t=window.platform;this.bitmap=t.openDataContext.createDisplayObject(null,this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(this.bitmap),e.ActivityController.getIntance().mfsqfrienduiView(),t.openDataContext.postMessage({text:"hello",year:(new Date).getFullYear(),command:"open"})},o.prototype.closemfsqFridenRankHanderl=function(){var e=window.platform;this.bitmap.parent&&this.bitmap.parent.removeChild(this.bitmap),e.openDataContext.postMessage({text:"hello",year:(new Date).getFullYear(),command:"close"})},o.prototype.onMask=function(e){mfsqShowFriendsRank("close"),this._rankMask.visible=!1},o.prototype.refreshGroupPos=function(e,t){var i=this.groupList[e];if(i){var n=6,o=Math.floor(t/n),a=t%n,s=o>2&&75*a||72*(5-a),r=80*o;i.btn.x=s+i.btn.width/2,i.btn.y=r+i.btn.height/2+i.btnDiffY,this.refreshEffectPos(i),this.refreshRedPos(i),this.refreshTimePos(i)}},o.prototype.refreshEffectPos=function(e){if(e){var t=e.ani;if(t){var i=e.btn,n=e.aniDiffY;t.parent.x=i.x,t.parent.y=i.y-i.height/2+i.width/2+n}}},o.prototype.refreshRedPos=function(e){if(e){var t=e.red;if(t){var i=e.btn,n=e.redDiffY;t.x=i.x+i.width/2-t.width,t.y=i.y-i.height/2+n}}},o.prototype.refreshTimePos=function(e){if(e){var t=e.timeLabel;if(t){var i=e.btn,n=e.timeDiffY;t.x=i.x-t.width/2,t.y=i.y+i.height/2-7+n}}},o.prototype.showHook=function(){"qqgame"==window.GJlenged_chanel&&e.ChannelShareController.getInstance().sendMessageShareinfo(),this.KFRedImg(2==getGlobalConfig().isfd||-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend.6deer.com")&&-1!=this.model.channelPf.indexOf("weChat")),this.model.getHuoDongEffectState()&&this.huodongEffect(!0),this.model.getjinzhuEffectState()&&e.ActivityBarController.getInstance().setjinzhuEffect(!0),this.model.getjindanEffectState()&&e.ActivityBarController.getInstance().setjindanEffect(!0),this.model.getbaopenEffectState()&&this.refreshJuBaoPenEffect(!0),this.model.getkuanghuanEffectState()&&e.ActivityBarController.getInstance().setKuangHuanEffect(!0),this.model.gethuikuiEffectState()&&this.huikuiEffect(!0),this.setWorldBossEffect(!0),this.setBonFireEffect(!0),this.setTwelvePalaceEffect(!0),this.setCampBattleEffect(!0),this.ZhuanPanRed(!0),e.ActivityBarController.getInstance().setAchievementRedTipVisible(),e.ActivityBarController.getInstance().setKuaFuSaiEffectVisible(),e.ActivityBarController.getInstance().setdragongodtreasureEffectVisible()},o.prototype.resizeHook=function(){this.x=ScreenAdaptation.instance.screenWidth-this.width,this.y=this.posY},o.prototype.update=function(){this.refresh()},o.prototype.setNewXianShiIcon=function(){var e=this.ui.yiyuanbuy,t=e.getChildAt(0);t.source="xianshi_enter_3yuan_png"},o.prototype.tickHook=function(t){var i=e.WorldBossController.getInstance().getRemainTime();i>0&&this.setBtnTimeValue(e.ActivityBtnType.WORLDBOSS,e.GlobalUtil.getTimeString(i/1e3,3));var n=e.UnionController.getInstance().getRemainTime();n>0&&this.setBtnTimeValue(e.ActivityBtnType.BONFIRE,e.GlobalUtil.getTimeString(n/1e3,3));var o=e.TwelvePalaceController.getInstance().getRemainTime();o>0&&this.setBtnTimeValue(e.ActivityBtnType.TWELVEPALACE,e.GlobalUtil.getTimeString(o/1e3,3)),this.limitTime||(this.limitTime=e.RechargeController.getInstance().getLimitEndTimes());var a=t-this.preTimes;a>=1e3&&(this.preTimes=t,this.limitTime-=1e3),this.limitTime&&this.limitTime>0&&this.setBtnTimeValue(e.ActivityBtnType.LIMITTIMESCHARGE,e.GlobalUtil.getTimeString(this.limitTime/1e3,3));var s=e.FactionBattleController.getInstance().getCampRemainingTime();s>0&&this.setBtnTimeValue(e.ActivityBtnType.CAMPBATTLE,e.GlobalUtil.getTimeString(s/1e3,3));var r=!1;o>0&&1==e.TwelvePalaceController.getInstance().getModel().isOpen&&(r=!0),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.TWELVEPALACE,r)},o.prototype.activityHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showPanel()},o.prototype.searchTreasureHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.SearchTreasureController.getInstance().showPanel()},o.prototype.fuliHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||(e.WealPanelController.getInstance().fuliUIIsShow=!1,e.WealPanelController.getInstance().showWealPanel())},o.prototype.xianliHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showMeiRiXianLiPanel()},o.prototype.jubaopenHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.JuBaoPenController.getInstance().showPanel()},o.prototype.dafuwengHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showDafuwengPanel()},o.prototype.daFanLiHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().sendRECHARGE_REBATE_C()},o.prototype.qqvipHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.WanbaVIPControler.getInstance().showqqvippanle()},o.prototype.limitChargeHandler=function(t){TweenMax.isTweening(this.ui.limitCharge)||e.RechargeController.getInstance().showPanel(!0)},o.prototype.shopHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ShopMainControler.getInstance().showPanel()},o.prototype.jueweiHandler=function(t){if(!TweenMax.isTweening(this.ui.btnGroup))if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.JUEWEI))e.NewJueweiController.getInstance().showPanel();else{var i=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.JUEWEI);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JUEWEIOPEN",i))}},o.prototype.achievementHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.AchievementController.getInstance().showPanel()},o.prototype.rankHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.RankController.getInstance().showRankPanel()},o.prototype.shareHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showsharePanel()},o.prototype.zajindanHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showZaJinDanPanel()},o.prototype.tongjinzhuHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showTongJinZhuPanel()},o.prototype.showHandler=function(e){var t=this.ui.aniGroup;if(t.visible=!0,!TweenMax.isTweening(t)){TweenMax.to(t,this.time,{alpha:1,x:t.x-this.distance});var i=this.ui.btnGroup;if(i.visible=!0,!TweenMax.isTweening(i)){TweenMax.to(i,this.time,{alpha:1,x:i.x-this.distance,onComplete:this.displayShowComplete.bind(this)});var n=this.ui.redGroup;if(n.visible=!0,!TweenMax.isTweening(n)){TweenMax.to(n,this.time,{alpha:1,x:n.x-this.distance});var o=this.ui.timeGroup;o.visible=!0,TweenMax.isTweening(o)||TweenMax.to(o,this.time,{alpha:1,x:o.x-this.distance})}}}},o.prototype.displayShowComplete=function(){var e=this.ui.btnGroup;e.touchEnabled=!0,e.touchChildren=!0,e.touchThrough=!0,TweenMax.killTweensOf(e),e.x=this.startX,this.ui.showBtn.visible=!1,this.ui.hideBtn.visible=!0;var t=this.ui.aniGroup;TweenMax.killTweensOf(t),t.x=this.startX;var i=this.ui.redGroup;TweenMax.killTweensOf(i),i.x=this.startX;var n=this.ui.timeGroup;TweenMax.killTweensOf(n),n.x=this.startX},o.prototype.hideHandler=function(e){var t=this.ui.aniGroup;if(!TweenMax.isTweening(t)){TweenMax.to(t,this.time,{alpha:0,x:t.x+this.distance});var i=this.ui.btnGroup;if(!TweenMax.isTweening(i)){TweenMax.to(i,this.time,{alpha:0,x:i.x+this.distance,onComplete:this.displayHideComplete.bind(this)});var n=this.ui.redGroup;if(!TweenMax.isTweening(n)){TweenMax.to(n,this.time,{alpha:0,x:n.x+this.distance});var o=this.ui.timeGroup;TweenMax.isTweening(o)||TweenMax.to(o,this.time,{alpha:0,x:o.x+this.distance})}}}},o.prototype.kuanghuanHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showkuanghuanPanel()},o.prototype.huikuiHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().showHuiKuiPanel()},o.prototype.worldBossHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.WorldBossController.getInstance().showBossPanel()},o.prototype.bonFireHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.UnionController.getInstance().showBonFirePanel()},o.prototype.twelvePalaceHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.TwelvePalaceController.getInstance().showPanel(1)},o.prototype.redPacketHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.RedPacketController.getInstance().showPanel()},o.prototype.kuafuliansaiHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.KFController.getInstance().showPanel()},o.prototype.dragongodtreasureHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityController.getIntance().openzeropackagepanel()},o.prototype.weiduanHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.WeiduanController.getInstance().showPanel()},o.prototype.zhuanpanHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.zhuanPanControler.getInstance().showPanel()},o.prototype.xianshiHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ActivityXianShiController.getIntance().showPanel()},o.prototype.shachengHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.UnionController.getInstance().showUnionSiegePanel(2,!0)},o.prototype.gongchengHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.UnionSiegeController.getInstance().showCrossServerPanel(1)},o.prototype.jijinHandler=function(t){e.ActivityController.getIntance().showPanel(!0,e.activityDaTingType.chengzhangjijin)},o.prototype.vipHandler=function(t){e.WanbaVIPControler.getInstance().showpanel()},o.prototype.kefuHandler=function(t){return 2==getGlobalConfig().isfd||-1!=this.model.channelPf.indexOf("weChat")?void e.ShareWanbaControler.getInstance().showzyxcxpanel():void window.open("http://wpa.b.qq.com/cgi/wpa.php?ln=1&key=XzgwMDgyNDEyMl80ODAyNjRfODAwODI0MTIyXzJf")},o.prototype.xjdjHandler=function(e){return"qqgame"==window.GJlenged_chanel?void qqOpenUrl("https://mobile.qzone.qq.com/l?g=8001"):void window.open("https://mobile.qzone.qq.com/l?g=8001")},o.prototype.xytqHandler=function(t){e.WanbaVIPControler.getInstance().showxinyuepanel()},o.prototype.tencentVideoHandler=function(t){e.TencentVideoController.getInstance().showpanel()},o.prototype.qqvipktHandler=function(t){e.ShareWanbaControler.getInstance().showWanbaSVIPpanel()},o.prototype.campbattleHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.FactionBattleController.getInstance().showPanel()},o.prototype.yiYuanBuyHandler=function(t){e.ActivityController.getIntance().showNewXianGouPanel(e.NewXianGouType.YIYUAN)},o.prototype.meirichognzhiHandler=function(t){e.ActivityController.getIntance().showMeiRiChongZhiView()},o.prototype.channelShareHandler=function(t){e.ChannelShareController.getInstance().showPanel()},o.prototype.ttShareHandler=function(t){e.TTShareController.getInstance().showPanel()},o.prototype.kuaFuBangdanHandler=function(t){e.ActivityController.getIntance().showKuafuBanDanPanel()},o.prototype.by1758showRealNameCretHandler=function(){var t={code:"1758showRealNameCret"};e.UserInfo.platform.reportData_legend(t)},o.prototype.openDatingHandler=function(t){e.QQdatingController.getInstance().showPanel()},o.prototype.openTTrecorder=function(e){},o.prototype.getRecorderBack=function(e){},o.prototype.pingtaifuliHandler=function(t){TweenMax.isTweening(this.ui.btnGroup)||e.ShareWanbaControler.getInstance().showPlatformBenefitsPanel()},o.prototype.privilegeHandler=function(t){e.PrivilegeController.getInstance().showpanel(1)},o.prototype.setBtnEffectVisible=function(t,i){var n=this.groupList[t];if(n)if(i&&n.btn.visible){if(!n.ani){var o=new eui.Group;this.ui.aniGroup.addChild(o),n.ani=new e.FoxAni(o)}n.ani.play("achievementAnimation","ani",-1),this.refreshEffectPos(n),n.ani.parent.visible=!0,Log.trace("showeffect    type = "+t)}else n.ani&&(n.ani.stop(),n.ani.parent.visible=!1)},o.prototype.setBtnRedVisible=function(e,t){var i=this.groupList[e];if(i)if(t&&i.btn.visible){if(!i.red){var n=new eui.Image("global_tips_tishidian_png");this.ui.redGroup.addChild(n),i.red=n}this.refreshRedPos(i),i.red.visible=!0,Log.trace("showred    type = "+e)}else i.red&&(i.red.visible=!1)},o.prototype.setBtnTimeValue=function(e,t,i){void 0===i&&(i=15915165);var n=this.groupList[e];if(n){if(!n.timeLabel){var o=new eui.Label;o.textColor=i,o.fontFamily="SimSun",o.size=18,o.stroke=1,o.strokeColor=0,this.ui.timeGroup.addChild(o),n.timeLabel=o}n.timeLabel.text=t,this.refreshTimePos(n),this.refreshBtnTime(e,!0)}},o.prototype.refreshBtnEffect=function(e,t){var i=this.groupList[e];i&&(1==i.refreshEffectType?this.setBtnEffectVisible(e,t):2==i.refreshEffectType&&(t&&this.groupList[e]&&this.groupList[e].red&&this.groupList[e].red.visible?(this.setBtnEffectVisible(e,!0),this.setBtnRedVisible(e,!1)):this.setBtnEffectVisible(e,!1)))},o.prototype.refreshBtnRed=function(e,t){var i=this.groupList[e];i&&(1==i.refreshEffectType?this.setBtnRedVisible(e,t):2==i.refreshRedType&&(this.setBtnRedVisible(e,t),t&&this.setBtnEffectVisible(e,!1)))},o.prototype.setNewXianGouEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.YIYUANXIANGOU,t)},o.prototype.refreshBtnTime=function(e,t){var i=this.groupList[e];i&&i.timeLabel&&(i.timeLabel.visible=!!t)},o.prototype.setWorldBossEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.WORLDBOSS,t)},o.prototype.setBonFireEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.BONFIRE,t)},o.prototype.setTwelvePalaceEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.TWELVEPALACE,t)},o.prototype.setCampBattleEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.CAMPBATTLE,t)},o.prototype.setAWFLEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.AWFL,t)},o.prototype.setGDJCEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.GDJC,t)},o.prototype.displayHideComplete=function(){var e=this.ui.btnGroup;e.touchEnabled=!1,e.touchChildren=!1,e.touchThrough=!0,e.visible=!1,TweenMax.killTweensOf(e),e.x=this.endX,this.ui.showBtn.visible=!0,this.ui.hideBtn.visible=!1;var t=this.ui.aniGroup;TweenMax.killTweensOf(t),t.x=this.endX;var i=this.ui.redGroup;TweenMax.killTweensOf(i),i.x=this.endX;var n=this.ui.timeGroup;TweenMax.killTweensOf(n),n.x=this.endX},o.prototype.setAchievementRedTipVisible=function(t){this.refreshBtnRed(e.ActivityBtnType.ACHIEVEMENT,t)},o.prototype.refreshJuBaoPenEffect=function(t){this.model.setbaopenEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.JUBAOPEN,t)},o.prototype.refreshJuBaoPenRed=function(t){this.refreshBtnRed(e.ActivityBtnType.JUBAOPEN,t)},o.prototype.huodongEffect=function(t){this.model.setHuoDongEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.ACTIVITY,t)},o.prototype.HdRedImg=function(t){this.refreshBtnRed(e.ActivityBtnType.ACTIVITY,t)},o.prototype.kefuRedClose=function(e){this.KFRedImg(e)},o.prototype.KFRedImg=function(t){this.refreshBtnRed(e.ActivityBtnType.WANBAKEFU,t)},o.prototype.jindanEffect=function(t){this.model.setjindanEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.ZAJINDAN,t)},o.prototype.dafuwengEffect=function(t){this.model.setdafuwengEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.DAFUWENG,t)},o.prototype.limitTimesEffect=function(t){this.model.setlimitTimesEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.LIMITTIMESCHARGE,t)},o.prototype.daFanLiEffect=function(t){this.model.setdaFanLiEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.DAFANLI,t)},o.prototype.jinzhuEffect=function(t){this.model.setjinzhuEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.TONGJINZHU,t)},o.prototype.kuangHuanEffect=function(t){this.model.setkuanghuanEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.KUANGHUAN,t)},o.prototype.kuanghuanRed=function(t){this.refreshBtnRed(e.ActivityBtnType.KUANGHUAN,t)},o.prototype.privilegeRed=function(t){this.refreshBtnRed(e.ActivityBtnType.PRIVILEGE,t)},o.prototype.qqvipRed=function(t){this.refreshBtnRed(e.ActivityBtnType.QQVIP,t)},o.prototype.dragongodtreasureEffect=function(t){this.model.setdragongodtreasureEffectState(t),this.refreshBtnEffect(e.ActivityBtnType.LIBAO0YUAN,t)},o.prototype.kuaFuSaiEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.KUAFULIANSAI,t)},o.prototype.qqdatingRed=function(t){this.refreshBtnRed(e.ActivityBtnType.DATING,t)},o.prototype.huikuiEffect=function(t){this.refreshBtnEffect(e.ActivityBtnType.HUIKUI,t)},o.prototype.huikuiRed=function(t){this.refreshBtnRed(e.ActivityBtnType.HUIKUI,t)},o.prototype.redPacketRed=function(t){this.refreshBtnRed(e.ActivityBtnType.REDPACKET,t)},o.prototype.ZhuanPanRed=function(t){this.refreshBtnRed(e.ActivityBtnType.ZHUANPAN,t)},o.prototype.setFuLiRedImg=function(t){this.refreshBtnRed(e.ActivityBtnType.FULI,t)},o.prototype.xianshiRed=function(t){this.refreshBtnRed(e.ActivityBtnType.XIANSHI,t)},o.prototype.refreshSearchTreasureRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.XUNBAO,t)},o.prototype.setShopRedImgVisible=function(t){this.refreshBtnRed(e.ActivityBtnType.SHOP,t)},o.prototype.setTongJinZhuRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.TONGJINZHU,t)},o.prototype.setZaJinDanRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.ZAJINDAN,t)},o.prototype.setChengZhangJiJinRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.JIJIN,t)},o.prototype.setCampbattleRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.CAMPBATTLE,t)},o.prototype.setChannelShareRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.CHANNELSHARING,t)},o.prototype.setplatRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.PINGTAIFULI,t)},o.prototype.setDafuwengRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.DAFUWENG,t)},o.prototype.setLimitTimesRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.LIMITTIMESCHARGE,t)},o.prototype.setdaFanLiRedPoint=function(t){this.refreshBtnRed(e.ActivityBtnType.DAFANLI,t)},o.prototype.getGroupList=function(){return this.groupList},o.prototype.closeHook=function(){},o.prototype.checkOpenActivityShow=function(t){switch(t){case e.ActivityBtnType.SHOP:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.SHOP,!0);break;case e.ActivityBtnType.RANK:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.RANK,!0);break;case e.ActivityBtnType.ACHIEVEMENT:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.ACHIEVEMENT,!0);break;case e.ActivityBtnType.FULI:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.FULI,!0);break;case e.ActivityBtnType.HUIKUI:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.HUIKUI,!0);break;case e.ActivityBtnType.XUNBAO:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XUNBAO,!0);break;case e.ActivityBtnType.KUAFULIANSAI:e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KUAFULIANSAI,!0);default:e.ActivityBarController.getInstance().setBtnStatus(t,!0)}},o.prototype.getLiansaiBtnPoint=function(){var e=this.ui.kuafuliansaiBtn.localToGlobal(this.ui.kuafuliansaiBtn.anchorOffsetX,this.ui.kuafuliansaiBtn.anchorOffsetY);return e},o.prototype.getSearchTreasureBtnPoint=function(){var e=this.ui.searchTreasureBtn.localToGlobal(this.ui.searchTreasureBtn.anchorOffsetX,this.ui.searchTreasureBtn.anchorOffsetY);return e},o.prototype.getachievementBtnPoint=function(){var e=this.ui.achievementBtn.localToGlobal(this.ui.achievementBtn.anchorOffsetX,this.ui.achievementBtn.anchorOffsetY);return e},o.prototype.getActivityBtnPoint=function(){var e=this.ui.activityBtn.localToGlobal(this.ui.activityBtn.anchorOffsetX,this.ui.activityBtn.anchorOffsetY);return e},o.prototype.getJueWeiBtnPoint=function(){var e=null;return e},o.prototype.addBtnTimer=function(e,t){var n=new i(e,t);this.refreshTimeList.push(n),this.startTimerRefresh()},o.prototype.startTimerRefresh=function(){this.refreshTimer||(this.refreshTimer=setInterval(this.onTimerRefresh.bind(this),1e3),this.onTimerRefresh())},o.prototype.stopTimerRefresh=function(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},o.prototype.onTimerRefresh=function(){for(var t=0;t<this.refreshTimeList.length;t++){var i=this.refreshTimeList[t];i.time2>0?(this.setBtnTimeValue(i.type,e.GlobalUtil.getTimeString(i.time2/1e3,3)),i.time2-=1e3):(this.refreshTimeList.splice(t,1),t--)}0==this.refreshTimeList.length&&this.stopTimerRefresh()},o.prototype.setRealNameBtnStatus=function(t){e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.REALNAME,t)},o}(e.BasePanel);e.ActivityBarPanel=n,__reflect(n.prototype,"foxgame.ActivityBarPanel",["foxgame.IActivityBar","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.TTgameShareInVo=t,__reflect(t.prototype,"foxgame.TTgameShareInVo")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.startTime=0,e.endTime=0,e.overTime=3,e.recorderStatus=0,e.recorderPath="",e.skinName="TTRecordedSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},i.prototype.init=function(){this.shareRecorderBtn.visible=!1,this.underwayBtn.visible=!1,this.recorderBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startRecord,this),this.underwayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startRecord,this)},i.prototype.startRecord=function(){var t=this,i=this.recorderStatus;startRecorder(i,function(i,n){switch(console.log("状态:"+i,"path:"+n+"  服务器时间"+egret.getTimer()/1e3),App.TimerManager().remove(t.timeOut,t),i){case 1:t.startTime=egret.getTimer()/1e3,t.recorderPath=n=null,t.shareRecorderBtn.visible=!1,t.recorderBtn.visible=!1,t.underwayBtn.visible=!0;break;case 2:t.underwayBtn.visible=!0,t.recorderBtn.visible=!1;break;case 3:case 0:if(t.underwayBtn.visible=!1,t.recorderBtn.visible=!0,0!=t.startTime){if(t.endTime=egret.getTimer()/1e3,t.endTime-t.startTime<t.overTime)return e.PopUpController.getInstance().showFloatTextPanel1("录屏时间不得小于3秒"),t.recorderStatus=0,t.recorderPath="",t.startTime=t.endTime=0,t.shareRecorderBtn.visible=!1,t.underwayBtn.visible=!1,void(t.recorderBtn.visible=!0);t.startTime=t.endTime=0}}t.recorderStatus=i,!n||0!=i&&3!=i||(t.recorderPath=n,e.TTShareController.getInstance().model.path=n,t.shareRecorderBtn.visible=!0,t.underwayBtn.visible=!1,t.recorderBtn.visible=!1,e.TTShareController.getInstance().showVideoPanel(),t.shareRecorderBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.shareRecord,t))})},i.prototype.timeOut=function(){this.shareRecorderBtn.visible=!1,this.underwayBtn.visible=!1,this.recorderBtn.visible=!0,this.startTime=this.endTime=0},i.prototype.shareRecord=function(){var t=this.recorderPath;e.TTShareController.getInstance().model.path=t,console.log(e.TTShareController.getInstance().model.path+"************"),e.TTShareController.getInstance().showVideoPanel()},i}(eui.Component);e.TTRecorded=t,__reflect(t.prototype,"foxgame.TTRecorded")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.ArenaMainTabBtnCount=3,e}();e.ArenaConsts=t,__reflect(t.prototype,"foxgame.ArenaConsts")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.MaxBuyTimes=10,this.curPointCount=0,this.arraycoll=new eui.ArrayCollection,this.protectsurpTimes=0,this.protectTimes=5,this.arenRankArrayColl=new eui.ArrayCollection,this.arenShopArrayColl=new eui.ArrayCollection}return Object.defineProperty(t,"Ins",{get:function(){return null==this.ins&&(this.ins=new t),this.ins},enumerable:!0,configurable:!0}),t.prototype.initselfData=function(t){this.surplusChallengeTimes=t.getSurplusChallengeTimes(),this.nextBuyPrice=t.getNextBuyPrice(),this.alreadyBuyTimes=t.getAlreadyBuyTimes(),this.curPointCount=t.getArenaPoint(),e.MainControler.instance.setArenaRedPoint()},t.prototype.showRedPoint=function(){return e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.JINGJICHANG,!1)&&null!=this.surplusChallengeTimes&&this.surplusChallengeTimes>0},t.prototype.ChallengesNum=function(){var e=this.surplusChallengeTimes;return e},t.prototype.initArenRankData=function(e){this.arenRankArrayColl.removeAll();var t=e.getRankInfo();this.arenRankArrayColl.replaceAll(t),this.arenRankArrayColl.refresh()},t.prototype.initAreanLogList=function(e){this.arraycoll.removeAll();var t=e.getRecord();this.arraycoll.replaceAll(t),this.arraycoll.refresh()},t.prototype.initArenShopList=function(){var t=this;this.arenShopArrayColl.removeAll();var i=e.JsonDataManager.instance.aren_ShopTemplate;i.forEach(function(e){t.arenShopArrayColl.addItem(e)}),this.arenShopArrayColl.refresh()},t.ins=null,t}();e.ArenaModel=t,__reflect(t.prototype,"foxgame.ArenaModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/arena/new/ArenaRecordItem.exml",e.touchEnabled=e.touchChildren=!1,e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=e.NewArenaControler.Ins.getArenLogString(this.data);this.timeLabel.text=i.time,this.contentLabel.textFlow=(new egret.HtmlTextParser).parser(i.content)},i}(eui.ItemRenderer);e.AreaLogItemRander=t,__reflect(t.prototype,"foxgame.AreaLogItemRander")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.skinName="resource/skins/arena/new/ArenaRecordSkin.exml",e.PopUpManager.instance.registerWindow(e.WindowName.NEW_AREA_LOG_UI,i,i),i}return __extends(i,t),i.prototype.childCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.show=function(){this.doScreenAdaptation(),e.PopUpManager.instance.addPopUp(e.WindowName.NEW_AREA_LOG_UI,e.WindowName.UILAYER,5,!0),e.NewArenaControler.Ins.requestAreaLog()},i.prototype.onBtnClose=function(){e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREA_LOG_UI)},i.prototype.initList=function(){this.recordList.dataProvider=e.ArenaModel.Ins.arraycoll,this.recordList.itemRenderer=e.AreaLogItemRander,this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},i}(e.ViewControler);e.AreaLogUI=t,__reflect(t.prototype,"foxgame.AreaLogUI")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.first=1]="first",e[e.second=2]="second",e[e.third=3]="third"}(t=e.Rank||(e.Rank={}));var i=function(t){function i(){var i=t.call(this)||this;return i.skinName="ArenaMainSkin",i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeFromStage,i),e.PopUpManager.instance.registerWindow(e.WindowName.NEW_AREA_UI,i,i),i}return __extends(i,t),i.prototype.removeFromStage=function(){e.Message.instance.remove(e.MsgCMD.NEW_AREN_UI_REFRESH,this),e.Message.instance.remove(e.MsgCMD.NEW_AREN_UI_REFRESH_SULPCOUNT,this),e.Message.instance.remove(e.MsgCMD.NEW_AREN_BEGIN_PROTECT_5S,this),e.Message.instance.remove(e.MsgCMD.NEW_AREN_UI_REFRESH_DEFENDER,this),this.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHelp,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.backFun,this),this.chaekRewardLabel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelchaekReward,this),this.imgBuyCount.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyCount,this),this.imgChange.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onImgChange,this),this.imgReward.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onImgReward,this),this.imgLog.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onImgLog,this),this.firstAvatar&&this.firstAvatar.getAvatar()&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.firstAvatar.getAvatar(),"AreaMainUICharAvatar",!1,""),this.firstAvatar.getAvatar().notifyUnLoadImageRes()),this.secondAvatar&&this.secondAvatar.getAvatar()&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.secondAvatar.getAvatar(),"AreaMainUICharAvatar",!1,""),this.secondAvatar.getAvatar().notifyUnLoadImageRes()),this.thirdAvatar&&this.thirdAvatar.getAvatar()&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.thirdAvatar.getAvatar(),"AreaMainUICharAvatar",!1,""),this.thirdAvatar.getAvatar().notifyUnLoadImageRes())},i.prototype.show=function(){return e.PlayerService.instance.level<60?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ARENA_MAINSCENE_LEVELERROR_TIP")):(App.LittleLoading().showLoading("AreaMainUI"),e.MainControler.instance.setbtnmask(!0),this.addEvent(),e.NewArenaControler.Ins.requestAreaData(),void e.PopUpManager.instance.addPopUp(e.WindowName.NEW_AREA_UI,e.WindowName.UILAYER,5,!1))},i.prototype.addEvent=function(){e.Message.instance.add(e.MsgCMD.NEW_AREN_UI_REFRESH,this),e.Message.instance.add(e.MsgCMD.NEW_AREN_UI_REFRESH_SULPCOUNT,this),e.Message.instance.add(e.MsgCMD.NEW_AREN_BEGIN_PROTECT_5S,this),e.Message.instance.add(e.MsgCMD.NEW_AREN_UI_REFRESH_DEFENDER,this),e.Message.instance.add(e.MsgCMD.NEW_AREN_REFRESH_POINT,this),this.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHelp,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backFun,this),this.chaekRewardLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelchaekReward,this),this.imgBuyCount.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyCount,this),this.imgChange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onImgChange,this),this.imgReward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onImgReward,this),this.imgLog.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onImgLog,this)},i.prototype.onBtnClose=function(t){e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREA_UI),e.MainControler.instance.setbtnmask(!1),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"AreaMainUI",tag:"onBtnClose",battleType:e.BattleType.BATTLE_PVP_ARENA})},i.prototype.backFun=function(t){34==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),e.WanFaController.getInstance().showPanel(),e.MainControler.instance.setbtnmask(!1),e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREA_UI),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"AreaMainUI",tag:"backFun",battleType:e.BattleType.BATTLE_PVP_ARENA})},i.prototype.onBtnHelp=function(t){e.HelpController.getInstance().showPanel("ARENAHELP")},i.prototype.onLabelchaekReward=function(){e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.NEW_AREA_RANK_UI)},i.prototype.onBuyCount=function(t){e.NewArenaControler.Ins.BuyCount()},i.prototype.onImgChange=function(t){e.NewArenaControler.Ins.ReplaceDefenders()},i.prototype.onImgReward=function(t){e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.NEW_AREN_SHAOP_UI)},i.prototype.onImgLog=function(t){e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.NEW_AREA_LOG_UI)},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.NEW_AREN_UI_REFRESH:this.refreshTopThree(i.getTopThree()),this.refreshDefenders(i.getDefender()),this.freshselfData(i.getSelf());break;case e.MsgCMD.NEW_AREN_UI_REFRESH_DEFENDER:var n=i;this.refreshDefenders(n.getDefender());break;case e.MsgCMD.NEW_AREN_UI_REFRESH_SULPCOUNT:this.refreshSurpLabel();break;case e.MsgCMD.NEW_AREN_BEGIN_PROTECT_5S:this.setTimeLabel(),34==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.backBtn,this.backBtn.parent,34,4,!0);break;case e.MsgCMD.NEW_AREN_REFRESH_POINT:this.scoreLabel.text=e.ArenaModel.Ins.curPointCount+""}},i.prototype.refreshTopThree=function(e){var t=[this.firstAvatar,this.secondAvatar,this.thirdAvatar];this.firstArena.visible=!1;for(var i=t.length,n=0,o=null;i>n;)o=t[n],e[n]?(o.setInfo(e[n]),o.visible=!0,0==n?(this.firstArena.visible=!0,this.firstArena.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.firstArena.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showOtherInfo,this)):o.hasEventListener(egret.TouchEvent.TOUCH_TAP)||o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showOtherInfo,this)):o.visible=!1,n+=1
},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.doScreenAdaptation(),34==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.challenger3.imgChallenge,this.challenger3.imgChallenge.parent,34,3,!0),this.currency.refresh()},i.prototype.showOtherInfo=function(t){var i=~~t.currentTarget.name,n=1==i?this.firstAvatar:2==i?this.secondAvatar:3==i?this.thirdAvatar:null;n&&e.OtherCharacterController.getInstance().showOtherCharacterPanel(n.getPlayerId())},i.prototype.refreshDefenders=function(e){for(var t=[this.challenger1,this.challenger2,this.challenger3],i=t.length,n=0;i>n;)e[n]?(t[n].visible=!0,t[n].setInfo(e[n])):t[n].visible=!1,n++},i.prototype.freshselfData=function(t){this.myRankLabel.text=t.getRank()+"",this.scoreLabel.text=e.ArenaModel.Ins.curPointCount+"",this.refreshSurpLabel()},i.prototype.refreshSurpLabel=function(){this.surpLabel.text=e.ArenaModel.Ins.surplusChallengeTimes+""},i.prototype.setTimeLabel=function(){function t(){var n=setTimeout(function(){i.timeLabel.text=--e.ArenaModel.Ins.protectsurpTimes+e.LanguageUtils.instance.getValue("MIAO"),e.ArenaModel.Ins.protectsurpTimes>0?t():i.timeLabel.text=e.ArenaModel.Ins.protectTimes+e.LanguageUtils.instance.getValue("MIAO"),clearTimeout(n)},1e3)}var i=this;e.ArenaModel.Ins.protectsurpTimes=e.ArenaModel.Ins.protectTimes,t()},i.prototype.doScreenAdaptation=function(){t.prototype.doScreenAdaptation.call(this),this.backBtn.scaleX=1/this.scaleX,this.backBtn.y=ScreenAdaptation.instance.screenHeight-110-this.y},i}(e.ViewControler);e.AreaMainUI=i,__reflect(i.prototype,"foxgame.AreaMainUI",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/arena/new/ArenaRankItem.exml",e.touchEnabled=e.touchChildren=!1,e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh(this.data)},i.prototype.refresh=function(t){var i=e.JsonDataManager.instance.roleTemplate[t.getCfgItemId()];i&&(this.headIcon.source=i.icon2);var n=t.getRank();switch(n){case e.Rank.first:this.rankIcon.source="global_jin_png";break;case e.Rank.second:this.rankIcon.source="global_yin_png";break;case e.Rank.third:this.rankIcon.source="global_tong_png";break;default:this.rankIcon.source=""}this.rankLabel.text=n+"",this.nameLabel.text=t.getName()+"["+e.LanguageUtils.instance.getValue("LEVEL")+" "+t.getLevel()+"]",this.fightLabel.text=t.getFightValue()+"";var o=e.NewArenaControler.Ins.getRewardStrByRank(n);this.coinLabel.text=o.coinCount+"",this.scroeLabel.text=o.pointCount+""},i}(eui.ItemRenderer);e.ArenaRankItem=t,__reflect(t.prototype,"foxgame.ArenaRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.skinName="resource/skins/arena/new/ArenaRankSkin.exml",e.PopUpManager.instance.registerWindow(e.WindowName.NEW_AREA_RANK_UI,i,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeFromStage,i),i}return __extends(i,t),i.prototype.removeFromStage=function(){e.Message.instance.remove(e.MsgCMD.NEW_AREN_RANK_UI_REFRESH,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.itemList.dataProvider=null,this.itemList.itemRenderer=null},i.prototype.show=function(){this.doScreenAdaptation(),this.itemList.dataProvider=e.ArenaModel.Ins.arenRankArrayColl,this.itemList.itemRenderer=e.ArenaRankItem,e.Message.instance.add(e.MsgCMD.NEW_AREN_RANK_UI_REFRESH,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),e.NewArenaControler.Ins.requestAreaRankData(),e.PopUpManager.instance.addPopUp(e.WindowName.NEW_AREA_RANK_UI,e.WindowName.UILAYER,5,!0)},i.prototype.onBtnClose=function(){e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREA_RANK_UI)},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.NEW_AREN_RANK_UI_REFRESH:this.refreshItems(i)}},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.refreshItems=function(t){var i=t.getSelf();e.PlayerService.instance.getRoleVO(i.getCfgItemId());this.rankLabel.text=i.getRank()+"",this.scroeLabel.text=i.getArenaPoint()+"";var n=e.NewArenaControler.Ins.getRewardStrByRank(i.getRank());this.coinLabel.text=n.coinCount+"",this.scroeLabel.text=n.pointCount+""},i}(e.ViewControler);e.ArenaRankUI=t,__reflect(t.prototype,"foxgame.ArenaRankUI",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/arena/new/ArenaShopItemSkin.exml",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e}return __extends(i,t),i.prototype.addToStage=function(){this.btnExchange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchange,this),this.itemcell.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnIcon,this),this.jifenIcon.visible=!0,this.bayebiIcon.visible=!1},i.prototype.removeFromStage=function(){this.btnExchange.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchange,this),this.itemcell.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnIcon,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=e.JsonDataManager.instance.itemTemplate,n=i[this.data.itemID];this.priceLabel.text=this.data.price,this.nameLabel.text=n.name,this.itemcell.setItem(this.data.itemID,1,!1,!1)},i.prototype.onBtnExchange=function(){e.NewArenaControler.Ins.buyArenShopItem(this.data.itemID,this.data.price)},i.prototype.onBtnIcon=function(){var t=e.JsonDataManager.instance.itemTemplate,i=t[this.data.itemID];i.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(this.data.itemID):e.TipsController.getInstance().showItemTips(this.data.itemID)},i}(eui.ItemRenderer);e.ArenShopItemRenderer=t,__reflect(t.prototype,"foxgame.ArenShopItemRenderer")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.skinName="resource/skins/arena/new/ArenaShopSkin.exml",e.PopUpManager.instance.registerWindow(e.WindowName.NEW_AREN_SHAOP_UI,i,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeFromStage,i),i.setIsTouchClose(!0),i.setOnCloseFun(i.onBtnClose),i}return __extends(i,t),i.prototype.removeFromStage=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHelp,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.itemList.dataProvider=null,this.itemList.itemRenderer=null},i.prototype.show=function(){this.itemList.dataProvider=e.ArenaModel.Ins.arenShopArrayColl,this.itemList.itemRenderer=e.ArenShopItemRenderer,e.ArenaModel.Ins.initArenShopList(),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHelp,this),e.PopUpManager.instance.addPopUp(e.WindowName.NEW_AREN_SHAOP_UI,e.WindowName.UILAYER,5,!0)},i.prototype.onBtnClose=function(){e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREN_SHAOP_UI)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.onBtnHelp=function(){},i}(e.ViewControler);e.ArenShopUI=t,__reflect(t.prototype,"foxgame.ArenShopUI")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e._pos=0,e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(i,t),i.prototype.addToStage=function(){this.imgChallenge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toChallenge,this)},i.prototype.setInfo=function(t){this.nameLabel.text=t.getName(),this.fightLabel.text=e.LanguageUtils.instance.getValue("FIGHT")+" "+t.getFightValue(),this.rankNumLabel.text=t.getRank()+"",this.rankNum=t.getRank(),this.playid=t.getPlayerId();var i=e.PlayerService.instance.getRoleVO(t.getCfgItemId());i&&(this.headIcon.source=i.icon)},i.prototype.removeFromStage=function(){this.imgChallenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.toChallenge,this)},i.prototype.toChallenge=function(){e.NewArenaControler.Ins.toChallengePlayer(this.rankNum,this.playid),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"ChallengeItem",tag:"toChallenge",battleType:e.BattleType.BATTLE_PVP_ARENA})},i.prototype.setPosition=function(e){this._pos=e},i}(eui.Component);e.ChallengeItem=t,__reflect(t.prototype,"foxgame.ChallengeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.addList()}return Object.defineProperty(t,"Ins",{get:function(){return null==this.ins&&(this.ins=new t),this.ins},enumerable:!0,configurable:!0}),t.prototype.addList=function(){e.Message.instance.add(e.Code.ARENA_DEFENDER_LIST_SYNC_S,this),e.Message.instance.add(e.Code.REPLACE_DEFENDER_LIST_S,this),e.Message.instance.add(e.Code.BUY_CHALLENGE_TIMES_S,this),e.Message.instance.add(e.Code.ARENA_RANKING_LIST_S,this),e.Message.instance.add(e.Code.ARENA_RECORD_S,this),e.Message.instance.add(e.Code.ARENA_SHOP_BUYITEM_S,this),e.Message.instance.add(e.Code.CHALLENGE_DEFENDER_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ARENA_DEFENDER_LIST_SYNC_S:App.LittleLoading().hideLoading("NewArenaControler"),this.handlAllAreaData(i);break;case e.Code.REPLACE_DEFENDER_LIST_S:e.Message.instance.send(e.MsgCMD.NEW_AREN_UI_REFRESH_DEFENDER,i);break;case e.Code.BUY_CHALLENGE_TIMES_S:this.handBuyCountData(i);break;case e.Code.ARENA_RANKING_LIST_S:i.setRankInfo(i.getRankInfo().splice(0,3)),e.Message.instance.send(e.MsgCMD.NEW_AREN_RANK_UI_REFRESH,i),e.ArenaModel.Ins.initArenRankData(i);break;case e.Code.ARENA_RECORD_S:e.ArenaModel.Ins.initAreanLogList(i);break;case e.Code.ARENA_SHOP_BUYITEM_S:var n=i;e.ArenaModel.Ins.curPointCount=n.getArenaPoint(),e.Message.instance.send(e.MsgCMD.NEW_AREN_REFRESH_POINT);break;case e.Code.CHALLENGE_DEFENDER_S:var o=i;0==o.getErrorNo()?(e.PopUpManager.instance.hasPopUp(e.WindowName.NEW_AREA_UI)&&(e.MainControler.instance.setbtnmask(!1),e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREA_UI)),e.MainControler.instance.EnterFight(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JINGJICHANGTIAOZHANKAISHI"))):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WANJIAMEICIBIANHUA"))}},t.prototype.requestAreaData=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPArenaDefenderList");t.setPlayerId(e.PlayerService.instance.playerInfo.getPlayerId()),e.Message.instance.send(e.Code.ARENA_DEFENDER_LIST_C,t,!0)},t.prototype.ReplaceDefenders=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPReplaceDefenderList");t.setPlayerId(e.PlayerService.instance.playerInfo.getPlayerId()),e.Message.instance.send(e.Code.REPLACE_DEFENDER_LIST_C,t,!0)},t.prototype.toChallengePlayer=function(t,i){if(e.ArenaModel.Ins.surplusChallengeTimes<=0)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JINRIJINGJICHANGTIAOZHANCISHUBUZU"));if(e.ArenaModel.Ins.protectsurpTimes>0)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JINGJICHANGLENGQUEZHONG"));var n=HawkProtocolManager.newBuilder("JsProto.HPChallengeDefender");n.setDefendeRank(t),n.setDefenderId(i),e.Message.instance.send(e.Code.CHALLENGE_DEFENDER_C,n,!0),e.Message.instance.send(e.MsgCMD.NEW_AREN_BEGIN_PROTECT_5S)},t.prototype.BuyCount=function(){e.ArenaModel.Ins.alreadyBuyTimes>=e.ArenaModel.Ins.MaxBuyTimes?e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JINRIGOUMAICISHUYIMAN")):e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("XIAOHAOYUANBAOGOUMAITIAOZHANCISHU",e.ArenaModel.Ins.nextBuyPrice),this,this.tobuyCount)},t.prototype.tobuyCount=function(){if(e.PlayerService.instance.playerInfo.getGold()<e.ArenaModel.Ins.nextBuyPrice)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var t=HawkProtocolManager.newBuilder("JsProto.HPBuyChallengeTimes");t.setTimes(1),e.Message.instance.send(e.Code.BUY_CHALLENGE_TIMES_C,t,!0)},t.prototype.requestAreaRankData=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPArenaRankingList");e.Message.instance.send(e.Code.ARENA_RANKING_LIST_C,t,!0)},t.prototype.requestAreaLog=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPArenaRecordList");e.Message.instance.send(e.Code.ARENA_RECORD_C,t,!0)},t.prototype.buyArenShopItem=function(t,i){if(i>e.ArenaModel.Ins.curPointCount)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JINGJICHANGJIFENBUZU"));var n=HawkProtocolManager.newBuilder("JsProto.HPBuyArenaShopItemById");n.setItemId(parseInt(t)),n.setCount(1),e.Message.instance.send(e.Code.ARENA_SHOP_BUYITEM_C,n,!0)},t.prototype.handlAllAreaData=function(t){var i=t.getSelf();e.ArenaModel.Ins.initselfData(i),e.Message.instance.send(e.MsgCMD.NEW_AREN_UI_REFRESH,t)},t.prototype.showRedPoint=function(){return e.ArenaModel.Ins.showRedPoint()},t.prototype.ChallengesNum=function(){return e.ArenaModel.Ins.ChallengesNum()||0},t.prototype.handBuyCountData=function(t){e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHOPBUYSUCCESS")),e.ArenaModel.Ins.nextBuyPrice=t.getNextBuyPrice(),e.ArenaModel.Ins.alreadyBuyTimes=t.getAlreadyBuyTimes(),e.ArenaModel.Ins.surplusChallengeTimes=t.getSurplusChallengeTimes(),e.Message.instance.send(e.MsgCMD.NEW_AREN_UI_REFRESH_SULPCOUNT)},t.prototype.getRewardStrByRank=function(t){for(var i=e.JsonDataManager.instance.aren_RankAwardTemplate,n=i.length,o="",a=0;n>a;a++){var s=parseInt(i[a].minRank);if(s>=t){o=i[a].awardStr;break}}if(""==o)return{coinCount:0,pointCount:0};var r=o.split(","),l=parseInt(r[0].split("_")[2]),h=parseInt(r[1].split("_")[2]);return{coinCount:l,pointCount:h}},t.prototype.getArenLogString=function(t){var i=new Date(1e3*t.getTimeStamp()),n=i.getMonth()+1+e.LanguageUtils.instance.getValue("YUE"),o=i.getDate()+e.LanguageUtils.instance.getValue("RI"),a=i.getHours()+":",s=i.getMinutes(),r=n+o+a+s,l='<font color="0x4BF707" >'+t.getTargetName()+"</font>",h="",c="",u=e.LanguageUtils.instance.getValue("YOUWINLE")+",",p=e.LanguageUtils.instance.getValue("PAIMINGBUBIAN");t.getIsOffences()?(h=e.LanguageUtils.instance.getValue("YOU"),c=l,t.getIsWin()?t.getIsRankUp()&&(p=e.LanguageUtils.instance.getValue("PAIMINGSHANGSHENG",t.getCurrentRank())):u=e.LanguageUtils.instance.getValue("YOULOSELE")+","):(h=l,c=e.LanguageUtils.instance.getValue("YOU"),0==t.getIsWin()&&(u=e.LanguageUtils.instance.getValue("YOULOSELE")+",",0==t.getIsRankUp()&&(p=e.LanguageUtils.instance.getValue("PAIMINGXIAJIANG",t.getCurrentRank()))));var g=h+e.LanguageUtils.instance.getValue("XIANG")+c+e.LanguageUtils.instance.getValue("FADONGGONGJI")+","+u+p;return{time:r,content:g}},t.ins=null,t}();e.NewArenaControler=t,__reflect(t.prototype,"foxgame.NewArenaControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e}return __extends(i,t),i.prototype.addToStage=function(){e.Message.instance.add(e.Code.SEE_OTHER_PLAYER_INFO_S,this)},i.prototype.removeFromStage=function(){e.Message.instance.remove(e.Code.SEE_OTHER_PLAYER_INFO_S,this)},i.prototype.setInfo=function(t){var i=t.getRank();i==e.Rank.first?this.rankNumImg.source="arena_diyiming_png":i==e.Rank.second?this.rankNumImg.source="arena_dierming_png":this.rankNumImg.source="arena_disanming_png",this.fightLabel.text=t.getFightValue()+"",this.nameLabel.text=t.getName(),this.curPlayId=t.getPlayerId();var n=HawkProtocolManager.newBuilder("JsProto.HPSeeOtherPlayerInfo");n.setPlayerId(this.curPlayId),e.Message.instance.send(e.Code.SEE_OTHER_PLAYER_INFO_C,n,!0)},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.SEE_OTHER_PLAYER_INFO_S:var n=i;if(n.getPlayerInfo().getPlayerId()==this.curPlayId)for(var o=n.getPlayerInfo().getRoles(),a=o.length,s=0;a>s;s++)if(o[s].getType()==e.RoleType.MAIN_ROLE){var r=new e.RoleData;r.setRoleInfo(o[s]),e.CharacterController.getInstance().showcharavatar(this.avatar,r);break}}},i.prototype.getPlayerId=function(){return this.curPlayId},i.prototype.getAvatar=function(){return this.avatar},i}(eui.Component);e.RankAvatarItem=t,__reflect(t.prototype,"foxgame.RankAvatarItem",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.updateRecordInfo()},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.headBtn.setButtonSkin("u_Icobg01","u_Icobg08"),this.seeBtn.setButtonSkin("b_Red","b_Red_Down"),this.seeBtn.setLabel(e.LanguageUtils.instance.getValue("CHAKAN"),!0,22)},i.prototype.clear=function(){this.removeListener()},i.prototype.init=function(){},i.prototype.updateRecordInfo=function(){},i.prototype.addListener=function(){this.headBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.headBtnHandler,this),this.seeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.seeBtnHandler,this)},i.prototype.removeListener=function(){this.headBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.headBtnHandler,this),this.seeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.seeBtnHandler,this)},i.prototype.headBtnHandler=function(e){},i.prototype.seeBtnHandler=function(e){},i}(eui.ItemRenderer);e.ArenaRecordItemRenderer=t,__reflect(t.prototype,"foxgame.ArenaRecordItemRenderer")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this._isInit=!1},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.updateRankItemInfo()},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.rankTextLabel.text=e.LanguageUtils.instance.getValue("RANK")+":",this.powerTextLabel.text=e.LanguageUtils.instance.getValue("FIGHT")+":",this._isInit=!0,this.updateRankItemInfo()},i.prototype.updateRankItemInfo=function(){if(this._isInit){var t,i,n=this.data,o="";if(n){if(1==n.getIdentityType()){i=e.JsonDataManager.instance.monster[n.getCfgItemId()];var a=i.icon.split("/"),s=a[1].split(".");this.headAsset.source=s[0]}else 2==n.getIdentityType()&&(t=e.PlayerService.instance.getRoleVO(n.getCfgItemId()),this.headAsset.source=t.icon);this.LEVELINFO1.text="Lv"+n.getLevel().toString(),this.challengeNameInfo.text=o,this.rankInfo.text=n.getRank().toString(),this.powerInfo.text=n.getFightValue().toString(),this.signatureLabel.text=n.getSignature(),this.updateRankInfo(),1==n.getProf()?this.proicon.source="u_IcoWarrior":2==n.getProf()?this.proicon.source="u_IcoHunter":3==n.getProf()&&(this.proicon.source="u_IcoMaster"),this.addListener()}else this.rankIcon.source=null,this.rankBoard0.source=null,this.rankBoard1.source=null,this.rankBoard2.source=null,this.rankBoard3.source=null,this.removeListener()}},i.prototype.updateRankInfo=function(){var e=this.data,t="";1==e.getRank()?(this.rankIcon.source="u_Trophy01",t="",this.rankIcon.anchorOffsetX=50,this.rankIcon.anchorOffsetY=52,this.rankIcon.x=475,this.rankIcon.y=65):2==e.getRank()?(this.rankIcon.source="u_Trophy02",t="",this.rankIcon.anchorOffsetX=45,this.rankIcon.anchorOffsetY=40,this.rankIcon.x=475,this.rankIcon.y=70):3==e.getRank()?(this.rankIcon.source="u_Trophy03",t="",this.rankIcon.anchorOffsetX=45,this.rankIcon.anchorOffsetY=36,this.rankIcon.x=475,this.rankIcon.y=70):(this.rankIcon.source=null,t=null),this.rankBoard0.source=t,this.rankBoard1.source=t,this.rankBoard2.source=t,this.rankBoard3.source=t},i.prototype.addListener=function(){this.headBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.headBtnHandler,this),this.BG.addEventListener(egret.TouchEvent.TOUCH_TAP,this.headBtnHandler,this)},i.prototype.removeListener=function(){this.headBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.headBtnHandler,this),this.BG.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.headBtnHandler,this)},i.prototype.headBtnHandler=function(t){var i=this.data;if(1==i.getIdentityType()){var n=e.LanguageUtils.instance.getValue("CheckNPCErro");e.PopUpController.getInstance().showFloatTextPanel1(n)}else 2==i.getIdentityType()},i.prototype.buyCountAlertCallBack=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPBuyChallengeTimes");e.Message.instance.send(e.Code.BUY_CHALLENGE_TIMES_C,t,!0)},i}(eui.ItemRenderer);e.ChallengerRankItemRenderer=t,__reflect(t.prototype,"foxgame.ChallengerRankItemRenderer")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.WHITE=1]="WHITE",e[e.GREEN=2]="GREEN",e[e.BLUE=3]="BLUE",e[e.PURPLE=4]="PURPLE",e[e.ORANGE=5]="ORANGE",e[e.RED=6]="RED"}(t=e.EquipQuality||(e.EquipQuality={}));var i;!function(e){e[e.WEAPON=1]="WEAPON",e[e.CLOTHES=2]="CLOTHES",e[e.BRACELET1=3]="BRACELET1",e[e.FINGERRING1=4]="FINGERRING1",e[e.BELT=5]="BELT",e[e.HELMET=6]="HELMET",e[e.NECKLACE=7]="NECKLACE",e[e.BRACELET2=8]="BRACELET2",e[e.FINGERRING2=9]="FINGERRING2",e[e.SHOES=10]="SHOES",e[e.SUIT_1=11]="SUIT_1",e[e.SUIT_2=12]="SUIT_2",e[e.SUIT_3=13]="SUIT_3",e[e.SUIT_4=14]="SUIT_4",e[e.GOD_1=15]="GOD_1",e[e.GOD_2=16]="GOD_2",e[e.GOD_3=17]="GOD_3",e[e.WING=18]="WING",e[e.MOUNT=19]="MOUNT"}(i=e.EquipPartType||(e.EquipPartType={}));var n;!function(e){e[e.NORMAL=0]="NORMAL",e[e.EQUIP=1]="EQUIP",e[e.SPECIALRING=2]="SPECIALRING",e[e.TREASUREBOX1=4]="TREASUREBOX1",e[e.TREASUREBOX2=7]="TREASUREBOX2",e[e.TREASUREBOX3=12]="TREASUREBOX3",e[e.CURRENCY=23]="CURRENCY",e[e.JINGYANDAN=24]="JINGYANDAN",e[e.SOUL=50]="SOUL",e[e.DRAGONBONE=51]="DRAGONBONE",e[e.SKILLSTONE=52]="SKILLSTONE",e[e.DRAGONARMOR=53]="DRAGONARMOR",e[e.DEMONKEE=54]="DEMONKEE",e[e.UNIONSIEGE=55]="UNIONSIEGE",e[e.JADERUYI=56]="JADERUYI",e[e.LIMITBOX=57]="LIMITBOX",e[e.HONGBAO=58]="HONGBAO"}(n=e.ItemType||(e.ItemType={}));var o;!function(e){e[e.ALL_EQUIP_INTENSIFY_1=1]="ALL_EQUIP_INTENSIFY_1",e[e.ALL_EQUIP_INTENSIFY_2=2]="ALL_EQUIP_INTENSIFY_2",e[e.ALL_EQUIP_INTENSIFY_3=3]="ALL_EQUIP_INTENSIFY_3"}(o=e.attrCond||(e.attrCond={}));var a;!function(e){e[e.PRIMARY_ATTR=1]="PRIMARY_ATTR",e[e.SECONDARY_ATTR=2]="SECONDARY_ATTR",e[e.GODLY_ATTR=3]="GODLY_ATTR"}(a=e.equipAttrGrade||(e.equipAttrGrade={}));var s=function(){function o(){this.len=0,this.len1=0,this.model=new e.BagModel,this.panel=new e.BagPanel(this.model)}return o.getInstance=function(){return null==this._instance&&(this._instance=new o),this._instance},o.prototype.registerMsg=function(t){t.add(e.Code.ITEM_INFO_SYNC_S,this),t.add(e.Code.EQUIP_INFO_SYNC_S,this),t.add(e.Code.PLAYER_CONSUME_S,this),t.add(e.Code.EQUIP_DRESS_S,this),t.add(e.Code.EQUIP_DRESS_ONE_KEY_S,this),t.add(e.Code.EQUIP_LOCK_S,this),t.add(e.Code.DRAGON_INFO_SYNC_S,this),t.add(e.Code.DRAGON_BONE_UPDATE_S,this),t.add(e.Code.DRAGON_BONE_DELETE_S,this),t.add(e.Code.DRAGON_BONE_LOCK_S,this),t.add(e.MsgCMD.Login_Success_Msg,this),t.add(e.Code.DRAGON_ARMOUR_BAG_INFO_S,this),t.add(e.Code.DRAGON_ARMOUR_ADD_S,this),t.add(e.Code.DRAGON_ARMOUR_LOCK_S,this),t.add(e.Code.DEMON_KEE_EQUIP_INFO_S,this),t.add(e.Code.DEMON_KEE_EQUIP_UPDATE_S,this),t.add(e.Code.DEMON_KEE_LOCK_S,this),t.add(e.Code.RED_RECHARGE_ITEM_S,this)},o.prototype.recvMsg=function(t,i){switch(t){case e.Code.ITEM_INFO_SYNC_S:this.len++;var n=i;if(0==n.getItemInfos().length)return;this.model.setItems(i),e.MainBottomControler.instance.refreshCharacterIconOperate(),e.MainBottomControler.instance.refreshWeaponIconOperate(),e.MainBottomControler.instance.refreshWingRedTip();break;case e.Code.EQUIP_INFO_SYNC_S:this.len1++,this.model.setEquips(i);break;case e.Code.PLAYER_CONSUME_S:this.model.deleteItemOrEquip(i);break;case e.Code.EQUIP_DRESS_S:this.model.equipDressOrOff(i);break;case e.Code.EQUIP_DRESS_ONE_KEY_S:this.model.quickEquipBack(i);break;case e.Code.EQUIP_LOCK_S:this.model.lockBack(i);break;case e.Code.DRAGON_INFO_SYNC_S:this.model.setDragonInfos(i);break;case e.Code.DRAGON_BONE_UPDATE_S:this.model.updateDragoneInfos(i);break;case e.Code.DRAGON_BONE_DELETE_S:this.model.deleteDragonInfos(i);break;case e.Code.DRAGON_BONE_LOCK_S:this.model.setDragonLockStatus(i);break;case e.MsgCMD.Login_Success_Msg:this.model.busyCount=0;break;case e.Code.DRAGON_ARMOUR_BAG_INFO_S:this.model.setDragonArmorInfos(i);break;case e.Code.DRAGON_ARMOUR_ADD_S:this.model.updataDragonArmorInfos(i);break;case e.Code.DEMON_KEE_EQUIP_INFO_S:this.model.setKeeEquipInfos(i);break;case e.Code.DEMON_KEE_EQUIP_UPDATE_S:this.model.updatakeeequipInfos(i);break;case e.Code.DRAGON_ARMOUR_LOCK_S:this.model.setDragonArmorLockStatus(i);break;case e.Code.DEMON_KEE_LOCK_S:this.model.setDemonkeeLockStatus(i);break;case e.Code.RED_RECHARGE_ITEM_S:var o=i;0==o.getErrorNo()&&console.log("红包使用成功")}},o.prototype.checkEquipStatus=function(e){return null!=this.model.equipedDic[e]},o.prototype.checkBagEnough=function(t,i,n,o){void 0===n&&(n=null),void 0===o&&(o=1);var a=1;if(1==o&&(a=Number(e.GlobalConfig.instance.getValue("NEEDBAGMINCOUNT"))),this.getFreeCellCount()<a){var s=e.LanguageUtils.instance.getValue("BAGNOTENOUGH");e.PopUpController.getInstance().showTextPanel(s,this,this.rongLianFun)}else i.call(t,n)},o.prototype.rongLianFun=function(){e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT)},o.prototype.getBusyCellCount=function(){return this.model.busyCount},o.prototype.getFreeCellCount=function(){var t=e.JsonDataManager.instance.vipTemplate[e.PlayerService.instance.vipLevel];if(void 0==t)return void e.GameUtils.MSG_TIP("VIP等级异常,请联系客服"+e.PlayerService.instance.vipLevel);var i=t.bagContainers,n=this.getBusyCellCount();return i-n},o.prototype.checkBagMinCellCount=function(){var t=Number(e.GlobalConfig.instance.getValue("NEEDBAGMINCOUNT"));return this.getFreeCellCount()>=t},o.prototype.showPanel=function(){this.panel.show()},o.prototype.getItemInfoById=function(e){var t=this.model.itemDic[e];return null==t?null:t.itemInfo},o.prototype.getItemInfoByItemId=function(e){var t=this.model.itemDicByItemId,i=t[e];return i?i.itemInfo:null},o.prototype.getBagItemDataByItemId=function(e){var t=this.model.itemDicByItemId;return t[e]},o.prototype.getCountByItemId=function(e){var t=this.getItemInfoByItemId(e);return t?t.getCount():0},o.prototype.getEquipInfoById=function(e){var t=this.model.equipDic[e];return null==t&&(t=this.model.equipedDic[e]),null!=t?t.equipInfo:null},o.prototype.getDragonBoneById=function(e){var t=this.model.dragonBoneDic[e];return null==t?null:t.dragonBoneInfo},o.prototype.getBeautyEquipById=function(e){var t=this.model.keeequipDic[e];return null==t?null:t.keeequipInfo},o.prototype.getEnableBeautyEquipByPart=function(e){for(var t,i=this.model.keeequipByPartDic[e],n=i.length,o=[],a=0;n>a;a++)t=i[a],1!=t.getIsEquiped()&&o.push(t.keeequipInfo);return o},o.prototype.getEnableBeautyMaxEquipByPart=function(t){for(var i,n,o=this.model.keeequipByPartDic[t],a=o.length,s=[],r=0;a>r;r++)i=o[r],1==i.getIsEquiped()?n=i.keeequipInfo:s.push(i.keeequipInfo);if(null==s)return null;if(null==n)return s[0];for(var l=void 0,h=0;h<s.length;h++)return l=s[h],e.BeautyController.getInstance().getbeautyEquipScore(l)>e.BeautyController.getInstance().getbeautyEquipScore(n)?l:null},o.prototype.getEnableBeautyEquip=function(){var e,t=this.model.keeequipDic,i=[];for(var n in t)e=t[n],1==e.getIsEquiped()&&i.push(e.keeequipInfo);return i},o.prototype.getEquipInfosByPart=function(e){for(var t,i=this.model.equipByPart[e],n=[],o=i.length,a=0;o>a;a++)t=i[a],n.push(t.equipInfo);return n.sort(this.sortEquipByScore),n},o.prototype.sortEquipByScore=function(e,t){return e.getScore()>t.getScore()?-1:e.getScore()<t.getScore()?1:0},o.prototype.getEquipInfosByProfAndPart=function(t,i){var n=this.model.equipByProAndPart[t+"_"+i];n=n.concat(this.model.equipByProAndPart["0_"+i]);for(var o,a=[],s=n.length,r=e.PlayerService.instance.playerInfo.getLevel(),l=0;s>l;l++)o=n[l],o.equipVO.level>r||a.push(o.equipInfo);return a.sort(this.sortEquipByScore),a},o.prototype.getEnableSoulVOList=function(t){var i,o,a=e.JsonDataManager.instance.soulTemplate,s=[],r=this.model.itemDic;for(var l in r)i=r[l],i.itemVO.type==n.SOUL&&(o=a[i.itemVO.id],o.type==e.SoulType.CANHUN||o.type==e.SoulType.EXPSOUL||o.profession!=t&&o.profession!=e.ProfessionType.PROFESSION0||s.push(o));return s.sort(this.sortSoulVO),s},o.prototype.sortSoulVO=function(e,t){return e.score>t.score?-1:e.score<t.score?1:0},o.prototype.getSoulVOList=function(){var t,i,o=e.JsonDataManager.instance.soulTemplate,a=[],s=this.model.itemDic;for(var r in s)t=s[r],t.itemVO.type==n.SOUL&&(i=o[t.itemVO.id],a.push(i));return a},o.prototype.getBestFreeEquipInfosByProfession=function(t){for(var n,o,a,s,r=e.PlayerService.instance.getRoleDataByRoleId(t),l=[i.WEAPON,i.CLOTHES,i.BRACELET1,i.FINGERRING1,i.BELT,i.HELMET,i.NECKLACE,i.BRACELET2,i.FINGERRING2,i.SHOES,i.SUIT_1,i.SUIT_2,i.SUIT_3,i.SUIT_4],h=[],c=l.length,u=(e.PlayerService.instance.level,0);c>u;u++){n=l[u];for(var p=this.getEquipInfosByProfAndPart(r.profession,n),g=0;g<h.length;g++)a=h[g],s=p.indexOf(a),-1!=s&&p.splice(s,1);a=p[0],o=r.getEquipInfoByPart(n),null==o||null!=a&&null!=o&&a.getScore()>o.getScore()?h[u]=a:h[u]=null}return h},o.prototype.getAllFreeEquipInfos=function(){var e=[],t=this.model.equipDic;for(var i in t)e.push(t[i]);return e},o.prototype.registerObserver=function(e){this.model.registerObserver(e)},o.prototype.getModel=function(){return this.model},o.prototype.getTotalRedEquipCount=function(){var e,i=this.model.equipDic,n=0;for(var o in i)e=i[o],e.itemVO.quality==t.RED&&n++;i=this.model.equipedDic;for(var o in i)e=i[o],e.itemVO.quality==t.RED&&n++;return n},o.prototype.getPhagocytosisDragonBone=function(t){var i,n=e.JsonDataManager.instance.dragonEssenceTemplate,a=o.getInstance(),s=[];for(var r in n)i=a.getBagItemDataByItemId(Number(r)),null!=i&&s.push(i);for(var l,h,c,u,p=s.concat(),g=[],d=0;d<p.length;d++)if(l=p[d],c=Math.ceil(l.itemInfo.getCount()/100),u=l.itemInfo.getCount()%100,c>1)for(var f=0;c>f;f++)h=new e.BagItemData(l.itemInfo,1),h.count=100,u>0&&f==c-1&&(h.count=u),g.push(h);else l.count=l.itemInfo.getCount(),g.push(l);for(var m,y,I=[],v=[e.DragonBonePartType.PART1,e.DragonBonePartType.PART2,e.DragonBonePartType.PART3,e.DragonBonePartType.PART4,e.DragonBonePartType.PART5],_=v.length,T=0;_>T;T++){y=this.model.dragonBoneByPartDic[v[T]];var C=t?3:0;for(C;C<y.length;C++)i=y[C],m=i.dragonBoneInfo,0==m.getLock()&&0==m.getState()&&I.push(i)}return I.sort(this.sortDragonEquipAsscend),g.concat(I)},o.prototype.sortDragonEquipAsscend=function(t,i){var n=e.DragonboneController.getInstance(),o=n.getDragonEquipScore(t.dragonBoneInfo),a=n.getDragonEquipScore(i.dragonBoneInfo);return o>a?1:a>o?-1:0},o.prototype.getEnableDragonboneByPartAndId=function(e){var t=this.model.dragonBoneDic[e];return t.dragonBoneInfo},o.prototype.getEnableDragonboneByPart=function(e){for(var t,i=this.model.dragonBoneByPartDic[e],n=i.length,o=[],a=0;n>a;a++)t=i[a],1!=t.getIsEquiped()&&o.push(t.dragonBoneInfo);return o},o.prototype.getDragonArmorById=function(e){var t=this.model.dragonArmorDic[e];return null==t?null:t.dragonArmorInfo},o.prototype.setDragonArmorById=function(e){var t=this.model.dragonArmorDic[e.getArmourId()];t.dragonArmorInfo=e},o.prototype.getEnableEngrave=function(){for(var t=[e.DAPartType.Part_1,e.DAPartType.Part_2,e.DAPartType.Part_3,e.DAPartType.Part_4,e.DAPartType.Part_5,e.DAPartType.Part_6,e.DAPartType.Part_7,e.DAPartType.Part_8],i=t.length,n=[],o=0;i>o;o++){for(var a=this.model.dragonArmorByPartDic[t[o]],s=0;s<a.length;s++)n.concat(a[s].dragonArmorInfo);
n.sort(this.sortDAEquipByScore)}return n},o.prototype.sortDAEquipByScore=function(t,i){var n=e.DragonArmorController.getInstance(),o=n.getDragonEquipScore(t),a=n.getDragonEquipScore(i);return o>a?-1:a>o?1:0},o.prototype.getEnableDAByPart=function(e){for(var t,i=this.model.dragonArmorByPartDic[e],n=i.length,o=[],a=0;n>a;a++)t=i[a],1!=t.getIsEquiped()&&o.push(t.dragonArmorInfo);return o},o.prototype.getArmor=function(){for(var t=[e.DAPartType.Part_1,e.DAPartType.Part_2,e.DAPartType.Part_3,e.DAPartType.Part_4,e.DAPartType.Part_5,e.DAPartType.Part_6,e.DAPartType.Part_7,e.DAPartType.Part_8],i=[],n=0;n<t.length;n++)i=i.concat(this.model.dragonArmorByPartDic[t[n]]);for(var o,a=i.length,s=[],n=0;a>n;n++)o=i[n],1!=o.getIsEquiped()&&s.push(o.dragonArmorInfo);return s},o.prototype.getSkillStoneList=function(){var t,i,o=e.JsonDataManager.instance.dragonArmorSkillStoneTemplate,a=[],s=this.model.itemDic;for(var r in s)t=s[r],t.itemVO.type==n.SKILLSTONE&&(i=o[t.itemVO.id],a.push(i));return a},o.prototype.wearDragonArmor=function(){this.model.wearDragonArmor()},o.prototype.getPanelIsShow=function(){return this.panel?this.panel.getIsShow():!1},o.prototype.closePanel=function(){this.panel&&this.panel.close()},o.prototype.getEquipInfoByEquipId=function(e){for(var t in this.model.equipDic){var i=this.model.equipDic[t];if(i.equipInfo.getEquipId()==e)return i}return null},o.prototype.getAllAlchemyItem=function(){var t=[],i=1;e.JsonDataManager.instance.itemTemplate;for(var n in this.model.equipDic){var o=this.model.equipDic[n];0==o.equipInfo.getLockPeriod()&&o.itemVO.isRecovery==i&&t.push(new r(e.AttributeType.EQUIP,o.equipVO.id,o.equipInfo.getId(),1))}for(var n in this.model.itemDic){var a=this.model.itemDic[n];a.itemVO.isRecovery==i&&t.push(new r(e.AttributeType.ITEM,a.itemVO.id,a.itemInfo.getId(),a.itemInfo.getCount()))}for(var n in this.model.dragonBoneDic){var a=this.model.dragonBoneDic[n];a.itemVO.isRecovery!=i||a.dragonBoneInfo.getLock()||a.dragonBoneInfo.getState()||t.push(new r(e.AttributeType.LONGGU,a.itemVO.id,a.dragonBoneInfo.getId(),1))}for(var n in this.model.dragonArmorDic){var a=this.model.dragonArmorDic[n];a.itemVO.isRecovery!=i||a.dragonArmorInfo.getIsLock()||a.dragonArmorInfo.getIsDress()||t.push(new r(e.AttributeType.LONGJIA,a.itemVO.id,a.dragonArmorInfo.getArmourId(),1))}for(var n in this.model.keeequipDic){var a=this.model.keeequipDic[n];a.itemVO.isRecovery!=i||a.keeequipInfo.getLockState()||a.keeequipInfo.getState()||t.push(new r(e.AttributeType.YAOJI,a.itemVO.id,a.keeequipInfo.getId(),1))}return t},o}();e.BagController=s,__reflect(s.prototype,"foxgame.BagController",["foxgame.IMessage"]);var r=function(){function e(e,t,i,n){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===i&&(i=-1),void 0===n&&(n=-1),this.type=e,this.itemId=t,this.id=i,this.itemNumber=n}return e}();e.AlchemyVO=r,__reflect(r.prototype,"foxgame.AlchemyVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="BagItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isInit=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.refresh()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.isDataChanged=!0,this.refresh()},i.prototype.refresh=function(){if(this.isInit&&this.isDataChanged){var t=this.data,i=t.itemVO.type==e.ItemType.EQUIP||t.itemVO.type==e.ItemType.DRAGONBONE||t.itemVO.type==e.ItemType.DRAGONARMOR||t.itemVO.type==e.ItemType.DEMONKEE?1:t.itemInfo.getCount();if(this.icon.setItem(t.itemVO.id,i),t.itemVO.type==e.ItemType.EQUIP){if(void 0==t.equipInfo)return;this.icon.setQueneLevelProps(t.equipInfo.getId())}else this.icon.clearQuenLevelProps();return t.itemVO.type!=e.ItemType.EQUIP&&t.itemVO.type!=e.ItemType.DRAGONBONE&&t.itemVO.type!=e.ItemType.DRAGONARMOR&&t.itemVO.type!=e.ItemType.DEMONKEE?void(this.lockLabel.visible=!1):void(this.lockLabel.visible=t.getIsLocked())}},i.prototype.clickHandler=function(t){var i=this.data;if(i.itemVO.type==e.ItemType.EQUIP){var n=e.JsonDataManager.instance.equipTemplate[i.itemVO.id];e.TipsController.getInstance().showEquipTips({profession:n.profession,equipInfo:i.equipInfo,showReplace:!1})}else i.itemVO.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(i.itemVO.id):i.itemVO.type==e.ItemType.DRAGONBONE?e.TipsController.getInstance().showDragonBoneTips(i.dragonBoneInfo.getId()):i.itemVO.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.dragonArmorInfo.getArmourId()):i.itemVO.type==e.ItemType.SKILLSTONE?e.TipsController.getInstance().showDragonArmorSkillTips(i.itemVO.id):i.itemVO.type==e.ItemType.DEMONKEE?e.TipsController.getInstance().showDemonkeeTips(i.keeequipInfo.getId()):i.itemVO.type==e.ItemType.JADERUYI?e.JadeRuyiController.getInstance().showPanel(i.itemVO.id,i.itemInfo.getCount(),!0):i.itemVO.type==e.ItemType.LIMITBOX?e.TipsController.getInstance().showLimiBOxItemTips(i.itemInfo.getId(),i.itemVO.id,i.itemInfo.getCount(),!0):e.TipsController.getInstance().showItemTips(i.itemVO.id,i.itemInfo.getCount(),!0)},i.createNum=0,i.updateNum=0,i}(eui.ItemRenderer);e.BagItem=t,__reflect(t.prototype,"foxgame.BagItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(e,t){this.setData(e,t)}return t.prototype.setData=function(t,i){var n;switch(i){case 1:this.itemInfo=t,n=this.itemInfo.getItemId();break;case 2:this.equipInfo=t,n=this.equipInfo.getEquipId(),this.equipVO=e.JsonDataManager.instance.equipTemplate[n];break;case 3:this.dragonBoneInfo=t,n=this.dragonBoneInfo.getEquipId();break;case 4:this.dragonArmorInfo=t,n=this.dragonArmorInfo.getItemId();break;case 5:this.keeequipInfo=t,n=this.keeequipInfo.getItemId();break;default:throw new Error("knapsack data type error")}this.itemVO=e.JsonDataManager.instance.itemTemplate[n]},t.prototype.getIsEquiped=function(){return null!=this.equipInfo&&e.BagController.getInstance().checkEquipStatus(this.equipInfo.getId())?!0:null!=this.dragonBoneInfo&&1==this.dragonBoneInfo.getState()?!0:null!=this.dragonArmorInfo&&1==this.dragonArmorInfo.getIsDress()?!0:null!=this.keeequipInfo&&1==this.keeequipInfo.getState()?!0:!1},t.prototype.getIsLocked=function(){return null!=this.equipInfo?this.equipInfo.getLockPeriod()>0:null!=this.dragonBoneInfo?this.dragonBoneInfo.getLock():null!=this.dragonArmorInfo?this.dragonArmorInfo.getIsLock():!1},t}();e.BagItemData=t,__reflect(t.prototype,"foxgame.BagItemData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/bag/BagItemTipSkin.exml")||this;return e.setEffect(!1),e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e.isCallHideSceneObjectsWhenClose=!1,e}return __extends(i,t),i.prototype.initHook=function(){this.playerInfo=e.PlayerService.instance.playerInfo,this.ui.useBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.useAllBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showPanel=function(t,i,n){void 0===n&&(n=!1);var o=e.JsonDataManager.instance.itemTemplate;this.itemVO=o[t],this.itemCount=i,this.isShowBtn=n,this.show()},i.prototype.refresh=function(){var t=this.ui.nameLabel;t.text=this.itemVO.name,t.textColor=e.ColorUtils.instance.getColorByQuality(this.itemVO.quality),this.ui.lvLabel.text=this.itemVO.levelLimit.toString(),this.ui.icon.setItem(this.itemVO.id,this.itemCount,!1);var i=e.JsonDataManager.instance.soulTemplate[this.itemVO.id];i&&i.smeltAttrVO.type==e.AttributeType.SOUL?this.ui.desc.text=e.LanguageUtils.instance.getValue("SOULREFINEEXP",i.smeltAttrVO.value):this.ui.desc.textFlow=(new egret.HtmlTextParser).parse(this.itemVO.desc);var n=this.ui.partLabel;this.itemVO.type==e.ItemType.TREASUREBOX1||this.itemVO.type==e.ItemType.TREASUREBOX2||this.itemVO.type==e.ItemType.TREASUREBOX3?n.text=e.LanguageUtils.instance.getValue("BAOXIANG"):n.text=e.LanguageUtils.instance.getValue("XIAOHAOPIN");var o=this.ui.btnGroup;this.itemVO.type==e.ItemType.HONGBAO||this.itemVO.type==e.ItemType.TREASUREBOX1||this.itemVO.type==e.ItemType.TREASUREBOX2||this.itemVO.type==e.ItemType.TREASUREBOX3||this.itemVO.type==e.ItemType.CURRENCY||this.itemVO.type==e.ItemType.JINGYANDAN?o.visible=this.isShowBtn:o.visible=!1},i.prototype.onClick=function(t){switch(t.target){case this.ui.useBtn:if(this.itemVO.type==e.ItemType.HONGBAO){e.BagController.getInstance().checkBagEnough(this,this.useHongBao,1);break}this.itemVO.type==e.ItemType.CURRENCY?this.useItem(1):e.BagController.getInstance().checkBagEnough(this,this.useItem,1);break;case this.ui.useAllBtn:if(this.itemVO.type==e.ItemType.HONGBAO){e.BagController.getInstance().checkBagEnough(this,this.useHongBao,this.itemCount);break}this.itemVO.type==e.ItemType.CURRENCY?this.useItem(this.itemCount):e.BagController.getInstance().checkBagEnough(this,this.useItem,this.itemCount)}},i.prototype.useHongBao=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPRedRechargeItemReq");i.setCount(t),i.setTimeId(this.itemVO.id),e.Message.instance.send(e.Code.RED_RECHARGE_ITEM_C,i,!0),this.close()},i.prototype.useItem=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPItemUse");i.setItemId(this.itemVO.id),i.setItemCount(t),e.Message.instance.send(e.Code.ITEM_USE_C,i,!0),this.close()},i}(e.BasePanel);e.BagItemTip=t,__reflect(t.prototype,"foxgame.BagItemTip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.dataSource=[],this.collection=new eui.ArrayCollection,this.itemDic={},this.itemDicByItemId={},this.equipDic={},this.equipedDic={};var t=[e.ProfessionType.PROFESSION0,e.ProfessionType.PROFESSION1,e.ProfessionType.PROFESSION2,e.ProfessionType.PROFESSION3],i=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES,e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4,e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3];this.equipByPart={};for(var n=0;n<i.length;n++)this.equipByPart[i[n]]=[];this.equipByProfession={},this.equipByProAndPart={};for(var n=0;n<t.length;n++){this.equipByProfession[t[n]]=[];for(var o=0;o<i.length;o++)this.equipByProAndPart[t[n]+"_"+i[o]]=[]}this.busyCount=0,this.observerList=[],this.dragonBoneDic={},this.dragonBoneByPartDic={},this.dragonBoneByPartDic[e.DragonBonePartType.PART1]=[],this.dragonBoneByPartDic[e.DragonBonePartType.PART2]=[],this.dragonBoneByPartDic[e.DragonBonePartType.PART3]=[],this.dragonBoneByPartDic[e.DragonBonePartType.PART4]=[],this.dragonBoneByPartDic[e.DragonBonePartType.PART5]=[],this.keeequipDic={},this.dragonArmorByPartDic={},this.dragonArmorByPartDic[e.DAPartType.Part_1]=[],this.dragonArmorByPartDic[e.DAPartType.Part_2]=[],this.dragonArmorByPartDic[e.DAPartType.Part_3]=[],this.dragonArmorByPartDic[e.DAPartType.Part_4]=[],this.dragonArmorByPartDic[e.DAPartType.Part_5]=[],this.dragonArmorByPartDic[e.DAPartType.Part_6]=[],this.dragonArmorByPartDic[e.DAPartType.Part_7]=[],this.dragonArmorByPartDic[e.DAPartType.Part_8]=[],this.dragonArmorDic={},this.keeequipByPartDic={},this.keeequipByPartDic[e.KeePartType.PART1]=[],this.keeequipByPartDic[e.KeePartType.PART2]=[],this.keeequipByPartDic[e.KeePartType.PART3]=[],this.keeequipByPartDic[e.KeePartType.PART4]=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.setItems=function(t){for(var i,n=t.getItemInfos(),o=n.length,a=0;o>a;a++)if(i=n[a],0==i.getCount())delete this.itemDic[i.getId()],delete this.itemDicByItemId[i.getItemId()];else{var s=new e.BagItemData(i,1);this.itemDic[i.getId()]=s,this.itemDicByItemId[i.getItemId()]=s}this.updateView()},t.prototype.setEquips=function(t){for(var i,n,o,a,s=t.getUnDressedInfos(),r=s.length,l=0;r>l;l++)if(i=s[l],!this.equipDic[i.getId()]){n=new e.BagItemData(i,2),this.equipDic[i.getId()]=n,o=n.equipVO.partList;for(var h=0;h<o.length;h++)this.equipByPart[o[h]].push(n),this.equipByProAndPart[n.equipVO.profession+"_"+o[h]].push(n);this.equipByProfession[n.equipVO.profession].push(n),this.busyCount++,this.deleteDressedEquip(a)}var c=t.getEquipInfos();r=c.length;for(var l=0;r>l;l++)i=c[l],a=i.getId(),n=new e.BagItemData(i,2),this.equipedDic[a]=n,this.deleteFreeEquip(a,n.equipVO);this.updateView()},t.prototype.deleteFreeEquip=function(e,t){var i=this.equipDic[e];if(null!=i){delete this.equipDic[e];for(var n=t.partList,o=void 0,a=0;a<n.length;a++)o=this.equipByPart[n[a]].indexOf(i),this.equipByPart[n[a]].splice(o,1),o=this.equipByProAndPart[t.profession+"_"+n[a]].indexOf(i),this.equipByProAndPart[t.profession+"_"+n[a]].splice(o,1);o=this.equipByProfession[t.profession].indexOf(i),this.equipByProfession[t.profession].splice(o,1),this.busyCount--}},t.prototype.deleteDressedEquip=function(e){null!=this.equipedDic[e]&&delete this.equipedDic[e]},t.prototype.deleteItemOrEquip=function(e){if(0!=e.getConsumeItem().length){for(var t,i,n,o=e.getConsumeItem(),a=o.length,s=0;a>s;s++)t=o[s],n=t.getId(),23!=t.getType()?25!=t.getType()?9!=t.getType()||(i=this.equipDic[n],null==i)?(i=this.itemDic[n],null==i||(i.itemInfo.setCount(i.itemInfo.getCount()-t.getCount()),i.itemInfo.getCount()<=0&&(delete this.itemDic[n],delete this.itemDicByItemId[i.itemInfo.getItemId()]))):(this.deleteFreeEquip(n,i.equipVO),this.deleteDressedEquip(n)):(i=this.keeequipDic[n],null!=i&&this.delDemonKee(n,t.getItemId())):(i=this.dragonArmorDic[n],null!=i&&this.deleteDragonArmor(n,t.getItemId()));this.updateView()}},t.prototype.quickEquipBack=function(e){for(var t,i=e.getEquips(),n=i.length,o=0;n>o;o++)t=i[o],this.equipDressOrOff(t,!1);this.updateView()},t.prototype.lockBack=function(e){var t=this.equipDic[e.getEquipId()];null==t&&(t=this.equipedDic[e.getEquipId()]),t.equipInfo.setLockPeriod(e.getLockType()),this.updateView()},t.prototype.equipDressOrOff=function(e,t){void 0===t&&(t=!0),this.updateView()},t.prototype.updateView=function(){for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.bagItemChanged();e.MainBottomControler.instance.checkBagStatus(),e.Message.instance.send(e.MsgCMD.UPDATE_EQUIPINFO)},t.prototype.getAllTabData=function(){var e=[];egret.getTimer();e=e.concat(this.getItemTabData(!1)),e=e.concat(this.getEquipTabData(!1)),e=this.sortTabData(e);egret.getTimer();return e},t.prototype.getEquipTabData=function(e){void 0===e&&(e=!0);var t,i=[];for(var n in this.dragonBoneDic)t=this.dragonBoneDic[n],0==t.getIsEquiped()&&i.push(t);for(var n in this.dragonArmorDic)t=this.dragonArmorDic[n],0==t.getIsEquiped()&&i.push(t);for(var n in this.equipDic)i.push(this.equipDic[n]);for(var n in this.keeequipDic)t=this.keeequipDic[n],0==t.getIsEquiped()&&i.push(t);return e&&(i=this.sortTabData(i)),i},t.prototype.getItemTabData=function(e){void 0===e&&(e=!0);var t=[],i=this.itemDic;for(var n in i)t.push(i[n]);return e&&(t=this.sortTabData(t)),t},t.prototype.getBoxTabData=function(){var t,i=[],n=this.itemDic;for(var o in n)t=n[o],(t.itemVO.type==e.ItemType.TREASUREBOX1||t.itemVO.type==e.ItemType.TREASUREBOX2||t.itemVO.type==e.ItemType.TREASUREBOX3||t.itemVO.type==e.ItemType.CURRENCY||t.itemVO.type==e.ItemType.JINGYANDAN||t.itemVO.type==e.ItemType.JADERUYI)&&i.push(t);return i=this.sortTabData(i)},t.prototype.getEnableBox=function(){for(var t,i=this.getBoxTabData(),n=i.length,o=e.PlayerService.instance.level,a=0;n>a;a++)if(t=i[a],!(t.itemVO.levelLimit>o))return!0;return!1},t.prototype.sortTabData=function(t){for(var i,n,o,a=t.length,s=[],r=[],l=[],h=[],c=[],u=[],p=[],g=[],d=e.JsonDataManager.instance.equipTemplate,f=a-1;f>=0;f--)i=t[f],n=i.itemVO,n.type==e.ItemType.EQUIP?(o=d[n.id],o.checkPartMatch([e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3])?h.push(i):o.checkPartMatch([e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4])?c.push(i):u.push(i)):n.type==e.ItemType.TREASUREBOX1||n.type==e.ItemType.TREASUREBOX2||n.type==e.ItemType.TREASUREBOX3||n.type==e.ItemType.CURRENCY||n.type==e.ItemType.JINGYANDAN?p.push(i):n.type==e.ItemType.DRAGONBONE?s.push(i):n.type==e.ItemType.DRAGONARMOR?r.push(i):n.type==e.ItemType.DEMONKEE?l.push(i):g.push(i),t.splice(f,1);return r.sort(this.sortArmorScore),s.sort(this.sortDragonByPartAndLevelAccend),h.sort(this.sortEquip),c.sort(this.sortEquip),u.sort(this.sortEquip),p.sort(this.sortItem),g.sort(this.sortItem),l.sort(this.sortKeeEquipByScoreDescend),t=t.concat(r),t=t.concat(s),t=t.concat(h),t=t.concat(l),t=t.concat(c),t=t.concat(u),t=t.concat(p),t=t.concat(g)},t.prototype.sortArmorScore=function(t,i){var n=t.dragonArmorInfo,o=i.dragonArmorInfo,a=e.DragonArmorController.getInstance().getDragonEquipScore(n),s=e.DragonArmorController.getInstance().getDragonEquipScore(o);return a>s?-1:s>a?1:0},t.prototype.sortDragonByPartAndLevelAccend=function(t,i){if(!t.dragonBoneInfo||i.dragonBoneInfo)return 1;var n=e.JsonDataManager.instance.dragonBoneTemplate,o=n[t.dragonBoneInfo.getEquipId()],a=n[i.dragonBoneInfo.getEquipId()];return o.part>a.part?1:o.part<a.part?-1:o.level>a.level?1:o.level<a.level?-1:0},t.prototype.sortEquip=function(t,i){var n=e.JsonDataManager.instance.equipTemplate,o=n[t.itemVO.id],a=n[i.itemVO.id];return o.quality>a.quality?-1:o.quality<a.quality?1:o.partList[0]>a.partList[0]?1:o.partList[0]<a.partList[0]?-1:o.level>a.level?-1:o.level<a.level?1:0},t.prototype.sortItem=function(e,t){var i=e.itemVO,n=t.itemVO;return i.quality>n.quality?-1:i.quality<n.quality?1:i.type>n.type?1:i.type<n.type?-1:0},t.prototype.setDragonInfos=function(t){for(var i,n,o,a=t.getEquipInfo(),s=a.length,r=e.JsonDataManager.instance.dragonBoneTemplate,l=0;s>l;l++)i=a[l],o=new e.BagItemData(i,3),this.dragonBoneDic[i.getId()]=o,n=r[i.getEquipId()],this.dragonBoneByPartDic[n.part].push(o),o.getIsEquiped()||this.busyCount++;this.sortDragonBonePartDic(),this.updateView()},t.prototype.sortDragonBonePartDic=function(){for(var t,i=[e.DragonBonePartType.PART1,e.DragonBonePartType.PART2,e.DragonBonePartType.PART3,e.DragonBonePartType.PART4,e.DragonBonePartType.PART5],n=i.length,o=0;n>o;o++)t=this.dragonBoneByPartDic[i[o]],t.sort(this.sortDragonEquipByScoreDescend)},t.prototype.sortDragonEquipByScoreDescend=function(t,i){var n=e.DragonboneController.getInstance(),o=n.getDragonEquipScore(t.dragonBoneInfo),a=n.getDragonEquipScore(i.dragonBoneInfo);return o>a?-1:a>o?1:0},t.prototype.updateDragoneInfos=function(t){for(var i,n,o,a,s,r,l=t.getEquipInfo(),h=l.length,c=e.JsonDataManager.instance.dragonBoneTemplate,u=0;h>u;u++)o=l[u],n=new e.BagItemData(o,3),i=this.dragonBoneDic[o.getId()],this.dragonBoneDic[o.getId()]=n,s=c[o.getEquipId()],r=this.dragonBoneByPartDic[s.part],a=r.indexOf(i),-1==a?(r.push(n),this.busyCount++):r[a]=n;this.sortDragonBonePartDic(),this.updateView()},t.prototype.deleteDragonInfos=function(t){for(var i=t.getDeleteInfo();i.length>0;)delete this.dragonBoneDic[i.pop()],this.busyCount--;for(var n,o,a=[e.DragonBonePartType.PART1,e.DragonBonePartType.PART2,e.DragonBonePartType.PART3,e.DragonBonePartType.PART4,e.DragonBonePartType.PART5],s=a.length,r=0;s>r;r++){n=this.dragonBoneByPartDic[a[r]];for(var l=n.length-1;l>=0;l--)o=n[l].dragonBoneInfo,null==this.dragonBoneDic[o.getId()]&&n.splice(l,1)}this.updateView()},t.prototype.setDragonLockStatus=function(e){if(0==e.getErrorNo()){var t=this.dragonBoneDic[e.getId()];t.dragonBoneInfo.setLock(e.getState()),this.updateView()}},t.prototype.setDemonkeeLockStatus=function(e){if(0==e.getErrorNo()){var t=this.keeequipDic[e.getEquipInfo().getId()];t.keeequipInfo.setLockState(e.getEquipInfo().getLockState()),this.updateView()}},t.prototype.setKeeEquipInfos=function(t){for(var i,n,o,a=t.getEquipList(),s=a.length,r=e.JsonDataManager.instance.demonKeeEquipTemplate,l=0;s>l;l++)i=a[l],o=new e.BagItemData(i,5),this.keeequipDic[i.getId()]=o,n=r[i.getItemId()],this.keeequipByPartDic[n.siteType].push(o),o.getIsEquiped()||this.busyCount++;this.sortkeeinfoPartDic(),this.updateView()},t.prototype.delDemonKee=function(t,i){var n,o=e.JsonDataManager.instance.demonKeeEquipTemplate[i],a=o.siteType,s=this.keeequipByPartDic[a];delete this.keeequipDic[t];for(var r=s.length-1;r>=0;r--)n=s[r].keeequipInfo,null==this.keeequipDic[n.getId()]&&s.splice(r,1);this.busyCount--,this.updateView()},t.prototype.sortkeeinfoPartDic=function(){for(var t,i=[e.KeePartType.PART1,e.KeePartType.PART2,e.KeePartType.PART3,e.KeePartType.PART4],n=i.length,o=0;n>o;o++)t=this.keeequipByPartDic[i[o]],t.sort(this.sortKeeEquipByScoreDescend)},t.prototype.sortKeeEquipByScoreDescend=function(t,i){var n=e.BeautyController.getInstance(),o=n.getbeautyEquipScore(t.keeequipInfo),a=n.getbeautyEquipScore(i.keeequipInfo);return o>a?-1:a>o?1:0},t.prototype.updatakeeequipInfos=function(t){for(var i,n,o,a,s,r,l=t.getEquipList(),h=l.length,c=e.JsonDataManager.instance.demonKeeEquipTemplate,u=0;h>u;u++)o=l[u],n=new e.BagItemData(o,5),i=this.keeequipDic[o.getId()],this.keeequipDic[o.getId()]=n,s=c[o.getItemId()],r=this.keeequipByPartDic[s.siteType],a=r.indexOf(i),-1==a?(r.push(n),this.busyCount++):r[a]=n;this.sortkeeinfoPartDic(),this.updateView()},t.prototype.setDragonArmorInfos=function(t){for(var i,n,o,a=t.getArmourInfo(),s=a.length,r=e.JsonDataManager.instance.dragonArmorTemplate,l=0;s>l;l++)i=a[l],o=new e.BagItemData(i,4),this.dragonArmorDic[i.getArmourId()]=o,n=r[i.getItemId()],n&&this.dragonArmorByPartDic[n.part].push(o),o.getIsEquiped()||this.busyCount++;this.sortDragonArmorPartDic(),this.updateView()},t.prototype.sortDragonArmorPartDic=function(){for(var t,i=[e.DAPartType.Part_1,e.DAPartType.Part_2,e.DAPartType.Part_3,e.DAPartType.Part_4,e.DAPartType.Part_5,e.DAPartType.Part_6,e.DAPartType.Part_7,e.DAPartType.Part_8],n=i.length,o=0;n>o;o++)t=this.dragonArmorByPartDic[i[o]],t.sort(this.sortDAEquipByScoreDescend)},t.prototype.sortDAEquipByScoreDescend=function(t,i){var n=e.DragonArmorController.getInstance(),o=n.getDragonEquipScore(t.dragonArmorInfo),a=n.getDragonEquipScore(i.dragonArmorInfo);return o>a?-1:a>o?1:0},t.prototype.updataDragonArmorInfos=function(t){for(var i,n,o,a,s,r,l=t.getAddArmourS(),h=l.length,c=e.JsonDataManager.instance.dragonArmorTemplate,u=0;h>u;u++)o=l[u],n=new e.BagItemData(o,4),i=this.dragonArmorDic[o.getArmourId()],this.dragonArmorDic[o.getArmourId()]=n,s=c[o.getItemId()],r=this.dragonArmorByPartDic[s.part],a=r.indexOf(i),-1==a?(r.push(n),this.busyCount++):r[a]=n;this.sortDragonArmorPartDic(),this.updateView()},t.prototype.setDragonArmorLockStatus=function(e){if(0==e.getErrorNo()){var t=this.dragonArmorDic[e.getArmourId()];t.dragonArmorInfo.setIsLock(e.getLock()),this.updateView()}},t.prototype.deleteDragonArmor=function(t,i){var n,o=e.JsonDataManager.instance.dragonArmorTemplate[i],a=o.part,s=this.dragonArmorByPartDic[a];delete this.dragonArmorDic[t];for(var r=s.length-1;r>=0;r--)n=s[r].dragonArmorInfo,null==this.dragonArmorDic[n.getArmourId()]&&s.splice(r,1);this.busyCount--},t.prototype.wearDragonArmor=function(){this.busyCount--},t}();e.BagModel=t,__reflect(t.prototype,"foxgame.BagModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/bag/BagSkin.exml","bagGroup",!1)||this;return n.TABTYPE1=0,n.TABTYPE2=1,n.TABTYPE3=2,n.TABTYPE4=3,n.isMask=!1,n.isMaskdown=!0,n.model=i,n.setIsShowTween(!1),n.adaptionType=1,n.setMaskGapBottom(e.Global.mainBtnsPanelMaskGapBottom),n}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.allBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.equipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.itemBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.boxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.vipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.vipHandler,this),this.ui.smeltBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.smeltHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this);var t=Number(e.GlobalConfig.instance.getValue("BAG_ROWNUM")),i=new eui.TileLayout;i.requestedColumnCount=t,i.paddingLeft=e.ItemIcon.horizontalOver,i.paddingRight=e.ItemIcon.horizontalOver,i.horizontalGap=(this.ui.scroller.width-e.ItemIcon.iconSize*t-2*e.ItemIcon.horizontalOver)/(t-1),i.verticalGap=Number(e.GlobalConfig.instance.getValue("BAG_GAPY"));var n=this.ui.list;n.dataProvider=this.model.collection,n.itemRenderer=e.BagItem,n.layout=i,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.doScreenAdaptation()},i.prototype.initParams=function(){this.model.curTab=this.TABTYPE1,this.ui.scroller.viewport.scrollV=0},i.prototype.refresh=function(){switch(this.ui.currency.refresh(),this.refreshTabBtn(),this.ui.boxRedImg.visible=this.model.getEnableBox(),this.model.curTab){case this.TABTYPE1:this.model.dataSource=this.model.getAllTabData();break;case this.TABTYPE2:this.model.dataSource=this.model.getEquipTabData();break;case this.TABTYPE3:this.model.dataSource=this.model.getItemTabData();break;case this.TABTYPE4:this.model.dataSource=this.model.getBoxTabData()}this.model.collection.replaceAll(this.model.dataSource);var t=e.JsonDataManager.instance.vipTemplate[e.PlayerService.instance.vipLevel];this.ui.numLabel.text=e.BagController.getInstance().getBusyCellCount()+"/"+t.bagContainers},i.prototype.refreshTabBtn=function(){this.ui.allBtn.currentState=this.model.curTab==this.TABTYPE1?"down":"up",this.ui.equipBtn.currentState=this.model.curTab==this.TABTYPE2?"down":"up",this.ui.itemBtn.currentState=this.model.curTab==this.TABTYPE3?"down":"up",this.ui.boxBtn.currentState=this.model.curTab==this.TABTYPE4?"down":"up"},i.prototype.tabHandler=function(e){this.ui.scroller.stopAnimation(),this.ui.scroller.viewport.scrollV=0;var t=e.currentTarget;t==this.ui.allBtn?this.model.curTab=this.TABTYPE1:t==this.ui.equipBtn?this.model.curTab=this.TABTYPE2:t==this.ui.itemBtn?this.model.curTab=this.TABTYPE3:t==this.ui.boxBtn&&(this.model.curTab=this.TABTYPE4),this.refresh()},i.prototype.vipHandler=function(t){e.CreateNewVipController.instance.showPanel()},i.prototype.smeltHandler=function(t){this.close(),e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT)},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("BACKPACKHELP")},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.readyDestroy=function(){this.ui.list.dataProvider=null},i}(e.BasePanel);e.BagPanel=t,__reflect(t.prototype,"foxgame.BagPanel",["foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/bag/LimitBoxTipSkin.exml")||this;return e.setEffect(!1),e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e.isCallHideSceneObjectsWhenClose=!1,e}return __extends(i,t),i.prototype.initHook=function(){this.playerInfo=e.PlayerService.instance.playerInfo,this.ui.useBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.useAllBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.initHide()},i.prototype.showPanel=function(t,i,n,o){void 0===o&&(o=!1),this.soleId=t;var a=e.JsonDataManager.instance.itemTemplate;this.itemVO=a[i],this.itemCount=n,this.isShowBtn=o,this.show()},i.prototype.refresh=function(){var t=this.ui.nameLabel;t.text=this.itemVO.name,t.textColor=e.ColorUtils.instance.getColorByQuality(this.itemVO.quality),this.ui.icon.setItem(this.itemVO.id,this.itemCount,!1);var i=e.JsonDataManager.instance.soulTemplate[this.itemVO.id];i&&i.smeltAttrVO.type==e.AttributeType.SOUL?this.ui.desc.text=e.LanguageUtils.instance.getValue("SOULREFINEEXP",i.smeltAttrVO.value):this.ui.desc.text=this.itemVO.desc;var n=this.ui.partLabel;this.itemVO.type==e.ItemType.TREASUREBOX1||this.itemVO.type==e.ItemType.TREASUREBOX2||this.itemVO.type==e.ItemType.TREASUREBOX3?n.text=e.LanguageUtils.instance.getValue("BAOXIANG"):n.text=e.LanguageUtils.instance.getValue("XIAOHAOPIN");var o=this.ui.btnGroup;this.itemVO.type==e.ItemType.TREASUREBOX1||this.itemVO.type==e.ItemType.TREASUREBOX2||this.itemVO.type==e.ItemType.TREASUREBOX3||this.itemVO.type==e.ItemType.CURRENCY||this.itemVO.type==e.ItemType.JINGYANDAN||this.itemVO.type==e.ItemType.LIMITBOX?o.visible=this.isShowBtn:o.visible=!1,this.boxlimitCondition()},i.prototype.initHide=function(){this.ui.limitcondition.visible=!1,this.ui.limitTitle.visible=!1,this.ui.limitcondition1.visible=!1,this.ui.limitTitle1.visible=!1},i.prototype.boxlimitCondition=function(){null!=this.itemVO.levelLimit&&(this.ui.limitTitle2.text="需要等级:",this.ui.lvLabel.text=this.itemVO.levelLimit+""),null!=this.itemVO.vipLevel&&this.itemVO.vipLevel>0&&(this.limitVip=this.itemVO.vipLevel,this.ui.limitcondition.visible=!0,this.ui.limitTitle.visible=!0,this.ui.limitcondition.text=this.itemVO.vipLevel+"",this.ui.limitTitle.text="VIP:"),null!=this.itemVO.goldNumber&&(this.limitYuanBao=this.itemVO.goldNumber,this.ui.limitcondition1.visible=!0,this.ui.limitTitle1.visible=!0,this.ui.limitTitle1.text="开启条件:",this.ui.limitcondition1.text=this.itemVO.goldNumber+"元宝")},i.prototype.onClick=function(t){switch(t.target){case this.ui.useBtn:if(this.itemVO.type==e.ItemType.CURRENCY)this.useItem(1);else{if(!this.useBoxBoolean())return;e.BagController.getInstance().checkBagEnough(this,this.useItem,1)}break;case this.ui.useAllBtn:if(this.itemVO.type==e.ItemType.CURRENCY)this.useItem(this.itemCount);else{if(!this.useBoxBoolean(this.itemCount))return;e.BagController.getInstance().checkBagEnough(this,this.useItem,2)}}},i.prototype.useBoxBoolean=function(t){return void 0===t&&(t=1),this.playerInfo.getLevel()<this.itemVO.levelLimit?(e.PopUpController.getInstance().showFloatTextPanel1("等级不满足要求"),!1):this.ui.limitcondition.visible&&this.playerInfo.getVipLevel()<this.limitVip?(e.PopUpController.getInstance().showFloatTextPanel1("VIP不满足要求"),!1):this.ui.limitcondition1.visible&&this.playerInfo.getGold()<this.limitYuanBao*t?(e.PopUpController.getInstance().showFloatTextPanel1("元宝不足"),!1):!0},i.prototype.useItem=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPItemLimitGiftGetReq");i.setItmeId(this.soleId),i.setTypeId(t),e.Message.instance.send(e.Code.ITEM_LIMTI_GIFT_GET_C,i,!0),this.close()},i}(e.BasePanel);e.LimitBoxTip=t,__reflect(t.prototype,"foxgame.LimitBoxTip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.FlyModel,this.panel=new e.FlyPanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.flyToBag=function(t,i,n){if(void 0===n&&(n=1),!e.WorldBossController.getInstance().isBoss&&!e.UnionController.getInstance().isInBonFire&&e.MainBottomControler.PageState!=e.SceneType.MainCity&&!e.FactionBattleController.getInstance().isFactionMap){var o=e.MainControler.instance.getBagGlobalPos(),a={startPos:t,endPos:o,itemId:i,count:n};this.model.paramList1.push(a),this.panel.fly()}},t.prototype.flyImgByPos=function(e,t,i,n,o,a,s){void 0===o&&(o=!0),void 0===a&&(a=null),void 0===s&&(s=null);var r={startPos:e,endPos:t,source:i,time:n,mask:o,caller:a,backFun:s};this.model.paramList2.push(r),this.panel.fly1()},t.prototype.FlyGuide=function(e,i){void 0===e&&(e=null),void 0===i&&(i=null),egret.Tween.get(e).to({x:e.width/2*e.getScale(),y:e.height/2*e.getScale(),scaleX:0,scaleY:0},350).wait(0).call(function(){var n=e.localToGlobal(0,0);i.point;t.getInstance().flyImgByPos(n,i.point,i.skin,i.time,i.mask,i.flycall,i.flyback);var o=i.backFun;null!=e&&o.call(e)},e,[e,i])},t}();e.FlyController=t,__reflect(t.prototype,"foxgame.FlyController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.paramList1=[],this.paramList2=[]}return e}();e.FlyModel=t,__reflect(t.prototype,"foxgame.FlyModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n._used=[],n._pool=[],n.model=i,n.touchEnabled=!1,n.touchChildren=!1,n.flyTime=Number(e.GlobalConfig.instance.getValue("ITEMFLYTOBAGTIME")),e.Global.topLayer.addChild(n),n
}return __extends(i,t),i.prototype.fly=function(){0!=this.model.paramList1.length&&this.addFly()},i.prototype.addFly=function(){var e=this.model.paramList1.shift(),t=e.startPos,i=e.endPos,n=e.itemId,o=e.count,a=this.popItemIcon();a.setItem(n,o,!1),a.x=t.x,a.y=t.y,a.visible=!0,TweenMax.to(a,this.flyTime,{x:i.x,y:i.y,onComplete:this.tweenComplete.bind(this),onCompleteParams:[a],ease:Cubic.easeOut})},i.prototype.tweenComplete=function(e){e.visible=!1,TweenMax.killTweensOf(e),this._pool.push(e)},i.prototype.fly1=function(){0!=this.model.paramList2.length&&this.addFly1()},i.prototype.addFly1=function(){var t=this.model.paramList2.shift(),i=t.startPos,n=t.endPos,o=t.source,a=t.time;this.backFun=t.backFun,this.caller=t.caller,1==t.mask?(this.maskBg||(this.maskBg=new eui.Image("mask_png"),this.addChild(this.maskBg),this.maskBg.x=-30,this.maskBg.width=this.stage.width+30,this.maskBg.height=this.stage.height,this.maskBg.touchEnabled=!0,this.maskBg.parent.touchChildren=!0),this.maskBg.visible=!0):this.maskBg&&(this.maskBg.visible=!1),null==this.group&&(this.group=new eui.Group,this.group.touchEnabled=this.group.touchChildren=!1,this.addChild(this.group)),this.group.x=i.x,this.group.y=i.y,this.group.visible=!0,this.ani||(this.ani=new e.FoxAni(this.group),this.ani.play("gongnengkaqi","gongnengkaqi",-1)),null!=this.img&&(this.group.removeChild(this.img),this.img=null),null==this.img&&(this.img=new eui.Image,this.group.addChild(this.img),this.img.source=o,this.img.width=64,this.img.height=77,this.img.x-=this.img.width>>1,this.img.y-=(this.img.height>>1)-10),TweenMax.fromTo(this.group,.5,{y:this.group.y,repeat:-1,yoyo:!0},{y:this.group.y+15,repeat:-1,yoyo:!0}),TweenMax.to(this.group,this.flyTime,{x:n.x,y:n.y,delay:a,onComplete:this.tweenComplete1.bind(this),ease:Cubic.easeOut})},i.prototype.tweenComplete1=function(e){this.maskBg.visible=!1,TweenMax.killTweensOf(this.group),this.group.visible=!1,this.caller&&this.backFun&&(this.backFun.call(this.caller),this.backFun=null,this.caller=null)},i.prototype.popItemIcon=function(){var t=null;return this._pool.length>0?t=this._pool.pop():(t=new e.ItemIcon,this.addChild(t)),t},i}(egret.DisplayObjectContainer);e.FlyPanel=t,__reflect(t.prototype,"foxgame.FlyPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(e.ActorInScene_Base);e.Actor_Base=t,__reflect(t.prototype,"foxgame.Actor_Base")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.scene=null,this.mapManager=null,this.playerManager=null,this.actorMap={},this.actorListByUnitId={},this.actorParent=e.MapViewportGroupManager.instance.sceneView.BattleUnitNode,this.mainActor=null,this.centerActor=null,this.actorMustShowNumber=0,this.actorMustShowData={},this.actorNeedShowNumber=0,this.actorNeedShowLimit=6,this.actorNeedShowData={},this.moveToPosDelay={},this.backupPos={},this.flyEffectList=[],this.flyEffectParent=e.MapViewportGroupManager.instance.sceneView,this.moveSpeed=280,this.sortActorZorderTimer=null,this.block=!1,this.addListener()}return t.prototype.setManager=function(e){this.scene=e.scene,this.mapManager=e.mapManager,this.playerManager=e.playerManager},t.prototype.addListener=function(){e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this)},t.prototype.removeListener=function(){e.Message.instance.remove(e.MsgCMD.REFRESH_PLAYERDATA,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:this.onMsgRefreshPlayerData(i)}},t.prototype.onMsgRefreshPlayerData=function(t){if(!t||"fightValueChange"!=t){var i=e.PlayerService.instance.getRoleDataList();this.refreshActorByRoleDataList(i,this.playerManager.serverId,this.playerManager.playerId),this.scene.inUse||this.setActorVisible(!1)}},t.prototype.findActorByUnitId=function(e){return this.actorListByUnitId[e]},t.prototype.checkBattleFilmOverForAll=function(){var e=!0;for(var t in this.actorListByUnitId){var i=this.actorListByUnitId[t];if(i.isInBattle||0!=i.iDelayFinishCount){e=!1;break}}return e},t.prototype.doFunctionForAllActor=function(e){null!=e&&this.doFunctionForEachPlayer(function(t,i){this.doFunctionForPlayerActor(t,i,e)}.bind(this))},t.prototype.doFunctionForPlayerActor=function(e,t,i){if(null!=e&&null!=t&&null!=i){var n=this.actorMap[e];if(n){var o=n[t];if(o){var a=null,s=null,r=null;for(var l in o){a=o[l];for(var h in a)if(s=a[h],r=i(s))return}}}}},t.prototype.doFunctionForEachPlayer=function(e){if(null!=e){var t=null,i=null,n=null;for(var o in this.actorMap){t=this.actorMap[o];for(var a in t)if(i=t[a],n=e(parseInt(o),parseInt(a)))return}}},t.prototype.doFunctionForMonsterActor=function(t,i,n){if(null!=t&&null!=i&&null!=n){var o=this.actorMap[t];if(o){var a=o[i];if(a){var s=e.RoleType.MONSTER,r=a[s];if(r){var l=null,h=null;for(var c in r)if(l=r[c],h=n(l))return}}}}},t.prototype.stopActorForPlayer=function(e,t){this.doFunctionForPlayerActor(e,t,function(e){e.stopMove(!0)}.bind(this))},t.prototype.stopActorForAll=function(){this.doFunctionForAllActor(function(e){e.stopMove(!0)}.bind(this))},t.prototype.updateBattleFilmForPlayer=function(e,t){this.doFunctionForPlayerActor(e,t,function(e){e.battleFrameUpdate()}.bind(this))},t.prototype.updateBattleFilmForAll=function(){this.doFunctionForAllActor(function(e){e.battleFrameUpdate()}.bind(this))},t.prototype.backupActorPos=function(){var e=this.playerManager.serverId,t=this.playerManager.playerId;this.doFunctionForPlayerActor(e,t,function(e){this.backupPos[e.$hashCode]={x:e.x,y:e.y}}.bind(this))},t.prototype.revertActorPos=function(){var t=this.playerManager.serverId,i=this.playerManager.playerId;this.doFunctionForPlayerActor(t,i,function(t){var i=this.backupPos[t.$hashCode];i?(t.x=i.x,t.y=i.y):e.LogUtil.getInstance().log("ActorManager","没有备份坐标")}.bind(this))},t.prototype.clearActorForPlayer=function(e,t){this.doFunctionForPlayerActor(e,t,function(e){e.cleanBuffList(),e.cleanAllEffectState()}.bind(this))},t.prototype.clearActorForMonster=function(e){var t=this.playerManager.monsterServerId,i=this.playerManager.monsterPlayerId;this.doFunctionForPlayerActor(t,i,function(t){return t.roleItemId==e?(t.cleanBuffList(),t.cleanAllEffectState(),!0):void 0}.bind(this))},t.prototype.resetActorByBattleInfo=function(t){Object.keys(this.actorListByUnitId).length>0&&(e.LogUtil.getInstance().log("ActorManager","还有之前战斗的角色没移除"),this.deleteActorForOther());var i=t.getBattleData(),n=i.getOffence();for(var o in n){var a=n[o],s=this.findActorByFightRole(a,!1);s?s.updateBattleData(a,t):s=this.createActorByFightRole(a,!0,t),this.addActorToUnitList(a,s)}var r=i.getDefence();for(var o in r){var a=r[o],s=this.findActorByFightRole(a,!1);s?s.updateBattleData(a,t):s=this.createActorByFightRole(a,!0,t),this.addActorToUnitList(a,s)}},t.prototype.refreshActorByBattleInfo=function(e){var t=e.getBattleData(),i=t.getOffence();for(var n in i){var o=i[n],a=this.findActorByFightRole(o,!1);a?a.refreshAction(o):a=this.createActorByFightRole(o,!0,e),this.addActorToUnitList(o,a)}var s=t.getDefence();for(var n in s){var o=s[n],a=this.findActorByFightRole(o,!1);a?a.refreshAction(o):a=this.createActorByFightRole(o,!0,e),this.addActorToUnitList(o,a)}this.setMainActor()},t.prototype.refreshActorByRoleDataList=function(t,i,n){for(var o in t){var a=t[o],s=this.findActorByRoleData(a,i,n);if(s){s.updateActorRoleLook(a)}else switch(a.type){case e.RoleType.MAIN_ROLE:case e.RoleType.MERCENARY:s=this.createActorByRoleData(a,i,n)}}this.setMainActor()},t.prototype.refreshActorBySimpleRoleList=function(t,i){for(var n in t){var o=t[n],a=i[n],s=this.findActorBySimpleRole(o,!1);s?s.updateFromSimpleRole(o):s=this.createActorBySimpleRole(o,!0),s.roleType==e.RoleType.MONSTER&&s.roleItemId==this.playerManager.flagMonsterId?(s.showByNeed=!1,s.visible=!1):s.curHp>0?(s.isDead=!1,s.visible=!0):(s.isDead=!0,s.visible=!1),a&&(s.x=a.getX(),s.y=a.getY(),this.centerActor&&s==this.centerActor&&this.mapManager.moveMapByType())}this.refreshActorDuan(),this.refreshCenterActor(),this.setMainActor()},t.prototype.deleteActorForOther=function(){this.doFunctionForEachPlayer(function(e,t){e==this.playerManager.serverId&&t==this.playerManager.playerId?this.deleteActorForReuse(e,t):this.deleteActorForNouse(e,t)}.bind(this))},t.prototype.deleteActorForReuse=function(t,i){var n=this.actorMap[t];if(n){var o=n[i];if(o){var a=null,s=null;for(var r in o)if(a=o[r],Number(r)==e.RoleType.CALLBEAST){for(var l in a){s=a[l];var h=s.fightRoleData&&s.fightRoleData.getId()||null;this.deleteActorFromBattleList(h),this.hideActorModel(s),s.deleteThis(),a[l]=null}o[r]=[]}else for(var l in a){s=a[l];var h=s.fightRoleData&&s.fightRoleData.getId()||null;this.deleteActorFromBattleList(h)}}}},t.prototype.deleteActorForNouse=function(t,i){e.LogUtil.getInstance().log("ActorManager","删除玩家"+i+"的所有角色");var n=this.actorMap[t];if(n){var o=n[i];if(o){var a=null,s=null;for(var r in o){a=o[r];for(var l in a){s=a[l];var h=s.fightRoleData&&s.fightRoleData.getId()||null;this.deleteActorFromBattleList(h),this.hideActorModel(s),s.deleteThis(),a[l]=null}}delete this.actorMap[t][i]}}},t.prototype.deleteActorForAll=function(){this.doFunctionForEachPlayer(function(e,t){this.deleteActorForNouse(e,t)}.bind(this))},t.prototype.deleteMonsterByMonsterId=function(t){if(t){e.LogUtil.getInstance().log("ActorManager","删除怪物"+t);var i=this.playerManager.monsterServerId,n=this.actorMap[i];if(n){var o=this.playerManager.monsterPlayerId,a=n[o];if(a){var s=e.RoleType.MONSTER,r=a[s],l=null;for(var h in r)if(l=r[h],l.roleItemId==t){var c=l.fightRoleData&&l.fightRoleData.getId()||null;this.deleteActorFromBattleList(c),this.hideActorModel(l),l.deleteThis(),r.splice(parseInt(h),1);break}}}}},t.prototype.getMainActorForPlayer=function(t,i){var n=this.actorMap[t];if(!n)return null;var o=n[i];if(!o)return null;var a=e.RoleType.MAIN_ROLE,s=o[a];return s&&0!=s.length?s[0]:null},t.prototype.refreshCenterActor=function(){var t=null;this.mainActor&&!this.mainActor.isDead?this.centerActor&&this.centerActor==this.mainActor||(t=this.mainActor):this.centerActor&&!this.centerActor.isDead?this.centerActor.serverId==this.playerManager.serverId&&this.centerActor.roleBelongPlayerId==this.playerManager.playerId||(t=this.getCenterActorForPlayer(this.playerManager.serverId,this.playerManager.playerId),t||(t=null)):(t=this.getCenterActorForPlayer(this.playerManager.serverId,this.playerManager.playerId),t||this.doFunctionForEachPlayer(function(e,i){return t=this.getCenterActorForPlayer(e,i),t?!0:void 0}.bind(this)),t||(t=this.mainActor)),t&&(e.LogUtil.getInstance().log("ActorManager","切换中心角色 : "+t.roleName),this.centerActor&&(this.centerActor.setTweenObject=t.setTweenObject),this.centerActor=t,this.centerActor.setTweenObject=function(){this.centerActor.tw=egret.Tween.get(this.centerActor,{onChange:this.onActorTween,onChangeObj:this})}.bind(this),this.mapManager.moveMapByType())},t.prototype.moveToPosForPlayer=function(t,i,n,o){if(null==t||null==i)return void(o&&o());this.clearMoveToPosDelay(t,i);var a=this.getCenterActorForPlayer(t,i);if(!a)return void(o&&o());this.moveToPosDelay[t]=this.moveToPosDelay[t]||{},this.moveToPosDelay[t][i]=this.moveToPosDelay[t][i]||{};var s=0,r=80;this.doFunctionForPlayerActor(t,i,function(l){if(l==a)l.moveToPosByLine(n,o,null,null);else{var h=new egret.Point(n.x,n.y);h.x+=r*e.GameUtils.randomNegetive()*(.5+Math.random()),h.y+=r*e.GameUtils.randomNegetive()*(.5+Math.random()),h.x=Math.floor(h.x),h.y=Math.floor(h.y),this.moveToPosDelay[t][i][s]=setTimeout(function(e){clearTimeout(this.moveToPosDelay[t][i][e]),delete this.moveToPosDelay[t][i][e],l.moveToPosByLine(h,null,null,null)}.bind(this),300*(.5+Math.random()),[s]),s++}}.bind(this))},t.prototype.randomActorPosForPlayer=function(t,i){if(null!=t&&null!=i){var n=this.getMainActorForPlayer(t,i);if(n){var o=n.x,a=n.y,s=50*(.5+Math.random());this.doFunctionForPlayerActor(t,i,function(t){if(t!=n){var i=new egret.Point(o,a);i.x+=s*e.GameUtils.randomNegetive()*(.5+Math.random()),i.y+=s*e.GameUtils.randomNegetive()*(.5+Math.random()),i.x=Math.floor(i.x),i.y=Math.floor(i.y),t.x=i.x,t.y=i.y}}.bind(this))}}},t.prototype.playFlyAction=function(t){var i=t.actorList,n=t.mainActor,o=t.landPointList,a=t.flyCallback,s=t.landCallback,r=!1;n&&-1!=i.indexOf(n)||(n=i[0]);for(var l=i.indexOf(n),h=o[l]||o[0]||new egret.Point,c=function(t){var l=i[t];l.stopMove();var c=u.flyEffectList[t];if(!c){var p=new egret.DisplayObjectContainer;u.flyEffectParent.addChild(p),c=new e.FoxAni(p),c.setPlayComplete(function(){c.parent.visible=!1},u),u.flyEffectList[t]=c}var g=0,d=0;if(o[t])g=o[t].x,d=o[t].y;else{var f=l.x-n.x,m=l.y-n.y;g=h.x+f,d=h.y+m}n==l?(r=!0,egret.Tween.get(l,{onChange:u.onActorTween,onChangeObj:u}).call(function(){c.parent.x=l.x,c.parent.y=l.y,c.play("skill201_1","skill201_1",1),c.parent.visible=!0},u).to({y:l.y-100},100,egret.Ease.sineIn).call(function(){l.visible=!1},u).wait(750).call(function(t){a&&a(),e.TextureCache.getInstance().releaseCache(e.ReleaseType.LEAST_RECENTLY_USED,10485760)},u).to({x:g,y:d-143},0).call(function(e){l.visible=!0},u).to({y:d},100,egret.Ease.sineOut).call(function(){c.parent.x=l.x,c.parent.y=l.y,c.play("skill201_1","skill201_1",1),c.parent.visible=!0},u).wait(500).call(function(e){s&&s()},u)):egret.Tween.get(l).call(function(){c.parent.x=l.x,c.parent.y=l.y,c.play("skill201_1","skill201_1",1),c.parent.visible=!0},u).to({y:l.y-100},100,egret.Ease.sineIn).call(function(){l.visible=!1},u).wait(750).to({x:g,y:d-143},0).call(function(e){l.visible=!0},u).to({y:d},100,egret.Ease.sineOut).call(function(){c.parent.x=l.x,c.parent.y=l.y,c.play("skill201_1","skill201_1",1),c.parent.visible=!0},u)},u=this,p=0;p<i.length;p++)c(p);r||(a&&a(),s&&s())},t.prototype.playFlyActionByBattleInfo=function(e,t){var i=[],n={};if(e){var o=e.getBattleData(),a=o.getOffence();for(var s in a){var r=a[s],l=this.findActorByFightRole(r,!1);l&&(n[i.length]=new egret.Point(r.getInitPos().getX(),r.getInitPos().getY()),i.push(l))}var h=o.getDefence();for(var s in h){var r=h[s],l=this.findActorByFightRole(r,!1);l&&(n[i.length]=new egret.Point(r.getInitPos().getX(),r.getInitPos().getY()),i.push(l))}}var c=t.beforeCallback,u=t.flyCallback,p=t.landCallback;i.length>0?(c&&c(),this.playFlyAction({actorList:i,mainActor:this.mainActor,landPointList:n,flyCallback:u,landCallback:p})):(c&&c(),u&&u(),p&&p())},t.prototype.setActorHpTypeByBattleType=function(t){switch(t){case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:var i=this.scene.getStateManagerByBattleType(t);this.doFunctionForEachPlayer(function(e,n){var o=i.getHpColorByBattleType(t,e,n);this.setHpColorForPlayer(e,n,o)}.bind(this))}},t.prototype.setHpColorForPlayer=function(e,t,i){this.doFunctionForPlayerActor(e,t,function(e){e.hpBar.setColor(i)}.bind(this))},t.prototype.freeEnemyPlayer=function(e,t){this.actorNeedShowNumber>this.actorNeedShowLimit&&this.hidePlayerModel(e,t)},t.prototype.setEnemyPlayer=function(e,t){this.showPlayerModel(e,t)},t.prototype.addActorToUnitList=function(e,t){if(e&&t){var i=e.getId();this.actorListByUnitId[i]=t}},t.prototype.deleteActorFromBattleList=function(e){e&&(this.actorListByUnitId[e]=null,delete this.actorListByUnitId[e])},t.prototype.findActorByRoleData=function(t,i,n){if(!this.actorMap[i])return null;if(!this.actorMap[i][n])return null;var o=t.type,a=this.actorMap[i][n][o];if(!a||0==a.length)return null;var s=t.roleId;switch(o){case e.RoleType.MAIN_ROLE:case e.RoleType.MERCENARY:case e.RoleType.MONSTER:case e.RoleType.BEAUTY:case e.RoleType.CALLBEAST:for(var r in a){var l=a[r];if(l.roleId==s)return l}}return null},t.prototype.findActorByFightRole=function(e,t){var i=e.getId();return t&&this.deleteActorFromBattleList(i),this.findActorBySimpleRole(e.getRole(),t)},t.prototype.findActorBySimpleRole=function(t,i){var n=t.getServerId();if(!this.actorMap[n])return null;var o=t.getPlayerId();if(!this.actorMap[n][o])return null;var a=t.getType(),s=this.actorMap[n][o][a];if(!s||0==s.length)return null;switch(a){case e.RoleType.MAIN_ROLE:case e.RoleType.MERCENARY:var r=t.getRoleItemId();for(var l in s){var h=s[l];if(h.roleItemId==r)return i&&s.splice(parseInt(l),1),h}break;case e.RoleType.MONSTER:case e.RoleType.BEAUTY:case e.RoleType.CALLBEAST:var c=t.getMonsterId();for(var l in s){var h=s[l];if(h.roleItemId==c)return i&&s.splice(parseInt(l),1),h}}return null},t.prototype.createActorByRoleData=function(t,i,n){var o=t.type,a=t.roleId,s=t.itemId,r=null;switch(o){case e.RoleType.MAIN_ROLE:case e.RoleType.MERCENARY:r=new e.ActorInScene_Role(t),r.showName(),r.simpleInitPosition(0,0,null),r.serverId=i,r.roleBelongPlayerId=n,r.roleItemId=s,r.roleId=a,this.showActorModel(r),this.actorParent.addChild(r)}return r&&(this.actorMap[i]=this.actorMap[i]||{},this.actorMap[i][n]=this.actorMap[i][n]||{},this.actorMap[i][n][o]=this.actorMap[i][n][o]||[],this.actorMap[i][n][o].push(r),r.setBlock(this.block)),r&&e.LogUtil.getInstance().log("ActorManager","RoleData 创建角色 "+r.roleName),r},t.prototype.createActorByFightRole=function(t,i,n){var o=t.getRole().getServerId(),a=t.getRole().getPlayerId(),s=t.getRole().getType(),r=null;switch(s){case e.RoleType.MAIN_ROLE:case e.RoleType.MERCENARY:var l=t.getRole().getRoleItemId();r=new e.ActorInScene_Role(null),r.pvpFightInit(t,n),r.serverId=o,r.roleBelongPlayerId=a,r.roleItemId=l,this.showActorModel(r),this.actorParent.addChild(r);break;case e.RoleType.MONSTER:case e.RoleType.BEAUTY:case e.RoleType.CALLBEAST:var h=t.getRole().getMonsterId();r=new e.ActorInScene_Monster(t,n),r.serverId=o,r.roleBelongPlayerId=a,r.roleItemId=h,this.showActorModel(r),this.actorParent.addChild(r)}return r&&i&&(this.actorMap[o]=this.actorMap[o]||{},this.actorMap[o][a]=this.actorMap[o][a]||{},this.actorMap[o][a][s]=this.actorMap[o][a][s]||[],this.actorMap[o][a][s].push(r),r.setBlock(this.block)),r&&e.LogUtil.getInstance().log("ActorManager","FightRole 创建角色 "+r.roleName),r},t.prototype.createActorBySimpleRole=function(t,i){var n=t.getServerId(),o=t.getPlayerId(),a=t.getType(),s=null;switch(a){case e.RoleType.MAIN_ROLE:case e.RoleType.MERCENARY:var r=t.getRoleItemId();s=new e.ActorInScene_Role(null),s.simpleInitFromSimpleRole(t),s.serverId=n,s.roleBelongPlayerId=o,s.roleItemId=r,this.showActorModel(s),this.actorParent.addChild(s);break;case e.RoleType.MONSTER:case e.RoleType.BEAUTY:case e.RoleType.CALLBEAST:var l=t.getMonsterId();s=new e.ActorInScene_Monster(null,null),s.simpleInitFromSimpleRole(t),s.serverId=n,s.roleBelongPlayerId=o,s.roleItemId=l,this.showActorModel(s),this.actorParent.addChild(s),l==this.playerManager.flagMonsterId&&(s.visible=!1,s.onHpChange=this.onHpChange.bind(this))}return s&&i&&(this.actorMap[n]=this.actorMap[n]||{},this.actorMap[n][o]=this.actorMap[n][o]||{},this.actorMap[n][o][a]=this.actorMap[n][o][a]||[],this.actorMap[n][o][a].push(s),s.setBlock(this.block)),s&&e.LogUtil.getInstance().log("ActorManager","SimpleRole 创建角色 "+s.roleName),s},t.prototype.refreshActorDuan=function(){var e=null,t=null;for(var i in this.actorMap){e=this.actorMap[i];for(var n in e){t=e[n];var o=this.getMainActorForPlayer(parseInt(i),parseInt(n));if(o){var a=o.roleLevel;for(var s in t){var r=t[s];for(var l in r){var h=r[l];h.updataDuanByPlayerLevel(a)}}}}}},t.prototype.getPlayerHeadDataByDistance=function(e,t,i,n){var o=[];if(null==e||null==t||null==i||null==n)return o;var a=this.getMainActorForPlayer(e,t);return a?(this.doFunctionForEachPlayer(function(s,r){if(e!=s||t!=r){var l=this.getMainActorForPlayer(s,r);if(l){var h=Math.abs(a.x-l.x),c=Math.abs(a.y-l.y);if(!(h>i||c>n)){var u=this.getPlayerHeadDataForPlayer(s,r);u.distance=h+c,o.push(u)}}}}.bind(this)),o):o},t.prototype.getPlayerHeadDataForPlayer=function(t,n){if(null!=t&&null!=n){var o=this.getMainActorForPlayer(t,n);if(o){var a=new i;a.serverId=t,a.playerId=n,a.roleType=o.roleType,a.name=o.roleName,a.union=o.unionName;var s=o.roleItemId;a.itemId=s;var r=e.PlayerService.instance.getRoleVO(s);r&&(a.icon=r.icon);var l=0,h=0;return this.doFunctionForPlayerActor(t,n,function(e){l+=Number(e.curHp),h+=Number(e.maxHp)}.bind(this)),a.curHp=l,a.maxHp=h,a}}},t.prototype.getMonsterHeadDataByDistance=function(t,n,o,a){var s=[];if(null==t||null==n||null==o||null==a)return s;var r=this.getMainActorForPlayer(t,n);if(!r)return s;var l=this.playerManager.serverId,h=this.playerManager.playerId;return this.doFunctionForMonsterActor(l,h,function(t){if(t.roleItemId!=this.playerManager.flagMonsterId){var n=Math.abs(r.x-t.x),c=Math.abs(r.y-t.y);if(!(n>o||c>a)){var u=new i;u.serverId=l,u.playerId=h,u.roleType=t.roleType,u.name=t.roleName,u.union=null;var p=e.JsonDataManager.instance.monster[t.roleItemId];p&&(u.icon=p.iconPath),u.itemId=t.roleItemId,u.curHp=Number(t.curHp),u.maxHp=Number(t.maxHp),u.distance=n+c,s.push(u)}}}.bind(this)),s},t.prototype.getMonsterHeadDataForMonster=function(t){var n=this.playerManager.serverId,o=this.playerManager.playerId,a=null;return this.doFunctionForMonsterActor(n,o,function(s){if(s.roleItemId==t){a=new i,a.serverId=n,a.playerId=o,a.roleType=s.roleType,a.name=s.roleName,a.union=null;var r=e.JsonDataManager.instance.monster[s.roleItemId];return r&&(a.icon=r.iconPath),a.icon=r.iconPath,a.itemId=s.roleItemId,a.curHp=Number(s.curHp),a.maxHp=Number(s.maxHp),s.roleItemId==this.playerManager.flagMonsterId&&(a.icon="qizitouxiang_png"),!0}}.bind(this)),a},t.prototype.getHeadDataByTypeId=function(t,i,n){var o=null;switch(t){case e.SceneObjectType.ObjTypePlayer:case e.SceneObjectType.ObjTypeNpc:o=this.getPlayerHeadDataForPlayer(i,n);break;case e.SceneObjectType.ObjTypeMonster:o=this.getMonsterHeadDataForMonster(n)}return o},t.prototype.setActorVisibleByDistance=function(e,t,i,n){this.doFunctionForAllActor(function(o){var a=Math.abs(o.x-e),s=Math.abs(o.y-t);i>a&&n>s&&!o.isDead&&o.showByNeed?(o.visible=!0,o.showByDistance=!0):(o.visible=!1,o.showByDistance=!1)}.bind(this))},t.prototype.showActorModel=function(t){t.modelController||(t.serverId==this.playerManager.serverId&&t.roleBelongPlayerId==this.playerManager.playerId?(this.actorMustShowNumber++,t.setModelControllerEnable(!0),e.LogUtil.getInstance().log("ActorManager","自己模型 显示 : "+t.roleName+" "+t.roleItemId)):t.serverId==this.playerManager.monsterServerId&&t.roleBelongPlayerId==this.playerManager.monsterPlayerId?(this.actorMustShowNumber++,t.setModelControllerEnable(!0),e.LogUtil.getInstance().log("ActorManager","怪物模型 显示 : "+t.roleName+" "+t.roleItemId)):t.serverId==this.playerManager.enemyServerId&&t.roleBelongPlayerId==this.playerManager.enemyPlayerId?(this.actorNeedShowNumber++,t.setModelControllerEnable(!0),e.LogUtil.getInstance().log("ActorManager","敌人模型 显示 : "+t.roleName+" "+t.roleItemId)):null==this.actorNeedShowLimit||this.actorNeedShowLimit>this.actorNeedShowNumber?(this.actorNeedShowNumber++,t.setModelControllerEnable(!0),e.LogUtil.getInstance().log("ActorManager","其他模型 显示 : "+t.roleName+" "+t.roleItemId)):(t.setModelControllerEnable(!1),e.LogUtil.getInstance().log("ActorManager","其他模型 不显示 : "+t.roleName+" "+t.roleItemId)),t.setStateIdle(),t.showName())},t.prototype.refreshActorShowData=function(e,t){if(e&&e.modelController){var i=e.modelController.actionTable;for(var n in i)var o=i[n],a=o.name,s=o.modelId}},t.prototype.hideActorModel=function(t){t.modelController&&(t.serverId==this.playerManager.serverId&&t.roleBelongPlayerId==this.playerManager.playerId?(this.actorMustShowNumber--,e.LogUtil.getInstance().log("ActorManager","自己模型 隐藏 : "+t.roleName+" "+t.roleItemId)):t.serverId==this.playerManager.monsterServerId&&t.roleBelongPlayerId==this.playerManager.monsterPlayerId?(this.actorMustShowNumber--,e.LogUtil.getInstance().log("ActorManager","怪物模型 隐藏 : "+t.roleName+" "+t.roleItemId)):(this.actorNeedShowNumber--,e.LogUtil.getInstance().log("ActorManager","其他模型 隐藏 : "+t.roleName+" "+t.roleItemId)),t.setModelControllerEnable(!1))},t.prototype.hidePlayerModel=function(e,t){this.doFunctionForPlayerActor(e,t,this.hideActorModel.bind(this))},t.prototype.showPlayerModel=function(e,t){this.doFunctionForPlayerActor(e,t,this.showActorModel.bind(this))},t.prototype.setMainActor=function(){if(!this.mainActor){var t=this.playerManager.serverId,i=this.actorMap[t];if(i){var n=this.playerManager.playerId,o=i[n];if(o){var a=e.RoleType.MAIN_ROLE,s=o[a];s&&0!=s.length&&(e.LogUtil.getInstance().log("ActorManager","设置主角"),this.mainActor=s[0],this.scene.onMainActor(),this.refreshCenterActor())}}}},t.prototype.clearMoveToPosDelay=function(e,t){var i=this.moveToPosDelay[e];if(i){var n=i[t];if(n)for(var o in n)clearTimeout(n[o]),delete n[o]}},t.prototype.getCenterActorForPlayer=function(t,i){var n=this.actorMap[t];if(!n)return null;var o=n[i];if(!o)return null;var a=null,s=null;a=o[e.RoleType.MAIN_ROLE];for(var r in a)if(s=a[r],!s.isDead)return s;a=o[e.RoleType.MERCENARY];for(var r in a)if(s=a[r],!s.isDead)return s;a=o[e.RoleType.CALLBEAST];for(var r in a)if(s=a[r],!s.isDead)return s;return null},t.prototype.onActorTween=function(){this.mapManager.moveMapByType()},t.prototype.onHpChange=function(e){this.scene.onHpChange(e)},t.prototype.setActorVisible=function(e){this.doFunctionForAllActor(function(t){t.isDead||(t.visible=e)}.bind(this))},t.prototype.checkOpacityByTile=function(){this.doFunctionForAllActor(function(e){e.visible&&(this.mapManager.isPointOpacity(e.x,e.y)?e.alpha=.7:e.alpha=1)}.bind(this))},t.prototype.onTimerSortActorZorder=function(){var e={};if(this.doFunctionForAllActor(function(t){if(t.visible){var i=(t.isDead&&0||1e4)+t.y+.01*t.parent.getChildIndex(t);e[i]=t}}.bind(this)),0!=Object.keys(e).length){var t=Object.keys(e);t.sort();for(var i=0;i<t.length;i++){var n=t[i],o=e[n];this.actorParent.setChildIndex(o,i)}}},t.prototype.startTimerSortActorZorder=function(){this.stopTimerSortActorZorder(),this.sortActorZorderTimer=setInterval(this.onTimerSortActorZorder.bind(this),400),this.onTimerSortActorZorder()},t.prototype.stopTimerSortActorZorder=function(){this.sortActorZorderTimer&&(clearInterval(this.sortActorZorderTimer),this.sortActorZorderTimer=null)},t.prototype.setInUse=function(e){e?this.startTimerSortActorZorder():this.stopTimerSortActorZorder()},t.prototype.addActorToPlayer=function(e,t,i,n){this.actorMap[e]=this.actorMap[e]||{},this.actorMap[e][t]=this.actorMap[e][t]||{},this.actorMap[e][t][i]=(this.actorMap[e][t][i]||[]).concat(n)},t.prototype.setActorNeedShowLimit=function(e){this.actorNeedShowLimit=e},t.prototype.setBlock=function(e){this.block=!this.block,this.refreshBlock()},t.prototype.refreshBlock=function(){this.doFunctionForEachPlayer(function(e,t){(e!=this.playerManager.serverId||t!=this.playerManager.playerId)&&this.doFunctionForPlayerActor(e,t,function(e){e.setBlock(this.block)}.bind(this))}.bind(this))},t}();e.ActorManager=t,__reflect(t.prototype,"foxgame.ActorManager",["foxgame.IMessage"]);var i=function(){function e(){this.serverId=null,this.playerId=null,this.roleType=null,this.name=null,this.union=null,this.icon=null,this.itemId=null,this.curHp=null,this.maxHp=null,this.distance=null,this.extend={}}return e}();e.PlayerHeadData=i,__reflect(i.prototype,"foxgame.PlayerHeadData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.actorManager=null,this.mapManager=null,this.dropList=[],this.dropTimer={},this.interrupt=!1}return t.prototype.setManager=function(e){this.actorManager=e.actorManager,this.mapManager=e.mapManager},t.prototype.changeDropAwardCount=function(e,t,i){for(var n=0;n<e.length;n++){var o=e[n].getItemId(),a=e[n].getCount();if(o==t){for(var s=0,r=0;r<i.length;r++){var l=i[r];if(a>=l.itemNumber){s=l.dropNumber-e.length;break}}if(s>0){for(var h=a>s&&s||a-1,r=0;h>r;r++){var c=new Buffer.DropAwardItem;c.setItemId(o),c.setCount(1),e.push(c)}e[n].setCount(a-h)}break}}},t.prototype.createDropItem=function(t){var i=e.DropItem.addDropItem(t);this.dropList.push(i)},t.prototype.createDropAward=function(t,i,n){e.LogUtil.getInstance().log("DropManager","创建掉落");var o=0,a=80,s=i.x,r=i.y,l=0,h=0,c=i.x,u=i.y,p=t.length,g=Math.ceil(Math.sqrt(p)),d=Math.ceil(p/g),f=d*a+(d-1)*o,m=g,y=m*a+(m-1)*o;l=0>c-f/2?0:c+f/2>this.mapManager.mapWidth?this.mapManager.mapWidth-f:c-f/2,c=l+f/2,h=0>u-y/2?0:u+y/2>this.mapManager.mapHeight?this.mapManager.mapHeight-y:u-y/2,u=h+y/2,this.dropList=[];for(var I=p,v=0,_=function(i){var c=Math.floor(i/g),u=c%2==0?i%g:g-1-i%g,p=l+c*(o+a)+a/2,d=h+u*(o+a)+a/2,f=t[i],m={itemid:f.getItemId(),countNum:f.getCount(),oriPos:new egret.Point(s,r),dstPos:new egret.Point(p,d),callback:function(){v++,v==I&&n&&n()}.bind(T)};if(e.Global.isWeChatXiaoChengXuBranch||window.egret_quickgame)T.createDropItem(m);else{var y=setTimeout(function(e){clearTimeout(y),delete this.dropTimer[y],this.createDropItem(e)}.bind(T),100,m);T.dropTimer[y]=!0}},T=this,C=0;p>C;C++)_(C)},t.prototype.deleteDropItem=function(e){e&&e.dispose(!0)},t.prototype.clearDropItem=function(){for(var e in this.dropTimer)clearTimeout(parseInt(e)),delete this.dropTimer[e];for(;this.dropList.length>0;){var t=this.dropList.pop();this.deleteDropItem(t)}},t.prototype.pickUpDropItem=function(t,i,n,o){if(this.dropList.length>0){var a=new egret.Point,s=this.dropList[0];a.x=s.x+s.width/2,a.y=s.y+s.height/2,this.actorManager.moveToPosForPlayer(t,i,a,function(){var e=this.dropList.shift();o&&o(e),this.deleteDropItem(e),this.pickUpDropItem(t,i,n,o)}.bind(this))}else this.interrupt||(e.LogUtil.getInstance().log("scene_baes","轮流拾取道具完毕"),n&&n())},t.prototype.pickUpDropItemOneByOne=function(e,t,i,n){void 0===n&&(n=null),this.interrupt=!1,this.pickUpDropItem(e,t,i,n)},t.prototype.pickUpDropItemAllAtOnce=function(t,i){for(var n=0;n<this.dropList.length;n++){var o=this.dropList[n];egret.Tween.removeTweens(o),egret.Tween.get(o).wait(10*n+1200).to({y:o.y+6},50,egret.Ease.backIn).to({y:o.y},50,egret.Ease.backIn).to({y:o.y+6},50,egret.Ease.backIn).to({y:o.y},50,egret.Ease.backIn).to({x:t.x,y:t.y},350,egret.Ease.backIn).call(function(e){this.dropList[e]&&(this.dropList[e].visible=!1)},this,[n]).wait(700).call(function(t){t+1==this.dropList.length&&(this.clearDropItem(),this.interrupt||(e.LogUtil.getInstance().log("scene_baes","一键拾取道具完毕"),i&&i()))},this,[n])}},t.prototype.interruptPickUp=function(){this.interrupt=!0,this.clearDropItem()},t}();e.DropManager=t,__reflect(t.prototype,"foxgame.DropManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.scene=null,this.actorManager=null,this.sceneManager=null,this.playerManager=null,this.mapId=0,this.mapType=i.NORMAL,this.switchList=null,this.switchNode=[],this.switchParent=null,this.switchTime=500,this.switchTimer=null,this.switchIndex=0,this.stopMoveTimer=null,this.touchLayer=null,this.touchAnimation=null,this.touchParent=null,this.centerType=n.ACTOR,this.centerFixedPos=null,this.mapMinX=0,this.mapMaxX=0,this.mapMinY=0,this.mapMaxY=0,this.mapWidth=0,this.mapHeight=0,this.screenWidth=0,this.screenHeight=0,this.borderL=0,this.borderR=0,this.borderT=0,this.borderB=0,this.showWidth=0,this.showHeight=0,this.refreshActorShowInterval=3e3,this.refreshActorShowTimer=null,this.tileData=new e.TileData,this.tileEnable=!1,this.opacityTimer=null,this.switchParent=e.MapViewportGroupManager.instance.mapView.mBattleGroup,this.touchParent=StageFrameControl.instance.mainUILayer,this.screenWidth=ScreenAdaptation.instance.mapWidth,this.screenHeight=ScreenAdaptation.instance.mapHeight,this.borderL=Math.floor(.48*this.screenWidth),this.borderR=this.screenWidth-this.borderL,this.borderT=Math.floor(.48*this.screenHeight),this.borderB=this.screenHeight-this.borderT,this.touchLayer=new eui.Button,this.touchLayer.width=this.screenWidth,this.touchLayer.height=this.screenHeight,this.touchParent.addChild(this.touchLayer),this.touchLayer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickMap,this),this.stopTouchMove(),this.touchAnimation=new egret.DisplayObjectContainer;var t=new e.FoxAni(this.touchAnimation);this.touchAnimation.animation=t,this.touchAnimation.animation.play("anim_click","ani",-1),this.hideTouch(),this.switchParent.addChild(this.touchAnimation),this.addListener()
}return t.prototype.setManager=function(e){this.scene=e.scene,this.actorManager=e.actorManager,this.sceneManager=e.sceneManager,this.playerManager=e.playerManager},t.prototype.addListener=function(){e.Message.instance.add(e.MsgCMD.BATTLE_MAP_REFRESH,this)},t.prototype.removeListener=function(){e.Message.instance.remove(e.MsgCMD.BATTLE_MAP_REFRESH,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.BATTLE_MAP_REFRESH:this.onMsgRefreshMap(i)}},t.prototype.onClickMap=function(t){e.LogUtil.getInstance().log("MapManager","touchmap "+t.localX+" "+t.localY);var i=new egret.Point(t.localX,t.localY),n=StageFrameControl.instance.getScrollViewport(),o=e.MapViewportGroupManager.instance.mapView;i.x+=n.scrollH,i.y+=n.scrollV,i.x<0||i.x>o.width||this.isPointPass(i.x,i.y)&&this.scene.onClickMap(i,function(){var e=null;e=this.checkSwitchPos(i)?this.startTimerSwitch.bind(this):this.startTimerStopMove.bind(this),this.onTouch(i,e)}.bind(this))},t.prototype.onTouch=function(e,t){this.stopTimerSwitch(),this.stopTimerStopMove(),this.touchAnimation.x=e.x,this.touchAnimation.y=e.y,this.touchAnimation.visible=!0,this.actorManager.moveToPosForPlayer(this.playerManager.serverId,this.playerManager.playerId,e,function(){this.hideTouch(),t&&t()}.bind(this)),this.sceneManager.sendMsgScenePlayerMoveRequest(e)},t.prototype.hideTouch=function(){this.touchAnimation.visible=!1},t.prototype.onMsgRefreshMap=function(t){e.LogUtil.getInstance().log("MapManager","有新的普通地图数据"),this.mapType==i.NORMAL&&this.refreshNormalMap()},t.prototype.refreshMap=function(t,n){if(this.mapType!=t||this.mapId!=n){var a=e.JsonDataManager.instance.mapTemplate[n];if(a){this.mapType=t,this.mapId=n,e.LogUtil.getInstance().log("MapManager","切换地图 mapType="+this.mapType+" mapId="+this.mapId);var s=a.battleIcon.split("/"),r=s[s.length-1].split(".")[0];e.MapViewportGroupManager.instance.mapView.setBattleBG(r,a);for(var l=a.mapJump.split(","),h=[],c=0;c<(l.length+1)/2;c++)h.push({x:parseInt(l[2*c]),y:parseInt(l[2*c+1])});this.switchList=h,this.mapType==i.NORMAL?this.showSwitchByConfig([{pos:0,effect:o.TRANS},{pos:1,effect:o.TRANS}]):this.mapType==i.BOSS&&this.hideSwitchForAll(),this.refreshMapSize(a),this.moveMapByType()}}},t.prototype.refreshBossMapByMapId=function(t){var n=e.JsonDataManager.instance.mapTemplate[t];if(n){var o=n.bossMapID;this.refreshMap(i.BOSS,o)}},t.prototype.refreshNormalMapByMapId=function(e){this.refreshMap(i.NORMAL,e)},t.prototype.refreshNormalMap=function(){var t=e.PlayerService.instance.playerStateInfo.getCurBattleMap();this.refreshNormalMapByMapId(t)},t.prototype.refreshMapSize=function(t){var i=t.mapXGrid*e.Global.mainMapTileWidth,n=t.mapYGrid*e.Global.mainMapTileWidth;this.mapWidth=i,this.mapHeight=n,this.mapMinX=0,this.mapMaxX=i-this.screenWidth,this.mapMinY=0,this.mapMaxY=n-this.screenHeight},t.prototype.moveMapByType=function(){switch(this.centerType){case n.ACTOR:var e=this.actorManager.centerActor;e&&this.moveMapToPos(e.x,e.y);break;case n.FIXED:this.centerFixedPos&&this.moveMapToPos(this.centerFixedPos.x,this.centerFixedPos.y)}},t.prototype.moveMapToPos=function(t,i){var n=StageFrameControl.instance.getScrollViewport(),o=e.MapViewportGroupManager.instance.mapView,a=n.scrollH,s=n.scrollV;t<a+this.borderL?a=t-this.borderL:t>a+this.borderR&&(a=t-this.borderR),i<s+this.borderT?s=i-this.borderT:i>s+this.borderB&&(s=i-this.borderB),a<this.mapMinX?a=this.mapMinX:a>this.mapMaxX&&(a=this.mapMaxX),s<this.mapMinY?s=this.mapMinY:s>this.mapMaxY&&(s=this.mapMaxY),e.GamePlatform.isQQdating&&o.width<o.stage.stageWidth&&(a=o.width-o.stage.stageWidth>>1),n.scrollH=a,n.scrollV=s,e.MapViewportGroupManager.instance.mapView.onMoveBattleMapPic(t,i)},t.prototype.startTouchMove=function(){this.touchLayer.touchEnabled=!0},t.prototype.stopTouchMove=function(){this.touchLayer.touchEnabled=!1},t.prototype.hideSwitchForAll=function(){for(var e=0;e<this.switchNode.length;e++)this.switchNode[e].visible=!1},t.prototype.showSwitchByConfig=function(t){for(var i=0,n=0;n<t.length;n++){var o=t[n],a=o.pos,s=o.effect,r=this.switchNode[i];if(!r){r=new egret.DisplayObjectContainer,r.name="battleMapDoorNode";var l=new e.FoxAni(r);r.animation=l,this.switchParent.addChild(r),this.switchNode[i]=r}this.playSwitchEffect(r,this.switchList[a],s),r.visible=!0,i++}for(;i<this.switchNode.length;i++)this.switchNode[i].visible=!1},t.prototype.playSwitchEffect=function(e,t,i){switch(i){case o.TRANS:e.animation.play("movestand","movestand",-1),e.x=t.x-32,e.y=t.y-32;break;case o.FLAG:e.animation.play("UnionSiegeFlag","flag",-1),e.x=t.x-50,e.y=t.y-200}},t.prototype.moveToSwitch=function(e,t){if(this.switchList.length>e){var i=new egret.Point;i.x=this.switchList[e].x,i.y=this.switchList[e].y,this.switchIndex=e,this.onTouch(i,t)}else t&&t()},t.prototype.checkSwitchPos=function(e){for(var t=0;t<this.switchList.length;t++){var i=Math.abs(e.x-this.switchList[t].x),n=Math.abs(e.y-this.switchList[t].y);if(100>i&&100>n)return this.switchIndex=t,!0}return!1},t.prototype.startTimerSwitch=function(){this.stopTimerSwitch(),this.switchTimer=setTimeout(this.onTimerSwitchOver.bind(this),this.switchTime)},t.prototype.stopTimerSwitch=function(){this.switchTimer&&(clearTimeout(this.switchTimer),this.switchTimer=null)},t.prototype.onTimerSwitchOver=function(){var e=this.scene.getStateManagerBySceneType(this.sceneManager.sceneType,this.sceneManager.sceneId);e.onTimeSwitchOver(this.switchIndex)},t.prototype.startTimerStopMove=function(){this.stopTimerStopMove(),this.stopMoveTimer=setTimeout(this.onTimerStopMove.bind(this),3e3)},t.prototype.stopTimerStopMove=function(){this.stopMoveTimer&&(clearTimeout(this.stopMoveTimer),this.stopMoveTimer=null)},t.prototype.onTimerStopMove=function(){var e=this.scene.getStateManagerBySceneType(this.sceneManager.sceneType,this.sceneManager.sceneId);e.onTimerStopMove()},t.prototype.startTimerRefreshActorShow=function(){this.stopTimerRefreshActorShow(),this.refreshActorShowTimer=setInterval(this.onTimerRefreshActorShow.bind(this),this.refreshActorShowInterval)},t.prototype.stopTimerRefreshActorShow=function(){this.refreshActorShowTimer&&(clearInterval(this.refreshActorShowTimer),this.refreshActorShowTimer=null)},t.prototype.onTimerRefreshActorShow=function(){var e=StageFrameControl.instance.getScrollViewport(),t=e.scrollH+this.screenWidth/2,i=e.scrollV+this.screenHeight/2,n=this.screenWidth/2+this.actorManager.moveSpeed*this.refreshActorShowInterval/1e3+100,o=this.screenHeight/2+this.actorManager.moveSpeed*this.refreshActorShowInterval/1e3+100;this.actorManager.setActorVisibleByDistance(t,i,n,o)},t.prototype.setTiledMapEnable=function(e){e?(this.tileEnable=!0,this.tileData.refreshMapId(this.mapId),this.startTimerOpacity()):(this.tileEnable=!1,this.stopTimerOpacity())},t.prototype.isPointPass=function(e,t){return this.tileEnable?this.tileData.isPointPass(e,t):!0},t.prototype.startTimerOpacity=function(){this.stopTimerOpacity(),this.opacityTimer=setInterval(this.onTimerOpacity.bind(this),500),this.onTimerOpacity()},t.prototype.stopTimerOpacity=function(){this.opacityTimer&&(clearInterval(this.opacityTimer),this.opacityTimer=null)},t.prototype.onTimerOpacity=function(){this.actorManager.checkOpacityByTile()},t.prototype.isPointOpacity=function(e,t){return this.tileEnable?this.tileData.isPointOpacity(e,t):!1},t.prototype.setInUse=function(e){e?(this.addListener(),this.startTimerRefreshActorShow()):(this.mapType=i.NORMAL,this.mapId=0,this.removeListener(),this.hideSwitchForAll(),this.stopTimerRefreshActorShow())},t}();e.MapManager=t,__reflect(t.prototype,"foxgame.MapManager",["foxgame.IMessage"]);var i;!function(e){e[e.NORMAL=0]="NORMAL",e[e.BOSS=1]="BOSS"}(i||(i={}));var n;!function(e){e[e.ACTOR=0]="ACTOR",e[e.FIXED=1]="FIXED"}(n||(n={}));var o;!function(e){e[e.TRANS=0]="TRANS",e[e.FLAG=1]="FLAG"}(o=e.SwitchEffect||(e.SwitchEffect={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.actorManager=null,this.serverId=null,this.playerId=null,this.unionId=null,this.monsterServerId=0,this.monsterPlayerId=0,this.enemyServerId=0,this.enemyPlayerId=0,this.flagMonsterId=384900,this.init=!1,this.addListener(),this.serverId=Number(e.Global.newServerId),this.flagMonsterId=Number(e.GlobalConfig.instance.getValue("FLAG_MONSTER_ID"))}return t.prototype.setManager=function(e){this.actorManager=e.actorManager},t.prototype.addListener=function(){e.Message.instance.add(e.Code.REFRESH_PLAYER_MANAGER,this)},t.prototype.removeListener=function(){e.Message.instance.remove(e.Code.REFRESH_PLAYER_MANAGER,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.REFRESH_PLAYER_MANAGER:Log.trace("接受外部消息"+t,i),null!=i.serverId&&(this.serverId=i.serverId),null!=i.playerId&&(this.playerId=i.playerId),null!=i.unionId&&(this.unionId=i.unionId)}},t.prototype.setEnemy=function(e,t){(this.enemyServerId!=e||this.enemyPlayerId!=t)&&(this.enemyServerId&&this.enemyPlayerId&&(this.enemyServerId==this.monsterServerId&&this.enemyPlayerId==this.monsterPlayerId||this.actorManager.freeEnemyPlayer(this.enemyServerId,this.enemyPlayerId),this.enemyServerId=null,this.enemyPlayerId=null),this.enemyServerId=e,this.enemyPlayerId=t,this.enemyServerId&&this.enemyPlayerId&&(this.enemyServerId==this.monsterServerId&&this.enemyPlayerId==this.monsterPlayerId||this.actorManager.setEnemyPlayer(this.enemyServerId,this.enemyPlayerId)))},t}();e.PlayerManager=t,__reflect(t.prototype,"foxgame.PlayerManager",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.inUse=!1,this.actorManager=null,this.dropManager=null,this.mapManager=null,this.sceneManager=null,this.playerManager=null,this.stateManager_Normal=null,this.stateManager_Challenge=null,this.stateManager_RealTime=null,this.stateManager_GuideBattle=null,this.stateManager_GuideMainCity=null,this.battleUI=null,this.battleType=e.BattleType.BATTLE_PVE_MONSTER,this.battleState=0,this.eventNode=new egret.DisplayObjectContainer,this.battleTime=1e3/30,this.battleTimer=new egret.Timer(this.battleTime),this.battleCallback=null,this.battleCallobjc=null,this.battleTypeTransValue={},e.LogUtil.getInstance().All=!0,this.actorManager=new e.ActorManager,this.dropManager=new e.DropManager,this.mapManager=new e.MapManager,this.sceneManager=new e.SceneManager,this.playerManager=new e.PlayerManager;var t={scene:this,actorManager:this.actorManager,dropManager:this.dropManager,mapManager:this.mapManager,sceneManager:this.sceneManager,playerManager:this.playerManager};this.actorManager.setManager(t),this.dropManager.setManager(t),this.mapManager.setManager(t),this.sceneManager.setManager(t),this.playerManager.setManager(t),this.stateManager_Normal=new e.stateManager_Normal(t),this.stateManager_Challenge=new e.StateManager_Challenge(t),this.stateManager_RealTime=new e.StateManager_RealTime(t),this.stateManager_GuideBattle=new e.StateManager_GuideBattle(t),this.stateManager_GuideMainCity=new e.StateManager_GuideMainCity(t),this.initBattleTypeTransValue(),this.eventNode.addEventListener(i.CHANGE_STATE,this.onStateChange,this),this.addListener(),this.mapManager.removeListener()}return t.prototype.changeState=function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o="");var a=new i(i.CHANGE_STATE,e,t,n,o);this.eventNode.dispatchEvent(a)},t.prototype.onStateChange=function(t){if(e.LogUtil.getInstance().log("Scene_Base","请求切换状态 : "+t.tag),this.battleType==t.battleType){if(this.battleState==t.battleState)return void e.LogUtil.getInstance().log("Scene_Base","相同状态不切换");e.LogUtil.getInstance().log("Scene_Base","战斗类型不变 "+this.battleType+" 切换战斗状态 "+this.battleState+" => "+t.battleState),this.changeBattleState(t)}else e.LogUtil.getInstance().log("Scene_Base","切换战斗类型 "+this.battleType+" => "+t.battleType+" 切换战斗状态 "+this.battleState+" => "+t.battleState),this.changeBattleType(t)},t.prototype.changeBattleState=function(e){var t=this.getStateManagerByBattleType(this.battleType);t.interruptState(this.battleState),this.battleType=e.battleType,this.battleState=e.battleState;var i=this.getStateManagerByBattleType(e.battleType);i.changeToState(this.battleState,e.params)},t.prototype.changeBattleType=function(e){var t=this.getStateManagerByBattleType(this.battleType);t.removeListener(),t.interruptState(this.battleState),this.battleType=e.battleType,this.battleState=e.battleState;var i=this.getStateManagerByBattleType(e.battleType);i.changeToState(this.battleState,e.params),i.addListener()},t.prototype.addListener=function(){},t.prototype.removeListener=function(){},t.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.BATTLE_INFO_CHALLENGE:this.onMsgBattleInfo(i)}},t.prototype.onMsgBattleInfo=function(t){var i=e.BattleService.instance.getBattleInfo("CHALLENGE");return i?void this.handleBattleInfo(i):void e.LogUtil.getInstance().warn("Scene_Base","未发现挑战战报")},t.prototype.handleBattleInfo=function(e){var t=e.getBattleType(),i=this.getStateManagerByBattleType(t);i.handleBattleInfo(e)},t.prototype.checkNeedTransByBattleType=function(t,i){var n=!0;if(i==e.BattleType.BATTLE_PVE_MONSTER)n=!1;else{var o=this.battleTypeTransValue[t],a=this.battleTypeTransValue[i];o&&a&&o==a&&(n=!1)}return n},t.prototype.getStateManagerByBattleType=function(t){switch(t){case e.BattleType.BATTLE_PVE_MONSTER:return this.stateManager_Normal;case e.BattleType.BOSS_TWELVE_PALACE_FIGHT:case e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER:case e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER:case e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER:case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:return this.stateManager_RealTime;case e.BattleType.BATTLE_GUIDE:return this.stateManager_GuideBattle;case e.BattleType.MAIN_CITY_GUIDE:return this.stateManager_GuideMainCity;default:return this.stateManager_Challenge}},t.prototype.changeToScene=function(e){var t=e.getSceneType(),i=e.getTargetSceneId(),n=this.getStateManagerBySceneType(t,i);n.changeToScene(e)},t.prototype.getStateManagerBySceneType=function(t,i){switch(t){case e.WorldSceneType.OldMonsterBattleMap:return this.stateManager_Normal;case e.WorldSceneType.OldBossBattleMap:return this.stateManager_Challenge;case e.WorldSceneType.TwelvePalaceBossBattleMap:case e.WorldSceneType.CrossServerBossBattleMap:case e.WorldSceneType.UnionWarBattleMap:case e.WorldSceneType.CrossServerUnionSiegeMap:return this.stateManager_RealTime;case e.WorldSceneType.GuideBattle:return this.stateManager_GuideBattle;case e.WorldSceneType.GuideMainCity:return this.stateManager_GuideMainCity;default:return this.stateManager_Normal}},t.prototype.startBattleTimer=function(e,t){this.deleteBattleTimer(),this.battleCallback=e,this.battleCallobjc=t,this.battleTimer.addEventListener(egret.TimerEvent.TIMER,this.battleCallback,this.battleCallobjc),this.battleTimer.start()},t.prototype.stopBattleTimer=function(e,t){this.battleCallback==e&&this.battleCallobjc==t&&(this.battleTimer.stop(),this.battleTimer.removeEventListener(egret.TimerEvent.TIMER,this.battleCallback,this.battleCallobjc),this.battleCallback=null,this.battleCallobjc=null)},t.prototype.deleteBattleTimer=function(){this.battleCallback&&this.battleCallobjc&&(this.battleTimer.stop(),this.battleTimer.removeEventListener(egret.TimerEvent.TIMER,this.battleCallback,this.battleCallobjc),this.battleCallback=null,this.battleCallobjc=null)},t.prototype.battleTypeOver=function(){},t.prototype.setInUse=function(t){this.inUse=!!t,this.inUse?(1==e.MainBottomControler.PageState&&e.Message.instance.send(e.MsgCMD.NEWBEEFORFIGHTCONTROLER,2),this.mapManager.setInUse(!0),e.BattleScene.instance.gotoChallengeBattle(null),e.BattleScene.instance.changeState(e.BattleState.NONE,"开始新战斗"),this.actorManager.setActorVisible(!0),this.actorManager.setInUse(!0)):(this.mapManager.setInUse(!1),this.actorManager.setInUse(!1),this.actorManager.setActorVisible(!1),e.BattleScene.instance.gotoNormalBattle(),e.BattleScene.instance.state==e.BattleState.NONE&&e.BattleScene.instance.changeState(e.BattleState.NORMAL_SEARCH,"回到旧战斗"))},t.prototype.initBattleTypeTransValue=function(){this.battleTypeTransValue[e.BattleType.BATTLE_PVE_MONSTER]=1,this.battleTypeTransValue[e.BattleType.BATTLE_PVE_BOSS]=1,this.battleTypeTransValue[e.BattleType.BATTLE_MAP_PK]=1,this.battleTypeTransValue[e.BattleType.BATTLE_PVP_ARENA]=2,this.battleTypeTransValue[e.BattleType.DAY_COPY]=3,this.battleTypeTransValue[e.BattleType.BOSS_PLUNDER_SINGLE]=4,this.battleTypeTransValue[e.BattleType.BATTLE_UNION_BOSS]=5,this.battleTypeTransValue[e.BattleType.BATTLE_CHALLENGE]=6,this.battleTypeTransValue[e.BattleType.GHOST_TOWER]=7,this.battleTypeTransValue[e.BattleType.LEGENDARY_EMPIRE]=8,this.battleTypeTransValue[e.BattleType.UNION_SIEGE_GATE_BATTLE]=9,this.battleTypeTransValue[e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY]=9,this.battleTypeTransValue[e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT]=9,this.battleTypeTransValue[e.BattleType.UNION_SIEGE_BATTLE_PALACE]=9,this.battleTypeTransValue[e.BattleType.CS_UNION_SIEGE_GATE_BATTLE]=10,this.battleTypeTransValue[e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY]=10,this.battleTypeTransValue[e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT]=10,this.battleTypeTransValue[e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE]=10},t.prototype.onHpChange=function(e){this.battleUI&&this.battleUI.onHpChange(e)},t.prototype.findActorByUnitId=function(e){return this.actorManager.findActorByUnitId(e)},t.prototype.onClickMap=function(e,t){this.battleUI&&this.battleUI.onClickMap(e,t)},t.prototype.onActorDead=function(e){e&&this.actorManager.centerActor&&e==this.actorManager.centerActor&&this.actorManager.refreshCenterActor()},t.prototype.onMainActor=function(){this.battleUI&&this.battleUI.onMainActor()},t.prototype.isGuide=function(){return this.inUse&&this.battleUI instanceof e.BattleUI_Guide?this.battleUI.isGuideStart:!1},t}();e.Scene_Base=t,__reflect(t.prototype,"foxgame.Scene_Base",["foxgame.IMessage"]);var i=function(e){function t(t,i,n,o,a,s,r){void 0===s&&(s=!1),void 0===r&&(r=!1);var l=e.call(this,t,s,r)||this;return l.battleType=i,l.battleState=n,l.params=o,l.tag=a,l}return __extends(t,e),t.CHANGE_STATE="CHANGE_STATE",t}(egret.Event);e.SceneStateEvent=i,__reflect(i.prototype,"foxgame.SceneStateEvent")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.scene=null,this.actorManager=null,this.playerManager=null,this.sceneType=e.WorldSceneType.OldMonsterBattleMap,this.sceneId=0,this.alive=!1,this.sceneObjectId={},this.battleInfoIndex=0,this.crowdIndex=0,this.addListener()}return t.prototype.setManager=function(e){this.actorManager=e.actorManager,this.scene=e.scene,this.playerManager=e.playerManager},t.prototype.addListener=function(){e.Message.instance.add(e.Code.SCENE_PLAYER_ENTER_RESPONSE,this),e.Message.instance.add(e.Code.SCENE_PLAYER_RELIVE_RESPONSE,this),e.Message.instance.add(e.Code.SCENE_PLAYER_ENTER,this),e.Message.instance.add(e.Code.SCENE_PLAYER_LEAVE,this),e.Message.instance.add(e.Code.SCENE_MONSTER_ENTER,this),e.Message.instance.add(e.Code.SCENE_MONSTER_LEAVE,this),e.Message.instance.add(e.Code.SCENE_PLAYER_INFO_SYNC,this),e.Message.instance.add(e.Code.SCENE_MONSTER_INFO_SYNC,this),e.Message.instance.add(e.Code.SCENE_OBJECT_MOVE_RESPONSE,this),e.Message.instance.add(e.Code.SCENE_OBJECT_MOVE_SYNC,this),e.Message.instance.add(e.Code.SCENE_OBJECT_POS_SYNC,this),e.Message.instance.add(e.Code.SCENE_OBJECT_ID_SYNC,this),e.Message.instance.add(e.Code.SCENE_OBJECT_DEATH,this),e.Message.instance.add(e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC,this),e.Message.instance.add(e.MsgCMD.CHANGE_BATTLE_SCENE,this)},t.prototype.removeListener=function(){e.Message.instance.remove(e.Code.SCENE_PLAYER_ENTER_RESPONSE,this),e.Message.instance.remove(e.Code.SCENE_PLAYER_RELIVE_RESPONSE,this),e.Message.instance.remove(e.Code.SCENE_PLAYER_ENTER,this),e.Message.instance.remove(e.Code.SCENE_PLAYER_LEAVE,this),e.Message.instance.remove(e.Code.SCENE_MONSTER_ENTER,this),e.Message.instance.remove(e.Code.SCENE_MONSTER_LEAVE,this),e.Message.instance.remove(e.Code.SCENE_PLAYER_INFO_SYNC,this),e.Message.instance.remove(e.Code.SCENE_MONSTER_INFO_SYNC,this),e.Message.instance.remove(e.Code.SCENE_OBJECT_MOVE_RESPONSE,this),e.Message.instance.remove(e.Code.SCENE_OBJECT_MOVE_SYNC,this),e.Message.instance.remove(e.Code.SCENE_OBJECT_POS_SYNC,this),e.Message.instance.remove(e.Code.SCENE_OBJECT_ID_SYNC,this),e.Message.instance.remove(e.Code.SCENE_OBJECT_DEATH,this),e.Message.instance.remove(e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC,this),e.Message.instance.remove(e.MsgCMD.CHANGE_BATTLE_SCENE,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.SCENE_PLAYER_ENTER_RESPONSE:e.Global.goBattleBtnswitch=!1,this.onMsgSceneChangeResponse(i);break;case e.Code.SCENE_PLAYER_RELIVE_RESPONSE:this.onMsgScenePlayerReliveResponse(i);break;case e.Code.SCENE_PLAYER_ENTER:this.onMsgScenePlayerEnter(i);break;case e.Code.SCENE_PLAYER_LEAVE:this.onMsgScenePlayerLeave(i);break;case e.Code.SCENE_MONSTER_ENTER:this.onMsgSceneMonsterEnter(i);break;case e.Code.SCENE_MONSTER_LEAVE:this.onMsgSceneMonsterLeave(i);break;case e.Code.SCENE_PLAYER_INFO_SYNC:this.onMsgScenePlayerInfo(i);break;case e.Code.SCENE_MONSTER_INFO_SYNC:this.onMsgSceneMonsterInfo(i);break;case e.Code.SCENE_OBJECT_MOVE_RESPONSE:this.onMsgScenePlayerMoveResponse(i);break;case e.Code.SCENE_OBJECT_MOVE_SYNC:this.onMsgSceneMoveSync(i);break;case e.Code.SCENE_OBJECT_POS_SYNC:this.onMsgScenePosSync(i);break;case e.Code.SCENE_OBJECT_ID_SYNC:this.onMsgSceneObjectIdSync(i);break;case e.Code.SCENE_OBJECT_DEATH:this.onMsgSceneDeathSync(i);break;case e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC:this.onMsgSceneBattleInfoSync(i);break;case e.MsgCMD.CHANGE_BATTLE_SCENE:this.sendMsgSceneChangeRequest(i.sceneType,i.sceneId)}},t.prototype.onMsgSceneChangeResponse=function(t){var i=t.getRet();if(0==i)this.scene.changeToScene(t),this.sendSceneChangeOK(t);else{var n=t.getMsg();n||e.GlobalUtil.showErrorCodeMsg(i)}},t.prototype.onMsgScenePlayerReliveResponse=function(t){var i=t.getSceneType(),n=t.getSubSceId();if(this.sceneType==i&&this.sceneId==n){var o=t.getRet();if(0==o){var a=(t.getPlayerServerId(),t.getPlayerId(),t.getReduceCnt(),this.scene.getStateManagerBySceneType(this.sceneType,this.sceneId));a.onSelfRelive(),this.alive=!0}else{var s=t.getMsg();s&&e.PopUpController.getInstance().showFloatTextPanel1(s)}}},t.prototype.onMsgScenePlayerEnter=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();if(this.sceneType==t&&this.sceneId==i){var n=e.getRoles(),o=e.getCurPos();this.actorManager.refreshActorBySimpleRoleList(n,o)}},t.prototype.onMsgScenePlayerLeave=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();if(this.sceneType==t&&this.sceneId==i){var n=e.getPlayerId(),o=e.getPlayerServerId();this.actorManager.deleteActorForNouse(o,n)}},t.prototype.onMsgSceneMonsterEnter=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();if(this.sceneType==t&&this.sceneId==i){var n=e.getMonsterInfo(),o=e.getCurPos();this.actorManager.refreshActorBySimpleRoleList(n,o)}},t.prototype.onMsgSceneMonsterLeave=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();if(this.sceneType==t&&this.sceneId==i){var n=(e.getTargetServerId(),e.getMonsterSvrId());this.actorManager.deleteMonsterByMonsterId(n)}},t.prototype.onMsgScenePlayerInfo=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();if(this.sceneType==t&&this.sceneId==i){var n=e.getPlayer();this.actorManager.refreshActorBySimpleRoleList(n,[])}},t.prototype.onMsgSceneMonsterInfo=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();if(this.sceneType==t&&this.sceneId==i){var n=e.getMonster();this.actorManager.refreshActorBySimpleRoleList(n,[])}},t.prototype.onMsgScenePlayerMoveResponse=function(t){var i=t.getSceneType(),n=t.getTargetSceneId();if(this.sceneType==i&&this.sceneId==n){var o=t.getTargetServerId(),a=t.getTargetId();if(o==this.playerManager.serverId&&a==this.playerManager.playerId){var s=t.getRet();if(0==s);else{var r=t.getMsg();r&&e.PopUpController.getInstance().showFloatTextPanel1(r);var l=t.getCurPos(),h=l.getX(),c=l.getY(),u=l.getDirection(),p=this.actorManager.getMainActorForPlayer(this.playerManager.serverId,this.playerManager.playerId);h&&(p.x=h),c&&(p.y=c),u&&(p.direction=u)}}}},t.prototype.onMsgSceneMoveSync=function(t){var i=t.getSceneType(),n=t.getTargetSceneId();if(this.sceneType==i&&this.sceneId==n){var o=t.getTargetServerId(),a=t.getTargetId(),s=t.getType();if(s==e.SceneObjectType.ObjTypePlayer&&(o!=this.playerManager.serverId||a!=this.playerManager.playerId)){var r=t.getMovePath();if(!r)return;var l=r.getPathPos()[0];if(!l)return;var h=l.getX(),c=l.getY();this.actorManager.moveToPosForPlayer(o,a,new egret.Point(h,c),null)}}},t.prototype.onMsgScenePosSync=function(e){var t=e.getSceneType(),i=e.getTargetSceneId();this.sceneType!=t||this.sceneId!=i},t.prototype.onMsgSceneObjectIdSync=function(e){var t=e.getSceneType(),n=e.getSceneId();if(this.sceneType==t&&this.sceneId==n){this.sceneObjectId={};for(var o=e.getSceneObjIdArray(),a=e.getSceneObjTypeArray(),s=e.getSceneObjOwnIdArray(),r=e.getServerIdArray(),l=o.length,h=0;l>h;h++){var c=new i;c.objectId=o[h],c.type=a[h],c.serverId=r[h],c.typeId=s[h],c.alive=!0,this.sceneObjectId[c.objectId]=c}}},t.prototype.onMsgSceneDeathSync=function(t){var i=t.getSceneType(),n=t.getTargetSceneId();if(this.sceneType==i&&this.sceneId==n){var o=t.getObjSceneId();if(!this.sceneObjectId[o])return void e.LogUtil.getInstance().log("SceneManager","场景中不存在死亡玩家 objectId : "+o);if(this.sceneObjectId[o].alive=!1,this.sceneObjectId[o].type==e.SceneObjectType.ObjTypePlayer&&this.sceneObjectId[o].serverId==this.playerManager.serverId&&this.sceneObjectId[o].typeId==this.playerManager.playerId){var a=this.scene.getStateManagerBySceneType(this.sceneType,this.sceneId);a.onSelfDeath(t.getReliveTime())}}},t.prototype.onMsgSceneBattleInfoSync=function(e){var t=e.getSceneType(),i=e.getSceneId();this.sceneType==t&&this.sceneId==i&&(this.battleInfoIndex=e.getPlayIdx(),this.scene.handleBattleInfo(e.getBattleInfo()))},t.prototype.sendMsgSceneChangeRequest=function(t,i){if(1==e.Global.goBattleBtnswitch)return void e.GameUtils.MSG_TIP("正在切换场景");if(e.Global.goBattleBtnswitch=!0,this.sceneType==t&&this.sceneId==i)return void e.GameUtils.MSG_TIP("已经在场景中");var n=HawkProtocolManager.newBuilder("JsProto.HPChangeWorldSceneC");n.setSceneType(t),n.setTargetSceneId(i),n.setLeaveSceneType(this.sceneType),n.setLeaveSceneId(this.sceneId),e.Message.instance.send(e.Code.SCENE_PLAYER_ENTER_REQUEST,n,!0)},t.prototype.sendSceneChangeOK=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPChangeWorldSceneC");i.setLeaveSceneId(0),i.setLeaveSceneType(0),i.setSceneType(t.getSceneType()),i.setTargetSceneId(t.getTargetSceneId()),e.Message.instance.send(e.Code.SCENE_PLAYER_CONFIRM_ENTER_C,i,!0)},t.prototype.sendMsgScenePlayerReliveRequest=function(){e.LogUtil.getInstance().log("SceneManager","发送场景玩家复活请求");var t=HawkProtocolManager.newBuilder("JsProto.HPScenePlayerRequestRelive");t.setSceneType(this.sceneType),t.setSubSceId(this.sceneId),t.setPlayerServerId(this.playerManager.serverId),t.setPlayerId(this.playerManager.playerId),t.setReliveLvl(0),e.Message.instance.send(e.Code.SCENE_PLAYER_RELIVE_REQUEST,t,!0)},t.prototype.sendMsgScenePlayerMoveRequest=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPSceneMoveRequest");i.setSceneType(this.sceneType),i.setTargetSceneId(this.sceneId),i.setType(e.SceneObjectType.ObjTypePlayer),i.setTargetServerId(this.playerManager.serverId),i.setTargetId(this.playerManager.playerId);var n=HawkProtocolManager.newBuilder("JsProto.PosInfo"),o=this.actorManager.getMainActorForPlayer(this.playerManager.serverId,this.playerManager.playerId);n.setX(Math.floor(o.x)),n.setY(Math.floor(o.y)),n.setDirection(o.direction),n.setSpeed(this.actorManager.moveSpeed),i.setCurPos(n);var a=HawkProtocolManager.newBuilder("JsProto.MovePath"),s=HawkProtocolManager.newBuilder("JsProto.PosInfo");s.setX(Math.floor(t.x)),s.setY(Math.floor(t.y)),a.setPathPos([s]),i.setMovePath(a),e.Message.instance.send(e.Code.SCENE_OBJECT_MOVE_REQUEST,i,!0)},t.prototype.sendMsgBattleInfoUpdateRequest=function(t){e.LogUtil.getInstance().log("SceneManager","发送玩家更新战斗胶片请求");var i=HawkProtocolManager.newBuilder("JsProto.HPSceneBattleMergeInfoUpdateRequest");i.setSceneType(this.sceneType),i.setSceneId(this.sceneId);var n=window.loginServerTime+egret.getTimer()-window.loginEgretTime;i.setServerTimeStamp(n),i.setCurPlayingIdx(this.battleInfoIndex),i.setHopeTimeLong(10),i.setOffenceIdArray(t.offence),i.setDeffenceIdArray(t.deffence);var o=HawkProtocolManager.newBuilder("JsProto.HPMapBattleRequest");o.setBattleType(t.battleType),o.setBattleArgs(t.battleArgs),o.setMonsterCrowdIdx(this.crowdIndex),i.setBattleRequest(o),e.Message.instance.send(e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_REQUEST,i,!0)},t.prototype.setSceneTypeAndSceneId=function(e,t){this.sceneType=e,this.sceneId=t},t.prototype.setAlive=function(e){this.alive=e},t}();e.SceneManager=t,__reflect(t.prototype,"foxgame.SceneManager",["foxgame.IMessage"]);var i=function(){function e(){this.objectId=null,this.type=null,this.serverId=null,this.typeId=null,this.alive=null}return e}();__reflect(i.prototype,"SceneObjectData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.mapId=null,this.orientation=i.NONE,this.data=[[]],this.loaded=!1,this.tileWidthPixel=null,this.tileHeightPixel=null,this.mapWidthTile=null,this.mapHeightTile=null}return e.prototype.refreshMapId=function(e){(null==this.mapId||this.mapId!=e)&&(this.mapId=e,this.loaded=!1,this.loadTileData(this.mapId))},e.prototype.loadTileData=function(e){App.getResourceUtils().getResAsync("TiledMap_"+e+"_json",this.onLoadTileData,this)},e.prototype.onLoadTileData=function(e,t){t=="TiledMap_"+this.mapId+"_json"&&this.parseTileData(e)},e.prototype.parseTileData=function(e){if(e){"orthogonal"==e.orientation?this.orientation=i.NORMAL:"staggered"==e.orientation&&(this.orientation=i.SCREW),this.tileWidthPixel=e.tilewidth,this.tileHeightPixel=e.tileheight,this.mapWidthTile=e.width,this.mapHeightTile=e.height;for(var t=e.layers[0].data,n=0,o=0;n<t.length;)this.data[o]=t.slice(n,n+this.mapWidthTile),n+=this.mapWidthTile,o++;this.loaded=!0}},e.prototype.isPointPass=function(e,t){if(!this.loaded)return!0;var i=this.PixelToTile({x:e,y:t}),o=this.data[i.y]&&this.data[i.y][i.x];switch(o=o||n.PASS){case n.BARRIER:return!1;default:return!0}},e.prototype.isPointOpacity=function(e,t){if(!this.loaded)return!1;var i=this.PixelToTile({x:e,y:t}),o=this.data[i.y]&&this.data[i.y][i.x];switch(o=o||n.PASS){case n.TRANSLUCENCE:return!0;default:return!1}},e.prototype.PixelToTile=function(e){switch(this.orientation){case i.NORMAL:return this.PixelToTile_Normal(e);case i.SCREW:return this.PixelToTile_Screw(e)}},e.prototype.PixelToTile_Normal=function(e){var t={x:0,y:0};return t.x=Math.floor(1*e.x/this.tileWidthPixel+.5),t.y=Math.floor(1*e.y/this.tileHeightPixel+.5),t},e.prototype.PixelToTile_Screw=function(e){return this.PixelToTile_Transform_Screw_temp(e,this.tileWidthPixel,this.tileHeightPixel)},e.prototype.TileToPixel=function(e){var t={x:0,y:0};return t},e.prototype.PixelToTile_Transform_Screw_temp=function(e,t,i){var n=Math.floor(2*e.y/i)*i/2,o=Math.floor(2*e.x/t)*t/2,a={x:0,y:0},s={x:0,y:0};Math.floor(2*e.y/i)%2==0&&Math.floor(2*e.x/t)%2==0||Math.floor(2*e.y/i)%2==1&&Math.floor(2*e.x/t)%2==1?(a.x=o,a.y=n,s.x=o+t/2,s.y=n+i/2):(a.x=o,a.y=n+i/2,s.x=o+t/2,s.y=n);var r={x:0,y:0};return a.x-e.x+a.y-e.y<=s.x-e.x+s.y-e.y?(r.x=Math.round(a.x/t)-1,r.y=2*a.y/i-1):(r.x=Math.round(s.x/t)-1,r.y=2*s.y/i-1),r},e}();e.TileData=t,__reflect(t.prototype,"foxgame.TileData");var i;!function(e){e[e.NONE=0]="NONE",e[e.NORMAL=1]="NORMAL",e[e.SCREW=2]="SCREW"}(i||(i={}));var n;!function(e){e[e.PASS=0]="PASS",e[e.BARRIER=1]="BARRIER",e[e.TRANSLUCENCE=2]="TRANSLUCENCE",e[e.SAFE_AREA=3]="SAFE_AREA"
}(n||(n={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.mcObject=null,n.parent=null,n.playComplete=null,n.compObject=null,n.aniCache=!0,n.cacheTimeMs=1e3,n.resGroupLoadPriority=e.Global.LoadFoxAniResPriority,n.offsetX=0,n.offsetY=0,n.scaleX=1,n.scaleY=1,n.anchorOffsetX=0,n.anchorOffsetY=0,n.anchorCenter=!1,n.frameRate=0,n.totalPlayCount=-1,n.callFrame=0,n.parent=i,n}return __extends(i,t),i.prototype.cacheTime=function(e){e>=0&&(this.cacheTimeMs=e)},i.prototype.setResGroupLoadPriority=function(e){this.resGroupLoadPriority=e},i.prototype.preload=function(t){var i=e.AniManager.instance;i.loadAniRes(t)},i.prototype.play=function(t,i,n){if(void 0===i&&(i="ani"),void 0===n&&(n=-1),void 0!=this.parent&&null!=this.parent){if(!t||!i)return void Log.trace("FoxAni play id or aniName null");this.resId&&this.resId!=t&&this.innerClearRes(),this.resId=t,null==this.mcObject&&(this.mcObject=new egret.MovieClip,this.parent.addChild(this.mcObject)),this.mcName=i,this.mcObject.name=i,this.totalPlayCount=n;var o=e.AniManager.instance;o.isResLoaded(this.resId)?o.play(this):o.playAsync(this)}},i.prototype.startPlay=function(){null!=this.mcObject&&(this.mcObject.visible=!0,this.applySetting(),this.playComplete&&this.mcObject.addEventListener(egret.Event.COMPLETE,this.playAnimComplete,this),this.frameName?this.mcObject.gotoAndPlay(this.frameName,this.totalPlayCount):this.mcObject.play(this.totalPlayCount))},i.prototype.playAnimComplete=function(e){this.playComplete.call(this.compObject,this.compData),this.mcObject&&this.mcObject.removeEventListener(egret.Event.COMPLETE,this.playAnimComplete,this)},i.prototype.applySetting=function(){this.anchorCenter&&(this.offsetX=-this.mcObject.width/2,this.offsetY=-this.mcObject.height/2),this.mcObject.x=this.offsetX,this.mcObject.y=this.offsetY,this.mcObject.scaleX=this.scaleX,this.mcObject.scaleY=this.scaleY,this.frameRate>0&&(this.mcObject.frameRate=this.frameRate),this.mcObject.anchorOffsetX=this.anchorOffsetX,this.mcObject.anchorOffsetY=this.anchorOffsetY},i.prototype.stop=function(){this.mcObject&&(this.mcObject.stop(),this.mcObject.visible=!1)},i.prototype.gotoAndStop=function(e){this.mcObject&&this.mcObject.gotoAndStop(e)},i.prototype.setPlayComplete=function(e,t,i){void 0===i&&(i=null),this.playComplete=e,this.compObject=t,this.compData=i},Object.defineProperty(i.prototype,"isPlay",{get:function(){return null!=this.mcObject?this.mcObject.isPlaying:!1},enumerable:!0,configurable:!0}),i.prototype.clear=function(){this.dispose()},i.prototype.innerClearRes=function(t){void 0===t&&(t=!1),this.resId&&this.mcObject&&(this.stop(),App.DisplayUtils().removeFromParent(this.mcObject),this.playComplete&&this.mcObject&&this.mcObject.removeEventListener(egret.Event.COMPLETE,this.playAnimComplete,this),this.mcObject&&(this.mcObject.visible=!1,this.mcObject.$texture=null),t||!this.aniCache?e.AniManager.instance.pushToDestroyQueue(this.resId,0,this):e.AniManager.instance.pushToDestroyQueue(this.resId,this.cacheTimeMs,this),e.AniManager.instance.removeFA(this),this.mcObject=null,this.resId=null,this.playComplete=null,this.compObject=null,this.compData=null)},i.prototype.dispose=function(e){void 0===e&&(e=!1),this.resId&&this.mcObject&&(this.innerClearRes(e),this.playComplete=null,this.compObject=null,this.parent=null,this.mcObject=null,this.compData=null,this.resId=null)},i.prototype.remove=function(){this.stop(),App.DisplayUtils().removeFromParent(this.mcObject),this.playComplete&&this.mcObject&&this.mcObject.removeEventListener(egret.Event.COMPLETE,this.playAnimComplete,this),this.mcObject&&(this.mcObject.visible=!1,this.mcObject.$texture=null),e.AniManager.instance.removeFA(this),this.playComplete=null,this.compObject=null,this.parent=null,this.mcObject=null,this.compData=null},i.prototype.removeFactoryCache=function(){e.AniManager.instance.removeAniFactory(this.resId),e.AniManager.instance.destroyAniRes(this.resId)},i}(egret.HashObject);e.FoxAni=t,__reflect(t.prototype,"foxgame.FoxAni",["foxgame.IDispose"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BattleUIRankItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.refresh()},t.prototype.refresh=function(){var e=this.data.rank;e&&(this.rank_Image.source="wb_rank"+e+"_png");var t=this.data.name;t&&(this.name_label.text=t);var i=this.data.description;i&&(this.description_label.text=i)},t}(eui.ItemRenderer);e.BattleUI_RankItem=t,__reflect(t.prototype,"foxgame.BattleUI_RankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function s(i){var n=t.call(this,i)||this;return n.equipGroupList=[],n.dropItemList={},n.guideMonster={},n.selfMonsterServerId=0,n.selfMonsterPlayerId=-1,n.robotMonsterServerId=0,n.robotMonsterPlayerId=-101,n.robotServerId=0,n.robotPlayerId=-201,n.aiMonsterServerId=0,n.aiMonsterPlayerId=-301,n.aiServerId=0,n.aiPlayerId=-401,n.guidePlayer={},n.pool_AIPlayer=[],n.guideStartId=0,n.aiCreateTimer=null,n.actorParent=e.MapViewportGroupManager.instance.sceneView.BattleUnitNode,n.aiMonster={},n.delayTimerList=[],n.hpTimerList=[],n.robotTimerList=[],n.robot={},n.missionIndex=0,n.missionId=null,n.isActorReady=!1,n.isMainRoleReady=!1,n.isOtherReady=!1,n.isGuideStart=!1,n.npcTipList={},n.curMap=a.NONE,n.newEquipIdList={},n.bossVsRobotTimer=null,n.ownSkill={},n.skinName="BattleUIGuideSkin",n.hide(),e.MainControler.instance.addChild(n),n}return __extends(s,t),s.prototype.init=function(){ScreenAdaptation.instance.adaptMask(this.mask_rect),this.mask_rect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMask,this),this.fetch_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnFetch,this);var t=new e.FoxAni(this.award_guangxiao_group);t.play("guideMission_guangxiao","guideMission_guangxiao",-1),this.start_game_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnStartGame,this),this.start_game_ani_group.scaleX=1.3;var i=new e.FoxAni(this.start_game_ani_group);i.play("GuideMission_start_btn","GuideMission_start_btn",-1),this.mission_click_image.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMission,this),this.mission_click_image0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMission,this);var n=new e.FoxAni(this.mission_guangxiao_group);n.play("guideMission_guangxiao","guideMission_guangxiao",-1),this.mission_label_mask_group.mask=new egret.Rectangle(0,0,this.mission_label_mask_group.width,this.mission_label_mask_group.height);var o=new e.FoxAni(this.mission_finish_tip_group);o.play("guideMission_finish_guangxiao","guideMission_finish_guangxiao",-1);var a=new e.FoxAni(this.auto_path_ani_group);a.play("guideMission_autoPath","guideMission_autoPath",-1);var s=this.fetch_tip_group.y;egret.Tween.get(this.fetch_tip_group,{loop:!0}).to({y:s-20},500).to({y:s},500);var r=this.mission_tip_group.y;egret.Tween.get(this.mission_tip_group,{loop:!0}).to({y:r-20},500).to({y:r},500);for(var l=0;3>l;l++){var h=new e.BattleUI_GuideEquip;this.equipGroupList.push(h),this.addChild(h)}this.isActorReady=null!=this.actorManager.mainActor,this.isMainRoleReady=null!=e.MainSceneManager.instance.mainRole},s.prototype.show=function(t){void 0===t&&(t=null),this.hide(),this.curMap=t.map,e.Message.instance.add(e.Code.MAINMISSION_BONUS_S_VALUE,this),e.Message.instance.add(e.MsgCMD.MAINCITY_CLICK_MAP,this),e.Message.instance.add(e.MsgCMD.MAINCITY_MAINROLE_CREATE,this),e.Message.instance.add(e.Code.EQUIP_INFO_SYNC_S,this),e.Message.instance.add(e.MsgCMD.PLAYER_LEVEL_UP,this),this.isGuideStart=!1,this.curMap==a.BATTLE?(e.Message.instance.add(e.MsgCMD.WELCOME_PANEL_CLOSE,this),e.WelcomeController.getInstance().showPanelGuide(),this.guideStartId=e.Global.GuideBattleStartIdForPlayer,this.startTimerAICreate(),this.createNormalRobot()):this.curMap==a.MAINCITY&&(this.guideStartId=e.Global.GuideMainSceneStartIdForPlayer,this.createMainCityNpcTip(),this.startSelfGuide(),this.createMainCityRobot()),e.GuideMission=!0},s.prototype.hide=function(t){if(void 0===t&&(t=null),e.Message.instance.remove(e.Code.MAINMISSION_BONUS_S_VALUE,this),e.Message.instance.remove(e.MsgCMD.MAINCITY_CLICK_MAP,this),e.Message.instance.remove(e.MsgCMD.MAINCITY_MAINROLE_CREATE,this),e.Message.instance.remove(e.Code.EQUIP_INFO_SYNC_S,this),e.Message.instance.remove(e.MsgCMD.PLAYER_LEVEL_UP,this),this.curMap==a.BATTLE){e.Message.instance.remove(e.MsgCMD.WELCOME_PANEL_CLOSE,this),this.stopTimerAICreate(),this.clearDelayTimer(),this.clearHPTimer(),this.clearRobotTimer();for(var i=0;i<this.equipGroupList.length;i++){var n=this.equipGroupList[i];n.dispose()}for(var i=0;i<this.pool_AIPlayer.length;i++){var o=this.pool_AIPlayer[i];o.dispose()}this.pool_AIPlayer=[];for(var i in this.guidePlayer){var o=this.guidePlayer[i];o.dispose(),delete this.guidePlayer[i]}for(var i in this.aiMonster){for(var s=this.aiMonster[i],r=0;r<s.length;r++)s[r]=null;delete this.aiMonster[i]}for(var i in this.robot){for(var l=this.robot[i],r=0;r<l.length;r++)l[r]=null;delete this.aiMonster[i]}this.bossVsRobotTimer&&(clearInterval(this.bossVsRobotTimer),this.bossVsRobotTimer=null)}else if(this.curMap==a.MAINCITY){this.clearDelayTimer();for(var i in this.npcTipList)this.npcTipList[i].dispose(),delete this.npcTipList[i];this.npcTipList={},this.removeMainCityRobot()}e.GuideMission=!1},s.prototype.dispose=function(){t.prototype.dispose.call(this)},s.prototype.refresh=function(e){void 0===e&&(e=null),this.show(e)},s.prototype.resize=function(){this.width=this.screenWidth,this.x=e.MainControler.instance.width/2-this.width/2},s.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.WELCOME_PANEL_CLOSE:this.isOtherReady=!0,this.startSelfGuide();break;case e.Code.MAINMISSION_BONUS_S_VALUE:e.LogUtil.getInstance().log("BattleUI_Guide","接收到领取任务奖励返回消息");break;case e.MsgCMD.MAINCITY_CLICK_MAP:this.stopAniAutoPath();break;case e.MsgCMD.MAINCITY_MAINROLE_CREATE:this.isMainRoleReady=!0,this.startSelfGuide();break;case e.Code.EQUIP_INFO_SYNC_S:this.onMsgNewEquip(i);break;case e.MsgCMD.PLAYER_LEVEL_UP:this.onMsgPlayerLevelUp(),e.PlayerService.instance.level==Number(e.GlobalConfig.instance.getValue("WANBA_QLD_AD_LIMIT_LEVEL"))&&e.WanbaQQVideoAdController.getInstance().sendMessageWanbaAdReq()}},s.prototype.onStopMove=function(){this.showMissionTip()},s.prototype.onClickMap=function(e,t){var i=this.guidePlayer[this.playerManager.playerId];(!i||i.guideState!=n.BATTLE&&i.guideState!=n.DROP)&&(this.stopAniAutoPath(),t())},s.prototype.showFetchAwardGroup=function(e,t,i){this.fetchCallback=i,this.showMask(),this.npc_image.source=e.image,this.npc_image.x=232-e.offset,Log.trace("tsc -- current : "+e.image),this.preloadNpcImage(e.QuestId+1),this.npc_name_label.text=e.name,this.mission_text_label.text=e.text;for(var n=0;n<e.awardOther.length;n++)this["mission_award_"+n].setItem(e.awardOther[n].id,e.awardOther[n].value),this["mission_award_"+n].visible=!0;for(e.awardEquip[t]&&(this["mission_award_"+n].setItem(e.awardEquip[t].id,e.awardEquip[t].value),this["mission_award_"+n].visible=!0,n++);3>n;n++)this["mission_award_"+n].visible=!1;this.startTimerFetch(),this.hideFinishMissionTip(),this.mission_finish_label.text=e.Tips||"",e.voice&&""!=e.voice&&(this.lastNpcSound&&(this.lastNpcSound.stop(),this.lastNpcSound=null),this.lastNpcSound=App.SoundManager().playEffect(e.voice)),this.fetch_award_group.visible=!0},s.prototype.preloadNpcImage=function(t){for(var i=e.JsonDataManager.instance.guideMissionTemplate;i[t];){if(i[t].image&&""!=i[t].image){this.npc_preload_image.source=i[t].image,Log.trace("tsc -- preload : "+i[t].image);break}t++}},s.prototype.hideFetchAwardGroup=function(){this.hideMask(),this.stopTimerFetch(),this.fetch_award_group.visible=!1},s.prototype.startTimerFetch=function(){this.stopTimerFetch(),this.fetchTimerTime=5,this.fetchTimer=setInterval(this.onTimerFetch.bind(this),1e3),this.onTimerFetch()},s.prototype.stopTimerFetch=function(){this.fetchTimer&&(clearInterval(this.fetchTimer),this.fetchTimer=null)},s.prototype.onTimerFetch=function(){this.fetchTimerTime>0?(this.fetch_time_label.text=this.fetchTimerTime+"s",this.fetchTimerTime--):(this.stopTimerFetch(),this.onBtnFetch())},s.prototype.onBtnFetch=function(){for(var t=0;3>t;t++){var i=this["mission_award_"+t];if(i&&1==i.visible)if(1004==i.itemId);else{var n=i.parent.localToGlobal(i.x,i.y);e.FlyController.getInstance().flyToBag(n,i.itemId,i.num)}}this.hideFetchAwardGroup(),this.playAniFinish(),this.showFinishMissionTip(),App.SoundManager().playEffect("guideMission_finish"),this.fetchCallback&&(this.fetchCallback(),this.fetchCallback=null)},s.prototype.showFinishMissionTip=function(){this.missionFinishTipTimer&&(clearTimeout(this.missionFinishTipTimer),this.missionFinishTipTimer=null),this.mission_finish_label.visible=!0,this.missionFinishTipTimer=setTimeout(this.hideFinishMissionTip.bind(this),2e3)},s.prototype.hideFinishMissionTip=function(){this.missionFinishTipTimer&&(clearTimeout(this.missionFinishTipTimer),this.missionFinishTipTimer=null),this.mission_finish_label.visible=!1},s.prototype.showSkillGroup=function(t,i){var n=e.JsonDataManager.instance.skillTemplate[t+"_"+i];this.skill_icon_image.source=n.icon,this.skill_name_label.text=n.skillName,egret.Tween.removeTweens(this.skill_group),egret.Tween.get(this.skill_group).to({x:-this.skill_group.width},0).to({x:this.width/2-this.skill_group.width/2},500,egret.Ease.backIn).wait(2e3).to({x:this.width},500,egret.Ease.backOut).call(this.hideSkillGroup,this),this.skill_group.visible=!0},s.prototype.hideSkillGroup=function(){this.skill_group.visible=!1},s.prototype.showStartGameGroup=function(){this.start_game_group.visible=!0,this.showMask()},s.prototype.hideStartGameGroup=function(){this.start_game_group.visible=!1,this.hideMask()},s.prototype.onBtnStartGame=function(){this.sceneManager.sendMsgSceneChangeRequest(e.WorldSceneType.OldMonsterBattleMap,0),this.hideStartGameGroup(),e.JsonDataManager.instance.nameTemplate=null,e.MtaUtils.notifyEvent("chuangjiaojinyo",{startnewguild:"true"})},s.prototype.showEquipGroup=function(e,t){for(var i=!1,n=0;n<this.equipGroupList.length;n++){var o=this.equipGroupList[n];o.visible?o.moveUp():i||(i=!0,o.refresh(e,t,5,this.sendMsgEquip.bind(this)),o.showWithAction(this.width-o.width,690))}},s.prototype.showMissionGroup=function(e){this.missionCallback=e,this.mission_group.visible=!0},s.prototype.hideMissionGroup=function(){this.missionCallback=null,this.mission_group.visible=!1},s.prototype.refreshMissionGroup=function(t,i){var o=t.guideId,a=t.guideState==n.FINISH,s=e.JsonDataManager.instance.mainMissionTemplate,r=s[o];if(r){if(this.missionId&&this.missionId==o){var l=this["mission_title_label"+this.missionIndex],h=this["mission_award_label"+this.missionIndex];a?(l.textFlow=new Array({text:r.name,style:{textColor:16750336}},{text:"(已完成)",style:{textColor:2227971}}),this.mission_finish_tip_group.visible=!0):(l.textFlow=new Array({text:r.name,style:{textColor:16750336}},{text:"(未完成)",style:{textColor:16711680}}),this.mission_finish_tip_group.visible=!1),h.text=i.target}else{this.playAniNew();var c=this.missionIndex;this.missionIndex=1-this.missionIndex;var l=this["mission_title_label"+this.missionIndex],h=this["mission_award_label"+this.missionIndex];a?(l.textFlow=new Array({text:r.name,style:{textColor:16750336}},{text:"(已完成)",style:{textColor:2227971}}),this.mission_finish_tip_group.visible=!0):(l.textFlow=new Array({text:r.name,style:{textColor:16750336}},{text:"(未完成)",style:{textColor:16711680}}),this.mission_finish_tip_group.visible=!1),h.text=i.target;var u=this["mission_label_group"+c],p=this["mission_label_group"+this.missionIndex];egret.Tween.removeTweens(u),egret.Tween.get(u).to({x:u.width},300,egret.Ease.sineIn),egret.Tween.removeTweens(p),egret.Tween.get(p).to({x:-u.width},0).to({x:0},300,egret.Ease.sineIn)}this.missionId=o}},s.prototype.showMissionTip=function(){this.mission_tip_group.visible=!0,this.mission_guangxiao_group.visible=!0},s.prototype.hideMissionTip=function(){this.mission_tip_group.visible=!1,this.mission_guangxiao_group.visible=!1},s.prototype.onBtnMission=function(){this.hideMissionTip();var t=this.guidePlayer[this.playerManager.playerId];if(t){if(t.guideState==n.BATTLE)return void e.PopUpController.getInstance().showFloatTextPanel1("正在清理怪物");if(t.guideState==n.DROP)return void e.PopUpController.getInstance().showFloatTextPanel1("正在拾取奖励")}this.missionCallback&&this.missionCallback()},s.prototype.playAniFinish=function(){this.finish_ani?(this.finish_ani.mcObject&&this.finish_ani.mcObject.gotoAndStop(0),this.finish_ani_group.visible=!0,this.finish_ani.play("complete","complete",1)):(this.finish_ani=new e.FoxAni(this.finish_ani_group),this.finish_ani.setPlayComplete(function(){this.finish_ani_group.visible=!1},this),this.finish_ani.play("complete","complete",1))},s.prototype.playAniNew=function(){this.new_ani?(this.new_ani.mcObject&&this.new_ani.mcObject.gotoAndStop(0),this.new_ani_group.visible=!0,this.new_ani.play("receive","receive",1)):(this.new_ani=new e.FoxAni(this.new_ani_group),this.new_ani.setPlayComplete(function(){this.new_ani_group.visible=!1},this),this.new_ani.play("receive","receive",1))},s.prototype.playAniAutoPath=function(){this.auto_path_ani_group.visible=!0},s.prototype.stopAniAutoPath=function(){this.auto_path_ani_group.visible=!1},s.prototype.playAniLevelUp=function(t){if(!t.isAI)if(t.levelUpAni)t.levelUpAni.mcObject&&t.levelUpAni.mcObject.gotoAndStop(0),t.levelUpAni.parent.visible=!0,t.levelUpAni.play("guideMission_levelUp","guideMission_levelUp",1);else{if(t.actor)t.levelUpAni=new e.FoxAni(t.actor.effectHeightNode);else{if(!t.people)return;t.levelUpAni=new e.FoxAni(t.people.mBuffEffect)}t.levelUpAni.setPlayComplete(function(){t.levelUpAni&&t.levelUpAni.parent&&(t.levelUpAni.parent.visible=!1)},this),t.levelUpAni.play("guideMission_levelUp","guideMission_levelUp",1)}},s.prototype.createGuideObject=function(t){var i=e.JsonDataManager.instance.guideMissionTemplate,n=null,a=null;for(var s in i)switch(n=Number(s),a=i[s],a.type){case o.SEARCH:break;case o.EQUIP:if(!this.dropItemList[n]){var r=new egret.Point(a.Waypoint[0],a.Waypoint[1]),l=e.DropItem.addDropItem({itemid:a.EquipmentId[t],countNum:1,oriPos:r,dstPos:r,callback:null});l.visible=!1,this.dropItemList[n]=l}break;case o.CROWD:if(!this.guideMonster[n]){for(var h=[],c=function(t){var i=new e.ActorInScene_Monster(null,null);i.simpleInitFromMonsterId(a.QuestMonsterID[t]),i.setModelControllerEnable(!0),i.maxHp=a.MonsterHp,i.x=a.QuestMonsterRefresh[t][0],i.y=a.QuestMonsterRefresh[t][1],i.roleBelongPlayerId=u.selfMonsterPlayerId,i.roleItemId=a.QuestMonsterID[t],i.visible=!1,u.actorParent.addChild(i);var n=[];n.push(new egret.Point(a.QuestMonsterRefresh[t][0],a.QuestMonsterRefresh[t][1])),n.push(new egret.Point(a.MonsterWaypoint[t][0],a.MonsterWaypoint[t][1]));var o=0,s=function(e){o=1-o;var t=3e3*Math.random();e.delayTimer=setTimeout(function(){delete e.delayTimer,e.moveToPosByLine(n[o],s,this,[e])}.bind(this),t)}.bind(u);s(i),h.push(i)},u=this,p=0;p<a.QuestMonsterID.length;p++)c(p);this.guideMonster[n]=h,this.actorManager.addActorToPlayer(this.selfMonsterServerId,this.selfMonsterPlayerId,e.RoleType.MONSTER,h)}break;case o.MONSTER:if(!this.guideMonster[n]){for(var h=[],g=function(t){var i=new e.ActorInScene_Monster(null,null);i.simpleInitFromMonsterId(a.QuestMonsterID[t]),i.setModelControllerEnable(!0),i.maxHp=a.MonsterHp,i.x=a.QuestMonsterRefresh[t][0],i.y=a.QuestMonsterRefresh[t][1],i.roleBelongPlayerId=d.selfMonsterPlayerId,i.roleItemId=a.QuestMonsterID[t],i.isBOSS=!0,i.showBossRing(e.BattleType.BATTLE_PVE_BOSS),i.visible=!1,d.actorParent.addChild(i);var n=[];n.push(new egret.Point(a.QuestMonsterRefresh[t][0],a.QuestMonsterRefresh[t][1])),n.push(new egret.Point(a.MonsterWaypoint[t][0],a.MonsterWaypoint[t][1]));var o=0,s=function(e){o=1-o;var t=3e3*Math.random();e.delayTimer=setTimeout(function(){delete e.delayTimer,e.moveToPosByLine(n[o],s,this,[e])}.bind(this),t)}.bind(d);s(i),h.push(i)},d=this,p=0;p<a.QuestMonsterID.length;p++)g(p);this.guideMonster[n]=h,this.actorManager.addActorToPlayer(this.selfMonsterServerId,this.selfMonsterPlayerId,e.RoleType.MONSTER,h)}break;case o.BOSS:if(!this.guideMonster[n]){for(var h=[],p=0;p<a.QuestMonsterID.length;p++){var f=new e.ActorInScene_Monster(null,null);f.simpleInitFromMonsterId(a.QuestMonsterID[p]),f.setModelControllerEnable(!0),f.maxHp=147e4,f.curHp=a.MonsterHp,f.updateHpWidget(),f.nameContainer.visible=!0,f.x=a.QuestMonsterRefresh[p][0],f.y=a.QuestMonsterRefresh[p][1],f.roleBelongPlayerId=this.selfMonsterPlayerId,f.roleItemId=a.QuestMonsterID[p],f.isBOSS=!0,f.showBossRing(e.BattleType.BATTLE_GUIDE),f.visible=!1,this.actorParent.addChild(f),h.push(f)}this.guideMonster[n]=h,this.actorManager.addActorToPlayer(this.selfMonsterServerId,this.selfMonsterPlayerId,e.RoleType.MONSTER,h)}break;case o.MAINCITY:}},s.prototype.startGuideByPlayerId=function(e){var t=this.guidePlayer[e];if(t){var i=t.guideId,n=t.guideState;t.guideId=null,t.guideState=null,this.setGuideIdStateByPlayerId(e,i,n)}},s.prototype.setGuideIdStateByPlayerId=function(t,i,n){var o=this.guidePlayer[t];if(o&&(o.guideId!=i||o.guideState!=n))if(o.isAI&&i==e.Global.GuideAllEndIdForAI)this.moveToSwitch(o);else if(o.isAI||this.curMap!=a.BATTLE||i!=e.Global.GuideMainSceneStartIdForPlayer)if(o.isAI||this.curMap!=a.MAINCITY||i!=e.Global.GuideAllEndIdForPlayer){o.guideId=i,o.guideState=n;var s=e.JsonDataManager.instance.guideMissionTemplate,r=s[o.guideId];if(!r)return;o.isAI?this.refreshGuideStateForAI(o,r):(this.refreshMissionGroup(o,r),this.refreshGuideObject(o),this.refreshGuideStateForPlayer(o,r))}else this.hideMissionGroup(),this.showStartGameGroup();else this.moveToSwitch(o)},s.prototype.refreshGuideObject=function(t){var i=e.JsonDataManager.instance.guideMissionTemplate,a=null,s=null;for(var r in i)switch(a=Number(r),s=i[r],s.type){case o.SEARCH:break;case o.EQUIP:t.guideId>a||t.guideId==a&&t.guideState==n.FINISH?this.dropItemList[a]&&(this.dropItemList[a].visible=!1):this.dropItemList[a]&&(this.dropItemList[a].visible=!0);break;case o.CROWD:if(t.guideId>a||t.guideId==a&&(t.guideState==n.DROP||t.guideState==n.FINISH)){if(this.guideMonster[a])for(var l=0;l<this.guideMonster[a].length;l++)this.guideMonster[a][l].visible=!1}else if(this.guideMonster[a])for(var l=0;l<this.guideMonster[a].length;l++)this.guideMonster[a][l].visible=!0;break;case o.MONSTER:if(t.guideId>a||t.guideId==a&&(t.guideState==n.DROP||t.guideState==n.FINISH)){if(this.guideMonster[a])for(var l=0;l<this.guideMonster[a].length;l++)this.guideMonster[a][l].visible=!1}else if(this.guideMonster[a])for(var l=0;l<this.guideMonster[a].length;l++)this.guideMonster[a][l].visible=!0;break;case o.BOSS:if(t.guideId>a||t.guideId==a&&(t.guideState==n.DROP||t.guideState==n.FINISH)){if(this.guideMonster[a])for(var l=0;l<this.guideMonster[a].length;l++)this.guideMonster[a][l].visible=!1}else if(this.guideMonster[a])for(var l=0;l<this.guideMonster[a].length;l++)this.guideMonster[a][l].visible=!0;break;case o.MAINCITY:}},s.prototype.refreshGuideStateForPlayer=function(t,i){switch(i.type){case o.SEARCH:switch(t.guideState){case n.ACCEPT:this.playAniAutoPath();var a=new egret.Point(i.Waypoint[0],i.Waypoint[1]);this.mapManager.onTouch(a,function(){var e=setTimeout(function(){this.popDelayTimer(e),this.sendMsgFinishMission(t.guideId),this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH)}.bind(this),1e3);this.pushDelayTimer(e)}.bind(this));break;case n.FINISH:this.stopAniAutoPath(),this.showTipMissionFinish(i,t)}break;case o.EQUIP:switch(t.guideState){case n.ACCEPT:this.playAniAutoPath();var a=new egret.Point(i.Waypoint[0],i.Waypoint[1]);this.mapManager.onTouch(a,function(){var e=setTimeout(function(){this.popDelayTimer(e),this.sendMsgGetMissionItem(t.guideId),this.sendMsgFinishMission(t.guideId),this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH)}.bind(this),1e3);this.pushDelayTimer(e)}.bind(this));break;case n.FINISH:this.stopAniAutoPath(),this.fetchMissionAward(t)}break;case o.CROWD:switch(t.guideState){case n.ACCEPT:this.playAniAutoPath();var a=new egret.Point(i.AttackPonit[0],i.AttackPonit[1]);this.mapManager.onTouch(a,function(){this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.BATTLE)}.bind(this));break;case n.BATTLE:this.stopAniAutoPath(),this.onBattle(t,i);break;case n.DROP:this.stopAniAutoPath(),this.sendMsgFinishMission(t.guideId),this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH);break;case n.FINISH:this.playAniAutoPath();var a=new egret.Point(i.Waypoint[0],i.Waypoint[1]);this.mapManager.onTouch(a,function(){this.stopAniAutoPath(),this.showTipMissionFinish(i,t)}.bind(this))}break;case o.MONSTER:switch(t.guideState){case n.ACCEPT:this.playAniAutoPath();var a=new egret.Point(i.AttackPonit[0],i.AttackPonit[1]);this.mapManager.onTouch(a,function(){this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.BATTLE)}.bind(this));break;case n.BATTLE:this.stopAniAutoPath(),this.onBattle(t,i);break;case n.DROP:this.stopAniAutoPath(),this.sendMsgGetMissionItem(t.guideId),this.sendMsgFinishMission(t.guideId),this.onDrop(t,i);break;case n.FINISH:this.playAniAutoPath();var a=new egret.Point(i.Waypoint[0],i.Waypoint[1]);this.mapManager.onTouch(a,function(){this.stopAniAutoPath(),this.showTipMissionFinish(i,t)}.bind(this))}break;case o.BOSS:switch(t.guideState){case n.ACCEPT:this.playAniAutoPath();var a=new egret.Point(i.AttackPonit[0],i.AttackPonit[1]);this.mapManager.onTouch(a,function(){this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.BATTLE)}.bind(this));break;case n.BATTLE:this.stopAniAutoPath(),this.bossVsRobotTimer&&(clearInterval(this.bossVsRobotTimer),this.bossVsRobotTimer=null),this.onBattle(t,i);break;case n.DROP:this.stopAniAutoPath(),this.sendMsgGetMissionItem(t.guideId),this.sendMsgFinishMission(t.guideId),this.bossRobotTrans(),this.onDrop(t,i);break;case n.FINISH:this.playAniAutoPath();var a=new egret.Point(i.Waypoint[0],i.Waypoint[1]);this.mapManager.onTouch(a,function(){this.stopAniAutoPath(),this.showTipMissionFinish(i,t)}.bind(this))}break;case o.MAINCITY:switch(t.guideState){case n.ACCEPT:this.playAniAutoPath(),null!=this.npcTipList[t.guideId]&&null!=this.npcTipList[t.guideId].parent&&(this.npcTipList[t.guideId].parent.visible=!0);var a=new egret.Point(i.Waypoint[0],i.Waypoint[1]),s=e.MapViewportGroupManager.instance.mapView.mainTiledMap.SpaceToTiled(a);t.people.MovePos(s,function(){var e=setTimeout(function(){this.popDelayTimer(e),this.sendMsgFinishMission(t.guideId),this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH)}.bind(this),1e3);this.pushDelayTimer(e)}.bind(this));break;case n.FINISH:this.stopAniAutoPath(),this.showTipMissionFinish(i,t)}}},s.prototype.refreshGuideStateForAI=function(e,t){switch(t.type){case o.SEARCH:switch(e.guideState){case n.ACCEPT:var i=new egret.Point(t.Waypoint[0],t.Waypoint[1]);e.actor.moveToPosByLine(i,function(){var t=setTimeout(function(){this.popDelayTimer(t),this.setGuideIdStateByPlayerId(e.playerId,e.guideId,n.FINISH)}.bind(this),1e3);this.pushDelayTimer(t)}.bind(this),null,null);break;case n.FINISH:this.fetchMissionAward(e)}break;case o.EQUIP:switch(e.guideState){case n.ACCEPT:var i=new egret.Point(t.Waypoint[0],t.Waypoint[1]);e.actor.moveToPosByLine(i,function(){var i=setTimeout(function(){this.popDelayTimer(i),this.onEquipTask(e,t),this.setGuideIdStateByPlayerId(e.playerId,e.guideId,n.FINISH)}.bind(this),1e3);this.pushDelayTimer(i)}.bind(this),null,null);break;case n.FINISH:this.fetchMissionAward(e)}break;case o.CROWD:switch(e.guideState){case n.ACCEPT:var i=new egret.Point(t.AttackPonit[0],t.AttackPonit[1]);e.actor.moveToPosByLine(i,function(){var t=setTimeout(function(){this.popDelayTimer(t),this.setGuideIdStateByPlayerId(e.playerId,e.guideId,n.BATTLE)}.bind(this),1e3);this.pushDelayTimer(t)}.bind(this),null,null);break;case n.BATTLE:this.onBattle(e,t);break;case n.FINISH:var i=new egret.Point(t.Waypoint[0],t.Waypoint[1]);e.actor.moveToPosByLine(i,function(){var t=setTimeout(function(){this.popDelayTimer(t),this.fetchMissionAward(e)}.bind(this),1e3);this.pushDelayTimer(t)}.bind(this),null,null)}break;case o.MONSTER:switch(e.guideState){case n.ACCEPT:var i=new egret.Point(t.Waypoint[0],t.Waypoint[1]);e.actor.moveToPosByLine(i,function(){var t=setTimeout(function(){this.popDelayTimer(t),this.fetchMissionAward(e)}.bind(this),1e3);this.pushDelayTimer(t)}.bind(this),null,null)}break;case o.BOSS:switch(e.guideState){case n.ACCEPT:var i=new egret.Point(t.Waypoint[0],t.Waypoint[1]);e.actor.moveToPosByLine(i,function(){var t=setTimeout(function(){this.popDelayTimer(t),this.fetchMissionAward(e)}.bind(this),1e3);this.pushDelayTimer(t)}.bind(this),null,null)}}},s.prototype.showTipMissionFinish=function(e,t){this.showFetchAwardGroup(e,t.typeId,function(){this.fetchMissionAward(t)}.bind(this))},s.prototype.fetchMissionAward=function(t){var i=e.JsonDataManager.instance.guideMissionTemplate,o=i[t.guideId];if(o){this.curMap==a.MAINCITY&&null!=this.npcTipList[t.guideId]&&null!=this.npcTipList[t.guideId].parent&&(this.npcTipList[t.guideId].parent.visible=!1),t.isAI||this.sendMsgFetchAward(t.guideId);var s=o.awardEquip[t.typeId];s&&this.onEquipAward(t,s.id),this.setGuideIdStateByPlayerId(t.playerId,t.guideId+1,n.ACCEPT)}},s.prototype.onEquipAward=function(e,t){e.isAI?this.onEquip(e,t):this.needShowEquip(t)},s.prototype.onEquipTask=function(t,i){var n=i.EquipmentId[t.typeId];if(t.isAI)this.onEquip(t,n);else{var o=e.JsonDataManager.instance.equipTemplate,a=o[n],s=HawkProtocolManager.newBuilder("JsProto.HPEquipDress");s.setEquipId(n),s.setRoleId(t.actor.roleId),s.setPart(a.partList[0]),e.Message.instance.send(e.Code.EQUIP_DRESS_C,s,!0)}},s.prototype.onEquip=function(e,t){var i=Math.floor(t%1e3/100),n=e.simpleRole.getEquipIds(),o=e.equip[i];if(o){var a=n.indexOf(o);n.splice(a,1)}n.push(t),e.equip[i]=t,e.actor.updateFromSimpleRole(e.simpleRole)},s.prototype.moveToSwitch=function(t){var i=new egret.Point(this.mapManager.switchList[1].x,this.mapManager.switchList[1].y);t.actor.moveToPosByLine(i,function(){t.isAI?this.pushAIActor(t):this.sceneManager.sendMsgSceneChangeRequest(e.WorldSceneType.OldMonsterBattleMap,0)}.bind(this),null,null)},s.prototype.startTimerAICreate=function(){this.stopTimerAICreate(),this.aiCreateTimer=setInterval(this.onTimerAICreate.bind(this),6e3),this.onTimerAICreate()},s.prototype.stopTimerAICreate=function(){this.aiCreateTimer&&(clearInterval(this.aiCreateTimer),this.aiCreateTimer=null)},s.prototype.onTimerAICreate=function(){var e=this.popAIPlayer();e.actor.x=this.mapManager.switchList[0].x,e.actor.y=this.mapManager.switchList[0].y,e.actor.alpha=0,e.actor.roleName=this.getAIName(e.actor.roleSex),e.actor.nameTextField.text=e.actor.roleName,e.simpleRole.setName(e.actor.roleName),e.actor.visible=!0,e.actor.tw||e.actor.setTweenObject(),e.actor.tw.to({alpha:1},500),e.guideId=this.guideStartId,e.guideState=n.ACCEPT,this.startGuideByPlayerId(e.playerId)},s.prototype.popAIPlayer=function(){if(this.pool_AIPlayer.length>0){var t=this.pool_AIPlayer.pop();return t.simpleRole.setEquipIds([]),t.equip={},t.actor.updateFromSimpleRole(t.simpleRole),t.actor.weaponClip.$texture&&(t.actor.weaponClip.$texture=null),t.actor.isDead=!1,t}var t=new i;t.playerId=this.aiPlayerId--,t.isAI=!0;var n=Math.floor(6*Math.random()+1),o=HawkProtocolManager.newBuilder("JsProto.SimpleRole");o.setName(""),o.setLevel(1),o.setCurrHp(1),o.setMaxHp(1),o.setRoleItemId(n),o.setType(e.RoleType.MAIN_ROLE),t.simpleRole=o;var a=new e.ActorInScene_Role(null);return a.simpleInitFromSimpleRole(o),a.roleItemId=n,a.setModelControllerEnable(!0),a.effectEnable=!1,a.showNameTitle(),a.roleBelongPlayerId=t.playerId,this.actorParent.addChild(a),this.actorManager.addActorToPlayer(this.aiServerId,t.playerId,e.RoleType.MAIN_ROLE,[a]),t.actor=a,t.typeId=(n-1)%3+1,this.guidePlayer[t.playerId]=t,t},s.prototype.pushAIActor=function(e){-1==this.pool_AIPlayer.indexOf(e)&&(e.actor.isDead=!0,e.actor.visible=!1,e.actor.stopMove(),this.pool_AIPlayer.push(e))},s.prototype.getAIName=function(t){var i=e.JsonDataManager.instance.nameTemplate,n=i.length,o=i[Math.floor(Math.random()*n)],a=i[Math.floor(Math.random()*n)];
return 1==t?o.firstName+a.manName:o.firstName+a.womanName},s.prototype.createNormalRobot=function(){var t,i=e.JsonDataManager.instance.guideMissionRobotTemplate,n=e.JsonDataManager.instance.monster,o=function(o){if(t=i[2][o],0!=Number(o)){var s=Math.floor(Math.random()*t.length),r=t[s],l=a.robotMonsterPlayerId--,h=new e.ActorInScene_Monster(null,null);h.simpleInitFromMonsterId(r.MonsterId),h.roleItemId=r.MonsterId,h.maxHp=1,h.curHp=1,h.x=r.npcMonsterRefresh[0],h.y=r.npcMonsterRefresh[1],h.roleBelongPlayerId=l,a.actorParent.addChild(h),a.actorManager.addActorToPlayer(a.robotMonsterServerId,l,e.RoleType.MONSTER,[h]);var c=r.itemId,u=HawkProtocolManager.newBuilder("JsProto.SimpleRole");u.setName(r.name),u.setLevel(1),u.setCurrHp(1),u.setMaxHp(1),r.fashionCloth&&u.setFashionClothesId(r.fashionCloth),r.fashionWeapon&&u.setFashionWeaponId(r.fashionWeapon),u.setEquipIds(r.equipIds),u.setWingItemId(r.wing),r.wardLevel&&(u.setWardState(!0),u.setWardLevel(r.wardLevel)),r.armorLevel&&(u.setDragonArmourShowGuard(!0),u.setDragonArmourGuardLevel(r.armorLevel)),u.setTitleId(r.titleId),u.setRoleItemId(c),u.setType(e.RoleType.MAIN_ROLE);var p=new e.ActorInScene_Role(null);p.simpleInitFromSimpleRole(u),p.roleItemId=c,p.setModelControllerEnable(!0),p.effectEnable=!1,p.roleBelongPlayerId=a.robotPlayerId--,p.x=r.npcRefresh[0],p.y=r.npcRefresh[1],p.showNameTitle(),a.robot[o]=[p],a.actorParent.addChild(p),a.actorManager.addActorToPlayer(a.robotServerId,p.roleBelongPlayerId,e.RoleType.MAIN_ROLE,[p]),h.direction=e.Astar.instance.judgeNextDirection(h.getPosition(),p.getPosition()),h.setModelControllerEnable(!0),h.showNameTitle();var g,d=n[h.roleItemId];if(d){var f=d.skills,m=f.split(",");m.length>0&&(g=Number(m[0]))}if(g){var y=setTimeout(function(){this.popDelayTimer(y);var e=setInterval(function(){h.playSkillTarget(g,[p],null,null,null)}.bind(this),1e3);this.pushRobotTimer(e)}.bind(a),100*s+200);a.pushDelayTimer(y)}var I=setTimeout(function(){this.popDelayTimer(I);var e=setInterval(function(){p.playSkillTarget(r.skill,[h],null,null,null)}.bind(this),1e3);this.pushRobotTimer(e)}.bind(a),100*s);a.pushDelayTimer(I)}},a=this;for(var s in i[2])o(s)},s.prototype.createBossRobot=function(){this.robot[0]=[];var t=e.JsonDataManager.instance.guideMissionRobotTemplate,i=t[1][0],n=null,a=null,s=e.JsonDataManager.instance.guideMissionTemplate;for(var r in this.guideMonster)if(s[r].type==o.BOSS){a=this.guideMonster[r][0];break}if(a){for(var l=function(t){n=i[t];var o=n.itemId,s=HawkProtocolManager.newBuilder("JsProto.SimpleRole");s.setName(n.name),s.setLevel(1),s.setCurrHp(1),s.setMaxHp(1),s.setEquipIds(n.equipIds),s.setWingItemId(n.wing),s.setTitleId(n.titleId),s.setRoleItemId(o),s.setType(e.RoleType.MAIN_ROLE);var r=new e.ActorInScene_Role(null);r.simpleInitFromSimpleRole(s),r.effectEnable=!1,r.roleItemId=o,r.setModelControllerEnable(!0),r.roleBelongPlayerId=h.robotPlayerId--,r.x=n.npcRefresh[0],r.y=n.npcRefresh[1],r.modelLoaded=null,r.showNameTitle(),h.robot[0].push(r),h.actorParent.addChild(r),h.actorManager.addActorToPlayer(h.robotServerId,r.roleBelongPlayerId,e.RoleType.MAIN_ROLE,[r]);var l=setTimeout(function(){this.popDelayTimer(l);var e=setInterval(function(){r.playSkillTarget(n.skill,[a],null,null,null)}.bind(this),600);this.pushRobotTimer(e),r.skillTimer=e}.bind(h),1e3*t);h.pushDelayTimer(l)},h=this,c=0;c<i.length;c++)l(c);var u,p=e.JsonDataManager.instance.monster[a.roleItemId];if(p){var g=p.skills,d=g.split(",");d.length>0&&(u=Number(d[0]))}u&&(this.bossVsRobotTimer&&(clearInterval(this.bossVsRobotTimer),this.bossVsRobotTimer=null),this.bossVsRobotTimer=setInterval(function(){a.playSkillTarget(u,[this.robot[0][0]],null,null,null)}.bind(this),1e3))}},s.prototype.bossRobotTrans=function(){for(var e=this.robot[0],t=new egret.Point(this.mapManager.switchList[1].x,this.mapManager.switchList[1].y),i=function(i){var o=e[i],a=o.skillTimer;a&&(clearInterval(a),n.popRobotTimer(a),delete o.skillTimer),o.stopMove(!0),o.moveToPosByLine(t,function(){o.isDead=!0,o.visible=!1},n,null)},n=this,o=0;o<e.length;o++)i(o)},s.prototype.createMainCityRobot=function(){var t,i=-1,n=e.JsonDataManager.instance.guideMissionMainCityRobotTemplate;for(var o in n){t=n[o];var a=Math.floor(Math.random()*t.length),s=t[a],r=HawkProtocolManager.newBuilder("JsProto.HPMapPlayerEnter"),l=HawkProtocolManager.newBuilder("JsProto.PosInfo"),h=e.CommonUtils.randomModelObjectOneDirection();l.setDirection(h),l.setX(s.npcRefresh[0]),l.setY(s.npcRefresh[1]),r.setCurPos(l);var c=HawkProtocolManager.newBuilder("JsProto.MapPlayer");c.setCurHp(s.hp),c.setMaxHp(s.hp),c.setPlayerId(i),c.setPlayerName(s.name),c.setTitleId(s.titleId),c.setEquipItemId(s.equipId),c.setWeaponItemId(s.weaponId),c.setRoleItemId(s.itemId),c.setWingItemId(s.wing),r.setPlayerInfo(c);var u=new e.PlayerData(r),p=new e.People(e.MapViewportGroupManager.instance.sceneView.MainScenePeopleNode,u,u.curPos,!1,e.MapViewportGroupManager.instance.sceneView.MSceneSkillNode,e.MapViewportGroupManager.instance.mapView.mainTiledMap);p.mActionController&&p.mActionController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_IDLE,h),e.MainSceneManager.instance.mainOtherRole.put(i,p),i--}},s.prototype.removeMainCityRobot=function(){for(var t=e.MainSceneManager.instance.mainOtherRole.keys(),i=0;i<t.length;i++){var n=Number(t[i]);0>n&&e.MainSceneManager.instance.removeFromPlayerId(n)}},s.prototype.createMainCityNpcTip=function(){var t=e.JsonDataManager.instance.guideMissionTemplate,i=null,n=null,a=e.MapViewportGroupManager.instance.sceneView.MainRoot;for(var s in t)switch(i=Number(s),n=t[s],n.type){case o.MAINCITY:var r=new eui.Group;r.x=n.QuestMonsterRefresh[0][0],r.y=n.QuestMonsterRefresh[0][1],r.visible=!1,a.addChild(r);var l=new e.FoxAni(r);l.play("guideMission_npc_tip","guideMission_npc_tip",-1),this.npcTipList[i]=l}},s.prototype.onBattle=function(e,t){t.EquipmentId[e.typeId];e.isAI?(this.prepareMonsterForAI(e,t),this.playSkill(e,t,0)):(this.prepareMonsterForPlayer(e,t),this.playSkill(e,t,0))},s.prototype.prepareMonsterForAI=function(t,i){var n=this.aiMonster[t.guideId];if(n)for(var a=0;a<n.length;a++){var s=n[a];s.curHp=s.maxHp,s.updateHpWidget(),s.direction=e.Astar.instance.judgeNextDirection(s.getPosition(),t.actor.getPosition()),s.setStateIdle(),i.type==o.MONSTER&&(s.isBOSS=!0,s.showBossRing(e.BattleType.BATTLE_PVE_BOSS)),s.alpha=0,s.isDead=!1,s.visible=!0,s.tw||s.setTweenObject(),s.tw.to({alpha:1},200)}else{n=[];for(var r=this.aiMonsterPlayerId--,a=0;a<i.AIMonsterRefresh.length;a++){var s=new e.ActorInScene_Monster(null,null);s.simpleInitFromMonsterId(i.QuestMonsterID[a]),s.x=i.AIMonsterRefresh[a][0],s.y=i.AIMonsterRefresh[a][1],s.direction=e.Astar.instance.judgeNextDirection(s.getPosition(),t.actor.getPosition()),s.setModelControllerEnable(!0),s.setStateIdle(),s.maxHp=i.MonsterHp,s.curHp=s.maxHp,s.updateHpWidget(),s.nameContainer.visible=!0,s.roleBelongPlayerId=r,s.roleItemId=i.QuestMonsterID[a],s.alpha=0,this.actorParent.addChild(s),s.tw||s.setTweenObject(),s.tw.to({alpha:1},200),n.push(s)}this.aiMonster[t.guideId]=n,this.actorManager.addActorToPlayer(this.aiMonsterServerId,r,e.RoleType.MONSTER,n)}},s.prototype.prepareMonsterForPlayer=function(t,i){for(var n=this.guideMonster[t.guideId],o=0;o<n.length;o++){var a=n[o];a.curHp=a.maxHp,a.updateHpWidget(),a.nameContainer.visible=!0,a.direction=e.Astar.instance.judgeNextDirection(a.getPosition(),t.actor.getPosition()),a.setStateIdle(),a.delayTimer&&(clearTimeout(a.delayTimer),delete a.delayTimer),a.stopMove(!0)}},s.prototype.playSkill=function(t,i,a){var s=[];s=t.isAI?this.aiMonster[t.guideId]:this.guideMonster[t.guideId];for(var r=null,l=0;l<s.length;l++)if(!s[l].isDead){r=s[l];break}if(r){if(!i.SkillId[t.typeId]){var h=e.GamePlatform.logDomain;e.GameUtils.httpSend(h,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID(),channelid:"qqgame",level:"1",typeId:t.typeId,skillId:i.SkillId[t.typeId].toString(),guideData:i.SkillId,text:i.text},what:"play_skill",who:e.UserInfo.platform.getPuid()})),console.log("为空的"+i.SkillId)}var c=i.SkillId[t.typeId]&&i.SkillId[t.typeId].length;a%=c;var u=i.SkillId[t.typeId][a];t.actor.stopMove(),t.actor.playSkillTarget(u,[r],this.setMonsterHp,this,[t,i,r,a]);var p=e.JsonDataManager.instance.monster[r.roleItemId];if(p){var g=p.skills,d=g.split(",");d&&d.length>0&&r.playSkillTarget(Number(d[0]),[t.actor],null,null,null)}t.skillTimer=setTimeout(function(){t.skillTimer=null,this.playSkill(t,i,++a)}.bind(this),1e3)}else t.isAI?this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH):i.type==o.CROWD||i.type==o.MONSTER||i.type==o.BOSS?this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.DROP):this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH)},s.prototype.setMonsterHp=function(t,i,n,o){if(n){var a=i.SkillId[t.typeId].length,s=Math.floor(i.MonsterHp/a),r=s*(a-o-1);n.curHp=r,n.updateHpWidget(),new e.BattleMoveText(n.getPosition(),s.toString(),e.SkillEffect.CRIT_DMG,0,0),0==r&&(n.isDead=!0,egret.Tween.get(n).to({alpha:0},300).to({visible:!1},0))}},s.prototype.playSkillAll=function(t,i,a){var s=i.SkillId[t.typeId][a];if(!s)return void(t.isAI?this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH):i.type==o.BOSS?this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.DROP):this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH));if(t.isAI){var r=this.aiMonster[t.guideId];if(r){if(0==a)for(var l=0;l<r.length;l++){var h=r[l];h.curHp=h.maxHp,h.updateHpWidget(),h.direction=e.Astar.instance.judgeNextDirection(h.getPosition(),t.actor.getPosition()),h.setStateIdle(),i.type==o.MONSTER&&(h.isBOSS=!0,h.showBossRing(e.BattleType.BATTLE_PVE_BOSS)),h.alpha=0,h.isDead=!1,h.visible=!0,h.tw||h.setTweenObject(),h.tw.to({alpha:1},200)}}else{r=[];for(var c=this.aiMonsterPlayerId--,l=0;l<i.AIMonsterRefresh.length;l++){var h=new e.ActorInScene_Monster(null,null);h.simpleInitFromMonsterId(i.QuestMonsterID[l]),h.x=i.AIMonsterRefresh[l][0],h.y=i.AIMonsterRefresh[l][1],h.direction=e.Astar.instance.judgeNextDirection(h.getPosition(),t.actor.getPosition()),h.setModelControllerEnable(!0),h.setStateIdle(),h.maxHp=i.MonsterHp,h.curHp=h.maxHp,h.updateHpWidget(),h.nameContainer.visible=!0,h.roleBelongPlayerId=c,h.alpha=0,this.actorParent.addChild(h),h.tw||h.setTweenObject(),h.tw.to({alpha:1},200),r.push(h)}this.aiMonster[t.guideId]=r,this.actorManager.addActorToPlayer(this.aiMonsterServerId,c,e.RoleType.MONSTER,r)}t.actor.stopMove(),t.actor.playSkillTarget(s,r,this.setMonsterHp,this,[t,i,a])}else{var r=this.guideMonster[t.guideId];if(0==a)for(var l=0;l<r.length;l++){var h=r[l];h.curHp=h.maxHp,h.updateHpWidget(),h.nameContainer.visible=!0,h.direction=e.Astar.instance.judgeNextDirection(h.getPosition(),t.actor.getPosition()),h.setStateIdle(),h.delayTimer&&(clearTimeout(h.delayTimer),delete h.delayTimer),h.stopMove(!0)}t.actor.stopMove(),t.actor.playSkillTarget(s,r,this.setMonsterHp,this,[t,i,a])}t.skillTimer=setTimeout(function(){t.skillTimer=null,this.playSkill(t,i,++a)}.bind(this),1e3)},s.prototype.setMonstersHp=function(t,i,n){var o=null;if(o=t.isAI?this.aiMonster[t.guideId]:this.guideMonster[t.guideId])for(var a=i.SkillId[t.typeId].length,s=Math.floor(i.MonsterHp/a),r=s*(a-n-1),l=0;l<o.length;l++){var h=o[l];h.curHp=r,h.updateHpWidget(),new e.BattleMoveText(h.getPosition(),s.toString(),e.SkillEffect.CRIT_DMG,0,0),0==r&&(h.isDead=!0,egret.Tween.get(h).to({alpha:0},300).to({visible:!1},0))}},s.prototype.onDrop=function(t,i){for(var o=[],a=0;a<i.dropItems.length;a++){var s=i.dropItems[a],r=HawkProtocolManager.newBuilder("JsProto.DropAwardItem");r.setItemId(s.id),r.setCount(s.value),o.push(r)}var l=this.guideMonster[t.guideId][0];e.JsonDataManager.instance.equipTemplate;this.dropManager.createDropAward(o,l.getPosition(),function(){this.dropManager.pickUpDropItemOneByOne(this.playerManager.serverId,this.playerManager.playerId,function(){this.setGuideIdStateByPlayerId(t.playerId,t.guideId,n.FINISH)}.bind(this),function(e){if(1==e.type){var i=Number(String(e.itemId).slice(1,2));i==t.typeId&&this.needShowEquip(e.itemId)}}.bind(this))}.bind(this))},s.prototype.onChangeEquip=function(e){var t=this.guidePlayer[this.playerManager.playerId];if(t){var i=e.getOnEquipId();this.onEquip(t,i)}},s.prototype.pushDelayTimer=function(e){e&&-1==this.delayTimerList.indexOf(e)&&this.delayTimerList.push(e)},s.prototype.popDelayTimer=function(e){if(e){var t=this.delayTimerList.indexOf(e);this.delayTimerList.splice(t,1)}},s.prototype.clearDelayTimer=function(){for(;this.delayTimerList.length>0;){var e=this.delayTimerList.pop();clearTimeout(e)}},s.prototype.pushHPTimer=function(e){e&&-1==this.hpTimerList.indexOf(e)&&this.hpTimerList.push(e)},s.prototype.popHPTimer=function(e){if(e){var t=this.hpTimerList.indexOf(e);this.hpTimerList.splice(t,1)}},s.prototype.clearHPTimer=function(){for(;this.hpTimerList.length>0;){var e=this.hpTimerList.pop();clearTimeout(e)}},s.prototype.pushRobotTimer=function(e){e&&-1==this.robotTimerList.indexOf(e)&&this.robotTimerList.push(e)},s.prototype.popRobotTimer=function(e){if(e){var t=this.robotTimerList.indexOf(e);this.robotTimerList.splice(t,1)}},s.prototype.clearRobotTimer=function(){for(;this.robotTimerList.length>0;){var e=this.robotTimerList.pop();clearInterval(e)}},s.prototype.startSelfGuide=function(){if((this.curMap!=a.BATTLE||this.isActorReady&&this.isOtherReady)&&(this.curMap!=a.MAINCITY||this.isMainRoleReady)&&!this.isGuideStart){this.isGuideStart=!0;var t=new i;t.playerId=this.playerManager.playerId,t.isAI=!1;var o=this.guideStartId,s=n.ACCEPT,r=e.PlayerService.instance.missionList;if(r&&r.length>0&&(o=r[0].getId(),s=r[0].getTag()&&n.FINISH||n.ACCEPT),t.guideId=o,t.guideState=s,this.guidePlayer[t.playerId]=t,this.curMap==a.BATTLE){if(t.actor=this.actorManager.getMainActorForPlayer(this.playerManager.serverId,this.playerManager.playerId),t.actor.nameContainer.visible=!0,t.typeId=(t.actor.roleItemId-1)%3+1,t.simpleRole=t.actor.simpleRole,o==this.guideStartId)t.actor.x=this.mapManager.switchList[0].x,t.actor.y=this.mapManager.switchList[0].y;else{var l=e.JsonDataManager.instance.guideMissionTemplate,h=l[t.guideId-1];t.actor.x=h.Waypoint[0],t.actor.y=h.Waypoint[1]}this.createGuideObject(t.typeId),this.createBossRobot(),this.showMissionGroup(function(){this.startGuideByPlayerId(this.playerManager.playerId)}.bind(this)),this.startGuideByPlayerId(t.playerId),this.preloadNpcImage(o),this.initNewSkill()}else{t.people=e.MainSceneManager.instance.mainRole;var c=new egret.Point;if(o==this.guideStartId)c.x=420,c.y=3330;else{var l=e.JsonDataManager.instance.guideMissionTemplate,h=l[t.guideId-1];c.x=h.Waypoint[0],c.y=h.Waypoint[1]}t.people.x=c.x,t.people.y=c.y;var u=e.MapViewportGroupManager.instance.mapView.mainTiledMap.SpaceToTiled(c);t.people.curPos=u,e.MainSceneManager.instance.canMoveBg=!0,e.MainSceneManager.instance.setScrollCenterToPeople(t.people),this.showMissionGroup(function(){this.startGuideByPlayerId(this.playerManager.playerId)}.bind(this)),this.startGuideByPlayerId(t.playerId),this.preloadNpcImage(o)}}},s.prototype.onMainActor=function(){this.isActorReady=!0,this.startSelfGuide()},s.prototype.sendMsgGetMissionItem=function(t){var i=this.guidePlayer[this.playerManager.playerId];if(i){e.LogUtil.getInstance().log("BattleUI_Guide","发送获得任务道具请求 : "+t);var n=HawkProtocolManager.newBuilder("JsProto.HPMissionLeadReq");n.setId(t);var o=e.PlayerService.instance.getRoleDataList();if(o&&o.length>0){var a=o[0].roleId;n.setRoleId(a),e.Message.instance.send(e.Code.MISSION_LEAD_C,n,!0)}}},s.prototype.sendMsgFinishMission=function(t){var i=this.guidePlayer[this.playerManager.playerId];if(i){e.LogUtil.getInstance().log("BattleUI_Guide","发送完成任务消息 : "+t);var n=HawkProtocolManager.newBuilder("JsProto.HPMissionLeadReq");n.setId(t);var o=e.PlayerService.instance.getRoleDataList();if(o&&o.length>0){var a=o[0].roleId;n.setRoleId(a),e.Message.instance.send(e.Code.MISSION_LEAD_FINISH_C,n,!0)}}},s.prototype.sendMsgFetchAward=function(t){e.LogUtil.getInstance().log("BattleUI_Guide","发送领取奖励消息 : "+t);var i=HawkProtocolManager.newBuilder("JsProto.HPMissionBonusC");i.setId(t),e.Message.instance.send(e.Code.MAINMISSION_BONUS_C_VALUE,i,!0)},s.prototype.sendMsgEquip=function(t,i){var n=this.guidePlayer[this.playerManager.playerId];if(n){e.LogUtil.getInstance().log("BattleUI_Guide","发送穿装备消息 : "+i);var o=e.JsonDataManager.instance.equipTemplate,a=o[i],s=HawkProtocolManager.newBuilder("JsProto.HPEquipDress");s.setEquipId(t),s.setRoleId(n.actor.roleId),s.setPart(a.partList[0]),e.Message.instance.send(e.Code.EQUIP_DRESS_C,s,!0)}},s.prototype.onMsgNewEquip=function(t){for(var i=(e.JsonDataManager.instance.equipTemplate,t.getUnDressedInfos()),n=0;n<i.length;n++){var o=i[n],a=o.getEquipId();this.newEquipIdList[a]&&(this.showEquipGroup(Number(o.getId()),a),delete this.newEquipIdList[a])}},s.prototype.needShowEquip=function(t){var i=e.BagController.getInstance().getEquipInfoByEquipId(t);i?this.showEquipGroup(Number(i.equipInfo.getId()),t):this.newEquipIdList[t]=!0},s.prototype.onMsgPlayerLevelUp=function(){var e=this.guidePlayer[this.playerManager.playerId];e&&(this.playAniLevelUp(e),this.checkNewSkill())},s.prototype.showMask=function(){this.mask_rect.visible=!0},s.prototype.hideMask=function(){this.mask_rect.visible=!1},s.prototype.onBtnMask=function(){},s.prototype.initNewSkill=function(){var t=e.PlayerService.instance.getRoleDataList();if(t&&0!=t.length){var i=t[0].roleInfo;if(i){var n=i.getSkills();if(n&&0!=n.length)for(var o=0;o<n.length;o++){var a=n[o],s=a.getLevel(),r=a.getId();s>0&&(this.ownSkill[r]||(e.LogUtil.getInstance().log("BattleUI_Guide","初始技能 : "+r),this.ownSkill[r]=!0))}}}},s.prototype.checkNewSkill=function(){var t=e.PlayerService.instance.getRoleDataList();if(t&&0!=t.length){var i=t[0].roleInfo;if(i){var n=i.getSkills();if(n&&0!=n.length)for(var o=0;o<n.length;o++){var a=n[o],s=a.getLevel(),r=a.getId();s>0&&(this.ownSkill[r]||(e.LogUtil.getInstance().log("BattleUI_Guide","获得技能 : "+r),this.ownSkill[r]=!0,this.showSkillGroup(r,s)))}}}},s}(e.BattleUI_Base);e.BattleUI_Guide=t,__reflect(t.prototype,"foxgame.BattleUI_Guide");var i=function(){function e(){this.playerId=null,this.isAI=null,this.actor=null,this.guideId=null,this.guideState=null,this.simpleRole=null,this.equip={},this.typeId=null,this.levelUpAni=null,this.skillTimer=null,this.people=null}return e.prototype.dispose=function(){clearTimeout(this.skillTimer),this.skillTimer=null,this.playerId=null,this.actor=null,this.simpleRole=null,this.levelUpAni&&this.levelUpAni.dispose()},e}();__reflect(i.prototype,"GuidePlayer");var n;!function(e){e[e.ACCEPT=0]="ACCEPT",e[e.FINISH=1]="FINISH",e[e.EQUIP=2]="EQUIP",e[e.BATTLE=3]="BATTLE",e[e.DROP=4]="DROP"}(n||(n={}));var o;!function(e){e[e.SEARCH=57]="SEARCH",e[e.EQUIP=58]="EQUIP",e[e.CROWD=59]="CROWD",e[e.MONSTER=60]="MONSTER",e[e.BOSS=61]="BOSS",e[e.MAINCITY=62]="MAINCITY"}(o||(o={}));var a;!function(e){e[e.NONE=0]="NONE",e[e.BATTLE=1]="BATTLE",e[e.MAINCITY=2]="MAINCITY"}(a||(a={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.id=null,e.equipId=null,e.skinName="BattleUIGuideEquipSkin",e.visible=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.equip_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnEquip,this)},i.prototype.showWithAction=function(t,i){egret.Tween.removeTweens(this),this.x=e.Global.stageWidth,this.y=i,this.visible=!0,egret.Tween.get(this).to({x:t},200)},i.prototype.showWithoutAction=function(e,t){egret.Tween.removeTweens(this),this.x=e,this.y=t,this.visible=!0},i.prototype.moveUp=function(){egret.Tween.get(this).to({y:this.y-this.height},100)},i.prototype.refresh=function(t,i,n,o){this.onBtnEquip(),this.id=t,this.equipId=i;var a=e.JsonDataManager.instance.equipTemplate,s=a[this.equipId];this.equip_name_label.text=s.name,this.equip_item.setItem(s.id,1);var r=s.quality==e.EquipQuality.RED,l=r?s.level:-1;this.equip_fight_label.text=""+(e.GlobalUtil.getScore(s.attrTypeList,s.attrValueList,null,null,null,null,r,l)+2e3),this.equip_arrow_image.x=this.equip_fight_label.x+this.equip_fight_label.width+5,this.equipCallback=o,this.startTimerEquip(n)},i.prototype.hide=function(){this.stopTimerEquip(),this.visible=!1},i.prototype.startTimerEquip=function(e){this.stopTimerEquip(),this.equipTimerTime=e,this.equipTimer=setInterval(this.onTimerEquip.bind(this),1e3),this.onTimerEquip()},i.prototype.stopTimerEquip=function(){this.equipTimer&&(clearInterval(this.equipTimer),this.equipTimer=null)},i.prototype.onTimerEquip=function(){this.equipTimerTime>0?(this.equip_time_label.text=this.equipTimerTime+"s",this.equipTimerTime--):(this.stopTimerEquip(),this.onBtnEquip())},i.prototype.onBtnEquip=function(){this.hide(),this.equipCallback&&(this.equipCallback(this.id,this.equipId),this.equipCallback=null)},i.prototype.dispose=function(){this.onBtnEquip()},i}(eui.ItemRenderer);e.BattleUI_GuideEquip=t,__reflect(t.prototype,"foxgame.BattleUI_GuideEquip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(e){var i=t.call(this,e)||this;return i.scene_button_group=null,i.gate_button_group=null,i.gate_button=null,i.gate_score_label=null,i.city_button_group=null,i.city_button=null,i.city_score_label=null,i.palace_front_button_group=null,i.palace_front_button=null,i.palace_front_score_label=null,i.palace_button_group=null,i.palace_button=null,i.palace_score_label=null,i.flag_button_group=null,i.flag_button=null,i.flag_score_label=null,i.open_time_label=null,i.target_group=null,i.target_head_image=null,i.zhan_image=null,i.dou_image=null,i.zhong_image=null,i.target_name_label=null,i.award_group=null,i.award_image=null,i.award_score_label=null,i.award_name_label=null,i.tip_group=null,i.tip_1_label=null,i.tip_2_label=null,i.flag_progress_group=null,i.flag_time_progress_image=null,i.flag_shield_progress_image=null,i.flag_player_name_label=null,i.flag_point_label=null,i.flag_time_label=null,i.flag_shield_label=null,i.flag_tip_group=null,i.flag_tip_player_name_label=null,i.flag_tip_left_time_label=null,i.flag_tip_union_label=null,i.relive_group=null,i.relive_button=null,i.head_group=null,i.head_list=null,i.head_scroller=null,i.block_group=null,i.block_choice_button=null,i.block_choice_group=null,i.block_button=null,i.block_not_image=null,i.back_button=null,i.rank=null,i.sceneRefreshList={},i.leftTimeTimer=null,i.tipTimer=null,i.reliveTimer=null,i.progressLength=224,i.activityOpenTimeNumber=0,i.activityLeftTimeNumber=0,i.flagLeftTimeNumber=0,i.reliveLeftTime=0,i.nextFlagTimeNumber=0,i.flagTotalTimeNumber=0,i.flagTotalShieldNumber=100,i.reliveTotalTime=0,i.flagState=0,i.flagObjectId=null,i.flagPlayerId=0,i.flagUnionId=0,i.flagServerId=0,i.selfScore=0,i.scoreAwardData=[],i.scoreAwardIndex=null,i.headData=new eui.ArrayCollection,i.refreshHeadDataInterval=1e3,i.refreshHeadDataTimer=null,i.sceneObjectData={},i.scenePlayerData={},i.sceneNpcData={},i.sceneMonsterData={},i.selfBattling=!1,i.selfFlaging=!1,i.reliveConsume=null,i.tipOnce=!1,i.battleResult=null,i.skinName="BattleUIUnionSiegeSkin",i.hide(),StageFrameControl.instance.mainUILayer.addChild(i),i}return __extends(n,t),n.prototype.init=function(){this.initData(),this.gate_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGate,this),this.city_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnCity,this),this.palace_front_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnPalaceFront,this),this.palace_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnPalace,this),this.flag_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnFlag,this),this.relive_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRelive,this),this.award_image.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAward,this),this.block_choice_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBlockChoice,this),this.block_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBlock,this),this.back_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBack,this),this.rank=new e.BattleUI_UnionSiegeRank,this.rank.y=50,this.addChild(this.rank),this.head_scroller.viewport=this.head_list,this.head_list.itemRenderer=e.BattleUI_UnionSiegeHead,this.head_list.dataProvider=this.headData;var t=250,i=1e3;egret.Tween.pauseTweens(this.zhan_image),egret.Tween.removeTweens(this.zhan_image),this.zhan_image.y=43,egret.Tween.get(this.zhan_image,{loop:!0}).to({y:this.zhan_image.y-5},t).to({y:this.zhan_image.y},t).wait(4*t+i),egret.Tween.pauseTweens(this.dou_image),egret.Tween.removeTweens(this.dou_image),this.dou_image.y=43,egret.Tween.get(this.dou_image,{loop:!0}).wait(2*t).to({y:this.dou_image.y-5},t).to({y:this.dou_image.y},t).wait(2*t+i),egret.Tween.pauseTweens(this.zhong_image),egret.Tween.removeTweens(this.zhong_image),this.zhong_image.y=43,egret.Tween.get(this.zhong_image,{loop:!0}).wait(4*t).to({y:this.zhong_image.y-5},t).to({y:this.zhong_image.y},t).wait(i)},n.prototype.show=function(t){void 0===t&&(t=null),this.visible=!0,e.Message.instance.add(e.Code.UNION_SIEGE_SCENE_INFO_S,this),e.Message.instance.add(e.Code.UNION_SIEGE_BATTLE_PROGRESS_S,this),e.Message.instance.add(e.Code.UNION_SIEGE_FLAG_STATE_S,this),e.Message.instance.add(e.Code.UNION_SIEGE_BATTLE_RESULT_S,this),e.MainControler.instance.adaptChatPos(!0),this.startTimerRefreshHeadData(),this.refresh(),e.Message.instance.send(e.MsgCMD.UNION_SIEGE_ENTER_BATTLE_SCENE,null,!1)},n.prototype.hide=function(t){void 0===t&&(t=null),this.visible=!1,this.stopTimerRelive(),this.stopTimerTip(),this.stopTimerLeftTime(),this.stopTimerRefreshHeadData(),e.Message.instance.remove(e.Code.UNION_SIEGE_SCENE_INFO_S,this),e.Message.instance.remove(e.Code.UNION_SIEGE_BATTLE_PROGRESS_S,this),e.Message.instance.remove(e.Code.UNION_SIEGE_FLAG_STATE_S,this),e.Message.instance.remove(e.Code.UNION_SIEGE_BATTLE_RESULT_S,this),e.MainControler.instance.adaptChatPos(!1)},n.prototype.dispose=function(){t.prototype.dispose.call(this)},n.prototype.refresh=function(e){void 0===e&&(e=null),this.refreshSceneButtonGroup(),this.refreshFlagProgressGroupVisible(),this.block_not_image.visible=!!this.actorManager.block},n.prototype.resize=function(){this.width=this.screenWidth,this.rank.x=this.width-this.rank.width+2},n.prototype.recvMsg=function(t,i){switch(t){case e.Code.UNION_SIEGE_SCENE_INFO_S:this.onMsgUnionSiegeSceneInfo(i);break;case e.Code.UNION_SIEGE_BATTLE_PROGRESS_S:this.onMsgUnionSiegeBattleProgress(i);break;case e.Code.UNION_SIEGE_FLAG_STATE_S:this.onMsgUnionSiegeFlagState(i);break;case e.Code.UNION_SIEGE_BATTLE_RESULT_S:this.onMsgUnionSiegeBattleResult(i)}},n.prototype.initData=function(){var t=e.JsonDataManager.instance.usSceneTemplate[e.UnionSiegeScene.US_GATE],i=({sceneButton:this.gate_button,scoreLabel:this.gate_score_label,scoreLimit:t&&t.integralLimit||0},e.JsonDataManager.instance.usSceneTemplate[e.UnionSiegeScene.US_CITY]),n={sceneButton:this.city_button,scoreLabel:this.city_score_label,scoreLimit:i&&i.integralLimit||0},o=e.JsonDataManager.instance.usSceneTemplate[e.UnionSiegeScene.US_PALACE_FRONT],a={sceneButton:this.palace_front_button,scoreLabel:this.palace_front_score_label,scoreLimit:o&&o.integralLimit||0},s=e.JsonDataManager.instance.usSceneTemplate[e.UnionSiegeScene.US_PALACE],r={sceneButton:this.palace_button,scoreLabel:this.palace_score_label,scoreLimit:s&&s.integralLimit||0};({sceneButton:this.flag_button,scoreLabel:this.flag_score_label,scoreLimit:0});this.sceneRefreshList[e.UnionSiegeScene.US_GATE]=[n],this.sceneRefreshList[e.UnionSiegeScene.US_CITY]=[a],this.sceneRefreshList[e.UnionSiegeScene.US_PALACE_FRONT]=[n,r],this.sceneRefreshList[e.UnionSiegeScene.US_PALACE]=[a];var l={},h=e.JsonDataManager.instance.usIntegralAwardTemplate;this.sceneManager.sceneType==e.WorldSceneType.CrossServerUnionSiegeMap&&(h=e.JsonDataManager.instance.usCSIntegralAwardTemplate);for(var c in h){var u=h[c];l[u.integral]=u}var p=Object.keys(l);p.sort(function(e,t){return parseInt(e)-parseInt(t)});for(var g=0;g<p.length;g++){var c=p[g],d=l[c];this.scoreAwardData.push(d)}var f=e.JsonDataManager.instance.globalTemplate.UNION_SIEGE_MINING_FLAG_TIME;this.flagTotalTimeNumber=f&&parseInt(f)/1e3||1,this.reliveConsume=e.JsonDataManager.instance.globalTemplate.UNION_SIEGE_RELIVE_COST_GOLD;var m=e.JsonDataManager.instance.globalTemplate.UNION_SIEGE_RELIVE_CD;this.reliveTotalTime=m&&parseInt(m)/1e3||0},n.prototype.onMsgUnionSiegeSceneInfo=function(t){var n=t.getSceneInfo(),o=n.getSceneType(),a=n.getSceneId();if(this.sceneManager.sceneType==o&&this.sceneManager.sceneId==a){this.sceneManager.onMsgSceneObjectIdSync(n);var s=this.sceneObjectData;this.sceneObjectData={},this.scenePlayerData={},this.sceneNpcData={},this.sceneMonsterData={};for(var r=this.playerManager.serverId,l=this.playerManager.playerId,h=n.getSceneObjIdArray(),c=n.getSceneObjTypeArray(),u=n.getServerIdArray(),p=n.getSceneObjOwnIdArray(),g=t.getUnionIds(),d=t.getUnionNames(),f=t.getSceneObjFightTargetIdArray(),m=0;m<h.length;m++){var y=new i;y.objectId=h[m],y.type=c[m],y.serverId=u[m],y.typeId=p[m],y.unionId=g[m],y.unionName=d[m],y.targetObjectId=f[m],-1==h.indexOf(y.targetObjectId)&&(y.targetObjectId=-1);var I=s[y.objectId];switch(I&&I.targetObjectId!=y.targetObjectId&&(y.type==e.SceneObjectType.ObjTypePlayer?this.actorManager.clearActorForPlayer(y.serverId,y.typeId):this.actorManager.clearActorForMonster(y.typeId)),this.sceneObjectData[y.objectId]=y,y.type){case e.SceneObjectType.ObjTypePlayer:this.scenePlayerData[y.serverId]=this.scenePlayerData[y.serverId]||{},this.scenePlayerData[y.serverId][y.typeId]=y;break;case e.SceneObjectType.ObjTypeNpc:this.sceneNpcData[y.serverId]=this.sceneNpcData[y.serverId]||{},this.sceneNpcData[y.serverId][y.typeId]=y;break;case e.SceneObjectType.ObjTypeMonster:this.sceneMonsterData[y.serverId]=this.sceneMonsterData[y.serverId]||{},this.sceneMonsterData[y.serverId][y.typeId]=y}}this.scenePlayerData[r]&&this.scenePlayerData[r][l]&&-1!=this.scenePlayerData[r][l].targetObjectId?(this.selfBattling=!0,this.mapManager.hideTouch(),this.refreshTargetGroup()):(this.selfBattling=!1,this.refreshTargetGroup()),this.onTimerRefreshHeadData(),this.actorManager.setActorHpTypeByBattleType(this.scene.battleType)}},n.prototype.onMsgUnionSiegeBattleProgress=function(t){e.LogUtil.getInstance().log("BattleUI_UnionSiege","接受到公会攻城战况推送");var i=t.getSceneType();if(this.sceneManager.sceneType==i){this.rank.refresh(t);var n=t.getMyRank();this.selfScore=n&&n.getIntegral()||0,this.refreshCurrentScore(this.selfScore),this.activityLeftTimeNumber=Number(t.getRemainingTime()),this.activityOpenTimeNumber=Number(t.getOpenTime()),this.startTimerLeftTime(),this.refreshSceneButtonGroup()}},n.prototype.onMsgUnionSiegeFlagState=function(t){e.LogUtil.getInstance().log("BattleUI_UnionSiege","接受到采旗状态推送");var i=t.getSceneType();if(this.sceneManager.sceneType==i){var n=t.getState();if(1==this.flagState&&0==n&&this.flagObjectId)for(var o in this.sceneObjectData){var a=this.sceneObjectData[o];a.targetObjectId&&a.targetObjectId==this.flagObjectId&&(this.actorManager.stopActorForPlayer(a.serverId,a.typeId),this.actorManager.clearActorForPlayer(a.serverId,a.typeId))}this.nextFlagTimeNumber=Number(t.getNextMiningTime()||0),this.flagState=n,this.flagServerId=t.getUnionServerId(),this.flagPlayerId=t.getPlayerId(),this.flagUnionId=t.getUnionId(),this.selfFlaging=this.flagServerId==this.playerManager.serverId&&this.flagPlayerId==this.playerManager.playerId,this.sceneMonsterData[this.playerManager.monsterServerId]&&this.sceneMonsterData[this.playerManager.monsterServerId][this.playerManager.flagMonsterId]&&(this.flagObjectId=this.sceneMonsterData[this.playerManager.monsterServerId][this.playerManager.flagMonsterId].objectId),this.flagLeftTimeNumber=t.getRemainingTime()/1e3;var s=t.getPlayerName(),r=t.getUnionName();this.refreshFlagProgressGroup(s,r),this.refreshFlagTipGroup(s,r),this.refreshFlagButton()}},n.prototype.onMsgUnionSiegeBattleResult=function(t){e.LogUtil.getInstance().log("BattleUI_UnionSiege","接受到战斗结算推送");var i=t.getSceneType();this.sceneManager.sceneType==i&&(this.battleResult={win:t.getWin(),ownerPlayer:t.getFirstPlayerName(),ownerUnion:t.getFirstUnionName(),playerScore:t.getMyIntegral(),playerRank:t.getMyRank(),unionScore:t.getUnionIntegral(),unionRank:t.getUnionRank(),officialPos:t.getMyPos(),confirmCallback:function(){this.sceneManager.sendMsgSceneChangeRequest(e.WorldSceneType.OldMonsterBattleMap,0)
}.bind(this)},this.showResultPop(this.battleResult))},n.prototype.showResultPop=function(t){var i=this.sceneManager.sceneType==e.WorldSceneType.CrossServerUnionSiegeMap,n=new e.BattleUI_UnionSiegeResult(i);n.refresh(t)},n.prototype.onBtnGate=function(t){if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");var i=null;if(this.sceneManager.sceneId==e.UnionSiegeScene.US_CITY&&(i=0),null!=i){var n=function(){this.mapManager.moveToSwitch(i,this.mapManager.startTimerSwitch.bind(this.mapManager))}.bind(this);this.selfFlaging?this.giveupFlag(n):n()}},n.prototype.onBtnCity=function(t){if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");var i=null;if(this.sceneManager.sceneId==e.UnionSiegeScene.US_GATE?i=1:this.sceneManager.sceneId==e.UnionSiegeScene.US_PALACE_FRONT&&(i=0),null!=i){var n=function(){this.mapManager.moveToSwitch(i,this.mapManager.startTimerSwitch.bind(this.mapManager))}.bind(this);this.selfFlaging?this.giveupFlag(n):n()}},n.prototype.onBtnPalaceFront=function(t){if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");var i=null;if(this.sceneManager.sceneId==e.UnionSiegeScene.US_CITY?i=1:this.sceneManager.sceneId==e.UnionSiegeScene.US_PALACE&&(i=0),null!=i){var n=function(){this.mapManager.moveToSwitch(i,this.mapManager.startTimerSwitch.bind(this.mapManager))}.bind(this);this.selfFlaging?this.giveupFlag(n):n()}},n.prototype.onBtnPalace=function(t){if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");var i=null;if(this.sceneManager.sceneId==e.UnionSiegeScene.US_PALACE_FRONT&&(i=1),null!=i){var n=function(){this.mapManager.moveToSwitch(i,this.mapManager.startTimerSwitch.bind(this.mapManager))}.bind(this);this.selfFlaging?this.giveupFlag(n):n()}},n.prototype.onBtnFlag=function(t){if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");if(this.sceneManager.sceneId==e.UnionSiegeScene.US_PALACE)if(0==this.flagState)this.nextFlagTimeNumber>0?e.PopUpController.getInstance().showFloatTextPanel1("王旗还需要"+this.nextFlagTimeNumber+"秒后可以被采集"):this.mapManager.moveToSwitch(1,this.sendMsgUnionSiegeFlagRequest.bind(this));else if(this.flagServerId==this.playerManager.serverId&&this.flagUnionId==this.playerManager.unionId);else{var i=null;this.scenePlayerData[this.flagServerId]&&(i=this.scenePlayerData[this.flagServerId][this.flagPlayerId]),i&&this.sceneManager.sendMsgBattleInfoUpdateRequest({offence:[],deffence:[i.objectId],battleType:this.scene.battleType,battleArgs:i.typeId})}},n.prototype.onBtnRelive=function(t){this.reliveLeftTime>0&&this.reliveConsume?e.PopUpController.getInstance().showTextPanel("是否花费"+this.reliveConsume+"元宝复活?",this,function(){this.sceneManager.sendMsgScenePlayerReliveRequest()}):this.sceneManager.sendMsgScenePlayerReliveRequest()},n.prototype.onBtnAward=function(t){if(null!=this.scoreAwardIndex){var i=this.scoreAwardData[this.scoreAwardIndex];i&&e.TipsController.getInstance().showItemTips(Number(i.award[1]),Number(i.award[2]),!1)}},n.prototype.onBtnBlockChoice=function(e){this.block_choice_group.visible=!this.block_choice_group.visible},n.prototype.onBtnBlock=function(e){this.actorManager.block?(this.actorManager.setBlock(!1),this.block_not_image.visible=!1):(this.actorManager.setBlock(!0),this.block_not_image.visible=!0)},n.prototype.onBtnBack=function(t){if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");var i=function(){this.sceneManager.sendMsgSceneChangeRequest(e.WorldSceneType.OldMonsterBattleMap,0)}.bind(this);this.selfFlaging?this.giveupFlag(i):i()},n.prototype.startTimerLeftTime=function(){this.leftTimeTimer||(this.leftTimeTimer=setInterval(this.onTimerLeftTime.bind(this),1e3),this.onTimerLeftTime())},n.prototype.stopTimerLeftTime=function(){this.leftTimeTimer&&(clearInterval(this.leftTimeTimer),this.leftTimeTimer=null)},n.prototype.onTimerLeftTime=function(){this.activityOpenTimeNumber>0?(this.onTimerActivityOpenTime(this.activityOpenTimeNumber),this.activityOpenTimeNumber--):this.refreshSceneButtonGroup(),this.activityLeftTimeNumber>=0?(this.onTimerActivityLeftTime(this.activityLeftTimeNumber),this.activityLeftTimeNumber--):this.stopTimerLeftTime(),this.flagLeftTimeNumber>=0&&(this.onTimerFlagLeftTime(this.flagLeftTimeNumber),this.flagLeftTimeNumber--),this.nextFlagTimeNumber>0&&this.nextFlagTimeNumber--},n.prototype.onTimerActivityLeftTime=function(e){this.rank.refreshLeftTime(this.activityLeftTimeNumber)},n.prototype.onTimerActivityOpenTime=function(t){this.open_time_label.textFlow=new Array({text:"攻城正式开始:",style:{textColor:15655878}},{text:e.GlobalUtil.getTimeString(t,1),style:{textColor:16711680}})},n.prototype.onTimerFlagLeftTime=function(t){var i=1-t/this.flagTotalTimeNumber;i=0>i?0:i,i=i>1?1:i,this.flag_time_progress_image.height=this.progressLength*i,this.flag_time_label.text=e.GlobalUtil.getTimeString(t,3),this.flag_tip_left_time_label.textFlow=new Array({text:"（剩余时间",style:{textColor:15655878}},{text:e.GlobalUtil.getTimeString(t,1),style:{textColor:16711680}},{text:")",style:{textColor:15655878}});var n=this.flag_point_label.text;n=n.length>5?".":n+".",this.flag_point_label.text=n},n.prototype.refreshSceneButtonGroup=function(){switch(this.sceneManager.sceneId){case e.UnionSiegeScene.US_GATE:this.gate_button_group.visible=!1,this.palace_front_button_group.visible=!1,this.palace_button_group.visible=!1,this.flag_button_group.visible=!1,this.activityOpenTimeNumber>0?(this.city_button_group.visible=!1,this.mapManager.hideSwitchForAll(),this.open_time_label.visible=!0):(this.open_time_label.visible=!1,this.city_button_group.x=this.scene_button_group.width/2-this.city_button_group.width/2,this.city_button_group.visible=!0,this.mapManager.showSwitchByConfig([{pos:1,effect:e.SwitchEffect.TRANS}]));break;case e.UnionSiegeScene.US_CITY:this.open_time_label.visible=!1,this.city_button_group.visible=!1,this.palace_button_group.visible=!1,this.flag_button_group.visible=!1,this.gate_button_group.x=this.scene_button_group.width/2-this.gate_button_group.width/2-100,this.gate_button_group.visible=!0,this.palace_front_button_group.x=this.scene_button_group.width/2-this.palace_front_button_group.width/2+100,this.palace_front_button_group.visible=!0;break;case e.UnionSiegeScene.US_PALACE_FRONT:this.open_time_label.visible=!1,this.gate_button_group.visible=!1,this.palace_front_button_group.visible=!1,this.flag_button_group.visible=!1,this.city_button_group.x=this.scene_button_group.width/2-this.city_button_group.width/2-100,this.city_button_group.visible=!0,this.palace_button_group.x=this.scene_button_group.width/2-this.palace_button_group.width/2+100,this.palace_button_group.visible=!0;break;case e.UnionSiegeScene.US_PALACE:this.open_time_label.visible=!1,this.gate_button_group.visible=!1,this.city_button_group.visible=!1,this.palace_front_button_group.visible=!1,this.palace_button_group.visible=!1,this.flag_button_group.visible=!1,this.palace_front_button_group.x=this.scene_button_group.width/2-this.palace_front_button_group.width/2-100,this.palace_front_button_group.visible=!0,this.flag_button_group.x=this.scene_button_group.width/2-this.flag_button_group.width/2+100,this.flag_button_group.visible=!0,this.refreshFlagButton()}this.refreshCurrentScore(this.selfScore)},n.prototype.refreshCurrentScore=function(e){this.refreshSceneButtonGroupScore(e),this.refreshAwardGroup(e)},n.prototype.refreshSceneButtonGroupScore=function(e){var t=this.sceneRefreshList[this.sceneManager.sceneId];if(t)for(var i in t){var n=t[i];n.scoreLimit&&(n.scoreLabel.text="("+e+"/"+n.scoreLimit+"积分)"),e>=n.scoreLimit?"disabled"==n.sceneButton.currentState&&(n.sceneButton.touchEnabled=!0,n.sceneButton.currentState="up"):(n.sceneButton.touchEnabled=!1,n.sceneButton.currentState="disabled")}},n.prototype.refreshTargetGroup=function(){if(this.selfBattling){var t=this.scenePlayerData[this.playerManager.serverId][this.playerManager.playerId],i=t.targetObjectId,n=this.sceneObjectData[i];if(n){var o=this.actorManager.getHeadDataByTypeId(n.type,n.serverId,n.typeId);o?(this.target_head_image.source=o.icon,this.target_head_image.width=85,this.target_head_image.height=80,this.target_name_label.text=o.name,this.target_group.visible=!0,n.type==e.SceneObjectType.ObjTypePlayer||n.type==e.SceneObjectType.ObjTypeNpc?this.playerManager.setEnemy(n.serverId,n.typeId):this.playerManager.setEnemy(null,null)):(this.target_group.visible=!1,this.playerManager.setEnemy(null,null))}else this.target_group.visible=!1,this.playerManager.setEnemy(null,null)}else this.target_group.visible=!1,this.playerManager.setEnemy(null,null)},n.prototype.refreshAwardGroup=function(e){var t=null;this.scoreAwardIndex=null;for(var i=0;i<this.scoreAwardData.length;i++){var n=this.scoreAwardData[i];if(e<n.integral){t=n,this.scoreAwardIndex=i;break}}return t?(this.award_image.source=t.icon.replace(".","_"),this.award_name_label.text=t.name,this.award_name_label.textColor=Number("0x"+t.color),this.award_score_label.textFlow=new Array({text:e+"",style:{textColor:2227971}},{text:"/"+t.integral,style:{textColor:15655878}}),void(this.award_group.visible=!0)):void(this.award_group.visible=!1)},n.prototype.refreshTipGroup=function(){this.sceneManager.sceneId==e.UnionSiegeScene.US_CITY?(this.tip_1_label.text="击杀NPC和玩家",this.tip_2_label.text="都会增加积分噢",0==this.headData.length?this.stopTimerTip():this.tipTimer||this.startTimerShowTip()):this.sceneManager.sceneId==e.UnionSiegeScene.US_PALACE_FRONT?(this.tip_1_label.text="殿前击杀玩家",this.tip_2_label.text="增加双倍积分噢",0==this.headData.length?this.stopTimerTip():this.tipTimer||this.startTimerShowTip()):this.stopTimerTip()},n.prototype.startTimerShowTip=function(){this.stopTimerTip(),this.tip_group.visible=!0,this.tipTimer=setTimeout(function(){this.startTimerHideTip()}.bind(this),3e3)},n.prototype.startTimerHideTip=function(){this.stopTimerTip(),this.tip_group.visible=!1,this.tipTimer=setTimeout(function(){this.startTimerShowTip()}.bind(this),7e3)},n.prototype.stopTimerTip=function(){this.tipTimer&&(clearTimeout(this.tipTimer),this.tipTimer=null),this.tip_group.visible=!1},n.prototype.refreshFlagProgressGroup=function(e,t){1==this.flagState&&(this.flag_time_progress_image.height=0,this.flag_shield_progress_image.height=this.progressLength,this.flag_player_name_label.text=e,this.flag_point_label.text="",this.flag_time_label.text="",this.flag_shield_label.text=""),this.refreshFlagProgressGroupVisible()},n.prototype.refreshFlagProgressGroupVisible=function(){this.sceneManager.sceneType!=e.WorldSceneType.UnionWarBattleMap&&this.sceneManager.sceneType!=e.WorldSceneType.CrossServerUnionSiegeMap||this.sceneManager.sceneId!=e.UnionSiegeScene.US_PALACE?this.flag_progress_group.visible=!1:1==this.flagState?this.flag_progress_group.visible=!0:this.flag_progress_group.visible=!1},n.prototype.refreshFlagShield=function(e,t){var i=e/t;i=0>i?0:i,i=i>1?1:i,this.flag_shield_progress_image.height=i*this.progressLength,this.flag_shield_label.text="（护盾为0时打断采集，当前 "+e+"）"},n.prototype.refreshFlagTipGroup=function(e,t){1==this.flagState?(this.flag_tip_group.visible=!0,this.flag_tip_player_name_label.textFlow=new Array({text:e,style:{textColor:16768512}},{text:"采集王旗中",style:{textColor:15655878}}),this.flag_tip_union_label.textFlow=new Array({text:"所在公会：",style:{textColor:15655878}},{text:t,style:{textColor:41983}})):this.flag_tip_group.visible=!1},n.prototype.refreshFlagButton=function(){0==this.flagState?(this.flag_button.currentState="up",this.flag_button.touchEnabled=!0):this.flagServerId==this.playerManager.serverId&&this.flagUnionId==this.playerManager.unionId?(this.flag_button.currentState="disabled",this.flag_button.touchEnabled=!1):(this.flag_button.currentState="up",this.flag_button.touchEnabled=!0)},n.prototype.refreshReliveGroup=function(e,t){void 0===t&&(t=null),e?(this.stopTimerRelive(),this.relive_group.visible=!1):(this.startTimerRelive(t),this.relive_group.visible=!0)},n.prototype.startTimerRelive=function(e){void 0===e&&(e=null),this.stopTimerRelive(),e?this.reliveLeftTime=Number(e):this.reliveLeftTime=this.reliveTotalTime,this.reliveTimer=setInterval(this.onTimerRelive.bind(this),1e3),this.onTimerRelive()},n.prototype.stopTimerRelive=function(){this.reliveTimer&&(clearInterval(this.reliveTimer),this.reliveTimer=null)},n.prototype.onTimerRelive=function(){this.reliveLeftTime>=0?(this.relive_button.label="立即复活("+this.reliveLeftTime+"s)",this.reliveLeftTime--):(this.stopTimerRelive(),this.relive_button.label="立即复活")},n.prototype.startTimerRefreshHeadData=function(){this.stopTimerRefreshHeadData(),this.refreshHeadDataTimer=setInterval(this.onTimerRefreshHeadData.bind(this),this.refreshHeadDataInterval)},n.prototype.stopTimerRefreshHeadData=function(){this.refreshHeadDataTimer&&(clearInterval(this.refreshHeadDataTimer),this.refreshHeadDataTimer=null)},n.prototype.onTimerRefreshHeadData=function(){if(this.sceneManager.sceneId==e.UnionSiegeScene.US_GATE)return this.head_group.visible=!1,void this.refreshTipGroup();this.head_group.visible=!0;for(var t=this.actorManager.getPlayerHeadDataByDistance(this.playerManager.serverId,this.playerManager.playerId,640,640),i=[],n=[],o=this.playerManager.serverId,a=this.playerManager.unionId,s=0;s<t.length;s++){var r=t[s],l=r.serverId;if(this.scenePlayerData[l]){var h=r.playerId,c=this.scenePlayerData[l][h];c&&(o!=c.serverId||a!=c.unionId)&&(r.extend.onClickHead=this.onClickHead.bind(this),r.extend.objectId=c.objectId,r.extend.type=c.type,r.extend.typeId=c.typeId,r.extend.fight=-1!=c.targetObjectId,r.union=c.unionName,1==this.flagState&&this.flagPlayerId==c.typeId?n.push(r):i.push(r))}}if(i.sort(function(e,t){return e.distance-t.distance}),this.sceneManager.sceneId==e.UnionSiegeScene.US_CITY){var u=new e.PlayerHeadData;if(u.serverId=0,u.playerId=0,u.itemId=1,u.name="皇宫守卫",u.icon="proHead1_1_png",u.union=null,u.maxHp=1,u.curHp=1,u.distance=0,u.extend.fight=!1,u.extend.type=e.SceneObjectType.ObjTypeNpc,u.extend.typeId=1,u.extend.objectId=0,u.extend.onClickHead=this.onClickHeadNpc.bind(this),0==this.playerManager.enemyServerId){var p=this.actorManager.getPlayerHeadDataForPlayer(this.playerManager.enemyServerId,this.playerManager.enemyPlayerId);u.curHp=p.curHp,u.maxHp=p.maxHp}this.headData.replaceAll([].concat([u],i))}else this.headData.replaceAll([].concat(i));this.refreshTipGroup()},n.prototype.sendMsgUnionSiegeFlagRequest=function(){e.LogUtil.getInstance().log("BattleUI_UnionSiege","发送采旗请求");var t=HawkProtocolManager.newBuilder("JsProto.UnionSiegeFlagReq");t.setSceneType(this.sceneManager.sceneType),e.Message.instance.send(e.Code.UNION_SIEGE_MINING_FLAG_C,t,!0)},n.prototype.onSwitch=function(t){if(!this.selfBattling)switch(this.sceneManager.sceneId){case e.UnionSiegeScene.US_GATE:this.activityOpenTimeNumber<=0&&1==t&&this.sceneManager.sendMsgSceneChangeRequest(this.sceneManager.sceneType,e.UnionSiegeScene.US_CITY);break;case e.UnionSiegeScene.US_CITY:0==t?this.sceneManager.sendMsgSceneChangeRequest(this.sceneManager.sceneType,e.UnionSiegeScene.US_GATE):1==t&&this.sceneManager.sendMsgSceneChangeRequest(this.sceneManager.sceneType,e.UnionSiegeScene.US_PALACE_FRONT);break;case e.UnionSiegeScene.US_PALACE_FRONT:0==t?this.sceneManager.sendMsgSceneChangeRequest(this.sceneManager.sceneType,e.UnionSiegeScene.US_CITY):1==t&&this.sceneManager.sendMsgSceneChangeRequest(this.sceneManager.sceneType,e.UnionSiegeScene.US_PALACE);break;case e.UnionSiegeScene.US_PALACE:0==t?this.sceneManager.sendMsgSceneChangeRequest(this.sceneManager.sceneType,e.UnionSiegeScene.US_PALACE_FRONT):this.sendMsgUnionSiegeFlagRequest()}},n.prototype.onClickHead=function(t){if(this.sceneManager.sceneId==e.UnionSiegeScene.US_GATE)return void e.PopUpController.getInstance().showFloatTextPanel1("当前场景不允许战斗");if(this.selfBattling)return void e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");var i=function(){this.sceneManager.sendMsgBattleInfoUpdateRequest({offence:[],deffence:[t.extend.objectId],battleType:this.scene.battleType,battleArgs:t.extend.typeId})}.bind(this);this.selfFlaging?this.giveupFlag(i):i()},n.prototype.onClickHeadNpc=function(t){if(this.sceneManager.sceneId==e.UnionSiegeScene.US_GATE)e.PopUpController.getInstance().showFloatTextPanel1("当前场景不允许战斗");else if(this.selfBattling)e.PopUpController.getInstance().showFloatTextPanel1("当前正在战斗中");else{e.LogUtil.getInstance().log("SceneManager","发送玩家挑战npc请求");var i=HawkProtocolManager.newBuilder("JsProto.UnionSiegeChallengeNPCReq");i.setSceneType(this.sceneManager.sceneType),e.Message.instance.send(e.Code.UNION_SIEGE_CHALLENGE_NPC_C,i,!0)}},n.prototype.onHpChange=function(e){this.refreshFlagShield(Number(e.curHp),Number(e.maxHp))},n.prototype.onClickMap=function(t,i){this.selfBattling?e.PopUpController.getInstance().showFloatTextPanel1("战斗中不允许移动"):this.selfFlaging?this.giveupFlag(i):i&&i()},n.prototype.giveupFlag=function(t){e.PopUpController.getInstance().showTextPanel("您正在采集王旗中，是否放弃？",this,function(){t&&t()})},n}(e.BattleUI_Base);e.BattleUI_UnionSiege=t,__reflect(t.prototype,"foxgame.BattleUI_UnionSiege");var i=function(){function e(){this.objectId=null,this.type=null,this.typeId=null,this.unionId=null,this.unionName=null,this.targetObjectId=null,this.serverId=null}return e}();__reflect(i.prototype,"UnionSiegeSceneObject")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.select_image=null,e.player_hp_image=null,e.player_hp_top_image=null,e.player_type_image=null,e.fight_image=null,e.player_info_bg_image=null,e.player_union_label=null,e.player_name_label=null,e.onClickHead=null,e.skinName="BattleUIUnionSiegeHeadSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.head_group.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHead,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){var t=this.data;t.extend.type==e.SceneObjectType.ObjTypePlayer?1==t.itemId||4==t.itemId?this.player_type_image.source="zhanshi_png":2==t.itemId||5==t.itemId?this.player_type_image.source="fashi_png":(3==t.itemId||6==t.itemId)&&(this.player_type_image.source="daoshi_png"):this.player_type_image.source="gongjian_png";var i=t.curHp/t.maxHp,n=this.player_hp_image.height*(1-i);this.player_hp_image.mask=new egret.Rectangle(0,n,this.player_hp_image.width,this.player_hp_image.height-n),this.player_hp_top_image.y=n;var o=this.player_hp_image.height/2;this.player_hp_top_image.width=2*Math.sqrt(Math.pow(o,2)-Math.pow(o-n,2)),t.union?(this.player_union_label.text=""+t.union,this.player_union_label.visible=!0,this.player_name_label.text=t.name,this.player_name_label.y=24):(this.player_union_label.visible=!1,this.player_name_label.text=t.name,this.player_name_label.y=15),t.extend.fight?(this.select_image.visible=!0,this.fight_image.visible=!0,this.player_info_bg_image.source="xingmingdihong_png"):(this.select_image.visible=!1,this.fight_image.visible=!1,this.player_info_bg_image.source="xingmingdihei_png"),this.onClickHead=t.extend.onClickHead},i.prototype.onBtnHead=function(e){this.onClickHead&&this.onClickHead(this.data)},i}(eui.ItemRenderer);e.BattleUI_UnionSiegeHead=t,__reflect(t.prototype,"foxgame.BattleUI_UnionSiegeHead")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.title_group=null,e.show_button=null,e.hide_button=null,e.rank_group=null,e.owner_label=null,e.unionRank_button=null,e.playerRank_button=null,e.rankList=null,e.rankScroller=null,e.rankType_label=null,e.rankScore_label=null,e.leftTime_label=null,e.showState=0,e.showType=0,e.ownerUnion="",e.ownerRank=null,e.rankUnionData=[],e.rankPlayerData=[],e.rankData=new eui.ArrayCollection,e.myUnionData={},e.myPlayerData={},e.skinName="BattleUIUnionSiegeRankSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},i.prototype.init=function(){this.showType=1,this.onBtnShow(null),this.show_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShow,this),this.hide_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHide,this),this.unionRank_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnUnionRank,this),this.playerRank_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnPlayerRank,this),this.rankScroller.viewport=this.rankList,this.rankList.dataProvider=this.rankData,this.rankList.itemRenderer=e.BattleUI_RankItem},i.prototype.onBtnShow=function(t){e.LogUtil.getInstance().log("BattleUI_UnionSiegeRank","onBtnShow"),1!=this.showState&&(this.show_button.visible=!1,this.hide_button.visible=!0,this.showState=1,this.title_group.visible=!0,this.rank_group.visible=!0,this.refreshShowType())},i.prototype.onBtnHide=function(t){e.LogUtil.getInstance().log("BattleUI_UnionSiegeRank","onBtnHide"),2!=this.showState&&(this.show_button.visible=!0,this.hide_button.visible=!1,this.showState=2,this.title_group.visible=!1,this.rank_group.visible=!1)},i.prototype.onBtnUnionRank=function(e){1!=this.showType&&(this.showType=1,this.refreshShowType())},i.prototype.onBtnPlayerRank=function(e){2!=this.showType&&(this.showType=2,this.refreshShowType())},i.prototype.refreshShowType=function(){1==this.showType?(this.rankData.replaceAll(this.rankUnionData.concat()),this.rankType_label.text="我的公会:",this.rankScore_label.textFlow=(new egret.HtmlTextParser).parser("<font color=0x21FF03>"+this.myUnionData.rank+"</font><font color=0xFFBA00>  "+this.myUnionData.score+"分</font>")):2==this.showType&&(this.rankData.replaceAll(this.rankPlayerData.concat()),this.rankType_label.text="我的排名:",this.rankScore_label.textFlow=(new egret.HtmlTextParser).parser("<font color=0x21FF03>"+this.myPlayerData.rank+"</font><font color=0xFFBA00>  "+this.myPlayerData.score+"分</font>"))},i.prototype.refreshOwner=function(e){e&&(this.owner_label.text=e)},i.prototype.refreshLeftTime=function(t){this.leftTime_label.text=e.GlobalUtil.getTimeString(t,1)},i.prototype.refresh=function(e){this.refreshOwner(e.getPalaceHolder());for(var t=e.getUnionRank(),i=0;i<t.length;i++){var n=t[i],o=n.getRank(),a=n.getName(),s=n.getIntegral()+"分";this.rankUnionData[o-1]={rank:o,name:a,description:s}}for(var r=e.getPlayerRank(),i=0;i<r.length;i++){var l=r[i],o=l.getRank(),h=l.getName(),s=l.getIntegral()+"分";this.rankPlayerData[o-1]={rank:o,name:h,description:s}}var c=e.getMyUnionRank();this.myUnionData={rank:c.getRank(),score:c.getIntegral()};var u=e.getMyRank();this.myPlayerData={rank:u.getRank(),score:u.getIntegral()},this.refreshShowType()},i}(eui.Component);e.BattleUI_UnionSiegeRank=t,__reflect(t.prototype,"foxgame.BattleUI_UnionSiegeRank")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.pop_group=null,n.success_group=null,n.failure_group=null,n.title_group=null,n.owner_player_name_label=null,n.owner_union_name_label=null,n.player_award_group=null,n.player_score_label=null,n.player_rank_label=null,n.player_rank_award_0=null,n.player_rank_award_1=null,n.player_rank_award_2=null,n.player_rank_award_3=null,n.union_award_group=null,n.union_score_label=null,n.union_rank_label=null,n.union_rank_award_0=null,n.union_rank_award_1=null,n.union_rank_award_2=null,n.union_rank_award_3=null,n.union_siege_award_group=null,n.union_siege_official_label=null,n.union_siege_award_0=null,n.union_siege_award_1=null,n.union_siege_award_2=null,n.confirm_button=null,n.time_label=null,n.confirmTimer=null,n.confirmTime=10,n.confirmCallback=null,n.isCrossServer=!1,n.isCrossServer=i,n.skinName="BattleUIUnionSiegeResultSkin",n.hide(),e.Global.topLayer.addChild(n),n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.resize()},i.prototype.init=function(){this.confirm_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnConfirm,this);var t=new e.FoxAni(this.title_group);this.isCrossServer?t.play("medal_10031","ani",-1):t.play("medal_10029","ani",-1)},i.prototype.dispose=function(){this.parent&&(this.removelistener(),this.parent.removeChild(this))},i.prototype.show=function(){this.visible=!0},i.prototype.hide=function(){this.visible=!1},i.prototype.resize=function(){this.width=e.Global.stageWidth},i.prototype.addlistener=function(){this.player_rank_award_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.player_rank_award_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.player_rank_award_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.player_rank_award_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_siege_award_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_siege_award_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_siege_award_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)},i.prototype.getItemTemp=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.click=function(t){var i=t.target,n=this.getItemTemp()[i.itemId];55==n.type?e.TipsController.getInstance().showUSTips(i.itemId):0==n.type&&e.TipsController.getInstance().showItemTips(i.itemId,i.num)},i.prototype.removelistener=function(){this.player_rank_award_0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.player_rank_award_1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.player_rank_award_2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.player_rank_award_3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_rank_award_3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_siege_award_0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_siege_award_1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.union_siege_award_2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)},i.prototype.refresh=function(e){e.win?(this.success_group.visible=!0,this.failure_group.visible=!1):(this.success_group.visible=!1,this.failure_group.visible=!0),this.owner_player_name_label.text=e.ownerPlayer,this.owner_union_name_label.text=e.ownerUnion,this.refreshPlayerAward(e.playerScore,e.playerRank),this.refreshUnionAward(e.unionScore,e.unionRank);var t=this.refreshOfficialAward(e.officialPos);this.startTimerConfirm(),this.pop_group.height=t&&1024||864,this.confirmCallback=e.confirmCallback,this.show()},i.prototype.onBtnConfirm=function(){this.confirmCallback&&this.confirmCallback(),this.dispose()},i.prototype.startTimerConfirm=function(){this.stopTimerConfirm(),this.confirmTime=10,this.confirmTimer=setInterval(this.onTimerConfirm.bind(this),1e3),this.onTimerConfirm()},i.prototype.stopTimerConfirm=function(){this.confirmTimer&&(clearInterval(this.confirmTimer),this.confirmTimer=null)},i.prototype.onTimerConfirm=function(){this.confirmTime>0?(this.time_label.text=this.confirmTime+"s",this.confirmTime--):(this.stopTimerConfirm(),this.time_label.text="0s",this.onBtnConfirm())},i.prototype.refreshPlayerAward=function(t,i){var n=null;n=10>=i?this.isCrossServer?e.JsonDataManager.instance.usCSPersonalRankAwardTemplate[i]:e.JsonDataManager.instance.usPersonalRankAwardTemplate[i]:this.isCrossServer?e.JsonDataManager.instance.usCSPersonalRankAwardTemplate[11]:e.JsonDataManager.instance.usPersonalRankAwardTemplate[11],this.player_score_label.text=t+"",this.player_rank_label.text=i+"",this.player_rank_award_0.setItem(Number(n.award[0][1]),Number(n.award[0][2])),this.player_rank_award_1.setItem(Number(n.award[1][1]),Number(n.award[1][2])),this.player_rank_award_2.setItem(Number(n.award[2][1]),Number(n.award[2][2])),this.player_rank_award_3.setItem(Number(n.award[3][1]),Number(n.award[3][2])),this.player_award_group.visible=!0},i.prototype.refreshUnionAward=function(t,i){var n=null;n=3>=i?this.isCrossServer?e.JsonDataManager.instance.usCSIntegralRankAwardTemplate[i]:e.JsonDataManager.instance.usIntegralRankAwardTemplate[i]:this.isCrossServer?e.JsonDataManager.instance.usCSIntegralRankAwardTemplate[4]:e.JsonDataManager.instance.usIntegralRankAwardTemplate[4],this.union_score_label.text=t+"",this.union_rank_label.text=i+"",this.union_rank_award_0.setItem(Number(n.award[0][1]),Number(n.award[0][2])),this.union_rank_award_1.setItem(Number(n.award[1][1]),Number(n.award[1][2])),this.union_rank_award_2.setItem(Number(n.award[2][1]),Number(n.award[2][2])),this.union_rank_award_3.setItem(Number(n.award[3][1]),Number(n.award[3][2])),this.union_award_group.visible=!0},i.prototype.refreshOfficialAward=function(t){if(0!=t){var i=e.JsonDataManager.instance.usPosAwardTemplate[t];return this.isCrossServer&&(i=e.JsonDataManager.instance.usCSPosAwardTemplate[t]),this.union_siege_official_label.text=i.name,this.union_siege_award_0.setItem(Number(i.award[0][1]),Number(i.award[0][2])),this.union_siege_award_1.setItem(Number(i.award[1][1]),Number(i.award[1][2])),this.union_siege_award_2.setItem(Number(i.award[2][1]),Number(i.award[2][2])),this.union_siege_award_group.visible=!0,!0}return this.union_siege_award_group.visible=!1,!1},i}(eui.Component);e.BattleUI_UnionSiegeResult=t,__reflect(t.prototype,"foxgame.BattleUI_UnionSiegeResult")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i,n,o){var a=t.call(this)||this;return a.mId="",a.mName="",a.mData=null,a.mPlay=!1,a.mPlayComplete=null,a.mPlayToFrame=null,a.mObject=null,a.mAniCache=null,a.mState=!1,a.mTexture=null,a.mPlayComplete=i,a.mPlayToFrame=n,a.mObject=o,a.mData=new e.SimpleAnimationEntity,a.mPlay=!1,a}return __extends(i,t),i.prototype.play=function(t,i,n,o,a){void 0===n&&(n=30),void 0===o&&(o=1),void 0===a&&(a=0),t?(this.mTexture=null,this.mId=t,this.mName=i,this.mData.setData(Math.floor(1e3/n),Number.MAX_VALUE,o,a),e.AnimationManager.instance.addAni(this)?this.complete():this.mAniCache=null):e.AnimationManager.instance.addAni(this),this.mData.play(),this.mPlay=!0,this.mState=!0},i.prototype.stop=function(e){e?this.mAniCache&&(this.mTexture=this.mAniCache.getTextureByFrame(this.mName,e-1)):this.mData.stop(),this.mPlay=!1,this.mState=!1},i.prototype.advanceTime=function(e){if(this.mPlay){var t=this.mData.getFrame();this.mAniCache&&(!this.mTexture,this.mTexture=this.mAniCache.getTextureByFrame(this.mName,t-1)),this.mData.callFrame>0&&!this.mData.isCall&&this.mData.currentFrame!=this.mData.totalFrame&&this.mData.currentPlayCount*this.mData.totalFrame+this.mData.currentFrame>=this.mData.curCallFrame&&(this.mData.isCall=!0,this.mPlayToFrame&&this.mPlayToFrame.call(this.mObject,this)),this.mData.currentPlayCount>=this.mData.totalPlayCount&&(this.mPlay=!1,this.mPlayComplete&&this.mPlayComplete.call(this.mObject,this))}},i.prototype.$render=function(){this.mTexture},i.prototype.$measureContentBounds=function(e){if(!this.mTexture)return void t.prototype.$measureContentBounds.call(this);var i=this.mTexture.$offsetX,n=this.mTexture.$offsetY,o=this.mTexture.$bitmapWidth,a=this.mTexture.$bitmapHeight;e.setTo(i,n,o,a)},i.prototype.resId=function(){return this.mId},i.prototype.complete=function(){this.mAniCache=e.AnimationManager.instance.getAnimationCache(this.mId),this.mData.totalFrame=this.mAniCache.totalFrame(this.mName);new egret.TextField},i.prototype.state=function(){return this.mState},Object.defineProperty(i.prototype,"playComplete",{set:function(e){this.mPlayComplete=e
},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playToFrame",{set:function(e){this.mPlayToFrame=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"thisObject",{set:function(e){this.mObject=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlay",{get:function(){return this.mPlay},enumerable:!0,configurable:!0}),i.prototype.clear=function(){this.mTexture=null,this.mPlay=!1,this.mState=!1,this.mAniCache=null},i.prototype.dispose=function(){this.clear(),this.mData=null,this.mPlayComplete=null,this.mPlayToFrame=null,this.mObject=null},i}(egret.DisplayObject);e.SimpleAnimation=t,__reflect(t.prototype,"foxgame.SimpleAnimation",["foxgame.IAnimation","foxgame.IDispose"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),n.prototype.addListener=function(){t.prototype.addListener.call(this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_SHOW,this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_HIDE,this)},n.prototype.removeListener=function(){t.prototype.removeListener.call(this),e.Message.instance.remove(e.MsgCMD.BATTLE_POP_SHOW,this),e.Message.instance.remove(e.MsgCMD.BATTLE_POP_HIDE,this)},n.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.BATTLE_POP_SHOW:this.onMsgBattlePopShow(i);break;case e.MsgCMD.BATTLE_POP_HIDE:this.onMsgBattlePopHide(i)}},n.prototype.onMsgBattlePopShow=function(e){},n.prototype.onMsgBattlePopHide=function(e){},n.prototype.interruptState=function(e){switch(e){case i.TRANS:this.interruptStateTrans()}},n.prototype.interruptStateTrans=function(){},n.prototype.interruptStateBattle=function(){this.scene.stopBattleTimer(this.onBattleUpdate,this)},n.prototype.changeToState=function(e,t){switch(e){case i.NONE:this.changeToStateNone(t);break;case i.TRANS:this.changeToStateTrans(t);break;case i.BATTLE:this.changeToStateBattle(t);break;case i.DROP:this.changeToStateDrop(t);break;case i.DOOR:this.changeToStateDoor(t);break;case i.END:this.changeToStateEnd(t)}},n.prototype.changeToStateNone=function(t){e.LogUtil.getInstance().log("StateManager_Challenge","切换到空白状态")},n.prototype.changeToStateTrans=function(t){e.LogUtil.getInstance().log("StateManager_Challenge","切换到传送状态"),this.scene.setInUse(!0),this.actorManager.stopActorForAll();var n=t.oldBattleType,o=this.scene.getStateManagerByBattleType(n),a=this.scene.checkNeedTransByBattleType(n,this.battleType);a?this.actorManager.playFlyActionByBattleInfo(this.battleInfo,{beforeCallback:function(){this.setMainUIVisible(this.battleType)}.bind(this),flyCallback:function(){this.changeBattleMap(this.battleType,this.battleInfo.getMapId()),o.releaseBattleRes()}.bind(this),landCallback:function(){this.setBattleUIVisible(this.battleType),this.actorManager.resetActorByBattleInfo(this.battleInfo),this.scene.changeState(this.battleType,i.BATTLE,null,"传送完毕")}.bind(this)}):(this.setMainUIVisible(this.battleType),this.changeBattleMap(this.battleType,this.battleInfo.getMapId()),o.releaseBattleRes(),this.setBattleUIVisible(this.battleType),this.actorManager.resetActorByBattleInfo(this.battleInfo),this.scene.changeState(this.battleType,i.BATTLE,null,"不需要传送"))},n.prototype.changeToStateBattle=function(t){e.LogUtil.getInstance().log("StateManager_Challenge","切换到战斗状态")},n.prototype.changeToStateDrop=function(t){e.LogUtil.getInstance().log("StateManager_Challenge","切换到掉落状态")},n.prototype.changeToStateDoor=function(t){e.LogUtil.getInstance().log("StateManager_Challenge","切换到传送点状态")},n.prototype.changeToStateEnd=function(t){e.LogUtil.getInstance().log("StateManager_Challenge","切换到结束状态")},n.prototype.handleBattleInfo=function(e){var t=this.scene.battleType;this.battleType=e.getBattleType(),this.battleInfo=e,this.scene.changeState(this.battleType,i.TRANS,{oldBattleType:t},"接收到战斗消息")},n.prototype.interruptBattle=function(){this.scene.changeState(this.battleType,i.NONE,null,"打断战斗"),this.releaseBattleRes()},n.prototype.releaseBattleRes=function(){t.prototype.releaseBattleRes.call(this)},n.prototype.setMainUIVisible=function(t){switch(t){case e.BattleType.BATTLE_CHALLENGE:case e.BattleType.BOSS_PLUNDER_SINGLE:case e.BattleType.BATTLE_UNION_BOSS:case e.BattleType.GHOST_TOWER:var i=e.RequestFightManager.instance.getRequestOwnerName();"无"!=i&&""!=i?e.MainControler.instance.bossFightPvpVisible(!1):e.MainControler.instance.bossFightBloodVisible(!1,!1,0);break;case e.BattleType.DAY_COPY:e.MainControler.instance.bossFightCopyVisible();break;case e.BattleType.BATTLE_PVP_ARENA:e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.jingjiPvpChangeUI();break;case e.BattleType.CS_ARENA_DAN:case e.BattleType.CS_ARENA_PRELIMINARY:e.KFController.getInstance().showSmackDownPanel(),e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.kuafuFightVisible();break;case e.BattleType.LEGENDARY_EMPIRE:e.MainControler.instance.bossFightBloodVisible(!1,!1,t);break;case e.BattleType.PRISONER_LVEDUO:case e.BattleType.PRISONER_REWENZHI:e.MainControler.instance.jingjiPvpChangeUI();break;case e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER:e.MainControler.instance.bossFightPvpVisible(!1),e.MainControler.instance.jingjiPvpChangeUI()}},n.prototype.setBattleUIVisible=function(e){switch(e){}},n.prototype.changeBattleMap=function(t,i){switch(t){case e.BattleType.BATTLE_PVE_BOSS:case e.BattleType.BATTLE_MAP_PK:this.mapManager.refreshNormalMapByMapId(i);break;default:this.mapManager.refreshBossMapByMapId(i)}},n.prototype.onBattleUpdate=function(){var e=this.actorManager.checkBattleFilmOverForAll();e?this.scene.changeState(this.battleType,i.END,null,"战斗播放完毕"):this.actorManager.updateBattleFilmForAll()},n.prototype.changeToScene=function(e){t.prototype.changeToScene.call(this,e)},n}(e.StateManager_Base);e.StateManager_Challenge=t,__reflect(t.prototype,"foxgame.StateManager_Challenge");var i;!function(e){e[e.NONE=0]="NONE",e[e.TRANS=1]="TRANS",e[e.BATTLE=2]="BATTLE",e[e.DROP=3]="DROP",e[e.POP=4]="POP",e[e.END=5]="END",e[e.DOOR=6]="DOOR"}(i||(i={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),n.prototype.addListener=function(){t.prototype.addListener.call(this),e.Message.instance.add(e.Code.EQUIP_DRESS_S,this)},n.prototype.removeListener=function(){t.prototype.removeListener.call(this),e.Message.instance.remove(e.Code.EQUIP_DRESS_S,this)},n.prototype.recvMsg=function(t,i){switch(t){case e.Code.EQUIP_DRESS_S:}},n.prototype.interruptState=function(e){switch(e){case i.MOVE:this.interruptStateMove()}},n.prototype.interruptStateMove=function(){e.LogUtil.getInstance().log("StateManager_GuideBattle","打断移动状态"),this.mapManager.setTiledMapEnable(!1),this.mapManager.stopTouchMove(),this.actorManager.stopActorForAll()},n.prototype.changeToState=function(e,t){switch(e){case i.TRANS:this.changeToStateTrans(t);break;case i.MOVE:this.changeToStateMove(t)}},n.prototype.changeToStateTrans=function(t){e.LogUtil.getInstance().log("StateManager_GuideBattle","切换到传送状态"),this.scene.setInUse(!0),this.sceneManager.setAlive(!0),this.actorManager.stopActorForAll();var n=t.oldBattleType,o=this.scene.getStateManagerByBattleType(n);o.releaseBattleRes(),this.battleType=t.newBattleType,this.setMainUIVisible(this.battleType),this.changeBattleMap(this.battleType,t.mapId),this.setBattleUIVisible(this.battleType),this.scene.changeState(this.battleType,i.MOVE,null,"传送完毕")},n.prototype.changeToStateMove=function(t){e.LogUtil.getInstance().log("StateManager_GuideBattle","切换到移动状态"),this.mapManager.setTiledMapEnable(!0),this.mapManager.startTouchMove()},n.prototype.handleBattleInfo=function(e){},n.prototype.interruptBattle=function(){},n.prototype.releaseBattleRes=function(){t.prototype.releaseBattleRes.call(this)},n.prototype.changeToScene=function(n){switch(t.prototype.changeToScene.call(this,n),this.sceneManager.sceneType){case e.WorldSceneType.GuideBattle:var o=e.BattleType.BATTLE_GUIDE;this.scene.changeState(o,i.TRANS,{mapId:n.getMapId(),newBattleType:o,oldBattleType:this.scene.battleType},"开始新手引导")}},n.prototype.changeBattleMap=function(t,i){switch(t){case e.BattleType.BATTLE_GUIDE:this.mapManager.refreshBossMapByMapId(i),this.mapManager.showSwitchByConfig([{pos:1,effect:e.SwitchEffect.TRANS}])}},n.prototype.setMainUIVisible=function(t){switch(t){case e.BattleType.BATTLE_GUIDE:e.MainControler.instance.bossFightBloodVisible(!1,!1,0),e.MainControler.instance.setBottomVisible(!0),e.MainControler.instance.showchat(!0)}},n.prototype.setBattleUIVisible=function(t){switch(t){case e.BattleType.BATTLE_GUIDE:if(this.scene.battleUI){if(this.scene.battleUI instanceof e.BattleUI_Guide){this.scene.battleUI.refresh({map:1});break}this.scene.battleUI.dispose(),this.scene.battleUI=null}this.scene.battleUI=new e.BattleUI_Guide({scene:this.scene,actorManager:this.actorManager,dropManager:this.dropManager,mapManager:this.mapManager,sceneManager:this.sceneManager,playerManager:this.playerManager}),this.scene.battleUI.show({map:1})}},n.prototype.onTimeSwitchOver=function(t){this.sceneManager.sceneType==e.WorldSceneType.GuideBattle},n.prototype.onTimerStopMove=function(){this.sceneManager.sceneType==e.WorldSceneType.GuideBattle&&this.scene.battleUI&&this.scene.battleUI instanceof e.BattleUI_Guide&&this.scene.battleUI.onStopMove()},n}(e.StateManager_Base);e.StateManager_GuideBattle=t,__reflect(t.prototype,"foxgame.StateManager_GuideBattle");var i;!function(e){e[e.NONE=0]="NONE",e[e.TRANS=1]="TRANS",e[e.MOVE=2]="MOVE"}(i||(i={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),n.prototype.interruptState=function(e){switch(e){case i.MOVE:this.interruptStateMove()}},n.prototype.interruptStateMove=function(){e.LogUtil.getInstance().log("stateManager_MainCity","打断移动状态"),this.actorManager.stopActorForAll(),e.MainControler.instance.gotoField()},n.prototype.changeToState=function(e,t){switch(e){case i.MOVE:this.changeToStateMove(t)}},n.prototype.changeToStateMove=function(t){e.LogUtil.getInstance().log("stateManager_MainCity","切换到移动状态"),this.scene.setInUse(!0),e.MainBottomControler.PageState=e.SceneType.MainCity,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,e.SceneType.MainCity),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.MAIN_SCENE_CLICK),this.sceneManager.setAlive(!0),this.actorManager.stopActorForAll();var i=t.oldBattleType,n=this.scene.getStateManagerByBattleType(i);n.releaseBattleRes(),this.setMainUIVisible(this.battleType),this.setBattleUIVisible(this.battleType)},n.prototype.changeToScene=function(t){var n=this.sceneManager.sceneType,o=this.sceneManager.sceneId,a=this.scene.getStateManagerBySceneType(n,o);a.removeListener();var s=t.getSceneType(),r=t.getTargetSceneId(),l=this.scene.getStateManagerBySceneType(s,r);switch(l.addListener(),this.sceneManager.setSceneTypeAndSceneId(s,r),this.sceneManager.sceneType){case e.WorldSceneType.GuideMainCity:this.battleType=e.BattleType.MAIN_CITY_GUIDE,this.scene.changeState(this.battleType,i.MOVE,{oldBattleType:this.scene.battleType},"切换场景")}},n.prototype.setMainUIVisible=function(t){switch(t){case e.BattleType.MAIN_CITY_GUIDE:e.MainControler.instance.bossFightBloodVisible(!1,!1,0),e.MainControler.instance.setBottomVisible(!0),e.MainControler.instance.showchat(!0)}},n.prototype.setBattleUIVisible=function(t){switch(t){case e.BattleType.MAIN_CITY_GUIDE:if(this.scene.battleUI){if(this.scene.battleUI instanceof e.BattleUI_Guide){this.scene.battleUI.refresh({map:2});break}this.scene.battleUI.dispose(),this.scene.battleUI=null}this.scene.battleUI=new e.BattleUI_Guide({scene:this.scene,actorManager:this.actorManager,dropManager:this.dropManager,mapManager:this.mapManager,sceneManager:this.sceneManager,playerManager:this.playerManager}),this.scene.battleUI.show({map:2})}},n}(e.StateManager_Base);e.StateManager_GuideMainCity=t,__reflect(t.prototype,"foxgame.StateManager_GuideMainCity");var i;!function(e){e[e.NONE=0]="NONE",e[e.MOVE=1]="MOVE"}(i||(i={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),n.prototype.interruptState=function(e){switch(e){case i.MOVE:this.interruptStateMove()}},n.prototype.interruptStateMove=function(){e.LogUtil.getInstance().log("StateManager_Normal","打断移动状态"),this.actorManager.stopActorForAll()},n.prototype.changeToState=function(e,t){switch(e){case i.MOVE:this.changeToStateMove(t)}},n.prototype.changeToStateMove=function(t){e.LogUtil.getInstance().log("StateManager_Normal","切换到移动状态");var i=t.oldBattleType;i==e.BattleType.BATTLE_GUIDE&&(e.BattleScene.instance.resetBackPos(),e.BattleScene.instance.getNormalBattleOnCreate()),this.scene.setInUse(!1),this.sceneManager.setAlive(!0),this.actorManager.stopActorForAll();var n=this.scene.getStateManagerByBattleType(i);n.releaseBattleRes(),this.setMainUIVisible(this.battleType),this.setBattleUIVisible(this.battleType)},n.prototype.changeToScene=function(t){var n=this.sceneManager.sceneType,o=this.sceneManager.sceneId,a=this.scene.getStateManagerBySceneType(n,o);a.removeListener();var s=t.getSceneType(),r=t.getTargetSceneId(),l=this.scene.getStateManagerBySceneType(s,r);switch(l.addListener(),this.sceneManager.setSceneTypeAndSceneId(s,r),n==e.WorldSceneType.UnionWarBattleMap?e.Message.instance.send(e.MsgCMD.UNION_SIEGE_EXIT_BATTLE_SCENE,null,!1):n==e.WorldSceneType.CrossServerUnionSiegeMap&&e.UnionSiegeController.getInstance().showCrossServerPanel(3),this.sceneManager.sceneType){case e.WorldSceneType.OldMonsterBattleMap:this.battleType=e.BattleType.BATTLE_PVE_MONSTER,this.mapManager.refreshNormalMap(),this.scene.changeState(this.battleType,i.MOVE,{oldBattleType:this.scene.battleType},"切换场景")}},n.prototype.setMainUIVisible=function(t){switch(t){case e.BattleType.BATTLE_PVE_MONSTER:}},n.prototype.setBattleUIVisible=function(t){switch(t){case e.BattleType.BATTLE_PVE_MONSTER:this.scene.battleUI&&(this.scene.battleUI.dispose(),this.scene.battleUI=null),e.BossBloodGroup.getInstance().close()}},n}(e.StateManager_Base);e.stateManager_Normal=t,__reflect(t.prototype,"foxgame.stateManager_Normal");var i;!function(e){e[e.NONE=0]="NONE",e[e.MOVE=1]="MOVE"}(i||(i={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(e){var i=t.call(this,e)||this;return i.battling=!1,i.battleTypeValue={},i.battleResult=null,i.initBattleTypeValue(),i}return __extends(n,t),n.prototype.initBattleTypeValue=function(){this.battleTypeValue[e.BattleType.BOSS_TWELVE_PALACE_FIGHT]=1,this.battleTypeValue[e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER]=1,this.battleTypeValue[e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER]=1,this.battleTypeValue[e.BattleType.UNION_SIEGE_GATE_BATTLE]=2,this.battleTypeValue[e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY]=2,this.battleTypeValue[e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT]=2,this.battleTypeValue[e.BattleType.UNION_SIEGE_BATTLE_PALACE]=2,this.battleTypeValue[e.BattleType.CS_UNION_SIEGE_GATE_BATTLE]=3,this.battleTypeValue[e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY]=3,this.battleTypeValue[e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT]=3,this.battleTypeValue[e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE]=3},n.prototype.addListener=function(){t.prototype.addListener.call(this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_SHOW,this),e.Message.instance.add(e.MsgCMD.BATTLE_POP_HIDE,this)},n.prototype.removeListener=function(){t.prototype.removeListener.call(this),e.Message.instance.remove(e.MsgCMD.BATTLE_POP_SHOW,this),e.Message.instance.remove(e.MsgCMD.BATTLE_POP_HIDE,this)},n.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.BATTLE_POP_SHOW:this.onMsgBattlePopShow(i);break;case e.MsgCMD.BATTLE_POP_HIDE:this.onMsgBattlePopHide(i);break;case e.Code.SYNC_TWELVE_PALACE_SCENE_INFO:this.onMsgTwelvePalaceSceneInfo(i);break;case e.Code.SYNC_TWELVE_PALACE_SCENE_RESULT_INFO:this.onMsgTwelvePalaceSceneResult(i)}},n.prototype.onMsgBattlePopShow=function(e){},n.prototype.onMsgBattlePopHide=function(e){},n.prototype.onMsgTwelvePalaceSceneInfo=function(t){e.LogUtil.getInstance().log("StateManager_RealTime","接收十二星宫场景信息")},n.prototype.onMsgTwelvePalaceSceneResult=function(t){e.LogUtil.getInstance().log("StateManager_RealTime","接收十二星宫战斗结果");var i=t.getResultType(),n=t.getSubRet(),o=e.PlayerService.instance.playerInfo.getPlayerId();switch(i){case 1:break;case 2:var a=null,s=null;1==n?o==t.getPlayerId2()?(a=t.getPlayerName1(),s="<font color='#21ff03'>"+a+"</font>击败了你"):o==t.getPlayerId1()&&(s="挑战成功"):2==n&&(o==t.getPlayerId1()?s=t.getPlayerName2()+"挑战你失败了":o==t.getPlayerId2()&&(a=t.getPlayerName1(),s="挑战失败")),s&&e.PopUpController.getInstance().showFloatTextPanel1(s),a&&(this.sceneManager.setAlive(!1),e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this.sceneManager.alive,sceneId:this.sceneManager.sceneId}));break;case 3:var r=t.getPlayerName1(),l=!1;o==t.getPlayerId1()&&(l=!0);var a=null,h=null,c=t.getPlayerId2();if(c){var u=e.JsonDataManager.instance.monster[c];a=u.name,h=u.iconPath}var p="";if(e.MainControler.instance.sceneId){var g=e.JsonDataManager.instance.twelvePalaceTemplate[e.MainControler.instance.sceneId];p=g.name}1==n?(e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,null),this.battleInfo.setDropItem(t.getDropItem()),this.battleResult={data:{mine:l,player:r,enemy:a,enemyIcon:h,palace:p,twelvePalaceId:t.getPalaceType(),result:n,award:t.getAward()},player:t.getPlayerId1()},this.battling=!1):2==n?o==t.getPlayerId1()&&(this.sceneManager.setAlive(!1),e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,{alive:this.sceneManager.alive,sceneId:this.sceneManager.sceneId})):3==n&&(e.Message.instance.send(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,null),this.battleInfo.setDropItem([]),this.battleResult={data:{player:r,enemy:a,enemyIcon:h,palace:p,twelvePalaceId:t.getPalaceType(),result:n},player:t.getPlayerId1()},this.battling=!1)}},n.prototype.interruptState=function(e){switch(e){case i.TRANS:this.interruptStateTrans();break;case i.BATTLE:this.interruptStateBattle();break;case i.DROP:this.interruptStateDrop();break;case i.POP:this.interruptStatePop();break;case i.END:this.interruptStateEnd()}},n.prototype.interruptStateTrans=function(){},n.prototype.interruptStateBattle=function(){this.scene.stopBattleTimer(this.onBattleUpdate,this),this.mapManager.setTiledMapEnable(!1),this.mapManager.stopTouchMove(),this.actorManager.stopActorForAll()},n.prototype.interruptStateDrop=function(){this.dropManager.interruptPickUp()},n.prototype.interruptStatePop=function(){},n.prototype.interruptStateEnd=function(){},n.prototype.changeToState=function(e,t){switch(e){case i.TRANS:this.changeToStateTrans(t);break;case i.BATTLE:this.changeToStateBattle(t);break;case i.DROP:this.changeToStateDrop(t);break;case i.POP:this.changeToStatePop(t);break;case i.END:this.changeToStateEnd(t)}},n.prototype.changeToStateTrans=function(t){e.LogUtil.getInstance().log("StateManager_RealTime","切换到传送状态"),this.scene.setInUse(!0),this.sceneManager.setAlive(!0),this.actorManager.stopActorForAll(),this.battling=!0;var n=t.oldBattleType,o=this.scene.getStateManagerByBattleType(n);o.releaseBattleRes();var a=t.newBattleType,s=t.newBattleInfo,r=this.scene.checkNeedTransByBattleType(n,a);s?r?this.actorManager.playFlyActionByBattleInfo(s,{beforeCallback:function(){this.setMainUIVisible(a)}.bind(this),flyCallback:function(){this.changeBattleMap(a,s.getMapId()),o.releaseBattleRes(),this.battleType=a,this.battleInfo=s}.bind(this),landCallback:function(){this.setBattleUIVisible(this.battleType),this.actorManager.resetActorByBattleInfo(this.battleInfo),this.actorManager.setActorHpTypeByBattleType(this.battleType),this.scene.changeState(this.battleType,i.BATTLE,null,"传送完毕")}.bind(this)}):(o.releaseBattleRes(),this.battleType=a,this.battleInfo=s,this.setMainUIVisible(this.battleType),this.changeBattleMap(this.battleType,this.battleInfo.getMapId()),this.setBattleUIVisible(this.battleType),this.actorManager.resetActorByBattleInfo(this.battleInfo),this.actorManager.setActorHpTypeByBattleType(this.battleType),this.scene.changeState(this.battleType,i.BATTLE,null,"不需要传送")):(o.releaseBattleRes(),this.battleType=a,this.setMainUIVisible(this.battleType),this.changeBattleMap(this.battleType,t.mapId),this.setBattleUIVisible(this.battleType),this.scene.changeState(this.battleType,i.BATTLE,null,"没有战斗数据，不传送"))},n.prototype.changeToStateBattle=function(t){e.LogUtil.getInstance().log("StateManager_RealTime","切换到战斗状态"),this.scene.startBattleTimer(this.onBattleUpdate,this),this.mapManager.setTiledMapEnable(!0),this.mapManager.startTouchMove()},n.prototype.changeToStateDrop=function(t){if(e.LogUtil.getInstance().log("StateManager_RealTime","切换到掉落状态"),!this.battleInfo)return void e.LogUtil.getInstance().log("StateManager_RealTime","没有战斗数据");var n=this.battleInfo.getDropItem();if(!n||0==n.length)return void e.LogUtil.getInstance().log("StateManager_RealTime","没有掉落");var o=new egret.Point(0,0);this.dropManager.createDropAward(n,o,function(){if(this.scene.battleState!=i.DROP){return void e.LogUtil.getInstance().log("StateManager_RealTime","当前状态不是掉落状态")}}.bind(this)),e.Message.instance.send(e.MsgCMD.QUICK_GET_REWARD)},n.prototype.changeToStatePop=function(t){e.LogUtil.getInstance().log("StateManager_RealTime","切换到弹窗状态"),this.scene.changeState(this.battleType,i.END,null,"弹窗")},n.prototype.changeToStateEnd=function(t){e.LogUtil.getInstance().log("StateManager_RealTime","切换到结束状态"),this.releaseBattleRes(),this.scene.battleTypeOver()},n.prototype.handleBattleInfo=function(t){var n=this.scene.battleType,o=t.getBattleType(),a=t;if(o!=e.BattleType.BOSS_TWELVE_PALACE_FIGHT&&o!=e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER&&o!=e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER&&o!=e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER&&o!=e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER)if(this.battling){var s=this.battleTypeValue[n],r=this.battleTypeValue[o];s&&r&&s==r?(this.battleType=o,this.battleInfo=a,this.refreshBattleInfo()):this.scene.changeState(o,i.TRANS,{newBattleType:o,oldBattleType:n,newBattleInfo:a},"接收到战斗消息，新战斗")}else this.battling=!0,this.scene.changeState(o,i.TRANS,{newBattleType:o,oldBattleType:n,newBattleInfo:a},"接收到战斗消息，新战斗")},n.prototype.refreshBattleInfo=function(){this.actorManager.refreshActorByBattleInfo(this.battleInfo),this.actorManager.setActorHpTypeByBattleType(this.battleType)},n.prototype.interruptBattle=function(){this.scene.changeState(this.battleType,i.NONE,null,"打断战斗"),this.releaseBattleRes()},n.prototype.releaseBattleRes=function(){t.prototype.releaseBattleRes.call(this)},n.prototype.setMainUIVisible=function(t){switch(t){case e.BattleType.BOSS_TWELVE_PALACE_FIGHT:case e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER:case e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER:e.MainControler.instance.bossFightBloodVisible(!1,!1,0);break;case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:e.MainControler.instance.bossFightBloodVisible(!1,!1,0)}},n.prototype.setBattleUIVisible=function(t){switch(t){case e.BattleType.BOSS_TWELVE_PALACE_FIGHT:case e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER:case e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER:e.MainControler.instance.bossFightBloodVisible(!1,!1,0);break;case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:if(this.scene.battleUI){if(this.scene.battleUI instanceof e.BattleUI_UnionSiege){this.scene.battleUI.refresh();break}this.scene.battleUI.dispose(),this.scene.battleUI=null}this.scene.battleUI=new e.BattleUI_UnionSiege({scene:this.scene,actorManager:this.actorManager,dropManager:this.dropManager,mapManager:this.mapManager,sceneManager:this.sceneManager,playerManager:this.playerManager}),this.scene.battleUI.show()}},n.prototype.changeBattleMap=function(t,i){switch(t){case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:this.mapManager.refreshBossMapByMapId(i),this.mapManager.hideSwitchForAll();break;case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:this.mapManager.refreshBossMapByMapId(i),this.mapManager.showSwitchByConfig([{pos:0,effect:e.SwitchEffect.TRANS},{pos:1,effect:e.SwitchEffect.TRANS}]);break;case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:this.mapManager.refreshBossMapByMapId(i),this.mapManager.showSwitchByConfig([{pos:0,effect:e.SwitchEffect.TRANS},{pos:1,effect:e.SwitchEffect.FLAG}]);break;default:this.mapManager.refreshBossMapByMapId(i)}},n.prototype.onBattleUpdate=function(){var e=this.actorManager.checkBattleFilmOverForAll();!this.battling&&e?this.scene.changeState(this.battleType,i.END,null,"战斗播放完毕"):this.actorManager.updateBattleFilmForAll()},n.prototype.changeToScene=function(n){switch(t.prototype.changeToScene.call(this,n),this.sceneManager.sceneType){case e.WorldSceneType.TwelvePalaceBossBattleMap:break;case e.WorldSceneType.UnionWarBattleMap:var o=null;switch(this.sceneManager.sceneId){case e.UnionSiegeScene.US_GATE:o=e.BattleType.UNION_SIEGE_GATE_BATTLE;break;case e.UnionSiegeScene.US_CITY:o=e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY;break;case e.UnionSiegeScene.US_PALACE_FRONT:o=e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT;break;case e.UnionSiegeScene.US_PALACE:o=e.BattleType.UNION_SIEGE_BATTLE_PALACE}this.scene.changeState(o,i.TRANS,{mapId:n.getMapId(),newBattleType:o,oldBattleType:this.scene.battleType},"切换皇城地图");break;case e.WorldSceneType.CrossServerUnionSiegeMap:var o=null;switch(this.sceneManager.sceneId){case e.UnionSiegeScene.US_GATE:o=e.BattleType.CS_UNION_SIEGE_GATE_BATTLE;break;case e.UnionSiegeScene.US_CITY:o=e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY;break;case e.UnionSiegeScene.US_PALACE_FRONT:o=e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT;break;case e.UnionSiegeScene.US_PALACE:o=e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE}this.scene.changeState(o,i.TRANS,{mapId:n.getMapId(),newBattleType:o,oldBattleType:this.scene.battleType},"切换皇城地图")}},n.prototype.onTimeSwitchOver=function(t){switch(this.sceneManager.sceneType){case e.WorldSceneType.UnionWarBattleMap:this.scene.battleUI&&this.scene.battleUI instanceof e.BattleUI_UnionSiege&&this.scene.battleUI.onSwitch(t);break;case e.WorldSceneType.CrossServerUnionSiegeMap:this.scene.battleUI&&this.scene.battleUI instanceof e.BattleUI_UnionSiege&&this.scene.battleUI.onSwitch(t)}},n.prototype.getHpColorByBattleType=function(t,i,n){var o=null;switch(t){case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:if(i==this.playerManager.serverId&&n==this.playerManager.playerId)o="green";else if(o="red",this.scene.battleUI.scenePlayerData&&this.scene.battleUI.scenePlayerData[i]&&this.scene.battleUI.scenePlayerData[i][n]){var a=this.scene.battleUI.scenePlayerData[i][n];a&&a.serverId&&a.serverId==this.playerManager.serverId&&a.unionId&&a.unionId==this.playerManager.unionId&&(o="green")}}return o},n.prototype.onSelfDeath=function(t){switch(this.battleType){case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:this.scene.battleUI&&this.scene.battleUI instanceof e.BattleUI_UnionSiege&&this.scene.battleUI.refreshReliveGroup(!1,t)}},n.prototype.onSelfRelive=function(){switch(this.battleType){case e.BattleType.UNION_SIEGE_GATE_BATTLE:case e.BattleType.UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.UNION_SIEGE_BATTLE_PALACE:case e.BattleType.CS_UNION_SIEGE_GATE_BATTLE:case e.BattleType.CS_UNION_SIEGE_BATTLE_ROYAL_CITY:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE_FRONT:case e.BattleType.CS_UNION_SIEGE_BATTLE_PALACE:this.scene.battleUI&&this.scene.battleUI instanceof e.BattleUI_UnionSiege&&this.scene.battleUI.refreshReliveGroup(!0)}},n}(e.StateManager_Base);e.StateManager_RealTime=t,__reflect(t.prototype,"foxgame.StateManager_RealTime");var i;!function(e){e[e.NONE=0]="NONE",e[e.TRANS=1]="TRANS",e[e.BATTLE=2]="BATTLE",e[e.DROP=3]="DROP",e[e.POP=4]="POP",e[e.END=5]="END",e[e.MOVE=6]="MOVE"}(i||(i={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.PART1=1]="PART1",e[e.PART2=2]="PART2",e[e.PART3=3]="PART3",e[e.PART4=4]="PART4"}(t=e.KeePartType||(e.KeePartType={}));var i;!function(e){e[e.FLOWER_TYPE=1]="FLOWER_TYPE",e[e.GOLDS_TYPE=2]="GOLDS_TYPE",e[e.KISS_TYPE=3]="KISS_TYPE",e[e.LUCKILY_TYPE=4]="LUCKILY_TYPE"}(i=e.DemonKeeType||(e.DemonKeeType={}));var n=function(){function t(){this.model=new e.BeautyModel,this.panel=new e.BeautyPanel(this.model),this.illusionpanel=new e.BeautyIllusionPanel(this.model),this.beautywear=new e.BeautyEquipWearPanel(this.model),this.beautytips=new e.Beautytips(this.model),this.beautyskilltip=new e.BeautySkillTip(this.model),this.favorpanel=new e.Favorpanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.showpanel=function(t){if(void 0===t&&(t=1),!this.panel.getIsShow()){var i=Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL"));if(e.PlayerService.instance.playerInfo.getLevel()<i)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BEAUTYOPEN",i));if(this.model.touxiangarr.length<=0)return void e.GameUtils.MSG_TIP("服务器没有发送妖姬数据");this.model.showindex=t,this.panel.show()}},t.prototype.getIsShow=function(){return this.panel&&this.panel.getIsInit()?this.panel.getIsShow():!1},t.prototype.closewearpanel=function(){this.beautywear.getIsShow()&&this.beautywear.close()},t.prototype.showfavorpanel=function(e){this.favorpanel.showpanel(e)},t.prototype.showskilltip=function(e,t){this.beautyskilltip.showPanel(e,t)},t.prototype.showtips=function(){this.beautytips.show()},t.prototype.showwearpanel=function(e){this.beautywear.showpanel(e)},t.prototype.showillusionpanel=function(){var t=Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL"));return e.PlayerService.instance.playerInfo.getLevel()<t?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BEAUTYOPEN",t)):1==this.model.first?void e.GameUtils.MSG_TIP("妖姬未激活"):void this.illusionpanel.show()},t.prototype.setbeautydata=function(e){this.model.setbeautydata(e)},t.prototype.setbeautytouxiang=function(e){this.model.setbeautytouxiang(e)},t.prototype.setbeautyillusion=function(e){this.model.setbeautydataillusion(e)},t.prototype.setbeautytouxiangillusion=function(e){this.model.setbeautytouxiangillusion(e)},t.prototype.playchongxingani=function(){this.panel.getIsShow()&&this.panel.playchongxingani()},t.prototype.getmodel=function(){return this.model},t.prototype.playupstarani=function(){this.panel.getIsShow()&&this.panel.playAni()},t.prototype.modelupdateView=function(){this.model.updateView()},t.prototype.setfightvalue=function(e){},t.prototype.registerMsg=function(t){t.add(e.Code.DEMON_KEE_INFO_S,this),t.add(e.Code.DEMON_KEE_UPGRADE_S,this),t.add(e.Code.DEMON_KEE_DOTE_ON_S,this),t.add(e.Code.DEMON_KEE_ROCKET_S,this),t.add(e.Code.DEMON_KEE_BOGGART_S,this),t.add(e.Code.DEMON_KEE_AWARD_S,this),t.add(e.Code.DEMON_KEE_EQUIP_S,this),t.add(e.Code.DEMON_KEE_FREE_S,this)
},t.prototype.recvMsg=function(t,i){switch(Log.trace("接受到的消息号:"+t),t){case e.Code.DEMON_KEE_INFO_S:this.model.setDEMON_KEE_INFO_S(i);break;case e.Code.DEMON_KEE_UPGRADE_S:this.model.setDEMON_KEE_UPGRADE_S(i);break;case e.Code.DEMON_KEE_DOTE_ON_S:this.model.setDEMON_KEE_DOTE_ON_S(i);break;case e.Code.DEMON_KEE_ROCKET_S:0==i.getErrorNo()&&this.illusionpanel.getIsShow()&&this.illusionpanel.playAniJiHuo(),this.model.setDEMON_KEE_ROCKET_S(i);break;case e.Code.DEMON_KEE_BOGGART_S:this.model.setDEMON_KEE_BOGGART_S(i);break;case e.Code.DEMON_KEE_AWARD_S:this.model.setDEMON_KEE_AWARD_S(i);break;case e.Code.DEMON_KEE_EQUIP_S:this.model.setDEMON_KEE_EQUIP_S(i);break;case e.Code.DEMON_KEE_FREE_S:this.model.first=!1;var n=i;n&&0==n.getErrorNo()&&this.panel.playAniJiHuo(),this.panel.setfirstgroup(),this.model.setDEMON_KEE_ROCKET_S(i)}},t.prototype.sendDEMON_KEE_FREE_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeFreeReq");e.Message.instance.send(e.Code.DEMON_KEE_FREE_C,t,!0)},t.prototype.sendDEMON_KEE_AWARD_C=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeKissAwardReq");n.setPetId(t),n.setLevel(Number(i)),e.Message.instance.send(e.Code.DEMON_KEE_AWARD_C,n,!0)},t.prototype.sendDEMON_KEE_EQUIP_C=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeEquipWearReq");n.setPartId(t),n.setEquiId(i),e.Message.instance.send(e.Code.DEMON_KEE_EQUIP_C,n,!0)},t.prototype.sendDEMON_KEE_UPGRADE_C=function(t,i,n){var o=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeTeachReq");o.setGoldStats(i),o.setState(t),o.setVoluntarily(n),e.Message.instance.send(e.Code.DEMON_KEE_UPGRADE_C,o,!0)},t.prototype.sendDEMON_KEE_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeInfoReq");e.Message.instance.send(e.Code.DEMON_KEE_INFO_C,t,!0)},t.prototype.sendDEMON_KEE_DOTE_ON_C=function(t,i,n){var o=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeKissReq");o.setTypeId(t),o.setPetId(i),o.setStats("down"==n),e.Message.instance.send(e.Code.DEMON_KEE_DOTE_ON_C,o,!0)},t.prototype.sendDEMON_KEE_BOGGART_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeFightReq");i.setPetId(t),i.setOldPetId(this.model.getbeauty().getpetId()),e.Message.instance.send(e.Code.DEMON_KEE_BOGGART_C,i,!0)},t.prototype.sendDEMON_KEE_ROCKET_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeFlyReq");i.setPetId(t),e.Message.instance.send(e.Code.DEMON_KEE_ROCKET_C,i,!0)},t.prototype.getdemonkee=function(){return this.model.demonkeelist},t.prototype.getbeautyEquipScore=function(t){if(null==t)return 0;var i=e.JsonDataManager.instance.demonKeeEquipTemplate[t.getItemId()];return e.GlobalUtil.getScore(i.attrTypeList,i.attrValueList)},t.prototype.redpoint=function(){if(e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL")))return!1;var t=this.panel.getdemonkeedata();if(t){var i=e.BagController.getInstance().getCountByItemId(t.costAward.id);if(i>=t.costAward.value)return!0;if(this.feishengred()||this.chongxingred()||this.equippoint()||this.tiaojiaopoint())return!0}return!1},t.prototype.tiaojiaopoint=function(){var t=e.BagController.getInstance().getCountByItemId(this.panel.getdemonkeedata().costAward.id);return t>=this.panel.getdemonkeedata().costAward.value?!0:!1},t.prototype.equippoint=function(){for(var t=1;5>t;t++)if(null!=e.BagController.getInstance().getEnableBeautyMaxEquipByPart(t))return!0;return!1},t.prototype.chongxingred=function(){for(var t in this.model.touxiangdata){var i=this.model.touxiangdata[t];if(this.model.kissNumber>=1)return!0;if(this.model.LuckilyNumber>=1)return!0;var n=e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_AWARDS_KISS"),o=n.split(","),a=e.BagController.getInstance().getCountByItemId(Number(o[0].split("_")[0])),s=e.BagController.getInstance().getCountByItemId(Number(o[1].split("_")[0]));if(a>=1)return!0;if(s>=1)return!0;for(var r=0;r<i.getawardList().length;r++){var l=Number(i.getawardList()[r]);if(-1==i.getawardList().indexOf(i.getkissLevel())&&i.getkissLevel()>=l)return!0}}return!1},t.prototype.feishengred=function(){for(var t in this.model.feisehnglist){var i=this.model.feisehnglist[t];if(-1==i.getkissLevel()){var n=e.BagController.getInstance().getCountByItemId(i.getconst().id);if(n>=i.getconst().value)return!0}else{var o=this.getDemonKeeFlyVO(i),n=e.BagController.getInstance().getCountByItemId(o.cost[0].id);if(n>=o.cost[0].value)return!0;if(o.cost.length>1){var a=e.BagController.getInstance().getCountByItemId(o.cost[1].id);if(a>=o.cost[1].value)return!0}}}return!1},t.prototype.getDemonKeeFlyVO=function(t){var i,n=e.JsonDataManager.instance.demonKeeFlyTemplate;for(var o in n){var a=n[o];if(a.petId==t.getpetId()&&a.level==t.getflyLevel())return i=a}return null},t.prototype.closePanel=function(){this.panel&&this.panel.close()},t}();e.BeautyController=n,__reflect(n.prototype,"foxgame.BeautyController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.tiaojiaoindexsend=!1,i.aniNumber=0,i.skinName="BeautyGracepanel",i.model=e,i.initlisten(),i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.refresh()},i.prototype.initlisten=function(){this.reward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.kiss.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.luckilyfxxk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.page_up.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickpagebtn,this),this.page_down.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickpagebtn,this),this.deliverose.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickmovebtn,this),this.deliverose.addEventListener(egret.TouchEvent.TOUCH_END,this.clickremovebtn,this),this.deliverose.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.clickremovebtn,this),this.senddiamonds.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickmovebtn,this),this.senddiamonds.addEventListener(egret.TouchEvent.TOUCH_END,this.clickremovebtn,this),this.senddiamonds.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.clickremovebtn,this);var t=new eui.TileLayout;this.list.dataProvider=this.model.collection,this.list.itemRenderer=e.BeautyItem,this.list.layout=t;var i=e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_AWARDS_KISS").split(","),n=i[0].split("_"),o=i[1].split("_");this.rosearid=Number(n[0]),this.diamondsid=Number(o[0])},i.prototype.clickmovebtn=function(e){switch(e.target){case this.deliverose:this.sendtiaojiao(),this.sendtiaojiaoset=setInterval(this.sendtiaojiao.bind(this),100);break;case this.senddiamonds:this.sendsenddiamonds(),this.sendtiaojiaoset=setInterval(this.sendsenddiamonds.bind(this),100)}},i.prototype.clickremovebtn=function(e){clearInterval(this.sendtiaojiaoset),this.sendtiaojiaoset=null},i.prototype.playtj=function(t){var i=this;if(!this.tjani){this.aniNumber++;var n=this.aniNumber%2==0?0:1;this.tjani=new e.FoxAni(this.playani),this.tjani.frameRate=24,this.tjani.play(t+n,"ani",1),TweenMax.delayedCall(.4,function(e){i.tjani&&(i.tjani.clear(),i.tjani=null)})}},i.prototype.playkissanig=function(t){var i=this;this.tjani||(this.tjani=new e.FoxAni(this.playkissani),this.tjani.play(t,"ani",1),TweenMax.delayedCall(.7,function(e){i.tjani&&(i.tjani.clear(),i.tjani=null)}))},i.prototype.sendtiaojiao=function(){return this.getdemonkeedata(1)?this.rosebool?void(1!=this.tiaojiaoindexsend&&(this.tiaojiaoindexsend=!0,this.playtj("beautyanih"),e.BeautyController.getInstance().sendDEMON_KEE_DOTE_ON_C(e.DemonKeeType.FLOWER_TYPE,this.datatemp.getpetId(),this.checkBoxBtn.currentState))):void e.ItemNotEnoughController.getInstance().showPanel(this.rosearid):void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"))},i.prototype.sendsenddiamonds=function(){return this.getdemonkeedata(1)?this.diamondsbool?void(1!=this.tiaojiaoindexsend&&(this.tiaojiaoindexsend=!0,this.playtj("beautyaniz"),e.BeautyController.getInstance().sendDEMON_KEE_DOTE_ON_C(e.DemonKeeType.GOLDS_TYPE,this.datatemp.getpetId(),this.checkBoxBtn.currentState))):(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void e.ItemNotEnoughController.getInstance().showPanel(this.diamondsid)):void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"))},i.prototype.clickbtn=function(t){switch(t.target){case this.reward:e.BeautyController.getInstance().showfavorpanel(this.model.getnowbeauty().getkissLevel());break;case this.kiss:if(!this.getdemonkeedata(1))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));if(!this.kissbool)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YAOJI_CHISHUBUZHU_TISHI"));this.playkissanig("beautykissani"),e.BeautyController.getInstance().sendDEMON_KEE_DOTE_ON_C(e.DemonKeeType.KISS_TYPE,this.datatemp.getpetId(),this.checkBoxBtn.currentState);break;case this.luckilyfxxk:if(!this.getdemonkeedata(1))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));if(!this.fxxkbool)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YAOJI_CHISHUBUZHU_TISHI"));e.BeautyController.getInstance().sendDEMON_KEE_DOTE_ON_C(e.DemonKeeType.LUCKILY_TYPE,this.datatemp.getpetId(),this.checkBoxBtn.currentState)}},i.prototype.clickpagebtn=function(t){switch(t.target){case this.page_up:this.selectindex-=1,this.selectindex<=0&&(this.selectindex=0),e.BeautyController.getInstance().setbeautytouxiang(this.selectindex);break;case this.page_down:this.selectindex+=1,this.selectindex>=this.model.touxiangarr.length&&(this.selectindex=this.model.touxiangarr.length-1),e.BeautyController.getInstance().setbeautytouxiang(this.selectindex)}},i.prototype.refresh=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.datatemp=this.model.getnowbeauty(),this.selectindex=this.model.touxiangarr.indexOf(this.datatemp.getpetId()+",1"),this.model.collection.replaceAll(this.model.touxiangarr),this.goodfeel.text=this.datatemp.getkissLevel()+"级",this.tenheart.setStarLvl(this.datatemp.getkissStar());var t=this.getdemonkeedata(0),i=this.getdemonkeedata(1);this.beautyprogress.maxValue=t.likability;for(var n=t.attrTypeList.length,o=[],a=0;n>a;a++)o.push({text:e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[a])+":",style:{textColor:e.ColorUtils.instance.getAttrColorById(t.attrTypeList[a])}}),o.push({text:e.GlobalUtil.getAttrValueStr(t.attrTypeList[a],Number(t.attrValueList[a])),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(t.attrTypeList[a])}}),o.push({text:"\n"});if(this.thisProperty.textFlow=o,i){n=i.attrTypeList.length;for(var s=[],a=0;n>a;a++)s.push({text:e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[a])+":",style:{textColor:e.ColorUtils.instance.getAttrColorById(i.attrTypeList[a])}}),s.push({text:e.GlobalUtil.getAttrValueStr(i.attrTypeList[a],Number(i.attrValueList[a])),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(i.attrTypeList[a])}}),s.push({text:"\n"});this.nextProperty.textFlow=s,this.beautyprogress.setProgress(this.datatemp.getkissValue())}else this.nextProperty.text=e.LanguageUtils.instance.getValue("YIMANJI"),this.beautyprogress.setDiffProgress(0);this.kissbool=!1,this.fxxkbool=!1,this.diamondsbool=!1,this.rosebool=!1;var r=e.BagController.getInstance().getCountByItemId(this.rosearid),l=e.BagController.getInstance().getCountByItemId(this.diamondsid);this.rosenum.textFlow=e.GlobalUtil.createMaterialProTextFlow(r,1),this.diamondsnum.textFlow=e.GlobalUtil.createMaterialProTextFlow(l,1),this.redPoint.visible=!1,this.setredpoint();var h=e.GlobalConfig.instance.getValue("BEAUTY_KISS_NUMBER"),c=e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_NUMBER");this.kissnum.textFlow=(new egret.HtmlTextParser).parser("<font color="+(0==this.model.kissNumber?"0xff0000":"0x00ff00")+">"+this.model.kissNumber+"</font><font color=0xffffff>/"+h+"</font>"),this.fxxknum.textFlow=(new egret.HtmlTextParser).parser("<font color="+(0==this.model.LuckilyNumber?"0xff0000":"0x00ff00")+">"+this.model.LuckilyNumber+"</font><font color=0xffffff>/"+c+"</font>"),this.page_down.y=this.scroller.y+103*this.model.touxiangarr.length+5,this.page_down.y>this.scroller.y+this.scroller.height+5&&(this.page_down.y=this.scroller.height+this.scroller.y+5),r>=1&&(this.rosebool=!0),l>=1&&(this.diamondsbool=!0),this.model.kissNumber>0&&(this.kissbool=!0),this.model.LuckilyNumber>0&&(this.fxxkbool=!0)},i.prototype.setredpoint=function(){if(this.redPoint.visible=!1,this.datatemp.getkissLevel()>=1&&-1==this.datatemp.getawardList().indexOf(this.datatemp.getkissLevel())){if(this.datatemp.getkissLevel()>10)return;this.redPoint.visible=!0}},i.prototype.getdemonkeedata=function(t){void 0===t&&(t=0);var i=Number(this.datatemp.getkissLevel()),n=Number(this.datatemp.getkissStar())+t;n>=10&&(i+=1,n=1);var o,a=e.JsonDataManager.instance.demonKeeDoteTemplate;for(var s in a){var r=a[s];if(r.level==i&&r.heartLevel==n){o=r;break}}return o},i}(eui.Component);e.BeautyGracePanel=t,__reflect(t.prototype,"foxgame.BeautyGracePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/beauty/BeautyIllusion.exml","beauty")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.jihuobtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.feishengbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.page_up.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickpagebtn,this),this.ui.page_down.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickpagebtn,this),this.ui.checkBoxBtn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.icon0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.ui.icon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this);for(var t=0;t<this.getskilllist().length;t++)this.getskilllist()[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskill,this);var i=new eui.TileLayout;this.ui.list.dataProvider=this.model.collectionillusion,this.ui.list.itemRenderer=e.BeautyItem,this.ui.list.layout=i,this.ani=new e.FoxAni(this.ui.aniGroup),this.ani.play("zdlhuodonghua","ani",-1),this.jihuoX=this.ui.jihuo.x,this.feisehngX=this.ui.feisheng.x},i.prototype.clickicon=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.clickskill=function(t){switch(t.target){case this.ui.skill1:e.BeautyController.getInstance().showskilltip(t.target.name,1);break;case this.ui.skill2:e.BeautyController.getInstance().showskilltip(t.target.name,2);break;case this.ui.skill3:case this.ui.skill4:case this.ui.skill5:case this.ui.skill6:e.BeautyController.getInstance().showskilltip(t.target.name,3)}},i.prototype.clickpagebtn=function(t){switch(t.target){case this.ui.page_up:this.selectindex-=1,this.selectindex<=0&&(this.selectindex=0),e.BeautyController.getInstance().setbeautytouxiangillusion(this.selectindex);break;case this.ui.page_down:this.selectindex+=1,this.selectindex>=this.model.touxiangfsarr.length&&(this.selectindex=this.model.touxiangfsarr.length-1),e.BeautyController.getInstance().setbeautytouxiangillusion(this.selectindex)}},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.jihuobtn:if(this.datakee.getconst().value>this.itemcount1)return void e.ItemNotEnoughController.getInstance().showPanel(this.datakee.getconst().id);e.BeautyController.getInstance().sendDEMON_KEE_ROCKET_C(this.datakee.getpetId());break;case this.ui.feishengbtn:if(this.datatemp.cost[0].value>this.itemcount1)return void e.ItemNotEnoughController.getInstance().showPanel(this.datatemp.cost[0].id);if(this.ui.feisheng.visible&&this.datatemp.cost[1].value>this.itemcount2)return void e.ItemNotEnoughController.getInstance().showPanel(this.datatemp.cost[1].id);if(30==this.datakee.getflyLevel())return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));e.BeautyController.getInstance().sendDEMON_KEE_ROCKET_C(this.datakee.getpetId());break;case this.ui.checkBoxBtn_0:if("down"==this.ui.checkBoxBtn_0.currentState)return;e.BeautyController.getInstance().sendDEMON_KEE_BOGGART_C(this.datakee.getpetId())}},i.prototype.showHook=function(){},i.prototype.refresh=function(){this.datakee=this.model.getnowflybeauty(),this.selectindex=this.model.touxiangfsarr.indexOf(this.datakee.getpetId()+",2");var t=this.getDemonKeeFlyVO();this.ui.model.source=t.modelId+"_model_png",this.ui.beautyname.source=t.modelId+"_name_png",this.model.collectionillusion.replaceAll(this.model.touxiangfsarr),this.ui.fightBLabel1.text=String(this.datakee.getfithValue()),this.ui.jihuo.visible=!1,this.ui.feisheng.visible=!1,this.ui.yimanji.visible=!1,this.ui.checkBoxBtn_0.visible=!1,this.ui.hxtxt.visible=!1,this.ui.jihuobtn.visible=!0,this.ui.feishengbtn.visible=!1,-1!=this.datakee.getkissLevel()&&(this.ui.checkBoxBtn_0.visible=!0,this.ui.hxtxt.visible=!0,this.ui.checkBoxBtn_0.currentState=this.datakee.getstate()?"down":"up",this.ui.feishengbtn.visible=!0,this.ui.jihuobtn.visible=!1),this.datatemp=null;var i=e.JsonDataManager.instance.demonKeeFlyTemplate;for(var n in i){var o=i[n];if(o.level==this.datakee.getflyLevel()&&o.petId==this.datakee.getpetId()){this.datatemp=o;break}}30==this.datatemp.level?(this.ui.jihuo.visible=!1,this.ui.feisheng.visible=!1,this.ui.jihuobtn.visible=!1,this.ui.feishengbtn.visible=!1,this.ui.yimanji.visible=!0):-1==this.datakee.getkissLevel()?(this.itemcount1=e.BagController.getInstance().getCountByItemId(this.datakee.getconst().id),this.ui.icon1.setItem(this.datakee.getconst().id,-1,!1),this.ui.xiaohao.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.itemcount1,this.datakee.getconst().value),this.ui.jihuo.x=(this.width>>1)-(this.ui.jihuo.width>>1),this.ui.jihuo.visible=!0):(this.itemcount1=e.BagController.getInstance().getCountByItemId(this.datatemp.cost[0].id),this.ui.icon1.setItem(this.datatemp.cost[0].id,-1,!1),this.ui.xiaohao.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.itemcount1,this.datatemp.cost[0].value),this.ui.jihuo.x=(this.width>>1)-(this.ui.jihuo.width>>1),this.ui.jihuo.visible=!0,this.datatemp.cost.length>1&&(this.ui.jihuo.x=this.jihuoX,this.ui.feisheng.x=this.feisehngX,this.ui.feisheng.visible=!0,this.itemcount2=e.BagController.getInstance().getCountByItemId(this.datatemp.cost[1].id),this.ui.icon0.setItem(this.datatemp.cost[1].id,-1,!1),this.ui.xiaohao2.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.itemcount2,this.datatemp.cost[1].value))),this.ui.level.text=e.GlobalUtil.sectionToChinese(this.model.teachLevel)+"阶"+e.GlobalUtil.sectionToChinese(this.model.starlevel)+"星",this.ui.jingjie.text=e.GlobalUtil.sectionToChinese(this.datakee.getflyLevel()),this.setskill()},i.prototype.setskill=function(){var t=(e.JsonDataManager.instance.demonKeeBabyTemplate[this.datakee.getpetId()],this.getDemonKeeFlyVO()),i=(this.getskilllist(),this.getskillinfo(t.talentSkillid,t.talentSkillvalue));this.ui.skill1.source=i.icon,this.ui.skill1.name=i.id+"_"+t.talentSkillvalue;var n=this.getskillinit(t.initiativeSkillid,t.initiativeSkillvalue);this.ui.skill2.source=n.icon,this.ui.skill2.name=n.skillType+"_"+t.initiativeSkillvalue,this.ui.skill1.filters=[],this.ui.skill2.filters=[],-1==this.datakee.getkissLevel()&&(this.ui.skill1.filters=e.GlobalUtil.grayFilter,this.ui.skill2.filters=e.GlobalUtil.grayFilter);for(var o=t.activationSkillid,a=t.activationSkillvalue,s=this.getskilllistbei(),r=0;r<o.length;r++){var l=o[r],h=a[r],c=s[r],u=this.getskillinfo(l,h);c.source=u.icon,c.name=u.id+"_"+h,c.filters=[],-1==this.datakee.getkissLevel()&&(c.filters=e.GlobalUtil.grayFilter),0==h&&(c.filters=e.GlobalUtil.grayFilter)}},i.prototype.getskillinit=function(t,i){var n=e.JsonDataManager.instance.skillTemplate[t+"_1"];return n},i.prototype.getskillinfo=function(t,i){var n=e.JsonDataManager.instance.demonKeeSkillTemplate[t+"_1"];return n},i.prototype.getDemonKeeFlyVO=function(){var t,i=e.JsonDataManager.instance.demonKeeFlyTemplate;for(var n in i){var o=i[n];if(o.petId==this.datakee.getpetId()&&o.level==this.datakee.getflyLevel())return t=o}return null},i.prototype.beautydataBack=function(){this.refresh()},i.prototype.beautygraceBack=function(){},i.prototype.beautyillusionBack=function(){this.refresh()},i.prototype.getskilllistbei=function(){var e=[];return e.push(this.ui.skill3),e.push(this.ui.skill4),e.push(this.ui.skill5),e.push(this.ui.skill6),e},i.prototype.getskilllist=function(){var e=[];return e.push(this.ui.skill1),e.push(this.ui.skill2),e.push(this.ui.skill3),e.push(this.ui.skill4),e.push(this.ui.skill5),e.push(this.ui.skill6),e},i.prototype.playAniJiHuo=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroupJiHuo),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroupJiHuo.visible=!0},i.prototype.playComplete=function(){this.ui.aniGroupJiHuo.visible=!1},i}(e.BasePanel);e.BeautyIllusionPanel=t,__reflect(t.prototype,"foxgame.BeautyIllusionPanel",["foxgame.IBeauty","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.touxiangdata={},this.observerList=[],this.collection=new eui.ArrayCollection,this.collectionillusion=new eui.ArrayCollection,this.touxiangdata={},this.feisehnglist={},this.demonkeelist=[],this.touxiangarr=[],this.touxiangfsarr=[],this.showtiparray=[],this.lastFightValue=0,this.teachLevel=-1,this.starlevel=-1,this.first=!1}return t.prototype.getPartInfoByPart=function(e){for(var t=0;t<this.demonkeelist.length;t++){var i=this.demonkeelist[t];if(i.getPartId()==e)return i}return null},t.prototype.setbeautydata=function(e){for(var t in this.touxiangdata){var i=this.touxiangdata[t];i.setselect(!1),i.getpetId()==e.getpetId()&&i.setselect(!0)}this.updateView()},t.prototype.setbeautytouxiang=function(e){for(var t=0;t<this.touxiangarr.length;t++){var i=this.touxiangarr[t],n=this.touxiangdata[i.split(",")[0]];n.setselect(!1),t==e&&n.setselect(!0)}this.updateView()},t.prototype.setDEMON_KEE_ROCKET_S=function(t){if(this.showtiparray=[],0==t.getErrorNo()){this.getnowflybeauty()&&(this.selectpetidByfeisehng=this.getnowflybeauty().getpetId());for(var i=0;i<t.getPetInfo().length;i++){var n=t.getPetInfo()[i];if(this.selectpetidByfeisehng==n.getPetId()){var o=this.babyVo(n.getPetId());if(n.getFlyLevel()>0){this.showtiparray.push(e.LanguageUtils.instance.getValue("YAOJI_FSCGONG_TISHI"));for(var a=this.flyVO(n.getPetId(),n.getFlyLevel()),s=0;s<a.skilltipid.length;s++){var r=a.skilltipid[s],l=a.skilltipvalue[s],h=this.skillVO(r,l);r>1?this.showtiparray.push(e.LanguageUtils.instance.getValue("YAOJI_SJJINENG_TISHI",o.name)):this.showtiparray.push(e.LanguageUtils.instance.getValue("YAOJI_JSJINENG_TISHI",o.name,h.name))}break}this.showtiparray.push(e.LanguageUtils.instance.getValue("JIHUOCHENGGONG"));break}}clearInterval(this.sendtiaojiaoset),this.sendtiaojiaoset=null,this.sendtiaojiaoset=setInterval(this.showTIP.bind(this),300),this.settouxiangdata(t.getPetInfo()),this.updateView()}},t.prototype.showTIP=function(){return 0==this.showtiparray.length?(clearInterval(this.sendtiaojiaoset),void(this.sendtiaojiaoset=null)):(e.GameUtils.MSG_TIP(this.showtiparray[0]),void this.showtiparray.shift())},t.prototype.skillVO=function(t,i){return e.JsonDataManager.instance.demonKeeSkillTemplate[t+"_"+i]},t.prototype.babyVo=function(t){return e.JsonDataManager.instance.demonKeeBabyTemplate[t]},t.prototype.flyVO=function(t,i){var n,o=e.JsonDataManager.instance.demonKeeFlyTemplate;for(var a in o){var s=o[a];if(s.petId==t&&s.level==i)return n=s}return null},t.prototype.setDEMON_KEE_BOGGART_S=function(t){if(0==t.getErrorNo()){for(var i=0;i<t.getPetUpdateInfo().length;i++){var n=t.getPetUpdateInfo()[i],o=this.touxiangdata[n.getPetId()];o&&o.setstate(n.getState()),o=this.feisehnglist[n.getPetId()],o&&o.setstate(n.getState()),n.getState()&&e.BeautyController.getInstance().setfightvalue(n.getFithValue()),this.setdemonkeedata()}this.sortarr1(),this.updateView()}},t.prototype.setBeautyEquipAll=function(e){this.demonkeelist=e,this.updateView()},t.prototype.setDEMON_KEE_AWARD_S=function(e){0==e.getErrorNo()&&this.setpetinfo(e.getPetInfo())},t.prototype.setDEMON_KEE_DOTE_ON_S=function(t){if(0==t.getErrorNo()){this.kissNumber=t.getKissNumber(),this.LuckilyNumber=t.getLuckilyNumber();var i=this.babyVo(t.getPetUpdateInfo().getPetId()),n=e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_AWARDS_KISS").split(",");switch(t.getTypeId()){case e.DemonKeeType.FLOWER_TYPE:var o=(e.JsonDataManager.instance.itemTemplate[110176],new e.HtmlTip(n[0].split("_")[1],"好感度"));o=null;break;case e.DemonKeeType.GOLDS_TYPE:var a=(e.JsonDataManager.instance.itemTemplate[110177],new e.HtmlTip(n[1].split("_")[1],"好感度"));a=null;break;case e.DemonKeeType.KISS_TYPE:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YAOJI_QINWEN_TISHI",i.name,e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_KISS")));break;case e.DemonKeeType.LUCKILY_TYPE:e.BeautyController.getInstance().playchongxingani(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YAOJI_LINXING_TISHI",i.name,e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_LUCKILY")))}this.setpetinfo(t.getPetUpdateInfo())}},t.prototype.setDEMON_KEE_UPGRADE_S=function(t){if(0==t.getErrorNo()){this.settouxiangdata(t.getPetInfo()),(t.getStarlevel()>this.starlevel||t.getTeachLevel()>this.teachLevel)&&e.BeautyController.getInstance().playupstarani(),this.starlevel=t.getStarlevel(),this.teachLevel=t.getTeachLevel(),this.teachValue=t.getTeachValue();var i=new e.HtmlTip(t.getSumTeachValue(),"调教值");i=null,this.updateView()}},t.prototype.setDEMON_KEE_EQUIP_S=function(e){0==e.getErrorNo()&&(this.settouxiangdata(e.getPetUpdateInfo()),this.updateView())},t.prototype.setDEMON_KEE_INFO_S=function(e){var t=e.getPetInfoList();this.settouxiangdata(t),this.demonkeelist=e.getEquipInfo(),this.teachLevel=Number(e.getTeachLevel()),this.starlevel=Number(e.getStarlevel()),this.teachValue=Number(e.getTeachValue()),this.kissNumber=Number(e.getKissNumber()),this.LuckilyNumber=Number(e.getLuckilyNumber()),this.updateView()},t.prototype.setpetinfo=function(e){var t=this.touxiangdata[e.getPetId()];t&&(t.setattrInfo(e.getAttrInfo()),t.setawardList(e.getAwardList()),t.setflyLevel(e.getFlyLevel()),t.setkissLevel(e.getKissLevel()),t.setkissStar(e.getKissStar()),t.setfithValue(e.getFithValue()),t.setkissValue(e.getKissValue()),t.setstate(e.getState()));var i=this.feisehnglist[e.getPetId()];i&&(i.setattrInfo(e.getAttrInfo()),i.setawardList(e.getAwardList()),i.setflyLevel(e.getFlyLevel()),i.setkissLevel(e.getKissLevel()),i.setkissStar(e.getKissStar()),i.setkissValue(e.getKissValue()),i.setfithValue(e.getFithValue()),i.setstate(e.getState())),this.updateView()},t.prototype.settouxiangdata=function(t){if(Log.trace("妖姬列表长度:"+t.length),this.touxiangdata={},this.touxiangarr=[],0==t.length){this.first=!0;var i=e.JsonDataManager.instance.demonKeeBabyTemplate[e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_PET")],n=new e.DemonKeeDataVO;return n.setselect(!0),n.setpetId(i.petId),n.setflyLevel(0),n.setkissLevel(0),n.setkissStar(0),n.setkissValue(0),n.setstate(!0),n.setfithValue(0),n.setskills(i.skillsid,i.skillsvalue),n.settalent(i.talentid,i.talentvalue),n.setinitiativeSkill(i.initiativeSkillid,i.initiativeSkillvalue),n.sethead(i.head),n.setattrInfo(null),n.setawardList(null),n.setname(i.name),n.setconst(i["const"]),n.settype(1),this.touxiangdata[i.petId]=n,void this.touxiangarr.push(i.petId+",1")}this.first=!1;var o,a=e.JsonDataManager.instance.demonKeeBabyTemplate;for(var s in a)for(var r=a[s],l=0;l<t.length;l++){var h=t[l];if(h.getPetId()==r.petId){var n=new e.DemonKeeDataVO;n.setselect(h.getState()),n.setpetId(h.getPetId()),n.setflyLevel(h.getFlyLevel()),n.setkissLevel(h.getKissLevel()),n.setkissStar(h.getKissStar()),n.setkissValue(h.getKissValue()),n.setstate(h.getState()),n.setfithValue(h.getFithValue()),n.setskills(r.skillsid,r.skillsvalue),n.settalent(r.talentid,r.talentvalue),n.setinitiativeSkill(r.initiativeSkillid,r.initiativeSkillvalue),n.sethead(r.head),n.setattrInfo(h.getAttrInfo()),n.setawardList(h.getAwardList()),n.setname(r.name),n.setconst(r["const"]),n.settype(1),this.touxiangdata[h.getPetId()]=n,this.touxiangarr.push(h.getPetId()+",1"),1==h.getState()&&(o=h.getFithValue())}}e.BeautyController.getInstance().setfightvalue(o),this.setfeishenglist()},t.prototype.setdemonkeedata=function(){for(var e in this.touxiangdata){var t=this.touxiangdata[e];t.setselect(t.getstate())}},t.prototype.getbeauty=function(){var t=new e.DemonKeeDataVO;for(var i in this.touxiangdata)1==this.touxiangdata[i].getstate()&&(t=this.touxiangdata[i]);return t},t.prototype.getnowbeauty=function(){var t=new e.DemonKeeDataVO;for(var i in this.touxiangdata)1==this.touxiangdata[i].getselect()&&(t=this.touxiangdata[i]);return t},t.prototype.getnowflybeauty=function(){var e;for(var t in this.feisehnglist)1==this.feisehnglist[t].getselect()&&(e=this.feisehnglist[t]);return e},t.prototype.setfeishenglist=function(){var t=e.JsonDataManager.instance.demonKeeBabyTemplate;this.touxiangfsarr=[],this.feisehnglist={};for(var i in t){var n=t[i],o=new e.DemonKeeDataVO;o.setskills(n.skillsid,n.skillsvalue),o.settalent(n.talentid,n.talentvalue),o.setinitiativeSkill(n.initiativeSkillid,n.initiativeSkillvalue),o.sethead(n.head),o.setpetId(n.petId),o.setname(n.name),o.setflyLevel(0),o.settype(2),o.setkissLevel(-1),o.setselect(!1),o.setfithValue(0),o.setconst(n["const"]),o.setstate(!1);var a=this.touxiangdata[n.petId];a?(o.setselect(this.selectpetidByfeisehng?this.selectpetidByfeisehng==n.petId:a.getstate()),o.setflyLevel(a.getflyLevel()),o.setkissLevel(a.getkissLevel()),o.setkissStar(a.getkissStar()),o.setattrInfo(a.getattrInfo()),o.setkissValue(a.getkissValue()),o.setstate(a.getstate()),o.setfithValue(a.getfithValue()),this.touxiangfsarr.unshift(n.petId+",2")):this.touxiangfsarr.push(n.petId+",2"),this.feisehnglist[n.petId]=o}this.touxiangfsarr.sort(this.sortarr.bind(this)),this.sortarr1()},t.prototype.sortarr=function(e,t){var i=this.feisehnglist[e.split(",")[0]],n=this.feisehnglist[t.split(",")[0]];return i.getfithValue()>n.getfithValue()?-1:i.getfithValue()<n.getfithValue()?1:0},t.prototype.sortarr1=function(){for(var e,t=0;t<this.touxiangfsarr.length;t++){e=this.touxiangfsarr[t];var i=this.feisehnglist[e.split(",")[0]];if(1==i.getstate()){this.touxiangfsarr.splice(t,1);break}}this.touxiangfsarr.unshift(e)},t.prototype.setbeautydataillusion=function(e){for(var t in this.feisehnglist){var i=this.feisehnglist[t];i.setselect(!1),i.getpetId()==e.getpetId()&&i.setselect(!0)}this.updateViewill()},t.prototype.setbeautytouxiangillusion=function(e){for(var t=0;t<this.touxiangfsarr.length;t++)this.feisehnglist[this.touxiangfsarr[t].split(",")[0]].setselect(!1),e==t&&this.feisehnglist[this.touxiangfsarr[t].split(",")[0]].setselect(!0);this.updateViewill()},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.beautydataBack()},t.prototype.updateViewfl=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.beautygraceBack()},t.prototype.updateViewill=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.beautyillusionBack()},t}();e.BeautyModel=t,__reflect(t.prototype,"foxgame.BeautyModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/beauty/Beautypanel.exml","beauty")||this;return n.tiaojiaoindexsend=!1,n.aniNumber=0,n.demonkeedata=new e.DemonKeeDataVO,n.model=i,n.isMask=!1,n.isMaskdown=!0,n.adaptionType=1,n}return __extends(i,t),i.prototype.closeHook=function(){this.tiaojiaoAni&&(this.tiaojiaoAni.clear(),this.tiaojiaoAni=null)},i.prototype.initHook=function(){this.model.registerObserver(this),e.BagController.getInstance().registerObserver(this),this.ui.chongxing.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.tiaojiao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.yuanfen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clicklingshi,this),this.ui.tiaojiaobtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickmovebtn,this),this.ui.tiaojiaobtn.addEventListener(egret.TouchEvent.TOUCH_END,this.clickremovebtn,this),this.ui.tiaojiaobtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.clickremovebtn,this),this.ui.tiaojiaobtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickmove,this),this.ui.xiang.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchbtn,this),this.ui.clickbtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.moveclickbtn,this),this.ui.clickbtn.addEventListener(egret.TouchEvent.TOUCH_END,this.removeclickbtn,this),this.ui.clickbtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.removeclickbtn,this),this.ui.huanxing.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openhuanxing,this),this.ui.chibang.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.yaoji.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchbtn,this),this.ui.jihuobtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickjihuo,this);
for(var t=0;t<this.getskilllist().length;t++)this.getskilllist()[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskill,this);this.ui.clickbtn.visible=!1;for(var i=0;i<this.geticonlist().length;i++){var n=this.geticonlist()[i];n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ckickicon,this)}this.ani=new e.FoxAni(this.ui.aniGroup),this.ani.play("zdlhuodonghua","ani",-1),this.rechargeAniGroup&&(this.rechargeAniGroup.clear(),this.rechargeAniGroup=null),this.rechargeAniGroup||(this.rechargeAniGroup=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAniGroup.play("rechargeAnimation","ani",-1)),this.demonkeedata=this.model.getbeauty(),this.doScreenAdaptation()},i.prototype.playchongxingani=function(){var t=this,i=600,n=2e3;this.ui.playanicx.visible=!0;var o=new e.FoxAni(this.ui.playanicx),a=this.ui.playanicx.width>>1;o.scaleX=o.scaleY=1.9,o.play("beautyplayani0","ani",-1),o.mcObject.x=-a;var s=new e.FoxAni(this.ui.playanicx);s.scaleX=s.scaleY=1.9,s.play("beautyplayani1","ani",-1),s.mcObject.x=this.ui.playanicx.width,egret.Tween.get(o.mcObject,{loop:!1}).to({x:0},i).call(function(){}).wait(n).to({x:-a},i).call(function(){}),egret.Tween.get(s.mcObject,{loop:!1}).to({x:a-25},i).call(function(){}).wait(n).to({x:this.ui.playanicx.width},i).call(function(){o&&(o.clear(),o=null),s&&(s.clear(),s=null),t.getIsShow()&&(t.ui.playanicx.visible=!1)})},i.prototype.clicklingshi=function(t){e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("FUNCTIONNOTOPEN"))},i.prototype.bagItemChanged=function(){this.model.setBeautyEquipAll(e.BagController.getInstance().getEnableBeautyEquip())},i.prototype.clickskill=function(t){switch(t.target){case this.ui.skill1:e.BeautyController.getInstance().showskilltip(t.target.name,1);break;case this.ui.skill2:e.BeautyController.getInstance().showskilltip(t.target.name,2);break;case this.ui.skill3:case this.ui.skill4:case this.ui.skill5:case this.ui.skill6:e.BeautyController.getInstance().showskilltip(t.target.name,3)}},i.prototype.ckickicon=function(t){var i=t.target;if(i.itemId)for(var n=e.BeautyController.getInstance().getdemonkee(),o=0;o<n.length;o++){var a=n[o];if(i.itemId==a.getItemId())return void e.TipsController.getInstance().showDemonkeeTipsByinfo(a)}else{var s=this.geticonlist().indexOf(t.currentTarget);e.BeautyController.getInstance().showwearpanel(s+1)}},i.prototype.seticon=function(){for(var e=0;e<this.geticonlist().length;e++){var t=this.geticonlist()[e],i=this.model.demonkeelist;t.setitembg("ZhuangBeiCao"+(e+1)+"_png");for(var n=0;n<i.length;n++){var o=i[n];o.getPartId()==e+1&&(t.setdata(o.getItemId()),t.setitembg(""))}}},i.prototype.openhuanxing=function(t){e.BeautyController.getInstance().showillusionpanel()},i.prototype.moveclickbtn=function(e){this.beautyGracePanel&&(this.clickX1=e.stageX)},i.prototype.removeclickbtn=function(t){this.beautyGracePanel&&(this.clickX2=t.stageX,this.clickX1>this.clickX2?(this.beautyGracePanel.selectindex+=1,this.beautyGracePanel.selectindex>=this.model.touxiangarr.length&&(this.beautyGracePanel.selectindex=this.model.touxiangarr.length-1),e.BeautyController.getInstance().setbeautytouxiang(this.beautyGracePanel.selectindex)):this.clickX1<this.clickX2&&(this.beautyGracePanel.selectindex-=1,this.beautyGracePanel.selectindex<=0&&(this.beautyGracePanel.selectindex=0),e.BeautyController.getInstance().setbeautytouxiang(this.beautyGracePanel.selectindex)))},i.prototype.clickmovebtn=function(e){this.sendtiaojiao(),this.sendtiaojiaoset=setInterval(this.sendtiaojiao.bind(this),300)},i.prototype.clickremovebtn=function(e){clearInterval(this.sendtiaojiaoset),this.sendtiaojiaoset=null},i.prototype.sendtiaojiao=function(){if(1!=this.tiaojiaoindexsend&&(this.tiaojiaoindexsend=!0,"down"!=this.ui.checkBoxBtn_0.currentState)){if(!this.getdemonkeedata(1))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));var t=e.BagController.getInstance().getCountByItemId(this.getdemonkeedata().costAward.id);if(t<this.getdemonkeedata().costAward.value&&"up"==this.ui.checkBoxBtn_2.currentState)return e.ItemNotEnoughController.getInstance().showPanel(this.getdemonkeedata().costAward.id),void(this.tiaojiaoindexsend=!1);if("down"==this.ui.checkBoxBtn_2.currentState&&e.PlayerService.instance.playerInfo.getGold()<this.getdemonkeedata().costGolds.value)return e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"),void(this.tiaojiaoindexsend=!1);Log.trace("循环次数:"+this.sendtiaojiaoset),this.playtj(),e.BeautyController.getInstance().sendDEMON_KEE_UPGRADE_C("down"==this.ui.checkBoxBtn_1.currentState,"down"==this.ui.checkBoxBtn_2.currentState,"down"==this.ui.checkBoxBtn_0.currentState)}},i.prototype.clickmove=function(t){if(!this.getdemonkeedata(1))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));if("down"==this.ui.checkBoxBtn_0.currentState){var i=e.BagController.getInstance().getCountByItemId(this.getdemonkeedata().costAward.id);if(i<this.getdemonkeedata().costAward.value&&"up"==this.ui.checkBoxBtn_2.currentState)return void e.ItemNotEnoughController.getInstance().showPanel(this.getdemonkeedata().costAward.id);if("down"==this.ui.checkBoxBtn_2.currentState&&e.PlayerService.instance.playerInfo.getGold()<this.getdemonkeedata().costGolds.value)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.playtj(),e.BeautyController.getInstance().sendDEMON_KEE_UPGRADE_C("down"==this.ui.checkBoxBtn_1.currentState,"down"==this.ui.checkBoxBtn_2.currentState,"down"==this.ui.checkBoxBtn_0.currentState)}},i.prototype.touchbtn=function(t){switch(t.target){case this.ui.xiang:e.BeautyController.getInstance().showtips();break;case this.ui.helpBtn:"down"==this.ui.tiaojiao.currentState?e.HelpController.getInstance().showPanel("YAOJITIAOJIAHELP"):"down"==this.ui.chongxing.currentState&&e.HelpController.getInstance().showPanel("YAOJICHONGXINGHELP")}},i.prototype.showHook=function(){43==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.jihuobtn,this.ui.jihuobtn.parent,43,3,!0),1==this.model.first&&(this.model.showindex=1),this.changeview(this.model.showindex),this.setfirstgroup(),this.playani()},i.prototype.playAni=function(){var t=this;this.upStarAni||(this.upStarAni=new e.FoxAni(this.ui.aniGroup0),this.upStarAni.play("upStarAni","ani",1),TweenMax.delayedCall(.6,function(e){t.upStarAni&&(t.upStarAni.clear(),t.upStarAni=null)}))},i.prototype.playani=function(){this.tiaojiaoAni&&(this.tiaojiaoAni.clear(),this.tiaojiaoAni=null),this.tiaojiaoAni=new e.FoxAni(this.ui.tiaojiaogroup),this.tiaojiaoAni.play("beauty_tiaojiao","ani")},i.prototype.playtj=function(){var t=this;if(!this.tjani){this.aniNumber++;var i=this.aniNumber%2==0?0:1;this.tjani=new e.FoxAni(this.ui.tiani),this.tjani.frameRate=24,this.tjani.play("beautyani"+i,"ani",1),TweenMax.delayedCall(.4,function(e){t.tjani&&(t.tjani.clear(),t.tjani=null)})}},i.prototype.playAniJiHuo=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroupJiHuo),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroupJiHuo.visible=!0},i.prototype.playComplete=function(){this.ui.aniGroupJiHuo.visible=!1},i.prototype.setfirstgroup=function(){this.ui.jihuogroup.visible=this.model.first,this.ui.tiaojiaoui.visible=!this.model.first},i.prototype.refresh=function(){this.ui.currency.refresh(),this.demonkeedata=this.model.getnowbeauty(),this.ui.level.text=e.GlobalUtil.sectionToChinese(this.model.teachLevel)+"阶"+e.GlobalUtil.sectionToChinese(this.model.starlevel)+"星",this.ui.jingjie.text=e.GlobalUtil.sectionToChinese(this.demonkeedata.getflyLevel());var t=this.getdemonkeedata(),i=this.getdemonkeedata(1),n=this.getDemonKeeFlyVO();this.ui.model.source=n.modelId+"_model_png",this.ui.beautyname.source=n.modelId+"_name_png",this.ui.tenStar.setStarLvl(this.model.starlevel),this.ui.upStarProgress.maxValue=t.value,this.ui.upStarProgress.setProgress(this.model.teachValue),this.ui.itemnum.text=t.costAward.value+"",this.ui.fightBLabel0.text=String(this.demonkeedata.getfithValue()),this.model.lastFightValue=this.demonkeedata.getfithValue();var o=Math.round(this.model.teachValue/t.value*100),a=e.JsonDataManager.instance.demonKeeStarTemplate.getdemonKeeStarBycondition(o);this.ui.tips.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("BEAUTYTIPS",a.prompt)),this.ui.itemnownum.text=e.BagController.getInstance().getCountByItemId(t.costAward.id)+"";for(var s=t.attrTypeList.length,r=[],l=0;s>l;l++)r.push({text:e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[l])+":",style:{textColor:e.ColorUtils.instance.getAttrColorById(t.attrTypeList[l])}}),r.push({text:e.GlobalUtil.getAttrValueStr(t.attrTypeList[l],Number(t.attrValueList[l])),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(t.attrTypeList[l])}}),r.push({text:"\n"});if(this.ui.thisProperty.textFlow=r,i){s=i.attrTypeList.length;for(var h=[],l=0;s>l;l++)h.push({text:e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[l])+":",style:{textColor:e.ColorUtils.instance.getAttrColorById(i.attrTypeList[l])}}),h.push({text:e.GlobalUtil.getAttrValueStr(i.attrTypeList[l],Number(i.attrValueList[l])),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(i.attrTypeList[l])}}),h.push({text:"\n"});this.ui.nextProperty.textFlow=h}else this.ui.nextProperty.text=e.LanguageUtils.instance.getValue("YIMANJI"),this.ui.upStarProgress.setDiffProgress(0);this.settjpoint(e.BeautyController.getInstance().equippoint()||e.BeautyController.getInstance().feishengred()||e.BeautyController.getInstance().tiaojiaopoint()),this.setcxpoint(e.BeautyController.getInstance().chongxingred()),this.sethxpoint(e.BeautyController.getInstance().feishengred()),this.seticon(),this.setskill(),this.equippoint(),this.setwingpoint()},i.prototype.setwingpoint=function(){this.ui.redPoint6.visible=e.BeautyController.getInstance().redpoint(),this.ui.redPoint5.visible=e.WingController.getInstance().getOperate()},i.prototype.equippoint=function(){for(var t=1;5>t;t++)null!=e.BagController.getInstance().getEnableBeautyMaxEquipByPart(t)?this.setequipredpoint(t-1,!0):this.setequipredpoint(t-1,!1)},i.prototype.setskill=function(){var t=(e.JsonDataManager.instance.demonKeeBabyTemplate[this.demonkeedata.getpetId()],this.getDemonKeeFlyVO()),i=(this.getskilllist(),this.getskillinfo(t.talentSkillid,t.talentSkillvalue));this.ui.skill1.source=i.icon,this.ui.skill1.name=i.id+"_"+t.talentSkillvalue;var n=this.getskillinit(t.initiativeSkillid,t.initiativeSkillvalue);this.ui.skill2.source=n.icon,this.ui.skill2.name=n.skillType+"_"+t.initiativeSkillvalue;for(var o=t.activationSkillid,a=t.activationSkillvalue,s=this.getskilllistbei(),r=0;r<o.length;r++){var l=o[r],h=a[r],c=s[r],u=this.getskillinfo(l,h);c.source=u.icon,c.name=u.id+"_"+h,c.filters=[],0==h&&(c.filters=e.GlobalUtil.grayFilter)}},i.prototype.getskillinit=function(t,i){var n=e.JsonDataManager.instance.skillTemplate[t+"_1"];return n},i.prototype.getskillinfo=function(t,i){var n=e.JsonDataManager.instance.demonKeeSkillTemplate[t+"_1"];return n},i.prototype.getDemonKeeFlyVO=function(){var t,i=e.JsonDataManager.instance.demonKeeFlyTemplate;for(var n in i){var o=i[n];if(o.petId==this.demonkeedata.getpetId()&&o.level==this.demonkeedata.getflyLevel())return t=o}return null},i.prototype.getdemonkeedata=function(t){if(void 0===t&&(t=0),-1==this.model.teachLevel||-1==this.model.starlevel)return null;var i=Number(this.model.teachLevel),n=Number(this.model.starlevel)+t;n>=10&&(i+=1,n=1);var o,a=e.JsonDataManager.instance.demonKeeBabyupTemplate;for(var s in a){var r=a[s];if(r.level==i&&r.starLevel==n){o=r;break}}return o},i.prototype.beautydataBack=function(){this.refresh(),this.tiaojiaoindexsend=!1,this.beautyGracePanel&&(this.beautyGracePanel.refresh(),this.beautyGracePanel.tiaojiaoindexsend=!1)},i.prototype.beautygraceBack=function(){this.beautyGracePanel&&(this.beautyGracePanel.refresh(),this.beautyGracePanel.tiaojiaoindexsend=!1)},i.prototype.beautyillusionBack=function(){},i.prototype.clickbtn=function(e){if(e.target!=this.btnindex)switch(this.btnindex=e.target,this.ui.tiaojiao.currentState=e.target==this.ui.tiaojiao?"down":"up",this.ui.chongxing.currentState=e.target==this.ui.chongxing?"down":"up",this.ui.yuanfen.currentState=e.target==this.ui.yuanfen?"down":"up",this.ui.gracegroup.removeChildren(),this.ui.clickbtn.visible=!1,e.target){case this.ui.tiaojiao:this.changeview(1);break;case this.ui.chongxing:this.changeview(2);break;case this.ui.yuanfen:}},i.prototype.changeview=function(t){switch(t){case 1:this.model.setdemonkeedata(),this.ui.tiaojiaoui.visible=!0,this.ui.gracegroup.visible=!1,this.refresh(),this.ui.tiaojiao.currentState="down";break;case 2:this.ui.clickbtn.visible=!0,this.ui.tiaojiaoui.visible=!1,this.ui.gracegroup.visible=!0,this.beautyGracePanel?(this.ui.gracegroup.addChild(this.beautyGracePanel),this.beautyGracePanel.refresh()):(this.beautyGracePanel=new e.BeautyGracePanel(this.model),this.ui.gracegroup.addChild(this.beautyGracePanel)),this.ui.chongxing.currentState="down"}},i.prototype.clickskip=function(t){switch(t.target){case this.ui.chibang:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.WING_SYSTEM),this.close();break;case this.ui.yaoji:}},i.prototype.clickjihuo=function(t){e.BeautyController.getInstance().sendDEMON_KEE_FREE_C(),App.SoundManager().playEffect("sound_activate_mp3"),43==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide())},i.prototype.setequipredpoint=function(e,t){this.geticonlist()[e].isShowRedPoint(t)},i.prototype.setcxpoint=function(e){this.ui.redPoint0.visible=e},i.prototype.settjpoint=function(e){this.ui.redPoint.visible=e},i.prototype.sethxpoint=function(e){this.ui.redPoint1.visible=e},i.prototype.getskilllistbei=function(){var e=[];return e.push(this.ui.skill3),e.push(this.ui.skill4),e.push(this.ui.skill5),e.push(this.ui.skill6),e},i.prototype.getskilllist=function(){var e=[];return e.push(this.ui.skill1),e.push(this.ui.skill2),e.push(this.ui.skill3),e.push(this.ui.skill4),e.push(this.ui.skill5),e.push(this.ui.skill6),e},i.prototype.geticonlist=function(){var e=[];return e.push(this.ui.icon1),e.push(this.ui.icon2),e.push(this.ui.icon3),e.push(this.ui.icon4),e},i}(e.BasePanel);e.BeautyPanel=t,__reflect(t.prototype,"foxgame.BeautyPanel",["foxgame.IBeauty","foxgame.IObserver","foxgame.IBag"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.list={1:"longJiao",2:"longYa",3:"longQu",4:"longZhua",5:"longWei"},t.list1={1:"longJiao_dianJi",2:"longYa_dianJi",3:"longQu_dianJi",4:"longZhua_dianJi",5:"longWei_dianJi"},t.skinName="BeautyCell",t.touchChildren=!1,t}return __extends(t,e),t.prototype.setdata=function(e){this.itemId=e,this.setItemIcon(this.itemId)},t.prototype.setItemIcon=function(e){this.itemIcon.setItem(e,-1,!1,!1)},t.prototype.setitembg=function(e){this.itembg.source=null,this.itembg.source=e},t.prototype.isShowRedPoint=function(e){void 0===e&&(e=!1),this.redPoint.visible=e},t}(eui.Button);e.BeautyCell=t,__reflect(t.prototype,"foxgame.BeautyCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/beauty/BeautyEquipTipsSkin.exml")||this;return e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(e,t){void 0===t&&(t=!0),this.id=e,this.showup=t,this.show(),this.ui.replaceBtn.visible=!t},i.prototype.showPanelByinfo=function(e,t){void 0===t&&(t=!1),this.info=e,this.id=e.getId(),this.showup=t,this.show(),this.ui.replaceBtn.visible=!t},i.prototype.initHook=function(){this.ui.lockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lockHandler,this),this.ui.unlockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.unlockHandler,this),this.ui.replaceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.replaceHandler,this),e.BagController.getInstance().registerObserver(this)},i.prototype.refresh=function(){if(this.info=e.BagController.getInstance().getBeautyEquipById(this.id),null!=this.info){var t=e.JsonDataManager.instance.demonKeeEquipTemplate[this.info.getItemId()],i=e.JsonDataManager.instance.itemTemplate[t.equipId];this.ui.icon.setItem(t.equipId,0,!1),this.ui.nameLabel.text=i.name,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(i.quality),this.ui.scoreLabel.text=e.BeautyController.getInstance().getbeautyEquipScore(this.info).toString();for(var n,o,a=this.getAttrLabelList(),s=a.length,r=0;s>r;r++)n=a[r],o=t.attrValueList[r],n.text=e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[r])+":"+e.GlobalUtil.getAttrValueStr(t.attrTypeList[r],o);var l,h=this.getnameLabelList(),c=0;if(this.showup)for(var r=0;r<h.length;r++)l=h[r],l.textColor=11447982,t.siteType==r+1&&(l.textColor=2227971);else for(var u=e.BeautyController.getInstance().getdemonkee(),p=0;p<u.length;p++){var g=e.JsonDataManager.instance.demonKeeEquipTemplate[u[p].getItemId()];g.type==t.type&&(h[g.siteType-1].textColor=2227971,c++)}var d=e.JsonDataManager.instance.demonKeeAttrTemplate,f={};for(var m in d)d[m].type==t.type&&(f[d[m].count]=d[m]);var y=this.getSpecialAttrLabelList();y[0].textFlow=(new egret.HtmlTextParser).parser("<font color="+(c>=2?2227971:11447982)+">"+f[2].tips+e.LanguageUtils.instance.getValue("ATT_"+f[2].attrTypeList[0])+"</font>+<font color=0xc73fee>"+e.GlobalUtil.getAttrValueStr(f[2].attrTypeList[0],f[2].attrValueList[0])+"</font>"),y[1].textFlow=(new egret.HtmlTextParser).parser("<font color="+(c>=3?2227971:11447982)+">"+f[3].tips+e.LanguageUtils.instance.getValue("ATT_"+f[3].attrTypeList[0])+"</font>+<font color=0xc73fee>"+e.GlobalUtil.getAttrValueStr(f[3].attrTypeList[0],f[3].attrValueList[0])+"</font>"),y[2].textFlow=(new egret.HtmlTextParser).parser("<font color="+(c>=4?2227971:11447982)+">"+f[4].tips+e.LanguageUtils.instance.getValue("ATT_"+f[4].attrTypeList[0])+"</font>+<font color=0xc73fee>"+e.GlobalUtil.getAttrValueStr(f[4].attrTypeList[0],f[4].attrValueList[0])+"</font>"),this.ui.replaceBtn.visible=!this.showup,this.ui.lockBtn.visible=!this.info.getLockState(),this.ui.unlockBtn.visible=this.info.getLockState()}},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.lockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeLockReq");i.setEquiId(this.id),i.setState(!0),e.Message.instance.send(e.Code.DEMON_KEE_LOCK_C,i,!0)},i.prototype.unlockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDemonKeeLockReq");i.setEquiId(this.id),i.setState(!1),e.Message.instance.send(e.Code.DEMON_KEE_LOCK_C,i,!0)},i.prototype.replaceHandler=function(t){e.BeautyController.getInstance().showwearpanel(this.info.getPartId()),this.close()},i.prototype.getAttrLabelList=function(){var e=[];return e.push(this.ui.attrLabel0),e.push(this.ui.attrLabel1),e.push(this.ui.attrLabel2),e},i.prototype.getSpecialAttrLabelList=function(){var e=[];return e.push(this.ui.specialAttrLabel1),e.push(this.ui.specialAttrLabel2),e.push(this.ui.specialAttrLabel3),e},i.prototype.getnameLabelList=function(){var e=[];return e.push(this.ui.nameLabel0),e.push(this.ui.nameLabel1),e.push(this.ui.nameLabel2),e.push(this.ui.nameLabel3),e},i}(e.BasePanel);e.BeautyEquipTips=t,__reflect(t.prototype,"foxgame.BeautyEquipTips",["foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="BeautyequipItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.baseLabelList=[this.baseLabel0,this.baseLabel1,this.baseLabel2],this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHandler,this),this.model=e.BeautyController.getInstance().getmodel()},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.keeInfo=this.data,this.recommendImg.visible=!1,0==this.keeInfo.getState()){var i=e.BagController.getInstance().getEnableBeautyEquipByPart(this.keeInfo.getPartId()),n=i.indexOf(this.keeInfo);0==n&&e.BeautyController.getInstance().getbeautyEquipScore(e.BeautyController.getInstance().getmodel().getPartInfoByPart(this.keeInfo.getPartId()))<e.BeautyController.getInstance().getbeautyEquipScore(this.keeInfo)&&(this.recommendImg.visible=!0)}this.jiaobiao.visible=this.keeInfo.getState(),this.selectBtn.visible=!this.keeInfo.getState();var o=e.JsonDataManager.instance.demonKeeEquipTemplate[this.keeInfo.getItemId()],a=e.JsonDataManager.instance.itemTemplate[this.keeInfo.getItemId()];this.nameLabel.text=a.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(a.quality),this.scoreLabel.text=e.BeautyController.getInstance().getbeautyEquipScore(this.keeInfo)+"",this.icon.setItem(this.keeInfo.getItemId());for(var s,r=this.baseLabelList.length,l=0;r>l;l++){s=this.baseLabelList[l],s.text=e.LanguageUtils.instance.getValue("ATT_"+o.attrTypeList[l])+":"+e.GlobalUtil.getAttrValueStr(o.attrTypeList[l],o.attrValueList[l]);var h=e.ColorUtils.instance.getAttrColorById(o.attrTypeList[l]);s.textColor=h}},i.prototype.selectHandler=function(t){e.BeautyController.getInstance().closewearpanel(),e.BeautyController.getInstance().sendDEMON_KEE_EQUIP_C(this.keeInfo.getPartId(),this.keeInfo.getId())},i}(eui.ItemRenderer);e.BeautyequipWearItem=t,__reflect(t.prototype,"foxgame.BeautyequipWearItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/beauty/BeautyequipWearSkin.exml")||this;return i.model=e,i.collection1=new eui.ArrayCollection,i}return __extends(i,t),i.prototype.showpanel=function(e){this.part=e,this.getIsShow()?this.refresh():this.show()},i.prototype.initHook=function(){var t=this.ui.list;t.dataProvider=this.collection1,t.itemRenderer=e.BeautyequipWearItem,this.ui.scroller.viewport=t,this.hight=this.ui.scroller.height},i.prototype.refresh=function(){var t=this.model.getPartInfoByPart(this.part),i=this.ui.scroller,n=this.ui.item;t?(n.data=e.BagController.getInstance().getBeautyEquipById(t.getId()),this.ui.item.dataChanged(),n.visible=!0,i.y=n.y+n.height,i.height=i.height-n.height):(n.visible=!1,i.y=n.y,i.height=this.hight);var o=e.BagController.getInstance().getEnableBeautyEquipByPart(this.part);this.collection1.replaceAll(o)},i}(e.BasePanel);e.BeautyEquipWearPanel=t,__reflect(t.prototype,"foxgame.BeautyEquipWearPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="BeautyItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){var t=this.data.split(",");1==t[1]?this.dataKee=e.BeautyController.getInstance().getmodel().touxiangdata[t[0]]:2==t[1]&&(this.dataKee=e.BeautyController.getInstance().getmodel().feisehnglist[t[0]]),this.select.visible=this.dataKee.getselect(),this.yihuanxing.visible=this.dataKee.getstate(),this.touxiang.source=this.dataKee.gethead(),this.touxiang.filters=[];var i=e.BeautyController.getInstance().getmodel();if(this.redPoint.visible=!1,2==this.dataKee.gettype())if(-1==this.dataKee.getkissLevel()){this.touxiang.filters=e.GlobalUtil.grayFilter;var n=e.BagController.getInstance().getCountByItemId(this.dataKee.getconst().id);n>=this.dataKee.getconst().value&&(this.redPoint.visible=!0)}else{var o=this.getflydata(),a=!1,s=!0,n=e.BagController.getInstance().getCountByItemId(o.cost[0].id);if(n>=o.cost[0].value&&(a=!0),o.cost.length>1){s=!1;var r=e.BagController.getInstance().getCountByItemId(o.cost[1].id);r>=o.cost[1].value&&(s=!0)}this.redPoint.visible=a==s}else if(1==this.dataKee.gettype()){i.kissNumber>=1&&(this.redPoint.visible=!0),i.LuckilyNumber>=1&&(this.redPoint.visible=!0);var l=e.GlobalConfig.instance.getValue("BEAUTY_LUCKILY_AWARDS_KISS"),h=l.split(","),c=e.BagController.getInstance().getCountByItemId(Number(h[0].split("_")[0])),u=e.BagController.getInstance().getCountByItemId(Number(h[1].split("_")[0]));c>=1&&(this.redPoint.visible=!0),u>=1&&(this.redPoint.visible=!0);for(var p=0;p<this.dataKee.getawardList().length;p++){var g=Number(this.dataKee.getawardList()[p]);-1==this.dataKee.getawardList().indexOf(this.dataKee.getkissLevel())&&this.dataKee.getkissLevel()>=g&&(this.redPoint.visible=!0)}}},i.prototype.getflydata=function(){var t=e.JsonDataManager.instance.demonKeeFlyTemplate;for(var i in t){var n=t[i];if(n.level==this.dataKee.getflyLevel()&&n.petId==this.dataKee.getpetId())return n}},i.prototype.clickHandler=function(t){switch(this.dataKee.gettype()){case 1:e.BeautyController.getInstance().setbeautydata(this.dataKee);break;case 2:e.BeautyController.getInstance().setbeautyillusion(this.dataKee)}},i}(eui.ItemRenderer);e.BeautyItem=t,__reflect(t.prototype,"foxgame.BeautyItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.minValue=0,e.maxValue=100,e.skinName="BeautyProgress_chongxing",e}return __extends(i,t),i.prototype.setProgress=function(t){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.labelDisplay.text=t.toString()+"/"+this.maxValue.toString(),t>this.maxValue?this.thumb.scaleX=1:this.thumb.scaleX=t/this.maxValue},i.prototype.setDiffProgress=function(t){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.labelDisplay.text=t.toString()+"/0",this.thumb.scaleX=1},i}(eui.Component);e.BeautyProgress=t,__reflect(t.prototype,"foxgame.BeautyProgress")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BeautySkillItem",t}return __extends(t,e),t.prototype.childrenCreated=function(){},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data;this.nameandlevel.text=t.name+" Lv."+t.level,this.nameandlevel.textColor=2227971,Number(t.nowlevel)<Number(t.level)&&(this.nameandlevel.textColor=16711680),this.tip.textFlow=(new egret.HtmlTextParser).parser(t.desc),this.condition.text=t.condition,this.condition.textColor=15655878,Number(t.nowlevel)<Number(t.level)?this.condition.textColor=16711680:this.condition.text=""},t}(eui.ItemRenderer);e.BeautySkillItem=t,__reflect(t.prototype,"foxgame.BeautySkillItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/beauty/BeautySkillTip.exml")||this;return i.collection=new eui.ArrayCollection,i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.showPanel=function(e,t){var i=e.split("_");this.skillid=Number(i[0]),this.skilllevel=Number(i[1]),this.setdata1(),this.show()},i.prototype.setdata=function(){var t=e.JsonDataManager.instance.skillTemplate;this.data=[];for(var i=1;10>=i;i++){var n=t[this.skillid+"_"+i];if(n){var o={};o.level=n.level,o.id=n.skillType,o.desc=n.skillDesc,o.name=n.skillName,o.condition="",o.nowlevel=this.skilllevel,this.data.push(o)}}},i.prototype.setdata1=function(){var t=e.JsonDataManager.instance.demonKeeSkillTemplate;this.data=[];for(var i=1;10>=i;i++){var n=t[this.skillid+"_"+i];if(n){var o={};o.level=n.level,o.id=n.id,o.desc=n.tips,o.name=n.name,o.condition=n.condition,o.nowlevel=this.skilllevel,this.skilllevel<=n.level&&this.data.push(o)}}},i.prototype.initHook=function(){var t=new eui.TileLayout;t.horizontalGap=5;var i=this.ui.list;i.dataProvider=this.collection,i.itemRenderer=e.BeautySkillItem,i.layout=t},i.prototype.refresh=function(){this.collection.replaceAll(this.data)},i}(e.BasePanel);e.BeautySkillTip=t,__reflect(t.prototype,"foxgame.BeautySkillTip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/beauty/BeautyTips.exml")||this;return i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.refresh=function(){var t=this.model.getnowbeauty().getattrInfo(),i=this.sortAttrs(t)[1],n=this.sortAttrs(t)[0];this.ui.attrText.lineSpacing=15;var o=[];this.ui.tou.text=this.model.getbeauty().getname();for(var a=0;a<n.length;a++){var s=n[a],r=i[a];o.push({text:e.LanguageUtils.instance.getValue("ATT_"+s)+": ",style:{textColor:e.ColorUtils.instance.getAttrColorById(s)}}),o.push({text:e.GlobalUtil.getAttrValueStr(s,Number(r)),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(s)}}),o.push({text:"\n"})}this.ui.attrText.textFlow=o},i.prototype.sortAttrs=function(t){for(var i=e.GlobalConfig.instance.getValue("BEAUTY_ATTRIBUTE_ORDER").split(","),n=i.length,o=[],a=0;n>a;a++){var s=Number(i[a]),r=this.pfunction(s,t);-1!=r?o.push(r):o.push(0)}return[i,o]},i.prototype.pfunction=function(e,t){for(var i in t){var n=t[i];if(Number(n.getAttrId())==e)return n.getAttrValue()}return-1},i}(e.BasePanel);e.Beautytips=t,__reflect(t.prototype,"foxgame.Beautytips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FavorItemSkin",e.collection=new eui.ArrayCollection,e}return __extends(i,t),i.prototype.childrenCreated=function(){this.receivebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkBtnHandler,this),this.labeltxt.visible=!1,this.model=e.BeautyController.getInstance().getmodel()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data;this.model.getnowbeauty();this.level=i.level;var n=i.nowlevel,o=i.awardList;this.labeltxt.text=this.level+"级可领",this.petid=i.petid,this.labeltxt.visible=Number(this.level)>n,this.receivebtn.visible=n>=Number(this.level),-1==o.indexOf(Number(this.level))?(this.receivebtn.currentState="up",this.receivebtn.label="领取"):(this.receivebtn.currentState="disabled",this.receivebtn.label="已领取"),this.group.removeChildren();for(var a=0;a<i.award.length;a++){var s=i.award[a],r=new e.ItemIcon;r.setItem(s.id,s.value,!0),this.group.addChild(r),r.x=a*(r.width+15)+20,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.receivebtn.visible&&"disabled"!=this.receivebtn.currentState?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.checkBtnHandler=function(t){var i=this.receivebtn.currentState;"disabled"!=i&&e.BeautyController.getInstance().sendDEMON_KEE_AWARD_C(this.petid,this.level)},i}(eui.ItemRenderer);e.FavorItem=t,__reflect(t.prototype,"foxgame.FavorItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/beauty/BeautyFavorSkin.exml")||this;return i.model=e,i.collection=new eui.ArrayCollection,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this);var t=new eui.TileLayout;t.horizontalGap=5,this.ui.list.dataProvider=this.collection,this.ui.list.itemRenderer=e.FavorItem,this.ui.list.layout=t,this.doScreenAdaptation()},i.prototype.showpanel=function(e){this.level=e,this.getIsShow()?this.refresh():this.show()},i.prototype.beautydataBack=function(){this.refresh()},i.prototype.beautygraceBack=function(){},i.prototype.beautyillusionBack=function(){},i.prototype.refresh=function(){var t=this.model.getnowbeauty(),i=e.JsonDataManager.instance.demonKeeAwardTemplate;this.favordata=[];for(var n in i){var o={},a=i[n];o.level=a.level,o.nowlevel=this.level,o.award=a.award,o.awardList=t.getawardList(),o.petid=t.getpetId(),this.favordata.push(o)}this.collection.replaceAll(this.favordata)
},i}(e.BasePanel);e.Favorpanel=t,__reflect(t.prototype,"foxgame.Favorpanel",["foxgame.IBeauty","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i){var n=t.call(this,"resource/skins/beauty/HtmlTip.exml")||this;return n.isMask=!1,n.isCenter=!1,n.setIsShowBackBtn(!1),n.setIsShowTween(!1),n.setEffect(!1),n.setRegisterTick(!0),n.layer=LayerType.TOPLAYER,n.isCallHideSceneObjectsWhenClose=!1,n.touchEnabled=!1,n.touchChildren=!1,n.str1=e,n.str2=i,n.showpanel(),n}return __extends(i,t),i.prototype.showpanel=function(){this.getIsShow()||this.show()},i.prototype.initHook=function(){this.x=(e.Global.stageWidth>>1)-(this.width>>1),this.y=(e.Global.stageHeight>>1)-(this.height>>1)+100,this.ui.str.textFlow=(new egret.HtmlTextParser).parser("+"+this.str1),this.ui.strtext.textFlow=(new egret.HtmlTextParser).parser(this.str2)},i.prototype.showHook=function(){var e=this;TweenMax.to(this,.3,{y:this.y-20,onComplete:function(){e.clearTween()}})},i.prototype.clearTween=function(){TweenMax.killTweensOf(this),this.destroy()},i}(e.BasePanel);e.HtmlTip=t,__reflect(t.prototype,"foxgame.HtmlTip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){this.stars=[this.star1,this.star2,this.star3,this.star4,this.star5,this.star6,this.star7,this.star8,this.star9]},t.prototype.setStarLvl=function(e){if(0>e?e=0:e>=9&&(e=9),this.stars)for(var t=0,i=this.stars.length;i>t;t++)e>t?this.stars[t].enabled=!0:this.stars[t].enabled=!1},t}(eui.Component);e.NineStar=t,__reflect(t.prototype,"foxgame.NineStar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.createChildren=function(){this.stars=[this.star1,this.star2,this.star3,this.star4,this.star5,this.star6,this.star7,this.star8,this.star9]},i.prototype.setStarLvl=function(t){if(e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),0>t?t=0:t>=9&&(t=9),this.stars)for(var i=0,n=this.stars.length;n>i;i++)t>i?this.stars[i].currentState="up":this.stars[i].currentState="down"},i}(eui.Component);e.TenHeart=t,__reflect(t.prototype,"foxgame.TenHeart")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeAttrVO=t,__reflect(t.prototype,"foxgame.DemonKeeAttrVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeAwardVO=t,__reflect(t.prototype,"foxgame.DemonKeeAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeBabyVO=t,__reflect(t.prototype,"foxgame.DemonKeeBabyVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.getconst=function(){return this["const"]},e.prototype.setconst=function(e){this["const"]=e},e.prototype.getfithValue=function(){return this.fithValue},e.prototype.setfithValue=function(e){this.fithValue=e},e.prototype.getawardList=function(){return this.awardList},e.prototype.setawardList=function(e){this.awardList=e},e.prototype.setinitiativeSkill=function(e,t){this.initiativeSkillid=e,this.initiativeSkillvalue=t},e.prototype.getinitiativeSkillid=function(){return this.initiativeSkillid},e.prototype.getinitiativeSkillvalue=function(){return this.initiativeSkillvalue},e.prototype.setname=function(e){this.name=e},e.prototype.setattrInfo=function(e){this.attrInfo=e},e.prototype.settype=function(e){this.type=e},e.prototype.setselect=function(e){this.select=e},e.prototype.setpetId=function(e){this.petId=e},e.prototype.setflyLevel=function(e){this.flyLevel=e},e.prototype.setkissLevel=function(e){this.kissLevel=e},e.prototype.setkissStar=function(e){this.kissStar=e},e.prototype.setkissValue=function(e){this.kissValue=e},e.prototype.settalent=function(e,t){this.talentid=e,this.talentvalue=t},e.prototype.setstate=function(e){this.state=e},e.prototype.setskills=function(e,t){this.skillsid=[],this.skillsvalue=[],this.skillsid=e,this.skillsvalue=t},e.prototype.sethead=function(e){this.head=e},e.prototype.getname=function(){return this.name},e.prototype.getattrInfo=function(){return this.attrInfo},e.prototype.gettype=function(){return this.type},e.prototype.getselect=function(){return this.select},e.prototype.getpetId=function(){return this.petId},e.prototype.getflyLevel=function(){return this.flyLevel},e.prototype.getkissLevel=function(){return this.kissLevel},e.prototype.getkissStar=function(){return this.kissStar},e.prototype.getkissValue=function(){return this.kissValue},e.prototype.gettalentid=function(){return this.talentid},e.prototype.gettalentvalue=function(){return this.talentvalue},e.prototype.getstate=function(){return this.state},e.prototype.getskillsid=function(){return this.skillsid},e.prototype.getskillsvalue=function(){return this.skillsvalue},e.prototype.gethead=function(){return this.head},e}();e.DemonKeeDataVO=t,__reflect(t.prototype,"foxgame.DemonKeeDataVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeDoteVO=t,__reflect(t.prototype,"foxgame.DemonKeeDoteVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeEquipVO=t,__reflect(t.prototype,"foxgame.DemonKeeEquipVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeFlyVO=t,__reflect(t.prototype,"foxgame.DemonKeeFlyVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeLevelVO=t,__reflect(t.prototype,"foxgame.DemonKeeLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeSkillVO=t,__reflect(t.prototype,"foxgame.DemonKeeSkillVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DemonKeeStarVO=t,__reflect(t.prototype,"foxgame.DemonKeeStarVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.bossHomeRedPointArr=[!1,!1,!1],this.model=e.NewBossMainModel.getIntance(),this.detailPanel=new e.NewBossFightDetailItemControler(this.model)}return t.getIntance=function(){return this._intance||(this._intance=new t),this._intance},t.prototype.showDetailPanel=function(e){this.model.setDetailData(e),App.LittleLoading().showLoading("NewBossControler"),this.detailPanel.show(),App.LittleLoading().hideLoading("NewBossControler")},t.prototype.registerMsg=function(e){},t.prototype.getDetailPanelIsShow=function(){return this.detailPanel.getIsShow()},t.prototype.closeDetailPanel=function(){this.detailPanel.getIsShow()&&this.detailPanel.close()},t.prototype.recvMsg=function(e,t){},t.prototype.getOverTime=function(e){return this.model.getOverTime(e)},t.prototype.getBossRedPoint=function(){return this.model.getBossRedPoint()},t.prototype.getRedPoint=function(e){return this.model.getRedPoint(e)},t.prototype.setRedPoint=function(e,t){this.model.setRedPoint(e,t)},t.prototype.checkRedPoint=function(){var t=this.getBossRedPoint();e.MainControler.instance.setbossRed(t),e.NewBossMainControler.getIntance().checkRedPoint()},t.prototype.setHomeRedPoint=function(e,t){t<this.bossHomeRedPointArr.length&&this.bossHomeRedPointArr[t]!=e&&(this.bossHomeRedPointArr[t]=e,this.checkHomeRed())},t.prototype.checkHomeRed=function(){var e=0,t=this.bossHomeRedPointArr.length;for(e;t>e;e++){var i=this.bossHomeRedPointArr[e];if(i)return this.setRedPoint(i,2)}this.setRedPoint(!1,2)},t}();e.NewBossControler=t,__reflect(t.prototype,"foxgame.NewBossControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=e.JsonDataManager,i=function(i){function n(e){var t=i.call(this,"resource/skins/lootboss/LootBossKillAward.exml")||this;return t.bossItemGap=17,t.columnNum=6,t.modelMonsterId=null,t._model=e,t}return __extends(n,i),n.prototype.initUi=function(i,n,o){this.ui.bossDropAward.removeChildren(),this.ui.bossDropAwardScroller.viewport.scrollH=0;var a=t.instance.mapTemplate,s=a[this.mapId];switch(this.setBossName(s.name),n){case 0:this.ui.awardType.text=e.LanguageUtils.instance.getValue("GUDINGJIANGLI");break;case 1:this.ui.awardType.text=e.LanguageUtils.instance.getValue("ZHAOHUANJIANGLI")}var r=s.monsterLevelRange,l=s.limitLevel;this.fixDrop=s.fixedDrop,this.award=s.dropPreview;for(var h=this.fixDrop.length,c=0;h>c;++c){var u=this.ui["itemIcon"+c],p=this.fixDrop[c].id,g=this.fixDrop[c].value;u.setItem(p,g)}this.ui.monsterLevel.text="Lv "+r.toString(),this.ui.roleLevel.text=l.toString();var d=0;e.PlayerService.instance.level>=l?(this.ui.enterCondition1.visible=!0,this.ui.enterCondition2.visible=!1,d=2227971):(this.ui.enterCondition1.visible=!1,this.ui.enterCondition2.visible=!0,d=16711680),this.ui.roleLevel.textColor=d,h=this.award.length;for(var c=0;h>c;++c){var f=void 0,m=new e.ItemIcon;m.setItem(this.award[c].id),m.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dropItemClickHandler,this),f=this.getIconPos(m.width,m.height,c),m.x=f.x,this.ui.bossDropAward.addChild(m)}this.setRegisterTick(!0),this.monsterMc=new egret.MovieClip,this.monsterMc.name="mChest",this.monsterMc.frameRate=6,this.monsterMc.scaleX=1.2,this.monsterMc.scaleY=1.2,this.ui.aniGroup.addChild(this.monsterMc)},n.prototype.refreshMonster=function(t){if(!this.modelController||!this.modelMonsterId||this.modelMonsterId!=t){this.modelMonsterId=t;var i=e.ActionUtils.CreateActionInfoByMonsterId(t);this.modelController=new e.ActionController(i,this.ui.aniGroup),this.modelController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_RUN,5)}},n.prototype.tickHook=function(e){var t=e-this.lastTime;if(!(1e3>t)){this.lastTime=e;var i,n,o;if(this.timeR<=0){this.timeR=0;new Date;i=0,n=0,o=0}else i=Math.floor(this.timeR/36e5),n=Math.floor(this.timeR%36e5/6e4),o=Math.floor(this.timeR%36e5%6e4/1e3),this.timeR=this.timeR-1e3;this.ui.bossEscapeTime.text=i+"时"+n+"分"+o+"秒"}},n.prototype.setBossName=function(e){var t=this.ui.bossName;t.text=e},n.prototype.playAni=function(){var e=t.instance.mapTemplate,i=this.mapId,n=e[i],o=t.instance.monster,a=o[n.bossId];this.refreshMonster(a.id)},n.prototype.getIconPos=function(e,t,i){var n=new egret.Point,o=Math.floor(i/this.columnNum);return n.x=i*(e+this.bossItemGap),n.y=o*(t+this.bossItemGap),n},n.prototype.showHook=function(){var e=this._model.getDetailData();this.mapId=e.mapId,this.mapType=e.mapType,this.timeR=e.timeR,this.initUi(this.mapId,this.mapType,this.timeR),this.initListener(),this.playAni(),this.setIsShowBackBtn(!0)},n.prototype.initHook=function(){},n.prototype.initListener=function(){this.ui.itemIcon0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)},n.prototype.clickBtn=function(i){var n=t.instance.itemTemplate;switch(i.target){case this.ui.closeBtn:this.close();break;case this.ui.itemIcon0:var o=this.fixDrop[0].id,a=n[o];a.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:o}):e.TipsController.getInstance().showItemTips(o);break;case this.ui.itemIcon1:var o=this.fixDrop[1].id,a=n[o];a.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:o}):e.TipsController.getInstance().showItemTips(o);break;case this.ui.itemIcon2:var o=this.fixDrop[2].id,a=n[o];a.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:o}):e.TipsController.getInstance().showItemTips(o)}},n.prototype.dropItemClickHandler=function(i){var n=this.getDropItems(),o=n.indexOf(i.target),a=this.award[o],s=a.id,r=t.instance.itemTemplate,l=r[s];l.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:s}):e.TipsController.getInstance().showItemTips(s)},n.prototype.closeHook=function(){},n.prototype.createChildren=function(){this.ui.bossDropAwardScroller.horizontalScrollBar.autoVisibility=!1},n.prototype.getDropItems=function(){for(var e=[],t=this.ui.bossDropAward.numChildren,i=0;t>i;i++)e.push(this.ui.bossDropAward.getChildAt(i));return e},n.prototype.childrenCreated=function(){this.doScreenAdaptation()},n}(e.BasePanel);e.NewBossFightDetailItemControler=i,__reflect(i.prototype,"foxgame.NewBossFightDetailItemControler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/lootboss/LootBossHomeSkin.exml")||this;return e.bossItemGap=4,e.columnNum=1,e.lastTime=0,e.dataSource=[],e.collection=new eui.ArrayCollection,e.collection.source=e.dataSource,e}return __extends(i,t),i.getIntance=function(){return this._intance||(this._intance=new i),this._intance},i.prototype.initParams=function(){},i.prototype.showPanel=function(e){var t=this;void 0===e&&(e=7),this.currentLayer=e,App.LittleLoading().showLoading("NewBossHomeMainControler"),App.getResourceUtils().loadGroup("lootbossGroup",function(){t.show(),App.LittleLoading().hideLoading("NewBossHomeMainControler")},null,this)},i.prototype.initListener=function(){this.ui.clearCDLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),e.Message.instance.add(e.Code.BP_BOSS_LIST_S,this),e.Message.instance.add(e.Code.BP_BOSS_CLEAN_CD_S,this)},i.prototype.childrenCreated=function(){this.doScreenAdaptation()},i.prototype.sendBossMapInfo=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPBossPlunderListReq");i.setMapGroup(t),e.Message.instance.send(e.Code.BP_BOSS_LIST_C,i,!0)},i.prototype.initBossHomeData=function(){for(var t=this.bossMapInfo.length,i=[],n=0;t>n;++n){var o=this.bossMapInfo[n],a=o.getRemainTime(),s=o.getId(),r=o.getMapId(),l=o.getState(),h=o.getHolderPlayerName(),c=o.getRefMiliSecond(),u=o.getFreeJoin(),p=new Object;p.mapId=r,p.id=s,p.mapGroupType=this.mapGroupType,p.timeR=a,p.state=l,p.name=h,p.refMiliSecond=c,p.freeJoin=u,i.push(p)}var g=this.ui.grabeBossGroup;g.dataProvider=this.collection,g.itemRenderer=e.NewBossMainItemRender,this.dataSource=i,this.collection.replaceAll(this.dataSource)},i.prototype.getIconPos=function(e,t,i){var n=new egret.Point,o=Math.floor(i/this.columnNum),a=i%this.columnNum;return n.x=a*(e+this.bossItemGap),n.y=o*(t+this.bossItemGap),n},i.prototype.showHook=function(){this.ui.clearCDLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("QINGCHUCD"));var t=this.currentLayer;switch(t){case 1:this.sendBossMapInfo(e.BossRequestFight.BOSS_HOME_LAYER_1);break;case 2:this.sendBossMapInfo(e.BossRequestFight.BOSS_HOME_LAYER_2);break;case 3:this.sendBossMapInfo(e.BossRequestFight.BOSS_HOME_LAYER_3)}this.initListener(),this.setRegisterTick(!0)},i.prototype.readyDestroy=function(){this.ui.grabeBossGroup.dataProvider=null,e.Message.instance.remove(e.Code.BP_BOSS_LIST_S,this),e.Message.instance.remove(e.Code.BP_BOSS_CLEAN_CD_S,this),this.setRegisterTick(!1)},i.prototype.closeHook=function(){},i.prototype.clear=function(){},i.prototype.dispose=function(){},i.prototype.createChildren=function(){this.ui.grabeBossScroller.verticalScrollBar.autoVisibility=!1},i.prototype.tickHook=function(t){var i=t-this.lastTime;1e3>i||0==this.cdMiliSecond||(this.lastTime=t,this.cdMiliSecond>0&&(this.cdMiliSecond--,this.ui.bossRestTime.text=this.cdMiliSecond+e.LanguageUtils.instance.getValue("MIAO"),this.cdMiliSecond<=0))},i.prototype.clickBtn=function(t){switch(t.target){case this.ui.closeBtn:this.close();break;case this.ui.clearCDLabel:if(this.cdMiliSecond>0){var i=e.LanguageUtils.instance.getValue("BOSS_PLUNDER_CD_COSTIPS",Math.ceil(this.cdMiliSecond));e.PopUpController.getInstance().showTextPanel(i,this,this.clearCDTime)}break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("BOSSSHOMEHELP")}},i.prototype.sortMapInfo=function(){for(var t=[],i=[],n=[],o=[],a=[],s=this.bossMapInfo.length,r=0;s>r;++r){var l=this.bossMapInfo[r],h=l.getState();1==h?t.push(l):2==h?i.push(l):3==h&&n.push(l)}s=t.length;for(var r=0;s>r;++r){var l=t[r],c=l.getMapId(),u=e.JsonDataManager.instance.mapTemplate,p=u[c],g=p.monsterLevelRange;e.PlayerService.instance.mainRoleInfo.getLevel()>=g?o.push(l):a.push(l)}o.reverse(),t=[],s=o.length;for(var r=0;s>r;++r){var l=o[r];t.push(l)}s=a.length;for(var r=0;s>r;++r){var l=a[r];t.push(l)}this.bossMapInfo=[],s=t.length;for(var r=0;s>r;++r){var l=t[r];this.bossMapInfo.push(l)}s=i.length;for(var r=0;s>r;++r){var l=i[r];this.bossMapInfo.push(l)}s=n.length;for(var r=0;s>r;++r){var l=n[r];this.bossMapInfo.push(l)}},i.prototype.clearCDTime=function(){if(e.PlayerService.instance.playerInfo.getGold()<this.cdMiliSecond)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var t=HawkProtocolManager.newBuilder("JsProto.HPBossPlunderCleanCdReq");t.setMapGroup(this.mapGroupType),e.Message.instance.send(e.Code.BP_BOSS_CLEAN_CD_C,t,!0)},i.prototype.recvMsg=function(t,i){if(!this||!this.ui)return void Log.trace("NewBossHomeMainControler recvMsg this ui null, return");switch(t){case e.Code.BP_BOSS_LIST_S:this.mapGroupType=i.mapGroup,this.cdMiliSecond=i.cdMiliSecond,this.cdMiliSecond=Math.floor(this.cdMiliSecond/1e3),this.cdMiliSecond>0,this.ui.bossRestTime.text=this.cdMiliSecond+e.LanguageUtils.instance.getValue("MIAO"),this.bossMapInfo=i.maps,this.ui.grabeBossScroller.stopAnimation(),this.ui.grabeBossScroller.viewport.scrollV=0,this.sortMapInfo(),this.initBossHomeData();break;case e.Code.BP_BOSS_CLEAN_CD_S:this.mapGroupType=i.mapGroup,this.cdMiliSecond=i.cdMiliSecond,this.cdMiliSecond=Math.floor(this.cdMiliSecond/1e3),this.ui.bossRestTime.text=this.cdMiliSecond+e.LanguageUtils.instance.getValue("MIAO")}},i}(e.BasePanel);e.NewBossHomeMainControler=t,__reflect(t.prototype,"foxgame.NewBossHomeMainControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.PERSONBOSSTYPE=1]="PERSONBOSSTYPE",e[e.FIELDBOSSTYPE=2]="FIELDBOSSTYPE",e[e.ELITEBOSSTYPE=3]="ELITEBOSSTYPE",e[e.HOMEBOSSTYPE=4]="HOMEBOSSTYPE",e[e.INTERSERVICEBOSSTYPE=5]="INTERSERVICEBOSSTYPE"}(t=e.BossFightType||(e.BossFightType={}));var i;!function(e){e[e.DAILY_COPY=5]="DAILY_COPY",e[e.BOSS_WILD=6]="BOSS_WILD",e[e.BOSS_HOME_LAYER_1=7]="BOSS_HOME_LAYER_1",e[e.BOSS_HOME_LAYER_2=8]="BOSS_HOME_LAYER_2",e[e.BOSS_HOME_LAYER_3=9]="BOSS_HOME_LAYER_3",e[e.BOSS_ELITE=10]="BOSS_ELITE",e[e.BOSS_CROSSDRESS=14]="BOSS_CROSSDRESS"}(i=e.BossRequestFight||(e.BossRequestFight={}));var n=function(n){function o(){var t=n.call(this,"resource/skins/lootboss/LootBossMainSkin.exml","lootbossGroup",!1)||this;return t.cdMiliSecond=0,t.bossItemGap=4,t.columnNum=1,t.timerCount=0,t.timerHandler=null,t.model||(t.model=e.NewBossMainModel.getIntance(),t.isMask=!1,t.isMaskdown=!0,t.adaptionType=1),t.dataSource=[],t.collection=new eui.ArrayCollection,t.collection.source=t.dataSource,t.setIsShowBackBtn(!0),t.setIsTextureCache(!1),t}return __extends(o,n),o.getIntance=function(){return this._instance||(this._instance=new o),this._instance},o.prototype.backHandler=function(){e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"NewBossMainControler",tag:"getbackBtn",battleType:e.BattleType.BATTLE_CHALLENGE}),this.close()},o.prototype.initHook=function(){this.doScreenAdaptation(),this.ui.backBtn.visible=!1,this.ui.currency.refresh()},o.prototype.initParams=function(){this.residueCountinit()},o.prototype.residueCountinit=function(){this.ui.challengeTips.visible=!1,this.ui.residueCount.visible=!1},o.prototype.residueCountShow=function(){this.ui.challengeTips.visible=!0,this.ui.residueCount.visible=!0},o.prototype.closepanel=function(){this.getIsShow()&&this.close()},o.prototype.showPanel=function(e){var t=this;void 0===e&&(e=null),this.currentObj=e,App.LittleLoading().showLoading("NewBossMainControler"),App.getResourceUtils().loadGroup("lootbossGroup",function(){t.show(),App.LittleLoading().hideLoading("NewBossMainControler")},null,this)},o.prototype.refreshItemNum=function(){var t=this.ui.grabeBossGroup;if(t.itemRenderer==e.NewBossEliteItemRender)for(var i=t.numChildren,n=0;i>n;n++){var o=t.getChildAt(n);o.changeBuyNum()}},o.prototype.childrenCreated=function(){this.doScreenAdaptation()},o.prototype.selectBossBtn=function(e){this.ui.grabeBossScroller.stopAnimation(),this.ui.grabeBossScroller.viewport.scrollV=0;for(var i=t.PERSONBOSSTYPE;i<=t.INTERSERVICEBOSSTYPE;++i){var n=this.ui["bossFight"+i];n.enabled=e!=i}},o.prototype.sendBossMapInfo=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPBossPlunderListReq");i.setMapGroup(t),e.Message.instance.send(e.Code.BP_BOSS_LIST_C,i,!0)},o.prototype.resetBossMapInfo=function(){this.bossMapInfo=[]},o.prototype.initDataByDungeonType=function(t){e.EquipDungenManager.instance.clear();for(var i,n=e.JsonDataManager.instance.mapByGroupAndLevelTemplate,o=30,a=Number(e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_GRADE_MAX")),s=5,r=[],l=o;a>=l;l+=s)i=t+"_"+l,n[i]&&r.push(n[i][0]);r=this.sortMapInfoPerson(r);for(var h=r.length,c=(r.length-1,[]),l=0;h>l;++l){var u=r[l],p=u.id;e.EquipDungenManager.instance.mapVOList[p]=u;var g=u.name,d=u.monsterLevelRange,f=this.getVipFightSurplusNum(p),m=new Object,y=this.getVipFightStarNum(p);m.mapId=p,m.mapName=g,m.monsterLevelRange=d,m.surplusNum=f,m.starNum=y,c.push(m)}e.NewBossControler.getIntance().setRedPoint(!1,0);var I=this.ui.grabeBossGroup;I.dataProvider=this.collection,I.itemRenderer=e.NewBossPersonItemRender,this.dataSource=c,this.collection.replaceAll(this.dataSource),this.checkRedPoint()},o.prototype.getVipFightStarNum=function(e){for(var t=0;t<this.dailyCopyInfo.length;++t)if(e==this.dailyCopyInfo[t].getMapId()){var i=this.dailyCopyInfo[t].getStar();return i}return 0},o.prototype.getVipFightSurplusNum=function(e){for(var t=this.dailyCopyInfo.length,i=0;t>i;++i)if(e==this.dailyCopyInfo[i].getMapId()){var n=this.dailyCopyInfo[i].getUseTimes();return n}return 0},o.prototype.initBossPersonData=function(){this.mapGroupType=i.DAILY_COPY,this.ui.helpBtn.resouce="PERSONALBOSSHELP",this.resetBossMapInfo();var t=0;this.ui.bossRestTime.text=t+e.LanguageUtils.instance.getValue("MIAO"),this.cdMiliSecond=0,this.initDataByDungeonType(e.FuBenType.personBossType)},o.prototype.initBossHomeData=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=0),this.resetBossMapInfo();for(var n=[],o=0;3>o;++o){var a=new Object;a.boo=t,a.layer=i;var s=e.LanguageUtils.instance.getValue("BOSSHOMELAYERNOTICE"+(o+1));a.str=s,a.i=o,n.push(a)}var r=this.ui.grabeBossGroup;r.dataProvider=this.collection,r.itemRenderer=e.NewBossHomeItemRender,this.dataSource=n,this.collection.replaceAll(this.dataSource),this.checkRedPoint(),this.residueCountShow()},o.prototype.sortMapInfoPerson=function(t){t.sort(this.compareFnWildBossLevelPerson);for(var i=[],n=[],o=[],a=[],s=t.length,r=0;s>r;++r){var l=t[r],h=this.getVipFightSurplusNum(l.id);1==h?n.push(l):i.push(l)}t=[],s=i.length;for(var r=0;s>r;++r){var l=i[r],c=l.id,u=e.JsonDataManager.instance.mapTemplate,p=u[c],g=p.monsterLevelRange;e.PlayerService.instance.mainRoleInfo.getLevel()>=g?o.push(l):a.push(l)}o.reverse(),i=[],s=o.length;for(var r=0;s>r;++r){var l=o[r];i.push(l)}for(var r=0;r<a.length;++r){var l=a[r];i.push(l)}this.bossMapInfo=[],s=i.length;for(var r=0;s>r;++r){var l=i[r];t.push(l)}s=n.length;for(var r=0;s>r;++r){var l=n[r];t.push(l)}return t},o.prototype.sortMapInfo=function(){this.bossMapInfo.sort(this.compareFnWildBossLevel);for(var t=[],i=[],n=[],o=[],a=[],s=this.bossMapInfo.length,r=0;s>r;++r){var l=this.bossMapInfo[r],h=l.getState();1==h?t.push(l):2==h||0==h?i.push(l):3==h&&n.push(l)}s=t.length;for(var r=0;s>r;++r){var l=t[r],c=l.getMapId(),u=e.JsonDataManager.instance.mapTemplate,p=u[c],g=p.monsterLevelRange;e.PlayerService.instance.mainRoleInfo.getLevel()>=g?o.push(l):a.push(l)}o.reverse(),t=[],s=o.length;for(var r=0;s>r;++r){var l=o[r];t.push(l)}for(var r=0;r<a.length;++r){var l=a[r];t.push(l)}this.bossMapInfo=[],s=t.length;for(var r=0;s>r;++r){var l=t[r];this.bossMapInfo.push(l)}s=i.length;for(var r=0;s>r;++r){var l=i[r];this.bossMapInfo.push(l)}s=n.length;for(var r=0;s>r;++r){var l=n[r];this.bossMapInfo.push(l)}this.model.checkData(this.bossMapInfo)},o.prototype.initBossWildData=function(){for(var t=this.bossMapInfo.length,i=[],n=0;t>n;++n){var o=this.bossMapInfo[n],a=o.getId(),s=o.getRemainTime(),r=o.getMapId(),l=o.getState(),h=(o.getRefMiliSecond(),o.getHolderPlayerName()),c=new Object;c.id=a,c.mapId=r,c.mapGroupType=this.mapGroupType,c.state=l,c.refMiliSecond=e.NewBossControler.getIntance().getOverTime(o.getId()),c.name=h,c.freeJoin=null,c.timeR=s,i.push(c)}var u=this.ui.grabeBossGroup;u.dataProvider=this.collection,u.itemRenderer=e.NewBossMainItemRender,this.dataSource=i,this.collection.replaceAll(this.dataSource),this.checkRedPoint(),this.residueCountShow()},o.prototype.initBosscrossdressData=function(){for(var t=this.bossMapInfo.length,i=[],n=0;t>n;++n){var o=this.bossMapInfo[n],a=Number(o.getId()),s=Number(o.getRemainTime()),r=Number(o.getMapId()),l=Number(o.getState()),h=Number(o.getRefMiliSecond()),c=o.getHolderPlayerName(),u=new Object;u.id=a,u.mapId=r,u.mapGroupType=this.mapGroupType,u.state=l,u.refMiliSecond=h,u.name=c,u.freeJoin=null,u.timeR=s,u.hp=Number(o.getCurHp()),Log.trace("boss刷新时间:"+o.getMapId()+" : "+o.getRemainTime()),i.push(u)}e.NewBossControler.getIntance().setRedPoint(!1,4);var p=this.ui.grabeBossGroup;p.dataProvider=this.collection,p.itemRenderer=e.NewBossCROSSDRESSItemRender,this.dataSource=i,this.collection.replaceAll(this.dataSource),this.checkRedPoint()},o.prototype.compareFnWildBossLevel=function(t,i){var n=t.getMapId(),o=i.getMapId(),a=e.JsonDataManager.instance.mapTemplate,s=a[n],r=a[o];return s.monsterLevelRange>r.monsterLevelRange?1:s.monsterLevelRange<r.monsterLevelRange?-1:0},o.prototype.compareFnWildBossLevelPerson=function(e,t){var i=e,n=t;return i.monsterLevelRange>n.monsterLevelRange?1:i.monsterLevelRange<n.monsterLevelRange?-1:0},o.prototype.initBossEliteData=function(){var t=this.bossMapInfo.length;this.eliteArr=[];for(var i=[],n=0;t>n;++n){var o=this.bossMapInfo[n],a=o.getId(),s=o.getMapId(),r=o.getState(),l=(o.getRefMiliSecond(),o.getHolderPlayerName()),h=o.getRemainTime(),c=new Object;c.id=a,c.mapId=s,c.state=r,c.flushTime=e.NewBossControler.getIntance().getOverTime(o.getId()),c.name=l,c.timeR=h,i.push(c),this.eliteArr.push(c)}var u=this.ui.grabeBossGroup;u.dataProvider=this.collection,u.itemRenderer=e.NewBossEliteItemRender,this.dataSource=i,this.collection.replaceAll(this.dataSource),this.checkRedPoint()},o.prototype.getIconPos=function(e,t,i){var n=new egret.Point,o=Math.floor(i/this.columnNum),a=i%this.columnNum;return n.x=a*(e+this.bossItemGap),n.y=o*(t+this.bossItemGap),n},o.prototype.initUi=function(){this.ui.clearCDLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("QINGCHUCD"))},o.prototype.initListerner=function(){e.Message.instance.add(e.Code.BP_BOSS_LIST_S,this),e.Message.instance.add(e.Code.BP_BOSS_CLEAN_CD_S,this),e.Message.instance.add(e.Code.BOSS_WIPE_S,this),this.ui.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.clearCDLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this);for(var i=t.PERSONBOSSTYPE;i<=t.INTERSERVICEBOSSTYPE;++i){var n=this.ui["bossFight"+i];n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)}},o.prototype.hideresiduceCount=function(e){for(var t=[this.ui.bossFight1,this.ui.bossFight2,this.ui.bossFight3,this.ui.bossFight4,this.ui.bossFight5],i=0;i<t.length;i++)if(e==t[i]){this.residueCountinit();break}},o.prototype.clickBtn=function(n){switch(this.hideresiduceCount(n.target),this.ui.currency.refresh(),n.target){case this.ui.closeBtn:e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"NewBossMainControler",tag:"gecloseBtn",battleType:e.BattleType.BATTLE_CHALLENGE}),this.close();break;case this.ui.backBtn:e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"NewBossMainControler",tag:"getbackBtn",battleType:e.BattleType.BATTLE_CHALLENGE}),this.close();break;case this.ui.bossFight1:this.selectBossBtn(t.PERSONBOSSTYPE),this.ui.helpBtn.resouce="PERSONALBOSSHELP",this.initBossPersonData();break;case this.ui.bossFight2:this.selectBossBtn(t.FIELDBOSSTYPE),this.ui.helpBtn.resouce="FIELDBOSSHELP",this.sendBossMapInfo(i.BOSS_WILD);break;case this.ui.bossFight3:e.PlayerService.instance.level>=Number(e.GlobalConfig.instance.getValue("SHENYU_BOSS_KQDJ"))||e.PlayerService.instance.vipLevel>=Number(e.GlobalConfig.instance.getValue("SHENYU_BOSS_VIPDJ"))?(this.selectBossBtn(t.ELITEBOSSTYPE),this.ui.helpBtn.resouce="ELITEBOSSHELP",this.sendBossMapInfo(i.BOSS_ELITE)):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BOSS_ELITEENTERNOTICE"));break;case this.ui.bossFight4:this.sendBossMapInfo(i.BOSS_HOME_LAYER_1),this.ui.helpBtn.resouce="BOSSSHOMEHELP",this.initBossHomeData(),this.selectBossBtn(t.HOMEBOSSTYPE);break;case this.ui.bossFight5:var o=Number(e.GlobalConfig.instance.getValue("BOSS_CROSSDRESS_OPEN_LEVEL"));if(e.PlayerService.instance.playerInfo.getLevel()<o)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BOSS_CROSSDRESS",o));this.getIsShow()&&this.startTimer(),45==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),this.ui.helpBtn.resouce="KUAFUBOSS",this.sendBossMapInfo(i.BOSS_CROSSDRESS),this.selectBossBtn(t.INTERSERVICEBOSSTYPE);break;case this.ui.clearCDLabel:if(this.mapGroupType!=i.DAILY_COPY&&this.mapGroupType!=i.BOSS_ELITE&&this.cdMiliSecond>0){var a=e.LanguageUtils.instance.getValue("BOSS_PLUNDER_CD_COSTIPS",Math.ceil(this.cdMiliSecond));e.PopUpController.getInstance().showTextPanel(a,this,this.clearCDTime)}break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel(this.ui.helpBtn.resouce)}},o.prototype.openTips=function(){var t=e.JsonDataManager.instance.errorCode;if(t){var i=t[95004];i&&e.PopUpController.getInstance().showFloatTextPanel1(i)}},o.prototype.clearCDTime=function(){if(e.PlayerService.instance.playerInfo.getGold()<this.cdMiliSecond)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var t=HawkProtocolManager.newBuilder("JsProto.HPBossPlunderCleanCdReq");t.setMapGroup(this.mapGroupType),e.Message.instance.send(e.Code.BP_BOSS_CLEAN_CD_C,t,!0)},o.prototype.showHook=function(){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();var n=this.currentObj;if(this.initUi(),this.initBossPersonData(),n&&n.tab?(this.selectBossBtn(n.tab),2==n.tab&&this.sendBossMapInfo(i.BOSS_WILD),5==n.tab&&this.sendBossMapInfo(i.BOSS_CROSSDRESS)):n&&n.fbType?this.selectTypeChange(n.fbType):this.selectBossBtn(t.PERSONBOSSTYPE),this.initListerner(),this.setRegisterTick(!0),28==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz){var o=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(o,o.parent,28,4,!0)}45==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.bossFight5,this.ui.bossFight5.parent,45,2,!0)},o.prototype.selectTypeChange=function(e){switch(e){case i.BOSS_ELITE:this.selectBossBtn(t.ELITEBOSSTYPE),this.ui.helpBtn.resouce="ELITEBOSSHELP",this.sendBossMapInfo(i.BOSS_ELITE);break;case i.BOSS_HOME_LAYER_1:this.sendBossMapInfo(i.BOSS_HOME_LAYER_1),this.ui.helpBtn.resouce="BOSSSHOMEHELP",this.initBossHomeData(!0,1),this.selectBossBtn(t.HOMEBOSSTYPE);break;case i.BOSS_HOME_LAYER_2:this.sendBossMapInfo(i.BOSS_HOME_LAYER_2),this.ui.helpBtn.resouce="BOSSSHOMEHELP",this.initBossHomeData(!0,2),this.selectBossBtn(t.HOMEBOSSTYPE);
break;case i.BOSS_HOME_LAYER_3:this.sendBossMapInfo(i.BOSS_HOME_LAYER_3),this.ui.helpBtn.resouce="BOSSSHOMEHELP",this.initBossHomeData(!0,3),this.selectBossBtn(t.HOMEBOSSTYPE);break;case i.BOSS_WILD:this.selectBossBtn(t.FIELDBOSSTYPE),this.ui.helpBtn.resouce="FIELDBOSSHELP",this.sendBossMapInfo(i.BOSS_WILD);break;case i.DAILY_COPY:this.selectBossBtn(t.PERSONBOSSTYPE),this.ui.helpBtn.resouce="PERSONALBOSSHELP",this.sendBossMapInfo(i.DAILY_COPY);break;case i.BOSS_CROSSDRESS:this.selectBossBtn(t.INTERSERVICEBOSSTYPE),this.ui.helpBtn.resouce="KUAFUBOSS",this.sendBossMapInfo(i.BOSS_CROSSDRESS)}},o.prototype.sendMessageAll=function(){this.sendBossMapInfo(i.BOSS_CROSSDRESS),this.sendBossMapInfo(i.BOSS_ELITE),this.sendBossMapInfo(i.BOSS_HOME_LAYER_1),this.sendBossMapInfo(i.BOSS_WILD)},o.prototype.checkRedPoint=function(){var t=0,i=5;for(t;i>t;t++){var n=this.getRedImg(t+1);n&&(n.visible=e.NewBossControler.getIntance().getRedPoint(t))}},o.prototype.getRedImg=function(e){return this.ui["RedImg"+e]},o.prototype.readyDestroy=function(){this.ui.grabeBossGroup.dataProvider=null},o.prototype.closeHook=function(){28==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidefun(),this.clearTimer()},o.prototype.createChildren=function(){this.ui.grabeBossScroller.verticalScrollBar.autoVisibility=!1},o.prototype.tickHook=function(t){var i=t-this.lastTime;1e3>i||0==this.cdMiliSecond||(this.lastTime=t,this.cdMiliSecond>0&&this.cdMiliSecond--,this.cdMiliSecond<=0,this.ui.bossRestTime.text=this.cdMiliSecond+e.LanguageUtils.instance.getValue("MIAO"))},o.prototype.tick=function(){if(this.timerCount>0){var e=this.ui["bossFight"+t.INTERSERVICEBOSSTYPE];e.enabled||(this.sendBossMapInfo(i.BOSS_CROSSDRESS),this.timerCount--)}else this.clearTimer()},o.prototype.startTimer=function(){this.clearTimer(),0==this.timerCount&&(this.timerCount=999,this.timerHandler=setInterval(this.tick.bind(this),1e4),this.tick())},o.prototype.clearTimer=function(){this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null,this.timerCount=0)},o.prototype.recvMsg=function(t,n){if(!this||!this.ui)return void Log.trace("NewBossMainControler recvMsg this ui null, return");switch(t){case e.Code.BP_BOSS_LIST_S:this.mapGroupType=n.mapGroup,this.cdMiliSecond=n.cdMiliSecond,this.cdMiliSecond>0?this.cdMiliSecond=Math.floor(this.cdMiliSecond/1e3):this.cdMiliSecond=0;var o=n,a=o.getBossTimes();if(this.mapGroupType>=i.BOSS_WILD&&this.mapGroupType<=i.BOSS_HOME_LAYER_3&&this.calResidueFromServer(n.mapGroup,a),this.ui.bossRestTime.text=this.cdMiliSecond+e.LanguageUtils.instance.getValue("MIAO"),this.resetBossMapInfo(),this.bossMapInfo=n.maps,this.sortMapInfo(),this.mapGroupType==i.BOSS_HOME_LAYER_1||this.mapGroupType==i.BOSS_HOME_LAYER_2||this.mapGroupType==i.BOSS_HOME_LAYER_3)return;if(this.mapGroupType==i.BOSS_WILD)this.initBossWildData();else if(this.mapGroupType==i.BOSS_ELITE){this.initBossEliteData();var s=0;this.ui.bossRestTime.text=s+e.LanguageUtils.instance.getValue("MIAO")}else this.mapGroupType==i.BOSS_CROSSDRESS&&this.initBosscrossdressData();break;case e.Code.BP_BOSS_CLEAN_CD_S:n.mapGroup;this.cdMiliSecond=n.cdMiliSecond,this.ui.bossRestTime.text=this.cdMiliSecond+e.LanguageUtils.instance.getValue("MIAO");break;case e.Code.BOSS_WIPE_S:var r=n.mapId,l=(n.fromLevel,n.upToLevel,n.award);e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTRESULTWIN)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:l,mapId:r,saodang:!0}}),this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState(),this.initBossPersonData()}},o.prototype.calResidueFromServer=function(t,n){t>i.BOSS_WILD&&(t=i.BOSS_HOME_LAYER_3);var o=e.JsonDataManager.instance.bossLimitCfg[t];this.ui.residueCount.text=n+"/"+o.frequency;var a=Number(o.frequency);n==a?this.canChallenge=!0:this.canChallenge=!1},o}(e.BasePanel);e.NewBossMainControler=n,__reflect(n.prototype,"foxgame.NewBossMainControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.BOSSLimitVO=t,__reflect(t.prototype,"foxgame.BOSSLimitVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.redPointArr=[!1,!1,!1,!1,!1],this.isTime=!1,this.kuafuArr=[],this.crossBoo=!1}return t.getIntance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setDetailData=function(e){this.detailData=e},t.prototype.getDetailData=function(){return this.detailData},t.prototype.setData=function(e){this._data=[],this._data=e},t.prototype.initBosscrossdressData=function(){this.kuafuArr=[],this.crossBoo=!1;for(var e=this.curData.getMaps().length,t=0;e>t;++t){var i=this.bossMapInfo[t],n=Number(i.getRemainTime());Number(i.getRefMiliSecond());n>0&&this.kuafuArr.push(i)}},t.prototype.kuaFuTime=function(){this.isTime&&(this.isTime=!1,e.NewBossControler.getIntance().setRedPoint(!0,4))},t.prototype.checkData=function(t){void 0===t&&(t=null),null!=t&&(this.bossMapInfo=t);var i,n,o=this.bossMapInfo.length;this.timeDataArr=new Array,this.timeDataArrNew=new Array,this.timeDataArr=this.bossMapInfo.concat(),this.mapCfg=e.JsonDataManager.instance.mapTemplate;for(var a=0;o>a;a++)i=this.bossMapInfo[a],i&&(n=i.getRefMiliSecond(),0>=n&&this.timeDataArr.splice(a,1));this.timeDataArrNew=this.timeDataArr.concat(),this.timerBegin()},t.prototype.timerBegin=function(){this.myTimer||(this.myTimer=new egret.Timer(1e3,0)),this.myTimer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.myTimer.start()},t.prototype.timerFunc=function(t){for(var i,n,o=this.timeDataArr.length,a=0,s=[],r=!1,l=0,h=0;o>h;h++)if(i=this.timeDataArr[h])if(n=i.getRefMiliSecond(),a>=n)s.push(i),a=n,r=!0;else{if(0>n)continue;n-=1e3,i.setRefMiliSecond(n),this.timeDataArr[h]=i,this.timeDataArrNew[h]=i}else s.length>0&&s.push(i);if(!this.crossBoo){var c=0,u=this.kuafuArr.length;for(c;u>c;c++)i=this.kuafuArr[c],i.getRemainTime()>0&&(n=i.getRefMiliSecond(),l=i.getRemainTime(),0>=n?0>=l?(this.crossBoo=!0,e.NewBossControler.getIntance().setRedPoint(!0,4)):(l-=1e3,i.setRemainTime(l)):(n-=1e3,i.setRefMiliSecond(n)))}r&&0==this.index&&this.checkSameTimeData(s)},t.prototype.checkSameTimeData=function(t){for(var i,n,o=t.length,a=e.PlayerService.instance.level,s=0,r=0;o>r&&(i=this.timeDataArr[r],i);r++){var l=this.mapCfg[i.getMapId()];if(l.limitLevel==a){this.currentData=i,n=l;break}l.limitLevel<a&&l.limitLevel>s&&(this.currentData=i,s=l.limitLevel,n=l)}if(n&&n.name){var h=n.name,c=h+e.LanguageUtils.instance.getValue("FUHUOLE");e.MainControler.instance.changeCharlingName(c),e.MainControler.instance.setbossRed(!0)}},t.prototype.gettimeDataArr=function(){return this.timeDataArr},t.prototype.getOverTime=function(e){var t=0,i=this.timeDataArrNew,n=0,o=i.length;for(n;o>n;n++){var a=this.timeDataArrNew[n];if(a&&a.getId()==e)return a.getRefMiliSecond()}return t},t.prototype.sortOn=function(e,t){if(!e||!t)return 0;var i=e.getRefMiliSecond(),n=t.getRefMiliSecond();return n>i?1:i==n?0:-1},t.prototype.getMsgDataGroup=function(){this.bossMapInfo=[],this.index=0,e.Message.instance.add(e.Code.BP_BOSS_LIST_S,this),e.Message.instance.add(e.Code.CS_BOSS_RED_NOT_S,this),this.getMsgData(e.BossRequestFight.BOSS_WILD),this.getMsgData(e.BossRequestFight.BOSS_HOME_LAYER_1),this.getMsgData(e.BossRequestFight.BOSS_HOME_LAYER_2),this.getMsgData(e.BossRequestFight.BOSS_HOME_LAYER_3),this.getMsgData(e.BossRequestFight.BOSS_ELITE),this.getMsgData(e.BossRequestFight.BOSS_CROSSDRESS)},t.prototype.getMsgData=function(t){this.index++;var i=HawkProtocolManager.newBuilder("JsProto.HPBossPlunderListReq");i.setMapGroup(t),e.Message.instance.send(e.Code.BP_BOSS_LIST_C,i,!0)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.BP_BOSS_LIST_S:this.curData=i,this.bossMapInfo=this.bossMapInfo.concat(i.maps).concat(null),this.index--,this.curData.getMapGroup()==e.BossRequestFight.BOSS_CROSSDRESS?this.initBosscrossdressData():this.checkData();break;case e.Code.CS_BOSS_RED_NOT_S:this.isTime=!0,this.kuaFuTime()}},t.prototype.setRedPoint=function(t,i){this.redPointArr.length>i&&this.redPointArr[i]!=t&&(this.redPointArr[i]=t,e.NewBossControler.getIntance().checkRedPoint())},t.prototype.getRedPoint=function(e){return this.redPointArr.length>e?this.redPointArr[e]:!1},t.prototype.getBossRedPoint=function(){var e=!1,t=0,i=this.redPointArr.length;for(t;i>t;t++){var n=this.redPointArr[t];if(n)return!0}return e},t}();e.NewBossMainModel=t,__reflect(t.prototype,"foxgame.NewBossMainModel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/fight/BossBloodSkin.exml")||this;return e.imgWWidth=323,e.bossId=-1,e._detailData_2=null,e.buttonsBottom=!1,e.bossBloodTimer||(e.bossBloodTimer=new egret.Timer(1e3)),e.bossBloodTimer.addEventListener(egret.TimerEvent.TIMER,e.onBloodTime,e),e.bossBloodTimer.stop(),e.isMask=!1,e.setIsShowBackBtn(!1),e.setRegisterTick(!0),e}return __extends(i,t),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.initHook=function(){this.isCallHideSceneObjectsWhenClose=!1,e.GamePlatform.isQQdating&&(this.ui.hpGroup.horizontalCenter=0,this.ui.hpGroup.top=0,this.ui.width=this.stage.stageWidth-ScreenAdaptation.instance.uiWidth)},i.prototype.showHook=function(){this.y=Number(e.GlobalConfig.instance.getValue("BOSSHPBARPOSY")),this.initListener(),this.setCurHP(this.curHP),this.buttonsBottom&&(this.buttonsBottom=!1,this.adaptButtonPos(!0))},i.prototype.initListener=function(){var e=this.ui.bossLookRewardBtn,t=this.ui.bossQuitFubenBtn;e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showPanel=function(e,t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this.bossId=e,this.curHP=t,this.showAwardBtn=i,this.showBackBtn=n,0==this.getIsShow()?(this.layer=0,this.show()):this.setCurHP(t)},i.prototype.initParams=function(){this.ui.bossLookRewardBtn.visible=this.showAwardBtn,this.ui.bossQuitFubenBtn.visible=this.showBackBtn},i.prototype.refresh=function(){var t=this.ui.bossName,i=this.ui.bossLevel;this.monsterVO=e.JsonDataManager.instance.monster[this.bossId],t.text=this.monsterVO.name,i.text=this.monsterVO.level+"";var n=(e.JsonDataManager.instance.monster,this.ui.bossIcon);n.source=this.monsterVO.iconPath;parseFloat((this.curHP/Number(this.monsterVO.hp)).toFixed(3));this.ui.blood.maximum=this.monsterVO.hp,this.ui.blood.value=this.curHP;var o=e.BattleType.BATTLE_PVE_BOSS;if(e.BattleScene.instance.currentBattle&&e.BattleScene.instance.currentBattle.battleType&&(o=e.BattleScene.instance.currentBattle.battleType),o==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||o==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||o==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER){var a=this.ui.reward_50;a.source="item410_png",a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(120299,0,!1)},this),a.visible=!0}else{var a=this.ui.reward_50;a.visible=!1}},i.prototype.tickHook=function(e){console.log("111111")},i.prototype.onBloodTime=function(e){this.bossBloodCurrentHp/this.bossBloodMaxHp;if(this.ui)return this.bossBloodCurrentHp<=0?void this.bossBloodTimer.stop():void this.bossBloodTween()},i.prototype.bossBloodTween=function(){this.bossBloodLastHp/this.bossBloodMaxHp*this.imgWWidth,Number(this.bossBloodCurrentHp)/Number(this.bossBloodMaxHp)*this.imgWWidth;this.bossBloodLastHp=this.bossBloodCurrentHp},i.prototype.setCurHP=function(t){if(!(this.bossId<0)){if(0==this.getIsInit())return void(this.curHP=t);this.monsterVO=e.JsonDataManager.instance.monster[this.bossId];var i=this.monsterVO.hp;this.bossBloodCurrentHp=t,this.bossBloodMaxHp=i,this.ui.blood.value=t,this.bossBloodLastHp=i,!this.bossBloodTimer.running&&this.ui&&(0==t&&(this.bossBloodTimer.delay=200),this.bossBloodTimer.start())}},i.prototype.onClick=function(t){var i=e.BattleType.BATTLE_PVE_BOSS;switch(e.BattleScene.instance.currentBattle&&e.BattleScene.instance.currentBattle.battleType&&(i=e.BattleScene.instance.currentBattle.battleType),t.target){case this.ui.bossLookRewardBtn:if(i==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||i==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||i==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER)e.TwelvePalaceRewardPanel.getInstance().showPanel(e.BattleScene.instance.currentBattle.mapId);else if(i==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER)e.KFPalaceRewardPanel.getInstance().showPanel(e.BattleScene.instance.currentBattle.mapId);else{var n=new Object;n.mapId=e.BattleScene.instance.currentBattle.mapId,n.mapType=0,n.timeR=0,e.NewBossControler.getIntance().showDetailPanel(n)}break;case this.ui.bossQuitFubenBtn:i==e.BattleType.BOSS_TWELVE_PALACE_FIGHT||i==e.BattleType.PVP_ATTACK_TWELVE_PALACE_PLAYER||i==e.BattleType.PVP_HITBACK_TWELVE_PALACE_ATTACTER||i==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER?e.BattleScene.instance.quitFuBen():(e.BattleScene.instance.quitFuBen(),e.BattleScene.instance.interruptCurrentBattle(),e.MainControler.instance.bossFightBloodVisible(!0,!1,0),e.MainControler.instance.initMainCityVisible(!0),this.close()),this.bossBloodTimer.stop()}},i.prototype.showDetail_2=function(t){if(this.getIsInit())if(t){var i=this.ui.bossIcon0;i.source=t.icon||"";var n=this.ui.bossName0;n.text=t.name||"";var o=this.ui.bossLevel0;o.text=t.level||"",this.refreshDetail_2(t),this.ui.bossGroup0.visible=!0;var a=this.ui.reward_50;a.source="item410_png",a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(120290,0,!1)},this),a.visible=!0}else{this.ui.bossGroup0.visible=!1;var a=this.ui.reward_50;a.visible=!1}else this._detailData_2=t},i.prototype.refreshDetail_2=function(e){var t=e.curHp||0,i=e.maxHp||0;this.ui.blood0.maximum=i,this.ui.blood0.value=t},i.prototype.readyDestroy=function(){this.bossBloodTimer.stop(),this.bossId=-1},i.prototype.closeHook=function(){e.UnionController.getInstance().closeBossTimePanel()},i.prototype.recvMsg=function(e,t){},i.prototype.adaptButtonPos=function(e){this.buttonsBottom!=e&&(this.buttonsBottom=e,1==this.getIsShow()&&(this.buttonsBottom?(this.ui.bossLookRewardBtn.y=this.ui.bossLookRewardBtn.y+70,this.ui.bossQuitFubenBtn.y=this.ui.bossQuitFubenBtn.y+70):(this.ui.bossLookRewardBtn.y=this.ui.bossLookRewardBtn.y-70,this.ui.bossQuitFubenBtn.y=this.ui.bossQuitFubenBtn.y-70)))},i}(e.BasePanel);e.BossBloodGroup=t,__reflect(t.prototype,"foxgame.BossBloodGroup")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(){var e=t.call(this,"resource/skins/lootboss/KFPalaceResultSkin.exml")||this;return e.timerCount=0,e.timerHandler=null,e.type=null,e.data=null,e.setIsShowBackBtn(!1),e}return __extends(n,t),n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickConfirm,this)},n.prototype.closeHook=function(){this.clearTimer()},n.prototype.onClickConfirm=function(t){1==this.type?(e.BattleScene.instance.quitFuBen(),this.close()):2==this.type&&(e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"KFPalaceResultPanel",tag:"win",battleType:e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER}),e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.KUAFUBOSS),this.close())},n.prototype.showPanel=function(e,t){this.type=e,this.data=t,this.show()},n.prototype.showHook=function(){if(this.type&&this.data){var e=this.data;this.startTimer(),1==this.type?1==e.result?(this.ui.success.visible=!0,this.ui.failure.visible=!1,this.ui.bossIcon.source=e.icon,e.mine?(this.ui.resultLabel.text=e.player,this.ui.rewardtxt.text="归属奖励",this.refreshAward(e.award)):(this.ui.resultLabel.text=e.player,this.ui.rewardtxt.text="参与奖励",this.refreshAward(e.award))):1==e.result?(this.ui.success.visible=!1,this.ui.failure.visible=!0,this.ui.bossIcon.source=e.icon,this.ui.resultLabel.text=e.player,this.ui.reward.visible=!1):(this.ui.success.visible=!1,this.ui.failure.visible=!0,this.ui.bossIcon.source=e.enemyIcon,this.ui.resultLabel.textFlow=new Array({text:"很遗憾，你在活动时间内没有击杀BOSS，BOSS已逃走",style:{textColor:16777215}}),this.ui.reward.visible=!1):2==this.type&&(1==e.result?(this.ui.success.visible=!0,this.ui.failure.visible=!1,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.9*.8,this.ui.bossIcon.scaleY=.8,this.ui.reward.visible=!1):(this.ui.success.visible=!1,this.ui.failure.visible=!0,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.9*.8,this.ui.bossIcon.scaleY=.8,this.ui.resultLabel.textFlow=new Array({text:"很遗憾，你被",style:{textColor:16777215}},{text:e.enemy,style:{textColor:11141123}},{text:"一顿爆打，落荒而逃，抢夺BOSS失败了！",style:{textColor:16777215}}),this.ui.reward.visible=!1))}},n.prototype.refreshAward=function(e){if(e){var t=[],n=e.getDrop().getItem();for(var o in n){var a=n[o];t.push({id:a.getItemId(),num:a.getItemCount()})}var s=e.getDrop().getDetailEquip();for(var o in s){var a=s[o];t.push({id:a.getItemId()})}if(t.sort(this.sortarr.bind(this)),0!=t.length){var r=new eui.ArrayCollection(t),l=new eui.TileLayout;l.requestedColumnCount=4,l.verticalGap=25;var h=this.ui.itemList;h.layout=l,h.dataProvider=r,h.itemRenderer=i,this.ui.itemScroller.viewport=this.ui.itemList,this.ui.reward.visible=!0}}},n.prototype.sortarr=function(e,t){var i=this.getItemTemp()[e.id],n=this.getItemTemp()[t.id];return n.quality-i.quality},n.prototype.getItemTemp=function(){return e.JsonDataManager.instance.itemTemplate},n.prototype.tick=function(){this.timerCount>0?(this.ui.timeLabel.text=""+this.timerCount,this.timerCount--):(this.clearTimer(),this.onClickConfirm(null))},n.prototype.startTimer=function(){this.clearTimer(),this.timerCount=10,this.timerHandler=setInterval(this.tick.bind(this),1e3),this.tick()},n.prototype.clearTimer=function(){this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null)},n.prototype.childrenCreated=function(){this.doScreenAdaptation()},n._instance=null,n}(e.BasePanel);e.KFPalaceResultPanel=t,__reflect(t.prototype,"foxgame.KFPalaceResultPanel");var i=function(t){function i(){var i=t.call(this)||this;return i.removeChildren(),i.width=100,i.height=70,i.itemIcon=new e.ItemIcon,i.itemIcon.x=i.width/2-i.itemIcon.width/2,i.itemIcon.y=i.height/2-i.itemIcon.height/2,i.addChild(i.itemIcon),i}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){this.removeChildren(),this.itemIcon.setItem(this.data.id,this.data.num),this.addChild(this.itemIcon)},i}(eui.ItemRenderer);__reflect(i.prototype,"KFPalaceResultItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/lootboss/KFPalaceRewardSkin.exml")||this;return e.palaceType=1,e.setIsTouchClose(!0),e}return __extends(i,t),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.showPanel=function(e){this.palaceType=e,this.show()},i.prototype.initHook=function(){for(var e=0;4>e;e++){var t=this.getDropItem(e);t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this);var i=this.getOccupyItem(e);i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)}},i.prototype.refresh=function(){for(var t=e.JsonDataManager.instance.mapTemplate[this.palaceType].dropPreview,i=0;4>i;i++){var n=this.getDropItem(i);n.setItem(t[i].id,t[i].value,!0,!0);var o=this.getOccupyItem(i);o.setItem(t[i].id,t[i].value,!0,!0)}},i.prototype.getItemTemp=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.click=function(t){var i=t.target;this.getItemTemp()[i.itemId];e.TipsController.getInstance().showItemTips(i.itemId,i.num)},i.prototype.childrenCreated=function(){this.doScreenAdaptation()},i.prototype.getDropItem=function(e){return this.ui["drop_"+e]},i.prototype.getOccupyItem=function(e){return this.ui["occupy_"+e]},i._instance=null,i}(e.BasePanel);e.KFPalaceRewardPanel=t,__reflect(t.prototype,"foxgame.KFPalaceRewardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,!0)||this;return e.refMiliSecond=0,e.lastTime=0,e.canT=!1,e.skinName="LootBossCrossdressBossItem",e}return __extends(i,t),i.prototype.tickHook=function(e){var t=e-this.lastTime;1e3>t||0==this.refMiliSecond||(this.lastTime=e,this.flushTime())},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.setItemRender(e.id,e.mapId,e.mapGroupType,e.state,e.refMiliSecond,e.hp,e.name,e.freeJoin,e.timeR)},i.prototype.setItemRender=function(t,i,n,o,a,s,r,l,h){this.descLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("XIANGXIJIANGLI")),this.id=t,this.mapId=i,this.mapItemType=n,this.bossState=0==o?2:o,this.bosshp=s,this.refMiliSecond=a,this.timeR=h,r?this.ownerName=r:this.ownerName=e.LanguageUtils.instance.getValue("WU"),this.freeJoin=l,this.initUi(),this.flushTime(),this.bossState>1&&(this.bossMapLevel.visible=!1,this.fightBtn.visible=!1,this.flushTimeLabel1.visible=!0,this.flushTimeLabel2.visible=!0)},i.prototype.flushTime=function(){var e=Math.floor(this.refMiliSecond/1e3/3600),t=0,i=0;e>0?t=Math.floor((this.refMiliSecond-3600*e*1e3)/1e3/60):(e=0,t=Math.floor(this.refMiliSecond/1e3/60)),i=t>0?Math.floor((this.refMiliSecond-3600*e*1e3-60*t*1e3)/1e3):Math.floor(this.refMiliSecond/1e3),this.flushTimeLabel2.text=(10>e?"0"+e:e)+":"+(10>t?"0"+t:t)+":"+(10>i?"0"+i:i),this.refMiliSecond-=1e3,this.refMiliSecond<=0&&this.fightBtnShow()},i.prototype.fightBtnShow=function(){this.bossMapLevel.visible=!1;var t=e.JsonDataManager.instance.mapTemplate,i=t[this.mapId];e.PlayerService.instance.playerInfo.getLevel()>=i.limitLevel?this.fightBtn.visible=!0:this.fightBtn.visible=!1,1==this.bossState&&e.NewBossMainControler.getIntance().cdMiliSecond<=0&&e.NewBossControler.getIntance().setRedPoint(!0,4),this.flushTimeLabel1.visible=!1,this.flushTimeLabel2.visible=!1},i.prototype.initUi=function(){switch(this.bossState){case e.BOSSFIGHTSTATE.APPEARBOSS:this.appearImg.visible=!0,this.deadImg.visible=!1,this.escapeImg.visible=!1;break;case e.BOSSFIGHTSTATE.ESCAPEBOSS:this.appearImg.visible=!1,this.deadImg.visible=!1,this.escapeImg.visible=!0;break;case e.BOSSFIGHTSTATE.DEADBOSS:this.appearImg.visible=!1,this.deadImg.visible=!0,this.escapeImg.visible=!1}var t=e.JsonDataManager.instance.mapTemplate,i=t[this.mapId];this.dropPreview=i.dropPreview;var n=i.extraCost.id;this.spendItemNum=0;var o=i.bossId;this.changeBossIcon(o);var a=e.BagController.getInstance().getItemInfoByItemId(n);a&&(this.spendItemNum=a.getCount());for(var s=1;3>=s;++s){var r=this.dropPreview[s-1],l=r.id,h=this["itemIcon"+s];h.setItem(l)}this.bossName.text=i.name,this.bossLevel.text=i.monsterLevelRange.toString();var c=i.limitLevel;this.holderName.text=this.ownerName,e.PlayerService.instance.playerInfo.getLevel()<c?(this.bossMapLevel.visible=!0,this.bossMapLevel.text=e.LanguageUtils.instance.getValue("JIJIKAIQI",c),this.fightBtn.visible=!1,this.flushTimeLabel1.visible=!1,this.flushTimeLabel2.visible=!1):this.bossState!=e.BOSSFIGHTSTATE.APPEARBOSS?(this.flushTimeLabel1.visible=!0,this.flushTimeLabel2.visible=!0,this.fightBtn.visible=!1,this.bossMapLevel.visible=!1):this.fightBtnShow()},i.prototype.changeBossIcon=function(t){var i=e.JsonDataManager.instance.monster,n=i[t];this.bossIcon.source=n.iconPath,this.hpbar.maximum=n.hp;var o;null==this.bosshp?(this.hpbar.value=n.hp,o=100):(this.hpbar.value=this.bosshp,o=this.bosshp/n.hp*100),this.hpLabel.text=~~o+"%"},i.prototype.timerFunc=function(e){this.flushTime()},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.dispose=function(){this.fightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.parent.removeChild(this)},i.prototype.CanTiaoZhan=function(e){this.canT=!0},i.prototype.btnClick=function(t){switch(t.target){case this.fightBtn:var i=e.JsonDataManager.instance.mapTemplate,n=i[this.mapId];if(e.PlayerService.instance.playerInfo.getLevel()<n.limitLevel)return;if(1==this.bossState){var o=0;if(e.PopUpManager.instance.getWindow(e.WindowName.BOSS_MAIN)){var a=e.NewBossMainControler.getIntance();o=a.cdMiliSecond}if(e.NewBossMainControler.getIntance().getIsShow()){var a=e.NewBossMainControler.getIntance();o=a.cdMiliSecond}if(o>0)e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BOSSRESTNOTICE"));else{if(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan,null,1),!this.canT)return;e.BattleScene.instance.sendMsgSceneChangeRequest(e.WorldSceneType.CrossServerBossBattleMap,this.id,e.WorldSceneType.MainCity,0)}}else 0==this.bossState?e.GameUtils.MSG_TIP("Boss刷新冷却中"):2==this.bossState?e.GameUtils.MSG_TIP("Boss已逃走，马上刷新"):3==this.bossState&&e.GameUtils.MSG_TIP("Boss已被击杀，稍后刷新");break;case this.descLabel:var s=new Object;s.mapId=this.mapId,s.mapType=0,s.timeR=this.timeR,e.NewBossControler.getIntance().showDetailPanel(s);break;case this.itemIcon1:var r=this.dropPreview[0],l=r.id;r.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:l}):r.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(l);break;case this.itemIcon2:var r=this.dropPreview[1],l=r.id;r.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:l}):r.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(l);break;case this.itemIcon3:var r=this.dropPreview[2],l=r.id;r.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:l}):r.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(l)}},i.prototype.showTips=function(){var t=e.LanguageUtils.instance.getValue("XIAOHAOYICENGTIAOZHANLING");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItem)},i.prototype.showTips2=function(){var t=e.LanguageUtils.instance.getValue("XIAOHAOERCENGTIAOZHANLING");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItem2)},i.prototype.showTips3=function(){var t=e.LanguageUtils.instance.getValue("XIAOHAOSANCENGTIAOZHANLING");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItem3)},i.prototype.spendItem=function(){if(this.spendItemNum>=1)e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_1);else{var t=e.LanguageUtils.instance.getValue("YICENGTONGXINGLINGBUZU");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItemVip)}},i.prototype.spendItem2=function(){if(this.spendItemNum>=1)e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_2);else{var t=e.LanguageUtils.instance.getValue("ERCENGTONGXINGLINGBUZU");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItemVip)}},i.prototype.spendItem3=function(){if(this.spendItemNum>=1)e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_3);else{var t=e.LanguageUtils.instance.getValue("SANCENGTONGXINGLINGBUZU");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItemVip)}},i.prototype.spendItemVip=function(){e.RechargeController.getInstance().showPanel()},i}(e.ItemRenderer1);e.NewBossCROSSDRESSItemRender=t,__reflect(t.prototype,"foxgame.NewBossCROSSDRESSItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,!0)||this;return e.lastTime=1e3,e.skinName="LootBossEliteBossItem",e}return __extends(i,t),i.prototype.tickHook=function(t){var i=t-this.lastTime;1e3>i||0==this.refMiliSecond||(this.lastTime=t,this.refMiliSecond=e.NewBossControler.getIntance().getOverTime(this.data.id),this.timerFunc())},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.lastTime=this.getcurTime();var e=this.data;this.setItemRender(e.id,e.mapId,e.state,e.flushTime,e.name,e.timeR)},i.prototype.setItemRender=function(t,i,n,o,a,s){void 0===s&&(s=0),this.descLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("XIANGXIJIANGLI")),this.id=t,this.mapId=i,this.bossState=n,this.timeR=s,this.refMiliSecond=o,a?(this.ownerName=a,this.ownHave=!0):(this.ownerName=e.LanguageUtils.instance.getValue("WU"),this.ownHave=!1),this.initUi()},i.prototype.changeBossStateVisible=function(){switch(this.bossState){case e.BOSSFIGHTSTATE.APPEARBOSS:this.appearImg.visible=!0,this.deadImg.visible=!1,this.escapeImg.visible=!1;break;case e.BOSSFIGHTSTATE.ESCAPEBOSS:this.appearImg.visible=!1,this.deadImg.visible=!1,this.escapeImg.visible=!0;break;case e.BOSSFIGHTSTATE.DEADBOSS:this.appearImg.visible=!1,this.deadImg.visible=!0,this.escapeImg.visible=!1}},i.prototype.initUi=function(){this.changeBossStateVisible();var t=e.JsonDataManager.instance.mapTemplate,i=t[this.mapId];this.dropPreview=i.dropPreview;var n=i.extraCost;this.eliteItemNum=n.value;var o=i.bossId;this.changeBossIcon(o),this.itemId=n.id,this.haveItemNum=0,this.changeBuyNum();for(var a=1;3>=a;++a){var s=this.dropPreview[a-1],r=s.id,l=this["itemIcon"+a];l.setItem(r)}this.bossName.text=i.name,this.bossLevel.text=i.monsterLevelRange.toString();var h=i.limitLevel;this.holderName.text=this.ownerName,e.PlayerService.instance.playerInfo.getLevel()<h?(this.bossMapLevel.visible=!0,this.bossMapLevel.text=e.LanguageUtils.instance.getValue("JIJIKAIQI",h),this.fightBtn.visible=!1,this.reborn1.visible=!1,this.reborn2.visible=!1):this.bossState!=e.BOSSFIGHTSTATE.APPEARBOSS?(this.reborn1.visible=!0,this.reborn2.visible=!0,this.fightBtn.visible=!1,this.bossMapLevel.visible=!1):this.fightBtnShow()},i.prototype.changeBuyNum=function(){var t=e.BagController.getInstance().getItemInfoByItemId(this.itemId);t&&(this.haveItemNum=t.getCount(),this.haveItemNum<0&&(this.haveItemNum=0));var i;i=this.haveItemNum>=this.eliteItemNum?2227971:16711680;var n=[{text:"",style:{textColor:16777215}},{text:this.haveItemNum+"",style:{textColor:i}},{text:"/"+this.eliteItemNum,style:{textColor:16777215}}];this.needItemNum.textFlow=n},i.prototype.timerFunc=function(){var e=Math.floor(this.refMiliSecond/1e3/3600),t=0,i=0;e>0?t=Math.floor((this.refMiliSecond-3600*e*1e3)/1e3/60):(e=0,t=Math.floor(this.refMiliSecond/1e3/60)),i=t>0?Math.floor((this.refMiliSecond-3600*e*1e3-60*t*1e3)/1e3):Math.floor(this.refMiliSecond/1e3),this.reborn2.text=(10>e?"0"+e:e)+":"+(10>t?"0"+t:t)+":"+(10>i?"0"+i:i),this.refMiliSecond-=1e3,this.refMiliSecond<=0&&(this.bossState=1,this.fightBtnShow())},i.prototype.changeBossIcon=function(t){var i=e.JsonDataManager.instance.monster,n=i[t],o=this.getBossIcon("bossIcon");o.source=n.iconPath},i.prototype.fightBtnShow=function(){this.bossMapLevel.visible=!1,1==this.bossState&&(this.ownHave||this.haveItemNum>=this.eliteItemNum),this.fightBtn.visible=!0,this.reborn1.visible=!1,this.reborn2.visible=!1,this.changeBossStateVisible()},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)
},i.prototype.dispose=function(){this.fightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.btnClick=function(t){switch(t.target){case this.fightBtn:if(1==this.bossState){if(this.ownHave)return void e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_ELITE);this.haveItemNum>=this.eliteItemNum?e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_ELITE):e.ShopMainControler.getInstance().showBuyItemPanel(this.itemId)}break;case this.descLabel:var i=new Object;i.mapId=this.mapId,i.mapType=1,i.timeR=this.timeR,e.NewBossControler.getIntance().showDetailPanel(i);break;case this.buyBtn:e.ShopMainControler.getInstance().showBuyItemPanel(this.itemId);break;case this.itemIcon1:this.showIconTips(0);break;case this.itemIcon2:this.showIconTips(1);break;case this.itemIcon3:this.showIconTips(2)}},i.prototype.showIconTips=function(t){var i=this.dropPreview[t],n=i.id;i.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:n}):i.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(n)},i.prototype.recvMsg=function(e,t){},i.prototype.getBossIcon=function(e){return this[e]},i}(e.ItemRenderer1);e.NewBossEliteItemRender=t,__reflect(t.prototype,"foxgame.NewBossEliteItemRender",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.goToOpen=0,e.skinName="LootBossFamilyItem",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.boo,n=e.layer,o=e.i,a=e.str;i&&n==o+1&&this.readyToOpen(n),this.setBossHomeItem(a,o+1)},i.prototype.setBossHomeItem=function(t,i){for(var n=t.split("|"),o="",a=n.length,s=0;a>s;s++)o+=n[s]+"\n\r";this.bossHomeLabel.textFlow=(new egret.HtmlTextParser).parser(o),this.bossHomeLayerLabel.text=i.toString();var r="",l="",h="";switch(i){case 1:l="Home_oneScence_png",h="HomeVIP14_png",r="BOSSZHIJIAYICHENG_REWARD";break;case 2:l="Home_twoScence_png",h="HomeVIP15_png",r="BOSSZHIJIAERCHENG_REWARD";break;case 3:l="Home_threeScence_png",h="HomeVIP16_png",r="BOSSZHIJIASANCHENG_REWARD"}this.bossHomeImg.source=l,this.vipImg.source=h;var c=e.GlobalConfig.instance.getValue(r),u=c.split(",");this.awardVOArr=[],a=u.length;for(var p=0;a>p;p++){var g=new e.AttributeVO(u[p]),d=this["itemCell"+p];d.setItem(g.id,g.value,!0,!0),d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.awardVOArr.push(g)}},i.prototype.onClick=function(e){switch(e.target){case this.itemCell0:this.showIconTips(0);break;case this.itemCell1:this.showIconTips(1);break;case this.itemCell2:this.showIconTips(2);break;case this.itemCell3:this.showIconTips(3);break;case this.itemCell4:this.showIconTips(4)}},i.prototype.showIconTips=function(t){var i=this.awardVOArr[t],n=i.id;i.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:n}):i.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(n)},i.prototype.readyToOpen=function(e){this.goToOpen=e},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.jumpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.goToOpen>0&&e.NewBossHomeMainControler.getIntance().showPanel(this.goToOpen)},i.prototype.close=function(){},i.prototype.dispose=function(){this.jumpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.parent.removeChild(this)},i.prototype.clickBtn=function(t){var i=e.NewBossMainControler.getIntance().canChallenge;if(i)return void e.GameUtils.MSG_TIP("今日挑战次数已用尽！");var n=parseInt(this.bossHomeLayerLabel.text);e.NewBossHomeMainControler.getIntance().showPanel(n)},i}(eui.ItemRenderer);e.NewBossHomeItemRender=t,__reflect(t.prototype,"foxgame.NewBossHomeItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.APPEARBOSS=1]="APPEARBOSS",e[e.ESCAPEBOSS=2]="ESCAPEBOSS",e[e.DEADBOSS=3]="DEADBOSS"}(t=e.BOSSFIGHTSTATE||(e.BOSSFIGHTSTATE={}));var i=function(i){function n(){var e=i.call(this,!0)||this;return e.refMiliSecond=0,e.lastTime=1e3,e.curIndexType=-1,e.skinName="LootBossPersonalBossItem",e}return __extends(n,i),n.prototype.tickHook=function(t){var i=t-this.lastTime;1e3>i||0==this.refMiliSecond||(this.lastTime=t,this.refMiliSecond=e.NewBossControler.getIntance().getOverTime(this.data.id),this.flushTime())},n.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var e=this.data;this.lastTime=this.getcurTime(),this.setItemRender(e.id,e.mapId,e.mapGroupType,e.state,e.refMiliSecond,e.name,e.freeJoin,e.timeR)},n.prototype.setItemRender=function(t,i,n,o,a,s,r,l){this.descLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("XIANGXIJIANGLI")),this.id=t,this.mapId=i,this.mapItemType=n,this.bossState=o,this.refMiliSecond=a,this.timeR=l,s?this.ownerName=s:this.ownerName=e.LanguageUtils.instance.getValue("WU"),this.freeJoin=r,this.initUi(),this.flushTime(),this.bossState>1&&(this.bossMapLevel.visible=!1,this.fightBtn.visible=!1,this.flushTimeLabel1.visible=!0,this.flushTimeLabel2.visible=!0),this.mapItemType==e.BossRequestFight.BOSS_WILD},n.prototype.flushTime=function(){var e=Math.floor(this.refMiliSecond/1e3/3600),t=0,i=0;e>0?t=Math.floor((this.refMiliSecond-3600*e*1e3)/1e3/60):(e=0,t=Math.floor(this.refMiliSecond/1e3/60)),i=t>0?Math.floor((this.refMiliSecond-3600*e*1e3-60*t*1e3)/1e3):Math.floor(this.refMiliSecond/1e3),this.flushTimeLabel2.text=(10>e?"0"+e:e)+":"+(10>t?"0"+t:t)+":"+(10>i?"0"+i:i),this.refMiliSecond-=1e3,this.refMiliSecond<=0&&this.fightBtnShow()},n.prototype.fightBtnShow=function(){this.bossMapLevel.visible=!1,this.fightBtn.visible=!0,this.mapItemType==e.BossRequestFight.BOSS_WILD&&e.NewBossMainControler.getIntance().cdMiliSecond<=0&&1==this.bossState||e.NewBossMainControler.getIntance().cdMiliSecond<=0&&this.freeJoin&&1==this.bossState,this.flushTimeLabel1.visible=!1,this.flushTimeLabel2.visible=!1},n.prototype.initUi=function(){switch(this.bossState){case t.APPEARBOSS:this.appearImg.visible=!0,this.deadImg.visible=!1,this.escapeImg.visible=!1;break;case t.ESCAPEBOSS:this.appearImg.visible=!1,this.deadImg.visible=!1,this.escapeImg.visible=!0;break;case t.DEADBOSS:this.appearImg.visible=!1,this.deadImg.visible=!0,this.escapeImg.visible=!1}var i=e.JsonDataManager.instance.mapTemplate,n=i[this.mapId];this.dropPreview=n.dropPreview;var o=n.extraCost.id;this.spendItemNum=0;var a=n.bossId;this.changeBossIcon(a);var s=e.BagController.getInstance().getItemInfoByItemId(o);s&&(this.spendItemNum=s.getCount());for(var r=1;3>=r;++r){var l=this.dropPreview[r-1],h=l.id,c=this["itemIcon"+r];c.setItem(h)}this.bossName.text=n.name,this.bossLevel.text=n.monsterLevelRange.toString();var u=n.limitLevel;switch(this.holderName.text=this.ownerName,this.curIndexType=-1,this.mapItemType){case e.BossRequestFight.BOSS_HOME_LAYER_1:this.curIndexType=0;break;case e.BossRequestFight.BOSS_HOME_LAYER_2:this.curIndexType=1;break;case e.BossRequestFight.BOSS_HOME_LAYER_3:this.curIndexType=2}e.PlayerService.instance.playerInfo.getLevel()<u?(this.bossMapLevel.visible=!0,this.bossMapLevel.text=e.LanguageUtils.instance.getValue("JIJIKAIQI",u),this.fightBtn.visible=!1,this.mapItemType==e.BossRequestFight.BOSS_WILD,this.flushTimeLabel1.visible=!1,this.flushTimeLabel2.visible=!1):this.bossState!=t.APPEARBOSS?(this.flushTimeLabel1.visible=!0,this.flushTimeLabel2.visible=!0,this.fightBtn.visible=!1,this.mapItemType==e.BossRequestFight.BOSS_WILD,this.bossMapLevel.visible=!1):this.fightBtnShow()},n.prototype.changeBossIcon=function(t){var i=e.JsonDataManager.instance.monster,n=i[t],o=this.getBossIcon("bossIcon");o.source=n.iconPath},n.prototype.timerFunc=function(e){this.flushTime()},n.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},n.prototype.dispose=function(){this.fightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.parent.removeChild(this)},n.prototype.btnClick=function(t){switch(t.target){case this.fightBtn:var i=e.NewBossMainControler.getIntance().canChallenge;if(i)return void e.GameUtils.MSG_TIP("今日挑战次数已用尽！");if(1==this.bossState){var n=0;if(e.PopUpManager.instance.getWindow(e.WindowName.BOSS_MAIN)){var o=e.NewBossMainControler.getIntance();n=o.cdMiliSecond}if(e.NewBossMainControler.getIntance().getIsShow()){var o=e.NewBossMainControler.getIntance();n=o.cdMiliSecond}if(n>0)e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BOSSRESTNOTICE"));else switch(this.mapItemType){case e.BossRequestFight.BOSS_HOME_LAYER_1:this.freeJoin?e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_1):this.showTips();break;case e.BossRequestFight.BOSS_HOME_LAYER_2:this.freeJoin?e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_2):this.showTips2();break;case e.BossRequestFight.BOSS_HOME_LAYER_3:this.freeJoin?e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_3):this.showTips3();break;default:e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,this.mapItemType)}}break;case this.descLabel:var a=new Object;a.mapId=this.mapId,a.mapType=0,a.timeR=this.timeR,e.NewBossControler.getIntance().showDetailPanel(a);break;case this.itemIcon1:var s=this.dropPreview[0],r=s.id;s.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:r}):s.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(r);break;case this.itemIcon2:var s=this.dropPreview[1],r=s.id;s.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:r}):s.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(r);break;case this.itemIcon3:var s=this.dropPreview[2],r=s.id;s.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:r}):s.type==e.AttributeType.ITEM&&e.TipsController.getInstance().showItemTips(r)}},n.prototype.showTips=function(){var t=e.LanguageUtils.instance.getValue("XIAOHAOYICENGTIAOZHANLING");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItem)},n.prototype.showTips2=function(){var t=e.LanguageUtils.instance.getValue("XIAOHAOERCENGTIAOZHANLING");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItem2)},n.prototype.showTips3=function(){var t=e.LanguageUtils.instance.getValue("XIAOHAOSANCENGTIAOZHANLING");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItem3)},n.prototype.getBossIcon=function(e){return this[e]},n.prototype.spendItem=function(){if(this.spendItemNum>=1)e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_1);else{var t=e.LanguageUtils.instance.getValue("YICENGTONGXINGLINGBUZU");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItemVip)}},n.prototype.spendItem2=function(){if(this.spendItemNum>=1)e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_2);else{var t=e.LanguageUtils.instance.getValue("ERCENGTONGXINGLINGBUZU");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItemVip)}},n.prototype.spendItem3=function(){if(this.spendItemNum>=1)e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_CHALLENGE,this.id,this.ownerName,e.BossRequestFight.BOSS_HOME_LAYER_3);else{var t=e.LanguageUtils.instance.getValue("SANCENGTONGXINGLINGBUZU");e.PopUpController.getInstance().showTextPanel(t,this,this.spendItemVip)}},n.prototype.spendItemVip=function(){e.RechargeController.getInstance().showPanel()},n}(e.ItemRenderer1);e.NewBossMainItemRender=i,__reflect(i.prototype,"foxgame.NewBossMainItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,!0)||this;return e.lastTime=0,e.starNum=0,e.canT=!1,e.skinName="LootBossFieldBossItem",e}return __extends(i,t),i.prototype.tickHook=function(e){var t=e-this.lastTime;1e3>t||(this.lastTime=e,this.flushTime())},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;null!=e.starNum&&(this.starNum=e.starNum),this.saodangBtn.visible=!1,this.setItemRender(e.mapId,e.mapName,e.monsterLevelRange,e.surplusNum)},i.prototype.setItemRender=function(e,t,i,n){this.mapId=e,this.bossName.text=t,this.bossLevel.text=i.toString(),this.descLabel.textFlow=(new egret.HtmlTextParser).parser("<font><u>详细奖励</u></font>"),this.initUi(n)},i.prototype.initUi=function(t){var i=e.JsonDataManager.instance.mapTemplate,n=i[this.mapId];this.dropPreview=n.dropPreview;for(var o=1;3>=o;++o){var a=this.dropPreview[o-1],s=a.id,r=this["itemIcon"+o];r.setItem(s)}var l=n.limitLevel,h=n.bossId;this.changeBossIcon(h),1==t?(this.deadImg.visible=!0,this.reborn1.visible=!0,this.reborn2.visible=!0,this.bossMapLevel.visible=!1,this.fightBtn.visible=!1,this.appearImg.visible=!1,this.saodangBtn.visible=!1,this.surplusCount.text="0"+e.LanguageUtils.instance.getValue("CI"),this.surplusCount.textColor=16711680,this.flushTime()):(e.PlayerService.instance.playerInfo.getLevel()<l?(this.bossMapLevel.visible=!0,this.bossMapLevel.text=e.LanguageUtils.instance.getValue("JIJIKAIQI",l),this.fightBtn.visible=!1,this.saodangBtn.visible=!1,this.reborn1.visible=!1,this.reborn2.visible=!1):(this.bossMapLevel.visible=!1,this.starNum>0?(this.fightBtn.visible=!1,this.saodangBtn.visible=!0):(this.fightBtn.visible=!0,this.saodangBtn.visible=!1),this.reborn1.visible=!1,this.reborn2.visible=!1),this.surplusCount.text="1"+e.LanguageUtils.instance.getValue("CI"),this.surplusCount.textColor=65280,this.deadImg.visible=!1,this.appearImg.visible=!0)},i.prototype.changeBossIcon=function(t){var i=e.JsonDataManager.instance.monster,n=i[t],o=this.getBossIcon("bossIcon");o.source=n.iconPath},i.prototype.flushTime=function(){var e=new Date,t=23-e.getHours(),i=59-e.getMinutes(),n=60-e.getSeconds();this.reborn2.text=(10>t?"0"+t:t)+":"+(10>i?"0"+i:i)+":"+(10>n?"0"+n:n)},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.saodangBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.fightBtn.visible&&28==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.fightBtn,this.fightBtn.parent.parent,28,2,!0)},i.prototype.dispose=function(){this.fightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.saodangBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.descLabel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.checkBag=function(){return!0},i.prototype.CanSaodang=function(e){this.canT=!0},i.prototype.btnClick=function(t){switch(t.target){case this.fightBtn:this.checkBag?e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BOSS_PLUNDER_SINGLE,this.mapId,null,e.BossRequestFight.DAILY_COPY):e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT);break;case this.saodangBtn:if(this.checkBag){if(e.BagController.getInstance().checkBagEnough(this,this.CanSaodang,null,2),!this.canT)return;e.RequestFightManager.instance.setRequestFightType(e.BattleType.BOSS_PLUNDER_SINGLE);var i=HawkProtocolManager.newBuilder("JsProto.HPBossWipe");i.setMapId(this.mapId),i.setBattleType(18),e.Message.instance.send(e.Code.BOSS_WIPE_C,i,!0)}else e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT);break;case this.descLabel:var n=new Object;n.mapId=this.mapId,n.mapType=0,n.timeR=0,e.NewBossControler.getIntance().showDetailPanel(n);break;case this.itemIcon1:var o=this.dropPreview[0],a=o.id;e.TipsController.getInstance().showEquipTips({equipId:a});break;case this.itemIcon2:var o=this.dropPreview[1],a=o.id;e.TipsController.getInstance().showEquipTips({equipId:a});break;case this.itemIcon3:var o=this.dropPreview[2],a=o.id;e.TipsController.getInstance().showEquipTips({equipId:a})}},i.prototype.getBossIcon=function(e){return this[e]},i}(e.ItemRenderer1);e.NewBossPersonItemRender=t,__reflect(t.prototype,"foxgame.NewBossPersonItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.list=[],i.listItem=[],i.gap=25,i.columnNum=4,i.equips=[],i.detailEquip=[],i.item=[],i.iCount=0,i.skinName="BossResultFightWin",e.PopUpManager.instance.registerWindow(e.WindowName.FIGHTBOSSRESULTWIN,i,i),i.mytimer=new egret.Timer(1e3,0),i.initListener(),i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.init=function(){this.fightResultScroller.viewport.scrollV=0,this.iCount=3,this.list=[],this.listItem=[],this.countDownFont.text=this.iCount.toString(),this.contentGroup.removeChildren();var t=this.detailEquip.length;if(t>0)for(var i=0;t>i;++i){var n=e.JsonDataManager.instance.equipTemplate,o=n[this.detailEquip[i].getItemId()],a=o.id;this.list.push(a)}t=this.item.length;for(var i=0;t>i;++i){var s=new Object;s.id=this.item[i].getItemId(),s.num=this.item[i].getItemCount(),this.listItem.push(s)}var r,l;t=this.listItem.length;for(var i=0;t>i;i++)r=new e.ItemIcon,r.setItem(this.listItem[i].id,this.listItem[i].num),l=this.getIconPos(r.width,this.list.length+i),r.x=l.x,r.y=l.y+20,this.contentGroup.addChild(r);t=this.list.length;for(var i=0;t>i;i++)r=new e.ItemIcon,r.setItem(this.list[i]),l=this.getIconPos(r.width,i),r.x=l.x,r.y=l.y+20,this.contentGroup.addChild(r);var h=this.contentGroup.numChildren%this.columnNum>0?Math.floor(this.contentGroup.numChildren/this.columnNum)+1:this.contentGroup.numChildren/this.columnNum;this.contentGroup.height=h*r.height+(h-1)*this.gap+40,this.mytimer.start()},i.prototype.getIconPos=function(e,t){var i=new egret.Point,n=Math.floor(t/this.columnNum),o=t%this.columnNum;return i.x=o*(e+this.gap),i.y=n*(e+this.gap),i},i.prototype.initListener=function(){this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.mytimer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this)},i.prototype.clickBtn=function(e){switch(e.target){case this.sureBtn:this.close()}},i.prototype.show=function(t){void 0===t&&(t=null);t.awards;this.mapID=t.mapId,t.saodang?(this.detailEquip=t.awards.getDrop().getDetailEquip(),this.item=t.awards.getDrop().getItem()):(this.detailEquip=t.awards.getDrop().getDetailEquip(),this.item=t.awards.getDrop().getItem()),this.init(),this.initListener(),e.PopUpManager.instance.addPopUp(e.WindowName.FIGHTBOSSRESULTWIN,e.WindowName.UILAYER,5,!0)},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.FIGHTBOSSRESULTWIN),this.mytimer.stop(),this.contentGroup.removeChildren();var t=e.RequestFightManager.instance.getRequestFightType();if(t==e.BattleType.BOSS_PLUNDER_SINGLE||t==e.BattleType.BATTLE_CHALLENGE){var i=e.BattleService.instance.getCurrentChallengeType(),n=new Object;i>0?(n.fbType=i,e.NewBossMainControler.getIntance().showPanel(n)):e.NewBossMainControler.getIntance().showPanel()}else e.FuBenController.getInstance().showPanel(e.EquipDungenManager.instance.getFightType())},i.prototype.clear=function(){this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.mytimer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this)},i.prototype.timerFunc=function(e){this.iCount--,this.countDownFont.text=this.iCount.toString(),this.iCount<0&&this.close()},i.prototype.dispose=function(){},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.fightResultScroller.verticalScrollBar.autoVisibility=!1},i}(e.ViewControler);e.BossFightResultWin=t,__reflect(t.prototype,"foxgame.BossFightResultWin")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.ChangeEquipModel,this.panel=new e.ChangeEquipPanel(this.model)}return t.prototype.showPanel=function(e,t,i){void 0===i&&(i=null),this.model.setInfo(e,t,i),this.panel.show()},t.prototype.sendPutOnEquip=function(t){var i=e.JsonDataManager.instance.equipTemplate,n=(i[t.getEquipId()],HawkProtocolManager.newBuilder("JsProto.HPEquipDress"));n.setEquipId(t.getId()),n.setRoleId(this.model.roleId),n.setPart(this.model.part),e.Message.instance.send(e.Code.EQUIP_DRESS_C,n,!0),this.panel.close()},t.prototype.getEquipedScore=function(){return this.model.equipInfo?this.model.equipInfo.getScore():-1},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t}();e.ChangeEquipController=t,__reflect(t.prototype,"foxgame.ChangeEquipController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.init=function(){this.skinName="ChangeEquipItemSkin",this.baseLabelList=[this.baseLabel1,this.baseLabel2,this.baseLabel3,this.baseLabel4],this.jipinLabelList=[this.jipinLabel1,this.jipinLabel2,this.jipinLabel3,this.jipinLabel4],this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBtnClickHandler,this),this.checkBoxBtn.visible=!1},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.info=this.data,this.refresh(this.info,!0,!1,0==this.itemIndex,i.type)},i.prototype.refresh=function(t,i,n,o,a){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===a&&(a=1),this.selectBtn.visible=i,this.itemType=a,this.equipInfo=t;var s=e.JsonDataManager.instance.equipTemplate,r=s[this.equipInfo.getEquipId()],l=this.tempGodlyEquip()[r.id];this.item.setItem(r.id),this.item.setQueneLevelProps(t.getId()),this.nameLabel.text=r.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(r.quality),this.recommendImg.visible=o,o&&(null!=l?this.recommendImg.visible=l.getScore()>e.GodlyEquipController.getInstance().getEquipedScore():this.recommendImg.visible=this.equipInfo.getScore()>e.ChangeEquipController.getInstance().getEquipedScore()),null!=l?this.scoreLabel.text=l.getScore().toString():this.scoreLabel.text=this.equipInfo.getScore().toString(),this.equipedImg.visible=n,this.refreshAttrs(1,this.baseLabelList);var h=this.refreshAttrs(2,this.jipinLabelList);h?(this.jipinGroup.visible=!0,this.baseGroup.y=0):(this.jipinGroup.visible=!1,this.baseGroup.y=this.labelGroup.height-this.baseGroup.height>>1),App.GuideUtils().currPart==e.GuidePart.currPart1&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.selectBtn,this,e.GuidePart.currPart1,2),38==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&o&&e.MainControler.instance.guidechange(this.selectBtn,this.selectBtn.parent,38,3,!0)},i.prototype.refreshAttrs=function(t,i){for(var n,o=this.equipInfo.getAttrInfos(),a=[],s=0;s<o.length;s++)n=o[s],n.getAttrGrade()==e.equipAttrGrade.PRIMARY_ATTR&&1==t?a.push(n):n.getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&2==t&&a.push(n);for(var r,l,h,c,u=2==t&&a.length>0,p=i.length,s=0;p>s;s++)r=i[s],n=a[s],n?(l=n.getAttrData(),c=e.ColorUtils.instance.getAttrColorById(l.getAttrId()),h=e.LanguageUtils.instance.getValue("ATT_"+l.getAttrId())+":",r.text=h+e.GlobalUtil.getAttrValueStr(l.getAttrId(),l.getAttrValue()),0!=l.getAdditionValue()&&(r.text+="+"+l.getAdditionValue()),r.textColor=c,r.visible=!0):r.visible=!1;return u},i.prototype.selectBtnClickHandler=function(t){e.CharacterController.getInstance().guideshow(),1==this.itemType?e.ChangeEquipController.getInstance().sendPutOnEquip(this.equipInfo):2==this.itemType&&(e.GodlyEquipController.getInstance().closeChoosePanel(),e.GodlyEquipController.getInstance().addUpgradeItem(this.equipInfo.getId()))},i.prototype.getselectBtn=function(){return this.selectBtn},i.prototype.tempGodlyEquip=function(){return e.JsonDataManager.instance.godlyEquipTemplate},i.type=1,i}(eui.ItemRenderer);e.ChangeEquipItem=t,__reflect(t.prototype,"foxgame.ChangeEquipItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.setInfo=function(e,t,i){this.roleId=e,this.part=t,this.equipInfo=i},e}();e.ChangeEquipModel=t,__reflect(t.prototype,"foxgame.ChangeEquipModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/character/ChangeEquipPanelSkin.exml")||this;return i.minShowNum=3,i.maxShowNum=4,i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.itemHeight=this.ui.itemEquiped.height,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.doScreenAdaptation();var t=this.ui.list;this.collection=new eui.ArrayCollection,t.dataProvider=this.collection,t.itemRenderer=e.ChangeEquipItem},i.prototype.refresh=function(){var t=e.PlayerService.instance.getRoleDataByRoleId(this.model.roleId);e.JsonDataManager.instance.equipTemplate;this.allEquipInfoList=e.BagController.getInstance().getEquipInfosByProfAndPart(t.profession,this.model.part),e.ChangeEquipItem.type=1,this.collection.replaceAll(this.allEquipInfoList);var i=this.ui.itemEquiped,n=this.ui.scroller;this.model.equipInfo?(i.refresh(this.model.equipInfo,!1,!0),i.visible=!0,n.height=this.itemHeight*this.minShowNum,n.y=i.y+i.height):(i.visible=!1,n.height=this.itemHeight*this.maxShowNum,n.y=i.y),n.viewport.scrollV=0},i.prototype.close=function(){t.prototype.close.call(this)},i}(e.BasePanel);e.ChangeEquipPanel=t,__reflect(t.prototype,"foxgame.ChangeEquipPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.CharacterModel,this.panel=new e.CharacterPanel(this.model),this.totalpanel=new e.Latestfashiontips(this.model),this.specialRingPanel=new e.SpecialRingPanel,this.specialRingUpgradePanel=new e.SpecialRingUpgradePanel}return t.prototype.showPanel=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=!0),void 0===n&&(n=!1),this.panel.showPanel(e,t,i,n)},t.prototype.registerMsg=function(t){t.add(e.Code.FASHION_ROLE_INFO_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.FASHION_ROLE_INFO_S:var n=i;this.model.fashiondataAll=n.getRoleFashionInfo()}},t.prototype.getpointred_fashion=function(){if(this.model&&this.model.fashiondataAll){for(var t=this.model.fashiondataAll.length,i=0;t>i;i++){var n=this.model.fashiondataAll[i],o=this.fashiondata_All(n);for(var a in o){var s=o[a],r=s.cost.id,l=Number(s.cost.value),h=e.BagController.getInstance().getCountByItemId(parseInt(r));if(Number(s.level)<Number(e.GlobalConfig.instance.getValue("FASHION_MAX_LEVEL"))&&Number(h)>=l)return!0}}return!1}},t.prototype.fashiondata_All=function(e){var t=new Object(this.getfashiondata()),i=new Object(this.fashiondata_zero()),n=new Array,o=e.getTypeInfo();for(var a in t){var s=new Object(t[a]);s.wearState=!1;for(var r=0;r<o.length;r++){var l=new Object(o[r]);Number(s.equipId)==l.fashionId&&s.level==l.fashionLevel&&(s.wearState=l.wearState,n.push(s))}}var h=new Object(i);for(var c in h){h[c].activate=!0;for(var u=0;u<n.length;u++){var p=new Object(n[u]);h[c].equipId==Number(p.equipId)&&(h[c]=p,h[c].activate=!1)}}return h},t.prototype.getfashiondata=function(){var t=new Object(e.JsonDataManager.instance.fashionTemplate);return t},t.prototype.fashiondata_zero=function(){var e=new Object(this.getfashiondata()),t=new Object;for(var i in e){var n=new Object(e[i]);1==Number(n.level)&&(t[n.equipId]=n)}return t},t.prototype.totalAttrPanelshow=function(){this.totalpanel.show()},t.prototype.guideshow=function(){this.panel.zguideshow()},t.prototype.closePanel=function(){this.panel.close()},t.prototype.getPanel=function(){return this.panel},t.prototype.getRedEquipLevelAndCount=function(){return this.model.getRedEquipLevelAndCount()},t.prototype.getCountAttString=function(e,t){return void 0===t&&(t=0),this.model.getCountAttString(e,t)},t.prototype.getModel=function(){return this.model},t.prototype.showcharavatar=function(t,i,n){void 0===n&&(n=!0);var o,a=i.getRoleEquipByPart(e.EquipPartType.CLOTHES);o=null!=a?a.getEquipItemId():-1;var s,r=i.getRoleEquipByPart(e.EquipPartType.WEAPON);s=null!=r?r.getEquipItemId():-1;var l;l=i.wingId;var h,c=i.roleInfo;h=n&&c.getWardState()?c.getWardLevel():-1;var u=c.getDragonArmourShowGuard()?c.getDragonArmourGuardLevel():-1;t.setAvatar(i.itemId,o,s,l,Number(c.getFashionClothesId()),Number(c.getFashionWeaponId()),Number(c.getFashionWingId()),u,h)},t.prototype.checkOperate=function(t){void 0===t&&(t=e.RedPointId.FUNC_MOST_MAINLY);var i;return i=this.checkRoleOperate(),i?!0:!1},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.checkRoleOperate=function(t){void 0===t&&(t=e.RedPointId.FUNC_MOST_MAINLY);for(var i,n=3,o=0;n>o;o++)if(i=this.checkSingleRoleOpenOperate(o))return!0;return!1},t.prototype.checkSingleRoleOpenOperate=function(i,n){void 0===n&&(n=e.RedPointId.FUNC_MOST_MAINLY);var o,a,s,r=e.PlayerService.instance,l=r.getRoleDataList(),h=(l.length,r.playerInfo.getLevel()),c=r.vipLevel,u=t.getInstance();if(o=l[i],null==o){if(1==i?(a=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV1")),s=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV1"))):(a=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV2")),s=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV2"))),h>=a||c>=s)return!0}else if(u.checkEquipOperate(o)||u.checkSuitEquipUpgrade(o)||u.checkRoleRingOperate(o)||u.checkGemRedPoint(o)||u.checkSkillRedPoint(o)||e.MedalController.getInstance().checkMedalRedPoint()||e.SoulController.getInstance().getEquipOrUpgrade(o)||e.GodlyEquipController.getInstance().checkOperate(o)||t.getInstance().getpointred_fashion()||e.GodHoodConttroller.getInstance().refreshRedPoint())return!0;return!1},t.prototype.checkEquipOperate=function(t){for(var i,n,o=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES,e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],a=o.length,s=0;a>s;s++)if(n=o[s],i=this.checkEquipPartOperate(t,n))return!0;return!1},t.prototype.checkEquipPartOperate=function(t,i){var n,o,a,s,r=e.BagController.getInstance();
return o=t.getEquipInfoByPart(i),n=r.getEquipInfosByProfAndPart(t.profession,i),a=n[0],s=null==a?!1:null==o?!0:a.getScore()>o.getScore()?!0:!1},t.prototype.checkSkillRedPoint=function(t){for(var i=e.PlayerService.instance.playerInfo,n=Number(i.getCoin()),o=t.roleInfo.getSkills(),a=i.getLevel(),s=o.length,r=e.JsonDataManager.instance.skillTemplate,l=0;s>l;l++){var h=o[l].getLevel();1>h&&(h=1);var c=r[o[l].getId()+"_"+h];if(n>=c.upgradeCost&&a>c.openLevel&&a>h)return!0}return!1},t.prototype.checkSuitEquipUpgrade=function(t){var i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.BAYEZHUANGBEI,!1);if(!i)return!1;for(var n,o,a,s,r=[e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],l=r.length,h=e.JsonDataManager.instance.equipmentUpgradeTemplate,c=0;l>c;c++)if(n=t.getEquipInfoByPart(r[c]),null!=n&&(o=h[n.getEquipId()],s=o.costList[0],a=e.BagController.getInstance().getCountByItemId(s.id),a>=s.value))return!0;return!1},t.prototype.checkRoleRingOperate=function(e){for(var t,i=4,n=0;i>n;n++)if(t=this.checkSingleRingOperate(e,n))return!0;return!1},t.prototype.checkSingleRingOperate=function(t,i){var n,o,a,s,r,l=t.getSpecialRingLvList(),h=e.GlobalConfig.instance.getValue("SPECIALRINGMATERIALS"),c=h.split(","),u=(Number(c[i]),e.JsonDataManager.instance.itemTemplate),p=e.JsonDataManager.instance.specialRingTemplate;return n=l[i],r=0>=n?i+1+"_1":i+1+"_"+(n+1),s=p[r],null==s?!1:(o=u[s.costId],a=e.BagController.getInstance().getCountByItemId(s.costId),a>=s.costNum)},t.prototype.checkGemRedPoint=function(t){var i=5;if(void 0==t.getRoleEquipCellInfo())return!1;for(var n=t.getRoleEquipCellInfo().getCellInfos(),o=n.length,a=this.model.gemModuleShowRPAry=[],s=0;o>s;s++)for(var r=s+1,l=n[s],h=l.getGemInfo(),c=e.JsonDataManager.instance.partStoneTemplate[r],u=e.JsonDataManager.instance.itemTemplate,p=u[c.stone1Id],g=u[c.stone2Id],d=u[c.stone3Id],f=u[c.stone4Id],m=[p,g,d,f],y=e.JsonDataManager.instance.partStoneAttTemplate,I=0;I<m.length;I++){var v=y[r+"_"+(I+1)+"_"+(h[I].getLevel()+1)];if(void 0!=v){var _=v.costAttribute.value,T=e.BagController.getInstance().getCountByItemId(m[I].id);T>=_&&(1==h[I].getPos()||h[I-1]&&h[I-1].getLevel()>=i)&&-1==a.indexOf(s)&&a.push(s)}}return a.length>0?!0:!1},t.prototype.getGemModuleShowRPAry=function(){return this.checkGemRedPoint(this.model.roleData),this.model.gemModuleShowRPAry},t.prototype.showSpecialRingPanel=function(e,t,i,n){void 0===n&&(n=!0),this.specialRingPanel.showPanel(e,t,i,n)},t.prototype.showSpecialRingUpgradePanel=function(e,t){this.specialRingUpgradePanel.showPanel(e,t)},t.prototype.isPanelShow=function(){return this.panel.getIsShow()},t}();e.CharacterController=t,__reflect(t.prototype,"foxgame.CharacterController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="CharacterDetailViewSkin",this.labelList=[this.attrLabel1,this.attrLabel2,this.attrLabel3,this.attrLabel4,this.attrLabel5,this.attrLabel6,this.attrLabel7,this.attrLabel8,this.attrLabel9,this.attrLabel10,this.attrLabel11,this.attrLabel12,this.attrLabel14,this.attrLabel15,this.attrLabel20,this.attrLabel21,this.attrLabel13,this.attrLabel16,this.attrLabel17,this.attrLabel18,this.attrLabel19,this.attrLabel26],this.attrTypeList=[1,2,3,4,5,6,7,8,9,10,11,12,14,15,20,21,13,16,17,18,19,26]},i.prototype.refresh=function(t){for(var i,n,o,a=this.attrTypeList.length,s=0;a>s;s++)i=this.attrTypeList[s],o=this.labelList[s],n=this.getValue(t,i),o.text=e.GlobalUtil.getAttrValueStr(i,n)},i.prototype.getValue=function(e,t){for(var i,n=e.length,o=0;n>o;o++)if(i=e[o],t==i.getAttrId())return i.getAttrValue();return 0},i}(eui.Component);e.CharacterDetailView=t,__reflect(t.prototype,"foxgame.CharacterDetailView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.isInit=!1,n.bNeedReBuild=!1,n.isAvatarPlay=!1,n.count=0,n.model=e.CharacterController.getInstance().getModel(),n.mainPanel=i,n.init(),n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.refresh()},i.prototype.init=function(){if(!this.isInit){this.isInit=!0,this.skinName="CharacterEquipViewSkin",this.labelDetail.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabClickHandler,this),this.btnChangeEquip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.quickEquipHandler,this),this.btnJueWei.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabClickHandler,this),this.btnGem.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabClickHandler,this),this.btnSkill.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabClickHandler,this),this.btnSoul.addEventListener(egret.TouchEvent.TOUCH_TAP,this.souleClickHandler,this),this.godhoodBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.godhoodBtnClickHandler,this),this.btnGodly.addEventListener(egret.TouchEvent.TOUCH_TAP,this.godlyClickHandler,this),this.suitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.suitClickHandler,this),this.medalBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.medalClickHandler,this),this.btnGongMing.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGongMing,this),this.btnzhuangban.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabClickHandler,this),e.Message.instance.add(e.MsgCMD.UPDATE_EQUIPINFO,this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.equipItemList=[this.itemEquip1,this.itemEquip2,this.itemEquip3,this.itemEquip4,this.itemEquip5,this.itemEquip6,this.itemEquip7,this.itemEquip8,this.itemEquip9,this.itemEquip10],this.suitItemList=[this.itemSuit1,this.itemSuit2,this.itemSuit3,this.itemSuit4],this.specialRingList=[this.itemSpecialRing1,this.itemSpecialRing2,this.itemSpecialRing3,this.itemSpecialRing4];for(var t,i=0;i<this.equipItemList.length;i++)t=this.equipItemList[i],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.equipPartList=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES],this.suitPartList=[e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4];for(var i=0;i<this.suitPartList.length;i++)t=this.suitItemList[i],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);for(var i=0;i<this.specialRingList.length;i++)t=this.specialRingList[i],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.specialRingClickHandler,this);this.labelDetail.textFlow=this.labelDetail.textFlow,this.itemGodly0.visible=!1,this.itemGodly1.visible=!1,this.itemGodly2.visible=!1}},i.prototype.showGuide=function(){App.GuideUtils().currPart==e.GuidePart.currPart1&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.itemEquip1,this,e.GuidePart.currPart1,1),App.GuideUtils().currPart==e.GuidePart.currPart7&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.btnChangeEquip,this,e.GuidePart.currPart7,1),32==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.btnGem,this.btnGem.parent,32,7,!0),35==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.itemSpecialRing1,this.itemSpecialRing1.parent,35,7,!0),38==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.itemSuit1,this.itemSuit1.parent,38,2,!0),39==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.btnSoul,this.btnSoul.parent,39,2,!0),40==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.btnGodly,this.btnGodly.parent,40,2,!0),46==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.godhoodBtn,this.godhoodBtn.parent,46,2,!0)},i.prototype.guidebayezhuangbei=function(){38==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.suitBtn,this.suitBtn.parent,38,4,!0)},i.prototype.avatarToBig=function(){egret.Tween.get(this.avatar).wait(350).to({scaleX:1.03,scaleY:1.04},1e3).wait(150).call(this.avatarToSmall,this,null)},i.prototype.avatarToSmall=function(){egret.Tween.get(this.avatar).to({scaleX:1,scaleY:1},800).call(this.avatarToBig,this,null)},i.prototype.refresh=function(){if(this.showGuide(),0!=this.isInit&&null!=this.model.roleData&&this.parent&&this.visible){e.CharacterController.getInstance().showcharavatar(this.avatar,this.model.roleData),0==this.isAvatarPlay&&(this.isAvatarPlay=!0,this.avatarToBig());for(var t,i,n,o,a,s,r=this.model.roleData.getRoleEquipCellInfo().getCellInfos(),l=e.JsonDataManager.instance.equipTemplate,h=0;h<this.equipItemList.length;h++){if(s=this.equipPartList[h],t=this.equipItemList[h],i=e.PlayerService.instance.getEquipInfoByRoleIdAndPart(this.model.roleData.roleId,s),n=r[h],null!=i){l[i.getEquipId()];o=i.getEquipId(),a=i.getId()?i.getId():-1}else o=-1;t.setEquip(o,s,n,a)}var c=parseInt(e.GlobalConfig.instance.getValue("SUITOPENLEVEL"));e.PlayerService.instance.level>=c?(this.suitAnimation&&(this.suitAnimation.clear(),this.suitAnimation=null),null==this.suitAnimation&&(this.suitAnimation=new e.FoxAni(this.suitAnimGroup)),this.suitAnimation.play("achievementAnimation","ani",-1),this.suitAnimGroup.visible=!0):this.suitAnimGroup.visible=!1,this.gongmingAnimation&&(this.gongmingAnimation.clear(),this.gongmingAnimation=null),null==this.gongmingAnimation&&(this.gongmingAnimation=new e.FoxAni(this.gongmingAnimGroup)),this.gongmingAnimation.play("achievementAnimation","ani",-1),this.medalAni&&(this.medalAni.clear(),this.medalAni=null),null==this.medalAni&&(this.medalAni=new e.FoxAni(this.medalAniGroup)),e.MedalController.getInstance().checkMedalRedPoint()?(this.medalAniGroup.visible=!0,this.medalAni.play("achievementAnimation")):this.medalAniGroup.visible=!1;for(var h=0;h<this.suitPartList.length;h++)s=this.suitPartList[h],t=this.suitItemList[h],i=this.model.roleData.getEquipInfoByPart(s),o=null!=i?i.getEquipId():-1,t.setSuit(o,s);for(var u,p=this.model.roleData.getSpecialRingLvList(),h=0;h<p.length;h++)u=this.specialRingList[h],u.setSpecialRing(h,p[h]);this.refreshOperate(),this.count++}},i.prototype.refreshOperate=function(){this.refresEquipIconOperate(),this.refreshSuitEquipOperate(),this.suitIconRedImg.visible=e.CharacterController.getInstance().checkSuitEquipUpgrade(this.model.roleData),this.refreshSpecialRingOperate(),this.redTip1.visible=e.CharacterController.getInstance().checkGemRedPoint(this.model.roleData),this.redTip2.visible=e.CharacterController.getInstance().checkSkillRedPoint(this.model.roleData);var t=!1;(e.SoulController.getInstance().checkOperate()||e.DragonboneController.getInstance().refreshRedPoint()||e.DragonArmorController.getInstance().refreshRedPoint()||e.DragongodTreasureController.getInstance().redpoint())&&(t=!0),this.redTip3.visible=t,this.redTip4.visible=e.GodlyEquipController.getInstance().checkOperate(this.model.roleData),this.redTip5.visible=e.CharacterController.getInstance().getpointred_fashion(),this.redTip6.visible=e.GodHoodConttroller.getInstance().refreshRedPoint()},i.prototype.setredtip5=function(e){this.redTip5.visible=e},i.prototype.destoryAnis=function(){e.Message.instance.remove(e.MsgCMD.UPDATE_EQUIPINFO,this),e.Message.instance.remove(e.MsgCMD.REFRESH_PLAYERDATA,this),this.medalAni&&(this.medalAni.clear(),this.medalAni=null),this.gongmingAnimation&&(this.gongmingAnimation.clear(),this.gongmingAnimation=null),this.suitAnimation&&(this.suitAnimation.clear(),this.suitAnimation=null),this.destoryAvatarAni()},i.prototype.destoryAvatarAni=function(){this.isAvatarPlay=!1,egret.Tween.removeTweens(this.avatar)},i.prototype.recvMsg=function(t,i){var n=e.CharacterController.getInstance().getPanel().getIsShow();if(n)switch(t){case e.MsgCMD.UPDATE_EQUIPINFO:this.refresh();break;case e.MsgCMD.REFRESH_PLAYERDATA:if(i&&"fightValueChange"==i)return;this.refresh()}},i.prototype.medalClickHandler=function(){e.MedalController.getInstance().showPanel()},i.prototype.quickEquipHandler=function(t){for(var i,n,o=e.BagController.getInstance().getBestFreeEquipInfosByProfession(this.model.roleData.roleId),a=HawkProtocolManager.newBuilder("JsProto.HPEquipDressOneKey"),s=o.length,r=[],l=0;s>l;l++)n=o[l],null!=n&&(i=HawkProtocolManager.newBuilder("JsProto.HPEquipDress"),i.setRoleId(this.model.roleData.roleId),i.setEquipId(n.getId()),i.setPart(l+1),r.push(i));0!=r.length&&(App.GuideUtils().currPart==e.GuidePart.currPart7&&1==App.GuideUtils().currStep&&e.CharacterController.getInstance().guideshow(),a.setEquips(r),e.Message.instance.send(e.Code.EQUIP_DRESS_ONE_KEY_C,a,!0))},i.prototype.tabClickHandler=function(t){var i=-1;switch(t.target){case this.labelDetail:i=5;break;case this.btnJueWei:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.JUEWEI))e.NewJueweiController.getInstance().showPanel();else{var n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.JUEWEI);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("JUEWEIOPEN",n))}return;case this.btnGem:i=2;break;case this.btnSkill:i=3;break;case this.btnGodly:break;case this.btnzhuangban:i=6}this.mainPanel.tabClickHandler(i)},i.prototype.itemClickHandler=function(t){var i,n=this.equipItemList.indexOf(t.target);-1==n?(n=this.suitItemList.indexOf(t.target),i=this.suitPartList[n]):i=this.equipPartList[n];var o=this.model.roleData.getRoleEquipCellInfo().getCellInfos(),a=this.model.roleData.getEquipInfoByPart(i),s=o[i-1];a?e.TipsController.getInstance().showEquipTips({part:i,profession:this.model.roleData.profession,equipInfo:a,cellInfo:s,showReplace:!0}):e.ChangeEquipController.getInstance().showPanel(this.model.roleData.roleId,i)},i.prototype.specialRingClickHandler=function(t){var i=this.specialRingList.indexOf(t.target);({index:i,roleId:this.model.roleData.roleId,lvList:this.model.roleData.getSpecialRingLvList(),isSelf:!0});e.CharacterController.getInstance().showSpecialRingPanel(i,this.model.roleData.roleId,this.model.roleData.getSpecialRingLvList())},i.prototype.souleClickHandler=function(t){var i=parseInt(e.GlobalConfig.instance.getValue("SOUL_OPENLEVEL"));if(e.PlayerService.instance.level<i)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SOULOPEN",i));var n=e.PlayerService.instance.getRoleDataList(),o=n.indexOf(this.model.roleData);e.SoulController.getInstance().showSoulPanel(o),e.CharacterController.getInstance().closePanel()},i.prototype.godhoodBtnClickHandler=function(t){var i=e.PlayerService.instance.getRoleDataList(),n=i.indexOf(this.model.roleData);e.GodHoodConttroller.getInstance().showpanel(n)},i.prototype.suitClickHandler=function(t){var i=parseInt(e.GlobalConfig.instance.getValue("SUITOPENLEVEL"));if(e.PlayerService.instance.level<i)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SUITEQUIPOPEN",i));var n=e.PlayerService.instance.getRoleDataList(),o=n.indexOf(this.model.roleData);e.SuitEquipController.getInstance().showPanel(o),e.CharacterController.getInstance().closePanel()},i.prototype.godlyClickHandler=function(t){var i=parseInt(e.GlobalConfig.instance.getValue("GODLYEQUIP_OPENLEVEL"));if(e.PlayerService.instance.level<i)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GODLYEQUIPOPEN",i));var n=e.PlayerService.instance.getRoleDataList(),o=n.indexOf(this.model.roleData);e.GodlyEquipController.getInstance().showPanel(o),e.CharacterController.getInstance().closePanel()},i.prototype.onBtnGongMing=function(){e.GongMingController.getInstance().showPanel(this.model.roleData)},i.prototype.refresEquipIconOperate=function(){for(var t,i,n,o=this.equipItemList.length,a=(e.BagController.getInstance(),this.model.roleData),s=0;o>s;s++)i=this.equipPartList[s],t=this.equipItemList[s],n=e.CharacterController.getInstance().checkEquipPartOperate(a,i),t.setRedImgVisible(n)},i.prototype.refreshSuitEquipOperate=function(){for(var t,i,n,o=this.suitItemList.length,a=(e.BagController.getInstance(),this.model.roleData),s=0;o>s;s++)i=this.suitPartList[s],t=this.suitItemList[s],n=e.CharacterController.getInstance().checkEquipPartOperate(a,i),t.setRedImgVisible(n)},i.prototype.refreshSpecialRingOperate=function(){for(var t,i,n=this.specialRingList.length,o=0;n>o;o++)t=this.specialRingList[o],i=e.CharacterController.getInstance().checkSingleRingOperate(this.model.roleData,o),t.setRedImgVisible(i)},i.prototype.unLoadUiRes=function(){this.avatar&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.avatar,"CharacterEquipViewCharAvatar",!0,e.CharacterController.getInstance().getPanel().getUiBaseName()),this.avatar.notifyUnLoadImageRes())},i}(eui.Component);e.CharacterEquipView=t,__reflect(t.prototype,"foxgame.CharacterEquipView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.prototype.getRedEquipLevelAndCount=function(){for(var t=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES],i=t.length,n=this.roleData.roleId,o=(this.roleData.profession,0),a=0,s=e.JsonDataManager.instance.equipTemplate,r=0;i>r;r++){var l=t[r],h=e.PlayerService.instance.getEquipInfoByRoleIdAndPart(n,l);if(null!=h){var c=s[h.getEquipId()];c.quality==e.EquipQuality.RED&&(o+=c.level,a++)}}return{level:o,count:a}},t.prototype.getCountAttString=function(t,i){void 0===i&&(i=0);var n=this.roleData.profession,o="",a=n+"_"+t,s=i?e.JsonDataManager.instance.redEquip_countTemplete[a]:e.JsonDataManager.instance.redEquip_levelTemplete[a],r=s.split(","),l=e.JsonDataManager.instance.attDefTemplate;return r.forEach(function(t){var i=t.split("_"),n=i[0],a=i[1],s=l[n],r=e.LanguageUtils.instance.getValue("ATT_"+n);r+=e.GlobalUtil.getAttrValueStr(parseInt(n),parseInt(a));var h=e.ColorUtils.instance.getAttrColorById(parseInt(s.attId));o+="<font color="+h+">"+r+"</font>\n"}),(new egret.HtmlTextParser).parser(o)},t}();e.CharacterModel=t,__reflect(t.prototype,"foxgame.CharacterModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.EQUIPVIEW=0]="EQUIPVIEW",e[e.GEMVIEW=2]="GEMVIEW",e[e.SKILLVIEW=3]="SKILLVIEW",e[e.DETAILVIEW=5]="DETAILVIEW",e[e.ZHUANGBAN=6]="ZHUANGBAN"}(t=e.CharacterPanelViewType||(e.CharacterPanelViewType={}));var i=function(i){function n(t){var n=i.call(this,"resource/skins/character/CharacterPanelSkin.exml","skill",!1)||this;return n.curTabIndex=0,n.isMask=!1,n.setIsResDestroy(!1),n.setMaskGapBottom(e.Global.mainBtnsPanelMaskGapBottom),n.model=t,n.isMaskdown=!0,n.setIsShowTween(!1),n.adaptionType=1,n}return __extends(n,i),n.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this)},n.prototype.showHook=function(){this.doScreenAdaptation(),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.ui.headBar.setSelect(this.roleIndex)},n.prototype.showPanel=function(e,t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),n&&(e=this.curTabIndex,this.roleIndex=this.roleIndex),this.curTabIndex=e,this.getIsShow()?this.changeview():(this.roleIndex=t,this.show())},n.prototype.initParams=function(){this.model.roleData=null,this.changeview(),this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList())},n.prototype.setHeadTextImg=function(e){switch(this.ui.jueseImg.visible=!1,this.ui.skillImg.visible=!1,this.ui.gemImg.visible=!1,this.ui.detailImg.visible=!1,this.ui.zhuangban.visible=!1,e){case t.EQUIPVIEW:this.ui.jueseImg.visible=!0;break;case t.SKILLVIEW:this.ui.skillImg.visible=!0;break;case t.GEMVIEW:this.ui.gemImg.visible=!0;break;case t.DETAILVIEW:this.ui.detailImg.visible=!0;break;case t.ZHUANGBAN:this.ui.zhuangban.visible=!0}},n.prototype.guideshow=function(){this.equipView.showGuide()},n.prototype.clear=function(){this.equipView=null,this.gemSystem=null,this.skillView=null,this.detailView=null,this.zhuangban=null},n.prototype.refresh=function(){switch(this.ui.currency.refresh(),this.curTabIndex){case t.EQUIPVIEW:this.equipView.refresh();break;case t.GEMVIEW:this.gemSystem.initData();break;case t.SKILLVIEW:this.skillView.initData();break;case t.DETAILVIEW:this.detailView.refresh(this.model.roleData.attrList);break;case t.ZHUANGBAN:this.zhuangban.rolechange()}},n.prototype.changeview=function(){switch(this.ui.viewGroup.removeChildren(),this.curTabIndex){case t.EQUIPVIEW:this.equipView||(this.equipView=new e.CharacterEquipView(this),this.equipView.horizontalCenter=0),this.ui.viewGroup.addChild(this.equipView);break;case t.GEMVIEW:this.gemSystem||(this.gemSystem=new e.GemSystemView(this),this.gemSystem.horizontalCenter=0),this.ui.viewGroup.addChild(this.gemSystem);break;case t.SKILLVIEW:this.skillView||(this.skillView=new e.SkillView(this),this.skillView.horizontalCenter=0),this.ui.viewGroup.addChild(this.skillView);break;case t.DETAILVIEW:this.detailView||(this.detailView=new e.CharacterDetailView),this.ui.viewGroup.addChild(this.detailView);break;case t.ZHUANGBAN:this.zhuangban||(this.zhuangban=new e.Latestfashionpanel,this.zhuangban.horizontalCenter=0),this.ui.viewGroup.addChild(this.zhuangban),this.zhuangban.xianshiavatar()}this.setHeadTextImg(this.curTabIndex),this.refreshRoleOperate(),this.refresh()},n.prototype.removeView=function(e){for(var t,i=this.ui.viewGroup;e.length>0;)t=e.pop(),null!=t&&null!=t.parent&&i.removeChild(t)},n.prototype.refreshRoleOperate=function(){for(var t,i=3,n=e.CharacterController.getInstance(),o=0;i>o;o++)t=n.checkSingleRoleOpenOperate(o),this.ui.headBar.setRedStatus(o,t)},n.prototype.setfashionredpoint=function(e){this.equipView&&this.equipView.setredtip5(e)},n.prototype.tabClickHandler=function(e){void 0===e&&(e=0),this.curTabIndex=e,this.changeview()},n.prototype.helpHandler=function(i){switch(this.curTabIndex){case t.GEMVIEW:e.HelpController.getInstance().showPanel("GEMHELP");break;case t.SKILLVIEW:e.HelpController.getInstance().showPanel("SKILLHELP");break;case t.EQUIPVIEW:e.HelpController.getInstance().showPanel("ROLEBARHELP");break;case t.ZHUANGBAN:e.HelpController.getInstance().showPanel("ZHUANGBAN")}},n.prototype.bagItemChanged=function(){this.curTabIndex==t.GEMVIEW&&this.gemSystem.initData()},n.prototype.recvMsg=function(t,i){if(0!=this.getIsShow())switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},n.prototype.backHandler=function(){this.curTabIndex==t.EQUIPVIEW?this.close():this.tabClickHandler(t.EQUIPVIEW)},n.prototype.readyDestroy=function(){this.ui.viewGroup.removeChildren(),this.equipView&&this.equipView.destoryAnis(),this.gemSystem&&(this.gemSystem=null),this.skillView&&(this.skillView=null)},n.prototype.closeHook=function(){e.NewJueweiController.getInstance().updateNobilityData(),App.GuideUtils().isShow&&37!=App.GuideUtils().currdbz&&38!=App.GuideUtils().currdbz&&App.GuideUtils().hide(),App.GuideUtils().currPart==e.GuidePart.currPart1&&3==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart7&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart9&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart19&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart20&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart25&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),32==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),this.zhuangban&&this.zhuangban.cleanUiRes(),this.equipView&&this.equipView.unLoadUiRes()},n.prototype.setRoleData=function(e){this.model.roleData=e,(this.equipView||this.gemSystem||this.skillView||this.detailView||this.zhuangban)&&this.refresh()},n.prototype.zguideshow=function(){var t=StageFrameControl.instance.getBackBtn();App.GuideUtils().currPart==e.GuidePart.currPart1&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart1,3,!1),App.GuideUtils().currPart==e.GuidePart.currPart7&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart7,2,!1),App.GuideUtils().currPart==e.GuidePart.currPart9&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart9,2,!1),App.GuideUtils().currPart==e.GuidePart.currPart19&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart19,2,!1),App.GuideUtils().currPart==e.GuidePart.currPart20&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart20,2,!1),App.GuideUtils().currPart==e.GuidePart.currPart25&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart25,2,!1),this.equipView&&this.equipView.guidebayezhuangbei()},n}(e.BasePanel);e.CharacterPanel=i,__reflect(i.prototype,"foxgame.CharacterPanel",["foxgame.IMessage","foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.EQUIPQUALITY1=16777215,this.EQUIPQUALITY2=917248,this.EQUIPQUALITY3=44543,this.EQUIPQUALITY4=13058030,this.EQUIPQUALITY5=16750336,this.EQUIPQUALITY6=16712704,this.GRAYCOLOR=10724259}return t.prototype.getColorByQuality=function(e){return this["EQUIPQUALITY"+e]},t.prototype.getAttrColorById=function(e){var t=this.tempAttDef[e];return t.equipColor},t.prototype.getAttrValueColorById=function(e){var t=this.tempAttDef[e];return t.equipValueColor},t.prototype.getGemAttrColorById=function(e){var t=this.tempAttDef[e];return t.gemColor},Object.defineProperty(t.prototype,"tempAttDef",{get:function(){return e.JsonDataManager.instance.attDefTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();e.ColorUtils=t,__reflect(t.prototype,"foxgame.ColorUtils")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/character/EquipTipsSkin.exml","equipTip")||this;return e.equipId=-1,e.offsetX1=10,e.offsetX2=15,e.offsetY=6,e.lineSpace=6,e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this),this.ui.replaceBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.replaceHandler,this),this.ui.replaceBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.replaceHandler,this),this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),this.ui.xilianBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.xilianHandler,this),this.ui.lockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lockHandler,this),this.ui.unlockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.unlockHandler,this),this.tempStrength=e.JsonDataManager.instance.strengthen,this.tempGem=e.JsonDataManager.instance.partStoneTemplate,this.tempGemAttr=e.JsonDataManager.instance.partStoneAttTemplate,this.strengthenLevelTemplate=e.JsonDataManager.instance.strengthenLevelRate,this.strengthenQualityTemplate=e.JsonDataManager.instance.strengthenQualityRate},i.prototype.showPanel=function(e){this.profession=e.profession?e.profession:-1,this.equipInfo=e.equipInfo,this.cellInfo=e.cellInfo,this.showReplace=null!=e.showReplace?e.showReplace:!0,this.showLock=null!=e.showLock?e.showLock:!0,this.equipId=e.equipId?e.equipId:-1,this.part=e.part?e.part:null!=this.cellInfo?this.cellInfo.getCellId():-1,this.show()},i.prototype.refresh=function(){var t;t=this.equipInfo?this.equipInfo.getId():this.equipId;var i=e.BagController.getInstance().getEquipInfoById(t);null!=i&&(this.equipInfo=i),this.groupAry=[];var n;n=-1==this.equipId?this.getEquipTemplate()[this.equipInfo.getEquipId()]:this.getEquipTemplate()[this.equipId];var o=this.tempGodlyEquip[n.id];this.ui.lockGroup.visible=this.showLock,-1==this.equipId?(this.ui.lockBtn.visible=this.equipInfo.getLockPeriod()<=0,this.ui.unlockBtn.visible=this.equipInfo.getLockPeriod()>0):this.ui.lockGroup.visible=!1,this.initGroupsState(),this.ui.icon.setItem(n.id,-1,!1);var a=n.name;if(n.quality==e.EquipQuality.RED&&void 0!=this.equipInfo){this.ui.icon.setQueneLevelProps(t,this.equipInfo);var s=this.equipInfo.getQuenchingLevel(),r=this.redQuenData[s];this.ui.label_jipinLevel.visible=!0,this.ui.label_jipinLevel.text="淬炼 LV."+s;var l=e.LanguageUtils.instance.getValue(r.nameEvolve.toUpperCase());void 0!=l&&(a=l+"·"+a)}else this.ui.label_jipinLevel.visible=!1;if(this.ui.nameLabel.text=a,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(n.quality),this.ui.bgImg.source="qualityBg"+n.quality+"_png",this.ui.partLabel.text=this.getPartName(n.partList[0]),this.ui.professionLabel.text=e.LanguageUtils.instance.getValue("PROF_"+n.profession),this.ui.lvLabel.text=n.level.toString(),null!=o)this.ui.scoreLabel.text=o.getScore().toString();else if(-1!=this.equipId){var h=n.quality==e.EquipQuality.RED,c=h?n.level:-1;this.ui.scoreLabel.text=e.GlobalUtil.getScore(n.attrTypeList,n.attrValueList,null,null,null,null,h,c)+2e3+" + ?????"}else this.ui.scoreLabel.text=this.equipInfo.getScore()+"";if(this.ui.dynamicGroup.removeChildren(),-1!=this.equipId)return void this.refreshByEquipId();var u,p=this.equipInfo.getAttrInfos();this.jipinAttrList=[],this.setBaseAttr(p,u),this.setJipinAttr(u),this.setQianghuaAttr(n),this.setGemAttr(),this.updateBtnState(n),this.sortGroupPosY()},i.prototype.setGemAttr=function(){var t=this.ui.gemAttrGroup;t.removeChildren();var i=this.ui.gemGroup;if(null!=this.cellInfo){i.visible=!0,-1==this.groupAry.indexOf(i)&&this.groupAry.push(i);for(var n=this.tempGem[this.cellInfo.getCellId()],o=void 0,a=0,s=this.cellInfo.getGemInfo(),r=void 0,l=void 0,h=40,c=a,u=0;u<s.length;u++){r=s[u];var p=new eui.Image;p.x=this.offsetX2,p.y=c+u*h,a=p.y+h,p.scaleX=.7,p.scaleY=.7,t.addChild(p);var g=new eui.Label;if(g.size=17,g.x=p.x+50,g.y=p.y+10,l=this.getItemTemplate()[n.getStoneList()[u]],r.getLevel()>0){p.source=l.icon,g.text=l.name+"【"+r.getLevel()+e.LanguageUtils.instance.getValue("JI")+"】",t.addChild(g),o=this.tempGemAttr[this.cellInfo.getCellId()+"_"+(u+1)+"_"+r.getLevel()];for(var d=0,f=0;f<o.attrTypeList.length;f++){var m=new eui.Label;m.name="宝石属性"+o.attrTypeList[f],m.text=e.LanguageUtils.instance.getValue("ATT_"+o.attrTypeList[f])+"+"+e.GlobalUtil.getAttrValueStr(o.attrTypeList[f],o.attrValueList[f]),m.textColor=e.ColorUtils.instance.getGemAttrColorById(o.attrTypeList[f]),m.size=15,m.x=g.x+d,m.y=g.y+g.height,t.addChild(m),d+=m.width+15,g.textColor=m.textColor}}else p.source="gemGrayBG_png",g.text=l.name+e.LanguageUtils.instance.getValue("WEIJIHUO"),g.textColor=e.ColorUtils.instance.GRAYCOLOR,t.addChild(g)}}else i.visible=!1},i.prototype.setQianghuaAttr=function(t){var i,n=this.ui.qianghuaGroup,o=this.ui.qianghuaAttr;if(null!=this.cellInfo&&this.cellInfo.getCellStrenthLevel()>0){-1==this.groupAry.indexOf(n)&&this.groupAry.push(n),n.visible=!0;var a=this.tempStrength[this.cellInfo.getCellStrenthLevel()],s=this.strengthenLevelTemplate[t.level],r=this.strengthenQualityTemplate[t.quality],l=a["propertiesCloaks"+this.cellInfo.getCellId()],h=Number(l[0]),c=Math.floor(Number(l[1])*s.rate*r.rate),u=[];i=e.LanguageUtils.instance.getValue("ATT_"+h);var p=i+"："+c,g=e.ColorUtils.instance.getAttrColorById(h),d={text:p,style:{textColor:g}};u.push(d),o.lineSpacing=this.lineSpace,o.textFlow=u
}else n.visible=!1;n.height=o.y+o.height},i.prototype.setJipinAttr=function(t){var i,n,o=0,a=this.ui.jipinGroup,s=this.ui.jipinAttrGroup;if(s.removeChildren(),this.jipinAttrList.length>0){-1==this.groupAry.indexOf(a)&&this.groupAry.push(a),a.visible=!0;for(var r=void 0,l=0;l<this.jipinAttrList.length;l++){t=this.jipinAttrList[l],i=t.getAttrData(),n=e.LanguageUtils.instance.getValue("ATT_"+i.getAttrId());var h=this.getAttrLabel();if(h.size=18,h.text=n+"："+e.GlobalUtil.getAttrValueStr(i.getAttrId(),i.getAttrValue()),i.getAdditionValue()>0&&(h.text+=" + "+i.getAdditionValue()),h.textColor=e.ColorUtils.instance.getAttrColorById(i.getAttrId()),h.x=this.offsetX2,h.y=o,o=h.y+h.height+this.offsetY,h.fontFamily="宋体",s.addChild(h),r=this.tempRareAttrStar[i.getAttrId()],null!=r)for(var c=h.x+200,u=0;u<r.star;u++){var p=new eui.Image("img_star_1_png");p.x=c,p.y=h.y,s.addChild(p),c+=24}}}else a.visible=!1;var g=s.numChildren,d=1;if(g>=1)for(;g-d>0;){if(s.getChildAt(g-d)instanceof eui.Label){var f=s.getChildAt(g-d);s.height=f.y+f.height,a.height=s.y+s.height;break}d++}},i.prototype.setBaseAttr=function(t,i){for(var n,o,a=[],s=this.ui.baseAttr,r=0;r<t.length;r++){if(i=t[r],n=i.getAttrData(),o=e.LanguageUtils.instance.getValue("ATT_"+n.getAttrId()),i.getAttrGrade()==e.equipAttrGrade.PRIMARY_ATTR){-1==this.groupAry.indexOf(s)&&this.groupAry.push(s);var l=(this.getAttrLabel(),o+"："+e.GlobalUtil.getAttrValueStr(n.getAttrId(),n.getAttrValue()));n.getAdditionValue()>0&&(l+="+"+n.getAdditionValue()),l+="\n";var h=e.ColorUtils.instance.getAttrColorById(n.getAttrId()),c={text:l,style:{textColor:h}};a.push(c)}else i.getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&this.jipinAttrList.push(t[r]);s.lineSpacing=this.lineSpace}var u=a[a.length-1];u&&u.text&&(u.text=u.text.split("\n")[0]),s.textFlow=a},i.prototype.sortGroupPosY=function(){for(var e=this.groupAry.length,t=1;e>t;t++){var i=this.groupAry[t-1];this.groupAry[t].y=i.y+i.height+this.offsetY}},i.prototype.updateBtnState=function(t){this.showReplace?t.quality==e.EquipQuality.RED||this.part>=11&&this.part<=14?(this.ui.xilianBtn.visible=!(this.part>=11&&this.part<=14),this.ui.upgradeBtn.visible=this.ui.replaceBtn1.visible=!0,this.ui.replaceBtn0.visible=!1):(this.ui.upgradeBtn.visible=this.ui.replaceBtn1.visible=!1,this.ui.xilianBtn.visible=!1,this.ui.replaceBtn0.visible=!0):(this.ui.replaceBtn1.visible=this.ui.replaceBtn0.visible=!1,this.ui.upgradeBtn.visible=!1,this.ui.xilianBtn.visible=!1)},i.prototype.refreshByEquipId=function(){this.initGroupsState(),this.ui.lockGroup.visible=!1,this.ui.xilianBtn.visible=!1,this.ui.upgradeBtn.visible=!1,this.ui.replaceBtn0.visible=!1,this.ui.replaceBtn1.visible=!1;for(var t,i,n,o=this.getEquipTemplate()[this.equipId],a=o.attrTypeList.length,s=[],r=0;a>r;r++){t=o.attrTypeList[r],i=o.attrValueList[r];var l=(this.getAttrLabel(),n=e.LanguageUtils.instance.getValue("ATT_"+t)+"："+e.GlobalUtil.getAttrValueStr(t,i)+" + ??????\n"),h=e.ColorUtils.instance.getAttrColorById(t),c={text:l,style:{textColor:h}};s.push(c)}var u=this.ui.jipinGroup,p=this.ui.jipinAttrGroup;if(o.quality>=e.EquipQuality.ORANGE){p.removeChildren(),u.visible=!0;var g=this.getAttrLabel();g.size=18;var d=o.quality==e.EquipQuality.ORANGE?" + ??????":" + ??????\n + ??????\n + ??????\n";g.textFlow=[{text:d}],p.addChild(g);var f=p.getChildAt(0);p.height=f.y+f.height,u.height=p.y+p.height}this.ui.baseAttr.textFlow=s,this.ui.baseAttr.lineSpacing=this.lineSpace},i.prototype.initGroupsState=function(){this.ui.jipinGroup.visible=!1,this.ui.qianghuaGroup.visible=!1,this.ui.gemGroup.visible=!1},i.prototype.getPartName=function(t){var i,n=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES],o=[e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],a=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3];return-1!=n.indexOf(t)?i=e.LanguageUtils.instance.getValue("PARTNAME"+t):-1!=o.indexOf(t)?i=e.LanguageUtils.instance.getValue("SUITNAME"):-1!=a.indexOf(t)&&(i=e.LanguageUtils.instance.getValue("GODLYNAME")),i},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.getTitleLabel=function(){var e=new eui.Label;return e.size=25,e.textColor=16776960,e},i.prototype.getAttrLabel=function(){var e=new eui.Label;return e.size=20,e},i.prototype.lockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPEquipLock");i.setEquipId(this.equipInfo.getId()),i.setLockType(1),e.Message.instance.send(e.Code.EQUIP_LOCK_C,i,!0)},i.prototype.unlockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPEquipLock");i.setEquipId(this.equipInfo.getId()),i.setLockType(2),e.Message.instance.send(e.Code.EQUIP_LOCK_C,i,!0)},i.prototype.replaceHandler=function(t){var i=e.PlayerService.instance.getRoleIdByEquipId(this.equipInfo.getId());e.ChangeEquipController.getInstance().showPanel(i,this.part,this.equipInfo),this.close()},i.prototype.xilianHandler=function(t){e.SmeltController.getInstance().showPanel(e.SMELTTAPS.SHENZHUANGXILIAN),this.close()},i.prototype.upgradeHandler=function(t){return this.part>=11&&this.part<=14?void e.SuitEquipController.getInstance().showtippanel(this.part):(e.SmeltController.getInstance().showPanel(e.SMELTTAPS.SHENZHUANGSHENGJI,this.cellInfo.getCellId()),void this.close())},i.prototype.closeHook=function(){},Object.defineProperty(i.prototype,"tempRareAttrStar",{get:function(){return e.JsonDataManager.instance.rareAttrStarTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempGodlyEquip",{get:function(){return e.JsonDataManager.instance.godlyEquipTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"redQuenData",{get:function(){return e.JsonDataManager.instance.redQuenching},enumerable:!0,configurable:!0}),i.prototype.getEquipTemplate=function(){return e.JsonDataManager.instance.equipTemplate},i.prototype.getItemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},i}(e.BasePanel);e.EquipTips=t,__reflect(t.prototype,"foxgame.EquipTips",["foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return Object.defineProperty(t.prototype,"languageTemp",{get:function(){return null==this._languageTemp&&(this._languageTemp=e.JsonDataManager.instance.languageTemplate),this._languageTemp},enumerable:!0,configurable:!0}),t.prototype.getValue=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!this.languageTemp)return e;var n=this.getReplaceString.apply(this,[this.languageTemp[e]].concat(t));return n},t.prototype.getReplaceString=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(t.length>0){var n=void 0,o=t.length;for(n=0;o>n;n++)e=e.replace("{"+n+"}",t[n])}return e},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();e.LanguageUtils=t,__reflect(t.prototype,"foxgame.LanguageUtils")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.curIndex=0,e.skinName="PanelHeadBarSkin",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.init()},i.prototype.init=function(){this.itemList=[this.item0,this.item1,this.item2];for(var e,t=this.itemList.length,i=0;t>i;i++)e=this["item"+i],e.setRedImgVisible(!1),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.headClickHandler,this)},i.prototype.setRoles=function(e,t,i,n){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===n&&(n=-1),n>=0&&!i&&(this.curIndex=n),this.roleDataList=e,this.isSelf=t,i?this.setSelect(0):this.setSelect(this.curIndex)},i.prototype.setFigthGradeShow=function(e){this.fightGradeGroup.visible=e,this.gradeBg.visible=e,this.aniGroup.visible=e},i.prototype.getCurIndex=function(){return this.curIndex},i.prototype.setBackFun=function(e){this.backFun=e},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.ani&&(this.ani.clear(),this.ani=null),this.ani||(this.ani=new e.FoxAni(this.aniGroup),this.ani.play("zdlhuodonghua","ani",-1))},i.prototype.destoryAni=function(){this.ani&&(this.ani.clear(),this.ani=null)},i.prototype.refresh=function(){for(var e,t,i=this.roleDataList,n=this.itemList.length,o=0;n>o;o++)t=i[o],e=this.itemList[o],e.setData(t);t=i[this.curIndex],null!=t&&(this.fightBLabel.text=t.fight.toString())},i.prototype.headClickHandler=function(t){var i=t.currentTarget;if(null!=i.roleData){var n=this.itemList.indexOf(i);this.setSelect(n)}else{if(0==this.isSelf)return;e.CharacterOpenController.getInstance().showPanel()}},i.prototype.setSelect=function(e){if(null!=this.backFun){var t=this.roleDataList,i=t[e];if(null!=i){this.curIndex=e;for(var n=this.itemList.length,o=0;n>o;o++)this.itemList[o].selected=o==e;this.refresh(),this.backFun(i)}}},i.prototype.setRedStatus=function(e,t){var i=this.itemList[e];i.setRedImgVisible(t)},i.prototype.setRedStatusByRoleId=function(e,t){for(var i=0;i<this.itemList.length;i++)this.itemList[i].roleData&&this.itemList[i].roleData.roleId==e&&this.itemList[i].setRedImgVisible(t)},i}(eui.Component);e.PanelHeadBar=t,__reflect(t.prototype,"foxgame.PanelHeadBar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.skinName="PanelHeadItemSkin"},t.prototype.setData=function(e){this.roleData=e,this.proImg1.visible=!1,this.proImg2.visible=!1,this.proImg3.visible=!1,null==e?(this.roleImg.source=null,this.selectImg.visible=!1,this.addBtn.visible=!0):(this.roleImg.source=e.headUrl,this.addBtn.visible=!1,this["proImg"+this.roleData.profession].visible=!0)},t.prototype.setRedImgVisible=function(e){this.redImg.visible=e},Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.selectImg.visible=e},enumerable:!0,configurable:!0}),t}(eui.Component);e.PanelHeadItem=t,__reflect(t.prototype,"foxgame.PanelHeadItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.fontColor=4842495,e.numberColor=917248,e.skinName="SkillItemCellSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.openLvel.touchEnabled=!1,this.initListener()},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.dispose(),this.data){var i=this.data.obj;this.skillIcon.source=i.icon,this.skillName.text=i.skillName,this.level.text=e.LanguageUtils.instance.getValue("LEVEL")+":"+i.level;for(var n="",o=i.skillDesc.split("|"),a=0;a<o.length;a++)n+=0==a?o[a]:"\n<font color="+this.fontColor.toString()+">"+o[a]+"</font>";n=n.replace(/\$/g,"<font color="+this.numberColor.toString()+">"),n=n.replace(/@/g,"</font>"),this.skillDesc.textFlow=(new egret.HtmlTextParser).parser(n),this.goldNeed.text=i.upgradeCost,this.data.roleLevel>=parseInt(i.openLevel)?(this.openLvel.visible=!1,this.upLevel.visible=!0):(this.openLvel.text=e.LanguageUtils.instance.getValue("JIJIKAIQI",this.data.obj.openLevel.toString()),this.openLvel.visible=!0,this.upLevel.visible=!1),this.checkRedPoint()}},i.prototype.checkRedPoint=function(){var e=Number(this.data.goldNums),t=Number(this.data.roleLevel),i=this.data.obj,n=Number(i.openLevel),o=Number(i.upgradeCost),a=Number(i.level);t>n&&e>=o&&t>a?this.isShowRedPoint=!0:this.isShowRedPoint=!1,this.redTip.visible=this.isShowRedPoint},i.prototype.getIsShowRedPoint=function(){return this.isShowRedPoint},i.prototype.dispose=function(){this.skillIcon.source="",this.skillName.text="",this.level.text="",this.skillDesc.text="",this.openLvel.visible=!1,this.upLevel.visible=!1},i.prototype.initListener=function(){this.upLevel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upSkillLevel,this)},i.prototype.upSkillLevel=function(t){if(this.data.roleLevel<=this.data.obj.level)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("JINENGDENGJIBUNENGDAYURENWUDENGJI"));if(this.data.goldNums<parseInt(this.data.obj.upgradeCost)){var i=e.JsonDataManager.instance.itemTemplate;i[1002];return void e.ItemNotEnoughController.getInstance().showPanel(1002)}var n=HawkProtocolManager.newBuilder("JsProto.SkillUpgradeReq");n.setRoleId(this.data.roleId),n.setSkillId(parseInt(this.data.obj.skillType)),e.Message.instance.send(e.Code.SKILL_LEVELUP_C,n,!0),App.SoundManager().playEffect("sound_upStar_mp3")},i}(eui.ItemRenderer);e.SkillItemCellRender=t,__reflect(t.prototype,"foxgame.SkillItemCellRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.showSkillInfos=new Array,n.skillCellHeight=170,n.skillCellList=[],n.mainPanel=i,n._model=e.CharacterController.getInstance().getModel(),n.skinName="SkillView",n.collection=new eui.ArrayCollection,n.skillTemp=e.JsonDataManager.instance.skillTemplate,n.collection.source=[],n.skillList.dataProvider=n.collection,n.skillList.itemRenderer=e.SkillItemCellRender,n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skillUpgradeOneKeyReq=HawkProtocolManager.newBuilder("JsProto.SkillUpgradeOneKeyReq"),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),e.Message.instance.add(e.Code.SKILL_LEVELUP_S,this),e.Message.instance.add(e.Code.SKILL_CHANGE_ORDER_S,this),this.oneKeyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.skillScroller.verticalScrollBar.autoVisibility=!1},i.prototype.initData=function(){null!=this._model.roleData&&(this.roleData=this._model.roleData,App.GuideUtils().currPart==e.GuidePart.currPart19&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.oneKeyBtn,this,e.GuidePart.currPart19,1),App.GuideUtils().currPart==e.GuidePart.currPart20&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.oneKeyBtn,this,e.GuidePart.currPart20,1),App.GuideUtils().currPart==e.GuidePart.currPart9&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.oneKeyBtn,this,e.GuidePart.currPart9,1),this.roleId=this.roleData.roleId,this.updataInfo(),this.showSkills())},i.prototype.updataInfo=function(){this.playerInfo=e.PlayerService.instance.playerInfo,this.currentCoinNums=this.playerInfo.getCoin(),this.skillInfos=this.roleData.roleInfo.getSkills(),this.roleLevel=this.playerInfo.getLevel()},i.prototype.showSkills=function(){this.clearSkills();for(var e=0;e<this.skillInfos.length;e++){var t=this.skillInfos[e].getLevel();1>t&&(t=1);var i=this.skillTemp[this.skillInfos[e].getId()+"_"+t];this.showSkillInfos.push({obj:i,roleLevel:this.roleLevel,goldNums:this.currentCoinNums,roleId:this.roleId})}this.collection.replaceAll(this.showSkillInfos)},i.prototype.clearSkills=function(){this.showSkillInfos=[]},i.prototype.btClick=function(t){e.JsonDataManager.instance.itemTemplate;switch(t.target){case this.oneKeyBtn:if(!this.checkSkillLevel())return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("JINENGDENGJIBUNENGDAYURENWUDENGJI"));if(!this.checkSkillConst()){var i=e.JsonDataManager.instance.itemTemplate;i[1002];return void e.ItemNotEnoughController.getInstance().showPanel(1002)}App.GuideUtils().currPart==e.GuidePart.currPart9&&1==App.GuideUtils().currStep&&e.CharacterController.getInstance().guideshow(),App.GuideUtils().currPart==e.GuidePart.currPart19&&1==App.GuideUtils().currStep&&e.CharacterController.getInstance().guideshow(),App.GuideUtils().currPart==e.GuidePart.currPart20&&1==App.GuideUtils().currStep&&e.CharacterController.getInstance().guideshow();var n=this.skillInfos[0].getLevel();this.skillTemp[this.skillInfos[0].getId()+"_"+n];this.skillUpgradeOneKeyReq.setRoleId(this.roleId),e.Message.instance.send(e.Code.SKILL_CHANGE_ORDER_C,this.skillUpgradeOneKeyReq,!0)}},i.prototype.checkSkillLevel=function(){for(var e=this.showSkillInfos.length,t=this.roleLevel,i=0;e>i;i++){var n=this.showSkillInfos[i];if(n.obj.level<t)return!0}return!1},i.prototype.checkSkillConst=function(){for(var e=this.showSkillInfos.length,t=this.currentCoinNums,i=0;e>i;i++){var n=this.showSkillInfos[i];if(t>n.obj.upgradeCost)return!0}return!1},i.prototype.backHandler=function(){e.Message.instance.remove(e.MsgCMD.REFRESH_PLAYERDATA,this),this.mainPanel.tabClickHandler()},i.prototype.getIsHasRedPoint=function(){return this.skillCellList.length>0?!0:!1},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_upStar_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.recvMsg=function(t,i){var n=e.CharacterController.getInstance().getPanel().getIsShow();if(n){var o,a=0;if(t==e.Code.SKILL_LEVELUP_S){for(a=0;a<this.showSkillInfos.length;a++)if(i.skillId==parseInt(this.showSkillInfos[a].obj.skillType)){o=this.skillTemp[i.skillId+"_"+i.skillLevel],this.showSkillInfos[a].obj=o;break}this.updataInfo(),this.showSkills(),e.MainBottomControler.instance.refreshCharacterIconOperate(),this.playAni()}if(t==e.Code.SKILL_CHANGE_ORDER_S){var s=i.skillInfos;for(a=0;a<s.length;a++)for(var r=0;r<this.skillInfos.length;r++)s[a].getId()==this.skillInfos[r].getId()&&(this.skillInfos[r]=s[a]);var l=i.getCoinCost();l>0&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YIJIANSHENGJICHENGGONG")+"!"),0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo()),this.roleData.roleInfo.setSkills(this.skillInfos),this.updataInfo(),this.showSkills(),e.MainBottomControler.instance.refreshCharacterIconOperate(),this.playAni()}t==e.MsgCMD.REFRESH_PLAYERDATA&&(this.playerInfo=e.PlayerService.instance.playerInfo,this.currentCoinNums!=this.playerInfo.getCoin()&&(this.currentCoinNums=this.playerInfo.getCoin(),this.updataInfo(),this.showSkills()))}},i.currentSelecetPlayerId=0,i}(eui.Component);e.SkillView=t,__reflect(t.prototype,"foxgame.SkillView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/character/SpecialRingPanel.exml")||this;return e.isMask=!0,e}return __extends(i,t),i.prototype.initHook=function(){this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this);for(var e,t=this.getGoLabelList(),i=t.length,n=0;i>n;n++)e=t[n],e.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.text+"</u>"),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goHandler,this)},i.prototype.showHook=function(){35==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.showPanel=function(e,t,i,n){this.index=e,this.roleId=t,this.lvList=i,this.isSelf=n,this.show()},i.prototype.refresh=function(){var t,i=e.JsonDataManager.instance.specialRingTemplate;e.PlayerService.instance.getRoleDataByRoleId(this.roleId);this.lvList[this.index]>0?(t=this.lvList[this.index],this.isHave=!0):(t=1,this.isHave=!1),this.ui.btnGroup.visible=this.isSelf;var n=this.index+1+"_"+t;this.ringVO=i[n];var o=i[this.index+1+"_"+(t+1)];this.ui.icon.setSpecialRing(this.index,this.ringVO.level);var a=this.ui.nameLabel;a.text=this.ringVO.name,a.textColor=e.ColorUtils.instance.getColorByQuality(this.ringVO.quality);for(var s,r,l,h,c=this.ringVO.attrTypeList.length,u=this.getDesLabelList(),p=this.getAttrLabelList(),g=u.length,d=0;g>d;d++)l=u[d],h=p[d],l.visible=this.index==d,c>d?(s=e.LanguageUtils.instance.getValue("ATT_"+this.ringVO.attrTypeList[d])+":",s+=e.GlobalUtil.getAttrValueStr(this.ringVO.attrTypeList[d],this.ringVO.attrValueList[d]),r=e.ColorUtils.instance.getAttrColorById(this.ringVO.attrTypeList[d]),h.text=s,h.textColor=r,h.visible=!0):h.visible=!1;for(var f,m,y,I=e.JsonDataManager.instance.itemTemplate,v=I[this.ringVO.costId],_=this.getWayGroupList(),T=this.getWayLabelList(),d=0;g>d;d++)m=_[d],v.getWayList[d]?(m.visible=!0,f=v.getWayList[d],y=T[d],y.text="*"+e.LanguageUtils.instance.getValue("ITEMGETWAY"+f)):m.visible=!1;null==o&&(this.ui.btnGroup.visible=!1),this.isHave?this.ui.upgradeBtn.label=e.LanguageUtils.instance.getValue("JINJIE"):this.ui.upgradeBtn.label=e.LanguageUtils.instance.getValue("JIHUO")},i.prototype.goHandler=function(t){var i=e.JsonDataManager.instance.itemTemplate,n=this.getGoLabelList(),o=n.indexOf(t.target),a=i[this.ringVO.costId],s=a.getWayList[o];if(1==s)e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.NEW_AREN_SHAOP_UI);else if(4==s)if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YOUMINGTA))e.ClimbingController.getInstance().show();else{var r=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YOUMINGTA);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CLIMBING_SHOW_LEVEL_TIP",r))}else 7==s?e.SearchTreasureController.getInstance().showPanel():10==s&&e.FuBenController.getInstance().showPanel(e.FuBenType.SpecialRingType)},i.prototype.upgradeHandler=function(t){e.CharacterController.getInstance().showSpecialRingUpgradePanel(this.index,this.roleId),this.close()},i.prototype.getGoLabelList=function(){var e=[];return e.push(this.ui.goLabel0),e.push(this.ui.goLabel1),e.push(this.ui.goLabel2),e.push(this.ui.goLabel3),e},i.prototype.getDesLabelList=function(){var e=[];return e.push(this.ui.desLabel0),e.push(this.ui.desLabel1),e.push(this.ui.desLabel2),e.push(this.ui.desLabel3),e},i.prototype.getAttrLabelList=function(){var e=[];return e.push(this.ui.attrLabel0),e.push(this.ui.attrLabel1),e.push(this.ui.attrLabel2),e.push(this.ui.attrLabel3),e},i.prototype.getWayGroupList=function(){var e=[];return e.push(this.ui.getWayGroup0),e.push(this.ui.getWayGroup1),e.push(this.ui.getWayGroup2),e.push(this.ui.getWayGroup3),e},i.prototype.getWayLabelList=function(){var e=[];return e.push(this.ui.getWayLabel0),e.push(this.ui.getWayLabel1),e.push(this.ui.getWayLabel2),e.push(this.ui.getWayLabel3),e},i}(e.BasePanel);e.SpecialRingPanel=t,__reflect(t.prototype,"foxgame.SpecialRingPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/character/SpecialRingUpgradeSkin.exml")||this;return e.isMask=!0,e}return __extends(i,t),i.prototype.initHook=function(){this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this)},i.prototype.showPanel=function(e,t){this.index=e,this.roleId=t,this.show()},i.prototype.refresh=function(){var t,i=e.JsonDataManager.instance.specialRingTemplate,n=e.PlayerService.instance.getRoleDataByRoleId(this.roleId),o=n.getSpecialRingLvList();o[this.index]>0?(t=o[this.index],t+=1,this.isHave=!0):(t=1,this.isHave=!1);var a=this.index+1+"_"+t;this.ringNextLvVO=i[a],this.ui.equipIcon.setSpecialRing(this.index,this.ringNextLvVO.level);var s=this.ui.nameLabel0;s.text=this.ringNextLvVO.name,s.textColor=e.ColorUtils.instance.getColorByQuality(this.ringNextLvVO.quality);var r=e.JsonDataManager.instance.itemTemplate,l=r[this.ringNextLvVO.costId];this.ui.itemIcon.setItem(l.id,1,!1);var h=e.BagController.getInstance().getCountByItemId(l.id),c=this.ui.nameLabel1,u=e.ColorUtils.instance.getColorByQuality(l.quality);c.textFlow=this.createMaterialProTextFlow(h,this.ringNextLvVO.costNum,l.name,u);for(var p,g,d,f,m=this.ringNextLvVO.attrTypeList.length,y=this.getDesLabelList(),I=this.getAttrLabelList(),v=y.length,_=0;v>_;_++)d=y[_],d.visible=this.index==_,f=I[_],m>_?(p=e.LanguageUtils.instance.getValue("ATT_"+this.ringNextLvVO.attrTypeList[_])+":",p+=e.GlobalUtil.getAttrValueStr(this.ringNextLvVO.attrTypeList[_],this.ringNextLvVO.attrValueList[_]),g=e.ColorUtils.instance.getAttrColorById(this.ringNextLvVO.attrTypeList[_]),f.text=p,f.textColor=g,f.visible=!0):f.visible=!1;this.isHave?this.ui.upgradeBtn.label=e.LanguageUtils.instance.getValue("JINJIE"):this.ui.upgradeBtn.label=e.LanguageUtils.instance.getValue("JIHUO")},i.prototype.createMaterialProTextFlow=function(e,t,i,n){var o;o=e>=t?65280:16711680;var a=[{text:i,style:{textColor:n}},{text:"(",style:{textColor:16777215}},{text:e+"",style:{textColor:o}},{text:"/"+t+")",style:{textColor:16777215}}];return a},i.prototype.upgradeHandler=function(t){var i=e.JsonDataManager.instance.itemTemplate,n=i[this.ringNextLvVO.costId],o=e.BagController.getInstance().getCountByItemId(n.id);if(o<this.ringNextLvVO.costNum)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void e.ItemNotEnoughController.getInstance().showPanel(n.id);var a=HawkProtocolManager.newBuilder("JsProto.HPsynthesis");a.setRoleId(this.roleId),a.setRingType(this.index+1),e.Message.instance.send(e.Code.RING_SYNTHESIS_C,a,!0),this.close()},i.prototype.getDesLabelList=function(){var e=[];return e.push(this.ui.desLabel0),e.push(this.ui.desLabel1),e.push(this.ui.desLabel2),e.push(this.ui.desLabel3),e},i.prototype.getAttrLabelList=function(){var e=[];return e.push(this.ui.attrLabel0),e.push(this.ui.attrLabel1),e.push(this.ui.attrLabel2),e.push(this.ui.attrLabel3),e},i}(e.BasePanel);e.SpecialRingUpgradePanel=t,__reflect(t.prototype,"foxgame.SpecialRingUpgradePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.touchChildren=!1,e.touchEnabled=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addedHandler,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeHandler,e),e}return __extends(i,t),i.prototype.cleanAvatarRes=function(t,i,n){void 0===n&&(n=!1),e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this,t,!1,i),this.notifyUnLoadImageRes()},i.prototype.deleteAvatar=function(e,t){this.cleanAvatarRes(e,t,!1),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addedHandler,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this)},i.prototype.notifyUnLoadImageRes=function(){this.charImg.source="",this.weaponImg.source="",this.hand1Img.source="",this.wingImg.source="",this.clearCharFashion(),this.clearWeaponFashion(),this.clearWingFashion()},i.prototype.clearCharFashion=function(){this.charFashionAni&&(this.charFashionGroup.numChildren&&this.charFashionGroup.removeChildren(),this.charFashionAni.clear(),this.charFashionAni=null)},i.prototype.clearWeaponFashion=function(){this.weaponFashionAni&&(this.weaponFashionGroup.numChildren&&this.weaponFashionGroup.removeChildren(),this.weaponFashionAni.clear(),this.weaponFashionAni=null)},i.prototype.clearWingFashion=function(){this.wingFashionAni&&(this.wingFashionGroup.numChildren&&this.wingFashionGroup.removeChildren(),this.wingFashionAni.clear(),this.wingFashionAni=null)},i.prototype.hidewing=function(){this.wingComplete("")},i.prototype.setAvatar=function(e,t,i,n,o,a,s,r,l,h){if(void 0===t&&(t=-1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===l&&(l=0),void 0===h&&(h=null),null!=this.stage){e=Number(e),t=Number(t),i=Number(i),s>0?this.setFashionWing(s):this.setNormalWing(n),o>0?this.setFashionClothes(e,o):this.setNormalClothes(e,t);var c;c=this.getHandImg(e),this.setHand(c),a>0?this.setFashionWeapon(a):this.setNormalWeapon(i),this.setDragonArmorGuard(r),this.setWardStatus(l)}},i.prototype.setFashionClothes=function(t,i){var n,o,a=this.getFashionTemplate(),s=this.getRoleTemplate()[t];for(var r in a)if(a[r].equipId==String(i)){n=a[r];break}o=this.getModelTemplate()[n.getModelId(s.sex)];var l=o.uiModel;this.charFashionAni&&this.charFashionAni.resId&&this.charFashionAni.resId!=l&&this.clearCharFashion(),null==this.charFashionAni&&(this.charFashionAni=new e.FoxAni(this.charFashionGroup)),this.charFashionAni.resId!=l&&this.charFashionAni.play(l,"ani",-1),this.charImg.source=""},i.prototype.setNormalClothes=function(e,t){var i,n;i=this.getEquipTemplate()[t];var o;if(i){var a=this.getRoleTemplate()[e];n=this.getModelTemplate()[i.getModelId(a.sex)],o=n.uiModel}else o=this.getDefaultClothes(e);this.setChar(o),this.clearCharFashion()},i.prototype.setFashionWeapon=function(t){var i,n=this.getFashionTemplate();for(var o in n)if(n[o].equipId==String(t)){i=n[o];break}var a,s;i?(s=this.getModelTemplate()[i.getModelId()],a=s.uiModel):a=null,this.weaponFashionAni&&this.weaponFashionAni.resId&&this.weaponFashionAni.resId!=a&&this.clearWeaponFashion(),null==this.weaponFashionAni&&(this.weaponFashionAni=new e.FoxAni(this.weaponFashionGroup)),this.weaponFashionAni.resId!=a&&this.weaponFashionAni.play(a,"ani",-1),this.weaponImg.source=""},i.prototype.setNormalWeapon=function(e){var t;t=this.getEquipTemplate()[e];var i,n;t?(n=this.getModelTemplate()[t.getModelId()],i=n.uiModel):i=null,this.setWeapon(i),this.clearWeaponFashion()},i.prototype.setFashionWing=function(t){var i,n,o,a=this.getFashionTemplate();for(var s in a)if(a[s].equipId==String(t)){n=a[s];break}n?(o=this.getModelTemplate()[n.getModelId()],i=o.uiModel):i=null,this.wingFashionAni&&this.wingFashionAni.resId&&this.wingFashionAni.resId!=i&&this.clearWingFashion(),null==this.wingFashionAni&&(this.wingFashionAni=new e.FoxAni(this.wingFashionGroup)),this.wingFashionAni.resId!=i&&this.wingFashionAni.play(i,"ani",-1),this.wingImg.source=""},i.prototype.setNormalWing=function(e){var t,i,n,o=this.getTempWing()[e];null!=o&&(n=this.getModelTemplate()[o.model],t=n.uiModel),o||i||(t=null),this.setWing(t),this.clearWingFashion()},i.prototype.recordGroupName=function(e){if(null!=e){var t=i.groupList;-1==t.indexOf(e)&&t.push(e)}},i.prototype.setHand=function(e){var t=this.hand1Img.source+"";if(e!=t)return this.recordGroupName(e),null==e?void(this.hand1Img.source=e):void App.getResourceUtils().loadGroups(e,[e],this.handComplete,null,this)},i.prototype.handComplete=function(e){this.hand1Img.source=e},i.prototype.setChar=function(e){var t=this.charImg.source+"";t!=e&&(this.recordGroupName(e),App.getResourceUtils().loadGroups(e,[e],this.charComplete,null,this))},i.prototype.charComplete=function(e){this.charImg.source=e},i.prototype.setWeapon=function(e){var t=this.weaponImg.source+"";if(t!=e)return this.recordGroupName(e),null==e?void(this.weaponImg.source=""):void App.getResourceUtils().loadGroups(e,[e],this.weaponComplete,null,this)},i.prototype.weaponComplete=function(e){this.weaponImg.source=e},i.prototype.setWing=function(e){var t=this.wingImg.source+"";if(t!=e)return this.recordGroupName(e),null==e?void(this.wingImg.source=""):void App.getResourceUtils().loadGroups(e,[e],this.wingComplete,null,this)},i.prototype.wingComplete=function(e){this.wingImg.source=e},i.prototype.getDefaultClothes=function(t){var i=this.getRoleTemplate()[t];if(i.sex==e.RoleSexType.MAN)return"ui_char1";if(i.sex==e.RoleSexType.WOMAN)return"ui_char2";throw new Error("sex Error")},i.prototype.getHandImg=function(t){var i=this.getRoleTemplate()[t];if(i.sex==e.RoleSexType.MAN)return"ui_hand1";if(i.sex==e.RoleSexType.WOMAN)return"ui_hand2";throw new Error("sex Error")},i.prototype.setDragonArmorGuard=function(t){var i=t>0?e.JsonDataManager.instance.dragonArmorGuardTemplate[t].effect1:"";this.dragonAGFashionAni&&this.dragonAGFashionAni.resId!=i&&(this.dragonAGFashionAni.clear(),this.dragonAGFashionAni=null),null==this.dragonAGFashionAni&&(this.dragonAGFashionAni=new e.FoxAni(this.dragonAGFashionGroup)),this.dragonAGFashionAni.resId!=i&&this.dragonAGFashionAni.play(i,"ani",-1)},i.prototype.setWardStatus=function(t){var i=t>0?e.JsonDataManager.instance.dragonGuardTemplate[t].effect1:"";this.wardFashionAni&&this.wardFashionAni.resId!=i&&(this.wardFashionAni.clear(),this.wardFashionAni=null),null==this.wardFashionAni&&(this.wardFashionAni=new e.FoxAni(this.wardFashionGroup)),this.wardFashionAni.resId!=i&&this.wardFashionAni.play(i,"ani",-1)},i.prototype.addedHandler=function(e){i.referenceCount++;
i.groupList},i.prototype.removeHandler=function(e){i.referenceCount--},i.prototype.getRoleTemplate=function(){return e.JsonDataManager.instance.roleTemplate},i.prototype.getEquipTemplate=function(){return e.JsonDataManager.instance.equipTemplate},i.prototype.getFashionTemplate=function(){return e.JsonDataManager.instance.fashionTemplate},i.prototype.getTempWing=function(){return e.JsonDataManager.instance.wingTemplate},i.prototype.getModelTemplate=function(){return e.JsonDataManager.instance.modelTemplate},i.referenceCount=0,i.groupList=[],i}(eui.Component);e.CharAvatar=t,__reflect(t.prototype,"foxgame.CharAvatar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.prototype.getModelId=function(t){return void 0===t&&(t=0),t==e.RoleSexType.MAN||0==t?this.modelId[0]:t==e.RoleSexType.WOMAN?this.modelId[1]:void 0},t}();e.FashionVO=t,__reflect(t.prototype,"foxgame.FashionVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.GemProgressModel,this.panel=new e.GemProgressView(this.model)}return t.prototype.showPanel=function(e){this.panel.show(),this.model.updateData(e)},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t}();e.GemProgressController=t,__reflect(t.prototype,"foxgame.GemProgressController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.gemLevelIsFull=!1,this.observerList=[]}return e.prototype.updateData=function(e){this.gemLevel=e,this.updateView()},e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e}();e.GemProgressModel=t,__reflect(t.prototype,"foxgame.GemProgressModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/character/GemProgressSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFun,this)},i.prototype.getIndex=function(){var t,i=e.JsonDataManager.instance.partStoneAttBufTemplate,n=i.length;this.model.gemLevelIsFull=!1;for(var o=0;n>o;o++)if(this.model.gemLevel<i[o].level){t=o;break}return this.model.gemLevel==i[n-1].level&&void 0==t&&(t=n-1,this.model.gemLevelIsFull=!0),t},i.prototype.refresh=function(){if(void 0!=this.model.gemLevel&&this.getIsInit()){var t=e.JsonDataManager.instance.partStoneAttBufTemplate,i=this.getIndex(),n=(t.length,t[i-1]),o=t[i],a=8;this.model.gemLevelIsFull&&(n=o),this.ui.thisLevel.text=e.LanguageUtils.instance.getValue("QUANSHENGBAOSHIDENGJI")+n.level;for(var s=this.clacGrade(n),r="",l=n.attrTypeList,h=n.attrValueList,c=0;c<l.length;c++){var u=c==l.length-1?"":"\n";r+=e.LanguageUtils.instance.getValue("ATT_"+l[c])+"："+h[c]+u}if(this.ui.thisP.lineSpacing=a,this.ui.thisP.text=r,this.ui.thisP.x=(this.width-this.ui.thisP.width)/2,this.ui.pingfenGroup0.x=this.ui.thisP.x,this.ui.pingfenGroup0.y=this.ui.thisP.y+this.ui.thisP.height+a,this.ui.currentGrade.text=s+"",this.model.gemLevelIsFull){this.ui.pingfenGroup1.visible=!1,this.ui.nextLevel.visible=!1,this.ui.attribute.visible=!1,this.ui.nextStateText.visible=!1;var p=e.JsonDataManager.instance.languageTemplate.GEMISFULL;this.ui.nextP.textFlow=(new egret.HtmlTextParser).parser(p),this.ui.nextP.x=(this.width-this.ui.nextP.width)/2}else{this.ui.nextLevel.text=e.LanguageUtils.instance.getValue("QUANSHENGBAOSHIDENGJI")+o.level;var g="";for(l=o.attrTypeList,h=o.attrValueList,c=0;c<l.length;c++){var u=c==l.length-1?"":"\n";g+=e.LanguageUtils.instance.getValue("ATT_"+l[c])+"："+h[c]+u}this.ui.nextP.lineSpacing=a,this.ui.nextP.text=g,this.ui.nextP.x=(this.width-this.ui.nextP.width)/2,this.ui.pingfenGroup1.x=this.ui.nextP.x,this.ui.pingfenGroup1.y=this.ui.nextP.y+this.ui.nextP.height+a,this.ui.purposGrade.text=this.clacGrade(o)+""}}},i.prototype.clacGrade=function(t){for(var i,n=e.JsonDataManager.instance.attDefTemplate,o=0,a=t.attrTypeList,s=t.attrValueList,r=a.length,l=0;r>l;l++)i=n[a[l]],o+=s[l]*i.score;return Math.floor(o)},i.prototype.closeFun=function(e){this.close()},i}(e.BasePanel);e.GemProgressView=t,__reflect(t.prototype,"foxgame.GemProgressView",["foxgame.IGemProgress","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GemSystemItemCell",t.initView(),t}return __extends(t,e),t.prototype.initView=function(){this.level.text="0"},t.prototype.setItemIcon=function(e){this.iconName=e},t.prototype.setItem=function(e,t,i,n){void 0===t&&(t=1),void 0===i&&(i=!0),void 0===n&&(n=!0),this.item.setItem(e,t,!1)},t.prototype.setSelectedState=function(e){void 0===e&&(e=!1),this.selectedIcon.visible=e},t.prototype.setLevel=function(e){this.itemLevel=e,this.level.text=e.toString()},Object.defineProperty(t.prototype,"index",{set:function(e){this.idx=e},enumerable:!0,configurable:!0}),t.prototype.isShowRedPoint=function(e){void 0===e&&(e=!1),this.redPoint.visible=e},t.prototype.setItemName=function(e){this.itemName.textFlow=(new egret.HtmlTextParser).parser(e)},t.prototype.setItemBGState=function(e){this.item.setGray(e)},t}(eui.Component);e.GemSystemItemCell=t,__reflect(t.prototype,"foxgame.GemSystemItemCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.isCheck=!1,n.mainPanel=i,n.model=e.CharacterController.getInstance().getModel(),n.skinName="GemSystemKin",n.initUI(),n.initListener(),n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var i=0,n=10;n>i;)this["cell"+i].setStar(!1),i++;App.GuideUtils().currPart==e.GuidePart.currPart25&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.upLevelBtn,this.upLevelBtn.parent,e.GuidePart.currPart25,1)},i.prototype.initData=function(){null!=this.model.roleData&&(this.roleInfo=this.model.roleData,this.roleId=this.roleInfo.roleId,this.roleLevel=e.PlayerService.instance.level,this._cellInfos=this.roleInfo.getRoleEquipCellInfo().getCellInfos(),this.showGemPartInfo(),this.showRedPoint(),this.lastrRoleId?this.lastrRoleId!=this.roleId&&(this.isCheck=!1,this.selectItem(),this.selectGem()):(this.isCheck=!1,this.selectItem(),this.selectGem()),this.lastrRoleId=this.roleId)},i.prototype.showGemPartInfo=function(){this.singleCellInfo=this._cellInfos[this.currentSelectItemIndex],this.itemTotalLevel=0,this._gemInfos=this.singleCellInfo.getGemInfo();for(var e=0;e<this.itemList.length;e++)if(null!=this._cellInfos[e]){for(var t=this._cellInfos[e].getGemInfo(),i=0,n=0;n<t.length;n++)i+=t[n].getLevel();this.itemTotalLevel+=i,this.itemList[e].showItemLevel(i)}this.totalLevel.text=this.itemTotalLevel.toString(),this.showGemsInfo()},i.prototype.showGemsInfo=function(){for(var t=0;t<this._gemInfos.length;t++){this.gemList[t].isShowRedPoint(!1),this.gemList[t].setItem(this.gemInfoList[t].id),this.gemList[t].setLevel(this._gemInfos[t].getLevel()),1>t?this._gemInfos[t].getLevel()>0?this.gemList[t].setItemBGState(!1):this.gemList[t].setItemBGState(!0):this._gemInfos[t-1].getLevel()>=5?this.gemList[t].setItemBGState(!1):this.gemList[t].setItemBGState(!0);this.getGemSystemCellInfo(this._gemInfos[t].getLevel(),t);this.gemList[t].setItemName(this.getProperty(this._gemInfos[t].getLevel(),t)),this.gemList[t].setSelectedState(!1),this.showGemRedPoint(t)}this.gemList[this.currentSelectGemIndex].setSelectedState(!0),this.gemIcon.source=this.gemInfoList[this.currentSelectGemIndex].icon;var i=this.gemInfoList[this.currentSelectGemIndex].name,n=this._gemInfos[this.currentSelectGemIndex].getLevel();if(null==this.getGemSystemCellInfo(n+1,this.currentSelectGemIndex))this.needNums.text=i+": "+e.LanguageUtils.instance.getValue("SMELTS_PRO7");else{var o=this.getGemSystemCellInfo(n+1,this.currentSelectGemIndex).costAttribute;this.currentHasGemNum=e.BagController.getInstance().getCountByItemId(this.gemInfoList[this.currentSelectGemIndex].id),this.currentNeedGemNum=o.value,this.needNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentHasGemNum,this.currentNeedGemNum)}},i.prototype.showGemRedPoint=function(t){var i=this._gemInfos[t].getLevel();if(null!=this.getGemSystemCellInfo(i+1,t)){var n=this.gemList[t],o=this.gemInfoList[t],a=this.getGemSystemCellInfo(i+1,t).costAttribute,s=e.BagController.getInstance().getCountByItemId(o.id);s>=a.value&&(1==this._gemInfos[t].getPos()||this._gemInfos[t]&&this._gemInfos[t-1].getLevel()>=5)&&n.isShowRedPoint(!0)}},i.prototype.initUI=function(){this.gemSystemCfg=e.JsonDataManager.instance.partStoneAttTemplate,this.gemCfg=e.JsonDataManager.instance.partStoneTemplate,this.totalLevel.touchEnabled=!1,this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9],this.gemList=[this.gem_0,this.gem_1,this.gem_2,this.gem_3];for(var t=0;t<this.itemList.length;t++)this.itemList[t].index=t,this.itemList[t].setSelectedState(!1),this.itemList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),this.itemList[t].showItemIcon("equipPartGray"+(t+1)+"_png");for(this.itemList[0].setSelectedState(!0),this.itemList[0].showItemIcon("equipPart1_png"),this.currentSelectItemIndex=0,this.currentSelectGemIndex=0,this.setInlayTitle(),this.resetGemInfo(),t=0;t<this.gemList.length;t++)this.gemList[t].index=t,this.gemList[t].setSelectedState(!1),this.gemList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickGem,this)},i.prototype.showRedPoint=function(){e.CharacterController.getInstance().checkGemRedPoint(this.model.roleData);var t=e.CharacterController.getInstance().getGemModuleShowRPAry();if(void 0!=t)for(var i=(t.length,0);i<this.itemList.length;i++){var n=t.indexOf(i)>-1;this.itemList[i].isShowRedPoint(n)}},i.prototype.clickGem=function(e){for(var t=e.currentTarget.idx,i=0;i<this.gemList.length;i++)this.gemList[i].setSelectedState(!1);this.gemList[t].setSelectedState(!0),this.currentSelectGemIndex=t,this.resetGemInfo(),this.showGemsInfo()},i.prototype.clickItem=function(e){this.isCheck=!0;for(var t=e.currentTarget.idx,i=0;i<this.itemList.length;i++)this.itemList[i].setSelectedState(!1),this.itemList[i].showItemIcon("equipPartGray"+(i+1)+"_png");this.itemList[t].setSelectedState(!0),this.itemList[t].showItemIcon("equipPart"+(t+1)+"_png"),this.currentSelectItemIndex=t,this.currentSelectGemIndex=0,this.setInlayTitle(),this.upGemsInfo(),this.resetGemInfo(),this.showGemsInfo(),this.selectGem()},i.prototype.initListener=function(){e.Message.instance.add(e.Code.EQUIP_CELL_SYNC,this),this.upLevelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.gemBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this)},i.prototype.btClick=function(t){switch(t.target){case this.upLevelBtn:if(this.currentHasGemNum<this.currentNeedGemNum){var i=this.gemInfoList[this.currentSelectGemIndex];return void e.ItemNotEnoughController.getInstance().showPanel(i.id)}var n=this._gemInfos[this.currentSelectGemIndex].getLevel();if(null==this.getGemSystemCellInfo(n+1,this.currentSelectGemIndex))return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("BAOSHIYIDAZUIDASHANGXIAN"));if(this.currentSelectGemIndex>0){var o=this._gemInfos[this.currentSelectGemIndex-1].getLevel();if(5>o)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SHANGKEBAOSHIXUDA5JI"))}var a=HawkProtocolManager.newBuilder("JsProto.HPEquipCellStoneUpgradeReq");a.setPartId(this.currentSelectItemIndex+1),a.setRoleId(this.roleId),a.setIndex(this.currentSelectGemIndex+1),e.Message.instance.send(e.Code.GEM_SYSTEM_UP_LEVEL,a,!0),App.GuideUtils().currPart==e.GuidePart.currPart25&&1==App.GuideUtils().currStep&&e.CharacterController.getInstance().guideshow();break;case this.gemBtn:e.GemProgressController.getInstance().showPanel(this.itemTotalLevel)}},i.prototype.selectGem=function(e){void 0===e&&(e=0);var t=this.isRedGem(e);if(!t)for(var i=0;4>i;i++)if(t=this.isRedGem(i)){for(var n=0;n<this.gemList.length;n++)this.gemList[n].setSelectedState(!1);this.gemList[i].setSelectedState(!0),this.currentSelectGemIndex=i,this.resetGemInfo(),this.showGemsInfo()}},i.prototype.isRedGem=function(t){var i=this._gemInfos[t].getLevel();if(null==this.getGemSystemCellInfo(i+1,t))return!1;var n=this.gemInfoList[t],o=this.getGemSystemCellInfo(i+1,t).costAttribute,a=e.BagController.getInstance().getCountByItemId(n.id);return a>=o.value&&(1==this._gemInfos[t].getPos()||this._gemInfos[t]&&this._gemInfos[t-1].getLevel()>=5)?!0:!1},i.prototype.selectItem=function(t){void 0===t&&(t=0);var i=e.CharacterController.getInstance().getGemModuleShowRPAry();if(void 0!=i){var n=i.indexOf(t)>-1;n&&0==t&&(this.pretermissionItem(i[0]),this.isCheck=!1),!n&&i.length>0&&(this.pretermissionItem(i[0]),this.isCheck=!1)}},i.prototype.pretermissionItem=function(e){for(var t=0;t<this.itemList.length;t++)this.itemList[t].setSelectedState(!1),this.itemList[t].showItemIcon("equipPartGray"+(t+1)+"_png");this.itemList[e].setSelectedState(!0),this.itemList[e].showItemIcon("equipPart"+(e+1)+"_png"),this.currentSelectItemIndex=e,this.currentSelectGemIndex=0,this.setInlayTitle(),this.upGemsInfo(),this.resetGemInfo(),this.showGemsInfo()},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.upGemsInfo=function(){this._gemInfos=this._cellInfos[this.currentSelectItemIndex].getGemInfo()},i.prototype.setInlayTitle=function(){7==this.currentSelectItemIndex?this.inlayTips.source="titleImg_2_png":8==this.currentSelectItemIndex?this.inlayTips.source="titleImg_3_png":this.inlayTips.source="titleImg_"+this.currentSelectItemIndex.toString()+"_png"},i.prototype.resetGemInfo=function(){var t=this.gemCfg[this.currentSelectItemIndex+1],i=e.JsonDataManager.instance.itemTemplate;this.gemInfo_0=i[t.stone1Id],this.gemInfo_1=i[t.stone2Id],this.gemInfo_2=i[t.stone3Id],this.gemInfo_3=i[t.stone4Id],this.gemInfoList=[this.gemInfo_0,this.gemInfo_1,this.gemInfo_2,this.gemInfo_3]},i.prototype.getProperty=function(t,i){var n="";if(1>t)n="<font color=0x60E021>"+this.gemInfoList[i].name+e.LanguageUtils.instance.getValue("WEIJIHUO")+"</font>";else for(var o=this.getGemSystemCellInfo(t,i),a=function(t){return e.JsonDataManager.instance.attDefTemplate[t]},s=0;s<o.attrTypeList.length;s++)n+="<font color="+a(o.attrTypeList[s]).gemColor+">"+e.LanguageUtils.instance.getValue("ATT_"+o.attrTypeList[s])+"+"+e.GlobalUtil.getAttrValueStr(o.attrTypeList[s],o.attrValueList[s])+"</font>",n+="<font>\n</font>";return n},i.prototype.getGemSystemCellInfo=function(e,t){var i=this.gemSystemCfg[this.currentSelectItemIndex+1+"_"+(t+1)+"_"+e];return i},i.prototype.recvMsg=function(t,i){if(t==e.Code.EQUIP_CELL_SYNC){var n=this.currentSelectGemIndex,o=this.currentSelectItemIndex,a=i.cellInfos[o],s=a.gemInfo[n];null!=this.parent&&this.parent instanceof eui.Group&&(1==s.level?this.playAni():this.playAni(),this.itemList[this.currentSelectItemIndex].playAni()),this._cellInfos=i.cellInfos,this.showGemPartInfo(),this.selectItem(this.currentSelectItemIndex),this.selectGem(this.currentSelectGemIndex)}},i}(e.ViewControler);e.GemSystemView=t,__reflect(t.prototype,"foxgame.GemSystemView",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var n=t.call(this)||this;return n.sitetype=1,n.fashiondata=[],n.fashionattribute=[],n.upbool=!1,n.selected_=0,n.skinName="Latestfashionpanel",n.model=e.CharacterController.getInstance().getModel(),i._instance=n,n}return __extends(i,t),i.getInstance=function(){return null==this._instance,this._instance},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initview(),this.initlisten(),this.tweenavatar()},i.prototype.cleanUiRes=function(){var t=!1;if(t){Log.trace("#####close Latestfashionpanel begin transform");var i=egret.getTimer();e.GlobalUtil.doTransformDisplayObjectContainerDestroyBitmapRes(this.avatar,!1);var n=egret.getTimer()-i;Log.trace("#####close Latestfashionpanel end transform, cost time: "+n)}else{Log.trace("#####close Latestfashionpanel begin transform");var i=egret.getTimer(),o=e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource(this.avatar),a=e.GlobalUtil.arrayUnique(o);e.GlobalUtil.transformResIdArrayDoConditionalDestroy(a,!1);var s=e.CharacterController.getInstance().getPanel().getUiBaseName(),r=AssetAdapter.getInstance().getBaseComponentUiResArray(s);if(r)for(var l in a){var h=a[l];r[h]&&(r[h]=!1)}var n=egret.getTimer()-i;Log.trace("#####close Latestfashionpanel end transform, cost time: "+n)}this.avatar.notifyUnLoadImageRes()},i.prototype.tweenavatar=function(){egret.Tween.get(this.avatar,{loop:!0}).wait(350).to({scaleX:1.03,scaleY:1.04},1e3).wait(200).to({scaleX:1,scaleY:1},800)},i.prototype.initview=function(){var e=[];this.nowshizhuang.text="",e.push({text:"",style:{textColor:"aeaeae"}}),this.xiaohaotxt.textFlow=e;var t=[];t.push({text:"",style:{textColor:"aeaeae"}}),this.thisProperty.textFlow=t,this.sitetype=1,this.btn1.restore(),this.btn2.restore(),this.btn3.restore(),this.btn1.setSelectedState(!0),this.scroller.horizontalScrollBar,this.avatar.hidewing(),this.settingmoxing()},i.prototype.settingmoxing=function(){var t=this.model.roleData.getRoleEquipByPart(e.EquipPartType.CLOTHES),i=null!=t?t.getEquipItemId():-1;this.model.roleData.roleInfo.getFashionClothesId()>0&&(this.clothesId=this.model.roleData.roleInfo.getFashionClothesId());var n=this.model.roleData.getRoleEquipByPart(e.EquipPartType.WEAPON),o=null!=n?n.getEquipItemId():-1;this.model.roleData.roleInfo.getFashionWeaponId()>0&&(this.weaponId=this.model.roleData.roleInfo.getFashionWeaponId()),this.model.roleData.roleInfo.getFashionWingId()>0&&(this.wingId=this.model.roleData.roleInfo.getFashionWingId());var a=this.model.roleData.wingId,s=this.model.roleData.roleInfo,r=s.getDragonArmourShowGuard()?s.getDragonArmourGuardLevel():-1,l=s.getWardState()?s.getWardLevel():-1;this.avatar.setAvatar(this.model.roleData.itemId,i,o,a,this.clothesId,this.weaponId,Number(this.wingId),r,l)},i.prototype.settingavatar=function(){var t=this.model.roleData.getRoleEquipByPart(e.EquipPartType.CLOTHES),i=null!=t?t.getEquipItemId():-1,n=this.model.roleData.getRoleEquipByPart(e.EquipPartType.WEAPON),o=null!=n?n.getEquipItemId():-1,a=this.model.roleData.wingId,s=this.model.roleData.roleInfo,r=s.getDragonArmourShowGuard()?s.getDragonArmourGuardLevel():-1,l=s.getWardState()?s.getWardLevel():-1;this.avatar.setAvatar(this.model.roleData.itemId,i,o,a,this.clothesId,Number(this.weaponId),Number(this.wingId),r,l)},i.prototype.fashiondataback=function(){this.fashionlist=[],this.group.removeChildren();var t=JSON.parse(JSON.stringify(this.fashiondata));if(!(t.length<=0)){for(var i=0;i<t.length;i++){var n=t[i],o=new e.SmeltWeaponItemCell;o.x=i*o.width+10,o.restore(),o.itemData=n,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addview,this),this.group.addChild(o),this.fashionlist.push(o)}this.fashionlist.length<=0}},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.aniGroup.visible=!0},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.initlisten=function(){e.Message.instance.add(e.Code.PLAYER_FASHION_INFO_S,this),e.Message.instance.add(e.Code.FASHION_ACTIVATE_S,this),e.Message.instance.add(e.Code.FASHION_WEAR_INFO_S,this),this.sendfashioninfo(),this.checkBoxBtn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.zhuangbandashi.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.xiaohaotxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnckickbtn,this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnckickbtn,this),this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnckickbtn,this),this.upLevelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this)},i.prototype.removeFromStage=function(){e.Message.instance.remove(e.Code.PLAYER_FASHION_INFO_S,this),e.Message.instance.remove(e.Code.FASHION_ACTIVATE_S,this),e.Message.instance.remove(e.Code.FASHION_WEAR_INFO_S,this),this.checkBoxBtn_0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.zhuangbandashi.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.xiaohaotxt.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.btn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnckickbtn,this),this.btn2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnckickbtn,this),this.btn3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnckickbtn,this),this.upLevelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnclick,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)},i.prototype.sendfashioninfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPFashionInfoReq");t.setRoleId(this.model.roleData.roleId),e.Message.instance.send(e.Code.PLAYER_FASHION_INFO_C,t,!0)},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.PLAYER_FASHION_INFO_S:this.fashionDataAll=i;for(var n=0;n<this.model.fashiondataAll.length;n++)this.model.fashiondataAll[n].getRoleId()==this.fashionDataAll.getRoleId()&&(this.model.fashiondataAll[n]=this.fashionDataAll);this.getfashionres(),this.fashiondataback(),this.initdata();var o=1==this.showredpiont(i)?1:0;e.RedPointController.getInstance().setOperateByType(e.RedPointId.FASHION_RED_DOT,o);break;case e.Code.FASHION_ACTIVATE_S:if(this.upLevelBtn.enabled=!0,0!=i.errorNo)return;this.playAni(),this.sendfashioninfo();break;case e.Code.FASHION_WEAR_INFO_S:if(0!=i.errorNo)return;this.sendfashioninfo()}},i.prototype.btnckickbtn=function(e){switch(e.currentTarget){case this.btn1:this.switchbtn(1);break;case this.btn2:this.switchbtn(2);break;case this.btn3:this.switchbtn(3)}},i.prototype.btnclick=function(t){switch(t.target){case this.checkBoxBtn_0:if("disabled"==this.checkBoxBtn_0.currentState)return;this.checkBoxBtn_0.currentState="down"==this.checkBoxBtn_0.currentState?"up":"down";var i=HawkProtocolManager.newBuilder("JsProto.HPWearFashionReq");i.setRoleId(this.roledata.roleId),i.setFashionId(this.upshizhuangid),i.setTypeId(Number(this.upsitetype)),"down"==this.checkBoxBtn_0.currentState?i.setDisplay(!0):i.setDisplay(!1),e.Message.instance.send(e.Code.FASHION_WEAR_INFO_C,i,!0);break;case this.zhuangbandashi:this.model.zhuangbandata=[],this.model.zhuangbandata=0==this.fashionattribute.length?0:this.fashionattribute,this.model.zhuagnbanscore=this.fashionscore,e.CharacterController.getInstance().totalAttrPanelshow();break;case this.upLevelBtn:if(!this.fashionProp)return;var n=e.BagController.getInstance().getCountByItemId(this.fashionProp[2]);if(n<Number(this.fashionProp[1]))return void e.ItemNotEnoughController.getInstance().showPanel(this.fashionProp[2]);var o=Number(e.GlobalConfig.instance.getValue("FASHION_MAX_LEVEL"));if(this.uplevel>=o)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));this.upLevelBtn.enabled=!1;var a=HawkProtocolManager.newBuilder("JsProto.HPFashionBuyReq");a.setFashionId(this.upshizhuangid),a.setRoleId(this.roledata.roleId),a.setTypeId(Number(this.upsitetype)),e.Message.instance.send(e.Code.FASHION_ACTIVATE_C,a,!0);break;case this.xiaohaotxt:var s=e.BagController.getInstance().getCountByItemId(this.fashionProp[2]);e.TipsController.getInstance().showItemTips(Number(this.fashionProp[2]),s,!0)}},i.prototype.switchbtn=function(e){this.btn1.setSelectedState(1==e),this.btn2.setSelectedState(2==e),this.btn3.setSelectedState(3==e),this.sitetype!=e&&(this.sitetype=e,this.getfashionres(),this.fashiondataback(),this.upbool=!1,this.initdata())},i.prototype.xianshiavatar=function(){this.sendfashioninfo(),this.settingavatar()},i.prototype.rolechange=function(){this.roledata&&this.roledata.roleId!=this.model.roleData.roleId&&(this.roledata=this.model.roleData,this.upbool=!1,this.sendfashioninfo())},i.prototype.initdata=function(){this.roledata=this.model.roleData;for(var t=0;t<this.fashionlist.length;t++){var i=this.fashionlist[t],n=this.fashiondata[t].cost.id,o=e.BagController.getInstance().getCountByItemId(parseInt(n));if(i.setItemIconname(n),i.setlevel1(this.fashiondata[t].level),Number(this.fashiondata[t].level)<Number(e.GlobalConfig.instance.getValue("FASHION_MAX_LEVEL"))){var a=e.JsonDataManager.instance.fashionTemplate.getFashionInfoByEquipIdAndlevel(this.fashiondata[t].equipId,this.fashiondata[t].level+1);o>=Number(a.cost.value)?i.isShowRedPoint(!0):i.isShowRedPoint(!1)}1==this.fashiondata[t].wearState&&0==this.upbool?(this.setSelectedStatelist(),this.fashionlist[t].setSelectedState(!0),this.datashow(this.fashionlist[t].data),this.selected_=t,this.upbool=!0):t>=this.fashionlist.length-1&&(this.fashionlist[this.selected_].setSelectedState(!0),this.datashow(this.fashionlist[this.selected_].data))}},i.prototype.addview=function(e){this.setSelectedStatelist();var t=e.currentTarget,i=this.fashionlist.indexOf(t);this.selected_=i,t.setSelectedState(!0);var n=JSON.parse(JSON.stringify(t._itemData));this.datashow(n)},i.prototype.setSelectedStatelist=function(){if(this.fashionlist.length>0)for(var e=0;e<this.fashionlist.length;e++){var t=this.fashionlist[e];t.setSelectedState(!1)}},i.prototype.datashow=function(t){this.checkBoxBtn_0.currentState=1==t.activate?"disabled":1==t.wearState?"down":"up",this.showtxt.textFlow=(new egret.HtmlTextParser).parser("disabled"==this.checkBoxBtn_0.currentState?e.LanguageUtils.instance.getValue("WEIJIHUOWUKUANG"):e.LanguageUtils.instance.getValue("XIANSHI"));var i=this.fashionProp=this.settingconsume(t),n=this.getItemTemp()[i[2]].quality;this.nowshizhuang.text=t.name,this.nowshizhuang.textColor=e.ColorUtils.instance.getColorByQuality(n),Number(t.level)<Number(e.GlobalConfig.instance.getValue("FASHION_MAX_LEVEL"))?this.xiaohaotxt.textFlow=(new egret.HtmlTextParser).parser("<font color='#aeaeae' stroke=0.5>"+e.LanguageUtils.instance.getValue("XUYAO")+":</font><font color="+e.ColorUtils.instance.getColorByQuality(n)+" stroke=0.5><u>"+i[0]+"</u></font><font color='#fff600' stroke=0.5>x"+i[1]+"</font>"):this.xiaohaotxt.textFlow=(new egret.HtmlTextParser).parser("<font color='#fff600' stroke=0.5 textAlign='center'>"+e.LanguageUtils.instance.getValue("YIMANJI")+"</font>"),this.upLevelBtn.label=1==t.activate?e.LanguageUtils.instance.getValue("JIHUO"):e.LanguageUtils.instance.getValue("SHENGJI"),"1"==t.siteType?this.weaponId=t.equipId:"2"==t.siteType?this.clothesId=t.equipId:"3"==t.siteType&&(this.wingId=t.equipId);var o=e.BagController.getInstance().getCountByItemId(i[2]);o>=i[1]&&1==t.activate?this.playani():this.anigroup.visible=!1,this.xinayou.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("XIANYOU",o)),this.upsitetype=Number(t.siteType),this.upshizhuangid=Number(t.equipId),this.uplevel=Number(t.level),this.settingavatar();for(var a=[],s=0;s<t.attrTypeList.length;s++)a.push({text:e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[s])+":",style:{textColor:e.ColorUtils.instance.getAttrColorById(t.attrTypeList[s])}}),a.push({text:e.GlobalUtil.getAttrValueStr(t.attrTypeList[s],Number(t.attrValueList[s])),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(t.attrTypeList[s])}}),a.push({text:"\n"});this.thisProperty.textFlow=a},i.prototype.playani=function(){this.anigroup.visible=!0,this.aniplay||this.aniplay||(this.aniplay=new e.FoxAni(this.anigroup),this.aniplay.play("rechargeAnimation","ani",-1))},i.prototype.settingconsume=function(t){var i,n=new Object(this.getfashiondata()),o=new Object(this.getItemTemp()),a=Number(e.GlobalConfig.instance.getValue("FASHION_MAX_LEVEL")),s=1==t.activate?0:Number(t.level)==a?0:1;for(var r in n){Number(n[r].equipId),Number(n[r].level);Number(n[r].equipId)!=Number(t.equipId)||Number(n[r].level)!=Number(t.level)+s||(i=n[r].cost)}var l,h=new Array;return l=o[parseInt(i.id)],h.push(l.name),h.push(i.value),h.push(i.id),h},i.prototype.getfashionres=function(){if(this.fashiondata=[],this.fashionDataAll){var e=new Object(this.fashiondata_All(this.fashionDataAll)),t=[];for(var i in e)e[i].siteType==this.sitetype&&t.push(e[i]);this.setbtnott(e),this.fashiondata=t}},i.prototype.setbtnott=function(e){this.btn1.setItemIconname(""),this.btn2.setItemIconname(""),this.btn3.setItemIconname(""),this.btn1.setItemIconfashion("zhuangban_wuqibtn1_jpg"),this.btn2.setItemIconfashion("zhuangban_yijiabtn1_jpg"),this.btn3.setItemIconfashion("zhuangban_chibangbtn1_jpg"),this.btn1.setlevel1(""),this.btn2.setlevel1(""),this.btn3.setlevel1("");for(var t in e)1==e[t].wearState&&("1"==e[t].siteType?(this.btn1.setlevel1(e[t].level),this.btn1.setItemIconname(e[t].cost.id)):"2"==e[t].siteType?(this.btn2.setlevel1(e[t].level),this.btn2.setItemIconname(e[t].cost.id)):"3"==e[t].siteType&&(this.btn3.setlevel1(e[t].level),this.btn3.setItemIconname(e[t].cost.id)))},i.prototype.fashiondata_All=function(e){var t=new Object(this.getfashiondata()),i=new Object(this.fashiondata_zero()),n=new Array,o=e.getTypeInfo();this.fashionscore=e.getScoreNumber(),this.fashionattribute=e.getAttribute();for(var a in t){var s=new Object(t[a]);s.wearState=!1;for(var r=0;r<o.length;r++){var l=new Object(o[r]);Number(s.equipId)==l.fashionId&&s.level==l.fashionLevel&&(s.wearState=l.wearState,n.push(s))}}var h=new Object(i);for(var c in h){h[c].activate=!0;for(var u=0;u<n.length;u++){var p=new Object(n[u]);h[c].equipId==Number(p.equipId)&&(h[c]=p,h[c].activate=!1)}}return h},i.prototype.fashiondata_zero=function(){var e=new Object(this.getfashiondata()),t=new Object;for(var i in e){var n=new Object(e[i]);1==Number(n.level)&&(t[n.equipId]=n)}return t},i.prototype.showredpiont=function(t){this.btn1.isShowRedPoint(!1),this.btn2.isShowRedPoint(!1),this.btn3.isShowRedPoint(!1);var i=!1,n=this.fashiondata_All(t);for(var o in n){var a=n[o],s=a.cost.id,r=(a.cost.value,e.BagController.getInstance().getCountByItemId(parseInt(s)));Number(a.level)<Number(e.GlobalConfig.instance.getValue("FASHION_MAX_LEVEL"))&&Number(r)>=this.fashionProp[1]&&("1"==a.siteType?this.btn1.isShowRedPoint(!0):"2"==a.siteType?this.btn2.isShowRedPoint(!0):"3"==a.siteType&&this.btn3.isShowRedPoint(!0),i=!0)}return i},i.prototype.getFashionInItemIcon=function(e){var t=new Object(this.fashiondata_zero()[e]),i=new Object(this.getItemTemp()[t.cost.id]);return i.id},i.prototype.getfashiondata=function(){var t=new Object(e.JsonDataManager.instance.fashionTemplate);return t},i.prototype.getItemTemp=function(){var t=new Object(e.JsonDataManager.instance.itemTemplate);return t},i}(eui.Component);e.Latestfashionpanel=t,__reflect(t.prototype,"foxgame.Latestfashionpanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/medal/medalTotalSkin.exml")||this;return i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.initHook=function(){},i.prototype.showHook=function(){this.ui.zongshuxing.visible=!1,this.ui.tou.visible=!0;var t=this.model.zhuangbandata,i=e.GlobalConfig.instance.getValue("SHIZHUANGXIANGSHI"),n=i.split(",");this.ui.totalGrade.text=this.model.zhuagnbanscore,this.ui.attrText.lineSpacing=8;for(var o=[],a=0;a<n.length;a++){var s=t[a];if(s)for(var r=0;r<n.length;r++)s.attrId==Number(n[r])&&(o.push({text:e.LanguageUtils.instance.getValue("ATT_"+s.attrId)+": ",style:{textColor:e.ColorUtils.instance.getAttrColorById(s.attrId)}}),o.push({text:e.GlobalUtil.getAttrValueStr(s.attrId,Number(s.attrValue)),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(s.attrId)}}),o.push({text:"\n"}));
else o.push({text:e.LanguageUtils.instance.getValue("ATT_"+n[a])+": ",style:{textColor:e.ColorUtils.instance.getAttrColorById(Number(n[a]))}}),o.push({text:e.GlobalUtil.getAttrValueStr(Number(n[a]),0),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(Number(n[a]))}}),o.push({text:"\n"})}this.ui.attrText.textFlow=o},i}(e.BasePanel);e.Latestfashiontips=t,__reflect(t.prototype,"foxgame.Latestfashiontips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panel=new e.CharacterOpenPanel}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.showPanel=function(){this.panel.show()},t}();e.CharacterOpenController=t,__reflect(t.prototype,"foxgame.CharacterOpenController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="CharacterOpenItemSkin",this.imgBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.initData=function(e,t,i,n){this.openPanel=e,this.profession=t,this.sex=i,this.isOpen=n,this.refresh()},i.prototype.setSex=function(e){this.isOpen||(this.sex=e,this.refresh())},i.prototype.refresh=function(){var t;this.proImg1.visible=!1,this.proImg2.visible=!1,this.proImg3.visible=!1,this.sex==e.RoleSexType.MAN?this.profession==e.ProfessionType.PROFESSION1?(t="roleImg11",this.proImg1.visible=!0):this.profession==e.ProfessionType.PROFESSION2?(t="roleImg21",this.proImg2.visible=!0):this.profession==e.ProfessionType.PROFESSION3&&(t="roleImg31",this.proImg3.visible=!0):this.sex==e.RoleSexType.WOMAN&&(this.profession==e.ProfessionType.PROFESSION1?(t="roleImg12",this.proImg1.visible=!0):this.profession==e.ProfessionType.PROFESSION2?(t="roleImg22",this.proImg2.visible=!0):this.profession==e.ProfessionType.PROFESSION3&&(t="roleImg32",this.proImg3.visible=!0)),this.charImg.source=t,this.openImg.visible=this.isOpen},i.prototype.clickHandler=function(e){this.openPanel.itemClickHandler(this)},i}(eui.Component);e.CharacterOpenItem=t,__reflect(t.prototype,"foxgame.CharacterOpenItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/character/CharacterOpenPanelSkin.exml","characterOpenPanelGroup")||this;return e.itemPosList=[],e.tweenTime=500,e.isMask=!1,e.isMaskdown=!0,e.adaptionType=1,e}return __extends(i,t),i.prototype.initHook=function(){for(var e,t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],e=new egret.Point(Math.floor(t.x),Math.floor(t.y)),this.itemPosList.push(e);this.ui.manRadioBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sexClickHandler,this),this.ui.womanRadioBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sexClickHandler,this),this.ui.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createHandler,this),this.ui.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changePositionHandler,this),this.ui.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changePositionHandler,this),this.doScreenAdaptation()},i.prototype.showHook=function(){e.MainControler.instance.checkHuoBanGroup(!1)},i.prototype.initParams=function(){null==this.roleTemp&&(this.roleTemp=e.JsonDataManager.instance.roleByProfessionAndSexTemplate),this.curSex=-1,this.isTweening=!1;for(var t,i,n=this.getItemList(),o=n.length,a=0;o>a;a++)t=n[a],i=this.itemPosList[a],t.x=i.x,t.y=i.y;this.scaleItem(n[1],this.itemPosList[1].x,this.itemPosList[1].y)},i.prototype.refresh=function(){var t,i,n,o,a,s=e.PlayerService.instance.getRoleDataList();s.length;i=s[0],-1==this.curSex&&(i.roleVO.sex==e.RoleSexType.MAN?this.curSex=e.RoleSexType.WOMAN:this.curSex=e.RoleSexType.MAN);for(var r=1,l=this.getItemList(),h=0;3>h;h++)t=e.PlayerService.instance.getRoleDataByProfession(r),n=l[h],o=null!=t?t.roleVO.sex:this.curSex,a=null!=t,n.initData(this,r,o,a),r++;var c,u,p=e.PlayerService.instance.getRoleDataList().length;1==p?(c=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV1")),u=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV1"))):(c=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV2")),u=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV2"))),this.ui.limitLvLabel.text=c+e.LanguageUtils.instance.getValue("JI"),this.ui.limitVIPLabel.text=e.LanguageUtils.instance.getValue("VIP")+u,this.refreshSex();var g;0==this.curIndex?g=e.ProfessionType.PROFESSION1:1==this.curIndex?g=e.ProfessionType.PROFESSION2:2==this.curIndex&&(g=e.ProfessionType.PROFESSION3),t=e.PlayerService.instance.getRoleDataByProfession(g),this.ui.groupCreateBtn.visible=null==t},i.prototype.refreshSex=function(){this.ui.manRadioBtn.selected=this.curSex==e.RoleSexType.MAN,this.ui.womanRadioBtn.selected=this.curSex==e.RoleSexType.WOMAN},i.prototype.changePositionHandler=function(e){if(!this.isTweening)switch(e.target){case this.ui.leftBtn:this.tweenFunc(1);break;case this.ui.rightBtn:this.tweenFunc(2)}},i.prototype.itemClickHandler=function(e){if(!this.isTweening){var t=this.itemPosList[1];if(e.x!=t.x||e.y!=t.y){var i=0;e.x==this.itemPosList[0].x&&e.y==this.itemPosList[0].y?i=2:e.x==this.itemPosList[2].x&&e.y==this.itemPosList[2].y&&(i=1),this.tweenFunc(i)}}},i.prototype.tweenFunc=function(e){this.isTweening=!0,this.startTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this);for(var t,i,n=this.getItemList(),o=n.length,a=(this.ui.groupChar,0);o>a;a++)i=this.itemPosList[a],t=this.getItemByPos(i.x,i.y);for(var s,r=[],a=0;o>a;a++)t=n[a],r.push(new egret.Point(t.x,t.y));for(var a=0;o>a;a++)t=n[a],1==e?s=0>a-1?2:a-1:2==e&&(s=a+1>2?0:a+1),t.targetX=r[s].x,t.targetY=r[s].y,this.scaleItem(t,t.targetX,t.targetY),TweenMax.to(t,this.tweenTime/1e3,{x:t.targetX,y:t.targetY,onComplete:function(e){TweenMax.killTweensOf(e)},onCompleteParams:[t]})},i.prototype.scaleItem=function(e,t,i){t==this.itemPosList[1].x&&i==this.itemPosList[1].y?(e.scaleX=e.scaleY=1.5,e.parent.setChildIndex(e,-1),e.touchEnabled=!1,e.touchChildren=!1):(e.touchEnabled=!0,e.touchChildren=!0,e.scaleX=e.scaleY=.8)},i.prototype.enterFrame=function(e){if(egret.getTimer()-this.startTime>=this.tweenTime){var t=this.getItemList();this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this);for(var i=void 0,n=t.length,o=0;n>o;o++)i=t[o],i.x=i.targetX,i.y=i.targetY;this.isTweening=!1,this.refresh()}},i.prototype.sexClickHandler=function(t){switch(t.target){case this.ui.manRadioBtn:this.curSex=e.RoleSexType.MAN;break;case this.ui.womanRadioBtn:this.curSex=e.RoleSexType.WOMAN}for(var i,n=this.getItemList(),o=n.length,a=0;o>a;a++)i=n[a],i.setSex(this.curSex);this.refreshSex()},i.prototype.createHandler=function(t){var i,n,o=e.PlayerService.instance.getRoleDataList().length,a=e.PlayerService.instance.level,s=e.PlayerService.instance.vipLevel;if(1==o?(i=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV1")),n=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV1"))):(i=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV2")),n=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV2"))),i>a&&n>s)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CHARACTEROPENTIP",i,n));if(!this.isTweening){var r=this.getItemList(),l=r[this.curIndex],h=this.roleTemp[l.profession+"_"+l.sex],c=HawkProtocolManager.newBuilder("JsProto.HPRoleCreate");c.setRoleItemId(h.id),c.setRoleName("asdf"),e.Message.instance.send(e.Code.ROLE_CREATE_OTHER_C,c,!0),e.MainControler.instance.hbani(),App.SoundManager().playEffect("sound_activate_mp3"),this.close()}},Object.defineProperty(i.prototype,"curIndex",{get:function(){for(var e,t=this.itemPosList[1],i=this.getItemList(),n=i.length,o=0;n>o;o++)if(e=i[o],Math.floor(e.x)==t.x&&Math.floor(e.y)==t.y)return o;return-1},enumerable:!0,configurable:!0}),i.prototype.getItemByPos=function(e,t){for(var i,n=this.getItemList(),o=n.length,a=0;o>a;a++)if(i=n[a],i.x==e&&i.y==t)return i;return i},i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e},i}(e.BasePanel);e.CharacterOpenPanel=t,__reflect(t.prototype,"foxgame.CharacterOpenPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.bubbleWidth=475,e.chatLableInitHeight=20,e.chatLableInitHeightO=20,e.csType=0,e.isCamp=!1,e.isshowMutual=!0,e.skinName="ChatAllSayItemSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.currentData=this.data;var i=(this.currentData.type,e.PlayerService.instance.playerInfo.getPlayerId()),n=(this.chatGroup.numChildren,this.chatGroupO.numChildren,0);for(n;n<this.chatGroup.numChildren;n++){var o=this.chatGroup.getChildAt(n);o!=this.chatLable&&(o.parent.removeChild(o),n--)}for(n=0;n<this.chatGroupO.numChildren;n++){var a=this.chatGroupO.getChildAt(n);a!=this.chatLableO&&(a.parent.removeChild(a),n--)}if(null!=this.currentData.data&&this.currentData.type!=(e.ChatType.XITONGGONGGAO||e.ChatType.GONGHUILIAOTIAN)){var s=this.currentData.data;if(this.NoticeGroup.visible=!1,this.currentData.isStr){var r=this.currentData.data;return this.NoticeGroup.visible=!0,this.ownSayGroup.visible=!1,this.otherSayGroup.visible=!1,void this.setUnionNoticeMsg(r)}s.getPlayerId()==i?(this.ownSayGroup.visible=!0,this.otherSayGroup.visible=!1,this.setChatOwnMsg(s)):(this.ownSayGroup.visible=!1,this.otherSayGroup.visible=!0,this.setChatOtherSayMsg(s))}else if(null!=this.currentData.data&&this.currentData.type==(e.ChatType.XITONGGONGGAO||e.ChatType.GONGHUILIAOTIAN)){var l=this.currentData.data;if(this.currentData.isStr){var r=this.currentData.data;return this.NoticeGroup.visible=!0,this.ownSayGroup.visible=!1,this.otherSayGroup.visible=!1,void this.setUnionNoticeMsg(r)}this.NoticeGroup.visible=!0,this.ownSayGroup.visible=!1,this.otherSayGroup.visible=!1,this.setChatNoticeMsg(l)}this.currentData.type==(e.ChatType.ALLCAMP+1||e.ChatType.SINGLECAMP+1)?this.isshowMutual=!1:this.isshowMutual=!0},i.prototype.setChatNoticeMsg=function(t){this.dataNew=t;var i=e.MarqueeController.getInstance().createLableText(t),n=t.getType();(132==n||133==n||134==n)&&this.bubble.removeEventListener(egret.TextEvent.LINK,this.linkHandler,this),this.bubble.textFlow=(new egret.HtmlTextParser).parser(i),this.bubble.y=this.height/2-this.bubble.height/2},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.bubble.addEventListener(egret.TextEvent.LINK,this.linkHandler,this),this.nameLable.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this),this.headPortrait.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this)},i.prototype.setUnionNoticeMsg=function(e){this.bubble.textFlow=(new egret.HtmlTextParser).parser(e),this.bubble.y=this.height/2-this.bubble.height/2},i.prototype.linkHandler=function(t){var i,n=e.PlayerService.instance.playerInfo.getLevel();if(-1!=t.text.indexOf("playerId")){var o=t.text,a=o.split("_");if("-1"==a[1])return;var s=Number(t.text.split("_")[1]);e.OtherCharacterController.getInstance().showOtherCharacterPanel(s)}else if(-1!=t.text.indexOf("csRoleId_")){var r=t.text.substr("csRoleId_".length);e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,r,1)}else if(-1!=t.text.indexOf("csRoleId2_")){var r=t.text.substr("csRoleId2_".length);e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,r,2)}else if(-1!=t.text.indexOf("KFpeopleId_")){var r=t.text.substr("KFpeopleId_".length);e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,r,3)}else if(-1!=t.text.indexOf("itemId")){var s=Number(t.text.split("_")[1]),l=e.JsonDataManager.instance.itemTemplate[s];if(l.type==e.ItemType.SOUL)e.TipsController.getInstance().showSoulTips(l.id);else if(l.type==e.ItemType.EQUIP){var h=e.JsonDataManager.instance.equipTemplate[s];e.TipsController.getInstance().showEquipTips({profession:h.profession,equipInfo:this.dataNew.getEquipInfo().getEquipInfo(),showLock:!1,showReplace:!1})}else l.type==e.ItemType.DRAGONBONE?e.TipsController.getInstance().showDragonPanelByinfo(this.dataNew.getEquipInfo().getDragonBoneInfo()):l.type==e.ItemType.SKILLSTONE?e.TipsController.getInstance().showDragonArmorSkillTips(s):l.type==e.ItemType.DRAGONARMOR?this.dataNew.getEquipInfo()?e.TipsController.getInstance().showDragonArmorBydata(this.dataNew.getEquipInfo().getDragonArmourInfo()):e.TipsController.getInstance().showDragonArmorTips(s,!1):e.TipsController.getInstance().showItemTips(s)}else if(-1!=t.text.indexOf("turn_xunbao"))e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.SEARCHTREASURE);else if(-1!=t.text.indexOf("turn_chibangshengjie")){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHIBANG),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHIBANG),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WINGOPEN",n));e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.WING_SYSTEM)}else if(-1!=t.text.indexOf("turn_zhuangbeishengxing")){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEISHENGXING),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHUANGBEISHENGXING",n));e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.EQUIP_UP_STAR)}else if(-1!=t.text.indexOf("turn_viplibao")){if(e.PlayerService.instance.playerInfo.getVipLevel()<16)e.LegendaryEquipController.getInstance().showPanel();else if(e.PlayerService.instance.playerInfo.getVipLevel()>=16){var c=e.CreateNewVipController.instance.isReceiveAward(16);c?e.CreateNewVipController.instance.showPanel(e.PlayerService.instance.playerInfo.getVipLevel()):e.CreateNewVipController.instance.showPanel(16)}}else if(-1!=t.text.indexOf("turn_shouchong"))e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.FIRST_RECHARGE);else if("gotoWorldBoss"==t.text){if(e.WorldBossController.getInstance().isBoss)return;e.WorldBossController.getInstance().requestEnter(),e.NewChatControler.getInstance().closeChatPanel()}else"turn_linghongbao"==t.text?e.RedPacketController.getInstance().showPanel():"turn_qianghongbao"==t.text?e.RedPacketController.getInstance().showPanel():"turn_baoku"==t.text?e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE):"turn_mibao"==t.text?e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.GUSHENMIBAO):e.NewChatControler.getInstance().getPanelIsShow()||e.NewChatControler.getInstance().showPanel()},i.prototype.setChatOtherSayMsg=function(t){var i=e.JsonDataManager.instance.roleTemplate,n=t.getRoleItemId();this.playerId=t.getPlayerId(),this.headPortrait.source=i[n].icon2;var o=t.getName();if(this.csType=t.getCsType(),this.nameLable.textFlow=(new egret.HtmlTextParser).parser("[<font><u>"+o+"</u></font>]"),t.getType()==e.ChatType.ALLCAMP+1||t.getType()==e.ChatType.SINGLECAMP){this.removeClickEvent(),this.headPortrait.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this),this.isCamp=!0,this.campLabel.visible=!0;var a="",s=t.getCampType()==e.FactionBattleController.getInstance().getPlayerCampType();t.getCampType()==factionType.dragon&&(a="龙"),t.getCampType()==factionType.tiger&&(a="虎");var r="";t.getName().indexOf(".")>-1&&(r=t.getName().split(".")[0]),this.campLabel.textFlow=this.getCampTextflow(a,r,s),this.campLabel.x=70;var l=t.getName().split(".")[1];this.nameLable.textFlow=(new egret.HtmlTextParser).parser("[<font>"+l+"</font>]")}else this.isCamp=!1,this.campLabel.visible=!1,this.vipLable.x=70;0==t.getVipLevel()?this.vipLable.visible=!1:(this.vipLable.text="VIP",this.isCamp&&(this.vipLable.x=this.campLabel.x+this.campLabel.width+e.ChatItemConfig.horizontalDis)),t.getQqblueInfo()&&t.getQqblueInfo().getIsBlueVip()?(e.Global.setBlueFont(this.txt_blue1,t.getQqblueInfo().getBlueVipLevel(),t.getQqblueInfo().getIsBlueYearVip(),t.getQqblueInfo().getIsSuperBlueVip()),this.txt_blue1.x=this.vipLable.x+this.vipLable.width+1,this.nameLable.x=this.txt_blue1.x+this.txt_blue1.width+e.ChatItemConfig.horizontalDis):(this.txt_blue1.text="",this.nameLable.x=this.vipLable.x+this.vipLable.width+e.ChatItemConfig.horizontalDis);var h=e.NewChatControler.getInstance().replaceFaceFromeMsg(t.getChatMsg(),this.chatGroup,this.chatLable.size,1,t.getType());this.chatLable.textFlow=(new egret.HtmlTextParser).parser(h),this.timeLable.text=this.createTime(t),this.timeLable.x=this.nameLable.x+this.nameLable.width+e.ChatItemConfig.horizontalDis,this.setChatBgBounds(this.chatLable)},i.prototype.createTime=function(e){var t="",i=new Date;return i.setTime(e.getChatTime()),t+=i.getHours()+":",i.getMinutes()<10&&(t+="0"),t+=i.getMinutes()+":",t+=i.getSeconds()},i.prototype.createDate=function(){var e="",t=new Date;return e+=t.getHours()+":",e+=t.getMinutes()+":",e+=t.getSeconds()},i.prototype.showMutual=function(t){if(this.isshowMutual){var i=new egret.Point(t.target.x+t.target.width,t.target.y);e.ChatMutual.getInstance().showMutual(i,t.target.parent,this.playerId,this.csType)}},i.prototype.removeClickEvent=function(){this.nameLable.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this)},i.prototype.setChatBgBounds=function(t){t.width;this.chatBg.width=t.width+e.ChatItemConfig.lastDis+e.ChatItemConfig.frontDis,this.chatBg.height=t.height+2*e.ChatItemConfig.verticalDis-5,this.chatGroup.height=t.height,this.chatGroup.width=t.width,t.x=this.chatBg.x+e.ChatItemConfig.frontDis},i.prototype.setChatOwnMsg=function(t){var i=e.JsonDataManager.instance.roleTemplate,n=t.getRoleItemId();this.headPortraitO.source=i[n].icon2;var o=e.NewChatControler.getInstance().replaceFaceFromeMsg(t.getChatMsg(),this.chatGroupO,this.chatLableO.size,0,t.getType());if(this.chatLableO.textFlow=(new egret.HtmlTextParser).parser(o),this.nameLableO.text="["+t.getName()+"]",t.getType()==e.ChatType.ALLCAMP||t.getType()==e.ChatType.SINGLECAMP){this.isCamp=!0,this.campLabelO.visible=!0;var a="";t.getCampType()==factionType.dragon&&(a="龙"),t.getCampType()==factionType.tiger&&(a="虎");var s="";t.getName().indexOf(".")>-1&&(s=t.getName().split(".")[0]),this.nameLableO.text="["+t.getName().split(".")[1]+"]",this.campLabelO.textFlow=this.getCampTextflow(s,a,!0),this.campLabelO.x=312}else this.isCamp=!1,this.campLabelO.visible=!1,this.vipLableO.x=342;0==t.getVipLevel()?this.vipLableO.visible=!1:(this.vipLableO.text="VIP",this.isCamp&&(this.vipLableO.x=this.campLabelO.x-e.ChatItemConfig.horizontalDis-this.vipLableO.width)),t.getQqblueInfo()&&t.getQqblueInfo().getIsBlueVip()?(e.Global.setBlueFont(this.txt_blue,t.getQqblueInfo().getBlueVipLevel(),t.getQqblueInfo().getIsBlueYearVip(),t.getQqblueInfo().getIsSuperBlueVip()),this.txt_blue.x=this.vipLableO.x-this.txt_blue.width-1,this.nameLableO.x=this.txt_blue.x-this.nameLableO.width-e.ChatItemConfig.horizontalDis):(this.txt_blue.text="",this.nameLableO.x=this.vipLableO.x-this.nameLableO.width-e.ChatItemConfig.horizontalDis),this.timeLableO.text=this.createOwnTime(t),this.timeLableO.x=this.nameLableO.x-this.timeLableO.width-e.ChatItemConfig.horizontalDis,this.setChatBgOwnBounds(this.chatLableO)},i.prototype.createOwnTime=function(e){var t="",i=new Date;return i.setTime(e.getChatTime()),t+=i.getHours()+":",i.getMinutes()<10&&(t+="0"),t+=i.getMinutes()+":",t+=i.getSeconds()},i.prototype.createOwnDate=function(){var e="",t=new Date;return e+=t.getHours()+":",t.getMinutes()<10&&(e+="0"),e+=t.getMinutes()+":",e+=t.getSeconds()},i.prototype.setChatBgOwnBounds=function(t){t.width;this.chatBgO.width=t.width+e.ChatItemConfig.lastDis+e.ChatItemConfig.frontDis,this.chatBgO.height=t.height+2*e.ChatItemConfig.verticalDis-5,this.chatGroupO.height=t.height,this.chatGroupO.width=t.width,t.x=this.chatBgO.x+e.ChatItemConfig.lastDis},i.prototype.getCampTextflow=function(e,t,i){var n=i?2227971:16711680,o="<font color = "+n+">"+e+"</font><font color = 0xEEE3C6>-"+t+"</font>";return(new egret.HtmlTextParser).parse(o)},i.wPublic=87,i}(eui.ItemRenderer);e.ChatAllSayItem=t,__reflect(t.prototype,"foxgame.ChatAllSayItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e._length=48,e.skinName="ChatFaceSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var e=0;e<this._length;e++)this["img"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.faceClick,this),this["img"+e].name="#"+this["img"+e].source.split("face_")[1].split("_png")[0]+"#"},i.prototype.faceClick=function(t){var i=t.target,n=i.name;e.NewChatControler.getInstance().addFace(n),e.NewChatControler.getInstance().showFaceView()},i.prototype.getFace=function(e){for(var t=0;t<this._length;t++)if(this["img"+t].name==e)return this["img"+t]},i}(eui.Component);e.ChatFace=t,__reflect(t.prototype,"foxgame.ChatFace")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.chatBgMaxLength=560,e.chatLableMaxLength=360,e.frontDis=26,e.lastDis=16,e.verticalDis=13,e.horizontalDis=3,e}();e.ChatItemConfig=t,__reflect(t.prototype,"foxgame.ChatItemConfig")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.ZONGHE=0]="ZONGHE",e[e.SHIJIELIAOTIAN=1]="SHIJIELIAOTIAN",e[e.GONGHUILIAOTIAN=2]="GONGHUILIAOTIAN",e[e.XITONGGONGGAO=3]="XITONGGONGGAO",e[e.GM=4]="GM",e[e.ALLCAMP=5]="ALLCAMP",e[e.SINGLECAMP=6]="SINGLECAMP",e[e.CAMPOTHER=7]="CAMPOTHER"}(t=e.ChatType||(e.ChatType={}));var i=function(){function i(){this.chatType=0,this.worldChatListItemAry=[],this.guildChatListItemAry=[],this.noticeListItemAry=[],this.zongheListItemAry=[],this.allCampListItemAry=[],this.singleCampListItemAry=[],this.worldChatListdataAry=[],this.guildChatListdataAry=[],this.noticeListdataAry=[],this.zongheListdataAry=[],this.allCampListDataAry=[],this.singleCampListDataAry=[],this.selectBtnIndex=0,this.maxChatMsg=25,this.observerList=[],this.dataSource=[],this.collection=new eui.ArrayCollection,this.collection.source=this.dataSource}return i.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},i.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},i.prototype.updateChatListData=function(i){for(var n=i.getChatMsg().length,o=0;n>o;o++){var a=this.chooseItem(i.getChatMsg()[o]);if(void 0!=a){var s=i.getChatMsg()[o].getType(),r=new Object;switch(s){case t.SHIJIELIAOTIAN-1:this.worldChatListItemAry.push(a),this.zongheListItemAry.push(a),r.type=t.SHIJIELIAOTIAN,r.data=i.getChatMsg()[o],r.isStr=!1,this.worldChatListdataAry.push(r),this.zongheListdataAry.push(r);break;case t.GONGHUILIAOTIAN-1:this.guildChatListItemAry.push(a),this.zongheListItemAry.push(a),r.type=t.GONGHUILIAOTIAN,r.data=i.getChatMsg()[o],r.isStr=!1,this.guildChatListdataAry.push(r),this.zongheListdataAry.push(r);break;case t.ALLCAMP+1:e.FactionBattleController.getInstance().setMessageArr(a),this.allCampListItemAry.push(a),r.type=t.GONGHUILIAOTIAN,r.data=i.getChatMsg()[o],r.isStr=!1,this.allCampListDataAry.push(r);break;case t.SINGLECAMP+1:e.FactionBattleController.getInstance().setMessageArr(a),this.singleCampListItemAry.push(a),r.type=t.GONGHUILIAOTIAN,r.data=i.getChatMsg()[o],r.isStr=!1,this.singleCampListDataAry.push(r)}this.itemAryHandler(s)}}this.updateView()},i.prototype.createNotice=function(i){var n=new e.ChatNoticeItem;n.setChatMsg(i);var o=new Object;o.type=t.XITONGGONGGAO,o.data=i,o.isStr=!1,this.noticeListItemAry.push(n),this.zongheListItemAry.push(n),this.noticeListdataAry.push(o),this.zongheListdataAry.push(o),this.itemAryHandler(t.ZONGHE),this.itemAryHandler(t.XITONGGONGGAO),this.updateView()},i.prototype.CreateUnionMessage=function(i){var n=new e.ChatNoticeItem;n.setUnionMsg(i),this.guildChatListItemAry.push(n);var o=new Object;o.type=t.GONGHUILIAOTIAN,o.data=i,o.isStr=!0,this.guildChatListdataAry.push(o),this.zongheListItemAry.push(n),this.zongheListdataAry.push(o),this.itemAryHandler(t.ZONGHE),this.itemAryHandler(t.GONGHUILIAOTIAN),this.updateView()},i.prototype.chooseItem=function(i){var n,o=i.getType(),a=e.PlayerService.instance.playerInfo.getPlayerId(),s=i.getPlayerId();switch(o){case t.ZONGHE:case t.SHIJIELIAOTIAN-1:n=a==s?new e.ChatOwnSayItem:new e.ChatOtherSayItem,n.setChatMsg(i);break;case t.GONGHUILIAOTIAN-1:n=a==s?new e.ChatOwnSayItem:new e.ChatOtherSayItem,n.setChatMsg(i);break;case t.XITONGGONGGAO-1:break;case t.GM:break;case t.ALLCAMP+1:n=a==s?new e.ChatOwnSayItem:new e.ChatOtherSayItem,n.setChatMsg(i);break;case t.SINGLECAMP+1:n=a==s?new e.ChatOwnSayItem:new e.ChatOtherSayItem,n.setChatMsg(i)}return n},i.prototype.itemAryHandler=function(e){switch(e){case 0:this.zongheListItemAry.length>this.maxChatMsg&&(this.zongheListItemAry.shift(),this.zongheListdataAry.shift());break;case 1:this.worldChatListItemAry.length>this.maxChatMsg&&(this.worldChatListItemAry.shift(),this.worldChatListdataAry.shift());break;case 2:this.guildChatListItemAry.length>this.maxChatMsg&&(this.guildChatListItemAry.shift(),this.guildChatListdataAry.shift());break;case 3:this.noticeListItemAry.length>this.maxChatMsg&&(this.noticeListItemAry.shift(),this.noticeListdataAry.shift());break;case t.ALLCAMP+1:this.allCampListItemAry.length>this.maxChatMsg&&(this.allCampListItemAry.shift(),this.allCampListDataAry.shift());break;case t.SINGLECAMP+1:this.allCampListItemAry.length>this.maxChatMsg&&(this.singleCampListItemAry.shift(),this.singleCampListDataAry.shift())}},i.prototype.getZongHeData=function(){var e=[];return e=this.zongheListdataAry.concat()},i.prototype.getworldData=function(){var e=[];return e=this.worldChatListdataAry.concat()},i.prototype.getGuildData=function(){var e=[];return e=this.guildChatListdataAry.concat()},i.prototype.getNoticeData=function(){var e=[];return e=this.noticeListdataAry.concat()},i.prototype.getAllCampData=function(){var e=[];return e=this.allCampListDataAry.concat()},i.prototype.getSingleCampData=function(){var e=[];return e=this.singleCampListDataAry.concat()},i}();e.ChatModel=i,__reflect(i.prototype,"foxgame.ChatModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.csType=0,e.skinName="ChatMutual",e.addClickEvent(),e}return __extends(i,t),i.prototype.addClickEvent=function(){this.privateChatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.privateChat,this),this.checkBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkMsg,this)},i.prototype.removeClickEvent=function(){this.privateChatBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.privateChat,this),this.checkBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.checkMsg,this)},i.prototype.privateChat=function(){e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZANWEIKAIQI"))},i.prototype.checkMsg=function(t){return void 0!=this.currentPlayerId?0!=this.csType?(e.GameUtils.MSG_TIP("您暂时无法查看该玩家信息"),void(i.getInstance().visible=!1)):void e.OtherCharacterController.getInstance().showOtherCharacterPanel(this.currentPlayerId):void 0},i.prototype.showMutual=function(t,n,o,a){void 0===a&&(a=0);var s=i._instance;s.x=t.x,s.y=t.y,s.currentPlayerId=o,s.csType=a,s.addClickEvent(),s.visible||(s.visible=!0),n instanceof e.BasePanel?n instanceof e.UnionHall&&e.UnionController.getInstance().addMutual(s):n.addChild(s)},i.prototype.closeMutual=function(e){e.target.parent==i.getInstance()?e.stopPropagation():i.getInstance().visible&&(i.getInstance().visible=!1)},i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i}(eui.Component);e.ChatMutual=t,__reflect(t.prototype,"foxgame.ChatMutual")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/chat/new/ChatNewMutual.exml")||this;return e.setIsShowBackBtn(!1),e.isMask=!1,e.visible=!1,e}return __extends(i,t),i.prototype.showHook=function(){this.addClickEvent()},i.prototype.addClickEvent=function(){this.ui.privateChatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.privateChat,this),this.ui.checkBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkMsg,this)},i.prototype.removeClickEvent=function(){this.ui.privateChatBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.privateChat,this),this.ui.checkBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.checkMsg,this)},i.prototype.privateChat=function(){e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZANWEIKAIQI"))},i.prototype.checkMsg=function(t){void 0!=this.currentPlayerId&&e.OtherCharacterController.getInstance().showOtherCharacterPanel(this.currentPlayerId)},i.prototype.setData=function(e,t){this.visible=!0,this.currentPlayerId=t,this.x=e.x,this.y=e.y},i.prototype.closeMutual=function(e){e.target==this?e.stopPropagation():this.visible&&(this.visible=!1)},i}(e.BasePanel);e.ChatNewMutual=t,__reflect(t.prototype,"foxgame.ChatNewMutual")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.bubbleWidth=475,e.skinName="ChatNoticeItem",e}return __extends(i,t),i.prototype.setChatMsg=function(t){this.data=t;var i=e.MarqueeController.getInstance().createLableText(t);this.bubble.textFlow=(new egret.HtmlTextParser).parser(i),this.bubble.y=this.height/2-this.bubble.height/2},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.bubble.addEventListener(egret.TextEvent.LINK,this.linkHandler,this)},i.prototype.childrenCreated=function(){},i.prototype.setUnionMsg=function(e){this.bubble.textFlow=(new egret.HtmlTextParser).parser(e),this.bubble.y=this.height/2-this.bubble.height/2},i.prototype.linkHandler=function(t){var i,n=e.PlayerService.instance.playerInfo.getLevel();if(-1!=t.text.indexOf("playerId")){var o=t.text,a=o.split("_");if("-1"==a[1])return;var s=Number(t.text.split("_")[1]);e.OtherCharacterController.getInstance().showOtherCharacterPanel(s)}else if(-1!=t.text.indexOf("csRoleId_")){var r=t.text.substr("csRoleId_".length);e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,r,1)}else if(-1!=t.text.indexOf("csRoleId2_")){var r=t.text.substr("csRoleId2_".length);e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,r,2)}else if(-1!=t.text.indexOf("itemId")){var s=Number(t.text.split("_")[1]),l=e.JsonDataManager.instance.itemTemplate[s];if(l.type==e.ItemType.SOUL)e.TipsController.getInstance().showSoulTips(s);else if(l.type==e.ItemType.EQUIP){var h=e.JsonDataManager.instance.equipTemplate[s];e.TipsController.getInstance().showEquipTips({profession:h.profession,equipInfo:this.data.getEquipInfo().getEquipInfo(),showLock:!1,showReplace:!1})}else l.type==e.ItemType.DRAGONBONE?e.TipsController.getInstance().showDragonPanelByinfo(this.data.getEquipInfo().getDragonBoneInfo()):l.type==e.ItemType.SKILLSTONE?e.TipsController.getInstance().showDragonArmorSkillTips(s):l.type==e.ItemType.DRAGONARMOR?this.data.getEquipInfo()?e.TipsController.getInstance().showDragonArmorBydata(this.data.getEquipInfo().getDragonArmourInfo()):e.TipsController.getInstance().showDragonArmorTips(s,!1):e.TipsController.getInstance().showItemTips(s)}else if(-1!=t.text.indexOf("turn_xunbao"))e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.SEARCHTREASURE);else if(-1!=t.text.indexOf("turn_chibangshengjie")){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHIBANG),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHIBANG),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WINGOPEN",n));e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.WING_SYSTEM)}else if(-1!=t.text.indexOf("turn_zhuangbeishengxing")){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEISHENGXING),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHUANGBEISHENGXING",n));e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.EQUIP_UP_STAR)}else if(-1!=t.text.indexOf("turn_viplibao")){if(e.PlayerService.instance.playerInfo.getVipLevel()<16)e.LegendaryEquipController.getInstance().showPanel();
else if(e.PlayerService.instance.playerInfo.getVipLevel()>=16){var c=e.CreateNewVipController.instance.isReceiveAward(16);c?e.CreateNewVipController.instance.showPanel(e.PlayerService.instance.playerInfo.getVipLevel()):e.CreateNewVipController.instance.showPanel(16)}}else if(-1!=t.text.indexOf("turn_shouchong"))e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.FIRST_RECHARGE);else if("gotoWorldBoss"==t.text){if(e.WorldBossController.getInstance().isBoss)return;e.WorldBossController.getInstance().requestEnter(),e.NewChatControler.getInstance().closeChatPanel()}else"turn_linghongbao"==t.text?e.RedPacketController.getInstance().showPanel():"turn_qianghongbao"==t.text?e.RedPacketController.getInstance().showPanel():"turn_baoku"==t.text?e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE):"turn_mibao"==t.text?e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.GUSHENMIBAO):e.NewChatControler.getInstance().getPanelIsShow()||e.NewChatControler.getInstance().showPanel()},i}(eui.Component);e.ChatNoticeItem=t,__reflect(t.prototype,"foxgame.ChatNoticeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.chatLableInitHeight=20,e.csType=0,e.skinName="ChatOtherSay",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.nameLable.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this),this.headPortrait.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this)},i.prototype.setChatMsg=function(t){var i=e.JsonDataManager.instance.roleTemplate,n=t.getRoleItemId();this.playerId=t.getPlayerId(),this.headPortrait.source=i[n].icon2;t.getName();this.csType=t.getCsType(),this.nameLable.textFlow=(new egret.HtmlTextParser).parser("[<font><u>dtfgdfgfg</u></font>]"),0==t.getVipLevel()?this.vipLable.visible=!1:(this.nameLable.x=this.vipLable.x+this.vipLable.width+e.ChatItemConfig.horizontalDis,this.vipLable.text="VIP"),this.timeLable.text=this.createTime(t),this.timeLable.x=this.nameLable.x+this.nameLable.width+e.ChatItemConfig.horizontalDis,this.setChatBgBounds(this.chatLable)},i.prototype.createTime=function(e){var t="",i=new Date;return i.setTime(e.getChatTime()),t+=i.getHours()+":",i.getMinutes()<10&&(t+="0"),t+=i.getMinutes()+":",t+=i.getSeconds()},i.prototype.createDate=function(){var e="",t=new Date;return e+=t.getHours()+":",e+=t.getMinutes()+":",e+=t.getSeconds()},i.prototype.showMutual=function(t){var i=new egret.Point(t.target.x+t.target.width,t.target.y);e.ChatMutual.getInstance().showMutual(i,t.target.parent,this.playerId,this.csType)},i.prototype.addClickEvent=function(){},i.prototype.removeClickEvent=function(){this.nameLable.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showMutual,this)},i.prototype.setChatBgBounds=function(t){t.width;this.chatBg.width=t.width+e.ChatItemConfig.lastDis+e.ChatItemConfig.frontDis,this.chatBg.height=t.height+2*e.ChatItemConfig.verticalDis,this.height+=t.height-this.chatLableInitHeight,this.chatGroup.height=t.height,this.chatGroup.width=t.width,t.x=this.chatBg.x+e.ChatItemConfig.frontDis},i}(eui.Component);e.ChatOtherSayItem=t,__reflect(t.prototype,"foxgame.ChatOtherSayItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.chatLableInitHeight=20,e.skinName="ChatOwnSay",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this)},i.prototype.setChatMsg=function(t){var i=e.JsonDataManager.instance.roleTemplate,n=t.getRoleItemId();this.headPortrait.source=i[n].icon2,this.nameLable.text="["+t.getName()+"]";Math.round(9*Math.random());0==t.getVipLevel()?this.vipLable.visible=!1:this.vipLable.text="VIP",this.timeLable.text=this.createTime(t),"0"!=this.txt_blue.text?(this.nameLable.x=this.txt_blue.x-this.nameLable.width-e.ChatItemConfig.horizontalDis,this.timeLable.x=this.nameLable.x-this.timeLable.width-e.ChatItemConfig.horizontalDis):(this.nameLable.x=this.vipLable.x-this.nameLable.width-e.ChatItemConfig.horizontalDis,this.timeLable.x=this.nameLable.x-this.timeLable.width-e.ChatItemConfig.horizontalDis),this.setChatBgBounds(this.chatLable)},i.prototype.createTime=function(e){var t="",i=new Date;return i.setTime(e.getChatTime()),t+=i.getHours()+":",i.getMinutes()<10&&(t+="0"),t+=i.getMinutes()+":",t+=i.getSeconds()},i.prototype.createDate=function(){var e="",t=new Date;return e+=t.getHours()+":",t.getMinutes()<10&&(e+="0"),e+=t.getMinutes()+":",e+=t.getSeconds()},i.prototype.setChatBgBounds=function(t){t.width;this.chatBg.width=t.width+e.ChatItemConfig.lastDis+e.ChatItemConfig.frontDis,this.chatBg.height=t.height+2*e.ChatItemConfig.verticalDis,this.height+=t.height-this.chatLableInitHeight,this.chatGroup.height=t.height,this.chatGroup.width=t.width,t.x=this.chatBg.x+e.ChatItemConfig.lastDis},i}(eui.Component);e.ChatOwnSayItem=t,__reflect(t.prototype,"foxgame.ChatOwnSayItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/chat/new/ChatMainSkin.exml",null,!1)||this;return i.imgAry=[],i.isCamp=!1,i.model=e,i.isMask=!1,i.isCenter=!1,i.isCallHideSceneObjectsWhenClose=!1,i.setIsTextureCache(!0),i.setIsShowBackBtn(!1),i}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.showHook=function(){this.y=ScreenAdaptation.instance.uiHeight-this.height*this.ui.scaleY,this.initBtnState(),this.refreshTabBtn(),e.MainControler.instance.showchat(!1),this.setScrollerView(),this.setMsgCampBtnGrou(),this.ui.bottomGroup.visible=!0,e.FactionBattleController.getInstance().clearMessageArr()},i.prototype.setMsgCampBtnGrou=function(){for(var e=0;e<this.getBtns().length;e++)4>e&&(this.getBtns()[e].visible=!this.isCamp,this.getBtns()[e].touchEnabled=!0);for(var t=0;t<this.getCampBtns().length;t++)this.getCampBtns()[t].visible=this.isCamp,this.getCampBtns()[t].touchEnabled=!0},i.prototype.refresh=function(){e.Global.isAppStoreReview&&(this.ui.guildBtn.visible=!1,this.ui.systemBtn.visible=!1,this.ui.GMBtn.visible=!1),this.updateChatList(),this.setScrollerView()},i.prototype.updateChatList=function(){var t,i=[];switch(this.model.selectBtnIndex){case e.ChatType.SHIJIELIAOTIAN:t=this.model.worldChatListItemAry,i=this.model.getworldData();break;case e.ChatType.GONGHUILIAOTIAN:t=this.model.guildChatListItemAry,i=this.model.getGuildData();break;case e.ChatType.XITONGGONGGAO:t=this.model.noticeListItemAry,i=this.model.getNoticeData();break;case e.ChatType.ZONGHE:t=this.model.zongheListItemAry,i=this.model.getZongHeData();break;case e.ChatType.ALLCAMP:t=this.model.allCampListItemAry,i=this.model.getAllCampData();break;case e.ChatType.SINGLECAMP:t=this.model.singleCampListItemAry,i=this.model.getSingleCampData();break;case e.ChatType.CAMPOTHER:t=this.model.noticeListItemAry,i=this.model.getNoticeData()}this.cleanImgAry(),this.model.dataSource=null,this.model.dataSource=i,this.model.collection.replaceAll(this.model.dataSource)},i.prototype.calcItemPosY=function(){for(var e=0,t=this.ui.chatList,i=t.numChildren,n=0;i>n;n++){var o=t.getChildAt(n);e+=o.height}return e},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.chatScroller.verticalScrollBar.autoVisibility=!1,this.ui.chatScroller.viewport=this.ui.chatList;var t=this.ui.chatList;t.dataProvider=this.model.collection,t.itemRenderer=e.ChatAllSayItem,this.initBtnState(),this.ui.textInput.type="input",this.ui.textInput.maxChars=40,this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.touchRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.sendMsgBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendMsgHandler,this),this.ui.wordBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.guildBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.GMBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.systemBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.zongheBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.quanbuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.campBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.ui.systeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeBtnState,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.closeMutual,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHelpTip,this),"ttgame"==window.GJlenged_chanel?this.ui.faceBtn.visible=!1:this.ui.faceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showFacePanel,this),this.ui.textInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.closeFaceView,this),this.doScreenAdaptation(),this.initData()},i.prototype.doScreenAdaptation=function(){this.ui.width=ScreenAdaptation.instance.uiWidth,this.ui.bg_1.width=ScreenAdaptation.instance.uiWidth,this.ui.bg_2.width=ScreenAdaptation.instance.uiWidth,this.ui.x=0},i.prototype.closeFaceView=function(){this.ui.chatFacePanel.visible=!1},i.prototype.showHelpTip=function(){e.HelpController.getInstance().showPanel("CHATHELP")},i.prototype.closeMutual=function(t){e.ChatMutual.getInstance().closeMutual(t)},i.prototype.changeBtnState=function(t){this.initBtnState(),this.ui.bottomGroup.visible=!0;var i=t.target;switch(i.enabled=!1,i){case this.ui.wordBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.SHIJIELIAOTIAN;break;case this.ui.guildBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.GONGHUILIAOTIAN;break;case this.ui.systemBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.XITONGGONGGAO,this.ui.bottomGroup.visible=!1;break;case this.ui.GMBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.GM;break;case this.ui.zongheBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.ZONGHE;break;case this.ui.quanbuBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.ALLCAMP;break;case this.ui.campBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.SINGLECAMP;break;case this.ui.systeBtn:this.model.chatType=this.model.selectBtnIndex=e.ChatType.CAMPOTHER,this.ui.bottomGroup.visible=!1}this.refreshTabBtn(),this.updateChatList(),this.ui.chatScroller.stopAnimation(),this.ui.chatScroller.viewport.scrollV=0,this.setScrollerView()},i.prototype.refreshTabBtn=function(){this.ui.wordBtn.currentState=this.model.selectBtnIndex==e.ChatType.SHIJIELIAOTIAN?"down":"up",this.ui.guildBtn.currentState=this.model.selectBtnIndex==e.ChatType.GONGHUILIAOTIAN?"down":"up",this.ui.systemBtn.currentState=this.model.selectBtnIndex==e.ChatType.XITONGGONGGAO?"down":"up",this.ui.GMBtn.currentState=this.model.selectBtnIndex==e.ChatType.GM?"down":"up",this.ui.zongheBtn.currentState=this.model.selectBtnIndex==e.ChatType.ZONGHE?"down":"up",this.ui.quanbuBtn.currentState=this.model.selectBtnIndex==e.ChatType.ALLCAMP?"down":"up",this.ui.campBtn.currentState=this.model.selectBtnIndex==e.ChatType.SINGLECAMP?"down":"up",this.ui.systeBtn.currentState=this.model.selectBtnIndex==e.ChatType.CAMPOTHER?"down":"up"},i.prototype.initBtnState=function(){var e=this.getCampBtns();this.isCamp||(e=this.getBtns());for(var t=e.length,i=0;t>i;i++){var n=e[i];n.enabled=!0}},i.prototype.initData=function(){this.initBtnState(),this.isCamp?(this.model.selectBtnIndex=e.ChatType.ALLCAMP,this.model.chatType=e.ChatType.ALLCAMP):(this.model.selectBtnIndex=e.ChatType.ZONGHE,this.model.chatType=e.ChatType.ZONGHE),this.refreshTabBtn()},i.prototype.setInitChatType=function(){this.isCamp?(this.model.selectBtnIndex=e.ChatType.ALLCAMP,this.model.chatType=e.ChatType.ALLCAMP):(this.model.selectBtnIndex=e.ChatType.ZONGHE,this.model.chatType=e.ChatType.ZONGHE)},i.prototype.setScrollerView=function(){this.model.dataSource.length*e.ChatAllSayItem.wPublic>this.ui.chatScroller.height&&(this.ui.chatScroller.viewport.scrollV=this.model.dataSource.length*e.ChatAllSayItem.wPublic-this.ui.chatScroller.height)},i.prototype.sendMsgHandler=function(){var t=2==this.model.chatType?!0:!1,i=e.PlayerService.instance.playerInfo.getLevel(),n=Number(e.GlobalConfig.instance.getValue("CHAT_LEVEL_NUMBER")),o=Number(e.GlobalConfig.instance.getValue("LIAOTIAN_CH_XZ"));if(e.Global.isYouGuSDK){var a=e.PlayerService.instance.playerInfo.getRechargeRmb();if(o>a)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YG_CHAT_LIMIT_RMB_TIP",o))}if(!this.checkByteLength())return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CHATMSGCONTEMPTY"));if(0==t){if(-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)){if(e.PlayerService.instance.playerInfo.getVipLevel()<=13&&0==e.PlayerService.instance.playerInfo.getRecharge())return void e.PopUpController.getInstance().showTextPanel("聊天功能需要首充后才能开启",this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}else if(e.GamePlatform.isXqwd||-1!=String(getGlobalConfig().serverUrl).indexOf("yl-xbtx-res")){if(n>i||e.PlayerService.instance.playerInfo.getRecharge()<50)return void e.PopUpController.getInstance().showFloatTextPanel1("发言功能未达到开启条件")}else if(-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend-dimai.biggerking.cn")){if(n>i||e.PlayerService.instance.playerInfo.getRechargeRmb()<o)return void e.PopUpController.getInstance().showFloatTextPanel1("需累冲100000元宝")}else if(n>i){var s=e.LanguageUtils.instance.getValue("CHATMSGCONTEMPTY_LEVEL",n);return void e.PopUpController.getInstance().showFloatTextPanel1(s)}var r=(new Date).getTime(),l=void 0==this.model.lastTIime?0:this.model.lastTIime;if(this.model.chatType==e.ChatType.SHIJIELIAOTIAN||this.model.chatType==e.ChatType.ZONGHE){if(!(Math.floor((r-l)/1e3)>10))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CHATDISTIMESOSHORT"));this.model.lastTIime=r}}var h=0;h=0==this.model.chatType?0:this.model.chatType-1,(this.model.chatType==e.ChatType.ALLCAMP||this.model.chatType==e.ChatType.SINGLECAMP)&&(h=this.model.chatType+1);var c=HawkProtocolManager.newBuilder("JsProto.HPSendChat");c.setChatMsg(this.ui.textInput.text),c.setChatType(h),e.Message.instance.send(e.Code.SEND_CHAT_C,c,!0),this.ui.textInput.text=""},i.prototype.showFacePanel=function(){this.ui.chatFacePanel.visible=!this.ui.chatFacePanel.visible},i.prototype.cleanImgAry=function(){var e=this.imgAry.length;if(e>0){var t=0;for(t;e>t;t++){var i=this.imgAry[t];i&&null!=i.parent&&(i.parent.removeChild(i),i=null)}}},i.prototype.replaceFaceFromeMsg=function(t,i,n,o,a){var s=30,r=[];this.imgAry=[];var l=360;t=this.deleteRedundanteFace(t);var h=t.match(/\#\d{1,2}#/g),c="";switch(a){case e.ChatType.ZONGHE:case e.ChatType.SHIJIELIAOTIAN-1:c="#cbbc8b";break;case e.ChatType.GONGHUILIAOTIAN-1:c="#00adff";break;case e.ChatType.XITONGGONGGAO-1:c="#ff9700";break;case e.ChatType.ALLCAMP+1:c="#FFFFFF";break;case e.ChatType.SINGLECAMP+1:c="#00A3FF"}if(t="<font color = "+c+">"+t+"</font>",null==h)return t;for(var u=h.length,p=0;u>p;p++){var g=h[p],d="face_"+g.match(/#(\d+)#/)[1]+"_png",f=new egret.Bitmap(RES.getRes(d));if(this.imgAry.push(f),f){var m=this.calcFaceX(t.split(g)[0],n,s,p),y=0,I=m,v=!1;if(l>m%l&&m%l+s>l){var _=Math.floor((l-m)/(n/2));switch(o){case 0:for(var T=0;_>T;T++)t=" "+t;v=!0;for(var C=0;p>C;C++)this.imgAry[C].x+=_*(n/2);break;case 1:for(var T=0;_>T;T++)t=t.split(g)[0]+" "+t.split(g)[1];v=!0}m=this.calcFaceX(t.split(g)[0],n,s,p),I=i.x+m}t=t.replace(g,"<font size = "+s+" fontFamily='SimSun'>　</font>");var A=Math.floor(m/l);if(-1==r.indexOf(A)&&r.push(A),m%l==0&&-1==r.indexOf(A-1)&&r.push(A-1),m>=l)for(var T=0;A>T;T++)T==A-1&&v?(-1==r.indexOf(T)&&r.push(T),y+=s):y+=-1!=r.indexOf(T)?s:n;I-=A*l,f.x=I,f.y=y,f.width=s,f.height=s,i.addChild(f)}}switch(c="",a){case e.ChatType.ZONGHE:case e.ChatType.SHIJIELIAOTIAN-1:c="#cbbc8b";break;case e.ChatType.GONGHUILIAOTIAN-1:c="#00adff";break;case e.ChatType.XITONGGONGGAO-1:c="#ff9700";break;case e.ChatType.ALLCAMP+1:c="#cbbc8b";break;case e.ChatType.SINGLECAMP+1:c="#cbbc8b"}return t="<font color = "+c+">"+t+"</font>"},i.prototype.calcFaceX=function(e,t,i,n){var o=0;if(this.getIsInit()&&this.ui.calcWidthLabel)this.ui.calcWidthLabel.textFlow=(new egret.HtmlTextParser).parser(e),o=this.ui.calcWidthLabel.width;else{var a=new eui.Label;a.fontFamily="SimSun",a.size=20,a.textFlow=(new egret.HtmlTextParser).parser(e),o=a.width}return o},i.prototype.getFace=function(e){return this.ui.chatFacePanel.getFace(e)},i.prototype.deleteRedundanteFace=function(e){var t=e.match(/\#\d{1,2}#/g);if(null==t)return e;var i=5,n=t.length;if(i>n)return e;for(var o=i;n>o;o++){var a=t[o];e=e.replace(a,"")}return e},i.prototype.calcByteLength=function(e){var t=e.replace(/[^\u0000-\u00ff]/g,"aa");return t.length},i.prototype.addFace=function(e){this.ui.textInput.text+=e},i.prototype.checkByteLength=function(){var e,t,i=this.ui.textInput.text;return null!=i.match(/\s+/)&&(t=i.match(/\s+/)[0].length==i.length?!0:!1),""==this.ui.textInput.text||t?(this.ui.textInput.text="",e=!1):!0},i.prototype.closeHook=function(){e.MainControler.instance.showchat(!0)},i.prototype.getBtns=function(){var e=[];return e.push(this.ui.zongheBtn),e.push(this.ui.wordBtn),e.push(this.ui.guildBtn),e.push(this.ui.systemBtn),e.push(this.ui.GMBtn),e},i.prototype.getCampBtns=function(){var e=[];return e.push(this.ui.systeBtn,this.ui.campBtn,this.ui.quanbuBtn),e},i}(e.BasePanel);e.ChatPanel=t,__reflect(t.prototype,"foxgame.ChatPanel",["foxgame.IChat","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.dataList=[],this.model=new e.ChatModel,this.panel=new e.ChatPanel(this.model)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.PUSH_CHAT_S:this.model.updateChatListData(i),this.addMsgToMainView(i);break;case e.Code.SEND_CHAT_S:0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo())}},t.prototype.showPanel=function(e){void 0===e&&(e=!1),this.panel.isCamp=e,this.panel.setInitChatType(),this.panel.show()},t.prototype.createNoticeMar=function(e){this.model.createNotice(e)},t.prototype.addMsgToMainView=function(t){for(var i=t.getChatMsg().length,n=0;i>n;n++){var o=t.getChatMsg()[n];if(o.getType()==e.ChatType.ALLCAMP+1||o.getType()==e.ChatType.SINGLECAMP+1)return;e.MainControler.instance.addMsgToGroup(this.createLabel(o))}},t.prototype.addUnionMsg=function(t){this.model.CreateUnionMessage(t),e.MainControler.instance.addMsgToGroup(this.createMainViewUnionMsg(t))},t.prototype.createMainViewUnionMsg=function(e){var t=new eui.Group,i=new eui.Label;return i.fontFamily="SimSun",i.maxWidth=340,i.size=18,i.lineSpacing=8,e="<font size="+i.size+" color=#00adff>【公会】</font>"+e,i.textFlow=(new egret.HtmlTextParser).parser(e),t.width=i.width,t.height=i.height,t.addChild(i),t},t.prototype.createLabel=function(t){var i=new eui.Group;i.touchEnabled=!1,i.touchChildren=!1;var n=new eui.Label;n.touchEnabled=!1,n.fontFamily="SimSun",n.maxWidth=400,n.size=18,n.lineSpacing=1.5;var o=t.getType(),a=t.getName(),s=t.getVipLevel(),r=t.getChatMsg(),l="",h=0;0==o?(l=e.LanguageUtils.instance.getValue("SHIJIE"),h=16750336):(l=e.LanguageUtils.instance.getValue("GONGHUI"),h=44543);var c=l;return s>0&&(c+="VIP"),c+=a+":",c+=r,c=this.createMainViewMsg(c,i,n.size,n.lineSpacing,n.maxWidth),c=c.replace(l,"<font size="+n.size+" color="+h+">"+l+"</font>"),s>0&&(c=c.replace("VIP","<font size="+n.size+" color=#e8cf63>VIP</font>")),c=c.replace(a+":","<font size="+n.size+" color=#00ff00><u>"+a+"</u>:</font>"),n.textFlow=(new egret.HtmlTextParser).parser(c),i.width=n.maxWidth,i.height=n.height-3,i.addChild(n),i},t.prototype.createMainViewMsg=function(e,t,i,n,o){e=this.panel.deleteRedundanteFace(e);var a=e.match(/\#\d{1,2}#/g);if(null==a)return e;for(var s=a.length,r=18,l=[],h=o,c=0;s>c;c++){var u=a[c],p="face_"+u.match(/#(\d+)#/)[1]+"_png",g=new egret.Bitmap(RES.getRes(p));if(g){var d=this.calcFaceX(e.split(u)[0],i,r,c),f=0,m=d,y=!1;if(h>d&&d+r>h){for(var I=Math.floor((h-d)/(i/2)),v=0;I>v;v++)e=e.split(u)[0]+" "+e.split(u)[1],y=!0;d=this.calcFaceX(e.split(u)[0],i,r,c),m=t.x+d}e=e.replace(u,"<font size = "+r+">　</font>");var _=Math.floor(d/h);if(-1==l.indexOf(_)&&l.push(_),d%h==0&&-1==l.indexOf(_-1)&&l.push(_-1),d>=h)for(var v=0;_>v;v++)v==_-1&&y?(-1==l.indexOf(v)&&l.push(v),f+=r+n):f+=-1!=l.indexOf(v)?r+n:i+n;m-=_*h,g.x=m,g.y=f,g.width=r,g.height=r,t.addChild(g)}}return e},t.prototype.calcFaceX=function(e,t,i,n){var o=new eui.Label;return o.size=t,o.fontFamily="SimSun",o.textFlow=(new egret.HtmlTextParser).parser(e),o.width},t.prototype.addFace=function(e){this.panel.addFace(e)},t.prototype.replaceFaceFromeMsg=function(e,t,i,n,o){return this.panel.replaceFaceFromeMsg(e,t,i,n,o)},t.prototype.showFaceView=function(){this.panel.showFacePanel()},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.closeChatPanel=function(){this.panel.close()},t.prototype.getPanelIsShow=function(){return this.panel.getIsShow()},t}();e.NewChatControler=t,__reflect(t.prototype,"foxgame.NewChatControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.climbingPanel=null,this.climbingRankView=null,this.climbingGetFriView=null,this.tipView=null,this.resultView=null,this.climbingData=null,this.resultData=null,this.getFriId=0,this._costNum=0}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.initView=function(){null==this.climbingPanel&&(this.climbingPanel=new e.ClimbingPanel)},t.prototype.removeView=function(){this.climbingPanel.dispose(),this.climbingPanel=null},t.prototype.recvMsg=function(i,n){switch(i){case e.Code.GHOST_TOWER_INFO_S:Log.trace(e.Code.GHOST_TOWER_INFO_S+"幽冥塔信息："+n),this._data=n,this.climbingPanel.setViewData(n),this.climbingPanel.updateView(n);break;case e.Code.GHOST_TOWER_CHALLENGE_S:Log.trace(e.Code.GHOST_TOWER_CHALLENGE_S+"幽冥塔信息："+n),t.getInstance().resultData=n;var o=e.JsonDataManager.instance.globalTemplate,a=~~o.GHOST_TOWER_PASS_TIME;e.UnionController.getInstance().showBossTimePanel(a),t.getInstance().closeWealView();break;case e.Code.GHOST_TOWER_DAILY_REWARD_S:Log.trace(e.Code.GHOST_TOWER_DAILY_REWARD_S+"幽冥塔信息："+n);break;case e.Code.GHOST_TOWER_HELP_PLAYER_S:Log.trace(e.Code.GHOST_TOWER_HELP_PLAYER_S+"幽冥塔信息："+n),this.climbingGetFriView.updateView(n.helpRankInfo,n.helpCount)}},t.prototype.closeWealView=function(){this.climbingPanel.close()},t.prototype.closeFriendView=function(){this.climbingGetFriView.close()},t.prototype.show=function(){return e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YOUMINGTA)?(this.requestGhostTowerInfoReq(),this.initView(),this.climbingPanel.show(),!0):(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CLIMBING_SHOW_LEVEL_TIP",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YOUMINGTA))),!1)},t.prototype.showRankView=function(){null==this.climbingRankView&&(this.climbingRankView=new e.ClimbingRankView),this.climbingRankView.show()},t.prototype.showFriendListView=function(){null==this.climbingGetFriView&&(this.climbingGetFriView=new e.ClimbingGetFriView),this.getFriendList(),this.climbingGetFriView.show()},t.prototype.showTipView=function(t){null==this.tipView&&(this.tipModel=new e.HelpModel,this.tipView=new e.ClimbingTipView(this.tipModel)),this.tipModel.content=this.getHelpTemplate()[t],this.tipView.show()},t.prototype.showResultView=function(){null==this.resultView&&(this.resultView=new e.ClimbingFightResultView),this.resultView.show()},t.prototype.getHelpTemplate=function(){return e.JsonDataManager.instance.helpTemplate},t.prototype.closeRankView=function(){this.climbingRankView.close()},t.prototype.registerMsg=function(t){t.add(e.Code.GHOST_TOWER_INFO_C,this),t.add(e.Code.GHOST_TOWER_INFO_S,this),t.add(e.Code.GHOST_TOWER_CHALLENGE_C,this),t.add(e.Code.GHOST_TOWER_CHALLENGE_S,this),t.add(e.Code.GHOST_TOWER_HELP_PLAYER_C,this),t.add(e.Code.GHOST_TOWER_HELP_PLAYER_S,this),t.add(e.Code.GHOST_TOWER_DAILY_REWARD_C,this),t.add(e.Code.GHOST_TOWER_DAILY_REWARD_S,this)},t.prototype.requestGhostTowerInfoReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.GhostTowerInfoReq");Log.trace(e.Code.GHOST_TOWER_INFO_C+"发送幽冥塔请求"+t),e.Message.instance.send(e.Code.GHOST_TOWER_INFO_C,t,!0)},t.prototype.requestFightInfoReq=function(){var i=HawkProtocolManager.newBuilder("JsProto.GhostTowerChallengeReq");i.setPlayerId(t.getInstance().getFriId),Log.trace(e.Code.GHOST_TOWER_CHALLENGE_C+"发送幽冥塔请求"+i),e.Message.instance.send(e.Code.GHOST_TOWER_CHALLENGE_C,i,!0),t.getInstance().getFriId=0,t.getInstance()._costNum=0},t.prototype.getAwardReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.DailyRewardReq");Log.trace(e.Code.GHOST_TOWER_DAILY_REWARD_C+"发送幽冥塔请求"+t),e.Message.instance.send(e.Code.GHOST_TOWER_DAILY_REWARD_C,t,!0)},t.prototype.getFriendList=function(){var t=HawkProtocolManager.newBuilder("JsProto.HelpPlayerInfoReq");Log.trace(e.Code.GHOST_TOWER_HELP_PLAYER_C+"发送幽冥塔请求"+t),e.Message.instance.send(e.Code.GHOST_TOWER_HELP_PLAYER_C,t,!0)},t.prototype.showClimbingPanelFriendInfo=function(){this.climbingPanel.showFriend()},t.prototype.getGhostTowerInfoById=function(e){return this.climbingData?this.climbingData[e]:null},t.prototype.getGhostTowerServiceInfo=function(){return this._data},t.prototype.getAwardData=function(){return this.awardData},t.prototype.setAwardData=function(e){this.awardData=e},t}();e.ClimbingController=t,__reflect(t.prototype,"foxgame.ClimbingController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/climbing/ClimbingGetFriViewSkin.exml")||this;return e.dp=null,e.scroller=null,e}return __extends(i,t),i.prototype.updateView=function(t,i){if(void 0===i&&(i=0),t){this.dp.removeAll();var n=e.JsonDataManager.instance.globalTemplate,o=n.GHOST_TOWER_INVITE_RANK_COST,a=n.GHOST_TOWER_INVITE_MAX_NUM,s=n.GHOST_TOWER_BE_INVITE_MAX_NUM;this._num=a-i;for(var r=null,l=0,h=t.length,c=e.PlayerService.instance.mainRoleData.roleInfo.name;h>l;)r=t[l],r.costNum=o,r.maxNum=s,r.curNum=this._num,r.name!=c?(this.dp.addItem(r),l+=1):l+=1;this.ui.freeId.text=this._num+"/"+a}},i.prototype.initHook=function(){this.isMask=!0,this.doScreenAdaptation(),this.dp=new eui.ArrayCollection,this.scroller=this.createList(this.dp),this.ui.listGroup.addChild(this.scroller)},i.prototype.initParams=function(){},i.prototype.closeHook=function(){},i.prototype.createList=function(t){var i=new eui.VerticalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER;var n=new eui.List;n.layout=i,n.itemRenderer=e.ClimbingGetFriRender,n.itemRendererSkinName="ClimbingGetFriRenderSkin",n.dataProvider=t;var o=new eui.Scroller;return o.percentWidth=o.percentHeight=100,o.viewport=n,o.top=5,o},i}(e.BasePanel);e.ClimbingGetFriView=t,__reflect(t.prototype,"foxgame.ClimbingGetFriView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/climbing/ClimbingSkin.exml","climbing")||this;return e.currentData=null,e.isMask=!1,e.isMaskdown=!0,e.adaptionType=1,e}return __extends(i,t),i.prototype.dispose=function(){},i.prototype.setViewData=function(e){this.currentData=e},i.prototype.showHook=function(){this.currentData&&this.updateView(this.currentData)},i.prototype.updateView=function(t){if(this.getIsShow()){var i=t.passId,n=0,o=[1,2,3,4,5];1100!=i?i>=2&&1097>=i?(n=3,o=[i-1,i,i+1,i+2,i+3]):2>i?n=i+1:i>1097&&(n=1098==i?4:5,o=[1096,1097,1098,1099,1100]):(n=5,o=[1096,1097,1098,1099,1100]),this.ui.curIndexBg.visible=!0,this.ui.curIndexBg.y=this.ui["floor"+n].y-10;for(var a=0,s=5;s>a;)this.ui["floor"+(a+1)].setData({showBg:a==n-1,name:o[a],floor:o[a],passId:i}),a+=1;this.ui.tipNameText.text="当前第"+(i+1)+"层";var r=t.personRankInfo;if(r&&r.length){this.ui.noRankInfoTip.visible=!1,this.ui.rankGroupId.visible=!0;var l=null;l=r.concat().splice(0,r.length>3?3:r.length),this.ui.rankRender1.visible=this.ui.rankRender1.visible=this.ui.rankRender1.visible=!1;for(var h=0,c=3,u=null;c>h;)u=this.ui["rankRender"+(h+1)],l[h]?(u.visible=!0,u.setData(l[h])):u.visible=!1,h+=1}else this.ui.noRankInfoTip.visible=!0,this.ui.rankGroupId.visible=!1;var p=e.ClimbingController.getInstance().getGhostTowerInfoById(1e3>i?i:i-1),g=e.ClimbingController.getInstance().getGhostTowerInfoById(i-1),d=new eui.ArrayCollection,f=new eui.ArrayCollection;if(p&&p.firstAward)for(p=p.firstAward,a=0,s=p.length;s>a;)d.addItem({id:p[a]}),a+=1;if(e.ClimbingController.getInstance().setAwardData(d),g&&g.dailyAward)for(g=g.dailyAward,a=0,s=g.length;s>a;)f.addItem({id:g[a]}),a+=1;this.ui.nextRewardGroup.removeChildren(),p?(this.ui.nextRewardGroup.addChild(this.createHorizontalList(d)),this.ui.nextFloorTextId.text="通关第"+(1e3>i?i+1:i)+"层奖励",this.ui.fightId.name="0"):(this.ui.nextRewardGroup.addChild(this.createHorizontalList(f)),this.ui.nextFloorTextId.text="通关第"+i+"层奖励",this.ui.fightId.name="1"),this.ui.curRewardGroup.removeChildren(),this.ui.getAwardId.name=t.dailyReward+"",g&&this.ui.curRewardGroup.addChild(this.createHorizontalList(f)),this.ui.dAwardTextIId.text=i+"层每日奖励",0==t.dailyReward&&i>0?this.ui.getAwardId.enabled=!0:this.ui.getAwardId.enabled=!1,this.showFriend()}},i.prototype.showFriend=function(){if(e.ClimbingController.getInstance().getFriId&&0!=e.ClimbingController.getInstance().getFriId){this.ui.friendGroup.visible=!0;var t=e.PlayerService.instance.getRoleVO(e.ClimbingController.getInstance().getFriId),i=e.ClimbingController.getInstance().friendData;t&&(this.ui.roleType.source="zhiye_"+t.profession+"_png",this.ui.roleImg.source=t.icon),this.ui.vipLevel.text="V"+i.vipLevel,this.ui.nameId.text=i.name,this.ui.fightId0.text=e.LanguageUtils.instance.getValue("FIGHT")+": "+i.fight,this.ui.lvId.text="LV."+i.level}else this.ui.friendGroup.visible=!1},i.prototype.initHook=function(){this.ui.currency.refresh(),this.doScreenAdaptation(),36==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.fightId,this.ui.fightId.parent,36,3,!0)},i.prototype.clickHandler=function(t){switch(t.currentTarget){case this.ui.rankId:e.ClimbingController.getInstance().showRankView();break;case this.ui.fightId:if("0"==this.ui.fightId.name){if(e.ClimbingController.getInstance()._costNum>0)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZHUZHANXIAOHAO",e.ClimbingController.getInstance()._costNum),this,this.toFightFunc);this.fightingFunc()}else e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("TONGGUANZUIGAOCENGSHU"));break;case this.ui.getAwardId:e.ClimbingController.getInstance().getAwardReq();break;case this.ui.getFeiId:e.ClimbingController.getInstance().showFriendListView();break;case this.ui.fightInfoId:e.ClimbingController.getInstance().showTipView("CHAOSABYSASSISTIN");break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("CHAOSABYSSHELP")}},i.prototype.fightingFunc=function(){e.ClimbingController.getInstance().requestFightInfoReq()},i.prototype.toFightFunc=function(){var t=e.PlayerService.instance.playerInfo;if(t){var i=Number(t.getGold());i>=e.ClimbingController.getInstance()._costNum?this.fightingFunc():e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}},i.prototype.initParams=function(){this.ui.rankId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.fightId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.getAwardId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.fightInfoId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.getFeiId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.readyDestroy=function(){this.ui.rankId.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.fightId.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.getAwardId.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.fightInfoId.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.getFeiId.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.friendGroup.visible=!1,this.currentData=null
},i.prototype.closeHook=function(){e.ClimbingController.getInstance().getFriId=0,e.ClimbingController.getInstance()._costNum=0,36==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.onTabBarIndexHorizontalChanged=function(t){var i=t.target.selectedIndex,n=t.target.dataProvider.source[i].id.split("_");e.TipsController.getInstance().showItemTips(n[1],n[2]),t.target.selectedIndex=-1},i.prototype.createHorizontalList=function(t){var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE;var n=new eui.List;n.layout=i,n.itemRenderer=e.LoginIconRender,n.itemRendererSkinName="ClimbingIconRenderSkin",n.dataProvider=t,n.addEventListener(egret.Event.CHANGE,this.onTabBarIndexHorizontalChanged,this);var o=new eui.Scroller;return o.percentWidth=o.percentHeight=100,o.viewport=n,o.top=5,o},i.prototype.backHandler=function(){this.close(),e.WanFaController.getInstance().showPanel()},i}(e.BasePanel);e.ClimbingPanel=t,__reflect(t.prototype,"foxgame.ClimbingPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this.zhanliBmLab.text=this.data.rank+"",this.vipLevel.text="V"+(this.data.vipLevel||0),this.nameId.text=this.data.name+"",this.floorId.text=this.data.passNum+e.LanguageUtils.instance.getValue("CENG"))},i}(eui.ItemRenderer);e.ClimbingRankRender=t,__reflect(t.prototype,"foxgame.ClimbingRankRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="climbFloorRender",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},i.prototype.setData=function(t){this.infoText.text=t.name+e.LanguageUtils.instance.getValue("CENG"),t.floor<1e3?t.floor<=t.passId+1?this.infoText.textColor=16759296:this.infoText.textColor=11316396:t.floor<t.passId+1?this.infoText.textColor=16759296:this.infoText.textColor=11316396},i}(eui.Component);e.ClimbFloorRender=t,__reflect(t.prototype,"foxgame.ClimbFloorRender")}(foxgame||(foxgame={}));var ClimbingFloorRender=function(e){function t(){var t=e.call(this)||this;return t.skinName="climbFloorRender",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.setData=function(e){this.infoText.text=e.name,e.floor<1e3?e.floor<=e.passId+1?this.infoText.textColor=16759296:this.infoText.textColor=11316396:e.floor<e.passId+1?this.infoText.textColor=16759296:this.infoText.textColor=11316396},t}(eui.Component);__reflect(ClimbingFloorRender.prototype,"ClimbingFloorRender");var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){var i=e.JsonDataManager.instance.roleTemplate[this.data.roleItemId];i&&(this.roleType.source="zhiye_"+i.profession+"_png",this.roleImg.source=i.icon),this.vipLevel.text="V"+this.data.vipLevel;var n=[];if(this.data.rank>3)n.push({text:e.LanguageUtils.instance.getValue("FREE"),style:{textColor:16761856}});else{var o=this.data.costNum.split(",");n.push({text:e.LanguageUtils.instance.getValue("XUYAOYUANBAO")+" "+o[this.data.rank-1],style:{textColor:16761856}})}n.push({text:" ("+this.data.helpCount+"/"+this.data.maxNum+")",style:{textColor:this.data.maxNum==this.data.helpCount?16711680:2227971}}),this.moneyId.textFlow=n,this.data.helpCount==this.data.maxNum?this.yaoqingId.enabled=!1:this.yaoqingId.enabled=!0;var a=[];a.push({text:this.data.name,style:{textColor:41983}}),a.push({text:" LV."+this.data.level,style:{textColor:2227971}}),this.nameId.textFlow=a,this.fightId.text=e.LanguageUtils.instance.getValue("FIGHT")+": "+this.data.fight,this.yaoqingId.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.yaoqingId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)}},i.prototype.clickHandler=function(t){return this.data.rank>3&&0==this.data.curNum?void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CLIMBING_YQCS_TIP")):(e.ClimbingController.getInstance().getFriId=this.data.playerId,e.ClimbingController.getInstance().friendData=this.data,e.ClimbingController.getInstance()._costNum=this.data.rank<4?this.data.costNum.split(",")[this.data.rank-1]:0,e.ClimbingController.getInstance().closeFriendView(),void e.ClimbingController.getInstance().showClimbingPanelFriendInfo())},i}(eui.ItemRenderer);e.ClimbingGetFriRender=t,__reflect(t.prototype,"foxgame.ClimbingGetFriRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ClimbingPanelRankRenderSkin",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},i.prototype.setData=function(t){if(t){var i=t.rank=~~t.rank;this.iconId.source=1==i?"global_jin_png":2==i?"global_yin_png":3==i?"global_tong_png":"",this.nameId.text=t.name,this.floorId.text=t.passNum+e.LanguageUtils.instance.getValue("CENG")}},i}(eui.Component);e.ClimbingPanelRankRender=t,__reflect(t.prototype,"foxgame.ClimbingPanelRankRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/climbing/ClimbingRankViewSkin.exml")||this;return e.dp=null,e.scroller=null,e}return __extends(i,t),i.prototype.showHook=function(){this.ui.rankId.text=e.LanguageUtils.instance.getValue("WODEPAIMING")+"0",this.ui.centerId.text=e.LanguageUtils.instance.getValue("WODETONGGUANCENGSHU")+"0";var t=e.ClimbingController.getInstance().getGhostTowerServiceInfo(),i=t.personRankInfo,n=e.PlayerService.instance.mainRoleData.roleInfo.name;this.dp.removeAll();for(var o=0,a=i.length;a>o;)i[o].name==n&&(this.ui.rankId.text=e.LanguageUtils.instance.getValue("WODEPAIMING")+(o+1),this.ui.centerId.text=e.LanguageUtils.instance.getValue("WODETONGGUANCENGSHU")+i[o].passNum),this.dp.addItem(i[o]),o+=1},i.prototype.initHook=function(){this.isMask=!0,this.doScreenAdaptation(),this.dp=new eui.ArrayCollection,this.scroller=this.createList(this.dp),this.ui.listGroup.addChild(this.scroller)},i.prototype.closeBtnHandler=function(t){e.ClimbingController.getInstance().closeRankView()},i.prototype.initParams=function(){this.ui.closeId.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.ui.closeId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnHandler,this)},i.prototype.closeHook=function(){},i.prototype.createList=function(t){var i=new eui.VerticalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER;var n=new eui.List;n.layout=i,n.itemRenderer=e.ClimbingRankRender,n.itemRendererSkinName="ClimbingRankRenderSkin",n.dataProvider=t;var o=new eui.Scroller;return o.percentWidth=o.percentHeight=100,o.viewport=n,o.top=5,o},i}(e.BasePanel);e.ClimbingRankView=t,__reflect(t.prototype,"foxgame.ClimbingRankView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/climbing/result/ClimbingFightResultViewSkin.exml")||this;return e.iCount=0,e}return __extends(i,t),i.prototype.initHook=function(){this.isMask=!0},i.prototype.initParams=function(){this.mytimer=new egret.Timer(1e3,0),this.mytimer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.mytimer.start(),this.iCount=5,this.ui.countDownFont.text=this.iCount.toString(),this.ui.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.bgId.source="shenlidi";var t=e.LanguageUtils.instance.getValue("GONGXITONGGUANYOUMINGTA",e.ClimbingController.getInstance()._data.passId+1);this.ui.contentLabel.textFlow=(new egret.HtmlTextParser).parser(t);var i=e.ClimbingController.getInstance().getAwardData();i&&(this.ui.rewardGroup.removeChildren(),this.ui.rewardGroup.addChild(this.createHorizontalList(i)))},i.prototype.createHorizontalList=function(t){var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,this.list=new eui.List,this.list.layout=i,this.list.itemRenderer=e.LoginIconRender,this.list.itemRendererSkinName="ClimbingIconRenderSkin",this.list.dataProvider=t,this.list.addEventListener(egret.Event.CHANGE,this.onTabBarIndexHorizontalChanged,this);var n=new eui.Scroller;return n.percentWidth=n.percentHeight=100,n.viewport=this.list,n.top=5,n},i.prototype.onTabBarIndexHorizontalChanged=function(t){var i=t.target.selectedIndex,n=t.target.dataProvider.source[i].id.split("_");e.TipsController.getInstance().showItemTips(n[1],n[2]),t.target.selectedIndex=-1},i.prototype.timerFunc=function(t){this.iCount--,this.ui.countDownFont.text=this.iCount.toString(),this.iCount<0&&(e.ClimbingController.getInstance().requestFightInfoReq(),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"ClimbingFightResultView",tag:"timerFunc",battleType:e.BattleType.GHOST_TOWER}),this.close())},i.prototype.clickHandler=function(t){switch(t.currentTarget){case this.ui.sureBtn:e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"ClimbingFightResultView",tag:"sureBtn",battleType:e.BattleType.GHOST_TOWER}),this.close();break;case this.ui.nextBtn:e.ClimbingController.getInstance().requestFightInfoReq(),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"ClimbingFightResultView",tag:"nextBtn",battleType:e.BattleType.GHOST_TOWER}),this.close()}},i.prototype.readyDestroy=function(){this.ui.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.list.dataProvider=null},i.prototype.closeHook=function(){this.mytimer.stop(),this.mytimer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.mytimer=null,e.ClimbingController.getInstance().resultData=null},i.prototype.backHandler=function(){e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"ClimbingFightResultView",tag:"backHandler",battleType:e.BattleType.GHOST_TOWER}),this.close()},i}(e.BasePanel);e.ClimbingFightResultView=t,__reflect(t.prototype,"foxgame.ClimbingFightResultView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/climbing/tip/ClimbingTipViewSkin.exml")||this;return i.isMask=!0,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.showHook=function(){var t=e.JsonDataManager.instance.globalTemplate,i=t.GHOST_TOWER_HELP_AWARD_1,n=t.GHOST_TOWER_HELP_AWARD,o=new e.AttributeVO(i),a=new e.AttributeVO(n);this.ui.itemIcon1.name=i,this.ui.itemIcon2.name=n,this.ui.itemIcon1.setItem(o.id,o.value,!0,!0),this.ui.itemIcon2.setItem(a.id,a.value,!0,!0),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.clickHandler=function(t){var i=new e.AttributeVO(t.currentTarget.name);e.TipsController.getInstance().showItemTips(i.id,i.value)},i.prototype.refresh=function(){this.ui.contentLabel&&(this.ui.contentLabel.textFlow=this.model.htmlParser.parser(this.model.content))},i}(e.BasePanel);e.ClimbingTipView=t,__reflect(t.prototype,"foxgame.ClimbingTipView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.ClimbingPanelVO=t,__reflect(t.prototype,"foxgame.ClimbingPanelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.TREASURECONTROLER=0]="TREASURECONTROLER",e[e.VIP=1]="VIP",e[e.CHONGZHI=2]="CHONGZHI",e[e.FIRST_CHARGE=3]="FIRST_CHARGE"}(t=e.StorgerModleName||(e.StorgerModleName={}));var i=function(t){function i(){var i=t.call(this)||this;return i.time=5,i.surpTime=0,i.arrChange=[],i.resourceStr="resource/asset2/common_new/tips/",i.skinName="resource/skins/tips/TipsDefeatSkin.exml",i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeFromStage,i),e.PopUpManager.instance.registerWindow(e.WindowName.FIGHTLOSECONTROLER,i,i),i}return __extends(i,t),i.prototype.removeFromStage=function(){this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.show=function(){App.LittleLoading().showLoading("CommonFailUI"),this.reflushBtnGroup(),e.PopUpManager.instance.addPopUp(e.WindowName.FIGHTLOSECONTROLER,e.WindowName.UILAYER,5,!0),this.autoClose(),App.LittleLoading().hideLoading("CommonFailUI"),App.SoundManager().playEffect("sound_openDefeat_mp3")},i.prototype.onTurnViewClick=function(e){switch(e.target){case this.goToOne:this.currentTurnNum=this.goToOne.skipType;break;case this.goToTwo:this.currentTurnNum=this.goToTwo.skipType}this.callBack()},i.prototype.reflushBtnGroup=function(){this.btnGroup.removeChildren(),this.surpTime=this.time,this.timeLabel.text=this.surpTime+"",this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClose,this),this.goToOne.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTurnViewClick,this),this.goToTwo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTurnViewClick,this),this.goToOne.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.goToTwo.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.goToOne.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.goToTwo.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.defeatData=e.JsonDataManager.instance.fightDefeatArr;var t=this.defeatData.length,i=[];this.arrChange=[];for(var o=0;t>o;o++)if(this.defeatData[o].name&&void 0!=this.defeatData[o].name){if(4>o){var a=new n;if(this.curData==this.defeatData[o])continue;this.curData=this.defeatData[o],this.checkMoudleFinish(),i.push(this.curData),a.initUI(this.curData,this.callBack.bind(this)),this.btnGroup.addChild(a),a.y=o*(a.height-4)}}else{if(this.curData==this.defeatData[o])continue;this.curData=this.defeatData[o],this.checkMoudleFinish(),this.arrChange.push(this.curData)}this.changeTwoTurn()},i.prototype.checkMoudleFinish=function(){var t,i=0;switch(this.curData.skipType){case e.NameCode.FIRST_RECHARGE:t=e.PlayerService.instance.playerInfo.getVipLevel()>13?!0:!1;break;case e.NameCode.GEM:t=!1;break;case e.NameCode.SEARCHTREASURE:t=!1;break;case e.NameCode.EQUIP_INTENSIFY:t=!1;break;case e.NameCode.WING_SYSTEM:t=!1;break;case e.NameCode.VIP:t=!1;break;case e.NameCode.SOULUPGRADEPANEL:t=!1;break;case e.NameCode.CHARACTEROPENPANEL:var n=e.PlayerService.instance.getRoleDataList(),o=n.length;t=3==o?!0:2==o?!0:!1;break;case e.NameCode.PERSONAL_EQUIP:t=!1;break;case e.NameCode.LEGEN_WEAPON:t=e.CreateNewVipController.instance.isReceiveAward(3)?!0:!1}if(t)if(this.curData.skipType==e.NameCode.CHARACTEROPENPANEL){var n=e.PlayerService.instance.getRoleDataList(),o=n.length;2==o?(i=this.curData.turnId,this.curData=this.defeatData[i-1]):3==o&&(i=this.curData.turnId,this.curData=this.defeatData[i-1],this.checkMoudleFinish())}else i=this.curData.turnId,this.curData=this.defeatData[i-1],this.checkMoudleFinish()},i.prototype.onBeginClick=function(e){switch(e.target){case this.goToOne:this.goToOne.source=this.arrChange[0].iconStr+"xuanzhong_png";break;case this.goToTwo:this.goToTwo.source=this.arrChange[1].iconStr+"xuanzhong_png"}},i.prototype.onEndClick=function(e){switch(e.target){case this.goToOne:this.goToOne.source=this.arrChange[0].iconStr+"_png";break;case this.goToTwo:this.goToTwo.source=this.arrChange[1].iconStr+"_png"}},i.prototype.changeTwoTurn=function(){this.goToOne.source=this.arrChange[0].iconStr+"_png",this.goToOne.skipType=this.arrChange[0].skipType,this.goToTwo.source=this.arrChange[1].iconStr+"_png",this.goToTwo.skipType=this.arrChange[1].skipType},i.prototype.onBtnClose=function(t){e.PopUpManager.instance.removePopUp(e.WindowName.FIGHTLOSECONTROLER)},i.showFailUI=function(){e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHTLOSECONTROLER)},i.prototype.callBack=function(t){void 0===t&&(t=0);var i=0,n=0;switch(n=0==t?this.currentTurnNum:t){case e.NameCode.FIRST_RECHARGE:i=1,this.checkLevelOpen(i)&&e.RechargeController.getInstance().showPanel();break;case e.NameCode.GEM:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.GEM);break;case e.NameCode.SEARCHTREASURE:i=1,this.checkLevelOpen(i)&&e.SearchTreasureController.getInstance().showPanel();break;case e.NameCode.EQUIP_INTENSIFY:i=1,this.checkLevelOpen(i)&&e.SmeltController.getInstance().showPanel(e.SMELTTAPS.QIANGHUA);break;case e.NameCode.WING_SYSTEM:i=20,this.checkLevelOpen(i)&&e.WingController.getInstance().showWingPanel();break;case e.NameCode.VIP:i=1,this.checkLevelOpen(i)&&e.CreateNewVipController.instance.isShowPanel();break;case e.NameCode.SOULUPGRADEPANEL:i=95,this.checkLevelOpen(i)&&e.SoulController.getInstance().showUpgradePanel();break;case e.NameCode.CHARACTEROPENPANEL:var o=e.PlayerService.instance.getRoleDataList(),a=o.length;1==a?i=75:2==a&&(i=95),this.checkLevelOpen(i)&&e.CharacterOpenController.getInstance().showPanel();break;case e.NameCode.PERSONAL_EQUIP:i=90,this.checkLevelOpen(i)&&e.SuitEquipController.getInstance().showPanel();break;case e.NameCode.LEGEN_WEAPON:i=1,this.checkLevelOpen(i)&&(e.CreateNewVipController.instance.showPanel(3),e.CreateNewVipController.instance.isShowPanel())}e.PopUpManager.instance.hasPopUp(e.WindowName.NEW_AREA_UI)&&(e.PopUpManager.instance.removePopUp(e.WindowName.NEW_AREA_UI),e.MainControler.instance.setbtnmask(!1)),this.onBtnClose(null)},i.prototype.checkLevelOpen=function(t){if(e.PlayerService.instance.level<t){var i=e.LanguageUtils.instance.getValue("LEVELOPEN",t);return e.PopUpController.getInstance().showFloatTextPanel1(i),!1}return!0},i.prototype.autoClose=function(){function e(){var i=setTimeout(function(){t.timeLabel.text=--t.surpTime+"",t.surpTime>0?e():t.onBtnClose(null),clearTimeout(i)},1e3)}var t=this;e()},i}(e.ViewControler);e.CommonFailUI=i,__reflect(i.prototype,"foxgame.CommonFailUI");var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/tips/TipsDefeatSkinItem.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.isInit=!0,this.update()},t.prototype.update=function(){0!=this.isInit&&(this.myImg.source=this.urlImg+"_png",this.descTxt.text=this.descText,this.jumpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTurnClick,this))},t.prototype.initUI=function(e,t){this.turnToView=e.skipType,e.iconStr&&(this.urlImg=e.iconStr),this.descText=e.name,this.turnId=e.turnId,this.callF=t,this.update()},t.prototype.onTurnClick=function(){this.callF(this.turnToView)},t}(eui.Component);__reflect(n.prototype,"TurnViewItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="EquipIconSkin",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.touchEnabled=!0,this.touchChildren=!1,this.redImg.visible=!1},i.prototype.setEquip=function(t,i,n,o,a,s){void 0===n&&(n=null),void 0===o&&(o=-1),void 0===a&&(a=!0),this.equipId=t;var r=e.JsonDataManager.instance.equipTemplate,l=r[this.equipId];if(this.intensifyGroup.visible=!1,this.starLv.visible=!1,null==l){e.LanguageUtils.instance.getValue("PARTNAME"+i);return this.bgImg.source="equipPartGray"+i+"_png",void(this.icon.visible=!1)}this.icon.visible=!0,this.icon.setItem(l.id,1,a,!1),n?(this.intensifyGroup.visible=n.getCellStrenthLevel()>0,this.intensifyLevel.text=n.getCellStrenthLevel().toString(),this.starLv.visible=n.getCellStartLevel()>0,this.starLv.text=n.getCellStartLevel()+e.LanguageUtils.instance.getValue("XING")):(this.intensifyGroup.visible=!1,this.starLv.visible=!1),-1!=o&&this.icon.setQueneLevelProps(o,s)},i.prototype.setSpecialRing=function(t,i){if(0==i)return this.intensifyGroup.visible=!1,this.starLv.visible=!1,this.bgImg.source="specialRingGray"+(t+1)+"_png",void(this.icon.visible=!1);var n=e.JsonDataManager.instance.specialRingTemplate,o=n[t+1+"_"+i];this.starLv.visible=!1,i>0?(this.intensifyGroup.visible=!0,this.icon.setItem(o.id,-1,!1),this.icon.visible=!0):(this.intensifyGroup.visible=!1,this.icon.visible=!1),this.intensifyLevel.text=i+e.LanguageUtils.instance.getValue("JI")},i.prototype.setSuit=function(t,i){if(this.equipId=t,this.intensifyGroup.visible=!1,this.starLv.visible=!1,0>=t){e.LanguageUtils.instance.getValue("PARTNAME"+i);return this.bgImg.source="equipPartGray"+i+"_png",void(this.icon.visible=!1)}this.icon.visible=!0;var n=this.getTempEquipUpgrade()[t],o=this.getTempEquip()[t];this.icon.setItem(o.id),null!=n&&(this.intensifyGroup.visible=!0,this.intensifyLevel.text=n.level.toString()+e.LanguageUtils.instance.getValue("JI"))},i.prototype.setGodly=function(t,i,n){if(this.equipId=t,this.intensifyGroup.visible=!1,this.starLv.visible=!1,0>=t){var o;return o=n==e.EquipPartType.GOD_1?e.LanguageUtils.instance.getValue("PARTNAME"+n+"_"+i):e.LanguageUtils.instance.getValue("PARTNAME"+n),this.bgImg.source="godlyEquip"+n+"_png",void(this.icon.visible=!1)}var a=this.getTempGodly()[t],s=this.getTempEquip()[t];this.intensifyGroup.visible=!0,this.intensifyLevel.text=a.level+e.LanguageUtils.instance.getValue("JI"),this.icon.setItem(s.id),this.icon.visible=!0},i.prototype.setRedImgVisible=function(e){this.redImg.visible=e},i.prototype.getTempGodly=function(){return e.JsonDataManager.instance.godlyEquipTemplate},i.prototype.getbgImg=function(){return this.bgImg},i.prototype.getTempEquip=function(){return e.JsonDataManager.instance.equipTemplate},i.prototype.getTempEquipUpgrade=function(){return e.JsonDataManager.instance.equipmentUpgradeTemplate},i}(eui.Component);e.EquipIcon=t,__reflect(t.prototype,"foxgame.EquipIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.skinName="ItemIconSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isInit=!0,this.setItem(this.itemId,this.num,this.isShowName,this.isShowProfession)},Object.defineProperty(i.prototype,"seticonImg",{set:function(e){-1!=e.indexOf("_jpg")?this.iconImg.source=e:this.iconImg.source=e+"_png",this.qualityAnimaGroup.visible=!1,this.qualityGroup.visible=!1},enumerable:!0,configurable:!0}),i.prototype.setItem=function(t,i,n,o,a){if(void 0===i&&(i=1),void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===a&&(a=!1),this.itemId=t,this.num=i,this.isShowName=n,this.isShowProfession=o,this.isInit){this.clear();var s=this.getItemTemp()[this.itemId];if(null==s)return void(this.iconImg.source=null);var r=s.icon;if(null!=s.iconAnimName&&""!=s.iconAnimName?(this.iconAnimation=new e.FoxAni(this.iconAnimaGroup),this.iconAnimation.play(s.iconAnimName,"ani",-1),this.iconAnimaGroup.visible=!0,this.iconImg.visible=!1):(this.iconImg.source!=r&&(this.iconImg.source=r),this.iconImg.visible=!0),this.numLabel.text=this.num>1?e.GlobalUtil.getUnitString(this.num):"",n)if(s.type==e.ItemType.EQUIP)this.txtLabel.text=e.LanguageUtils.instance.getValue("LEVEL")+s.levelLimit,this.txtLabel.textColor=16382208;else if(s.type==e.ItemType.DRAGONBONE){var l=e.JsonDataManager.instance.dragonBoneTemplate[s.id];this.txtLabel.text=e.LanguageUtils.instance.getValue("LEVEL")+l.level,this.txtLabel.textColor=16382208}else s.type==e.ItemType.DRAGONARMOR?(this.txtLabel.text=e.LanguageUtils.instance.getValue("LEVEL")+s.levelLimit,this.txtLabel.textColor=16382208):(this.txtLabel.text=s.name,this.txtLabel.textColor=e.ColorUtils.instance.getColorByQuality(s.quality));if(s.type==e.ItemType.EQUIP&&o){this.proGroup.visible=!0,this.proImg1.visible=!1,this.proImg2.visible=!1,this.proImg3.visible=!1;var h=this.getEquipTemp(),c=h[s.id];c.profession==e.ProfessionType.PROFESSION1?this.proImg1.visible=!0:c.profession==e.ProfessionType.PROFESSION2?this.proImg2.visible=!0:c.profession==e.ProfessionType.PROFESSION3&&(this.proImg3.visible=!0)}a?this.jueban.visible=!0:this.jueban.visible=!1,this.qualityGroup.visible=!0;for(var u,p=1;6>=p;p++)u=this["quality"+p],u.visible=p==s.quality;null!=s.qualityAnimName&&""!=s.qualityAnimName&&(this.qualityAnimation=new e.FoxAni(this.qualityAnimaGroup),this.qualityAnimation.frameRate=10,this.qualityAnimation.play(s.qualityAnimName,"ani",-1),this.qualityAnimaGroup.visible=!0,this.cacheAsBitmap=!1)}},i.prototype.settxtlabel=function(e){this.txtLabel.text=e},i.prototype.setGray=function(t){t?(this.iconImg.filters=e.GlobalUtil.grayFilter,this.qualityGroup.visible=!1,this.qualityAnimaGroup.visible=!1,null!=this.qualityAnimation&&this.qualityAnimation.stop()):(this.iconImg.filters=[],this.qualityGroup.visible=!0,this.qualityAnimaGroup.visible=!0,null!=this.qualityAnimation&&this.qualityAnimation.startPlay())},i.prototype.clear=function(){this.qualityGroup.visible=!1,this.numLabel.text="",this.proGroup.visible=!1,this.txtLabel.text="",this.qualityAnimaGroup.visible=!1,null!=this.iconAnimation&&(this.iconAnimation.clear(),this.iconAnimation=null,this.iconAnimaGroup.visible=!1),null!=this.qualityAnimation&&(this.qualityAnimation.clear(),this.qualityAnimation=null,this.qualityAnimaGroup.visible=!1)},i.prototype.setShowQualityGroup=function(e){this.qualityGroup.visible=e},i.prototype.getOverX=function(){return this.txtLabel.width-this.iconImg.width>>1},i.prototype.getItemTemp=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.getEquipTemp=function(){return e.JsonDataManager.instance.equipTemplate},i.prototype.setQueneLevelProps=function(t,i){var n;n=i?i:e.BagController.getInstance().getEquipInfoById(t);var o=this.getItemTemp()[this.itemId];if(o.quality==e.EquipQuality.RED&&n){var a=n.getQuenchingLevel(),s=e.JsonDataManager.instance.redQuenching[a],r=s.nameEvolve;this.setQueneAni(r),this.setNameEvolve(r)}else this.setQueneAni("-1"),this.setNameEvolve("-1")},i.prototype.clearQuenLevelProps=function(){this.setQueneAni("-1"),this.setNameEvolve("-1")},i.prototype.setQueneAni=function(t){return"-1"==t?void(this.queneAniGroup.visible=!1):(this.queneAniGroup.visible=!0,this.queneMc||(this.queneMc=new e.FoxAni(this.queneAniGroup)),this.queneMc.play("fx_"+t,"ani"),void this.setShowQualityGroup(!1))},i.prototype.setNameEvolve=function(e){return"-1"==e?void(this.nameEvolve.visible=!1):(this.nameEvolve.visible=!0,void(this.nameEvolve.source="icon_"+e+"_png"))},i.iconSize=68,i.horizontalOver=16,i}(eui.Component);e.ItemIcon=t,__reflect(t.prototype,"foxgame.ItemIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return i._instance=e,e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="CommandToolsSkin",e.PopUpManager.instance.registerWindow(e.WindowName.COMMANDTOOLS,this,this),this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this),this.dataSource=new eui.ArrayCollection,this.btnList.dataProvider=this.dataSource,this.btnList.itemRenderer=e.CommandToolsItemRenderer,e.Message.instance.add(e.Code.BACKDOOR_LIST,this),e.Message.instance.add(e.Code.BACKDOOR_OPEN_S,this)},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.BACKDOOR_LIST:this.refresh(i);break;case e.Code.BACKDOOR_OPEN_S:e.MainControler.instance.dateBysign(i)}},i.prototype.show=function(t){var i=HawkProtocolManager.newBuilder("JsProto.BackdoorListRsp");e.Message.instance.send(e.Code.BACKDOOR_LIST,i,!0),e.PopUpManager.instance.addPopUp(e.WindowName.COMMANDTOOLS,e.WindowName.UILAYER,5,!0)},i.prototype.refresh=function(e){var t=e?e.getBackdoors():[],i=HawkProtocolManager.newBuilder("JsProto.BackdoorInfo");i.setId("destroyRes"),i.setName("destroyRes"),i.setNeedArg(!0);var n=[];n.push(i),t=n.concat(t),this.dataSource.replaceAll(t),this.dataSource.refresh()},i.prototype.dispose=function(){},i.prototype.closeHandler=function(t){e.PopUpManager.instance.removePopUp(e.WindowName.COMMANDTOOLS)},i.prototype.getParams=function(){return this.labelCommand.text},Object.defineProperty(i,"instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i}(e.ViewControler);e.CommandToolsController=t,__reflect(t.prototype,"foxgame.CommandToolsController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){this.stars=[this.star1,this.star2,this.star3,this.star4,this.star5,this.star6,this.star7,this.star8,this.star9,this.star10]},t.prototype.setStarLvl=function(e){if(0>e?e=0:e>10&&(e=10),this.stars)for(var t=0,i=this.stars.length;i>t;t++)e>t?this.stars[t].enabled=!0:this.stars[t].enabled=!1},t}(eui.Component);e.TenStar=t,__reflect(t.prototype,"foxgame.TenStar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.resGroupName="createCharacterPanelGroup",this.model=new e.CreateCharacterModel,this.panel=new e.CreateCharacterPanel(this.model)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ROLE_CREATE_S:this.createBack(i)}},t.prototype.createBack=function(t){var i=t.getStatus();if(i>0)return 7==i?e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHARACTERNAMEERROR2")):8==i&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHARACTERNAMEERROR3")),void e.MtaUtils.notifyEvent("chuangjiaojinyo",{recvcreaterolefail:"true"});var n="guide_pre";RES.createGroup(n,["guideMission_n_json","common_bg_png","battle_json","item1_277_json","lv_fnt","tips02_json","skillIcon_json","item23150_27090_json","item33050_36160_json","welcome_beijingdi_png","welcome_start_png","diaoluowupinkuang_png","pve_xsyd_0_slt_jpg","diaoluowupinkuang_png","drop_light_yellow_png"]),e.MainLoadingController.instance.addPreload("guide_pre");var o="guideMission_guangxiao_png",a="guideMission_guangxiao_json";RES.createGroup("guideMission_guangxiao",[o,a]),e.MainLoadingController.instance.addPreload("guideMission_guangxiao"),e.MainLoadingController.instance.startLoad(),App.SoundManager().setBgOn(!1),App.SoundManager().stopBg(),this.cleanUp();var s={code:"createPlayer",data:t,roleid:t.getRoleInfo().getRoleId(),name:t.getRoleInfo().getName(),game_key:e.UserInfo.platform.game_id,appkey:e.UserInfo.platform.appKey,user_id:e.UserInfo.platform.uid,role_name:e.UserInfo.platform.username,game_area:e.Global.serverId,serverName:e.Global.serverName,level:t.getRoleInfo().getLevel(),platformUrl:e.Global.globalConfig.platformUrl};if(e.UserInfo.platform.reportData_legend(s),"wx_xinghe"==window.GJlenged_chanel){e.PlayerService.instance;updateRoleInfo_wxgame_xinghe("create",e.Global.serverId,e.Global.serverName,e.Global.playerId+"",t.getRoleInfo().getName(),1,13,0)}window.sdk&&(window.sdk.CreateRoleNew=!0),e.MtaUtils.notifyEvent("chuangjiaojinyo",{recvcreateroleok:"true"})},t.prototype.cleanUp=function(){this.panel.close(),this.panel=null,this.model.cleanData(),this.model=null,this.cleanTempName()},t.prototype.createCharacter=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.loadComplete,this),RES.loadGroup(this.resGroupName)},t.prototype.showPanel=function(){e.UserInfo.platform.reportData_legend({code:"tdcreate"}),this.changeSex(e.RoleSexType.MAN),this.changeName(),this.panel.show(),e.MainLoadingController.instance.hidelabel()},t.prototype.loadComplete=function(e){e.groupName==this.resGroupName&&this.showPanel()},t.prototype.changeSex=function(e){this.model.setSex(e)},t.prototype.changeName=function(){var e=this.getTempName(),t=e.length,i=e[Math.floor(Math.random()*t)],n=e[Math.floor(Math.random()*t)];this.model.selectName(i,n)},t.prototype.getNextRandomName=function(t){var i=this.getTempName(),n=i.length,o=i[Math.floor(Math.random()*n)],a=i[Math.floor(Math.random()*n)];return t==e.RoleSexType.MAN?o.firstName+a.manName:o.firstName+a.womanName
},t.prototype.getTempName=function(){return e.JsonDataManager.instance.nameTemplate},t.prototype.cleanTempName=function(){},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();e.CreateCharacterController=t,__reflect(t.prototype,"foxgame.CreateCharacterController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.imgNameList=["1zhanshinan","1fashinan","1daoshinan","1zhanshinv","1fashinv","1daoshinv"],e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="CreateCharacterItem",this.touchChildren=!1},i.prototype.setItem=function(e){this.roleVO=this.getRoleTemplate()[e],this.itemImg.source=this.imgNameList[this.roleVO.id-1]+"_png",this.proImg1.visible=!1,this.proImg2.visible=!1,this.proImg3.visible=!1,this["proImg"+this.roleVO.profession].visible=!0},i.prototype.getRoleTemplate=function(){return e.JsonDataManager.instance.roleTemplate},Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e},enumerable:!0,configurable:!0}),i}(eui.Component);e.CreateCharacterItem=t,__reflect(t.prototype,"foxgame.CreateCharacterItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this._curIndex=-1,this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.selectName=function(e,t){this._nameVO=e,this._secondNameVO=t,this.updateView()},t.prototype.setCurIndex=function(e){this._curIndex=e,this.updateView()},t.prototype.getCurIndex=function(){return-1==this._curIndex&&(this._curIndex=0),this._curIndex},t.prototype.setSex=function(e){this.sex=e,this.roleIdList=[];var t,i=this.getRoleTemplate();for(var n in i)t=i[n],t.sex==this.sex&&this.roleIdList.push(t.id);this.updateView()},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},t.prototype.getRoleTemplate=function(){return e.JsonDataManager.instance.roleTemplate},Object.defineProperty(t.prototype,"nameVO",{get:function(){return this._nameVO},enumerable:!0,configurable:!0}),t.prototype.getSecondNameVO=function(){return this._secondNameVO},t.prototype.cleanData=function(){this.observerList=null,this.roleIdList=null,this._nameVO=null,this._secondNameVO=null,this.gemModuleShowRPAry=null},t}();e.CreateCharacterModel=t,__reflect(t.prototype,"foxgame.CreateCharacterModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/createCharacter/CreateCharacterSkin.exml","createCharacterPanelGroup")||this;return i.totalTime=200,i.aniList=[],i.createBtnSourceDown="kaishiyouxi_anxia_png",i.createBtnSourceNormal="kaishiyouxiB_png",i.createBtnSourceTimestamp=egret.getTimer(),i.setIsShowBackBtn(!1),i.setIsShowTween(!1),i.setRegisterTick(!0),i.isMask=!1,i.setIsTextureCache(!1),i.model=e,App.MessageCenter.addListener("resizeWindowHandler",i.resizeWindowHandler,i),i}return __extends(i,t),i.prototype.resizeWindowHandler=function(e){this.getIsInit()&&(this.resetItemPos(),this.doBgImgScreenAdaptation())},i.prototype.doBgImgScreenAdaptation=function(){ScreenAdaptation.instance.uiWidth/2,ScreenAdaptation.instance.uiHeight},i.prototype.closeHook=function(){this.updateTimer.stop(),this.updateTimer.removeEventListener(egret.TimerEvent.TIMER,this.onUpdate,this),this.updateTimer=null,App.MessageCenter.removeListener("resizeWindowHandler",this.resizeWindowHandler,this);var t=["zsnandonghua","fsnandonghua","dsnandonghua","zsnvdonghua","fsnvdonghua","dsnvdonghua"];null!=this.ui&&(this.ui.removeChildren(),this.ui=null);for(var i=0,n=t.length;n>i;)e.GlobalUtil.destroyRes(t[i]),e.GlobalUtil.destroyRes(t[i]+"_json"),i+=1;t=null},i.prototype.initHook=function(){this.model.registerObserver(this);for(var t,i=this.getItemList(),n=(ScreenAdaptation.instance.uiWidth-(ScreenAdaptation.instance.uiWidth-e.Global.SCREEN_WIDTH>>1),i[0]?~~(i[0].width*(2/3)):160,0),o=i.length;o>n;)t=i[n],this.model.startX=t.x*(ScreenAdaptation.instance.uiWidth/this.ui.width),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this),n++;this.ui.manBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.manHandler,this),this.ui.womanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.womanHandler,this),this.ui.randomBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.randomNameHandler,this),this.ui.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startHandler,this),this.model.speedX=Math.abs((t.width-(this.ui.width-t.x))/this.totalTime);for(var a=(ScreenAdaptation.instance.uiWidth/this.ui.width,0);6>a;++a){var s=a%2==0?e.RoleSexType.MAN:e.RoleSexType.WOMAN,r=this.getPlayerNameLabel(a);r.textFlow=new Array({text:e.CreateCharacterController.instance.getNextRandomName(s),style:{textColor:4576767}},{text:"进入了游戏",style:{textColor:16763692}})}this.updateTimer=new egret.Timer(50),this.updateTimer.addEventListener(egret.TimerEvent.TIMER,this.onUpdate,this),this.updateTimer.start(),e.Global.isWeChatXiaoChengXuBranch&&(this.ui.registGiftYuanbaoImg.source="registGiftYuanbao_jpg")},i.prototype.onUpdate=function(t){for(var i=0;6>i;++i){var n=this.getPlayerNameLabel(i);if(n.bottom>112){n.bottom=-4;var o=i%2==0?e.RoleSexType.MAN:e.RoleSexType.WOMAN;n.textFlow=new Array({text:e.CreateCharacterController.instance.getNextRandomName(o),style:{textColor:4576767}},{text:"进入了游戏",style:{textColor:16763692}})}n.bottom=n.bottom+2}},i.prototype.initParams=function(){},i.prototype.refresh=function(){for(var t=this.model.roleIdList[this.model.getCurIndex()],i=this.getRoleTemplate()[t],n=this.getProGroupList(),o=n.length,a=0;o>a;a++)n[a].visible=i.profession==a+1;var s=this.getAniGroupList();o=s.length,a=0;for(var r,l,h=["zsnandonghua","fsnandonghua","dsnandonghua","zsnvdonghua","fsnvdonghua","dsnvdonghua"];o>a;a++)l=s[a],r=this.aniList[a],i.id==a+1?(l.visible=!0,r.isPlay||(r.play(h[a],"ani",-1),this.setPosition(a,r.mcObject))):(r.isPlay||(r.play(h[a],"ani",-1),this.setPosition(a,r.mcObject)),l.visible=!1);h=null;var c=this.getItemList();o=c.length;for(var u,p=0;o>p;p++)u=c[p],u.setItem(this.model.roleIdList[p]),u.selected=this.model.getCurIndex()==p;this.ui.manBtn.currentState="up",this.ui.womanBtn.currentState="up",i.sex==e.RoleSexType.MAN?(this.ui.manBtn.currentState="down",this.ui.nameLabel.text=this.model.nameVO.firstName+this.model.getSecondNameVO().manName):(this.ui.womanBtn.currentState="down",this.ui.nameLabel.text=this.model.nameVO.firstName+this.model.getSecondNameVO().womanName),e.GlobalUtil.speedLoadResGroupAtCreateCharacterPanel()},i.prototype.setPosition=function(e,t){var i=0,n=0;switch(e){case 0:i=4,n=-8;break;case 1:i=-10,n=-15;break;case 2:i=11,n=-16;break;case 3:i=-30,n=-12;break;case 4:i=-2,n=-13;break;case 5:i=10,n=-20}t.x=i,t.y=n},i.prototype.showHook=function(){var t=e.GamePlatform.logDomain;e.GameUtils.httpSend(t,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID(),channelid:"qqgame",level:"1"},what:"create_role",who:e.UserInfo.platform.getPuid()})),this.model.lastTime=egret.getTimer()},i.prototype.resetItemPos=function(){if(!(this.model.lastTime<0))for(var t,i=this.getItemList(),n=i.length,o=(ScreenAdaptation.instance.uiWidth-(ScreenAdaptation.instance.uiWidth-e.Global.SCREEN_WIDTH>>1),0);n>o;o++)t=i[o],t.x=this.model.getCurIndex()==o?ScreenAdaptation.instance.uiWidth-t.width+25:this.model.startX},i.prototype.updateView=function(){this.refresh()},i.prototype.tickHook=function(e){if(this.tweenItem(e),e-this.createBtnSourceTimestamp>600){this.createBtnSourceTimestamp=e;var t=this.ui.startBtn.getChildAt(0);t.source==this.createBtnSourceNormal?t.source=this.createBtnSourceDown:t.source=this.createBtnSourceNormal}},i.prototype.tweenItem=function(e){if(!(this.model.lastTime<0)){var t,i=this.getItemList(),n=i.length,o=e-this.model.lastTime;this.model.lastTime=e;for(var a=0;n>a;a++)if(t=i[a],a==this.model.getCurIndex()){if(t.x-=this.model.speedX*o,t.x<=ScreenAdaptation.instance.uiWidth-t.width)return this.resetItemPos(),void(this.model.lastTime=-1)}else t.x<this.model.startX&&(t.x+=this.model.speedX*o)}},i.prototype.itemClickHandler=function(e){if(!(this.model.lastTime>0)){var t=this.getItemList(),i=t.indexOf(e.target);this.model.getCurIndex()!=i&&(this.model.setCurIndex(i),this.model.lastTime=egret.getTimer())}},i.prototype.manHandler=function(t){e.CreateCharacterController.instance.changeSex(e.RoleSexType.MAN)},i.prototype.womanHandler=function(t){e.CreateCharacterController.instance.changeSex(e.RoleSexType.WOMAN)},i.prototype.randomNameHandler=function(t){e.CreateCharacterController.instance.changeName()},i.prototype.startHandler=function(t){if(egret.getOption("pf")&&-1!=egret.getOption("pf").indexOf("dcerf")||window.egret_quickgame&&"newOppogame"==window.GJlenged_chanel||"wx360game"==window.GJlenged_chanel)return void e.GameUtils.MSG_TIP("角色创建已关闭！");var i=new RegExp(".*[^ ].*"),n=i.test(this.ui.nameLabel.text);if(0==n)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CHARACTERNAMEERROR1"));var o=HawkProtocolManager.newBuilder("JsProto.HPRoleCreate");if(o.setRoleItemId(this.model.roleIdList[this.model.getCurIndex()]),o.setRoleName(this.ui.nameLabel.text),e.Global.launchOptions&&e.Global.launchOptions.playerIdentify){var a=e.Global.launchOptions;o.setInviteIdentify(a.playerIdentify),o.setInviteTime(a.inviteTime)}e.Message.instance.send(e.Code.ROLE_CREATE_C,o,!0),e.MtaUtils.notifyEvent("chuangjiaojinyo",{clicksendcreaterole:"true"});var s=e.GamePlatform.logDomain;e.GameUtils.httpSend(s,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID(),channelid:"qqgame",level:"1"},what:"start_game",who:e.UserInfo.platform.getPuid()}))},i.prototype.getRoleTemplate=function(){return e.JsonDataManager.instance.roleTemplate},i.prototype.getProGroupList=function(){var e=[];return e.push(this.ui.proGroup1),e.push(this.ui.proGroup2),e.push(this.ui.proGroup3),e},i.prototype.getAniGroupList=function(){for(var t=[],i=0,n=6;n>i;i++){var o=new e.FoxAni(this.ui["aniGroup"+i]);t.push(this.ui["aniGroup"+i]),o.resGroupLoadPriority=e.Global.LoadMainLoadingUIGroupPriority,this.aniList.push(o)}return t},i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},i.prototype.getPlayerNameLabel=function(e){return this.ui["playerName"+e]},i}(e.BasePanel);e.CreateCharacterPanel=t,__reflect(t.prototype,"foxgame.CreateCharacterPanel",["foxgame.ICreateCharacter","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"DaFuWengPanel","dafuweng")||this;return i.isCanTouzhi=!0,i.startPos=0,i.viewisReady=!1,i.dataReady=!1,i.isCanChangeViewport=!1,i.preTimes=0,i.isMask=!0,i.isMaskdown=!0,i.adaptionType=1,i.model=e,i.viewisReady=!1,i.dataReady=!1,i.setRegisterTick(!0),i.model.registerObserver(i),i}return __extends(i,t),i.prototype.panelChanged=function(){this.dataReady=!0,this.viewisReady&&this.initUI()},i.prototype.initHook=function(){var t=this;this.ui.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelpClick,this),this.ui.btn_touzhi.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouzhiClick,this),this.ui.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRankClick,this),this.ui.btn_chongzhi.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChongZhiClick,this),this.ui.lab_show.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShowLabelClick,this);var i=this.model.getDafuwengInfoData().getMapInfo();i.forEach(function(i){var n=i.getAward();if(n){var o=i.getId(),a=new e.AttributeVO(n),s=t.getStepByNum(o),r=s.numChildren,l=s.getChildAt(r-1);l.name!=n&&(78!=o&&(s.getChildAt(r-2).visible=!1),l.name=n,l.visible=!0,l.setItem(a.id,a.value,!1),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},t))}})},i.prototype.showHook=function(){this.setTouzhi(!0),this.isCanChangeViewport=!1,this.ui.lab_show.textFlow=(new egret.HtmlTextParser).parse("<u>查看</u>"),this.baoxiangMC&&(this.baoxiangMC.clear(),this.baoxiangMC=null),this.baoxiangMC=new e.FoxAni(this.ui.group_baoxiang_light),this.baoxiangMC.play("fx_baoxiang_light","ani",-1),this.viewisReady=!0,e.ActivityBarController.getInstance().setDafuwengEffect(!1)},i.prototype.tickHook=function(t){if(this.model.getDafuwengRefreshTimes()&&this.model.dafuwengCurRefreshTimes){var i=t-this.preTimes;i>=1e3&&(this.preTimes=t,this.model.dafuwengCurRefreshTimes-=1e3);var n=this.model.dafuwengCurRefreshTimes;this.ui.lab_refreshTimes.text=e.GlobalUtil.getTimeString(Math.ceil(n/1e3),2),0==Math.ceil(n/1e3)&&e.ActivityController.getIntance().sendmessageDafuWenginfo()}},i.prototype.initUI=function(){this.model.getDafuwengRefreshTimes().getState()&&(this.setRegisterTick(!1),this.ui.lab_refreshTimes.parent.visible=!1);var t=this.model.getDafuwengInfoData();if(null!=t&&void 0!=t){var i=this.charStringBack(t.getStartTime(),t.getEndTime());this.ui.lab_actTimes.textFlow=(new egret.HtmlTextParser).parser(i);var n=t.getTimes();this.ui.lab_times.text=String(n);var o,a;n>0&&(this.touziBtnMC&&(this.touziBtnMC.clear(),this.touziBtnMC=null),this.touziBtnMC_1&&(this.touziBtnMC_1.clear(),this.touziBtnMC_1=null),this.touziBtnMC=new e.FoxAni(this.ui.touziBtn_mc),this.touziBtnMC.scaleX=this.touziBtnMC.scaleY=2.2,this.touziBtnMC.play("effect_vip","ani",-1),this.touziBtnMC_1=new e.FoxAni(this.ui.touziBtn_mc),this.touziBtnMC_1.scaleX=this.touziBtnMC_1.scaleY=2.2,this.touziBtnMC_1.play("textFlash","ani",-1)),this.ui.lab_chongzhi.text=String(t.getRechargeNumber()),this.ui.lab_chongzhigetNum.text=String(t.getAddTimes());var s=e.PlayerService.instance.playerId;this.model.curTouziNum&&(this.ui.img_touzi.source="touzi_"+this.model.curTouziNum+"_png"),console.log("this.model.curTouziNum:",this.model.curTouziNum);for(var r=t.getPlayerInfo(),l=1;3>=l;l++)this.getImgTopPlayer(l).visible=!1;for(var l=0;l<r.length;l++){var h=r[l].getPlayerId(),c=r[l].getRank(),u=(r[l].getItmeId(),r[l].getId()),p=this.getStepByNum(u);if(h!=s&&3>=c){var g=this.getStepPos(u);this.getImgTopPlayer(c).x=g.x+p.width/2,this.getImgTopPlayer(c).y=g.y+p.height/2,this.getImgTopPlayer(c).visible=!0}h==s&&(o=u,this.startPos=o,a=this.getStepPos(o),this.ui.img_player.x=a.x+p.width/2,this.ui.img_player.y=a.y+p.height/2,this.ui.img_player.visible=!0,p.getChildAt(0).visible=!0,this.changeViewport(o,a))}}},i.prototype.changeViewport=function(e,t){if(this.isCanChangeViewport){if(10>=e&&(t=this.getStepPos(10),egret.Tween.get(this.ui.scroller_map.viewport).to({scrollV:0},400)),e>10&&63>e){var i=t.y-3*this.getStepByNum(0).width;egret.Tween.get(this.ui.scroller_map.viewport).to({scrollV:i},400)}else if(e>=63){t=this.getStepPos(63);var i=t.y-2.5*this.getStepByNum(0).width;egret.Tween.get(this.ui.scroller_map.viewport).to({scrollV:i},400)}}else if(e>10&&63>e)this.ui.scroller_map.viewport.scrollV=t.y-3*this.getStepByNum(0).width;else if(e>=63){var n=this.getStepPos(63);this.ui.scroller_map.viewport.scrollV=n.y-2.5*this.getStepByNum(0).width}},i.prototype.getStepPos=function(e){this.ui.group_map.validateNow();var t=this.getStepByNum(e),i=t.localToGlobal();return this.ui.group_map.globalToLocal(i.x,i.y,this.model.resultPoint),this.model.resultPoint},i.prototype.onHelpClick=function(){e.HelpController.getInstance().showPanel("DAFUWENGHELP")},i.prototype.closeHook=function(){this.isCanChangeViewport=!1},i.prototype.onTouzhiClick=function(){this.isCanTouzhi&&(this.isCanChangeViewport=!0,this.setTouzhi(!1),this.changeViewport(this.startPos,this.getStepPos(this.startPos)),e.ActivityController.getIntance().sendmessageDafuWengCast())},i.prototype.createTouziMC=function(t){var i=this;this.ui.img_touzi.visible=!1,this.touziMC=new e.FoxAni(this.ui.group_touziMC),this.touziMC.offsetX=this.ui.group_touziMC.width/2,this.touziMC.offsetY=this.ui.group_touziMC.height/2,this.touziMC.play("fx_sieve","ani",3),this.touziMC.mcObject.addEventListener(egret.Event.COMPLETE,function(){i.touziMC.clear(),i.touziMC=null,i.ui.img_touzi.source="touzi_"+t+"_png",i.endPos=i.startPos+t,i.ui.img_touzi.visible=!0,i.move()},this)},i.prototype.move=function(){var t=this;if(this.startPos<78)if(this.startPos<this.endPos&&this.parent){this.getIsShow()&&(this.getStepByNum(this.startPos).getChildAt(0).visible=!1),this.startPos++;var i=this.getStepPos(this.startPos);egret.Tween.get(this.ui.img_player).to({x:i.x+this.getStepByNum(0).width/2,y:i.y+this.getStepByNum(0).height/2},300).call(function(){if(t.startPos<78&&t.getIsShow()){var i=t.getStepByNum(t.startPos).getChildAt(0);i.visible=!0,t.startPos!=t.endPos&&egret.Tween.get(i).to({visible:!1},300)}78==t.startPos&&(e.ActivityController.getIntance().sendmessageDafuwengAward(),e.ActivityController.getIntance().sendmessageDafuWenginfo()),t.move()})}else e.ActivityController.getIntance().sendmessageDafuwengAward(),e.ActivityController.getIntance().sendmessageDafuWenginfo()},i.prototype.onChongZhiClick=function(){e.RechargeController.getInstance().showPanel()},i.prototype.onRankClick=function(){e.ActivityController.getIntance().showDafuwengRankPanel()},i.prototype.onShowLabelClick=function(){this.dafuwengshowTip||(this.dafuwengshowTip=new e.DafuwengShowTips),this.addChild(this.dafuwengshowTip);var t=this.model.getDafuwengInfoData();this.dafuwengshowTip.refresh(t.getVersionNumber())},i.prototype.checkCurPosAward=function(t){var i=this.model.getDafuwengInfoData(),n=i.getMapInfo(),o=null;if(n.forEach(function(e){e.getId()==t&&(o=e.getAward())}),o){var a=new e.AttributeVO(o),s=this.getStepByNum(t).localToGlobal();e.FlyController.getInstance().flyToBag(s,a.id,a.value)}},i.prototype.charStringBack=function(t,i){var n=new Date;n.setTime(t);var o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),r=new Date;r.setTime(i);var l=r.getFullYear(),h=r.getMonth()+1,c=r.getDate(),u="00:00",p="23:59",g=e.LanguageUtils.instance.getValue("ACTIVITY_KAIFUSHIJIAN",o,a,s,u,l,h,c,p);return g},i.prototype.setTouzhi=function(e){this.isCanTouzhi=e},i.prototype.getStepByNum=function(e){return this.ui["step_"+e]},i.prototype.getImgTopPlayer=function(e){return this.ui["img_top"+e]},i}(e.BasePanel);e.DaFuWengPanel=t,__reflect(t.prototype,"foxgame.DaFuWengPanel",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/dafuweng/DafuwengShowTips.exml",e.touch_group.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.parent&&e.parent.removeChild(e)},e),e}return __extends(i,t),i.prototype.refresh=function(t){for(var i=e.JsonDataManager.instance.dafuwengMap[t],n=i.recharge,o='<font size=20 color=0xeee3c6 fontFamily="宋体">累计充值金额</font>\n',a='<font size=20 color=0xffba00 fontFamily="宋体">获得次数</font>\n',s=0;s<n.length;s++){n[s][0];o+='<font size=18 color=0xeee3c6 fontFamily="宋体">  '+n[s][0]+" 元宝</font>\n",a+='<font size=18 color=0xffba00 fontFamily="宋体">  '+n[s][1]+"</font>\n"}for(var r=i.refreshTime,l='<font size=20 color=0xeee3c6 fontFamily="宋体">在线时间</font>\n',h="<font size=20 color=0xffba00>获得次数</font>\n",s=0;s<r.length;s++)l+='<font size=18 color=0xeee3c6 fontFamily="宋体">  '+r[s]+" 分钟</font>\n",h+='<font size=18 color=0xffba00 fontFamily="宋体">  1</font>\n';this.label_chongzhiMsg.textFlow=(new egret.HtmlTextParser).parse(o),this.label_chongzhigive.textFlow=(new egret.HtmlTextParser).parse(a),this.label_timesMsg.textFlow=(new egret.HtmlTextParser).parse(l),this.label_timesgive.textFlow=(new egret.HtmlTextParser).parse(h)},i}(eui.Component);e.DafuwengShowTips=t,__reflect(t.prototype,"foxgame.DafuwengShowTips",["eui.UIComponent","egret.DisplayObject"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"DaFuWengRank","dafuweng")||this;return i.isMask=!0,i.isMaskdown=!0,i.adaptionType=1,i.model=e,i.dataReady=!1,i.viewisReady=!1,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.ui.list_paiming.itemRenderer=e.TopListItemRender,this.ui.list_paiming.dataProvider=this.model.collection_dafuwengRank},i.prototype.showHook=function(){this.viewisReady=!0},i.prototype.panelChanged=function(){this.dataReady=!0,this.viewisReady&&this.initUI()},i.prototype.initUI=function(){var t=this.model.getDafuwengRankData(),i=t.getNormalAward();if(i){var n=new e.AttributeVO(i);this.ui.normalAwardIcon.setItem(n.id,1,!1),this.ui.normalAwardIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(n.id,n.value,!1)},this)}var o=t.getAwards();if(o){var a=new e.AttributeVO(o);this.ui.bigAwardsIcon.setItem(a.id,1,!1),this.ui.bigAwardsIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(a.id,a.value,!1)},this)}var s=t.getRankAward();if(s){var r=new e.AttributeVO(s);this.ui.topAwardsIcon.setItem(r.id,1,!1),this.ui.topAwardsIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(r.id,r.value,!1)},this)}for(var l=t.getRankInfo(),h=[],c=0;c<l.length;c++){var u=new e.DaFuWengPlayerRankInfo;u.rankId=l[c].getRankId();var p=l[c].getAward();switch(u.rankId){case 1:u.rankBgSource="Guild_qizijing_png";break;case 2:u.rankBgSource="Guild_qiziying_png";break;case 3:u.rankBgSource="Guild_qizitong_png";break;default:u.rankBgSource=null}u.name=l[c].getName(),u.topAward=new e.AttributeVO(p),u.progress=l[c].getCoordinateId()||0;var g=l[c].getState();g?u.stateSource="leiji_yilingqu2_png":u.stateSource="leiji_weijihuo_png",h.push(u)}this.ui.list_paiming.itemRenderer=e.TopListItemRender,this.model.datasource_dafuwengRank=h,this.ui.list_paiming.dataProvider=this.model.collection_dafuwengRank,this.model.collection_dafuwengRank.replaceAll(this.model.datasource_dafuwengRank)},i.prototype.onCloseClick=function(){this.close()},i}(e.BasePanel);e.DaFuWengRankPanel=t,__reflect(t.prototype,"foxgame.DaFuWengRankPanel",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/dafuweng/DaFuWengListSkin.exml",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh(this.data)},i.prototype.refresh=function(t){t&&(this.img_rankBg.source=t.rankBgSource,this.rankId.text=String(t.rankId),this.lab_name.text=t.name,t.name?(this.lab_step.text=String(t.progress),this.img_state.source=t.stateSource,this.img_state.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(t.topAward.id,t.topAward.value,!1)},this)):(this.lab_step.text="",this.img_state.source="",this.topAwardicon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(t.topAward.id,t.topAward.value,!1)},this)),this.topAwardicon.setItem(t.topAward.id,t.topAward.value,!1))},i}(eui.ItemRenderer);e.TopListItemRender=t,__reflect(t.prototype,"foxgame.TopListItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DaFuWengPlayerRankInfo=t,__reflect(t.prototype,"foxgame.DaFuWengPlayerRankInfo")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.refreshTime=[],this.recharge=[]}return e}();e.DafuwengTip=t,__reflect(t.prototype,"foxgame.DafuwengTip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.Type_1=1]="Type_1",e[e.Type_2=2]="Type_2",e[e.Type_3=3]="Type_3"}(t=e.DASelectPanelType||(e.DASelectPanelType={}));var i;!function(e){e[e.Panel_1=1]="Panel_1",e[e.Panel_2=2]="Panel_2",e[e.Panel_3=3]="Panel_3"}(i=e.DAPanelType||(e.DAPanelType={}));var n;!function(e){e[e.Part_1=0]="Part_1",e[e.Part_2=1]="Part_2",e[e.Part_3=2]="Part_3",e[e.Part_4=3]="Part_4",e[e.Part_5=4]="Part_5",e[e.Part_6=5]="Part_6",e[e.Part_7=6]="Part_7",e[e.Part_8=7]="Part_8"}(n=e.DAPartType||(e.DAPartType={}));var o;!function(e){e.SkillIconNum=5,e.ArmorPartSourceList={2:"longjia_hushou_png",6:"longjia_jiezi_png",4:"longjia_toukui_png",0:"longjia_wuqi_png",5:"longjia_xianglian_png",7:"longjia_xiezi_png",3:"longjia_yaodai_png",1:"longjia_yifu_png"},e.SkillQualityIcon={4:"ziSeJiNeng_BiaoJi_png",5:"chengSeJiNeng_biaoJi_png",6:"hongSeJiNeng_biaoJi_png"},e.SkillEngraveSourceIcon="kongJiNeng_biaoJi_png",e.SkillEngravePaomaList=[1,10,12,15,18],e.PartFoxAniSourceList={0:"wuqi_dhzs",1:"yifu_dhzs",2:"hushou_dhzs",3:"yaodai_dhzs",4:"toukui_dhzs",5:"xianglian_dhzs",6:"jiezhi_dhzs",7:"xiezi_dhzs"},e.PartLength=8}(o=e.DAConst||(e.DAConst={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.equipbool=!1,this.model=new e.DragonArmorModel,this.panel=new e.DragonArmorPanel(this.model)}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showArmorPanel=function(t){void 0===t&&(t=0),this.model.RoleIndex=t,this.model.CurentTap=e.DAPanelType.Panel_1,this.panel.showPanel()},t.prototype.closeArmorPanel=function(){this.panel.getIsShow()&&this.panel.close()},t.prototype.chooseWearArmor=function(e){this.model.CurChoosePart=e,this.refreshMainUI()},t.prototype.showSeletctWearPanel=function(t,i){void 0===i&&(i=0),(null==this.selectWearPanel||void 0==this.selectWearPanel)&&(this.selectWearPanel=new e.DragonArmorSelectWearPanel(this.model)),this.selectWearPanel.showpanel(t,i)},t.prototype.refreshMainUI=function(){this.panel&&this.panel.getIsShow()&&this.panel.refreshUI()},t.prototype.selectEngraveArmor=function(e){this.resetEngraveAni(),this.selectWearPanel&&this.selectWearPanel.parent&&this.selectWearPanel.close(),this.model.CurEngraveArmorPart=e,this.model.CurEngraveStone=null,this.refreshMainUI()},t.prototype.resetEngraveAni=function(){return 0==this.panel.getaniPlayEnd()?(this.panel.resetEngraveAni(),this.model.CurEngraveStone=null,!0):!1},t.prototype.selectEngraveStone=function(e){this.selectWearPanel.close(),this.model.CurEngraveStone=e,this.refreshMainUI()},t.prototype.showEngravedSkillPanel=function(){(null==this.engravedSkillPanel||void 0==this.engravedSkillPanel)&&(this.engravedSkillPanel=new e.DragonArmorSkillPanel(this.model)),this.engravedSkillPanel.show()},t.prototype.registerMsg=function(t){t.add(e.Code.DRAGON_ARMOUR_INFO_S,this),t.add(e.Code.DRAGON_ARMOUR_DRESS_S,this),t.add(e.Code.DRAGON_ARMOUR_ENGRAVE_S,this),t.add(e.Code.DRAGON_ARMOUR_QUENCHING_S,this),t.add(e.Code.DRAGON_ARMOUR_SHOW_GUARD_S,this),t.add(e.Code.DRAGON_ARMOUR_OPEN_PORE_S,this),t.add(e.Code.DRAGON_ARMOUR_YU_ENGRAVE_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.DRAGON_ARMOUR_INFO_S:this.drga_infoBack(i);break;case e.Code.DRAGON_ARMOUR_DRESS_S:this.drga_dressBack(i);break;case e.Code.DRAGON_ARMOUR_YU_ENGRAVE_S:this.drga_yuEngraveBack(i);break;case e.Code.DRAGON_ARMOUR_ENGRAVE_S:this.drga_engraveBack(i);break;case e.Code.DRAGON_ARMOUR_QUENCHING_S:this.drga_quenchBack(i);break;case e.Code.DRAGON_ARMOUR_SHOW_GUARD_S:this.drga_setGuard(i);break;case e.Code.DRAGON_ARMOUR_OPEN_PORE_S:this.drga_openPore(i)}},t.prototype.sendDragonInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.DragonArmourInfoReq");e.Message.instance.send(e.Code.DRAGON_ARMOUR_INFO_C,t,!0)},t.prototype.drga_infoBack=function(e){this.model.setDragonAInfo(e),this.refreshMainUI()},t.prototype.sendDragonDress=function(t,i,n){var o=HawkProtocolManager.newBuilder("JsProto.DragonArmourDressReq");o.setPartId(t),o.setArmourId(i),o.setRoleId(n),e.Message.instance.send(e.Code.DRAGON_ARMOUR_DRESS_C,o,!0)},t.prototype.drga_dressBack=function(e){e.getErrorNo()>0||(this.selectWearPanel.close(),this.model.setRolePartWear(e),this.refreshMainUI())},t.prototype.sendYuEngrave=function(t){this.model.curChangeSkillIdx=-1,this.model.RsgEngraveInfo=!1;var i=HawkProtocolManager.newBuilder("JsProto.DragonArmourYuEngraveReq");i.setArmourId(t),e.Message.instance.send(e.Code.DRAGON_ARMOUR_YU_ENGRAVE_C,i,!0)},t.prototype.drga_yuEngraveBack=function(e){this.model.curChangeSkillIdx=e.getIndex()},t.prototype.sendEngrave=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.DragonArmourEngraveReq");n.setArmourId(t),n.setStoneId(i),e.Message.instance.send(e.Code.DRAGON_ARMOUR_ENGRAVE_C,n,!0)},t.prototype.drga_engraveBack=function(t){t.getErrorNo()>0||(this.model.setEngraveBackData(t),e.GameUtils.MSG_TIP("恭喜您，铭刻技能成功了"),this.model.CurEngraveStone=null,this.model.RsgEngraveInfo=!0,this.panel.setaniPlayEnd(!0),this.refreshMainUI())},t.prototype.sendQuench=function(t){var i=HawkProtocolManager.newBuilder("JsProto.DragonArmourQuenchingReq");i.setRoleId(t),e.Message.instance.send(e.Code.DRAGON_ARMOUR_QUENCHING_C,i,!0)},t.prototype.drga_quenchBack=function(t){this.model.setGuardLevel(t.getRoleId(),t.getGuardLevel()),this.panel.showQuenchAni(),e.GameUtils.MSG_TIP("恭喜您，淬炼成功"),this.refreshMainUI()},t.prototype.sendSetGuardStatus=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.DragonArmourShowGuardReq");n.setRoleId(t),n.setShow(i),e.Message.instance.send(e.Code.DRAGON_ARMOUR_SHOW_GUARD_C,n,!0)},t.prototype.drga_setGuard=function(e){e.getErrorNo()>0||(this.model.setGuardStatus(e.getRoleId()),this.refreshMainUI())},t.prototype.sendOpenPore=function(t){var i=HawkProtocolManager.newBuilder("JsProto.DragonArmourOpenPoreReq");i.setArmourId(t),e.Message.instance.send(e.Code.DRAGON_ARMOUR_OPEN_PORE_C,i,!0)},t.prototype.drga_openPore=function(t){t.getErrorNo()>0||(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DRAGONARMOR_1")),this.model.changeRoleEquip(t.getArmourInfo()),this.refreshMainUI())},t.prototype.getDragonEquipScore=function(t){for(var i=e.JsonDataManager.instance.dragonArmorTemplate[t.getItemId()],n=e.GlobalUtil.getScore(i.attrTypeList,i.attrValueList),o=t.getSkills(),a=0;a<o.length;a++)if(o[a]&&o[a].getSkillId()>0){var s=e.JsonDataManager.instance.dragonArmorSkillTemplate[o[a].getSkillId()];n+=s.score}return n},t.prototype.refreshDragonEquip=function(t,i){var n=e.BagController.getInstance().getEnableDAByPart(i);if(n.length<=0)return this.equipbool=!1,!1;var o=this.getDragonEquipScore(n[0]);if(null==t||t.getItemId()<=0)return this.equipbool=!0,!0;var a=this.getDragonEquipScore(e.BagController.getInstance().getDragonArmorById(t.getArmourId()));return o>a?(this.equipbool=!0,!0):(this.equipbool=!1,!1)},t.prototype.refreshDragonEngrave=function(e,t){var i=this.model.getPartInfoByRoleIdAndPart(e,t);if(null==i)return!1;for(var n=i.getSkills(),o=!1,a=0;a<n.length;a++)if(0==n[a].getSkillId()){o=!0;break}return this.model.filtrateStone(i).length>0&&1==o?!0:!1},t.prototype.getModel=function(){return this.model},t.prototype.refreshRedPoint=function(e){return void 0===e&&(e=!1),this.panel.refreshRedPoint(e)},t}();e.DragonArmorController=t,__reflect(t.prototype,"foxgame.DragonArmorController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.curentTap=e.DAPanelType.Panel_1,this.roleIndex=0,this.collection_red=new eui.ArrayCollection,this.collection_orange=new eui.ArrayCollection,this.collection_purple=new eui.ArrayCollection,this.collection_wearArmor=new eui.ArrayCollection,this.collection_engraveArmor=new eui.ArrayCollection,this.collection_engraveStone=new eui.ArrayCollection,this.dragonAInfo=null,this.curEngraveStone=null,this.curChoosePart=e.DAPartType.Part_1,this.rsgEngraveInfo=!1,this.curChangeSkillIdx=-1}return Object.defineProperty(t.prototype,"RsgEngraveInfo",{get:function(){return this.rsgEngraveInfo},set:function(e){this.rsgEngraveInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurentTap",{get:function(){return this.curentTap},set:function(e){this.curentTap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RoleIndex",{get:function(){return this.roleIndex
},set:function(e){this.roleIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RoleData",{get:function(){return this.roleData},set:function(e){this.roleData=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RoleId",{get:function(){return this.roleData.roleId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurEngraveArmorPart",{get:function(){return this.CurChoosePart},set:function(e){this.CurChoosePart=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurEngraveStone",{get:function(){return this.curEngraveStone},set:function(e){this.curEngraveStone=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurChoosePart",{get:function(){return this.curChoosePart},set:function(e){this.curChoosePart=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Collection_red",{get:function(){return this.collection_red},set:function(e){this.collection_red=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Collection_orange",{get:function(){return this.collection_orange},set:function(e){this.collection_orange=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Collection_purple",{get:function(){return this.collection_purple},set:function(e){this.collection_purple=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Collection_wearArmor",{get:function(){return this.collection_wearArmor},set:function(e){this.collection_wearArmor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Collection_engraveArmor",{get:function(){return this.collection_engraveArmor},set:function(e){this.collection_engraveArmor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Collection_engraveStone",{get:function(){return this.collection_engraveStone},set:function(e){this.collection_engraveStone=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DragonAInfo",{get:function(){return this.dragonAInfo},enumerable:!0,configurable:!0}),t.prototype.setDragonAInfo=function(e){this.dragonAInfo={};for(var t,i=e.getRoleDressList(),n=i.length,o=0;n>o;o++)t=i[o],this.dragonAInfo[t.getRoleId()]=t},t.prototype.getInfoByRole=function(e){return this.dragonAInfo&&this.dragonAInfo[e]?this.dragonAInfo[e]:null},Object.defineProperty(t.prototype,"CurRoleDressList",{get:function(){if(this.dragonAInfo&&this.dragonAInfo[this.roleData.roleId]){var e=this.dragonAInfo[this.roleData.roleId];return e.getDressList()}},enumerable:!0,configurable:!0}),t.prototype.getGuardLevel=function(e){var t=this.getInfoByRole(e);return t?t.getGuardLevel():-1},t.prototype.setGuardLevel=function(e,t){var i=this.getInfoByRole(e);i&&i.setGuardLevel(t)},t.prototype.setGuardStatus=function(t){var i=this.getInfoByRole(t);i&&i.setShowGuard(!i.getShowGuard()),e.MapSceneService.instance.mainPlayerData.armorHaloChange=!0,e.MapSceneService.instance.mainPlayerData.InfoChange=!0,e.BattleScene.instance.changeSelfActorShowPlayerBasicInfo(e.MapSceneService.instance.mainPlayerData.playerInfo)},t.prototype.getGuardStatus=function(){var e=this.getInfoByRole(this.RoleId);return e?e.getShowGuard():!1},t.prototype.setRolePartWear=function(t){var i=this.dragonAInfo[t.getRoleId()],n=i.getDressList(),o=(n.length,e.BagController.getInstance().getDragonArmorById(t.getDressArmourId())),a=!1;for(var s in n){var r=n[s],l=e.JsonDataManager.instance.dragonArmorTemplate[r.getItemId()].part;if(l==t.getPartId()){var h=this.getPartInfoByRoleIdAndPart(t.getRoleId(),t.getPartId());h&&e.BagController.getInstance().getDragonArmorById(h.getArmourId()).setIsDress(!1),r.setArmourId(o.getArmourId()),r.setItemId(o.getItemId()),r.setIsDress(!0),r.setIsLock(o.getIsLock()),r.setSkills(o.getSkills()),a=!0;break}}o.setIsDress(!0),a||(e.BagController.getInstance().wearDragonArmor(),n.push(o))},t.prototype.getWearNumByRole=function(e){var t=this.dragonAInfo[e],i=t.getDressList();return i.length>=8},t.prototype.getChangeSkillIndex=function(e){for(var t=this.dragonAInfo[this.RoleId],i=e.getArmourInfo(),n=t.getDressList(),o=0;o<n.length;o++)if(Number(n[o].getArmourId())==Number(i.getArmourId()))for(var a=i.getSkills(),s=0;s<a.length;s++)if(a[s].getSkillId()!=n[o].getSkills()[s].getSkillId())return s;return-1},t.prototype.setEngraveBackData=function(t){if(t&&t.getArmourInfo()){var i=t.getArmourInfo();1==i.getIsDress()&&this.changeRoleEquip(i),e.BagController.getInstance().setDragonArmorById(i)}},t.prototype.changeRoleEquip=function(e){for(var t=this.dragonAInfo[this.RoleId],i=t.getDressList(),n=0;n<i.length;n++)if(Number(i[n].getArmourId())==Number(e.getArmourId()))return void(i[n]=e)},t.prototype.getDragonEquipData=function(t){var i=this.dragonAInfo[this.roleData.roleId];if(!i)return null;for(var n=i.getDressList(),o=e.JsonDataManager.instance.dragonBoneTemplate,a=n.length,s=0;a>s;s++){var r=e.JsonDataManager.instance.dragonArmorTemplate[n[s].getItemId()].part;if(r==t){var l=n[s].getItemId();return o[l]}}return null},t.prototype.getPartInfoByRoleIdAndPart=function(t,i){var n=this.dragonAInfo[t];if(!n)return null;for(var o,a=n.getDressList(),s=a.length,r=0;s>r;r++){o=a[r];var l=e.JsonDataManager.instance.dragonArmorTemplate[o.getItemId()].part;if(l==i)return o}return null},t.prototype.getBagHasBetter=function(t){if(null==this.dragonAInfo)return!1;var i=[0,1,2,3,4,5,6,7],n=this.dragonAInfo[t];if(null==n)return!1;for(var o=n.getDressList(),a=0;a<e.DAConst.PartLength;a++){var s=o[a],r=!1;if(null!=s){var l=Number(e.JsonDataManager.instance.dragonArmorTemplate[s.getItemId()].part);r=e.DragonArmorController.getInstance().refreshDragonEquip(s,l),i.splice(i.indexOf(l),1)}else r=e.DragonArmorController.getInstance().refreshDragonEquip(s,i[i.length-1]),i.pop();if(r)return r}return!1},t.prototype.getBagHasEngrave=function(e){if(null==this.dragonAInfo)return!1;var t=this.dragonAInfo[e];if(null==t)return!1;for(var i=t.getDressList(),n=0;n<i.length;n++){for(var o=i[n],a=o.getSkills(),s=!1,r=0;r<a.length;r++)if(0==a[r].getSkillId()){s=!0;break}if(this.filtrateStone(o).length>0&&1==s)return!0}return!1},t.prototype.getBagHasQuench=function(t){if(null==this.dragonAInfo)return!1;var i=this.dragonAInfo[t];if(null==i)return!1;var n=this.getGuardLevel(t),o=e.JsonDataManager.instance.dragonArmorGuardTemplate[n],a=e.JsonDataManager.instance.dragonArmorGuardTemplate[n+1];if(null==o)return!1;if(null==a)return!1;var s=Number(o.levelUpCost[1]),r=Number(o.levelUpCost[2]),l=e.BagController.getInstance().getCountByItemId(s);return l>=r?!0:!1},t.prototype.filtrateStone=function(t){for(var i=e.BagController.getInstance().getSkillStoneList(),n=e.JsonDataManager.instance.dragonArmorTemplate[t.getItemId()].part,o=t.getSkills(),a=i.length-1;a>=0;a--)if(-1==i[a].part.indexOf(n))i.splice(a,1);else for(var s=i[a].skillId,r=0;r<o.length;r++)if(o[r].getSkillId()==s){i.splice(a,1);break}return i},t}();e.DragonArmorModel=t,__reflect(t.prototype,"foxgame.DragonArmorModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonArmor/DragonArmorSkin.exml","dragonArmorGroup")||this;return i.model=e,i.setRegisterTick(!0),i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.addLister(),this.doScreenAdaptation(),this.ui.longjia.currentState="down",this.model.CurentTap=e.DAPanelType.Panel_1,this.ui.headBar.setBackFun(this.setRoleData.bind(this)),e.DragonArmorController.getInstance().sendDragonInfo()},i.prototype.addLister=function(){this.ui.longhun.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longgu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longjia.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.longshenbaoku.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this);var t=this.tapBtnList;if(t)for(var i=0;i<t.length;i++)t[i]&&t[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListHandler,this);e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this)},i.prototype.showtips=function(t){e.HelpController.getInstance().showPanel("LONGJIAHELP")},i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.RoleIndex)},i.prototype.showHook=function(){this.refreshUI()},i.prototype.showPanel=function(){this.show()},i.prototype.openview=function(t){switch(t.target){case this.ui.longhun:e.SoulController.getInstance().showSoulPanel(),this.close();break;case this.ui.longgu:this.ui.longgu.currentState="up";var i=e.PlayerService.instance.getRoleDataList(),n=i.indexOf(this.model.RoleData);e.DragonboneController.getInstance().showpanel(n),this.close();break;case this.ui.longjia:break;case this.ui.longshenbaoku:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE)}},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:if(!this.getIsShow())return;this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.clickListHandler=function(e){var t=this.tapBtnList,i=t.indexOf(e.target),n=1;switch(i){case 0:n=1;break;case 1:n=2;break;case 2:n=3}this.model.CurentTap!=n&&(this.model.CurEngraveStone=null,this.model.CurentTap=n,this.model.RsgEngraveInfo=!1,this.engravedPanel&&this.engravedPanel.parent&&this.engravedPanel.resetData(),this.refreshUI())},i.prototype.setRoleData=function(t){this.model.RoleData&&this.model.RoleId!=t.roleId&&e.DragonArmorController.getInstance().resetEngraveAni(),this.model.RoleData=t,this.refreshUI()},i.prototype.refreshUI=function(){this.ui.currency.refresh(),null!=this.model.DragonAInfo&&null!=this.model.RoleData&&(this.showPanelByTap(),this.refreshRedPoint(!0))},i.prototype.showPanelByTap=function(){var t=this.model.CurentTap;switch(this.ui.commonGroup.removeChildren(),t){case e.DAPanelType.Panel_1:this.showWearView();break;case e.DAPanelType.Panel_2:this.showEngraved();break;case e.DAPanelType.Panel_3:this.showQuench()}for(var i=1;i<=this.tapBtnList.length;i++)this.tapBtnList[i-1].currentState=this.model.CurentTap==i?"down":"up"},i.prototype.refreshRedPoint=function(t){if(void 0===t&&(t=!1),e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_LEVEL")))return!1;for(var i=e.PlayerService.instance.getRoleDataList(),n=!1,o=0;o<i.length;o++){var a=this.model.getBagHasBetter(i[o].roleId);if(0==n&&1==a&&(n=!0,0==t))return!0;this.model.CurentTap==e.DAPanelType.Panel_1&&this.wearPanel&&this.wearPanel.parent&&this.parent&&this.ui.headBar.setRedStatus(o,a)}for(var s=!1,o=0;o<i.length;o++){var a=this.model.getBagHasEngrave(i[o].roleId);if(0==s&&1==a&&(s=!0,0==t))return!0;this.model.CurentTap==e.DAPanelType.Panel_2&&this.engravedPanel&&this.engravedPanel.parent&&this.parent&&this.ui.headBar.setRedStatus(o,a)}for(var r=!1,o=0;o<i.length;o++){var a=this.model.getBagHasQuench(i[o].roleId);if(0==r&&1==a&&(r=!0,0==t))return!0;this.model.CurentTap==e.DAPanelType.Panel_3&&this.quenchPanel&&this.quenchPanel.parent&&this.parent&&this.ui.headBar.setRedStatus(o,a)}var l=n||s||r;return this.parent&&1==t&&(this.ui.redPoint_1.visible=n,this.ui.redPoint_2.visible=s,this.ui.redPoint_3.visible=r,this.ui.dragnredpoint1.visible=e.SoulController.getInstance().checkOperate(),this.ui.dragnredpoint2.visible=e.DragonboneController.getInstance().refreshRedPoint(),this.ui.dragnredpoint3.visible=l,this.ui.dragnredpoint4.visible=e.DragongodTreasureController.getInstance().redpoint()),l},i.prototype.showQuenchAni=function(){this.quenchPanel&&this.quenchPanel.parent&&this.quenchPanel.quenchBackAni()},i.prototype.tickHook=function(e){},i.prototype.showWearView=function(){(null==this.wearPanel||void 0==this.wearPanel)&&(this.wearPanel=new e.DragonArmorWearPanel(this.model)),this.ui.commonGroup.addChild(this.wearPanel),this.wearPanel.refreshUI()},i.prototype.showEngraved=function(){(null==this.engravedPanel||void 0==this.engravedPanel)&&(this.engravedPanel=new e.DragonArmorEngravedPanel(this.model)),this.ui.commonGroup.addChild(this.engravedPanel),this.engravedPanel.refreshUI()},i.prototype.showQuench=function(){(null==this.quenchPanel||void 0==this.quenchPanel)&&(this.quenchPanel=new e.DragonArmorQuenchPanel(this.model)),this.ui.commonGroup.addChild(this.quenchPanel),this.quenchPanel.refreshUI()},i.prototype.backHandler=function(){e.CharacterController.getInstance().showPanel(0,0,!1),this.close()},i.prototype.setaniPlayEnd=function(e){this.engravedPanel.aniPlayEnd=e},i.prototype.getaniPlayEnd=function(){return this.engravedPanel&&this.engravedPanel.parent?this.engravedPanel.aniPlayEnd:!1},i.prototype.resetEngraveAni=function(){this.engravedPanel&&this.engravedPanel.parent&&this.engravedPanel.resetData()},i.prototype.readyDestroy=function(){this.model.CurChoosePart=e.DAPartType.Part_1,this.model.CurEngraveStone=null,this.model.CurEngraveArmorPart=e.DAPartType.Part_1,this.model.CurentTap=e.DAPanelType.Panel_1,this.model.RsgEngraveInfo=!1,this.wearPanel&&(this.wearPanel.closeUI(),this.wearPanel=null),this.engravedPanel&&(this.engravedPanel.closeUI(),this.engravedPanel=null),this.quenchPanel&&(this.quenchPanel.closeUI(),this.quenchPanel=null)},Object.defineProperty(i.prototype,"tapBtnList",{get:function(){return[this.ui.tapBtn1,this.ui.tapBtn2,this.ui.tapBtn3]},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.DragonArmorPanel=t,__reflect(t.prototype,"foxgame.DragonArmorPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isLock=!1,e.isEngrave=!1,e.indx=-1,e.skinName="DragonArmorSkillItemSkin",e.touchChildren=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addLister()},i.prototype.addLister=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.init=function(){},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refreshUI(this.data.id,-1),this.indx=-1},i.prototype.refreshUI=function(t,i){if(this.armorId=i,this.skillId=t,this.isLock=-1==t?!0:!1,this.isEngrave=t>0?!0:!1,this.skillAdd.visible=0==t?!0:!1,this.lockImg.visible=this.isLock,this.skillImg.visible=!1,this.skillName.text="",t>0){var n=e.JsonDataManager.instance.dragonArmorSkillTemplate[t];this.skillImg.visible=!0;var o=e.JsonDataManager.instance.dragonArmorSkillStoneTemplate;for(var a in o){var s=o[a];s.skillId==t&&this.skillImg.setItem(s.id)}this.skillName.text=n.name,this.skillName.textColor=e.ColorUtils.instance.getColorByQuality(n.quality)}},i.prototype.clickHandler=function(t){if(this.isLock){if(this.indx>=0)for(var i=e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_PORE_COST").split(";"),n=0;n<i.length;n++){var o=i[n].split(",");if(Number(o[0])==this.indx){var a=o[1].split("_"),s=e.JsonDataManager.instance.itemTemplate[Number(a[1])],r="<font color='#ccc3ae'>您确定花费"+a[2]+"</font><font color='#"+e.ColorUtils.instance.getColorByQuality(s.quality).toString(16)+"'>"+s.name+"</font><font color='#ccc3ae'>开启技能格吗</font>";return void e.PopUpController.getInstance().showTextPanel(r,this,this.openPore)}}}else if(this.isEngrave){var l=e.JsonDataManager.instance.dragonArmorSkillStoneTemplate;for(var h in l){var c=l[h];if(c.skillId==this.skillId)return void e.TipsController.getInstance().showDragonArmorSkillTips(c.id)}}else{var u=e.DragonArmorController.getInstance().getModel(),p=u.getPartInfoByRoleIdAndPart(u.RoleId,u.CurEngraveArmorPart);u.CurentTap==e.DAPanelType.Panel_2&&null!=p&&e.DragonArmorController.getInstance().showSeletctWearPanel(e.DASelectPanelType.Type_3)}},i.prototype.setIndex=function(e){this.indx=e},i.prototype.openPore=function(){if(this.armorId>0)for(var t=e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_PORE_COST").split(";"),i=0;i<t.length;i++){var n=t[i].split(",");if(Number(n[0])==this.indx){var o=n[1].split("_"),a=(e.JsonDataManager.instance.itemTemplate[Number(o[1])],Number(o[2])),s=0;return"10000"==o[0]?(Number(o[1])==e.AttributeType.COIN&&(s=e.PlayerService.instance.playerInfo.getCoin()),Number(o[1])==e.AttributeType.DIAMOND&&(s=e.PlayerService.instance.playerInfo.getGold())):"30000"==o[0]&&(s=e.BagController.getInstance().getCountByItemId(Number(o[1]))),void(a>s?Number(o[1])==e.AttributeType.DIAMOND?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):e.ItemNotEnoughController.getInstance().showPanel(Number(o[1])):this.reviewIsAllOpen()?e.DragonArmorController.getInstance().sendOpenPore(this.armorId):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DRAGONARMOR_2")))}}},i.prototype.reviewIsAllOpen=function(){if(-1==this.indx)return!1;for(var t=e.DragonArmorController.getInstance().getModel(),i=t.getPartInfoByRoleIdAndPart(t.RoleId,t.CurEngraveArmorPart),n=i.getSkills(),o=0;o<this.indx;o++)if(!(n[o]&&n[o].getSkillId()>=0))return!1;return!0},i.prototype.closeUI=function(){},i}(eui.ItemRenderer);e.DragonArmorSkillItemIcon=t,__reflect(t.prototype,"foxgame.DragonArmorSkillItemIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonArmor/DragonArmorEngravedSkillSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){var t=new eui.TileLayout;t.requestedColumnCount=e.DAConst.SkillIconNum,t.verticalGap=0;var i=new eui.TileLayout;i.requestedColumnCount=e.DAConst.SkillIconNum,i.verticalGap=0;var n=new eui.TileLayout;n.requestedColumnCount=e.DAConst.SkillIconNum,n.verticalGap=0,this.ui.list_0.layout=t,this.ui.list_1.layout=i,this.ui.list_2.layout=n,this.ui.list_0.dataProvider=this.model.Collection_red,this.ui.list_0.itemRenderer=e.DragonArmorSkillItemIcon,this.ui.list_1.dataProvider=this.model.Collection_orange,this.ui.list_1.itemRenderer=e.DragonArmorSkillItemIcon,this.ui.list_2.dataProvider=this.model.Collection_purple,this.ui.list_2.itemRenderer=e.DragonArmorSkillItemIcon,this.initList()},i.prototype.showHook=function(){t.prototype.showHook.call(this),this.refreshUI()},i.prototype.refreshUI=function(){this.refreshListGroup()},i.prototype.initList=function(){this.skilllist_1=[],this.skilllist_2=[],this.skilllist_3=[];var t=e.JsonDataManager.instance.dragonArmorSkillTemplate;for(var i in t){var n=t[i];6==Number(n.quality)&&this.skilllist_1.push(n),5==Number(n.quality)&&this.skilllist_2.push(n),4==Number(n.quality)&&this.skilllist_3.push(n)}this.skilllist_1.sort(this.sortScore),this.skilllist_2.sort(this.sortScore),this.skilllist_3.sort(this.sortScore)},i.prototype.sortScore=function(e,t){var i=Number(e.score),n=Number(t.score);return i>n?1:i==n?0:-1},i.prototype.refreshListGroup=function(){this.model.Collection_red.replaceAll(this.skilllist_1),this.model.Collection_orange.replaceAll(this.skilllist_2),this.model.Collection_purple.replaceAll(this.skilllist_3),this.ui.group_1.y=this.ui.group_0.y+this.ui.list_0.y+114*Math.ceil(this.skilllist_1.length/e.DAConst.SkillIconNum),this.ui.group_2.y=this.ui.group_1.y+this.ui.list_1.y+114*Math.ceil(this.skilllist_2.length/e.DAConst.SkillIconNum)},i}(e.BasePanel);e.DragonArmorSkillPanel=t,__reflect(t.prototype,"foxgame.DragonArmorSkillPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.list={1:"longJiao",2:"longYa",3:"longQu",4:"longZhua",5:"longWei"},e.list1={1:"longJiao_dianJi",2:"longYa_dianJi",3:"longQu_dianJi",4:"longZhua_dianJi",5:"longWei_dianJi"},e.pos={leftx:-3,rightx:89},e.skinName="DragonArmorItemSkin",e.cacheAsBitmap=!0,e.touchChildren=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addLister()},i.prototype.addLister=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this)},i.prototype.showtips=function(t){var i=e.DragonArmorController.getInstance().getModel().CurentTap;switch(i){case e.DAPanelType.Panel_1:e.DragonArmorController.getInstance().chooseWearArmor(this.part);break;case e.DAPanelType.Panel_2:e.DragonArmorController.getInstance().selectEngraveArmor(this.part)}},i.prototype.setdragon=function(t,i){void 0===i&&(i=null),this.part=t,this.data=i,this.setIconImg(),this.setSkillIcon(i),this.setGray(null==i||i.getArmourId()<=0);var n=e.DragonArmorController.getInstance().getModel().CurentTap,o=e.DragonArmorController.getInstance().getModel();switch(n){case e.DAPanelType.Panel_1:this.selectedImage.visible=this.part==o.CurChoosePart,this.isShowRedPoint(e.DragonArmorController.getInstance().refreshDragonEquip(i,this.part));break;case e.DAPanelType.Panel_2:this.selectedImage.visible=this.part==o.CurEngraveArmorPart,this.isShowRedPoint(e.DragonArmorController.getInstance().refreshDragonEngrave(o.RoleId,this.part))}},i.prototype.setIconImg=function(){this.itembg.source=e.DAConst.ArmorPartSourceList[this.part]},i.prototype.setGray=function(t){this.itembg.filters=this.qualityIcon.filters=t?e.GlobalUtil.grayFilter:[]},i.prototype.setSkillIcon=function(t){if(null==t){for(var i=0;i<this.skillImgList.length;i++)this.skillImgList[i].source="";this.itemName.text=""}else{for(var n=t.getSkills(),i=0;i<this.skillImgList.length;i++){var o="";if(n[i].getSkillId()>0){var a=e.JsonDataManager.instance.dragonArmorSkillTemplate[n[i].getSkillId()];o=e.DAConst.SkillQualityIcon[a.quality]}0==n[i].getSkillId()&&(o=e.DAConst.SkillEngraveSourceIcon),this.skillImgList[i].source=o}var s=e.JsonDataManager.instance.dragonArmorTemplate[t.getItemId()];this.itemName.text=s.name}this.iconGroup.x=this.part<=e.DAPartType.Part_4?this.pos.rightx:this.pos.leftx},i.prototype.isShowRedPoint=function(e){void 0===e&&(e=!1),this.redPoint.visible=e},Object.defineProperty(i.prototype,"skillImgList",{get:function(){return[this.img_0,this.img_1,this.img_2,this.img_3,this.img_4]},enumerable:!0,configurable:!0}),i}(eui.ItemRenderer);e.DragonArmorItemIcon=t,__reflect(t.prototype,"foxgame.DragonArmorItemIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.indx=0,i.maxIdx=0,i.aniPlayEnd=!0,i.waitTime=50,i.showIndex=0,i.showbool=!1,i.skinName="DragonArmorEngravedSkin",i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){this.iconList=[this.icon_0,this.icon_1,this.icon_2,this.icon_3,this.icon_4,this.icon_5,this.icon_6,this.icon_7],this.skillIconList=[this.skillIcon_0,this.skillIcon_1,this.skillIcon_2,this.skillIcon_3,this.skillIcon_4],this.attList=[this.att_0,this.att_1],this.attNameList=[this.attName_0,this.attName_1],this.attEngList=[this.attEng_0,this.attEng_1,this.attEng_2,this.attEng_3,this.attEng_4],this.paomaLight.visible=!1,this.titleBgAni=new e.FoxAni(this.aniGpBg),this.titleBgAni.play("xuanzhuan_diquan","ani",-1),this.aniplay||(this.aniplay=new e.FoxAni(this.anigroup),this.aniplay.play("rechargeAnimation","ani",-1))},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.refreshUI=function(){0!=this.aniPlayEnd&&(this.resetData(),this.refreshIconList(),this.refreshEngraveArmor(),this.refreshEngraveStone(),this.refreshFoxAni(),this.equipshow(),this.refreshAttr(),this.refreshBtnAni())},i.prototype.equipshow=function(){for(var e=0;e<this.iconList.length;e++){var t=this.iconList[e];if(t){var i=this.model.RoleId;t.setdragon(e,this.model.getPartInfoByRoleIdAndPart(i,e))}}},i.prototype.refreshIconList=function(){for(var e=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart),t=e?e.getSkills():[],i=0;i<this.skillIconList.length;i++){var n=-1,o=t[i],a=-1;o&&o.getIndex()==i&&(n=o.getSkillId(),a=o.getIndex()),this.skillIconList[i].refreshUI(n,e?Number(e.getArmourId()):-1),this.skillIconList[i].setIndex(a)}},i.prototype.refreshEngraveArmor=function(){var t,i=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart);i&&(t=e.JsonDataManager.instance.itemTemplate[i.getItemId()]),this.itembg.source=t?t.icon:"",this.equipName.text=t?t.name:""},i.prototype.refreshEngraveStone=function(){var t,i=this.model.CurEngraveStone;i&&(t=i.itemVO),this.stoneBg.source=t?t.icon:"",this.stoneName.text=t?t.name:"",this.stoneName.textColor=t?e.ColorUtils.instance.getColorByQuality(t.quality):16777215},i.prototype.refreshAttr=function(){var t,i,n=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart),o=this.attList,a=o.length;if(null!=n&&void 0!=n){for(var s=e.JsonDataManager.instance.dragonArmorTemplate[n.getItemId()],r=0;a>r;r++)t=o[r],i=s.attrValueList[r],this.attNameList[r].text=e.LanguageUtils.instance.getValue("ATT_"+s.attrTypeList[r])+":",t.text=e.GlobalUtil.getAttrValueStr(s.attrTypeList[r],i),t.x=this.attNameList[r].x+this.attNameList[r].width+5;for(var l=n.getSkills(),h=0;h<this.attEngList.length;h++)if(l[h]&&l[h].getSkillId()>0){var c=e.JsonDataManager.instance.dragonArmorSkillTemplate[l[h].getSkillId()];this.attEngList[h].text=c.name,this.attEngList[h].textColor=e.ColorUtils.instance.getColorByQuality(c.quality)}else this.attEngList[h].text=""}else{for(var r=0;a>r;r++)t=o[r],t.text="",this.attNameList[r].text="";for(var h=0;h<this.attEngList.length;h++)this.attEngList[h].text=""}},i.prototype.refreshBtnAni=function(){var t=this.model.CurChoosePart,i=e.DragonArmorController.getInstance().refreshDragonEngrave(this.model.RoleId,t);this.anigroup.visible=i},i.prototype.addLister=function(){this.skillInfoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickShowSkill,this),this.equipAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.equipAddHandler,this),this.stoneAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stoneAddHandler,this),this.engraveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.engraveHandler,this)},i.prototype.removeLister=function(){this.skillInfoBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickShowSkill,this),this.equipAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.equipAddHandler,this),this.stoneAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.stoneAddHandler,this),this.engraveBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.engraveHandler,this)},i.prototype.clickShowSkill=function(t){e.DragonArmorController.getInstance().showEngravedSkillPanel()},i.prototype.equipAddHandler=function(t){e.DragonArmorController.getInstance().showSeletctWearPanel(e.DASelectPanelType.Type_2)},i.prototype.refreshFoxAni=function(){var t=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart),i="";if(t){var n=e.JsonDataManager.instance.dragonArmorTemplate[t.getItemId()];i=e.DAConst.PartFoxAniSourceList[n.part]}this.titleAni&&this.titleAni.resId!=i&&(this.titleAni.clear(),this.titleAni=null),null==this.titleAni&&(this.titleAni=new e.FoxAni(this.aniGp)),this.titleAni.resId!=i&&this.titleAni.play(i,"ani",-1)},i.prototype.stoneAddHandler=function(t){0!=this.aniPlayEnd&&(null==this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart)||e.DragonArmorController.getInstance().showSeletctWearPanel(e.DASelectPanelType.Type_3))},i.prototype.engraveHandler=function(t){if(null==this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart)||null==this.model.CurEngraveStone)return void e.GameUtils.MSG_TIP("请放入要铭刻的装备或技能石");this.engraveSkillAni();var i=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart).getArmourId();e.DragonArmorController.getInstance().sendYuEngrave(Number(i))},i.prototype.refreshAni=function(){this.ani&&(this.ani.clear(),this.ani=null,TweenMax.killTweensOf(this.aniMask)),this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart)&&this.model.CurEngraveStone&&(void 0==this.ani&&(this.ani=new e.FoxAni(this.aniGroup),this.ani.scaleX=3,this.ani.play("weapupEffect"),this.aniGroup.mask=this.aniMask),TweenMax.to(this.aniMask,.5,{width:this.aniGroup.width}))},i.prototype.engraveSkillAni=function(){var e=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart),t=e.getSkills();this.maxIdx=0;for(var i=0;i<t.length;i++)t[i].getSkillId()>=0&&this.maxIdx++;this.maxIdx>0&&1==this.aniPlayEnd&&this.model.CurEngraveStone&&(this.paomaLight.visible=!0,this.aniPlayEnd=!1,this.engraveBtn.visible=!1,this.anigroup.visible=!1,this.paomaAni())},i.prototype.paomaAni=function(){var t=this,i=this.indx%this.maxIdx;this.paomaLight.x=this.skillIconList[i].x+2,this.paomaLight.y=this.skillIconList[i].y-2;var n=this.waitTime*this.indx*Math.sin(this.indx/e.DAConst.SkillEngravePaomaList[this.maxIdx-1]);egret.Tween.get(this.paomaLight).wait(n+10).call(function(){t.paomaAniBack()})},i.prototype.paomaAniBack=function(){var t=this.indx%this.maxIdx;if(this.indx++,egret.Tween.removeTweens(this.paomaLight),this.indx<e.DAConst.SkillEngravePaomaList[this.maxIdx-1]||t!=this.model.curChangeSkillIdx)this.paomaAni();else{if(this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart)&&this.model.CurEngraveStone){var i=e.JsonDataManager.instance.itemTemplate[this.model.CurEngraveStone.itemVO.id],n=i.icon;this.paomaIcon.x=this.paomaLight.x+12,this.paomaIcon.y=this.paomaLight.y+9,this.paomaIcon.source!=n&&(this.paomaIcon.source=n)}this.paomaAniBack1()}},i.prototype.paomaAniBack1=function(){if(0==this.model.RsgEngraveInfo&&this.model.CurEngraveStone){if(0==this.showbool){this.showbool=!0;var t=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart),i=t.getArmourId(),n=this.model.CurEngraveStone.itemVO.id;e.DragonArmorController.getInstance().sendEngrave(i,n)}this.showIndex<=10&&this.showIndex>=0?(this.showIndex++,egret.Tween.get(this.paomaIcon).to({visible:!this.paomaIcon.visible},0).wait(100).call(this.paomaAniBack1.bind(this))):this.showIndex>=11&&(this.showIndex=-1,this.showbool=!1,egret.Tween.removeTweens(this.paomaIcon))}},i.prototype.resetData=function(){this.showbool=!1,this.indx=0,this.showIndex=0,this.model.RsgEngraveInfo=!1,this.model.curChangeSkillIdx=-1,this.paomaLight.visible=!1,this.paomaIcon.visible=!1,this.engraveBtn.visible=!0,this.anigroup.visible=!0,this.aniPlayEnd=!0},i.prototype.closeHook=function(){},i.prototype.closeUI=function(){this.resetData(),this.titleBgAni&&(this.titleBgAni.clear(),this.titleBgAni=null),this.ani&&(this.ani.clear(),this.ani=null),egret.Tween.removeTweens(this.paomaLight),this.removeLister()},i}(eui.Component);e.DragonArmorEngravedPanel=t,__reflect(t.prototype,"foxgame.DragonArmorEngravedPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.wearNum=0,i.skinName="DragonArmorQuenchSkin",i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){this.txtList=[this.txt_1,this.txt_2,this.txt_3,this.txt_4,this.txt_5,this.txt_6,this.txt_7,this.txt_8],this.attrLabelList_0=[this.attrLabel0,this.attrLabel1,this.attrLabel2],this.attrLabelList_1=[this.attrLabel_0,this.attrLabel_1,this.attrLabel_2],this.attrNameList_0=[this.attrName0,this.attrName1,this.attrName2],this.attrNameList_1=[this.attrName_0,this.attrName_1,this.attrName_2],this.stateList=[this.txt_state0,this.txt_state1,this.txt_state2],this.titleBgAni=new e.FoxAni(this.aniGpBg),this.titleBgAni.play("xuanzhuan_diquan","ani",-1),this.aniplay||(this.aniplay=new e.FoxAni(this.anigroup),this.aniplay.play("rechargeAnimation","ani",-1)),this.conditionList=[];for(var t,i=e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_GUARD_ACTIVE").split(","),n=0;n<i.length;n++){var o=i[n].split("_");t=new Object,t.key=o[0],t.value=o[1],this.conditionList.push(t)}},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.refreshUI=function(){this.showWearInfo(),this.showNowAttrList(),this.showNextAttrList(),this.refreshCheckShow(),this.refreshCostNum(),this.refreshFoxAni(),this.refreshBtnAni()},i.prototype.addLister=function(){this.quenchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.quenchHandler,this),this.checkShow.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkShowHandler,this)
},i.prototype.removeLister=function(){this.quenchBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.quenchHandler,this),this.checkShow.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.checkShowHandler,this)},i.prototype.showNowAttrList=function(){for(var t,i,n=e.JsonDataManager.instance.dragonArmorGuardTemplate[this.model.getGuardLevel(this.model.RoleId)],o=this.attrLabelList_0,a=o.length,s=0;a>s;s++)t=o[s],i=n.attrValueList[s],this.attrNameList_0[s].text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[s])+":",t.x=this.attrNameList_0[s].x+this.attrNameList_0[s].width+5,t.text=e.GlobalUtil.getAttrValueStr(n.attrTypeList[s],i);this.attrTitle.text="神龙守护Lv."+this.model.getGuardLevel(this.model.RoleId)},i.prototype.showNextAttrList=function(){var t,i,n=e.JsonDataManager.instance.dragonArmorGuardTemplate[this.model.getGuardLevel(this.model.RoleId)+1],o=this.attrLabelList_1,a=o.length;if(null==n||void 0==n){for(var s=0;a>s;s++)t=o[s],t.text="",this.attrNameList_1[s].text="";return void(this.quenchBtn.visible=!1)}this.quenchBtn.visible=!0;for(var s=0;a>s;s++)t=o[s],i=n.attrValueList[s],this.attrNameList_1[s].text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[s])+":",t.x=this.attrNameList_1[s].x+this.attrNameList_1[s].width+5,t.text=e.GlobalUtil.getAttrValueStr(n.attrTypeList[s],i);this.showStateLabel()},i.prototype.showStateLabel=function(){for(var t,i,n,o,a,s,r,l=0;l<this.conditionList.length;l++)t=this.conditionList[l].key,i=this.conditionList[l].value,n=this.stateList[l],o=this.attrNameList_1[l],a=this.attrLabelList_1[l],s=this.attrNameList_0[l],r=this.attrLabelList_0[l],this.wearNum>=t?(n.text=e.LanguageUtils.instance.getValue("LONGJIAYIJIHUO"),o.textColor=a.textColor=n.textColor=2227971,s.textColor=r.textColor=16772111):(n.text=e.LanguageUtils.instance.getValue("LONGSHENCUILIAN",t),n.textColor=16727357,s.textColor=r.textColor=o.textColor=a.textColor=11447982),n.x=a.x+a.width+2},i.prototype.refreshFoxAni=function(){var t=e.JsonDataManager.instance.dragonArmorGuardTemplate[this.model.getGuardLevel(this.model.RoleId)],i=t.effect1;this.titleAni&&this.titleAni.resId!=i&&(this.titleAni.clear(),this.titleAni=null),null==this.titleAni&&(this.titleAni=new e.FoxAni(this.aniGp)),this.titleAni.resId!=i&&this.titleAni.play(i,"ani",-1)},i.prototype.refreshBtnAni=function(){var e=this.model.getBagHasQuench(this.model.RoleId);this.anigroup.visible=e},i.prototype.quenchBackAni=function(){this.aniEnd(),egret.Tween.get(this.aniGp).to({scaleX:1.5,scaleY:1.5,alpha:0},300).wait(50).call(this.aniEnd,this,null)},i.prototype.aniEnd=function(){egret.Tween.removeTweens(this.aniGp),this.aniGp.alpha=1,this.aniGp.scaleX=1,this.aniGp.scaleY=1},i.prototype.showWearInfo=function(){var e=this.model.RoleId;this.wearNum=0;for(var t=0;t<this.txtList.length;t++){var i=t,n=this.model.getPartInfoByRoleIdAndPart(e,i);this.txtList[t].textColor=null==n?11447982:2227968,this.wearNum=null==n?this.wearNum:this.wearNum+1}this.wearInfoTxt.text="("+this.wearNum+"/"+this.txtList.length+")"},i.prototype.refreshCheckShow=function(){var e=this.model.getWearNumByRole(this.model.RoleId);this.checkStatus.text=e?"已生效":"未生效",this.checkStatus.textColor=e?2227971:16711680,e?this.checkShow.currentState=this.model.getGuardStatus()?"down":"up":this.checkShow.currentState="disabled"},i.prototype.refreshCostNum=function(){var t=e.JsonDataManager.instance.dragonArmorGuardTemplate[this.model.getGuardLevel(this.model.RoleId)],i=Number(t.levelUpCost[1]),n=Number(t.levelUpCost[2]),o=e.BagController.getInstance().getCountByItemId(i);this.costNum.text="("+o+"/"+n+")",this.costNum.textColor=o>=n?2227971:16711680},i.prototype.quenchHandler=function(t){var i=e.JsonDataManager.instance.dragonArmorGuardTemplate[this.model.getGuardLevel(this.model.RoleId)],n=Number(i.levelUpCost[1]),o=Number(i.levelUpCost[2]),a=e.BagController.getInstance().getCountByItemId(n);return o>a?void e.ItemNotEnoughController.getInstance().showPanel(n):void e.DragonArmorController.getInstance().sendQuench(this.model.RoleId)},i.prototype.checkShowHandler=function(t){if(this.model.getWearNumByRole(this.model.RoleId)){var i=this.model.RoleId,n=this.model.getGuardStatus();e.DragonArmorController.getInstance().sendSetGuardStatus(i,!n)}},i.prototype.closeHook=function(){},i.prototype.closeUI=function(){this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.titleBgAni&&(this.titleBgAni.clear(),this.titleBgAni=null),this.aniEnd(),this.removeLister()},i}(eui.Component);e.DragonArmorQuenchPanel=t,__reflect(t.prototype,"foxgame.DragonArmorQuenchPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="DragonArmorWearSkin",i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){this.iconList=[this.icon_0,this.icon_1,this.icon_2,this.icon_3,this.icon_4,this.icon_5,this.icon_6,this.icon_7],this.skillIconList=[this.skillIcon_0,this.skillIcon_1,this.skillIcon_2,this.skillIcon_3,this.skillIcon_4],this.attList=[this.att_0,this.att_1],this.attNameList=[this.attName_0,this.attName_1],this.attEngList=[this.attEng_0,this.attEng_1,this.attEng_2,this.attEng_3,this.attEng_4],this.aniplay||(this.aniplay=new e.FoxAni(this.anigroup),this.aniplay.play("rechargeAnimation","ani",-1))},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.refreshUI=function(){this.equipshow(),this.refreshSkillList(),this.refreshAttr(),this.refreshFoxAni(),this.refreshBtnAni()},i.prototype.equipshow=function(){for(var e=0;e<this.iconList.length;e++){var t=this.iconList[e];if(t){var i=this.model.RoleId;t.setdragon(e,this.model.getPartInfoByRoleIdAndPart(i,e))}}},i.prototype.refreshSkillList=function(){for(var e=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurChoosePart),t=0;t<this.skillIconList.length;t++){var i=-1,n=-1;if(e&&e.getSkills()[t]){var o=e.getSkills()[t];t==o.getIndex()&&(i=o.getSkillId(),n=o.getIndex())}this.skillIconList[t].refreshUI(i,e?Number(e.getArmourId()):-1),this.skillIconList[t].setIndex(n)}},i.prototype.refreshAttr=function(){var t,i,n=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurChoosePart),o=this.attList,a=o.length;if(null!=n&&void 0!=n){for(var s=e.JsonDataManager.instance.dragonArmorTemplate[n.getItemId()],r=0;a>r;r++)t=o[r],i=s.attrValueList[r],this.attNameList[r].text=e.LanguageUtils.instance.getValue("ATT_"+s.attrTypeList[r])+":",t.text=e.GlobalUtil.getAttrValueStr(s.attrTypeList[r],i),t.x=this.attNameList[r].x+this.attNameList[r].width+5;for(var l=n.getSkills(),h=0;h<this.attEngList.length;h++)if(l[h]&&l[h].getSkillId()>0){var c=e.JsonDataManager.instance.dragonArmorSkillTemplate[l[h].getSkillId()];this.attEngList[h].text=c.name,this.attEngList[h].textColor=e.ColorUtils.instance.getColorByQuality(c.quality)}else this.attEngList[h].text=""}else{var u=e.JsonDataManager.instance.dragonArmorTemplate,p=void 0;for(var g in u){var d=u[g];d.part==this.model.CurChoosePart&&(p=d)}for(var r=0;a>r;r++)t=o[r],t.text="0",this.attNameList[r].text=e.LanguageUtils.instance.getValue("ATT_"+p.attrTypeList[r])+":",t.x=this.attNameList[r].x+this.attNameList[r].width+5;for(var h=0;h<this.attEngList.length;h++)this.attEngList[h].text=""}},i.prototype.refreshFoxAni=function(){var t=e.DAConst.PartFoxAniSourceList[this.model.CurChoosePart];this.titleAni&&this.titleAni.resId!=t&&(this.titleAni.clear(),this.titleAni=null),null==this.titleAni&&(this.titleAni=new e.FoxAni(this.aniGp)),this.titleAni.resId!=t&&this.titleAni.play(t,"ani",-1)},i.prototype.refreshBtnAni=function(){var t=this.model.CurChoosePart,i=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,t),n=e.DragonArmorController.getInstance().refreshDragonEquip(i,t);this.anigroup.visible=n},i.prototype.addLister=function(){this.wearBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.wearHandler,this)},i.prototype.removeLister=function(){this.wearBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.wearHandler,this)},i.prototype.wearHandler=function(t){e.DragonArmorController.getInstance().showSeletctWearPanel(e.DASelectPanelType.Type_1,this.model.CurChoosePart)},i.prototype.closeHook=function(){},i.prototype.closeUI=function(){this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.removeLister()},i}(eui.Component);e.DragonArmorWearPanel=t,__reflect(t.prototype,"foxgame.DragonArmorWearPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="DragonArmorSelectStoneItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHandler,this),this.model=e.DragonboneController.getInstance().getModel()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data.info,n=e.JsonDataManager.instance.dragonArmorSkillTemplate[i.skillId],o=e.JsonDataManager.instance.itemTemplate[i.id];this.nameLabel.text=o.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(o.quality),this.scoreLabel.text=n.score+"";var a=e.BagController.getInstance().getCountByItemId(i.id);this.icon.setItem(i.id,a,!0),this.baseLabel0.text=n.depict},i.prototype.selectHandler=function(t){var i=this.data.info,n=e.BagController.getInstance().getBagItemDataByItemId(i.id);e.DragonArmorController.getInstance().selectEngraveStone(n)},i}(eui.ItemRenderer);e.DragonArmorSelectStoneItemIcon=t,__reflect(t.prototype,"foxgame.DragonArmorSelectStoneItemIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="DragonArmorSelectWearItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.baseLabelList=[this.baseLabel0,this.baseLabel1],this.specialLabelList=[this.specialLabel0,this.specialLabel1,this.specialLabel2,this.specialLabel3,this.specialLabel4],this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHandler,this),this.specialGroupHeight=this.specialGroup.height,this.model=e.DragonArmorController.getInstance().getModel()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data.info;this.type=this.data.type,this.jiaobiao.visible=i.getIsDress(),this.selectBtn.visible=!i.getIsDress()||this.type==e.DASelectPanelType.Type_2;var n=e.JsonDataManager.instance.dragonArmorTemplate[i.getItemId()],o=e.JsonDataManager.instance.itemTemplate[i.getItemId()];this.nameLabel.text=o.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(o.quality),this.scoreLabel.text=e.DragonArmorController.getInstance().getDragonEquipScore(i)+"",this.icon.setItem(i.getItemId(),1,!0);for(var a,s=this.baseLabelList.length,r=0;s>r;r++)a=this.baseLabelList[r],a.text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[r])+":"+e.GlobalUtil.getAttrValueStr(n.attrTypeList[r],n.attrValueList[r]);for(var l=i.getSkills(),h=0;h<l.length;h++)if(l[h]&&l[h].getSkillId()>0){var c=e.JsonDataManager.instance.dragonArmorSkillTemplate[l[h].getSkillId()];this.specialLabelList[h].text=c.name,this.specialLabelList[h].textColor=e.ColorUtils.instance.getColorByQuality(c.quality)}else this.specialLabelList[h].text=""},i.prototype.selectHandler=function(t){var i=this.data.info;switch(this.type){case e.DASelectPanelType.Type_1:e.DragonArmorController.getInstance().sendDragonDress(this.model.CurChoosePart,Number(i.getArmourId()),this.model.RoleId)}},i}(eui.ItemRenderer);e.DragonArmorSelectWearItemIcon=t,__reflect(t.prototype,"foxgame.DragonArmorSelectWearItemIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonArmor/DragonArmorSelectWearSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.showpanel=function(e,t){return this.part=t,this.uiType=e,this.getIsShow()?void this.refreshUI():void this.show()},i.prototype.initHook=function(){},i.prototype.showHook=function(){this.refreshUI()},i.prototype.refreshUI=function(){null!=this.model.DragonAInfo&&this.refreshlist()},i.prototype.refreshlist=function(){switch(this.ui.list.removeChildren(),this.uiType){case e.DASelectPanelType.Type_1:this.ui.titleTxt.text="选择要穿戴的龙甲",this.setWearArmorList();break;case e.DASelectPanelType.Type_2:this.ui.titleTxt.text="选择要铭刻的龙甲",this.setEngraveArmorList();break;case e.DASelectPanelType.Type_3:this.ui.titleTxt.text="选择要铭刻的铭刻石",this.setEngraveStoneList()}},i.prototype.setWearArmorList=function(){var t=this.ui.list;t.dataProvider=this.model.Collection_wearArmor,t.itemRenderer=e.DragonArmorSelectWearItemIcon,this.ui.scroller.viewport=t,this.hight=this.ui.scroller.height;for(var i=e.BagController.getInstance().getEnableDAByPart(this.part),n=[],o=0;o<i.length;o++)n.push({type:e.DASelectPanelType.Type_1,info:i[o]});this.model.Collection_wearArmor.replaceAll(n)},i.prototype.setEngraveArmorList=function(){var t=this.ui.list;t.dataProvider=this.model.Collection_engraveArmor,t.itemRenderer=e.DragonArmorSelectWearItemIcon,this.ui.scroller.viewport=t,this.hight=this.ui.scroller.height;for(var i=[],n=this.model.CurRoleDressList,o=0;o<n.length;o++)n[o]&&n[o].getArmourId()>0&&i.push(n[o]);for(var a=[],o=0;o<i.length;o++)a.push({type:e.DASelectPanelType.Type_2,info:i[o]});this.model.Collection_engraveArmor.replaceAll(a)},i.prototype.setEngraveStoneList=function(){var t=this.ui.list;t.dataProvider=this.model.Collection_engraveStone,t.itemRenderer=e.DragonArmorSelectStoneItemIcon,this.ui.scroller.viewport=t,this.hight=this.ui.scroller.height;var i=this.model.getPartInfoByRoleIdAndPart(this.model.RoleId,this.model.CurEngraveArmorPart),n=this.model.filtrateStone(i);n.sort(this.sortArmorScore);for(var o=[],a=0;a<n.length;a++)o.push({type:e.DASelectPanelType.Type_3,info:n[a]});this.model.Collection_engraveStone.replaceAll(o)},i.prototype.sortArmorScore=function(t,i){var n=e.JsonDataManager.instance.dragonArmorSkillTemplate[t.skillId],o=e.JsonDataManager.instance.dragonArmorSkillTemplate[i.skillId],a=Number(n.score),s=Number(o.score);return a>s?-1:s>a?1:0},i}(e.BasePanel);e.DragonArmorSelectWearPanel=t,__reflect(t.prototype,"foxgame.DragonArmorSelectWearPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/dragonArmor/DragonArmorSkillTips.exml")||this;return e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(e){this.skillId=e,this.show()},i.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this)},i.prototype.refresh=function(){var t=e.JsonDataManager.instance.dragonArmorSkillStoneTemplate[this.skillId],i=e.JsonDataManager.instance.dragonArmorSkillTemplate[t.skillId],n=e.JsonDataManager.instance.itemTemplate[this.skillId];this.ui.nameLabel.text=n.name,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(n.quality),this.ui.skillImg.setItem(this.skillId,0,!1),this.ui.scoreLabel.text=i.score+"",this.ui.lvLabel.text=n.levelLimit+"",this.ui.attrLabel.textFlow=(new egret.HtmlTextParser).parser(n.desc),this.ui.qualityBg.source="qualityBg"+n.quality+"_png"},i.prototype.bagItemChanged=function(){this.refresh()},i}(e.BasePanel);e.DragonArmorSkillTipsPanel=t,__reflect(t.prototype,"foxgame.DragonArmorSkillTipsPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/dragonArmor/DragonArmorTipsSkin.exml")||this;return e.isInstance=!0,e.armorInfo=null,e.posY=0,e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(e,t){void 0===t&&(t=!0),this.id=e,this.isInstance=t,this.armorInfo=null,this.show()},i.prototype.showAPanel=function(e){this.armorInfo=e,this.id=e.getArmourId(),this.isInstance=!0,this.show(),this.ui.lockBtn.visible=!1,this.ui.unlockBtn.visible=!1},i.prototype.initHook=function(){this.ui.lockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lockHandler,this),this.ui.unlockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.unlockHandler,this),e.BagController.getInstance().registerObserver(this),this.posY=this.ui.gp_3.y+this.ui.gp_3.height+20},i.prototype.refresh=function(){if(0==this.isInstance)return void this.refreshByItemID();this.ui.gp_3.visible=this.ui.gp_4.visible=!0;var t=this.armorInfo?this.armorInfo:e.BagController.getInstance().getDragonArmorById(this.id),i=e.JsonDataManager.instance.dragonArmorTemplate[t.getItemId()],n=e.JsonDataManager.instance.itemTemplate[i.id];this.ui.icon.setItem(i.id,0,!1),this.ui.lvLabel.text=n.levelLimit+"",this.ui.nameLabel.text=n.name,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(n.quality),this.ui.scoreLabel.text=e.DragonArmorController.getInstance().getDragonEquipScore(t)+"",this.ui.lockBtn.visible=!t.getIsLock(),this.ui.unlockBtn.visible=t.getIsLock();for(var o,a,s=this.getAttrLabelList(),r=s.length,l=0;r>l;l++)o=s[l],a=i.attrValueList[l],o.text=e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[l])+":"+e.GlobalUtil.getAttrValueStr(i.attrTypeList[l],a);this.ui.gp_4.removeChildren(),this.posY=this.ui.gp_3.y+this.ui.gp_3.height+20;for(var h=t.getSkills(),c=0;c<h.length;c++){var u=c+1,p=this.createIcon(h[c].getSkillId());if(p.x=this.ui.gp_3.x+10,this.ui.gp_4.addChild(p),p.y=this.posY,h[c]&&h[c].getSkillId()>0){var g=e.JsonDataManager.instance.dragonArmorSkillTemplate[h[c].getSkillId()],d=new eui.Label;d.size=22,d.fontFamily="宋体",d.x=this.ui.gp_3.x+70,d.textColor=e.ColorUtils.instance.getColorByQuality(g.quality),d.text="铭刻"+u+":"+g.name,d.y=this.posY,this.posY=this.posY+d.height+15,this.ui.gp_4.addChild(d);var f=new eui.Label;f.size=18,f.fontFamily="宋体",f.x=this.ui.gp_3.x+80,f.width=340,f.text=g.depict,f.y=this.posY,this.posY=this.posY+f.height+20,this.ui.gp_4.addChild(f)}if(h[c]&&0==h[c].getSkillId()){var d=new eui.Label;d.size=22,d.fontFamily="宋体",d.x=this.ui.gp_3.x+70,d.textColor=13419438,d.text="铭刻"+u+":空",d.y=this.posY,this.posY=this.posY+d.height+20,this.ui.gp_4.addChild(d)}if(!h[c]||h[c].getSkillId()<0){var d=new eui.Label;d.size=22,d.fontFamily="宋体",d.x=this.ui.gp_3.x+70,d.textColor=13419438,d.text="铭刻"+u+":锁",d.y=this.posY,this.posY=this.posY+d.height+20,this.ui.gp_4.addChild(d)}this.posY=this.posY<p.y+p.height+5?p.y+p.height+5:this.posY}this.$setHeight(this.posY),this.ui.bgImg1.height=this.ui.bgImg.height=this.posY,this.ui.textIn.y=this.posY+15},i.prototype.refreshByItemID=function(){var t=e.JsonDataManager.instance.itemTemplate[this.id],i=e.JsonDataManager.instance.dragonArmorTemplate[this.id];this.ui.icon.setItem(this.id,0,!1),this.ui.lvLabel.text=t.levelLimit+"",this.ui.nameLabel.text=t.name,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(t.quality),this.ui.scoreLabel.text=e.GlobalUtil.getScore(i.attrTypeList,i.attrValueList)+"",this.ui.lockBtn.visible=!1,this.ui.unlockBtn.visible=!1;for(var n,o,a=this.getAttrLabelList(),s=a.length,r=0;s>r;r++)n=a[r],o=i.attrValueList[r],n.text=e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[r])+":"+e.GlobalUtil.getAttrValueStr(i.attrTypeList[r],o);this.ui.gp_4.removeChildren(),this.posY=this.ui.gp_3.y+this.ui.gp_3.height+20;for(var l=[0,-1,-1,-1,-1],h=0;h<l.length;h++){var c=this.createIcon(l[h]);c.x=this.ui.gp_3.x+10,this.ui.gp_4.addChild(c),c.y=this.posY;var u=0==l[h]?"空":"锁",p=h+1,g=new eui.Label;g.size=22,g.fontFamily="宋体",g.x=this.ui.gp_3.x+70,g.textColor=13419438,g.text="铭刻"+p+":"+u,g.y=this.posY,this.posY=this.posY+g.height+20,this.ui.gp_4.addChild(g),this.posY=this.posY<c.y+c.height+5?c.y+c.height+5:this.posY}this.$setHeight(this.posY),this.ui.bgImg1.height=this.ui.bgImg.height=this.posY,this.ui.textIn.y=this.posY+15},i.prototype.createIcon=function(t){var i=new eui.Group,n=new eui.Image;if(n.source="iconBg_png",i.addChild(n),t>0){var o=new e.ItemIcon,a=(e.JsonDataManager.instance.dragonArmorSkillTemplate[t],e.JsonDataManager.instance.dragonArmorSkillStoneTemplate);for(var s in a){var r=a[s];if(r.skillId==t){o.setItem(r.id,1,!1),i.addChild(o);break}}}else if(0==t){var l=new eui.Image;l.source="soul_daijiahaozhuangbeikuang1_png",i.addChild(l)}else{var l=new eui.Image;l.source="soul_suo_png",l.x=17,l.y=23,i.addChild(l)}return i.scaleX=i.scaleY=.8,i},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.lockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneLockRep");i.setId(this.id),i.setState(!0),e.Message.instance.send(e.Code.DRAGON_ARMOUR_LOCK_C,i,!0)},i.prototype.unlockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneLockRep");i.setId(this.id),i.setState(!1),e.Message.instance.send(e.Code.DRAGON_ARMOUR_LOCK_C,i,!0)},i.prototype.getAttrLabelList=function(){var e=[];return e.push(this.ui.attrLabel0),e.push(this.ui.attrLabel1),e},i}(e.BasePanel);e.DragonArmorTipsPanel=t,__reflect(t.prototype,"foxgame.DragonArmorTipsPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonArmourGuardVO=t,__reflect(t.prototype,"foxgame.DragonArmourGuardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonArmourSkillStoneVO=t,__reflect(t.prototype,"foxgame.DragonArmourSkillStoneVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonArmourSkillVO=t,__reflect(t.prototype,"foxgame.DragonArmourSkillVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.decompose=[]}return e}();e.DragonArmourVO=t,__reflect(t.prototype,"foxgame.DragonArmourVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonbone/DragonBallSkin.exml","dragonball")||this;return i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.initHook=function(){for(var e=this.getcheckBoxBtn(),t=0;t<e.length;t++){var i=e[t];i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickcheck,this)}e[0].currentState="down",this.clicknumber=0,this.ui.ball.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickball,this),this.ui.ball1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickball,this),this.ui.ball2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickball,this),this.ui.ball3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickball,this),this.ui.uplevelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.update,this),this.model.registerObserver(this)},i.prototype.update=function(t){var i=e.BagController.getInstance().getCountByItemId(this.datacost.cost.id);return i<this.datacost.cost.value?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")):void e.DragonboneController.getInstance().sendDRAGON_BONE_COMBINED_STAR_C(this.clicknumber+1)},i.prototype.clickball=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.showHook=function(){},i.prototype.closeHook=function(){},i.prototype.dragonboneCombinedBallBack=function(){this.refresh()},i.prototype.dragonboneInfoBack=function(){},i.prototype.dragonboneUpStarBack=function(){},i.prototype.dragonboneUpgradeLevelBack=function(){},i.prototype.refresh=function(){this.datacost=this.getDragonBallupstarTemplate()[this.clicknumber+1],this.ui.ball.setItem(this.datacost.itemCraft.id,-1,!1,!1);var t=e.BagController.getInstance().getCountByItemId(this.datacost.cost.id);this.ui.ball1.setItem(this.datacost.cost.id,t,!1,!1),this.ui.ball2.setItem(this.datacost.cost.id,t,!1,!1),this.ui.ball3.setItem(this.datacost.cost.id,t,!1,!1),this.ui.ball1.setGray(1>t),this.ui.ball2.setGray(2>t),this.ui.ball3.setGray(3>t);var i=this.getinititemTemplate()[this.datacost.itemCraft.id];this.ui.ballname.text=i.name},i.prototype.clickcheck=function(e){for(var t=this.getcheckBoxBtn(),i=0;i<t.length;i++){var n=t[i];n==e.target?(n.currentState="down",this.clicknumber=i):n.currentState="up"}this.refresh()},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.ui.aniGroup.visible=!1},i.prototype.getinititemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.getDragonBallupstarTemplate=function(){return e.JsonDataManager.instance.dragonBallupstarTemplate},i.prototype.getcheckBoxBtn=function(){var e=[this.ui.checkBoxBtn_0,this.ui.checkBoxBtn_1,this.ui.checkBoxBtn_2,this.ui.checkBoxBtn_3,this.ui.checkBoxBtn_4,this.ui.checkBoxBtn_5,this.ui.checkBoxBtn_6];return e},i}(e.BasePanel);e.DragonBallpanel=t,__reflect(t.prototype,"foxgame.DragonBallpanel",["foxgame.IDragonbone","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.PART1=1]="PART1",e[e.PART2=2]="PART2",e[e.PART3=3]="PART3",e[e.PART4=4]="PART4",e[e.PART5=5]="PART5"}(t=e.DragonBonePartType||(e.DragonBonePartType={}));var i=function(){function t(){this.equipbool=!1,this.starbool=!1,this.model=new e.DragonboneModel,this.panel=new e.DragonbonePanel(this.model),this.dragonball=new e.DragonBallpanel(this.model),this.selectUpgradePanel=new e.DragonboneSelectUpgradePanel(this.model),this.phagocytosisPanel=new e.PhagocytosisPanel(this.model),this.dragonboneSelectWearPanel=new e.DragonboneSelectWearPanel(this.model),this.dragonGuardTips=new e.DragonGuardTips}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showdragonboneSelectWearPanel=function(e){this.dragonboneSelectWearPanel.showpanel(e)},t.prototype.getPanel=function(){return this.panel},t.prototype.showDragonGuardTips=function(e,t){this.dragonGuardTips.showpanel(e,t)},t.prototype.showdragonballpanel=function(){this.dragonball.show()},t.prototype.showpanel=function(t){void 0===t&&(t=0);var i=parseInt(e.GlobalConfig.instance.getValue("DRAGONBONE_OPEN_LEVEL"));return e.PlayerService.instance.level<i?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DRAGONBONEOPEN",i)):(e.SoulController.getInstance().closeSoulPanel(),this.model.roleIndex=t,this.model.roleData=e.PlayerService.instance.getRoleDataList()[this.model.roleIndex],this.panel.show(),void(i=null))},t.prototype.sendDRAGON_BONE_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneInfoReq");e.Message.instance.send(e.Code.DRAGON_BONE_INFO_C,t,!0),t=null},t.prototype.sendDRAGON_BONE_WEAR_C=function(t){var i=this.getinitdragonboneTemplate()[t.getEquipId()].part,n=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneWearReq");n.setEquipPartId(i),n.setRoleId(this.model.roleData.roleId),n.setId(t.getId()),e.Message.instance.send(e.Code.DRAGON_BONE_WEAR_C,n,!0),n=null},t.prototype.sendDRAGON_BONE_UPDRADE_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneRisingStarReq");i.setEquipPartId(t),i.setRoleId(this.model.roleData.roleId),e.Message.instance.send(e.Code.DRAGON_BONE_RISING_STAR_C,i,!0),i=null},t.prototype.sendDRAGON_BONE_COMBINED_STAR_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneCombinedStarReq");i.setStarLevel(t),e.Message.instance.send(e.Code.DRAGON_BONE_COMBINED_STAR_C,i,!0),i=null},t.prototype.sendDRAGON_BONE_WARD_C=function(t,i){if("disabled"!=t){var n=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneWardDisReq");n.setDisplay("up"==t?!1:!0),n.setRoleId(this.model.roleData.roleId),n.setLevel(i),e.Message.instance.send(e.Code.DRAGON_BONE_WARD_C,n,!0),n=null}},t.prototype.closepanel=function(){this.panel.close()},t.prototype.registerMsg=function(t){t.add(e.Code.DRAGON_BONE_INFO_S,this),t.add(e.Code.DRAGON_BONE_WEAR_S,this),t.add(e.Code.DRAGON_BONE_UPDRADE_S,this),t.add(e.Code.DRAGON_BONE_RISING_STAR_S,this),t.add(e.Code.DRAGON_BONE_WARDSYNC_S,this),t.add(e.Code.DRAGON_BONE_COMBINED_STAR_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.DRAGON_BONE_INFO_S:this.model.setDragonInfo(i);break;case e.Code.DRAGON_BONE_WEAR_S:this.model.setWearInfo(i);break;case e.Code.DRAGON_BONE_UPDRADE_S:this.upgradeLevelBack(i);break;case e.Code.DRAGON_BONE_RISING_STAR_S:this.model.setUpStarBack(i);break;case e.Code.DRAGON_BONE_COMBINED_STAR_S:0==i.getErrorNo()&&this.dragonball.playAni(),this.model.setCombinedBall(i);break;case e.Code.DRAGON_BONE_WARDSYNC_S:this.model.setHaloBack(i)}},t.prototype.upgradeLevelBack=function(t){this.model.setUpgradeLevelBack(t);for(var i,n,o,a,s,r=t.getDevourInfo(),l=r.length,h=e.JsonDataManager.instance.dragonBoneTemplate,c=e.JsonDataManager.instance.dragonEssenceTemplate,u=e.JsonDataManager.instance.dragonboneuplevelTemplate,p=0,g=0;l>g;g++)i=r[g],s=i.getEquipId(),1==i.getState()?(a=h[s],n=u[a.level],p+=n.devourExp):(o=c[s],p+=o.exp*Number(i.getCostNumber()));0==t.getErrorNo()&&this.panel.LevelSucces(),e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("DRAGONPHAGOCYTOSISPROMPT2",p))},t.prototype.getinitdragonboneTemplate=function(){return e.JsonDataManager.instance.dragonBoneTemplate},t.prototype.showUpgradeLevelPanel=function(e){void 0===e&&(e=-1),this.panel.upgradeLevelPanelshowPanel(e)},t.prototype.getModel=function(){return this.model},t.prototype.getDragonEquipScore=function(t){if(null==t)return 0;var i=e.JsonDataManager.instance.dragonBoneTemplate[t.getEquipId()];i.attrTypeList,i.attrValueList;for(var n,o=[],a=[],s=t.getAttribute(),r=s.length,l=0;r>l;l++)n=s[l],o.push(n.getAttrId()),a.push(n.getAttrValue());return e.GlobalUtil.getScore(i.attrTypeList,i.attrValueList,o,a)},t.prototype.showSelectUpgradePanel=function(){this.selectUpgradePanel.show()},t.prototype.selectUpgradeDragon=function(e){this.selectUpgradePanel.close(),this.showUpgradeLevelPanel(e.getId())},t.prototype.selectWearDragon=function(e){this.dragonboneSelectWearPanel.close(),this.sendDRAGON_BONE_WEAR_C(e)},t.prototype.showSelectPhagocytosisPanel=function(){this.phagocytosisPanel.show()},t.prototype.updatePhagocytosisView=function(){this.panel.upgradeLevelPanelrefreshPhagocytosis()},t.prototype.getWearInfoById=function(t){var i;for(var n in this.model.dragonBoneInfo)for(var o=this.model.dragonBoneInfo[n],a=o.getEquipInfo(),s=0;s<a.length;s++)if(i=e.BagController.getInstance().getDragonBoneById(a[s].getId()),null!=i&&Number(i.getId())==t)return a[s]},t.prototype.requestLevelUp=function(t,i){for(var n,o,a=[],s=this.model.phagocytosisList,r=s.length,l=0,h=0;r>h;h++)o=s[h],null!=o&&(n=HawkProtocolManager.newBuilder("JsProto.DevourInfo"),o.itemInfo&&(l=o.count),n.setCostNumber(l),n.setEquipId(0),null!=o.itemInfo?(n.setState(!1),n.setId(o.itemInfo.getId())):null!=o.dragonBoneInfo&&(n.setState(!0),n.setId(o.dragonBoneInfo.getId())),a.push(n));var c=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneUpgradeReq");c.setRoleId(t),c.setUpgrdeId(i),c.setDevourInfo(a),e.Message.instance.send(e.Code.DRAGON_BONE_UPDRADE_C,c,!0)},t.prototype.setDragonRedPoint=function(t){void 0===t&&(t=!1),this.panel.setDragonRedPoint(0,this.equipbool),this.panel.setDragonRedPoint(1,this.refreshDragonUplevel()),this.panel.setDragonRedPoint(2,this.starbool),this.panel.setDragonRedPoint(3,e.SoulController.getInstance().checkOperate()),this.panel.setDragonRedPoint(4,this.refreshRedPoint(t)),this.panel.setDragonRedPoint(5,e.DragonArmorController.getInstance().refreshRedPoint()),this.panel.setDragonRedPoint(6,e.DragongodTreasureController.getInstance().redpoint())},t.prototype.refreshRedPoint=function(t){void 0===t&&(t=!1);var i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.DRAGONBONE,!1);if(!i)return!1;if(!this.model.dragonBoneInfo)return!1;var n=this.model.dragonBoneInfo,o=this.headbarredpoint(n,t);if(0==t&&o)return!0;for(var a in n)for(var s=n[a],r=s.getEquipInfo().length,l=0;r>l;l++){var h=s.getEquipInfo()[l];if(this.refreshDragonStar(h)||this.refreshDragonEquip(h)||this.refreshDragonUplevel())return!0}return!1},t.prototype.headbarredpoint=function(e,t){void 0===t&&(t=!1);var i,n=Object.keys(e),o=!1;for(var a in e){var s=n.indexOf(a),r=e[a],l=r.getEquipInfo().length;
i=!1;for(var h=0;l>h;h++){var c=r.getEquipInfo()[h];if((this.refreshDragonStar(c)||this.refreshDragonEquip(c)||this.refreshDragonUplevel())&&(i=!0,o||(o=!0),0==t))return!0}this.panel.getIsShow()&&this.panel.getheadbarset().setRedStatus(s,i)}return o},t.prototype.refreshDragonUplevel=function(){var t=!1,i=e.BagController.getInstance().getPhagocytosisDragonBone(!0),n=this.model.dragonBoneInfo;for(var o in n){for(var a=n[o],s=a.getEquipInfo().length,r=0;s>r;r++){var l=a.getEquipInfo()[r],h=e.BagController.getInstance().getDragonBoneById(l.getId()),c=0!=l.getId()?Number(e.JsonDataManager.instance.dragonBoneTemplate[h.getEquipId()].level):-1,u=e.JsonDataManager.instance.dragonBoneByPartAndLvTemplate[l.getEquipPartId()+"_"+(c+1)];if(0!=l.getEquiId()&&null!=u){if(i.length>0)return!0;break}}if(t)break}return!1},t.prototype.refreshDragonStar=function(t){var i=t.getStatrLevel();if(i>=Number(e.GlobalConfig.instance.getValue("DRAGONBONE_UPSTAR_MAX")))return this.starbool=!1,!1;var n=e.JsonDataManager.instance.dragonboneupstarTemplate[i+1],o=n.levelUpCost,a=e.BagController.getInstance().getCountByItemId(o.id);return o.value<=a?(this.starbool=!0,!0):(this.starbool=!1,!1)},t.prototype.refreshDragonEquip=function(t){var i=t.getEquipPartId(),n=e.BagController.getInstance().getEnableDragonboneByPart(i);if(n.length<=0)return this.equipbool=!1,!1;var o=this.getDragonEquipScore(n[0]);if(t.getEquiId()<=0)return this.equipbool=!0,!0;var a=this.getDragonEquipScore(e.BagController.getInstance().getDragonBoneById(t.getId()));return o>a?(this.equipbool=!0,!0):(this.equipbool=!1,!1)},t.prototype.refreshDragonBall=function(){var t=e.JsonDataManager.instance.dragonBallupstarTemplate;for(var i in t){var n=t[i],o=e.BagController.getInstance().getCountByItemId(n.cost.id);if(n.cost.value<=o)return!0}return!1},t}();e.DragonboneController=i,__reflect(i.prototype,"foxgame.DragonboneController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.selectpart=1,this.phagocytosisList=[],this.collection=new eui.ArrayCollection,this.collection.source=[],this.phagocytosisCollection=new eui.ArrayCollection,this.selectLvList=[],this.collection1=new eui.ArrayCollection,this.collection1.source=[],this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.getWardLevel=function(){return this.dragonBoneInfo?this.dragonBoneInfo[this.roleData.roleId].getWardLevel():0},t.prototype.setDragonInfo=function(e){var t=e.getDragonBoneInfo();this.dragonBoneInfo={};var i,n=t.length;Log.trace("龙骨返回:"+e.getDragonBoneInfo());for(var o=0;n>o;o++)i=t[o],this.dragonBoneInfo[i.getRoleId()]=i;var a;n=this.observerList.length;for(var o=0;n>o;o++)a=this.observerList[o],a.getIsShow()&&a.dragonboneInfoBack()},t.prototype.getDragonEquipData=function(t){var i=this.dragonBoneInfo[this.roleData.roleId];if(!i)return null;for(var n=i.getEquipInfo(),o=e.JsonDataManager.instance.dragonBoneTemplate,a=n.length,s=0;a>s;s++)if(n[s].getEquipPartId()==t){var r=n[s].getEquiId();return o[r]}return null},t.prototype.getPartInfoByRoleIdAndPart=function(e,t){var i=this.dragonBoneInfo[e];if(!i)return null;for(var n,o=i.getEquipInfo(),a=o.length,s=0;a>s;s++)if(n=o[s],Number(n.getEquipPartId())==t)return n;return null},t.prototype.setWearInfo=function(e){this.changedata(e);for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.dragonboneInfoBack()},t.prototype.setUpStarBack=function(e){if(void 0===e&&(e=null),0!=e.getErrorNo())return void Log.trace("龙骨升星返回错误码 "+e.getErrorNo());this.changeUpStardata(e);for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.dragonboneUpStarBack()},t.prototype.changeUpStardata=function(e){if(e){var t=this.dragonBoneInfo[e.getRoleId()],i=t.getEquipInfo();i.length,new Buffer.WearequipInfo;for(var n in i){var o=i[n];if(Number(o.getEquipPartId())==e.getEquipPartId())return void o.setStatrLevel(e.getStatrLevel())}}},t.prototype.setCombinedBall=function(t){if(void 0===t&&(t=null),0!=t.getErrorNo())return void Log.trace("龙珠合成返回错误码 "+t.getErrorNo());e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GETBALLTRUE",t.getStarLevel()));for(var i,n=this.observerList.length,o=0;n>o;o++)i=this.observerList[o],i.getIsShow()&&i.dragonboneCombinedBallBack()},t.prototype.setHaloBack=function(t){if(this.dragonBoneInfo){var i=this.dragonBoneInfo[this.roleData.roleId];i.getRoleId()==t.getRoleId()&&(i.setWardLevel(t.getWardLevel()),this.roleData.roleInfo.setWardLevel(t.getDisplayLevel()),this.roleData.roleInfo.setWardState(t.getWardState())),e.MapSceneService.instance.mainPlayerData.haloChange=!0,e.MapSceneService.instance.mainPlayerData.InfoChange=!0;for(var n,o=this.observerList.length,a=0;o>a;a++)n=this.observerList[a],n.getIsShow()&&n.dragonboneInfoBack()}},t.prototype.changedata=function(t){var i=this.dragonBoneInfo[t.getRoleId()],n=i.getEquipInfo(),o=(n.length,new Buffer.WearequipInfo,e.BagController.getInstance().getDragonBoneById(t.getId()));for(var a in n){var s=n[a];if(Number(s.getEquipPartId())==t.getEquipPartId())return s.setId(o.getId()),void s.setEquiId(o.getEquipId())}},t.prototype.pushPhagocytosis=function(e){for(var t=this.phagocytosisList.length,i=0;t>i;i++)if(null==this.phagocytosisList[i])return this.phagocytosisList[i]=e,!0;return!1},t.prototype.removePhagocytosis=function(e){for(var t=this.phagocytosisList.length,i=0;t>i;i++)if(this.phagocytosisList[i]==e)return void(this.phagocytosisList[i]=null)},t.prototype.setUpgradeLevelBack=function(e){if(0!=e.getErrorNo())return void Log.trace("龙骨升级返回错误码 "+e.getErrorNo());for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.dragonboneUpgradeLevelBack()},t}();e.DragonboneModel=t,__reflect(t.prototype,"foxgame.DragonboneModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonbone/DragonboneSkin.exml","dragonPanelGroup")||this;return i.model=e,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.shouhu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeview,this),this.ui.chuandai.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeview,this),this.ui.longhun.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longgu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longshenbaoku.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longjia.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.shengji.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeview,this),this.ui.shengxing.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeview,this),this.ui.longjiao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.longya.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.longqu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.longzhua.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.longwei.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.guardIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ui.longgu.currentState="down",this.changebtnstate(this.ui.chuandai),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.equipshow(),this.model.registerObserver(this),e.BagController.getInstance().getModel().registerObserver(this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.doScreenAdaptation()},i.prototype.bagItemChanged=function(){this.dragonuplevel&&this.dragonuplevel.refresh()},i.prototype.equipshow=function(){this.ui.longjiao.setdragon(e.DragonBonePartType.PART1,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART1)),this.ui.longya.setdragon(e.DragonBonePartType.PART2,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART2)),this.ui.longqu.setdragon(e.DragonBonePartType.PART3,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART3)),this.ui.longzhua.setdragon(e.DragonBonePartType.PART4,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART4)),this.ui.longwei.setdragon(e.DragonBonePartType.PART5,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART5))},i.prototype.showHook=function(){},i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.roleIndex)},i.prototype.closeHook=function(){this.dragonguard&&(this.dragonguard=null),this.dragonupstar&&(this.dragonupstar=null),this.dragonuplevel&&(this.dragonuplevel=null)},i.prototype.refresh=function(){this.ui.currency.refresh(),null!=this.model.dragonBoneInfo[this.model.roleData.roleId]&&(this.equipshow(),this.guardchange(this.model.getWardLevel()),this.dragonguard&&this.dragonguard.refresh(this.model.getWardLevel()),this.dragonupstar&&this.dragonupstar.refresh(),this.dragonuplevel&&this.dragonuplevel.refresh(),this.equipAttrShow(),this.scoreshow(),e.DragonboneController.getInstance().setDragonRedPoint(!0))},i.prototype.scoreshow=function(){for(var t=0,i=[this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART1),this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART2),this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART3),this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART4),this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART5)],n=0;n<i.length;n++){var o=i[n];if(o){var a=e.BagController.getInstance().getDragonBoneById(o.getId()),s=a?e.DragonboneController.getInstance().getDragonEquipScore(a):0;t+=s}}this.ui.scoreLabel.text=String(t)},i.prototype.equipAttrShow=function(){for(var t={},i=[],n=[this.model.getDragonEquipData(e.DragonBonePartType.PART1),this.model.getDragonEquipData(e.DragonBonePartType.PART2),this.model.getDragonEquipData(e.DragonBonePartType.PART3),this.model.getDragonEquipData(e.DragonBonePartType.PART4),this.model.getDragonEquipData(e.DragonBonePartType.PART5)],o=0;o<n.length;o++){var a=n[o];if(a)for(var s=0;s<a.attrTypeList.length;s++)if(a.attrTypeList[s]in t){var r=Number(t[a.attrTypeList[s]]);t[a.attrTypeList[s]]=Number(a.attrValueList[s])+r}else t[a.attrTypeList[s]]=a.attrValueList[s],i.push(a.attrTypeList[s])}for(var l=this.getAttrList(),o=0;o<l.length;o++){var h=i[o],c=e.GlobalConfig.instance.getValue("LONGHUXIANGSHI"),u=c.split(",");if(h){var p=e.ColorUtils.instance.getAttrColorById(h),g=e.ColorUtils.instance.getAttrValueColorById(h);l[o].textFlow=(new egret.HtmlTextParser).parser("<font color="+p+">"+e.LanguageUtils.instance.getValue("ATT_"+h)+":</font><font color="+g+">"+t[h]+"</font>")}else{var d=e.ColorUtils.instance.getAttrColorById(Number(u[o])),f=e.ColorUtils.instance.getAttrValueColorById(Number(u[o]));l[o].textFlow=(new egret.HtmlTextParser).parser("<font color="+d+">"+e.LanguageUtils.instance.getValue("ATT_"+u[o])+":</font><font color="+f+">0</font>")}}},i.prototype.getAttDet=function(){return e.JsonDataManager.instance.attDefTemplate},i.prototype.guardchange=function(t){this.ui.guardIcon.currentState=0!=t?"up":"down";var i=e.JsonDataManager.instance.dragonGuardTemplate,n=i[t],o="0%";n&&(o=e.GlobalUtil.getAttrValueStr(n.attrTypeList[0],n.attrValueList[0])),this.ui.guardtxt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("DRAGONGUARD1",o))},i.prototype.backHandler=function(){e.CharacterController.getInstance().showPanel(0,this.model.roleIndex,!1),this.close()},i.prototype.setRoleData=function(e){e.roleId!=this.model.roleData.roleId&&this.dragonuplevel&&(this.dragonuplevel.setid(this.model.selectpart),this.model.roleData=e,this.dragonuplevel.equipshow(),this.dragonuplevel.refresh()),this.model.roleData=e,this.refresh()},i.prototype.changebtnstate=function(e){this.ui.chuandai.currentState=this.ui.chuandai==e?"down":"up",this.ui.shengji.currentState=this.ui.shengji==e?"down":"up",this.ui.shengxing.currentState=this.ui.shengxing==e?"down":"up",this.ui.shouhu.currentState=this.ui.shouhu==e?"down":"up"},i.prototype.isshowdragonboneSelectWearPanel=function(t){var i=t;0==i.data.getId()?e.DragonboneController.getInstance().showdragonboneSelectWearPanel(i.part):e.TipsController.getInstance().showDragonBoneTips(i.data.getId())},i.prototype.showtips=function(t){switch(t.target){case this.ui.longjiao:case this.ui.longya:case this.ui.longqu:case this.ui.longzhua:case this.ui.longwei:this.isshowdragonboneSelectWearPanel(t.target);break;case this.ui.guardIcon:e.DragonboneController.getInstance().showDragonGuardTips(this.model.getWardLevel(),!1);break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("LONGGUHELP")}},i.prototype.upgradeLevelPanelrefreshPhagocytosis=function(){this.dragonuplevel&&this.dragonuplevel.refreshPhagocytosis()},i.prototype.upgradeLevelPanelshowPanel=function(t){return this.ui.shouhugroup.removeChildren(),this.changebtnstate(this.ui.shengji),this.btnindex=this.ui.shengji,this.dragonuplevel?(this.dragonuplevel.showPanel(t),void this.ui.shouhugroup.addChild(this.dragonuplevel)):(this.dragonuplevel=new e.DragonboneUpgradeLevelPanel(this.model),this.dragonuplevel.showPanel(t),void this.ui.shouhugroup.addChild(this.dragonuplevel))},i.prototype.showupstar=function(){return this.getIsShow()||e.DragonboneController.getInstance().showpanel(),this.changebtnstate(this.ui.shengxing),this.dragonupstar?void this.ui.shouhugroup.addChild(this.dragonupstar):(this.dragonupstar=new e.DragonboneUpStarPanel(this.model),void this.ui.shouhugroup.addChild(this.dragonupstar))},i.prototype.changeview=function(t){if(t.target!=this.btnindex)switch(this.btnindex=t.target,this.changebtnstate(t.target),this.ui.shouhugroup.removeChildren(),t.target){case this.ui.chuandai:break;case this.ui.shengji:if(this.dragonuplevel)return this.ui.shouhugroup.addChild(this.dragonuplevel),void this.dragonuplevel.showPanel(this.model.selectpart);this.dragonuplevel=new e.DragonboneUpgradeLevelPanel(this.model),this.ui.shouhugroup.addChild(this.dragonuplevel),this.dragonuplevel.showPanel(this.model.selectpart);break;case this.ui.shengxing:if(this.dragonupstar)return void this.ui.shouhugroup.addChild(this.dragonupstar);this.dragonupstar=new e.DragonboneUpStarPanel(this.model),this.ui.shouhugroup.addChild(this.dragonupstar);break;case this.ui.shouhu:if(this.dragonguard)return void this.ui.shouhugroup.addChild(this.dragonguard);this.dragonguard=new e.DragonGuard(this.model.getWardLevel()),this.ui.shouhugroup.addChild(this.dragonguard)}},i.prototype.openview=function(t){switch(t.target){case this.ui.longhun:e.SoulController.getInstance().showSoulPanel(),e.DragonboneController.getInstance().closepanel(),e.DragonArmorController.getInstance().closeArmorPanel();break;case this.ui.longgu:break;case this.ui.longjia:e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_LEVEL"))?(e.DragonArmorController.getInstance().showArmorPanel(),e.DragonboneController.getInstance().closepanel()):e.PopUpController.getInstance().showFloatTextPanel1("龙甲"+e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_LEVEL")+"级开启");break;case this.ui.longshenbaoku:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE)}},i.prototype.LevelSucces=function(){this.dragonuplevel.playAni()},i.prototype.heshengSucces=function(){},i.prototype.dragonboneInfoBack=function(){this.refresh()},i.prototype.dragonboneUpStarBack=function(){this.refresh(),this.dragonupstar&&(this.dragonupstar.playAni(),this.dragonupstar.refresh())},i.prototype.dragonboneCombinedBallBack=function(){this.dragonupstar&&this.dragonupstar.refresh()},i.prototype.dragonboneUpgradeLevelBack=function(){this.dragonuplevel&&(this.dragonuplevel.resetPhagocytosisList(),this.dragonuplevel.refresh())},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:if(!this.getIsShow())return;this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.getheadbarset=function(){return this.ui.headBar},i.prototype.setDragonRedPoint=function(e,t){this.ui["dragnredpoint"+e].visible=t},i.prototype.getAttrList=function(){var e=[];return e.push(this.ui.attr1),e.push(this.ui.attr2),e.push(this.ui.attr3),e.push(this.ui.attr4),e},i}(e.BasePanel);e.DragonbonePanel=t,__reflect(t.prototype,"foxgame.DragonbonePanel",["foxgame.IMessage","foxgame.IDragonbone","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="DragonboneSelectUpgradeItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.baseLabelList=[this.baseLabel0,this.baseLabel1],this.specialLabelList=[this.specialLabel0,this.specialLabel1,this.specialLabel2,this.specialLabel3,this.specialLabel4],this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHandler,this),this.specialGroupHeight=this.specialGroup.height,this.model=e.DragonboneController.getInstance().getModel()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=e.JsonDataManager.instance.dragonBoneTemplate[i.getEquipId()],o=e.JsonDataManager.instance.itemTemplate[i.getEquipId()];this.jiaobiao.visible=i.getState(),this.nameLabel.text=o.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(o.quality),this.scoreLabel.text=e.DragonboneController.getInstance().getDragonEquipScore(i)+"",this.icon.setDragonItem(i);for(var a,s=this.baseLabelList.length,r=0;s>r;r++){a=this.baseLabelList[r],a.text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[r])+":"+e.GlobalUtil.getAttrValueStr(n.attrTypeList[r],n.attrValueList[r]);var l=e.ColorUtils.instance.getAttrColorById(n.attrTypeList[r]);a.textColor=l}var h=i.getAttribute();if(null==h||0==h.length)this.specialGroup.height=0,this.specialGroup.visible=!1;else{this.specialGroup.height=this.specialGroupHeight,this.specialGroup.visible=!0,s=this.specialLabelList.length;for(var c=void 0,r=0;s>r;r++)c=h[r],a=this.specialLabelList[r],a.visible=null!=c,null!=c&&(a.text=e.LanguageUtils.instance.getValue("ATT_"+c.getAttrId())+":"+e.GlobalUtil.getAttrValueStr(c.getAttrId(),c.getAttrValue()))}},i.prototype.selectHandler=function(t){e.DragonboneController.getInstance().selectUpgradeDragon(this.data)},i}(eui.ItemRenderer);e.DragonboneSelectUpgradeItem=t,__reflect(t.prototype,"foxgame.DragonboneSelectUpgradeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonbone/DragonboneSelectUpgradeSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){var t=this.ui.list;t.dataProvider=this.model.collection,t.itemRenderer=e.DragonboneSelectUpgradeItem},i.prototype.refresh=function(){for(var t,i=this.model.dragonBoneInfo[this.model.roleData.roleId],n=i.getEquipInfo(),o=[],a=n.length,s=0;a>s;s++)t=n[s],t.getId()>0&&o.push(e.BagController.getInstance().getDragonBoneById(t.getId()));this.model.collection.replaceAll(o)},i}(e.BasePanel);e.DragonboneSelectUpgradePanel=t,__reflect(t.prototype,"foxgame.DragonboneSelectUpgradePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="DragonboneSelectUpgradeItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.baseLabelList=[this.baseLabel0,this.baseLabel1],this.specialLabelList=[this.specialLabel0,this.specialLabel1,this.specialLabel2,this.specialLabel3,this.specialLabel4],this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHandler,this),this.specialGroupHeight=this.specialGroup.height,this.model=e.DragonboneController.getInstance().getModel()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data;this.jiaobiao.visible=i.getState(),this.selectBtn.visible=!i.getState();var n=e.JsonDataManager.instance.dragonBoneTemplate[i.getEquipId()],o=e.JsonDataManager.instance.itemTemplate[i.getEquipId()];this.recommendImg.visible=!1;var a=e.BagController.getInstance().getEnableDragonboneByPart(n.part);if(a.length>0){var s=a.indexOf(i);if(0==s){var r=this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleInfo.getRoleId(),n.part),l=e.BagController.getInstance().getDragonBoneById(r.getId());e.DragonboneController.getInstance().getDragonEquipScore(l)<e.DragonboneController.getInstance().getDragonEquipScore(i)&&(this.recommendImg.visible=!0)}}this.nameLabel.text=o.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(o.quality),this.scoreLabel.text=e.DragonboneController.getInstance().getDragonEquipScore(i)+"",this.icon.setDragonItem(i);for(var h,c=this.baseLabelList.length,u=0;c>u;u++){h=this.baseLabelList[u],h.text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[u])+":"+e.GlobalUtil.getAttrValueStr(n.attrTypeList[u],n.attrValueList[u]);var p=e.ColorUtils.instance.getAttrColorById(n.attrTypeList[u]);h.textColor=p}var g=i.getAttribute();if(null==g||0==g.length)this.specialGroup.height=0,this.specialGroup.visible=!1;else{this.specialGroup.height=this.specialGroupHeight,this.specialGroup.visible=!0,c=this.specialLabelList.length;for(var d=void 0,u=0;c>u;u++)d=g[u],h=this.specialLabelList[u],h.visible=null!=d,null!=d&&(h.text=e.LanguageUtils.instance.getValue("ATT_"+d.getAttrId())+e.GlobalUtil.getAttrValueStr(d.getAttrId(),d.getAttrValue()))}},i.prototype.selectHandler=function(t){e.DragonboneController.getInstance().selectWearDragon(this.data)},i}(eui.ItemRenderer);e.DragonboneSelectWearItem=t,__reflect(t.prototype,"foxgame.DragonboneSelectWearItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonbone/DragonboneSelectWearSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.showpanel=function(e){this.part=e,this.getIsShow()?this.refresh():this.show()},i.prototype.initHook=function(){var t=this.ui.list;t.dataProvider=this.model.collection1,t.itemRenderer=e.DragonboneSelectWearItem,this.ui.scroller.viewport=t,this.hight=this.ui.scroller.height},i.prototype.refresh=function(){var t=this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,this.part),i=this.ui.scroller,n=this.ui.item;t.getId()>0?(n.data=e.BagController.getInstance().getDragonBoneById(t.getId()),this.ui.item.dataChanged(),n.visible=!0,i.y=n.y+n.height,i.height=i.height-n.height):(n.visible=!1,i.y=n.y,i.height=this.hight);var o=e.BagController.getInstance().getEnableDragonboneByPart(this.part);this.model.collection1.replaceAll(o)},i}(e.BasePanel);e.DragonboneSelectWearPanel=t,__reflect(t.prototype,"foxgame.DragonboneSelectWearPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/dragonbone/DragonBoneTipsSkin.exml","equipTip")||this;return e.id=null,e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(t,i){void 0===i&&(i=!0),this.id=t,this.showup=i,this.info=e.BagController.getInstance().getDragonBoneById(this.id),this.show()},i.prototype.showPanelByinfo=function(e,t){void 0===t&&(t=!1),this.info=e,this.showup=t,this.show()},i.prototype.initHook=function(){this.ui.lockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lockHandler,this),this.ui.unlockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.unlockHandler,this),this.ui.replaceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.replaceHandler,this),this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),e.BagController.getInstance().registerObserver(this)},i.prototype.refresh=function(){null!=this.id&&(this.info=e.BagController.getInstance().getDragonBoneById(this.id));var t=e.JsonDataManager.instance.dragonBoneTemplate[this.info.getEquipId()],i=e.JsonDataManager.instance.itemTemplate[t.id];this.ui.icon.setItem(t.id,0,!1);var n=null==this.info.getAttribute()?0:this.info.getAttribute().length;this.ui.nameLabel.text=n>0?i.name+"("+e.LanguageUtils.instance.getValue("JIBIANYI",n)+")":i.name,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(i.quality),this.ui.lvLabel.text=t.level+"",this.ui.scoreLabel.text=e.DragonboneController.getInstance().getDragonEquipScore(this.info)+"";for(var o,a,s,r=this.getAttrLabelList(),l=r.length,h=e.JsonDataManager.instance.dragonboneupstarTemplate,c=0;l>c;c++)o=r[c],a=t.attrValueList[c],o.text=e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[c])+":"+e.GlobalUtil.getAttrValueStr(t.attrTypeList[c],a);var u=e.DragonboneController.getInstance().getWearInfoById(this.info.getId());r=this.getStartAttrLabelList();for(var c=0;l>c;c++)o=r[c],a=t.attrValueList[c],o.text=e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[c])+":"+e.GlobalUtil.getAttrValueStr(t.attrTypeList[c],a),s=null!=u?h[u.getStatrLevel()]:null,null!=s?(a=Math.floor(a*s.addRate),o.text=e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[c])+":"+e.GlobalUtil.getAttrValueStr(t.attrTypeList[c],a)):o.text=e.LanguageUtils.instance.getValue("ATT_"+t.attrTypeList[c])+":0";r=this.getSpecialAttrLabelList(),l=r.length;for(var p,g=this.info.getAttribute(),c=0;l>c;c++)o=r[c],p=g[c],null!=p?o.text=e.LanguageUtils.instance.getValue("ATT_"+p.getAttrId())+":"+e.GlobalUtil.getAttrValueStr(p.getAttrId(),p.getAttrValue()):o.text="???";var d;if(this.showup){var f=e.BagController.getInstance().getEnableDragonboneByPart(t.part);d=f.length<1?!1:e.DragonboneController.getInstance().getDragonEquipScore(f[0])>e.DragonboneController.getInstance().getDragonEquipScore(this.info)}this.ui.redpoint.visible=this.showup?null==u?!1:d:this.showup,this.ui.replaceBtn.visible=this.showup?null!=u:this.showup,this.ui.upgradeBtn.visible=this.showup?null!=u:this.showup,this.ui.lockBtn.visible=this.showup?!this.info.getLock():this.showup,this.ui.unlockBtn.visible=this.showup?this.info.getLock():this.showup},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.lockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneLockRep");i.setId(this.id),i.setState(!0),e.Message.instance.send(e.Code.DRAGON_BONE_LOCK_C,i,!0)},i.prototype.unlockHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPDragonBoneLockRep");i.setId(this.id),i.setState(!1),e.Message.instance.send(e.Code.DRAGON_BONE_LOCK_C,i,!0)},i.prototype.replaceHandler=function(t){var i=e.BagController.getInstance().getDragonBoneById(this.id),n=e.JsonDataManager.instance.dragonBoneTemplate[i.getEquipId()];e.DragonboneController.getInstance().showdragonboneSelectWearPanel(n.part),this.close()},i.prototype.closeHook=function(){this.id=null},i.prototype.upgradeHandler=function(t){var i=e.BagController.getInstance().getDragonBoneById(this.id),n=e.JsonDataManager.instance.dragonBoneTemplate[i.getEquipId()];e.DragonboneController.getInstance().showUpgradeLevelPanel(n.part),this.close()},i.prototype.getAttrLabelList=function(){var e=[];return e.push(this.ui.attrLabel0),e.push(this.ui.attrLabel1),e},i.prototype.getStartAttrLabelList=function(){var e=[];return e.push(this.ui.starAttrLabel0),e.push(this.ui.starAttrLabel1),e},i.prototype.getSpecialAttrLabelList=function(){var e=[];return e.push(this.ui.specialAttrLabel0),e.push(this.ui.specialAttrLabel1),e.push(this.ui.specialAttrLabel2),e.push(this.ui.specialAttrLabel3),e.push(this.ui.specialAttrLabel4),e},i}(e.BasePanel);e.DragonBoneTips=t,__reflect(t.prototype,"foxgame.DragonBoneTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="DragonboneUpgradeLevelIcon",e.touchChildren=!1,e}return __extends(i,t),i.prototype.setItem=function(e,t){if(void 0===t&&(t=0),this.data=e,null!=this.data.dragonBoneInfo)this.setDragonItem(this.data.dragonBoneInfo,!1);else if(null!=this.data.itemInfo){this.lvLabel.visible=!1;var i=0!=t?t:this.data.itemInfo.getCount();this.icon.setItem(this.data.itemVO.id,i,!1)}},i.prototype.setDragonItem=function(t,i){void 0===i&&(i=!0),this.lvLabel.visible=!0;var n=e.JsonDataManager.instance.dragonBoneTemplate[t.getEquipId()];this.lvLabel.text="Lv."+n.level,this.icon.setItem(t.getEquipId(),0,i)},i}(eui.Component);e.DragonboneUpgradeLevelIcon=t,__reflect(t.prototype,"foxgame.DragonboneUpgradeLevelIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="DragonboneUpgradeLevelSkin",i.model=e,i.initHook(),i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.showPanel=function(e){void 0===e&&(e=-1),this.model.selectpart=e,this.equipshow(),this.refresh(),this.initParams()},i.prototype.initHook=function(){this.progressWidth=this.progressBarImg.width;for(var e,t,i=this.getIconList().length,n=this.getIconList(),o=this.getAddImgList(),a=0;i>a;a++)this.model.phagocytosisList[a]=null,e=n[a],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.iconHandler,this),t=o[a],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addPhagocytosisHandler,this);this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addUpgradeHandler,this),this.quickBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.phagocytosisHandler,this),this.longjiao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longya.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longqu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longzhua.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longwei.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this)},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.showtips=function(e){this.longjiao.setSelectedState(this.longjiao==e.target),this.longya.setSelectedState(this.longya==e.target),this.longqu.setSelectedState(this.longqu==e.target),this.longzhua.setSelectedState(this.longzhua==e.target),this.longwei.setSelectedState(this.longwei==e.target);var t=e.target.data;this.model.selectpart=e.target.part,this.setid(t.getId()),this.refresh()},i.prototype.initParams=function(){this.resetPhagocytosisList()},i.prototype.equipshow=function(){this.longjiao.setdragon(e.DragonBonePartType.PART1,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART1)),this.longya.setdragon(e.DragonBonePartType.PART2,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART2)),this.longqu.setdragon(e.DragonBonePartType.PART3,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART3)),this.longzhua.setdragon(e.DragonBonePartType.PART4,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART4)),this.longwei.setdragon(e.DragonBonePartType.PART5,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART5));var t;switch(this.longjiao.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART1),this.longya.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART2),this.longqu.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART3),this.longzhua.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART4),this.longwei.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART5),this.model.selectpart){case e.DragonBonePartType.PART1:t=this.longjiao.data,this.setid(t.getId());
break;case e.DragonBonePartType.PART2:t=this.longya.data,this.setid(t.getId());break;case e.DragonBonePartType.PART3:t=this.longqu.data,this.setid(t.getId());break;case e.DragonBonePartType.PART4:t=this.longzhua.data,this.setid(t.getId());break;case e.DragonBonePartType.PART5:t=this.longwei.data,this.setid(t.getId())}},i.prototype.resetPhagocytosisList=function(){for(var t,i=e.BagController.getInstance().getPhagocytosisDragonBone(!0).concat(),n=this.model.phagocytosisList,o=n.length,a=0;o>a;a++)t=i[a],n[a]=t;this.equipshow()},i.prototype.setid=function(e){this.id=e},i.prototype.refresh=function(){this.dragonInfo=e.BagController.getInstance().getDragonBoneById(this.id);for(var t,i,n=this.getIconList(),o=this.getAddImgList(),a=n.length,s=0;a>s;s++)t=n[s],t.visible=null!=this.dragonInfo,i=o[s],i.visible=null==this.dragonInfo;if(null==this.dragonInfo)return this.scoreLabel.text="0",this.curIcon.visible=!1,this.nameLabel.text="",this.attrGroup.visible=!1,this.progressBarImg.width=0,this.progressLabel.text="",void(this.quickBtn.visible=!1);this.curIcon.visible=!0,this.attrGroup.visible=!0,this.quickBtn.visible=!0;var r=e.JsonDataManager.instance.dragonBoneTemplate[this.dragonInfo.getEquipId()],l=e.JsonDataManager.instance.itemTemplate[r.id],h=e.DragonboneController.getInstance().getDragonEquipScore(this.dragonInfo);this.scoreLabel.text=h+"",this.curIcon.setDragonItem(this.dragonInfo,!1),this.nameLabel.text=l.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(l.quality);var c;a=r.attrTypeList.length,this.curLvLabel.text="Lv."+r.level;for(var s=0;a>s;s++)c=this.getCurAttrLabelList()[s],c.text=e.LanguageUtils.instance.getValue("ATT_"+r.attrTypeList[s])+":"+e.GlobalUtil.getAttrValueStr(r.attrTypeList[s],r.attrValueList[s]);var u=e.JsonDataManager.instance.dragonBoneByPartAndLvTemplate[r.part+"_"+(r.level+1)];if(this.nextGroup.visible=null!=u,this.maxLvLabel.visible=null==u,null!=u){this.nextLvLabel.text="Lv."+u.level;for(var s=0;a>s;s++)c=this.getNextAttrLabelList()[s],c.text=e.LanguageUtils.instance.getValue("ATT_"+u.attrTypeList[s])+e.GlobalUtil.getAttrValueStr(u.attrTypeList[s],u.attrValueList[s])}var p=e.JsonDataManager.instance.dragonboneuplevelTemplate[r.level];if(null!=u){var g=Number(this.dragonInfo.getExp())/p.levelupExp;this.progressBarImg.width=this.progressWidth*g,this.progressLabel.text=this.dragonInfo.getExp()+"/"+p.levelupExp}else this.progressBarImg.width=this.progressWidth,this.progressLabel.text="0/0";this.refreshPhagocytosis()},i.prototype.refreshPhagocytosis=function(){for(var e,t,i,n=this.getIconList(),o=this.getAddImgList(),a=n.length,s=0;a>s;s++)e=n[s],t=this.model.phagocytosisList[s],i=o[s],e.visible=null!=t,i.visible=null==t,null!=t&&e.setItem(t,t.count)},i.prototype.addUpgradeHandler=function(t){e.DragonboneController.getInstance().showSelectUpgradePanel()},i.prototype.phagocytosisHandler=function(t){var i=e.JsonDataManager.instance.dragonBoneTemplate[this.dragonInfo.getEquipId()],n=e.JsonDataManager.instance.dragonBoneByPartAndLvTemplate[i.part+"_"+(i.level+1)];if(null==n)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("DRAGONPHAGOCYTOSISPROMPT3"));for(var o=!1,a=this.model.phagocytosisList.length,s=0;a>s;s++)if(null!=this.model.phagocytosisList[s]){o=!0;break}return 0==o?void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("DRAGONPHAGOCYTOSISPROMPT1")):void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("DRAGONPHAGOCYTOSISPROMPT4"),this,this.confirmBack)},i.prototype.confirmBack=function(){e.DragonboneController.getInstance().requestLevelUp(this.model.roleData.roleId,this.dragonInfo.getId())},i.prototype.iconHandler=function(e){var t=e.currentTarget;this.getIconList().indexOf(t);this.model.removePhagocytosis(t.data),this.refreshPhagocytosis()},i.prototype.addPhagocytosisHandler=function(t){null!=this.dragonInfo&&e.DragonboneController.getInstance().showSelectPhagocytosisPanel()},i.prototype.clearPhagocytosisList=function(){for(var e=this.model.phagocytosisList.length,t=0;e>t;t++)this.model.phagocytosisList[t]=null},i.prototype.closeHook=function(){this.clearPhagocytosisList()},i.prototype.dragonboneInfoBack=function(){},i.prototype.dragonboneUpStarBack=function(){},i.prototype.dragonboneCombinedBallBack=function(){},i.prototype.dragonboneUpgradeLevelBack=function(){this.resetPhagocytosisList(),this.refresh()},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.getCurAttrLabelList=function(){var e=[];return e.push(this.curAttrLabel0),e.push(this.curAttrLabel1),e},i.prototype.getNextAttrLabelList=function(){var e=[];return e.push(this.nextAttrLabel0),e.push(this.nextAttrLabel1),e},i.prototype.getAddImgList=function(){var e=[];return e.push(this.addImg0),e.push(this.addImg1),e.push(this.addImg2),e.push(this.addImg3),e.push(this.addImg4),e.push(this.addImg5),e.push(this.addImg6),e.push(this.addImg7),e.push(this.addImg8),e.push(this.addImg9),e.push(this.addImg10),e.push(this.addImg11),e},i.prototype.getIconList=function(){var e=[];return e.push(this.icon0),e.push(this.icon1),e.push(this.icon2),e.push(this.icon3),e.push(this.icon4),e.push(this.icon5),e},i}(eui.Component);e.DragonboneUpgradeLevelPanel=t,__reflect(t.prototype,"foxgame.DragonboneUpgradeLevelPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="DragonUpStarSkin",i.model=e,i.initHook(),i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.refresh()},i.prototype.initHook=function(){this.uplevelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clicktab,this),this.uplevelballBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clicktab,this),this.longjiao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longya.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longqu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longzhua.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.longwei.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtips,this),this.ball.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showtip,this),this.equipshow()},i.prototype.equipshow=function(){this.longjiao.setdragonupstar(e.DragonBonePartType.PART1,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART1)),this.longya.setdragonupstar(e.DragonBonePartType.PART2,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART2)),this.longqu.setdragonupstar(e.DragonBonePartType.PART3,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART3)),this.longzhua.setdragonupstar(e.DragonBonePartType.PART4,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART4)),this.longwei.setdragonupstar(e.DragonBonePartType.PART5,this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,e.DragonBonePartType.PART5)),this.longjiao.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART1),this.longya.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART2),this.longqu.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART3),this.longzhua.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART4),this.longwei.setSelectedState(this.model.selectpart==e.DragonBonePartType.PART5)},i.prototype.showtips=function(e){this.longjiao.setSelectedState(this.longjiao==e.target),this.longya.setSelectedState(this.longya==e.target),this.longqu.setSelectedState(this.longqu==e.target),this.longzhua.setSelectedState(this.longzhua==e.target),this.longwei.setSelectedState(this.longwei==e.target),this.model.selectpart=e.target.part,this.refresh()},i.prototype.showtip=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.refresh=function(){this.equipshow();var t=0,i=this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,this.model.selectpart);i&&(t=i.getStatrLevel());var n=this.getkeelRisingStar()[t],o=0,a=0;this.dataarr=[],n&&(o=n.level,a=n.addRate,this.dataarr=this.settingconsume(n.levelUpCost)),this.nowlevel.text="Lv."+o,this.nowattr.text=e.LanguageUtils.instance.getValue("BASEATTR")+"+"+100*a+"%";var s,r=this.getkeelRisingStar()[t+1],l=e.LanguageUtils.instance.getValue("YIMANJI"),h=e.LanguageUtils.instance.getValue("YIMANJI");r&&(l=String(r.level),h=String(r.addRate),this.dataarr=this.settingconsume(r.levelUpCost),s=e.BagController.getInstance().getCountByItemId(this.dataarr[2])),this.nextlevel.text=r?"Lv."+l:l,this.nextattr.text=r?e.LanguageUtils.instance.getValue("BASEATTR")+"+"+100*Number(h)+"%":h,this.ball.setItem(this.dataarr[2],-1,!1,!1),this.ball.setGray(s<Number(this.dataarr[1])),this.redpoint.visible=e.DragonboneController.getInstance().refreshDragonBall()},i.prototype.playCompleteS=function(){this.aniGroup.visible=!1},i.prototype.settingconsume=function(e){var t=this.getItemTemp()[e.id],i=new Array;return i.push(t.name),i.push(e.value),i.push(e.id),i},i.prototype.clicktab=function(t){switch(t.target){case this.uplevelBtn:var i=e.BagController.getInstance().getCountByItemId(this.dataarr[2]);if(i<Number(this.dataarr[1]))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU"));var n=this.model.getPartInfoByRoleIdAndPart(this.model.roleData.roleId,this.model.selectpart),o=0;n&&(o=n.getStatrLevel());var a=this.getkeelRisingStar()[o+1];if(!a)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GAIBUWEIXINGJIYIDASHANGXIAN"));e.DragonboneController.getInstance().sendDRAGON_BONE_UPDRADE_C(this.model.selectpart);break;case this.uplevelballBtn:e.DragonboneController.getInstance().showdragonballpanel()}},i.prototype.playAni=function(){this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.upStarAni=new e.FoxAni(this.anigroup),this.upStarAni.setPlayComplete(this.playComplete,this),this.upStarAni.play("upStarAni","ani",1),this.anigroup.visible=!0},i.prototype.playComplete=function(){this.anigroup.visible=!1},i.prototype.getkeelRisingStar=function(){return e.JsonDataManager.instance.dragonboneupstarTemplate},i.prototype.getItemTemp=function(){return e.JsonDataManager.instance.itemTemplate},i}(eui.Component);e.DragonboneUpStarPanel=t,__reflect(t.prototype,"foxgame.DragonboneUpStarPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.list={1:"longJiao_jpg",2:"longYa_jpg",3:"longQu_jpg",4:"longZhua_jpg",5:"longWei_jpg"},e.list1={1:"longJiao_dianJi_jpg",2:"longYa_dianJi_jpg",3:"longQu_dianJi_jpg",4:"longZhua_dianJi_jpg",5:"longWei_dianJi_jpg"},e.skinName="Dragoncell",e.touchChildren=!1,e}return __extends(i,t),i.prototype.setdragon=function(t,i){void 0===i&&(i=null),this.part=t,this.data=i,this.isShowRedPoint(e.DragonboneController.getInstance().refreshDragonEquip(i));var n=e.BagController.getInstance().getDragonBoneById(i.getId());this.starId.visible=!0,this.setLevel(String(i.getStatrLevel())),this.setlevel1(0==i.getId()?"":this.getdragon()[n.getEquipId()].level),this.itembg.visible=0==i.getId(),this.itemIcon.visible=0!=i.getId(),0==i.getId()?this.setItemIconfashion(this.list[t]):this.setItemIcon(n.getEquipId()),this.setItemLevel(0==i.getId()?"":this.getitem()[n.getEquipId()].name)},i.prototype.setdragonupstar=function(t,i){void 0===i&&(i=null),this.part=t,this.data=i,this.isShowRedPoint(e.DragonboneController.getInstance().refreshDragonStar(i)),this.setItemIconfashion(this.selectedImage.visible?this.list1[t]:this.list[t]),this.setlevel1(""),this.starId.visible=!0,this.setLevel(String(i.getStatrLevel()))},i.prototype.getitem=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.getdragon=function(){return e.JsonDataManager.instance.dragonBoneTemplate},i.prototype.restore=function(){this.isShowRedPoint(!1),this.setQualityIconVisible(!1),this.setSelectedState(!1),this.setLevelBg(!1),this.setLevel(""),this.setItemStar(""),this.setItemLevel(""),this.setQualityIcon("6"),this.setItemIcon(1),this.setlevel1("")},i.prototype.setlevel1=function(e){""==e?this.level1.text=e:this.level1.text="Lv."+e},i.prototype.setItemIcon=function(e){this.itemIcon.setItem(e,-1,!1,!1)},i.prototype.setItemIconfashion=function(e){this.itembg.source=null,this.itembg.source=e},i.prototype.setLevelBg=function(e){this.levelBg.visible=e},i.prototype.setSelectedState=function(e){this.setItemIconfashion(e?this.list1[this.part]:this.list[this.part]),this.selectedImage.visible=e},i.prototype.getselectedImage=function(){return this.selectedImage.visible},i.prototype.setItemLevel=function(t){this.itemLevel.text=t;var i=e.JsonDataManager.instance.itemTemplate[this.data.getEquiId()];i&&(this.itemLevel.textColor=e.ColorUtils.instance.getColorByQuality(i.quality))},i.prototype.setItemIconname=function(e){this.itemIcon.setItem(e,-1,!0,!1)},i.prototype.setLevel=function(e){""==e?this.level.text=e:this.level.text=e},i.prototype.setItemStar=function(t){""==t?this.num.text=t:this.num.text=t+e.LanguageUtils.instance.getValue("XING")},i.prototype.isShowRedPoint=function(e){void 0===e&&(e=!1),this.redPoint.visible=e},i.prototype.showItemType=function(e){this.itemType.text=e},i.prototype.setQualityIcon=function(e){this.qualityIcon.source="0000"+e+"_png"},i.prototype.setQualityIconVisible=function(e){this.qualityIcon.visible=e},Object.defineProperty(i.prototype,"itemData",{set:function(e){this.data=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Index",{set:function(e){this.idx=e},enumerable:!0,configurable:!0}),i}(eui.Button);e.DragonCell=t,__reflect(t.prototype,"foxgame.DragonCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="DragonGuardSkin",i.halonowlevel=e,i.init(e),i.initListener(),i}return __extends(i,t),i.prototype.initListener=function(){this.shouhu1.name="1",this.shouhu2.name="2",this.shouhu3.name="3",this.shouhu1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.shouhu2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.shouhu3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.checkBoxBtn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickcheck,this)},i.prototype.clickcheck=function(t){"disabled"!=this.checkBoxBtn_0.currentState&&(this.checkBoxBtn_0.currentState="up"==this.checkBoxBtn_0.currentState?"down":"up",e.DragonboneController.getInstance().sendDRAGON_BONE_WARD_C(this.checkBoxBtn_0.currentState,this.halolevel))},i.prototype.clickbtn=function(e){this.playAni(Number(e.target.name)),this.rolehalo(this.halonowlevel)},i.prototype.playAni=function(t){this.halolevel=t;var i=e.JsonDataManager.instance.dragonGuardTemplate[t];return this.upStarAni?void this.upStarAni.play(i.effect1,"ani"):(this.upStarAni=new e.FoxAni(this.halogroup),this.upStarAni.play(i.effect1,"ani"),void(this.halogroup.visible=!0))},i.prototype.init=function(e){this.playAni(0==e?1:e),this.refresh(e)},i.prototype.refresh=function(t){e.CharacterController.getInstance().showcharavatar(this.avatar,e.DragonboneController.getInstance().getModel().roleData,!1),this.halonowlevel=t,this.shouhu1.currentState=t>=1?"up":"disabled",this.shouhu2.currentState=t>=2?"up":"disabled",this.shouhu3.currentState=t>=3?"up":"disabled",this.shouhu4.currentState=t>=2?"up":"down",this.shouhu5.currentState=t>=3?"up":"down",this.showtxt0.textFlow=(new egret.HtmlTextParser).parser(0==t?e.LanguageUtils.instance.getValue("DRAGONGUARD9"):e.LanguageUtils.instance.getValue("DRAGONGUARD8",t)),this.rolehalo(t),this.guardchange(t)},i.prototype.rolehalo=function(t){var i=e.DragonboneController.getInstance().getModel(),n=i.roleData.roleInfo,o="disabled";t>=this.halolevel&&(o="up",n.getWardLevel()&&n.getWardLevel()==this.halolevel&&1==n.getWardState()&&(o="down")),this.checkBoxBtn_0.currentState=o},i.prototype.guardchange=function(t){var i=e.JsonDataManager.instance.dragonGuardTemplate,n=i[t],o="0%";n&&(o=e.GlobalUtil.getAttrValueStr(n.attrTypeList[0],n.attrValueList[0])),this.txt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("DRAGONGUARD1",o))},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),e.CharacterController.getInstance().showcharavatar(this.avatar,e.DragonboneController.getInstance().getModel().roleData,!1)},i.prototype.removeFromStage=function(){this.shouhu1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.shouhu2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.shouhu3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.checkBoxBtn_0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickcheck,this),this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.avatar&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(this.avatar,"DragonGuardCharAvatar",!0,e.DragonboneController.getInstance().getPanel().getUiBaseName()),this.avatar.notifyUnLoadImageRes())},i}(eui.Component);e.DragonGuard=t,__reflect(t.prototype,"foxgame.DragonGuard")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this,"resource/skins/dragonbone/DragonGuardTips.exml")||this}return __extends(i,t),i.prototype.showpanel=function(e,t){this.wardLevel=e,this.showguard=t,this.getIsShow()?this.refresh():this.show()},i.prototype.refresh=function(){var t=e.JsonDataManager.instance.dragonGuardTemplate,i=this.wardLevel,n=t[this.wardLevel],o=t[i+1],a="0%",s="0",r=e.LanguageUtils.instance.getValue("YIMANJI");"down"==this.ui.guardIcon.currentState,n&&(a=e.GlobalUtil.getAttrValueStr(n.attrTypeList[0],n.attrValueList[0]),s=String(n.wardLevel),"up"==this.ui.guardIcon.currentState),o&&(r=e.GlobalUtil.getAttrValueStr(o.attrTypeList[0],o.attrValueList[0])),this.ui.tiaojian.text=this.showguard?e.LanguageUtils.instance.getValue("DRAGONGUARD4"):e.LanguageUtils.instance.getValue("DRAGONGUARD5"),this.ui.scoreBLabel.text=n?String(e.GlobalUtil.getScore(n.attrTypeList,n.attrValueList)):"0",this.ui.nameLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("DRAGONGUARD3",s)),this.ui.attrLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("DRAGONGUARD6",a)),this.ui.attrLabel0.textFlow=(new egret.HtmlTextParser).parser(o?e.LanguageUtils.instance.getValue("DRAGONGUARD7",r):r),this.ui.attrLabel1.textFlow=(new egret.HtmlTextParser).parser(this.showguard?e.LanguageUtils.instance.getValue("DRAGONGUARD2",n.keelLevel):o?e.LanguageUtils.instance.getValue("DRAGONGUARD2",o.keelLevel):r)},i}(e.BasePanel);e.DragonGuardTips=t,__reflect(t.prototype,"foxgame.DragonGuardTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.clear()}return e.prototype.clear=function(){this.isSelected=!1,this.data=null},e}();e.PhagocytosisData=t,__reflect(t.prototype,"foxgame.PhagocytosisData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="PhagocytosisItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.baseLabelList=[this.baseLabel0,this.baseLabel1],this.specialLabelList=[this.specialLabel0,this.specialLabel1,this.specialLabel2,this.specialLabel3,this.specialLabel4],this.checkBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkBtnHandler,this),this.checkBtn.selected=!1,this.specialGroupHeight=this.specialGroup.height,this.model=e.DragonboneController.getInstance().getModel()},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;null!=e.itemInfo?this.setItem(e.itemVO):null!=e.dragonBoneInfo&&this.setDragonItem(e.dragonBoneInfo)},i.prototype.setItem=function(e){this.attrGroup.visible=!1,this.desLabel.visible=!0,this.setIcon(e.id),this.desLabel.text=e.desc},i.prototype.setDragonItem=function(t){this.attrGroup.visible=!0,this.desLabel.visible=!1,this.setIcon(t.getEquipId()),this.scoreLabel.text=e.DragonboneController.getInstance().getDragonEquipScore(t)+"";for(var i,n=e.JsonDataManager.instance.dragonBoneTemplate[t.getEquipId()],o=this.baseLabelList.length,a=0;o>a;a++){i=this.baseLabelList[a],i.text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[a])+":"+e.GlobalUtil.getAttrValueStr(n.attrTypeList[a],n.attrValueList[a]);var s=e.ColorUtils.instance.getAttrColorById(n.attrTypeList[a]);i.textColor=s}var r=t.getAttribute();if(null==r||0==r.length)this.specialGroup.height=0,this.specialGroup.visible=!1;else{this.specialGroup.height=this.specialGroupHeight,this.specialGroup.visible=!0,o=this.specialLabelList.length;for(var l=void 0,a=0;o>a;a++)l=r[a],i=this.specialLabelList[a],i.visible=null!=l,null!=l&&(i.text=e.LanguageUtils.instance.getValue("ATT_"+l.getAttrId())+":"+e.GlobalUtil.getAttrValueStr(l.getAttrId(),l.getAttrValue()))}},i.prototype.setIcon=function(t){var i=this.data.itemInfo?this.data.count:0;this.icon.setItem(this.data,i);var n=e.JsonDataManager.instance.itemTemplate[t];this.nameLabel.text=n.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(n.quality)},i.prototype.checkBtnHandler=function(e){var t=this.checkBtn.selected;if(t){var i=this.model.pushPhagocytosis(this.data);0==i&&(this.checkBtn.selected=!1)}else this.model.removePhagocytosis(this.data)},i}(eui.ItemRenderer);e.PhagocytosisItem=t,__reflect(t.prototype,"foxgame.PhagocytosisItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragonbone/PhagocytosisSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){var t=this.ui.itemList;t.dataProvider=this.model.phagocytosisCollection,t.itemRenderer=e.PhagocytosisItem,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandler,this)},i.prototype.refresh=function(){for(var t,i=e.BagController.getInstance().getPhagocytosisDragonBone(!1),n=i.length,o=n-1;o>=0;o--)t=i[o],-1!=this.model.phagocytosisList.indexOf(t)&&i.splice(o,1);this.model.phagocytosisCollection.replaceAll(i)},i.prototype.confirmHandler=function(t){this.close(),e.DragonboneController.getInstance().updatePhagocytosisView()},i}(e.BasePanel);e.PhagocytosisPanel=t,__reflect(t.prototype,"foxgame.PhagocytosisPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonBallUpStarVO=t,__reflect(t.prototype,"foxgame.DragonBallUpStarVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonBoneHaloVO=t,__reflect(t.prototype,"foxgame.DragonBoneHaloVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonBoneUpLevelVO=t,__reflect(t.prototype,"foxgame.DragonBoneUpLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonBoneUpStarVO=t,__reflect(t.prototype,"foxgame.DragonBoneUpStarVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonBoneVO=t,__reflect(t.prototype,"foxgame.DragonBoneVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonEssenceVO=t,__reflect(t.prototype,"foxgame.DragonEssenceVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragonGuardVO=t,__reflect(t.prototype,"foxgame.DragonGuardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="DragongodBagItem",e}return __extends(i,t),i.prototype.setData=function(e){this.lockLabel.visible=!1,this.data=e,this.icon.setItem(e.id,-1),this.icon.settxtlabel("")},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){if(!(this.data instanceof e.ItemVO)){var t=this.data,i=e.JsonDataManager.instance.itemTemplate[t.getItmeId()];this.lockLabel.visible=!1,this.icon.setItem(i.id,t.getAmount()),this.data=i}},i.prototype.clickHandler=function(t){var i=this.data;i.type==e.ItemType.EQUIP||(i.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(i.id):i.type==e.ItemType.DRAGONBONE?e.TipsController.getInstance().showDragonBoneTips(i.id):i.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.id,!1):i.type==e.ItemType.SKILLSTONE?e.TipsController.getInstance().showDragonArmorSkillTips(i.id):e.TipsController.getInstance().showItemTips(i.id,-1,!1))},i.createNum=0,i.updateNum=0,i}(eui.ItemRenderer);e.DragongodBagItem=t,__reflect(t.prototype,"foxgame.DragongodBagItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.DragongodTreasureModel,this.panel=new e.DragongodTreasurePanel(this.model),this.housepanel=new e.DragongodTreasureWarehouse(this.model),this.rewardpanel=new e.DragongodTreasureRewardSkin(this.model)}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showpanel=function(){var t=e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN");return e.PlayerService.instance.playerInfo.getLevel()<Number(t)?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BAOKUOPEN",t)):(this.sendDRAGON_HOARD_LOG_C(),void this.panel.show())},t.prototype.closepanel=function(){this.panel.close()},t.prototype.showhoudepanel=function(){this.housepanel.show()},t.prototype.showrewardpanel=function(e){this.rewardpanel.showPage(e)},t.prototype.registerMsg=function(t){t.add(e.Code.DRAGON_HOARD_INFO_S,this),t.add(e.Code.NATURAL_VALUE_AWARD_S,this),t.add(e.Code.DRAGON_HOARD_AWARD_S,this),t.add(e.Code.OPEN_DRAGON_HOARD_S,this),t.add(e.Code.DRAGON_HOARD_LOG_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.DRAGON_HOARD_INFO_S:this.model.setCodeDRAGON_HOARD_INFO_S(i);break;case e.Code.NATURAL_VALUE_AWARD_S:0!=i.getErrorNo()?e.GlobalUtil.showErrorCodeMsg(i.getErrorNo()):this.model.setNATURAL_VALUE_AWARD_S(i);break;case e.Code.DRAGON_HOARD_AWARD_S:0!=i.getErrorNo()?e.GlobalUtil.showErrorCodeMsg(i.getErrorNo()):(this.model.dataSource=[],this.model.updateRecord());break;case e.Code.OPEN_DRAGON_HOARD_S:this.model.setOPEN_DRAGON_HOARD_S(i);break;case e.Code.DRAGON_HOARD_LOG_S:this.model.setRecords(i)}},t.prototype.redpoint=function(t){return void 0===t&&(t=!1),e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN"))?!1:1==this.model.freeNnmber?!0:this.model.dataSource.length>=1?!0:this.ondepointred()?!0:this.tenepointred()?!0:this.tianyunpoint()?!0:!1},t.prototype.tianyunpoint=function(){for(var e=this.model.activityList.length,t=0;e>t;t++){var i=this.model.activityList[t];if(0==i.getState()&&this.model.activity>=i.getNaValue())return!0}return!1},t.prototype.ondepointred=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ITEM")),i=e.BagController.getInstance().getCountByItemId(t.id);return i>=1?!0:e.PlayerService.instance.playerInfo.getGold()>=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ONECONSUME"))?!0:!1},t.prototype.tenepointred=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ITEM")),i=e.BagController.getInstance().getCountByItemId(t.id);return i>=10?!0:e.PlayerService.instance.playerInfo.getGold()>=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_TENCONSUME"))?!0:!1},t.prototype.setRecords=function(e){this.model.setRecord(e)},t.prototype.sendDRAGON_HOARD_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDragonHoardInfoReq");e.Message.instance.send(e.Code.DRAGON_HOARD_INFO_C,t,!0)},t.prototype.sendDRAGON_HOARD_AWARD_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPNaturalValueReq");i.setNaValue(Number(t)),e.Message.instance.send(e.Code.NATURAL_VALUE_AWARD_C,i,!0)},t.prototype.sendNATURAL_VALUE_AWARD_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDragonHoardAwardReq");e.Message.instance.send(e.Code.DRAGON_HOARD_AWARD_C,t,!0)},t.prototype.sendOPEN_DRAGON_HOARD_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPOpenDragonHoardReq");i.setState(t),e.Message.instance.send(e.Code.OPEN_DRAGON_HOARD_C,i,!0)},t.prototype.boolsend=function(e){this.panel.sendmessage(e)},t.prototype.sendDRAGON_HOARD_LOG_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPDragonHoardLogReq");e.Message.instance.send(e.Code.DRAGON_HOARD_LOG_C,t,!0)},t}();e.DragongodTreasureController=t,__reflect(t.prototype,"foxgame.DragongodTreasureController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.maxNum=30,this.tipbool=!1,this.activityList=[],this.recordList=[],this.datasouse=[],this.observerList=[],this.dataSource=[],this.resultList=[],this.tipbool=!1,this.collection=new eui.ArrayCollection}return t.prototype.getdragongodnum=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ITEM")),i=e.BagController.getInstance().getCountByItemId(t.id);return i},t.prototype.refreshdatasouse=function(){for(var t=e.JsonDataManager.instance.dragongodtreasureItemTemplate[e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN")],i=e.JsonDataManager.instance.itemTemplate,n=t.displayProps.length,o=0;n>o;o++){var a=t.displayProps[o];this.datasouse.push(i[a.id])}},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateRecord=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.dragongodInfoBack()},t.prototype.setCodeDRAGON_HOARD_INFO_S=function(e){this.activity=Number(e.getNaturalValue()),this.activityList=[],this.activityList=e.getNaturalValueList(),this.freeNnmber=Number(e.getFreeNnmber()),this.addNumber=Number(e.getAddNumber()),this.dataSource=[],this.dataSource=e.getHoardInfo(),this.updateRecord()},t.prototype.setNATURAL_VALUE_AWARD_S=function(e){this.activityList=[],this.activityList=e.getNaturalValueList(),this.updateRecord()},t.prototype.setOPEN_DRAGON_HOARD_S=function(t){return 0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.activity=Number(t.getNaturalValue()),this.addNumber=Number(t.getAddNumber()),this.freeNnmber=Number(t.getFreeNnmber()),this.activityList=[],this.activityList=t.getNaturalValueList(),this.dataSource=[],this.dataSource=t.getHoardInfo(),this.resultList=t.getDrawAwardInfo(),e.DragongodTreasureController.getInstance().showrewardpanel(t.getState()),void this.updateRecord())},t.prototype.setRecord=function(e){var t=e.getParams(),i={};for(i.playerId=t[0].getIntParam(),i.playerName=t[0].getStrParam(),i.itemId=t[1].getIntParam(),this.recordList.push(i);this.recordList.length>this.maxNum;)this.recordList.shift();this.updateRecord()},t.prototype.setRecords=function(e){var t=e.getLogInfo();this.recordList=[];for(var i,n=0;n<t.length;n++){i=t[n];var o={};o.playerId=i.getPlayerId(),o.playerName=i.getName(),o.itemId=i.getItemId(),this.recordList.push(o),o=null}for(;this.recordList.length>this.maxNum;)this.recordList.shift();this.updateRecord()},t}();e.DragongodTreasureModel=t,__reflect(t.prototype,"foxgame.DragongodTreasureModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragongodtreasure/DragongodTreasureSkin.exml","dragongodtreasure")||this;return i.model=e,i}return __extends(i,t),i.prototype.showHook=function(){42==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.add_one,this,42,3,!0),e.SearchTreasureController.getInstance().sendTreasureSale()},i.prototype.initHook=function(){this.ui.contentLabel.addEventListener(egret.TextEvent.LINK,this.linkHandler,this),this.model.refreshdatasouse(),this.ui.tianyunjindu.mask=this.ui.tianyunzhezhao,this.ui.log1.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("DRAGONGODTREASURELOG1"));
for(var t,i=this.getitemList(),n=0;n<i.length;n++){t=i[n];var o=this.model.datasouse[n];t.setData(o)}this.model.registerObserver(this),e.SearchTreasureController.getInstance().getmodel().registerObserver(this),this.ui.help.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("HELPLOG")),this.ui.help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.add_one.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.add_ten.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.addprice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.warehouse.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.dragongodtreasure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.goldtreasure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this);for(var a=this.getlisthuo(),n=0;n<a.length;n++)a[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.gethuo,this);this.ui.longshenzhibao.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("LONGSHENZHIBAO")),this.doScreenAdaptation(),this.saleList=[]},i.prototype.dragongodInfoBack=function(){this.refresh()},i.prototype.gethuo=function(t){var i=this.getlisthuo().indexOf(t.target),n=e.JsonDataManager.instance.dragongodTreasureNaturalValueTemplate[String(i)];if(this.model.activity<n.naturalValue)return void e.TipsController.getInstance().showItemTips(n.naturalAward.id,n.naturalAward.value,!1);for(var o=this.model.activityList.length,a=0;o>a;a++){var s=this.model.activityList[a];if(1==s.getState()&&n.naturalValue==s.getNaValue())return void e.TipsController.getInstance().showItemTips(n.naturalAward.id,n.naturalAward.value,!1)}e.DragongodTreasureController.getInstance().sendDRAGON_HOARD_AWARD_C(n.naturalValue)},i.prototype.sendmessage=function(t){var i=e.PlayerService.instance.playerInfo.getGold();if(!t&&this.model.freeNnmber>0)return void(t?this.buyten():this.buyone());if(this.model.getdragongodnum()>=(t?10:1))return void(t?this.buyten():this.buyone());if(!this.model.tipbool){var n=this.time>0?Number(e.GlobalConfig.instance.getValue(t?"DRAGON_GOD_TREASURE_TENCONSUME":"DRAGON_GOD_TREASURE_ONECONSUME"))*this.discount:Number(e.GlobalConfig.instance.getValue(t?"DRAGON_GOD_TREASURE_TENCONSUME":"DRAGON_GOD_TREASURE_ONECONSUME"));return void e.PopUpController.getInstance().showTextPanel2(e.LanguageUtils.instance.getValue("DRAGONGODTREASURELOG2",n),this,t?this.buyten:this.buyone,{tipbool:this.model.tipbool})}i<Number(e.GlobalConfig.instance.getValue(t?"DRAGON_GOD_TREASURE_TENCONSUME":"DRAGON_GOD_TREASURE_ONECONSUME"))?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):t?this.buyten():this.buyone()},i.prototype.clickbtn=function(t){switch(t.currentTarget){case this.ui.help:e.HelpController.getInstance().showPanel("LONGSHENBKHELP");break;case this.ui.add_one:this.sendmessage(!1),42==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()));break;case this.ui.add_ten:this.sendmessage(!0);break;case this.ui.addprice:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE);break;case this.ui.warehouse:e.DragongodTreasureController.getInstance().showhoudepanel()}},i.prototype.buyone=function(t){if(void 0===t&&(t=null),t&&(this.model.tipbool=t),this.model.freeNnmber>0||this.model.getdragongodnum()>=1)e.DragongodTreasureController.getInstance().sendOPEN_DRAGON_HOARD_C(!1);else{if(e.PlayerService.instance.playerInfo.getGold()<Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ONECONSUME")))return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");e.DragongodTreasureController.getInstance().sendOPEN_DRAGON_HOARD_C(!1)}},i.prototype.buyten=function(t){if(void 0===t&&(t=null),t&&(this.model.tipbool=t),this.model.getdragongodnum()>=10)e.DragongodTreasureController.getInstance().sendOPEN_DRAGON_HOARD_C(!0);else{if(e.PlayerService.instance.playerInfo.getGold()<Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_TENCONSUME")))return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");e.DragongodTreasureController.getInstance().sendOPEN_DRAGON_HOARD_C(!0)}},i.prototype.setmask=function(t,i){void 0===t&&(t=0),void 0===i&&(i=1e3),i=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ACTIVITY"));var n=t/i,o=n*this.ui.tianyunjindu.height;return o},i.prototype.closeHook=function(){App.TimerManager().remove(this.timeOut,this),this.effAni&&(this.effAni.clear(),this.effAni=null)},i.prototype.refresh=function(){this.ui.redpointxb.visible=e.ActivityBarController.getInstance().refreshSearchTreasureRedPoint(),this.ui.redpointbk.visible=e.DragongodTreasureController.getInstance().redpoint(),e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("TREASURE_OF_ANCIENT_GOD_OPEN_LEVEL"))?(this.ui.group_gushen.visible=!0,this.ui.group_gushen.parent.removeChild(this.ui.group_gushen),this.ui.group_allSelected.addChild(this.ui.group_gushen),this.ui.redpointgt.visible=e.GoldTreasureController.getInstance().redpoint()):this.ui.group_gushen.visible=!1,this.ui.tianyunzhezhao.height=this.setmask(this.model.activity),this.refreshActivity(),this.ui.tianyunnum.text=this.model.activity,this.ui.yuanbao.text=e.GlobalUtil.getUnitString(e.PlayerService.instance.playerInfo.getGold(),2),this.updateRecords();var t=this.model.getdragongodnum();1!=this.discount?this.showDiscount():this.showOriginal(),this.ui.one_itemnum.textFlow=e.GlobalUtil.createMaterialProTextFlow(t,1),this.ui.ten_itemnum.textFlow=e.GlobalUtil.createMaterialProTextFlow(t,10),this.ui.one_tip.visible=1==this.model.freeNnmber,this.ui.ten_tip.text=this.model.addNumber<Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_NUMBER_VALUE"))?"(必得装备)":this.model.activity>=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ACTIVITY"))-10?"(必得至宝)":"",this.ui.redpointone.visible=1==this.model.freeNnmber||e.DragongodTreasureController.getInstance().ondepointred(),this.ui.redpointten.visible=e.DragongodTreasureController.getInstance().tenepointred(),this.ui.redpoint.visible=this.model.dataSource.length>=1},i.prototype.showOriginal=function(){this.ui.one_yuanbao.text=e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ONECONSUME"),this.ui.ten_yuanbao.text=e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_TENCONSUME"),-1!=this.ui.group_one.getChildIndex(this.ui.group_original0)&&this.ui.group_one.removeChild(this.ui.group_original0),-1!=this.ui.group_ten.getChildIndex(this.ui.group_original1)&&this.ui.group_ten.removeChild(this.ui.group_original1),this.ui.group_one.x=this.ui.add_one.x-(this.ui.group_one.width-this.ui.add_one.width)/2,this.ui.group_ten.x=this.ui.add_ten.x-(this.ui.group_ten.width-this.ui.add_ten.width)/2,this.ui.zhekou0.visible=this.saleList[e.SearchTreasureModel.XUNBAO]?!0:!1,this.ui.zhekou1.visible=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?!0:!1,this.ui.zhekou2.visible=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?!0:!1,this.ui.tab_zhe0.text=this.saleList[e.SearchTreasureModel.XUNBAO]?10*this.saleList[e.SearchTreasureModel.XUNBAO].getSaleNumber()+"":"",this.ui.tab_zhe1.text=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?10*this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN].getSaleNumber()+"":"",this.ui.tab_zhe2.text=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?10*this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI].getSaleNumber()+"":"",this.ui.group_zhekou.visible=!1},i.prototype.playAni=function(){this.effAni&&(this.effAni.clear(),this.effAni=null),this.effAni=new e.FoxAni(this.ui.eff_group),this.effAni.play("fx_zhekou","ani",-1)},i.prototype.showDiscount=function(){var t=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ONECONSUME")),i=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_TENCONSUME"));this.ui.one_yuanbao.text=t*this.discount+"",this.ui.txt_discount0.text=t+"",this.ui.ten_yuanbao.text=i*this.discount+"",this.ui.txt_discount1.text=i+"",this.ui.group_one.x=this.ui.add_one.x-(this.ui.group_one.width-this.ui.add_one.width)/2,this.ui.group_ten.x=this.ui.add_ten.x-(this.ui.group_ten.width-this.ui.add_ten.width)/2,this.ui.zhekou0.visible=this.saleList[e.SearchTreasureModel.XUNBAO]?!0:!1,this.ui.zhekou1.visible=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?!0:!1,this.ui.zhekou2.visible=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?!0:!1,this.ui.tab_zhe0.text=this.saleList[e.SearchTreasureModel.XUNBAO]?10*this.saleList[e.SearchTreasureModel.XUNBAO].getSaleNumber()+"":"",this.ui.tab_zhe1.text=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?10*this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN].getSaleNumber()+"":"",this.ui.tab_zhe2.text=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?10*this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI].getSaleNumber()+"":"",this.ui.group_zhekou.visible=!0,this.playAni();var n=10*this.discount+"",o=n.split(".");this.ui.txt_zhekou.text=o.length>1?o[0]+".wz":" "+o[0]+"z",this.time>0&&(this.ui.txt_time.text="折扣剩余时间:"+e.GlobalUtil.secondsToTimeSimple(this.time),App.TimerManager().doTimer(1e3,0,this.timeOut,this))},i.prototype.timeOut=function(){this.time--,this.ui.txt_time.text="折扣剩余时间:"+e.GlobalUtil.secondsToTimeSimple(this.time),this.time<0&&(this.time=0,this.ui.txt_time.text="",this.showOriginal(),e.SearchTreasureController.getInstance().sendTreasureSale(),App.TimerManager().remove(this.timeOut,this))},i.prototype.updateSale=function(){this.saleList=e.SearchTreasureController.getInstance().getmodel().saleList;var t=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN];t?(this.time=Math.floor(t.getDateTimes()/1e3),this.discount=t.getSaleNumber()):(this.time=0,this.discount=1,this.ui.txt_time.text=""),this.refresh()},i.prototype.initParams=function(){},i.prototype.refreshActivity=function(){var t,i=this.model.activityList,n=(this.model.activity,e.JsonDataManager.instance.dragongodTreasureNaturalValueTemplate);for(var o in n)if(this.gethuo1list()[o].visible=!1,t=n[o],this.gethuotxt10()[o].text=t.naturalAward.value,this.gethuotxt()[o].text=t.naturalValue+"点",this.gethuotxt()[o].textColor=13419462,this.model.activity&&this.model.activity>=t.naturalValue&&(this.gethuotxt()[o].text="可领取",this.gethuotxt()[o].textColor=2227971,this.gethuo1list()[o].visible=!0),i)for(var a in i){var s=i[a];s.getNaValue()==t.naturalValue&&1==s.getState()&&(this.gethuotxt()[o].text="已领取",this.gethuotxt()[o].textColor=11447982,this.gethuo1list()[o].visible=!1)}},i.prototype.updateRecords=function(){var t=new egret.HtmlTextParser;this.ui.contentLabel.textFlow=t.parser("");for(var i,n,o,a,s=this.model.recordList.length,r="",l=0;s>l;l++)i=this.model.recordList[l],o=this.getItemTemplate()[i.itemId],n=e.ColorUtils.instance.getColorByQuality(o.quality),a=n.toString(16),r+=e.LanguageUtils.instance.getValue("TREASURERECORD",i.playerId,i.playerName,a,i.itemId,o.name)+"\n";r=this.cleanUpStr(r),this.ui.contentLabel.textFlow=(new egret.HtmlTextParser).parser(r),this.ui.contentLabel.height>this.ui.scroller.height?this.ui.scroller.viewport.scrollV=this.ui.contentLabel.height-this.ui.scroller.height:this.ui.scroller.viewport.scrollV=0},i.prototype.cleanUpStr=function(t){var i=t.split("\n"),n=[],o=i.length,a="",s=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_LOGNUMBER"));if(!(o>s))return t;var r=o-s-1;n=i.splice(r,o);for(var l=0;l<n.length;l++)""!=n[l]&&(a+=n[l]+"\n");return a},i.prototype.linkHandler=function(t){var i=t.text.split("_"),n=i[0],o=Number(i[1]);if("playerId"==n){if(-1==o)return;e.OtherCharacterController.getInstance().showOtherCharacterPanel(o)}else{if("itemId"!=n)throw new Error("examine parameter Error");var a=this.getItemTemplate()[o];a.type==e.ItemType.EQUIP||(a.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(a.id):a.type==e.ItemType.DRAGONBONE||(a.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(a.id,!1):a.type==e.ItemType.SKILLSTONE?e.TipsController.getInstance().showDragonArmorSkillTips(a.id):e.TipsController.getInstance().showItemTips(a.id)))}},i.prototype.clickskip=function(t){switch(t.target){case this.ui.xunbao:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.SEARCHTREASURE),this.close();break;case this.ui.dragongodtreasure:break;case this.ui.goldtreasure:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.GUSHENMIBAO),this.close()}},i.prototype.getitemList=function(){var e=[];return e.push(this.ui.cell0),e.push(this.ui.cell1),e.push(this.ui.cell2),e.push(this.ui.cell3),e.push(this.ui.cell4),e.push(this.ui.cell5),e.push(this.ui.cell6),e.push(this.ui.cell7),e.push(this.ui.cell8),e.push(this.ui.cell9),e.push(this.ui.cell10),e.push(this.ui.cell11),e.push(this.ui.cell12),e},i.prototype.gethuotxt=function(){var e={0:this.ui.huotxt1,1:this.ui.huotxt2,2:this.ui.huotxt3,3:this.ui.huotxt4,4:this.ui.huotxt5};return e},i.prototype.gethuotxt10=function(){var e={0:this.ui.huotxt10,1:this.ui.huotxt6,2:this.ui.huotxt7,3:this.ui.huotxt8,4:this.ui.huotxt9};return e},i.prototype.getlisthuo=function(){var e=[];return e.push(this.ui.huo1btn),e.push(this.ui.huo2btn),e.push(this.ui.huo3btn),e.push(this.ui.huo4btn),e.push(this.ui.huo5btn),e},i.prototype.gethuo1list=function(){var e={0:this.ui.huo1,1:this.ui.huo2,2:this.ui.huo3,3:this.ui.huo4,4:this.ui.huo5};return e},i.prototype.getItemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},i}(e.BasePanel);e.DragongodTreasurePanel=t,__reflect(t.prototype,"foxgame.DragongodTreasurePanel",["foxgame.IDragongod","foxgame.IObserver","foxgame.ISearchTreasure"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragongodtreasure/DragongodTreasureRewardSkin.exml")||this;return i.aniArr=[],i.tenDoneNum=0,i.isTen=!1,i.model=e,i.isMask=!0,i.pointobject={},i}return __extends(i,t),i.prototype.showPage=function(e){this.lastCountType=e,this.getIsShow()?this.refresh():this.show()},i.prototype.initHook=function(){for(var e,t=this.getItemList(),i=t.length,n=0;i>n;n++)e=t[n],this.pointobject[n]={x:e.x,y:e.y},e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);e=t[1],this.model.registerObserver(this),this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)},i.prototype.backHandler=function(){if(this.tw&&(this.tw.pause(),this.tw=null),this.twArr&&this.twArr.length>0){var e=0,t=this.twArr.length;for(e;t>e;e++)this.twArr[e].pause(),this.twArr[e]=null}TweenMax.killTweensOf(this),this.close()},i.prototype.closeHook=function(){},i.prototype.dragongodInfoBack=function(){this.refresh()},i.prototype.tickHook=function(e){},i.prototype.refresh=function(){TweenMax.killTweensOf(this),this.tw=TweenMax.delayedCall(.3,this.delayShow.bind(this)),this.ui.tianyunzhi.text=this.lastCountType?"获得天运值10点":"获得天运值1点",0==this.lastCountType?(this.cost1=1,this.cost2=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_ONECONSUME"))):1==this.lastCountType&&(this.cost1=10,this.cost2=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_TENCONSUME")));var t=e.SearchTreasureController.getInstance().getmodel().saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN],i=t?this.cost2*t.getSaleNumber():this.cost2;this.ui.priceLabel0.text=i+"";var n=this.model.getdragongodnum();this.ui.priceLabel1.textFlow=e.GlobalUtil.createMaterialProTextFlow(n,this.cost1)},i.prototype.delayShow=function(){this.twArr=[];var e,t=this.getItemList(),i=t.length,n=this.model.resultList,o=0;this.tenDoneNum=0;for(var a=0;i>a;a++)if(e=t[a],TweenMax.killTweensOf(e),e.visible=!1,n[a]){e.data=n[a],o=.1*(a+1);var s=TweenMax.delayedCall(o,this.funBack.bind(this),[e,a]);this.twArr.push(s)}},i.prototype.funBack=function(e,t){var i,n,o=0;0!=this.aniArr.length&&this.aniArr[t]&&(i=this.aniArr[t]),this.getAniGroupList()[t]&&(n=this.getAniGroupList()[t]),this.effectLingQu(!0,i,n),o=.03*(t+1),TweenMax.delayedCall(o,this.funBack1.bind(this),[e,t])},i.prototype.funBack1=function(e,t){var i=0;i=this.lastCountType?10:1,this.tenDoneNum<i&&this.tenDoneNum++,e.visible=!0},i.prototype.itemHandler=function(t){var i=this.getItemList(),n=i.indexOf(t.target),o=this.model.resultList,a=o[n],s=e.JsonDataManager.instance.itemTemplate[a.getItmeId()];s.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:s.id}):s.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(s.id):e.TipsController.getInstance().showItemTips(s.id)},i.prototype.effectLingQu=function(t,i,n){return n?(i&&(i.clear(),i=null),void(t&&(i||(i=new e.FoxAni(n),i.play("shilianchou_fx","ani",1),this.aniArr.push(i))))):void console.log(n)},i.prototype.btnClickHandler=function(t){10!=this.tenDoneNum&&this.lastCountType||(1==this.tenDoneNum||this.lastCountType)&&"disabled"!=this.ui.btn.currentState&&e.DragongodTreasureController.getInstance().boolsend(this.lastCountType)},i.prototype.getAniGroupList=function(){var e=[],t=0,i=10;for(t;i>t;t++)e.push(this.ui["aniGroup"+t]);return e},i.prototype.getItemList=function(){for(var e=[],t=0;10>t;t++)e.push(this.ui["item"+t]);return e},i}(e.BasePanel);e.DragongodTreasureRewardSkin=t,__reflect(t.prototype,"foxgame.DragongodTreasureRewardSkin",["foxgame.IDragongod","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/dragongodtreasure/DragongodTreasureWarehouseSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.showHook=function(){this.doScreenAdaptation()},i.prototype.initHook=function(){this.ui.addAll.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addall,this),this.model.registerObserver(this);var t=new eui.TileLayout;t.requestedColumnCount=6,t.paddingLeft=e.ItemIcon.horizontalOver,t.paddingRight=e.ItemIcon.horizontalOver,t.horizontalGap=11,t.verticalGap=10;var i=this.ui.list;i.dataProvider=this.model.collection,i.itemRenderer=e.DragongodBagItem,i.layout=t},i.prototype.dragongodInfoBack=function(){this.refresh()},i.prototype.addall=function(){if(!(this.model.dataSource.length<=0)){var t=e.BagController.getInstance().getFreeCellCount();if(t>this.model.dataSource.length)e.DragongodTreasureController.getInstance().sendNATURAL_VALUE_AWARD_C();else{var i=e.LanguageUtils.instance.getValue("BAGNOTENOUGH");e.PopUpController.getInstance().showTextPanel(i,this,this.rongLianFun)}}},i.prototype.rongLianFun=function(){e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT)},i.prototype.closeHook=function(){},i.prototype.refresh=function(){this.model.dataSource.sort(this.sortdata),this.model.collection.replaceAll(this.model.dataSource)},i.prototype.sortdata=function(e,t){return t.getTypeId()-e.getTypeId()},i.prototype.initParams=function(){},i}(e.BasePanel);e.DragongodTreasureWarehouse=t,__reflect(t.prototype,"foxgame.DragongodTreasureWarehouse",["foxgame.IDragongod","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragongodTreasureItemVO=t,__reflect(t.prototype,"foxgame.DragongodTreasureItemVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.DragongodTreasureNaturalVO=t,__reflect(t.prototype,"foxgame.DragongodTreasureNaturalVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panelTimer=0,this.model=new e.EfficiencyUpModel,this.panel=new e.EfficiencyUpPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){0!=this.panelTimer&&(egret.clearTimeout(this.panelTimer),this.panelTimer=0),this.panel.show(),this.panelTimer=egret.setTimeout(function(){this.panel.closePanel(),this.panelTimer=0},this,2e3)},t.prototype.setModelData=function(e){this.model.setData(e)},t}();e.EfficiencyUpController=t,__reflect(t.prototype,"foxgame.EfficiencyUpController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e.prototype.setData=function(e){this.efficiencyData=e,this.updateView()},e}();e.EfficiencyUpModel=t,__reflect(t.prototype,"foxgame.EfficiencyUpModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this,"resource/skins/fight/EfficiencyUpSkin.exml")||this;return i.model=t,i.isMask=!1,i.isCallHideSceneObjectsWhenClose=!1,i.layer=LayerType.TOPLAYER,i.setIsShowBackBtn(!1),i}return __extends(t,e),t.prototype.updateView=function(){this.refresh()},t.prototype.refresh=function(){if(void 0!=this.model.efficiencyData){var e=this.model.efficiencyData.oldMapInfo,t=this.model.efficiencyData.newMapInfo;if(e&&t){var i,n;i=this.ui.coinBefNumber,n=i.x+i.width,i.text=e.avgCoinPerHour,i.x=n-i.width,i=this.ui.expBefNumber,n=i.x+i.width,i.text=e.avgExpPerHour,i.x=n-i.width,i=this.ui.coinAftNumber,i.text=t.avgCoinPerHour,i=this.ui.expAftNumber,i.text=t.avgExpPerHour}}},t.prototype.initHook=function(){this.model.registerObserver(this),this.doScreenAdaptation()},t.prototype.closePanel=function(){this.close()},t.prototype.closeHook=function(){},t}(e.BasePanel);e.EfficiencyUpPanel=t,__reflect(t.prototype,"foxgame.EfficiencyUpPanel",["foxgame.IOffLineYield","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.itemArray=[],i.iconArray=[],i.isSmelt=!1,i.skinName="AlchemySkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.icon0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.icon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.icon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.icon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.icon4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.oneKeyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.oneKeyHandler,this),this.resolveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resolveHandler,this),this.itemArray=[this.item0,this.item1,this.item2,this.item3,this.item4],this.iconArray=[this.icon0,this.icon1,this.icon2,this.icon3,this.icon4],this.resetItemArray(),this.str_1.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("RECYLEMESSAGE0"));for(var i=0;i<this.itemArray.length;i++)this.itemArray[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickitem,this)},i.prototype.clickitem=function(t){t.target.id>0&&e.TipsController.getInstance().showItemTips(t.target.id,t.target.numberItem,!1)},i.prototype.resetItemArray=function(){for(var e=0;e<this.itemArray.length;e++)this.itemArray[e].setAlchemy(-1)},i.prototype.resetIconArray=function(){for(var e=0;e<this.iconArray.length;e++)this.iconArray[e].setItem(-1)},i.prototype.oneKeyHandler=function(t){if(!this.isSmelt){var i=e.BagController.getInstance().getAllAlchemyItem();this.model.chooseitemArray=[];for(var n=0;5>n;n++){var o=i[n];if(!o)break;if(this.model.chooseitemArray.length>=5)break;for(var a=0;a<o.itemNumber&&!(this.model.chooseitemArray.length>=5);a++)this.model.chooseitemArray.push(new e.AlchemyVO(o.type,o.itemId,o.id,1))}this.refresh()}},i.prototype.resolveHandler=function(t){var i=this;if(this.model.chooseitemArray.length<=0)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("RECYLEMESSAGE1"));if(e.BagController.getInstance().getFreeCellCount()<=0)return void e.GameUtils.MSG_TIP("背包剩余空间不足,请先清理背包");if(!this.isSmelt){this.isSmelt=!0;for(var n=function(t){if(o.model.chooseitemArray[t]){var n=e.JsonDataManager.instance.itemTemplate[o.model.chooseitemArray[t].itemId],a=new eui.Image(n.icon);o.addChild(a),a.x=o.iconArray[t].x,a.y=o.iconArray[t].y,a.width=a.height=68,a.anchorOffsetX=a.width>>1,a.anchorOffsetY=a.height>>1,egret.Tween.get(a,{}).to({x:o.anigroup.x,y:o.anigroup.y,scaleX:.6,scaleY:.6},800).call(function(){a.parent.removeChild(a),a=null,i.playAni()},o)}},o=this,a=0;a<this.model.chooseitemArray.length;a++)n(a)}},i.prototype.playAni=function(){var t=this;return null!=this.fireAni?void this.fireAni.mcObject.gotoAndPlay(0,0):(this.fireAni=new e.FoxAni(this.anigroup),this.fireAni.play("huoyan_lianjin","ani"),void egret.Tween.get(this,{}).wait(1e3).call(function(){e.EquipSmeltController.getInstance().sendALCHEMY_ITME_C(t.model.chooseitemArray)},this))},i.prototype.alchemySuccess=function(t,i){var n=this;if(null!=this.fireAni&&(this.fireAni.clear(),this.fireAni=null),0>=t)return e.GameUtils.MSG_TIP("熔炼失败"),this.resetItemArray(),this.resetIconArray(),this.model.chooseitemArray=[],void(this.isSmelt=!1);var o=e.JsonDataManager.instance.itemTemplate[t],a=new eui.Image(o.icon);this.addChild(a),a.x=this.anigroup.x,a.y=this.anigroup.y,a.width=a.height=68,a.anchorOffsetX=a.width>>1,a.anchorOffsetY=a.height>>1,e.GameUtils.MSG_TIP("熔炼成功,获得:"+o.name),egret.Tween.get(a,{}).wait(1e3).to({x:e.MainBottomControler.instance.getBagPoint().x,y:e.MainBottomControler.instance.getBagPoint().y,scaleX:.6,scaleY:.6},1200).call(function(){a.parent.removeChild(a),a=null,n.model.chooseitemArray=[],n.refresh()},this)},i.prototype.clickicon=function(t){this.isSmelt||e.EquipSmeltController.getInstance().showchoosealchemyPanel(this.iconArray.indexOf(t.target),t.target.id>-1)},i.prototype.refresh=function(){if(null!=this.fireAni&&(this.fireAni.clear(),this.fireAni=null),this.isSmelt=!1,this.cost=0,this.model.chooseitemArray.length<1)return this.resetItemArray(),this.resetIconArray(),void(this.str_2.textFlow=(new egret.HtmlTextParser).parser("<font color=0xeee3c6>总价值:</font><font color=0x21ff03>"+this.cost+"</font>"));for(var t=0;t<this.iconArray.length;t++)if(this.model.chooseitemArray[t]){this.iconArray[t].setAlchemy(this.model.chooseitemArray[t].itemId);var i=e.JsonDataManager.instance.itemTemplate[this.model.chooseitemArray[t].itemId];this.cost+=i.alchemyValue}else this.iconArray[t].setItem(-1);this.str_2.textFlow=(new egret.HtmlTextParser).parser("<font color=0xeee3c6>总价值:</font><font color=0x21ff03>"+this.cost+"</font>"),this.refreshAlchemyReward()},i.prototype.refreshAlchemyReward=function(){var t=[];for(var i in e.JsonDataManager.instance.AlchemyRewardTemplate){var n=e.JsonDataManager.instance.AlchemyRewardTemplate[i];this.cost>=n.minValue&&this.cost<=n.maxValue&&(t=n.openAward)}if(t.length<=0)return void e.GameUtils.MSG_TIP("数值超出预期"+this.cost);for(var i=0;i<this.itemArray.length;i++)this.itemArray[i].playaniAndseticon(t[i].id,t[i].value)},i}(eui.Component);e.AlchemyPanel=t,__reflect(t.prototype,"foxgame.AlchemyPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.openAward=[]}return e}();e.AlchemyRewardVO=t,__reflect(t.prototype,"foxgame.AlchemyRewardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="choosealchemyCellskin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.text.text=String(this.data).split("_")[1]},t}(eui.ItemRenderer);e.ChoosealchemyCell=t,__reflect(t.prototype,"foxgame.ChoosealchemyCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChooseAlchemyItemskin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data;this.itemIcon.setItem(t.itemId,t.itemNumber),this.select.visible=!1},t.prototype.changeSelect=function(e){this.select.visible=e},t}(eui.ItemRenderer);e.ChooseAlchemyItemCell=t,__reflect(t.prototype,"foxgame.ChooseAlchemyItemCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"choosealchemyskin")||this;return i.titleArr=[],i.lasttitle=[],i.lastselect=[],i.selectNow=-1,i.selectNumber=0,i.model=e,i.setIsTouchClose(!0),i.titledata=new eui.ArrayCollection,i.itemdata=new eui.ArrayCollection,i}return __extends(i,t),i.prototype.showPanel=function(e,t){this.isHasItem=t,this.selectNow=e,this.lastselect=[],this.selectNumber=0;for(var i=0;5>i;i++)(null==this.model.chooseitemArray[i]||void 0==this.model.chooseitemArray[i])&&this.selectNumber++;this.show()},i.prototype.initHook=function(){this.ui.up.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.titlelist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.clicktitlelist,this),this.ui.itemlist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.clickitemlist,this),this.ui.add.addEventListener(egret.TouchEvent.TOUCH_TAP,this.additem,this),this.ui.titlelist.dataProvider=this.titledata,this.ui.titlelist.itemRenderer=e.ChoosealchemyCell,this.ui.itemlist.dataProvider=this.itemdata,this.ui.itemlist.itemRenderer=e.ChooseAlchemyItemCell;var t=e.GlobalConfig.instance.getValue("ALCHEMY_SCREEN").split(",");this.titleArr=[],this.lastselect=[];for(var i=0;i<t.length;i++)this.titleArr.push(t[i]);this.lasttitle[0]=t[0],this.titledata.source=this.lasttitle,this.model.AllitemArray=e.BagController.getInstance().getAllAlchemyItem()},i.prototype.showHook=function(){this.model.AllitemArray=e.BagController.getInstance().getAllAlchemyItem()},i.prototype.additem=function(t){if(this.lastselect.length<=0)return void e.GameUtils.MSG_TIP("未选择道具");if(1==this.isHasItem)this.model.chooseitemArray[this.selectNow]=this.itemdata.getItemAt(this.lastselect.shift());else for(var i=0;i<this.itemdata.length;i++)null==this.model.chooseitemArray[i]&&void 0==this.model.chooseitemArray[i]&&this.lastselect.length>0&&(this.model.chooseitemArray[i]=this.itemdata.getItemAt(this.lastselect.shift()));this.close(),this.model.refreshalchemyBack()},i.prototype.clickbtn=function(e){"up"==this.ui.up.currentState?this.ui.up.currentState="down":this.ui.up.currentState="up","up"==this.ui.up.currentState?this.titledata.source=this.titleArr:this.titledata.source=this.lasttitle},i.prototype.clickitemlist=function(e){return-1!=this.lastselect.indexOf(e.itemIndex)?(e.itemRenderer.changeSelect(!1),void this.lastselect.splice(this.lastselect.indexOf(e.itemIndex),1)):this.isHasItem?void(0==this.lastselect.length&&(e.itemRenderer.changeSelect(!0),this.lastselect.push(e.itemIndex))):void(this.lastselect.length<this.selectNumber&&(e.itemRenderer.changeSelect(!0),this.lastselect.push(e.itemIndex)))},i.prototype.clicktitlelist=function(e){this.lasttitle[0]=e.item,this.titledata.source=this.lasttitle,this.ui.up.currentState="down",this.lastselect=[],this.refresh()},i.prototype.refresh=function(){this.itemdata.source=this.getChooseItemArray(this.lasttitle[0])},i.prototype.getChooseItemArray=function(t){var i,n=[];if(-1==Number(t.split("_")[0])){for(var o=0;o<this.model.AllitemArray.length;o++)i=this.model.AllitemArray[o],i.itemNumber-this.queryIsChoice(i)>0&&n.push(new e.AlchemyVO(i.type,i.itemId,i.id,i.itemNumber-this.queryIsChoice(i)));return n}for(var a=e.JsonDataManager.instance.itemTemplate,o=0;o<this.model.AllitemArray.length;o++)i=this.model.AllitemArray[o],a[i.itemId].type==Number(t.split("_")[0])&&i.itemNumber-this.queryIsChoice(i)>0&&n.push(new e.AlchemyVO(i.type,i.itemId,i.id,i.itemNumber-this.queryIsChoice(i)));return n},i.prototype.queryIsChoice=function(e){if(this.model.chooseitemArray.length<=0)return 0;for(var t=0,i=0;i<this.model.chooseitemArray.length;i++)this.model.chooseitemArray[i]&&this.model.chooseitemArray[i].id==e.id&&t++;
return t},i}(e.BasePanel);e.ChoosealchemyPanel=t,__reflect(t.prototype,"foxgame.ChoosealchemyPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="EquipResolveViewSkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.numLabelList=[this.numLabel0,this.numLabel2,this.numLabel1,this.numLabel3,this.numLabel4,this.numLabel5,this.numLabel6];var i=e.GlobalConfig.instance.getValue("RESOLVEMATERIAL").split(","),n=i.length;this.itemIdList=[];for(var o=0;n>o;o++)this.itemIdList.push(Number(i[o]));n=this.itemGroup.numChildren;var a;this.itemList=[];for(var o=0;n>o;o++)a=this.itemGroup.getChildAt(o),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this),this.itemList.push(a);this.oneKeyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.quickHandler,this),this.resolveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resolveHandler,this)},i.prototype.refresh=function(){var t,i;if(this.model.selectViewFlag){this.model.selectViewFlag=!1,t=this.itemList.length;for(var n,o=0,a=0;t>a;a++)if(n=this.itemList[a],!(n.id>0)){if(this.model.selectedEquipList[o]&&this.model.selectedEquipList[o].armourId)n.setItem(this.model.selectedEquipList[o].armourId,e.ItemType.DRAGONARMOR);else{if(i=this.model.selectedEquipList[o],null==i)continue;n.setItem(i.getId())}o++}return this.model.selectedEquipList=[],void this.refreshMaterial()}var s=this.model.resolveEquipList;e.JsonDataManager.instance.itemTemplate;t=this.itemList.length;for(var r,a=0;t>a;a++){r=this.itemList[a];var l=-1;s[a]&&s[a].hasOwnProperty("armourId")?(l=Number(s[a].getArmourId()),r.setItem(l,e.ItemType.DRAGONARMOR)):(i=s[a],null!=i&&(l=i.getId()),r.setItem(l))}this.refreshMaterial()},i.prototype.refreshMaterial=function(){this.numList=[];for(var t=this.numLabelList.length,i=0;t>i;i++)this.numList[i]=0;var n;e.JsonDataManager.instance.itemTemplate;t=this.itemList.length;for(var o,a,s,r,l,h=e.JsonDataManager.instance.equipTemplate,i=0;t>i;i++)if(o=this.itemList[i],o.itemType==e.ItemType.DRAGONARMOR){var c=e.BagController.getInstance().getDragonArmorById(o.id);if(null==c)continue;var u=e.JsonDataManager.instance.dragonArmorTemplate[c.getItemId()];l=u.decompose.length;for(var p=0;l>p;p++)s=u.decompose[p],r=this.itemIdList.indexOf(s.id),-1!=r&&(this.numList[r]+=s.value)}else{if(n=e.BagController.getInstance().getEquipInfoById(o.id),null==n)continue;a=h[n.getEquipId()],l=a.decomposeList.length;for(var p=0;l>p;p++)s=a.decomposeList[p],r=this.itemIdList.indexOf(s.id),-1!=r&&(this.numList[r]+=s.value)}t=this.numLabelList.length;for(var g,i=0;t>i;i++)g=this.numLabelList[i],g.text=this.numList[i]+""},i.prototype.itemClickHandler=function(t){var i=t.currentTarget;i.id>0?(i.setItem(-1),this.refreshMaterial()):e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.RESOLVESELECT)},i.prototype.quickHandler=function(t){this.model.resolveEquipList=e.EquipSmeltController.getInstance().getResolveEquips(),this.refresh()},i.prototype.resolveHandler=function(t){for(var i,n=[],o=[],a=this.itemList.length,s=0;a>s;s++)i=this.itemList[s],i.id>0&&(i.itemType==e.ItemType.DRAGONARMOR?o.push(i.id):n.push(i.id));if(n.length+o.length!=0){var r=e.LanguageUtils.instance.getValue("EQUIPRESOLVEPROMPT");e.PopUpController.getInstance().showTextPanel(r,this,this.confirmBack,{equipList:n,armorList:o})}},i.prototype.confirmBack=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPEquipDecompose");i.setType(e.SmeltOperateType.RESOLVE),i.setOneKey(2),i.setEquipId(t.equipList),i.setArmourId(t.armorList),e.Message.instance.send(e.Code.EQUIP_DECOMPOSE_C,i,!0),this.model.operateFlag=!1},i.prototype.smeltBack=function(){for(var e,t=this.itemList.length,i=0;t>i;i++)e=this.itemList[i],e.id>0},i.prototype.getShowEquips=function(){for(var t,i,n=[],o=this.itemList.length,a=0;o>a;a++)if(t=this.itemList[a],t.itemType!=e.ItemType.DRAGONARMOR)t.id<=0||(i=e.BagController.getInstance().getEquipInfoById(t.id),n.push(i));else{var s=e.BagController.getInstance().getDragonArmorById(Number(t.id));n.push(s)}return n},i.prototype.getFreeCount=function(){for(var e,t=0,i=this.itemList.length,n=0;i>n;n++)e=this.itemList[n],e.id>0||t++;return t},i}(eui.Component);e.EquipResolveView=t,__reflect(t.prototype,"foxgame.EquipResolveView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.SMELT=1]="SMELT",e[e.RESOLVE=2]="RESOLVE"}(t=e.SmeltOperateType||(e.SmeltOperateType={}));var i=function(){function t(){this.model=new e.EquipSmeltModel,this.panel=new e.EquipSmeltPanel(this.model),this.choosealchemyPanel=new e.ChoosealchemyPanel(this.model)}return t.prototype.registerMsg=function(t){t.add(e.Code.EQUIP_DECOMPOSE_S,this),t.add(e.Code.ALCHEMY_ITME_S,this)},t.prototype.showchoosealchemyPanel=function(e,t){this.choosealchemyPanel.showPanel(e,t)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ALCHEMY_ITME_S:this.model.setAlchemySuccess(i);break;case e.Code.EQUIP_DECOMPOSE_S:egret.getTimer()-this.model.timeFlag;this.model.operateFlag=!0,this.model.operateBack(i)}},t.prototype.sendALCHEMY_ITME_C=function(t){if(!(t.length<=0)){for(var i=HawkProtocolManager.newBuilder("JsProto.HPAlchemyItmeReq"),n=[],o=0;o<t.length;o++)if(t[o]){var a=HawkProtocolManager.newBuilder("JsProto.ItmeInfos");a.setId(t[o].id),a.setItmeId(t[o].itemId),a.setType(t[o].type),n.push(a)}i.setItemInfo(n),e.Message.instance.send(e.Code.ALCHEMY_ITME_C,i,!0)}},t.prototype.guideshow=function(){this.panel.guideshow()},t.prototype.showPanel=function(t,i){void 0===t&&(t=e.SmeltViewType.SMELT),void 0===i&&(i=null),this.model.equips=i,this.panel.showPanel(t)},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.getModel=function(){return this.model},t.prototype.getSmeltEquips=function(t){void 0===t&&(t=!0);for(var i,n,o,a,s,r=[e.ProfessionType.PROFESSION1,e.ProfessionType.PROFESSION2,e.ProfessionType.PROFESSION3],l=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.SHOES],h=[],c=r.length,u=l.length,p=0;c>p;p++){a=r[p],n=e.PlayerService.instance.getRoleDataByProfession(a);for(var g=0;u>g;g++)s=l[g],i=null!=n?n.getEquipInfoByPart(s):null,o=null!=i?i.getId():-1,h=h.concat(this.getEquipInfoExceptBestScore(a,s,o,t))}return h.sort(this.sortSmelt),h},t.prototype.sortSmelt=function(t,i){var n=e.JsonDataManager.instance.equipTemplate,o=n[t.getEquipId()],a=n[i.getEquipId()],s=o.partList[0],r=a.partList[0];return o.quality>a.quality?1:o.quality<a.quality?-1:o.level>a.level?1:o.level<a.level?-1:s>r?-1:r>s?1:0},t.prototype.getEquipInfoExceptBestScore=function(t,i,n,o){var a,s,r,l=e.BagController.getInstance().getModel(),h=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.SHOES],c=[],u=l.equipDic;for(var p in u)s=u[p],a=s.equipInfo,r=s.equipVO,r.profession==t&&0!=r.checkPartMatch([i])&&-1!=h.indexOf(r.partList[0])&&r.quality!=e.EquipQuality.RED&&(a.getLockPeriod()>0||c.push(a));c.sort(this.sortEquipByScoreAscending),s=l.equipedDic[n];var g=null!=s?s.equipInfo:null;return o&&(null==g||c.length>0&&g.getScore()<c[c.length-1].getScore())&&c.pop(),c},t.prototype.sortEquipByScoreAscending=function(e,t){return e.getScore()<t.getScore()?-1:e.getScore()>t.getScore()?1:0},t.prototype.getResolveEquips=function(){var t,i,n,o=[e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],a=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],s=e.BagController.getInstance().getModel(),r=[],l=e.JsonDataManager.instance.equipTemplate;for(var h in s.equipDic)t=s.equipDic[h],i=t.equipInfo,i.getLockPeriod()>0||(n=l[i.getEquipId()],(t.itemVO.quality==e.EquipQuality.RED||-1!=o.indexOf(n.partList[0])||-1!=a.indexOf(n.partList[0]))&&"false"!=n.decomposeable&&r.push(i));var c,u;return r.sort(function(e,t){return c=l[e.getEquipId()],u=l[t.getEquipId()],c.partList[0]>u.partList[0]?1:c.partList[0]<u.partList[0]?-1:0}),r=this.getResolveArmor().concat(r)},t.prototype.getResolveArmor=function(){for(var t=e.BagController.getInstance().getArmor(),i=t.length-1;i>=0;i--)1==t[i].getIsLock()&&t.splice(i,1);return t},t.prototype.addEquipInfoToList=function(t){return this.model.selectedEquipList.length==this.model.freeCount?(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTNOFREECOUNT")),!1):(this.model.selectedEquipList.push(t),!0)},t.prototype.removeEquipInfoFromList=function(e){var t=this.model.selectedEquipList.indexOf(e);-1!=t&&this.model.selectedEquipList.splice(t,1)},t.prototype.checkAddedToSelected=function(e){return-1!=this.model.selectedEquipList.indexOf(e)},t}();e.EquipSmeltController=i,__reflect(i.prototype,"foxgame.EquipSmeltController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.id=-1,i.itemType=e.ItemType.NORMAL,i.numberItem=0,i.skinName="EquipSmeltItemSkin",i}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.touchChildren=!1,this.aniGroup.visible=!1},i.prototype.setItem=function(t,i,n,o){switch(void 0===i&&(i=e.ItemType.NORMAL),void 0===n&&(n=1),void 0===o&&(o=!0),this.id=t,this.itemType=i,this.addImg.source="soul_daijiahaozhuangbeikuang1_png",this.itemIcon.setItem(-1),i){case e.ItemType.DRAGONARMOR:var a=e.BagController.getInstance().getDragonArmorById(t);null!=a&&(this.addImg.source="",this.itemIcon.setItem(a.getItemId(),n,o));break;default:var s=e.BagController.getInstance().getEquipInfoById(t);null!=s&&(this.addImg.source="",this.itemIcon.setItem(s.getEquipId(),n,o))}},i.prototype.setAlchemy=function(e){this.id=e,this.addImg.source=-1==e?"lianjin_wenhao_png":"",this.itemIcon.setItem(e,0,!1),this.anim&&(this.anim.clear(),this.anim=null)},i.prototype.playaniAndseticon=function(t,i){var n=this;this.numberItem=i,this.id=t,this.anim&&(this.anim.clear(),this.anim=null),this.aniGroup.visible=!0,this.anim||(this.anim=new e.FoxAni(this.aniGroup),this.anim.scaleX=this.anim.scaleY=.9,this.anim.setPlayComplete(function(){n.itemIcon.setItem(t,i,!0),n.addImg.source=""},this)),this.anim.play("soulRefine","ani",1)},i.prototype.playAnimation=function(){return this.aniGroup.visible=!0,this.anim&&1==this.aniGroup.visible?(this.anim.mcObject.addEventListener(egret.Event.COMPLETE,this.animComplete,this),this.anim.mcObject.visible=!0,void this.anim.mcObject.gotoAndPlay(0,1)):(this.anim||(this.anim=new e.FoxAni(this.aniGroup),this.anim.scaleX=this.anim.scaleY=.9,this.anim.setPlayComplete(this.animComplete,this)),void this.anim.play("soulRefine","ani",1))},i.prototype.animComplete=function(){this.aniGroup.visible=!1,this.anim.mcObject.visible=!1},i}(eui.Component);e.EquipSmeltItem=t,__reflect(t.prototype,"foxgame.EquipSmeltItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.selectedEquipIndexList=[],this.freeCount=0,this.chooseitemArray=[],this.AllitemArray=[],this.smeltEquipList=[],this.resolveEquipList=[],this.selectEquipList=[],this.selectedEquipList=[],this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.resetSmeltQuality=function(){var t=e.GlobalConfig.instance.getValue("SMELTSELECT"),i=t.split(",");this.qualityList=[];for(var n,o=i.length,a=0;o>a;a++)n=Number(i[a]),this.qualityList.push(n)},t.prototype.operateBack=function(e){for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.smeltBack(e.getType())},t.prototype.refreshalchemyBack=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.alchemyback()},t.prototype.setAlchemySuccess=function(t){if(0!=t.getErrorNo())return void e.GameUtils.MSG_TIP(e.JsonDataManager.instance.errorCode[t.getErrorNo()]);this.AllitemArray=e.BagController.getInstance().getAllAlchemyItem();for(var i,n=this.observerList.length,o=0;n>o;o++)i=this.observerList[o],i.getIsShow()&&i.alchemySuccessback(t.getItemId(),t.getQuantity())},t}();e.EquipSmeltModel=t,__reflect(t.prototype,"foxgame.EquipSmeltModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.SMELT=1]="SMELT",e[e.SELECT=2]="SELECT",e[e.RESOLVE=3]="RESOLVE",e[e.RESOLVESELECT=4]="RESOLVESELECT",e[e.ALCHEMY=5]="ALCHEMY"}(t=e.SmeltViewType||(e.SmeltViewType={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/equipFurnace/EquipSmeltSkin.exml","equipFurnaceGroup",!1)||this;return t.model=e,t.isMaskdown=!0,t.model.registerObserver(t),t.isMask=!1,t.isMaskdown=!0,t.adaptionType=1,t}return __extends(n,i),n.prototype.initHook=function(){this.ui.resolveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.smeltBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.Alchemy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.doScreenAdaptation(),e.Global.isAppStoreReview&&(this.ui.resolveBtn.visible=!1)},n.prototype.showPanel=function(e){this.getIsShow()?this.changeView(e):(this.model.curTabType=e,this.show())},n.prototype.initParams=function(){this.model.resetSmeltQuality(),this.model.resolveEquipList=[],this.model.operateFlag=!0,this.changeView(this.model.curTabType)},n.prototype.refresh=function(){switch(this.ui.currency.refresh(),this.ui.smeltImg.visible=!1,this.ui.resolveImg.visible=!1,this.ui.AlchemyImg.visible=!1,this.ui.smeltBtn.currentState="up",this.ui.resolveBtn.currentState="up",this.ui.Alchemy.currentState="up",this.model.curTabType){case t.SMELT:this.smeltView.refresh(),this.ui.smeltImg.visible=!0,this.ui.smeltBtn.currentState="down";break;case t.SELECT:this.ui.smeltImg.visible=!0,this.selectView.refresh();break;case t.RESOLVESELECT:this.ui.resolveImg.visible=!0,this.selectView.refresh();break;case t.RESOLVE:this.resolveView.refresh(),this.ui.resolveImg.visible=!0,this.ui.resolveBtn.currentState="down";break;case t.ALCHEMY:this.AlchemyView.refresh(),this.ui.AlchemyImg.visible=!0,this.ui.Alchemy.currentState="down"}},n.prototype.alchemyback=function(){this.refresh()},n.prototype.alchemySuccessback=function(e,i){this.model.curTabType==t.ALCHEMY&&this.AlchemyView.alchemySuccess(e,i),this.ui.currency.refresh()},n.prototype.smeltBack=function(t){t==e.SmeltOperateType.SMELT?(this.model.smeltEquipList=e.EquipSmeltController.getInstance().getSmeltEquips(),this.smeltView.smeltBack()):t==e.SmeltOperateType.RESOLVE&&(this.model.resolveEquipList=e.EquipSmeltController.getInstance().getResolveEquips(),this.resolveView.smeltBack()),this.refresh()},n.prototype.tabHandler=function(e){var i;switch(e.currentTarget){case this.ui.smeltBtn:this.model.curTabType==t.RESOLVESELECT&&(this.model.selectedEquipList=[]),i=t.SMELT;break;case this.ui.resolveBtn:this.model.curTabType==t.SELECT&&(this.model.selectedEquipList=[]),i=t.RESOLVE;break;case this.ui.Alchemy:i=t.ALCHEMY}this.model.equips=null,this.changeView(i)},n.prototype.changeView=function(i){this.model.lastTabType=this.model.curTabType,this.model.curTabType=i;var n=this.ui.viewGroup;n.removeChildren(),this.model.curTabType==t.SMELT?(null==this.smeltView&&(this.smeltView=new e.EquipSmeltView(this.model)),this.smeltView.restBtnStatus(),n.addChild(this.smeltView),this.model.smeltEquipList=e.EquipSmeltController.getInstance().getSmeltEquips()):this.model.curTabType==t.SELECT||this.model.curTabType==t.RESOLVESELECT?(null==this.selectView&&(this.selectView=new e.EquipSmeltSelectView(this.model)),n.addChild(this.selectView),this.model.selectEquipList=this.setSelectEquipList(),this.model.freeCount=this.getFreeCount(),this.model.selectViewFlag=!0):this.model.curTabType==t.RESOLVE?(null==this.resolveView&&(this.resolveView=new e.EquipResolveView(this.model)),n.addChild(this.resolveView),this.model.resolveEquipList=[]):this.model.curTabType==t.ALCHEMY&&(null==this.AlchemyView&&(this.AlchemyView=new e.AlchemyPanel(this.model)),this.model.chooseitemArray=[],n.addChild(this.AlchemyView)),this.refresh()},n.prototype.getFreeCount=function(){return this.model.lastTabType==t.SMELT?this.smeltView.getFreeCount():this.model.lastTabType==t.RESOLVE?this.resolveView.getFreeCount():void 0},n.prototype.setSelectEquipList=function(){var i,n,o=[];this.model.lastTabType==t.SMELT?(n=e.EquipSmeltController.getInstance().getSmeltEquips(!1),i=this.smeltView.getShowEquips()):this.model.lastTabType==t.RESOLVE&&(n=e.EquipSmeltController.getInstance().getResolveEquips(),i=this.resolveView.getShowEquips());for(var a,s,r,l=n.length,h=i.length,c=0;l>c;c++){r=!1,a=n[c];for(var u=0;h>u;u++){s=i[u];var p=-1,g=-1;if(p=a&&a.armourId||a instanceof Buffer.DragonArmourInfo?a.armourId?a.armourId:a.getArmourId():a.getId(),g=s&&s instanceof Buffer.DragonArmourInfo||s.armourId?s instanceof Buffer.DragonArmourInfo?s.getArmourId():s.armourId:s.getId(),p==g){r=!0;break}}r||o.push(a)}return o},n.prototype.helpHandler=function(i){var n;n=this.model.curTabType==t.RESOLVE?"DECOMPOSITIONHELP":this.model.curTabType==t.ALCHEMY?"RECYCLEHELP":"SMELTINGHELP",e.HelpController.getInstance().showPanel(n)},n.prototype.readyDestroy=function(){this.ui.viewGroup.removeChildren(),this.smeltView=null,this.selectView=null,this.resolveView=null,this.model&&(this.model.operateFlag=!0)},n.prototype.guideshow=function(){if(App.GuideUtils().currPart==e.GuidePart.currPart4&&1==App.GuideUtils().currStep){var t=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart4,2,!1)}if(App.GuideUtils().currPart==e.GuidePart.currPart11&&1==App.GuideUtils().currStep){var t=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart11,2,!1)}},n.prototype.closeHook=function(){App.GuideUtils().isShow&&App.GuideUtils().hide(),App.GuideUtils().currPart==e.GuidePart.currPart4&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart11&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),this.model.curTabType=-1},n}(e.BasePanel);e.EquipSmeltPanel=i,__reflect(i.prototype,"foxgame.EquipSmeltPanel",["foxgame.IEquipSmelt","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ChangeEquipItemSkin",e.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.checkBoxHandler,e),e.baseLabelList=[e.baseLabel1,e.baseLabel2,e.baseLabel3,e.baseLabel4],e.jipinLabelList=[e.jipinLabel1,e.jipinLabel2,e.jipinLabel3,e.jipinLabel4],e.equipedImg.visible=!1,e.recommendImg.visible=!1,e.selectBtn.visible=!1,e}return __extends(i,t),i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),null!=this.data.armourId&&void 0!=this.data.armourId)return void this.refreshArmorUI();var i=this.data,n=e.JsonDataManager.instance.itemTemplate[i.getEquipId()];this.item.setItem(n.id),this.nameLabel.text=n.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(n.quality),this.scoreLabel.text=i.getScore()+"";var o=e.JsonDataManager.instance.equipTemplate[n.id],a=e.JsonDataManager.instance.godlyEquipTemplate,s=a[o.id];null!=s?this.scoreLabel.text=s.getScore().toString():this.scoreLabel.text=i.getScore().toString(),this.refreshAttrs(1,this.baseLabelList);var r=this.refreshAttrs(2,this.jipinLabelList);r?(this.jipinGroup.visible=!0,this.baseGroup.y=0):(this.jipinGroup.visible=!1,this.baseGroup.y=this.labelGroup.height-this.baseGroup.height>>1),this.checkBoxBtn.selected=e.EquipSmeltController.getInstance().checkAddedToSelected(i)},i.prototype.refreshArmorUI=function(){var t=e.JsonDataManager.instance.itemTemplate[this.data.itemId],i=e.JsonDataManager.instance.dragonArmorTemplate[this.data.itemId],n=e.BagController.getInstance().getDragonArmorById(this.data.armourId);this.item.setItem(t.id),this.nameLabel.text=t.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(t.quality),this.scoreLabel.text=e.DragonArmorController.getInstance().getDragonEquipScore(n)+"";var o=!1;o?(this.jipinGroup.visible=!0,this.baseGroup.y=0):(this.jipinGroup.visible=!1,this.baseGroup.y=this.labelGroup.height-this.baseGroup.height>>1),this.checkBoxBtn.selected=e.EquipSmeltController.getInstance().checkAddedToSelected(n),this.baseLabelList[0].text=e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[0])+":"+e.GlobalUtil.getAttrValueStr(i.attrTypeList[0],i.attrValueList[0]),this.baseLabelList[2].text=e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[1])+":"+e.GlobalUtil.getAttrValueStr(i.attrTypeList[1],i.attrValueList[1]),this.baseLabelList[1].text=this.baseLabelList[3].text=""},i.prototype.refreshAttrs=function(t,i){for(var n,o=this.data,a=o.getAttrInfos(),s=[],r=0;r<a.length;r++)n=a[r],n.getAttrGrade()==e.equipAttrGrade.PRIMARY_ATTR&&1==t?s.push(n):n.getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&2==t&&s.push(n);for(var l,h,c,u,p=2==t&&s.length>0,g=i.length,r=0;g>r;r++)l=i[r],n=s[r],n?(h=n.getAttrData(),u=e.ColorUtils.instance.getAttrColorById(h.getAttrId()),c=e.LanguageUtils.instance.getValue("ATT_"+h.getAttrId())+":",l.text=c+e.GlobalUtil.getAttrValueStr(h.getAttrId(),h.getAttrValue()),0!=h.getAdditionValue()&&(l.text+="+"+h.getAdditionValue()),l.textColor=u,l.visible=!0):l.visible=!1;return p},i.prototype.checkBoxHandler=function(t){var i=t.currentTarget;if(0==i.selected)return e.EquipSmeltController.getInstance().removeEquipInfoFromList(this.data),void(i.selected=!1);var n=e.EquipSmeltController.getInstance().addEquipInfoToList(this.data);i.selected=n},i}(eui.ItemRenderer);e.EquipSmeltSelectItem=t,__reflect(t.prototype,"foxgame.EquipSmeltSelectItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="EquipSmeltSelectViewSkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.dataSource=[],this.collection=new eui.ArrayCollection,this.list.dataProvider=this.collection,this.list.itemRenderer=e.EquipSmeltSelectItem,this.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.submitHandler,this)},i.prototype.refresh=function(){this.scroller.viewport.scrollV=0,this.collection.replaceAll(this.model.selectEquipList)},i.prototype.submitHandler=function(t){e.EquipSmeltController.getInstance().showPanel(this.model.lastTabType)},i}(eui.Component);e.EquipSmeltSelectView=t,__reflect(t.prototype,"foxgame.EquipSmeltSelectView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.lastSmeltTimestamp=0,i.skinName="EquipSmeltViewSkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList=[];for(var i,n=this.itemGroup.numChildren,o=0;n>o;o++)i=this.itemGroup.getChildAt(o),this.itemList.push(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.checkBoxList=[this.checkBoxBtn_1,this.checkBoxBtn_2,this.checkBoxBtn_3,this.checkBoxBtn_4,this.checkBoxBtn_5],n=this.checkBoxList.length;for(var a,o=0;n>o;o++)a=this.checkBoxList[o],a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkBoxHandler,this);this.smeltBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.smeltHandler,this),this.oneKeySmeltBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.quickSmeltHandler,this),this.attrShow.textFlow=(new egret.HtmlTextParser).parse(e.LanguageUtils.instance.getValue("RONG_LIAN_TIP")),this.autoBreakLabel.text="v"+e.GlobalConfig.instance.getValue("OFFLINE_AUTO_SMELT_VIP_LIMIT")},i.prototype.restBtnStatus=function(){this.smeltBtn.enabled=!0,this.oneKeySmeltBtn.enabled=!0},i.prototype.guide=function(){App.GuideUtils().currPart==e.GuidePart.currPart4&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.smeltBtn,this.group,e.GuidePart.currPart4,1),App.GuideUtils().currPart==e.GuidePart.currPart11&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.smeltBtn,this.group,e.GuidePart.currPart11,1)},i.prototype.refresh=function(){this.guide();var t,i;if(this.model.selectViewFlag){this.model.selectViewFlag=!1,t=this.itemList.length;for(var n,o=0,a=0;t>a;a++)if(n=this.itemList[a],!(n.id>0)){if(this.model.selectedEquipList[o]instanceof Buffer.DragonArmourInfo)n.setItem(this.model.selectedEquipList[o].getArmourId(),e.ItemType.DRAGONARMOR);else{if(i=this.model.selectedEquipList[o],null==i)continue;n.setItem(i.getId())}o++}return void(this.model.selectedEquipList=[])}this.refreshQualitySelect();var s,r=this.model.smeltEquipList,l=[],h=e.JsonDataManager.instance.itemTemplate;t=r.length;for(var a=0;t>a;a++)i=r[a],s=h[i.getEquipId()],this.checkQuality(s.quality)&&l.push(i);t=this.itemList.length;for(var c,a=0;t>a;a++)c=this.itemList[a],i=l[a],null!=i?c.setItem(i.getId()):c.setItem(-1)},i.prototype.checkQuality=function(e){return-1!=this.model.qualityList.indexOf(e)},i.prototype.itemClickHandler=function(t){var i=t.currentTarget;i.id>0?i.setItem(-1):e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SELECT)},i.prototype.checkBoxHandler=function(e){var t,i=(this.checkBoxList,this.checkBoxList.length);this.model.qualityList=[];for(var n=0;i>n;n++)t=this.checkBoxList[n],t.selected&&this.model.qualityList.push(n+1);this.refresh()},i.prototype.smeltHandler=function(t){var i=egret.getTimer(),n=i-this.lastSmeltTimestamp;if(!(300>n)&&(this.lastSmeltTimestamp=i,0!=this.model.operateFlag)){for(var o,a=[],s=this.itemList.length,r=0;s>r;)o=this.itemList[r],o.id>0&&a.push(o.id),r+=1;if(0==a.length)return void(this.smeltBtn.enabled=!0);var l=HawkProtocolManager.newBuilder("JsProto.HPEquipDecompose");l.setType(e.SmeltOperateType.SMELT),l.setOneKey(2),l.setEquipId(a),this.model.operateFlag=!1,e.Message.instance.send(e.Code.EQUIP_DECOMPOSE_C,l,!0),this.model.timeFlag=egret.getTimer(),App.SoundManager().playEffect("sound_ronglianItem_mp3"),e.EquipSmeltController.getInstance().guideshow()}},i.prototype.quickSmeltHandler=function(t){var i=Number(e.GlobalConfig.instance.getValue("EQUIP_DECOMPOSE_ONE_KEY_VIP_LEVEL"));if(e.PlayerService.instance.vipLevel<i)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("QUICKSMELTUNOPEN",i)),void(this.oneKeySmeltBtn.enabled=!0);for(var n,o,a=[],s=this.model.smeltEquipList,r=e.JsonDataManager.instance.itemTemplate,l=s.length,h=0;l>h;)n=s[h],o=r[n.getEquipId()],this.checkQuality(o.quality)&&a.push(n.getId()),h+=1;if(0==a.length)return void(this.oneKeySmeltBtn.enabled=!0);var c=HawkProtocolManager.newBuilder("JsProto.HPEquipDecompose");c.setType(e.SmeltOperateType.SMELT),c.setOneKey(1),c.setEquipId(a),e.Message.instance.send(e.Code.EQUIP_DECOMPOSE_C,c,!0),App.SoundManager().playEffect("sound_ronglianItem_mp3"),this.model.operateFlag=!1},i.prototype.smeltBack=function(){this.smeltBtn.enabled=!0,this.oneKeySmeltBtn.enabled=!0;for(var e,t=this.itemList.length,i=0;t>i;i++)e=this.itemList[i],e.id>0&&e.playAnimation()},i.prototype.refreshQualitySelect=function(){for(var e,t=this.checkBoxList.length,i=0;t>i;i++)e=this.checkBoxList[i],e.selected=!1;var n,o=this.model.qualityList;t=o.length;for(var i=0;t>i;i++)n=o[i],e=this.checkBoxList[n-1],e.selected=!0},i.prototype.getShowEquips=function(){for(var t,i,n=[],o=this.itemList.length,a=0;o>a;a++)t=this.itemList[a],t.id<=0||(i=e.BagController.getInstance().getEquipInfoById(t.id),n.push(i));return n},i.prototype.getFreeCount=function(){for(var e,t=0,i=this.itemList.length,n=0;i>n;n++)e=this.itemList[n],e.id>0||t++;return t},i}(eui.Component);e.EquipSmeltView=t,__reflect(t.prototype,"foxgame.EquipSmeltView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.previosTime=0,this.isOpen=!1,this.isFactionbattle=!1,this.isFactionMap=!1,this.model=new e.FactionBattleModel,this.panel=new e.FactionBattlePanel(this.model),this.mapPanel=new e.FactionBattleMapPanel(this.model),this.battleLogPanel=new e.FactionBattleLog(this.model),this.checkFactionPanel=new e.CheckFactionPanel(this.model),this.battleExpBoxPanel=new e.BattleExpTreasureBox(this.model),this.achievRank=new e.BattleAchieveRanking(this.model),this.fightPointPanel=new e.FactionFightingPointPanel(this.model),this.battleLoading=new e.FactionBattlePKLoading(this.CSBattlebackFun.bind(this)),this.factionSettlement=new e.FactionSettlement(this.model),this.battleSettlement=new e.BattleSettlement(this.model)}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.getModel=function(){return this.model},t.prototype.registerMsg=function(t){t.add(e.Code.TIME_PLAY_METHOD_PUSH,this),t.add(e.Code.CAMP_INFO_S,this),t.add(e.Code.CAMP_SIGN_UP_S,this),t.add(e.Code.CAMP_ENTER_S,this),t.add(e.Code.CAMP_LOG_S,this),t.add(e.Code.CAMP_OURS_S,this),t.add(e.Code.CAMP_GARRISON_S,this),t.add(e.Code.CAMP_CHALLENGE_S,this),t.add(e.Code.CAMP_OPEN_TREASURE_S,this),t.add(e.Code.CAMP_BATTLE_ACHIEVEMENT_S,this),t.add(e.Code.CAMP_STRONG_POINT_S,this),t.add(e.Code.CAMP_TREASURE_INFO_S,this),t.add(e.Code.CAMP_BATTLE_RESULT_S,this),t.add(e.Code.CAMP_LEAVE_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.TIME_PLAY_METHOD_PUSH:this.setCampPlaceTime(i);break;case e.Code.CAMP_INFO_S:this.model.setCampInfo(i);break;case e.Code.CAMP_SIGN_UP_S:this.model.setCampSignUpInfo(i);break;case e.Code.CAMP_ENTER_S:this.model.setEnterCampBattleInfo(i);break;case e.Code.CAMP_LOG_S:this.model.setCampbattleLogInfo(i);break;case e.Code.CAMP_OURS_S:this.model.setOthersInfo(i);break;case e.Code.CAMP_GARRISON_S:this.model.setGarrisonInfo(i);break;case e.Code.CAMP_CHALLENGE_S:this.model.setChallengeEnemyInfo(i);break;case e.Code.CAMP_OPEN_TREASURE_S:this.model.setOpenTreasureInfo(i);break;case e.Code.CAMP_BATTLE_ACHIEVEMENT_S:this.model.setCampBattleAchievement(i);break;case e.Code.CAMP_STRONG_POINT_S:this.model.setCampStrongPointInfo(i);break;case e.Code.CAMP_TREASURE_INFO_S:this.model.setCampTreasureInfo(i);break;case e.Code.CAMP_BATTLE_RESULT_S:this.model.setCampBattleResult(i);break;case e.Code.CAMP_LEAVE_S:this.model.setCampLeave(i)}},t.prototype.showPanel=function(){var t=Number(e.GlobalConfig.instance.getValue("CS_CAMP_LEVEL_LIMIT"));return e.PlayerService.instance.level>=t?(this.sendmessageFactionInfo(),void this.panel.show()):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPBATTLELEVELLIMIT",t))},t.prototype.CSBattlebackFun=function(){e.BattleService.instance.battle_info(this.model.battleInfo)},t.prototype.CSChallenge=function(){this.mapPanel.getIsShow()&&this.mapPanel.close();for(var t=this.model.observerList.length,i=0;t>i;i++)this.model.observerList[i].getIsShow()&&this.model.observerList[i].close();this.isFactionMap=!0,this.isFactionbattle=!0,e.MainControler.instance.mainOrBattleState(!1),this.showFactionPanel(factionPanelType.battleLoading)},t.prototype.showFactionPanel=function(e){void 0===e&&(e=null);for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(e)switch(e){case factionPanelType.mapPanel:this.mapPanel.show(),this.isFactionMap=!0;break;case factionPanelType.battleLog:this.battleLogPanel.show();break;case factionPanelType.battleExpBox:this.battleExpBoxPanel.show();break;case factionPanelType.checkFaction:this.checkFactionPanel.show();break;case factionPanelType.achieveRank:this.achievRank.show();break;case factionPanelType.fightCity:this.fightPointPanel.show();break;case factionPanelType.battleLoading:this.battleLoading.show();break;case factionPanelType.factionSettlement:this.factionSettlement.show()}},t.prototype.showBattleResultPanel=function(e){this.battleSettlement.showSettlement(e),this.mapPanel.visible=!0},t.prototype.setCampPlaceTime=function(t){t.getPlayType()==e.TimePlayMethodType.CS_CAMP&&(egret.stopTick(this.tick,this),this.isOpen=t.getOpen(),this.isOpen?(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.CAMPBATTLE,!0),e.ActivityBarController.getInstance().setCampbattleRedPoint(!this.model.factionIsSignUp&&!this.model.factionIsBattleTime),this.model.campRemainingTime=t.getRemainingTime(),this.model.campRemainingTime>0&&(e.ActivityBarController.getInstance().setCampbattleEffect(!0),egret.startTick(this.tick,this))):(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.CAMPBATTLE,!1),egret.stopTick(this.tick,this),this.model.campRemainingTime=0))
},t.prototype.tick=function(e){return e-this.previosTime>=1e3&&(this.previosTime=e,this.model.campRemainingTime-=1e3,Math.ceil(this.model.campRemainingTime/1e3)<=0&&egret.stopTick(this.tick,this)),!1},t.prototype.getCampRemainingTime=function(){return this.model.campRemainingTime},t.prototype.getCampIsopen=function(){return this.isOpen},t.prototype.sendmessageFactionInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.CampInfoReq");e.Message.instance.send(e.Code.CAMP_INFO_C,t,!0)},t.prototype.sendmessageFactionSignUp=function(){var t=HawkProtocolManager.newBuilder("JsProto.CampSignUpReq");e.Message.instance.send(e.Code.CAMP_SIGN_UP_C,t,!0)},t.prototype.sendmessageEnterBattle=function(){var t=HawkProtocolManager.newBuilder("JsProto.EnterWorldBossReq");e.Message.instance.send(e.Code.CAMP_ENTER_C,t,!0)},t.prototype.sendmessageCampLog=function(){var t=HawkProtocolManager.newBuilder("JsProto.CampBattleLogReq");e.Message.instance.send(e.Code.CAMP_LOG_C,t,!0)},t.prototype.sendmessageOthersInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.CampOursInfoReq");e.Message.instance.send(e.Code.CAMP_OURS_C,t,!0)},t.prototype.sendmessageBoxListInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.CampTreasureInfoReq");e.Message.instance.send(e.Code.CAMP_TREASURE_INFO_C,t,!0)},t.prototype.sendmessageGarrison=function(t){var i=HawkProtocolManager.newBuilder("JsProto.CampStrongPointGarrisonReq");i.setStrongPointId(t),e.Message.instance.send(e.Code.CAMP_GARRISON_C,i,!0)},t.prototype.sendmessageChallengeEnemy=function(t){var i=HawkProtocolManager.newBuilder("JsProto.CampChallengeEnemyReq");i.setPlayerIdentify(t),e.Message.instance.send(e.Code.CAMP_CHALLENGE_C,i,!0)},t.prototype.sendmessageOpenTreasure=function(t){var i=HawkProtocolManager.newBuilder("JsProto.CampOpenTreasureReq");i.setIndex(t),e.Message.instance.send(e.Code.CAMP_OPEN_TREASURE_C,i,!0)},t.prototype.sendmessageLeaveCamp=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSCampLeaveReq");e.Message.instance.send(e.Code.CAMP_LEAVE_C,t,!0)},t.prototype.setMessageArr=function(e){-1==this.model.msgArr.indexOf(e)&&this.model.msgArr.push(e)},t.prototype.clearMessageArr=function(){this.model.msgArr=[]},t.prototype.setMessageRedPoint=function(){this.mapPanel.setMapBottom()},t.prototype.getPlayerCampType=function(){return this.model.myfactionType},t.prototype.getPlayerIdentify=function(){return this.model.playerIdentify},t.prototype.getBoxList=function(){var t=e.GlobalConfig.instance.getValue("CS_CAMP_BA_TREASURE"),i=t.split(",");return i},t.prototype.setPlayerPointId=function(e){this.model.playerPointId=e},t.prototype.setPlayerState=function(e){this.model.playerState=e},t.prototype.getPlayerState=function(){return this.model.playerState},t.prototype.getPlayerPointId=function(){return this.model.playerPointId},t.prototype.getCampItemDict=function(){return this.model.CampItemDict},t.prototype.getSelectedPointId=function(){return this.model.curSelectedPointId},t}();e.FactionBattleController=t,__reflect(t.prototype,"foxgame.FactionBattleController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isFirstEnter=!0,this.isCloudEnter=!1,this.factionIsSignTime=!1,this.factionIsBattleTime=!1,this.msgArr=[],this.boxOpenTimes=0,this.observerList=[],this.isFirstEnter=!0,this.CampItemDict={},this.strongPointList=[],this.changedStrongPointList=[],this.campMemberInfo=[],this.factionPlayersCollection=new eui.ArrayCollection,this.factionPlayersCollection.source=this.campMemberInfo,this.factionRankAwardSource=[],this.factionRankAwardCollection=new eui.ArrayCollection,this.factionRankAwardCollection.source=this.factionRankAwardSource,this.campBattleLogSource=[],this.campPlayerLogSource=[],this.campBattleLogCollection=new eui.ArrayCollection,this.achieveRankingSource=[],this.achieveRankingCollecton=new eui.ArrayCollection,this.achieveRankingCollecton.source=this.achieveRankingSource,this.expBoxsSource=[],this.expBoxsCollection=new eui.ArrayCollection,this.expBoxsCollection.source=this.expBoxsSource,this.boxOpenList=[],this.playerPointSource=[],this.playerPointCollecton=new eui.ArrayCollection,this.playerPointCollecton.source=this.playerPointSource,this.enemyPointSource=[],this.enemyPointCollecton=new eui.ArrayCollection,this.enemyPointCollecton.source=this.enemyPointSource}return t.prototype.getBattleMaxLastTime=function(){return Number(e.GlobalConfig.instance.getValue("CS_CAMP_TIME").split(",")[3])},t.prototype.initParams=function(){this.campStrongpointTemplate=e.JsonDataManager.instance.campStrongpointTemplate,this.campSourceTemplate=e.JsonDataManager.instance.campSourceInfoTemplate,this.factionRankAwardSource=e.JsonDataManager.instance.campRankAwardTemplate;var t=Number(e.GlobalConfig.instance.getValue("CS_CAMP_BA_SHULIANG"));this.expBoxsSource=[];for(var i=0;t>i;i++){var n=new CampTreasureVO;n.index=i,this.expBoxsSource.push(n)}},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.operateBack=function(e){for(var t,i=this.observerList.length,n=0;i>n;n++)if(t=this.observerList[n],t.getIsShow())if(e)for(var o=0;o<e.length;o++)t.type==e[o]&&t.panelChange();else t.panelChange()},t.prototype.setCampInfo=function(e){this.factionInfo=e,this.factionIsSignUp=e.getSignUp();var t=e.getSysTime();this.factionIsSignTime=e.getSignUpBeginTime()<=t&&t<=e.getOpenTime();var i=this.getBattleMaxLastTime();this.factionIsBattleTime=!0,this.factionIsBattleTime=e.getOpenTime()<=t&&t<=Number(e.getOpenTime())+Number(i),this.operateBack()},t.prototype.getCampInfo=function(){return this.factionInfo},t.prototype.setCampSignUpInfo=function(t){0==t.getErrorNo()?(this.factionIsSignUp=!0,e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPFBMCGTIME")),this.operateBack()):this.factionIsSignUp=!1},t.prototype.setEnterCampBattleInfo=function(e){0==e.getErrorNo()&&(this.myfactionType=e.getCampType(),this.playerIdentify=e.getMyIdentify(),this.strongPointList=e.getStrongPointList(),this.battleOverTime=e.getRemainMs(),this.achieveRankingSource=e.getRankInfoList(),this.battleAchievement=e.getBattleAchievement(),this.campBattleInfo=e,this.operateBack([factionPanelType.mapPanel]))},t.prototype.getCampBattleInfo=function(){return this.campBattleInfo},t.prototype.setCampbattleLogInfo=function(e){this.campBattleLogSource=e.getBattleLogList(),this.campPlayerLogSource=e.getPlayerLogList(),this.operateBack([factionPanelType.battleLog])},t.prototype.setOthersInfo=function(e){this.campMemberInfo=e.getMemList(),this.operateBack([factionPanelType.checkOthers])},t.prototype.setGarrisonInfo=function(e){0==e.getErrorNo()&&(console.log("据点进驻成功"),this.operateBack([factionPanelType.fightCity]))},t.prototype.setChallengeEnemyInfo=function(t){0==t.getErrorNo()&&(this.battleInfo=t.getBattleInfo(),this.campChallengeInfo=t,e.FactionBattleController.getInstance().CSChallenge())},t.prototype.setCampTreasureInfo=function(e){this.boxOpenList=e.getOpenList(),this.boxOpenTimes=e.getOpenNum(),this.operateBack([factionPanelType.battleExpBox])},t.prototype.setOpenTreasureInfo=function(t){0==t.getErrorNo()&&e.FactionBattleController.getInstance().sendmessageBoxListInfo()},t.prototype.setCampBattleAchievement=function(e){this.achieveRankingSource=e.getRankList(),this.battleAchievement=e.getInfo(),this.operateBack([factionPanelType.mapPanel])},t.prototype.setCampStrongPointInfo=function(e){var t=this;this.changedStrongPointList=e.getPointList(),this.changedStrongPointList.forEach(function(e){var i=e.getStrongPointId();t.strongPointList.forEach(function(n){if(i==n.getStrongPointId())try{var o=t.strongPointList.indexOf(n);t.strongPointList[o]=e}catch(a){throw new Error(a)}})}),this.operateBack([factionPanelType.mapPanel,factionPanelType.fightCity])},t.prototype.setCampBattleResult=function(t){this.campBattleResult=t;for(var i=e.FactionBattleController.getInstance().mapPanel.getIsShow(),n=0;n<this.observerList.length;n++)this.observerList[n].close();e.FactionBattleController.getInstance().sendmessageFactionInfo(),e.FactionBattleController.getInstance().showPanel(),i&&e.FactionBattleController.getInstance().showFactionPanel(factionPanelType.factionSettlement)},t.prototype.getCampBattleResult=function(){return this.campBattleResult},t.prototype.setCampLeave=function(e){0==e.getErrorNo()&&console.log("离开阵营战成功")},t.prototype.getRewards=function(){var t=e.GlobalConfig.instance.getValue("CS_CAMP_ACTIVITY_AWARD").split(",");return t},t}();e.FactionBattleModel=t,__reflect(t.prototype,"foxgame.FactionBattleModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/factionBattle/FactionBattlePanel.exml",null,!1)||this;return i.times=0,i.type=factionPanelType.mainPanel,i.model=e,i.model.registerObserver(i),i.setIsShowTween(!1),i.isMask=!1,i.isMaskdown=!0,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.signUpBtn.setState(e.FactionButton.normal),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.signUpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.initParams=function(){this.model.initParams()},i.prototype.showHook=function(){this.ui.cloudGroup.visible=!1,this.showReward()},i.prototype.refresh=function(){this.ui.currency.refresh();var t=this.model.getCampInfo();if(t){this.model.factionIsSignUp?this.ui.signUpBtn.setState(this.model.factionIsBattleTime?e.FactionButton.enter:e.FactionButton.signuped):this.ui.signUpBtn.setState(this.model.factionIsSignTime?e.FactionButton.normal:e.FactionButton.disabled);var i=this.model.getBattleMaxLastTime();this.ui.signUpTimeLabel.text=e.FactionBattleUtil.getFormatDate1(t.getSignUpBeginTime(),t.getOpenTime()),this.ui.battleTimeLabel.text=e.FactionBattleUtil.getFormatDate1(t.getOpenTime(),Number(t.getOpenTime())+Number(i))}},i.prototype.panelChange=function(){(this.getIsInit()||this.getIsShow())&&this.refresh()},i.prototype.showReward=function(){var t=this.model.getRewards();if(t.length>0&&this.ui.rewardGroup.numChildren<=0)for(var i=void 0,n=void 0,o=0;o<t.length;o++)i=new e.AttributeVO(t[o]),n=new e.ItemIcon,n.setItem(i.id,i.value),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemClick,this),this.ui.rewardGroup.addChild(n)},i.prototype.closeHook=function(){},i.prototype.onClick=function(t){switch(t.target){case this.ui.helpBtn:e.HelpController.getInstance().showPanel("LONGHUZBHELP");break;case this.ui.signUpBtn:if(this.ui.signUpBtn.state==e.FactionButton.disabled)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPNOSIGNTIME"));switch(this.ui.signUpBtn.label){case e.FactionButton.normal:e.FactionBattleController.getInstance().sendmessageFactionSignUp();break;case e.FactionButton.signuped:e.FactionBattleController.getInstance().sendmessageFactionInfo(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPNOENTERTIME"));break;case e.FactionButton.enter:e.FactionBattleController.getInstance().sendmessageBoxListInfo(),this.model.isFirstEnter&&!this.model.myfactionType?(this.model.isCloudEnter=!0,this.showEnterScene()):(this.model.isCloudEnter=!1,e.FactionBattleController.getInstance().sendmessageEnterBattle(),e.FactionBattleController.getInstance().showFactionPanel(factionPanelType.mapPanel))}}},i.prototype.onRewardItemClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.showEnterScene=function(){this.ui.cloudUp.y=0,this.ui.cloudDown.y=this.height,this.times=0,this.ui.cloudGroup.visible=!0,egret.Tween.get(this.ui.cloudUp).to({y:this.ui.cloudUp.height},500).call(this.showEnd,this),egret.Tween.get(this.ui.cloudDown).to({y:this.height-this.ui.cloudDown.height},500).call(this.showEnd,this)},i.prototype.showEnd=function(){this.times++,2==this.times&&(this.ui.cloudGroup.visible=!1,egret.Tween.removeTweens(this.ui.cloudUp),egret.Tween.removeTweens(this.ui.cloudDown),e.FactionBattleController.getInstance().sendmessageEnterBattle(),e.FactionBattleController.getInstance().showFactionPanel(factionPanelType.mapPanel))},i}(e.BasePanel);e.FactionBattlePanel=t,__reflect(t.prototype,"foxgame.FactionBattlePanel",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.getInstance=function(){return e.instance&&(e.instance=new e),e.instance},e.findKey=function(e,t){for(var i=Object.keys(e),n=0;n<i.length;n++)if(e[i[n]]==t)return i[n];return Log.trace("未找到指定value:"+t+"的key值")},e.getFormatDate=function(e,t){var i=new Date(Number(e)),n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),s=i.getHours();10>s&&(s="0"+s);var r=i.getMinutes();10>r&&(r="0"+r);var l=i.getSeconds();10>l&&(l="0"+l);var h=n+"年"+o+"月"+a+"日 "+s+":"+r+":"+l;if(t){var c=new Date(Number(t)),u=c.getHours(),p=c.getMinutes(),g=c.getSeconds();10>u&&(u="0"+u),10>p&&(p="0"+p),10>g&&(g="0"+g),h=n+"年"+o+"月"+a+"日"+s+":"+r+"-"+u+":"+p+":"+g}return h},e.getFormatDate1=function(e,t){var i=new Date(Number(e)),n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),s=i.getHours();10>s&&(s="0"+s);var r=i.getMinutes();10>r&&(r="0"+r);var l=i.getSeconds();10>l&&(l="0"+l);var h=n+"年"+o+"月"+a+"日 "+s+":"+r+":"+l;if(t){var c=new Date(Number(t)),u=c.getHours(),p=c.getMinutes(),g=c.getSeconds();10>u&&(u="0"+u),10>p&&(p="0"+p),10>g&&(g="0"+g),h=s+":"+r+"-"+u+":"+p}return h},e.getGrayBlueHtml=function(e,t,i,n,o,a){void 0===i&&(i=[15655878,2227971]),void 0===n&&(n=20),void 0===o&&(o="宋体"),void 0===a&&(a=!0);var s,r="<font size="+n+" color="+i[0]+" fontFamily="+o+">"+e+"</font>",l="<font size="+n+" color="+i[1]+" fontFamily="+o+">"+t+"</font>";return s=a?r+l:l+r,(new egret.HtmlTextParser).parse(s)},e.getprogressBarValue=function(e,t){return void 0===t&&(t=0),e-t},e.getServerIdByPlayerIdentify=function(e){return e.split("#")[1].split("*")[0]},e}();e.FactionBattleUtil=t,__reflect(t.prototype,"foxgame.FactionBattleUtil")}(foxgame||(foxgame={}));var factionType;!function(e){e[e.normal=0]="normal",e[e.dragon=1]="dragon",e[e.tiger=2]="tiger"}(factionType||(factionType={}));var factionPanelType;!function(e){e[e.mainPanel=0]="mainPanel",e[e.mapPanel=1]="mapPanel",e[e.battleLog=2]="battleLog",e[e.checkFaction=3]="checkFaction",e[e.checkOthers=4]="checkOthers",e[e.battleExpBox=5]="battleExpBox",e[e.achieveRank=6]="achieveRank",e[e.fightCity=7]="fightCity",e[e.battleLoading=8]="battleLoading",e[e.factionSettlement=9]="factionSettlement"}(factionPanelType||(factionPanelType={}));var Pointstate;!function(e){e[e.fail=0]="fail",e[e.fighting=1]="fighting",e[e.protect=2]="protect"}(Pointstate||(Pointstate={}));var headBoxType;!function(e){e[e.jin=0]="jin",e[e.yin=1]="yin",e[e.tong=2]="tong"}(headBoxType||(headBoxType={}));var playerStateType;!function(e){e[e.normal=1]="normal",e[e.fighting=2]="fighting",e[e.repair=3]="repair",e[e.reviving=4]="reviving",e[e.death=5]="death"}(playerStateType||(playerStateType={}));var foxgame;!function(e){var t=function(e){function t(t){void 0===t&&(t=null);var i=e.call(this,"FactionBattlePKLoading",null)||this;return i.endTimes=0,i.backFunction=t,i.setIsShowBackBtn(!1),i}return __extends(t,e),t.prototype.showHook=function(){var e=this;this.ui.frameUp.y=0,this.ui.frameDown.y=516,this.timeOut=egret.setTimeout(function(){e.showTween()},this,500)},t.prototype.showTween=function(){egret.Tween.get(this.ui.frameDown).to({y:this.height},1e3,egret.Ease.circIn).call(this.showEnd,this),egret.Tween.get(this.ui.frameUp).to({y:-this.ui.frameUp.height},1e3,egret.Ease.circIn).call(this.showEnd,this)},t.prototype.showEnd=function(){this.endTimes++,this.endTimes>=2&&(this.backFunction&&this.backFunction(),this.close())},t.prototype.destroy=function(){egret.Tween.removeTweens(this.ui.frameDown),egret.Tween.removeTweens(this.ui.frameUp),egret.clearTimeout(this.timeOut)},t}(e.BasePanel);e.FactionBattlePKLoading=t,__reflect(t.prototype,"foxgame.FactionBattlePKLoading")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isOpen=!1,e.skinName="BattleExpBoxItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.boxani&&(this.boxani.clear,this.boxani=null),this.boxInfo=this.data,this.isOpen=!1,this.boxInfo.openName){this.isOpen=!0,this.openGroup.visible=!0;var i=new e.AttributeVO(this.boxInfo.itemId);this.itemIcon.setItem(i.id,i.value,!1),this.roleNameLabel.text=this.boxInfo.openName}},i.prototype.showAni=function(){this.bg.visible&&!this.isOpen&&(this.boxani&&(this.boxani.clear,this.boxani=null),this.boxani=new e.FoxAni(this.boxAniGroup),this.boxani.setPlayComplete(this.onAniComplete,this),this.openGroup.visible=!1,this.boxani.play("fx_fanpai","ani",1),this.bg.visible=!1,this.isOpen=!0)},i.prototype.onAniComplete=function(){this.boxani&&(this.boxani.clear,this.boxani=null),e.FactionBattleController.getInstance().sendmessageOpenTreasure(this.itemIndex),this.openGroup.visible=!0},i.prototype.onClick=function(t){t.stopPropagation(),this.itemIcon.itemId>0&&e.TipsController.getInstance().showItemTips(this.itemIcon.itemId)},i}(eui.ItemRenderer);e.BattleExpBoxItemRender=t,__reflect(t.prototype,"foxgame.BattleExpBoxItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"BattleExpTreasureBox")||this;return i.type=factionPanelType.battleExpBox,i.openNeed=[],i.offsetOpenTimes=0,i.setIsShowBackBtn(!0),i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.boxList.useVirtualLayout=!1,this.ui.boxList.dataProvider=this.model.expBoxsCollection,this.ui.boxList.itemRenderer=e.BattleExpBoxItemRender,this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.boxList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemClick,this),this.openNeed=e.GlobalConfig.instance.getValue("CS_CAMP_OPEN_TREASURE_BA").split(",")},i.prototype.showHook=function(){},i.prototype.panelChange=function(){this.refresh()},i.prototype.refresh=function(){var t=this.model.achieveRankingSource;if(t){for(var i=t.length,n=0,o=0;i>o;o++){var a=t[o];a.getPlayerIdentify()==this.model.playerIdentify&&(n=a.getBattleAchievement())}for(var s=n,r=0,o=0;o<this.openNeed.length;o++){var l=Number(this.openNeed[o]);s>=l&&(s-=l,r++,o==this.openNeed.length-1&&(r+=Math.floor(s/l)))}if(this.model.boxOpenTimes>=0){var h=r-this.model.boxOpenTimes;if(this.offsetOpenTimes=h,h>=0){this.ui.openTimesLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("剩余开启次数：",h),this.model.boxOpenTimes>=3&&(this.offsetOpenTimes=0,this.ui.openTimesLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("剩余开启次数：",0));for(var c=this.model.boxOpenTimes>this.openNeed.length-1?this.openNeed.length-1:this.model.boxOpenTimes,u=0,o=0;c>=o;o++)u+=Number(this.openNeed[o]);this.ui.curExpLabel.textFlow=this.getFontlabel(n,u)}}}for(var p=this.model.boxOpenList.length,o=0;p>o;o++){var g=this.model.boxOpenList[o];this.model.expBoxsSource[g.getIndex()].openName=g.getName(),this.model.expBoxsSource[g.getIndex()].itemId=g.getItem()}this.model.expBoxsCollection.replaceAll(this.model.expBoxsSource)},i.prototype.getFontlabel=function(e,t){void 0===t&&(t=0);var i;return i=e>=t?'<font size=18 color=0x21ff03 fontFamily="宋体">'+e+" </font>"+('<font size=18 color=0xffffff fontFamily="宋体">/ '+t+"</font>"):'<font size=18 color=0xff0000 fontFamily="宋体">'+e+" </font>"+('<font size=18 color=0xffffff fontFamily="宋体">/ '+t+"</font>"),(new egret.HtmlTextParser).parse(i)},i.prototype.onClick=function(t){e.HelpController.getInstance().showPanel("LONGHUZGBXHELP")},i.prototype.onItemClick=function(t){if(!t.itemRenderer.isOpen){if(this.offsetOpenTimes<=0)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPZGBXTIME"));this.offsetOpenTimes--,this.curSelectedBox=this.ui.boxList.getChildAt(t.itemIndex),this.curSelectedBox.showAni(),this.ui.openTimesLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("剩余开启次数：",this.offsetOpenTimes)}},i}(e.BasePanel);e.BattleExpTreasureBox=t,__reflect(t.prototype,"foxgame.BattleExpTreasureBox",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"CheckFactionPanel")||this;return i.type=factionPanelType.checkFaction,i.model=e,i.setIsShowBackBtn(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.checkPerson.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.checkOther.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.setCampIcon(),this.initAward()},i.prototype.showHook=function(){},i.prototype.panelChange=function(){this.refresh()},i.prototype.refresh=function(){for(var t=this.model.achieveRankingSource,i=t.length,n=0;i>n;n++){var o=t[n];o.getPlayerIdentify()==this.model.playerIdentify&&(this.ui.rankNumLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("排名：",o.getRank(),[15655878,16759296]))}for(var a=this.model.campMemberInfo,s=a.length,n=0;s>n;n++){var r=a[n];r.getPlayerIdentify()==this.model.playerIdentify&&(this.ui.killNumLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("杀敌人数：",r.getKillNum()?r.getKillNum():0,[15655878,16759296]))}},i.prototype.onClick=function(t){switch(t.target){case this.ui.checkPerson:this.factionPlayerRankAward||(this.factionPlayerRankAward=new e.FactionPlayerRankAward(this.model)),this.factionPlayerRankAward.show();break;case this.ui.checkOther:e.FactionBattleController.getInstance().sendmessageOthersInfo(),this.factionOthersPanel||(this.factionOthersPanel=new e.FactionOthersPanel(this.model)),this.factionOthersPanel.show()}},i.prototype.onRewardItemClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.setCampIcon=function(){var e=this.model.myfactionType,t=this.model.campSourceTemplate[e];this.ui.wordIcon.source=t.wordIcon,this.ui.flagIcon.source=t.flagIcon},i.prototype.initAward=function(){var t,i,n=e.GlobalConfig.instance.getValue("CS_CAMP_WIN_AWARD").split(","),o=e.GlobalConfig.instance.getValue("CS_CAMP_FAIL_AWARD").split(",");if(n.length>0&&this.ui.winRewardGroup.numChildren<=0)for(var a=0;a<n.length;a++)t=new e.AttributeVO(n[a]),i=new e.ItemIcon,i.setItem(t.id,t.value,!1),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemClick,this),this.ui.winRewardGroup.addChild(i);if(o.length>0&&this.ui.loseRewardGroup.numChildren<=0)for(var a=0;a<o.length;a++)t=new e.AttributeVO(o[a]),i=new e.ItemIcon,i.setItem(t.id,t.value,!1),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemClick,this),this.ui.loseRewardGroup.addChild(i)},i}(e.BasePanel);e.CheckFactionPanel=t,__reflect(t.prototype,"foxgame.CheckFactionPanel",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FactionOtherItem",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data;this.rolename.text=e.getName(),this.effect.text=e.getFightValue().toString(),this.killNum.text=e.getKillNum().toString()},t}(eui.ItemRenderer);e.FactionOtherItem=t,__reflect(t.prototype,"foxgame.FactionOtherItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"FactionOthersPanel")||this;return i.type=factionPanelType.checkOthers,i.model=e,i.model.registerObserver(i),i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.playerList.itemRenderer=e.FactionOtherItem,this.ui.playerList.dataProvider=this.model.factionPlayersCollection},i.prototype.panelChange=function(){if(this.model.campMemberInfo){var e=this.model.campMemberInfo;e.sort(function(e,t){return t.getKillNum()-e.getKillNum()}),this.model.factionPlayersCollection.replaceAll(e)}},i.prototype.showHook=function(){},i}(e.BasePanel);e.FactionOthersPanel=t,__reflect(t.prototype,"foxgame.FactionOthersPanel",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"FactionPlayerRankAward")||this;return i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.playerList.dataProvider=this.model.factionRankAwardCollection,this.ui.playerList.itemRenderer=e.FactionRankAwardItem,this.model.factionRankAwardCollection.replaceAll(this.model.factionRankAwardSource)},i.prototype.showHook=function(){},i.prototype.refresh=function(){},i}(e.BasePanel);e.FactionPlayerRankAward=t,__reflect(t.prototype,"foxgame.FactionPlayerRankAward")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FactionRankAwardItem",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),console.log(this.data);var i=this.data,n=i.rankEnd-i.rankStart;if(0==n)switch(this.rankNum.text=i.rankStart.toString(),Number(i.rankStart)){case 1:this.rankIcon.source="Guild_qizijing_png";break;case 2:this.rankIcon.source="Guild_qiziying_png";break;case 3:this.rankIcon.source="Guild_qizitong_png"}else n>0&&99>n?(this.rankIcon.visible=!1,i.rankEnd>=10&&i.rankStart<10&&(this.hengImg.horizontalCenter=-7),this.rankNum.text=i.rankStart+"  "+i.rankEnd,this.hengImg.visible=!0):(this.bigGroup.visible=!1,this.bitAward.visible=!0,this.bitAward.text="参与奖");for(var o=this.itemGroup.numChildren,a=function(t){var n=new e.AttributeVO(i.awards[t]),o=s.itemGroup.getChildAt(t);o.setItem(n.id,n.value),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(o.itemId,n.value)},s),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.TipsController.getInstance().showItemTips(o.itemId,n.value)},s)},s=this,r=0;o>r;r++)a(r)},i}(eui.ItemRenderer);e.FactionRankAwardItem=t,__reflect(t.prototype,"foxgame.FactionRankAwardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.iconRepair="icon_lengque_png",e.iconFighting="icon_zding_png",e.iconreviving="icon_siwang_png",e.isMe=!1,e.isFriendData=!1,e.previosTime=0,e.skinName="FactionFightingPointItem",e.stateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e),e}return __extends(i,t),i.prototype.onClick=function(){if("挑战"==this.stateBtn.label){if(e.FactionBattleController.getInstance().getPlayerState()==playerStateType.repair)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPCZTZTIME"));if(e.FactionBattleController.getInstance().getPlayerState()==playerStateType.reviving)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAMPFHTZTIME"));e.FactionBattleController.getInstance().sendmessageChallengeEnemy(this.data.getPlayerIdentify())}},i.prototype.dataChanged=function(){var t=this.data,i=t.getPlayerIdentify();this.isFriendData=t.friend,i==e.FactionBattleController.getInstance().getPlayerIdentify()?(this.roleMsg.textColor=2227971,this.isMe=!0):(this.roleMsg.textColor=15655878,this.isMe=!1);var n=t.getState(),o=(e.FactionBattleUtil.getServerIdByPlayerIdentify(i),t.getPlayerName());this.roleMsg.text=o,this.roleHpProgress.setThumb(this.isMe),this.roleHpProgress.value=t.getHpPercent(),this.levelNum.text=t.getPlayerLevel().toString(),this.stateCd=t.getStateCD();var a=e.JsonDataManager.instance.roleTemplate[t.getPlayerItemId()];this.headIcon.source=a.icon,this.setPlayerState(n),this.setregisteTick(this.stateCd>0)},i.prototype.setregisteTick=function(e){e?(this.previosTime=0,egret.startTick(this.update,this)):egret.stopTick(this.update,this)},i.prototype.update=function(t){return!this.stateCd||this.stateCd<0?void 0:(t-this.previosTime>=1e3&&(this.previosTime=t,this.stateCd-=1e3),this.stateCd<1e3&&(this.stateTimeLabel.visible=!1),this.stateTimeLabel.text=e.GlobalUtil.getTimeString(this.stateCd/1e3,2),!1)},i.prototype.setPlayerState=function(t){this.othersGroup.visible=!0,this.stateBtn.visible=t==playerStateType.normal,this.parent.name.indexOf("player")>-1&&(this.stateBtn.visible=!1),this.stateLabel.visible=this.stateTimeLabel.visible=t==playerStateType.repair||t==playerStateType.reviving;var i="",n="";switch(this.stateBtn.filters=[],this.stateBtn.touchEnabled=!0,t){case playerStateType.normal:this.stateIcon.source="",e.FactionBattleController.getInstance().getSelectedPointId()==e.FactionBattleController.getInstance().getPlayerPointId()?this.stateBtn.label="挑战":this.stateBtn.visible=!1;break;case playerStateType.repair:this.isFriendData?(this.stateIcon.source=this.iconRepair,i="挑战修整",n=e.GlobalUtil.getTimeString(this.stateCd/1e3,2),this.stateTimeLabel.textColor=this.stateLabel.textColor=16759296,this.stateLabel.text=i,this.stateTimeLabel.text=n):(this.stateIcon.source="",this.stateLabel.visible=!1,this.stateTimeLabel.visible=!1,e.FactionBattleController.getInstance().getSelectedPointId()==e.FactionBattleController.getInstance().getPlayerPointId()?(this.stateBtn.visible=!0,this.stateBtn.label="挑战"):this.stateBtn.visible=!1);break;case playerStateType.fighting:this.stateBtn.visible=!0,this.stateBtn.label="战斗中",this.stateBtn.filters=e.GlobalUtil.grayFilter,this.stateBtn.touchEnabled=!1,this.stateIcon.source=this.iconFighting;break;case playerStateType.reviving:this.stateIcon.source=this.iconreviving,this.headIcon.filters=e.GlobalUtil.grayFilter,i="复活修整",n=e.GlobalUtil.getTimeString(this.stateCd/1e3,2),this.stateTimeLabel.textColor=this.stateLabel.textColor=14211288,this.stateLabel.text="复活修整",this.stateTimeLabel.text=n}this.isMe&&(this.stateBtn.visible=!1)},i}(eui.ItemRenderer);e.FactionFightingPointItemRender=t,__reflect(t.prototype,"foxgame.FactionFightingPointItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"FactionFightingPointPanel")||this;return i.type=factionPanelType.fightCity,i.stateCD=0,i.previosTime=0,i.canArrivePoint=[],i.isShowChallenge=!1,i.setRegisterTick(!0),i.model=e,i.model.registerObserver(i),i.setIsShowBackBtn(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.playerList.dataProvider=this.model.playerPointCollecton,this.ui.playerList.itemRenderer=e.FactionFightingPointItemRender,this.ui.enemyList.dataProvider=this.model.enemyPointCollecton,this.ui.enemyList.itemRenderer=e.FactionFightingPointItemRender,this.ui.enterCityBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showHook=function(){},i.prototype.checkPointEnter=function(e){var t=this.model.campStrongpointTemplate[e],i=this.model.CampItemDict[e],n=i.getCamptype();if(n==this.model.myfactionType)for(var o=t.connectId,a=0;a<o.length;a++){var s=o[a],r=this.model.CampItemDict[s];r.getState()==Pointstate.protect?r.getCamptype()==this.model.myfactionType&&-1==this.canArrivePoint.indexOf(s)&&(this.canArrivePoint.push(s),this.checkPointEnter(s)):r.getCamptype()==this.model.myfactionType?-1==this.canArrivePoint.indexOf(s)&&(this.canArrivePoint.push(s),this.checkPointEnter(s)):-1==this.canArrivePoint.indexOf(s)&&this.canArrivePoint.push(s)}else for(var o=t.connectId,a=0;a<o.length;a++){var s=o[a],r=this.model.CampItemDict[s];r.getCamptype()==this.model.myfactionType&&-1==this.canArrivePoint.indexOf(s)&&(this.canArrivePoint.push(s),this.checkPointEnter(s))}},i.prototype.tickHook=function(t){return!this.stateCD||this.stateCD<0?void 0:(t-this.previosTime>=1e3&&(this.previosTime=t,this.stateCD-=1e3),this.stateCD<1e3?void(this.ui.stateTimeLabel.visible=!1):void(this.ui.stateTimeLabel.text=e.GlobalUtil.getTimeString(this.stateCD/1e3,2)))},i.prototype.refresh=function(){var t=this.model.campStrongpointTemplate[this.model.curSelectedPointId];this.ui.pointNameLabel.text=t.name,this.canArrivePoint=[],this.checkPointEnter(this.model.playerPointId),this.canArrivePoint.indexOf(this.model.curSelectedPointId)>-1&&this.model.curSelectedPointId!=this.model.playerPointId&&e.FactionBattleController.getInstance().getPlayerState()!=playerStateType.reviving&&e.FactionBattleController.getInstance().getPlayerState()!=playerStateType.death?this.ui.enterCityBtn.filters=[]:this.ui.enterCityBtn.filters=e.GlobalUtil.grayFilter,this.model.curSelectedPointId==this.model.playerPointId&&(this.isShowChallenge=!0),this.showSelectdPoint(),this.model.curSelectedPointId==this.model.playerPointId&&(this.ui.enterCityBtn.filters=e.GlobalUtil.grayFilter)
},i.prototype.panelChange=function(){this.refresh()},i.prototype.showSelectdPoint=function(){var e=this.model.strongPointList;if(e){for(var t=this.model.curSelectedPointId,i=e.length,n=0;i>n;n++){var o=e[n];o.getStrongPointId()==t&&(this.model.myfactionType==factionType.tiger?(this.ui.tigerIcon.left=0,this.ui.dragonIcon.right=0,this.model.playerPointSource=this.sortByState(o.getTigerPlayerList()),this.model.enemyPointSource=this.sortByState(o.getDragonPlayerList())):this.model.myfactionType==factionType.dragon&&(this.ui.tigerIcon.right=0,this.ui.dragonIcon.left=0,this.model.playerPointSource=this.sortByState(o.getDragonPlayerList()),this.model.enemyPointSource=this.sortByState(o.getTigerPlayerList())))}for(var a=this.model.playerPointSource.length,n=0;a>n;n++)if(this.model.playerPointSource[n].friend=!0,this.model.playerPointSource[n].getPlayerIdentify()==this.model.playerIdentify){var s=this.model.playerPointSource[n],r=s.getState(),l="";r==playerStateType.reviving&&(l="复活修整"),r==playerStateType.repair&&(l="挑战修整"),s.getStateCD()>0&&this.setPlayerStateTimeLabel(l,"",s.getStateCD())}this.model.playerPointCollecton.replaceAll(this.model.playerPointSource),this.model.enemyPointCollecton.replaceAll(this.model.enemyPointSource)}},i.prototype.sortByState=function(e){for(var t=[],i=[],n=[],o=[],a=[],s=[],r=e.length,l=0;r>l;l++){var h=e[l];h.getPlayerIdentify()==this.model.playerIdentify&&t.push(h);var c=h.getState();switch(c){case playerStateType.normal:n.push(h);break;case playerStateType.fighting:o.push(h);break;case playerStateType.repair:a.push(h);break;case playerStateType.reviving:s.push(h)}}i=t.concat(n).concat(a).concat(o).concat(s);for(var l=1;l<i.length;l++)if(i[l].getPlayerIdentify()==this.model.playerIdentify){i.splice(l,1);break}return i},i.prototype.onClick=function(t){if(this.ui.enterCityBtn.filters.length>0){var i="";return-1==this.canArrivePoint.indexOf(this.model.curSelectedPointId)?(i="CAMPXLBTTIME",console.log("当前据点路线不通,请绕行"),this.model.CampItemDict[this.model.curSelectedPointId].getState()==Pointstate.protect&&(console.log("敌人保护状态"),i="CAMPFJZBHTIME")):this.model.curSelectedPointId==this.model.playerPointId?(i="CAMPNOENTERSAMEPOINT",console.log("我当前就在这个城池")):(e.FactionBattleController.getInstance().getPlayerState()==playerStateType.reviving||e.FactionBattleController.getInstance().getPlayerState()!=playerStateType.death)&&(console.log("玩家已死亡"),i="CAMPFHRZTIME"),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue(i))}this.model.CampItemDict[this.model.playerPointId].clearState(),e.FactionBattleController.getInstance().sendmessageGarrison(this.model.curSelectedPointId)},i.prototype.setPlayerStateTimeLabel=function(t,i,n){this.ui.stateNameLabel.visible=this.ui.stateTimeLabel.visible=!0,this.ui.stateNameLabel.text=t,this.ui.stateTimeLabel.text=e.GlobalUtil.getTimeString(n/1e3,2),this.stateCD=n,this.ui.stateTimeLabel.visible=!0},Object.defineProperty(i.prototype,"pointNameLabel",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dragonIcon",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tigerIcon",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playerList",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enemyList",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enterCityBtn",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stateTimeLabel",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stateNameLabel",{get:function(){},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.FactionFightingPointPanel=t,__reflect(t.prototype,"foxgame.FactionFightingPointPanel",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FightingPointProgressBar",t}return __extends(t,e),t.prototype.setThumb=function(e){void 0===e&&(e=!1),this.thumb.source=e?"pb_player_png":"pb_other_png"},t.prototype.updateSkinDisplayList=function(){e.prototype.updateSkinDisplayList.call(this),this.setLabel()},t.prototype.setLabel=function(){this.label.text=this.value+"%"},t}(eui.ProgressBar);e.FightingPointProgressBar=t,__reflect(t.prototype,"foxgame.FightingPointProgressBar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"FactionBattleLog",null,!1)||this;return i.type=factionPanelType.battleLog,i.model=e,i.setIsShowBackBtn(!0),i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.battleLogBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.myLogBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.logList.itemRenderer=e.FactionBattleLogItem,this.ui.logList.dataProvider=this.model.campBattleLogCollection},i.prototype.showHook=function(){this.setState(this.ui.battleLogBtn);var e="本次阵营战战况";this.ui.introdLabel.text=e,this.ui.titleLabel.text="战场日志"},i.prototype.refresh=function(){},i.prototype.panelChange=function(){this.refresh(),this.model.campBattleLogCollection.replaceAll(this.model.campBattleLogSource.reverse())},i.prototype.onClick=function(e){var t=e.target,i=this.ui.introdLabel.text;switch(t){case this.ui.battleLogBtn:i="本次阵营战战况",this.model.campBattleLogCollection.source=this.model.campBattleLogSource.reverse();break;case this.ui.myLogBtn:i="本次阵营战我的战况",this.model.campBattleLogCollection.source=this.model.campPlayerLogSource.reverse()}this.ui.introdLabel.text=i,this.ui.titleLabel.text=t.label,this.setState(t)},i.prototype.setState=function(e){this.ui.battleLogBtn.currentState=this.ui.battleLogBtn==e?"down":"up",this.ui.myLogBtn.currentState=this.ui.myLogBtn==e?"down":"up"},i}(e.BasePanel);e.FactionBattleLog=t,__reflect(t.prototype,"foxgame.FactionBattleLog",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.winIcon="icon_zhenying_sheng_png",e.failIcon="icon_zhenying_bai_png",e.skinName="FactionBattleLogItem",e}return __extends(i,t),i.prototype.dataChanged=function(){var t=e.FactionBattleController.getInstance().getPlayerCampType(),i=!0;try{i=this.data.getStrongPointId()?!1:!0}catch(n){i=!0}if(i){var o=this.data;this.timeLabel.text=e.FactionBattleUtil.getFormatDate(o.getTime());var a=o.getSuc(),s=o.getChallege(),r=o.getOpponentName(),l=o.getPlayerBA(),h=o.getCampBA(),c=void 0;a?(this.iconResult.source=this.winIcon,c=s?e.LanguageUtils.instance.getValue("CAMPBATTLELOGCHALLENGEWIN",r,l,h):e.LanguageUtils.instance.getValue("CAMPBATTLELOGCHALLENGEDWIN",r,l,h)):(this.iconResult.source=this.failIcon,c=s?e.LanguageUtils.instance.getValue("CAMPBATTLELOGCHALLENGELOSE",r,l,h):e.LanguageUtils.instance.getValue("CAMPBATTLELOGCHALLENGEDLOSE",r,l,h)),this.descLabel.textFlow=(new egret.HtmlTextParser).parse(c)}else{var o=this.data;this.timeLabel.text=e.FactionBattleUtil.getFormatDate(o.getTime());var u=o.getStrongPointId(),p=e.JsonDataManager.instance.campStrongpointTemplate[u],g=p.name,d=void 0;d=e.FactionBattleController.getInstance().getPlayerCampType()==factionType.dragon?"龙":"虎";var c=void 0;t==o.getCampType()?(c=e.LanguageUtils.instance.getValue("CAMPBATTLELOGOURHOLD",d,g),this.iconResult.source=this.winIcon):(c=e.LanguageUtils.instance.getValue("CAMPBATTLELOGENEMYHOLD",g,d),this.iconResult.source=this.failIcon),this.descLabel.textFlow=(new egret.HtmlTextParser).parse(c)}},i}(eui.ItemRenderer);e.FactionBattleLogItem=t,__reflect(t.prototype,"foxgame.FactionBattleLogItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="AchieveRankingHeadItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.setHeadItem=function(t,i,n,o,a,s,r){void 0===t&&(t=headBoxType.jin),void 0===i&&(i=-1),void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===a&&(a=""),void 0===s&&(s=.63),void 0===r&&(r=1);var l="box_touxiang_";switch(t){case headBoxType.jin:this.headBoxImg.source=l+"jin_png";break;case headBoxType.yin:this.headBoxImg.source=l+"yin_png";break;case headBoxType.tong:this.headBoxImg.source=l+"tong_png";break;default:this.headBoxImg.source="roleHeadBg1_png"}if(-1!=i){var h=e.JsonDataManager.instance.roleTemplate[i];this.headImg.source=h.icon}n||(this.headBoxImg.visible=!1),o?this.roleName.text=a.split(".")[1]:this.roleName.visible=!1,this.headImg.scaleX=this.headImg.scaleY=s,this.headBoxImg.scaleX=this.headBoxImg.scaleY=r},i}(eui.Component);e.AchieveRankingHeadItem=t,__reflect(t.prototype,"foxgame.AchieveRankingHeadItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="AchieveRankItem",e}return __extends(i,t),i.prototype.dataChanged=function(){this.setRankItemData(this.data)},i.prototype.setRankItemData=function(t){var i=e.JsonDataManager.instance.campSourceInfoTemplate[t.getCampType()];this.setRankBgNum(t.getRank()),this.roleName.text=t.getName(),this.factionType.text=i.name,this.jifen.text=t.getBattleAchievement().toString()},i.prototype.setRankBgNum=function(e){var t="putonga_png";switch(e){case 1:t="Guild_qizijing_png";break;case 2:t="Guild_qiziying_png";break;case 3:t="Guild_qizitong_png"}this.rankBg.source=t,this.rankNumLabel.text=e.toString()},i}(eui.ItemRenderer);e.AchieveRankItemRender=t,__reflect(t.prototype,"foxgame.AchieveRankItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"BattleAchieveRanking",null,!1)||this;return i.type=factionPanelType.achieveRank,i.model=e,i.setIsShowBackBtn(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.showMax=Number(e.GlobalConfig.instance.getValue("CS_CAMP_BA_RANK_NUM")),this.ui.rankList.useVirtualLayout=!1,this.ui.rankList.dataProvider=this.model.achieveRankingCollecton,this.ui.rankList.itemRenderer=e.AchieveRankItemRender;for(var t=this.ui.headGroup.numChildren,i=0;t>i;i++)this.ui.headGroup.getChildAt(i).setHeadItem(i)},i.prototype.showHook=function(){},i.prototype.panelChange=function(){this.refresh()},i.prototype.refresh=function(){var e=this.model.achieveRankingSource;if(e){for(var t=e.length,i=0;t>i;i++){var n=e[i];this.model.playerIdentify==n.getPlayerIdentify()&&(n.getRank()<=this.showMax,this.ui.playerRankItem.setRankItemData(n))}e.sort(function(e,t){return t.getBattleAchievement()-e.getBattleAchievement()});var o=void 0;o=t>this.showMax?e.slice(0,this.showMax):e;for(var i=0;i<o.length&&!(i>2);i++){var a=o[i];this.ui.headGroup.getChildAt(i).setHeadItem(i,a.getPlayerItemId(),!0,!0,a.getName())}this.model.achieveRankingCollecton.replaceAll(o)}},Object.defineProperty(i.prototype,"headGroup",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rankList",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playerRankItem",{get:function(){},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.BattleAchieveRanking=t,__reflect(t.prototype,"foxgame.BattleAchieveRanking",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.greenSource="xuetiaolv_png",t.redSource="xuetiaohong_png",t.skinName="CityProgressBar",t}return __extends(t,e),Object.defineProperty(t.prototype,"playerBar",{get:function(){return this.green},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enemyBar",{get:function(){return this.red},enumerable:!0,configurable:!0}),t}(eui.ProgressBar);e.CityProgressBar=t,__reflect(t.prototype,"foxgame.CityProgressBar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FactionButton",e}return __extends(i,t),i.prototype.setState=function(t){return this.state=t,t==i.disabled?(this.filters=e.GlobalUtil.grayFilter,void(this.label=i.normal)):(this.filters=[],void(this.label=t))},i.disabled="disabled",i.normal="报名参加",i.enter="进入战场",i.signupIng="报名中",i.signuped="已报名",i}(eui.Button);e.FactionButton=t,__reflect(t.prototype,"foxgame.FactionButton")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/factionBattle/FactionBattleMapPanel.exml",null,!1)||this;return i.type=factionPanelType.mapPanel,i.previosTime=0,i.isInit=!1,i.times=0,i.model=e,i.model.registerObserver(i),i.setRegisterTick(!0),i.setIsShowBackBtn(!0),i.isCenter=!0,i}return __extends(i,t),i.prototype.initHook=function(){this.adaptationPanel(),this.ui.myFlag.visible=!1,this.ui.checkHideOpen.addEventListener(eui.UIEvent.CHANGE,this.onCheckChange,this);for(var e=this.ui.enemyGroup.numChildren,t=0;e>t;t++){var i=this.ui.enemyGroup.getChildAt(t);i.setEnemyLabelscaleX(),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var n=this.ui.friendGroup.getChildAt(t);n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.ui.centerCity.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showHook=function(){e.FactionBattleController.getInstance().isFactionMap=!0,this.model.myfactionType&&(this.isInit=!0,this.initMap()),this.model.isCloudEnter&&(this.model.isCloudEnter=!1,this.model.isFirstEnter=!1,this.showEnterScene())},i.prototype.adaptationPanel=function(){var t=e.Global.stageHeight-this.height>>1;this.ui.mapBottom.y=this.ui.mapBottom.y+t,this.ui.centerGroup.y=this.ui.centerGroup.y+t/2},i.prototype.tickHook=function(t){return this.model.battleOverTime<=0||!this.model.battleOverTime?void 0:(t-this.previosTime>=1e3&&(this.previosTime=t,this.model.battleOverTime-=1e3),Math.ceil(this.model.battleOverTime/1e3)<=0?console.log("游戏结束"):void(this.ui.timeLabel.text=e.GlobalUtil.getTimeString(Math.ceil(this.model.battleOverTime/1e3),2)))},i.prototype.panelChange=function(){this.refresh(),e.FactionBattleController.getInstance().setMessageRedPoint()},i.prototype.refresh=function(){var t=this.model.getCampBattleInfo();if(t){var i=this.model.battleAchievement;this.ui.longAchieveLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("阵营战功：",i.getDragon()),this.ui.huAchieveLabel.textFlow=e.FactionBattleUtil.getGrayBlueHtml("阵营战功：",i.getTiger()),this.ui.smallRanking.refreshRank(this.model.achieveRankingSource),this.ui.mapBottom.refreshBoxRed(this.model.achieveRankingSource,this.model.boxOpenTimes),this.model.playerPointId=t.getMyStrongPointId(),this.model.myfactionType&&!this.isInit&&this.initMap();for(var n=this.model.strongPointList,o=n.length,a=0;o>a;a++){var s=n[a],r=s.getStrongPointId(),l=this.model.CampItemDict[r];l.setPointMsg(s,this.model.myfactionType,this.model.playerIdentify)}}},i.prototype.onClick=function(t){var i=e.FactionBattleUtil.findKey(this.model.CampItemDict,t.target);i?this.model.curSelectedPointId=Number(i):Log.trace("错误的选择信息:",t.target),e.FactionBattleController.getInstance().sendmessageEnterBattle(),e.FactionBattleController.getInstance().showFactionPanel(factionPanelType.fightCity)},i.prototype.onCheckChange=function(e){var t=this,i=0;i=this.ui.checkHideOpen.selected?this.ui.smallRanking.x-this.ui.smallRanking.width:this.ui.smallRanking.x+this.ui.smallRanking.width,this.ui.checkHideOpen.touchEnabled=!1,egret.Tween.get(this.ui.smallRanking).to({x:i},500).call(function(){t.ui.checkHideOpen.touchEnabled=!0})},i.prototype.initMap=function(){var e=this.model.myfactionType,t=this.model.campStrongpointTemplate;for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(n.initType==e){var o=n.id,a=6,s=o-a;if(s>0)for(var r=n.id;r>s+1;r--)this.model.CampItemDict[r]=this.ui.friendGroup.getChildAt(Math.abs(r-11)),this.model.CampItemDict[r-a]=this.ui.enemyGroup.getChildAt(Math.abs(r-7));else for(var r=1;r<=Math.abs(s);r++)this.model.CampItemDict[r]=this.ui.friendGroup.getChildAt(Math.abs(r-1)),this.model.CampItemDict[r+a]=this.ui.enemyGroup.getChildAt(Math.abs(r-5));this.model.CampItemDict[a]=this.ui.centerCity;break}}var l=this.model.CampItemDict;for(var h in l)if(l.hasOwnProperty(h)){var n=l[h],c=t[h];n.setcityIcon(c.icon),n.setCityName(c.name),n.setflagIcon(c.initType),n.setHolderBarValue(0),n.setHolderMaxNum(c.progress),n.progress_enemy_later=-1,n.progress_player_later=-1,n==this.ui.centerCity&&n.setHoldbarWidth(163)}},i.prototype.showEnterScene=function(){this.ui.cloudUp.y=this.ui.cloudUp.height,this.ui.cloudDown.y=this.height-this.ui.cloudUp.height,this.ui.cloudGroup.visible=!0,this.times=0,this.ui.cloudGroup.visible=!0,egret.Tween.get(this.ui.cloudUp).to({y:0},500).call(this.showEnd,this),egret.Tween.get(this.ui.cloudDown).to({y:this.height},500).call(this.showEnd,this)},i.prototype.showEnd=function(){var e=this;if(this.times++,2==this.times&&(this.ui.cloudGroup.visible=!1,egret.Tween.removeTweens(this.ui.cloudUp),egret.Tween.removeTweens(this.ui.cloudDown),this.model.myfactionType)){var t=this.model.campSourceTemplate[this.model.myfactionType];this.ui.myFlag.source=t.flagIcon,this.ui.myFlag.visible=!0;var i=this.ui.friendGroup.x+this.ui.friendGroup.width/2,n=this.ui.friendGroup.y+this.ui.friendGroup.height-80;this.ui.myFlag.scaleX=this.ui.myFlag.scaleY=.2,egret.Tween.get(this.ui.myFlag).to({scaleX:1,scaleY:1},800).wait(1500).to({x:i,y:n,scaleX:.2,scaleY:.2},800).call(function(){e.ui.myFlag.visible=!1,egret.Tween.removeTweens(e.ui.myFlag),e.scaleX=e.scaleY=1})}},i.prototype.backHandler=function(){t.prototype.backHandler.call(this),e.FactionBattleController.getInstance().sendmessageLeaveCamp()},i.prototype.pointToOtherPoint=function(e){for(var t=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=i.length;this.headImg.visible=!0,this.headImg.x=e.x,this.headImg.y=e.y;for(var a=egret.Tween.get(this.headImg),s=1e3,r=0,l=0;o>l;l++){var h=i[l];a.to({x:h.x,type:h.y},s/o).call(function(){r++,r>=o&&(console.log("执行回调"),t.headImg.visible=!1)},this)}},i.prototype.closeHook=function(){e.FactionBattleController.getInstance().isFactionMap=!1},i.prototype.setMapBottom=function(){this.ui.mapBottom.setMsgPoint(this.model.msgArr.length>0,this.model.msgArr.length)},i}(e.BasePanel);e.FactionBattleMapPanel=t,__reflect(t.prototype,"foxgame.FactionBattleMapPanel",["foxgame.IFactionBattle","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="BattleAchieveSmallRanking",e.dataCollection=new eui.ArrayCollection,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.chekMore.textFlow=(new egret.HtmlTextParser).parse("<u>"+this.chekMore.text+"</u>"),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rankList.dataProvider=this.dataCollection,this.rankList.itemRenderer=e.BattleAchieveSmallRankItem},i.prototype.onClick=function(){e.FactionBattleController.getInstance().showFactionPanel(factionPanelType.achieveRank)},i.prototype.refreshRank=function(t){t.sort(function(e,t){return e.getRank()-t.getRank()});for(var i=0;i<t.length;i++)if(t[i].getPlayerIdentify()==e.FactionBattleController.getInstance().getPlayerIdentify()){var n=t[i].getBattleAchievement();this.chekMore.textFlow=(new egret.HtmlTextParser).parse("<u>个人战功："+n+"</u>")}t.length>5&&(t=t.slice(0,5)),this.dataCollection.replaceAll(t)},i}(eui.Component);e.BattleAchieveSmallRanking=t,__reflect(t.prototype,"foxgame.BattleAchieveSmallRanking")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="BattleAchieveSmallRankItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){var t=this.data;this.rankLabel.text=t.getRank().toString();var i=e.JsonDataManager.instance.campSourceInfoTemplate[t.getCampType()];this.flagIcon.source=i.smallIcon,this.nameLabel.text=t.getName()},i}(eui.ItemRenderer);e.BattleAchieveSmallRankItem=t,__reflect(t.prototype,"foxgame.BattleAchieveSmallRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FactionMapBottom",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.msgBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.battleLogBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.factionCheckBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.achieveBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i;switch(t.target){case this.msgBtn:e.NewChatControler.getInstance().showPanel(!0);break;case this.battleLogBtn:e.FactionBattleController.getInstance().sendmessageCampLog(),i=factionPanelType.battleLog;break;case this.factionCheckBtn:e.FactionBattleController.getInstance().sendmessageOthersInfo(),i=factionPanelType.checkFaction;break;case this.achieveBoxBtn:e.FactionBattleController.getInstance().sendmessageBoxListInfo(),i=factionPanelType.battleExpBox}e.FactionBattleController.getInstance().showFactionPanel(i)},i.prototype.refreshBoxRed=function(t,i){for(var n,o=t.length,a=0;o>a;a++){var s=t[a];if(s.getPlayerIdentify()==e.FactionBattleController.getInstance().getPlayerIdentify()){n=s.getBattleAchievement();for(var r=0,l=e.GlobalConfig.instance.getValue("CS_CAMP_OPEN_TREASURE_BA").split(","),h=0;h<l.length;h++){var c=Number(l[h]);n>=c&&(n-=c,r++,h==l.length-1&&(r+=Math.floor(n/c)))}if(i>=0){var u=r-i;this.setboxRedPoint(u>0)}}}},i.prototype.setMsgPoint=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=0),this.msgPointGroup.visible=e,this.msgNumLabel.text=t.toString()},i.prototype.setlogRedPoint=function(e){this.logRedPoint.visible=e},i.prototype.setcheckRedPoint=function(e){this.checkRedPoint.visible=e},i.prototype.setboxRedPoint=function(e){this.boxRedPoint.visible=e},i}(eui.Component);e.FactionMapBottom=t,__reflect(t.prototype,"foxgame.FactionMapBottom")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.previosTime=0,e.protectedTime=0,e.stateCdTime=0,e.curValue=0,e.isEnemy=!1,e.progress_enemy_later=-1,e.progress_player_later=-1,e._lastTimeByPlayer=0,e._lastTimeByEnemy=0,e.stateName="",e.skinName="FactionMapCityItem",e}return __extends(i,t),i.prototype.onTouchBegin=function(){var e=this.sourceStr,t=this.sourceStr.indexOf("_png");if(t>0){var i=this.sourceStr.split("_png");e=i[0]+"_touch_png"}this.cityIcon.source=e,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchCancle,this)},i.prototype.onTouchCancle=function(){this.cityIcon.source=this.sourceStr,this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchCancle,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchCancle,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sourceStr=this.cityIcon.source,-1!=this.name.indexOf("enemy")&&(this.isEnemy=!0),this.addBaTimeLater=Number(e.GlobalConfig.instance.getValue("CS_CAMP_HOLD_BA_TIME"))},i.prototype.interValHook=function(){var e;this.holdEnemyBar.width==this.holdBarMaxWidth&&(e=this.campStrongpointVO.holdBaseValue+this.enemyNum*this.campStrongpointVO.holdPlayerMultiple,this.showAddAchievementLabel(Math.ceil(e/5),!0)),this.holdPlayerBar.width==this.holdBarMaxWidth&&(e=this.campStrongpointVO.holdBaseValue+this.friendNum*this.campStrongpointVO.holdPlayerMultiple,this.showAddAchievementLabel(Math.ceil(e/5),!1))},i.prototype.initProgressValue=function(){this.enemyProgress!=this.progress_enemy_later&&(this.progress_enemy_later=this.enemyProgress,this.holdEnemyBar.width=(this.enemyProgress/this.holdBar.maximum>1?1:this.enemyProgress/this.holdBar.maximum)*this.holdBarMaxWidth),this.friendProgress!=this.progress_player_later&&(this.progress_player_later=this.friendProgress,this.holdPlayerBar.width=(this.friendProgress/this.holdBar.maximum>1?1:this.friendProgress/this.holdBar.maximum)*this.holdBarMaxWidth)},i.prototype.refreshProgress=function(){(0==this.enemyNum&&0==this.enemyProgress||this.getState()==Pointstate.protect)&&egret.Tween.removeTweens(this.holdEnemyBar),(0==this.friendNum&&0==this.friendProgress||this.getState()==Pointstate.protect)&&egret.Tween.removeTweens(this.holdPlayerBar),this.friendNum==this.enemyNum&&(egret.Tween.removeTweens(this.holdPlayerBar),egret.Tween.removeTweens(this.holdEnemyBar));var t;if(this.isEnemy){if(t=e.FactionBattleUtil.getprogressBarValue(this.enemyNum,this.friendNum),0>t)this.playerMuchEnemyLess(t,!0);else if(t>0){if(this.name.indexOf("_1")>-1&&0==this.friendNum)return this.holdEnemyBar.width=this.holdBarMaxWidth,this.holdEnemyBar.visible=!0,void(this.holdPlayerBar.visible=!1);this.playerLessEnemyMuch(t,!0)}}else if(this.setFailState(this.nowCampType!=e.FactionBattleController.getInstance().getPlayerCampType()&&this.nowCampType!=factionType.normal&&-1==this.name.indexOf("center")),t=e.FactionBattleUtil.getprogressBarValue(this.friendNum,this.enemyNum),0>t)this.playerLessEnemyMuch(t,!1);else if(t>0){if(this.name.indexOf("_1")>-1&&0==this.enemyNum)return this.holdPlayerBar.width=this.holdBarMaxWidth,this.holdEnemyBar.visible=!1,void(this.holdPlayerBar.visible=!0);this.playerMuchEnemyLess(t,!1)}},i.prototype.playerMuchEnemyLess=function(e,t){if(void 0===t&&(t=!1),this.holdEnemyBar.width>0)if(this.nowCampType==factionType.normal){egret.Tween.removeTweens(this.holdPlayerBar),this.holdEnemyBar.visible=!0,this.holdPlayerBar.visible=!1;var i=this.holdEnemyBar.width/this.holdBarMaxWidth*this.holdBar.maximum;this.changeEnemyValue(0,i/Math.abs(e)*1e3)}else{this.holdEnemyBar.visible=!0,this.holdPlayerBar.visible=!0;var n=(this.holdBarMaxWidth-this.holdPlayerBar.width)/this.holdBarMaxWidth*this.holdBar.maximum;this.changePlayerValue(this.holdBarMaxWidth,n/Math.abs(e)*1e3);var i=this.holdEnemyBar.width/this.holdBarMaxWidth*this.holdBar.maximum;this.changeEnemyValue(0,i/Math.abs(e)*1e3)}else if(0==this.holdEnemyBar.width&&this.holdPlayerBar.width<this.holdBarMaxWidth){egret.Tween.removeTweens(this.holdEnemyBar),this.holdPlayerBar.visible=!0;var n=(this.holdBarMaxWidth-this.holdPlayerBar.width)/this.holdBarMaxWidth*this.holdBar.maximum;this.changePlayerValue(this.holdBarMaxWidth,n/Math.abs(e)*1e3)}else 0==this.holdEnemyBar.width&&this.holdPlayerBar.width==this.holdBarMaxWidth&&(this.holdPlayerBar.visible=!0,egret.Tween.removeTweens(this.holdPlayerBar),egret.Tween.removeTweens(this.holdEnemyBar))},i.prototype.playerLessEnemyMuch=function(e,t){if(void 0===t&&(t=!1),this.holdPlayerBar.width>0)if(this.nowCampType==factionType.normal){egret.Tween.removeTweens(this.holdEnemyBar),this.holdEnemyBar.visible=!1,this.holdPlayerBar.visible=!0;var i=this.holdPlayerBar.width/this.holdBarMaxWidth*this.holdBar.maximum;this.changePlayerValue(0,i/Math.abs(e)*1e3)}else{this.holdEnemyBar.visible=!0,this.holdPlayerBar.visible=!0;var i=this.holdPlayerBar.width/this.holdBarMaxWidth*this.holdBar.maximum;this.changePlayerValue(0,i/Math.abs(e)*1e3);var n=(this.holdBarMaxWidth-this.holdEnemyBar.width)/this.holdBarMaxWidth*this.holdBar.maximum;this.changeEnemyValue(this.holdBarMaxWidth,n/Math.abs(e)*1e3)}else if(0==this.holdPlayerBar.width&&this.holdEnemyBar.width<this.holdBarMaxWidth){egret.Tween.removeTweens(this.holdPlayerBar),this.holdEnemyBar.visible=!0;var n=(this.holdBarMaxWidth-this.holdEnemyBar.width)/this.holdBarMaxWidth*this.holdBar.maximum;this.changeEnemyValue(this.holdBarMaxWidth,n/Math.abs(e)*1e3)}else 0==this.holdPlayerBar.width&&this.holdEnemyBar.width==this.holdBarMaxWidth&&(this.holdEnemyBar.visible=!0,egret.Tween.removeTweens(this.holdPlayerBar),egret.Tween.removeTweens(this.holdEnemyBar))},i.prototype.changePlayerValue=function(e,t){(this._lastTimeByPlayer!=t||0==e&&0==this.holdPlayerBar.width)&&(this._lastTimeByPlayer=t,egret.Tween.removeTweens(this.holdPlayerBar)),egret.Tween.get(this.holdPlayerBar).to({width:e},t).call(this.refreshProgress,this)},i.prototype.changeEnemyValue=function(e,t){(this._lastTimeByEnemy!=t||0==e&&0==this.holdEnemyBar.width)&&(egret.Tween.removeTweens(this.holdEnemyBar),this._lastTimeByEnemy=t),egret.Tween.get(this.holdEnemyBar).to({width:e},t).call(this.refreshProgress,this)},Object.defineProperty(i.prototype,"holdPlayerBar",{get:function(){return this.holdBar.playerBar},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"holdEnemyBar",{get:function(){return this.holdBar.enemyBar},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"holdBarMaxWidth",{get:function(){return this.holdBar.width-20},enumerable:!0,configurable:!0}),i.prototype.setPointMsg=function(t,i,n){this.setPointHighlight(!1);var o=e.FactionBattleController.getInstance().getCampItemDict();this.curKey=e.FactionBattleUtil.findKey(o,this),this.campStrongpointVO=e.JsonDataManager.instance.campStrongpointTemplate[this.curKey];var a=t.getCampType();this.nowCampType=a,this.setflagIcon(a);var s=[],r=[],l=t.getDragonPlayerList(),h=t.getTigerPlayerList(),c=t.getDragonProgress(),u=t.getTigerProgress();if(i==factionType.tiger)s=h,r=l,this.friendProgress=u,this.enemyProgress=c;else{if(i!=factionType.dragon)return;s=l,r=h,this.friendProgress=c,this.enemyProgress=u}this.initProgressValue(),this.headFriendGroup.removeChildren(),this.headEnemyGroup.removeChildren();var p=s.length;if(this.friendNum=p,this.interval_item||(this.interval_item=egret.setInterval(this.interValHook,this,this.addBaTimeLater/5)),p>0){this.friendNumLabel.visible=!0,this.friendNumLabel.text=p+"人",s.sort(function(e,t){return t.getBa()-e.getBa()});for(var g=0;p>g;g++){var d=s[g];if((d.getState()==playerStateType.reviving||d.getState()==playerStateType.death)&&this.friendNum--,d.getPlayerIdentify()==n){if(this.setPointHighlight(!0),e.FactionBattleController.getInstance().setPlayerState(d.getState()),(this.stateCdTime<=0||0==d.getStateCD())&&(this.stateCdTime=d.getStateCD()),this.setStateCdLabel(d.getState(),this.stateCdTime),e.FactionBattleController.getInstance().setPlayerPointId(t.getStrongPointId()),g>2){var f=(d.getPlayerItemId(),new e.AchieveRankingHeadItem);f.setHeadItem(headBoxType.jin,d.getPlayerItemId(),!0,!1,"",.31,.5),this.headFriendGroup.addChildAt(f,0),this.headFriendGroup.numChildren>3&&this.headFriendGroup.removeChildAt(3)}}else t.getStrongPointId()!=e.FactionBattleController.getInstance().getPlayerPointId()&&(this.stateGroup.visible=!1,this.stateCdTime=0,this.setStateCdLabel(playerStateType.normal,0));if(3>g){var f=(d.getPlayerItemId(),new e.AchieveRankingHeadItem);d.getPlayerIdentify()==n?f.setHeadItem(headBoxType.jin,d.getPlayerItemId(),!0,!1,"",.31,.5):f.setHeadItem(-1,d.getPlayerItemId(),!1,!1,"",.28,.45),this.headFriendGroup.numChildren<3&&this.headFriendGroup.addChild(f),d.getPlayerIdentify()==n&&this.headFriendGroup.setChildIndex(f,0)}}}else this.friendNumLabel.visible=!1,this.stateGroup.visible=!1,this.stateCdTime=0,this.setStateCdLabel(playerStateType.normal,0);if(p=r.length,this.enemyNum=p,this.interval_item||(this.interval_item=egret.setInterval(this.interValHook,this,this.addBaTimeLater)),p>0){this.enemyNumLabel.visible=!0,this.enemyNumLabel.text=p+"人",r.sort(function(e,t){return t.getBa()-e.getBa()});for(var g=0;p>g;g++){var d=r[g];if((d.getState()==playerStateType.reviving||d.getState()==playerStateType.death)&&this.enemyNum--,3>g){var f=(d.getPlayerItemId(),new e.AchieveRankingHeadItem);f.setHeadItem(-1,d.getPlayerItemId(),!1,!1,"",.28,.45),this.headEnemyGroup.addChild(f)}}}else this.enemyNumLabel.visible=!1;var m=-1;this.enemyNum>0&&this.friendNum>0&&(m=Pointstate.fighting),(this.protectedTime<=0||0==t.getProtectRemainTime())&&(this.protectedTime=t.getProtectRemainTime()),t.getProtectRemainTime()>0?(m=Pointstate.protect,this.protectTimeLabel.visible=!0,this.setRegistterTick(!0)):(this.stateCdTime<0&&this.setRegistterTick(!1),this.protectTimeLabel.visible=!1,this.refreshProgress()),this.setState(m)
},i.prototype.setRegistterTick=function(e){e?egret.startTick(this.update,this):egret.stopTick(this.update,this)},i.prototype.clearState=function(){this.stateGroup.visible=!1,this.stateCdTime=0,this.setStateCdLabel(playerStateType.normal,0)},i.prototype.update=function(t){return t-this.previosTime>=1e3&&(this.previosTime=t,this.protectedTime-=1e3,this.stateCdTime-=1e3),this.protectedTime<1e3&&(this.protectTimeLabel.visible=!1),this.stateCdTime<1e3&&(this.stateGroup.visible=!1),this.protectTimeLabel.text=e.GlobalUtil.getTimeString(this.protectedTime/1e3,2),this.stateCdLabel.text=this.stateName+e.GlobalUtil.getTimeString(this.stateCdTime/1e3,2),!1},i.prototype.setEnemyLabelscaleX=function(){this.enemyNumLabel.scaleX=-1,this.enemyNumLabel.right=void 0,this.enemyNumLabel.left=-5,this.friendNumLabel.scaleX=-1,this.friendNumLabel.left=void 0,this.friendNumLabel.right=-5,this.cityName.scaleX=-1,this.protectTimeLabel.scaleX=-1,this.popLabel.scaleX=-1,this.holdBar.scaleX=-1,this.headFriendGroup.scaleX=-1,this.headFriendGroup.horizontalCenter=80,this.headEnemyGroup.scaleX=-1,this.headEnemyGroup.horizontalCenter=-80,this.stateGroup.scaleX=-1},i.prototype.setHoldbarWidth=function(e){this.holdBar.width;this.holdBar.width=e,this.friendNumLabel.left=-30,this.enemyNumLabel.right=-30},i.prototype.setHolderMaxNum=function(e){this.holdBar.maximum=e},i.prototype.setHolderBarValue=function(e){this.holdBar.value=e,0==e&&(this.holdEnemyBar.width=0,this.holdPlayerBar.width=0)},i.prototype.setflagIcon=function(t){this.campType=t;var i=e.JsonDataManager.instance.campSourceInfoTemplate[t],n=i.smallIcon;this.flagIcon.source=n},i.prototype.getCamptype=function(){return this.campType},i.prototype.setcityIcon=function(e){this.sourceStr=e,this.cityIcon.source=e},i.prototype.setCityName=function(e){this.cityName.text=e},i.prototype.setState=function(t){this.curstate=t,this.jiaozhanAni&&(this.jiaozhanAni.clear(),this.jiaozhanAni=null),this.flagIcon.visible=!0,this.flagIconLeft.visible=this.flagIconRight.visible=!1;var i="";switch(t){case Pointstate.fail:i="fx_maoyan";break;case Pointstate.fighting:i="fx_zhaohuo",this.flagIcon.visible=!1,this.jiaozhanAni=new e.FoxAni(this.flagAniGroup),this.jiaozhanAni.play("fx_jiaozhan","ani");var n=e.JsonDataManager.instance.campSourceInfoTemplate,o="",a="";e.FactionBattleController.getInstance().getPlayerCampType()==factionType.dragon?(o=n[factionType.dragon].smallIcon,a=n[factionType.tiger].smallIcon):(a=n[factionType.dragon].smallIcon,o=n[factionType.tiger].smallIcon),this.flagIconLeft.source=o,this.flagIconRight.source=a,this.flagIconLeft.visible=this.flagIconRight.visible=!0;break;case Pointstate.protect:i="fx_fanghuzhao"}return 0>t?void(this.stateAni&&(this.stateAni.clear(),this.stateAni=null)):(this.stateAni||(this.stateAni=new e.FoxAni(this.aniGroup)),void this.stateAni.play(i,"ani"))},i.prototype.setFailState=function(t){if(t){var i="fx_maoyan";this.stateFailAni||(this.stateFailAni=new e.FoxAni(this.aniGroupFail)),this.stateFailAni.play(i,"ani")}else this.stateFailAni&&(this.stateFailAni.clear(),this.stateFailAni=null)},i.prototype.getState=function(){return this.curstate},i.prototype.showAddAchievementLabel=function(e,t){var i=this;return 0>=e?!1:(this.popLabel.textColor=t?16711680:2227971,this.popLabel.visible=!0,this.popLabel.text="+"+e,void egret.Tween.get(this.popLabel).to({y:-10},1e3).call(function(){i.popLabel.visible=!1,i.popLabel.y=50}))},i.prototype.setPointHighlight=function(e){if(this.cityIconHighlight.visible=e,e){var t=this.sourceStr,i=this.sourceStr.indexOf("_png");if(i>=0){var n=this.sourceStr.split("_png");t=n[0]+"_touch_png"}this.cityIconHighlight.source=t}},i.prototype.setStateCdLabel=function(t,i){switch(this.stateGroup.visible=!1,t){case playerStateType.repair:this.stateGroup.visible=!0,this.stateName="挑战修整：",this.setRegistterTick(!0);break;case playerStateType.reviving:this.stateGroup.visible=!0,this.stateName="复活修整：",this.setRegistterTick(!0)}var n=e.GlobalUtil.getTimeString(i/1e3,2);this.stateCdLabel.text=this.stateName+n},i}(eui.Button);e.FactionMapCityItem=t,__reflect(t.prototype,"foxgame.FactionMapCityItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"BattleSettlement")||this;return i.totalTime=5e3,i.previousTime=0,i.setIsShowBackBtn(!1),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClick,this)},i.prototype.showHook=function(){var e=this.model.campChallengeInfo;if(e){this.ui.factionJifenLabel.text=e.getCampAchieve().toString(),this.ui.personJifenLabel.text=e.getPersonalAchieve().toString();var t=e.getWinningTimes();t>0?this.ui.titleLabel.text="lz"+t+"r":this.ui.titleLabel.text="ybtd"}this.totalTime=5e3,this.previousTime=0,this.ui.confirmBtn.label="确定（5）"},i.prototype.tickHook=function(e){if(e-this.previousTime>1e3){this.previousTime=e,this.totalTime-=1e3;var t=Math.round(this.totalTime/1e3);t>=0?this.ui.confirmBtn.label="确定（"+t+"）":(console.log("自动关闭页面"),this.close())}return!1},i.prototype.showSettlement=function(t){e.FactionBattleController.getInstance().isFactionbattle=!1,e.FactionBattleController.getInstance().showFactionPanel(factionPanelType.mapPanel),this.setRegisterTick(!0),this.show(),this.setBg(t)},i.prototype.setBg=function(e){if(void 0===e&&(e=0),0==e){this.ui.titleIcon.source="shibaiwenzi_png";for(var t=this.ui.bgId.numChildren,i=0;t>i;i++){var n=this.ui.bgId.getChildAt(i);2>i?n.source="shibaidi1_png":4>i&&(n.source="shibaidi2_png")}}else{this.ui.titleIcon.source="shengliwenzi_png";for(var t=this.ui.bgId.numChildren,i=0;t>i;i++){var n=this.ui.bgId.getChildAt(i);2>i?n.source="shenlidi1_png":4>i&&(n.source="shenlidi2_png")}}},i.prototype.closeHook=function(){e.TipsController.getInstance().closeAllPanel()},i.prototype.onClick=function(e){this.setRegisterTick(!1),this.close()},i}(e.BasePanel);e.BattleSettlement=t,__reflect(t.prototype,"foxgame.BattleSettlement")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"FactionSettlement")||this;return i.totalTime=5e3,i.previousTime=0,i.model=e,i.setIsShowBackBtn(!1),i.isCallHideSceneObjectsWhenClose=!0,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showHook=function(){this.setRegisterTick(!0);var t=this.model.getCampBattleResult();if(t.getCampType()==this.model.myfactionType){this.ui.factionIcon.source=this.model.campSourceTemplate[this.model.myfactionType].flagIcon,this.ui.factionJifenLabel.text=t.getCampAchieve().toString(),this.ui.personJifenLabel.text=t.getMyAcheieve().toString(),this.ui.personRank.text=t.getRank().toString();var i=t.getRank(),n=t.getWin();this.setBgTitle(n);for(var o=this.model.factionRankAwardSource,a=o.length,s=[],r=0;a>r;r++){var l=o[r];Number(i)>=Number(l.rankStart)&&Number(i)<=Number(l.rankEnd)&&(s=l.awards)}this.ui.personitemGroup.removeChildren(),this.ui.factionitemGroup.removeChildren();for(var r=0;r<s.length;r++){var h=new e.AttributeVO(s[r]),c=new e.ItemIcon;c.setItem(h.id,h.value,!1),c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemClick,this),this.ui.personitemGroup.addChild(c)}var u=n?e.GlobalConfig.instance.getValue("CS_CAMP_WIN_AWARD"):e.GlobalConfig.instance.getValue("CS_CAMP_FAIL_AWARD"),p=u.split(",");if(p.length>0&&this.ui.factionitemGroup.numChildren<=0)for(var h=void 0,c=void 0,r=0;r<p.length;r++)h=new e.AttributeVO(p[r]),c=new e.ItemIcon,c.setItem(h.id,h.value,!1),c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemClick,this),this.ui.factionitemGroup.addChild(c)}this.totalTime=5e3,this.previousTime=0,this.ui.confirmBtn.label="确定（5）"},i.prototype.tickHook=function(e){if(e-this.previousTime>1e3){this.previousTime=e,this.totalTime-=1e3;var t=Math.round(this.totalTime/1e3);t>=0?this.ui.confirmBtn.label="确定（"+t+"）":(console.log("自动关闭页面"),this.close())}},i.prototype.setBgTitle=function(e){if(e){this.ui.titleIcon.source="shengliwenzi_png";for(var t=this.ui.bgId.numChildren,i=0;t>i;i++){var n=this.ui.bgId.getChildAt(i);2>i?n.source="shenlidi1_png":4>i&&(n.source="shenlidi2_png")}}else{this.ui.titleIcon.source="shibaiwenzi_png";for(var t=this.ui.bgId.numChildren,i=0;t>i;i++){var n=this.ui.bgId.getChildAt(i);2>i?n.source="shibaidi1_png":4>i&&(n.source="shibaidi2_png")}}},i.prototype.onClick=function(e){this.setRegisterTick(!1),this.close()},i.prototype.onRewardItemClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!0)},i}(e.BasePanel);e.FactionSettlement=t,__reflect(t.prototype,"foxgame.FactionSettlement")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CampRankAwardVO=t,__reflect(t.prototype,"foxgame.CampRankAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CampSourceVO=t,__reflect(t.prototype,"foxgame.CampSourceVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CampStrongpointVO=t,__reflect(t.prototype,"foxgame.CampStrongpointVO")}(foxgame||(foxgame={}));var CampTreasureVO=function(){function e(){}return e}();__reflect(CampTreasureVO.prototype,"CampTreasureVO");var foxgame;!function(e){var t=function(){function t(){this.lastTime=0,this.model=new e.FieldPKModel,this.pkPanel=new e.FieldPKPanel(this.model),this.recordPanel=new e.FieldPKRecordPanel(this.model),this.rewardPanel=new e.FieldPKRewardPanel(this.model),this.rankPanel=new e.FieldPKKillRankPanel(this.model),this.resultPanel=new e.FieldPKResultPanel(this.model),this.playerPanel=new e.FieldPKPlayerPanel}return t.prototype.registerMsg=function(t){t.add(e.Code.PK_INFO_S,this),t.add(e.Code.PK_LOG_S,this),t.add(e.Code.PK_PVALUE_CLEAN_S,this),t.add(e.Code.PK_REFRESH_OPPONENT_S,this),t.add(e.Code.PK_FIGHT_S,this),t.add(e.Code.PK_SEARCH_PINFO_S,this),t.add(e.Code.PK_PVALUE_CLEAN_S,this),t.add(e.MsgCMD.CLOSE_PANEL,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.CLOSE_PANEL:(0==i||1==i)&&(this.pkPanel&&this.pkPanel.getIsShow()&&this.pkPanel.close(),this.recordPanel&&this.recordPanel.getIsShow()&&this.recordPanel.close(),this.rewardPanel&&this.rewardPanel.getIsShow()&&this.rewardPanel.close(),this.rankPanel&&this.rankPanel.getIsShow()&&this.rankPanel.close(),this.resultPanel&&this.resultPanel.getIsShow()&&this.resultPanel.close(),this.playerPanel&&this.playerPanel.getIsShow()&&this.playerPanel.close());break;case e.Code.PK_INFO_S:this.receivePKInfos(i),e.MainControler.instance.refreshPKPlayer();break;case e.Code.PK_LOG_S:this.model.setPKRecord(i.getLogs());break;case e.Code.PK_PVALUE_CLEAN_S:this.model.setPKValue(i.getCurrentPkValue());break;case e.Code.PK_REFRESH_OPPONENT_S:this.model.resetPKPlayer(i.getOpponent()),e.MainControler.instance.refreshPKPlayer();break;case e.Code.PK_FIGHT_S:this.model.resultRank=i.getMyRank(),this.model.resultReward=i.getReward(),this.pkPanel.close(),this.requestPanelInfo();break;case e.Code.PK_SEARCH_PINFO_S:this.model.setKillRankInfo(i)}},t.prototype.receivePKInfos=function(e){this.model.setPKInfo(e);for(var t,i=e.getOpponents(),n=i.length,o=0;n>o;o++)if(t=i[o],t.getCd()>0)return egret.startTick(this.tickHandler,this),void(this.lastTime=egret.getTimer());egret.stopTick(this.tickHandler,this)},t.prototype.requestPanelInfo=function(){var t=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YEWAIPK);if(t){var i=HawkProtocolManager.newBuilder("JsProto.PKInfoReq");e.Message.instance.send(e.Code.PK_INFO_C,i,!0)}},t.prototype.requestSingleInfo=function(t,i){var n=new e.AttributeVO(e.GlobalConfig.instance.getValue("PK_REFRESH_COST"));if(n.type==e.AttributeType.DIAMOND){if(e.PlayerService.instance.playerInfo.getGold()<n.value)return void(this.pkPanel.getIsShow()&&e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"));if(i){var o=e.LanguageUtils.instance.getValue("PKREFRESHPLAYER",n.value);e.PopUpController.getInstance().showTextPanel(o,this,this.confirmSingleInfo,t)}else this.confirmSingleInfo(t)}},t.prototype.confirmSingleInfo=function(t){var i=HawkProtocolManager.newBuilder("JsProto.PKRefreshOpponentReq");i.setIndex(t),e.Message.instance.send(e.Code.PK_REFRESH_OPPONENT_C,i,!0)},t.prototype.requestPKLog=function(){var t=HawkProtocolManager.newBuilder("JsProto.PKLogReq");e.Message.instance.send(e.Code.PK_LOG_C,t,!0)},t.prototype.requestKillRankPlayerInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.PKRankPlayerInfoReq");e.Message.instance.send(e.Code.PK_SEARCH_PINFO_C,t,!0)},t.prototype.requestStartFight=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.PKStartReq");n.setType(t),e.BattleScene.instance.lastMapFieldPKRequestType=t,n.setParam(i),1==t&&e.BattleScene.instance.requestMapPkTypeOneOffencesDffencesPositionInfo(n),e.Message.instance.send(e.Code.PK_FIGHT_C,n,!0)},t.prototype.requestClearPKValue=function(){function t(){var t=HawkProtocolManager.newBuilder("JsProto.PKCleanPkValueReq");e.Message.instance.send(e.Code.PK_PVALUE_CLEAN_C,t,!0)}if(!(this.model.pkValue<=0)){var i=new e.AttributeVO(e.GlobalConfig.instance.getValue("PK_PVALUE_CLEAN_COST"));return e.PlayerService.instance.playerInfo.getGold()<i.value?void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("PKZHIQINGKONG",i.value),this,t)}},t.prototype.tickHandler=function(e){var t=e-this.lastTime;if(!(1e3>t)){this.lastTime=e;for(var i,n,o,a=this.model.pkItemInfoList.length,s=0;a>s;s++)n=this.model.pkItemInfoList[s],i=n.getCd(),0!=i&&(o=i-t,0>o&&(o=0,this.requestSingleInfo(n.getIndex(),!1)),n.setCd(o));return this.pkPanel.tick(e),!1}},t.prototype.showPKPanel=function(){var t=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YEWAIPK);if(!t){var i=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YEWAIPK);return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("PKOPEN",i)),!1}return this.pkPanel.show(),!0},t.prototype.closePKPanel=function(){this.pkPanel.close()},t.prototype.showPkRewardPanel=function(){this.rewardPanel.show()},t.prototype.showFieldPKKillRankPanel=function(){this.requestKillRankPlayerInfo(),this.rankPanel.show()},t.prototype.showFieldPKRecordPanel=function(){this.requestPKLog(),this.recordPanel.show()},t.prototype.showResultPanel=function(e,t,i,n){this.model.resultType=e,this.model.resultCoin=t,this.model.resultExp=i,this.model.resultHonor=n,this.resultPanel.show()},t.prototype.showPlayerPanel=function(e){this.playerPanel.showPanel(e)},t.prototype.getPKPlayerList=function(){return this.model.pkItemInfoList},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();e.FieldPKController=t,__reflect(t.prototype,"foxgame.FieldPKController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.skinName="FieldPKItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isInit=!0,null!=this.pkItemInfo&&this.setItem(this.pkItemInfo),this.refreshBtn.touchEnabled=this.challengeBtn.touchEnabled=!0,this.challengeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.challengeHandler,this),this.refreshBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refreshHandler,this)},i.prototype.setItem=function(e){this.pkItemInfo=e,this.refresh()},i.prototype.refresh=function(){if(0!=this.isInit&&null!=this.pkItemInfo){this.clear();var t=this.pkItemInfo.getPlayer(),i=new e.AttributeVO(e.GlobalConfig.instance.getValue("PK_REFRESH_COST"));if(i.type!=e.AttributeType.DIAMOND)throw new Error("Consumption type Error");if(this.priceLabel.text=i.value+"",null!=t){var n=t.getRoles()[0];this.playerGroup.visible=!0,this.challengeBtn.visible=!0;var o=this.getRoleTemplate()[n.getItemId()];this.headImg.source=o.icon,this.nameLabel.text="LV."+t.getPlayerInfo().getLevel()+" "+n.getName();var a=Number(e.GlobalConfig.instance.getValue("PK_READ_THRESHOLD_VALUE"));this.nameLabel.textColor=t.getPlayerInfo().getPkValue()>=a?16711680:16777215,this.honerLabel.text=t.getPlayerInfo().getHonorValue()+"",this["professionImg"+n.getProf()].visible=!0}else{this.headImg.source=null,this.nobodyGroup.visible=!0,this.refreshBtn.visible=!0,this.priceGroup.visible=!0;var s=Math.floor(this.pkItemInfo.getCd()/1e3);this.timeLabel.text=e.GlobalUtil.getTimeString(s)}}},i.prototype.clear=function(){this.professionImg1.visible=!1,this.professionImg2.visible=!1,this.professionImg3.visible=!1,this.playerGroup.visible=!1,this.nobodyGroup.visible=!1,this.refreshBtn.visible=!1,this.challengeBtn.visible=!1,this.priceGroup.visible=!1},i.prototype.tickHandler=function(e){this.refresh()},i.prototype.challengeHandler=function(t){e.FieldPKController.getInstance().requestStartFight(1,this.pkItemInfo.getIndex()),e.FieldPKController.getInstance().closePKPanel(),e.MainControler.instance.turnYeWaiViewFormPk(),e.MainControler.instance.jingjiPvpChangeUI(),31==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidefun()},i.prototype.refreshHandler=function(t){e.FieldPKController.getInstance().requestSingleInfo(this.pkItemInfo.getIndex(),!0)},i.prototype.getRoleTemplate=function(){return e.JsonDataManager.instance.roleTemplate},i.prototype.getchallengeBtn=function(){return this.challengeBtn},i.prototype.getPKRefreshTotalTime=function(){return Number(e.GlobalConfig.instance.getValue("PK_REFRESH_CD"))},i}(eui.Component);e.FieldPKItem=t,__reflect(t.prototype,"foxgame.FieldPKItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fieldPK/FieldPKKillRank.exml")||this;return i.isMask=!0,i.model=e,i.model.registerObserver(i),i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.rewardLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rewardHandler,this);for(var e,t=this.getBtnImgList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.avatarHandler,this);var o=this.getChallengeBtnList();i=o.length;for(var a,n=0;i>n;n++)a=o[n],a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.challengeHandler,this);this.ui.rewardLabel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.ui.rewardLabel.text+"</u>")},i.prototype.refresh=function(){this.clear();for(var e,t,i,n,o=this.model.killRankInfos,a=o.length,s=this.getRankItemList(),r=this.getBtnImgList(),l=this.getChallengeBtnList(),h=0;a>h;h++)e=o[h],t=e.getInfo(),i=e.getRank(),null!=t&&(n=s[h],n.setItem(i,t),n.visible=!0,r[h].visible=null!=t,l[h].visible=e.getFightAble())},i.prototype.clear=function(){for(var e,t=this.getRankItemList(),i=t.length,n=0;i>n;n++)e=t[n],e.setItem(-1,null),e.visible=!1;var o,a=this.getBtnImgList();i=a.length;for(var n=0;i>n;n++)o=a[n],o.visible=!1;var s,r=this.getChallengeBtnList();i=r.length;for(var n=0;i>n;n++)s=r[n],s.visible=!1},i.prototype.updateKillRankView=function(){this.refresh()},i.prototype.updateView=function(){},i.prototype.avatarHandler=function(t){var i=this.getBtnImgList().indexOf(t.currentTarget),n=this.model.killRankInfos[i].getInfo();null!=n&&e.OtherCharacterController.getInstance().showOtherCharacterPanel(n.getPlayerId())},i.prototype.challengeHandler=function(t){var i=this.getChallengeBtnList().indexOf(t.currentTarget),n=this.model.killRankInfos[i],o=n.getInfo().getPlayerId();return o==e.PlayerService.instance.playerInfo.getPlayerId()?void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("NOPKSELF")):(e.FieldPKController.getInstance().requestStartFight(3,i),e.MainControler.instance.turnYeWaiViewFormPk(),e.MainControler.instance.jingjiPvpChangeUI(),void this.close())},i.prototype.rewardHandler=function(t){e.FieldPKController.getInstance().showPkRewardPanel()},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("FIELDPKHELP")},i.prototype.getRankItemList=function(){var e=[];return e.push(this.ui.rankItem0),e.push(this.ui.rankItem1),e.push(this.ui.rankItem2),e},i.prototype.getBtnImgList=function(){var e=[];return e.push(this.ui.btnImg0),e.push(this.ui.btnImg1),e.push(this.ui.btnImg2),e},i.prototype.getChallengeBtnList=function(){var e=[];return e.push(this.ui.challengeBtn0),e.push(this.ui.challengeBtn1),e.push(this.ui.challengeBtn2),e},i}(e.BasePanel);e.FieldPKKillRankPanel=t,__reflect(t.prototype,"foxgame.FieldPKKillRankPanel",["foxgame.IFieldPKObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.recordList=[],this.killRankInfos=[],this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.setPKInfo=function(e){this.pkHonor=e.getPkHonor(),this.pkValue=e.getPkValue(),this.myRank=e.getMyRank(),this.pkItemInfoList=e.getOpponents(),this.pkItemInfoList.sort(this.sortPlayer),this.updateView()},e.prototype.resetPKPlayer=function(e){for(var t,i=this.pkItemInfoList.length,n=0;i>n;n++)t=this.pkItemInfoList[n],t.getIndex()==e.getIndex()&&(t.setCd(e.getCd()),t.setIndex(e.getIndex()),t.setPlayer(e.getPlayer()));this.updateView()},e.prototype.setKillRankInfo=function(e){this.killRankInfos=e.getInfos();for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.updateKillRankView()},e.prototype.setPKValue=function(e){this.pkValue=e,this.updateView()},e.prototype.setPKRecord=function(e){this.recordList=e,this.updateView()},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e.prototype.sortPlayer=function(e,t){return e.getIndex()<t.getIndex()?-1:e.getIndex()==t.getIndex()?0:e.getIndex()>t.getIndex()?1:void 0},e}();e.FieldPKModel=t,__reflect(t.prototype,"foxgame.FieldPKModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fieldPK/FieldPK.exml","fieldPKGroup")||this;return i.model=e,i.model.registerObserver(i),i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.rankBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankHandler,this),this.ui.recordBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.recordHandler,this),this.ui.clearLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clearHandler,this),this.ui.clearLabel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.ui.clearLabel.text+"</u>");for(var t,i=this.getRewardList(),n=i.length,o=0;n>o;o++)t=i[o],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rewardClickHandler,this);this.doScreenAdaptation(),31==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.getPlayerList()[0].getchallengeBtn(),this.getPlayerList()[0].getchallengeBtn().parent,31,3,!0)},i.prototype.showHook=function(){e.FieldPKController.getInstance().requestPanelInfo()},i.prototype.refresh=function(){if(this.ui.currency.refresh(),null!=this.model.pkHonor){var t=e.PlayerService.instance.mainRoleData,i=this.model.myRank;this.ui.rankLabel.text=-1==i?e.LanguageUtils.instance.getValue("WEISHANGBANG"):i+"",this.ui.headImg.source=t.headUrl,this.ui.nameLabel.text="LV."+e.PlayerService.instance.level+" "+t.name,this.ui.fightLabel.text=e.PlayerService.instance.fightValue+"",this.ui.honorLabel.text=this.model.pkHonor.toString(),this.ui.pkLabel.text=this.model.pkValue.toString();for(var n,o,a=this.getRewardList(),s=a.length,r=this.tempPkRankPrize[i],l=0;s>l;l++)n=a[l],null!=r?(o=r.prizeList[l],n.setItem(o.id,o.value,!1)):n.setItem(-1);for(var h,c=this.getProfessionImgList(),u=c.length,l=0;u>l;l++)h=c[l],h.visible=l==t.profession-1;var p=this.getPlayerList();s=p.length;for(var g,l=0;s>l;l++)g=p[l],g.setItem(this.model.pkItemInfoList[l])}},i.prototype.updateView=function(){this.refresh()},i.prototype.updateKillRankView=function(){},i.prototype.tick=function(e){if(this.getIsShow())for(var t,i=this.getPlayerList(),n=i.length,o=0;n>o;o++)t=i[o],t.tickHandler(e)},i.prototype.rewardClickHandler=function(t){var i=this.getRewardList(),n=i.indexOf(t.target),o=this.tempPkRankPrize[this.model.myRank];if(null!=o){var a=o.prizeList[n];null!=a&&e.TipsController.getInstance().showItemTips(a.id,a.value)}},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("FIELDPKHELP")},i.prototype.rankHandler=function(t){e.FieldPKController.getInstance().showFieldPKKillRankPanel()},i.prototype.recordHandler=function(t){e.FieldPKController.getInstance().showFieldPKRecordPanel()},i.prototype.clearHandler=function(t){e.FieldPKController.getInstance().requestClearPKValue()},i.prototype.backHandler=function(){this.close(),e.WanFaController.getInstance().showPanel()},Object.defineProperty(i.prototype,"tempPkRankPrize",{get:function(){return e.JsonDataManager.instance.PKRankPrizeTemplate},enumerable:!0,configurable:!0}),i.prototype.getProfessionImgList=function(){var e=[];return e.push(this.ui.professionImg1),e.push(this.ui.professionImg2),e.push(this.ui.professionImg3),e},i.prototype.getRewardList=function(){var e=[];return e.push(this.ui.rewardItem0),e.push(this.ui.rewardItem1),e.push(this.ui.rewardItem2),e},i.prototype.getPlayerList=function(){var e=[];return e.push(this.ui.playerItem0),e.push(this.ui.playerItem1),e.push(this.ui.playerItem2),e.push(this.ui.playerItem3),e},i}(e.BasePanel);e.FieldPKPanel=t,__reflect(t.prototype,"foxgame.FieldPKPanel",["foxgame.IFieldPKObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FieldPKPlayer",e}return __extends(i,t),i.prototype.setItem=function(t){this.info=t;var i=t.getPlayer().getRoles()[0].getItemId(),n=e.JsonDataManager.instance.roleTemplate[i];this.headImg.source=n.icon},i}(e.CommonAniButton);e.FieldPKPlayer=t,__reflect(t.prototype,"foxgame.FieldPKPlayer")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/fieldPK/FieldPKPlayerPanel.exml")||this;return e.isMask=!1,e.isMaskdown=!0,e.adaptionType=1,e}return __extends(i,t),i.prototype.showPanel=function(e){this.info=e,this.show()},i.prototype.initHook=function(){if(this.ui.challengeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.challengeHandler,this),this.doScreenAdaptation(),31==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz){var t=this.ui.challengeBtn,i={x:t.x,y:t.y,width:148,height:50};e.MainControler.instance.guidechange(i,t.parent,31,6,!0)}},i.prototype.refresh=function(){this.ui.currency.refresh();var t=this.info.getPlayer().getRoles()[0],i=new e.RoleData;i.setRoleInfo(t),e.CharacterController.getInstance().showcharavatar(this.ui.avatar,i);for(var n,o=this.info.getPlayer().getPlayerInfo(),a=this.getProfImgList(),s=a.length,r=0;s>r;r++)n=a[r],n.visible=t.getProf()-1==r;var l=o.getLevel();this.ui.nameLabel.text=t.getName()+" Lv."+l,this.ui.vipImg.source="u_vip"+o.getVipLevel()+"_png",this.ui.honorLabel.text=o.getHonorValue()+"";var h=e.JsonDataManager.instance.PKPrizeTemplate[l];s=h.prizeList.length;for(var c,r=0;s>r;r++)c=h.prizeList[r],c.type==e.AttributeType.COIN?this.ui.coinLabel0.text=c.value+"":c.type==e.AttributeType.EXP?this.ui.expLabel0.text=c.value+"":c.type==e.AttributeType.PKHONOR&&(this.ui.honorLabel0.text=c.value+"");var u,p=Number(e.GlobalConfig.instance.getValue("PK_READ_THRESHOLD_VALUE")),g=0,d=Number(e.GlobalConfig.instance.getValue("PK_HONOR_PLUNDER_MAX")),f=Number(e.GlobalConfig.instance.getValue("PK_HONOR_PLUNDER_RATE")),m=Number(e.GlobalConfig.instance.getValue("PK_COIN_PLUNDER_MAX")),y=Number(e.GlobalConfig.instance.getValue("PK_COIN_PLUNDER_RATE"));o.getPkValue()>p?(u=Math.ceil(o.getHonorValue()*f*2),u=u>d?d:u,g=Math.ceil(o.getCoin()*y),g=g>m?m:g):(u=Math.ceil(o.getHonorValue()*f),u=u>d?d:u),this.ui.honorLabel1.text=u+"",this.ui.coinLabel1.text=g+""},i.prototype.challengeHandler=function(t){e.FieldPKController.getInstance().requestStartFight(1,this.info.getIndex()),e.MainControler.instance.turnYeWaiViewFormPk(),e.MainControler.instance.jingjiPvpChangeUI(),this.close()},i.prototype.getProfImgList=function(){var e=[];return e.push(this.ui.professionImg1),e.push(this.ui.professionImg2),e.push(this.ui.professionImg3),e},i}(e.BasePanel);e.FieldPKPlayerPanel=t,__reflect(t.prototype,"foxgame.FieldPKPlayerPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FieldPKRankItem",e.touchEnabled=e.touchChildren=!1,e}return __extends(i,t),i.prototype.setItem=function(t,i){if(null!=i){var n=i.getRoles()[0],o=new e.RoleData;o.setRoleInfo(n),e.CharacterController.getInstance().showcharavatar(this.avatar,o),this.honorLabel.text=i.getPlayerInfo().getHonorValue()+"",this.nameLabel.text=i.getRoles()[0].getName();var a=Number(e.GlobalConfig.instance.getValue("PK_READ_THRESHOLD_VALUE"));switch(this.nameLabel.textColor=i.getPlayerInfo().getPkValue()>=a?16711680:16777215,this.oneImg.visible=!1,this.twoImg.visible=!1,this.threeImg.visible=!1,t){case 1:this.oneImg.visible=!0;break;case 2:this.twoImg.visible=!0;break;case 3:this.threeImg.visible=!0}}},i.prototype.clear=function(){this.nameLabel.text=""},i}(eui.Component);e.FieldPKRankItem=t,__reflect(t.prototype,"foxgame.FieldPKRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.htmlParser=new egret.HtmlTextParser,e.skinName="BattleRecordItem",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),this.touchEnabled=this.touchChildren=!1},i.prototype.setItem=function(t){this.pkLog=t;var i,n=Number(this.pkLog.getId()),o=new Date(n),a=o.getMonth()+1,s=o.getDate(),r=o.getHours(),l=o.getMinutes(),h=t.getType(),c=t.getResult(),u=t.getCoinChange(),p=t.getPkHonorChange(),g=t.getRedName(),d=t.getOpponentName();1==h?1==c?i=e.LanguageUtils.instance.getValue("FIELDPKLOGITEM2",a,s,r,l,d,p,u):2==c&&(i=g?e.LanguageUtils.instance.getValue("FIELDPKLOGITEM3",a,s,r,l,d,u):e.LanguageUtils.instance.getValue("FIELDPKLOGITEM1",a,s,r,l,d)):2==h&&(i=u>0?e.LanguageUtils.instance.getValue("FIELDPKLOGITEM5",a,s,r,l,d,p,u):e.LanguageUtils.instance.getValue("FIELDPKLOGITEM4",a,s,r,l,d,p)),this.contentLabel.textFlow=this.htmlParser.parse(i)},i}(eui.Component);e.FieldPKRecordItem=t,__reflect(t.prototype,"foxgame.FieldPKRecordItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fieldPK/BattleRecordPanel.exml")||this;return i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.scroller.verticalScrollBar.autoVisibility=!1},i.prototype.refresh=function(){this.ui.contentGroup.removeChildren();for(var t,i=this.model.recordList,n=i.length,o=0;n>o;o++)t=new e.FieldPKRecordItem,t.setItem(i[o]),t.y=t.height*o,this.ui.contentGroup.addChild(t)},i.prototype.updateView=function(){this.refresh()},i.prototype.updateKillRankView=function(){},i}(e.BasePanel);e.FieldPKRecordPanel=t,__reflect(t.prototype,"foxgame.FieldPKRecordPanel",["foxgame.IFieldPKObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fieldPK/FieldPKResultPanel.exml")||this;return i.columnNum=4,i.isMask=!0,i.setRegisterTick(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandler,this)},i.prototype.initParams=function(){this.model.resultLastTime=egret.getTimer(),this.model.resultShowTime=Number(e.GlobalConfig.instance.getValue("FIELDPKRESULTTIME")),this.gapX=Number(e.GlobalConfig.instance.getValue("RESULTREWARDDISX")),this.gapY=Number(e.GlobalConfig.instance.getValue("RESULTREWARDDISY"))
},i.prototype.getIconPos=function(e,t){var i=new egret.Point,n=Math.floor(t/this.columnNum),o=t%this.columnNum;return i.x=o*(e+this.gapX),i.y=n*(e+this.gapY),i},i.prototype.refresh=function(){if(this.ui.fightResultScroller.verticalScrollBar.autoVisibility=!1,this.ui.fightResultScroller.viewport.scrollV=0,this.ui.contentGroup.removeChildren(),this.model.resultReward){this.itemArr=[],this.voArr=[];var t=0,i=[],n=0,o=this.model.resultReward.getDrop().getDetailEquip(),a=this.model.resultReward.getDrop().getItem();for(n=o.length,t;n>t;t++){var s=o[t],r=new Object;r.id=s.getItemId(),r.count=s.getCount(),i.push(r)}for(t=0,n=a.length,t;n>t;t++){var l=a[t],r=new Object;r.id=l.getItemId(),r.count=l.getItemCount(),i.push(r)}t=0,n=i.length;var h=void 0,c=void 0;for(t;n>t;t++){var u=i[t];h=new e.ItemIcon,h.setItem(u.id,u.count,!1),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),c=this.getIconPos(h.width,t),h.x=c.x,h.y=c.y+this.gapY,this.ui.contentGroup.addChild(h),this.itemArr.push(h),this.voArr.push(u)}}var p=this.ui.successImg,g=this.ui.failureImg,d=this.ui.succLabel,f=this.ui.failLabel;0==this.model.resultType?(p.visible=!1,g.visible=!0,d.visible=!1,f.visible=!0):(p.visible=!0,g.visible=!1,d.visible=!0,f.visible=!1);var m=this.model.resultRank<=0?e.LanguageUtils.instance.getValue("WEISHANGBANG"):this.model.resultRank+"";this.ui.rankLabel.text=m,this.ui.myHonorLabel.text=e.PlayerService.instance.playerInfo.getHonorValue()+"",this.ui.coinLabel.text=this.model.resultCoin+"",this.ui.expLabel.text=this.model.resultExp+"",this.ui.honorLabel.text=this.model.resultHonor+"",this.ui.timeLabel.text=this.model.resultShowTime+"",31==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.confirmBtn,this.ui.confirmBtn.parent,31,4,!0),31==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.confirmBtn,this.ui.confirmBtn.parent,31,7,!0)},i.prototype.onClick=function(t){var i,n=0,o=this.itemArr.length;for(n;o>n;n++){var a=this.itemArr[n];if(a==t.target){var s=this.voArr[n];i=e.JsonDataManager.instance.itemTemplate[s.id],e.ActivityController.getIntance().showTipsByItemOrEquip(s.id,i.type,s.count);break}}},i.prototype.closeHook=function(){31==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz?e.MainControler.instance.guidefun():31==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz&&(e.MainControler.instance.guidefun(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),e.TipsController.getInstance().closeAllPanel(),e.FieldPKController.getInstance().showPKPanel()},i.prototype.tickHook=function(e){var t=e-this.model.resultLastTime;if(!(1e3>t)){if(this.model.resultLastTime=e,this.model.resultShowTime<=0)return void this.close();this.model.resultShowTime--,this.ui.timeLabel.text=this.model.resultShowTime+""}},i.prototype.confirmHandler=function(e){this.close()},i}(e.BasePanel);e.FieldPKResultPanel=t,__reflect(t.prototype,"foxgame.FieldPKResultPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="FieldPKRewardItem",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),this.touchEnabled=this.touchChildren=!0,this.itemList=[this.item0,this.item1,this.item2]},i.prototype.setItem=function(e){var t,i,n=this.tempPKRankReward[e],o=this.itemList.length;this.firstImg.visible=1==e,this.secondImg.visible=2==e,this.thirdImg.visible=3==e,this.otherImg.visible=e>3,this.bmpLabel.text=e+"";for(var a=0;o>a;a++)t=this.itemList[a],i=n.prizeList[a],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.show,this),null!=i?t.setItem(i.id,i.value):t.setItem(-1)},i.prototype.show=function(t){var i=e.JsonDataManager.instance.itemTemplate,n=t.target.parent.itemId,o=i[n];o.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:n}):e.TipsController.getInstance().showItemTips(n)},Object.defineProperty(i.prototype,"tempPKRankReward",{get:function(){return e.JsonDataManager.instance.PKRankPrizeTemplate},enumerable:!0,configurable:!0}),i}(eui.Component);e.FieldPKRewardItem=t,__reflect(t.prototype,"foxgame.FieldPKRewardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fieldPK/FieldPKReward.exml")||this;return i.isMask=!0,i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.initView(),this.ui.scroller.verticalScrollBar.autoVisibility=!1},i.prototype.refresh=function(){},i.prototype.initView=function(){for(var t,i=this.ui.contentGroup,n=0;n<this.getDisplayNum();n++)t=new e.FieldPKRewardItem,t.setItem(n+1),i.addChild(t),t.y=t.height*n},i.prototype.getDisplayNum=function(){return Number(e.GlobalConfig.instance.getValue("FIELDPKSHOWREWARDNUM"))},i}(e.BasePanel);e.FieldPKRewardPanel=t,__reflect(t.prototype,"foxgame.FieldPKRewardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.skinName="skins.fight.FightOffLineSkin",e.PopUpManager.instance.registerWindow(e.WindowName.FIGHTOFFLINE,i,i),i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.doScreenAdaptation()},i.prototype.show=function(t){e.PopUpManager.instance.addPopUp(e.WindowName.FIGHTOFFLINE,e.WindowName.UILAYER,5,!0),this.setData(t),Log.trace(t)},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.FIGHTOFFLINE)},i.prototype.clear=function(){},i.prototype.createChildren=function(){t.prototype.createChildren.call(this)},i.prototype.setData=function(e){},i.prototype.btnClick=function(e){this.close()},i}(e.ViewControler);e.FightOffLineControler=t,__reflect(t.prototype,"foxgame.FightOffLineControler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.EquipType=1]="EquipType",e[e.GemType=2]="GemType",e[e.FeatherType=3]="FeatherType",e[e.SpecialRingType=4]="SpecialRingType",e[e.personBossType=5]="personBossType"}(t=e.FuBenType||(e.FuBenType={}));var i=function(){function i(){this.model=new e.FuBenModel,this.panel=new e.FuBenPanel(this.model)}return i.getInstance=function(){return null==this.instance&&(this.instance=new i),this.instance},i.prototype.getFuBtnType=function(){return this.model.tabType},i.prototype.showPanel=function(i){var n=!1,o="",a=0;return i==t.EquipType?(n=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEIFUBEN),a=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEIFUBEN),o="ZHANGBEIFUBEN_SHOW_LEVEL_TIP"):i==t.GemType?(n=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.BAOSHIFUBEN),a=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.BAOSHIFUBEN),o="BAOSHIFUBEN_SHOW_LEVEL_TIP"):i==t.FeatherType?(n=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YUMAOFUBEN),a=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YUMAOFUBEN),o="FUBEN_SHOW_LEVEL_TIP"):i==t.SpecialRingType&&(n=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.TEJIEFUEBN,!1),a=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.TEJIEFUEBN),o="TEJIEFUBEN_SHOW_LEVEL_TIP"),n?(this.model.tabType=i,void this.panel.show()):void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue(o,a))},i.prototype.changeGemFbFlush=function(){0!=this.panel.getIsShow()&&this.panel.changeGemFbFlush()},i.prototype.sendBuyShopItem=function(){0!=this.panel.getIsShow()&&this.panel.sendBuyShopItem()},i.prototype.closePanel=function(){this.panel.close()},i.prototype.closeguide=function(){this.panel.guideshow()},i.prototype.refreshTopLable=function(){0!=this.panel.getIsShow()&&this.panel.refreshTopLable()},i.prototype.getfubenredimg=function(){return this.panel.refreshredpoint(t.EquipType)?!0:this.panel.refreshredpoint(t.GemType)?!0:this.panel.refreshredpoint(t.FeatherType)?!0:this.panel.refreshredpoint(t.SpecialRingType)?!0:!1},i.prototype.getFuBenItemNum=function(){return this.panel?this.panel.getFuBenItemCount():null},i}();e.FuBenController=i,__reflect(i.prototype,"foxgame.FuBenController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FuBenItem",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);this.data},t}(eui.ItemRenderer);e.FuBenItem=t,__reflect(t.prototype,"foxgame.FuBenItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.FuBenItemData=t,__reflect(t.prototype,"foxgame.FuBenItemData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.collection=new eui.ArrayCollection}return t.prototype.getFeatherData=function(){var t=(e.PlayerService.instance.playerStateInfo.getDailyCopyState(),e.JsonDataManager.instance.mapByGroupTemplate),i=(e.PlayerService.instance.level,t[e.FuBenType.FeatherType]),n=[];i.length;return n},t}();e.FuBenModel=t,__reflect(t.prototype,"foxgame.FuBenModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fight/FuBenSkin.exml","dailyFuBen",!1)||this;return i.equipItemHeight=153,i.equipItemGap=4,i.showEquipInfos=new Array,i.showEquipInfosOver=new Array,i.equipType=0,i.model=e,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){for(var t,i=this.getTabBtnList(),n=i.length,o=0;n>o;o++)t=i[o],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabClickHandler,this);this.ui.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addHandler,this),e.Message.instance.add(e.MsgCMD.DAILY_COPY_INFO,this),e.Message.instance.add(e.Code.BOSS_WIPE_S,this);var a=this.ui.list;a.itemRenderer=e.EquipDungenItemRender,this.collection=new eui.ArrayCollection,a.dataProvider=this.collection,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.doScreenAdaptation()},i.prototype.initParams=function(){this.changeView(this.model.tabType)},i.prototype.refresh=function(){this.ui.currency.refresh(),this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState(),this.ui.featherBtn.currentState="up",this.ui.equipBtn.currentState="up",this.ui.gemBtn.currentState="up",this.ui.specialRingBtn.currentState="up",this.model.tabType==e.FuBenType.FeatherType?this.ui.featherBtn.currentState="down":this.model.tabType==e.FuBenType.EquipType?this.ui.equipBtn.currentState="down":this.model.tabType==e.FuBenType.GemType?this.ui.gemBtn.currentState="down":this.model.tabType==e.FuBenType.SpecialRingType&&(this.ui.specialRingBtn.currentState="down")},i.prototype.showHook=function(){this.guideshow()},i.prototype.guideshow=function(){if(this.ui){var t=StageFrameControl.instance.getBackBtn();27==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&(this.show(),e.MainControler.instance.guidechange(t,t.parent,27,7,!0)),29==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.equipBtn,this.ui.equipBtn.parent,29,2,!0),29==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(t,t.parent,29,5,!0),32==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.gemBtn,this.ui.gemBtn.parent,32,2,!0),32==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(t,t.parent,32,5,!0),35==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.specialRingBtn,this.ui.specialRingBtn.parent,35,2,!0),35==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(t,t.parent,35,5,!0)}},i.prototype.tabClickHandler=function(t){var i,n=t.currentTarget;this.ui.scroller.stopAnimation(),this.ui.scroller.viewport.scrollH=0,n==this.ui.featherBtn?i=e.FuBenType.FeatherType:n==this.ui.equipBtn?i=e.FuBenType.EquipType:n==this.ui.gemBtn?i=e.FuBenType.GemType:n==this.ui.specialRingBtn&&(i=e.FuBenType.SpecialRingType),this.changeView(i)},i.prototype.changeView=function(t){this.model.tabType=t,e.EquipDungenManager.instance.setFightType(this.model.tabType);var i,n;if(t==e.FuBenType.FeatherType){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YUMAOFUBEN),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YUMAOFUBEN),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("FUBEN_SHOW_LEVEL_TIP",n));this.initDataByDungeonType(e.FuBenType.FeatherType)}else if(this.model.tabType==e.FuBenType.EquipType){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEIFUBEN),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEIFUBEN),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHANGBEIFUBEN_SHOW_LEVEL_TIP",n));this.initDataByDungeonType(e.FuBenType.EquipType)}else if(this.model.tabType==e.FuBenType.GemType){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.BAOSHIFUBEN),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.BAOSHIFUBEN),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BAOSHIFUBEN_SHOW_LEVEL_TIP",n));this.flushGemDungen()}else if(this.model.tabType==e.FuBenType.SpecialRingType){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.TEJIEFUEBN,!1),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.TEJIEFUEBN),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("TEJIEFUBEN_SHOW_LEVEL_TIP",n));this.flushPreRing()}this.refresh()},i.prototype.readyDestroy=function(){this.ui.list.dataProvider=null},i.prototype.closeHook=function(){32==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&e.MainControler.instance.guidefun(),35==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&e.MainControler.instance.guidefun(),27==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),29==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.addHandler=function(e){this.sendBuyShopItem()},i.prototype.sendBuyShopItem=function(){e.ShopMainControler.getInstance().showBuyItemPanel(this.itemId)},i.prototype.getTabBtnList=function(){var e=[];return e.push(this.ui.featherBtn),e.push(this.ui.equipBtn),e.push(this.ui.gemBtn),e.push(this.ui.specialRingBtn),e},i.prototype.getVipFightNum=function(t){for(var i,n=e.PlayerService.instance.vipLevel,o=e.JsonDataManager.instance.vipTemplate,a=o[n],s=0;s<a.copyTimes.length;++s){i=a.copyTimes[s];var r=i[0],l=i[1],h=i[2];if(t>=r&&l>=t)return h}return 0},i.prototype.getVipFightSurplusNum=function(t){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();for(var i=0;i<this.dailyCopyInfo.length;++i)if(t==this.dailyCopyInfo[i].getMapId()){var n=this.dailyCopyInfo[i].getUseTimes();return n}return 0},i.prototype.getVipFightStarNum=function(t){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();for(var i=0;i<this.dailyCopyInfo.length;++i)if(t==this.dailyCopyInfo[i].getMapId()){var n=this.dailyCopyInfo[i].getStar();return n}return 0},i.prototype.initDataByDungeonType=function(t){this.isSaoDang?this.isSaoDang=!1:this.ui.scroller.viewport.scrollV=0,this.showEquipInfos=[],this.showEquipInfosOver=[],e.EquipDungenManager.instance.clear();for(var i,n=e.JsonDataManager.instance.mapByGroupAndLevelTemplate,o=20,a=e.PlayerService.instance.level,s=5,r=[],l=o;a>=l;l+=s)i=t+"_"+l,n[i]&&r.push(n[i]);if(t==e.FuBenType.EquipType&&r.reverse(),t==e.FuBenType.GemType){for(var h=[],c=r.length,l=0;c>l;l++){var u=r[l];u[0].maxLevelLimit>=a&&u[0].limitLevel<=a&&h.push(u)}r=h.reverse()}for(var p=r.length,l=0;p>l;++l)for(var g=r[l],d=g.length,f=0;d>f;++f){var m=[],y=[],I=g[f];e.EquipDungenManager.instance.mapVOList[I.id]=I;var v=I.id,_=I.name,T=Number(I.bossId),C=I.dropPreview,A=I.extraCost,E=I.extraCost2;this.itemId=0,this.itemId2=0;var S=void 0;A&&(this.itemId=A.id),E&&(this.itemId2=E.id,S=E.value);var P=A.value,b=e.JsonDataManager.instance.itemTemplate;if(C.length>0)for(var L=C.length,w=0;L>w;++w)if(1001==C[w].type||1002==C[w].type||1003==C[w].type){var B=b[C[w].type],N=B.icon,R=B.id;m.push(N),y.push(R)}else if(3e4==C[w].type){var B=b[C[w].id],N=B.icon,R=B.id;m.push(N),y.push(R)}else if(4e4==C[w].type){var B=b[C[w].id],N=B.icon,R=B.id;m.push(N),y.push(R)}var x=0,M=!1;t==e.FuBenType.EquipType?x=this.getVipFightNum(v):t==e.FuBenType.GemType?(x=this.getVipFightNum(v),M=!0):t==e.FuBenType.FeatherType?x=2:t==e.FuBenType.SpecialRingType&&(x=1);var O=this.getVipFightSurplusNum(v),U=this.getVipFightStarNum(v);x-O==0?this.showEquipInfosOver.push({mapID:v,maxFightNum:x,surplusNum:O,star:U,equipType:t,bossMapName:_,dropPreview:m,itemIdArray:y,extraCost:P,extraCost2:S,itemId:this.itemId,itemId2:this.itemId2,canBuyTimes:M,bossId:T}):this.showEquipInfos.push({mapID:v,maxFightNum:x,surplusNum:O,star:U,equipType:t,bossMapName:_,dropPreview:m,itemIdArray:y,extraCost:P,extraCost2:S,itemId:this.itemId,itemId2:this.itemId2,canBuyTimes:M,bossId:T})}this.collection.replaceAll(this.showEquipInfos.concat(this.showEquipInfosOver)),this.refreshBossToolCard(t),this.redpoint()},i.prototype.redpoint=function(){this.ui.zhuangbeiRedImg.visible=this.refreshredpoint(e.FuBenType.EquipType),this.ui.baoshiRedImg.visible=this.refreshredpoint(e.FuBenType.GemType),this.ui.yumaoRedImg.visible=this.refreshredpoint(e.FuBenType.FeatherType),this.ui.tejieRedImg.visible=this.refreshredpoint(e.FuBenType.SpecialRingType)},i.prototype.refreshredpoint=function(t){for(var i,n=e.JsonDataManager.instance.mapByGroupAndLevelTemplate,o=20,a=e.PlayerService.instance.level,s=5,r=[],l=0,h=!1,c=o;a>=c;c+=s)i=t+"_"+c,n[i]&&r.push(n[i]);if(t==e.FuBenType.GemType){for(var u=[],p=r.length,c=0;p>c;c++){var g=r[c],d=g[0].monsterLevelRange;d>=a-20&&a>=d&&u.push(g)}r=u.reverse()}for(var f=r.length,c=0;f>c;++c)for(var m=r[c],y=m.length,I=0;y>I;++I){var v=m[I],_=v.id,T=this.getVipFightSurplusNum(_);if(t==e.FuBenType.EquipType){var C=v.extraCost,A=e.BagController.getInstance().getItemInfoByItemId(C.id);if(l=this.getVipFightNum(_),h=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEIFUBEN),(A?A.getCount():0)>=C.value&&l>T&&h)return!0}else if(t==e.FuBenType.GemType){var C=v.extraCost,E=v.extraCost2,A=e.BagController.getInstance().getItemInfoByItemId(C.id),S=e.BagController.getInstance().getItemInfoByItemId(E.id);l=this.getVipFightNum(_),h=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.BAOSHIFUBEN);var P=(A?A.getCount():0)>=C.value||(S?S.getCount():0)>=E.value;if(P&&l>T&&h)return!0}else if(t==e.FuBenType.FeatherType){if(l=2,h=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YUMAOFUBEN),l>T&&h)return!0}else if(t==e.FuBenType.SpecialRingType&&(l=1,h=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.TEJIEFUEBN),l>T&&h))return!0}return!1},i.prototype.refreshBossToolCard=function(t){var i=this.ui.costGroup1,n=this.ui.costNameLabel1,o=this.ui.costGroup2;t==e.FuBenType.EquipType?(o.visible=!1,i.visible=!0,n.text=e.LanguageUtils.instance.getValue("ZHUANGBEITONGXINGZHENG")+":",this.refreshTopLable()):t==e.FuBenType.GemType?(o.visible=!0,i.visible=!0,n.text=e.LanguageUtils.instance.getValue("BAOSHITONGXINGLING")+":",this.refreshTopLable()):t==e.FuBenType.FeatherType?(o.visible=!1,i.visible=!1):t==e.FuBenType.SpecialRingType&&(o.visible=!1,i.visible=!1)},i.prototype.refreshTopLable=function(){var t=e.BagController.getInstance().getItemInfoByItemId(this.itemId),i=e.BagController.getInstance().getItemInfoByItemId(this.itemId2);this.ui.costNumLabel1.text=(t?t.getCount():0)+"",this.ui.costNumLabel2.text=(i?i.getCount():0)+"",this.redpoint()},i.prototype.getFuBenItemCount=function(){var t=e.BagController.getInstance().getItemInfoByItemId(this.itemId),i=e.BagController.getInstance().getItemInfoByItemId(this.itemId2),n=new Object;return n.num=(t?t.getCount():0)+"",n.num2=(i?i.getCount():0)+"",n},i.prototype.flushEquipDungen=function(e){this.initDataByDungeonType(e)},i.prototype.flushGemDungen=function(){this.initDataByDungeonType(e.FuBenType.GemType)},i.prototype.flushPreRing=function(){this.initDataByDungeonType(e.FuBenType.SpecialRingType)},i.prototype.recvMsg=function(t,i){if(t==e.MsgCMD.DAILY_COPY_INFO)this.dailyCopyInfo=i,this.initDataByDungeonType(e.FuBenType.EquipType);else if(t==e.Code.BOSS_WIPE_S){var n=i.mapId,o=(i.fromLevel,i.upToLevel,i.award);e.PopUpManager.instance.hasPopUp(e.WindowName.FIGHTRESULTWIN)||e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTRESULTWIN,data:{awards:o,mapId:n,saodang:!0}}),this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState(),this.isSaoDang=!0,this.flushEquipDungen(this.model.tabType),e.DailyDungeonControler.getIntance().getIsShow()&&e.DailyDungeonControler.getIntance().initUI()}},i.prototype.changeGemFbFlush=function(){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState(),this.flushGemDungen()},i.prototype.changeGemFbFlushF=function(){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState()},i}(e.BasePanel);e.FuBenPanel=t,__reflect(t.prototype,"foxgame.FuBenPanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/fight/DailyBossPreviewSkin.exml")||this;return e.list=[],e.columnNum=4,e.equipThroughCardGroupPositionX=39.49,e.enterFightPositionX=74.8,i.instance=e,e.gap=55,e.setIsShowBackBtn(!1),e}return __extends(i,t),i.prototype.setCurrentData=function(e){void 0===e&&(e=null),this.currentData=e},i.getIntance=function(){return this.instance||(this.instance=new i),this.instance},i.prototype.showPanel=function(e){void 0===e&&(e=null),this.currentData=e,this.show()},i.prototype.showHook=function(){this.initListener(),this.list=[],this.ui.contentGroup.removeChildren(),this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();var t=0;if(this.currentData){t=this.currentData.mapId,this.star=this.currentData.star;var n=e.JsonDataManager.instance.monster,o=n[this.currentData.bossId];this.ui.bossName.text=o.name}var a=e.EquipDungenManager.instance.mapVOList[t];this.mapId=a.id,this.monsterLevel=a.monsterLevelRange,this.ui.copyName.text=a.name,this.copyType=a.mapGroup;var s=a.dropPreview;e.JsonDataManager.instance.itemTemplate;if(this.playAni(),s.length>0)for(var r=0;r<s.length;++r)1001==s[r].type||1002==s[r].type||1003==s[r].type?this.list.push(s[r].type):3e4==s[r].type?this.list.push(s[r].id):4e4==s[r].type&&this.list.push(s[r].id);this.initUI(),i.getIntance().showPanel()},i.prototype.playAni=function(){var t=e.JsonDataManager.instance.mapTemplate,i=this.mapId,n=t[i],o=n.standbyAnimation;this.mosterAni&&(this.mosterAni.clear(),this.mosterAni=null),void 0==this.mosterAni&&(this.mosterAni=new e.FoxAni(this.ui.aniGroup)),this.mosterAni.play(o,"ani",-1)},i.prototype.getVipFightNum=function(t){for(var i=e.PlayerService.instance.vipLevel,n=e.JsonDataManager.instance.vipTemplate,o=n[i],a=o.copyTimes,s=0;s<a.length;++s){var r=a[s],l=r[2],h=r[0],c=r[1];if(t>=h&&c>=t)return l}return 0},i.prototype.getExtraItemId=function(t){var i=e.JsonDataManager.instance.mapTemplate,n=i[this.mapId],o=n.extraCost,a=o.id;return a},i.prototype.getExtraItemNum=function(t){var i=e.JsonDataManager.instance.mapTemplate,n=i[this.mapId],o=n.extraCost,a=o.id,s=e.BagController.getInstance().getItemInfoByItemId(a),r=0;return s&&(r=s.getCount()),r},i.prototype.getVipCopyFightTimes=function(t){for(var i=e.PlayerService.instance.vipLevel,n=e.JsonDataManager.instance.vipTemplate,o=n[i],a=o.copyBuyTimes,s=0;s<a.length;++s){var r=a[2],l=a[0],h=a[1];if(t>=l&&h>=t)return r}return 0},i.prototype.getVipCopyBuyPrice=function(t){for(var i=e.PlayerService.instance.vipLevel,n=e.JsonDataManager.instance.vipTemplate,o=n[i],a=o.copyBuyTimes,s=0;s<a.length;++s){var r=a[3],l=(a[2],a[0]),h=a[1];if(t>=l&&h>=t)return r}return 0},i.prototype.getVipFightSurplusNum=function(t){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();for(var i=0;i<this.dailyCopyInfo.length;++i)if(t==this.dailyCopyInfo[i].getMapId()){var n=this.dailyCopyInfo[i].getUseTimes();return n}return 0},i.prototype.getFightBuyTimes=function(t){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();for(var i=0;i<this.dailyCopyInfo.length;++i)if(t==this.dailyCopyInfo[i].getMapId()){var n=this.dailyCopyInfo[i].getBuyTimes();return n}return 0},i.prototype.dispose=function(){this.ui.enterFight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.sweepingBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.timesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.equipPassCardBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.childrenCreated=function(){this.ui.bossPreviewScroller.verticalScrollBar.autoVisibility=!1,this.initListener(),this.doScreenAdaptation()},i.prototype.initUI=function(){this.ui.bossPreviewScroller.viewport.scrollV=0,this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();for(var t,i,n=0;n<this.list.length;n++)t=new e.ItemIcon,t.setItem(this.list[n]),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dropItemClickHandler,this),i=this.getIconPos(t.width,n),t.x=i.x+50,t.y=i.y+40,this.ui.contentGroup.addChild(t);var o=this.ui.contentGroup.numChildren%this.columnNum>0?Math.floor(this.ui.contentGroup.numChildren/this.columnNum)+1:this.ui.contentGroup.numChildren/this.columnNum;this.ui.contentGroup.height=o*t.height+(o-1)*this.gap+40,this.maxFightNum=0,this.copyType==e.FuBenType.EquipType?(this.maxFightNum=this.getVipFightNum(this.mapId),this.ui.dailyTimesGroup.x=this.equipThroughCardGroupPositionX,this.ui.enterFight.x=this.enterFightPositionX,this.ui.equipThroughCardGroup.visible=!0,this.ui.timesBtn.visible=!1,this.ui.sweepingBtn.visible=!1,this.ui.passCheckLabel.text=e.LanguageUtils.instance.getValue("ZHUANGBEITONGXINGZHENG")+":",this.ui.passCheckNumLabel.text=this.getExtraItemNum(this.mapId)+""):this.copyType==e.FuBenType.GemType?(this.maxFightNum=this.getVipFightNum(this.mapId),this.ui.dailyTimesGroup.x=this.equipThroughCardGroupPositionX,this.ui.enterFight.x=this.enterFightPositionX+149,this.ui.equipThroughCardGroup.visible=!0,this.ui.timesBtn.visible=!0,this.ui.sweepingBtn.visible=!1,this.ui.passCheckLabel.text=e.LanguageUtils.instance.getValue("BAOSHITONGXINGLING")+":",this.ui.passCheckNumLabel.text=this.getExtraItemNum(this.mapId)+""):this.copyType==e.FuBenType.FeatherType?(this.ui.dailyTimesGroup.x=this.equipThroughCardGroupPositionX+149,this.ui.enterFight.x=this.enterFightPositionX+149,this.ui.equipThroughCardGroup.visible=!1,this.ui.timesBtn.visible=!1,this.ui.sweepingBtn.visible=!1,this.maxFightNum=2):this.copyType==e.FuBenType.SpecialRingType&&(this.ui.dailyTimesGroup.x=this.equipThroughCardGroupPositionX+149,this.ui.enterFight.x=this.enterFightPositionX+149,this.ui.equipThroughCardGroup.visible=!1,this.ui.timesBtn.visible=!1,this.ui.sweepingBtn.visible=!1,this.maxFightNum=1);var a=this.getVipFightSurplusNum(this.mapId);this.ui.surplusFightNum.text=this.maxFightNum-a+"/"+this.maxFightNum,this.surplusNum=this.maxFightNum-a,this.maxFightNum-a==0?this.ui.enterFight.enabled=!1:this.ui.enterFight.enabled=!0,this.surplusNum>=1&&3==this.star?this.ui.sweepingBtn.enabled=!0:this.ui.sweepingBtn.enabled=!1},i.prototype.flushFightBuyTimes=function(t,i,n,o){void 0===o&&(o=null);for(var a=e.PlayerService.instance.playerStateInfo.getDailyCopyState(),s=a.length,r=0;s>r;r++){var l=a[r];if(l.getMapId()==i){l.setUseTimes(t),l.setBuyTimes(n),a[r]=l;break}}e.PlayerService.instance.playerStateInfo.setDailyCopyState(a),e.FuBenController.getInstance().changeGemFbFlush(),this.ui.surplusFightNum.text=this.maxFightNum-t+"/"+this.maxFightNum},i.prototype.flushEquipPassCardNum=function(){this.ui.passCheckNumLabel.text=this.getExtraItemNum(this.mapId)+""},i.prototype.getIconPos=function(e,t){var i=new egret.Point,n=Math.floor(t/this.columnNum),o=t%this.columnNum;return i.x=o*(e+this.gap),i.y=n*(e+this.gap),i},i.prototype.initListener=function(){this.ui.enterFight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.sweepingBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.timesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.equipPassCardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.closeBtn:this.close();break;case this.ui.enterFight:if(this.copyType!=e.FuBenType.FeatherType&&Number(this.ui.passCheckNumLabel.text)<=0)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void this.sendBuyShopItem();e.EquipDungenManager.instance.setFightNum(this.surplusNum),e.EquipDungenManager.instance.setFightType(this.copyType),e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.DAY_COPY,this.mapId),this.close();break;case this.ui.sweepingBtn:if(Number(this.ui.passCheckNumLabel.text)<=0)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU"));var i=HawkProtocolManager.newBuilder("JsProto.HPBossWipe");i.setMapId(this.mapId),e.Message.instance.send(e.Code.BOSS_WIPE_C,i,!0);break;case this.ui.timesBtn:if(this.surplusNum=this.maxFightNum-this.getVipFightSurplusNum(this.mapId),this.surplusNum<=0)e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYBUYTIMESNOTICE"));else{e.Message.instance.add(e.Code.BUY_FIELDORKEY_FIGHT_TIMES_S,this);var n=this.getVipCopyFightTimes(this.mapId),o=this.getVipCopyBuyPrice(this.mapId),a=this.getFightBuyTimes(this.mapId);if(n-a>0){var s=e.LanguageUtils.instance.getValue("GEMCOPYQUICKBUY",o,this.monsterLevel,n-a);e.PopUpController.getInstance().showTextPanel(s,this,this.gemQuickFightTimes)}else e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYBUYTIMESNOTICE"))}break;case this.ui.equipPassCardBtn:this.sendBuyShopItem()}},i.prototype.sendBuyShopItem=function(){this.showBuyTips()},i.prototype.showBuyTips=function(){e.ShopMainControler.getInstance().showBuyItemPanel(this.getExtraItemId(this.mapId))},i.prototype.gemQuickFightTimes=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPBuyCopyTimesReq");t.setMapId(this.mapId),e.Message.instance.send(e.Code.BUY_FIELDORKEY_FIGHT_TIMES_C,t,!0)},i.prototype.readyDestroy=function(){this.ui.contentGroup.removeChildren(),e.Message.instance.remove(e.Code.BUY_FIELDORKEY_FIGHT_TIMES_S,this),this.mosterAni&&(this.mosterAni.clear(),this.mosterAni=null)},i.prototype.closeHook=function(){},i.prototype.dropItemClickHandler=function(t){var i=this.getDropItems(),n=i.indexOf(t.target),o=this.list[n],a=e.JsonDataManager.instance.itemTemplate,s=a[o];s.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:o}):e.TipsController.getInstance().showItemTips(o)},i.prototype.getDropItems=function(){for(var e=[],t=this.ui.contentGroup.numChildren,i=0;t>i;i++)e.push(this.ui.contentGroup.getChildAt(i));return e},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.BUY_FIELDORKEY_FIGHT_TIMES_S:var n=~~i.useTimes,o=~~i.fightBuyTimes,a=i.mapId;this.flushFightBuyTimes(n,a,o)}},i}(e.BasePanel);e.DailyDungeonControler=t,__reflect(t.prototype,"foxgame.DailyDungeonControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.list=[],i.listItem=[],i.columnNum=4,i.equips=[],i.detailEquip=[],i.item=[],i.iCount=0,i.initEuiPos={},i.battleType=null,i.skinName="DailyResultFightWin",e.PopUpManager.instance.registerWindow(e.WindowName.FIGHTRESULTWIN,i,i),i.mytimer=new egret.Timer(1e3,0),i.initListener(),i}return __extends(i,t),i.prototype.init=function(){this.fightResultScroller.viewport.scrollV=0,this.gapX=Number(e.GlobalConfig.instance.getValue("RESULTREWARDDISX")),this.gapY=Number(e.GlobalConfig.instance.getValue("RESULTREWARDDISY")),this.iCount=3,this.list=[],this.listItem=[],this.contentGroup.removeChildren(),this.countDownFont.text=this.iCount.toString(),this.countDownFont1.text=this.iCount.toString();
var t=this.detailEquip.length;if(t>0)for(var i=0;t>i;++i)this.list.push(this.detailEquip[i].getItemId());t=this.item.length;for(var i=0;t>i;++i){var n=new Object;n.id=this.item[i].getItemId(),n.num=this.item[i].getItemCount(),this.listItem.push(n)}var o,a;t=this.list.length;for(var i=0;t>i;i++)o=new e.ItemIcon,o.setItem(this.list[i]),a=this.getIconPos(o.width,i),o.x=a.x,o.y=a.y+this.gapY,this.contentGroup.addChild(o);t=this.listItem.length;for(var i=0;t>i;i++)o=new e.ItemIcon,o.setItem(this.listItem[i].id,this.listItem[i].num),a=this.getIconPos(o.width,this.list.length+i),o.x=a.x,o.y=a.y+this.gapY,this.contentGroup.addChild(o);var s=this.contentGroup.numChildren%this.columnNum>0?Math.floor(this.contentGroup.numChildren/this.columnNum)+1:this.contentGroup.numChildren/this.columnNum;this.contentGroup.height=s*(0>=t?1:o.height)+(s-1)*this.gapY+40,this.mytimer.start(),e.NewChatControler.getInstance().getPanelIsShow()&&e.NewChatControler.getInstance().closeChatPanel()},i.prototype.getVipFightStarNum=function(t){this.dailyCopyInfo=e.PlayerService.instance.playerStateInfo.getDailyCopyState();for(var i=0;i<this.dailyCopyInfo.length;++i)if(t==this.dailyCopyInfo[i].getMapId()){var n=this.dailyCopyInfo[i].getStar();return n}return 0},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.getIconPos=function(e,t){var i=new egret.Point,n=Math.floor(t/this.columnNum),o=t%this.columnNum;return i.x=o*(e+this.gapX),i.y=n*(e+this.gapY),i},i.prototype.initListener=function(){this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.sureBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.mytimer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this)},i.prototype.clickBtn=function(t){switch(t.target){case this.sureBtn:e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"sureBtn",battleType:this.battleType}),this.close(),this.backScene();break;case this.sureBtn1:(!this.battleType||this.battleType!=e.BattleType.BATTLE_CHALLENGE&&this.battleType!=e.BattleType.BOSS_PLUNDER_SINGLE)&&e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"sureBtn1",battleType:this.battleType}),this.close(),this.backScene();break;case this.againBtn:if(e.FuBenController.getInstance().getFuBtnType()==e.FuBenType.EquipType&&!e.BagController.getInstance().checkBagMinCellCount()){var i=e.LanguageUtils.instance.getValue("BAGNOTENOUGH");return e.PopUpController.getInstance().showTextPanel(i),e.EquipDungenManager.instance.setFightNum(0),e.FuBenController.getInstance().showPanel(e.EquipDungenManager.instance.getFightType()),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"againBtn",battleType:this.battleType}),void this.close()}if(this.battleType==e.BattleType.DAY_COPY){var n=e.FuBenController.getInstance().getFuBenItemNum(),o=n.num,a=n.num2;if(e.FuBenController.getInstance().getFuBtnType()==e.FuBenType.EquipType){if(0>=o){var i=e.LanguageUtils.instance.getValue("DAOJUBUZU");return e.PopUpController.getInstance().showTextPanel(i),void(e.BagController.getInstance().checkBagMinCellCount()||(e.EquipDungenManager.instance.setFightNum(0),e.FuBenController.getInstance().showPanel(e.EquipDungenManager.instance.getFightType()),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"againBtn",battleType:this.battleType}),this.close()))}}else if(e.FuBenController.getInstance().getFuBtnType()==e.FuBenType.GemType&&0>=o&&0>=a){var i=e.LanguageUtils.instance.getValue("DAOJUBUZU");return e.PopUpController.getInstance().showTextPanel(i),void(e.BagController.getInstance().checkBagMinCellCount()||(e.EquipDungenManager.instance.setFightNum(0),e.FuBenController.getInstance().showPanel(e.EquipDungenManager.instance.getFightType()),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"againBtn",battleType:this.battleType}),this.close()))}}e.EquipDungenManager.instance.getFightNum()-1<=0?(e.EquipDungenManager.instance.setFightNum(0),e.FuBenController.getInstance().showPanel(e.EquipDungenManager.instance.getFightType()),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"againBtn",battleType:this.battleType}),this.close()):(e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"DailyDungeonResultWin",tag:"againBtn",battleType:this.battleType}),this.close(),e.EquipDungenManager.instance.setFightNum(e.EquipDungenManager.instance.getFightNum()-1),e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.DAY_COPY,this.mapID))}},i.prototype.show=function(t){void 0===t&&(t=null);t.awards;this.mapID=t.mapId,this.battleType=t.battleType,t.callback,App.SoundManager().playEffect("sound_openWin_mp3"),t.saodang?(this.fightResultScroller.y=this.refSaodang.y,this.gradeGroup.visible=!1,this.againBtn.visible=!1,this.winGroup.visible=!1,this.saodangGroup.visible=!0,this.detailEquip=t.awards.getDrop().getDetailEquip(),this.item=t.awards.getDrop().getItem()):(this.fightResultScroller.y=this.refWin.y,this.gradeGroup.visible=!0,this.againBtn.visible=!0,this.winGroup.visible=!0,this.saodangGroup.visible=!1,this.detailEquip=t.awards.getDrop().getDetailEquip(),this.item=t.awards.getDrop().getItem()),27==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.sureBtn,this.sureBtn.parent,27,6,!0),28==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.sureBtn1,this.sureBtn1.parent,28,3,!0),29==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.sureBtn,this.sureBtn.parent,29,4,!0),32==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.sureBtn,this.sureBtn.parent,32,4,!0),35==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.sureBtn,this.sureBtn.parent,35,4,!0);var i=this.getVipFightStarNum(t.mapId);switch(i){case 1:this.star1.visible=!0,this.star2.visible=!1,this.star3.visible=!1;break;case 2:this.star1.visible=!0,this.star2.visible=!0,this.star3.visible=!1;break;case 3:this.star1.visible=!0,this.star2.visible=!0,this.star3.visible=!0;break;default:this.star1.visible=!1,this.star2.visible=!1,this.star3.visible=!1}this.init(),this.initListener(),e.PopUpManager.instance.addPopUp(e.WindowName.FIGHTRESULTWIN,e.WindowName.UILAYER,5,!0)},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.FIGHTRESULTWIN),this.mytimer.stop(),this.contentGroup.removeChildren(),27==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&e.FuBenController.getInstance().closeguide()},i.prototype.clear=function(){this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.sureBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.againBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.mytimer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this)},i.prototype.timerFunc=function(t){this.iCount--,this.countDownFont.text=this.iCount.toString(),this.countDownFont1.text=this.iCount.toString(),this.iCount<0&&((!this.battleType||this.battleType!=e.BattleType.BATTLE_CHALLENGE&&this.battleType!=e.BattleType.BOSS_PLUNDER_SINGLE)&&e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"DailyDungeonResultWin",tag:"timerFunc",battleType:this.battleType}),this.close(),this.backScene())},i.prototype.backScene=function(){if(this.battleType!=e.BattleType.RUINS_BATTLE_TYPE){var t=e.RequestFightManager.instance.getRequestFightType();if(t==e.BattleType.BATTLE_CHALLENGE||t==e.BattleType.BOSS_PLUNDER_SINGLE){var i=e.BattleService.instance.getCurrentChallengeType(),n=new Object;n.fbType=5,i>5?(n.fbType=i,e.NewBossMainControler.getIntance().showPanel(n)):0!=i&&e.NewBossMainControler.getIntance().showPanel(n)}else t==e.BattleType.BATTLE_PVE_BOSS?console.log("boss 走了这里 "):e.FuBenController.getInstance().showPanel(e.EquipDungenManager.instance.getFightType())}},i.prototype.dispose=function(){},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.fightResultScroller.verticalScrollBar.autoVisibility=!1},i.prototype.recvMsg=function(e,t){},i}(e.ViewControler);e.DailyDungeonResultWin=t,__reflect(t.prototype,"foxgame.DailyDungeonResultWin",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.equipItemHeight=150,i.equipItemGap=15,i.showEquipInfos=new Array,i.skinName="DailyBoss_featherFuBenSkin",e.PopUpManager.instance.registerWindow(e.WindowName.FEATHERDUNGEON,i,i),i}return __extends(i,t),i.prototype.initUI=function(){this.gemFuBenScroll.verticalScrollBar.autoVisibility=!1,this.gemFuBenList.itemRenderer=e.EquipDungenItemRender,this.equips=new eui.ArrayCollection,this.gemFuBenList.dataProvider=this.equips;for(var t=0;10>t;t++)this.showEquipInfos.push({});this.gemFuBenList.height=this.showEquipInfos.length*(this.equipItemHeight+this.equipItemGap),this.equips.replaceAll(this.showEquipInfos),this.equips.refresh()},i.prototype.show=function(t){void 0===t&&(t=null),e.PopUpManager.instance.addPopUp(e.WindowName.FEATHERDUNGEON,e.WindowName.UILAYER,5,!0)},i.prototype.initListener=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.FEATHERDUNGEON)},i.prototype.clear=function(){},i.prototype.dispose=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.initListener(),this.doScreenAdaptation()},i.prototype.recvMsg=function(e,t){},i.prototype.onClick=function(e){switch(e.target){case this.closeBtn:this.close()}},i}(e.ViewControler);e.FeatherDungenControler=t,__reflect(t.prototype,"foxgame.FeatherDungenControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.equipItemHeight=150,i.equipItemGap=15,i.showEquipInfos=new Array,i.skinName="DailyBoss_gemFuBenSkin",e.PopUpManager.instance.registerWindow(e.WindowName.GEMDUNGEON,i,i),i}return __extends(i,t),i.prototype.initUI=function(){this.gemFuBenScroll.verticalScrollBar.autoVisibility=!1,this.gemFuBenList.itemRenderer=e.EquipDungenItemRender,this.equips=new eui.ArrayCollection,this.gemFuBenList.dataProvider=this.equips;for(var t=0;10>t;t++)this.showEquipInfos.push({});this.gemFuBenList.height=this.showEquipInfos.length*(this.equipItemHeight+this.equipItemGap),this.equips.replaceAll(this.showEquipInfos),this.equips.refresh()},i.prototype.show=function(t){void 0===t&&(t=null),e.PopUpManager.instance.addPopUp(e.WindowName.GEMDUNGEON,e.WindowName.UILAYER,5,!0)},i.prototype.initListener=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.GEMDUNGEON)},i.prototype.clear=function(){},i.prototype.dispose=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.initListener(),this.doScreenAdaptation()},i.prototype.recvMsg=function(e,t){},i.prototype.onClick=function(e){switch(e.target){case this.closeBtn:this.close()}},i}(e.ViewControler);e.GemDungenControler=t,__reflect(t.prototype,"foxgame.GemDungenControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.equipItemHeight=150,i.equipItemGap=15,i.showEquipInfos=new Array,i.skinName="DailyBoss_preRingFuBenSkin",e.PopUpManager.instance.registerWindow(e.WindowName.PRERINGDUNGEON,i,i),i}return __extends(i,t),i.prototype.initUI=function(){this.gemFuBenScroll.verticalScrollBar.autoVisibility=!1,this.gemFuBenList.itemRenderer=e.EquipDungenItemRender,this.equips=new eui.ArrayCollection,this.gemFuBenList.dataProvider=this.equips;for(var t=0;10>t;t++)this.showEquipInfos.push({});this.gemFuBenList.height=this.showEquipInfos.length*(this.equipItemHeight+this.equipItemGap),this.equips.replaceAll(this.showEquipInfos),this.equips.refresh()},i.prototype.show=function(t){void 0===t&&(t=null),e.PopUpManager.instance.addPopUp(e.WindowName.PRERINGDUNGEON,e.WindowName.UILAYER,5,!0)},i.prototype.initListener=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.PRERINGDUNGEON)},i.prototype.clear=function(){},i.prototype.dispose=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.initListener(),this.doScreenAdaptation()},i.prototype.recvMsg=function(e,t){},i.prototype.onClick=function(e){switch(e.target){case this.closeBtn:this.close()}},i}(e.ViewControler);e.PreRingDungenControler=t,__reflect(t.prototype,"foxgame.PreRingDungenControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="EquipFuBenItem",e.initUI(),e}return __extends(i,t),i.prototype.initUI=function(){this.dianLiangStar1.visible=!1,this.dianLiangStar2.visible=!1,this.dianLiangStar3.visible=!1,this.rewardsDes.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("XIANGXIJIANGLI")),this.initListener()},i.prototype.createChildren=function(){t.prototype.createChildren.call(this),!this.data},i.prototype.CanTiaoZhan=function(e){this.canT=!0},i.prototype.onClickBtn=function(t){var i,n,o=0,a=0;switch(t.target){case this.tiaoZhanBtn:if(o=0,a=0,i=e.BagController.getInstance().getItemInfoByItemId(this.itemId),this.itemId2&&(n=e.BagController.getInstance().getItemInfoByItemId(this.itemId2)),n&&(a=n.getCount()),i&&(o=i.getCount()),o<this.extraCostNum&&void 0!=this.extraCostNum2&&a<this.extraCostNum2)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void e.FuBenController.getInstance().sendBuyShopItem();if(e.EquipDungenManager.instance.setFightNum(this.surplusFightNum),e.EquipDungenManager.instance.setFightType(this.equipType),this.equipType==e.FuBenType.EquipType&&o<this.extraCostNum)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void e.FuBenController.getInstance().sendBuyShopItem();if(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan,null,2),!this.canT)return;this.canT=!1,e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.DAY_COPY,this.mapID),e.FuBenController.getInstance().closePanel();break;case this.saodangBtn:if(i=e.BagController.getInstance().getItemInfoByItemId(this.itemId),this.itemId2&&(n=e.BagController.getInstance().getItemInfoByItemId(this.itemId2)),n&&(a=n.getCount()),o=null!=i?i.getCount():0,o<this.extraCostNum&&void 0!=this.extraCostNum2&&a<this.extraCostNum2)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void e.FuBenController.getInstance().sendBuyShopItem();if(this.equipType==e.FuBenType.EquipType&&o<this.extraCostNum)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("DAOJUBUZU")),void e.FuBenController.getInstance().sendBuyShopItem();if(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan,null,2),!this.canT)return;this.canT=!1,e.BattleService.instance.setCurrentChallengeType(0);var s=HawkProtocolManager.newBuilder("JsProto.HPBossWipe");s.setMapId(this.mapID),e.Message.instance.send(e.Code.BOSS_WIPE_C,s,!0);break;case this.dropItem1:var r=this.itemIdArray[0];this.showItemTips(r);break;case this.dropItem2:var r=this.itemIdArray[1];this.showItemTips(r);break;case this.dropItem3:var r=this.itemIdArray[2];this.showItemTips(r);break;case this.timesBtn:var l=e.EquipDungenManager.instance.mapVOList[this.data.mapID],h=l.monsterLevelRange;if(!e.DailyDungeonControler.instance){var c=new Object;c.itemIndex=this.itemIndex,c.star=this.star,e.DailyDungeonControler.getIntance().setCurrentData(c)}e.DailyDungeonControler.instance.surplusNum=this.maxFightNum-e.DailyDungeonControler.instance.getVipFightSurplusNum(this.mapID);var u=e.DailyDungeonControler.instance.getVipCopyFightTimes(this.mapID);if(0>=u)e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYBUYTIMESNOTICE"));else{e.Message.instance.add(e.Code.BUY_FIELDORKEY_FIGHT_TIMES_S,this);var p=e.DailyDungeonControler.instance.getVipCopyBuyPrice(this.mapID),g=e.PlayerService.instance.playerInfo.getGold();if(p>g)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var d=e.DailyDungeonControler.instance.getFightBuyTimes(this.mapID);if(u-d>0){var f=e.LanguageUtils.instance.getValue("GEMCOPYQUICKBUY",p,h,u-d);e.PopUpController.getInstance().showTextPanel(f,this,this.gemQuickFightTimes)}else e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYBUYTIMESNOTICE"))}}},i.prototype.gemQuickFightTimes=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPBuyCopyTimesReq");t.setMapId(this.mapID),e.Message.instance.send(e.Code.BUY_FIELDORKEY_FIGHT_TIMES_C,t,!0)},i.prototype.showItemTips=function(t){var i=e.JsonDataManager.instance.itemTemplate,n=i[t];n.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:t}):e.TipsController.getInstance().showItemTips(t)},i.prototype.clickHandler=function(t){var i=new Object;i.star=this.data.star,i.bossId=this.data.bossId,i.mapId=this.data.mapID,e.DailyDungeonControler.getIntance().showPanel(i)},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){switch(this.mapID=parseInt(this.data.mapID),this.bossId=this.data.bossId,this.equipType=this.data.equipType,this.bossMapName=this.data.bossMapName,this.equipName.text=this.bossMapName,this.dropPreview=this.data.dropPreview,this.itemIdArray=this.data.itemIdArray,this.extraCostNum=this.data.extraCost,this.extraCostNum2=this.data.extraCost2,this.itemId=this.data.itemId,this.itemId2=this.data.itemId2,this.setMonsterIcon(),this.data.canBuyTimes?this.timesBtn.visible=!0:this.timesBtn.visible=!1,this.dropPreview.length>=3&&(this.dropItem1.source=this.dropPreview[0],this.dropItem2.source=this.dropPreview[1],this.dropItem3.source=this.dropPreview[2]),this.maxFightNum=this.data.maxFightNum,0==this.data.surplusNum?this.surplusFightNum=this.maxFightNum:this.surplusFightNum=this.maxFightNum-this.data.surplusNum,0==this.surplusFightNum?(this.tiaoZhanBtn.enabled=!1,this.saodangBtn.enabled=!1):(this.tiaoZhanBtn.enabled=!0,this.saodangBtn.enabled=!0),this.surplusFightNumLabel.text="("+this.surplusFightNum+"/"+this.maxFightNum+")",this.saodangBtn.visible=!1,this.tiaoZhanBtn.visible=!0,this.star=this.data.star,this.star){case 1:this.dianLiangStar1.visible=!0,this.dianLiangStar2.visible=!1,this.dianLiangStar3.visible=!1;break;case 2:this.dianLiangStar1.visible=!0,this.dianLiangStar2.visible=!0,this.dianLiangStar3.visible=!1;break;case 3:this.dianLiangStar1.visible=!0,this.dianLiangStar2.visible=!0,this.dianLiangStar3.visible=!0,this.saodangBtn.visible=!0,this.tiaoZhanBtn.visible=!1;break;default:this.dianLiangStar1.visible=!1,this.dianLiangStar2.visible=!1,this.dianLiangStar3.visible=!1}1==this.equipType?29==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.tiaoZhanBtn,this.tiaoZhanBtn.parent.parent,29,3,!0):3==this.equipType?27==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.tiaoZhanBtn,this.tiaoZhanBtn.parent,27,5,!0):2==this.equipType?32==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.tiaoZhanBtn,this.tiaoZhanBtn.parent,32,3,!0):4==this.equipType&&35==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.tiaoZhanBtn,this.tiaoZhanBtn.parent,35,3,!0)}},i.prototype.setMonsterIcon=function(){var t=e.JsonDataManager.instance.monster,i=t[this.bossId];this.headImage.source=i.iconPath},i.prototype.dispose=function(){this.tiaoZhanBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.saodangBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.dropItem1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.dropItem2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.dropItem3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.timesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this)},i.prototype.initListener=function(){this.rewardsDes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.tiaoZhanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.saodangBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.dropItem1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.dropItem2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.dropItem3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this),this.timesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this)},i.prototype.getTiaozhanbtn=function(){return this.tiaoZhanBtn},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.BOSS_WIPE_S:break;case e.Code.BUY_FIELDORKEY_FIGHT_TIMES_S:if(this.mapID!=i.mapId)return;this.data.surplusNum=i.useTimes;for(var n=e.PlayerService.instance.playerStateInfo.getDailyCopyState(),o=0;o<n.length;o++)n[o].getMapId()==i.mapId&&(n[o].setUseTimes(i.useTimes),n[o].setBuyTimes(i.fightBuyTimes));e.FuBenController.getInstance().changeGemFbFlush()}},i}(eui.ItemRenderer);e.EquipDungenItemRender=t,__reflect(t.prototype,"foxgame.EquipDungenItemRender",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.itemList=[]}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getFightNum=function(){return this.fightNum},e.prototype.setFightNum=function(e){this.fightNum=e},e.prototype.getFightType=function(){return this.fightType},e.prototype.setFightType=function(e){this.fightType=e},Object.defineProperty(e.prototype,"mapVOList",{get:function(){return this.itemList},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.itemList=[]},e}();e.EquipDungenManager=t,__reflect(t.prototype,"foxgame.EquipDungenManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.cost=[]}return e}();e.GodheadActivationVO=t,__reflect(t.prototype,"foxgame.GodheadActivationVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.GodheaddataVO=t,__reflect(t.prototype,"foxgame.GodheaddataVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.GodheadgodheadOpenVO=t,__reflect(t.prototype,"foxgame.GodheadgodheadOpenVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.GodheadHieronVO=t,__reflect(t.prototype,"foxgame.GodheadHieronVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.attrTypeList=[],this.attrValueList=[],this.cost=[]}return e}();e.GodheadLevelVO=t,__reflect(t.prototype,"foxgame.GodheadLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.GodHoodModel,this.panel=new e.GodHoodPanel(this.model),this.godhoodpreview=new e.GodHoodpreview,this.godHoodturntable=new e.GodHoodturntable}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getmodel=function(){return this.model},t.prototype.getpanel=function(){return this.panel},t.prototype.showpanel=function(t,i){void 0===t&&(t=0),void 0===i&&(i=1);var n=parseInt(e.GlobalConfig.instance.getValue("GODHEAD_OPEN_LEVEL"));return e.PlayerService.instance.level<n?void e.GameUtils.MSG_TIP("神格功能"+n+"级开启"):(this.model.roleIndex=t,this.model.godheadtype=i,this.model.roleData=e.PlayerService.instance.getRoleDataList()[this.model.roleIndex],void(this.panel.getIsShow()?this.panel.showUp():this.panel.show()))},t.prototype.showgodhoodpreview=function(e){this.godhoodpreview.showpanel(e)},t.prototype.showgodHoodturntable=function(e){this.godHoodturntable.showpanel(e)},t.prototype.registerMsg=function(t){t.add(e.Code.GODHEAD_INFO_S,this),t.add(e.Code.GODHEAD_ACTIVATE_UPGRAD_S,this),t.add(e.Code.GODHEAD_ACTIVATE_HIERON_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.GODHEAD_INFO_S:this.model.setgodhoodinfo(i);break;case e.Code.GODHEAD_ACTIVATE_UPGRAD_S:this.model.setgodhoodupinfo(i);break;case e.Code.GODHEAD_ACTIVATE_HIERON_S:this.model.setgodhoodhierominfo(i)}},t.prototype.sendGODHEAD_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPPlayerGodheadInfoReq");e.Message.instance.send(e.Code.GODHEAD_INFO_C,t,!0)},t.prototype.sendGODHEAD_ACTIVATE_UPGRAD_C=function(t,i,n){var o=HawkProtocolManager.newBuilder("JsProto.HPPlayerGodheadUpgradeReq");o.setType(i),o.setRoleId(t),o.setPositionId(n),e.Message.instance.send(e.Code.GODHEAD_ACTIVATE_UPGRAD_C,o,!0)},t.prototype.sendGODHEAD_ACTIVATE_HIERON_C=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPGodheadHieronReq");n.setType(i),n.setRoleId(t),e.Message.instance.send(e.Code.GODHEAD_ACTIVATE_HIERON_C,n,!0)},t.prototype.refreshRedPoint=function(){var t=e.PlayerService.instance.level;if(t<parseInt(e.GlobalConfig.instance.getValue("GODHEAD_OPEN_LEVEL")))return!1;var i=this.model.roleGodHoodInfo;return this.shenweihondian(i)?!0:!1},t.prototype.shenweihondian=function(t){for(var i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.getGodheadDateInfo().length;o++){var a=n.getGodheadDateInfo()[o],s=void 0,r=void 0;if(0!=a.getId()&&a.getState()){var l=e.JsonDataManager.instance.GodheadActivationTemplate[a.getType()+"_1"];s=l.cost[0],r=l.cost[1]}else if(0==a.getId()&&a.getState()){var l=e.JsonDataManager.instance.GodheadActivationTemplate[a.getType()+"_0"];s=l.cost[0],r=l.cost[1]}if(s&&s.type==e.AttributeType.COIN){if(e.PlayerService.instance.playerInfo.getCoin()>=s.value&&e.BagController.getInstance().getCountByItemId(r.id)>=r.value)return!0}else if(s&&e.BagController.getInstance().getCountByItemId(s.id)>=s.value&&e.BagController.getInstance().getCountByItemId(r.id)>=r.value)return!0;for(var h=0;h<a.getGodheadPropertyInfo().length;h++){var c=a.getGodheadPropertyInfo()[h];if(c.getState()){var u=this.model.getGodHeadInfoTempByTypeAndIndex(a.getType(),c.getPositionId(),c.getLevel());if(null!=this.model.getGodHeadInfoTempByTypeAndIndex(a.getType(),c.getPositionId(),c.getLevel()+1)&&e.BagController.getInstance().getCountByItemId(u.cost[0].id)>=u.cost[0].value&&e.BagController.getInstance().getCountByItemId(u.cost[1].id)>=u.cost[1].value)return!0}}}return!1},t}();e.GodHoodConttroller=t,__reflect(t.prototype,"foxgame.GodHoodConttroller")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="goditem",e}return __extends(i,t),i.prototype.setDate=function(e){this.data=e,this.refresh()},i.prototype.refresh=function(){this.img_4.visible=!this.data.getState();var t=e.GodHoodConttroller.getInstance().getmodel().getGodheadHieronTempByIdAndType(this.data.getId(),this.data.getType());if(this.data.getState()){var i=void 0,n=void 0;if(this.img_1.source="godhoodbig_"+this.data.getType()+"_png",0==this.data.getId()){this.img_2.source="off_tianshen_1_png",this.lab_2.text="可激活",this.lab_2.textColor=16770048;var o=e.JsonDataManager.instance.GodheadActivationTemplate[this.data.getType()+"_0"];i=o.cost[0],n=o.cost[1]}else{var o=e.JsonDataManager.instance.GodheadActivationTemplate[this.data.getType()+"_1"];i=o.cost[0],n=o.cost[1],this.img_2.source=t.icon,this.lab_2.text=t.name,this.lab_2.textColor=e.ColorUtils.instance.getColorByQuality(t.quality)}i.type==e.AttributeType.COIN?this.redimg.visible=e.PlayerService.instance.playerInfo.getCoin()>=i.value&&e.BagController.getInstance().getCountByItemId(n.id)>=n.value:this.redimg.visible=e.BagController.getInstance().getCountByItemId(i.id)>=i.value&&e.BagController.getInstance().getCountByItemId(n.id)>=n.value}else this.redimg.visible=!1,this.img_1.source="godhoodbig_0_png",this.img_2.source="off_tianshen_1_png",this.lab_2.text="未激活",this.lab_2.textColor=15655878},i.prototype.setselect=function(e){this.img_3.visible=e},i.prototype.setshow=function(t,i,n,o){if(void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===o&&(o=!0),this.img_4.visible=!1,this.img_3.visible=!1,this.redimg.visible=!1,this.lab_2.text="",t.getState()){var a=e.GodHoodConttroller.getInstance().getmodel().getGodheadHieronTempByIdAndType(t.getId(),t.getType());this.img_1.source="godhoodbig_"+t.getType()+"_png",0==t.getId()?this.img_2.source="off_tianshen_1_png":this.img_2.source=a.icon}else this.img_1.source="godhoodbig_0_png",this.img_2.source="off_tianshen_1_png"},i.prototype.setshowicon=function(t,i){void 0===i&&(i=!0),this.info=t,this.img_4.visible=!1,this.redimg.visible=!1,this.img_3.visible=!1,this.img_2.source=t.icon,this.lab_2.text=t.name,this.lab_2.textColor=e.ColorUtils.instance.getColorByQuality(t.quality),i?"":this.lab_2.text="",this.img_1.source="godhoodbig_"+t.type+"_png"},i}(eui.Component);e.GodHooditem=t,__reflect(t.prototype,"foxgame.GodHooditem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="goditems",e}return __extends(i,t),i.prototype.setDate=function(e,t){this.data=e,this.index=t,this.refresh()},i.prototype.setselect=function(e){this.img_3.visible=e},i.prototype.refresh=function(){var t=e.GodHoodConttroller.getInstance().getmodel().godheadtype,i=e.GodHoodConttroller.getInstance().getmodel().getGodHeadInfoTempByTypeAndIndex(t,this.data.getPositionId(),this.data.getLevel()),n=e.GodHoodConttroller.getInstance().getmodel().getGodHeadDataTempByTypeAndIndex(t,this.data.getPositionId());this.img_3.visible=this.data.getPositionId()==this.index,this.img_4.visible=!this.data.getState(),this.lab_1.text=this.data.getLevel()+"",this.data.getState()?this.data.getLevel()>0?(this.img_1.source="godhood_"+t+"_png",this.img_2.source=n.icon+this.data.getPositionId()+"_png",this.lab_2.text=i.name,this.lab_2.textColor=e.ColorUtils.instance.getColorByQuality(n.quality)):(this.img_1.source="godhood_0_png",this.img_2.source=n.icon+"0_png",this.lab_2.text="可升级",this.lab_2.textColor=16770048):(this.img_1.source="godhood_0_png",this.img_2.source=n.icon+"0_png",this.lab_2.text="未开启",this.lab_2.textColor=15655878),i.cost.length<=1||!this.data.getState()?this.redimg.visible=!1:this.redimg.visible=e.BagController.getInstance().getCountByItemId(i.cost[0].id)>=i.cost[0].value&&e.BagController.getInstance().getCountByItemId(i.cost[1].id)>=i.cost[1].value},i.prototype.setshow=function(t){this.img_3.visible=!1,this.img_4.visible=!1,this.redimg.visible=!1,this.lab_2.text="";var i=e.GodHoodConttroller.getInstance().getmodel().godheadtype,n=e.GodHoodConttroller.getInstance().getmodel().getGodHeadDataTempByTypeAndIndex(i,t.getPositionId());this.lab_1.text=t.getLevel()+"",t.getState()?(this.img_1.source="godhood_"+i+"_png",this.img_2.source=n.icon+t.getPositionId()+"_png"):(this.img_1.source="godhood_0_png",this.img_2.source=n.icon+"0_png")},i}(eui.Component);e.GodHooditems=t,__reflect(t.prototype,"foxgame.GodHooditems")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isrepeat=!1,this.tipbool=!1,this.observerList=[],this.roleGodHoodInfo=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)
},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.refreshView()},t.prototype.getGodHeadInfoTempByTypeAndIndex=function(t,i,n){var o=e.JsonDataManager.instance.GodheadLevelTemplate;for(var a in o){var s=o[a];if(s.level==n&&s.positionId==i&&s.type==t)return s}return null},t.prototype.getGodHeadDataTempByTypeAndIndex=function(t,i){var n=e.JsonDataManager.instance.GodheaddataTemplate;for(var o in n){var a=n[o];if(a.positionId==i&&a.type==t)return a}return null},t.prototype.getGodheadHieronTempByIdAndType=function(t,i){var n=e.JsonDataManager.instance.GodheadHieronTemplate;for(var o in n){var a=n[o];if(a.id==t&&a.type==i)return a}return null},t.prototype.getroleGodHoodInfoByroleidandtype=function(t,i){if(this.roleGodHoodInfo.length<=0)return void e.GameUtils.MSG_TIP("神格数据未同步成功");for(var n,o=0;o<this.roleGodHoodInfo.length;o++){var a=this.roleGodHoodInfo[o];a.getRoleId()==t&&(n=a.getGodheadDateInfo())}for(var s=0;s<n.length;s++){var r=n[s];if(r.getType()==i)return r}return null},t.prototype.getroleGodHoodInfoByroleidandtypePos=function(e,t,i){for(var n=this.getroleGodHoodInfoByroleidandtype(e,t),o=0;o<n.getGodheadPropertyInfo().length;o++){var a=n.getGodheadPropertyInfo()[o];if(a.getPositionId()==i)return a}},t.prototype.getroleinfo=function(e){for(var t=0;t<this.roleGodHoodInfo.length;t++)if(this.roleGodHoodInfo[t].getRoleId()==e)return this.roleGodHoodInfo[t];return null},t.prototype.setGodheadUpgrade=function(e){var t=this.getroleGodHoodInfoByroleidandtype(e.getRoleId(),e.getGodheadDateInfo().getType());t.setGodheadPropertyInfo(e.getGodheadDateInfo().getGodheadPropertyInfo()),t.setAttrValue(e.getGodheadDateInfo().getAttrValue()),t.setId(e.getGodheadDateInfo().getId()),t.setState(e.getGodheadDateInfo().getState())},t.prototype.setGodheadHieron=function(t){var i=this.getroleGodHoodInfoByroleidandtype(t.getRoleId(),t.getType());if(t.getGodheadDateInfo()){var n=this.getroleGodHoodInfoByroleidandtype(t.getRoleId(),t.getGodheadDateInfo().getType());n.setGodheadPropertyInfo(t.getGodheadDateInfo().getGodheadPropertyInfo())}i.setId(t.getHieronId()),i.setState(t.getHieronSate()),i.setAttrValue(t.getAttrValue()),e.GodHoodConttroller.getInstance().showgodHoodturntable(t)},t.prototype.setgodhoodinfo=function(t){return 0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.roleGodHoodInfo=t.getPlayerGodHeadInfo(),void this.updateView())},t.prototype.setgodhoodupinfo=function(t){return this.isrepeat=!1,0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(e.GodHoodConttroller.getInstance().getpanel().playuplevelAni(),this.setGodheadUpgrade(t),void this.updateView())},t.prototype.setgodhoodhierominfo=function(t){return this.isrepeat=!1,0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.setGodheadHieron(t),void this.updateView())},t}();e.GodHoodModel=t,__reflect(t.prototype,"foxgame.GodHoodModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"godhoodpanel")||this;return i.islevelMax=!1,i.isiteminadequate=!1,i.isactivation=!1,i.grouplist=[],i.groupXliat=[],i.model=e,i.isMask=!1,i.setRemoveForward(!0),i}return __extends(i,t),i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.roleIndex)},i.prototype.initHook=function(){this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.model.registerObserver(this),e.BagController.getInstance().registerObserver(this);var t=0;for(t=0;t<this.getlistbtn().length;t++)this.getlistbtn()[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this);for(t=0;t<this.geticon().length;t++)this.geticon()[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this);for(this.ui.icon9.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this),this.ui.btn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.updata.addEventListener(egret.TouchEvent.TOUCH_TAP,this.updata,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.addGoldCoinBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.addYuanBaoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.btn_5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.model.selection=1,e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.grouplist=[],this.groupXliat=[],t=0;t<this.getgroup().length;t++)this.grouplist.push(this.getgroup()[t]),this.groupXliat.push(this.getgroup()[t].x),this.showleftbarBtn(this.getgroup()[t],!1);for(t=0;11>=t;t++){var i=new e.FoxAni(this.getnlimg(t));i.scaleX=1.3,i.play("weapupEffect")}},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.updata=function(t){var i=this;if(-1==this.model.selection){if(this.isiteminadequate)return void e.GameUtils.MSG_TIP("道具不足");if(this.model.isrepeat)return void console.log("%c未成功接收神格信息","font-size:30px;color:red");if(this.model.isrepeat=!0,!this.model.tipbool&&"重置"==this.ui.updata.label)return void e.PopUpController.getInstance().showTextPanel2(e.LanguageUtils.instance.getValue("GODHOODMESSAGE2"),this,function(t){t&&(i.model.tipbool=t),e.GodHoodConttroller.getInstance().sendGODHEAD_ACTIVATE_HIERON_C(i.model.roleData.roleId,i.model.godheadtype)},{tipbool:this.model.tipbool},function(){i.model.isrepeat=!1},null,"确认");e.GodHoodConttroller.getInstance().sendGODHEAD_ACTIVATE_HIERON_C(this.model.roleData.roleId,this.model.godheadtype)}else{if(this.isactivation)return void e.GameUtils.MSG_TIP("未激活");if(this.islevelMax)return void e.GameUtils.MSG_TIP("已满级");if(this.isiteminadequate)return void e.GameUtils.MSG_TIP("道具不足");if(this.model.isrepeat)return void console.log("%c未成功接收神格信息","font-size:30px;color:red");this.model.isrepeat=!0,e.GodHoodConttroller.getInstance().sendGODHEAD_ACTIVATE_UPGRAD_C(this.model.roleData.roleId,this.model.godheadtype,this.model.selection)}},i.prototype.showHook=function(){this.getlistbtn()[this.model.godheadtype-1].currentState="down"},i.prototype.openview=function(t){var i=this;switch(t.target){case this.ui.btn_0:e.GodHoodConttroller.getInstance().showgodhoodpreview(this.model.godheadtype);break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("GODHOODHELP");break;case this.ui.addGoldCoinBtn:e.ItemNotEnoughController.getInstance().showPanel(this.oneitemId,function(){i.close(),e.CharacterController.getInstance().closePanel()},this);break;case this.ui.addYuanBaoBtn:e.ItemNotEnoughController.getInstance().showPanel(this.twoitemId,function(){i.close(),e.CharacterController.getInstance().closePanel()},this);break;case this.ui.btn_5:e.GoldTreasureController.getInstance().showpanel()}},i.prototype.clickicon=function(e){var t;this.setselect(e.currentTarget),e.currentTarget==this.ui.icon9?(this.model.selection=-1,this.ui.smallicon.visible=!1,this.ui.bigicon.visible=!0):(t=e.currentTarget.data,this.model.selection=t.getPositionId(),this.ui.smallicon.visible=!0,this.ui.bigicon.visible=!1),this.refresh()},i.prototype.setselect=function(e){e==this.ui.icon9?this.ui.icon9.setselect(!0):this.ui.icon9.setselect(!1);for(var t=0;t<this.geticon().length;t++)this.geticon()[t]==e?this.geticon()[t].setselect(!0):this.geticon()[t].setselect(!1)},i.prototype.clickbtn=function(e,t){if(void 0===t&&(t=-1),-1!=t){for(var i=0;i<this.getlistbtn().length;i++)this.getlistbtn()[i].currentState="up";return this.getlistbtn()[t-1].currentState="down",void this.refresh()}if("down"!=e.target.currentState){for(var i=0;i<this.getlistbtn().length;i++)e.target==this.getlistbtn()[i]?(this.getlistbtn()[i].currentState="down",this.model.godheadtype=i+1):this.getlistbtn()[i].currentState="up";this.refresh()}},i.prototype.refresh=function(){this.ui.currency.refresh();for(var e=this.model.getroleGodHoodInfoByroleidandtype(this.model.roleData.roleId,this.model.godheadtype),t=0;t<this.geticon().length;t++)this.geticon()[t].setDate(this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,this.model.godheadtype,t+1),this.model.selection);this.ui.icon9.setDate(e),this.ui.bigicon.visible=!1,this.ui.smallicon.visible=!1,-1==this.model.selection?(this.ui.bigicon.visible=!0,this.ui.bigicon.setshow(e),this.refreshThrone(e)):(this.refreshfunctiongodhood(this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,this.model.godheadtype,this.model.selection)),this.ui.smallicon.visible=!0,this.ui.smallicon.setshow(this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,this.model.godheadtype,this.model.selection))),this.refreshRedPoint(),this.refreshnl(e),this.refreshBtn()},i.prototype.refreshBtn=function(){for(var e=this.model.getroleinfo(this.model.roleData.roleId),t=0;t<e.getGodheadDateInfo().length;t++)1==e.getGodheadDateInfo()[t].getGodheadPropertyInfo()[0].getState()?this.showleftbarBtn(this.getgroupByid(t),!0):this.showleftbarBtn(this.getgroupByid(t),!1);this.showleftbarBtn(this.getgroupByid("4"),!0)},i.prototype.refreshnl=function(e){for(var t=0;t<e.getGodheadPropertyInfo().length;t++){var i=e.getGodheadPropertyInfo()[t];1!=i.getPositionId()?2!=i.getPositionId()?3!=i.getPositionId()?4!=i.getPositionId()?5!=i.getPositionId()?6!=i.getPositionId()?7!=i.getPositionId()?8!=i.getPositionId()||(i.getLevel()>=1&&e.getId()>0?this.getnlimg(11).visible=!0:this.getnlimg(11).visible=!1):i.getLevel()>=1&&e.getId()>0?this.getnlimg(10).visible=!0:this.getnlimg(10).visible=!1:i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),8).getLevel()>=1?this.getnlimg(9).visible=!0:this.getnlimg(9).visible=!1:(i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),7).getLevel()>=1?this.getnlimg(7).visible=!0:this.getnlimg(7).visible=!1,i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),8).getLevel()>=1?this.getnlimg(8).visible=!0:this.getnlimg(8).visible=!1):i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),7).getLevel()>=1?this.getnlimg(6).visible=!0:this.getnlimg(6).visible=!1:(i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),5).getLevel()>=1?this.getnlimg(4).visible=!0:this.getnlimg(4).visible=!1,i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),6).getLevel()>=1?this.getnlimg(5).visible=!0:this.getnlimg(5).visible=!1):(i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),4).getLevel()>=1?this.getnlimg(2).visible=!0:this.getnlimg(2).visible=!1,i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),5).getLevel()>=1?this.getnlimg(3).visible=!0:this.getnlimg(3).visible=!1):(i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),2).getLevel()>=1?this.getnlimg(0).visible=!0:this.getnlimg(0).visible=!1,i.getLevel()>=1&&this.model.getroleGodHoodInfoByroleidandtypePos(this.model.roleData.roleId,e.getType(),3).getLevel()>=1?this.getnlimg(1).visible=!0:this.getnlimg(1).visible=!1)}},i.prototype.refreshThrone=function(t){this.ui.upgroup.visible=!1,this.ui.img_1.visible=!1,this.ui.lab_0.text=this.ui.lab_3.text=this.ui.lab_2.text=this.ui.lab_4.text="",this.ui.updata.visible=!1,this.ui.lab_1.text="";var i=e.JsonDataManager.instance.itemTemplate;if(t.getState()){this.ui.updata.visible=!0,this.ui.upgroup.visible=!0;var n=void 0,o=void 0;if(0==t.getId()){this.ui.lab_name.textFlow=(new egret.HtmlTextParser).parser("<font color=0xffe400>神位</font><font color=0x21FF03>（可激活）</font>"),this.ui.lab_2.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GODHOODMESSAGE3_1")),this.ui.lab_4.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GODHOODMESSAGE3_2")),this.ui.updata.label="激活";var a=e.JsonDataManager.instance.GodheadActivationTemplate[t.getType()+"_0"];n=a.cost[0],o=a.cost[1]}else{var s=this.model.getGodheadHieronTempByIdAndType(t.getId(),t.getType());this.ui.lab_name.text=s.name,this.ui.lab_name.textColor=e.ColorUtils.instance.getColorByQuality(s.quality),this.ui.updata.label="重置";var a=e.JsonDataManager.instance.GodheadActivationTemplate[t.getType()+"_1"];n=a.cost[0],o=a.cost[1];for(var r="",l=0;l<t.getAttrValue().length;l++){var h=t.getAttrValue()[l];r+="<font color=0x21ff03>",r+=e.LanguageUtils.instance.getValue("ATT_"+h.getAttrId())+":"+e.GlobalUtil.getAttrValueStr(h.getAttrId(),h.getAttrValue())+",</font>",1==l&&(r+="<font>\n</font>")}var c=r.split("");c.splice(r.lastIndexOf(","),1,""),r=c.join(""),this.ui.lab_2.text="属性:",this.ui.lab_1.textFlow=(new egret.HtmlTextParser).parser(r)}n.type==e.AttributeType.COIN?(this.ui.goldCoinLab.textFlow=e.GlobalUtil.createMaterialProTextFlow(e.PlayerService.instance.playerInfo.getCoin(),n.value),this.isiteminadequate=e.PlayerService.instance.playerInfo.getCoin()<n.value||e.BagController.getInstance().getCountByItemId(o.id)<o.value):(this.ui.goldCoinLab.textFlow=e.GlobalUtil.createMaterialProTextFlow(e.BagController.getInstance().getCountByItemId(n.id),n.value),this.isiteminadequate=e.BagController.getInstance().getCountByItemId(n.id)<n.value||e.BagController.getInstance().getCountByItemId(o.id)<o.value),this.oneitemId=n.id,this.twoitemId=o.id;var u=i[n.id],p=i[o.id];this.ui.coinImg.source=u.icon,this.ui.yuanbaoImg.source=p.icon,this.ui.yuanBaoLab.textFlow=e.GlobalUtil.createMaterialProTextFlow(e.BagController.getInstance().getCountByItemId(o.id),o.value)}else this.ui.lab_name.textFlow=(new egret.HtmlTextParser).parser("<font color=0xffe400>神位</font><font color=0xff0400>（未激活）</font>"),this.ui.lab_2.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GODHOODMESSAGE5"))},i.prototype.refreshfunctiongodhood=function(t){this.ui.img_1.visible=!0,this.ui.updata.visible=!0,this.ui.lab_2.text="升级效果:",this.ui.updata.label="升级",this.ui.lab_1.text="";var i=this.model.getGodHeadDataTempByTypeAndIndex(this.model.godheadtype,t.getPositionId()),n=this.model.getGodHeadInfoTempByTypeAndIndex(this.model.godheadtype,t.getPositionId(),t.getLevel());if(t.getState()){this.isactivation=!1,this.ui.lab_4.text="",this.ui.upgroup.visible=!0,this.ui.lab_name.textFlow=(new egret.HtmlTextParser).parser("<font color="+e.ColorUtils.instance.getColorByQuality(i.quality)+">"+n.name+"</font><font color=0xFFE400> Lv."+t.getLevel()+"</font>");var o=(e.PlayerService.instance.playerInfo,e.JsonDataManager.instance.itemTemplate);if(1==n.cost.length)this.ui.upgroup.visible=!1;else{var a=n.cost[0],s=n.cost[1],r=o[a.id],l=o[s.id];this.oneitemId=a.id,this.twoitemId=s.id,this.ui.coinImg.source=r.icon,this.ui.yuanbaoImg.source=l.icon,this.isiteminadequate=e.BagController.getInstance().getCountByItemId(a.id)<a.value||e.BagController.getInstance().getCountByItemId(s.id)<s.value,this.ui.goldCoinLab.textFlow=e.GlobalUtil.createMaterialProTextFlow(e.BagController.getInstance().getCountByItemId(a.id),a.value),this.ui.yuanBaoLab.textFlow=e.GlobalUtil.createMaterialProTextFlow(e.BagController.getInstance().getCountByItemId(s.id),s.value)}}else this.isactivation=!0,this.ui.upgroup.visible=!1,this.ui.lab_4.textFlow=(new egret.HtmlTextParser).parser(i.condition),this.ui.lab_name.textFlow=(new egret.HtmlTextParser).parser("<font color=0xFFE400>"+n.name+"</font><font color=0xff0400>（未激活）</font>");for(var h=0;h<n.attrTypeList.length;h++)this.ui.lab_0.text=e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[h])+":"+n.attrValueList[h];var c=this.model.getGodHeadInfoTempByTypeAndIndex(this.model.godheadtype,t.getPositionId(),t.getLevel()+1);if(null==c)this.islevelMax=!0,this.ui.lab_3.text=e.LanguageUtils.instance.getValue("YIMANJI"),this.ui.lab_4.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GODHOODMESSAGE1"));else{this.islevelMax=!1;for(var u=0;u<n.attrTypeList.length;u++)this.ui.lab_3.text=e.LanguageUtils.instance.getValue("ATT_"+c.attrTypeList[u])+":"+c.attrValueList[u]}},i.prototype.closeHook=function(){46==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.refreshView=function(){this.getIsShow()&&this.refresh()},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:if(!this.getIsShow()||29==i)return;e.PlayerService.instance.getRoleDataList();this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.refreshRedPoint=function(){for(var e=this.model.roleGodHoodInfo,t=0;t<e.length;t++)e[t].getRoleId()==this.model.roleData.roleId?this.ui.headBar.setRedStatusByRoleId(e[t].getRoleId(),this.shenweihondian(e[t])):this.ui.headBar.setRedStatusByRoleId(e[t].getRoleId(),this.shenweihondian(e[t],!1))},i.prototype.shenweihondian=function(t,i){void 0===i&&(i=!0);for(var n=t,o=!1,a=0;a<n.getGodheadDateInfo().length;a++){var s=n.getGodheadDateInfo()[a],r=void 0,l=void 0,h=!1;if(0!=s.getId()&&s.getState()){var c=e.JsonDataManager.instance.GodheadActivationTemplate[s.getType()+"_1"];r=c.cost[0],l=c.cost[1]}else if(0==s.getId()&&s.getState()){var c=e.JsonDataManager.instance.GodheadActivationTemplate[s.getType()+"_0"];r=c.cost[0],l=c.cost[1]}if(r&&r.type==e.AttributeType.COIN){if(e.PlayerService.instance.playerInfo.getCoin()>=r.value&&e.BagController.getInstance().getCountByItemId(l.id)>=l.value){if(0==i)return!0;o=h=!0}}else if(r&&e.BagController.getInstance().getCountByItemId(r.id)>=r.value&&e.BagController.getInstance().getCountByItemId(l.id)>=l.value){if(0==i)return!0;o=h=!0}for(var u=0;u<s.getGodheadPropertyInfo().length;u++){var p=s.getGodheadPropertyInfo()[u];if(p.getState()){var g=this.model.getGodHeadInfoTempByTypeAndIndex(s.getType(),p.getPositionId(),p.getLevel());if(null!=this.model.getGodHeadInfoTempByTypeAndIndex(s.getType(),p.getPositionId(),p.getLevel()+1)&&e.BagController.getInstance().getCountByItemId(g.cost[0].id)>=g.cost[0].value&&e.BagController.getInstance().getCountByItemId(g.cost[1].id)>=g.cost[1].value){if(0==i)return!0;o=h=!0;break}}}1==i&&(this.getredimg(s.getType()).visible=h)}return 0==i?!1:o},i.prototype.playuplevelAni=function(){var t=this;this.intensifyAni||(this.intensifyAni=new e.FoxAni(this.ui.aniuplevel),this.intensifyAni.setPlayComplete(function(){t.intensifyAni.clear(),t.intensifyAni=null},this),this.intensifyAni.play("chenggongFX","ani",1))},i.prototype.playani=function(){var t=this;this.effectAni||(this.effectAni=new e.FoxAni(this.ui.anigroup),this.effectAni.setPlayComplete(function(){t.effectAni.clear(),t.effectAni=null},this),this.effectAni.play("godhoodAni","ani",2))},i.prototype.setRoleData=function(e){this.model.roleData=e;for(var t=this.model.godheadtype;t<=this.model.godheadtype;t--){var i=this.model.getroleGodHoodInfoByroleidandtypePos(e.roleId,t,1);if(i.getState())return this.model.godheadtype=t,void this.clickbtn(null,this.model.godheadtype)}},i.prototype.getlistbtn=function(){var e=[this.ui.btn_1,this.ui.btn_2,this.ui.btn_3,this.ui.btn_4];return e},i.prototype.geticon=function(){var e=[this.ui.icon1,this.ui.icon2,this.ui.icon3,this.ui.icon4,this.ui.icon5,this.ui.icon6,this.ui.icon7,this.ui.icon8];return e},i.prototype.getredimg=function(e){return this.ui["redimg"+e]},i.prototype.getnlimg=function(e){return this.ui["nl"+e]},i.prototype.getgroup=function(){var e=[this.ui.group0,this.ui.group1,this.ui.group2,this.ui.group3,this.ui.group4];return e},i.prototype.getgroupByid=function(e){return this.ui["group"+e]},i.prototype.showleftbarBtn=function(e,t){for(var i,n=this.grouplist.length,o=0,a=0;n>a;a++)i=this.grouplist[a],i==e&&(i.visible=t),1==i.visible&&(i.x=this.groupXliat[o++])},i}(e.BasePanel);e.GodHoodPanel=t,__reflect(t.prototype,"foxgame.GodHoodPanel",["foxgame.IMessage","foxgame.IGodHood","foxgame.IObserver","foxgame.IBag"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"godhoodpreview")||this;return e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showHook=function(){},i.prototype.showpanel=function(e){this.type=e,this.show()},i.prototype.initHook=function(){for(var e=0;e<this.geticon().length;e++)this.geticon()[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this)},i.prototype.clickicon=function(t){var i=t.currentTarget.info;e.TipsController.getInstance().showGodHoodTips(i.type,i.id)},i.prototype.refresh=function(){for(var e=this.gettemp(this.type),t=0;t<this.geticon().length;t++)this.geticon()[t].setshowicon(e[t+1]);this.ui.title.text=e[1].godname+"神位预览"},i.prototype.gettemp=function(t){var i={},n=e.JsonDataManager.instance.GodheadHieronTemplate;for(var o in n){var a=n[o];a.type==t&&(i[a.id]=a)}return i},i.prototype.geticon=function(){var e=[this.ui.icon0,this.ui.icon1,this.ui.icon2,this.ui.icon3,this.ui.icon4,this.ui.icon5,this.ui.icon6,this.ui.icon7];return e},i}(e.BasePanel);e.GodHoodpreview=t,__reflect(t.prototype,"foxgame.GodHoodpreview")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"godhoodtip")||this;return e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(e,t){this.type=e,this.id=t,this.show()},i.prototype.gettemp=function(t,i){var n=e.JsonDataManager.instance.GodheadHieronTemplate;for(var o in n){var a=n[o];if(a.type==t&&a.id==i)return a}return null},i.prototype.showHook=function(){},i.prototype.refresh=function(){var t=this.gettemp(this.type,this.id);this.ui.godname.text=t.name,this.ui.godname.textColor=e.ColorUtils.instance.getColorByQuality(t.quality),this.ui.bgImg.source="qualityBg"+t.quality+"_png",this.ui.lab_1.text=t.godname,this.ui.tips.textFlow=(new egret.HtmlTextParser).parser(t.tips),this.ui.scoreLabel.text=t.score,this.ui.icon.setshowicon(t,!1)},i}(e.BasePanel);e.GodHoodTips=t,__reflect(t.prototype,"foxgame.GodHoodTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"godhoodturntable")||this;return e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.initHook=function(){},i.prototype.showpanel=function(e){this.data=e,this.show()},i.prototype.showHook=function(){for(var e=this.gettemp(this.data.getType()),t=0;t<this.geticon().length;t++)this.geticon()[t].setshowicon(e[t+1])},i.prototype.refresh=function(){var e=this;this.ui.group.rotation=0;var t=45*this.data.getHieronId()+1080;egret.Tween.get(this.ui.group,{}).to({rotation:t},4500,egret.Ease.quadOut).wait(1500).call(function(){e.close()})},i.prototype.readyDestroy=function(){var t=this.getgodhoodtemp(this.data.getType(),this.data.getHieronId());e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GODHOODMESSAGE4",e.ColorUtils.instance.getColorByQuality(t.quality),t.name)),egret.Tween.removeTweens(this.ui.group)},i.prototype.closeHook=function(){e.GodHoodConttroller.getInstance().getpanel().playani()},i.prototype.getgodhoodtemp=function(t,i){var n=e.JsonDataManager.instance.GodheadHieronTemplate;for(var o in n){var a=n[o];if(a.type==t&&a.id==i)return a}return null},i.prototype.gettemp=function(t){var i={},n=e.JsonDataManager.instance.GodheadHieronTemplate;for(var o in n){var a=n[o];a.type==t&&(i[a.id]=a)}return i},i.prototype.geticon=function(){var e=[this.ui.icon1,this.ui.icon2,this.ui.icon3,this.ui.icon4,this.ui.icon5,this.ui.icon6,this.ui.icon7,this.ui.icon8];return e},i}(e.BasePanel);e.GodHoodturntable=t,__reflect(t.prototype,"foxgame.GodHoodturntable")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/godlyEquip/GodlyEquipChoose.exml")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.scroller.verticalScrollBar.autoVisibility=!1;var t=this.ui.list;this.collection=new eui.ArrayCollection,t.dataProvider=this.collection,t.itemRenderer=e.ChangeEquipItem},i.prototype.refresh=function(){var t=this.tempEquip[this.model.equipInfo.getEquipId()],i=[],n=e.BagController.getInstance().getEquipInfosByPart(e.EquipPartType.GOD_1),o=e.BagController.getInstance().getEquipInfosByPart(e.EquipPartType.GOD_2),a=e.BagController.getInstance().getEquipInfosByPart(e.EquipPartType.GOD_3);i=i.concat(n,o,a);var s,r,l,h=[],c=this.tempGodlyEquip[t.id],u=i.length;for(l=0;u>l;l++)r=i[l],this.model.equipGId1!=r.getId()&&this.model.equipGId2!=r.getId()&&(s=this.tempGodlyEquip[r.getEquipId()],s.level==c.level&&h.push(r));e.ChangeEquipItem.type=2,this.collection.replaceAll(h),this.ui.scroller.viewport.scrollV=0},Object.defineProperty(i.prototype,"tempEquip",{get:function(){return e.JsonDataManager.instance.equipTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempGodlyEquip",{get:function(){return e.JsonDataManager.instance.godlyEquipTemplate},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.GodlyEquipChoosePanel=t,__reflect(t.prototype,"foxgame.GodlyEquipChoosePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/godlyEquip/GodlyEquipCompose.exml")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.composeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.composeHandler,this),this.ui.item2.setItem(-1)},i.prototype.refresh=function(){var t,i,n=e.GlobalConfig.instance.getValue("GODLYEQUIP_COMPOUND_COST").split(","),o=[],a=n.length;for(t=0;a>t;t++)i=new e.AttributeVO(n[t]),o.push(i);for(t=0;a>t;t++)o[t].type==e.AttributeType.ITEM?this.itemCostVO=o[t]:o[t].type==e.AttributeType.DIAMOND&&(this.costVO2=o[t]);this.ui.desLabel.text=e.LanguageUtils.instance.getValue("GODLYEQUIPCOMPOSECONFIRM",this.itemCostVO.value),this.ui.item1.setItem(this.itemCostVO.id,1);var s=e.BagController.getInstance().getCountByItemId(this.itemCostVO.id);this.ui.numLabel.textFlow=e.GlobalUtil.createMaterialProTextFlow(s,this.itemCostVO.value),this.ui.priceLabel.text=this.costVO2.value.toString()},i.prototype.composeHandler=function(t){var i=e.BagController.getInstance().getCountByItemId(this.itemCostVO.id);return i<this.itemCostVO.value?void e.ItemNotEnoughController.getInstance().showPanel(this.itemCostVO.id):e.PlayerService.instance.playerInfo.getGold()<this.costVO2.value?void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):void e.BagController.getInstance().checkBagEnough(this,this.backFun)},i.prototype.backFun=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEquipGodCompoundReq");e.Message.instance.send(e.Code.EQUIP_GOD_COMPOUND_C,t,!0),this.close()},i}(e.BasePanel);e.GodlyEquipComposePanel=t,__reflect(t.prototype,"foxgame.GodlyEquipComposePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.GodlyEquipModel,this.panel=new e.GodlyEquipPanel(this.model),this.composePanel=new e.GodlyEquipComposePanel(this.model),this.choosePanel=new e.GodlyEquipChoosePanel(this.model),this.inlayPanel=new e.GodlyEquipInlayPanel(this.model),this.upgradePanel=new e.GodlyEquipUpgradePanel(this.model)}return t.prototype.showPanel=function(t){void 0===t&&(t=0);var i=parseInt(e.GlobalConfig.instance.getValue("GODLYEQUIP_OPENLEVEL"));return e.PlayerService.instance.level<i?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GODLYEQUIPOPEN",i)):void this.panel.showPanel(t)},t.prototype.showComposePanel=function(){this.composePanel.show()},t.prototype.closeComposePanel=function(){this.composePanel.close()},t.prototype.showChoosePanel=function(){this.choosePanel.show()},t.prototype.closeChoosePanel=function(){this.choosePanel.close()},t.prototype.showInlayPanel=function(){this.inlayPanel.show()},t.prototype.showUpgradePanel=function(){this.upgradePanel.show()},t.prototype.addUpgradeItem=function(e){this.model.addUpgradeEquipGid(e),this.upgradePanel.updateView()},t.prototype.getEquipedScore=function(){return this.model.getEquipedScore()},t.prototype.checkOperate=function(t){var i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.SHENQI,!1);return i&&(this.checkEquipOperate(t)||this.checkComposeOperate()||this.checkInlayOperate(t)||this.checkUpgradeOperate(t))?!0:!1},t.prototype.checkEquipOperate=function(t){for(var i,n=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],o=n.length,a=0;o>a;a++)if(i=this.checkEquipOperate1(t,n[a]))return!0;return!1},t.prototype.checkEquipOperate1=function(t,i){var n,o,a;if(n=t.getEquipInfoByPart(i),a=e.BagController.getInstance().getEquipInfosByProfAndPart(t.profession,i),o=a[0],null!=n){if(null!=o&&Number(n.getScore())<Number(o.getScore()))return!0}else if(null!=o)return!0;return!1},t.prototype.checkComposeOperate=function(){for(var t,i,n,o=e.GlobalConfig.instance.getValue("GODLYEQUIP_COMPOUND_COST").split(","),a=[],s=o.length,r=0;s>r;r++)t=new e.AttributeVO(o[r]),a.push(t);for(var r=0;s>r;r++)a[r].type==e.AttributeType.ITEM?i=a[r]:a[r].type==e.AttributeType.DIAMOND&&(n=a[r]);if(e.PlayerService.instance.playerInfo.getGold()<n.value)return!1;var l=e.BagController.getInstance().getCountByItemId(i.id);return l<i.value?!1:!0},t.prototype.checkInlayOperate=function(t){for(var i,n=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],o=n.length,a=0;o>a;a++)if(i=this.checkInlayOperate1(t,n[a]))return!0;return!1},t.prototype.checkInlayOperate1=function(t,i){var n=t.getEquipInfoByPart(i);if(null==n)return!1;for(var o,a,s=t.godlyEquipPartInfoList,r=s.length,l=e.JsonDataManager.instance.godlyEquipInlayTemplate,h=0;r>h;h++)if(s[h].getPartId()==i){a=s[h],o=l[a.getPartId()+"_"+a.getInlayLevel()];break}var c=l[a.getPartId()+"_"+(a.getInlayLevel()+1)];if(null==c)return!1;var u=e.BagController.getInstance().getCountByItemId(o.costVO.id);return u>=o.costVO.value},t.prototype.checkUpgradeOperate=function(t){for(var i,n=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],o=n.length,a=0;o>a;a++)if(i=this.checkUpgradeOperate1(t,n[a]))return!0;return!1},t.prototype.checkUpgradeOperate1=function(t,i){var n=t.getEquipInfoByPart(i);if(null==n)return!1;var o=e.JsonDataManager.instance.godlyEquipTemplate,a=o[n.getEquipId()],s=o[a.nextId];if(null==s)return!1;var r=e.JsonDataManager.instance.equipTemplate,l=(r[n.getEquipId()],[]),h=e.BagController.getInstance().getEquipInfosByPart(e.EquipPartType.GOD_1),c=e.BagController.getInstance().getEquipInfosByPart(e.EquipPartType.GOD_2),u=e.BagController.getInstance().getEquipInfosByPart(e.EquipPartType.GOD_3);l=l.concat(h,c,u);for(var p,g=[],d=l.length,f=0;d>f;f++)n=l[f],p=o[n.getEquipId()],p.level==a.level&&g.push(n);if(g.length<a.costNum)return!1;var m=e.JsonDataManager.instance.itemTemplate;m[a.costAttVO.id];return e.PlayerService.instance.playerInfo.getGold()>=a.costAttVO.value},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t}();e.GodlyEquipController=t,__reflect(t.prototype,"foxgame.GodlyEquipController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/godlyEquip/GodlyEquipInlay.exml")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.inlayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inlayHandler,this)},i.prototype.refresh=function(){var t=(this.model.godlyEquipPartInfo.getPartId(),this.model.godlyEquipPartInfo.getInlayLevel(),this.tempEquip[this.model.equipInfo.getEquipId()]),i=this.tempGodlyEquipInlay[this.model.godlyEquipPartInfo.getPartId()+"_"+(this.model.godlyEquipPartInfo.getInlayLevel()+1)];this.ui.desLabel.text=e.LanguageUtils.instance.getValue("GODLYEQUIPINLAYDESCRIBE",t.name,i.rateStr);var n=this.tempGodlyEquipInlay[this.model.godlyEquipPartInfo.getPartId()+"_"+this.model.godlyEquipPartInfo.getInlayLevel()];this.ui.icon.setItem(n.costVO.id);
var o=e.BagController.getInstance().getCountByItemId(n.costVO.id);this.ui.needLabel.textFlow=this.createMaterialProTextFlow(o,n.costVO.value)},i.prototype.createMaterialProTextFlow=function(t,i){var n;n=t>=i?65280:16711680;var o=[{text:e.LanguageUtils.instance.getValue("XUYAOSHULIANG")+":",style:{textColor:16777215}},{text:t+"",style:{textColor:n}},{text:"/"+i,style:{textColor:16777215}}];return o},i.prototype.inlayHandler=function(t){var i=this.tempGodlyEquipInlay[this.model.godlyEquipPartInfo.getPartId()+"_"+this.model.godlyEquipPartInfo.getInlayLevel()],n=e.BagController.getInstance().getCountByItemId(i.costVO.id);if(i.costVO.value>n)return void e.ItemNotEnoughController.getInstance().showPanel(i.costVO.id);var o=HawkProtocolManager.newBuilder("JsProto.HPEquipGodInlayReq");o.setRoleId(this.model.roleData.roleId),o.setPart(this.model.godlyEquipPartInfo.getPartId()),e.Message.instance.send(e.Code.EQUIP_GOD_INLAY_C,o,!0),this.close()},i.prototype.closeHook=function(){e.NewJueweiController.getInstance().updateNobilityData()},Object.defineProperty(i.prototype,"tempGodlyEquipInlay",{get:function(){return e.JsonDataManager.instance.godlyEquipInlayTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempEquip",{get:function(){return e.JsonDataManager.instance.equipTemplate},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.GodlyEquipInlayPanel=t,__reflect(t.prototype,"foxgame.GodlyEquipInlayPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="GodlyEquipItem",this.equipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.equipHandler,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.equipRedImg.visible=!1},i.prototype.setItem=function(t,i,n,o){if(this.roleId=t,this.profession=i,this.part=n,this.equipInfo=e.BagController.getInstance().getEquipInfoById(o),this.typeImg1.visible=!1,this.typeImg2.visible=!1,this.typeImg3.visible=!1,this.typeImg4.visible=!1,this.typeImg5.visible=!1,this.equipInfo){this.icon.setItem(this.equipInfo.getEquipId(),1,!1,!1),this.icon.visible=!0;var a=this.tempGodlyEquip()[this.equipInfo.getEquipId()];this.levelLabel.text=a.level+e.LanguageUtils.instance.getValue("JIE")}else this.icon.visible=!1,this.part==e.EquipPartType.GOD_1?this.profession==e.ProfessionType.PROFESSION1?this.typeImg1.visible=!0:this.profession==e.ProfessionType.PROFESSION2?this.typeImg2.visible=!0:this.profession==e.ProfessionType.PROFESSION3&&(this.typeImg3.visible=!0):this.part==e.EquipPartType.GOD_2?this.typeImg4.visible=!0:this.part==e.EquipPartType.GOD_3&&(this.typeImg5.visible=!0),this.levelLabel.text=e.LanguageUtils.instance.getValue("WEIHUODE")},i.prototype.setSelected=function(e){this._selected=e,this.borderImg.visible=this._selected},i.prototype.getSelected=function(){return this._selected},i.prototype.setRedImgVisible=function(e){this.equipRedImg.visible=e},i.prototype.setOtherRedImgVisible=function(e){this.otherRedImg.visible=e},i.prototype.equipHandler=function(t){e.ChangeEquipController.getInstance().showPanel(this.roleId,this.part,this.equipInfo)},i.prototype.tempGodlyEquip=function(){return e.JsonDataManager.instance.godlyEquipTemplate},i}(e.ViewControler);e.GodlyEquipItem=t,__reflect(t.prototype,"foxgame.GodlyEquipItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.equipGId1=-1,this.equipGId2=-1}return e.prototype.addUpgradeEquipGid=function(e){1==this.waitIndex?this.equipGId1=e:2==this.waitIndex&&(this.equipGId2=e)},e.prototype.getEquipedScore=function(){return this.equipInfo?this.equipInfo.getScore():-1},e}();e.GodlyEquipModel=t,__reflect(t.prototype,"foxgame.GodlyEquipModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/godlyEquip/GodlyEquipPanel.exml","godlyEquipPanel")||this;return n.partList=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],n.tweenTime=2e3,n.tweenDir=50,n.isMask=!1,n.model=i,n.isMaskdown=!0,n.adaptionType=1,n}return __extends(i,t),i.prototype.initHook=function(){this.ui.composeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.composeHandler,this),this.ui.inlayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inlayHandler,this),this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.headBar.setBackFun(this.setRoleData.bind(this));for(var t=this.getItemList(),i=t.length,n=0;i>n;n++)t[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.startY=this.ui.equipImg.y,e.Message.instance.add(e.MsgCMD.UPDATE_EQUIPINFO,this),e.Message.instance.add(e.Code.EQUIP_GOD_INLAY_S,this),e.Message.instance.add(e.Code.EQUIP_GOD_EVOLUTION_S,this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),e.Message.instance.add(e.Code.EQUIP_GOD_COMPOUND_S,this),this.doScreenAdaptation()},i.prototype.showPanel=function(e){this.model.roleIndex=e,this.show()},i.prototype.closeHook=function(){40==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.roleIndex)},i.prototype.refresh=function(){if(this.ui.currency.refresh(),this.getIsInit()&&this.getIsShow()){var t,i=[];t=this.partList.length;for(var n=0;t>n;n++)i.push(this.model.roleData.getEquipInfoByPart(this.partList[n]));this.model.equipInfo=i[this.curSelectIndex];var o,a,s=this.ui.animGroup,r=this.ui.equipImg;if(null!=this.model.equipInfo)o=this.tempEquip[this.model.equipInfo.getEquipId()],a=this.tempGodlyEquip[o.id],r.source=a.image+"_png",this.imgTween(),this.animation&&(this.animation.clear(),this.animation=null),null==this.animation&&(this.animation=new e.FoxAni(s),this.animation.play("fazhenAnimation","ani",-1)),s.visible=!0,this.ui.nameLabel.text=o.name;else{this.clearImgTween(),r.y=this.startY,s.visible=!1;var l=this.tempEquipByPart[this.partList[this.curSelectIndex]];t=l.length;for(var n=0;t>n;n++)if((l[n].profession==e.ProfessionType.PROFESSION0||l[n].profession==this.model.roleData.profession)&&l[n].partList[0]==this.partList[this.curSelectIndex]){o=l[n];break}a=this.tempGodlyEquip[o.id];var h=this.getGrayImg();r.source=h,this.ui.nameLabel.text=o.name}var c,u=this.model.roleData.godlyEquipPartInfoList;t=u.length;for(var n=0;t>n;n++)if(u[n].getPartId()==this.partList[this.curSelectIndex]){this.model.godlyEquipPartInfo=u[n],c=this.tempGodlyEquipInlay[this.model.godlyEquipPartInfo.getPartId()+"_"+this.model.godlyEquipPartInfo.getInlayLevel()];break}this.ui.addAttrLabel.text=e.LanguageUtils.instance.getValue("GODLYADDATTRIBUTE")+":"+c.rateStr;var p=this.getLevelList();t=p.length;for(var g=this.getGrayLevelList(),n=0;t>n;n++)c.inlayLevel>=n+1?(p[n].visible=!0,g[n].visible=!1):(p[n].visible=!1,g[n].visible=!0);this.ui.scoreLabel.text=a.getScore().toString();var d,f,m,y,I=new Array;t=o.attrTypeList.length;for(var n=0;t>n;n++){d=o.attrTypeList[n],f=o.attrValueList[n],m=e.LanguageUtils.instance.getValue("ATT_"+d)+":",m+=e.GlobalUtil.getAttrValueStr(d,Math.floor(f*c.rate))+"\n",y=e.ColorUtils.instance.getAttrColorById(d);var v={text:m,style:{textColor:y}};I.push(v)}this.ui.baseAttrLabel.textFlow=I;var _,T=this.tempRareAttr[o.rareGroupId];t=T.length;for(var C=new Array,n=0;t>n;n++){_=T[n],m=e.LanguageUtils.instance.getValue("ATT_"+_.attId)+":",m+=e.GlobalUtil.getAttrValueStr(_.attId,_.intensifyMaxVal)+"\n",y=e.ColorUtils.instance.getAttrColorById(_.attId);var v={text:m,style:{textColor:y}};C.push(v)}this.ui.jipinAttrLabel.textFlow=C;var A=this.getItemList();t=A.length;for(var E,S,P,n=0;t>n;n++)P=i[n],S=null!=P?P.getId():-1,E=A[n],E.setItem(this.model.roleData.roleId,this.model.roleData.profession,this.partList[n],S),E.setSelected(this.curSelectIndex==n);this.refreshRedPoint()}},i.prototype.imgTween=function(){this.ui.equipImg},i.prototype.clearImgTween=function(){var e=this.ui.equipImg;TweenMax.killTweensOf(e)},i.prototype.refreshRedPoint=function(){this.refreshHeadRedPoint();var t,i,n,o=this.model.roleData,a=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],s=a.length,r=this.getItemList(),l=e.GodlyEquipController.getInstance();this.ui.composeRedImg.visible=l.checkComposeOperate();for(var h=0;s>h;h++)i=r[h],t=a[h],n=l.checkEquipOperate1(o,t),i.setRedImgVisible(n),i.setOtherRedImgVisible(!1),n=l.checkInlayOperate1(o,t),i.getSelected()&&(this.ui.inlayRedImg.visible=n),n&&i.setOtherRedImgVisible(!0),n=l.checkUpgradeOperate1(o,t),i.getSelected()&&(this.ui.upgradeRedImg.visible=n),n&&i.setOtherRedImgVisible(!0)},i.prototype.refreshHeadRedPoint=function(){for(var t,i,n=e.PlayerService.instance.getRoleDataList(),o=n.length,a=e.GodlyEquipController.getInstance(),s=0;o>s;s++)t=n[s],i=a.checkOperate(t),this.ui.headBar.setRedStatus(s,i)},i.prototype.getGrayImg=function(){var t;return this.partList[this.curSelectIndex]==e.EquipPartType.GOD_1?this.model.roleData.profession==e.ProfessionType.PROFESSION1?t=e.GlobalConfig.instance.getValue("GODLYEQUIP_GRAY1")+"_png":this.model.roleData.profession==e.ProfessionType.PROFESSION2?t=e.GlobalConfig.instance.getValue("GODLYEQUIP_GRAY2")+"_png":this.model.roleData.profession==e.ProfessionType.PROFESSION3&&(t=e.GlobalConfig.instance.getValue("GODLYEQUIP_GRAY3")+"_png"):this.partList[this.curSelectIndex]==e.EquipPartType.GOD_2?t=e.GlobalConfig.instance.getValue("GODLYEQUIP_GRAY4")+"_png":this.partList[this.curSelectIndex]==e.EquipPartType.GOD_3&&(t=e.GlobalConfig.instance.getValue("GODLYEQUIP_GRAY5")+"_png"),t},i.prototype.recvMsg=function(t,i){if(0!=this.getIsShow())switch(t){case e.MsgCMD.UPDATE_EQUIPINFO:this.refresh();break;case e.Code.EQUIP_GOD_COMPOUND_S:var n=i;0==n.getErrorNo()&&this.playAni();break;case e.Code.EQUIP_GOD_INLAY_S:var o=i;o&&this.playAni(),this.refresh();break;case e.Code.EQUIP_GOD_EVOLUTION_S:var a=i;0==a.getErrorNo()&&this.playAni(),this.refresh();break;case e.MsgCMD.REFRESH_PLAYERDATA:this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.setRoleData=function(e){0!=this.getIsShow()&&(this.model.roleData!=e&&(this.curSelectIndex=0),this.model.roleData=e,this.refresh())},i.prototype.itemClickHandler=function(e){var t=this.getItemList().indexOf(e.currentTarget);this.itemSelect(t)},i.prototype.itemSelect=function(e){for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],t.setSelected(o==e);this.curSelectIndex=e,this.refresh()},i.prototype.clear=function(){this.animation&&(this.animation.clear(),this.animation=null)},i.prototype.composeHandler=function(t){e.GodlyEquipController.getInstance().showComposePanel()},i.prototype.inlayHandler=function(t){if(null==this.model.equipInfo)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEICHUANDAISHENQI"));var i=this.tempGodlyEquipInlay[this.model.godlyEquipPartInfo.getPartId()+"_"+(this.model.godlyEquipPartInfo.getInlayLevel()+1)];return null==i?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GODLYEQUIPINLAYMAX")):void e.GodlyEquipController.getInstance().showInlayPanel()},i.prototype.upgradeHandler=function(t){if(null==this.model.equipInfo)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEICHUANDAISHENQI"));var i=this.tempGodlyEquip[this.model.equipInfo.getEquipId()],n=this.tempGodlyEquip[i.nextId];null!=n&&i.level+1==n.level?e.GodlyEquipController.getInstance().showUpgradePanel():e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("GODLYEQUIPUPGRADEMAX"))},i.prototype.readyDestroy=function(){this.clearImgTween(),this.animation&&(this.animation.clear(),this.animation=null)},i.prototype.backHandler=function(){e.CharacterController.getInstance().showPanel(0,this.model.roleIndex,!1),this.close()},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("ARTIFACTHELP")},Object.defineProperty(i.prototype,"tempEquipByPart",{get:function(){return e.JsonDataManager.instance.equipByPartTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempEquip",{get:function(){return e.JsonDataManager.instance.equipTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempGodlyEquip",{get:function(){return e.JsonDataManager.instance.godlyEquipTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempRareAttr",{get:function(){return e.JsonDataManager.instance.rareAttrTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempGodlyEquipInlay",{get:function(){return e.JsonDataManager.instance.godlyEquipInlayTemplate},enumerable:!0,configurable:!0}),i.prototype.getGrayLevelList=function(){var e=[];return e.push(this.ui.grayLevelImg1),e.push(this.ui.grayLevelImg2),e.push(this.ui.grayLevelImg3),e.push(this.ui.grayLevelImg4),e.push(this.ui.grayLevelImg5),e.push(this.ui.grayLevelImg6),e.push(this.ui.grayLevelImg7),e.push(this.ui.grayLevelImg8),e.push(this.ui.grayLevelImg9),e.push(this.ui.grayLevelImg10),e},i.prototype.getLevelList=function(){var e=[];return e.push(this.ui.levelImg1),e.push(this.ui.levelImg2),e.push(this.ui.levelImg3),e.push(this.ui.levelImg4),e.push(this.ui.levelImg5),e.push(this.ui.levelImg6),e.push(this.ui.levelImg7),e.push(this.ui.levelImg8),e.push(this.ui.levelImg9),e.push(this.ui.levelImg10),e},i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.ui.aniGroup.visible=!1},i}(e.BasePanel);e.GodlyEquipPanel=t,__reflect(t.prototype,"foxgame.GodlyEquipPanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/godlyEquip/GodlyEquipUpgrade.exml")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),this.ui.icon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addHandler,this),this.ui.icon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addHandler,this),e.Message.instance.add(e.Code.EQUIP_DRESS_S,this)},i.prototype.initParams=function(){this.model.equipGId1=-1,this.model.equipGId2=-1},i.prototype.refresh=function(){var t=this.tempEquip[this.model.equipInfo.getEquipId()];if(this.ui.icon0.setItem(t.id,1,!1,!1),this.godlyEquipVO=this.tempGodlyEquip[t.id],this.ui.levelLabel0.text=this.godlyEquipVO.level+e.LanguageUtils.instance.getValue("JIE"),this.ui.nameLabel0.text=t.name,this.ui.scoreLabel0.text=this.godlyEquipVO.getScore()+"",this.ui.priceLabel.text=this.godlyEquipVO.costAttVO.value+"",this.model.equipGId1>0){var i=e.BagController.getInstance().getEquipInfoById(this.model.equipGId1),n=this.tempEquip[i.getEquipId()];this.ui.icon1.setItem(i.getEquipId(),1,!1,!1),this.ui.addDesLabel1.text=n.name,this.ui.addImg1.visible=!1}else this.ui.icon1.setItem(-1),this.ui.addImg1.visible=!0,this.ui.addDesLabel1.text=e.LanguageUtils.instance.getValue("GODLYEQUIPUPGRADEPUTIN",this.godlyEquipVO.level);if(this.model.equipGId2>0){var o=e.BagController.getInstance().getEquipInfoById(this.model.equipGId2),a=this.tempEquip[o.getEquipId()];this.ui.icon2.setItem(o.getEquipId(),1,!1,!1),this.ui.addDesLabel2.text=a.name,this.ui.addImg2.visible=!1}else this.ui.icon2.setItem(-1),this.ui.addImg2.visible=!0,this.ui.addDesLabel2.text=e.LanguageUtils.instance.getValue("GODLYEQUIPUPGRADEPUTIN",this.godlyEquipVO.level);var s=this.tempEquip[this.godlyEquipVO.nextId],r=this.tempGodlyEquip[this.godlyEquipVO.nextId];this.ui.icon3.setItem(r.id,1,!1,!1),this.ui.levelLabel3.text=r.level+e.LanguageUtils.instance.getValue("JIE"),this.ui.nameLabel3.text=s.name,this.ui.scoreLabel3.text=r.getScore()+""},i.prototype.updateView=function(){this.refresh()},i.prototype.recvMsg=function(t,i){if(this.getIsShow())switch(t){case e.Code.EQUIP_DRESS_S:this.initParams(),this.refresh()}},i.prototype.upgradeHandler=function(t){if(!(this.godlyEquipVO.nextId<=0)){if(this.model.equipGId1<=0||this.model.equipGId2<=0)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CAILIAOBUZU"));if(e.PlayerService.instance.playerInfo.getGold()<this.godlyEquipVO.costAttVO.value)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var i=HawkProtocolManager.newBuilder("JsProto.HPEquipGodEvolutionReq");i.setRoleId(this.model.roleData.roleId),i.setEquipId(this.model.equipInfo.getId()),i.setMaterials([this.model.equipGId1,this.model.equipGId2]),e.Message.instance.send(e.Code.EQUIP_GOD_EVOLUTION_C,i,!0),this.close()}},i.prototype.addHandler=function(t){t.currentTarget==this.ui.icon1?this.model.waitIndex=1:t.currentTarget==this.ui.icon2&&(this.model.waitIndex=2),e.GodlyEquipController.getInstance().showChoosePanel()},Object.defineProperty(i.prototype,"tempEquip",{get:function(){return e.JsonDataManager.instance.equipTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tempGodlyEquip",{get:function(){return e.JsonDataManager.instance.godlyEquipTemplate},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.GodlyEquipUpgradePanel=t,__reflect(t.prototype,"foxgame.GodlyEquipUpgradePanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/goldtreasure/GoldTreasureAddTipSkin.exml",null,!1)||this;return e.cancelType=0,e.confirmType=1,e.isMask=!0,e.layer=LayerType.TOPLAYER,e.isCallHideSceneObjectsWhenClose=!1,e.setIsShowBackBtn(!1),e}return __extends(i,t),i.prototype.showPanel=function(e,t,i,n,o,a,s,r,l,h){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===l&&(l=20),void 0===h&&(h=!0),this.content=e,this.target=t,this.confirmBack=i,this.confirmParam=n,this.cancelBack=o,this.cancelParam=a,this.confirmName=s,this.cancelName=r,this.textSizeNum=l,this.isShowCancel=h,this.show()},i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandler,this),this.ui.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelHandler,this),this.ui.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickcheckBox,this),this.htmlParser=new egret.HtmlTextParser,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.baseConfirmX=this.ui.confirmGroup.x},i.prototype.clickcheckBox=function(e){this.ui.checkBoxBtn.currentState="up"==this.ui.checkBoxBtn.currentState?"down":"up"},i.prototype.initParams=function(){this.ui.scroller.viewport.scrollV=0,this.operation=this.cancelType},i.prototype.refresh=function(){null==this.confirmName&&(this.confirmName=e.LanguageUtils.instance.getValue("QUEDING")),this.confirmName&&(this.ui.confirmBtn.label=this.confirmName),null==this.cancelName&&(this.cancelName=e.LanguageUtils.instance.getValue("QUXIAO")),this.cancelName&&(this.ui.cancelBtn.label=this.cancelName),this.ui.contentLabel.textFlow=this.htmlParser.parser(this.content),this.ui.contentLabel.size=this.textSizeNum,this.ui.cancelGroup.visible=this.isShowCancel,0==this.isShowCancel?this.ui.confirmGroup.x=this.width-this.ui.confirmBtn.width>>1:this.ui.confirmGroup.x=this.baseConfirmX},i.prototype.confirmHandler=function(e){this.operation=this.confirmType,this.confirmParam="down"==this.ui.checkBoxBtn.currentState,this.close();var t=this.confirmParam;this.operation==this.confirmType&&null!=this.confirmBack&&this.confirmBack.call(this.target,t)},i.prototype.cancelHandler=function(e){this.operation=this.cancelType,this.ui.checkBoxBtn.currentState="up",this.close();var t=this.confirmParam;this.operation==this.confirmType?null!=this.confirmBack&&this.confirmBack.call(this.target,t):this.operation==this.cancelType&&null!=this.cancelBack&&this.cancelBack.call(this.target,t)},i}(e.BasePanel);e.GoldTreasureAddTip=t,__reflect(t.prototype,"foxgame.GoldTreasureAddTip")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.isInit=!1,e.isDataChanged=!1,e.skinName="GoldTreasureBagItem",e}return __extends(i,t),i.prototype.setData=function(e){this.lockLabel.visible=!1,this.data=e,this.icon.setItem(e.id,-1),this.icon.settxtlabel("")},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){if(!(this.data instanceof e.ItemVO)){var t=this.data,i=e.JsonDataManager.instance.itemTemplate[t.getItemId()];this.lockLabel.visible=!1,this.icon.setItem(i.id,t.getNum()),this.data=i}},i.prototype.clickHandler=function(t){var i=this.data;i.type==e.ItemType.EQUIP||(i.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(i.id):i.type==e.ItemType.DRAGONBONE?e.TipsController.getInstance().showDragonBoneTips(i.id):i.type==e.ItemType.DRAGONARMOR?e.TipsController.getInstance().showDragonArmorTips(i.id,!1):i.type==e.ItemType.SKILLSTONE?e.TipsController.getInstance().showDragonArmorSkillTips(i.id):e.TipsController.getInstance().showItemTips(i.id,-1,!1))},i.createNum=0,i.updateNum=0,i}(eui.ItemRenderer);e.GoldTreasureBagItem=t,__reflect(t.prototype,"foxgame.GoldTreasureBagItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.GoldTreasureModel,this.panel=new e.GoldTreasurePanel(this.model),this.rewardPanel=new e.GoldTreasureRewardSkin(this.model)}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showpanel=function(){var t=e.GlobalConfig.instance.getValue("TREASURE_OF_ANCIENT_GOD_OPEN_LEVEL");return e.PlayerService.instance.playerInfo.getLevel()<Number(t)?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BAOKUOPEN",t)):(this.sendGOLD_HOARD_INFO_C(),void this.panel.show())},t.prototype.closepanel=function(){this.panel.close()},t.prototype.showrewardpanel=function(e){this.rewardPanel.showPage(e)},t.prototype.registerMsg=function(t){t.add(e.Code.TREASURE_OF_ANCIENT_GOD_INFO_S,this),t.add(e.Code.OPEN_TREASURE_OF_ANCIENT_GOD_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.TREASURE_OF_ANCIENT_GOD_INFO_S:this.model.setCodeGOLD_HOARD_INFO_S(i);break;case e.Code.OPEN_TREASURE_OF_ANCIENT_GOD_S:this.model.setOPEN_Gold_HOARD_S(i)}},t.prototype.redpoint=function(t){return void 0===t&&(t=!1),e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("TREASURE_OF_ANCIENT_GOD_OPEN_LEVEL"))?!1:1==this.model.freeNnmber?!0:this.ondepointred()?!0:this.tenepointred()?!0:!1},t.prototype.ondepointred=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_1")),i=e.BagController.getInstance().getCountByItemId(t.id);return i>=1?!0:e.PlayerService.instance.playerInfo.getGold()>=Number(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3"))?!0:!1},t.prototype.tenepointred=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_2")),i=e.BagController.getInstance().getCountByItemId(t.id);return i>=10?!0:e.PlayerService.instance.playerInfo.getGold()>=Number(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4"))?!0:!1},t.prototype.sendGOLD_HOARD_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.TreasureOfAncientGodInfoReq");e.Message.instance.send(e.Code.TREASURE_OF_ANCIENT_GOD_INFO_C,t,!0)},t.prototype.sendOPEN_Gold_HOARD_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.OpenTreasureOfAncientGodReq");i.setOnce(t),e.Message.instance.send(e.Code.OPEN_TREASURE_OF_ANCIENT_GOD_C,i,!0)},t.prototype.requestGoldSearch=function(t){var i=parseInt(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3")),n=parseInt(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4")),o=e.SearchTreasureController.getInstance().getmodel().saleList[e.SearchTreasureModel.XUNBAO_SHENMI],a=o?i*o.getSaleNumber():i;o?n*o.getSaleNumber():n;t==a?this.sendOPEN_Gold_HOARD_C(!0):this.sendOPEN_Gold_HOARD_C(!1)},t.prototype.setRecords=function(e){},t}();e.GoldTreasureController=t,__reflect(t.prototype,"foxgame.GoldTreasureController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.tipbool=!1,this.observerList=[],this.dataSource=[],this.logsource=[],this.tipbool=!1}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateRecord=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&(e.goldInfoBack(),e.updateRecords())},t.prototype.setCodeGOLD_HOARD_INFO_S=function(e){this.freeNnmber=e.getFreeNum(),this.logsource=e.getLogs(),this.updateRecord()},t.prototype.setOPEN_Gold_HOARD_S=function(t){var i=0;return 0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.dataSource=[],this.dataSource=t.getItems(),this.freeNnmber=t.getFreeNum(),i=t.getOnce()?1:10,e.GoldTreasureController.getInstance().showrewardpanel(i),void this.updateRecord())},t}();e.GoldTreasureModel=t,__reflect(t.prototype,"foxgame.GoldTreasureModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/goldtreasure/GoldTreasureSkin.exml","goldtreasure")||this;return i.model=e,i.rotateBool=!1,i}return __extends(i,t),i.prototype.showHook=function(){42==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.add_one,this,42,3,!0),e.SearchTreasureController.getInstance().sendTreasureSale()},i.prototype.initHook=function(){this.model.registerObserver(this),e.SearchTreasureController.getInstance().getmodel().registerObserver(this),this.ui.contentLabel.addEventListener(egret.TextEvent.LINK,this.linkHandler,this),this.ui.help.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("HELPLOG")),this.ui.help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.add_one.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.add_ten.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.addprice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.dragongodtreasure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.doScreenAdaptation(),this.saleList=[]},i.prototype.goldInfoBack=function(){this.refresh()},i.prototype.sendmessage=function(t){var i=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_1")),n=parseInt(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3")),o=parseInt(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4")),a=e.BagController.getInstance().getCountByItemId(i.id);if(!t&&this.model.freeNnmber>0)return void(t?this.buyten():this.buyone());if(t)if(a>=10)this.buyten();else{if(this.count=this.time>0?o*this.discount:o,!this.model.tipbool)return void e.PopUpController.getInstance().showTextPanel2(e.LanguageUtils.instance.getValue("GUSHENMIBAOTISHI1",this.count),this,this.buySearch.bind(this),{tipbool:!1});this.buySearch()}else if(a>=1)this.buyone();else{if(this.count=this.time>0?n*this.discount:n,!this.model.tipbool)return void e.PopUpController.getInstance().showTextPanel2(e.LanguageUtils.instance.getValue("GUSHENMIBAOTISHI1",this.count),this,this.buySearch.bind(this),{tipbool:!0});this.buySearch()}},i.prototype.clickbtn=function(t){switch(t.currentTarget){case this.ui.help:e.HelpController.getInstance().showPanel("OLDGODMIBAOHELP");break;case this.ui.add_one:this.sendmessage(!1),42==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()));break;case this.ui.add_ten:this.sendmessage(!0);break;case this.ui.addprice:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)}},i.prototype.buySearch=function(t){void 0===t&&(t=null),t&&(this.model.tipbool=t);var i=e.PlayerService.instance.playerInfo.getGold();return i>=this.count?void this.startBuy():void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")},i.prototype.startBuy=function(){var t=this;if(!this.centerAni||null==this.centerAni){var i=this.ui.group_ani;this.centerAni=new e.FoxAni(i)}this.centerAni.play("fx_openBox","ani",1),this.rotateBool=!0,this.setRotateStatus(),egret.setTimeout(function(){t.centerAni.gotoAndStop(7),e.GoldTreasureController.getInstance().requestGoldSearch(t.count)},this,1e3)},i.prototype.buyone=function(){this.playopenAni(!0)},i.prototype.buyten=function(){this.playopenAni(!1)},i.prototype.playopenAni=function(t){var i=this;if(!this.centerAni||null==this.centerAni){var n=this.ui.group_ani;this.centerAni=new e.FoxAni(n)}this.centerAni.play("fx_openBox","ani",1),this.rotateBool=!0,this.setRotateStatus(),egret.setTimeout(function(){i.centerAni.gotoAndStop(7),t?e.GoldTreasureController.getInstance().sendOPEN_Gold_HOARD_C(!0):e.GoldTreasureController.getInstance().sendOPEN_Gold_HOARD_C(!1)},this,1e3)},i.prototype.closeHook=function(){App.TimerManager().remove(this.timeOut,this),this.effAni&&(this.effAni.clear(),this.effAni=null)},i.prototype.refresh=function(){this.ui.redpointxb.visible=e.ActivityBarController.getInstance().refreshSearchTreasureRedPoint(),this.ui.redpointbk.visible=e.DragongodTreasureController.getInstance().redpoint(),this.ui.redpointgt.visible=e.GoldTreasureController.getInstance().redpoint(),this.ui.redpointone.visible=this.model.freeNnmber>=1||e.GoldTreasureController.getInstance().ondepointred(),this.ui.redpointten.visible=e.GoldTreasureController.getInstance().tenepointred(),this.refreshActivity(),this.addCenterAni(),this.updateRecords(),this.setRotateStatus(),1!=this.discount?this.showDiscount():this.showOriginal()},i.prototype.showOriginal=function(){var t=Number(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3")),i=Number(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4"));this.ui.one_yuanbao.text=t+"",this.ui.ten_yuanbao.text=i+"",-1!=this.ui.group_one.getChildIndex(this.ui.group_original0)&&this.ui.group_one.removeChild(this.ui.group_original0),-1!=this.ui.group_ten.getChildIndex(this.ui.group_original1)&&this.ui.group_ten.removeChild(this.ui.group_original1),this.ui.group_one.x=this.ui.add_one.x-(this.ui.group_one.width-this.ui.add_one.width)/2,this.ui.group_ten.x=this.ui.add_ten.x-(this.ui.group_ten.width-this.ui.add_ten.width)/2,this.ui.zhekou0.visible=this.saleList[e.SearchTreasureModel.XUNBAO]?!0:!1,this.ui.zhekou1.visible=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?!0:!1,this.ui.zhekou2.visible=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?!0:!1,this.ui.tab_zhe0.text=this.saleList[e.SearchTreasureModel.XUNBAO]?10*this.saleList[e.SearchTreasureModel.XUNBAO].getSaleNumber()+"":"",this.ui.tab_zhe1.text=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?10*this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN].getSaleNumber()+"":"",this.ui.tab_zhe2.text=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?10*this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI].getSaleNumber()+"":"",this.ui.group_zhekou.visible=!1
},i.prototype.playAni=function(){this.effAni&&(this.effAni.clear(),this.effAni=null),this.effAni=new e.FoxAni(this.ui.eff_group),this.effAni.play("fx_zhekou","ani",-1)},i.prototype.showDiscount=function(){var t=Number(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3")),i=Number(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4"));this.ui.one_yuanbao.text=t*this.discount+"",this.ui.txt_discount0.text=t+"",this.ui.ten_yuanbao.text=i*this.discount+"",this.ui.txt_discount1.text=i+"",this.ui.group_one.x=this.ui.add_one.x-(this.ui.group_one.width-this.ui.add_one.width)/2,this.ui.group_ten.x=this.ui.add_ten.x-(this.ui.group_ten.width-this.ui.add_ten.width)/2,this.ui.zhekou0.visible=this.saleList[e.SearchTreasureModel.XUNBAO]?!0:!1,this.ui.zhekou1.visible=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?!0:!1,this.ui.zhekou2.visible=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?!0:!1,this.ui.tab_zhe0.text=this.saleList[e.SearchTreasureModel.XUNBAO]?10*this.saleList[e.SearchTreasureModel.XUNBAO].getSaleNumber()+"":"",this.ui.tab_zhe1.text=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?10*this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN].getSaleNumber()+"":"",this.ui.tab_zhe2.text=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?10*this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI].getSaleNumber()+"":"",this.ui.group_zhekou.visible=!0,this.playAni();var n=10*this.discount+"",o=n.split(".");this.ui.txt_zhekou.text=o.length>1?o[0]+".wz":" "+o[0]+"z",this.time>0&&(this.ui.txt_time.text="折扣剩余时间:"+e.GlobalUtil.secondsToTimeSimple(this.time),App.TimerManager().doTimer(1e3,0,this.timeOut,this))},i.prototype.timeOut=function(){this.time--,this.ui.txt_time.text="折扣剩余时间:"+e.GlobalUtil.secondsToTimeSimple(this.time),this.time<0&&(this.time=0,this.ui.txt_time.text="",this.showOriginal(),e.SearchTreasureController.getInstance().sendTreasureSale(),App.TimerManager().remove(this.timeOut,this))},i.prototype.updateSale=function(){this.saleList=e.SearchTreasureController.getInstance().getmodel().saleList;var t=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI];t?(this.time=Math.floor(t.getDateTimes()/1e3),this.discount=t.getSaleNumber()):(this.time=0,this.discount=1,this.ui.txt_time.text=""),this.refresh()},i.prototype.setRotateStatus=function(){var e=this;this.rotateBool?(this.ui.img_light.visible=!0,this.ui.img_light.scaleX=this.ui.img_light.scaleY=0,this.ui.img_light.alpha=0,egret.setTimeout(function(){egret.Tween.get(e.ui.img_light,{loop:!1}).to({scaleX:1.7,scaleY:1.7,alpha:.85},400),egret.Tween.get(e.ui.img_light,{loop:!0}).to({rotation:360},2e3,egret.Ease.sineIn)},this,300)):(egret.Tween.removeTweens(this.ui.img_light),this.ui.img_light.visible=!1,this.centerAni&&this.centerAni.gotoAndStop(1))},i.prototype.refreshActivity=function(){for(var t=e.GlobalConfig.instance.getValue("TREASURE_OF_ANCIENT_GOD_SHOW_ITEM"),i=t.split(","),n=(i.length,0);5>n;n++){var o=n+1,a=this.ui["award"+o],s=new e.AttributeVO(i[n]);s?(a&&(a.setItem(s.id,s.value,!0),a.visible=!0),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showTopDetail,this)):a&&(a.visible=!1)}},i.prototype.addCenterAni=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_1")),i=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_2")),n=e.BagController.getInstance().getCountByItemId(t.id);if(this.ui.label_payKey.textFlow=e.GlobalUtil.createMaterialProTextFlow(n,t.value),this.ui.label_payTenKey.textFlow=e.GlobalUtil.createMaterialProTextFlow(n,i.value),this.ui.label_keyNum.text=e.BagController.getInstance().getCountByItemId(t.id).toString(),this.ui.label_yuanNum.text=e.GlobalUtil.getUnitString(e.PlayerService.instance.playerInfo.getGold(),2),this.ui.one_tip.visible=this.model.freeNnmber>0?!0:!1,this.centerAni&&(this.centerAni.clear(),this.centerAni=null),!this.centerAni||null==this.centerAni){var o=this.ui.group_ani;this.centerAni=new e.FoxAni(o),this.centerAni.play("fx_openBox","ani",1),this.rotateBool=!1,this.setRotateStatus()}this.centerAni.gotoAndStop(1)},i.prototype.updateRecords=function(){var t=new egret.HtmlTextParser;this.ui.contentLabel.textFlow=t.parser("");for(var i,n,o,a,s=this.model.logsource.length,r="",l=0;s>l;l++)i=this.model.logsource[l],o=this.getItemTemplate()[i.getItemId()],n=e.ColorUtils.instance.getColorByQuality(o.quality),a=n.toString(16),r+=e.LanguageUtils.instance.getValue("GODMIBAORECORD",i.getPlayerId(),i.getName(),a,i.getItemId(),o.name,i.getItemNum())+"\n";r=this.cleanUpStr(r),this.ui.contentLabel.textFlow=(new egret.HtmlTextParser).parser(r),this.ui.contentLabel.height>this.ui.scroller.height?this.ui.scroller.viewport.scrollV=this.ui.contentLabel.height-this.ui.scroller.height:this.ui.scroller.viewport.scrollV=0},i.prototype.getItemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.cleanUpStr=function(t){var i=t.split("\n"),n=[],o=i.length,a="",s=Number(e.LanguageUtils.instance.getValue("SEARCHMSGMAXLENGTH"));if(!(o>s))return t;var r=o-s-1;n=i.splice(r,o);for(var l=0;l<n.length;l++)""!=n[l]&&(a+=n[l]+"\n");return a},i.prototype.linkHandler=function(t){var i=t.text.split("_"),n=i[0],o=Number(i[1]);if("playerId"==n){if(-1==o)return;e.OtherCharacterController.getInstance().showOtherCharacterPanel(o)}else{if("itemId"!=n)throw new Error("examine parameter Error");var a=this.getItemTemplate()[o];e.TipsController.getInstance().showItemTips(a.id)}},i.prototype.clickskip=function(t){switch(t.target){case this.ui.xunbao:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.SEARCHTREASURE),this.close();break;case this.ui.dragongodtreasure:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE),this.close();break;case this.ui.goldtreasure:}},i.prototype.showTopDetail=function(t){for(var i=t.target.name,n=parseInt(i.substr(i.length-1,1))-1,o=e.GlobalConfig.instance.getValue("TREASURE_OF_ANCIENT_GOD_SHOW_ITEM"),a=o.split(","),s=a.length,r=0;s>r;r++){var l=new e.AttributeVO(a[r]);if(r==n)return void e.TipsController.getInstance().showItemTips(l.id,l.value,!1)}},i}(e.BasePanel);e.GoldTreasurePanel=t,__reflect(t.prototype,"foxgame.GoldTreasurePanel",["foxgame.IGold","foxgame.IObserver","foxgame.ISearchTreasure"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/goldtreasure/GoldTreasureRewardSkin.exml")||this;return i.aniArr=[],i.tenDoneNum=0,i.model=e,i.isMask=!0,i.pointobject={},i}return __extends(i,t),i.prototype.showPage=function(e){this.lastCountType=e,this.getIsShow()?this.refresh():this.show()},i.prototype.initHook=function(){for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],this.pointobject[o]={x:t.x,y:t.y},t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);if(t=i[1],this.timer=new egret.Timer(60,10),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.ui.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this),App.GuideUtils().currPart==e.GuidePart.currPart17&&1==App.GuideUtils().currStep){var a=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(a,a.parent,e.GuidePart.currPart17,2,!1)}},i.prototype.readyDestroy=function(){},i.prototype.backHandler=function(){if(this.tw&&(this.tw.pause(),this.tw=null),this.twArr&&this.twArr.length>0){var e=0,t=this.twArr.length;for(e;t>e;e++){var i=this.twArr[e];i.pause(),i=null}}TweenMax.killTweensOf(this),this.close()},i.prototype.closeHook=function(){this.timer.reset(),this.timer.stop()},i.prototype.goldInfoBack=function(){this.refresh()},i.prototype.tickHook=function(e){},i.prototype.refresh=function(){TweenMax.killTweensOf(this),TweenMax.delayedCall(.3,this.delayShow.bind(this));var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_1"));1==this.lastCountType?(this.cost1=1,this.cost2=Number(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3"))):10==this.lastCountType&&(this.cost1=10,this.cost2=Number(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4")));var i=e.SearchTreasureController.getInstance().getmodel().saleList[e.SearchTreasureModel.XUNBAO_SHENMI],n=i?this.cost2*i.getSaleNumber():this.cost2;this.ui.priceLabel0.text=e.BagController.getInstance().getCountByItemId(t.id)+"/"+this.cost1,this.ui.priceLabel1.text=n+""},i.prototype.delayShow=function(){this.twArr=[];var e,t=this.getItemList(),i=t.length,n=this.model.dataSource,o=0;this.tenDoneNum=0;for(var a=0;i>a;a++)if(e=t[a],TweenMax.killTweensOf(e),e.visible=!1,n[a]){e.data=n[a],o=.1*(a+1);var s=TweenMax.delayedCall(o,this.funBack.bind(this),[e,a]);this.twArr.push(s)}},i.prototype.funBack=function(e,t){var i,n,o=0;0!=this.aniArr.length&&this.aniArr[t]&&(i=this.aniArr[t]),this.getAniGroupList()[t]&&(n=this.getAniGroupList()[t]),this.effectLingQu(!0,i,n),o=.03*(t+1),TweenMax.delayedCall(o,this.funBack1.bind(this),[e,t])},i.prototype.funBack1=function(e,t){var i=0;i=this.lastCountType?10:1,this.tenDoneNum<i&&this.tenDoneNum++,e.visible=!0},i.prototype.timerFunc1=function(e){var t=this.getItemList()[e],i=this.pointobject[e];TweenMax.killTweensOf(t),TweenMax.to(t,.3,{x:i.x,y:i.y})},i.prototype.timerFunc=function(e){var t=e.target.currentCount,i=this.getItemList()[t-1],n=this.pointobject[t-1];TweenMax.killTweensOf(i),TweenMax.to(i,.1,{x:n.x,y:n.y})},i.prototype.timerComFunc=function(e){this.timer.reset()},i.prototype.itemHandler=function(t){var i=this.getItemList(),n=i.indexOf(t.target),o=this.model.dataSource,a=o[n],s=e.JsonDataManager.instance.itemTemplate[a.getItemId()];s.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:s.id}):s.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(s.id):e.TipsController.getInstance().showItemTips(s.id)},i.prototype.effectLingQu=function(t,i,n){i&&(i.clear(),i=null),t&&(i||(i=new e.FoxAni(n),i.play("shilianchou_fx","ani",1),this.aniArr.push(i)))},i.prototype.getAniGroupList=function(){var e=[],t=0,i=10;for(t;i>t;t++)e.push(this.ui["aniGroup"+t]);return e},i.prototype.getItemList=function(){for(var e=[],t=0;10>t;t++)e.push(this.ui["item"+t]);return e},i.prototype.btnClickHandler=function(t){var i=new e.AttributeVO(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_1"));if(e.BagController.getInstance().getCountByItemId(i.id)<this.cost1){var n=e.PlayerService.instance.playerInfo.getGold()<this.cost2?!0:!1;if(n)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}if(1==this.lastCountType){var o=parseInt(e.GlobalConfig.instance.getValue("OPEN_A_TREASURE_OF_ANCIENT_GOD_COST_3"));e.GoldTreasureController.getInstance().requestGoldSearch(o)}else{var a=parseInt(e.GlobalConfig.instance.getValue("OPEN_TEN_TREASURE_OF_ANCIENT_GOD_COST_4"));e.GoldTreasureController.getInstance().requestGoldSearch(a)}this.tenDoneNum=0},i}(e.BasePanel);e.GoldTreasureRewardSkin=t,__reflect(t.prototype,"foxgame.GoldTreasureRewardSkin")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.GongMingModel,this.panel=new e.GongMingPanel(this.model)}return t.prototype.showPanel=function(e){this.model.roleData=e,this.panel.show()},t.prototype.getRoleData=function(){return this.model.roleData},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();e.GongMingController=t,__reflect(t.prototype,"foxgame.GongMingController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="GongMingLightItem",e}return __extends(i,t),i.prototype.lighten=function(){this.ani&&(this.ani.clear(),this.ani=null),this.ani||(this.ani=new e.FoxAni(this.aniGroup)),this.aniGroup.visible=!0,this.ani.play("gongmingdonghua","ani",-1)},i.prototype.offLight=function(){this.aniGroup.visible=!1},i.prototype.destoryAni=function(){this.ani&&(this.ani.clear(),this.ani=null)},i}(eui.Component);e.GongMingLightItem=t,__reflect(t.prototype,"foxgame.GongMingLightItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.lightAry=[]}return t.prototype.getEquipIdList=function(){for(var t,i,n=[],o=this.roleData.getRoleEquips(),a=o.length,s=0;a>s;s++)t=o[s],i=this.getEquipTemplate()[t.getEquipItemId()],i.quality==e.EquipQuality.RED&&n.push(i);return n},t.prototype.getEquipTemplate=function(){return e.JsonDataManager.instance.equipTemplate},t}();e.GongMingModel=t,__reflect(t.prototype,"foxgame.GongMingModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/character/GongMingPanel.exml")||this;return i.model=e,i.isMask=!1,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.doScreenAdaptation()},i.prototype.refresh=function(){this.ui.currency.refresh();for(var t,i=this.model.roleData,n=this.model.getEquipIdList(),o=n.length,a=0,s=0;o>s;s++)t=n[s],a+=t.level;this.ui.levelLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GODLYEQUIPTOTALLEVEL",a));for(var r=this.getGongMingLevelTemplate()[a+"_"+i.profession],l=e.GlobalUtil.getFormatAttText(r.attrTypeList,r.attrValueList),s=0;s<this.getLevelAttrLabels().length;s++)this.getLevelAttrLabels()[s].textFlow=[l[2*s],l[2*s+1]];var h,c,u=Number(e.GlobalConfig.instance.getValue("SHENZHUANGLINKMINCOUNT"));n.length<u?(h=this.getGongMingLinkTemplate()["0_"+i.profession],c=this.getGongMingLinkTemplate()[u+"_"+i.profession]):(h=this.getGongMingLinkTemplate()[n.length+"_"+i.profession],c=this.getGongMingLinkTemplate()[h.count+1+"_"+i.profession],null==c&&(c=h)),this.offAllLight();for(var s=0;s<n.length;s++)this.getLightItems()[s].lighten();this.ui.curCountLabel.text=n.length+"",this.ui.nextCountLabel.text=c.count+"",l=e.GlobalUtil.getFormatAttText(h.attrTypeList,h.attrValueList),this.ui.curCountAttrLabel.lineSpacing=8,this.ui.curCountAttrLabel.textFlow=l,l=e.GlobalUtil.getFormatAttText(c.attrTypeList,c.attrValueList),this.ui.nextCountAttrLabel.lineSpacing=8,this.ui.nextCountAttrLabel.textFlow=l},i.prototype.offAllLight=function(){for(var e=this.getLightItems().length,t=0;e>t;t++)this.getLightItems()[t].offLight()},i.prototype.destroyAnis=function(){for(var e=this.getLightItems().length,t=0;e>t;t++){var i=this.getLightItems()[t];i&&i.destoryAni()}},i.prototype.readyDestroy=function(){this.destroyAnis()},i.prototype.closeHook=function(){},i.prototype.getEquipTemplate=function(){return e.JsonDataManager.instance.equipTemplate},i.prototype.getGongMingLevelTemplate=function(){return e.JsonDataManager.instance.equipGongMingLevelTemplate},i.prototype.getGongMingLinkTemplate=function(){return e.JsonDataManager.instance.equipGongMingLinkTemplate},i.prototype.getLevelAttrLabels=function(){var e=[];return e.push(this.ui.levelAttrLabel0),e.push(this.ui.levelAttrLabel1),e.push(this.ui.levelAttrLabel2),e.push(this.ui.levelAttrLabel3),e},i.prototype.getLightItems=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e.push(this.ui.item4),e.push(this.ui.item5),e.push(this.ui.item6),e.push(this.ui.item7),e.push(this.ui.item8),e.push(this.ui.item9),e},i}(e.BasePanel);e.GongMingPanel=t,__reflect(t.prototype,"foxgame.GongMingPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){if(this.id=Number(e.id),this.itemId=Number(e.itemid),this.group=Number(e.group),this.name=e.name,this.equipId=Number(e.equipId),this.weaponId=Number(e.weaponId),this.wing=e.wing||"",this.titleId=Number(e.weapotitleIdnId),this.hp=Number(e.HP),this.npcRefresh=[],e.npcRefresh)for(var t=e.npcRefresh.split(","),i=0;i<t.length;i++)this.npcRefresh.push(Number(t[i]))}return e}();e.GuideMissionMainCityRobotVO=t,__reflect(t.prototype,"foxgame.GuideMissionMainCityRobotVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){if(this.id=Number(e.id),this.itemId=Number(e.itemid),this.map=Number(e.map),this.name=e.name,this.equipIds=[],e.equipIds)for(var t=e.equipIds.split(","),i=0;i<t.length;i++)this.equipIds.push(Number(t[i]));if(this.wing=e.wing||"",this.titleId=Number(e.titleId),this.skill=Number(e.skill),this.npcRefresh=[],e.npcRefresh)for(var n=e.npcRefresh.split(","),i=0;i<n.length;i++)this.npcRefresh.push(Number(n[i]));if(this.MonsterId=Number(e.MonsterId),this.npcMonsterRefresh=[],e.npcMonsterRefresh)for(var o=e.npcMonsterRefresh.split(","),i=0;i<o.length;i++)this.npcMonsterRefresh.push(Number(o[i]));if(this.group=Number(e.group),e.fashion){var a=e.fashion.split(",");a.length>0&&(this.fashionCloth=Number(a[0]),this.fashionWeapon=Number(a[1]))}if(e.effect){var s=e.effect.split(",");s.length>0&&(this.wardLevel=Number(s[0]),this.armorLevel=Number(s[1]))}}return e}();e.GuideMissionRobotVO=t,__reflect(t.prototype,"foxgame.GuideMissionRobotVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(t){if(this.MonsterHp=1,this.id=Number(t.id),this.QuestId=Number(t.QuestId),this.type=Number(t.type),this.Waypoint=[],t.Waypoint)for(var i=t.Waypoint.split(","),n=0;n<i.length;n++)this.Waypoint.push(Number(i[n]));if(this.text=t.text,this.name=t.name,this.image=t.image,this.QuestMonsterID=[],t.QuestMonsterID)for(var o=t.QuestMonsterID.split(","),n=0;n<o.length;n++)this.QuestMonsterID.push(Number(o[n]));if(this.QuestMonsterRefresh=[],t.QuestMonsterRefresh)for(var a=t.QuestMonsterRefresh.split(","),n=0;n<a.length;n++)this.QuestMonsterRefresh.push([Number(a[n]),Number(a[++n])]);if(this.MonsterWaypoint=[],t.MonsterWaypoint)for(var s=t.MonsterWaypoint.split(","),n=0;n<s.length;n++)this.MonsterWaypoint.push([Number(s[n]),Number(s[++n])]);if(this.AIMonsterRefresh=[],t.AIMonsterRefresh)for(var r=t.AIMonsterRefresh.split(","),n=0;n<r.length;n++)this.AIMonsterRefresh.push([Number(r[n]),Number(r[++n])]);if(this.EquipmentId={},t.EquipmentId)for(var l=t.EquipmentId.split(","),n=0;n<l.length;n++){var h=Number(l[n]),c=Math.floor(h%1e5/1e4);this.EquipmentId[c]=h}if(this.awardOther=[],this.awardEquip={},t.award)for(var u=t.award.split(","),n=0;n<u.length;n++){var p=new e.AttributeVO(u[n]);if(4e4==p.type){var c=Math.floor(p.id%1e5/1e4);this.awardEquip[c]=p}else this.awardOther.push(p)}if(this.AttackPonit=[],t.AttackPonit)for(var g=t.AttackPonit.split(","),n=0;n<g.length;n++)this.AttackPonit.push(Number(g[n]));if(this.SkillId={},t.SkillId)for(var d=t.SkillId.split(","),n=0;n<d.length;n++){for(var f=[],m=d[n].split("_"),y=0;y<m.length;y++)f.push(Number(m[y]));this.SkillId[n+1]=f}if(this.MonsterHp=Number(t.MonsterHp),this.Tips=t.Tips,this.voice=t.voice,this.target=t.target,this.offset=Number(t.offset||0),this.dropItems=[],t.dropItems)for(var I=t.dropItems.split(","),n=0;n<I.length;n++){var p=new e.AttributeVO(I[n]);this.dropItems.push(p)}}return t}();e.GuideMissionVO=t,__reflect(t.prototype,"foxgame.GuideMissionVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.HelpModel,this.panel=new e.HelpPanel(this.model)}return t.prototype.showPanel=function(e){this.model.content=this.getHelpTemplate()[e],this.panel.show()},t.prototype.closePanel=function(){this.panel.close()},t.prototype.getHelpTemplate=function(){return e.JsonDataManager.instance.helpTemplate},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();e.HelpController=t,__reflect(t.prototype,"foxgame.HelpController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.htmlParser=new egret.HtmlTextParser}return e}();e.HelpModel=t,__reflect(t.prototype,"foxgame.HelpModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this,"resource/skins/common/HelpPanel.exml")||this;return i.isMask=!0,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i.model=t,i}return __extends(t,e),t.prototype.showHook=function(){this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.ui.scroller.viewport.scrollV=0},t.prototype.refresh=function(){this.ui.contentLabel.textFlow=this.model.htmlParser.parser(this.model.content)},t}(e.BasePanel);e.HelpPanel=t,__reflect(t.prototype,"foxgame.HelpPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panel=new e.ItemNotEnoughPanel}return t.prototype.showPanel=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.panel.showPanel(e,t,i)},t.prototype.skipHandler=function(e){this.panel.btnClickHandler(null,e)},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();e.ItemNotEnoughController=t,__reflect(t.prototype,"foxgame.ItemNotEnoughController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.JINGJICHANG=1]="JINGJICHANG",e[e.VIPLIBAO=2]="VIPLIBAO",e[e.GUANQIABOSS=3]="GUANQIABOSS",e[e.YOUMINGTA=4]="YOUMINGTA",e[e.RONGLIANCHENGZHUANG=5]="RONGLIANCHENGZHUANG",e[e.GONGHUIZHAN=6]="GONGHUIZHAN",e[e.XUNBAO=7]="XUNBAO",e[e.YISHOURUQIN=8]="YISHOURUQIN",e[e.JINGYINGBOSS=9]="JINGYINGBOSS",e[e.TEJIEFUBEN=10]="TEJIEFUBEN",e[e.HUNYI=11]="HUNYI",e[e.YAJIEQIUTU=12]="YAJIEQIUTU",e[e.YEWAIPK=13]="YEWAIPK",e[e.MEIRIJUEWEIJIANGLI=14]="MEIRIJUEWEIJIANGLI",e[e.KUAFUJINGJI=15]="KUAFUJINGJI",e[e.KUAFUGONGHUIZHAN=16]="KUAFUGONGHUIZHAN",e[e.FENJIESHENQI=17]="FENJIESHENQI",e[e.FENJIEHONGZHUANG=18]="FENJIEHONGZHUANG",e[e.KUAFUJINGYINGBOSS=19]="KUAFUJINGYINGBOSS",e[e.FENJIEBAYEZHUANGBEI=20]="FENJIEBAYEZHUANGBEI",e[e.BAOSHIFUBEN=21]="BAOSHIFUBEN",e[e.BAOSHISHANGCHENG=22]="BAOSHISHANGCHENG",e[e.YUMAOFUBEN=23]="YUMAOFUBEN",e[e.VIPMEIRILIBAO=24]="VIPMEIRILIBAO",e[e.GONGHUIBOSS=25]="GONGHUIBOSS",e[e.KUAFUYEWAIBOSS=26]="KUAFUYEWAIBOSS",e[e.DAOJUSHANGCHENG=27]="DAOJUSHANGCHENG",e[e.JINBIDUIHUAN=28]="JINBIDUIHUAN",e[e.RONGLIANZHUANGBEI=29]="RONGLIANZHUANGBEI",e[e.CHUANQIBAYE=30]="CHUANQIBAYE",e[e.KAIFUHUODONG=31]="KAIFUHUODONG",e[e.YUNYINGHUODONG=34]="YUNYINGHUODONG",e[e.HEFUHUODONG=36]="HEFUHUODONG",e[e.PAIHANGJIANGLI=32]="PAIHANGJIANGLI",e[e.DIANFENGLIANSAI=37]="DIANFENGLIANSAI",e[e.LONGGU=38]="LONGGU",e[e.LONGSHENBAOKU=39]="LONGSHENBAOKU",e[e.LONGJIA=40]="LONGJIA",e[e.LONGJIAFENJIE=41]="LONGJIAFENJIE",e[e.SHIERXINGGONG=42]="SHIERXINGGONG",e[e.YAOJICHONGXING=43]="YAOJICHONGXING",e[e.KFGONGCHENG=44]="KFGONGCHENG",e[e.SCZHENGBA=45]="SCZHENGBA",e[e.GUSHENMIBAO=46]="GUSHENMIBAO",e[e.GUSHENYIJI=47]="GUSHENYIJI"}(t=e.ItemGetWayType||(e.ItemGetWayType={}));var i=function(i){function n(){var e=i.call(this,"resource/skins/common/ItemNotEnough.exml")||this;return e.callback=null,e.callthis=null,e.isMask=!0,e.setIsTouchClose(!0),e}return __extends(n,i),n.prototype.initHook=function(){this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this);for(var e,t=this.getBtnList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)},n.prototype.showPanel=function(t,i,n){this.callback=i,this.callthis=n;var o=e.JsonDataManager.instance.itemTemplate;this.itemVO=o[t],null!=this.itemVO&&this.show()},n.prototype.refresh=function(){this.ui.icon.setItem(this.itemVO.id);var t;t=1002==this.itemVO.id?e.PlayerService.instance.playerInfo.getCoin():e.BagController.getInstance().getCountByItemId(this.itemVO.id),this.ui.numLabel.text=e.LanguageUtils.instance.getValue("DANGQIANYONGYOU",t);for(var i,n,o=this.getGroupList(),a=(this.getBtnList(),this.getLabelList()),s=o.length,r=0;s>r;r++)i=o[r],r<this.itemVO.getWayList.length?(n=a[r],n.text=e.LanguageUtils.instance.getValue("ITEMGETWAY"+this.itemVO.getWayList[r]),n.textFlow=n.textFlow,i.visible=!0):i.visible=!1},n.prototype.btnClickHandler=function(i,n){void 0===n&&(n=null);var o;if(n)o=n;else{var a=this.getBtnList(),s=a.indexOf(i.currentTarget);o=this.itemVO.getWayList[s]}switch(o){case t.JINGJICHANG:this.checkModuleOpen(e.ModuleOpenId.JINGJICHANG)&&e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.NEW_AREA_UI});break;case t.VIPLIBAO:case t.VIPMEIRILIBAO:e.CreateNewVipController.instance.showPanel();break;case t.GUANQIABOSS:break;case t.YOUMINGTA:this.checkModuleOpen(e.ModuleOpenId.YOUMINGTA)&&e.ClimbingController.getInstance().show();break;case t.RONGLIANCHENGZHUANG:case t.RONGLIANZHUANGBEI:e.EquipSmeltController.getInstance().showPanel();break;case t.XUNBAO:e.SearchTreasureController.getInstance().showPanel();break;case t.JINGYINGBOSS:this.checkModuleOpen(e.ModuleOpenId.HUNLUANSHENYUAN)&&e.NewBossMainControler.getIntance().showPanel();break;case t.TEJIEFUBEN:this.checkModuleOpen(e.ModuleOpenId.TEJIEFUEBN)&&e.FuBenController.getInstance().showPanel(e.FuBenType.SpecialRingType);break;case t.HUNYI:this.checkModuleOpen(e.ModuleOpenId.HUNYI)&&e.SoulController.getInstance().showSoulPanel();break;case t.YEWAIPK:this.checkModuleOpen(e.ModuleOpenId.YEWAIPK)&&e.FieldPKController.getInstance().showPKPanel();break;case t.MEIRIJUEWEIJIANGLI:this.checkModuleOpen(e.ModuleOpenId.JUEWEI)&&e.NewJueweiController.getInstance().showPanel();break;case t.FENJIESHENQI:case t.FENJIEHONGZHUANG:case t.FENJIEBAYEZHUANGBEI:case t.LONGJIAFENJIE:e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.RESOLVE);break;case t.BAOSHIFUBEN:this.checkModuleOpen(e.ModuleOpenId.BAOSHIFUBEN)&&(e.FuBenController.getInstance().showPanel(e.FuBenType.GemType),this.close(),e.CharacterController.getInstance().closePanel());break;case t.YUMAOFUBEN:this.checkModuleOpen(e.ModuleOpenId.YUMAOFUBEN)&&e.FuBenController.getInstance().showPanel(e.FuBenType.FeatherType);break;case t.BAOSHISHANGCHENG:e.ShopMainControler.getInstance().showPanel();break;case t.GONGHUIBOSS:e.UnionController.getInstance().getHasUnion()?e.UnionController.getInstance().showBossPanel():e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31"));break;case t.JINBIDUIHUAN:e.ShopMainControler.getInstance().showBuyItemPanel(120012);break;case t.DAOJUSHANGCHENG:e.ShopMainControler.getInstance().showPanel();break;case t.PAIHANGJIANGLI:this.checkModuleOpen(e.ModuleOpenId.PAIHANGBANG)&&e.RankController.getInstance().showRankPanel();break;case t.KAIFUHUODONG:case t.HEFUHUODONG:case t.YUNYINGHUODONG:e.ActivityController.getIntance().showPanel();break;case t.CHUANQIBAYE:e.LegendController.getInstance().showMainPanel();break;case t.YAJIEQIUTU:var r=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YAJIEQIUTU,!1);if(0==r){var l=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YAJIEQIUTU));e.PopUpController.getInstance().showFloatTextPanel1(l)}else e.PrisonerController.getInstance().showPanel();break;case t.YISHOURUQIN:e.WorldBossController.getInstance().showBossPanel();break;case t.LONGGU:e.DragonboneController.getInstance().showpanel();break;case t.DIANFENGLIANSAI:var h=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.KUAFULIANSAI,!0);h&&e.KFController.getInstance().showPanel();break;case t.LONGSHENBAOKU:e.DragongodTreasureController.getInstance().showpanel();break;case t.LONGJIA:e.DragonArmorController.getInstance().showArmorPanel();break;case t.SHIERXINGGONG:e.TwelvePalaceController.getInstance().showPanel(1);break;case t.YAOJICHONGXING:e.BeautyController.getInstance().showpanel(2);break;case t.KFGONGCHENG:var c=e.UnionController.getInstance().getUnionId();if(0==c)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31"));e.UnionSiegeController.getInstance().showCrossServerPanel(1);break;case t.SCZHENGBA:var u=e.UnionController.getInstance().getUnionId();if(0==u)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31"));e.UnionSiegeController.getInstance().showPanel();break;case t.GUSHENMIBAO:e.GoldTreasureController.getInstance().showpanel();break;case t.GUSHENYIJI:e.UnionController.getInstance().showyijipanel();break;default:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZANWEIKAIQI"))}this.callback&&this.callback.call(this.callthis),this.close()},n.prototype.checkModuleOpen=function(t){var i=e.PlayerService.instance.level,n=e.GlobalUtil.getModuleOpenLevel(t);return void 0==n?!0:n>i?(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYOPENLEVEL",n)),!1):!0},n.prototype.closeHook=function(){},n.prototype.closeHandler=function(e){this.close()},n.prototype.getGroupList=function(){var e=[];return e.push(this.ui.group0),e.push(this.ui.group1),e.push(this.ui.group2),e.push(this.ui.group3),e.push(this.ui.group4),e.push(this.ui.group5),e},n.prototype.getLabelList=function(){var e=[];return e.push(this.ui.label0),e.push(this.ui.label1),e.push(this.ui.label2),e.push(this.ui.label3),e.push(this.ui.label4),e.push(this.ui.label5),e},n.prototype.getBtnList=function(){var e=[];return e.push(this.ui.btn0),e.push(this.ui.btn1),e.push(this.ui.btn2),e.push(this.ui.btn3),e.push(this.ui.btn4),e.push(this.ui.btn5),e},n}(e.BasePanel);e.ItemNotEnoughPanel=i,__reflect(i.prototype,"foxgame.ItemNotEnoughPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.JadeRuyiMode,this.panel=new e.JadeRuyiPanel,this.jadeRuyiArray=new Array}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.recvMsg=function(e,t){},t.prototype.showPanel=function(e,t,i){void 0===t&&(t=1),void 0===i&&(i=!1),this.jadeRuyiCount=t,this.panel.showPanel(e,t,i)},t.prototype.showRuyiList=function(t){e.JadeRuyiListController.getInstance().showList(t)},t.prototype.getJadeRuyiCount=function(){return 1},t.prototype.setJadeRuyiArray=function(e){this.jadeRuyiArray.push(e)},t.prototype.getJadeRuyiArray=function(){return this.jadeRuyiArray},t}();e.JadeRuyiController=t,__reflect(t.prototype,"foxgame.JadeRuyiController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.JadeRuyiMode=t,__reflect(t.prototype,"foxgame.JadeRuyiMode")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/jadeRuyi/JadeRuyiItemSkin.exml")||this;return e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.initHook=function(){this.ui.useBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.useBtn,this),this.ui.cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},i.prototype.showPanel=function(t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var o=e.JsonDataManager.instance.itemTemplate;this.itemVO=o[t],this.itemCount=i,this.isShowBtn=n,this.show()},i.prototype.refresh=function(){var t=this.ui.nameLabel;t.text=this.itemVO.name,t.textColor=e.ColorUtils.instance.getColorByQuality(this.itemVO.quality),this.ui.lvLabel.text=this.itemVO.levelLimit.toString(),this.ui.icon.setItem(this.itemVO.id,this.itemCount,!1);var i=e.JsonDataManager.instance.soulTemplate[this.itemVO.id];i&&i.smeltAttrVO.type==e.AttributeType.SOUL?this.ui.desc.text=e.LanguageUtils.instance.getValue("SOULREFINEEXP",i.smeltAttrVO.value):this.ui.desc.text=this.itemVO.desc;var n=this.ui.partLabel;this.itemVO.type==e.ItemType.TREASUREBOX1||this.itemVO.type==e.ItemType.TREASUREBOX2||this.itemVO.type==e.ItemType.TREASUREBOX3?n.text=e.LanguageUtils.instance.getValue("BAOXIANG"):n.text=e.LanguageUtils.instance.getValue("XIAOHAOPIN");var o=this.ui.btnGroup;this.itemVO.type==e.ItemType.TREASUREBOX1||this.itemVO.type==e.ItemType.TREASUREBOX2||this.itemVO.type==e.ItemType.TREASUREBOX3||this.itemVO.type==e.ItemType.CURRENCY||this.itemVO.type==e.ItemType.JINGYANDAN||this.itemVO.type==e.ItemType.JADERUYI?o.visible=this.isShowBtn:o.visible=!1},i.prototype.useBtn=function(){e.JadeRuyiController.getInstance().showRuyiList(this.itemVO),this.close()},i}(e.BasePanel);e.JadeRuyiPanel=t,__reflect(t.prototype,"foxgame.JadeRuyiPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.checBoxFlag=!1,e.selectBol=!1,e.selectActivate=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skinName="JadeItemSkin",this.jadeData=new e.JadeRuyiItemData,e.JadeRuyiListController.getInstance().itemList.push(this)
},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh(),this.imageMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipDetail,this),this.selectBgMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap1,this)},i.prototype.refresh=function(){this.select.visible=!1;new e.JadeRuyiItemData;this.jadeData.itemVO=this.data,this.nameLabel.text=this.jadeData.itemVO.name,this.nameLabel.textColor=16711680,this.icon.setItem(this.data.id,1,!1);for(var t=e.JadeRuyiListController.getInstance().getIdAndCount(),i=0;i<t.length;i++){var n=t[i].split(",");if(this.data.id==n[0]){this.equipAmount.text=n[1];break}}},i.prototype.setGray=function(t){this.icon.filters=t?[]:e.GlobalUtil.grayFilter,this.select.visible=t},i.prototype.onClickTap1=function(){return 1==this.selectBol?void e.JadeRuyiListController.getInstance().initItem():void e.JadeRuyiListController.getInstance().selectItem(this)},i.prototype.onEquipDetail=function(t){e.JadeRuyiListController.getInstance().showItemTips(this.data.id,1,!0)},i}(eui.ItemRenderer);e.JadeItem=t,__reflect(t.prototype,"foxgame.JadeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/jadeRuyi/JadeItemDetail.exml")||this;return e.collection=new eui.ArrayCollection,e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var o=e.JsonDataManager.instance.itemTemplate;this.itemVO=o[t],this.itemVO.type==e.ItemType.JADERUYI?this.show():e.JadeRuyiListController.getInstance().difTypeTips(this.itemVO)},i.prototype.initHook=function(){var t=this.ui.equipNameList;t.dataProvider=this.collection,t.itemRenderer=e.RuyiTipsItem;var i=new eui.TileLayout;i.requestedColumnCount=2,i.paddingLeft=e.ItemIcon.horizontalOver,i.paddingRight=e.ItemIcon.horizontalOver,t.layout=i,i.horizontalGap=10;var n=this.ui.equipList;n.dataProvider=this.collection,n.itemRenderer=e.RuyiEquipDisPlayTipsItem;var o=new eui.TileLayout;o.requestedRowCount=1,o.paddingLeft=e.ItemIcon.horizontalOver,n.layout=o,o.horizontalGap=8},i.prototype.refresh=function(){this.ui.icon.setItem(this.itemVO.id,1,!1),this.ui.equpitName.text=this.itemVO.name;var t=e.JadeRuyiListController.getInstance().getRuyiContentDetailTips(this.itemVO.containItem);this.collection.replaceAll(t)},i}(e.BasePanel);e.JadeItemDetailTips=t,__reflect(t.prototype,"foxgame.JadeItemDetailTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.JadeRuyiItemData=t,__reflect(t.prototype,"foxgame.JadeRuyiItemData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.ruyiIsSelected=!1,this.selectedIndex=-1,this.index=0,this.model=new e.JadeRuyiListMode,this.itemTips=new e.JadeItemDetailTips,this.ruyiItemArray=new Array,this.itemList=[],this.idAndCountArray=new Array,this.idAndCountDetail=new Array}return t.prototype.registerMsg=function(t){t.add(e.Code.ITME_GIFTS_GET_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ITME_GIFTS_GET_S:console.log("接收到信息 "+i)}},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.showList=function(t){this.ruyiBox=t,this.panel=new e.JadeRuyiListPanel(t,this.model),this.panel.show()},t.prototype.getRuyiContent=function(t){this.ruyiItemContent=t;for(var i=new Array,n=t.split(","),o=0;o<n.length;o++){var a=n[o].split("_")[1],s=n[o].split("_")[2];i.push(a);var r=a+","+s;this.idAndCountArray.push(r)}for(var l=new Array,h=e.JsonDataManager.instance.itemTemplate,o=0;o<i.length;o++)l.push(h[i[o]]);return l},t.prototype.getRuyiContentDetailTips=function(t){for(var i=new Array,n=t.split(","),o=0;o<n.length;o++){var a=n[o].split("_")[1],s=n[o].split("_")[2];i.push(a);var r=a+","+s;this.idAndCountDetail.push(r)}for(var l=new Array,h=e.JsonDataManager.instance.itemTemplate,o=0;o<i.length;o++)l.push(h[i[o]]);return l},t.prototype.getRuyiContentByBox=function(){return this.getRuyiContent(this.ruyiBox.containItem)},t.prototype.conversionGift=function(){if(0!=this.itemList.length){for(var t,i=0;i<this.itemList.length;i++)if(this.itemList[i].select.visible){t=this.itemList[i].data.id;break}for(var n,o=this.ruyiItemContent.split(","),a=o,i=0;i<a.length;i++){var s=parseInt(a[i].split("_")[1]);s==t&&(n=o[i])}e.BagController.getInstance().checkBagEnough(this,this.sendToServer,n,2)}},t.prototype.sendToServer=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPItemGetGiftReq");i.setItmeId(this.ruyiBox.id),i.setAwardStr(t),e.Message.instance.send(e.Code.ITME_GIFTS_GET_C,i,!0)},t.prototype.selectItem=function(e){for(var t,i=this.itemList.length,n=0;i>n;n++)t=this.itemList[n],t.selectBol=t==e?!0:!1,t.setGray(t==e)},t.prototype.initItem=function(){for(var e,t=this.itemList.length,i=0;t>i;i++)e=this.itemList[i],e.setGray(!0),e.selectBol=!1,e.select.visible=!1},t.prototype.showItemTips=function(e,t,i){this.itemTips.showPanel(e,t,i)},t.prototype.getIdAndCount=function(){return null!=this.idAndCountArray?this.idAndCountArray:void 0},t.prototype.getIdAndCountDetail=function(){return null!=this.idAndCountDetail?this.idAndCountDetail:void 0},t.prototype.difTypeTips=function(t){e.TipsController.getInstance().showItemTips(t.id,1,!0)},t.prototype.residueGiftNum=function(e,t){this.panel.updateGiftNum(e-t)},t.prototype.setRuyiIsSelected=function(e){this.ruyiIsSelected=e},t.prototype.getRuyiSelected=function(){return this.ruyiIsSelected},t.prototype.getRuyiItemArray=function(){return this.ruyiItemArray},t}();e.JadeRuyiListController=t,__reflect(t.prototype,"foxgame.JadeRuyiListController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.collection=new eui.ArrayCollection}return e}();e.JadeRuyiListMode=t,__reflect(t.prototype,"foxgame.JadeRuyiListMode")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i){var n=t.call(this,"resource/skins/jadeRuyi/JadeRuyiListSkin.exml")||this;return n.jadeRuyiItemVO=e,n.model=i,n.setIsTouchClose(!0),n}return __extends(i,t),i.prototype.initHook=function(){this.ui.list.dataProvider=this.model.collection,this.ui.list.itemRenderer=e.JadeItem;var t=new eui.TileLayout;t.requestedColumnCount=4,t.paddingLeft=5,t.paddingRight=5,t.horizontalGap=5,t.verticalGap=5,t.horizontalAlign="center",this.ui.list.layout=t,this.ui.conversion.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickConversion,this),this.ui.cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},i.prototype.refresh=function(){var t=this.ui.nameLabel;t.text=this.jadeRuyiItemVO.name,t.textColor=e.ColorUtils.instance.getColorByQuality(this.jadeRuyiItemVO.quality),this.ui.icon.setItem(this.jadeRuyiItemVO.id,this.itemCount,!1);var i=(this.ui.partLabel,e.JadeRuyiListController.getInstance().getRuyiContent(this.jadeRuyiItemVO.containItem));this.model.collection.replaceAll(i)},i.prototype.onClickConversion=function(){for(var t=0,i=e.JadeRuyiListController.getInstance().itemList,n=0;n<i.length;n++)i[n].select.visible&&t++;return 0==t?void(this.ui.selectTips.text="您没有选择礼包！"):(this.ui.selectTips.text="玩家每次只能选择一个道具!",e.JadeRuyiListController.getInstance().conversionGift(),void this.close())},i.prototype.updateGiftNum=function(e){e>0?this.ui.selectTips.text="还需要选择"+e+"个奖励！":0==e&&(this.ui.selectTips.text="已完成奖励的选择！")},i.prototype.closeHook=function(){e.JadeRuyiListController.getInstance().itemList=[]},i}(e.BasePanel);e.JadeRuyiListPanel=t,__reflect(t.prototype,"foxgame.JadeRuyiListPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skinName="RuyiEquipDisPlayTipsItem"},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){if(this.data){this.icon.setItem(this.data.id,1,!1);for(var t=e.JadeRuyiListController.getInstance().getIdAndCountDetail(),i=0;i<t.length;i++){var n=t[i].split(",");if(this.data.id==n[0]){var o=parseInt(n[1]);o>1?this.equipAmount.text=n[1]:this.equipAmount.text="";break}}}},i}(eui.ItemRenderer);e.RuyiEquipDisPlayTipsItem=t,__reflect(t.prototype,"foxgame.RuyiEquipDisPlayTipsItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.skinName="RuyiDetailDes"},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.refresh()},t.prototype.refresh=function(){this.data&&(this.equipName.text=this.data.name)},t}(eui.ItemRenderer);e.RuyiTipsItem=t,__reflect(t.prototype,"foxgame.RuyiTipsItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityAwardListItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){this.curretnVo=this.data,this.dayTxt.text=e.LanguageUtils.instance.getValue("DIJITIAN",this.curretnVo.getDays());var t=new e.AttributeVO(this.curretnVo.getReawagd());if(t&&0!=t.id){var i=e.JsonDataManager.instance.itemTemplate[t.id];this.icon.source=i.icon,this.itemNum.text=t.value+""}var n=e.JuBaoPenController.getInstance().getJuBaoPenAwardCurrentDays();this.group.touchChildren=!1,this.curretnVo.getReceive()?(this.keling.visible=!1,this.maskImg.visible=!0,this.yiling.visible=!0,this.guoqi.visible=!1):n<this.curretnVo.getDays()?(this.keling.visible=!1,this.maskImg.visible=!1,this.yiling.visible=!1,this.guoqi.visible=!1):n>this.curretnVo.getDays()?(this.keling.visible=!1,this.maskImg.visible=!0,this.yiling.visible=!1,this.guoqi.visible=!0):(this.keling.visible=!0,this.maskImg.visible=!1,this.yiling.visible=!1,this.guoqi.visible=!1),this.group.touchEnabled=!0,this.group.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.group:if(this.keling.visible)this.lingqu();else{var i=new e.AttributeVO(this.curretnVo.getReawagd());e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,i.value)}}},i.prototype.lingqu=function(){e.JuBaoPenController.getInstance().JuBaoPenAwardLingQu(this.curretnVo.getDays())},i.iconSize=68,i}(eui.ItemRenderer);e.ActivityJuBaoPenAwardListItemView=t,__reflect(t.prototype,"foxgame.ActivityJuBaoPenAwardListItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/jubaopen/ActivityAwardListViewSkin.exml")||this;return i.model=e,i.model.registerObserver(i),i.setIsShowBackBtn(!0),i}return __extends(i,t),i.prototype.showHook=function(){this.initUI()},i.prototype.panelChanged=function(){this.getIsShow()&&this.initUI()},i.prototype.updataView=function(e){this.currentData=e},i.prototype.getCurrentDay=function(){return this.currentData.getContinueDays()},i.prototype.refreshData=function(){this.initUI()},i.prototype.initUI=function(){var t,i=this.currentData.getInfos(),n=this.ui.list,o=Number(e.GlobalConfig.instance.getValue("JUBAOPEN_ROWNUM")),a=new eui.TileLayout;switch(a.requestedColumnCount=o,a.horizontalGap=(this.ui.listScroller.width-e.ActivityJuBaoPenAwardListItemView.iconSize*o)/(o-1),a.verticalGap=Number(e.GlobalConfig.instance.getValue("JUBAOPEN_GAPY")),this.currentData.getTypeId()){case 6:t=e.LanguageUtils.instance.getValue("GOLD_JUBAOPEN"),n.dataProvider=this.model.collection_JuBaoPenAward_yuanbao,n.itemRenderer=e.ActivityJuBaoPenAwardListItemView,n.layout=a,this.ui.listScroller.verticalScrollBar.autoVisibility=!1,this.model.setAwardType(this.currentData.getTypeId()),this.model.collection_JuBaoPenAward_yuanbao.replaceAll(i);break;case 7:t=e.LanguageUtils.instance.getValue("EXP_JUBAOPEN"),n.dataProvider=this.model.collection_JuBaoPenAward_exp,n.itemRenderer=e.ActivityJuBaoPenAwardListItemView,n.layout=a,this.ui.listScroller.verticalScrollBar.autoVisibility=!1,this.model.setAwardType(this.currentData.getTypeId()),this.model.collection_JuBaoPenAward_exp.replaceAll(i);break;case 8:t=e.LanguageUtils.instance.getValue("TONGBI_JUBAOPEN"),n.dataProvider=this.model.collection_JuBaoPenAward_tongbi,n.itemRenderer=e.ActivityJuBaoPenAwardListItemView,n.layout=a,this.ui.listScroller.verticalScrollBar.autoVisibility=!1,this.model.setAwardType(this.currentData.getTypeId()),this.model.collection_JuBaoPenAward_tongbi.replaceAll(i)}this.ui.titleName.text=t},i}(e.BasePanel);e.ActivityJuBaoPenAwardListView=t,__reflect(t.prototype,"foxgame.ActivityJuBaoPenAwardListView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityJuBaoPenItemViewSkin",e}return __extends(i,t),i.prototype.setItemData=function(e){this.currentData=e,this.initUI()},i.prototype.initUI=function(){var t,i;switch(this.currentData.getTypeId()){case 6:i=e.JsonDataManager.instance.jubappenGoldTemplate,t=i.icon,this.chaozhi.text=e.GlobalConfig.instance.getValue("JUBAOPEN_YBBS"),this.zhixu.text=e.GlobalConfig.instance.getValue("JUBAOPEN_YBJG");break;case 7:i=e.JsonDataManager.instance.jubappenExpTemplate,t=i.icon,this.chaozhi.text=e.GlobalConfig.instance.getValue("JUBAOPEN_JYBS"),this.zhixu.text=e.GlobalConfig.instance.getValue("JUBAOPEN_JYJG");break;case 8:i=e.JsonDataManager.instance.jubappenMoneyTemplate,t=i.icon,this.chaozhi.text=e.GlobalConfig.instance.getValue("JUBAOPEN_TQBS"),this.zhixu.text=e.GlobalConfig.instance.getValue("JUBAOPEN_TQJG")}if(this.bg.source=t,this.fanliBtn.textFlow=(new egret.HtmlTextParser).parser("<a href = ''><u>"+this.fanliBtn.text+"</u></a>"),this.fanliBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.currentData.getState()){this.buyImg.visible=!0,this.buyBtn.visible=!1,this.redPoint.visible=!1;for(var n=this.currentData.getContinueDays(),o=this.currentData.getInfos(),a=o.length,s=0;a>s;s++){var r=o[s];if(r.getDays()==n&&!r.getReceive()){this.redPoint.visible=!0;break}}}else this.buyBtn.visible=!0,this.buyImg.visible=!1,this.redPoint.visible=!1,this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.fanliBtn:e.JuBaoPenController.getInstance().showAwardPannel(this.currentData);break;case this.buyBtn:this.buy()}},i.prototype.buy=function(){var t,i;switch(this.currentData.getTypeId()){case 6:i=e.JsonDataManager.instance.jubappenGoldTemplate;break;case 7:i=e.JsonDataManager.instance.jubappenExpTemplate;break;case 8:i=e.JsonDataManager.instance.jubappenMoneyTemplate}t=i,this.chongzhi(t)},i.prototype.chongzhi=function(t){var i={};i.goodsId=t.productId,i.productName=t.productName,i.orderMoney=t.costMoney,i.diamondNum=t.amount,i.giftDiamondNum=t.addNum,e.RechargeController.getInstance().setPayData(i);var n=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");n.setGoodsId(t.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,n,!0)},i.prototype.lingquAward=function(){},i}(eui.Component);e.ActivityJuBaoPenItenView=t,__reflect(t.prototype,"foxgame.ActivityJuBaoPenItenView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityNew/jubaopen/ActivityJuBaoPenViewSkin.exml")||this;return i.canshow=!1,i.setIsTextureCache(!1),i.model=e,i.model.registerObserver(i),i.dataisok=!1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.jubaoTipLabel.text=e.LanguageUtils.instance.getValue("TREASUREBOWL")},i.prototype.panelChanged=function(){this.dataisok=!0,this.getIsShow()&&this.initUI()},i.prototype.refresh=function(){this.initUI()},i.prototype.initUI=function(){if(this.dataisok)for(var e=this.model.getJuBaoPenData(),t=e.getInfoList(),i=t.length,n=0;i>n;n++){var o=t[n];switch(o.getTypeId()){case 6:this.getItem(n+1).setItemData(o);break;case 7:this.getItem(n+1).setItemData(o);break;case 8:this.getItem(n+1).setItemData(o)}}},i.prototype.getIsShow=function(){return null!=this.parent},i.prototype.showHook=function(){this.initUI(),e.ActivityBarController.getInstance().setjubaopenEffect(!1)},i.prototype.getItem=function(e){return this.ui["item"+e]},i}(e.BasePanel);e.ActivityJuBaoPenView=t,__reflect(t.prototype,"foxgame.ActivityJuBaoPenView",["foxgame.IActivity","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.JuBaoPenModel,this.panel=new e.ActivityJuBaoPenView(this.model),this.awardPanel=new e.ActivityJuBaoPenAwardListView(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),window.JuBaoPenController=this.instance,this.instance},t.prototype.getJuBaoPenAwardCurrentDays=function(){return this.awardPanel.getCurrentDay()},t.prototype.JuBaoPenAwardLingQu=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPConrnuconpiaAwardReq");i.setTypeId(this.model.getAwardType()),i.setContinueDays(t),e.Message.instance.send(e.Code.CONRNUCONPIA_AWARD_C,i,!0)},t.prototype.showAwardPannel=function(e){this.model.setAwardType(e.getTypeId()),this.awardPanel.updataView(e),this.awardPanel.getIsShow()?this.awardPanel.refreshData():this.awardPanel.show()},t.prototype.showPanel=function(){this.panel.getIsShow()||(this.sendMessageForJuBaoPenInfo(),this.panel.show())},t.prototype.closePanel=function(){this.panel.close()},t.prototype.registerMsg=function(t){t.add(e.Code.CONRNUCONPIA_INFO_S,this),t.add(e.Code.CONRNUCONPIA_AWARD_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.CONRNUCONPIA_INFO_S:this.model.setJuBaoPenData(i);break;case e.Code.CONRNUCONPIA_AWARD_S:this.model.setJuBaoPenAwardData(i)}},t.prototype.sendMessageForJuBaoPenInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPConrnuconpiaInfoReq");e.Message.instance.send(e.Code.CONRNUCONPIA_INFO_C,t,!0)},t.prototype.showJuBaoPenAwardListPannel=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPConrnuconpiaAwardReq");i.setTypeId(t.getTypeId()),i.setContinueDays(t.getContinueDays()),e.Message.instance.send(e.Code.CONRNUCONPIA_AWARD_C,i,!0)},t}();e.JuBaoPenController=t,__reflect(t.prototype,"foxgame.JuBaoPenController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.dataSource_JuBaoPenAward_yuanbao=[],this.dataSource_JuBaoPenAward_exp=[],this.dataSource_JuBaoPenAward_tongbi=[],this.collection_JuBaoPenAward_yuanbao=new eui.ArrayCollection,this.collection_JuBaoPenAward_yuanbao.source=this.dataSource_JuBaoPenAward_yuanbao,this.collection_JuBaoPenAward_exp=new eui.ArrayCollection,this.collection_JuBaoPenAward_exp.source=this.dataSource_JuBaoPenAward_exp,this.collection_JuBaoPenAward_tongbi=new eui.ArrayCollection,this.collection_JuBaoPenAward_tongbi.source=this.dataSource_JuBaoPenAward_tongbi,this.observerList=[]}return t.prototype.setCurrentKaiQiTime=function(e){this.kaiQiShiJian=e},t.prototype.getCurrentKaiQiTime=function(){return this.kaiQiShiJian},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChanged()},t.prototype.setJuBaoPenAwardData=function(t){e.JuBaoPenController.getInstance().sendMessageForJuBaoPenInfo();for(var i=t.getInfoList().length,n=0;i>n;n++){var o=t.getInfoList()[n];if(o.getTypeId()==this.jubaopen_type)return void e.JuBaoPenController.getInstance().showAwardPannel(o)}},t.prototype.setJuBaoPenData=function(t){this._jubaopen=t,this.updateView();for(var i=this._jubaopen.getInfoList().length,n=0;i>n;n++){var o=this._jubaopen.getInfoList()[n];if(o.getState())for(var a=o.getContinueDays(),s=o.getInfos(),r=s.length,l=0;r>l;l++){var h=s[l];if(h.getDays()==a&&!h.getReceive())return e.ActivityBarController.getInstance().setJubaopenRedPoint(!0)}}e.ActivityBarController.getInstance().setJubaopenRedPoint(!1)},t.prototype.getJuBaoPenData=function(){return this._jubaopen},t.prototype.callBackPointByjubaopen=function(t){e.ActivityBarController.getInstance().setJubaopenRedPoint(t)},t.prototype.setAwardType=function(e){this.jubaopen_type=e},t.prototype.getAwardType=function(){return this.jubaopen_type},t}();e.JuBaoPenModel=t,__reflect(t.prototype,"foxgame.JuBaoPenModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="JueweiConditionSkin",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.goComplete.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickEvent,this)},i.prototype.setSkipCode=function(t){var i=e.JsonDataManager.instance.nobilityMission;this.skipCode=i[t].skipType},i.prototype.setItemMsg=function(t,i,n){this.condition.text=t,this.progress.textFlow=this.createTextFlow(i),this.progress.x=this.condition.x+this.condition.width+5,this.goComplete.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("DIANJIQIANWANG")),this.complete.visible=1==n?!0:!1,this.goComplete.visible=1==n?!1:!0},i.prototype.createTextFlow=function(e){var t,i=e.split("/"),n=Number(i[0]),o=Number(i[1]);t=n>=o?65280:16711680;var a=[{text:"(",style:{textColor:16777215}},{text:n+"",style:{textColor:t}},{text:"/"+o+")",style:{textColor:16777215}}];return a},i.prototype.clickEvent=function(){void 0!==this.skipCode&&(e.SkipCodeDataHandler.getInstance().skipTo(Number(this.skipCode)),e.NewJueweiController.getInstance().getPanel().getIsShow()&&e.NewJueweiController.getInstance().getPanel().close())},i.prototype.removeClickEvent=function(){this.goComplete.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickEvent,this)},i}(eui.Component);e.JueweiConditionItem=t,__reflect(t.prototype,"foxgame.JueweiConditionItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.JueweiMissionVO=t,__reflect(t.prototype,"foxgame.JueweiMissionVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.JueweiVO=t,__reflect(t.prototype,"foxgame.JueweiVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.NewJueweiModel,this.panel=new e.NewJueweiPanel(this.model)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.NOBILITY_NOBILITY_INFO_S:this.model.setNobilityInfo(i);break;case e.Code.NOBILITY_LEVEL_UP_S:this.panel.showAscendGroup();break;case e.Code.NOBILITY_REWARD_S:this.model.setNOBILITY_REWARD_S(i)}},t.prototype.showPanel=function(){App.LittleLoading().showLoading("NewJueweiController"),this.panel.show(),this.panel.sendNobilityMsg(),App.LittleLoading().hideLoading("NewJueweiController")},t.prototype.updateNobilityData=function(){this.panel.getIsInit()&&this.panel.sendNobilityMsg()},t.prototype.closePanel=function(){this.panel.getIsShow()&&this.panel.close()},t.prototype.getPanel=function(){return this.panel},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t}();e.NewJueweiController=t,__reflect(t.prototype,"foxgame.NewJueweiController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.ConditionProgress=t,__reflect(t.prototype,"foxgame.ConditionProgress");var i=function(){function i(){this.rowDis=15,this.tweenDis=24,this.tweenSpeed=.6,this.tweenToTop=!0,this.isCompleteAllCondition=!1,this.modelUpdated=!1,this.isCompleteAry=[],this.observerList=[]}return i.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},i.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},i.prototype.updateChopPath=function(t){var i=t.getLevel(),n=e.JsonDataManager.instance.nobility,o=n[i];this.currentLevelChopPath=o.chopPath},i.prototype.updateMissionData=function(t){var i=e.JsonDataManager.instance.nobilityMission,n=t.getMissionInfo();if(this.conditionMsgAry=[],0!=n.length){for(var o=0;o<n.length;o++){this.conditionMsgAry[o]=[];var a=n[o].missionId,s=i[a],r=s.name,l=this.calcMissionProgress(n[o],s,i);this.conditionMsgAry[o].push(r),this.conditionMsgAry[o].push(l.progress),this.conditionMsgAry[o].push(l.isComplete),this.conditionMsgAry[o].push(n[o].missionId),this.isCompleteAry[o]=l.isComplete}this.updatePromoteState()}},i.prototype.calcMissionProgress=function(e,i,n){var o,a,s=new t;return-1!=i.name.indexOf("-")?(o=this.findBossPro(i.cond),a=this.findBossPro(e.progress)):(o=i.cond,a=e.progress),s.progress=o>=a?a+"/"+o:o+"/"+o,s.isComplete=o>a?!1:!0,s},i.prototype.findBossPro=function(t){var i=e.JsonDataManager.instance.mapTemplate;for(var n in i)if(i[n].bossId==t)return Number(n);return t},i.prototype.updateJueweiMsg=function(t){this.level=t.getLevel(),this.levelText=e.LanguageUtils.instance.getValue("JUEWEILV")+t.getLevel(),this.gradeText=e.LanguageUtils.instance.getValue("JUEWEIPINGFEN")+": "+t.getGrade()},i.prototype.updateAttrsMsg=function(t){var i=e.JsonDataManager.instance.nobility,n=t.getLevel(),o=i[n],a=o.attrs,s=a.length;this.attrs=[];for(var r=0;s>r;r++){var l=a[r];this.attrs.push(l[1])}},i.prototype.updatePromoteState=function(){for(var e=0;e<this.isCompleteAry.length;e++)if(!this.isCompleteAry[e])return void(this.isCompleteAllCondition=!1);this.isCompleteAllCondition=!0},i.prototype.updateRewardState=function(e){var t=0==e.getRewardState()?!0:!1;this.rewardState=t},i.prototype.setNobilityInfo=function(e){this.updateChopPath(e),this.updateJueweiMsg(e),this.updateAttrsMsg(e),this.updateMissionData(e),this.updateRewardState(e),this.modelUpdated=!0,this.updateView()},i.prototype.setNOBILITY_REWARD_S=function(t){1==t.getResult()&&e.NewJueweiController.getInstance().updateNobilityData()},i}();e.NewJueweiModel=i,__reflect(i.prototype,"foxgame.NewJueweiModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/juewei/JueweiMainSkin.exml","JueWei")||this;return i.count=0,i.setRegisterTick(!0),i.model=e,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.refresh=function(){if(this.ui.currency.refresh(),this.model.modelUpdated&&this.getIsInit()){this.initBtnState(),this.ui.jueweiLevel.text=this.getJueweiVO().name+"Lv"+this.getJueweiVO().namelevel,this.ui.jueweiGrade.text=this.model.gradeText,this.effectChop(!0);for(var t=this.getCurrentAttrs(),i=0;i<t.length;i++)t[i].text=this.model.attrs[i]+"";if(this.updatePurposAtts(),this.updateAttrsPos(),this.updateRewards(),this.model.isCompleteAllCondition&&(this.ui.promoteBtn.enabled=!0),this.updateMission(),Log.trace(this.getJueweiVO()),this.receivePartHandler(),26==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz)if(this.model.isCompleteAllCondition)e.MainControler.instance.guidechange(this.ui.promoteBtn,this.ui.promoteBtn.parent,26,2,!0);else{var n=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(n,n.parent,26,5,!0)}}},i.prototype.showHook=function(){t.prototype.showHook.call(this)},i.prototype.updatePurposAtts=function(t){void 0===t&&(t=!1);var i=this.getPurposAttrs(),n=e.JsonDataManager.instance.nobility,o=this.model.level+1;t&&(o=this.model.level+Number(n[this.model.level].intervalLv));var a=n[o];a||(a=n[this.model.level]);for(var s=a.attrs,r=i.length,l=0;r>l;l++)i[l].text=s[l][1]+"";t?this.ui.jueweiLevel.text=a.name+"Lv"+a.namelevel:this.ui.jueweiLevel.text=n[this.model.level].name+"Lv"+n[this.model.level].namelevel},i.prototype.updateAttrsPos=function(){for(var e=this.getArrowheads(),t=this.getCurrentAttrs(),i=this.getPurposAttrs(),n=e.length,o=0;n>o;o++)e[o].x=t[o].x+t[o].width+this.model.rowDis,i[o].x=e[o].x+e[o].width+this.model.rowDis},i.prototype.updateRewards=function(){for(var e=this.getItemCells(),t=this.getJueweiVO(),i=0;i<e.length;i++){var n=t.awards[i][1],o=t.awards[i][2];e[i].setItem(n,o,!0,!1)}},i.prototype.receivePartHandler=function(){var e=this.getItemCells();if(this.ui.receiveBtn.visible=this.model.rewardState,this.model.level>=1){this.ui.receiveTipText.visible=!1;for(var t=0;t<e.length;t++)e[t].visible=!0}else{this.ui.receiveBtn.visible=!1;for(var t=0;t<e.length;t++)e[t].visible=!1}this.ui.receiveBtn.enabled&&this.ui.receiveBtn.visible?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAniGroup&&(this.rechargeAniGroup.clear(),this.rechargeAniGroup=null),t&&(this.rechargeAniGroup||(this.rechargeAniGroup=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAniGroup.play("rechargeAnimation","ani",-1)))},i.prototype.effectJuewei=function(t,i){if(void 0===i&&(i=!1),this.ascendAniGroup&&(this.ascendAniGroup.clear(),this.ascendAniGroup=null),t&&!this.ascendAniGroup){this.ascendAniGroup=new e.FoxAni(this.ui.ascendAniGroup);var n=this.getJueweiVO(i,i).chopPath+this.getJueweiVO(i,i).type;this.ascendAniGroup.play(n,"ani",-1)}},i.prototype.effectChop=function(t,i){if(void 0===i&&(i=!1),this.chopGroup&&(this.chopGroup.clear(),this.chopGroup=null),t&&!this.chopGroup){this.chopGroup=new e.FoxAni(this.ui.chopGroup);var n=this.getJueweiVO(i,i).chopPath+this.getJueweiVO(i,i).type;this.chopGroup.play(n,"ani",-1)}},i.prototype.effectJueweidi=function(t){this.dizuoAniGroup&&(this.dizuoAniGroup.clear(),this.dizuoAniGroup=null),t&&(this.dizuoAniGroup||(this.dizuoAniGroup=new e.FoxAni(this.ui.dizuoAniGroup),this.dizuoAniGroup.play("jueweidiAni","ani",-1)))},i.prototype.updateMission=function(){var e=this.getConditions().length;if(0!=this.model.conditionMsgAry.length)for(var t=0;e>t;t++){var i=this.model.conditionMsgAry[t];this.getConditions()[t].setItemMsg(i[0],i[1],i[2]),this.getConditions()[t].setSkipCode(i[3])}else for(var t=0;e>t;t++)this.getConditions()[t].visible=!1,this.ui.endText.visible=!0},i.prototype.tickHook=function(e){},i.prototype.tweenItem=function(e){this.getIsShow()&&(this.model.tweenToTop?(this.ui.chopImg.y-=this.model.tweenSpeed,this.ui.chopImg.y<this.ui.ref.y-this.model.tweenDis&&(this.ui.chopImg.y=this.ui.ref.y-this.model.tweenDis,this.model.tweenToTop=!1)):(this.ui.chopImg.y+=this.model.tweenSpeed,this.ui.chopImg.y>this.ui.ref.y+this.model.tweenDis&&(this.ui.chopImg.y=this.ui.ref.y+this.model.tweenDis,this.model.tweenToTop=!0)))},i.prototype.initHook=function(){this.ui.ascendGroup.visible=!1,this.ui.ascendRect.visible=!1,this.ui.nextLeft.visible=!1,this.ui.nextRight.visible=!0,DebugTool.getInstance().addDisplayObj(this.ui,this.count++),this.model.registerObserver(this),this.ui.promoteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.nextLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.nextRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.ascendRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.testBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.receiveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this);for(var e=0;e<this.getItemCells().length;e++)this.getItemCells()[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.showItemTip,this);this.doScreenAdaptation()},i.prototype.initBtnState=function(){this.ui.promoteBtn.enabled=!0,this.ui.receiveBtn.visible=!1,this.ui.receiveTipText.visible=!0,this.ui.endText.visible=!1,this.effectLingQu(!1)},i.prototype.btnClick=function(t){switch(t.target){case this.ui.promoteBtn:if(1==this.ui.receiveBtn.enabled&&1==this.ui.receiveBtn.visible){var i=e.LanguageUtils.instance.getValue("JUEWEIRECEIVETIP");return i=i.replace("{br}","\n"),void e.PopUpController.getInstance().showTextPanel(i,this,this.sendJueweiLevelUpReq)}if(!this.model.isCompleteAllCondition)return void e.PopUpController.getInstance().showFloatTextPanel1("当前升阶条件不足");26==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.jihuo,this.ui.jihuo.parent,26,3,!0),this.sendJueweiLevelUpReq();
break;case this.ui.receiveBtn:if(this.ui.receiveBtn.visible=!1,this.effectLingQu(!1),this.sendJueweiRewardReq(),App.SoundManager().playEffect("sound_award_mp3"),26==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz){var n=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(n,n.parent,26,5,!0)}break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("NOBILITYHELP");break;case this.ui.testBtn:this.showAscendGroup();break;case this.ui.ascendRect:26==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.receiveBtn,this.ui.receiveBtn.parent,26,4,!0),this.ui.ascendGroup.visible=!1,this.ui.ascendRect.visible=!1,StageFrameControl.instance.getBackBtn().visible=!0;break;case this.ui.nextLeft:this.updatePurposAtts(),this.ui.nextRight.visible=!0,this.ui.nextLeft.visible=!1,this.effectChop(!0,!1),this.ui.rewardGroup.visible=!0,this.ui.intervalLvText.visible=!1;break;case this.ui.nextRight:this.updatePurposAtts(!0),this.ui.nextRight.visible=!1,this.ui.nextLeft.visible=!0,this.effectChop(!0,!0),this.ui.rewardGroup.visible=!1,this.ui.intervalLvText.visible=!0,this.ui.intervalLvText.text="再升"+this.getJueweiVO().intervalLv+"级可晋升"+this.getJueweiVO(!0,!0).name}},i.prototype.showAscendGroup=function(){var t=this.model.level;0==this.model.level&&(t=-1),(-1==t||5==e.JsonDataManager.instance.nobility[this.model.level].namelevel)&&(StageFrameControl.instance.getBackBtn().visible=!1,this.ui.ascendGroup.visible=!0,this.ui.ascendRect.visible=!0,egret.Tween.get(this.ui.ascendGroup).to({scaleX:.2,scaleY:.2},0,egret.Ease.sineIn).to({scaleX:1,scaleY:1},300,egret.Ease.sineIn),this.effectJuewei(!0,!0),this.effectJueweidi(!0),this.ui.ascendText.text="恭喜您晋升"+this.getJueweiVO(!0,!0).name)},i.prototype.showItemTip=function(t){var i=t.target,n=this.getItemCells().indexOf(i),o=this.getJueweiVO(),a=o.awards[n][1],s=o.awards[n][2];e.TipsController.getInstance().showItemTips(a,s)},i.prototype.getJueweiVO=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var n=e.JsonDataManager.instance.nobility,o=this.model.level;t&&n[o+1]&&!i&&(o=this.model.level+1),i&&t&&n[o+1]&&(o=this.model.level+Number(n[o].intervalLv));var a=n[o];return a},i.prototype.sendJueweiLevelUpReq=function(){this.ui.promoteBtn.enabled=!0;var t=HawkProtocolManager.newBuilder("JsProto.NobilityLevelUpReq");t.setVersion(1),Log.trace("==========================="),e.Message.instance.send(e.Code.NOBILITY_LEVEL_UP_C,t,!0)},i.prototype.sendJueweiRewardReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.NobilityRewardReq");t.setVersion(1),e.Message.instance.send(e.Code.NOBILITY_REWARD_C,t,!0)},i.prototype.sendNobilityMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.NobilityInfoReq");t.setVersion(1),e.Message.instance.send(e.Code.NOBILITY_NOBILITY_INFO_C,t,!0)},i.prototype.closeHook=function(){this.scaleX=this.scaleY=1,this.x=this.y=0,26==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),this.rechargeAniGroup&&(this.rechargeAniGroup.dispose(),this.rechargeAniGroup=null),this.ascendAniGroup&&(this.ascendAniGroup.dispose(),this.ascendAniGroup=null),this.dizuoAniGroup&&(this.dizuoAniGroup.dispose(),this.dizuoAniGroup=null),this.chopGroup&&(this.chopGroup.dispose(),this.chopGroup=null)},i.prototype.getCurrentAttrs=function(){var e=[];return e.push(this.ui.currentAttr0),e.push(this.ui.currentAttr1),e.push(this.ui.currentAttr2),e.push(this.ui.currentAttr3),e},i.prototype.getPurposAttrs=function(){var e=[];return e.push(this.ui.purposAttr0),e.push(this.ui.purposAttr1),e.push(this.ui.purposAttr2),e.push(this.ui.purposAttr3),e},i.prototype.getConditions=function(){var e=[];return e.push(this.ui.condition0),e.push(this.ui.condition1),e.push(this.ui.condition2),e.push(this.ui.condition3),e},i.prototype.getArrowheads=function(){var e=[];return e.push(this.ui.arrowhead0),e.push(this.ui.arrowhead1),e.push(this.ui.arrowhead2),e.push(this.ui.arrowhead3),e},i.prototype.getItemCells=function(){var e=[];return e.push(this.ui.itemCell0),e.push(this.ui.itemCell1),e.push(this.ui.itemCell2),e.push(this.ui.itemCell3),e},i}(e.BasePanel);e.NewJueweiPanel=t,__reflect(t.prototype,"foxgame.NewJueweiPanel",["foxgame.IJuewei","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.Panel_1=1]="Panel_1",e[e.Panel_2=2]="Panel_2",e[e.Panel_3=3]="Panel_3",e[e.Panel_4=4]="Panel_4"}(t=e.KFPanelType||(e.KFPanelType={}));var i;!function(e){e[e.DAN=1]="DAN",e[e.PRELIMINARY=2]="PRELIMINARY",e[e.PRELIMINARY_OPEN=3]="PRELIMINARY_OPEN",e[e.PRELIMINARY_END=4]="PRELIMINARY_END",e[e.FINALS=5]="FINALS",e[e.TOP_8=6]="TOP_8",e[e.TOP_4=7]="TOP_4",e[e.TOP_2=8]="TOP_2",e[e.TOP_1=9]="TOP_1",e[e.FINISH=10]="FINISH"}(i=e.CSArenaStage||(e.CSArenaStage={}));var n;!function(e){e[e.Search=1]="Search",e[e.Get=2]="Get",e[e.Fight=3]="Fight",e[e.Wait=4]="Wait"}(n=e.MatchType||(e.MatchType={}));var o;!function(e){e.PanelTapLength=4,e.EachDanLevel=6,e.JueBattleSession=5,e.ChuSaiAwdRankSource=["chusai_1","chusai_2","chusai_35","chusai_616","chusai_canyujiang"],e.JueSaiAwdRankSource=["juesai_guanjun","juesai_yajun","juesai_4","juesai_8","juesai_16"],e.ChuSaiCanYuAwdRank=17,e.JueSaiTimeColorList=[15655878,2227971,16711680,41983],e.JueSaiTimeColorDelay=200,e.PinnacleCoinChange="pinnacleCoinChange",e.CsStageChange="csStageChange"}(o=e.KFConst||(e.KFConst={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isFirst=!0,this.aa=1,this.model=new e.KFModel,this.panel=new e.KFMainPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.panel&&0==this.panel.getIsShow()&&this.panel.show()},t.prototype.getKFMainPanelBaseUiName=function(){return this.panel?this.panel.getUiBaseName():"getKFMainPanelBaseUiName"},t.prototype.registerMsg=function(t){t.add(e.MsgCMD.CLOSE_PANEL,this),t.add(e.Code.CS_ARENA_INFO_S,this),t.add(e.Code.CS_MATCH_OPPONENT_S,this),t.add(e.Code.CS_CHALLENGE_S,this),t.add(e.Code.CS_ARENA_RANK_INFO_S,this),t.add(e.Code.CS_ARENA_BET_S,this),t.add(e.Code.CS_ARENA_MY_BET_S,this),t.add(e.Code.CS_ARENA_POPULAR_S,this),t.add(e.Code.CS_ARENA_MY_FIGHT_S,this),t.add(e.Code.CS_ARENA_OTHER_FIGHT_S,this),t.add(e.Code.CS_ARENA_WORSHIP_S,this),t.add(e.Code.CS_ARENA_PINNACLE_SHOP_BUY_S,this),t.add(e.Code.CS_ARENA_CANCEL_MATCH_S,this),t.add(e.Code.CS_ARENA_THUMBS_UP_S,this),t.add(e.Code.CS_ARENA_MATCH_TIMES_BUY_S,this),t.add(e.Code.CS_ARENA_SEASON_STAGE_CHANGE_S,this),t.add(e.Code.CS_ARENA_PINNACLE_COIN_SYNC,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.CLOSE_PANEL:(0==i||2==i)&&(this.panel&&this.panel.getIsShow()&&this.panel.close(),this.rankPanel&&this.rankPanel.getIsShow()&&this.rankPanel.close(),this.sentRankPanel&&this.sentRankPanel.getIsShow()&&this.sentRankPanel.close(),this.myRecordPanel&&this.myRecordPanel.getIsShow()&&this.myRecordPanel.close(),this.betPanel&&this.betPanel.getIsShow()&&this.betPanel.close(),this.myBetPanel&&this.myBetPanel.getIsShow()&&this.myBetPanel.close(),this.battleReportPanel&&this.battleReportPanel.getIsShow()&&this.battleReportPanel.close(),this.battleResultPanel&&this.battleResultPanel.getIsShow()&&this.battleResultPanel.close(),this.mobaiAwardInfoPanel&&this.mobaiAwardInfoPanel.getIsShow()&&this.mobaiAwardInfoPanel.close(),this.smackDownPanel&&this.smackDownPanel.getIsShow()&&this.smackDownPanel.close());break;case e.Code.CS_ARENA_INFO_S:this.kf_infoBack(i);break;case e.Code.CS_MATCH_OPPONENT_S:this.kf_matchBack(i);break;case e.Code.CS_CHALLENGE_S:break;case e.Code.CS_ARENA_RANK_INFO_S:this.kf_arenaRankInfoBack(i);break;case e.Code.CS_ARENA_BET_S:this.kf_betBack(i);break;case e.Code.CS_ARENA_MY_BET_S:this.kf_myBetBack(i);break;case e.Code.CS_ARENA_POPULAR_S:this.kf_popularBack(i);break;case e.Code.CS_ARENA_MY_FIGHT_S:this.kf_myFightInfoBack(i);break;case e.Code.CS_ARENA_OTHER_FIGHT_S:this.kf_otherFightInfoBack(i);break;case e.Code.CS_ARENA_WORSHIP_S:this.kf_worshipBack(i);break;case e.Code.CS_ARENA_PINNACLE_SHOP_BUY_S:this.kf_pinnacleShopBuyBack(i);break;case e.Code.CS_ARENA_CANCEL_MATCH_S:this.kf_cancleMatchBack(i);break;case e.Code.CS_ARENA_THUMBS_UP_S:this.kf_thumbs_upBack(i);break;case e.Code.CS_ARENA_MATCH_TIMES_BUY_S:this.kf_matchTimesBuyBack(i);break;case e.Code.CS_ARENA_SEASON_STAGE_CHANGE_S:this.kf_seasonStageChange(i);break;case e.Code.CS_ARENA_PINNACLE_COIN_SYNC:this.kf_pinnacleCoinBack(i)}},t.prototype.refreshMainUI=function(){this.panel&&1==this.panel.getIsShow()&&this.panel.refreshUI()},t.prototype.showRankPanel=function(){(null==this.rankPanel||void 0==this.rankPanel)&&(this.rankPanel=new e.KFRankPanel(this.model)),this.rankPanel.show()},t.prototype.closeRankPanel=function(){this.rankPanel&&this.rankPanel.getIsShow()&&(this.rankPanel.close(),this.rankPanel=null)},t.prototype.showSentRankPanel=function(){(null==this.sentRankPanel||void 0==this.sentRankPanel)&&(this.sentRankPanel=new e.SentimentRankPanel(this.model)),this.sentRankPanel.show()},t.prototype.closeSentRankPanel=function(){this.sentRankPanel&&this.sentRankPanel.getIsShow()&&(this.sentRankPanel.close(),this.sentRankPanel=null)},t.prototype.showMyRecordPanel=function(){(null==this.myRecordPanel||void 0==this.myRecordPanel)&&(this.myRecordPanel=new e.MyRecordPanel(this.model)),this.myRecordPanel.show()},t.prototype.closeMyRecordPanel=function(){this.myRecordPanel&&this.myRecordPanel.getIsShow()&&(this.myRecordPanel.close(),this.myRecordPanel=null)},t.prototype.showSmackDownPanel=function(){(null==this.smackDownPanel||void 0==this.smackDownPanel)&&(this.smackDownPanel=new e.KFSmackDownPanel(this.model)),this.smackDownPanel.show()},t.prototype.showBetPanel=function(t){null!=this.betPanel&&null!=this.betPanel.parent&&(this.betPanel.close(),this.betPanel=null),this.betPanel=new e.KFBetPanel(this.model,t),this.betPanel.show()},t.prototype.closeBetPanel=function(){this.betPanel&&this.betPanel.getIsShow()&&(this.betPanel.close(),this.betPanel=null)},t.prototype.showMyBetPanel=function(){(null==this.myBetPanel||void 0==this.myBetPanel)&&(this.myBetPanel=new e.KFMyBetPanel(this.model)),this.myBetPanel.show()},t.prototype.closeMyBetPanel=function(){this.myBetPanel&&this.myBetPanel.getIsShow()&&(this.myBetPanel.close(),this.myBetPanel=null)},t.prototype.showBattleReportPanel=function(t){null==this.battleReportPanel&&(this.battleReportPanel=new e.KFBattleReportPanel(this.model,t)),this.battleReportPanel.setInitData(t),this.battleReportPanel.show()},t.prototype.closeBattleReportPanel=function(){this.battleReportPanel&&this.battleReportPanel.getIsShow()&&(this.battleReportPanel.close(),this.battleReportPanel=null)},t.prototype.showBattleResultPanel=function(t){this.model.MatchStatus=e.MatchType.Wait,this.model.DanStar=this.model.DanStar+t.awards.getSegmentStar(),this.model.PreliminaryIntegral=this.model.PreliminaryIntegral+t.awards.getIntegral(),this.battleResultPanel=new e.KFBattleResultPanel(this.model,t),this.battleResultPanel.show()},t.prototype.setRemainTime=function(){this.model.Kf_chusaiRemainTime>0&&this.model.CurentBattleTap==e.CSArenaStage.PRELIMINARY_OPEN&&(this.stopRemainTick(),egret.startTick(this.remainTick,this))},t.prototype.showMobaiAwardInfoPanel=function(){(null==this.mobaiAwardInfoPanel||void 0==this.mobaiAwardInfoPanel)&&(this.mobaiAwardInfoPanel=new e.KFMobaiAwardInfoPanel(this.model)),this.mobaiAwardInfoPanel.show()},t.prototype.remainTick=function(e){this.model.lastRemainTime<=0&&(this.model.lastRemainTime=e);var t=e-this.model.lastRemainTime;if(1e3>t)return!1;this.model.lastRemainTime=e,this.model.Kf_chusaiRemainTime-=t;var i=Math.floor(this.model.Kf_chusaiRemainTime/1e3);return this.model.Kf_chusaiRemainTime<=0&&(i=-1,this.stopRemainTick()),!0},t.prototype.stopRemainTick=function(){this.model.lastRemainTime=-1,egret.stopTick(this.remainTick,this)},t.prototype.sendKFInfoMsg=function(){Log.trace("client   请求联赛信息");var t=HawkProtocolManager.newBuilder("JsProto.CSArenaInfoReq");e.Message.instance.send(e.Code.CS_ARENA_INFO_C,t,!0)},t.prototype.kf_infoBack=function(t){Log.trace("server   收到服务器联赛信息"),t.getErrorNo()>0||(this.model.CsInfo=t,this.setRemainTime(),this.refreshMainUI(),this.isFirst&&(this.isFirst=!1,e.MainSceneManager.instance.refreshMainRoleDuanTitle(),e.ActivityBarController.getInstance().setKuaFuSaiEffectVisible()))},t.prototype.test=function(){var e=new Buffer.CSArenaInfoRsp,t=new Buffer.CSArenaInfo,i=new Buffer.SeasonInfo,n=[1,2,5],o=new Buffer.CSArenaPlayerInfo;o.setPlayerName("啥玩意"+Math.floor(10*Math.random())),o.setDanStar(5*this.aa),i.setRemainingTime(1e3),i.setStage(n[this.aa%3]),t.setSeasonInfo(i),t.setMatchTimes(5),t.setPlayerInfo(o),e.setCsArenaInfo(t),this.kf_infoBack(e),this.aa++},t.prototype.sendKFRankInfoMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaRankInfoReq");e.Message.instance.send(e.Code.CS_ARENA_RANK_INFO_C,t,!0)},t.prototype.kf_arenaRankInfoBack=function(e){this.model.KfRankInfo=e,this.rankPanel&&this.rankPanel.getIsShow()&&this.rankPanel.refreshUI()},t.prototype.sendMatchPlayer=function(){Log.trace("client   请求对手"),this.model.MatchStatus=e.MatchType.Search;var t=HawkProtocolManager.newBuilder("JsProto.CSMatchOpponentReq");t.setStage(this.model.CurentBattleTap),e.Message.instance.send(e.Code.CS_MATCH_OPPONENT_C,t,!0)},t.prototype.kf_matchBack=function(t){return t.getErrorNo()>0?(Buffer,this.model.MatchStatus=e.MatchType.Get,this.model.MatchEnemyInfo=null,void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo())):(this.model.MatchStatus=e.MatchType.Get,void(this.model.MatchEnemyInfo=t.getOpponentInfo()))},t.prototype.kf_challange=function(){if(Log.trace("client   请求跨服战斗"),this.model.MatchStatus=e.MatchType.Fight,null!=this.model.MatchEnemyInfo){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaChallengeReq");e.Message.instance.send(e.Code.CS_CHALLENGE_C,t,!0)}this.panel.close()},t.prototype.kf_challengeBack=function(e){},t.prototype.sendLikePlayer=function(t){var i=HawkProtocolManager.newBuilder("JsProto.CSArenaThumbsUpReq");i.setTargetIdentify(t),e.Message.instance.send(e.Code.CS_ARENA_THUMBS_UP_C,i,!0)},t.prototype.kf_thumbs_upBack=function(e){e.getErrorNo()>0||(this.model.MySupportPlayer=e.getMyIdentify(),this.sentRankPanel&&this.sentRankPanel.getIsShow()&&this.sentRankPanel.refreshUI())},t.prototype.sendBet=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.CSArenaBetReq");n.setTargetIdentify(t),n.setPinnacleCoin(i),e.Message.instance.send(e.Code.CS_ARENA_BET_C,n,!0)},t.prototype.kf_betBack=function(e){e.getErrorNo()>0||(this.model.MyBetTarget=e.getTarget().getPlayerIdentify(),this.refreshMainUI())},t.prototype.sendMyBet=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaMyBetInfoReq");e.Message.instance.send(e.Code.CS_ARENA_MY_BET_C,t,!0)},t.prototype.kf_myBetBack=function(e){this.model.MyBetInfoRsp=e,this.myBetPanel&&this.myBetPanel.getIsShow()&&this.myBetPanel.refreshUI()},t.prototype.sendPopular=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaPopularInfoReq");e.Message.instance.send(e.Code.CS_ARENA_POPULAR_C,t,!0)},t.prototype.kf_popularBack=function(e){this.model.PopularInfoRsp=e,this.sentRankPanel&&this.sentRankPanel.getIsShow()&&this.sentRankPanel.refreshUI()},t.prototype.sendMyFightInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaMyFightInfoReq");e.Message.instance.send(e.Code.CS_ARENA_MY_FIGHT_C,t,!0)},t.prototype.kf_myFightInfoBack=function(e){this.model.MyFightInfoRsp=e,this.myRecordPanel&&this.myRecordPanel.getIsShow()&&this.myRecordPanel.refreshUI()},t.prototype.sendOtherFightInfo=function(t){if(""==t)return void(this.model.OtherFightInfoRsp=null);var i=HawkProtocolManager.newBuilder("JsProto.CSArenaOtherFightInfoReq");i.setGroupIdentify(t),e.Message.instance.send(e.Code.CS_ARENA_OTHER_FIGHT_C,i,!0)},t.prototype.kf_otherFightInfoBack=function(e){this.model.OtherFightInfoRsp=e,this.battleReportPanel&&this.battleReportPanel.getIsShow()&&this.battleReportPanel.refreshUI()},t.prototype.sendWorship=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaWorshipReq");e.Message.instance.send(e.Code.CS_ARENA_WORSHIP_C,t,!0)},t.prototype.kf_worshipBack=function(e){e.getErrorNo()>0||(this.model.IsWoship=!0,this.refreshMainUI())},t.prototype.sendPinnacleShopBuy=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.CSArenaPinnacleShopBuyReq");n.setItemId(t),n.setNum(i),e.Message.instance.send(e.Code.CS_ARENA_PINNACLE_SHOP_BUY_C,n,!0)},t.prototype.kf_pinnacleShopBuyBack=function(t){t.getErrorNo()>0||(this.model.CSpinnacleCoin=t.getPinnacleCoin(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHOPBUYSUCCESS")))},t.prototype.sendCancleMatchBack=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaWorshipReq");e.Message.instance.send(e.Code.CS_ARENA_CANCEL_MATCH_C,t,!0)},t.prototype.kf_cancleMatchBack=function(t){Log.trace("server   取消匹配"),t.getErrorNo()>0||(this.model.MatchStatus=e.MatchType.Wait)},t.prototype.sendMatchTimesBuy=function(){var t=HawkProtocolManager.newBuilder("JsProto.CSArenaDanMatchTimesBuyReq");e.Message.instance.send(e.Code.CS_ARENA_MATCH_TIMES_BUY_C,t,!0)},t.prototype.kf_matchTimesBuyBack=function(e){this.model.DuanMatchTimes=e.getMatchTimes(),this.model.MatchTimesBuyCount=e.getMatchTimesBuyCount(),this.refreshMainUI(),this.panel.duanWeiMatch()},t.prototype.kf_seasonStageChange=function(e){this.panel&&this.panel.getIsShow()&&this.sendKFInfoMsg()},t.prototype.kf_pinnacleCoinBack=function(e){this.model.CSpinnacleCoin=e.getPinnacleCoin()},t.prototype.SetMatchStatus=function(e){this.model.MatchStatus==e},t.prototype.getModel=function(){return this.model},t.prototype.getCurStage=function(){return this.model.CurStage},t.prototype.getCSpinnacleCoin=function(){return this.model.CSpinnacleCoin},t.prototype.isShowMainIconEffect=function(){return this.model&&(this.model.DuanMatchTimes>0||this.model.CurentBattleTap==e.CSArenaStage.PRELIMINARY_OPEN||this.model.CurentBattleTap==e.CSArenaStage.TOP_8||this.model.CurentBattleTap==e.CSArenaStage.TOP_4||this.model.CurentBattleTap==e.CSArenaStage.TOP_2||this.model.CurentBattleTap==e.CSArenaStage.TOP_1)?!0:!1},t.prototype.getDuanByLevel=function(e){return this.model.getDuanByLevel(e)},t.prototype.getroleDuanStarByLevel=function(e){return this.model.getCurStarByLevel(e)},t}();e.KFController=t,__reflect(t.prototype,"foxgame.KFController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.curentTap=e.KFPanelType.Panel_1,i.curentBattleTap=e.CSArenaStage.DAN,i.matchEnemyInfo=null,i.arenaRankDp=new eui.ArrayCollection,i.lastRemainTime=-1,i.kuafuAwdDp=new eui.ArrayCollection,i.popularRankDp=new eui.ArrayCollection,i.myFightInfoDp=new eui.ArrayCollection,i.otherFightInfoDp=new eui.ArrayCollection,i.shopDataCollection=new eui.ArrayCollection,i.mobaiAwdCollection=new eui.ArrayCollection,i.matchStatus=e.MatchType.Wait,i.pinCoinChangeEvt=new egret.Event(e.KFConst.PinnacleCoinChange),i.csStageChangeEvt=new egret.Event(e.KFConst.CsStageChange),i}return __extends(i,t),Object.defineProperty(i.prototype,"CurentTap",{get:function(){return this.curentTap},set:function(e){this.curentTap=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CsArenaInfo",{get:function(){return this.csInfo?this.csInfo.getCsArenaInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CsSeasonInfo",{get:function(){return null!=this.CsArenaInfo?this.CsArenaInfo.getSeasonInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CsPlayerInfo",{get:function(){return null!=this.CsArenaInfo?this.CsArenaInfo.getPlayerInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MatchTimesBuyCount",{get:function(){return null!=this.CsArenaInfo?this.CsArenaInfo.getMatchTimesBuyCount():-1},set:function(e){this.CsArenaInfo.setMatchTimesBuyCount(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CurentBattleTap",{get:function(){return null!=this.CsSeasonInfo?this.CsSeasonInfo.getStage():this.curentBattleTap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DayOfWeek",{get:function(){return this.CsArenaInfo?this.CsArenaInfo.getDayOfWeek():1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CSpinnacleCoin",{get:function(){return this.CsArenaInfo?this.CsArenaInfo.getPinnacleCoin():-1},set:function(e){this.CsArenaInfo.getPinnacleCoin()!=e&&(this.CsArenaInfo.setPinnacleCoin(e),this.dispatchEvent(this.pinCoinChangeEvt))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"BattleInfo",{get:function(){return this.battleInfo},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CsInfo",{get:function(){return this.csInfo},set:function(e){this.csInfo=e,this.checkStageChange(e)},enumerable:!0,configurable:!0}),i.prototype.checkStageChange=function(e){(null==this.csInfo||e&&e.getCsArenaInfo()&&e.getCsArenaInfo().getSeasonInfo()&&this.csInfo.getCsArenaInfo().getSeasonInfo().getStage()!=e.getCsArenaInfo().getSeasonInfo().getStage())&&this.dispatchEvent(this.csStageChangeEvt)},Object.defineProperty(i.prototype,"MatchEnemyInfo",{get:function(){return this.matchEnemyInfo},set:function(e){this.matchEnemyInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DanStar",{get:function(){return null!=this.CsPlayerInfo?this.CsPlayerInfo.getDanStar():-1},set:function(e){this.CsPlayerInfo.setDanStar(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"PreliminaryIntegral",{get:function(){return null!=this.CsPlayerInfo?this.CsPlayerInfo.getPreliminaryIntegral():void 0},set:function(e){this.CsPlayerInfo.setPreliminaryIntegral(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DuanNum",{get:function(){return null!=this.CsPlayerInfo?Math.floor(this.DanStar/e.KFConst.EachDanLevel):-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DuanName",{get:function(){return this.DuanNum>=0?e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[this.DuanNum]:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CurDuanStar",{get:function(){return null!=this.CsPlayerInfo?this.DanStar%e.KFConst.EachDanLevel:3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DuanMatchTimes",{get:function(){return null!=this.CsArenaInfo?this.CsArenaInfo.getMatchTimes():-1},set:function(e){this.CsArenaInfo.setMatchTimes(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ArenaRankDp",{get:function(){return this.arenaRankDp},set:function(e){this.arenaRankDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Kf_chusaiRemainTime",{get:function(){return this.CsSeasonInfo?this.CsSeasonInfo.getRemainingTime():-1},set:function(e){this.CsSeasonInfo&&this.CsSeasonInfo.setRemainingTime(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"FinalsInfo",{get:function(){return this.CsSeasonInfo?this.CsSeasonInfo.getFinalsInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"TopInfo",{get:function(){return this.FinalsInfo?this.FinalsInfo.getTopInfo():null},enumerable:!0,configurable:!0}),i.prototype.getFightGroup=function(e){if(this.TopInfo){var t=[];for(var i in this.TopInfo){var n=this.TopInfo[i];if(n.getStage()==e&&n.getFightGroup()&&n.getFightGroup().length>0)return t=this.TopInfo[i].getFightGroup()}}return null},Object.defineProperty(i.prototype,"MyBetTarget",{get:function(){return this.FinalsInfo?this.FinalsInfo.getMyBetTarget():null},set:function(e){this.FinalsInfo.setMyBetTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MyThumbsUp",{get:function(){return this.FinalsInfo?this.FinalsInfo.getMyThumbsUp():null},set:function(e){this.FinalsInfo.setMyThumbsUp(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"JuePlayerList",{get:function(){var t=this.getFightGroup(e.CSArenaStage.TOP_8),i=[];if(t)for(var n=0;n<t.length;n++)t[n].getPlayer1()&&i.push(t[n].getPlayer1()),t[n].getPlayer2()?i.push(t[n].getPlayer2()):i.push(null);return i},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CanBetStatus",{get:function(){return this.CurentBattleTap==e.CSArenaStage.FINALS?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"FirstPlayer",{get:function(){return this.CsArenaInfo?this.CsArenaInfo.getFirstPlayer():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"FirstPlayerAvatar",{get:function(){return this.CsArenaInfo?this.CsArenaInfo.getFirstAvatar():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MyBetInfoRsp",{get:function(){return this.myBetInfoRsp},set:function(e){this.myBetInfoRsp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"KuafuAwdDp",{get:function(){return this.kuafuAwdDp},set:function(e){this.kuafuAwdDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"PopularInfoRsp",{get:function(){return this.popularInfoRsp},set:function(e){this.popularInfoRsp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"PopularRank",{get:function(){return this.PopularInfoRsp?this.PopularInfoRsp.getRankInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MySupportPlayer",{get:function(){return this.PopularInfoRsp?this.PopularInfoRsp.getMySupportPlayer():null},set:function(e){this.PopularInfoRsp.setMySupportPlayer(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"PopularRankDp",{get:function(){return this.popularRankDp},set:function(e){this.popularRankDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MyFightInfoRsp",{get:function(){return this.myFightInfoRsp},set:function(e){this.myFightInfoRsp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MyFightInfoDp",{get:function(){return this.myFightInfoDp},set:function(e){this.myFightInfoDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"OtherFightInfoRsp",{get:function(){return this.otherFightInfoRsp},set:function(e){this.otherFightInfoRsp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"OtherFightReportInfo",{get:function(){return this.OtherFightInfoRsp?this.OtherFightInfoRsp.getReportInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"OtherFightPlayer_1",{get:function(){return this.OtherFightReportInfo?this.OtherFightReportInfo.getPlayer1():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"OtherFightPlayer_2",{get:function(){return this.OtherFightReportInfo?this.OtherFightReportInfo.getPlayer2():null},enumerable:!0,configurable:!0}),i.prototype.getOtherFightInfoList=function(){var t=[],i=this.OtherFightReportInfo;if(i)for(var n=i.getWinPlayerIdentify(),o=0;o<e.KFConst.JueBattleSession;o++){var a=i.getPlayer1(),s=i.getPlayer2();a&&n&&n[o]&&a.getPlayerIdentify()==n[o]&&t.push(a),s&&n&&n[o]&&s.getPlayerIdentify()==n[o]&&t.push(s)}return t},Object.defineProperty(i.prototype,"OtherFightInfoDp",{get:function(){return this.otherFightInfoDp},set:function(e){this.otherFightInfoDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"KfRankInfo",{get:function(){return this.kfRankInfo},set:function(e){this.kfRankInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kfRankStage",{get:function(){return this.kfRankInfo?this.kfRankInfo.getStage():-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"KfRankList",{get:function(){return this.kfRankInfo?this.kfRankInfo.getRankInfo():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ShopDataCollection",{get:function(){return this.shopDataCollection},set:function(e){this.shopDataCollection=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MobaiAwdCollection",{get:function(){return this.mobaiAwdCollection},set:function(e){this.mobaiAwdCollection=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"IsWoship",{get:function(){return this.CsArenaInfo?this.CsArenaInfo.getIsWoship():!1},set:function(e){this.CsArenaInfo.setIsWoship(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MatchStatus",{get:function(){return this.matchStatus},set:function(e){this.matchStatus=e},enumerable:!0,configurable:!0}),i.prototype.getStatusName=function(e){switch(this.CurStage){case 1:return e[0];case 2:return e[1];default:return e[2]}},i.prototype.timeToDate=function(t,i){var n="",o=new Date,a=new Date;o.setTime(t),a.setTime(i);var s=o.getFullYear(),r=o.getMonth()+1,l=o.getDate(),h=0==o.getHours()?"00":o.getHours().toString(),c=0==o.getMinutes()?"00":o.getMinutes().toString(),u=(o.getSeconds(),a.getFullYear()),p=a.getMonth()+1,g=a.getDate(),d=0==a.getHours()?"00":a.getHours().toString(),f=0==a.getMinutes()?"00":a.getMinutes().toString(),m=(a.getSeconds(),e.LanguageUtils.instance.getValue("NIAN")),y=e.LanguageUtils.instance.getValue("YUE"),I=e.LanguageUtils.instance.getValue("RI");return n=s+m+r+y+l+I+h+":"+c,n=s==u&&r==p&&l==g?n+"——"+d+":"+f:n+"——"+u+m+p+y+g+I+d+":"+f},i.prototype.getDuanByLevel=function(t){return Math.floor(t/e.KFConst.EachDanLevel)},i.prototype.getCurStarByLevel=function(t){return Math.floor(t%e.KFConst.EachDanLevel)},Object.defineProperty(i.prototype,"CurStage",{get:function(){var t=this.CurentBattleTap;switch(t){case e.CSArenaStage.DAN:return 1;case e.CSArenaStage.PRELIMINARY:case e.CSArenaStage.PRELIMINARY_OPEN:case e.CSArenaStage.PRELIMINARY_END:return 2;case e.CSArenaStage.FINALS:case e.CSArenaStage.TOP_8:case e.CSArenaStage.TOP_4:case e.CSArenaStage.TOP_2:case e.CSArenaStage.TOP_1:return 3;case e.CSArenaStage.FINISH:return 0}},enumerable:!0,configurable:!0}),i.prototype.duanWeiRedPointPreCondition=function(){return this.curentBattleTap==e.CSArenaStage.DAN&&this.DuanMatchTimes>0?!0:!1},i.prototype.chuRedPointPreCondition=function(){return this.curentBattleTap==e.CSArenaStage.PRELIMINARY_OPEN?!0:!1},i.prototype.mobaiRedPointPreCondition=function(){return null==this.firstPlayer||0!=this.IsWoship||1!=this.CurStage&&2!=this.CurStage?!1:!0},i.prototype.sentRankRedPointPreCondition=function(){return null==this.MyThumbsUp&&3==this.CurStage?!0:!1},i.prototype.jingCaiRedPointPreCondition=function(){return null==this.MyBetTarget&&this.curentBattleTap==e.CSArenaStage.FINALS?!0:!1},i.prototype.getRoleName=function(t,i){var n=t;return n.indexOf(".")>=0?n:e.LanguageUtils.instance.getValue("CSARENA_11",i)+n},i.prototype.setGoOn=function(t){this.isGoOnToBattle=t,t&&e.KFController.getInstance().refreshMainUI()},i.prototype.getGoOn=function(){return this.isGoOnToBattle},i}(egret.EventDispatcher);e.KFModel=t,__reflect(t.prototype,"foxgame.KFModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/kuaFuBattle/KuaFuMainSkin.exml","kuafuLiansaiGroup")||this;return i.model=e,i.isMask=!1,i.isMaskdown=!0,i.setIsShowTween(!1),i.adaptionType=1,i.setRegisterTick(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.model.CurentTap=e.KFPanelType.Panel_1,e.KFController.getInstance().sendKFInfoMsg(),this.addLister(),this.doScreenAdaptation(),41==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=0,App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.addLister=function(){var e=this.getTapBtnList();if(e)for(var t=0;t<e.length;t++)e[t]&&e[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListHandler,this);this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeH,this)},i.prototype.removeLister=function(){var e=this.getTapBtnList();
if(e)for(var t=0;t<e.length;t++)e[t]&&e[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListHandler,this);this.ui.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeH,this)},i.prototype.clickTestHandler=function(t){e.KFController.getInstance().test()},i.prototype.clickListHandler=function(e){var t=this.getTapBtnList(),i=t.indexOf(e.target),n=1;switch(i){case 0:n=1;break;case 1:n=2;break;case 2:n=3;break;case 3:n=4}this.model.CurentTap!=n&&(this.model.CurentTap=n,this.refreshUI())},i.prototype.showHook=function(){t.prototype.showHook.call(this),this.refreshUI(),this.ui.currency.refresh()},i.prototype.helpHandler=function(t){var i;if(this.model.CurentTap==e.KFPanelType.Panel_4)return i="LIANGSHAIMOBAI",void e.HelpController.getInstance().showPanel(i);var n=this.model.CurStage;1==n&&(i="LIANGSHAIDUANWEISHAI"),2==n&&(i="LIANGSHAICHUSHAI"),(3==n||0==n)&&(i="LIANGSHAIJUESHAI"),e.HelpController.getInstance().showPanel(i)},i.prototype.refreshUI=function(){null!=this.model.CsInfo&&(this.showPanelByTap(),this.refreshTabBtn())},i.prototype.showPanelByTap=function(){var t=this.model.CurentTap;switch(this.resetGroup(),t){case e.KFPanelType.Panel_1:this.showDianFengSaiCheng();break;case e.KFPanelType.Panel_2:this.showSaiJiAward();break;case e.KFPanelType.Panel_3:this.showShop();break;case e.KFPanelType.Panel_4:this.showMobai()}},i.prototype.resetGroup=function(){this.ui.comGroup0.removeChildren(),this.ui.comGroup1.removeChildren(),this.ui.groupType0.visible=!0,this.ui.groupType1.visible=!1},i.prototype.refreshTabBtn=function(){for(var t=1;t<=this.getTapBtnList().length;t++)this.getTapBtnList()[t-1].currentState=this.model.CurentTap==e.KFPanelType["Panel_"+t]?"down":"up";this.ui.tapBtn2.label=this.model.getStatusName(e.LanguageUtils.instance.getValue("CSARENA_20").split(",")),this.ui.tapBtn1.label=this.model.getStatusName(e.LanguageUtils.instance.getValue("CSARENA_33").split(",")),this.ui.redPoint1.visible=this.model.chuRedPointPreCondition()||this.model.duanWeiRedPointPreCondition()||this.model.jingCaiRedPointPreCondition()||this.model.sentRankRedPointPreCondition(),this.ui.redPoint4.visible=this.model.mobaiRedPointPreCondition()},i.prototype.showDianFengSaiCheng=function(){var t=this.model.CurStage;switch(t){case 1:(void 0==this.duanWeiSaiPanel||null==this.duanWeiSaiPanel)&&(this.duanWeiSaiPanel=new e.KFDuanWeiSaiPanel(this.model)),this.ui.comGroup0.addChild(this.duanWeiSaiPanel),this.duanWeiSaiPanel.refreshUI();break;case 2:(void 0==this.chuSaiPanel||null==this.chuSaiPanel)&&(this.chuSaiPanel=new e.KFChuSaiPanel(this.model)),this.ui.comGroup0.addChild(this.chuSaiPanel),this.chuSaiPanel.refreshUI();break;case 3:case 0:(void 0==this.jueSaiPanel||null==this.jueSaiPanel)&&(this.jueSaiPanel=new e.KFJueSaiPanel(this.model)),this.ui.comGroup0.addChild(this.jueSaiPanel),this.jueSaiPanel.refreshUI()}},i.prototype.showSaiJiAward=function(){(null==this.saiJiAwardPanel||void 0==this.saiJiAwardPanel)&&(this.saiJiAwardPanel=new e.KFSaiJiAwardPanel(this.model)),this.ui.comGroup0.addChild(this.saiJiAwardPanel),this.saiJiAwardPanel.refreshUI()},i.prototype.showShop=function(){this.ui.groupType0.visible=!1,this.ui.groupType1.visible=!0,(null==this.shopPanel||void 0==this.shopPanel)&&(this.shopPanel=new e.KFShopPanel(this.model)),this.ui.comGroup1.addChild(this.shopPanel),this.shopPanel.refreshUI()},i.prototype.showMobai=function(){(null==this.mobaiPanel||void 0==this.mobaiPanel)&&(this.mobaiPanel=new e.KFMobaiPanel(this.model)),this.ui.comGroup0.addChild(this.mobaiPanel),this.mobaiPanel.refreshUI()},i.prototype.tickHook=function(e){this.chuSaiPanel&&this.chuSaiPanel.parent&&this.chuSaiPanel.tickHook(),this.mobaiPanel&&this.mobaiPanel.parent&&this.mobaiPanel.tickHook(),this.jueSaiPanel&&this.jueSaiPanel.parent&&this.jueSaiPanel.tickHook(e)},i.prototype.backHandler=function(){this.model.setGoOn(!1),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"KFMainPanel",tag:"getCloseBtn",battleType:e.BattleType.CS_ARENA_DAN}),this.close()},i.prototype.closeH=function(t){this.model.setGoOn(!1),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"KFMainPanel",tag:"getCloseBtn",battleType:e.BattleType.CS_ARENA_DAN}),this.close()},i.prototype.readyDestroy=function(){this.resetGroup(),null!=this.mobaiPanel&&(this.mobaiPanel.closeUI(),this.mobaiPanel=null),null!=this.duanWeiSaiPanel&&(this.duanWeiSaiPanel.closeUI(),this.duanWeiSaiPanel=null),null!=this.chuSaiPanel&&(this.chuSaiPanel.closeUI(),this.chuSaiPanel=null),null!=this.jueSaiPanel&&(this.jueSaiPanel.closeUI(),this.jueSaiPanel=null),this.saiJiAwardPanel=null,null!=this.shopPanel&&(this.shopPanel.closeUI(),this.shopPanel=null),this.removeLister(),this.model.MatchStatus==e.MatchType.Get?e.KFController.getInstance().kf_challange():this.model.MatchStatus==e.MatchType.Search&&e.KFController.getInstance().sendCancleMatchBack()},i.prototype.duanWeiMatch=function(){this.duanWeiSaiPanel&&this.duanWeiSaiPanel.parent&&this.duanWeiSaiPanel.clickMatch()},i.prototype.getTapBtnList=function(){for(var t=[],i=1;i<=e.KFConst.PanelTapLength;i++)t.push(this.ui["tapBtn"+i]);return t},i}(e.BasePanel);e.KFMainPanel=t,__reflect(t.prototype,"foxgame.KFMainPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SaiJiAwardItem",Log.trace("多少次了"),e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addLister()},i.prototype.addLister=function(){for(var e=0;e<this.iconList.length;e++)this.iconList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.init=function(){this.initIconList()},i.prototype.initIconList=function(){this.iconList=[],this.iconList.push(this.icon_0,this.icon_1,this.icon_2,this.icon_3)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refreshAwdList()},i.prototype.refreshAwdList=function(){var t=e.KFController.getInstance().getCurStage();switch(this.duanGroup.visible=this.chuImage.visible=this.jueImage.visible=!1,t){case 1:this.refreshStage_1();break;case 2:this.refreshStage_2();break;case 3:case 0:this.refreshStage_3()}},i.prototype.refreshStage_1=function(){for(var t=this.data,i=t.awards,n=0;n<i.length;n++)this.iconList[n].setItem(Number(i[n][1]),Number(i[n][2]));this.duanGroup.visible=!0;var o=t.segment-1;this.duanImage.source="kfDuan_"+o+"_png",this.duanTxt.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[o]},i.prototype.refreshStage_2=function(){for(var t=this.data,i=t.awards,n=0;n<i.length;n++)this.iconList[n].setItem(Number(i[n][1]),Number(i[n][2]));this.chuImage.visible=!0;var o=t.id-1;this.chuImage.source=e.KFConst.ChuSaiAwdRankSource[o]+"_png"},i.prototype.refreshStage_3=function(){for(var t=this.data,i=t.awards,n=0;n<i.length;n++)this.iconList[n].setItem(Number(i[n][1]),Number(i[n][2]));this.jueImage.visible=!0;var o=t.id-1;this.jueImage.source=e.KFConst.JueSaiAwdRankSource[o]+"_png"},i.prototype.closeUI=function(){},i}(eui.ItemRenderer);e.KFSaiJiAwardItem=t,__reflect(t.prototype,"foxgame.KFSaiJiAwardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="SaiJiAwardSkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addLister()},i.prototype.init=function(){this.initScrollerList()},i.prototype.initScrollerList=function(){this.list.itemRenderer=e.KFSaiJiAwardItem,this.list.dataProvider=this.model.KuafuAwdDp,this.sList.scrollPolicyH="ScrollPolicy.OFF",this.sList.bounces=!1,this.sList.viewport.scrollV=0},i.prototype.addLister=function(){},i.prototype.refreshUI=function(){var t=e.LanguageUtils.instance.getValue("CSARENA_1");this.statusTxt.text=this.model.getStatusName(t.split(",")),this.refreshBetweenTime(),this.refreshAwdList()},i.prototype.refreshBetweenTime=function(){var t=this.model.CsSeasonInfo;this.battleTime.text=e.LanguageUtils.instance.getValue("CSARENA_37")+this.model.timeToDate(t.getBeginDate(),t.getEndDate())},i.prototype.refreshAwdList=function(){var e=this.model.CurStage;switch(e){case 1:this.refreshAwd_1();break;case 2:this.refreshAwd_2();break;case 3:case 0:this.refreshAwd_3()}},i.prototype.refreshAwd_1=function(){var t=e.JsonDataManager.instance.csSegmentAward;this.model.KuafuAwdDp.replaceAll(t)},i.prototype.refreshAwd_2=function(){var t=e.JsonDataManager.instance.csPreliminaryAward;this.model.KuafuAwdDp.replaceAll(t)},i.prototype.refreshAwd_3=function(){var t=e.JsonDataManager.instance.csFinalsAward;this.model.KuafuAwdDp.replaceAll(t)},i.prototype.closeHook=function(){},i}(eui.Component);e.KFSaiJiAwardPanel=t,__reflect(t.prototype,"foxgame.KFSaiJiAwardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="KFBattleReportItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},i.prototype.init=function(){},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data.rankItem,n=this.data.index+1,o=i?!0:!1;this.groupTp_1.visible=o,this.groupTp_2.visible=!o,o&&(this.indexTxt.text=e.LanguageUtils.instance.getValue("CSARENA_2",n),this.winerName.text=e.KFController.getInstance().getModel().getRoleName(i.getPlayerName(),i.getServerId()),this.winerName.textColor=this.data.tColor)},i.prototype.closeUI=function(){},i}(eui.ItemRenderer);e.KFBattleReportItem=t,__reflect(t.prototype,"foxgame.KFBattleReportItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i){var n=t.call(this,"resource/skins/kuaFuBattle/KFBattleReportSkin.exml",null)||this;return n.setIsTouchClose(!0),n.setIsShowBackBtn(!1),n.model=e,n.groupIdentify=i,n}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.showHook=function(){e.KFController.getInstance().sendOtherFightInfo(this.groupIdentify),this.refreshUI()},i.prototype.addLister=function(){},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.KFBattleReportItem,this.ui.list.dataProvider=this.model.OtherFightInfoDp,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.setInitData=function(e){this.groupIdentify=e},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.refreshUI=function(){return null==this.model.OtherFightInfoRsp?void this.resetUI():(this.refreshList(),this.refreshPlayerName(),void this.refreshScore())},i.prototype.resetUI=function(){this.model.OtherFightInfoDp.replaceAll([]),this.ui.leftName.text=e.LanguageUtils.instance.getValue("CSARENA_30"),this.ui.rightName.text=e.LanguageUtils.instance.getValue("CSARENA_30"),this.ui.scoreNum.text="0 m 0",this.ui.leftImg.source="",this.ui.rightImg.source=""},i.prototype.refreshPlayerName=function(){var t=this.model.OtherFightPlayer_1,i=this.model.OtherFightPlayer_2;this.ui.leftName.text=null!=t?this.model.getRoleName(t.getPlayerName(),t.getServerId()):e.LanguageUtils.instance.getValue("CSARENA_30"),this.ui.rightName.text=null!=i?this.model.getRoleName(i.getPlayerName(),i.getServerId()):e.LanguageUtils.instance.getValue("CSARENA_30")},i.prototype.refreshScore=function(){var e=0,t=0,i=this.model.OtherFightReportInfo;if(i){var n=i.getWinPlayerIdentify(),o=this.model.OtherFightPlayer_1,a=this.model.OtherFightPlayer_1;if(n&&(o||a))for(var s=0;s<n.length;s++)o&&o.getPlayerIdentify()==n[s]?e++:t++}this.ui.scoreNum.text=e+" m "+t,this.ui.leftImg.source="",this.ui.rightImg.source="",(e>=3||t>=3)&&(this.ui.leftImg.source=e>=3?"kfsheng":"kffu",this.ui.rightImg.source=t>=3?"kfsheng":"kffu")},i.prototype.refreshList=function(){for(var e=this.model.getOtherFightInfoList(),t=this.model.OtherFightReportInfo,i=t?t.getWinPlayerIdentify():[],n=this.model.OtherFightPlayer_1,o=(this.model.OtherFightPlayer_1,[]),a=0;a<e.length;a++){var s=n.getPlayerIdentify()==i[a]?1111274:2227971;o.push({rankItem:e[a],index:a,tColor:s})}this.model.OtherFightInfoDp.replaceAll(o)},i}(e.BasePanel);e.KFBattleReportPanel=t,__reflect(t.prototype,"foxgame.KFBattleReportPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i){var n=t.call(this,"resource/skins/kuaFuBattle/KFBattleResuleSkin.exml",null)||this;return n.iCount=0,n.model=e,n.battleInfo=i,n.batleType=i.battleType,n}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.initListener()},i.prototype.initUI=function(){this.mytimer=new egret.Timer(1e3,0)},i.prototype.initListener=function(){switch(this.mytimer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.batleType){case e.BattleType.CS_ARENA_DAN:this.ui.sureBtn.visible=!0,this.ui.countDownFont0.visible=!0,this.ui.okBtn.visible=!1,this.ui.goOnBtn.visible=!1,this.ui.countDownFont2.visible=!1,this.ui.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sureFunc,this);break;case e.BattleType.CS_ARENA_PRELIMINARY:this.ui.sureBtn.visible=!1,this.ui.countDownFont0.visible=!1,this.ui.okBtn.visible=!0,this.ui.goOnBtn.visible=!0,this.ui.countDownFont2.visible=!0,this.ui.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sureFunc,this),this.ui.goOnBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goOnFunc,this)}},i.prototype.showHook=function(){switch(this.iCount=3,this.mytimer.start(),this.refreshAwd(),this.refreshBG_gray(),this.ui.chuSaiGroup.visible=this.ui.duanWeiGroup.visible=!1,this.batleType){case e.BattleType.CS_ARENA_DAN:this.ui.duanWeiGroup.visible=!0,this.ui.starAddNum.text=this.battleInfo.awards.getSegmentStar()+"",this.showAni();break;case e.BattleType.CS_ARENA_PRELIMINARY:this.ui.chuSaiGroup.visible=!0,this.ui.scoreAddNum.text=this.battleInfo.awards.getIntegral()+"",1==this.battleInfo.result?this.ui.winStreakTxt.text=e.LanguageUtils.instance.getValue("CSARENA_3",this.battleInfo.winningTimes):this.ui.winStreakTxt.text=e.LanguageUtils.instance.getValue("CSARENA_4")}},i.prototype.showAni=function(){var t=this.model.DanStar-this.battleInfo.awards.getSegmentStar(),i=this.model.getDuanByLevel(t),n=this.model.getCurStarByLevel(t),o=this.model.DuanNum,a=this.model.CurDuanStar;this.ui.duanOldImg.source="kfDuan_"+i+"_png";for(var s=0;s<this.starList.length;s++)this.starList[s].openToLight(n>s?!0:!1);this.battleInfo.awards.getSegmentStar()<0?a==e.KFConst.EachDanLevel-1?this.showStarDown1(i,o,a):this.showStarDown2(n-1):0==this.battleInfo.awards.getSegmentStar()||(0==a?this.showStarUp1(i,o,a):this.showStarUp2(a-1))},i.prototype.showDuanAni=function(e,t,i){var n=this;void 0===i&&(i=null),e!=t&&(this.ui.duanCurImg.source="kfDuan_"+t+"_png",TweenMax.to(this.ui.duanOldImg,.3,{alpha:0,ease:Cubic.easeOut}),TweenMax.to(this.ui.duanCurImg,.3,{onComplete:function(){TweenMax.to(n.ui.duanCurImg,.2,{alpha:1,onComplete:function(){i&&i()},ease:Cubic.easeIn})}}))},i.prototype.showStarDown1=function(e,t,i){var n=this;this.showDuanAni(e,t,function(){for(var e=0;e<n.starList.length;e++)n.starList[e].openToLight(i>e?!0:!1)})},i.prototype.showStarDown2=function(e){this.starList[e].lightToBlackAni()},i.prototype.showStarUp1=function(e,t,i){var n=this;this.showDuanAni(e,t,function(){for(var e=0;e<n.starList.length;e++)n.starList[e].openToLight(i>e?!0:!1)})},i.prototype.showStarUp2=function(e){this.starList[e].blackToLightAni()},i.prototype.refreshBG_gray=function(){1==this.battleInfo.result?(this.ui.resulTitle.source="shengliwenzi_png",this.ui.frameGroup.filters=[]):(this.ui.resulTitle.source="shibaiwenzi_png",this.ui.frameGroup.filters=e.GlobalUtil.grayFilter)},i.prototype.refreshAwd=function(){this.ui.icon_0.setItem(1026,this.battleInfo.awards.getPinnacleCoin()),this.ui.icon_1.setItem(1002,this.battleInfo.awards.getCoin())},i.prototype.timerFunc=function(t){this.iCount--,this.batleType==e.BattleType.CS_ARENA_DAN?(this.ui.countDownFont0.text=this.iCount.toString(),this.iCount<0&&this.sureFunc(null)):this.batleType==e.BattleType.CS_ARENA_PRELIMINARY&&(this.ui.countDownFont2.text=this.iCount.toString(),this.iCount<0&&this.goOnFunc(null))},i.prototype.sureFunc=function(e){this.mytimer.stop(),this.close(),this.model.setGoOn(!1)},i.prototype.goOnFunc=function(e){this.mytimer.stop(),this.close(),this.model.setGoOn(!0)},i.prototype.readyDestroy=function(){t.prototype.readyDestroy.call(this),this.mytimer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.ui.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sureFunc,this),this.mytimer.stop()},Object.defineProperty(i.prototype,"starList",{get:function(){return[this.ui.star_1,this.ui.star_2,this.ui.star_3,this.ui.star_4,this.ui.star_5]},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.KFBattleResultPanel=t,__reflect(t.prototype,"foxgame.KFBattleResultPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i){var n=t.call(this,"resource/skins/kuaFuBattle/KFBetSkin.exml",null)||this;return n.setIsTouchClose(!0),n.setIsShowBackBtn(!1),n.model=e,n.playInfo=i,n}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.showHook=function(){this.ui.nameTxt.text=this.model.getRoleName(this.playInfo.getPlayerName(),this.playInfo.getServerId());var t=e.JsonDataManager.instance.roleTemplate[this.playInfo.getPlayerItemId()];this.ui.myHeadImg.source=t.icon2,this.ui.oddsTxt.text="1:"+e.GlobalConfig.instance.getValue("CS_ARENA_BET_ODDS")},i.prototype.addLister=function(){this.ui.betBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBet,this),this.ui.maxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMax,this),this.ui.textInput.addEventListener(egret.Event.CHANGE,this.changeLabel,this)},i.prototype.removeLister=function(){this.ui.betBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBet,this),this.ui.maxBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMax,this),this.ui.textInput.removeEventListener(egret.Event.CHANGE,this.changeLabel,this)},i.prototype.initUI=function(){this.ui.textInput.type="input",this.ui.textInput.maxChars=10,this.ui.textInput.restrict="0-9",this.ui.textInput.text=this.getMax().toString()},i.prototype.clickBet=function(t){var i=Number(this.ui.textInput.text);i>0?(e.KFController.getInstance().sendBet(this.playInfo.getPlayerIdentify(),i),this.close()):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_48"))},i.prototype.clickMax=function(e){this.ui.textInput.text=this.getMax().toString()},i.prototype.changeLabel=function(e){this.ui.textInput.text&&Number(this.ui.textInput.text)>this.getMax()&&(this.ui.textInput.text=this.getMax().toString())},i.prototype.getMax=function(){var t=this.model.CsArenaInfo.getPinnacleCoin(),i=Number(e.GlobalConfig.instance.getValue("CS_ARENA_BET_MAX_MONEY"));return Math.min(t,i)},i.prototype.readyDestroy=function(){t.prototype.readyDestroy.call(this),this.removeLister()},i}(e.BasePanel);e.KFBetPanel=t,__reflect(t.prototype,"foxgame.KFBetPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/kuaFuBattle/KFMyBetSkin.exml",null)||this;return i.setIsTouchClose(!0),i.setIsShowBackBtn(!1),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.addLister()},i.prototype.showHook=function(){e.KFController.getInstance().sendMyBet(),this.refreshUI()},i.prototype.addLister=function(){},i.prototype.refreshUI=function(){null!=this.model.MyBetInfoRsp&&(this.refreshDescribe(),this.refreshHeadImg())},i.prototype.refreshDescribe=function(){var t=this.model.MyBetInfoRsp,i=t.getTarget(),n=e.LanguageUtils.instance.getValue("CSARENA_5");if(i){this.ui.myBetNum.text=t.getCapital()+"",this.ui.nameTxt.text=this.model.getRoleName(i.getPlayerName(),i.getServerId());var o=this.model.FirstPlayer;if(null!=i&&t.getCapital()>0)if(null==o)n=e.LanguageUtils.instance.getValue("CSARENA_6");else{var a=!1;a=i.getPlayerIdentify()==o.getPlayerIdentify()?!0:!1,n=a?e.LanguageUtils.instance.getValue("CSARENA_8",t.getAward()):e.LanguageUtils.instance.getValue("CSARENA_9")}}this.ui.desTxt.text=n},i.prototype.refreshHeadImg=function(){var t=this.model.MyBetInfoRsp,i="";if(t&&t.getTarget()){var n=e.JsonDataManager.instance.roleTemplate[t.getTarget().getPlayerItemId()];i=n.icon2}this.ui.myHeadImg.source=i},i}(e.BasePanel);e.KFMyBetPanel=t,__reflect(t.prototype,"foxgame.KFMyBetPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.isLight=!1,t.skinName="KFDuanWeiStarItem",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init()},t.prototype.blackToLightAni=function(){var e=this;this.largeStar.scaleX=this.largeStar.scaleY=.5,this.largeStar.visible=!0,this.largeStar.alpha=1,this.smallStar.visible=!1,TweenMax.to(this.largeStar,.2,{scaleX:1,scaleY:1,onComplete:function(){TweenMax.to(e.largeStar,.3,{scaleX:.4,scaleY:.4,onComplete:function(){TweenMax.to(e.largeStar,.1,{alpha:0,onComplete:function(){e.largeStar.visible=!1,e.smallStar.visible=!0,TweenMax.killTweensOf(e.largeStar)}})}})}})},t.prototype.lightToBlackAni=function(){this.largeStar.visible=!1,this.smallStar.visible=!0,TweenMax.to(this.smallStar,.5,{alpha:0})},t.prototype.openToLight=function(e){void 0===e&&(e=!0),this.largeStar.visible=!1,this.smallStar.visible=e},t.prototype.init=function(){this.largeStar.visible=!1,this.smallStar.visible=!1},t.prototype.$onRemoveFromStage=function(){TweenMax.killTweensOf(this.largeStar),e.prototype.$onRemoveFromStage.call(this)},t}(eui.Component);e.KFDuanWeiStarItem=t,__reflect(t.prototype,"foxgame.KFDuanWeiStarItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="KFRankItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},i.prototype.init=function(){},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=i.getRank();this.firstImg.visible=1==n,this.secondImg.visible=2==n,this.thirdImg.visible=3==n,this.rankBLabel.text=n+"";var o=e.KFController.getInstance().getCurStage(),a=e.KFController.getInstance().getModel(),s=i.getDanStar(),r=a.getDuanByLevel(s),l=a.getCurStarByLevel(s);this.nameLabel.text=a.getRoleName(i.getPlayerName(),i.getServerId()),1==o&&(this.contributeLabel.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[r]+e.LanguageUtils.instance.getValue("CSARENA_10",l)),2==o&&(this.contributeLabel.text=i.getPreliminaryIntegral().toString()),this.duanImg.source="kfDuan_"+r+"_png",this.starNum.text=l.toString()},i.prototype.closeUI=function(){},i}(eui.ItemRenderer);e.KFRankItem=t,__reflect(t.prototype,"foxgame.KFRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/kuaFuBattle/KFRankSkin.exml",null)||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.showHook=function(){e.KFController.getInstance().sendKFRankInfoMsg(),this.refreshUI()},i.prototype.addLister=function(){},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.KFRankItem,this.ui.list.dataProvider=this.model.ArenaRankDp,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.refreshUI=function(){null!=this.model.KfRankInfo&&(this.refreshList(),this.refreshMyRankInfo(),this.refreshTitle())},i.prototype.refreshList=function(){var e=this.model.KfRankList;this.model.ArenaRankDp.replaceAll(e)},i.prototype.refreshMyRankInfo=function(){var t=this.model.CsPlayerInfo,i=t.getRank();this.ui.firstImg.visible=1==i,this.ui.secondImg.visible=2==i,this.ui.thirdImg.visible=3==i,this.ui.rankBLabel.text=i+"",this.ui.nameLabel.text=this.model.getRoleName(t.getPlayerName(),t.getServerId());var n=e.KFController.getInstance().getCurStage(),o=e.KFController.getInstance().getModel(),a=t.getDanStar(),s=o.getDuanByLevel(a),r=o.getCurStarByLevel(a);1==n&&(this.ui.contributeLabel.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[s]+e.LanguageUtils.instance.getValue("CSARENA_10",r)),2==n&&(this.ui.contributeLabel.text=t.getPreliminaryIntegral().toString()),this.ui.duanImg.source="kfDuan_"+s+"_png",this.ui.starNum.text=r.toString()},i.prototype.refreshTitle=function(){var t=this.model.CurStage,i=e.LanguageUtils.instance.getValue("CSARENA_32").split(",");this.ui.scoreTitle.text=1==t?i[0]:i[1]},i}(e.BasePanel);e.KFRankPanel=t,__reflect(t.prototype,"foxgame.KFRankPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ArenaShopItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnExchange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchange,this),this.itemcell.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnIcon,this),this.jifenIcon.visible=!1,this.bayebiIcon.visible=!0},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=e.JsonDataManager.instance.itemTemplate,n=i[this.data.itemID];this.priceLabel.text=this.data.price,this.nameLabel.text=n.name,this.itemcell.setItem(this.data.itemID,1,!1,!1),this.bayebiIcon.source="dianfengbi_png",this.bayebiIcon.width=33,this.bayebiIcon.height=30},i.prototype.onBtnExchange=function(){return Number(this.data.price)>e.KFController.getInstance().getCSpinnacleCoin()?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_12")):void e.KFController.getInstance().sendPinnacleShopBuy(Number(this.data.itemID),1)},i.prototype.onBtnIcon=function(){var t=e.JsonDataManager.instance.itemTemplate,i=t[this.data.itemID];i.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(this.data.itemID):e.TipsController.getInstance().showItemTips(this.data.itemID)},i.prototype.onClose=function(){this.btnExchange.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchange,this),this.itemcell.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnIcon,this)},i}(eui.ItemRenderer);e.KFShopItem=t,__reflect(t.prototype,"foxgame.KFShopItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="KuaFuShopSkin",i.model=e,i.init(),i}return __extends(i,t),i.prototype.init=function(){this.initScrollerList()},i.prototype.initScrollerList=function(){for(var t=new eui.ArrayCollection,i=0,n=10;n>i;i++)t.addItem({});this.shopScroll.scrollPolicyH="ScrollPolicy.OFF",this.shopScroll.bounces=!1,this.shopItemList.itemRenderer=e.KFShopItem,this.shopItemList.dataProvider=this.model.ShopDataCollection},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addLister()},i.prototype.refreshUI=function(){var t=e.JsonDataManager.instance.csShop;this.model.ShopDataCollection.source=t,this.model.ShopDataCollection.refresh(),this.dfbNumTxt.text=this.model.CSpinnacleCoin.toString();var i=e.LanguageUtils.instance.getValue("CSARENA_22");i=i.replace("{br}","\n"),i=i.replace("{br}","\n"),this.describeTxt.textFlow=(new egret.HtmlTextParser).parser(i),this.describeTxt.lineSpacing=10},i.prototype.addLister=function(){this.model.addEventListener(e.KFConst.PinnacleCoinChange,this.pinCoinChangeEvt,this)},i.prototype.removeLister=function(){this.model.removeEventListener(e.KFConst.PinnacleCoinChange,this.pinCoinChangeEvt,this)},i.prototype.pinCoinChangeEvt=function(e){this.dfbNumTxt.text=this.model.CSpinnacleCoin.toString()},i.prototype.closeUI=function(){if(this.removeLister(),this.shopItemList&&this.shopItemList.numChildren>0)for(var e=0;e<this.shopItemList.numChildren;e++)this.shopItemList.getChildAt(e).onClose()},i}(eui.Component);e.KFShopPanel=t,__reflect(t.prototype,"foxgame.KFShopPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t,i){void 0===i&&(i=null);var n=e.call(this,"resource/skins/kuaFuBattle/KFSmackDownSkin.exml",null)||this;return n.idx=0,n.idxMax=2,n.timeOutIdx=-1,n.setIsShowBackBtn(!1),n.setIsTouchClose(!1),n.isMask=!1,n.model=t,n.showBack=i,n}return __extends(t,e),t.prototype.initHook=function(){e.prototype.initHook.call(this),this.doScreenAdaptation()},t.prototype.showHook=function(){this.timeOutIdx=egret.setTimeout(function(){this.openBattleAni()},this,500)},t.prototype.openBattleAni=function(){var e=this;TweenMax.to(this.ui.frameUp,.2,{onComplete:function(){TweenMax.to(e.ui.frameUp,.5,{y:e.ui.frameUp.y-e.ui.frameUp.height,onComplete:function(){e.aniBack()},ease:Cubic.easeOut})}}),TweenMax.to(this.ui.frameDown,.2,{onComplete:function(){TweenMax.to(e.ui.frameDown,.5,{y:e.ui.frameDown.y+e.ui.frameDown.height,onComplete:function(){e.aniBack()},ease:Cubic.easeOut})}})},t.prototype.aniBack=function(){this.idx++,this.idx>=this.idxMax&&(null!=this.showBack&&this.showBack(),this.close())},t.prototype.readyDestroy=function(){e.prototype.readyDestroy.call(this),egret.clearTimeout(this.timeOutIdx),this.timeOutIdx=-1,TweenMax.killTweensOf(this.ui.frameUp),TweenMax.killTweensOf(this.ui.frameDown)},t}(e.BasePanel);e.KFSmackDownPanel=t,__reflect(t.prototype,"foxgame.KFSmackDownPanel")}(foxgame||(foxgame={}));var App=function(){function e(){}return e.getResourceUtils=function(){return null==this.resourceUtils&&(this.resourceUtils=new ResourceUtils),this.resourceUtils},e.DisplayUtils=function(){return DisplayUtils.getInstance()},e.TimerManager=function(){return TimerManager.getInstance()},e.DebugUtils=function(){return DebugUtils.getInstance()},e.GuideUtils=function(){return GuideUtils.getInstance()},e.LittleLoading=function(){return LittleLoading.getInstance()},e.SoundManager=function(){return SoundManager.getInstance()},Object.defineProperty(e,"MessageCenter",{get:function(){return MessageCenter.getInstance(0)},enumerable:!0,configurable:!0}),e.StarlingSwfFactory=function(){return StarlingSwfFactory.getInstance()},e.DeviceUtils=function(){return DeviceUtils.getInstance()},e.init=function(){e.DebugUtils().isOpen(!0),e.LittleLoading().init(),SoundManager.getInstance().init()},e}();__reflect(App.prototype,"App");var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="KFMobaiAwardInfoItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addLister()},i.prototype.init=function(){},i.prototype.addLister=function(){for(var e,t=this.getAwardIconList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removeLister=function(){for(var e,t=this.getAwardIconList(),i=t.length,n=0;i>n;n++)e=t[n],e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refreshAwdList(),this.numImg.text=this.data.day.toString()},i.prototype.refreshAwdList=function(){for(var e=this.getAwardIconList(),t=this.data,i=t.firstServerAwards,n=0;n<i.length;n++)e[n].setItem(Number(i[n][1]),Number(i[n][2]),!1)},i.prototype.onClose=function(){this.removeLister()},i.prototype.getAwardIconList=function(){var e=[];return e.push(this.item_0),e.push(this.item_1),e.push(this.item_2),e.push(this.item_3),e.push(this.item_4),e},i}(eui.ItemRenderer);
e.KFMobaiAwardInfoItem=t,__reflect(t.prototype,"foxgame.KFMobaiAwardInfoItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/kuaFuBattle/KFMobaiAwardInfoSkin.exml",null)||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI()},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.KFMobaiAwardInfoItem,this.ui.list.dataProvider=this.model.MobaiAwdCollection,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.showHook=function(){this.refreshUI()},i.prototype.refreshUI=function(){this.refreshList(),this.refreshTitleDes()},i.prototype.refreshList=function(){var t=e.JsonDataManager.instance.csWorshipAward;this.model.MobaiAwdCollection.replaceAll(t)},i.prototype.refreshTitleDes=function(){var t=this.model.FirstPlayer,i=e.LanguageUtils.instance.getValue("CSARENA_41"),n=e.LanguageUtils.instance.getValue("CSARENA_43");t&&(i=this.model.getRoleName(t.getPlayerName(),t.getServerId()),this.model.CsPlayerInfo&&this.model.CsPlayerInfo.getServerId()==t.getServerId()&&(n=e.LanguageUtils.instance.getValue("CSARENA_42"))),this.ui.winerInfo.text=i,n=n.replace("{br}","\n"),this.ui.decsText.textFlow=(new egret.HtmlTextParser).parser(n)},i.prototype.readyDestroy=function(){if(t.prototype.readyDestroy.call(this),this.ui.list&&this.ui.list.numChildren>0)for(var e=0;e<this.ui.list.numChildren;e++)this.ui.list.getChildAt(e).onClose()},i}(e.BasePanel);e.KFMobaiAwardInfoPanel=t,__reflect(t.prototype,"foxgame.KFMobaiAwardInfoPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="MyRecordItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},i.prototype.init=function(){},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data.rankItem,n=this.data.index,o="",a=e.LanguageUtils.instance.getValue("CSARENA_13").split(",");switch(this.data.stage){case e.CSArenaStage.TOP_8:o=a[0];break;case e.CSArenaStage.TOP_4:o=a[1];break;case e.CSArenaStage.TOP_2:o=a[2];break;case e.CSArenaStage.TOP_1:o=a[3]}this.numTxt.text=o+"　"+e.LanguageUtils.instance.getValue("CSARENA_2",n);var s=e.LanguageUtils.instance.getValue("CSARENA_30");null!=i&&(s=e.KFController.getInstance().getModel().getRoleName(i.getPlayerName(),i.getServerId())),this.nameTxt.text=s;var r=e.LanguageUtils.instance.getValue("CSARENA_14").split(",");this.resultTxt.text=1==this.data.result?r[0]:r[1]},i.prototype.closeUI=function(){},i}(eui.ItemRenderer);e.MyRecordItem=t,__reflect(t.prototype,"foxgame.MyRecordItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/kuaFuBattle/MyRecordSkin.exml",null)||this;return i.setIsTouchClose(!0),i.setIsShowBackBtn(!1),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.MyRecordItem,this.ui.list.dataProvider=this.model.MyFightInfoDp,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.showHook=function(){e.KFController.getInstance().sendMyFightInfo(),this.refreshUI()},i.prototype.refreshUI=function(){null!=this.model.MyFightInfoRsp&&this.refreshList()},i.prototype.refreshList=function(){for(var e=this.model.MyFightInfoRsp.getReportInfo(),t=this.model.MyFightInfoRsp.getMyIdentify(),i=[],n=1,o=0;o<e.length;o++)for(var a=e[o].getPlayer1(),s=e[o].getPlayer2(),r=void 0,l=e[o].getWinPlayerIdentify(),h=void 0,c=0;c<l.length;c++)h=a.getPlayerIdentify()==t?s:a,r=t==l[c]?1:0,n=c+1,i.push({rankItem:h,index:n,result:r,stage:e[o].getStage()});this.model.MyFightInfoDp.replaceAll(i)},i}(e.BasePanel);e.MyRecordPanel=t,__reflect(t.prototype,"foxgame.MyRecordPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.idx=0,i.hList=[],i.skinName="KFChuSaiSkin",i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){this.headGroup.mask=this.imgMask,this.showRankTxt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("CSARENA_15")),this.noGotDes.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("CSARENA_31")),this.hList=[this.head0,this.head1],this.awdList=[this.awd_0,this.awd_1,this.awd_2,this.awd_3],this.vsAni=new e.FoxAni(this.vsGroup),this.vsAni.play("dongtaiVS","ani",-1)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.refreshUI=function(){this.refreshMatchGroup(),this.refreshGotGroup(),this.refreshMyselfInfo(),this.refreshMyRank(),this.refreshBetweenTime(),this.refreshAwdList(),this.refreshRemainTime(),this.refreshMatch();var t=this.model.CsArenaInfo;this.myScore.text=this.model.PreliminaryIntegral.toString();var i=e.LanguageUtils.instance.getValue("CSARENA_14").split(",");this.myFightInfo.text=t.getPreliminaryWinTimes()+i[0]+t.getPreliminaryLoseTimes()+i[1],this.model.getGoOn()&&(this.model.setGoOn(!1),this.clickMatch(null))},i.prototype.addLister=function(){this.showRankTxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickRank,this),this.matchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMatch,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removeLister=function(){this.showRankTxt.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickRank,this),this.matchBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMatch,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.clickRank=function(t){e.KFController.getInstance().showRankPanel()},i.prototype.clickMatch=function(t){return this.model.CurentBattleTap!=e.CSArenaStage.PRELIMINARY_OPEN||this.model.Kf_chusaiRemainTime<=0?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_26")):this.model.DanStar<Number(e.GlobalConfig.instance.getValue("CS_ARENA_PRELIMINARY_SEGMENT_LIMIT"))?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_25")):(this.head0.x=0,this.head0.y=0,this.head1.x=0,this.head1.y=80,e.KFController.getInstance().sendMatchPlayer(),this.refreshMatch(),void this.playHeadAni())},i.prototype.playHeadAni=function(){var t=this;egret.Tween.get(this.hList[0]).to({y:-this.hList[0].height},200),egret.Tween.get(this.hList[1]).to({y:0},200).wait(300).call(function(){if(t.hList[0].y=t.hList[1].y+t.hList[1].height,egret.Tween.removeTweens(t.hList[0]),egret.Tween.removeTweens(t.hList[1]),t.hList.reverse(),t.model.MatchStatus!=e.MatchType.Get)t.hList[1].source="proHead2_"+Math.ceil(6*Math.random())+"_png",t.playHeadAni();else{var i=t.model.MatchEnemyInfo;if(null==i)t.hList[1].source="godlyEquipPanel.kfwenhao",t.model.MatchStatus=e.MatchType.Wait,t.refreshMatch(),egret.Tween.get(t.hList[0]).to({y:-t.hList[0].height},200),egret.Tween.get(t.hList[1]).to({y:0},200);else{e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_46"));var n=e.JsonDataManager.instance.roleTemplate[i.getPlayerItemId()];t.hList[1].source=n.icon2;var o=i.getDanStar(),a=t.model.getCurStarByLevel(o),s=t.model.getDuanByLevel(o);t.myDuanWeiTxt0.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[s]+e.LanguageUtils.instance.getValue("CSARENA_17",a),t.myPlayerName0.text=t.model.getRoleName(i.getPlayerName(),i.getServerId()),egret.Tween.get(t.hList[0]).to({y:-t.hList[0].height},200),egret.Tween.get(t.hList[1]).to({y:0},200).wait(300).call(function(){e.KFController.getInstance().kf_challange()},t,null)}}},this,null)},i.prototype.refreshMatchGroup=function(){var t=this.model.CurentBattleTap,i=!1,n=1;t==e.CSArenaStage.PRELIMINARY_OPEN&&(i=!0,n=2),t==e.CSArenaStage.PRELIMINARY_END&&(n=3),this.matchGroup.visible=i,this.stageDesImage.source="biaoyu"+n+"_png"},i.prototype.refreshGotGroup=function(){var t=!0;this.model.DanStar<Number(e.GlobalConfig.instance.getValue("CS_ARENA_PRELIMINARY_SEGMENT_LIMIT"))&&(t=!1),this.hasGotGroup.visible=t,this.noGotGroup.visible=!t},i.prototype.refreshMyselfInfo=function(){var t=this.model.CsPlayerInfo;if(t){var i=e.JsonDataManager.instance.roleTemplate[t.getPlayerItemId()];i&&(this.myHeadImg.source=i.icon2),this.myPlayerName.text=this.model.getRoleName(t.getPlayerName(),t.getServerId());var n=t.getDanStar(),o=this.model.getCurStarByLevel(n),a=this.model.getDuanByLevel(n);this.myDuanWeiTxt.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[a]+e.LanguageUtils.instance.getValue("CSARENA_17",o)}},i.prototype.tickHook=function(){if(this.model.CurentBattleTap==e.CSArenaStage.PRELIMINARY_OPEN){var t=this.model.Kf_chusaiRemainTime;t>0&&(this.remainTime.text=e.GlobalUtil.getTimeString(t/1e3,2))}},i.prototype.refreshMyRank=function(){if(null!=this.model.CsPlayerInfo){var t=this.model.CsPlayerInfo.getRank();this.myRank.text=t>0?e.LanguageUtils.instance.getValue("CSARENA_16",t):e.LanguageUtils.instance.getValue("WEISHANGBANG")}},i.prototype.refreshBetweenTime=function(){var t=this.model.CsSeasonInfo;this.battleTime.text=e.LanguageUtils.instance.getValue("CSARENA_38")+this.model.timeToDate(t.getBeginDate(),t.getEndDate())},i.prototype.refreshRemainTime=function(){var t=e.LanguageUtils.instance.getValue("CSARENA_36");this.model.CurentBattleTap==e.CSArenaStage.PRELIMINARY?t=e.LanguageUtils.instance.getValue("CSARENA_34"):this.model.CurentBattleTap==e.CSArenaStage.PRELIMINARY_END&&(t=e.LanguageUtils.instance.getValue("CSARENA_35")),this.remainTimeDes.text=t},i.prototype.refreshAwdList=function(){var t=e.JsonDataManager.instance.csPreliminaryAward,i=this.model.CsPlayerInfo.getRank(),n=this.model.CsPlayerInfo.getPreliminaryIntegral(),o=n>0?!0:!1;0>=i&&(i=e.KFConst.ChuSaiCanYuAwdRank);for(var a=0;a<t.length;a++){var s=t[a].rankStart,r=t[a].rankEnd;if(i>=s&&r>=i)for(var l=0;l<t[a].awards.length;l++)this.awdList[l].setItem(Number(t[a].awards[l][1]),Number(t[a].awards[l][2]))}this.awdDesTxt.text=o?e.LanguageUtils.instance.getValue("CSARENA_27"):e.LanguageUtils.instance.getValue("CSARENA_28")},i.prototype.refreshMatch=function(){this.model.MatchStatus==e.MatchType.Search?(this.matchBtn.visible=!1,this.redPoint.visible=!1):(this.matchBtn.visible=!0,this.redPoint.visible=this.model.chuRedPointPreCondition())},i.prototype.closeHook=function(){},i.prototype.closeUI=function(){this.removeLister(),egret.Tween.removeTweens(this.hList[0]),egret.Tween.removeTweens(this.hList[1]),null!=this.vsAni&&(this.vsAni.clear(),this.vsAni=null)},i}(eui.Component);e.KFChuSaiPanel=t,__reflect(t.prototype,"foxgame.KFChuSaiPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.idx=0,i.hList=[],i.skinName="KFDuanWeiSkin",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){this.showRankTxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickRank,this),this.matchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMatch,this),this.testShowStar.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickTest,this),this.testShowBattle.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickTestB,this),this.plusBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickAddTimes,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removeLister=function(){this.showRankTxt.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickRank,this),this.matchBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMatch,this),this.testShowStar.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickTest,this),this.testShowBattle.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickTestB,this),this.plusBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickAddTimes,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.initUI=function(){this.headGroup.mask=this.imgMask,this.showRankTxt.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("CSARENA_15")),this.hList=[this.head0,this.head1],this.starList=[this.star_1,this.star_2,this.star_3,this.star_4,this.star_5],this.awdList=[this.awd_0,this.awd_1,this.awd_2,this.awd_3],this.vsAni=new e.FoxAni(this.vsGroup),this.vsAni.play("dongtaiVS","ani",-1)},i.prototype.refreshUI=function(){this.refreshMyselfInfo(),this.refreshDuanStarInfo(),this.refreshTimes(),this.refreshMyRank(),this.refreshAwdList(),this.refreshBetweenTime(),this.refreshMatch()},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.clickRank=function(t){e.KFController.getInstance().showRankPanel()},i.prototype.clickTest=function(e){var t=Math.floor(Math.random()*this.starList.length);this.starList[t].blackToLightAni()},i.prototype.clickTestB=function(t){(null==this.showB||void 0==this.showB)&&(this.showB=new e.KFSmackDownPanel(this.model)),this.showB.show()},i.prototype.clickMatch=function(t){if(void 0===t&&(t=null),this.model.DuanMatchTimes<=0){var i=Number(e.GlobalConfig.instance.getValue("CS_ARENA_MATCH_TIMES_BUY_MAX_COUNT")),n=this.model.MatchTimesBuyCount,o=Number(e.GlobalConfig.instance.getValue("CS_ARENA_MATCH_TIMES_BUY_RADIX"))+Number(e.GlobalConfig.instance.getValue("CS_ARENA_MATCH_TIMES_BUY_RATIO"))*(n+1);if(i>n&&o<=e.PlayerService.instance.playerInfo.getGold()){var a=e.LanguageUtils.instance.getValue("CSARENA_24",o,i-n);return void e.PopUpController.getInstance().showTextPanel(a,this,e.KFController.getInstance().sendMatchTimesBuy)}return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_47"))}this.model.MatchStatus==e.MatchType.Wait&&(this.head0.x=0,this.head0.y=0,this.head1.x=0,this.head1.y=80,e.KFController.getInstance().sendMatchPlayer(),this.refreshMatch(),this.playHeadAni())},i.prototype.playHeadAni=function(){var t=this;egret.Tween.get(this.hList[0]).to({y:-this.hList[0].height},200),egret.Tween.get(this.hList[1]).to({y:0},200).wait(300).call(function(){if(t.hList[0].y=t.hList[1].y+t.hList[1].height,egret.Tween.removeTweens(t.hList[0]),egret.Tween.removeTweens(t.hList[1]),t.hList.reverse(),t.model.MatchStatus!=e.MatchType.Get)t.hList[1].source="proHead2_"+Math.ceil(6*Math.random())+"_jpg",t.playHeadAni();else{var i=t.model.MatchEnemyInfo;if(null==i)t.hList[1].source="kfwenhao_png",t.model.MatchStatus=e.MatchType.Wait,t.refreshMatch(),egret.Tween.get(t.hList[0]).to({y:-t.hList[0].height},200),egret.Tween.get(t.hList[1]).to({y:0},200);else{var n=e.JsonDataManager.instance.roleTemplate[i.getPlayerItemId()];t.hList[1].source=n.icon2;var o=i.getDanStar(),a=t.model.getCurStarByLevel(o),s=t.model.getDuanByLevel(o);t.myDuanWeiTxt0.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[s]+e.LanguageUtils.instance.getValue("CSARENA_17",a),t.myPlayerName0.text=t.model.getRoleName(i.getPlayerName(),i.getServerId()),egret.Tween.get(t.hList[0]).to({y:-t.hList[0].height},200),egret.Tween.get(t.hList[1]).to({y:0},200).wait(300).call(function(){e.KFController.getInstance().kf_challange()},t,null)}}},this,null)},i.prototype.refreshMyselfInfo=function(){var t=this.model.CsPlayerInfo;if(t){var i=e.JsonDataManager.instance.roleTemplate[t.getPlayerItemId()];i&&(this.myHeadImg.source=i.icon2),this.myPlayerName.text=this.model.getRoleName(t.getPlayerName(),t.getServerId());var n=t.getDanStar(),o=this.model.getCurStarByLevel(n),a=this.model.getDuanByLevel(n);this.myDuanWeiTxt.text=e.LanguageUtils.instance.getValue("CSARENA_21").split(",")[a]+e.LanguageUtils.instance.getValue("CSARENA_17",o)}},i.prototype.refreshDuanStarInfo=function(){var t=this.model.CurDuanStar;this.duanStarTxt.text=this.model.DuanName+e.LanguageUtils.instance.getValue("CSARENA_17",t);for(var i=0;i<this.starList.length;i++)this.starList[i].openToLight(t>i?!0:!1);this.duanImg.source="kfDuan_"+this.model.DuanNum+"_png"},i.prototype.clickAddTimes=function(t){void 0===t&&(t=null);var i=Number(e.GlobalConfig.instance.getValue("CS_ARENA_MATCH_TIMES_BUY_MAX_COUNT")),n=this.model.MatchTimesBuyCount,o=Number(e.GlobalConfig.instance.getValue("CS_ARENA_MATCH_TIMES_BUY_RADIX"))+Number(e.GlobalConfig.instance.getValue("CS_ARENA_MATCH_TIMES_BUY_RATIO"))*(n+1);if(o>e.PlayerService.instance.playerInfo.getGold())return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");if(n>=i)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_23"));var a=e.LanguageUtils.instance.getValue("CSARENA_24",o,i-n);e.PopUpController.getInstance().showTextPanel(a,this,e.KFController.getInstance().sendMatchTimesBuy)},i.prototype.refreshTimes=function(){this.timesTxt.text=this.model.DuanMatchTimes+"/"+e.GlobalConfig.instance.getValue("CS_ARENA_DAN_DAY_COUNT")},i.prototype.refreshMyRank=function(){if(null!=this.model.CsPlayerInfo){var t=this.model.CsPlayerInfo.getRank();this.myRank.text=t>0?e.LanguageUtils.instance.getValue("CSARENA_16",t):e.LanguageUtils.instance.getValue("WEISHANGBANG")}},i.prototype.refreshBetweenTime=function(){var t=this.model.CsSeasonInfo;this.battleTime.text=e.LanguageUtils.instance.getValue("CSARENA_37")+this.model.timeToDate(t.getBeginDate(),t.getEndDate())},i.prototype.refreshAwdList=function(){for(var t=e.JsonDataManager.instance.csSegmentAward,i=this.model.DuanNum,n=0;n<t.length;n++)if(i==t[n].segment-1)for(var o=0;o<t[n].awards.length;o++)this.awdList[o].setItem(Number(t[n].awards[o][1]),Number(t[n].awards[o][2]))},i.prototype.refreshMatch=function(){this.model.MatchStatus==e.MatchType.Search?(this.matchBtn.visible=!1,this.redPoint.visible=!1):(this.matchBtn.visible=!0,this.redPoint.visible=this.model.duanWeiRedPointPreCondition())},i.prototype.closeUI=function(){this.removeLister(),egret.Tween.removeTweens(this.hList[0]),egret.Tween.removeTweens(this.hList[1]),null!=this.vsAni&&(this.vsAni.clear(),this.vsAni=null)},i}(eui.Component);e.KFDuanWeiSaiPanel=t,__reflect(t.prototype,"foxgame.KFDuanWeiSaiPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.oldTime=-1,i.oldColorIdx=0,i.curTextIndex=-1,i.hasFirstPlay=!1,i.skinName="KFJueSaiSkin",i.model=e,i}return __extends(i,t),i.prototype.initUI=function(){null==this.titleAni&&(this.titleAni=new e.FoxAni(this.aniGroup)),this.titleAni.play("zqwzdonghua","ani",-1),this.setBetGroupList(!1),this.hideAllLineGroup()},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){this.recordBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.betBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.sentRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.showBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.showBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this);var t=0;for(t=0;t<this.btnList.length;t++)this.btnList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListBtnHandler,this),this.betBtnList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListBtnHandler,this);for(t=1;3>=t;t++)for(var i=0;i<this["glassBtnList_"+t].length;i++)this["glassBtnList_"+t][i].addEventListener(egret.TouchEvent.TOUCH_TAP,this["clickGlass_"+t],this);this.model.addEventListener(e.KFConst.CsStageChange,this.stageChange,this)},i.prototype.removeLister=function(){this.recordBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.betBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.sentRank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.showBtn0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.showBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this);var t=0;for(t=0;t<this.btnList.length;t++)this.btnList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListBtnHandler,this),this.betBtnList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickListBtnHandler,this);for(t=1;3>=t;t++)for(var i=0;i<this["glassBtnList_"+t].length;i++)this["glassBtnList_"+t][i].removeEventListener(egret.TouchEvent.TOUCH_TAP,this["clickGlass_"+t],this);this.model.removeEventListener(e.KFConst.CsStageChange,this.stageChange,this)},i.prototype.refreshUI=function(){this.stageChange(),this.refreshNameBtnList(),this.refreshBetBtn(),this.refreshBetBtnList(),this.refreshLineAbout(),this.refreshGlass(),this.refreshRedPoint(),this.refreshBetweenTime()},i.prototype.clickGlass_1=function(t){var i=this.glassBtnList_1.indexOf(t.target),n="",o=this.model.getFightGroup(e.CSArenaStage.TOP_8);o&&o[i]&&(n=o[i].getGroupIdentify(),e.KFController.getInstance().showBattleReportPanel(n))},i.prototype.clickGlass_2=function(t){var i=this.glassBtnList_2.indexOf(t.target),n="",o=this.model.getFightGroup(e.CSArenaStage.TOP_4);o&&o[i]&&(n=o[i].getGroupIdentify(),e.KFController.getInstance().showBattleReportPanel(n))},i.prototype.clickGlass_3=function(t){var i=this.glassBtnList_3.indexOf(t.target),n="",o=this.model.getFightGroup(e.CSArenaStage.TOP_2);o&&o[i]&&(n=o[i].getGroupIdentify(),e.KFController.getInstance().showBattleReportPanel(n))},i.prototype.refreshNameBtnList=function(){for(var t,i=this.model.JuePlayerList,n=0;n<this.nameList.length;n++)t=i[n]?this.model.getRoleName(i[n].getPlayerName(),i[n].getServerId()):e.LanguageUtils.instance.getValue("CSARENA_30"),this.nameList[n].text=t,this.nameList[n].touchEnabled=!1},i.prototype.refreshBetBtn=function(){var e=!1;this.model.CanBetStatus&&(e=null==this.model.MyBetTarget?!0:!1),this.btnG_1.visible=e},i.prototype.refreshGlass=function(){this.glassGroup_1.visible=this.glassGroup_2.visible=this.glassGroup_3.visible=this.btnG_0.visible=!1,this.model.CurentBattleTap>=e.CSArenaStage.TOP_8&&(this.glassGroup_1.visible=!0),this.model.CurentBattleTap>=e.CSArenaStage.TOP_4&&(this.glassGroup_2.visible=!0),this.model.CurentBattleTap>=e.CSArenaStage.TOP_2&&(this.glassGroup_3.visible=!0),this.model.CurentBattleTap>=e.CSArenaStage.TOP_1&&(this.btnG_0.visible=!0)},i.prototype.refreshBetBtnList=function(){if(null!=this.model.MyBetTarget)for(var t=this.model.JuePlayerList,i=0;i<this.betBtnList.length;i++)t[i]&&t[i].getPlayerIdentify()==this.model.MyBetTarget&&this.model.CanBetStatus?(this.betTxtList[i].text=e.LanguageUtils.instance.getValue("CSARENA_18"),this.betTxtList[i].size=20,this.betTxtList[i].visible=!0,this.betBtnList[i].visible=!1):this.betBtnList[i].visible=this.betTxtList[i].visible=!1},i.prototype.refreshLineAbout=function(){var t=this.model.FirstPlayer,i=null!=t?!0:!1;if((i||this.model.CurentBattleTap>=e.CSArenaStage.TOP_8)&&this.showLineGp(this.group_1,e.CSArenaStage.TOP_8),(i||this.model.CurentBattleTap>=e.CSArenaStage.TOP_4)&&this.showLineGp(this.group_2,e.CSArenaStage.TOP_4),(i||this.model.CurentBattleTap>=e.CSArenaStage.TOP_2)&&this.showLineGp(this.group_3,e.CSArenaStage.TOP_2),this.winGroup.visible=!1,(i||this.model.CurentBattleTap>=e.CSArenaStage.TOP_1)&&(this.showWinerLine(),this.winGroup.visible=!0,t)){var n=e.JsonDataManager.instance.roleTemplate[t.getPlayerItemId()];this.winerImg.source=n.icon2,this.winerName.text=this.model.getRoleName(t.getPlayerName(),t.getServerId())}},i.prototype.refreshRedPoint=function(){this.sentRankRedPoint.visible=this.model.sentRankRedPointPreCondition(),this.jingCaiRedPoint.visible=this.model.jingCaiRedPointPreCondition()},i.prototype.refreshBetweenTime=function(){var t=this.model.CsSeasonInfo;this.battleTime.text=e.LanguageUtils.instance.getValue("CSARENA_39")+this.model.timeToDate(t.getBeginDate(),t.getEndDate())},i.prototype.hideAllLineGroup=function(){var e=0;for(e=0;e<this.group_1.length;e++)this.group_1[e].visible=!1;for(e=0;e<this.group_2.length;e++)this.group_2[e].visible=!1;for(e=0;e<this.group_3.length;e++)this.group_3[e].visible=!1;for(e=0;e<this.group_4.length;e++)this.group_4[e].visible=!1},i.prototype.showLineGp=function(e,t){var i=this.model.getFightGroup(t);if(null!=i&&0!=i.length)for(var n=0;n<.5*e.length;n++)if(e[2*n].visible=e[2*n+1].visible=!1,i[n]){var o=i[n].getWinPlayerIdentify();if(null==o||""==o)continue;var a=2*n;if(o==i[n].getPlayer1().getPlayerIdentify()){e[a].visible=!0;continue}o==i[n].getPlayer2().getPlayerIdentify()&&(e[a+1].visible=!0)}},i.prototype.setBetGroupList=function(e){this.isShow=e;for(var t=0;t<this.betBtnList.length;t++)this.betBtnList[t].visible=this.betTxtList[t].visible=e},i.prototype.showWinerLine=function(){if(null==this.model.FirstPlayer)return void(this.group_4[0].visible=this.group_4[1].visible=!1);var t=this.model.getFightGroup(e.CSArenaStage.TOP_1);if(null!=t&&0!=t.length){var i=!1;this.model.FirstPlayer.getPlayerIdentify()==t[0].getPlayer1().getPlayerIdentify()&&(i=!0),this.group_4[0].visible=i,this.group_4[1].visible=!i}},i.prototype.clickHandler=function(t){switch(t.target){case this.recordBtn:e.KFController.getInstance().showMyRecordPanel();break;case this.betBtn:e.KFController.getInstance().showMyBetPanel();break;case this.sentRank:e.KFController.getInstance().showSentRankPanel();break;case this.showBtn0:var i="";this.model.getFightGroup(e.CSArenaStage.TOP_1)&&(i=this.model.getFightGroup(e.CSArenaStage.TOP_1)[0].getGroupIdentify()),e.KFController.getInstance().showBattleReportPanel(i);break;case this.showBtn1:this.setBetGroupList(!this.isShow)}},i.prototype.clickListBtnHandler=function(t){var i=t.target,n=this.btnList.indexOf(i);if(n>=0){var o=this.model.JuePlayerList;o[n]&&e.OtherCharacterController.getInstance().showOtherCharacterPanel(-1,o[n].getPlayerIdentify(),1)}if(this.betBtnList.indexOf(i)>=0){var a=this.model.JuePlayerList[this.betBtnList.indexOf(i)];a&&e.KFController.getInstance().showBetPanel(a)}},i.prototype.tickHook=function(t){return-1!=this.curTextIndex||0!=this.hasFirstPlay?-1==this.oldTime?void(this.oldTime=t):void(t-this.oldTime>=e.KFConst.JueSaiTimeColorDelay&&(this.oldTime=t,this.oldColorIdx<e.KFConst.JueSaiTimeColorList.length-1?this.oldColorIdx++:this.oldColorIdx=0,this.changeTimeColir())):void 0},i.prototype.changeTimeColir=function(){var t=this.timeList[this.curTextIndex],i=this.titleTimeList[this.curTextIndex];t&&i&&(t.textColor=i.textColor=e.KFConst.JueSaiTimeColorList[this.oldColorIdx]),1==this.hasFirstPlay&&(this.winerName.textColor=e.KFConst.JueSaiTimeColorList[this.oldColorIdx])},i.prototype.checkInTime=function(){this.model.CurentBattleTap==e.CSArenaStage.TOP_8?this.curTextIndex=0:this.model.CurentBattleTap==e.CSArenaStage.TOP_4?this.curTextIndex=1:this.model.CurentBattleTap==e.CSArenaStage.TOP_2?this.curTextIndex=2:this.model.CurentBattleTap==e.CSArenaStage.TOP_1?this.curTextIndex=3:this.curTextIndex=-1,this.model.CurentBattleTap>=e.CSArenaStage.TOP_1&&null!=this.model.FirstPlayer?this.hasFirstPlay=!0:this.hasFirstPlay=!1},i.prototype.stageChange=function(e){void 0===e&&(e=null),this.checkInTime();for(var t=0;t<this.titleTimeList.length;t++)t!=this.curTextIndex&&(this.timeList[t].textColor=this.titleTimeList[t].textColor=15655878);0==this.hasFirstPlay&&(this.winerName.textColor=15655878)},i.prototype.closeUI=function(){this.removeLister(),this.oldTime=-1,this.oldColorIdx=0,this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.model.removeEventListener(e.KFConst.CsStageChange,this.stageChange,this)},i.prototype.closeHook=function(){},Object.defineProperty(i.prototype,"group_1",{get:function(){return[this.line_1_1,this.line_1_16,this.line_1_2,this.line_1_15,this.line_1_3,this.line_1_14,this.line_1_4,this.line_1_13,this.line_1_5,this.line_1_12,this.line_1_6,this.line_1_11,this.line_1_7,this.line_1_10,this.line_1_8,this.line_1_9]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"group_2",{get:function(){return[this.line_2_1,this.line_2_3,this.line_2_2,this.line_2_4,this.line_2_5,this.line_2_7,this.line_2_6,this.line_2_8]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"group_3",{get:function(){return[this.line_3_1,this.line_3_3,this.line_3_2,this.line_3_4]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"group_4",{get:function(){return[this.line_4_1,this.line_4_2]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"btnList",{get:function(){return[this.btn_1,this.btn_16,this.btn_2,this.btn_15,this.btn_3,this.btn_14,this.btn_4,this.btn_13,this.btn_5,this.btn_12,this.btn_6,this.btn_11,this.btn_7,this.btn_10,this.btn_8,this.btn_9]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nameList",{get:function(){return[this.name_1,this.name_16,this.name_2,this.name_15,this.name_3,this.name_14,this.name_4,this.name_13,this.name_5,this.name_12,this.name_6,this.name_11,this.name_7,this.name_10,this.name_8,this.name_9]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"betBtnList",{get:function(){return[this.bet_1,this.bet_16,this.bet_2,this.bet_15,this.bet_3,this.bet_14,this.bet_4,this.bet_13,this.bet_5,this.bet_12,this.bet_6,this.bet_11,this.bet_7,this.bet_10,this.bet_8,this.bet_9]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"betTxtList",{get:function(){return[this.betTxt_1,this.betTxt_16,this.betTxt_2,this.betTxt_15,this.betTxt_3,this.betTxt_14,this.betTxt_4,this.betTxt_13,this.betTxt_5,this.betTxt_12,this.betTxt_6,this.betTxt_11,this.betTxt_7,this.betTxt_10,this.betTxt_8,this.betTxt_9]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glassBtnList_1",{get:function(){return[this.glassBtn1_1,this.glassBtn1_2,this.glassBtn1_3,this.glassBtn1_4,this.glassBtn1_5,this.glassBtn1_6,this.glassBtn1_7,this.glassBtn1_8]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glassBtnList_2",{get:function(){return[this.glassBtn2_1,this.glassBtn2_2,this.glassBtn2_3,this.glassBtn2_4]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glassBtnList_3",{get:function(){return[this.glassBtn3_1,this.glassBtn3_2]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleTimeList",{get:function(){return[this.timeTitle1,this.timeTitle2,this.timeTitle3,this.timeTitle4]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeList",{get:function(){return[this.time1,this.time2,this.time3,this.time4]},enumerable:!0,configurable:!0}),i}(eui.Component);e.KFJueSaiPanel=t,__reflect(t.prototype,"foxgame.KFJueSaiPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SentimentRankItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addlister()},i.prototype.init=function(){},i.prototype.addlister=function(){this.clklikeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickLikeHandler,this)},i.prototype.removelister=function(){this.clklikeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickLikeHandler,this)},i.prototype.clickLikeHandler=function(t){var i=this.data.getPlayerIdentify();e.KFController.getInstance().sendLikePlayer(i)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=i.getRank();this.nameTxt.text=e.KFController.getInstance().getModel().getRoleName(i.getPlayerName(),i.getServerId()),this.likeNumTxt.text=i.getPopularValue().toString(),this.numImg.text=n.toString(),this.firstImg.visible=1==n,this.secondImg.visible=2==n,this.thirdImg.visible=3==n;
var o=e.KFController.getInstance().getModel().MySupportPlayer,a=!0;if(this.clklikeBtn.touchEnabled=!0,null!=o){i.getPlayerIdentify()!=o&&(a=!1),this.clklikeBtn.touchEnabled=!1;var s=e.LanguageUtils.instance.getValue("CSARENA_19").split(",");this.clklikeBtn.label=1==a?s[0]:s[1],this.clklikeBtn.filters=1==a?e.GlobalUtil.grayFilter:[]}this.clklikeBtn.visible=a},i.prototype.onClose=function(){this.removelister()},i}(eui.ItemRenderer);e.SentimentRankItem=t,__reflect(t.prototype,"foxgame.SentimentRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/kuaFuBattle/SentimentRankSkin.exml",null)||this;return i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI()},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.SentimentRankItem,this.ui.list.dataProvider=this.model.PopularRankDp,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.showHook=function(){e.KFController.getInstance().sendPopular(),this.refreshUI()},i.prototype.refreshUI=function(){null!=this.model.PopularInfoRsp&&this.showScrollerList()},i.prototype.showScrollerList=function(){var e=this.model.PopularRank;this.model.PopularRankDp.replaceAll(e)},i.prototype.readyDestroy=function(){if(t.prototype.readyDestroy.call(this),this.ui.list&&this.ui.list.numChildren>0)for(var e=0;e<this.ui.list.numChildren;e++)this.ui.list.getChildAt(e).onClose()},Object.defineProperty(i.prototype,"list",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sList",{get:function(){},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.SentimentRankPanel=t,__reflect(t.prototype,"foxgame.SentimentRankPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CSFinalsAwardVO=t,__reflect(t.prototype,"foxgame.CSFinalsAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CSPreliminaryAwardVO=t,__reflect(t.prototype,"foxgame.CSPreliminaryAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CSSegmentAwardVO=t,__reflect(t.prototype,"foxgame.CSSegmentAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CSShopVO=t,__reflect(t.prototype,"foxgame.CSShopVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CSTimeVO=t,__reflect(t.prototype,"foxgame.CSTimeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.CSWorshipAwardVO=t,__reflect(t.prototype,"foxgame.CSWorshipAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.AWARDVIEW=0]="AWARDVIEW",e[e.AWARDSTATEVIEW=1]="AWARDSTATEVIEW"}(t=e.LegendViewType||(e.LegendViewType={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/legend/LegendAwardSkin.exml")||this;return t.model=e,t}return __extends(n,i),n.prototype.initHook=function(){},n.prototype.refresh=function(){switch(this.model.currentLegendViewType){case t.AWARDVIEW:this.ui.stateAwardGroup.visible=!1,this.ui.receiveAwardGroup.visible=!0,this.updateAwardGroup(this.model.currentAwardIndex);break;case t.AWARDSTATEVIEW:this.ui.stateAwardGroup.visible=!0,this.ui.receiveAwardGroup.visible=!1,this.updateAwardStateGroup()}this.initBuffBuyState()},n.prototype.setBuffBuyState=function(e){for(var t=this.getItems().length,i=0;t>i;i++){var n=this.getItems()[i];n.getBuffId()==e&&n.setBuyBtnState(!1)}},n.prototype.initBuffBuyState=function(){for(var e=this.getItems().length,t=0;e>t;t++){var i=this.getItems()[t];i.setBuyBtnState(!0)}},n.prototype.showPanel=function(e,t,i){void 0===i&&(i=null),this.model.currentLegendViewType=e,this.model.currentAwardIndex=t,this.model.buffData=i,this.show()},n.prototype.updateAwardStateGroup=function(){for(var e=this.getItems().length,t=this.model.buffData,i=0;e>i;i++){var n=this.getItems()[i],o=t.getBuffStr()[i];n.setData(o)}},n.prototype.updateAwardGroup=function(t){for(var i=this.getItemCells().length,n=e.JsonDataManager.instance.legendAward,o=n[t],a=0;i>a;a++){var s=this.getItemCells()[a];s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showItemTip,this);var r=o.award[a];s.setItem(Number(r[1]),Number(r[2]))}},n.prototype.showItemTip=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},n.prototype.getItemCells=function(){var e=[];return e.push(this.ui.itemCell0),e.push(this.ui.itemCell1),e.push(this.ui.itemCell2),e.push(this.ui.itemCell3),e},n.prototype.getItems=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},n}(e.BasePanel);e.LegendAwardPanel=i,__reflect(i.prototype,"foxgame.LegendAwardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.LegendAwardVO=t,__reflect(t.prototype,"foxgame.LegendAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.LegendBuffVO=t,__reflect(t.prototype,"foxgame.LegendBuffVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.LegendModel,this.mainPanel=new e.LegendPanel(this.model),this.victoryPanel=new e.LegendVictoryPanel(this.model),this.playerMsgPanel=new e.LegendPlayerMsgPanel(this.model),this.awardPanel=new e.LegendAwardPanel(this.model),this.shopPanel=new e.LegendShopPanel(this.model)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.LEGENDS_UPREMACY_INFO_S:this.model.setPlayersInfo(i.getLegendSupremacyInfo());break;case e.Code.LEGENDS_UPREMACY_CHALLENGE_S:var n=i;if(null==n.getCheckpointNumber())return;var o=n.getChallengState();this.model.fightResult=o,this.model.updateMyselfInfo(n),o&&(this.model.fightedNum=n.getCheckpointNumber(),this.mainPanel.sendReceiveAwardReq(n.getCheckpointNumber())),e.BattleScene.instance.showLegendResult();break;case e.Code.LEGENDS_UPREMACY_BUFF_BUY_S:0==i.getErrorNo()?(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHOPBUYSUCCESS")),this.model.myInfo=i.getPlayerInfos(),this.mainPanel.refreshAttrText(i),this.awardPanel.setBuffBuyState(i.getBuffId())):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XINGBIBUZU"));break;case e.Code.LEGENDS_UPREMACY_PACKAGE_S:this.model.refreshBayebiNumber(i);break;case e.Code.LEGENDS_UPREMACY_AWARD_S:i.getErrorNo()||(this.mainPanel.refreshBayebiNumText(i),this.model.refreshBayebiNumber(i));break;case e.Code.LEGENDS_UPREMACY_RESET_S:if(i.getErrorNo()){var a=e.LanguageUtils.instance.getValue("CQBY_CZCHISHUBUZHU");e.GameUtils.MSG_TIP(a)}else{var a=e.LanguageUtils.instance.getValue("CQBY_CZCHENGGONG");e.GameUtils.MSG_TIP(a),this.mainPanel.setMapMsg(),this.mainPanel.initScrollerY(),this.model.setPlayersInfo(i.getLegendSupremacyInfo())}break;case e.Code.LEGENDS_UPREMACY_RESET_BUY_S:var s=i;s.getErrorNo()||(this.mainPanel.refreshResetTimeText(s),this.model.refreshBuyResetTimes(s));break;case e.Code.LEGENDS_UPREMACY_RESURRECTION_BUY_S:this.model.refrehGoldNumber(i),this.model.updateMyselfInfo(i);break;case e.Code.LEGENDS_UPREMACY_BUFF_INFO_S:this.model.setBuffData(i)}},t.prototype.getIsContinueFight=function(){return this.victoryPanel.getIsContinueFight()},t.prototype.registerMessage=function(t){t.add(e.Code.LEGENDS_UPREMACY_INFO_S,this),t.add(e.Code.LEGENDS_UPREMACY_CHALLENGE_S,this),t.add(e.Code.LEGENDS_UPREMACY_BUFF_BUY_S,this),t.add(e.Code.LEGENDS_UPREMACY_PACKAGE_S,this),t.add(e.Code.LEGENDS_UPREMACY_AWARD_S,this),t.add(e.Code.LEGENDS_UPREMACY_RESET_S,this),t.add(e.Code.LEGENDS_UPREMACY_RESET_BUY_S,this),t.add(e.Code.LEGENDS_UPREMACY_RESURRECTION_BUY_S,this),t.add(e.Code.LEGENDS_UPREMACY_BUFF_INFO_S,this)},t.prototype.fightReq=function(){e.MainControler.instance.jingjiPvpChangeUI();var t=HawkProtocolManager.newBuilder("JsProto.HPChallengeSupremacyReq");t.setCheckpointNumber(this.model.willFightMapIndex),e.Message.instance.send(e.Code.LEGENDS_UPREMACY_CHALLENGE_C,t,!0)},t.prototype.showMainPanel=function(){var t=Number(e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_GRADE_MIN")),i=e.PlayerService.instance.playerInfo.getLevel();if(t>i){var n=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",t);return void e.GameUtils.MSG_TIP(n)}this.mainPanel.show(),this.mainPanel.sendGetSupremacyInfoReq()},t.prototype.mainPanelIsShow=function(){return this.mainPanel.getIsShow()},t.prototype.closeMainPanel=function(){this.mainPanel.close()},t.prototype.showVictoryPanel=function(){this.model.fightResult&&this.victoryPanel.show()},t.prototype.showShopPanel=function(){this.shopPanel.show()},t.prototype.showPlayerMsgPanel=function(t,i){0==t?this.playerMsgPanel.showPanel(e.MsgType.MYSELF,this.model.myInfo):this.playerMsgPanel.showPanel(t,i)},t.prototype.closePlayerMsgPanel=function(){this.playerMsgPanel.close()},t.prototype.checkMyPlatersIsAllDied=function(){for(var e=this.model.myInfo.length,t=0;e>t;t++){var i=this.model.myInfo[t];if(i.getOutPutNumber()>0)return!1}return!0},t.prototype.showAwardPanel=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.awardPanel.showPanel(e,t,i)},t.prototype.getBuffData=function(){return this.model.buffData},t.prototype.getSupremacyCion=function(){return void 0!=this.model.bayebiNum?this.model.bayebiNum:void 0},t.prototype.getReviveGoldNumber=function(){return this.model.reviveGoldNumber},t.prototype.getFightedNum=function(){return this.model.fightedNum},t.prototype.getMyselfInfo=function(){return this.model.myInfo},t.prototype.getFightResult=function(){return this.model.fightResult},t.prototype.getMaxMapNum=function(){return this.model.maxMapNum},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t}();e.LegendController=t,__reflect(t.prototype,"foxgame.LegendController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.data=[],e.tapTime=3,e.skinName="LegendMapItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fight,this),this.touchGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSelect,this),this.touchGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.showPlayersInfo,this),this.touchGroup.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.dispearSelect,this)},i.prototype.showSelect=function(){this.mapSelectIcon.visible=!0,this.touchTime=egret.getTimer()},i.prototype.dispearSelect=function(){this.isShowSelectImg||(this.mapSelectIcon.visible=!1)},i.prototype.showPlayersInfo=function(){var t=Math.ceil((egret.getTimer()-this.touchTime)/1e3);this.isShowSelectImg||(this.mapSelectIcon.visible=!1),t>this.tapTime||e.LegendController.getInstance().showPlayerMsgPanel(this.isFighted,this.data)},i.prototype.setData=function(t){this.data=t;var i=e.PlayerService.instance.playerInfo.getPlayerId();t[0].getPlayerId()==i?(this.occupyImg.visible=!0,this.fightText.text=e.LanguageUtils.instance.getValue("FIGHT")+":"+this.calcTotalFightGrade(),this.fightText.textColor=16746752,this.fightBtn.touchEnabled=!1,this.isFighted=e.MsgType.MYSELF,this.setMapNameTextFolw()):(this.isFighted=e.MsgType.ENEMY,this.fightText.text=e.LanguageUtils.instance.getValue("LEVEL")+":"+t[0].getRank(),this.fightText.textColor=16777215,this.occupyImg.visible=!1);var n=t[0].getItem(),o=e.JsonDataManager.instance.roleTemplate[n];o&&(this.roleType.source="zhiye_"+o.profession+"_png",this.roleIcon.source=o.icon)},i.prototype.calcTotalFightGrade=function(){for(var t=this.data.length,i=0,n=0;t>n;n++){var o=this.data[n];i+=Number(o.getFighting())}return e.GlobalUtil.getUnitString(i)},i.prototype.setFightBtnState=function(e){this.fightBtn.enabled=e,this.isShowSelectImg=e,this.mapSelectIcon.visible=e},i.prototype.setMapMsg=function(t){var i=e.JsonDataManager.instance.legendMap[t];this.mapIndex=Number(i.mapId),this.fightBtn.touchEnabled=!0,this.occupyImg.visible=!1,this.mapIcon.source=i.icon+"_png",this.mapSelectIcon.source=i.icon1+"_png",this.mapSelectIcon.visible=!1,this.mapNameText.text=i.name,this.mapName=i.name,this.fightText.text="",37==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&1==this.mapIndex&&e.MainControler.instance.guidechange(this.fightBtn,this.fightBtn.parent,37,3,!0)},i.prototype.getMapIndex=function(){return this.mapIndex},i.prototype.setMapNameTextFolw=function(){var e=this.mapName;this.mapNameText.textFlow=[{text:e,style:{textColor:10461086}}]},i.prototype.fight=function(){if(e.LegendController.getInstance().checkMyPlatersIsAllDied())e.LegendController.getInstance().showPlayerMsgPanel(e.MsgType.MYSELF,e.LegendController.getInstance().getMyselfInfo()),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CQBY_ZHENGWANG_TIP"));else{e.MainControler.instance.jingjiPvpChangeUI(),e.LegendController.getInstance().closeMainPanel();var t=HawkProtocolManager.newBuilder("JsProto.HPChallengeSupremacyReq");t.setCheckpointNumber(this.mapIndex),e.Message.instance.send(e.Code.LEGENDS_UPREMACY_CHALLENGE_C,t,!0)}37==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i}(eui.Component);e.LegendMapItem=t,__reflect(t.prototype,"foxgame.LegendMapItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.LegendMapVO=t,__reflect(t.prototype,"foxgame.LegendMapVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.shopDataCollection=new eui.ArrayCollection,this.maxMapNum=15,this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.updateMyInfo=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateMyInfo()},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e.prototype.setBuffData=function(e){this.buffData=e},e.prototype.refrehGoldNumber=function(e){this.reviveGoldNumber=e.getGlodNumber()},e.prototype.updateMyselfInfo=function(e){this.myInfo=e.getPlayerInfos(),this.updateMyInfo()},e.prototype.setLegendsAttrData=function(e){this._bufferData=e},e.prototype.getLegendsAttrData=function(){return this._bufferData},e.prototype.refreshBuyResetTimes=function(e){this.buyResetTimes=e.getBuyResetNumber()},e.prototype.refreshBayebiNumber=function(e){void 0!=e.getSupremacyCion()&&(this.bayebiNum=e.getSupremacyCion())},e.prototype.setPlayersInfo=function(e){this.playersInfo=e,this.bayebiNum=e.getSupremacyCion(),this.reviveGoldNumber=e.getGlodNumber(),this.myInfo=e.getPlayerInfos(),this.buyResetTimes=e.getBuyResetNumber(),this.updateView()},e}();e.LegendModel=t,__reflect(t.prototype,"foxgame.LegendModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/legend/LegendMainSkin.exml")||this;return i.model=e,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHelpTip,this),this.ui.shopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.plusBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getFightTime,this),this.ui.scroller.horizontalScrollBar.autoVisibility=!1,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.ui.scroller.scrollPolicyH="ScrollPolicy.OFF",this.ui.scroller.bounces=!1,this.initGroupHeight=this.ui.mapGroup.height,this.ui.myInfoText.textFlow=(new egret.HtmlTextParser).parser("<font><u>我的信息</u></font>"),this.ui.myInfoText.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMyInfo,this),this.setAward(),this.setMapMsg(),this.doScreenAdaptation()},i.prototype.showMyInfo=function(){e.LegendController.getInstance().showPlayerMsgPanel(e.MsgType.MYSELF,this.model.myInfo)},i.prototype.setAward=function(){for(var t=this.getBoxs().length,i=0;t>i;i++){var n=this.getBoxs()[i];n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.boxClick,this),n.setState(e.TreasureBoxState.UNRECEIVE),n.setAwardIndex(i+1)}},i.prototype.setMapMsg=function(){for(var e=this.getMaps().length,t=0;e>t;t++){var i=this.getMaps()[t];i.setMapMsg(t)}},i.prototype.initScrollerY=function(){this.model.lastScrollY=this.initGroupHeight-this.ui.scroller.height,this.ui.scroller.viewport.scrollV=this.initGroupHeight-this.ui.scroller.height},i.prototype.boxClick=function(t){var i=t.currentTarget;e.LegendController.getInstance().showAwardPanel(e.LegendViewType.AWARDVIEW,i.getAwardIndex())},i.prototype.updateAwardState=function(){},i.prototype.initParams=function(){void 0==this.model.lastScrollY?this.ui.scroller.viewport.scrollV=this.initGroupHeight-this.ui.scroller.height:this.ui.scroller.viewport.scrollV=this.model.lastScrollY},i.prototype.showHelpTip=function(){e.HelpController.getInstance().showPanel("CQBYHELP")},i.prototype.onClick=function(t){switch(t.target){case this.ui.shopBtn:e.LegendController.getInstance().showShopPanel();break;case this.ui.restartBtn:var i=e.LanguageUtils.instance.getValue("CQBY_CZTIP");e.PopUpController.getInstance().showTextPanel(i,this,this.sendRestartReq)}},i.prototype.updateView=function(){this.ui.currency.refresh(),this.refresh()},i.prototype.refresh=function(){this.model.playersInfo&&this.getIsInit()&&(this.refreshLabel(),this.refreshPlatersInfo(),this.refreshAwardState())},i.prototype.refreshPlayerInfo=function(e){this.ui.medalNumText.text=e.getSupremacyCion()+"",this.ui.xingbiText.text=e.getStarCion()+"";var t=e.getCheckpointNumber();this.model.willFightMapIndex=t;var i=this.getMaps()[t-1],n=this.getMaps().length;e.getChallengState()?i.setData(e.getPlayerInfos()):i.setData(e.getHostilePlayerInfo()),n>=t+1&&this.getMaps()[t+1].setFightBtnState(!0)},i.prototype.refreshAwardState=function(){for(var t=this.getBoxs().length,i=0;t>i;i++){var n=this.getBoxs()[i],o=this.model.playersInfo,a=o.getViewScenarioInfo()[i],s=a.getChallengState(),r=void 0;r=s?0==a.getPackageState()?e.TreasureBoxState.CANRECEIVE:e.TreasureBoxState.ALREADYRECEIVE:e.TreasureBoxState.UNRECEIVE,n.setState(r)}},i.prototype.refreshMyPlayerInfo=function(e){for(var t=this.getMaps().length,i=0;t>i;i++){var n=this.getMaps()[i];i<=this.model.fightedNum&&n.setData(e.getPlayerInfos())}},i.prototype.refreshAttrText=function(e){this.ui.attrsText.textFlow=this.createAttrText(e.getBuffInfoList()),this.ui.xingbiText.text=e.getStarCion()+""},i.prototype.refreshBayebiNumText=function(e){this.ui.medalNumText.text=e.getSupremacyCion()+""},i.prototype.refreshResetTimeText=function(e){this.model.playersInfo.setResetNumber(e.getResetNumber()),this.ui.timesText.text=e.getResetNumber()+"/"+e.getResetSumNumber()},i.prototype.refreshLabel=function(){var e=this.model.playersInfo;this.ui.timesText.text=e.getResetNumber()+"/"+e.getResetSumNumber(),this.ui.medalNumText.text=e.getSupremacyCion()+"",this.ui.xingbiText.text=e.getStarCion()+"",this.ui.attrsText.textFlow=this.createAttrText(e.getBuffInfoList())},i.prototype.refreshPlatersInfo=function(){var e=this.getMaps().length,t=this.model.playersInfo;this.model.willFightMapIndex=t.getCheckpointNumber();for(var i=0;e>i;i++){var n=this.getMaps()[i],o=t.getViewScenarioInfo()[i];o.getChallengState()?n.setData(t.getPlayerInfos()):n.setData(o.getHostilePlayerInfo()),t.getCheckpointNumber()==n.getMapIndex()?n.setFightBtnState(!0):n.setFightBtnState(!1)}},i.prototype.createAttrText=function(t){for(var i=t.length,n=[],o=0;i>o;o++){var a=t[o],s=e.LanguageUtils.instance.getValue("ATT_"+a.getAttrId());n.push({text:s+"+",style:{textColor:2227971}}),n.push({text:Number(a.getAttrValue())/100+"%\n",style:{textColor:2227971}})}return n},i.prototype.sendRestartReq=function(){var t=e.PlayerService.instance.vipLevel,i=e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_VIP_LEVEL"),n=Number(i.split("_")[0]);if(t>=n&&0==this.model.playersInfo.getResetNumber())return void this.getFightTime();var o=HawkProtocolManager.newBuilder("JsProto.HPSupremacyResetReq");e.Message.instance.send(e.Code.LEGENDS_UPREMACY_RESET_C,o,!0)},i.prototype.sendGetSupremacyInfoReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPLegendSupremacyInfoReq");e.Message.instance.send(e.Code.LEGENDS_UPREMACY_INFO_C,t,!0)},i.prototype.sendReceiveAwardReq=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPSupremacyAwardReq");i.setCheckpointNumber(t),e.Message.instance.send(e.Code.LEGENDS_UPREMACY_PACKAGE_C,i,!0)},i.prototype.getFightTime=function(){for(var t=e.PlayerService.instance.vipLevel,i=e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_VIP_LEVEL"),n=i.split(","),o=n.length,a=0,s=0;o>s;s++){var r=n[s].split("_"),l=Number(r[0]);t>=l&&(a=Number(r[1]))}if(t<Number(n[0].split("_")[0]))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CQBY_GOUMAIVIP_TIP"));if(this.model.buyResetTimes<a){var h=e.GlobalConfig.instance.getValue("CHUANGQIBAYE_GONGMAICHISHU"),c=e.LanguageUtils.instance.getValue("CQBY_GOUMAI_TIP",h);e.PopUpController.getInstance().showTextPanel(c,this,this.sendBuyResetReq)}else e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CQBY_GOUMAISHANGXIAN_TIP"))},i.prototype.sendBuyResetReq=function(){var t=e.PlayerService.instance.playerInfo.getGold(),i=e.GlobalConfig.instance.getValue("CHUANGQIBAYE_GONGMAICHISHU");if(t>=Number(i)){var n=HawkProtocolManager.newBuilder("JsProto.HPSupremacyBuyResetReq");e.Message.instance.send(e.Code.LEGENDS_UPREMACY_RESET_BUY_C,n,!0)}else e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")},i.prototype.readyDestroy=function(){this.model.lastScrollY=this.ui.scroller.viewport.scrollV},i.prototype.backHandler=function(){this.close(),e.WanFaController.getInstance().showPanel()},i.prototype.updateMyInfo=function(){},i.prototype.getMaps=function(){for(var e=[],t=0;14>=t;t++)e.push(this.ui["map"+t]);return e},i.prototype.getBoxs=function(){for(var e=[],t=0;14>=t;t++)e.push(this.ui["box"+t]);return e},i}(e.BasePanel);e.LegendPanel=t,__reflect(t.prototype,"foxgame.LegendPanel",["foxgame.ILegend","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e._maxWidth=231,e.skinName="LegendPlayerMsgItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createFriend,this),this.reviveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reviveFriend,this)},i.prototype.reviveFriend=function(){var t=e.LegendController.getInstance().getReviveGoldNumber(),i=e.LanguageUtils.instance.getValue("CQBY_FUHUOQUEREN_TIP",t);e.PopUpController.getInstance().showTextPanel(i,this,this.sendReviveFriend)},i.prototype.sendReviveFriend=function(){var t=e.LegendController.getInstance().getReviveGoldNumber(),i=e.PlayerService.instance.playerInfo.getGold();if(t>i)e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");else{var n=HawkProtocolManager.newBuilder("JsProto.HPResurrectionBuyReq");n.setItemId(this.data.getItem()),e.Message.instance.send(e.Code.LEGENDS_UPREMACY_RESURRECTION_BUY_C,n,!0)}},i.prototype.createFriend=function(){e.LegendController.getInstance().closePlayerMsgPanel(),e.LegendController.getInstance().closeMainPanel(),e.CharacterOpenController.getInstance().showPanel()},i.prototype.setData=function(t,i){switch(this.data=t,i){case e.MsgType.MYSELF:if(this.diedImg.visible=!1,void 0==t)this.noFriendText.visible=!0,this.createBtn.visible=!0,this.reviveBtn.visible=!1,this.hpGroup.visible=!1,this.roleType.source="",this.roleIcon.source="",this.gradeText.visible=!1;else{this.noFriendText.visible=!1,this.createBtn.visible=!1,this.gradeText.visible=!0,this.hpGroup.visible=!0;var n=t.getOutPutNumber();this.setPartMsg(t),0==n?this.reviveBtn.visible=!0:this.reviveBtn.visible=!1}break;case e.MsgType.ENEMY:if(this.createBtn.visible=!1,this.reviveBtn.visible=!1,void 0==t)this.noFriendText.visible=!0,this.roleType.source="",this.roleIcon.source="",this.gradeText.visible=!1,this.diedImg.visible=!1,this.hpGroup.visible=!1;else{this.noFriendText.visible=!1,this.gradeText.visible=!0,this.hpGroup.visible=!0;var n=t.getOutPutNumber();this.setPartMsg(t),0==n?this.diedImg.visible=!0:this.diedImg.visible=!1}}},i.prototype.setPartMsg=function(t){var i=t.getOutPutNumber(),n=t.getMaxoutPutNumber(),o=Number((i/n*100).toFixed(2));o>100&&(o=100),this.hpText.text=i+"("+o+"%)",this.gradeText.text=e.LanguageUtils.instance.getValue("FIGHT")+":"+t.getFighting();var a=e.JsonDataManager.instance.roleTemplate[t.getItem()];a&&(this.roleType.source="zhiye_"+a.profession+"_png",this.roleIcon.source=a.icon),this.hpBarImg.width=e.GlobalUtil.calcFloat(this._maxWidth,o/100)},i.prototype.setBtnState=function(e){this.createBtn.visible=e,this.reviveBtn.visible=e},i.prototype.setEmptyData=function(){this.noFriendText.visible=!0,this.gradeText.visible=!1,this.hpGroup.visible=!1},i}(eui.Component);e.LegendPlayerMsgItem=t,__reflect(t.prototype,"foxgame.LegendPlayerMsgItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.MYSELF=0]="MYSELF",e[e.ENEMY=1]="ENEMY"}(t=e.MsgType||(e.MsgType={}));var i=function(e){function i(t){var i=e.call(this,"resource/skins/legend/LegendPlayerMsgSkin.exml")||this;return i.model=t,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,e),i.prototype.initHook=function(){this.model.registerObserver(this),this.setView()},i.prototype.showPanel=function(e,t){this.model.PlayerType=e,this.model.currentPlayerMsg=t,this.show()},i.prototype.updateMyInfo=function(){for(var e=this.model.myInfo,i=0;i<e.length;i++){var n=this.getMsgItems()[i],o=e[i];n.setData(o,t.MYSELF)}},i.prototype.setView=function(){switch(this.model.PlayerType){case t.MYSELF:this.ui.mySelfImg.visible=!0,this.ui.enemyImg.visible=!1;break;case t.ENEMY:this.ui.mySelfImg.visible=!1,this.ui.enemyImg.visible=!0}},i.prototype.setPlayerMsg=function(e,t){for(var i=this.getMsgItems().length,n=0;i>n;n++){var o=this.getMsgItems()[n],a=e[n];o.setData(a,t)}this.setView()},i.prototype.refresh=function(){this.setPlayerMsg(this.model.currentPlayerMsg,this.model.PlayerType)},i.prototype.updateView=function(){},i.prototype.getMsgItems=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},i}(e.BasePanel);e.LegendPlayerMsgPanel=i,__reflect(i.prototype,"foxgame.LegendPlayerMsgPanel",["foxgame.ILegend","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ArenaShopItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnExchange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchange,this),this.itemcell.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnIcon,this),this.jifenIcon.visible=!1,this.bayebiIcon.visible=!0},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=e.JsonDataManager.instance.itemTemplate,n=i[this.data.itemID];this.priceLabel.text=this.data.price,this.nameLabel.text=n.name,this.itemcell.setItem(this.data.itemID,1,!1,!1)},i.prototype.onBtnExchange=function(){if(Number(this.data.price)>e.LegendController.getInstance().getSupremacyCion())return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("BAYEBIBUZU"));var t=HawkProtocolManager.newBuilder("JsProto.HPSupremacyShoppingAwardReq");t.setItemId(parseInt(this.data.itemID)),e.Message.instance.send(e.Code.LEGENDS_UPREMACY_AWARD_C,t,!0)},i.prototype.onBtnIcon=function(){var t=e.JsonDataManager.instance.itemTemplate,i=t[this.data.itemID];i.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(this.data.itemID):e.TipsController.getInstance().showItemTips(this.data.itemID)},i}(eui.ItemRenderer);e.LegendShopItem=t,__reflect(t.prototype,"foxgame.LegendShopItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/legend/LegendShopSkin.exml")||this;return i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.shopScroller.horizontalScrollBar.autoVisibility=!1,this.ui.shopScroller.verticalScrollBar.autoVisibility=!1,this.ui.shopScroller.scrollPolicyH="ScrollPolicy.OFF",this.ui.shopScroller.bounces=!1,this.ui.shopList.dataProvider=this.model.shopDataCollection,this.ui.shopList.itemRenderer=e.LegendShopItem},i.prototype.refresh=function(){var t=e.JsonDataManager.instance.legendShop;this.model.shopDataCollection.source=t,this.model.shopDataCollection.refresh()},i}(e.BasePanel);e.LegendShopPanel=t,__reflect(t.prototype,"foxgame.LegendShopPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.LegendShopVO=t,__reflect(t.prototype,"foxgame.LegendShopVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyState,this)},i.prototype.createChildren=function(){t.prototype.createChildren.call(this)},i.prototype.buyState=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPSupremacyBuyBuffReq");t.setCheckpointNumber(1),t.setAttributeId(this.buffId),e.Message.instance.send(e.Code.LEGENDS_UPREMACY_BUFF_BUY_C,t,!0)},i.prototype.setData=function(t){var i=t.getBuff().split("_"),n=Number(i[1]);this.buffId=n;var o=Number(i[2])/100,a=e.JsonDataManager.instance.legendBuffData,s=a[n],r=e.LanguageUtils.instance.getValue("ATT_"+n);this.icon.source=s.icon+"_png",this.attrText.text=r+"+"+o+"%",this.xingbiText.text=t.getStarCion()+""},i.prototype.getBuffId=function(){return this.buffId},i.prototype.setBuyBtnState=function(e){this.buyBtn.enabled=e},i}(eui.Component);e.LegendStateItem=t,__reflect(t.prototype,"foxgame.LegendStateItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.CANRECEIVE=0]="CANRECEIVE",e[e.UNRECEIVE=1]="UNRECEIVE",e[e.ALREADYRECEIVE=2]="ALREADYRECEIVE"}(t=e.TreasureBoxState||(e.TreasureBoxState={}));var i=function(i){function n(){var e=i.call(this)||this;return e.skinName="LegendTreasureBox",e}return __extends(n,i),n.prototype.setState=function(i){switch(i){case t.CANRECEIVE:this.unLightBox.visible=!1,this.lightBox.visible=!0,this.receiveText.visible=!0,this.playAni(),this.receiveText.text=e.LanguageUtils.instance.getValue("DIANJILINGQU");break;case t.UNRECEIVE:this.unLightBox.visible=!0,this.lightBox.visible=!1,this.receiveText.visible=!1;break;case t.ALREADYRECEIVE:this.unLightBox.visible=!1,this.lightBox.visible=!0,this.receiveText.visible=!0,this.receiveText.text=e.LanguageUtils.instance.getValue("YILINGQU"),this.destoryAni()}this.currentShowState=i},n.prototype.setAwardIndex=function(e){this.currentAwardIndex=e},n.prototype.getAwardIndex=function(){return this.currentAwardIndex},n.prototype.getState=function(){return this.currentShowState},n.prototype.playAni=function(){var e=this;null!=this.tweenTarget0&&(this.tweenTarget0.kill(),this.tweenTarget0=null),this.tweenTarget0=TweenMax.fromTo(this.lightBox,.1,{rotation:-10},{rotation:10,yoyo:!0,repeat:3,onComplete:function(){null!=e.tweenTarget1&&(e.tweenTarget1.kill(),e.tweenTarget1=null),e.lightBox.rotation=0,e.tweenTarget1=TweenMax.delayedCall(3,function(){e.playAni()
})}})},n.prototype.stopAni=function(){},n.prototype.destoryAni=function(){null!=this.tweenTarget0&&(this.tweenTarget0.kill(),this.tweenTarget0=null),null!=this.tweenTarget1&&(this.tweenTarget1.kill(),this.tweenTarget1=null)},n}(eui.Component);e.LegendTreasureBox=i,__reflect(i.prototype,"foxgame.LegendTreasureBox")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/legend/LegendVictorySkin.exml")||this;return i.iCount=0,i.setRegisterTick(!0),i}return __extends(i,t),i.prototype.refresh=function(){var t=e.LegendController.getInstance().getFightedNum(),i=e.LegendController.getInstance().getMyselfInfo();this.refreshMapMsg(t,i)},i.prototype.initParams=function(){this.iCount=9},i.prototype.initHook=function(){this.ui.nextFightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendFightReq,this),this.ui.returnBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showLegendPanel,this)},i.prototype.showLegendPanel=function(t){this.isContinueFight=!1,e.LegendController.getInstance().showMainPanel(),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"LegendVictoryPanel",tag:"showLegendPanel",battleType:e.BattleType.LEGENDARY_EMPIRE}),this.close()},i.prototype.sendFightReq=function(t){this.isContinueFight=!0,e.LegendController.getInstance().mainPanelIsShow()&&e.LegendController.getInstance().closeMainPanel(),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"LegendVictoryPanel",tag:"sendFightReq",battleType:e.BattleType.LEGENDARY_EMPIRE}),this.close()},i.prototype.getIsContinueFight=function(){return this.isContinueFight},i.prototype.tickHook=function(t){void 0==this.startTime&&(this.startTime=t);var i=Math.floor((t-this.startTime)/1e3);this.ui.timeText.text=this.iCount-i+"",this.iCount-i<=0&&(this.iCount=0,this.isContinueFight=!0,this.startTime=void 0,e.LegendController.getInstance().mainPanelIsShow()&&e.LegendController.getInstance().closeMainPanel(),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"LegendVictoryPanel",tag:"tickHook",battleType:e.BattleType.LEGENDARY_EMPIRE}),this.close())},i.prototype.refreshMapMsg=function(t,i){var n=e.JsonDataManager.instance.legendMap[t-1],o=e.LanguageUtils.instance.getValue("CQBY_SHENGLI_TIP",n.name,n.name);this.ui.desText.textFlow=(new egret.HtmlTextParser).parser(o);for(var a=this.getItems().length,s=0;a>s;s++){var r=this.getItems()[s],l=i[s];r.setData(l,e.MsgType.MYSELF),r.setBtnState(!1)}},i.prototype.readyDestroy=function(){this.startTime=void 0,this.isShowAwardPanel(),this.isContinueFight=!1},i.prototype.backHandler=function(){e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"LegendVictoryPanel",tag:"backHandler",battleType:e.BattleType.LEGENDARY_EMPIRE}),this.close()},i.prototype.isShowAwardPanel=function(){var t=e.LegendController.getInstance().getFightedNum(),i=e.LegendController.getInstance().getMaxMapNum();t%3==0&&i!=t?(e.LegendController.getInstance().showMainPanel(),e.LegendController.getInstance().showAwardPanel(e.LegendViewType.AWARDSTATEVIEW,null,e.LegendController.getInstance().getBuffData())):this.isContinueFight?e.LegendController.getInstance().fightReq():e.LegendController.getInstance().mainPanelIsShow()||e.LegendController.getInstance().getIsContinueFight()||e.LegendController.getInstance().showMainPanel()},i.prototype.getItems=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},i}(e.BasePanel);e.LegendVictoryPanel=t,__reflect(t.prototype,"foxgame.LegendVictoryPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panel=new e.LegendaryEquipPanel}return t.prototype.showPanel=function(){App.LittleLoading().showLoading("LegendaryEquipController"),this.panel.show(),App.LittleLoading().hideLoading("LegendaryEquipController")},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.refreshUI=function(){this.panel.getIsShow()&&this.panel.refeshUI()},t.prototype.requestVIPInfo=function(){e.Message.instance.send(e.Code.VIP_GIFTS_INFO_C,HawkProtocolManager.emptyProtocol(),!0)},t}();e.LegendaryEquipController=t,__reflect(t.prototype,"foxgame.LegendaryEquipController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/legendaryEquip/LegendaryEquip.exml","legendaryEquip")||this;return e.isMask=!0,e}return __extends(i,t),i.prototype.initHook=function(){e.LegendaryEquipController.getInstance().requestVIPInfo(),this.initAni(),this.ui.rechargeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHandler,this);for(var t=0,i=this.getItems().length;i>t;)this.getItems()[t].setItem(this.getItemId(t),null,!0),this.getItems()[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.showItemTip,this),t+=1;this.doScreenAdaptation()},i.prototype.initAni=function(){this.ani_zhanshi&&(this.ani_zhanshi.clear(),this.ani_zhanshi=null),this.ani_zhanshi||(this.ani_zhanshi=new e.FoxAni(this.ui.zhanshi_ani),this.ani_zhanshi.play("zhanshiwuqi","ani",-1),this.ui.zhanshi_ani.scaleX=this.ui.zhanshi_ani.scaleY=.8),this.ani_fashi&&(this.ani_fashi.clear(),this.ani_fashi=null),this.ani_fashi||(this.ani_fashi=new e.FoxAni(this.ui.fashi_ani),this.ani_fashi.play("fashiwuqi","ani",-1),this.ui.fashi_ani.scaleX=this.ui.fashi_ani.scaleY=.6),this.ani_daoshi&&(this.ani_daoshi.clear(),this.ani_daoshi=null),this.ani_daoshi||(this.ani_daoshi=new e.FoxAni(this.ui.daoshi_ani),this.ani_daoshi.play("daoshiwuqi","ani",-1),this.ui.daoshi_ani.scaleX=this.ui.daoshi_ani.scaleY=.8),this.rechargeAniGroup&&(this.rechargeAniGroup.clear(),this.rechargeAniGroup=null),this.rechargeAniGroup||(this.rechargeAniGroup=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAniGroup.play("rechargeAnimation","ani",-1))},i.prototype.showHook=function(){this.refeshUI(),this.ui.tip.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("VIP_CSWQ_JINE"))},i.prototype.refeshUI=function(){!e.CreateNewVipController.instance.isReceiveAward(16)&&e.PlayerService.instance.playerInfo.getVipLevel()>=16&&(this.ui.rechargeBtn.label=e.LanguageUtils.instance.getValue("LINGQU"))},i.prototype.getItemId=function(t){var i=e.JsonDataManager.instance.vipGift,n=i[16],o=n.awards,a=o[t].id;return a},i.prototype.backHandler=function(){this.close()},i.prototype.showItemTip=function(t){var i=this.getItems().indexOf(t.target),n=this.getItemId(i);e.TipsController.getInstance().showEquipTips({equipId:n})},i.prototype.btnClick=function(t){switch(t.target){case this.ui.rechargeBtn:!e.CreateNewVipController.instance.isReceiveAward(16)&&e.PlayerService.instance.playerInfo.getVipLevel()>=16?(e.CreateNewVipController.instance.showPanel(16),App.SoundManager().playEffect("sound_award_mp3")):e.RechargeController.getInstance().showPanel(),this.close()}},i.prototype.readyDestroy=function(){this.ani_zhanshi&&(this.ani_zhanshi.clear(),this.ani_zhanshi=null),this.ani_fashi&&(this.ani_fashi.clear(),this.ani_fashi=null),this.ani_daoshi&&(this.ani_daoshi.clear(),this.ani_daoshi=null)},i.prototype.closeHook=function(){this.x=this.y=0,this.scaleX=this.scaleY=1},i.prototype.getItems=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},i}(e.BasePanel);e.LegendaryEquipPanel=t,__reflect(t.prototype,"foxgame.LegendaryEquipPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.isFrist=!0,i.skinName="skins.loading.LoadingSkin",i.width=400,i.height=200,e.PopUpManager.instance.registerWindow(e.WindowName.LOADING,i,i),i}return __extends(i,t),i.prototype.show=function(){e.Message.instance.add(e.MsgCMD.LOAD_RES,this),this.isFrist||(e.PopUpManager.instance.addPopUp(e.WindowName.LOADING),this.msgLab&&(this.msgLab.text=e.LanguageUtils.instance.getValue("LoadingMsg")))},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.doScreenAdaptation()},i.prototype.close=function(){e.PopUpManager.instance.removePopUp(e.WindowName.LOADING)},i.prototype.clear=function(){e.Message.instance.remove(e.MsgCMD.LOAD_RES,this)},i.prototype.recvMsg=function(t,i){"complete"==i.status?(this.isFrist&&window.ProcessBar&&"function"==typeof ProcessBar.addProcess&&ProcessBar.addProcess(100),this.isFrist=!1):this.isFrist?window.ProcessBar&&"function"==typeof ProcessBar.addProcess&&ProcessBar.addProcess(80/i.groupTotal):this.msgLab&&(this.msgLab.text=e.LanguageUtils.instance.getValue("LoadingProcess",i.groupLoaded,i.groupTotal))},i}(e.ViewControler);e.LoadingControler=t,__reflect(t.prototype,"foxgame.LoadingControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/login/AnnouncementPanel.exml")||this;return i.htmlParser=new egret.HtmlTextParser,i.model=e,i.setIsShowBackBtn(!1),i.setIsShowTween(!1),i.setEffect(!1),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this)},i.prototype.refresh=function(){try{this.ui.contentLabel.textFlow=this.htmlParser.parse(this.model.noticeContent)}catch(e){console.error(e)}},i.prototype.closeHandler=function(t){this.close();var i=e.GamePlatform.logDomain;e.GameUtils.httpSend(i,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID(),channelid:"qqgame",level:"1"},what:"close_notice",who:e.UserInfo.platform.getPuid()})),RES.loadGroup("mainLoadingPanelGroup",e.Global.LoadMainLoadingUIGroupPriority)},i}(e.BasePanel);e.AnnouncementPanel=t,__reflect(t.prototype,"foxgame.AnnouncementPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=e.MsgCMD,i=function(){function i(){this.isNewRole=!1,this.model=new e.LoginModel,this.loginPanel=new e.LoginPanel(this.model),this.serverPanel=new e.ServerListPanel(this.model),this.announcementPanel=new e.AnnouncementPanel(this.model),this.privacyPanel=new e.PrivacyPanel}return i.prototype.recvMsg=function(i,n){switch(i){case e.Code.LOGIN_S:this.loginSuccess(n);break;case e.Code.ERROR:this.showTips(n);break;case t.NetWork_Closed_Msg:case t.NetWork_Connect_Error_Msg:case t.NetWork_Connect_TimeOut_Msg:this.model.setStartBtnState(!0),App.LittleLoading().hideLoading("LoginPanel"),e.Global.isNewPuidRegisterNoLoginPanel&&this.loginPanel.show()}},i.prototype.showTips=function(t){switch(App.LittleLoading().hideLoading("LoginController showTips"),t.getErrCode()){case 15:e.GameUtils.MSG_TIP("当前账号被封禁");break;default:console.log("%c错误码:"+t.getErrCode()+"信息:"+t.getErrMsg(),"color:red;font-size:20px")}},i.prototype.requestLoginServer=function(){this.closeServerPanel();var t=e.GameUtils.formatBrowserDeviceSystemInfo();console.log("将要传送的pf "+t);var i=HawkProtocolManager.newBuilder("JsProto.HPLogin");if(-1!=e.PlayerService.instance.puid.indexOf("wanba_ts")&&window.TDAPP.onEvent("玩吧","login",{platformStr:t,puid:e.PlayerService.instance.puid,device:egret.Capabilities.os}),-1!=e.PlayerService.instance.puid.indexOf("wanba_ts")&&"H5.QZONE.PC"==t.split("#")[5]){var n=e.PlayerService.instance.puid.split("_");e.PlayerService.instance.puid="qqgame_"+n[2]}console.log("requestLoginServer:PlayerService.instance.puid"+e.PlayerService.instance.puid+"  hpLogin"+i),i.setPuid(e.PlayerService.instance.puid);var o=e.Global.serverId;i.setServerId(o);var a=e.GameUtils.getBrowserDeviceUUID();if(e.MainControler.instance.xwydeviceUUIDstr=a,i.setDeviceId(a),i.setPlatform(t),-1!=checkPlatformStr().indexOf("qqgame")){e.Global.launchScene=getlaunchOptionsQQ().scene;var s=i.getPlatform();console.log("pfinof----  "+s)}var r=egret.getOption("uid");null!=r&&i.setOpenid(r);var l=egret.getOption("appKey");null!=l&&i.setOpenKey(l);var h=egret.getOption("platform");null!=h&&i.setPf(h);var c=egret.getOption("appid");null!=c&&i.setAppid(c);var u=egret.getOption("path"),p=egret.getOption("via");null!=u&&-1!=u.indexOf("gdt")?i.setChannelParame(String("QQVip"==e.UserInfo.platform.chanel)+"&"+u):null!=p?i.setChannelParame(String("QQVip"==e.UserInfo.platform.chanel)+"&"+p):e.Global.launchScene?i.setChannelParame(String("QQVip"==e.UserInfo.platform.chanel)+"&"+e.Global.launchScene):i.setChannelParame(String("QQVip"==e.UserInfo.platform.chanel)+"&0"),"H5.QZONE.PC"==t.split("#")[5]?i.setWanBaParame("appid="+e.UserInfo.platform.game_id+"&openid="+e.UserInfo.platform.uid+"&openkey="+e.UserInfo.platform.appKey+"&pf=qqgame&format=json&userip="):i.setWanBaParame("appid="+e.UserInfo.platform.game_id+"&openid="+e.UserInfo.platform.uid+"&openkey="+e.UserInfo.platform.appKey+"&pf=wanba_ts&format=json&userip="),e.Message.instance.send(e.Code.LOGIN_C,i,!0)},i.prototype.getCreatePlayerTime=function(){return this.createPlayerTime},i.prototype.loginSuccess=function(t){if(console.log("loginSuccess"),this.createPlayerTime=t.getPlayerCreateTime(),"mfsqgame"==window.GJlenged_chanel&&(this.model.mfslSceneId=t.getSceneValue(),e.ActivityController.getIntance().getModel().mfslSceneId=t.getSceneValue()),e.Global.newServerId=t.getCurrServerId().toString(),e.MtaUtils.notifyEvent("jibenzhuanhua",{loginsuccessgamesvr:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_recvLoginGameSvr"}),e.AldUtils.sendEvent("game_recvLoginGameSvr","game_recvLoginGameSvr"),1==e.MtaUtils.checkEventJiaZaiJinYouXi&&e.MtaUtils.notifyEvent("jiazaijinyouxi",{recvloginproto:"true"}),window&&window.newPlayerEvent&&window.newPlayerEvent(),App.LittleLoading().hideLoading("LoginController loginSuccess"),this.closeLoginPanel(),window.loginServerTime=t.getTimeStamp(),window.loginEgretTime=egret.getTimer(),!e.Global.isInit&&this.model){if(e.Global.isNewPlayer=!1,isLocalStorage()&&egret.localStorage.setItem("gjgame_puid",e.PlayerService.instance.puid),t.getRoleItemId()>0)this.model.setIsRoleNew(!1),e.MainLoadingController.instance.startLoad();else{this.model.setIsRoleNew(!0),e.MainLoadingController.instance.showMainLoadingPanel(),e.CreateCharacterController.instance.createCharacter(),e.Global.isNewPlayer=!0;var i={code:"firstCreation",serverId:e.Global.serverId,serverName:e.Global.serverName};e.UserInfo.platform.reportData_legend(i)}this.cleanWhenEnterMainLoad(),e.MtaUtils.notifyEvent("jibenzhuanhua",{needcreatecharacter:"true"}),e.MtaUtils.notifyEvent("chuangjiaojinyo",{needcreaterole:"true"})}else e.MainLoadingController.instance&&e.MainLoadingController.instance.requestLastMessage();e.Global.playerId=t.getPlayerId();var n={code:"loginGameSvr",serverId:e.Global.serverId,data:t,serverName:e.Global.serverName,user_id:e.UserInfo.platform.uid,role_name:e.UserInfo.platform.username,level:t.getPlayerLevel(),roleCTime:t.getPlayerCreateTime(),hlmy_gw:e.UserInfo.platform.hlmy_gw,nonce:e.UserInfo.platform.nonce,url:getGlobalConfig().platformUrl+"/callback/1758GameReport",appKey:e.UserInfo.platform.appKey,name:null==t.getPlayerName()?"":t.getPlayerName(),playerid:e.Global.playerId,platformUrl:e.Global.globalConfig.platformUrl};e.UserInfo.platform.reportData_legend(n)},i.prototype.showLoginPanel=function(){e.Message.instance.add(t.NetWork_Closed_Msg,this),e.Message.instance.add(t.NetWork_Connect_Error_Msg,this),e.Message.instance.add(t.NetWork_Connect_TimeOut_Msg,this),e.Global.isNewPuidRegisterNoLoginPanel||this.loginPanel.show(),this.getUserInfo()},i.prototype.saveSeverName=function(){var e=this.model.getServerDataById(this.model.serverId);this.currentName=e.name,this.isNewRole=this.model.getIsRoleNew()},i.prototype.getSeverName=function(){return this.currentName},i.prototype.getIsRoleNew=function(){return this.isNewRole},i.prototype.setIsRoleNew=function(e){this.isNewRole=e},i.prototype.showServerPanel=function(){return this.model&&this.model.serverId?void this.serverPanel.show():(this.getServerList(),void e.GameUtils.MSG_TIP("正在努力请求区服列表！"))},i.prototype.showAnnouncementPanel=function(){e.UserInfo.platform.requestNotice(this.setNoticeContent.bind(this))},i.prototype.setNoticeContent=function(e){return e?(console.log("公告内容"+e.notice),this.model.noticeContent=e.notice||"",this.model.noticeContent||""==this.model.noticeContent?void this.announcementPanel.show():void console.error("Announcement noticeContent undefined")):void console.error("Announcement url fail")},i.prototype.changeCurrentServer=function(e,t){this.model.serverId=e,this.model.serverName=t,this.model.updateView(),this.closeServerPanel(),"wx_xinghe"==window.GJlenged_chanel&&updateSelfInfo_wxgame_xinghe()},i.prototype.connectServer=function(){setTimeout(function(){e.Message.instance.connectSmart(e.Global.serverHost,e.Global.serverPort,e.Global.wsproxy)},0)},i.prototype.getUserInfo=function(){this.model&&e.UserInfo.platform.reqUserInfo(this.getUserInfoBack.bind(this),this)},i.wanBaCallEgret=function(){Log.trace("wanBaCallEgret"),e.LoginController.instance.getUserInfo()},i.prototype.getUserInfoBack=function(){if(console.log("userinfoback",e.UserInfo.platform.getPuid()),-1!=checkPlatformStr().indexOf("qqgame")){var t=getlaunchOptionsQQ();e.Global.launchOptions=t.query,e.Global.launchScene=t.scene,console.log("小游戏入口值:",e.Global.launchScene)}var i="";i=""!=e.UserInfo.platform.uid&&""!=e.UserInfo.platform.puid?e.UserInfo.platform.getPuid():isLocalStorage()?egret.localStorage.getItem("gjgame_puid"):"",i||(i=""),this.model.setPuid(i),e.Global.isWeChatXiaoChengXuBranch&&(i||egret.Capabilities.runtimeType==egret.RuntimeType.WEB)&&this.getServerList(),e.Global.isWeChatXiaoChengXuBranch||this.getServerList()},i.prototype.setPuid=function(e){console.log("setPuid"+e),this.model.setPuid(e)},i.prototype.getServerList=function(){e.UserInfo.platform.reqServerList(this.getServerListBack,this.model.puid,this)},i.prototype.getServerListBack=function(t){if(!t)return console.error("get Server List Failed!"),e.Global.isNewPuidRegisterNoLoginPanel&&this.loginPanel.show(),e.FundebugUtils.notify("getServerListBack","get Server List Failed!"),void e.MtaUtils.notifyEvent("notify",{msg:"game_getServerListFailed"});if(Log.trace("getserverlistok"),!this.model)return console.error("getServerListBack !this.model"),e.FundebugUtils.notify("getServerListBack","this.model invalid, timeout callback!"),void e.MtaUtils.notifyEvent("notify",{msg:"game_getServerListFailed_model_invalid"});e.MtaUtils.notifyEvent("jibenzhuanhua",{getserverlistok:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_getServerListOk"}),e.AldUtils.sendEvent("game_getServerListOk","game_getServerListOk");var i=t.servers||t.servers;this.model.setAllServerIdList(i);for(var n=isLocalStorage()?egret.localStorage.getItem("gjgame_servers_"+this.model.puid):null,o=null!=n?n.split(","):[],a=[],s=0;s<o.length;s++){var r=parseInt(o[s]);if(r){var l=this.model.getServerDataById(r);l&&a.push(l)}}var h=[];h=t.historyLoginInfo,h||(h=[]),0==h.length&&(h=a),this.model.setMyHistoryServers(h),this.model.serverId=Number(t.defaultSeverID),this.model.getServerDataById(this.model.serverId)||(this.model.serverId=1);for(var c,s=0;s<i.length;s++)if(Number(t.defaultSeverID)==Number(i[s].id)){c=i[s].name;break}this.model.serverName=c,this.model.updateView();var u="https://log.reyun.com/receive/rest/install";e.GameUtils.httpSend(u,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID()}}));for(var p=!0,g=this.model.allServerDataList,s=0;s<g.length;s++)if(0!=g[s].state&&1!=g[s].state){p=!1;break}if(0==h.length&&this.model.puid&&!p)if(window.newPlayerFlag=!0,e.Global.isNewPuidRegisterNoLoginPanel){this.loginPanel.startHandler(null);var d="zsnandonghua",f=d+"_png",m=d+"_json";RES.createGroup(d,[f,m]),App.getResourceUtils().loadGroups("preloadCreateCharacter",["createCharacterPanelGroup",d],function(t){e.GlobalUtil.notifyGlobalPreLoadingProgress(1,1,!0)},this.preloadProgressHandler,this)}else e.GlobalUtil.notifyGlobalPreLoadingProgress(1,1,!0);else{"QQdating"==getchannel()?this.startHander():this.loginPanel.show(),e.GlobalUtil.notifyGlobalPreLoadingProgress(1,1,!0);var y={};y.func="Event_Channel_Resources_loaded",y.params=null,window.egret_quickgame||window.parent.postMessage(JSON.stringify(y),"*")}},i.prototype.startHander=function(){console.log("开始游戏"),console.log("puid:"+this.model.puid+"  serverId:"+this.model.serverId);var t=egret.getOption("serverid"),n=e.JsonDataManager.instance.qqServerListTemplate[t];if(n&&(this.model.serverId=n.serverId),e.GlobalUtil.speedLoadResGroupAtLoginPanel(),0==e.MtaUtils.checkEventJiaZaiJinYouXi&&(e.MtaUtils.notifyEvent("jiazaijinyouxi",{clickconnectgamesvr:"true"}),e.MtaUtils.checkEventJiaZaiJinYouXi=!0),!this.model.puid)return e.GameUtils.MSG_TIP("请先登录账号！"),void e.FundebugUtils.notify("startLoginGameSvr","请先登录账号！");if(!this.model||!this.model.serverId)return i.instance.getServerList(),e.GameUtils.MSG_TIP("正在努力请求区服列表！"),void e.FundebugUtils.notify("startLoginGameSvr","正在努力请求区服列表！");e.MtaUtils.notifyEvent("jibenzhuanhua",{startconnectgamesvr:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_startConnectGameSvr"}),e.AldUtils.sendEvent("game_startConnectGameSvr","game_startConnectGameSvr"),e.PlayerService.instance.puid=this.model.puid;var o=this.model.getServerDataById(this.model.serverId);if(!o)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CHOOSESERVER"));e.Global.serverId=o.id.toString(),e.Global.newServerId=o.id.toString(),e.Global.serverName=o.name,e.Global.serverHost=o.address,e.Global.serverPort=o.port,e.Global.wsproxy="http://"+e.Global.serverHost+":"+e.Global.serverPort,e.MainLoadingController.instance.addPreload("activityBarGroup"),e.MainLoadingController.instance.addPreload("mainUIGroup"),i.instance.connectServer(),i.instance.saveSeverName(),window.sdk&&window.sdk.SelectServer&&window.sdk.SelectServer(e.Global.serverId,e.Global.serverName,e.PlayerService.instance.puid),App.LittleLoading().showLoading("LoginPanel");var a=egret.setTimeout(function(){egret.clearTimeout(a),a=0,App.LittleLoading().hideLoading("LoginPanel")},this,1e4)},i.prototype.preloadProgressHandler=function(t,i){e.GlobalUtil.notifyGlobalPreLoadingProgress(t,i)},i.prototype.closeLoginPanel=function(){e.Message.instance.remove(t.NetWork_Closed_Msg,this),e.Message.instance.remove(t.NetWork_Connect_Error_Msg,this),e.Message.instance.remove(t.NetWork_Connect_TimeOut_Msg,this),this.loginPanel&&this.loginPanel.close()},i.prototype.closeServerPanel=function(){this.serverPanel&&this.serverPanel.close()},i.prototype.cleanWhenEnterMainLoad=function(){if(this.model){var e=isLocalStorage()?egret.localStorage.getItem("gjgame_servers_"+this.model.puid):null,t=null!=e?e.split(","):[];if(t.indexOf(this.model.serverId+"")<0){t.push(this.model.serverId+"");for(var i="",n=t.length,o=0;n>o;++o)i=i+t[o]+",";egret.localStorage.setItem("gjgame_servers_"+this.model.puid,i)}}this.serverPanel&&this.serverPanel.freeSelf(),this.serverPanel=null,this.loginPanel&&this.loginPanel.freeSelf(),this.loginPanel=null,this.announcementPanel&&(this.announcementPanel.close(),this.announcementPanel.freeSelf()),this.announcementPanel=null,this.model&&this.model.cleanData(),this.model=null},i.prototype.getmodel=function(){return this.model},i.prototype.hwRestLogin=function(e){this.model.puid=e,this.loginPanel.hwsetPuid()},i.prototype.showFriendsRankUi=function(t){console.log("MainControler.instance.showFriendsRankUi(ui)"),e.MainControler.instance.showFriendsRankUi(t)},Object.defineProperty(i,"instance",{get:function(){return null==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.showPrivacyPanel=function(){this.privacyPanel.showPanel("")},i.prototype.refreshLogin=function(e){console.log("刷新登录"),this.model.puid=e,this.loginPanel.getIsShow&&this.loginPanel.hwsetPuid(),this.getUserInfo()},i}();e.LoginController=i,__reflect(i.prototype,"foxgame.LoginController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.mfslSceneId="",this.observerList=[]}return t.prototype.registerObserver=function(e){this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.refreshView()},t.prototype.setIsRoleNew=function(t){e.LoginController.instance.setIsRoleNew(t)},t.prototype.getIsRoleNew=function(){return this.isRoleNew},t.prototype.setPuid=function(e){this.puid=e,this.updateView()},t.prototype.setAllServerIdList=function(e){this.allServerDataList=e,this.allServerDataList.sort(this.serverSortFun)},t.prototype.setMyHistoryServers=function(e){this.myServerDataList=e},t.prototype.serverSortFun=function(t,i){var n,o;return e.Global.globalConfig.isDebug?(n=Number(t.state),o=Number(i.state)):(n=Number(t.id),o=Number(i.id)),n>o?-1:n==o?0:o>n?1:void 0},t.prototype.getServerDataById=function(e){for(var t={},i=this.allServerDataList.length,n=0;i>n;n++)if(this.allServerDataList[n].id==e){t=this.allServerDataList[n];break}return t},t.prototype.setStartBtnState=function(e){if(e)for(var t=void 0,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.resetStartBtn()},t.prototype.cleanData=function(){this.allServerDataList=null,this.myServerDataList=null,this.observerList=null,this.noticeContent=null},t.devicePlatformStr="",t}();e.LoginModel=t,__reflect(t.prototype,"foxgame.LoginModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/login/LoginPanel.exml","loginPanelGroup")||this;return i.stonePool=[],i.stoneList=[],i.lastStoneTime=-1,i.xyw_banGameTimeArray=[22,23,0,1,2,3,4,5,6,7],i.privacyFlag=!0,i.isMask=!1,i.setIsShowBackBtn(!1),i.setIsShowTween(!1),i.setEffect(!1),i.setRegisterTick(!0),i.setIsTextureCache(!0),i.isTextureCache=!0,i.model=e,i.adaptionType=0,console.log("登录页面构造"),i}return __extends(i,t),i.prototype.initHook=function(){var t=e.GamePlatform.logDomain;e.GameUtils.httpSend(t,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID(),channelid:"qqgame",level:"1"},what:"login_game",who:this.model.puid})),ScreenAdaptation.instance.adaptLogin(this.ui),this.model.registerObserver(this),this.ui.serverBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.serverClickHandler,this),this.ui.startBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startHandler,this),this.ui.accountLabel.addEventListener(egret.Event.CHANGE,this.accountChangeHandler,this),this.ui.accountLabel.addEventListener(egret.FocusEvent.FOCUS_IN,this.changeCDKIn,this),this.ui.accountLabel.addEventListener(egret.FocusEvent.FOCUS_OUT,this.changeCDKOut,this),this.ui.boardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.boardHandler,this),this.ui.boardBtn.right=60,e.Global.isWeChatXiaoChengXuBranch&&(this.ui.boardBtn.y=this.ui.boardBtn.y+80),e.Global.isAppStoreReview&&(this.ui.accountLabel.visible=!1,this.ui.boardBtn.visible=!1),this.stoneDelay=Number(e.GlobalConfig.instance.getValue("LOGINSTONEDELAY")),this.ui.accountGroup.visible=e.Global.globalConfig.isDebug,-1!=String(getGlobalConfig().serverUrl).indexOf("test")&&(this.ui.accountGroup.visible=!0);var i=(ScreenAdaptation.instance.uiWidth/this.ui.width,window.codeVersion||""),n=e.Global.version||"";this.ui.versionLab.text="v"+i+" r"+n,e.LoginController.instance.showAnnouncementPanel()},i.prototype.initParams=function(){this.lastStoneTime=egret.getTimer(),this.lastTweenStoneTime=this.lastStoneTime},i.prototype.changeCDKIn=function(t){if(this.ui.accountLabel){this.ui.accountLabel.textColor=16777215;var i=this.ui.accountLabel.text;""!=i?i==e.LanguageUtils.instance.getValue("SHURUZHANGHAO")&&(this.ui.accountLabel.text=""):this.ui.accountLabel.text=""}},i.prototype.changeCDKOut=function(t){if(this.ui.accountLabel){var i=this.ui.accountLabel.text;""!=i?this.ui.accountLabel.textColor=16777215:(this.ui.accountLabel.textColor=6381921,this.ui.accountLabel.text=e.LanguageUtils.instance.getValue("SHURUZHANGHAO"))}},i.prototype.showHook=function(){console.log("打开登录界面 End"),this.ani=new e.FoxAni(this.ui.logingroup),this.ani.play("ksyxFX","ani",-1);var t=egret.getOption("pf");"jiayoubz"==t||"azypadyz"==t||"bzypadyz"==t?(this.ui.ziyun_yyb_privacy.visible=!0,this.setPrivacyBtnSelect0(!0),this.ui.privacyLabel0.textFlow=[{text:"用户服务协议",style:{size:18,textColor:3458560,underline:!0}}],this.ui.privacyBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.privacyBtnHandler0,this),this.ui.privacyLabel0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.privacyLabelHandler0,this)):e.GamePlatform.isDragonEx?(this.setPrivacyBtnSelect0(!0),this.ui.ziyun_yyb_privacy.visible=!0,this.ui.label_txt.text="",this.ui.privacyBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.privacyBtnHandler0,this),this.ui.privacyLabel0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.privacyLabelHandler0,this)):"1108023326"==getGlobalConfig().wanBaAppId?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font>本游戏由“深圳一凡”提供 \n< /font><font>如在游戏中遇到问题,请联系我们的在线客服：800824122< /font>"):"1107925907"==getGlobalConfig().wanBaAppId?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font>本游戏由“冰玩网络”提供 \n< /font><font>如在游戏中遇到问题,请联系我们的在线客服：2322310853< /font>"):-1!=checkPlatformStr().indexOf("yybrxbyol")||-1!=checkPlatformStr().indexOf("cuigeyijie3")||-1!=checkPlatformStr().indexOf("cuigeyijie1")?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font size:10>著作权人：北京飞狐互动网络科技有限公司 软著登记号：2016SR351279\n</font>< font size:10>出版物号：ISBN 978-7-7979-6897-3\n< /font>< font size:10>审批文号：新广出审[2017]3435号 出版单位：三辰影库音像出版社有限公司\n< /font>"):"jdh5_"==e.UserInfo.platform.prefix||-1!=checkPlatformStr().indexOf("opporpk")||"vivogame"==getchannel()||-1!=e.UserInfo.platform.prefix.indexOf("suyi")||-1!=String(getGlobalConfig().serverUrl).indexOf("dcuc")||-1!=e.UserInfo.platform.prefix.indexOf("bagfquick")?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font size:10>审批文号：新广出审[2018]415号  软著登记号：2017SR148888\n</font>< font size:10>出版物号：ISBN 978-7-498-03887-6\n< /font>< font size:10>著作权人：重庆盟岩科技有限公司  出版单位：北京伯通电子出版社\n< /font>"):"mlqld"==getchannel()?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font size:10>新广出审[2017]2489号   ISBN 978-7-7979-5951-3\n</font>< font size:10>运营单位:北京（欢动）科技有限公司  登记号:2017SR010013 \n< /font>< font size:10>著作权人:北京（欢动）科技有限公司  出版单位:北京科海电子出版社\n< /font>"):"newOppogame"==getchannel()||"newoppogame"==getchannel()?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font size:10>审批文号：新广出审[2016]4307号   文网游备字：[2016]M-RPG 366\n</font>< font size:10>出版物号：ISBN 978-7-7979-2868-7 \n< /font>< font size:10>著作权人:上海跳跳虎网络科技有限公司  出版单位:北京伯通电子出版社\n< /font>"):getchannel()&&-1!=getchannel().indexOf("fdbt")?(this.ui.fdbt_txt.visible=!0,this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("< font size:10>本网络游戏适合年满16周岁以上的用户使用：请您确认已如实进行实名注册\n< /font><font size:10>审批文号：国新出审[2019]296号 ISBN 978-7-498-05827-0\n</font>< font size:10>著作权人:南京碧讯网络科技有限公司 \n< /font>< font size:10>出版单位:江苏凤凰电子音像出版社有限公司 \n< /font>")):-1!=checkPlatformStr().indexOf("mfxyxmgame")||-1!=checkPlatformStr().indexOf("mfxyoppo")?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font size:10>审批文号：新广出审[2017]4596号 ISBN 978-7-7979-8010-4\n</font>< font size:10>著作权人:成都雪隼科技有限公司 \n< /font>< font size:10>出版单位:北京艺术与科学电子出版社 \n< /font>"):this.ui.label_txt.text="",this.playFire()},i.prototype.playFire=function(){this.fireAni1=new e.FoxAni(this.ui.fireGroup1),this.fireAni1.play("loginFire","ani",-1),this.fireAni2=new e.FoxAni(this.ui.fireGroup2),this.fireAni2.play("loginFire","ani",-1),this.fireAni3=new e.FoxAni(this.ui.fireGroup3),this.fireAni3.play("loginFire","ani",-1),this.fireAni4=new e.FoxAni(this.ui.fireGroup4),this.fireAni4.play("loginFire","ani",-1)},i.prototype.refresh=function(){if(null!=this.model.allServerDataList){this.ui.accountLabel.text=this.model.puid,this.ui.accountLabel.text.length?this.ui.accountLabel.textColor=16777215:(this.ui.accountLabel.textColor=6381921,this.ui.accountLabel.text=e.LanguageUtils.instance.getValue("SHURUZHANGHAO"));var t=this.model.getServerDataById(this.model.serverId);if(t)switch(this.ui.serverLabel.text=t.name,this.state=t.state,this.state){case 1:this.ui.huoImg.source="weihu_png";
break;case 2:this.ui.huoImg.source="xin_png";break;case 3:this.ui.huoImg.source="huo_png";break;case 0:case 4:this.ui.huoImg.source="neiwang_png";break;default:this.ui.huoImg.source=""}}},i.prototype.refreshView=function(){this.refresh()},i.prototype.resetStartBtn=function(){this.ui.startBtn&&(this.ui.startBtn.touchEnabled=!0)},i.prototype.serverClickHandler=function(t){e.LoginController.instance.showServerPanel()},i.prototype.accountChangeHandler=function(e){this.model.puid=this.ui.accountLabel.text},i.prototype.boardHandler=function(t){e.Global.isAppStoreReview||e.LoginController.instance.showAnnouncementPanel()},i.prototype.newPuidRegisterNoLoginPanelFallback=function(){e.Global.isNewPuidRegisterNoLoginPanel&&this.show()},i.prototype.youkeYes=function(){window.close();var t="22时至次日8时游戏不对未成年人开放！";e.PopUpController.getInstance().showTextPanel(t,this,null,"",null,"","hide","No",20,!1,!1)},i.prototype.startHandler=function(t){var i=this;this.ui&&null!=this.ui.startBtn&&(this.ui.startBtn.enabled=!1,setTimeout(function(){i.ui&&i.ui.startBtn&&(i.ui.startBtn.enabled=!0)},2e3));var n=egret.getOption("xyw_platform");if(""!=n&&"xyw"==n){var o=egret.getOption("xyw_isAdult");if("0"==o)for(var a=(new Date).getHours(),s=0;s<this.xyw_banGameTimeArray.length;s++)if(a==this.xyw_banGameTimeArray[s]){var r="22时至次日8时游戏不对未成年人开放！";return void e.PopUpController.getInstance().showTextPanel(r,this,this.youkeYes,"",null,"","确定","No",20,!1,!1)}}if(!this.privacyFlag)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("PRIVACYPROTOCAL"));if("dchwgame"==window.GJlenged_chanel){var l=getHwLoadStatus();"yes"==l&&dchwgameResetLogin()}if("wx_xinghe"==window.GJlenged_chanel&&updateSelfInfo_wxgame_xinghe(),console.log("开始游戏"),console.log("puid:"+this.model.puid+"  serverId:"+this.model.serverId),e.GlobalUtil.speedLoadResGroupAtLoginPanel(),0==e.MtaUtils.checkEventJiaZaiJinYouXi&&(e.MtaUtils.notifyEvent("jiazaijinyouxi",{clickconnectgamesvr:"true"}),e.MtaUtils.checkEventJiaZaiJinYouXi=!0),!this.model.puid)return"wanba_ts"==getchannel()&&(e.GameUtils.MSG_TIP("登陆失败，请重启游戏进行登陆"),this.newPuidRegisterNoLoginPanelFallback()),e.GameUtils.MSG_TIP("请先登录账号！"),this.newPuidRegisterNoLoginPanelFallback(),void e.FundebugUtils.notify("startLoginGameSvr","请先登录账号！");if(!this.model||!this.model.serverId)return e.LoginController.instance.getServerList(),e.GameUtils.MSG_TIP("正在努力请求区服列表！"),this.newPuidRegisterNoLoginPanelFallback(),void e.FundebugUtils.notify("startLoginGameSvr","正在努力请求区服列表！");if(!e.Global.isNewPuidRegisterNoLoginPanel){var h=this.ui.accountLabel.text;if(0==h.length||h==e.LanguageUtils.instance.getValue("SHURUZHANGHAO"))return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHURUZHANGHAO")),"function"==typeof ImagineInit&&ImagineInit(),this.newPuidRegisterNoLoginPanelFallback(),void e.FundebugUtils.notify("startLoginGameSvr","请先登录账号...！")}if(1==this.state)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SERVERSTOPPLEASEWAIT")),egret.Tween.get({}).wait(3e4).call(function(){e.LoginController.instance.getServerList()}),e.LoginController.instance.showAnnouncementPanel(),this.newPuidRegisterNoLoginPanelFallback(),void e.FundebugUtils.notify("startLoginGameSvr","服务器状态：关闭...！");e.MtaUtils.notifyEvent("jibenzhuanhua",{startconnectgamesvr:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_startConnectGameSvr"}),e.AldUtils.sendEvent("game_startConnectGameSvr","game_startConnectGameSvr"),e.PlayerService.instance.puid=this.model.puid;var c=this.model.getServerDataById(this.model.serverId);if(!c)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CHOOSESERVER"));e.Global.serverId=c.id.toString(),e.Global.newServerId=c.id.toString(),e.Global.serverName=c.name,e.Global.serverHost=c.address,e.Global.serverPort=c.port,e.Global.wsproxy="http://"+e.Global.serverHost+":"+e.Global.serverPort,e.MainLoadingController.instance.addPreload("activityBarGroup"),e.MainLoadingController.instance.addPreload("mainUIGroup"),e.LoginController.instance.connectServer(),e.LoginController.instance.saveSeverName(),window.sdk&&window.sdk.SelectServer&&window.sdk.SelectServer(e.Global.serverId,e.Global.serverName,e.PlayerService.instance.puid),e.Global.isNewPuidRegisterNoLoginPanel||null==this.ui.startBtn||(this.ui.startBtn.touchEnabled=!1),App.LittleLoading().showLoading("LoginPanel");var u=egret.setTimeout(function(){egret.clearTimeout(u),u=0,App.LittleLoading().hideLoading("LoginPanel")},this,1e4)},i.prototype.tickHook=function(e){if(!(this.lastStoneTime<0)){var t=e-this.lastTweenStoneTime;this.lastTweenStoneTime=e,this.tweenStone(t);var i=e-this.lastStoneTime;if(!(i<this.stoneDelay)){this.lastStoneTime=e;var n=this.getStone();n.randomStone(),n.x=Math.floor(Math.random()*(this.ui.width-n.width)),n.y=this.ui.height,this.ui.stoneGroup.addChild(n),this.stoneList.push(n)}}},i.prototype.tweenStone=function(e){if(0!=this.stoneList.length)for(var t,i,n=this.stoneList.length,o=this.ui.stoneGroup,a=0;n>a;a++)t=this.stoneList[a],null!=t&&(i=t.speed/1e3*e,t.y-=i,t.y<-t.height&&(o.removeChild(t),this.stoneList.splice(a,1),this.restoreStone(t),a--))},i.prototype.privacyBtnHandler0=function(e){this.setPrivacyBtnSelect0(this.ui.privacyBtn0.selected)},i.prototype.privacyLabelHandler0=function(t){e.LoginController.instance.showPrivacyPanel()},i.prototype.setPrivacyBtnSelect0=function(e){this.privacyFlag=e,this.ui.privacyBtn0.selected=e},i.prototype.getStone=function(){return this.stonePool.length>0?this.stonePool.pop():new e.Stone},i.prototype.restoreStone=function(e){this.stonePool.push(e)},i.prototype.closeHook=function(){this.ui&&this.ui.removeChildren(),this.ui=null,this.stonePool.splice(0,this.stonePool.length),this.stonePool=null,this.fireAni1.clear(),this.fireAni1=null,this.fireAni2.clear(),this.fireAni2=null,this.fireAni3.clear(),this.fireAni3=null,this.fireAni4.clear(),this.fireAni4=null,this.ani&&(this.ani.clear(),this.ani=null),this.loginBtnAni&&this.loginBtnAni.clear(),this.loginBtnAni=null},i.prototype.hwsetPuid=function(){this.refresh()},i}(e.BasePanel);e.LoginPanel=t,__reflect(t.prototype,"foxgame.LoginPanel",["foxgame.ILogin","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){return e.call(this,"PrivacySkin")||this}return __extends(t,e),t.prototype.initHook=function(){return this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this)},t.prototype.showPanel=function(e){this.show()},t.prototype.closeHandler=function(e){this.close()},t}(e.BasePanel);e.PrivacyPanel=t,__reflect(t.prototype,"foxgame.PrivacyPanel")}(foxgame||(foxgame={}));var QQServerListVo=function(){function e(){}return e}();__reflect(QQServerListVo.prototype,"QQServerListVo");var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ServerListItem1",t}return __extends(t,e),t.prototype.init=function(){},t.prototype.dataChanged=function(){if(e.prototype.dataChanged.call(this),this.index=this.data,-2==this.data)this.nameLabel.text="内测专区";else{var t=this.data.split("_");this.nameLabel.text=t[0],this.index=Number(t[1])}},t.prototype.setSelect=function(e){this.touchbtn=e,this.btn.currentState=e},t.prototype.clickHandler=function(e){},t}(eui.ItemRenderer);e.ServerListItem1=t,__reflect(t.prototype,"foxgame.ServerListItem1")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="ServerListItem2",this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.setItem=function(e,t){if(e){this.model=t,this.data=e,this.nameLabel.text=this.data.name;var i=e.state;switch(i){case 1:this.huoImg.source="weihu_png";break;case 2:this.huoImg.source="xin_png";break;case 3:this.huoImg.source="huo_png";break;case 0:case 4:this.huoImg.source="neiwang_png";break;default:this.huoImg.source=""}}},i.prototype.clickHandler=function(t){e.LoginController.instance.changeCurrentServer(this.data.id,this.data.name)},i.prototype.clear=function(){null!=this.parent&&this.parent.removeChild(this)},i}(eui.Component);e.ServerListItem2=t,__reflect(t.prototype,"foxgame.ServerListItem2")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/login/ServerListPanel.exml")||this;return i.gapY=20,i.iswbqldServer=!1,i.selectIndex=0,i.model=e,i.isMask=!0,i.setIsShowBackBtn(!1),i}return __extends(i,t),i.prototype.closeHook=function(){var t={code:"userstatus",datatype:1,serverId:this.model.serverId,serverName:this.model.serverName,level:0,name:0,playerid:0,fightvalue:0};e.UserInfo.platform.reportData_legend(t)},i.prototype.initHook=function(){this.gameId=this.getServerGameId(),this.serverDic=this.getServerDic(),this.ui.recentlyItem1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.recentClickHandler,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.iswbqldServer=-1!=String(getGlobalConfig().serverUrl).indexOf("wanbaqld");var t=this.model.allServerDataList.length;this.collection=new eui.ArrayCollection,this.ui.serverlist1.dataProvider=this.collection,this.ui.serverlist1.itemRenderer=e.ServerListItem1;this.ui.qldBtnGroup.visible=!1,this.ui.xqwdGroup.visible=!1,this.ui.fdGroup.visible=!1,this.ui.xqh5Group.visible=!1,this.ui.zyxcxGroup.visible=!1,this.iswbqldServer&&t>=e.Global.serverOld_qld&&(this.ui.qldBtnGroup.visible=!0,this.ui.rexueBtn.addEventListener(eui.UIEvent.CHANGE,this.onChange,this),this.ui.zhanBtn.addEventListener(eui.UIEvent.CHANGE,this.onChange,this),this.ui.aojianBtn.addEventListener(eui.UIEvent.CHANGE,this.onChange,this)),"xqwd_legend"==this.gameId&&t>=e.Global.xqwdOld_xqwd&&(this.ui.xqwdGroup.visible=!0,this.ui.xqwdBtn0.addEventListener(eui.UIEvent.CHANGE,this.onChange1,this),this.ui.xqwdBtn1.addEventListener(eui.UIEvent.CHANGE,this.onChange1,this),this.ui.xqwdBtn2.addEventListener(eui.UIEvent.CHANGE,this.onChange1,this),this.ui.xqwdBtn3.addEventListener(eui.UIEvent.CHANGE,this.onChange1,this),t<e.Global.xqwdNew_xqwd&&this.ui.xqwdGroup.removeChild(this.ui.xqwdBtn3)),"h5_legend"==this.gameId&&t>=e.Global.serverOld_fd&&(this.ui.fdGroup.visible=!0,this.ui.fdBtn.addEventListener(eui.UIEvent.CHANGE,this.fdTabOnChange,this),this.ui.fdBtn1.addEventListener(eui.UIEvent.CHANGE,this.fdTabOnChange,this)),"xq_legend"==this.gameId&&t>=e.Global.serverOld_xqh5&&(this.ui.xqh5Group.visible=!0,this.ui.xqh5Btn.addEventListener(eui.UIEvent.CHANGE,this.xqh5TabOnChange,this),this.ui.xqh5Btn1.addEventListener(eui.UIEvent.CHANGE,this.xqh5TabOnChange,this)),"zyxcx_legend"==this.gameId&&t>=e.Global.serverOld_zyxcxNum&&(this.ui.zyxcxGroup.visible=!0,this.ui.zyxcxBtn.addEventListener(eui.UIEvent.CHANGE,this.zyxcxTabOnChange,this),this.ui.zyxcxBtn1.addEventListener(eui.UIEvent.CHANGE,this.zyxcxTabOnChange,this),this.ui.zyxcxBtn2.addEventListener(eui.UIEvent.CHANGE,this.zyxcxTabOnChange,this),t<e.Global.serverNew_zyxcxNum&&this.ui.zyxcxGroup.removeChild(this.ui.zyxcxBtn2))},i.prototype.showHook=function(){if(this.iswbqldServer&&this.model.allServerDataList.length>=e.Global.serverOld_qld){this.selectIndex=Math.floor(this.model.allServerDataList.length/e.Global.serverOld_qld);for(var t=0;t<this.ui.qldBtnGroup.numChildren;t++)this.ui.qldBtnGroup.getChildAt(t).selected=t==this.selectIndex}if("xqwd_legend"==this.gameId&&this.model.allServerDataList.length>=e.Global.xqwdOld_xqwd){this.selectIndex=3;for(var t=0;t<this.ui.xqwdGroup.numChildren;t++)this.ui.xqwdGroup.getChildAt(t).selected=t==this.selectIndex}if("h5_legend"==this.gameId&&this.model.allServerDataList.length>=e.Global.serverOld_fd){this.selectIndex=1;for(var t=0;t<this.ui.fdGroup.numChildren;t++)this.ui.fdGroup.getChildAt(t).selected=t==this.selectIndex}if("xq_legend"==this.gameId&&this.model.allServerDataList.length>=e.Global.serverOld_xqh5){this.selectIndex=1;for(var t=0;t<this.ui.xqh5Group.numChildren;t++)this.ui.xqh5Group.getChildAt(t).selected=t==this.selectIndex}if("zyxcx_legend"==this.gameId&&this.model.allServerDataList.length>=e.Global.serverOld_zyxcxNum){this.selectIndex=this.ui.zyxcxGroup.numChildren-1;for(var t=0;t<this.ui.zyxcxGroup.numChildren;t++)this.ui.zyxcxGroup.getChildAt(t).selected=t==this.selectIndex}var i=[];i=this.getServerGroupIndexData(),this.ui.serverlist1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.touchserver,this),i.reverse(),this.collection.replaceAll(i),this.ui.scroller1.verticalScrollBar.autoVisibility=!1,this.ui.scroller2.verticalScrollBar.autoVisibility=!1},i.prototype.onChange=function(e){e.target.selected=!0;var t=this.ui.qldBtnGroup.getChildIndex(e.target);if(t!=this.selectIndex){this.selectIndex=t;for(var i=0;i<this.ui.qldBtnGroup.numChildren;i++)this.ui.qldBtnGroup.getChildAt(i).selected=i==t;for(var n=this.ui.serverlist1.numChildren,i=0;n>i;i++)this.ui.serverlist1.getChildAt(i).setSelect("up");this.model.groupIndex=-1,this.ui.recentlyItem1.setSelect("down");var o=[];o=this.getServerGroupIndexData(),o.reverse(),this.collection.replaceAll(o),this.ui.scroller1.verticalScrollBar.autoVisibility=!1,this.ui.scroller2.verticalScrollBar.autoVisibility=!1,this.refresh()}},i.prototype.onChange1=function(e){e.target.selected=!0;var t=this.ui.xqwdGroup.getChildIndex(e.target);if(t!=this.selectIndex){this.selectIndex=t;for(var i=0;i<this.ui.xqwdGroup.numChildren;i++)this.ui.xqwdGroup.getChildAt(i).selected=i==t;for(var n=this.ui.serverlist1.numChildren,i=0;n>i;i++)this.ui.serverlist1.getChildAt(i).setSelect("up");this.model.groupIndex=-1,this.ui.recentlyItem1.setSelect("down");var o=[];o=this.getServerGroupIndexData(),o.reverse(),this.collection.replaceAll(o),this.ui.scroller1.verticalScrollBar.autoVisibility=!1,this.ui.scroller2.verticalScrollBar.autoVisibility=!1,this.refresh()}},i.prototype.fdTabOnChange=function(e){e.target.selected=!0;var t=this.ui.fdGroup.getChildIndex(e.target);if(t!=this.selectIndex){this.selectIndex=t;for(var i=0;i<this.ui.fdGroup.numChildren;i++)this.ui.fdGroup.getChildAt(i).selected=i==t;for(var n=this.ui.serverlist1.numChildren,i=0;n>i;i++)this.ui.serverlist1.getChildAt(i).setSelect("up");this.model.groupIndex=-1,this.ui.recentlyItem1.setSelect("down");var o=[];o=this.getServerGroupIndexData(),o.reverse(),this.collection.replaceAll(o),this.ui.scroller1.verticalScrollBar.autoVisibility=!1,this.ui.scroller2.verticalScrollBar.autoVisibility=!1,this.refresh()}},i.prototype.xqh5TabOnChange=function(e){e.target.selected=!0;var t=this.ui.xqh5Group.getChildIndex(e.target);if(t!=this.selectIndex){this.selectIndex=t;for(var i=0;i<this.ui.xqh5Group.numChildren;i++)this.ui.xqh5Group.getChildAt(i).selected=i==t;for(var n=this.ui.serverlist1.numChildren,i=0;n>i;i++)this.ui.serverlist1.getChildAt(i).setSelect("up");this.model.groupIndex=-1,this.ui.recentlyItem1.setSelect("down");var o=[];o=this.getServerGroupIndexData(),o.reverse(),this.collection.replaceAll(o),this.ui.scroller1.verticalScrollBar.autoVisibility=!1,this.ui.scroller2.verticalScrollBar.autoVisibility=!1,this.refresh()}},i.prototype.zyxcxTabOnChange=function(e){e.target.selected=!0;var t=this.ui.zyxcxGroup.getChildIndex(e.target);if(t!=this.selectIndex){this.selectIndex=t;for(var i=0;i<this.ui.zyxcxGroup.numChildren;i++)this.ui.zyxcxGroup.getChildAt(i).selected=i==t;for(var n=this.ui.serverlist1.numChildren,i=0;n>i;i++)this.ui.serverlist1.getChildAt(i).setSelect("up");this.model.groupIndex=-1,this.ui.recentlyItem1.setSelect("down");var o=[];o=this.getServerGroupIndexData(),o.reverse(),this.collection.replaceAll(o),this.ui.scroller1.verticalScrollBar.autoVisibility=!1,this.ui.scroller2.verticalScrollBar.autoVisibility=!1,this.refresh()}},i.prototype.initParams=function(){this.ui.scroller1.viewport.scrollV=0,this.model.groupIndex=-1},i.prototype.refresh=function(){this.ui.scroller2.stopAnimation(),this.ui.scroller2.viewport.scrollV=0;for(var t;this.ui.contentGroup2.numChildren>0;)t=this.ui.contentGroup2.removeChildAt(0),t.clear(),e.ObjectPoolManager.instance.add(t);var i=-1==this.model.groupIndex?this.getHistoryServerData():this.getGroupListData(this.gameId,this.selectIndex,this.model.groupIndex);-1!=this.model.groupIndex&&(i=this.setRightInfo(i));for(var n=i.length,o=0,a=0;n>a;a++)"1"==i[a].displayState&&(t=e.ObjectPoolManager.instance.get("ServerListItem2"),t.y=o*(this.gapY+t.height),t.setItem(i[a],this.model),this.ui.contentGroup2.addChild(t),o++)},i.prototype.setRightInfo=function(e){var t=[];for(var i in e)e[i].serverData&&t.push(e[i].serverData);return this.sortArryOn(t,"id",2),t},i.prototype.recentClickHandler=function(e){if("down"!=this.ui.recentlyItem1.touchbtn){this.model.groupIndex=-1,this.ui.recentlyItem1.setSelect("down");for(var t=this.ui.serverlist1.numChildren,i=0;t>i;i++)this.ui.serverlist1.getChildAt(i).setSelect("up");this.refresh()}},i.prototype.touchserver=function(e){this.ui.recentlyItem1.setSelect("up");var t=e.itemRenderer;if("down"!=t.touchbtn){for(var i=this.ui.serverlist1.numChildren,n=0;i>n;n++)this.ui.serverlist1.getChildAt(n).index==t.index?this.ui.serverlist1.getChildAt(n).setSelect("down"):this.ui.serverlist1.getChildAt(n).setSelect("up");this.model.groupIndex=t.index,this.refresh()}},i.prototype.getHistoryServerData=function(){for(var e,t=[],i=this.model.myServerDataList.length,n=0;i>n;n++)e=this.model.myServerDataList[n],e=this.model.getServerDataById(e.id),t.push(e);return t},i.prototype.getServerGroupIndexData=function(){var t,i,n,o,a=e.JsonDataManager.instance.serverListGroupTemplate,s=[],r=[],l=this.model.allServerDataList.length;for(var h in a)o=h.split(",")[0],n=Number(h.split(",")[1]),this.selectIndex==n&&this.gameId==o&&(t=a[h],s=this.getGroupListData(this.gameId,this.selectIndex,t),i="h5_legend"!=this.gameId&&"zyxcx_legend"!=this.gameId&&"yyb_legend"!=this.gameId||-2==t||0!=this.selectIndex?this.getSectionLabel(s):this.getSpecialSectionLabel(s),-2==t&&(i="内测专区_"+t,r.push(i)),l>=this.getServerMinId(i)?r.push(i):"test_legend"==o&&r.push(i));return r},i.prototype.getServerMinId=function(e){var t=Number(e.split("-")[0]),i=Number(e.split("_")[1]),n=this.getGroupListData(this.gameId,this.selectIndex,i);for(var o in n)if(n[o].serverName-this.intranet==t)return n[o].serverId},i.prototype.getSpecialSectionLabel=function(t){var i=[];for(var n in t)i.push(Number(n));return t[i[0]].serverName-this.intranet+"-"+(t[i[i.length-1]].serverName-this.intranet)+e.LanguageUtils.instance.getValue("QU")+"_"+t[i[0]].group},Object.defineProperty(i.prototype,"intranet",{get:function(){var t=0;switch(this.gameId){case"h5_legend":t=e.Global.serverOld;break;case"yyb_legend":t=e.Global.serverOld_yyb;break;case"zyxcx_legend":t=e.Global.serverOld_zyxcx}return 0!=this.selectIndex?0:t},enumerable:!0,configurable:!0}),i.prototype.getSectionLabel=function(t){var i=[];for(var n in t)i.push(Number(n));return t[i[0]].serverName+"-"+t[i[i.length-1]].serverName+e.LanguageUtils.instance.getValue("QU")+"_"+t[i[0]].group},i.prototype.getGroupListData=function(t,i,n){var o,a,s=e.JsonDataManager.instance.serverListTemplate,r=[];for(var l in s)o=s[l],a=this.serverDic[o.serverId],o.tab==i&&o.group==n&&o.gameid==t&&(o.serverData=a,r.push(o));return r},i.prototype.getServerDic=function(){var e,t=[];for(var i in this.model.allServerDataList)e=this.model.allServerDataList[i],t[e.id]=e;return t},i.prototype.sortArryOn=function(e,t,i){void 0===i&&(i=1),e.sort(function(e,n){return e[t]>n[t]?1==i?1:-1:1==i?-1:1})},i.prototype.getServerGameId=function(){return-1!=String(getGlobalConfig().serverUrl).indexOf("test")&&"1"==String(getGlobalConfig().pingce)?"pingce_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("blqkl")?"blqkl_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("mfxhgate.biggerking.cn")?"mfxh_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("test")?"test_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("rxdjbapi.biggerking.cn")?"mfxinyu_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("yyb")?"yyb_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("zyxcx")?"zyxcx_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("wanbaqld")?"wbqld_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("yl-res")?"xq_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("yl-xbtx-res")?"xqwd_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("guandu")?"gd_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("jrtt")?"jrtt_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend-dimai.biggerking.cn")?"fdbt_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("gatemanfangcq.couplefish.com")?"mfsq_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend-mrbj.6deer.com")?"mrbj_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("mlqld")?"mlqld_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend.6deer.com")?"h5_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("by1758")?"by1758_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("648sy")?"yougu_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("xy")?"xy_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("cycq")?"jiuxiu_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("dcuc")?"dcuc_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("dcerf")?"dcerf_legend":-1!=String(getGlobalConfig().serverUrl).indexOf("rxdjapi")?"zwmf_legend":"h5_legend"},i.count=50,i}(e.BasePanel);e.ServerListPanel=t,__reflect(t.prototype,"foxgame.ServerListPanel")}(foxgame||(foxgame={}));var ServerListVo=function(){function e(){}return e}();__reflect(ServerListVo.prototype,"ServerListVo");var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.skinName="Stone",i.stoneSpeed=Number(e.GlobalConfig.instance.getValue("LOGINSTONESPEED")),i.stoneSpeedRatio=Number(e.GlobalConfig.instance.getValue("LOGINSTONESPEEDRATIO")),i}return __extends(i,t),i.prototype.childrenCreated=function(){this.randomStone()},i.prototype.randomStone=function(){var e=Math.random();this.stoneImg1.visible=e>=.5,this.stoneImg2.visible=.5>e,this.speed=Math.floor(this.stoneSpeed+Math.random()*this.stoneSpeedRatio)},i}(eui.Component);e.Stone=t,__reflect(t.prototype,"foxgame.Stone")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.UNREAD=0]="UNREAD",e[e.READED=1]="READED",e[e.GOT=2]="GOT",e[e.NOTGET=3]="NOTGET"}(t=e.MailStatus||(e.MailStatus={}));var i=function(){function i(){this.model=new e.MailModel,this.panel=new e.MailPanel(this.model),this.detailPanel=new e.MailDetailPanel(this.model)}return i.prototype.registerMsg=function(t){t.add(e.Code.MAIL_INFO_S,this),t.add(e.Code.MAIL_READ_S,this),t.add(e.Code.MAIL_GET_S,this)},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.MAIL_INFO_S:this.model.setMailInfo(i);break;case e.Code.MAIL_GET_S:this.model.getRewardBack(i);break;case e.Code.MAIL_READ_S:this.model.setReadMail(i)}e.MainControler.instance.refreshMailStatus()},i.prototype.guideshow=function(){this.panel.guideshow()},i.prototype.requestMailInfos=function(){var t=HawkProtocolManager.newBuilder("JsProto.OPMailInfo");e.Message.instance.send(e.Code.MAIL_INFO_C,t,!0)},i.prototype.requestReadMail=function(t){var i=HawkProtocolManager.newBuilder("JsProto.ReadMailInfo");i.setId(t),e.Message.instance.send(e.Code.MAIL_READ_C,i,!0)},i.prototype.requestGetAward=function(t,i){if(void 0===i&&(i=-1),0==e.BagController.getInstance().getFreeCellCount())return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("BAGNOTENOUGH"),this,function(){e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT)});var n=HawkProtocolManager.newBuilder("JsProto.OPMailGet");n.setType(t),1==t&&n.setId(i),e.Message.instance.send(e.Code.MAIL_GET_C,n,!0)},i.prototype.showMailPanel=function(){this.requestMailInfos(),this.panel.show()},i.prototype.showMailDetailPanel=function(e){var i=this.model.getMailInfoById(e);i.getReadState()==t.UNREAD&&this.requestReadMail(e),this.model.detailId=e,this.detailPanel.show()},i.prototype.getHaveNewMail=function(){for(var e=this.model.mailList,i=e.length,n=0;i>n;n++)if(Number(e[n].getReadState())==t.UNREAD)return!0;return!1},i.prototype.getIsFull=function(){var t=Number(e.GlobalConfig.instance.getValue("MAILMAXCOUNT"));return this.model.mailList.length>=t},i.getInstance=function(){return null==this.instance&&(this.instance=new i),this.instance},i}();e.MailController=i,__reflect(i.prototype,"foxgame.MailController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/mail/MailDetailSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){var t=this.ui.list;t.dataProvider=this.model.detailCollection,t.itemRenderer=e.MailRewardItem;var i=new eui.HorizontalLayout;i.paddingLeft=-16,t.layout=i,this.ui.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getHandler,this),this.ui.scroller.verticalScrollBar.autoVisibility=!1,28==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.getBtn,this.ui.getBtn.parent,28,7,!0)},i.prototype.refresh=function(){var t=this.model.getMailInfoById(this.model.detailId),i=e.JsonDataManager.instance.mailTemplate[t.getMailId()];this.ui.titleLabel.text=i.title;var n,o=t.getContentParams().split(",");1==o.length?n=e.LanguageUtils.instance.getReplaceString(i.content,o[0]):2==o.length?n=e.LanguageUtils.instance.getReplaceString(i.content,o[0],o[1]):3==o.length&&(n=e.LanguageUtils.instance.getReplaceString(i.content,o[0],o[1],o[2])),this.ui.contentLabel.textFlow=(new egret.HtmlTextParser).parse(n);for(var a,s=[],r=t.getItems(),l=r.length,h=0;l>h;h++)a=r[h],a.getItemId()==e.AttributeType.DIAMOND?this.ui.goldLabel.text=a.getItemCount()+"":a.getItemId()==e.AttributeType.COIN?this.ui.coinLabel.text=a.getItemCount()+"":s.push(a);this.model.detailCollection.replaceAll(s),t.getItems().length>0?t.getReadState()==e.MailStatus.GOT?this.ui.getBtn.visible=!1:this.ui.getBtn.visible=!0:this.ui.getBtn.visible=!1},i.prototype.closeHook=function(){28==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz&&e.MailController.getInstance().guideshow()},i.prototype.getHandler=function(t){e.MailController.getInstance().requestGetAward(1,this.model.detailId),this.close()},i}(e.BasePanel);e.MailDetailPanel=t,__reflect(t.prototype,"foxgame.MailDetailPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="MailItemSkin",e.touchChildren=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.clickHandler,e),e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.unreadImg.visible=!1,this.unGetImg.visible=!1,this.readImg.visible=!1;var i=this.data,n=i.getReadState();if(n==e.MailStatus.UNREAD)this.unreadImg.visible=!0;else if(n==e.MailStatus.READED||n==e.MailStatus.GOT)this.readImg.visible=!0;else{if(n!=e.MailStatus.NOTGET)throw new Error("mail state Error");this.unGetImg.visible=!0}var o=e.JsonDataManager.instance.mailTemplate[i.getMailId()];this.titleLabel.text=o.title;var a=Number(1e3*i.getCreateTime()),s=new Date(a),r=s.getFullYear(),l=s.getMonth()+1,h=s.getDate(),c=s.getHours(),u=s.getMinutes(),p=s.getSeconds(),g=e.LanguageUtils.instance.getValue("NIAN"),d=e.LanguageUtils.instance.getValue("YUE"),f=e.LanguageUtils.instance.getValue("RI");if(this.contentLabel.text=r+g+l+d+h+f+c+":"+u+":"+p,28==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz){var m={x:this.unreadImg.x,y:this.unreadImg.y,width:103,height:76};e.MainControler.instance.guidechange(m,this.unreadImg.parent,28,6,!0)}},i.prototype.clickHandler=function(t){var i=this.data;e.MailController.getInstance().showMailDetailPanel(i.getId())},i}(eui.ItemRenderer);e.MailItem=t,__reflect(t.prototype,"foxgame.MailItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.mailList=[],this.observerList=[],this.mailDataSource=[],this.mailCollection=new eui.ArrayCollection,this.detailCollection=new eui.ArrayCollection}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.setMailInfo=function(t){if(0!=t.getMails().length){t.getIsAll()?this.mailList=t.getMails():this.mailList=this.mailList.concat(t.getMails()),this.mailList.sort(this.sortMail);for(var i=Number(e.GlobalConfig.instance.getValue("MAILMAXCOUNT"));this.mailList.length>i;)this.mailList.pop();for(var n,o=this.observerList.length,a=0;o>a;a++)n=this.observerList[a],n.getIsShow()&&n.mailInfoBack()}},t.prototype.sortMail=function(e,t){var i=Number(e.getId()),n=Number(t.getId());return i>n?-1:n>i?1:0},t.prototype.getRewardBack=function(t){if(0!=t.getResult()){for(var i,n,o=this.mailList.length,a=t.getIds(),s=a.length,r=0;s>r;r++){n=a[r];for(var l=0;o>l;l++)if(i=this.mailList[l],Number(i.getId())==n){i.setReadState(e.MailStatus.GOT);break}}o=this.observerList.length;for(var h,r=0;o>r;r++)h=this.observerList[r],h.getIsShow()&&h.updateMailStatus()}},t.prototype.setReadMail=function(t){if(0!=t.getResult()){for(var i,n=this.mailList.length,o=0;n>o;o++)if(i=this.mailList[o],Number(i.getId())==Number(t.getId())){i.getItems().length>0?i.setReadState(e.MailStatus.NOTGET):i.setReadState(e.MailStatus.READED);break}n=this.observerList.length;for(var a,o=0;n>o;o++)a=this.observerList[o],a.getIsShow()&&a.updateMailStatus()}},t.prototype.getMailInfoById=function(e){for(var t,i=this.mailList.length,n=0;i>n;n++)if(t=this.mailList[n],Number(t.getId())==e)return t;return null},t}();e.MailModel=t,__reflect(t.prototype,"foxgame.MailModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/mail/MailSkin.exml","mailPanel")||this;return i.setIsTextureCache(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this);var t=this.ui.list;t.dataProvider=this.model.mailCollection,t.itemRenderer=e.MailItem,this.ui.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getHandler,this),this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.doScreenAdaptation()},i.prototype.refresh=function(){this.model.mailCollection.replaceAll(this.model.mailList),this.ui.getBtn.visible=this.model.mailList.length>0},i.prototype.getHandler=function(t){if(e.MailController.getInstance().requestGetAward(0),28==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz){var i=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(i,i.parent,28,8)}},i.prototype.guideshow=function(){if(28==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz){var t=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(t,t.parent,28,8,!0)}},i.prototype.mailInfoBack=function(){this.refresh()},i.prototype.updateMailStatus=function(){this.refresh()},i.prototype.closeHook=function(){28==App.GuideUtils().currdbz&&8==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i}(e.BasePanel);e.MailPanel=t,__reflect(t.prototype,"foxgame.MailPanel",["foxgame.IMail","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="MailRewardItemSkin",e.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.iconClickHandler,e),e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.icon.setItem(e.getItemId(),e.getItemCount())},i.prototype.iconClickHandler=function(t){var i=this.data,n=e.JsonDataManager.instance.itemTemplate[i.getItemId()];n.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:n.id}):e.TipsController.getInstance().showItemTips(n.id,i.getItemCount())},i}(eui.ItemRenderer);e.MailRewardItem=t,__reflect(t.prototype,"foxgame.MailRewardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isMsgFinish=!1,this.isNetworkLoginedGameSvrOk=!1,this.iLastHeartBeatCheckTimestamp=0,this.startupTimestamp=egret.getTimer(),this.hasCheakStay120Seconds=!1
}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.registerMsg=function(t){t.add(e.Code.ASSEMBLE_FINISH_S,this),t.add(e.Code.ERROR,this),t.add(e.Code.HEART_BEAT,this),t.add(e.MsgCMD.Login_Success_Msg,this),t.add(e.MsgCMD.NetWork_Closed_Msg,this),t.add(e.MsgCMD.NetWork_Connect_Error_Msg,this),this.heartTimer=new egret.Timer(3e3),this.heartTimer.addEventListener(egret.TimerEvent.TIMER,this.onHeartUpdate,this),this.heartTimer.start()},t.prototype.onHeartUpdate=function(t){if(this.isNetworkLoginedGameSvrOk){var i=egret.getTimer(),n=i-this.iLastHeartBeatCheckTimestamp;if(n>1e4){this.iLastHeartBeatCheckTimestamp=i;var o=(new Date).getTime();o=Math.floor(o/1e3);var a=HawkProtocolManager.newBuilder("JsProto.HPHeartBeat");a.setTimeStamp(o),e.Message.instance.send(e.Code.HEART_BEAT,a,!0)}}var s=egret.getTimer(),r=s-this.startupTimestamp;1==e.MtaUtils.checkEventJiaZaiJinYouXi&&r>6e4&&(e.MtaUtils.checkEventJiaZaiJinYouXi=!1,e.MtaUtils.notifyEvent("jiazaijinyouxi",{stay60seconds:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_stay60Seconds"}),e.AldUtils.sendEvent("game_stay60Seconds","game_stay60Seconds")),0==this.hasCheakStay120Seconds&&r>12e4&&(this.hasCheakStay120Seconds=!0,e.MtaUtils.notifyEvent("jiazaijinyouxi",{stay120seconds:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_stay120Seconds"}),e.AldUtils.sendEvent("game_stay120Seconds","game_stay120Seconds"))},t.prototype.recvMsg=function(t,i){if(t!=e.Code.ERROR)t==e.MsgCMD.Login_Success_Msg?this.isNetworkLoginedGameSvrOk=!0:t==e.MsgCMD.NetWork_Closed_Msg||t==e.MsgCMD.NetWork_Connect_Error_Msg?this.isNetworkLoginedGameSvrOk=!1:t==e.Code.HEART_BEAT,t==e.Code.ASSEMBLE_FINISH_S&&(this.isMsgFinish||(this.isMsgFinish=!0,this.showUI()));else{var n=i;e.JsonDataManager.instance.errorCode;switch(n.getErrCode()){case 11100:}}},t.prototype.showUI=function(){1==this.isMsgFinish&&(e.BattleScene.instance.getNormalBattleOnCreate(),egret.setTimeout(function(){e.MainBottomControler.instance.refreshCharacterIconOperate()},this,1500),e.MainLoadingController.instance.closePanel(),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.MAIN),e.MtaUtils.notifyEvent("chuangjiaojinyo",{entergameui:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_showMainUI"}),e.AldUtils.sendEvent("game_showMainUI","game_showMainUI"),1==e.MtaUtils.checkEventJiaZaiJinYouXi&&e.MtaUtils.notifyEvent("jiazaijinyouxi",{entermainui:"true"}))},t}();e.MainUIController=t,__reflect(t.prototype,"foxgame.MainUIController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="CurrencySkin",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.init()},i.prototype.init=function(){"qqgame"==checkPlatformStr()&&(this.addGoldCoinBtn.visible=!1,this.addYuanBaoBtn.visible=!1),this.addGoldCoinBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.addYuanBaoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.refresh=function(){var t=e.PlayerService.instance.playerInfo;t&&(this.goldCoinLab.text=e.GlobalUtil.getUnitString(t.getCoin(),2),this.yuanBaoLab.text=e.GlobalUtil.getUnitString(t.getGold(),2))},i.prototype.btnClick=function(t){var i=t.target;if(i)switch(i){case this.addGoldCoinBtn:e.ShopMainControler.getInstance().showBuyItemPanel(120012);break;case this.addYuanBaoBtn:e.RechargeController.getInstance().showPanel()}},i}(eui.Component);e.CurrencyControler=t,__reflect(t.prototype,"foxgame.CurrencyControler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.FirstpayByDayModel,this.panel=new e.FirstpayByDayPanel(this.model)}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getmodel=function(){return this.model},t.prototype.showpanel=function(){this.panel.show()},t.prototype.refreshpanel=function(){this.panel.getIsShow()&&this.panel.refreshpanel()},t.prototype.registerMsg=function(t){t.add(e.Code.DAILY_FIRST_CHARGE_INFO_S,this),t.add(e.Code.DAILY_FIRST_CHARGE_AWARD_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.DAILY_FIRST_CHARGE_AWARD_S:this.model.setDAILY_FIRST_CHARGE_AWARD_S(i),this.panel.getIsShow()&&this.panel.closeAni();break;case e.Code.DAILY_FIRST_CHARGE_INFO_S:this.model.setDAILY_FIRST_CHARGE_INFO_S(i)}},t.prototype.sendDAILY_FIRST_CHARGE_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.DailyFirstChargeInfoReq");e.Message.instance.send(e.Code.DAILY_FIRST_CHARGE_INFO_C,t,!0)},t.prototype.sendDAILY_FIRST_CHARGE_AWARD_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.DailyFirstChargeAwardReq");e.Message.instance.send(e.Code.DAILY_FIRST_CHARGE_AWARD_C,t,!0)},t}();e.FirstpayByDayControler=t,__reflect(t.prototype,"foxgame.FirstpayByDayControler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.firstpaystate=!0}return t.prototype.setaward=function(t){var i=t.split(",");this.rewardList=[];for(var n=0;n<i.length;n++){var o=new e.AttributeVO(i[n]);this.rewardList.push(o)}},t.prototype.setDAILY_FIRST_CHARGE_AWARD_S=function(t){0==t.getErrorNo()&&e.FirstpayByDayControler.getInstance().sendDAILY_FIRST_CHARGE_INFO_C()},t.prototype.setDAILY_FIRST_CHARGE_INFO_S=function(t){this.type=t.getType(),this.oldPrice=t.getOldPrice(),this.status=t.getStatus(),this.setaward(t.getAward()),this.firstpaystate=t.getHasNext(),e.FirstpayByDayControler.getInstance().refreshpanel()},t}();e.FirstpayByDayModel=t,__reflect(t.prototype,"foxgame.FirstpayByDayModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/firstpaybyday/Firstpaybyday.exml")||this;return i.model=e,i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.doScreenAdaptation(),this.effectLingQu(!0),-1!=checkPlatformStr().indexOf("opporpk")?this.ui.rpktip.text="如有问题,请联系客服QQ：2997253306":this.ui.rpktip.text="·点击任意空白区域关闭·"},i.prototype.effectLingQu=function(t){this.aniplay&&(this.aniplay.clear(),this.aniplay=null),t&&(this.aniplay||(this.aniplay=new e.FoxAni(this.ui.anigroup),this.aniplay.play("rechargeAnimation","ani",-1)))},i.prototype.closeAni=function(){this.effectLingQu(!1)},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.btn:if(0==this.model.firstpaystate)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YILINGQU"));this.model.status?(e.FirstpayByDayControler.getInstance().sendDAILY_FIRST_CHARGE_AWARD_C(),App.SoundManager().playEffect("sound_award_mp3")):(e.RechargeController.getInstance().showPanel(),this.close())}},i.prototype.refresh=function(){this.ui.tip1.text=this.model.type.toString(),this.ui.tip2.text=this.model.oldPrice.toString(),this.ui.anigroup.visible=!1,0==this.model.firstpaystate?this.ui.txt.text=e.LanguageUtils.instance.getValue("YILINGQU"):(this.ui.txt.text=1==this.model.status?"领取":"充点小钱",1==this.model.status&&(this.ui.anigroup.visible=!0)),this.ui.group.removeChildren();for(var t=0;t<this.model.rewardList.length;t++){var i=this.model.rewardList[t],n=new e.ItemIcon;n.setItem(i.id,i.value,!0),this.ui.group.addChild(n),n.x=t*(n.width+15)+20,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.onClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.refreshpanel=function(){this.refresh()},i}(e.BasePanel);e.FirstpayByDayPanel=t,__reflect(t.prototype,"foxgame.FirstpayByDayPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="CommandToolsItemSkin",this.btnaa.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.info=this.data,this.btnaa.label=this.info.getName()},i.prototype.clickHandler=function(t){var i=e.CommandToolsController.instance.getParams();if("destroyRes"==this.info.getId()){if(!i){if(window.showTextureCacheInfo){window.showTextureCacheInfo=!1,window.showAniActionCacheInfo=!1,e.TextureCache.getInstance().restartTextureCacheProfileTimerHandler(!1);var n=window.document.getElementById("egretSysFpsLog");n.innerHTML="";var o=document.getElementById("egretSysFpsTextureCache");o.innerHTML=""}else window.showTextureCacheInfo=!0,window.showAniActionCacheInfo=!0,e.TextureCache.getInstance().restartTextureCacheProfileTimerHandler(!0);return}if(i.indexOf("debugAni ")>=0){var a=i.substr(9);return void(e.TextureCache.getInstance().debugInfoAniNameFilter=a)}if(i.indexOf("debugAction ")>=0){var a=i.substr(12);return void(e.TextureCache.getInstance().debugInfoActionNameFilter=a)}if(i.indexOf("debugResInfo ")>=0){var a=i.substr(13);return e.TextureCache.getInstance().debugInfoResInfoFilter=a,void(e.TextureCache.getInstance().debugInfoRESAssetsManagerResIdFilter=a)}if(i.indexOf("debugResId ")>=0){var a=i.substr(11);return void(e.TextureCache.getInstance().debugInfoRESAssetsManagerResIdFilter=a)}return"printAssetRes"==i?void AssetAdapter.getInstance().printAssetResLoadInfo():"printPanelList"==i?void StageFrameControl.instance.printInUsingPanelList():void e.GlobalUtil.destroyRes(i)}var s=HawkProtocolManager.newBuilder("JsProto.BackdoorOpenReq");s.setId(this.info.getId()),s.setParam(i),e.Message.instance.send(e.Code.BACKDOOR_OPEN,s,!0)},i}(eui.ItemRenderer);e.CommandToolsItemRenderer=t,__reflect(t.prototype,"foxgame.CommandToolsItemRenderer")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=e.MapViewportGroupManager,i=e.MainSceneManager,n=e.BattleScene,o=e.ActivityController;window.foxgame=e;var a=function(a){function s(){var e=a.call(this)||this;return e.giftData={},e.barFatherVisibleOldValue=!0,e.chatOrMailGroupBottom=!1,e.isShowAdver=!1,e.rewardIsClose=!1,e._touchStatus=!1,e._distance=new egret.Point,e.startPos=new egret.Point,e.inBattle=!0,e.switchToBattleTimestamp=0,e.inRequestSwitchToBattle=!1,e.didOnceSwitchToBattleForceHideMainSceneObjects=!0,e.leaveBattleSceneTimestamp=0,e.inRequestLeaveBattle=!1,e.didOnceLeaveBattleForceHideBattleSceneObjects=!1,e.rewardCout=0,e.rewardType=0,e.isGiftBtnCanClick=!0,e.curRewardId=0,e.roleDataList=[],e.lastRequestRankTime=egret.getTimer()-5e4,e.saveTaskData=[],e.leftList=[],e.leftY=[],e.xyw_allowRecharge=!0,e.xyw_MonthCost=-1,e.xyw_nonageAllowTime=54e5,e.wealPaneisShow=!1,e.payData={},e.isShowInitGroomUI=!1,e.ttgameKefuCount=0,e.isMainui=!1,e.msgCacheList=[],e.msgPosType=-1,e.isplayboss=!1,e._getLock=0,e.isFirstOpenKuaFu=!0,e.maskcount=0,e.skinName="resource/skins/main/MainSkin.exml",e}return __extends(s,a),Object.defineProperty(s,"instance",{get:function(){return this._instance||(this._instance=new s),this._instance},enumerable:!0,configurable:!0}),s.prototype.initMsg=function(){e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),e.Message.instance.add(e.MsgCMD.MAIN_NOTICE_GIFT,this),e.Message.instance.add(e.MsgCMD.MAIN_NOTICE_ACTIVITY,this),e.Message.instance.add(e.MsgCMD.MAIN_NOTICE_RAID,this),e.Message.instance.add(e.MsgCMD.MAIN_NOTICE_CHAT,this),e.Message.instance.add(e.Code.EQUIP_SYNC_FINISH_S,this),e.Message.instance.add(e.MsgCMD.BROADCAST_MESSAGE,this),e.Message.instance.add(e.MsgCMD.MAIN_SCENE_CLICK,this),e.Message.instance.add(e.MsgCMD.BATTLE_SCENE_CLICK,this),e.Message.instance.add(e.MsgCMD.REFRESH_BATTLE_PLAYER_INFO,this),e.Message.instance.add(e.Code.BATTLE_FAST_FIGHT_S,this),e.Message.instance.add(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,this),e.Message.instance.add(e.MsgCMD.BOTTOM_NOTICE_PACKAGE,this),e.Message.instance.add(e.MsgCMD.ARENA_CHALLENGE_COUNT,this),e.Message.instance.add(e.Code.ARENA_DEFENDER_LIST_SYNC_S,this),e.Message.instance.add(e.MsgCMD.QUICK_GET_REWARD,this),e.Message.instance.add(e.MsgCMD.CLOSE_THE_98,this),e.Message.instance.add(e.Code.CHECK_CDK_CAN_USE_S,this),e.Message.instance.add(e.MsgCMD.NEW_NOTICE_TASK_OPEN_ACTIVITY,this),e.Message.instance.add(e.Code.MAINMISSION_BONUS_S_VALUE,this),e.Message.instance.add(e.MsgCMD.UICanHideSomethingForDrawLess,this),e.Message.instance.add(e.MsgCMD.UIRestoreHideSomethingForDrawLess,this),e.Message.instance.add(e.Code.VISITOR_LIMIT_INFO_S,this),e.Message.instance.add(e.Code.add_LOGIN_TIMES_S,this),e.Message.instance.add(e.Code.MOTH_ADD_MB_S,this),e.Message.instance.add(e.Code.CHANNEL_CRETIFICATION_AWARDS_S,this)},s.prototype.create=function(){this.chatWindow.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.commandBtn.icon="",this.commandBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),e.PopUpManager.instance.registerWindow(e.WindowName.MAIN,this,this,!1),e.ModuleOpenController.getInstance().openModuleSendData(),this.noticeMap=new e.HashMap,this.mytimer=new egret.Timer(2e3,3),this.tiaozhanbossBtn.enabled=!1;var t=new e.FoxAni(this.guanqiaboss);t.play("guanqiaani"),this.yieldGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.chuanshuoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.chuanshuoHandler,this),this.mainPageBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.battlePageBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.firstRechargeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rechargeClickHandler,this),this.wanfaGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.wanfaHandler,this),this.wanfaGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.handlerBegin,this),this.wanfaGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.handlerEnd,this),this.wanfaGroup.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.handlerEnd,this),this.fubenGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fubenHandler,this),this.fubenGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.handlerBegin,this),this.fubenGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.handlerEnd,this),this.fubenGroup.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.handlerEnd,this),this.bossGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bossHandler,this),this.bossGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.handlerBegin,this),this.bossGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.handlerEnd,this),this.bossGroup.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.handlerEnd,this),this.shoucangwanba.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ShareWanbaControler.getInstance().showpanel()},this),this.fenxiangwanba.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ShareWanbaControler.getInstance().showcollection()},this),this.suyishoucangbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.SuyiFollowControler.getInstance().showpanel()},this),e.Global.padddingY=~~(e.Global.SCREEN_HEIGHT-(this.bottomBar.bgId.height+this.lvLab.y+this.lvLab.height))+30,e.Global.mainSceneButtonY=e.Global.SCREEN_HEIGHT-this.bottomBar.bgId.height,App.TimerManager().doTimer(1e3,0,this.MainTimerHandler,this),this.pkHeadList=[this.pkHead1,this.pkHead2,this.pkHead3];for(var i,n=this.pkHeadList.length,o=0;n>o;o++)i=this.pkHeadList[o],i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pkHeadHandler,this);e.FirstpayByDayControler.getInstance().sendDAILY_FIRST_CHARGE_INFO_C();var a=egret.getOption("xyw_platform");""!=a&&"xyw"==a&&(this.xyw_platformInfo=a,this.xyw_UserTypeInfo=egret.getOption("xyw_UserType"),this.xyw_isAdultInfo=egret.getOption("xyw_isAdult"),this.xyw_ageRangeInfo=egret.getOption("xyw_ageRange"),"1"==this.xyw_UserTypeInfo?this.xywSendMsg():"2"==this.xyw_UserTypeInfo&&"0"==this.xyw_isAdultInfo&&this.xywSendGameTime())},s.prototype.dateBysign=function(t){var i,n=this,o=Math.abs(Number(t.getTime())),a=new Date(o),s=a.getFullYear(),r=a.getMonth()+1,l=a.getDate(),h=a.getHours(),c=a.getMinutes(),u=a.getSeconds();i=0==h?"0"+h:""+h;var p;p=0==c?"0"+c:""+c;var g=s+"-"+r+"-"+l+" "+i+":"+p+":"+u,d=["HeiTi","Tahoma","KaiTi","Verdana","SimHei"];this.signtime.textFlow=[{text:s+"",style:{textColor:e.GlobalUtil.getColor(),size:50,fontFamily:d[this.randomNumber(4,0)],strokeColor:e.GlobalUtil.getColor(),stroke:2}},{text:"年",style:{textColor:e.GlobalUtil.getColor(),fontFamily:d[this.randomNumber(4,0)],size:50}},{text:r+"",style:{textColor:e.GlobalUtil.getColor(),size:50,fontFamily:d[this.randomNumber(4,0)],strokeColor:e.GlobalUtil.getColor(),stroke:2}},{text:"月",style:{textColor:e.GlobalUtil.getColor(),fontFamily:d[this.randomNumber(4,0)],size:50}},{text:l+"",style:{textColor:e.GlobalUtil.getColor(),size:50,fontFamily:d[this.randomNumber(4,0)],strokeColor:e.GlobalUtil.getColor(),stroke:2}},{text:"日",style:{textColor:e.GlobalUtil.getColor(),fontFamily:d[this.randomNumber(4,0)],size:50}},{text:i+":"+p+":"+u,style:{textColor:e.GlobalUtil.getColor(),fontFamily:d[this.randomNumber(4,0)],size:50,strokeColor:e.GlobalUtil.getColor(),stroke:2}}],this.signtime.touchEnabled=!0,this.signtime.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){egret.Tween.get(n.signtime,{}).to({x:20,alpha:.8},60).to({x:0},60).to({x:15,alpha:.5},50).to({x:0},50).to({x:10,alpha:0},40).to({x:0},40).wait(1e3).to({x:10,y:n.randomNumber(n.stage.stageHeight-30,0)},40).to({x:0,alpha:0},40).to({x:15},50).to({x:0,alpha:.5},50).to({x:20},60).to({x:0,alpha:1},60)},this),console.log("%c"+g,"font-size:50px;color:red;-webkit-text-fill-color:transparent;-webkit-text-stroke: 1px black;")},s.prototype.randomNumber=function(e,t){return Math.round(Math.random()*(e-t)+t)},s.prototype.MainTimerHandler=function(i){if(this.isShowInitGroomUI=!1,this.commandBtn&&this.commandBtn.visible){var a="glF";window.feefoxUseglFormat&&(a="glF"+window.feefoxUseglFormat),(window.deviceBenchmarkLevel||0==window.deviceBenchmarkLevel)&&(a=a+"bLv"+window.deviceBenchmarkLevel);var s="cache"+e.TextureCache.getInstance().getSimpleInfo();if(this.debugInfoLabel.text=s,egret.RuntimeType.WEB==egret.Capabilities.runtimeType&&window.showAniActionCacheInfo){s=s+"<br/><br/>Ani: "+e.AniManager.instance.getSimpleDebugInfo(),s=s+"<br/><br/>Action: "+e.ActionManager.instance.getSimpleDebugInfo(),s=s+"<br/><br/>"+LittleLoading.getInstance().debugInfoWhoCallMe;var r=window.document.getElementById("egretSysFpsLog");r.style.maxWidth="600px",r.innerHTML=s}this.commandBtn.label="Tool,"+App.TimerManager().fps+"FPS"+a}if(this.bottomBar&&this.bottomBar.update(i),this.inRequestSwitchToBattle){var l=egret.getTimer(),h=l-this.switchToBattleTimestamp;h>2e3&&(this.inRequestSwitchToBattle=!1,e.CommonUtils.destroyMainMapPic(t.instance.mapView),e.MapSceneService.instance.forceHideMainPlayerRoleMainScene(),e.MapSceneService.instance.forceHideOtherPlayerMainScene(),t.instance.sceneView.hideAndUnloadNpc(),this.didOnceSwitchToBattleForceHideMainSceneObjects=!0)}if(this.inRequestLeaveBattle){var l=egret.getTimer(),h=l-this.leaveBattleSceneTimestamp;h>2e3&&(this.inRequestLeaveBattle=!1,e.CommonUtils.destroyBattleMapPic(t.instance.mapView,t.instance.mapView.getOldBattleBgStr(),t.instance.mapView.getOldMapVoObj()),n.instance.destroyNpcPlayerMonster(),this.didOnceLeaveBattleForceHideBattleSceneObjects=!0)}this.fubenRedImg.visible=e.FuBenController.getInstance().getfubenredimg(),e.WelcomeController.getInstance().isShow()&&(this.isShowAdver=!0),this.isShowAdver||e.OffLineYieldController.getInstance().isShowPanel()||(o.getIntance().sendHPInitGroomReq(),this.isShowAdver=!0)},s.prototype.ucIos=function(t){e.PopUpController.getInstance().showTextPanel(t,this,null,"",null,"","确定","No",20,!1,!1)},s.prototype.setbossRed=function(e){this.bossRedImg.visible=e},s.prototype.setSoundBtn=function(e){this.chatCloseBtn.visible=!e,this.chatBtn.visible=e},s.prototype.getSoundStatus=function(){return this.chatBtn.visible},s.prototype.show=function(){if(Log.trace("MainControler begin show at timestamp: "+egret.getTimer()),this.call1758(),"ttgame"==window.GJlenged_chanel?(console.log("头条游戏 "),ttCreateKefuBtn()):console.log("非头条游戏"),-1!=String(getGlobalConfig().serverUrl).indexOf("by1758")||"by1758"==egret.getOption("pf"));if(e.PopUpManager.instance.addPopUp(e.WindowName.MAIN,e.WindowName.UILAYER,5),e.PlayerService.instance&&1==e.PlayerService.instance.level&&e.WelcomeController.getInstance().showPanel(),e.MainLoadingController.instance.cleanNotNeededRes(),e.ActivityBarController.getInstance().showOrClosePanel(!0),"mfsqgame"==window.GJlenged_chanel||"mrbjqqgame"==window.GJlenged_chanel){mfsqAddRecentColorSign();var t=e.PlayerService.instance.mainRoleInfo.getLevel();mfsqSetSelfDataInfo([{key:"level",value:t+""}])}},s.prototype.dispose=function(){this.noticeMap=null,e.Message.instance.remove(e.MsgCMD.REFRESH_PLAYERDATA,this),e.Message.instance.remove(e.MsgCMD.MAIN_NOTICE_GIFT,this),e.Message.instance.remove(e.MsgCMD.MAIN_NOTICE_CHAT,this),e.Message.instance.remove(e.MsgCMD.MAIN_NOTICE_ACTIVITY,this),e.Message.instance.remove(e.MsgCMD.MAIN_NOTICE_RAID,this),e.Message.instance.remove(e.Code.EQUIP_SYNC_FINISH_S,this),e.Message.instance.remove(e.MsgCMD.BROADCAST_MESSAGE,this),e.Message.instance.remove(e.MsgCMD.MAIN_SCENE_CLICK,this),e.Message.instance.remove(e.MsgCMD.BATTLE_SCENE_CLICK,this),e.Message.instance.remove(e.MsgCMD.REFRESH_BATTLE_PLAYER_INFO,this),e.Message.instance.remove(e.Code.BATTLE_FAST_FIGHT_S,this),e.Message.instance.remove(e.Code.WANBA_VIP_PACKAGE_S,this),e.Message.instance.remove(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,this),e.Message.instance.remove(e.MsgCMD.UICanHideSomethingForDrawLess,this),e.Message.instance.remove(e.MsgCMD.UIRestoreHideSomethingForDrawLess,this),this.addGoldCoinBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.addYuanBaoBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.chatWindow.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.tiaozhanbossBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.vipBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.autoFightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.mailBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.chatBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.chatCloseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),e.Message.instance.remove(e.MsgCMD.CHA_YOU_LIAO_QIE,this),e.Message.instance.remove(e.MsgCMD.AUTO_FIGHT_BOSS,this),e.Message.instance.remove(e.MsgCMD.AUTO_FIGHT_BOSS_CHANGE,this),this.mytimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),e.Message.instance.remove(e.Code.ARENA_DEFENDER_LIST_SYNC_S,this),e.Message.instance.remove(e.MsgCMD.ARENA_CHALLENGE_COUNT,this),e.Message.instance.remove(e.MsgCMD.NEW_NOTICE_TASK_OPEN_ACTIVITY,this)},s.prototype.showFriendsRankUi=function(e){console.log("showFriendsRankUi调用 ");var t=new egret.BitmapData(e);t.$deleteSource=!1;var i=new egret.Texture;i._setBitmapData(t);var n=new egret.Bitmap(i);n.width=this.stage.stageWidth,n.height=this.stage.stageHeight,n.touchEnabled=!0,n.pixelHitTest=!0,this.barFather.addChild(n)},s.prototype.EnterFight=function(){this.bottomBar.mainInToFuBen(),this.changeCharlingName(),e.MainBottomControler.instance.setMaincityvisible(!1)},s.prototype.changeCharlingName=function(t){if(void 0===t&&(t=null),!(e.PlayerService.instance.playerInfo&&e.PlayerService.instance.playerInfo.getLevel()<30)){var i;t&&""!=t?(this.charingName.text=t,this.setBossTipVisible(this.bossGroup.visible)):(this.charingName.text.length>5&&(i=!0),this.setBossTipVisible(!1),this.charingName.text=""),i&&(i=!1,this.getBossData()),e.Global.isAppStoreReview&&this.setBossTipVisible(!1)}},s.prototype.createChildren=function(){function t(e,t){return e.toString()+"/"+t.toString()}var i=e.GamePlatform.logDomain;e.GameUtils.httpSend(i,JSON.stringify({appid:e.GamePlatform.reyunAppId,context:{deviceid:e.GameUtils.getBrowserDeviceUUID(),channelid:"qqgame",level:"1"},what:"start_game1",who:e.UserInfo.platform.getPuid()})),Log.trace("MainControler begin createChildren at timestamp: "+egret.getTimer());var o=e.PlayerService.instance.mainRoleInfo,s={code:"Enter_Main",serverId:e.Global.serverId,serverName:e.Global.serverName,roleid:o.getRoleId(),roleName:o.getName(),level:o.getLevel(),moneyNum:e.PlayerService.instance.playerInfo.getCoin(),vip:e.PlayerService.instance.playerInfo.getVipLevel(),power:o.getFight()};e.UserInfo.platform.reportData_legend(s),a.prototype.createChildren.call(this),this.setBossTipVisible(!1),e.Message.instance.send(e.MsgCMD.SET_expBarProgress,0,!1),this.huobanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.mfsqBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.addGoldCoinBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this);var r=checkPlatformStr();("qqgame"==r||"wxgame"==r||"opporpk"==r||"ttgame"==r)&&(this.addGoldCoinBtn.visible=!1,this.addYuanBaoBtn.visible=!1),this.addYuanBaoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.tiaozhanbossBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.vipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.exit_copyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.autoFightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.mailBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.chatCloseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.chatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.giftBtnop.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.moduleOpenImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),e.Message.instance.add(e.MsgCMD.CHA_YOU_LIAO_QIE,this),e.Message.instance.add(e.MsgCMD.AUTO_FIGHT_BOSS,this),e.Message.instance.add(e.MsgCMD.AUTO_FIGHT_BOSS_CHANGE,this),this.mytimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.rewardTweenGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getMissionRewards,this),e.Global.isInit=!0,e.BattleService.instance.offlineResult&&e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTOFFLINE,data:1}),e.SpeedUtil.time1(e.SpeedCollectType.speed_3),e.SpeedUtil.end(e.SpeedCollectType.speed_3),this.mapCfg=e.JsonDataManager.instance.mapTemplate;var l=(e.Global.SCREEN_HEIGHT-this.stage.stageHeight,new egret.Event(egret.Event.RESIZE));this.stage.dispatchEvent(l);var h=HawkProtocolManager.newBuilder("JsProto.OPMailInfo");e.Message.instance.send(e.Code.MAIL_INFO_C,h,!0),e.Global.killMonsterNum=this.monsterlen(),this.bossFightCount.maximum=e.Global.killMonsterNum,this.bossFightCount.minimum=0,this.bossFightCount.labelFunction=t,this.setBossFightCountProgress(n.instance.fightCount,this.bossFightCount.maximum),this.setAutoBossBtnState(!1),this.fightCountAni=new e.FoxAni(this.fightCountAniGroup),this.MainHeadGroup.name="MainHeadGroup",this.rightBar.name="BattleHeadGroup",App.SoundManager().reSetSound(),this.setSoundBtn(App.SoundManager().getEffectOn()),App.MessageCenter.addListener("resizeWindowHandler",this.sceneWindowHandler,this),this.commandBtn.visible=e.Global.globalConfig.isDebug,this.signtime.visible=e.Global.globalConfig.isDebug,this.debugInfoLabel.visible=this.commandBtn.visible,Log.trace("MainControler end createChildren at timestamp: "+egret.getTimer()),this.leftList.push(this.shouchonggroup),this.leftList.push(this.chuanshuogroup),this.leftList.push(this.huobangroup),this.leftList.push(this.wanbashoucang),this.leftList.push(this.wanbafenxiang),this.leftList.push(this.suyishoucang),this.leftList.push(this.ttGroup),this.leftList.push(this.mfsqGroup),this.leftY.push(this.shouchonggroup.y),this.leftY.push(this.chuanshuogroup.y),this.leftY.push(this.huobangroup.y),this.leftY.push(this.wanbashoucang.y),this.leftY.push(this.wanbafenxiang.y),this.leftY.push(this.suyishoucang.y),this.leftY.push(this.ttGroup.y),this.leftY.push(this.mfsqGroup.y),this.showleftbarBtn(this.mfsqGroup,!1),this.showleftbarBtn(this.ttGroup,!1),this.showleftbarBtn(this.suyishoucang,!1),this.showleftbarBtn(this.wanbafenxiang,!1),this.showleftbarBtn(this.wanbashoucang,!1),this.showleftbarBtn(this.huobangroup,!1),this.chuanshuaobtn(),this.showleftbarBtn(this.shouchonggroup,!1),this.tiaozhanbossBtn.visible=!1,this.guanqiaboss.visible=!1,this.autoFightBtn.visible=!1,this.bossFightCount.visible=!1,this.fightCountAniGroup.visible=!1,"mfxyoppo"==window.GJlenged_chanel&&(this.addGoldCoinBtn9.visible=!1,this.addYuanBaoBtn9.visible=!1,this.yuanBaoLab.x+=30)},s.prototype.childrenCreated=function(){Log.trace("MainControler begin childrenCreated at timestamp: "+egret.getTimer()),a.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0,ScreenAdaptation.instance.adaptMain(this),console.log(egret.MainContext.instance.stage.stageWidth),ScreenAdaptation.instance.adaptPanelBg(this.btnmask),ScreenAdaptation.instance.adaptPanelMask(this.maskui),this.stageOnResize(),this.getStage().addEventListener(egret.Event.RESIZE,this.stageOnResize,this),this.width/this.bottomBar.width<=1&&(this.bottomBar.scaleX=this.width/this.bottomBar.width,this.bottomBar.scaleY=this.bottomBar.scaleX),egret.Capabilities.isMobile?this.MainHeadGroup.horizontalCenter=0:this.MainHeadGroup.left=0,this.width/this.MainHeadGroup.width<=1&&(this.MainHeadGroup.scaleX=this.width/this.MainHeadGroup.width,this.MainHeadGroup.scaleY=this.MainHeadGroup.scaleX),this.getBossData();var t=e.PlayerService.instance.blueInfo;t&&t.getIsBlueVip()?e.Global.setBlueFont(this.txt_blue,t.getBlueVipLevel(),t.getIsBlueYearVip(),t.getIsSuperBlueVip()):this.txt_blue.text="",this.rewardTweenGroup.mask=this.rewardMask,e.CreateNewVipController.instance.requestVIPInfo(),e.RankController.getInstance().requestRankInfo(e.RankType.SHALUBANG),e.PrisonerController.getInstance().sendMessageToSeverForPrisonerData(),e.RedPacketController.getInstance().getRedPacketInfo(),this.changeScene(),this.checkHuoBanGroup(!0);var i=e.ModuleOpenController.getInstance().getNextModuleVO(),n=e.ModuleOpenController.getInstance().getCurModuleVO(),o=e.ModuleOpenController.getInstance().getLastModuleVO();this.moduleOpenAni=new e.FoxAni(this.moduleOpenAniGroup),this.moduleOpenAniGroup.name="konhg",n?(this.moduleOpenImg.source=n.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(n.describe),this.openModuleRedImg.visible=!0,this.moduleOpenAniGroup.visible=!0):(this.openModuleRedImg.visible=!1,null!=i?(this.moduleOpenImg.source=i.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(i.describe),this.moduleOpenAniGroup.visible=!0):e.ModuleOpenController.getInstance().getFinalData()?(this.moduleOpenImg.visible=!0,this.moduleOpenLabel.visible=!0,this.moduleOpenImg.source=o.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(o.describe),this.moduleOpenAniGroup.visible=!0):(this.moduleOpenImg.visible=!1,this.moduleOpenLabel.visible=!1,this.moduleOpenAniGroup.visible=!1,this.moduleOpenAni.stop())),e.FieldPKController.getInstance().requestPanelInfo(),this.figthGradeAni||(this.figthGradeAni=new e.FoxAni(this.fightGradeAniGroup),this.figthGradeAni.play("zdlhuodonghua","ani",-1)),this.refreshPKPlayer(),App.MessageCenter.dispatch(MessageCode.REFRESH_COIN),e.PlayerService.instance.level&&e.PlayerService.instance.level>=60&&e.NewArenaControler.Ins.requestAreaData(),this.refreshTask(),this.addVipEffect(),e.UserInfo.getGiftId()&&this.sendGiftid(),Log.trace("MainControler end childrenCreated at timestamp: "+egret.getTimer()),this.initUpdateShowUiWidgetFromPlyerLevel(1*e.PlayerService.instance.playerInfo.getLevel()),this.initShowUiWidgetFromTaskId(),this.takeMsgCache(),e.SoulController.getInstance().requestSoulInfo(),e.DragonboneController.getInstance().sendDRAGON_BONE_INFO_C(),e.DragonArmorController.getInstance().sendDragonInfo(),e.PrivilegeController.getInstance().sendPRIVILEGE_CARD_INFO_C();
var s=e.PlayerService.instance.level;s>=parseInt(e.GlobalConfig.instance.getValue("GODHEAD_OPEN_LEVEL"))&&(App.getResourceUtils().loadGroup("godhood",null,null,null),e.GodHoodConttroller.getInstance().sendGODHEAD_INFO_C()),s>=parseInt(e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL"))&&e.UnionController.getInstance().sendVESTIGES_OF_ANCIENT_GODS_INFO_C(),s>=parseInt(e.GlobalConfig.instance.getValue("CS_CAMP_LEVEL_LIMIT"))&&e.FactionBattleController.getInstance().sendmessageFactionInfo(),s>=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN"))&&e.DragongodTreasureController.getInstance().sendDRAGON_HOARD_INFO_C(),s>=Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL"))&&e.BeautyController.getInstance().sendDEMON_KEE_INFO_C();var r=checkPlatformStr();if("1108023326"==getGlobalConfig().wanBaAppId&&(e.ShareWanbaControler.getInstance().sendWANBA_INFO_C(),-1!=Number(getgift_id()))){e.Message.instance.add(e.Code.WANBA_VIP_PACKAGE_S,this);var l=HawkProtocolManager.newBuilder("JsProto.HPWanBaVipAwardReq");l.setPackageId(e.UserInfo.platform.gift_id),l.setState(1),e.Message.instance.send(e.Code.WANBA_VIP_PACKAGE_C,l,!0)}this.showleftbarBtn(this.ttGroup,"ttgame"==r),this.showleftbarBtn(this.wanbafenxiang,"wanba_ts"==r),this.showleftbarBtn(this.wanbashoucang,"wanba_ts"==r&&"WX"!=e.UserInfo.platform.chanel),"wanba_ts"==r&&this.showleftbarBtn(this.wanbafenxiang,!0),"QQVip"==e.UserInfo.platform.chanel&&e.WanbaVIPControler.getInstance().sendQQ_VIP_GIFT_STATUS_C();var h=r.indexOf("suyi"),c=e.UserInfo.platform.share,u=e.UserInfo.platform.erweima;-1!=h&&(this.showleftbarBtn(this.wanbafenxiang,"true"==c),this.showleftbarBtn(this.suyishoucang,"true"==u),e.ShareWanbaControler.getInstance().sendWANBA_INFO_C()),e.SearchTreasureController.getInstance().sendTreasureSale()},s.prototype.hideMfsqHongbao=function(e){this.showleftbarBtn(this.mfsqGroup,e)},s.prototype.chengeModuleImg=function(){var t=e.ModuleOpenController.getInstance().getCurModuleVO(),i=e.ModuleOpenController.getInstance().getNextModuleVO(),n=e.ModuleOpenController.getInstance().getLastModuleVO();t?(this.moduleOpenImg.source=t.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(t.describe),this.moduleOpenImg.visible=!0,this.moduleOpenLabel.visible=!0,this.openModuleRedImg.visible=!0,this.moduleOpenAniGroup.visible=!0):(this.openModuleRedImg.visible=!1,null!=i?(this.moduleOpenImg.source=i.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(i.describe),this.moduleOpenAniGroup.visible=!0):e.ModuleOpenController.getInstance().getFinalData()?(this.moduleOpenImg.visible=!0,this.moduleOpenLabel.visible=!0,this.moduleOpenImg.source=n.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(n.describe),this.moduleOpenAniGroup.visible=!0):(this.moduleOpenImg.visible=!1,this.moduleOpenLabel.visible=!1,this.moduleOpenAniGroup.visible=!1,this.moduleOpenAni.stop()))},s.prototype.chengeModuleImgByNext=function(){var t=e.ModuleOpenController.getInstance().getNextModuleVO();null!=t?(this.moduleOpenImg.source=t.icon+"_png",this.moduleOpenImg.visible=!0,this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(t.describe),this.openModuleRedImg.visible=!1,this.moduleOpenAniGroup.visible=!0):e.ModuleOpenController.getInstance().getFinalData()||(this.moduleOpenImg.source="",this.moduleOpenLabel.text="",this.openModuleRedImg.visible=!1,this.moduleOpenAniGroup.visible=!1,this.moduleOpenAni.stop())},s.prototype.sendGiftid=function(){var t=HawkProtocolManager.newBuilder("JsProto.UseCdk1758Req");t.setGiftId(e.UserInfo.getGiftId()),t.setGid(e.UserInfo.platform.uid);var i=getHlmyGw();t.setHlmyGw(i),e.Message.instance.send(e.Code.CHECK_CDK_CAN_USE_C,t,!0)},s.prototype.addVipEffect=function(){this.vipAni||(this.vipAni=new e.FoxAni(this.vipAniGroup),this.vipAni.play("effect_vip","ani",-1),this.vipAni1=new e.FoxAni(this.vipAniGroup),this.vipAni1.play("textFlash","ani",-1))},s.prototype.updateModuleOpen=function(t){var i=e.ModuleOpenController.getInstance().getCurModuleVO(),n=e.ModuleOpenController.getInstance().getLastModuleVO();i?(this.moduleOpenImg.source=i.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(i.describe),this.moduleOpenImg.visible=!0,this.moduleOpenLabel.visible=!0,this.moduleOpenAniGroup.visible=!0):e.ModuleOpenController.getInstance().getNextModuleVO(t)?(this.moduleOpenImg.source=e.ModuleOpenController.getInstance().getNextModuleVO(t).icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(e.ModuleOpenController.getInstance().getNextModuleVO(t).describe),this.moduleOpenAniGroup.visible=!0):e.ModuleOpenController.getInstance().getFinalData()?(this.moduleOpenImg.visible=!0,this.moduleOpenLabel.visible=!0,this.moduleOpenImg.source=n.icon+"_png",this.moduleOpenLabel.textFlow=(new egret.HtmlTextParser).parser(n.describe),this.moduleOpenAniGroup.visible=!0):(this.moduleOpenImg.visible=!1,this.moduleOpenLabel.visible=!1,this.moduleOpenAniGroup.visible=!1,this.moduleOpenAni.stop())},s.prototype.chuanshuaobtn=function(){!e.CreateNewVipController.instance.isReceiveAward(16)&&this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600019)?(null==this.csAni&&(this.csAni=new e.FoxAni(this.csAniGroup)),this.csAni.play("achievementAnimation","ani"),this.showleftbarBtn(this.chuanshuogroup,!0)):(this.csAni&&(this.csAni.clear(),this.csAni=null),this.showleftbarBtn(this.chuanshuogroup,!1))},s.prototype.checkHuoBanGroup=function(t){if(0!=this.isInit&&this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600025))if(t)null==this.hbAni&&(this.hbAni=new e.FoxAni(this.hbAniGroup),this.hbAni.play("achievementAnimation","ani"),this.hbAniGroup.visible=!0);else if(this.hbAni){var i=e.PlayerService.instance.getRoleDataList().length,n=e.PlayerService.instance.level,o=e.PlayerService.instance.vipLevel,a=void 0,s=void 0;1==i?(a=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV1")),s=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV1"))):(a=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENLV2")),s=Number(e.GlobalConfig.instance.getValue("CHARACTEROPENVIPLV2"))),n>=a&&o>=s&&(this.hbAniGroup.visible=!1)}},s.prototype.hbani=function(){this.hbAniGroup.visible=!1},s.prototype.checkRechangeGroup=function(t){0!=this.isInit&&this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600014)&&(this.showleftbarBtn(this.shouchonggroup,!0),e.GamePlatform.isDragonEx_qld&&this.showleftbarBtn(this.shouchonggroup,!1),e.PlayerService.instance.playerInfo.getFirstRechargeState()?this.firstRechargeBtn.source="chongzhiss_png":e.FirstpayByDayControler.getInstance().getmodel().firstpaystate?(t=!0,this.firstRechargeBtn.source="meirishouchong_png",e.FirstpayByDayControler.getInstance().getmodel().status?this.dayPayRedImg.visible=!0:this.dayPayRedImg.visible=!1):(this.firstRechargeBtn.source="chongzhiaa_png",this.dayPayRedImg.visible=!1),t?(null==this.fpAni&&(this.fpAni=new e.FoxAni(this.fpAniGroup)),this.fpAni.play("achievementAnimation","ani"),this.fpAniGroup.visible=!0):(this.fpAniGroup.visible=!1,this.fpAni&&(this.fpAni.clear(),this.fpAni=null)))},s.prototype.sceneWindowHandler=function(e){this.isInit&&this.changeScene()},s.prototype.changeScene=function(){var e=ScreenAdaptation.instance.screenWidth,t=e-(e-ScreenAdaptation.instance.designWidth>>1);this.MainHeadGroup.x=this.chatOrMailGroup.x=this.leftBar.x=-(e-ScreenAdaptation.instance.designWidth>>1),this.rightBar.x=t-this.rightBar.width,this.exit_copyBtn.x=ScreenAdaptation.instance.screenWidth/2+ScreenAdaptation.instance.designWidth/2-109-this.x,this.exit_copyBtn.y=ScreenAdaptation.instance.screenHeight-110-this.y,this.mainJPGroup.x=t-this.mainJPGroup.width-18,this.moduleOpenImg.x=0,this.moduleOpenLabel.x=0},s.prototype.getBossData=function(){var t=e.NewBossMainModel.getIntance();t.getMsgDataGroup()},s.prototype.takeMsgCache=function(){if(this.msgCacheList.length>0){for(var e=0;e<this.msgCacheList.length;e++)this.addMsgToGroup(this.msgCacheList[e]);this.msgCacheList=[]}},s.prototype.addMsgToGroup=function(e){if(0==this.isInit)return void this.msgCacheList.push(e);e.maxWidth=this.newMsgGroup.width,this.newMsgGroup.addChild(e),this.updateMsgPos();var t;e instanceof eui.Group?t=e.getChildAt(0):e instanceof eui.Label&&(t=e)},s.prototype.chatLinkHandler=function(t){if("gotoWorldBoss"==t.text){if(e.WorldBossController.getInstance().isBoss||e.UnionController.getInstance().isInBonFire)return;e.WorldBossController.getInstance().requestEnter(),e.NewChatControler.getInstance().closeChatPanel()}},s.prototype.updateMsgPos=function(){switch(this.checkType(),this.msgPosType){case 1:this.updataMsgPosType_1();break;case 2:this.updataMsgPosType_2()}},s.prototype.checkType=function(){var e=0,t=this.newMsgGroup.numChildren;if(!(0>=t)){for(var i=t-1;i>=0;i--)e+=this.newMsgGroup.getChildAt(i).height;e<this.newMsgGroup.height+8?this.msgPosType=1:this.msgPosType=2}},s.prototype.updataMsgPosType_1=function(){for(var e=0,t=this.newMsgGroup.numChildren,i=0;t>i;i++)this.newMsgGroup.getChildAt(i).y=e,e+=this.newMsgGroup.getChildAt(i).height+8},s.prototype.updataMsgPosType_2=function(){for(var e=this.newMsgGroup.height-5,t=(this.newMsgGroup.height,this.newMsgGroup.numChildren),i=t-1;i>=0;i--)if(this.newMsgGroup.getChildAt(i).y=e-this.newMsgGroup.getChildAt(i).height,e-=this.newMsgGroup.getChildAt(i).height+8,-60>e){this.newMsgGroup.removeChildAt(0),this.updataMsgPosType_2();break}},s.prototype.setBossFightCountProgress=function(t,i){var n=this;if(this.inBattle){var o=new eui.Group;this.addChild(o),o.x=this.width>>1,o.y=(this.height>>1)+50;var a=new e.FoxAni(o);a.play("starani"),egret.Tween.get(o).to({x:this.rightBar.x+50,y:(this.height>>1)+100},800).call(function(){a.clear(),a=null,o.removeChildren(),n.removeChild(o),o=null})}this.bossFightCount.value=t,this.bossFightCount.maximum=this.monsterlen(),this.fightCountAni&&!this.fightCountAni.isPlay,t>=0&&this.refreshTask()},s.prototype.recvMsg=function(t,i){if(t==e.Code.WANBA_VIP_PACKAGE_S){var o=i,a=[];return a[0]="领取成功\n道具已发放至背包",a[2e3]="系统繁忙",a[2001]="参数错误",a[2002]="拉取礼包数据出错",a[2003]="礼包兑换达到上限",a[2004]="非积分兑换礼包及VIP礼包",a[2005]="积分不足，无法兑换积分礼包",a[2006]="用户非VIP，无法兑换VIP礼包",a[2007]="用户VIP等级与VIP礼包等级不符，无法兑换",a[2008]="礼包已过期",a[2009]="单用户兑换积分礼包次数限制",void e.PopUpController.getInstance().showTextPanel(a[o.getErrorNo()])}if(t==e.MsgCMD.UICanHideSomethingForDrawLess?this.barFather.visible&&(this.barFatherVisibleOldValue=this.barFather.visible):t==e.MsgCMD.UIRestoreHideSomethingForDrawLess&&(this.barFather.visible=this.barFatherVisibleOldValue),t==e.Code.MAINMISSION_BONUS_S_VALUE,t==e.MsgCMD.REFRESH_PLAYERDATA?(this.setRoleInfo(),this.isInit&&(e.PlayerService.instance.playerInfo.getFirstRechargeState()?this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600014)&&this.checkRechangeGroup(!0):this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600014)&&this.checkRechangeGroup(!1))):t==e.MsgCMD.MAIN_NOTICE_GIFT||t==e.MsgCMD.MAIN_NOTICE_ACTIVITY||t==e.MsgCMD.MAIN_NOTICE_RAID||t==e.MsgCMD.MAIN_NOTICE_CHAT?this.isInit&&(this.noticeMap.put(t,i),this.setNotice()):t==e.MsgCMD.MAIN_SCENE_CLICK?this.switchToShowMainScene():t==e.MsgCMD.BATTLE_SCENE_CLICK?this.switchToShowBattleScene():t==e.Code.CHECK_CDK_CAN_USE_S?this.updateGift(i):t==e.Code.BATTLE_FAST_FIGHT_S?(e.BattleService.instance.offlineResult=i.result,e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.FIGHTOFFLINE,data:2})):t==e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE&&(this.tiaozhanbossBtn.enabled=i,this.setAutoBossBtnState(!1)),t==e.MsgCMD.CHA_YOU_LIAO_QIE&&(this.peopleId=i,this.setGroup()),t==e.MsgCMD.BOTTOM_NOTICE_PACKAGE&&e.PlayerService.instance.mainRoleInfo){var s=e.PlayerService.instance.mainRoleInfo.getFight();if(s>=e.Global.ArenaFightLimit){var r=HawkProtocolManager.newBuilder("JsProto.HPArenaDefenderList");r.setPlayerId(e.PlayerService.instance.playerInfo.getPlayerId())}}if(t==e.Code.ARENA_DEFENDER_LIST_SYNC_S||t==e.MsgCMD.ARENA_CHALLENGE_COUNT){var l=e.PlayerService.instance.mainRoleInfo.getFight();if(l<e.Global.ArenaFightLimit)return;var h=(e.PlayerService.instance.playerInfo.getGold(),void 0),c=void 0;t==e.Code.ARENA_DEFENDER_LIST_SYNC_S&&(h=i.getSelf().getSurplusChallengeTimes(),c=i.getSelf().getNextBuyPrice())}if(t==e.MsgCMD.AUTO_FIGHT_BOSS){if(this.tiaozhanbossBtn.scaleX=.8,this.tiaozhanbossBtn.scaleY=.8,n.instance.state==e.BattleState.WAITING||n.instance.state==e.BattleState.INTERRUPT||n.instance.state==e.BattleState.CHANGETOWAIT)return;this.guankabossTiaoVisible(!1),e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_PVE_BOSS,e.PlayerService.instance.playerStateInfo.getCurBattleMap())}t==e.Code.CHANNEL_CRETIFICATION_AWARDS_S&&this.by1758Rsp(i),t==e.MsgCMD.QUICK_GET_REWARD&&(e.Global.killMonsterNum=this.monsterlen(),n.instance.fightCount>=e.Global.killMonsterNum?this.isplayboss=!0:this.isplayboss=!1,this.rewardCout<1&&(this.rewardCout+=1),this.setBossFightCountProgress(n.instance.fightCount,e.Global.killMonsterNum),n.instance.fightCount>=e.Global.killMonsterNum?(this.tiaozhanbossBtn.enabled=!0,this.autoFightBtn.selected&&(e.Global.isAutoFightBoss=!0)):this.guankaBossAnimation&&this.guankaBossAnimation.isPlay&&(this.guankaBossAnimation.clear(),this.guankaBossAnimation=null)),t==e.MsgCMD.NEW_NOTICE_TASK_OPEN_ACTIVITY&&this.recvMsgShowUiWidgetFromTaskId(i),t==e.Code.VISITOR_LIMIT_INFO_S&&this.xyw_visitorLimitRsp(i),t==e.Code.add_LOGIN_TIMES_S&&this.xyw_gameTime(i)},s.prototype.openTips=function(t){e.PopUpController.getInstance().showTextPanel(t,this,this.payYes,"",null,"","确定","No",20,!1,!1)},s.prototype.payYes=function(){e.RechargeController.getInstance().closeFirstRechargePanel()},s.prototype.setMonthCost=function(e){this.xyw_MonthCost=e},s.prototype.getMonthCost=function(){return this.xyw_MonthCost},s.prototype.setAllowRecharge=function(e){this.xyw_allowRecharge=e},s.prototype.getAllowRecharge=function(){return this.xyw_allowRecharge},s.prototype.xyw_gameTime=function(t){var i=Number(t.getOnlineTime()),n=this.xyw_nonageAllowTime-i;if(0>=n){var o="根据广电总署发布的相关通知规定，其他时间每日累计游戏时长不得超过1.5小时！";e.PopUpController.getInstance().showTextPanel(o,this,this.gameTimeYes,"",null,"","确定","No",20,!1,!1)}else setTimeout(this.xywSendGameTime.bind(this),n)},s.prototype.gameTimeYes=function(){window.location.reload()},s.prototype.xywSendGameTime=function(){var t=Buffer.addLoginTimesReq=HawkProtocolManager.newBuilder("JsProto.addLoginTimesReq");e.Message.instance.send(e.Code.add_LOGIN_TIMES_C,t,!0)},s.prototype.xyw_visitorLimitRsp=function(t){var i=Number(t.getTime());if(0==i){clearTimeout(this.xywSendMsg.bind(this));var n="根据广电总署发布的相关通知规定，游客体验模式体验游戏时长不得超过1小时，您的剩余游戏体验时长为0小时，请注册账号体验游戏。";e.PopUpController.getInstance().showTextPanel(n,this,this.youkeYes,"",null,"","确定","No",20,!1,!1)}else setTimeout(this.xywSendMsg.bind(this),i)},s.prototype.youkeYes=function(){window.location.reload()},s.prototype.xywSendMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.visitorLimitReq");console.log(this.xwydeviceUUIDstr);var i=this.xwydeviceUUIDstr;e.LoginController.instance,t.setDevice(i),e.Message.instance.send(e.Code.VISITOR_LIMIT_INFO_C,t,!0)},s.prototype.getFirstRechargeBtnPoint=function(){var e=this.firstRechargeBtn.localToGlobal(this.firstRechargeBtn.anchorOffsetX,this.firstRechargeBtn.anchorOffsetY);return e},s.prototype.getchuanshuoBtnPoint=function(){var e=this.chuanshuoBtn.localToGlobal(this.chuanshuoBtn.anchorOffsetX,this.chuanshuoBtn.anchorOffsetY);return e},s.prototype.updateGift=function(t){6==t.getStatus()?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("1758_LIBAO_TIP1")):0==t.getStatus()?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("1758_LIBAO_TIP2")):1==t.getStatus()?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("1758_LIBAO_TIP3")):2==t.getStatus()?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("1758_LIBAO_TIP4")):3==t.getStatus()&&e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("1758_LIBAO_TIP5s"))},s.prototype.setAutoBossBtnState=function(t){this.autoFightBtn.selected=t,e.Global.isAutoFightBoss=t},s.prototype.newBeeInFightScene=function(){e.PopUpManager.instance.hasPopUp(e.WindowName.HELP_TIP)&&e.PopUpManager.instance.removePopUp(e.WindowName.HELP_TIP);var t=2;e.Message.instance.send(e.MsgCMD.NEWBEEFORFIGHTCONTROLER,t)},s.prototype.setRoleInfo=function(){if(this.isInit){this.roleDataList=e.PlayerService.instance.getRoleDataList(),3==this.roleDataList.length&&(this.showleftbarBtn(this.huobangroup,!1),this.checkHuoBanGroup(!1));var t=e.PlayerService.instance.mainRoleInfo;if(t){var i=e.PlayerService.instance.getRoleVO(t.getItemId());i&&(this.roleType.source="zhiye_"+i.profession+"_png",this.head_img.source=i.icon),this.nameLab.text=t.getName();var n=t.getLevel();this.recvMsgUpdateShowUiWidgetFromPlayerLevel(1*n),this.lvLab.text="Lv."+n.toString(),n+=1;var o=e.PlayerService.instance.getRoleLevelExp(n);if(o){var a=Number(t.getExp())/o.exp;e.Message.instance.send(e.MsgCMD.SET_expBarProgress,a,!1)}this.zhanliBmLab.text!=e.PlayerService.instance.fightValue.toString()&&(this.zhanliBmLab.text=e.PlayerService.instance.fightValue.toString(),e.Global.isWeChatXiaoChengXuBranch&&(e.PlayerService.instance.fightValue<1e8?this.zhandilidikuang.width=360:this.zhandilidikuang.width=380))}var s=e.PlayerService.instance.playerInfo;s&&(this.vipAsset.source="u_vip"+s.getVipLevel().toString()+"_png",this.goldCoinLab.text=e.GlobalUtil.getUnitString(s.getCoin(),2),this.yuanBaoLab.text=e.GlobalUtil.getUnitString(s.getGold(),2),e.ActivityBarController.getInstance().refreshSearchTreasureRedPoint());var r=e.BattleService.instance.mapStatistics;if(r){var l=e.PlayerService.instance.playerInfo.getVipLevel(),h=e.JsonDataManager.instance.vipTemplate,c=h[l],u=c.experienceAddition/1e4;c.copperMoneyAdded/1e4;this.chanJinType.text=this.mapCfg[r.getMapId()].name,r.getExpRatio()-u>1?this.expSpeed.text=r.getExpRate()+"/"+e.LanguageUtils.instance.getValue("HOUR")+"  x"+r.getExpRatio():this.expSpeed.text=r.getExpRate()+"/"+e.LanguageUtils.instance.getValue("HOUR")}if(e.Global.areanFightRecored>0)return;e.Global.areanFightRecored=null!=e.PlayerService.instance.mainRoleInfo?e.PlayerService.instance.mainRoleInfo.getFight():0}},s.prototype.setNotice=function(){if(null!=this.noticeMap){var e;for(var t in this.noticeMap)this.noticeMap.hasOwnProperty(t)&&(e=this.noticeMap.remove(t))}},s.prototype.btnClick=function(t){var o=this;if(1!=this._getLock){this._getLock=1;var a=egret.setTimeout(function(){o._getLock=0,egret.clearTimeout(a),a=null},this,300),r=t.target;if(r)switch(r){case this.chatCloseBtn:App.SoundManager().setSoundStatus(!0),this.setSoundBtn(!0);break;case this.chatBtn:App.SoundManager().setSoundStatus(!1),this.setSoundBtn(!1);break;case this.chatWindow:e.NewChatControler.getInstance().showPanel();break;case this.mailBtn:e.MailController.getInstance().showMailPanel();break;case this.commandBtn:e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.COMMANDTOOLS);break;case this.yieldGroup:e.YieldController.getInstance().showPanel(),e.YieldController.getInstance().setModelYieldData(e.BattleService.instance.mapStatistics);break;case this.addGoldCoinBtn:e.ShopMainControler.getInstance().showBuyItemPanel(120012);break;case this.addYuanBaoBtn:e.RechargeController.getInstance().showPanel();break;case this.vipBtn:e.CreateNewVipController.instance.showPanel();break;case this.exit_copyBtn:n.instance.quitFuBen(),n.instance.interruptCurrentBattle(),this.bossFightBloodVisible(!0,!1,0),e.MainBottomControler.instance.setMaincityvisible(!0);break;case this.tiaozhanbossBtn:this.guankaTiaoZhanEvent();break;case this.autoFightBtn:App.GuideUtils().currPart==e.GuidePart.currPart23&&2==App.GuideUtils().currStep&&(App.GuideUtils().currPart=App.GuideUtils().currStep=0,App.GuideUtils().hide());var l=Number(e.GlobalConfig.instance.getValue("BOSSAUTOFIGHTLEVEL")),h=Number(e.GlobalConfig.instance.getValue("BOSSAUTOFIGHTVIPLEVEL")),c=e.PlayerService.instance.level,u=e.PlayerService.instance.vipLevel;if(l>c&&h>u)return this.setAutoBossBtnState(!1),void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("VIPAUTOMATICCHALLENGE"));n.instance.fightCount>=e.Global.killMonsterNum,this.setAutoBossBtnState(this.autoFightBtn.selected);break;case this.huobanBtn:e.CharacterOpenController.getInstance().showPanel();break;case this.giftBtnop:if(this.isGiftBtnCanClick){this.isGiftBtnCanClick=!1;var p=this.rewardTweenGroup.width,g=0;g=this.rewardIsClose?this.rewardMask.x:this.rewardMask.x-p-p/4,TweenMax.to(this.rewardTweenGroup,.5,{x:g,onComplete:function(){o.isGiftBtnCanClick=!0,TweenMax.killTweensOf(o)}}),this.rewardIsClose=!this.rewardIsClose,t.stopPropagation(),(App.GuideUtils()._parent==this.leftBar||App.GuideUtils()._parent==this.newReward)&&(this.rewardIsClose?App.GuideUtils().change_point("left",null,105,0):App.GuideUtils().change_point("right",null,105,0))}break;case this.moduleOpenImg:e.ModuleOpenController.getInstance().openModuleSendData(),e.ModuleOpenController.getInstance().showPanel(!0);break;case this.mainPageBtn:e.MainBottomControler.PageState=e.SceneType.MainCity,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,e.SceneType.MainCity),s.instance.refreshPKPlayer(),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.MAIN_SCENE_CLICK),this.initMainCityVisible(!1),i.instance.canMoveBg=!0,i.instance.moveBG();var d=egret.getTimer(),f=d-this.lastRequestRankTime;f>6e4&&(e.RankController.getInstance().requestRankInfo(e.RankType.ZHANSHENBANG,1),e.RankController.getInstance().requestRankInfo(e.RankType.FASHENGBANG,1),e.RankController.getInstance().requestRankInfo(e.RankType.DAOZUNBANG,1),this.lastRequestRankTime=d);break;case this.battlePageBtn:this.gotoField();break;case this.mfsqBtn:console.log("漫方手Q按钮 ！！"),e.MfsqRedPackController.getInstance().showView()}}},s.prototype.gotoField=function(){e.MainBottomControler.PageState=e.SceneType.Field,e.Message.instance.send(e.MsgCMD.SwitchSceneType_Msg,e.SceneType.Field),s.instance.refreshPKPlayer(),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.FIGHT),n.instance.moveBG(),e.PopUpManager.instance.removeAll(),e.Message.instance.send(e.MsgCMD.BATTLE_SCENE_CLICK),this.initMainCityVisible(!0)},s.prototype.initMainCityVisible=function(e){this.mainPageBtn.touchEnabled=e,this.mainPageBtn.visible=e,this.battlePageBtn.touchEnabled=!e,this.battlePageBtn.visible=!e},s.prototype.guankaTiaoZhanEvent=function(){var t=e.JsonDataManager.instance.mapTemplate,i=t[e.PlayerService.instance.playerStateInfo.getCurBattleMap()],o=i.limitLevel;return e.PlayerService.instance.playerInfo&&e.PlayerService.instance.playerInfo.getLevel()<o?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("MAPBOSSFIGHTTIPS",o)):(e.BagController.getInstance().checkBagEnough(this,this.CanTiaoZhan),this.canT?(this.canT=!1,this.tiaozhanbossBtn.enabled=!1,n.instance.fightCount=-1,e.Global.killMonsterNum=this.monsterlen(),this.setBossFightCountProgress(n.instance.fightCount,e.Global.killMonsterNum),void(n.instance.state!=e.BattleState.WAITING&&n.instance.state!=e.BattleState.INTERRUPT&&n.instance.state!=e.BattleState.CHANGETOWAIT&&(this.guankabossTiaoVisible(!1),this.exit_copyBtn.visible=!0,this.exit_copyBtn.touchEnabled=!0,e.MainBottomControler.instance.setMaincityvisible(!1),App.SoundManager().playEffect("bossbellow_mp3"),e.RequestFightManager.instance.tiaoZhanBoss(e.BattleType.BATTLE_PVE_BOSS,e.PlayerService.instance.playerStateInfo.getCurBattleMap())))):(e.Message.instance.send(e.MsgCMD.TIAO_ZHAN_BOSS_VISIBLE,!0),void(e.Global.isAutoFightBoss=!1)))},s.prototype.CanTiaoZhan=function(e){this.canT=!0},s.prototype.switchToShowMainScene=function(){i.instance.moveBG(),i.instance.showOnce=!0,this.guankabossTiaoVisible(!1),this.inBattle=!1,this.exit_copyBtn.touchEnabled=!1,this.exit_copyBtn.visible=!1,this.mainJPGroup.visible=!0,this.mainJPGroup.touchChildren=!0,this.rightBar.visible=!1,this.wanfaGroup.visible=!1,this.fubenGroup.visible=!1,this.bossGroup.visible=!1,this.rightBar.touchChildren=!1,this.initMainJPUI(),e.GlobalUtil.destroyGroup("createCharacterPanelGroup"),this.didOnceSwitchToBattleForceHideMainSceneObjects&&(this.didOnceSwitchToBattleForceHideMainSceneObjects=!1,e.MapSceneService.instance.forceShowChangeMainPlayer(),e.MapSceneService.instance.forceShowChangeOtherPlayer(),t.instance.sceneView.loadAndShowNpc()),this.inRequestSwitchToBattle=!1,this.inRequestLeaveBattle=!0,this.leaveBattleSceneTimestamp=egret.getTimer(),this.didOnceLeaveBattleForceHideBattleSceneObjects=!1},s.prototype.checkGuanKaBossCanFight=function(){if(n.instance.fightCount>=e.Global.killMonsterNum)this.guankaTiaoZhanEvent();else if(this.missionList=e.PlayerService.instance.missionList,0==this.missionList[0].getTag()){var t=this.missionList[0].getId(),i=e.JsonDataManager.instance.mainMissionTemplate,o=i[t];if(1==o.type){var a=void 0,s=e.Global.killMonsterNum-n.instance.fightCount-1;0==s||this.canT||(a=e.LanguageUtils.instance.getValue("TIAOZHAN_GKRW",s),e.PopUpController.getInstance().showFloatTextPanel1(a))}}},s.prototype.guankabossTiaoVisible=function(t){this.initUpdateShowUiWidgetFromPlyerLevel(1*e.PlayerService.instance.playerInfo.getLevel()),n.instance.fightCount<e.Global.killMonsterNum&&(this.tiaozhanbossBtn.enabled=!1);var i=e.WorldBossController.getInstance().isBoss,o=e.UnionController.getInstance().isInBonFire;i||o||(this.rightBar.visible=t)},s.prototype.switchToShowBattleScene=function(){i.instance.showOnce=!1,n.instance.moveBG(null,null,!0),this.rightBar.visible=!0,this.rightBar.touchChildren=!0,(!n.instance.currentBattle||n.instance.currentBattle&&n.instance.currentBattle.battleType==e.BattleType.BATTLE_PVE_MONSTER)&&(this.exit_copyBtn.touchEnabled=!1,this.exit_copyBtn.visible=!1,this.mainOrBattleState(!1),this.guankabossTiaoVisible(!0)),this.setBossTipVisible(!1),this.mainJPGroup.visible=!1,this.inBattle=!0,this.setBattleNotice(),this.didOnceLeaveBattleForceHideBattleSceneObjects&&(this.didOnceLeaveBattleForceHideBattleSceneObjects=!1,n.instance.restoreNpcPlayerMonster()),this.inRequestLeaveBattle=!1,this.inRequestSwitchToBattle=!0,this.switchToBattleTimestamp=egret.getTimer(),this.didOnceSwitchToBattleForceHideMainSceneObjects=!1},s.prototype.initMainJPUI=function(){this.sceneJingJian(this.tuan_key.visible),this.mainJPGroup.visible&&this.btnRightMenu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mainJPClick,this)},s.prototype.mainJPClick=function(e){switch(e.target){case this.btnRightMenu:this.MainCityBtnGroup.visible?(this.MainCityBtnGroup.visible=!1,this.jingjian_btn.touchEnabled=!1,this.pingbi_btn.touchEnabled=!1,this.jingjian_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.mainJPClick,this),this.pingbi_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.mainJPClick,this)):(this.MainCityBtnGroup.visible=!0,this.jingjian_btn.touchEnabled=!0,this.pingbi_btn.touchEnabled=!0,this.jingjian_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mainJPClick,this),this.pingbi_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mainJPClick,this));break;case this.jingjian_btn:this.tuan_jingjian.visible=!this.tuan_jingjian.visible,this.sceneJingJian(this.tuan_jingjian.visible);break;case this.pingbi_btn:this.tuan_pingbi.visible=!this.tuan_pingbi.visible,this.scenePingBi(this.tuan_pingbi.visible)}},s.prototype.sceneJingJian=function(e){this.tuan_jingjian.visible?this.tuan_key.visible=!0:this.tuan_key.visible=!1,this.mainOrBattleState(!e)},s.prototype.scenePingBi=function(e){},s.prototype.mainOrBattleState=function(t){var i=e.WorldBossController.getInstance().isBoss,n=e.UnionController.getInstance().isInBonFire,o=e.FactionBattleController.getInstance().isFactionbattle;return o?(this.barFather.visible=!0,this.leftBar.visible=!1,this.chatOrMailGroup.visible=!1,this.rightBar.visible=!1,this.mainJPGroup.visible=!1,this.exit_copyBtn.visible=!1,this.bottomBar.visible=!1,this.moduleOpenImg.visible=!1,this.moduleOpenLabel.visible=!1,this.changeOpenModuleRedImgState(!1),void e.ActivityBarController.getInstance().showOrClosePanel(!1)):i?(this.barFather.visible=!0,this.leftBar.visible=!1,this.chatOrMailGroup.visible=!0,this.rightBar.visible=!1,this.mainJPGroup.visible=!1,this.exit_copyBtn.visible=!1,this.bottomBar.visible=!1,this.moduleOpenImg.visible=!1,this.moduleOpenLabel.visible=!1,this.changeOpenModuleRedImgState(!1),void e.ActivityBarController.getInstance().showOrClosePanel(!1)):n?(this.barFather.visible=!0,this.leftBar.visible=!1,this.chatOrMailGroup.visible=!0,this.rightBar.visible=!1,this.mainJPGroup.visible=!1,this.exit_copyBtn.visible=!1,this.moduleOpenImg.visible=!1,this.moduleOpenLabel.visible=!1,this.changeOpenModuleRedImgState(!1),void e.ActivityBarController.getInstance().showOrClosePanel(!1)):(this.chatOrMailGroup.visible=!0,e.ActivityBarController.getInstance().showOrClosePanel(t),this.yieldGroup.visible=t,this.yieldGroup.touchChildren=t,this.leftBar.visible=t,this.leftBar.touchChildren=t,this.newReward.visible=t,this.newReward.touchChildren=t,this.moduleOpenImg.visible=t,this.moduleOpenLabel.visible=t,this.changeOpenModuleRedImgState(t),void(e.Global.isAppStoreReview&&(this.fubenGroup.visible=!1,this.newReward.visible=!1,this.autoFightBtn.visible=!1)))},s.prototype.changeOpenModuleRedImgState=function(e){e?this.openModuleLastVisibleState&&(this.openModuleRedImg.visible=!0,this.openModuleLastVisibleState=!1):(this.openModuleRedImg.visible&&(this.openModuleLastVisibleState=this.openModuleRedImg.visible),this.openModuleRedImg.visible=!1)},s.prototype.showchat=function(e){this.chatOrMailGroup.visible=e},s.prototype.bossFightBloodVisible=function(t,i,n){void 0===i&&(i=!1),e.WorldBossController.getInstance().isBoss||e.UnionController.getInstance().isInBonFire||(i?(this.mainOrBattleState(!t),this.exit_copyBtn.touchEnabled=!0,this.exit_copyBtn.visible=!0):(this.mainOrBattleState(t),this.exit_copyBtn.touchEnabled=!1,this.exit_copyBtn.visible=!1),this.bottomBar.visible=t,this.rightBar.visible=t,n==e.BattleType.LEGENDARY_EMPIRE&&(this.rightBar.visible=!1),t&&e.MainBottomControler.PageState==e.SceneType.MainCity&&(this.rightBar.visible=!1))},s.prototype.setRightBarVisible=function(e){this.rightBar.visible=e},s.prototype.jingjiPvpChangeUI=function(){this.exit_copyBtn.touchEnabled=!0,this.exit_copyBtn.visible=!0,this.rightBar.visible=!1,e.MainBottomControler.instance.setMaincityvisible(!1)},s.prototype.kuafuFightVisible=function(){this.exit_copyBtn.visible=!1,this.rightBar.visible=!1,this.bottomBar.visible=!1},s.prototype.setBottomVisible=function(e){this.bottomBar.visible=!!e},s.prototype.bossFightPvpVisible=function(t){this.guankabossTiaoVisible(t),e.MainBottomControler.instance.setMaincityvisible(!1)},s.prototype.turnYeWaiViewFormPk=function(){this.newBeeInFightScene()},s.prototype.bossFightCopyVisible=function(t){void 0===t&&(t=!1),this.guankabossTiaoVisible(t),t||(this.mainOrBattleState(!1),this.exit_copyBtn.touchEnabled=!0,this.exit_copyBtn.visible=!0,this.rightBar.visible=!1,e.MainBottomControler.instance.setMaincityvisible(!1))},s.prototype.bossFightTwelvePalaceVisible=function(t){this.guankabossTiaoVisible(t),e.MainBottomControler.instance.setMaincityvisible(t),this.mainOrBattleState(t),this.exit_copyBtn.touchEnabled=t,this.exit_copyBtn.visible=t,this.leftBar.visible=t,this.bottomBar.visible=t,this.rightBar.visible=t},s.prototype.setGroup=function(){this.mytimer.reset(),this.mytimer.start()},s.prototype.timerComFunc=function(){this.peopleId=null},s.prototype.setBattleNotice=function(){var t=e.PlayerService.instance.playerInfo,i=e.PlayerService.instance.playerStateInfo},s.prototype.refreshTask=function(){if(0!=this.isInit){this.missionList=[];var t=e.JsonDataManager.instance.mainMissionTemplate;if(this.missionList=e.PlayerService.instance.missionList,this.missionList.length>0){this.RewardDes.visible=!0,this.RewardNa.visible=!0,this.getBG.visible=!0,this.rewardGroup.visible=!0,this.rewardfoxani||(this.rewardfoxani=new e.FoxAni(this.rewardAniGroup),this.rewardfoxani.anchorOffsetY+=32,this.rewardfoxani.play("taskFlash"));
var i=this.missionList[0],o=t[i.getId()];if(o&&!n.instance.sceneBase.isGuide()){if(o.id>=e.Global.GuideBattleStartIdForPlayer&&o.id<e.Global.GuideMainSceneStartIdForPlayer)return void n.instance.sendMsgSceneChangeRequest(e.WorldSceneType.GuideBattle,0,e.WorldSceneType.OldMonsterBattleMap,0);if(o.id>=e.Global.GuideMainSceneStartIdForPlayer&&o.id<e.Global.GuideAllEndIdForPlayer)return void n.instance.sendMsgSceneChangeRequest(e.WorldSceneType.GuideMainCity,0,e.WorldSceneType.OldMonsterBattleMap,0)}if(o&&o.awardAttr){var a="",s="";if(1==o.type?0==i.getTag()&&(s=e.LanguageUtils.instance.getValue("WEIWANCHENG")+" "+this.bossFightCount.value+"/"+this.bossFightCount.maximum,this.rewardfoxani.isPlay&&this.rewardfoxani.play("taskFlash")):0==i.getTag()&&(s="<font color =0xFF0000>("+i.getProgress().toString()+"/"+o.cond+")</font>",this.rewardfoxani.isPlay&&this.rewardfoxani.play("taskFlash")),i.getTag()&&(s=e.LanguageUtils.instance.getValue("WANCHENG"),this.rewardAniGroup.visible=!0,this.rewardfoxani.play("taskAnim")),!App.GuideUtils().isShow()){var r=e.JsonDataManager.instance.initguidetemp[i.getId()],l=null,h=0;if(r){switch(l=Number(r.id),Log.trace("引导:"+i.getId()+" "+l),l){case 21:i.getTag()&&(h=1);break;case 18:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 13:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 10:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 8:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 6:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 3:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 1:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 25:i.getTag()&&(h=3);break;case 24:i.getTag()&&(h=1);break;case 23:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 22:i.getTag()&&(h=3);break;case 19:i.getTag()&&(h=3);break;case 15:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 16:this.isplayboss||i.getTag()||(l=null),i.getTag()&&(h=1);break;case 17:i.getTag()&&(h=4);break;case 14:i.getTag()?h=0:l=null;break;case 12:i.getTag()&&(h=3);break;case 11:i.getTag()&&(h=3);break;case 9:i.getTag()&&(h=3);break;case 20:i.getTag()&&(h=3);break;case 7:i.getTag()&&(h=3);break;case 5:i.getTag()&&(h=3);break;case 4:i.getTag()&&(h=3);break;case 2:i.getTag()&&(h=4);break;case 46:l=null}1==o.type?this.bossFightCount.value==this.bossFightCount.maximum&&this.guidechange(this.rewardIsClose?this.giftGroup:this.newReward,this.leftBar,l,h):this.guidechange(this.rewardIsClose?this.giftGroup:this.newReward,this.leftBar,l,h)}}a=o.name+s,this.RewardDes.textFlow=(new egret.HtmlTextParser).parser(a);var c=e.JsonDataManager.instance.itemTemplate[o.awardAttr.id];this.RewardNa.text=c.name+"*"+o.awardAttr.value,this.curRewardId=c.id}}else this.RewardDes.text="",this.RewardNa.text="",this.getBG.visible=!1,this.rewardGroup.visible=!1,this.rewardfoxani&&(this.rewardfoxani.dispose(),this.rewardfoxani=null),this.curRewardId=0}},s.prototype.guidechange=function(e,t,i,n,o,a){if(void 0===o&&(o=!1),void 0===a&&(a=1),e&&null!=i){App.GuideUtils().currlv=o;var s={x:e.x*a,y:e.y*a,width:e.width,height:e.height};App.GuideUtils().show(s,t,i,n)}},s.prototype.guidenewReward=function(){this.guidechange(this.rewardIsClose?this.giftBtnop:this.newReward,this.rewardIsClose?this.newReward:this.leftBar,1,1)},s.prototype.getMissionRewards=function(t){var i=this;if(App.GuideUtils().isShow()&&App.GuideUtils().hide(),this.missionList=e.PlayerService.instance.missionList,0==this.missionList[0].getTag()){var n=this.missionList[0].getId(),a=e.JsonDataManager.instance.mainMissionTemplate,r=a[n],l=r.skipType;return e.SkipCodeDataHandler.getInstance().skipTo(l),void((this.isplayboss||0!=l)&&this.missionList[0].getId()<=600036&&App.GuideUtils().play_soung_guide())}if(600014==this.missionList[0].getId()){s.instance.checkRechangeGroup(!0);var h=new eui.Image;h.source="firstpay2_png",e.GamePlatform.isDragonEx_qld&&(h.source=""),h.name="firstpay_png",h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rechargeClickHandler,this),this.leftBar.addChild(h),h.x=this.shouchonggroup.x+63,h.y=this.shouchonggroup.y-201,egret.Tween.get(h,{}).to({},1e3).call(function(){}).wait(1e4).to({alpha:0},1e3).call(function(){i.leftBar.getChildByName("firstpay_png")&&i.leftBar.removeChild(i.leftBar.getChildByName("firstpay_png"))})}var c=HawkProtocolManager.newBuilder("JsProto.HPMissionBonusC");if(c.setId(this.missionList[0].getId()),e.Message.instance.send(e.Code.MAINMISSION_BONUS_C_VALUE,c,!0),600038==this.missionList[0].getId()&&this.guidechange(this.vipBtn,this.vipBtn.parent,e.GuidePart.currPart46,0),this.curRewardId>0){var u=this.rewardTweenGroup.localToGlobal(),p=u;e.FlyController.getInstance().flyToBag(p,this.curRewardId)}switch(this.missionList[0].getId()){case e.MainUiGuideValue.TASK_ID_600016:e.RechargeController.getInstance().showPanel();break;case e.MainUiGuideValue.TASK_ID_600015:e.AchievementController.getInstance().showPanel();break;case e.MainUiGuideValue.TASK_ID_600023_K:e.CreateNewVipController.instance.showPanel();break;case e.MainUiGuideValue.TASK_ID_600025_K:e.WealPanelController.getInstance().showWealPanel();break;case e.MainUiGuideValue.TASK_ID_600029_K:o.getIntance().showPanel();break;case e.MainUiGuideValue.TASK_ID_600032_K:o.getIntance().showPanel(!0,e.activityDaTingType.chengzhangjijin);break;case e.MainUiGuideValue.TASK_ID_600038_K:e.CharacterOpenController.getInstance().showPanel()}600028==this.missionList[0].getId()&&(App.GuideUtils().currPart=e.GuidePart.currPart23,App.GuideUtils().currStep=2,this.guidechange(this.autoFightBtn,this.rightBar,e.GuidePart.currPart23,2)),this.playani_renwuwancheng()},s.prototype.playani_renwuwancheng=function(){var t=this;null==this.playani_wanchengrenwu&&(this.playani_wanchengrenwu=new e.FoxAni(this),this.playani_wanchengrenwu.offsetX=this.width>>1,this.playani_wanchengrenwu.offsetY=this.height>>1,this.playani_wanchengrenwu.play("complete","complete",1),TweenMax.delayedCall(1.3,function(e){t.playani_wanchengrenwu.clear(),t.playani_wanchengrenwu=null,t.playani_renwuxin()}))},s.prototype.playani_renwuxin=function(){var t=this;null==this.playani_xinrenwu&&(this.playani_xinrenwu=new e.FoxAni(this.newReward.parent),this.playani_xinrenwu.offsetX=this.newReward.x+160,this.playani_xinrenwu.offsetY=this.newReward.y-40,this.playani_xinrenwu.play("receive","receive",1),TweenMax.delayedCall(1.3,function(e){t.playani_xinrenwu.clear(),t.playani_xinrenwu=null}))},s.prototype.guidefun=function(){if(43==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getWingGroup(),this.bottomBar.getWingGroup().parent,43,1,!0),27==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getWingGroup(),this.bottomBar.getWingGroup().parent,27,1,!0),27==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz){var e=this.reanchorchang(this.fubenGroup);this.guidechange(e,this.fubenGroup.parent,27,4,!0)}if(28==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.bossGroup);this.guidechange(e,this.bossGroup.parent,28,1,!0)}if(28==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&this.guidechange(this.mailBtn,this.mailBtn.parent,28,5,!0),29==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.fubenGroup);this.guidechange(e,this.fubenGroup.parent,29,1,!0)}if(30==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getheroGroup(),this.bottomBar.getheroGroup().parent,30,1,!0),31==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.wanfaGroup);this.guidechange(e,this.wanfaGroup.parent,31,1,!0)}if(31==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz){var e=this.reanchorchang(this.pkHead1);this.guidechange(e,this.pkHead1.parent,31,5,!0)}if(32==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.fubenGroup);this.guidechange(e,this.fubenGroup.parent,32,1,!0)}if(32==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getRoleGroup(),this.bottomBar.getRoleGroup().parent,32,6,!0),34==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.wanfaGroup);this.guidechange(e,this.wanfaGroup.parent,34,1,!0)}if(35==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.fubenGroup);this.guidechange(e,this.fubenGroup.parent,35,1,!0)}if(35==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getRoleGroup(),this.bottomBar.getRoleGroup().parent,35,6,!0),36==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.wanfaGroup);this.guidechange(e,this.wanfaGroup.parent,36,1,!0)}if(37==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.wanfaGroup);this.guidechange(e,this.wanfaGroup.parent,37,1,!0)}if(38==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getRoleGroup(),this.bottomBar.getRoleGroup().parent,38,1,!0),39==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getRoleGroup(),this.bottomBar.getRoleGroup().parent,39,1,!0),40==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getRoleGroup(),this.bottomBar.getRoleGroup().parent,40,1,!0),46==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getRoleGroup(),this.bottomBar.getRoleGroup().parent,46,1,!0),33==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.group5,this.bottomBar.group5.parent,33,1,!0),26==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.rightGroup,this.bottomBar.rightGroup.parent,26,1,!0),44==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.wanfaGroup);this.guidechange(e,this.wanfaGroup.parent,44,1,!0)}if(45==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz){var e=this.reanchorchang(this.bossGroup);this.guidechange(e,this.bossGroup.parent,45,1,!0)}48==App.GuideUtils().currdbz&&0==App.GuideUtils().currxbz&&this.guidechange(this.bottomBar.getheroGroup(),this.bottomBar.getheroGroup().parent,48,1,!0)},s.prototype.getfubenbossbtn=function(){var e=this.fubenGroup.localToGlobal(this.fubenGroup.anchorOffsetX,this.fubenGroup.anchorOffsetY);return e},s.prototype.getbossbtn=function(){var e=this.bossGroup.localToGlobal(this.bossGroup.anchorOffsetX,this.bossGroup.anchorOffsetY);return e},s.prototype.getwanfabtn=function(){var e=this.wanfaGroup.localToGlobal(this.wanfaGroup.anchorOffsetX,this.wanfaGroup.anchorOffsetY);return e},s.prototype.reanchorchang=function(e){var t={x:e.x-(e.width>>1),y:e.y-(e.height>>1),width:e.width,height:e.height};return t},s.prototype.zhengbaHandler=function(e){},s.prototype.chuanshuoHandler=function(t){e.LegendaryEquipController.getInstance().showPanel()},s.prototype.setArenaRedPoint=function(){this.refreshWanFaRedImg()},s.prototype.refreshWanFaRedImg=function(){this.wanfaRedImg.visible=e.WanFaController.getInstance().getOperate()},s.prototype.rechargeClickHandler=function(t){if(this.leftBar.getChildByName("firstpay_png")){var i=this.leftBar.getChildByName("firstpay_png");egret.Tween.removeTweens(i),i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.rechargeClickHandler,this),i.parent.removeChild(i)}return e.PlayerService.instance.playerInfo.getFirstRechargeState()?void e.RechargeController.getInstance().showPanel():void(e.FirstpayByDayControler.getInstance().getmodel().firstpaystate?e.FirstpayByDayControler.getInstance().showpanel():e.RechargeController.getInstance().showPanel())},s.prototype.refreshPKPlayer=function(){if(null!=this.pkHeadList){var t,i=1*e.PlayerService.instance.playerInfo.getLevel(),n=this.pkHeadList.length;if(i<e.MainUiGuideValue.PLAYER_LEVEL_FORTYFIVE)for(var o=0;n>o;o++)t=this.pkHeadList[o],t.visible=!1;else{var a=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YEWAIPK),s=e.FieldPKController.getInstance().getPKPlayerList(),r=e.MainBottomControler.PageState==e.SceneType.MainCity;if(Number(e.BattleService.instance.curBattleType)!=e.BattleType.BATTLE_PVE_MONSTER||!a||null==s||r){for(var o=0;n>o;o++)t=this.pkHeadList[o],t.visible=!1;return this.isShowFieldPKRedImg=!1,void this.refreshWanFaRedImg()}var l,h=[];n=s.length;for(var o=0;n>o;o++)l=s[o],null!=l.getPlayer()&&h.push(l);this.isShowFieldPKRedImg=h.length>0,n=this.pkHeadList.length;for(var o=0;n>o;o++)l=h[o],t=this.pkHeadList[o],null!=l&&(t.setItem(l),t.visible=!0);this.refreshWanFaRedImg()}}},s.prototype.pkHeadHandler=function(t){var i=t.currentTarget;e.FieldPKController.getInstance().showPlayerPanel(i.info)},s.prototype.refreshMailStatus=function(){var t=e.MailController.getInstance().getIsFull();this.mailFullImg.visible=t,t?this.mailRedImg.visible=!1:this.mailRedImg.visible=e.MailController.getInstance().getHaveNewMail()},s.prototype.getBagGlobalPos=function(){return this.bottomBar.getBagGlobalPos()},s.prototype.wanfaHandler=function(t){e.WanFaController.getInstance().showPanel()},s.prototype.handlerBegin=function(e){egret.Tween.removeTweens(e.target),egret.Tween.get(e.target).to({scaleX:1.1,scaleY:1.1},50)},s.prototype.handlerEnd=function(e){egret.Tween.removeTweens(e.target);var t=e.target;t.scaleX=t.scaleY=1},s.prototype.fubenHandler=function(t){e.FuBenController.getInstance().showPanel(e.FuBenType.FeatherType)},s.prototype.bossHandler=function(t){this.setBossTipVisible(!1),e.PlayerService.instance.playerInfo&&e.PlayerService.instance.playerInfo.getLevel()<30?e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("BOSSKAIFANG")):e.NewBossMainControler.getIntance().showPanel()},s.prototype.setJuBaoPenBtnVis=function(e){},s.prototype.initUpdateShowUiWidgetFromPlyerLevel=function(t){t>=e.MainUiGuideValue.PLAYER_LEVEL_FORTYFIVE?(n.instance.isInChallengeBattle()||(this.wanfaGroup.visible=!0,this.fubenGroup.visible=!0,this.bossGroup.visible=!0),this.refreshPKPlayer()):t<e.MainUiGuideValue.PLAYER_LEVEL_FORTYFIVE&&(this.wanfaGroup.visible=!1,this.fubenGroup.visible=!0,this.bossGroup.visible=!0,t<e.MainUiGuideValue.PLAYER_LEVEL_THIRTY&&(this.bossGroup.visible=!1),t<e.MainUiGuideValue.PLAYER_LEVEL_TWENTY&&(this.fubenGroup.visible=!1))},s.prototype.recvMsgUpdateShowUiWidgetFromPlayerLevel=function(t){t>e.MainUiGuideValue.PLAYER_LEVEL_SIXTY,t>=e.MainUiGuideValue.PLAYER_LEVEL_ONE,t>=e.MainUiGuideValue.PLAYER_LEVEL_TEN,t>=e.MainUiGuideValue.PLAYER_LEVEL_TWENTY&&(this.fubenGroup.visible=!0),t>=e.MainUiGuideValue.PLAYER_LEVEL_THIRTY&&(this.bossGroup.visible=!0),t>=e.MainUiGuideValue.PLAYER_LEVEL_FORTYFIVE&&(this.wanfaGroup.visible=!0,this.refreshPKPlayer()),t>=e.MainUiGuideValue.PLAYER_LEVEL_FIFTYFIVE,t>=e.MainUiGuideValue.PLAYER_LEVEL_SIXTY&&e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.RANK),t>=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_ICONOPEN"))&&(e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.KUAFULIANSAI),this.isFirstOpenKuaFu&&(this.isFirstOpenKuaFu=!1,e.KFController.getInstance().sendKFInfoMsg())),t>=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN"))},s.prototype.initShowUiWidgetFromTaskId=function(){this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600023)&&(this.tiaozhanbossBtn.visible=!0,this.guanqiaboss.visible=!0,this.autoFightBtn.visible=!0,this.bossFightCount.visible=!0,this.fightCountAniGroup.visible=!0),this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600019)&&this.chuanshuaobtn(),this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600014)&&this.checkRechangeGroup(!0),this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600025)&&this.showleftbarBtn(this.huobangroup,!0),this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600022)&&(e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.FULI),e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.ACTIVITY)),this.curTaskIdCanOpenShowWidget(this.saveTaskData,e.MainUiGuideValue.TASK_ID_600017)&&e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.XUNBAO,!0)},s.prototype.recvMsgShowUiWidgetFromTaskId=function(t){this.saveTaskData=[],this.saveTaskData=t;var i=this.saveTaskData[0].id,n=this.saveTaskData[0].tag;switch(i){case e.MainUiGuideValue.TASK_ID_600014:n&&this.checkRechangeGroup(!0);break;case e.MainUiGuideValue.TASK_ID_600015:n&&e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.ACHIEVEMENT);break;case e.MainUiGuideValue.TASK_ID_600016:break;case e.MainUiGuideValue.TASK_ID_600017:n&&e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.XUNBAO);break;case e.MainUiGuideValue.TASK_ID_600019:n&&this.chuanshuaobtn();break;case e.MainUiGuideValue.TASK_ID_600022:n&&(e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.FULI),e.ActivityBarController.getInstance().checkOpenActivityShow(e.ActivityBtnType.ACTIVITY),o.getIntance().checkServerOpenCloseActivityBtns());break;case e.MainUiGuideValue.TASK_ID_600023:n&&(this.tiaozhanbossBtn.visible=!0,this.guanqiaboss.visible=!0,this.autoFightBtn.visible=!0,this.bossFightCount.visible=!0,this.fightCountAniGroup.visible=!0,this.guankabossTiaoVisible(!0));case e.MainUiGuideValue.TASK_ID_600025:n&&(this.showleftbarBtn(this.huobangroup,!0),this.checkHuoBanGroup(!0))}},s.prototype.curTaskIdCanOpenShowWidget=function(e,t){return e&&e.length>0?e[0].id>t?!0:e[0].id==t&&e[0].tag?!0:!1:!1},s.prototype.setBossTipVisible=function(e){this.bossTipGroup.visible=e},s.prototype.call1758=function(){var t={};t={serverId:e.PlayerService.instance.playerInfo.getServerId(),serverName:e.LoginController.instance.getSeverName(),isNewRole:e.LoginController.instance.getIsRoleNew(),roleId:e.PlayerService.instance.playerInfo.getPlayerId(),roleName:e.PlayerService.instance.mainRoleInfo.getName(),roleLevel:e.PlayerService.instance.playerInfo.getLevel(),roleCoins:e.PlayerService.instance.playerInfo.getGold(),roleTypeName:e.PlayerService.instance.mainRoleInfo.getProf(),vipLevel:e.PlayerService.instance.playerInfo.getVipLevel(),roleCreateTime:null,gameRolePower:e.PlayerService.instance.mainRoleInfo.getFight()},e.UserInfo.platform.getDatacallRollInfo(t)},s.prototype.adaptChatPos=function(e){this.chatOrMailGroupBottom!=e&&(this.chatOrMailGroupBottom=e,1==this.getIsShow()&&(this.chatOrMailGroupBottom?this.chatOrMailGroup.bottom=this.chatOrMailGroup.bottom-70:this.chatOrMailGroup.bottom=this.chatOrMailGroup.bottom+70))},s.prototype.setbtnmask=function(e){1==e?(this.maskcount++,this.btnmask.visible=e,this.maskui.visible=e):(this.maskcount--,0==this.maskcount&&(this.btnmask.visible=e,this.maskui.visible=e))},s.prototype.getbtnmask=function(){return this.btnmask.visible},s.prototype.monsterlen=function(){return Math.floor(Math.max(e.PlayerService.instance.level/15-1,0)+1)},s.prototype.showleftbarBtn=function(e,t){for(var i,n=this.leftList.length,o=0,a=0;n>a;a++)i=this.leftList[a],i==e&&(i.visible=t),1==i.visible&&(i.y=this.leftY[o++])},s.prototype.getStage=function(){return egret.MainContext.instance.stage},s.prototype.stageOnResize=function(){ScreenAdaptation.instance.adaptMain(this),ScreenAdaptation.instance.adaptPanelMask(this.maskui),ScreenAdaptation.instance.adaptPanelBg(this.btnmask),e.GamePlatform.isQQdating&&(this.rightBar.bottom=0,this.leftBar.bottom=120,this.chatOrMailGroup.bottom=0,ScreenAdaptation.instance.adaptActivityBar(e.ActivityBarController.getInstance().getpanel()))},s.prototype.addTouTiaoCount=function(t){"ttgame"==window.GJlenged_chanel&&(t instanceof e.ActivityBarPanel||t instanceof e.MarqueePanel||(this.ttgameKefuCount++,ttKefuBtnHide()))},s.prototype.subtractTouTiaoCount=function(t){"ttgame"==window.GJlenged_chanel&&(t instanceof e.ActivityBarPanel||t instanceof e.MarqueePanel||(this.ttgameKefuCount--,this.ttgameKefuCount>0||ttKefuBtnShow()))},s.prototype.sendby1758RealName=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPChannelCretificatioAwardsReq");t.setChannlName("1758"),e.Message.instance.send(e.Code.CHANNEL_CRETIFICATION_AWARDS_C,t,!0)},s.prototype.by1758Rsp=function(e){console.log("错误码为 "+e.getErrorNo())},s}(e.ViewControler);e.MainControler=a,__reflect(a.prototype,"foxgame.MainControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panel=new e.SuyiFollowPanel}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.registerMsg=function(e){},t.prototype.recvMsg=function(e,t){},t.prototype.showpanel=function(){this.panel.getIsShow()||this.panel.show()},t.prototype.sendCHANNEL_ATTENTION_AWARD_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPChannelAttentionAwardRsp");e.Message.instance.send(e.Code.CHANNEL_ATTENTION_AWARD_C,t,!0)},t}();e.SuyiFollowControler=t,__reflect(t.prototype,"foxgame.SuyiFollowControler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/wanba/SuyiFollowSkin.exml")||this;return e.arr=[],e}return __extends(i,t),i.prototype.initHook=function(){this.ui.followStateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.arr=this.getarr();for(var e=0;e<this.getlist().length;e++){var t=this.getlist()[e];t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this)}},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.followStateBtn:var i={code:"suyiguanzhu"};e.UserInfo.platform.reportData_legend(i)}},i.prototype.clickicon=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.getarr=function(){for(var t=e.GlobalConfig.instance.getValue("CHANNEL_ATTENTION_AWARD"),i=t.split(","),n=[],o=0;o<i.length;o++){var a=new e.AttributeVO(i[o]);n.push(a)}return n},i.prototype.refresh=function(){for(var e=0;e<this.getlist().length;e++){var t=this.getlist()[e],i=this.arr[e];t.setItem(i.id,i.value)}},i.prototype.getlist=function(){var e=[];return e.push(this.ui.itemCell4),e.push(this.ui.itemCell5),e.push(this.ui.itemCell6),e.push(this.ui.itemCell7),e},i}(e.BasePanel);e.SuyiFollowPanel=t,__reflect(t.prototype,"foxgame.SuyiFollowPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SharIngAwardItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.yilingquImg.visible=!1,this.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAwardClick,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.model=e.TTShareController.getInstance().model,this.shareInfo=this.model.shareTaskList[e.TTShareModel.COMMON_TYPE];var i=this.data,n=i.award,o=this.itemGroup.numChildren,a=n.length;if(o>a)for(var s=0;o-a>s;s++)this.itemGroup.removeChildAt(o-1-s);for(var s=0;s<n.length;s++){var r=new e.AttributeVO(n[s]),l=new e.ItemIcon;s>o-1?this.itemGroup.addChild(l):l=this.itemGroup.getChildAt(s),l.setItem(r.id,r.value,!0),l.hasEventListener(egret.TouchEvent.TOUCH_TAP)||l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.yilingquImg.visible=-1==this.shareInfo.getAwardIds().indexOf(Number(i.id))?!1:!0,this.getAwardBtn.visible=!this.yilingquImg.visible;var h=i.desc.split("{0}");this.taskLabel.textFlow=(new egret.HtmlTextParser).parse(h[0]+("<font color=0x21ff03>"+i.shareInCount+"</font>")+h[1]+this.getCanChangedStr(this.shareInfo.getTodayCount(),i.shareInCount))},i.prototype.getCanChangedStr=function(e,t){var i;return i=e>=t?'<font size=20 color=0x21ff03 fontFamily="宋体">'+e+"</font>"+('<font size=20 color=0xffffff fontFamily="宋体">/'+t+"</font>"):'<font size=20 color=0xff0000 fontFamily="宋体">'+e+"</font>"+('<font size=20 color=0xffffff fontFamily="宋体">/'+t+"</font>"),"("+i+")"},i.prototype.onClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.onGetAwardClick=function(t){var i=this;this.shareInfo.getTodayCount()>=this.data.shareInCount?(console.log("发送领取"),e.TTShareController.getInstance().sendMessageGetShareAward(this.shareInfo.getType(),this.data.id)):ttfenxiang(function(t){t&&e.TTShareController.getInstance().sendMessageShareSucc(i.shareInfo.getType())})},i}(eui.ItemRenderer);e.TTAwardItemRender=t,__reflect(t.prototype,"foxgame.TTAwardItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.TTShareModel,this.ttVideo=new e.TTvideoSharePanel(this.model),this.mainPanel=new e.TTShareMainPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.registerMsg=function(t){t.add(e.Code.JRTT_SHARE_SUCC_S,this),t.add(e.Code.JRTT_SHARE_INFO_S,this),t.add(e.Code.JRTT_SHARE_AWARD_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.JRTT_SHARE_INFO_S:this.model.setShareInfo(i);break;case e.Code.JRTT_SHARE_SUCC_S:break;case e.Code.JRTT_SHARE_AWARD_S:}},t.prototype.sendMessageShareSucc=function(t){var i=HawkProtocolManager.newBuilder("JsProto.JRTTShareSuccReq");i.setType(t),e.Message.instance.send(e.Code.JRTT_SHARE_SUCC_C,i,!0)},t.prototype.sendMessageShareinfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.JRTTShareInfoReq");e.Message.instance.send(e.Code.JRTT_SHARE_INFO_C,t,!0)},t.prototype.sendMessageGetShareAward=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.GetJRTTShareGiftReq");n.setType(t),n.setId(Number(i)),e.Message.instance.send(e.Code.JRTT_SHARE_AWARD_C,n,!0)},t.prototype.showPanel=function(){this.mainPanel.getIsShow()||this.mainPanel.show()},t.prototype.showVideoPanel=function(){this.ttVideo.getIsShow()||this.ttVideo.show()},t}();e.TTShareController=t,__reflect(t.prototype,"foxgame.TTShareController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"TTgameShareSkin")||this;return i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnClick,this),this.collection=new eui.ArrayCollection,this.ui.list.dataProvider=this.collection,this.ui.list.itemRenderer=e.TTAwardItemRender},i.prototype.initParams=function(){this.model.initParams()},i.prototype.showHook=function(){this.model.initParams()},i.prototype.refresh=function(){this.model.shareTaskList.length>0&&this.collection.replaceAll(this.model.getShareData(e.TTShareModel.COMMON_TYPE))},i.prototype.onShareBtnClick=function(){ttfenxiang(function(t){t&&e.TTShareController.getInstance().sendMessageShareSucc(e.TTShareModel.COMMON_TYPE)})},i.prototype.panelChange=function(){this.refresh()},i.prototype.closeHook=function(){this.model.curSelectedPanel=-1},i}(e.BasePanel);e.TTShareMainPanel=t,__reflect(t.prototype,"foxgame.TTShareMainPanel",["foxgame.IttlShare","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.shareSucTimes=0,this.observerList=[],this.shareTaskList=[],this.bannerArr=[]}return t.prototype.initParams=function(){e.TTShareController.getInstance().sendMessageShareinfo(),this.shareTimeCell=Number(e.GlobalConfig.instance.getValue("SHARE_TIP_TIME_CELL")),this.bannerArr.push("banner_fxyl_01_jpg","banner_fxyl_02_jpg","banner_fxyl_03_jpg","banner_fxyl_04_jpg")},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.operateBack=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChange()},t.prototype.setShareInfo=function(e){for(var t=0;t<e.getInfo().length;t++)this.shareTaskList[e.getInfo()[t].getType()]=e.getInfo()[t];this.operateBack()},t.prototype.setShareAward=function(e){return 0!=e.getErrorNo()?console.log("领取失败"):void console.log("领取成功")},t.prototype.getShareData=function(t){this.shareTaskVO=e.JsonDataManager.instance.ttgameShareInTemplate;var i,n=[];for(var o in this.shareTaskVO)i=this.shareTaskVO[o],i.type==t&&n.push(i);return n},t.COMMON_TYPE=1,t.VIDEO_TYPE=2,t}();e.TTShareModel=t,__reflect(t.prototype,"foxgame.TTShareModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="TTvideoShareItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.yilingquImg.visible=!1,this.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAwardClick,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.model=e.TTShareController.getInstance().model,this.shareInfo=this.model.shareTaskList[e.TTShareModel.VIDEO_TYPE];var i=this.data,n=i.award,o=this.itemGroup.numChildren,a=n.length;if(o>a)for(var s=0;o-a>s;s++)this.itemGroup.removeChildAt(o-1-s);for(var s=0;s<n.length;s++){var r=new e.AttributeVO(n[s]),l=new e.ItemIcon;s>o-1?this.itemGroup.addChild(l):l=this.itemGroup.getChildAt(s),l.setItem(r.id,r.value,!0),l.hasEventListener(egret.TouchEvent.TOUCH_TAP)||l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.getAwardBtn.filters=this.shareInfo.getTodayCount()<i.shareInCount?e.GlobalUtil.grayFilter:[],this.getAwardBtn.touchEnabled=this.shareInfo.getTodayCount()<i.shareInCount?!1:!0,this.yilingquImg.visible=-1==this.shareInfo.getAwardIds().indexOf(Number(i.id))?!1:!0,this.getAwardBtn.visible=!this.yilingquImg.visible;i.desc.split("{0}");this.taskLabel.text=i.desc},i.prototype.onClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.onGetAwardClick=function(t){e.TTShareController.getInstance().sendMessageGetShareAward(this.shareInfo.getType(),this.data.id)},i}(eui.ItemRenderer);e.TTVideoItemRender=t,__reflect(t.prototype,"foxgame.TTVideoItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"TTvideoShareSkin")||this;return i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.collection=new eui.ArrayCollection,this.ui.list.dataProvider=this.collection,this.ui.list.itemRenderer=e.TTVideoItemRender},i.prototype.initParams=function(){this.model.initParams()},i.prototype.showHook=function(){this.model.initParams(),this.ui.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnClick,this)},i.prototype.refresh=function(){this.model.shareTaskList.length>0&&(this.shareInfo=this.model.shareTaskList[e.TTShareModel.VIDEO_TYPE],this.collection.replaceAll(this.model.getShareData(e.TTShareModel.VIDEO_TYPE)),this.ui.txt_num.text=this.shareInfo.getTodayCount()+"",this.ui.txt_num.textColor=this.shareInfo.getTodayCount()>0?2227971:16711680)},i.prototype.onShareBtnClick=function(t){return console.log("点击分享"+e.TTShareController.getInstance().model.path),"-1"==e.TTShareController.getInstance().model.path?void e.PopUpController.getInstance().showFloatTextPanel1("请重新录制视频"):void clipVideoRecorder(this.model.path,function(t){e.MainControler.instance.ttBtn.shareRecorderBtn.visible=!1,e.MainControler.instance.ttBtn.underwayBtn.visible=!1,e.MainControler.instance.ttBtn.recorderBtn.visible=!0,t&&(e.TTShareController.getInstance().sendMessageShareSucc(e.TTShareModel.VIDEO_TYPE),e.TTShareController.getInstance().model.path="-1")})},i.prototype.panelChange=function(){this.refresh()},i.prototype.closeHook=function(){this.model.curSelectedPanel=-1},i}(e.BasePanel);e.TTvideoSharePanel=t,__reflect(t.prototype,"foxgame.TTvideoSharePanel",["foxgame.IttlShare","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"chatcode")||this;return i.isMask=!0,i}return __extends(i,t),i.prototype.showPanel=function(e){this.codestr=e,this.getIsShow()?this.refresh():this.show()
},i.prototype.initHook=function(){var t=this;this.ui.add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ShareWanbaControler.getInstance().sendCHAT_IDENTIFYING_CODE_C(t.ui.input.text),t.close()},this)},i.prototype.refresh=function(){this.ui.input.text="",this.ui.code.text=this.codestr},i}(e.BasePanel);e.ChatcodePanel=t,__reflect(t.prototype,"foxgame.ChatcodePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/wanba/CollectionPanelskin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.showHook=function(){},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this);for(var e=0;e<this.getbtnlist().length;e++){var t=this.getbtnlist()[e];t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clicklingjiang,this)}for(var i=0;i<this.geticonlist().length;i++){var t=this.geticonlist()[i];t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this)}},i.prototype.clickicon=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.clicklingjiang=function(t){var i=e.JsonDataManager.instance.WanbaShareInTemplate;e.ShareWanbaControler.getInstance().sendWANBA_AWARD_C(2,i[Number(t.target.name)].id)},i.prototype.clickbtn=function(t){var i=this;switch(t.target){case this.ui.btn:if("WX"==e.UserInfo.platform.chanel){var n=new eui.Rect(e.Global.stageWidth,e.Global.stageHeight,2500134);n.alpha=.5,StageFrameControl.instance.newBeeGuideLayer.addChild(n);var o=new eui.Image("dianji_png");return StageFrameControl.instance.newBeeGuideLayer.addChild(o),o.x=StageFrameControl.instance.newBeeGuideLayer.width-463,o.y=0,o.touchEnabled=!1,void n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(){},i),StageFrameControl.instance.newBeeGuideLayer.removeChild(n),StageFrameControl.instance.newBeeGuideLayer.removeChild(o),n=null,o=null},this)}var a=e.LoginModel.devicePlatformStr,s={code:"wanbafenxiang",str:"",str1:"登录即送VIP13，百万元宝免费领！",pfStr:a};e.UserInfo.platform.reportData_legend(s)}},i.prototype.refresh=function(){for(var t=e.JsonDataManager.instance.WanbaShareInTemplate,i=0;i<this.getbtnlist().length;i++){var n=t[i+1],o=this.getbtnlist()[i],a=this.getimglist()[i];-1!=this.model.awardIds.indexOf(n.id)?(o.visible=!1,a.source="leiji_yilingqu_png"):n.shareInCount>this.model.shareInCount?(a.source="leiji_dailingqu_png",o.visible=!1):(o.visible=!0,a.source="")}for(var s=0;s<this.geticonlist().length;s++){var r=this.geticonlist()[s],l=this.getjaigli()[s];r.setItem(l.id,l.value)}},i.prototype.getjaigli=function(){var t=e.JsonDataManager.instance.WanbaShareInTemplate,i=[];for(var n in t){var o=t[n];o.award[0]&&i.push(o.award[0]),o.award[1]&&i.push(o.award[1])}return i},i.prototype.refreshView=function(){this.refresh()},i.prototype.refreshvipview=function(){},i.prototype.refreshqqvipview=function(){},i.prototype.refreshxytq=function(){},i.prototype.geticonlist=function(){var e=[];return e.push(this.ui.icon1),e.push(this.ui.icon0),e.push(this.ui.icon2),e.push(this.ui.icon3),e.push(this.ui.icon4),e.push(this.ui.icon5),e},i.prototype.getimglist=function(){var e=[];return e.push(this.ui.img1),e.push(this.ui.img2),e.push(this.ui.img3),e.push(this.ui.img4),e.push(this.ui.img5),e},i.prototype.getbtnlist=function(){var e=[];return e.push(this.ui.btn_1),e.push(this.ui.btn_2),e.push(this.ui.btn_3),e.push(this.ui.btn_4),e.push(this.ui.btn_5),e},i}(e.BasePanel);e.CollectionPanel=t,__reflect(t.prototype,"foxgame.CollectionPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"PlatfromBenefits")||this;return i.collection=new eui.ArrayCollection,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.list.dataProvider=this.collection,this.ui.list.itemRenderer=e.PlatformRender},i.prototype.clickBtn=function(e){switch(e.target){case this.ui.btn_1:this.model.select=0;break;case this.ui.btn_2:this.model.select=1}this.refresh()},i.prototype.showHook=function(){console.log("3242")},i.prototype.refresh=function(){if(0==this.model.select){for(var e=[],t=[],i=[],n=0;n<this.model.HPAccLoginInfoRet.getAwardsInfo().length;n++){var o=this.model.HPAccLoginInfoRet.getAwardsInfo()[n];-1==this.model.HPAccLoginInfoRet.getGotAwardCfgId().indexOf(o.getId())?o.getId()<=this.model.HPAccLoginInfoRet.getLoginDays()?e.push(o):i.push(o):t.push(o)}this.collection.source=e.concat(i,t),this.ui.tips.textFlow=[{text:"目前已签到:",style:{size:18,textColor:16770048,fontFamily:"HeiTi",strokeColor:0,stroke:1}},{text:this.model.HPAccLoginInfoRet.getLoginDays()+"天",style:{size:18,textColor:2227971,fontFamily:"HeiTi",strokeColor:0,stroke:1}}]}else{for(var e=[],t=[],i=[],n=0;n<this.model.HPAccRecharge2InfoRet.getAwardsInfo().length;n++){var o=this.model.HPAccRecharge2InfoRet.getAwardsInfo()[n];-1==this.model.HPAccRecharge2InfoRet.getGotAwardCfgId().indexOf(o.getId())?o.getId()<=this.model.HPAccRecharge2InfoRet.getAccRechargeGold()?e.push(o):i.push(o):t.push(o)}this.collection.source=e.concat(i,t),this.ui.tips.textFlow=[{text:"目前已充值:",style:{size:18,textColor:16770048,fontFamily:"HeiTi",strokeColor:0,stroke:1}},{text:this.model.HPAccRecharge2InfoRet.getAccRechargeGold()+"元宝",style:{size:18,textColor:2227971,fontFamily:"HeiTi",strokeColor:0,stroke:1}}]}this.refreshpoint()},i.prototype.refreshpoint=function(){this.ui.redPoint.visible=!1,this.ui.redPoint0.visible=!1;for(var e=this.model.HPAccLoginInfoRet||null,t=0;t<e.getAwardsInfo().length;t++)e.getLoginDays()>=e.getAwardsInfo()[t].getId()&&-1==e.getGotAwardCfgId().indexOf(e.getAwardsInfo()[t].getId())&&(this.ui.redPoint.visible=!0);for(var i=this.model.HPAccRecharge2InfoRet||null,t=0;t<i.getAwardsInfo().length;t++)i.getAccRechargeGold()>=i.getAwardsInfo()[t].getStepNumber()&&-1==i.getGotAwardCfgId().indexOf(i.getAwardsInfo()[t].getId())&&(this.ui.redPoint0.visible=!0)},i.prototype.refreshplatform=function(){this.getIsShow()&&this.refresh()},i}(e.BasePanel);e.PlatformBenefitsPanel=t,__reflect(t.prototype,"foxgame.PlatformBenefitsPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.selectnum=0,e.itemlist=[],e.skinName="Platfromrender",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemlist=[this.item_0,this.item_1,this.item_2,this.item_3],this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this);for(var e=0;e<this.itemlist.length;e++)this.itemlist[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickitem,this)},i.prototype.clickitem=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.clickbtn=function(t){0==this.selectnum?e.ShareWanbaControler.getInstance().sendWAN_BA_LOGIN_DRAW_C(this.info.getId()):e.ShareWanbaControler.getInstance().sendWAN_BA_RECHARGE_DRAW_C(this.info2.getId())},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.selectnum=e.ShareWanbaControler.getInstance().getmodel().select,this.lingquImg.visible=!1,this.dailingqu.visible=!1,this.btn.visible=!1,0==this.selectnum){this.info=this.data,this.tips.textFlow=[{text:"累计签到",style:{size:20,textColor:16777215,fontFamily:"SimSun",strokeColor:0,stroke:1}},{text:this.info.getId()+"天",style:{size:20,textColor:2227971,fontFamily:"SimSun",strokeColor:0,stroke:1}},{text:"可获得",style:{size:20,textColor:16777215,fontFamily:"SimSun",strokeColor:0,stroke:1}}];for(var i=this.info.getAwards().split(","),n=0;n<i.length;n++){var o=new e.AttributeVO(i[n]);this.itemlist[n].setItem(o.id,o.value)}var a=e.ShareWanbaControler.getInstance().getmodel().HPAccLoginInfoRet.getGotAwardCfgId();if(-1!=a.indexOf(this.info.getId()))this.lingquImg.visible=!0;else{var s=e.ShareWanbaControler.getInstance().getmodel().HPAccLoginInfoRet.getLoginDays();this.info.getId()<=s?this.btn.visible=!0:this.dailingqu.visible=!0}}else{this.info2=this.data,this.tips.textFlow=[{text:"累计充值",style:{size:20,textColor:16777215,fontFamily:"SimSun",strokeColor:0,stroke:1}},{text:this.info2.getStepNumber()+"元宝",style:{size:20,textColor:2227971,fontFamily:"SimSun",strokeColor:0,stroke:1}},{text:"可获得",style:{size:20,textColor:16777215,fontFamily:"SimSun",strokeColor:0,stroke:1}}];for(var i=this.info2.getAwards().split(","),n=0;n<i.length;n++){var o=new e.AttributeVO(i[n]);this.itemlist[n].setItem(o.id,o.value)}var a=e.ShareWanbaControler.getInstance().getmodel().HPAccRecharge2InfoRet.getGotAwardCfgId();if(-1!=a.indexOf(this.info2.getId()))this.lingquImg.visible=!0;else{var s=e.ShareWanbaControler.getInstance().getmodel().HPAccRecharge2InfoRet.getAccRechargeGold();this.info2.getStepNumber()<=s?this.btn.visible=!0:this.dailingqu.visible=!0}}},i}(eui.ItemRenderer);e.PlatformRender=t,__reflect(t.prototype,"foxgame.PlatformRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.collectAward=!1,this.awardIds=[],this.select=0,this.observerList=[]}return t.prototype.registerObserver=function(e){this.observerList.push(e)},t.prototype.setWANBA_INFO_S=function(e){this.awardIds=e.getAwardIds(),this.collectAward=e.getCollectAward(),this.shareInCount=e.getShareInCount(),this.updateView()},t.prototype.setWANBA_SHARE_IN_SUCC_S=function(e){this.shareInCount=e.getShareInCount(),this.updateView()},t.prototype.setWANBA_AWARD_S=function(t){0==t.getErrorNo()&&(1==t.getType()?(e.GameUtils.MSG_TIP("收藏奖励领取成功"),this.collectAward=!0):2==t.getType()&&this.awardIds.push(this.award),this.updateView())},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.refreshView()},t.prototype.setCHAT_IDENTIFYING_CODE_S=function(t){e.ShareWanbaControler.getInstance().showchatcodePanel(t.getCode())},t.prototype.setWAN_BA_RECHARGE_INFO_S=function(e){this.HPAccRecharge2InfoRet=e;for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.refreshplatform()},t.prototype.setWAN_BA_LOGIN_INF_C=function(t){this.HPAccLoginInfoRet=t,e.GamePlatform.isDragonEx_qld||e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.PINGTAIFULI,!0)},t.prototype.setWAN_BA_RECHARGE_DRAW_S=function(e){var t=this.HPAccRecharge2InfoRet.getGotAwardCfgId();t.push(e.getGotAwardCfgId()),this.HPAccRecharge2InfoRet.setGotAwardCfgId(t);for(var i,n=this.observerList.length,o=0;n>o;o++)i=this.observerList[o],i.getIsShow()&&i.refreshplatform()},t.prototype.setWAN_BA_LOGIN_DRAW_S=function(e){this.HPAccLoginInfoRet.setGotAwardCfgId(e.getGotAwardCfgId());for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.refreshplatform()},t.prototype.platredpoint=function(){var e=this.HPAccRecharge2InfoRet||null;if(null==e)return!1;for(var t=0;t<e.getAwardsInfo().length;t++)if(e.getAccRechargeGold()>=e.getAwardsInfo()[t].getStepNumber()&&-1==e.getGotAwardCfgId().indexOf(e.getAwardsInfo()[t].getId()))return!0;var i=this.HPAccLoginInfoRet||null;if(null==i)return!1;for(var t=0;t<i.getAwardsInfo().length;t++)if(i.getLoginDays()>=i.getAwardsInfo()[t].getId()&&-1==i.getGotAwardCfgId().indexOf(i.getAwardsInfo()[t].getId()))return!0;return!1},t}();e.ShareModel=t,__reflect(t.prototype,"foxgame.ShareModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/wanba/SharePanelskin.exml")||this;return i.arr=[],i.model=e,i}return __extends(i,t),i.prototype.showHook=function(){},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.arr=this.getarr();for(var e=0;e<this.getlist().length;e++){var t=this.getlist()[e];t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this)}},i.prototype.clickicon=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.btn:var i={code:"wanbashoucang"};e.UserInfo.platform.reportData_legend(i)}},i.prototype.getarr=function(){for(var t=e.GlobalConfig.instance.getValue("WANBA_COLLECT_AWARD"),i=t.split(","),n=[],o=0;o<i.length;o++){var a=new e.AttributeVO(i[o]);n.push(a)}return n},i.prototype.refresh=function(){for(var e=0;e<this.getlist().length;e++){var t=this.getlist()[e],i=this.arr[e];t.setItem(i.id,i.value)}this.ui.img.visible=this.model.collectAward},i.prototype.refreshView=function(){this.refresh()},i.prototype.refreshvipview=function(){},i.prototype.refreshqqvipview=function(){},i.prototype.refreshxytq=function(){},i.prototype.getlist=function(){var e=[];return e.push(this.ui.icon1),e.push(this.ui.icon2),e.push(this.ui.icon3),e.push(this.ui.icon4),e},i}(e.BasePanel);e.SharePanel=t,__reflect(t.prototype,"foxgame.SharePanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.ShareModel,this.panel=new e.SharePanel(this.model),this.collection=new e.CollectionPanel(this.model),this.chatcodePanel=new e.ChatcodePanel(this.model),this.wanbasvippanel=new e.WanbaSVIPpanel(this.model),this.zyxcxkefu=new e.zyxcxkefuPanel(this.model),this.platformBenefitsPanel=new e.PlatformBenefitsPanel(this.model)}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getmodel=function(){return this.model},t.prototype.showPlatformBenefitsPanel=function(){this.model.select=0,this.platformBenefitsPanel.show(),this.sendWAN_BA_RECHARGE_INFO_C()},t.prototype.showzyxcxpanel=function(){this.zyxcxkefu.show()},t.prototype.showWanbaSVIPpanel=function(){this.wanbasvippanel.show()},t.prototype.showchatcodePanel=function(e){this.chatcodePanel.showPanel(e)},t.prototype.registerMsg=function(t){t.add(e.Code.WANBA_INFO_S,this),t.add(e.Code.WANBA_SHARE_IN_SUCC_S,this),t.add(e.Code.WANBA_AWARD_S,this),t.add(e.Code.WAN_BA_RECHARGE_INFO_S,this),t.add(e.Code.WAN_BA_LOGIN_INF_S,this),t.add(e.Code.WAN_BA_LOGIN_DRAW_S,this),t.add(e.Code.WAN_BA_RECHARGE_DRAW_S,this),e.Message.instance.add(e.Code.CHAT_IDENTIFYING_CODE_S,this)},t.prototype.recvMsg=function(i,n){switch(i){case e.Code.WAN_BA_RECHARGE_DRAW_S:this.model.setWAN_BA_RECHARGE_DRAW_S(n),e.ActivityBarController.getInstance().setplatRedPoint(t.getInstance().getmodel().platredpoint());break;case e.Code.WAN_BA_LOGIN_DRAW_S:this.model.setWAN_BA_LOGIN_DRAW_S(n),e.ActivityBarController.getInstance().setplatRedPoint(t.getInstance().getmodel().platredpoint());break;case e.Code.WAN_BA_RECHARGE_INFO_S:this.model.setWAN_BA_RECHARGE_INFO_S(n),e.ActivityBarController.getInstance().setplatRedPoint(t.getInstance().getmodel().platredpoint());break;case e.Code.WAN_BA_LOGIN_INF_S:this.model.setWAN_BA_LOGIN_INF_C(n),e.ActivityBarController.getInstance().setplatRedPoint(t.getInstance().getmodel().platredpoint());break;case e.Code.CHAT_IDENTIFYING_CODE_S:this.model.setCHAT_IDENTIFYING_CODE_S(n);break;case e.Code.WANBA_INFO_S:this.model.setWANBA_INFO_S(n);break;case e.Code.WANBA_SHARE_IN_SUCC_S:this.model.setWANBA_SHARE_IN_SUCC_S(n);break;case e.Code.WANBA_AWARD_S:this.model.setWANBA_AWARD_S(n)}},t.prototype.sendWAN_BA_LOGIN_DRAW_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPAccLoginAwards");i.setRewwardDay(t),e.Message.instance.send(e.Code.WAN_BA_LOGIN_DRAW_C,i,!0)},t.prototype.sendWAN_BA_RECHARGE_DRAW_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPGetAccRecharge2Award");i.setAwardCfgId(t),e.Message.instance.send(e.Code.WAN_BA_RECHARGE_DRAW_C,i,!0)},t.prototype.sendWAN_BA_RECHARGE_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccRecharge2Info");e.Message.instance.send(e.Code.WAN_BA_RECHARGE_INFO_C,t,!0)},t.prototype.sendWAN_BA_LOGIN_INF_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccLoginInfo");e.Message.instance.send(e.Code.WAN_BA_LOGIN_INF_C,t,!0)},t.prototype.sendWAN_BA_QQ_BUY_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.WaBaRechargeRsp");i.setAppId(t.appid),i.setBillNo(t.billNo),i.setFormat(t.format),i.setGiftId(t.prize),i.setOpenId(t.openid),i.setOpenKey(t.openkey),i.setPf(t.pf),e.Message.instance.send(e.Code.WAN_BA_QQ_BUY_C,i,!0)},t.prototype.sendCHAT_IDENTIFYING_CODE_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.ChatIdentifyingCodeC");i.setCheckCode(t),e.Message.instance.send(e.Code.CHAT_IDENTIFYING_CODE_C,i,!0)},t.prototype.sendWANBA_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.WBInfoReq");e.Message.instance.send(e.Code.WANBA_INFO_C,t,!0)},t.prototype.sendWANBA_SHARE_IN_SUCC_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.WBShareInSuccessReq");e.Message.instance.send(e.Code.WANBA_SHARE_IN_SUCC_C,t,!0)},t.prototype.sendWANBA_AWARD_C=function(t,i){if(void 0===i&&(i=null),1!=t||1!=this.model.collectAward){var n=HawkProtocolManager.newBuilder("JsProto.WBAwardReq");this.model.award=i,n.setType(t),n.setShareInAwardId(i),e.Message.instance.send(e.Code.WANBA_AWARD_C,n,!0)}},t.prototype.showpanel=function(){this.panel.getIsShow()||this.panel.show()},t.prototype.showcollection=function(){this.collection.getIsShow()||this.collection.show()},t}();e.ShareWanbaControler=t,__reflect(t.prototype,"foxgame.ShareWanbaControler")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.award=[]}return e}();e.WanbaQQSVIPVO=t,__reflect(t.prototype,"foxgame.WanbaQQSVIPVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"Wanbaqqvipskin")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this);for(var e=0;e<this.getlist().length;e++)this.getlist()[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this);this.ui.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickicon,this)},i.prototype.clickicon=function(t){if(t.target==this.ui.addBtn)return void e.WanbaVIPControler.getInstance().sendQQ_VIP_GIFT_AWARD_C();var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.showHook=function(){for(var e=this.model.getQQVIP_reward(),t=0;t<this.getlist().length;t++)this.getlist()[t].setItem(e[t].id,e[t].value,!0)},i.prototype.refresh=function(){this.ui.addBtn.enabled=!this.model.qqvipstage},i.prototype.refreshView=function(){},i.prototype.refreshvipview=function(){},i.prototype.refreshqqvipview=function(){this.refresh()},i.prototype.refreshxytq=function(){},i.prototype.getlist=function(){var e=[];return e.push(this.ui.icon1),e.push(this.ui.icon2),e.push(this.ui.icon3),e.push(this.ui.icon4),e},i}(e.BasePanel);e.WanbaQQvipPanel=t,__reflect(t.prototype,"foxgame.WanbaQQvipPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"wanbaxytqskin")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.img_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this);for(var t=e.GlobalConfig.instance.getValue("XIN_YUE_PRIVILEGE_DAILY_GIFT_AWARD").split(","),i=0;i<t.length;i++){var n=new e.AttributeVO(t[i]);this.geticon(i).setItem(n.id,n.value),this.geticon(i).addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)}},i.prototype.click=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.showpanel=function(){this.getIsShow()||this.show()},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.img_1:window.open("http://xinyue.qq.com/act/a20181130xyh5game/index.html");break;case this.ui.btn_1:0==this.model.xinyuestage&&e.WanbaVIPControler.getInstance().sendGET_XINYUE_PRIVILEGE_DAILY_GIFT_C();break;case this.ui.btn_2:window.open("http://xinyue.qq.com/act/a20181130xyh5game/index.html")}},i.prototype.refresh=function(){this.model.xinyuestage&&(this.ui.btn_1.currentState="disabled")},i.prototype.refreshView=function(){},i.prototype.refreshvipview=function(){},i.prototype.refreshqqvipview=function(){},i.prototype.refreshxytq=function(){this.refresh()},i.prototype.geticon=function(e){return this.ui["icon"+e]},i}(e.BasePanel);e.WanbaQQxinyuetequanPanel=t,__reflect(t.prototype,"foxgame.WanbaQQxinyuetequanPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.award=[]}return e}();e.WanbaShareInVO=t,__reflect(t.prototype,"foxgame.WanbaShareInVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"Wanbasvippanel")||this;return i.collection=new eui.ArrayCollection,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.list.dataProvider=this.collection,this.ui.list.itemRenderer=e.Wanbasviprender;var t=[];for(var i in e.JsonDataManager.instance.WanbaQQPayTemplate)t.push(e.JsonDataManager.instance.WanbaQQPayTemplate[i]);this.collection.replaceAll(t)},i}(e.BasePanel);e.WanbaSVIPpanel=t,__reflect(t.prototype,"foxgame.WanbaSVIPpanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;e.iconlist=[],e.skinName="sviprender",e.add.addEventListener(egret.TouchEvent.TOUCH_TAP,e.click,e),e.iconlist=[e.icon0,e.icon1,e.icon2,e.icon3,e.icon4];for(var i=0;i<e.iconlist.length;i++)e.iconlist[i].addEventListener(egret.TouchEvent.TOUCH_TAP,e.clickicon,e);return e}return __extends(i,t),i.prototype.clickicon=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId)},i.prototype.click=function(e){QQVIPpay(this.dataVo.id)},i.prototype.dataChanged=function(){this.dataVo=this.data,this.dataVo.id.indexOf("qqhy_month")?this.txt1.source="text_svipqq_png":this.dataVo.id.indexOf("cjhy_month")&&(this.txt1.source="text_vipchaoji_png"),this.dataVo.id.indexOf("_1")?this.txt2.source="text_svip1_png":this.dataVo.id.indexOf("_3")&&(this.txt2.source="text_svip3_png");for(var e=0;e<this.iconlist.length;e++)this.iconlist[e].setItem(this.dataVo.award[e].id,this.dataVo.award[e].value)},i}(eui.ItemRenderer);e.Wanbasviprender=t,__reflect(t.prototype,"foxgame.Wanbasviprender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.WanbaVIPModel,this.panel=new e.WanbaVIPPanel(this.model),this.qqvippanle=new e.WanbaQQvipPanel(this.model),this.qqxinyuetequanpanel=new e.WanbaQQxinyuetequanPanel(this.model),this.addList()}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showpanel=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPWanBanVipDayInfoReq");e.Message.instance.send(e.Code.WANBA_VIP_PACKAGE_INFO_C,t,!0)},t.prototype.showxinyuepanel=function(){var t=HawkProtocolManager.newBuilder("JsProto.XinYuePrivilegeGiftStatusReq");e.Message.instance.send(e.Code.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_C,t,!0)},t.prototype.showqqvippanle=function(){this.qqvippanle.show()},t.prototype.addList=function(){e.Message.instance.add(e.Code.WANBA_VIP_PACKAGE_INFO_S,this),e.Message.instance.add(e.Code.WANBA_VIP_DAY_BUY_S,this),e.Message.instance.add(e.Code.WANBA_VIP_DAY_AWARDS_S,this),e.Message.instance.add(e.Code.WANBA_QQ_VIP_DAILY_GIFT_STATUS_S,this),e.Message.instance.add(e.Code.WANBA_QQ_VIP_DAILY_GIFT_AWARD_S,this),e.Message.instance.add(e.Code.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_S,this),e.Message.instance.add(e.Code.GET_XINYUE_PRIVILEGE_DAILY_GIFT_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.WANBA_QQ_VIP_DAILY_GIFT_STATUS_S:this.model.setQQ_VIP_GIFT_STATUS_S(i);break;case e.Code.WANBA_QQ_VIP_DAILY_GIFT_AWARD_S:this.model.setQQ_VIP_GIFT_AWARD_S(i);break;case e.Code.WANBA_VIP_PACKAGE_INFO_S:this.model.setWANBA_VIP_PACKAGE_INFO_S(i),this.panel.show();break;case e.Code.WANBA_VIP_DAY_BUY_S:this.model.setWANBA_VIP_DAY_BUY_C(i);break;case e.Code.WANBA_VIP_DAY_AWARDS_S:this.model.setWANBA_VIP_DAY_AWARDS_S(i);break;case e.Code.GET_XINYUE_PRIVILEGE_DAILY_GIFT_S:this.model.setGET_XINYUE_PRIVILEGE_DAILY_GIFT_S(i);break;case e.Code.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_S:this.model.setXINYUE_PRIVILEGE_DAILY_GIFT_STATUS_S(i),this.qqxinyuetequanpanel.showpanel()}},t.prototype.getmodel=function(){return this.model},t.prototype.sendGET_XINYUE_PRIVILEGE_DAILY_GIFT_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.GetXinYuePrivilegeGiftReq");e.Message.instance.send(e.Code.GET_XINYUE_PRIVILEGE_DAILY_GIFT_C,t,!0)},t.prototype.sendQQ_VIP_GIFT_STATUS_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.WanBaQQVIPDailyGiftStatusReq");e.Message.instance.send(e.Code.WANBA_QQ_VIP_DAILY_GIFT_STATUS_C,t,!0)},t.prototype.sendQQ_VIP_GIFT_AWARD_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.WanBaGetQQVIPDailyGiftReq");e.Message.instance.send(e.Code.WANBA_QQ_VIP_DAILY_GIFT_AWARD_C,t,!0)},t.prototype.sendWANBA_VIP_DAY_AWARDS_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPWanBaVipDayReq");e.Message.instance.send(e.Code.WANBA_VIP_DAY_AWARDS_C,t,!0)},t.prototype.sendWANBA_VIP_DAY_BUY_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPWanBaVipDayBuyReq");i.setVipLevel(t),e.Message.instance.send(e.Code.WANBA_VIP_DAY_BUY_C,i,!0)},t}();e.WanbaVIPControler=t,__reflect(t.prototype,"foxgame.WanbaVIPControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.list=[],e.skinName="WanbaVIPItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.buy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.list=[],this.list.push(this.icon1),this.list.push(this.icon2),this.list.push(this.icon3);var e=new egret.Shape;e.graphics.lineStyle(2,16711680),e.graphics.moveTo(this.yuanjia.x,this.yuanjia.y+(this.yuanjia.height>>1)),e.graphics.lineTo(this.yuanjia.x+this.yuanjia.width,this.yuanjia.y+(this.yuanjia.height>>1)),e.graphics.endFill(),e.name="line",this.addChild(e)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.info=this.data,this.xianjia.text=this.info.getCurrentPrice().toString(),this.yuanjia.text=this.info.getOriginalPrice()+"",this.vip.text="VIP"+this.info.getVipLevel();var i=e.WanbaVIPControler.getInstance().getmodel().viplevel;i>=this.info.getVipLevel()?(this.buy.enabled=!0,1==this.info.getBuyState()?(this.buy.visible=!1,this.addbuy.visible=!0):(this.buy.visible=!0,this.addbuy.visible=!1)):(this.buy.visible=!0,this.buy.enabled=!1,this.addbuy.visible=!1);for(var n=this.getaward(this.info.getAwardBuy()),o=0;o<this.list.length;o++)this.list[o].setItem(n[o].id,n[o].value,!0)},i.prototype.getaward=function(t){var i=[],n=[];n=t.split(",");for(var o,a=0;a<n.length;a++)n[a]&&(o=new e.AttributeVO(n[a]),i.push(o));return i},i.prototype.clickbtn=function(t){switch(t.target){case this.buy:var i=e.PlayerService.instance.playerInfo.getGold();if(this.info.getCurrentPrice()>i)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");e.WanbaVIPControler.getInstance().sendWANBA_VIP_DAY_BUY_C(this.info.getVipLevel())}},i}(eui.ItemRenderer);e.WanbaVIPItem=t,__reflect(t.prototype,"foxgame.WanbaVIPItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.drawState=!1,this.vipPackageinfo=[],this.qqvipstage=!0,this.observerList=[],this.collection=new eui.ArrayCollection}return t.prototype.registerObserver=function(e){this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.refreshvipview()},t.prototype.updateqqView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.refreshqqvipview()},t.prototype.updatexytqView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.refreshxytq()},t.prototype.setGET_XINYUE_PRIVILEGE_DAILY_GIFT_S=function(e){this.xinyuestage=e.getStatus(),this.updatexytqView()},t.prototype.setXINYUE_PRIVILEGE_DAILY_GIFT_STATUS_S=function(e){this.xinyuestage=e.getStatus(),this.updatexytqView()},t.prototype.setQQ_VIP_GIFT_STATUS_S=function(t){this.qqvipstage=t.getStatus(),0==this.qqvipstage&&e.PopUpController.getInstance().showTextPanel("尊敬的QQ会员用户,您已获得今日专属QQ会员礼包,请及时前往领取",this,function(){e.WanbaVIPControler.getInstance().showqqvippanle()},null,null,null,"前往领取"),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QQVIP,!this.qqvipstage)},t.prototype.setQQ_VIP_GIFT_AWARD_S=function(t){t.getStatus()||alert("领取失败"),this.qqvipstage=!0,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.QQVIP,!1),this.updateqqView()},t.prototype.setWANBA_VIP_PACKAGE_INFO_S=function(e){this.vipPackageinfo=e.getVipPackageinfo(),this.drawState=e.getDrawState(),this.viplevel=Number(e.getViplevel())},t.prototype.setWANBA_VIP_DAY_AWARDS_S=function(t){return 0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.drawState=0==t.getErrorNo(),void this.updateView())},t.prototype.setWANBA_VIP_DAY_BUY_C=function(t){return 0!=t.getErrorNo()?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.vipPackageinfo[t.getVipLevel()].setBuyState(t.getState()),void this.updateView())},t.prototype.getawardByVIPlevel=function(t,i){var n=[],o=[];for(var a in this.vipPackageinfo)this.vipPackageinfo[a].getVipLevel()==t&&(o=1==i?this.vipPackageinfo[t].getAwardStr().split(","):this.vipPackageinfo[t].getAwardBuy().split(","));if(o==[])return null;for(var s,r=0;r<o.length;r++)o[r]&&(s=new e.AttributeVO(o[r]),n.push(s));return n},t.prototype.getQQVIP_reward=function(){for(var t=e.GlobalConfig.instance.getValue("WAN_BA_QQ_VIP_DAILY_GIFT").split(","),i=[],n=0;n<t.length;n++){var o=new e.AttributeVO(t[n]);i.push(o)}return i},t}();e.WanbaVIPModel=t,__reflect(t.prototype,"foxgame.WanbaVIPModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/wanba/WanbaVIPskin.exml")||this;return i.model=e,i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.showHook=function(){this.ui.day.visible=!0,this.ui.buy.visible=!1,this.ui.daybtn.currentState="down",this.ui.buybtn.currentState="up"},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.lingqubtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.daybtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.buybtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.list.dataProvider=this.model.collection,this.ui.list.itemRenderer=e.WanbaVIPItem},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.lingqubtn:e.WanbaVIPControler.getInstance().sendWANBA_VIP_DAY_AWARDS_C();break;case this.ui.daybtn:this.ui.day.visible=!0,this.ui.buy.visible=!1,this.ui.daybtn.currentState="down",this.ui.buybtn.currentState="up";break;case this.ui.buybtn:this.ui.day.visible=!1,this.ui.buy.visible=!0,this.ui.daybtn.currentState="up",this.ui.buybtn.currentState="down"}},i.prototype.refresh=function(){this.ui.vip.text="VIP"+this.model.viplevel,this.ui.lingqubtn.enabled=!this.model.drawState;var e=this.model.getawardByVIPlevel(this.model.viplevel,!0);if(null!=e)for(var t=0;t<e.length;t++)this.geticonl()[t].setItem(e[t].id,e[t].value,!0);if(e=this.model.getawardByVIPlevel(this.model.viplevel+1,!0),null!=e)for(var t=0;t<e.length;t++)this.geticonx()[t].visible=!0,this.geticonx()[t].setItem(e[t].id,e[t].value,!0);else for(var t=0;t<e.length;t++)this.geticonx()[t].visible=!1;this.model.collection.replaceAll(this.model.vipPackageinfo)
},i.prototype.refreshView=function(){},i.prototype.refreshvipview=function(){this.refresh()},i.prototype.refreshqqvipview=function(){},i.prototype.refreshxytq=function(){},i.prototype.geticonl=function(){var e=[];return e.push(this.ui.icon1),e.push(this.ui.icon2),e.push(this.ui.icon3),e},i.prototype.geticonx=function(){var e=[];return e.push(this.ui.icon4),e.push(this.ui.icon5),e.push(this.ui.icon6),e},i}(e.BasePanel);e.WanbaVIPPanel=t,__reflect(t.prototype,"foxgame.WanbaVIPPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"zyxcxkf")||this;return i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.showHook=function(){-1!=String(getGlobalConfig().serverUrl).indexOf("h5legend.6deer.com")&&-1!=e.ActivityBarController.getInstance().getPFName().indexOf("weChat")?(this.ui.feelGet.text="限时免费领取：元宝*2000、铜钱*50万、寻宝券*10、天空之羽*50、宝石挑战令*5",this.ui.text1.textFlow=(new egret.HtmlTextParser).parser("<font color=0xEEE3C6>微信搜一搜 > </font><font color=0x21ff03>小鹿游戏</font><font color=0xEEE3C6> > 关注微信</font> <font color=0x21ff03>小鹿游戏</font><font color=0xEEE3C6> 公众号 >回复</font><font color=0x21ff03>RG</font>"),this.ui.tips.text="您在游戏中遇到任何问题，都可联系人工客服进行处理！",e.ActivityBarController.getInstance().kefuRedClose()):this.ui.text1.textFlow=(new egret.HtmlTextParser).parser("<font color=0xEEE3C6>微信搜一搜 > </font><font color=0x21ff03>5432U</font><font color=0xEEE3C6> > 关注微信 </font><font color=0x21ff03>5432U</font><font color=0xEEE3C6> 公众号 > 回复</font><font color=0x21ff03>RG</font>"),this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this);for(var t=e.GlobalConfig.instance.getValue("ZHIYUN_XCX_KFLB").split(","),i=0;i<t.length;i++){var n=new e.AttributeVO(t[i]);this.ui["icon"+i].setItem(n.id,n.value),this.ui["icon"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num)},this),n=null}},i}(e.BasePanel);e.zyxcxkefuPanel=t,__reflect(t.prototype,"foxgame.zyxcxkefuPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.QQdatingModel,this.panel=new e.QQdatingPanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.getModel=function(){return this.model},t.prototype.showPanel=function(){this.panel.getIsShow()||this.panel.show()},t.prototype.registerMsg=function(t){t.add(e.Code.QQ_HALL_PRIVILEGE_INFO_S,this),t.add(e.Code.QQ_HALL_PRIVILEGE_GIFT_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.QQ_HALL_PRIVILEGE_INFO_S:this.model.getQQdatingInfo(i);break;case e.Code.QQ_HALL_PRIVILEGE_GIFT_S:}},t.prototype.sendQQdatingInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.QQHallPrivilegeInfoReq");e.Message.instance.send(e.Code.QQ_HALL_PRIVILEGE_INFO_C,t,!0)},t.prototype.sendQQdatingLingqu=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.GetQQHallPrivilegeGiftReq");n.setType(t),n.setDictId(Number(i)),e.Message.instance.send(e.Code.QQ_HALL_PRIVILEGE_GIFT_C,n,!0)},t}();e.QQdatingController=t,__reflect(t.prototype,"foxgame.QQdatingController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.iconArr=[],e.skinName="QQblueListItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.iconArr=[this.icon0,this.icon1,this.icon2,this.icon3],this.lingquBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.model=e.QQdatingController.getInstance().getModel();for(var i=0;i<this.iconArr.length;i++)this.iconArr[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickIcon,this)},i.prototype.onClickIcon=function(t){e.TipsController.getInstance().showItemTips(t.target.itemId)},i.prototype.clickHandler=function(t){var i=3!=this.model.selectIndex?0:this.data.id;e.QQdatingController.getInstance().sendQQdatingLingqu(this.model.selectIndex,i)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.group_blue.visible=!1,1==this.model.selectIndex?(this.lingquBtn.filters=this.model.newGiftBlo?e.GlobalUtil.grayFilter:[],this.lingquBtn.touchEnabled=this.model.newGiftBlo?!1:!0,this.lingquBtn.label=this.model.newGiftBlo?"已领取":"领取",this.txt_name.text="QQ游戏大厅专属新手礼包",this.getXinshouRewardArr()):2==this.model.selectIndex?(this.lingquBtn.filters=this.model.dailyGiftIdBlo?e.GlobalUtil.grayFilter:[],this.lingquBtn.touchEnabled=this.model.dailyGiftIdBlo?!1:!0,this.lingquBtn.label=this.model.dailyGiftIdBlo?"已领取":"领取",this.txt_name.text="QQ游戏大厅专属每日礼包",this.getXinshouRewardArr()):3==this.model.selectIndex&&(e.PlayerService.instance.level>=Number(this.data.levelCond)?(this.lingquBtn.label=-1==this.model.growUpGiftIdArr.indexOf(Number(this.data.id))?"领取":"已领取",this.lingquBtn.filters=-1==this.model.growUpGiftIdArr.indexOf(Number(this.data.id))?[]:e.GlobalUtil.grayFilter):(this.lingquBtn.label="领取",this.lingquBtn.filters=e.GlobalUtil.grayFilter,this.lingquBtn.touchEnabled=!1),this.txt_name.text=this.data.desc+"",this.getRewardArr(this.data.award))},i.prototype.getXinshouRewardArr=function(){for(var t,i,n=String(this.data).split(","),o=[],a=0;a<n.length;a++)t=new e.AttributeVO(n[a]),i=new Object,i.key=t.id,i.value=t.value,o.push(i);for(var s=0;s<this.iconArr.length;s++)o[s]?this.iconArr[s].setItem(o[s].key,o[s].value):this.iconArr[s].visible=!1},i.prototype.getRewardArr=function(t){for(var i,n,o=[],a=0;a<t.length;a++)i=new e.AttributeVO(t[a]),n=new Object,n.key=i.id,n.value=i.value,o.push(n);for(var s=0;s<this.iconArr.length;s++)o[s]?this.iconArr[s].setItem(o[s].key,o[s].value):this.iconArr[s].visible=!1},i}(eui.ItemRenderer);e.QQdatingListItem=t,__reflect(t.prototype,"foxgame.QQdatingListItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.selectIndex=1,this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.openSelectRefresh=function(e){this.selectIndex=e,this.updateView()},t.prototype.getQQdatingInfo=function(t){this.newGiftBlo=t.getNewGift(),this.dailyGiftIdBlo=t.getDailyGift(),this.growUpGiftIdArr=t.getGrowUpGiftIds(),this.updateView(),e.ActivityBarController.getInstance().setQQdatingred()},t.prototype.getQQdatingRedBlo=function(){if(!this.newGiftBlo)return!0;if(!this.dailyGiftIdBlo)return!0;for(var t,i=this.getQQdatingVoData1(3),n=0;n<i.length;n++)if(t=i[n],e.PlayerService.instance.level>=Number(t.levelCond)&&-1==this.growUpGiftIdArr.indexOf(Number(t.id)))return!0;return!1},t.prototype.getLevelGiftRed=function(){for(var t,i=this.getQQdatingVoData1(3),n=0;n<i.length;n++)if(t=i[n],e.PlayerService.instance.level>=Number(t.levelCond)&&-1==this.growUpGiftIdArr.indexOf(Number(t.id)))return!0;return!1},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},t.prototype.getQQdatingVoData1=function(t){var i,n=[];3==t&&(i=e.JsonDataManager.instance.qqHallGrowUpGiftTemplate);for(var o in i)n.push(i[o]);return n},t.prototype.getQQdatingVoData=function(){var t,i=[];3==this.selectIndex&&(t=e.JsonDataManager.instance.qqHallGrowUpGiftTemplate);for(var n in t)i.push(t[n]);return i},t}();e.QQdatingModel=t,__reflect(t.prototype,"foxgame.QQdatingModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="QQbluePandectViewSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.collection=new eui.ArrayCollection,this.list.dataProvider=this.collection,this.list.itemRenderer=e.QQdatingListItem},i.prototype.initUi=function(){this.model=e.QQdatingController.getInstance().getModel();var t=[];if(1==this.model.selectIndex){var i=e.GlobalConfig.instance.getValue("QQ_HALL_NEW_GIFT");t.push(i)}else if(2==this.model.selectIndex){var i=e.GlobalConfig.instance.getValue("QQ_HALL_DAILY_GIFT");t.push(i)}else t=this.model.getQQdatingVoData();this.collection.replaceAll(t)},i}(eui.Component);e.QQdatingPandectView=t,__reflect(t.prototype,"foxgame.QQdatingPandectView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/QQblue/QQbluePanelSkin.exml",null,!1)||this;return i.selectArr=[],i.model=e,i}return __extends(i,t),i.prototype.updateView=function(){return 3==this.model.selectIndex&&this.datingPandectView?(this.setRed(),void this.datingPandectView.initUi()):void this.refresh()},i.prototype.initHook=function(){this.ui.img_title.source="qqyouxidating_json.title_datingtequan_png",this.ui.img_desc.source="banner_dating_jpg",this.selectArr=[this.ui.btn_select0,this.ui.btn_select1,this.ui.btn_select2,this.ui.btn_select3],this.model.registerObserver(this),this.ui.group_btn.removeChild(this.ui.btn_select0),this.ui.btn_select1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBox,this),this.ui.btn_select2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBox,this),this.ui.btn_select3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBox,this),this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick_close,this)},i.prototype.showHook=function(){this.model.selectIndex=1,e.QQdatingController.getInstance().sendQQdatingInfo()},i.prototype.refresh=function(){this.setButtonState(),this.removePanel(),this.setRed(),this.datingPandectView||(this.datingPandectView=new e.QQdatingPandectView,this.ui.sceneGroup.addChild(this.datingPandectView),this.datingPandectView.initUi())},i.prototype.setRed=function(){this.ui.img_red1.visible=this.model.newGiftBlo?!1:!0,this.ui.img_red2.visible=this.model.dailyGiftIdBlo?!1:!0,this.ui.img_red3.visible=this.model.getLevelGiftRed()?!0:!1},i.prototype.onClick_close=function(e){this.close()},i.prototype.onCheckBox=function(e){switch(e.target){case this.ui.btn_select1:this.model.selectIndex=1;break;case this.ui.btn_select2:this.model.selectIndex=2;break;case this.ui.btn_select3:this.model.selectIndex=3}this.refresh()},i.prototype.setButtonState=function(){for(var e=0;e<this.selectArr.length;e++)this.model.selectIndex==e?this.selectArr[e].selected=!0:this.selectArr[e].selected=!1},i.prototype.removePanel=function(){this.datingPandectView&&this.datingPandectView.parent&&(this.ui.sceneGroup.removeChild(this.datingPandectView),this.datingPandectView=null)},i}(e.BasePanel);e.QQdatingPanel=t,__reflect(t.prototype,"foxgame.QQdatingPanel",["foxgame.IQQdating","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.QQHallGrowUpGiftVo=t,__reflect(t.prototype,"foxgame.QQHallGrowUpGiftVo")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this,"WanbaQQVideoAdAwardSkin")||this;return i.isRunRandom=!1,i.previosTime=0,i.indexTime=0,i.currentIndex=0,i.speed=1,i.layer=LayerType.TOPLAYER,i.setIsShowBackBtn(!1),i.setRegisterTick(!0),i}return __extends(t,e),t.prototype.initHook=function(){this.ui.awardGetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.numView.mask=this.ui.maskImg},t.prototype.showHook=function(){this.isRunRandom=!1,this.ui.bg.touchEnabled=!0,this.ui.awardGetBtn.touchEnabled=!0},t.prototype.tickHook=function(e){this.isRunRandom&&(e-this.previosTime>=500&&(this.previosTime=e,this.ui.lampView.showDeng()),this.indexTime<20&&(this.currentIndex+=1,this.speed<300&&(this.speed+=3)),this.indexTime+=1,this.ui.numView.playMc(this.speed,this.currentIndex))},t.prototype.stopRandomMc=function(){this.isRunRandom=!1,this.previosTime=0,this.indexTime=0,this.currentIndex=0,this.speed=3},t.prototype.setRandomNum=function(e){this.ui.numView.stopMc(e)},t.prototype.refreshVideoAward=function(){this.refresh()},t.prototype.onClick=function(e){switch(e.target){case this.ui.awardGetBtn:showQQVideoAd();break;case this.ui.bg:this.close()}},t.prototype.setRunRandom=function(e){this.ui.bg.touchEnabled=!1,this.isRunRandom=e},t.prototype.setAwardBtnEnable=function(e){this.ui.awardGetBtn.touchEnabled=e},t}(e.BasePanel);e.WanbaQQVideoAdAwardPanel=t,__reflect(t.prototype,"foxgame.WanbaQQVideoAdAwardPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="WanbaQQVideoBoxSkin",e.touchEnabled=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.boxImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQQVideoClick,this)},i.prototype.show=function(){var t=this;setTimeout(function(){e.Global.topLayer.addChild(t),t.showQQVideoAd()},1800)},i.prototype.showQQVideoAd=function(){var t=this;this.qqVideoImg.x=(e.Global.stageWidth-this.qqVideoImg.width)/2,this.qqVideoImg.y=0,this.boxImg.rotation=0,this.lightImg.rotation=0,this.boxImg.touchEnabled=!0,this.qqVideoImg.visible=!0;var i=5e3,n=function(){egret.Tween.get(t.boxImg,{loop:!0}).to({rotation:10},100).to({rotation:-10},100)};egret.Tween.get(this.qqVideoImg).to({y:e.Global.stageHeight-2*this.qqVideoImg.height},i).call(n).wait(8e3).call(function(){egret.Tween.removeTweens(t.boxImg),t.boxImg.rotation=0}).to({y:e.Global.stageHeight},7e3).call(function(){t.qqVideoImg.x=(e.Global.stageWidth-t.qqVideoImg.width)/2,t.qqVideoImg.y=0,t.boxImg.rotation=0,t.lightImg.rotation=0,egret.Tween.removeTweens(t.qqVideoImg),egret.Tween.removeTweens(t.lightImg),egret.Tween.removeTweens(t.boxImg),t.qqVideoImg.visible=!1,t.close()}),egret.Tween.get(this.lightImg,{loop:!0}).to({rotation:359},3e3)},i.prototype.onQQVideoClick=function(t){egret.Tween.removeTweens(this.qqVideoImg),egret.Tween.removeTweens(this.lightImg),egret.Tween.removeTweens(this.boxImg),this.qqVideoImg.visible=!1,this.qqVideoImg.x=(e.Global.stageWidth-this.qqVideoImg.width)/2,this.qqVideoImg.y=0,e.WanbaQQVideoAdController.getInstance().showAdPanel(),this.close()},i.prototype.close=function(){egret.Tween.removeTweens(this.qqVideoImg),egret.Tween.removeTweens(this.lightImg),egret.Tween.removeTweens(this.boxImg),this.parent.removeChild(this)},i}(eui.Component);e.WanbaQQVideoAdBoxPanel=t,__reflect(t.prototype,"foxgame.WanbaQQVideoAdBoxPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isLookAd=!1,this.isPkBoosEnd=!1,this.isLoginInEnter=!1,this.model=new e.WanbaQQVideoAdModel,this.panel=new e.WanbaQQVideoAdPanel(this.model),this.awardPanel=new e.WanbaQQVideoAdAwardPanel(this.model),this.boxPanel=new e.WanbaQQVideoAdBoxPanel}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.registerMsg=function(t){t.add(e.Code.WANBA_QLD_AD_S,this),t.add(e.Code.WANBA_QLD_AD_AWARD_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.WANBA_QLD_AD_S:this.model.setQldAdInfo(i);break;case e.Code.WANBA_QLD_AD_AWARD_S:this.model.setQldAdAward(i)}},t.prototype.showBoxPanel=function(){this.boxPanel.parent||this.boxPanel.show()},t.prototype.showAdPanel=function(){this.panel.show()},t.prototype.showAwardPanel=function(){this.awardPanel.show()},t.prototype.closeAdPanel=function(){this.panel.close()},t.prototype.closeAwardPanel=function(){this.awardPanel.close()},t.prototype.onVideoEnd=function(t){var i=this;if(!t)return this.closeAwardPanel(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WANBA_QLD_AD_GETFAIL"));this.awardPanel.setRunRandom(!0);var n=setTimeout(function(){i.sendMessageWanbaAdAwardReq(!0),clearTimeout(n)},5e3)},t.prototype.stopRandomMc=function(){this.awardPanel.stopRandomMc()},t.prototype.setRandomMcNum=function(e){this.awardPanel&&this.awardPanel.setRandomNum(e)},t.prototype.sendMessageWanbaAdReq=function(t){if(void 0===t&&(t=!1),"qqgame"==window.GJlenged_chanel){this.isLoginInEnter=t;var i=HawkProtocolManager.newBuilder("JsProto.WanBaAdReq");e.Message.instance.send(e.Code.WANBA_QLD_AD_C,i,!0)}},t.prototype.sendMessageWanbaAdAwardReq=function(t){this.isLookAd=t;var i=HawkProtocolManager.newBuilder("JsProto.WanBaAdAwardReq");i.setIsAd(t),e.Message.instance.send(e.Code.WANBA_QLD_AD_AWARD_C,i,!0)},t}();e.WanbaQQVideoAdController=t,__reflect(t.prototype,"foxgame.WanbaQQVideoAdController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.times=1,this._index=0,this._wanbaAdAward=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.operateBack=function(){for(var e=this.observerList.length,t=0;e>t;t++)this.observerList[t].refreshVideoAward()},t.prototype.initParams=function(){var t=e.GlobalConfig.instance.getValue("WANBA_QLD_AD_AWARD");this._wanbaAdAward=t.split(",")},t.prototype.setQldAdInfo=function(t){if(e.WanbaQQVideoAdController.getInstance().isLoginInEnter){var i=t.getTodayCount();!t.getResult()||0!=i&&void 0!==i||e.WanbaQQVideoAdController.getInstance().showBoxPanel()}else t.getResult()&&e.WanbaQQVideoAdController.getInstance().showBoxPanel()},t.prototype.setQldAdAward=function(t){if(0==t.getErrorNo()){this.times=Number(t.getTimes())||1,e.WanbaQQVideoAdController.getInstance().isLookAd?e.WanbaQQVideoAdController.getInstance().setRandomMcNum(t):console.log("领取成功"),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WANBA_QLD_AD_GETSUC")),e.WanbaQQVideoAdController.getInstance().awardPanel.getIsShow()&&e.WanbaQQVideoAdController.getInstance().awardPanel.setAwardBtnEnable(!1),e.WanbaQQVideoAdController.getInstance().panel.getIsShow()&&e.WanbaQQVideoAdController.getInstance().panel.setTouchenable(!1);var i=setTimeout(function(){e.WanbaQQVideoAdController.getInstance().closeAdPanel(),e.WanbaQQVideoAdController.getInstance().awardPanel.setAwardBtnEnable(!0),e.WanbaQQVideoAdController.getInstance().closeAwardPanel(),clearTimeout(i)},500);this._index=0,this._interVal=egret.setInterval(this.flytoBag,this,500)}},t.prototype.flytoBag=function(){var t=new e.AttributeVO(this._wanbaAdAward[this._index]),i=new egret.Point(e.Global.stageWidth/2,e.Global.stageHeight/2);e.FlyController.getInstance().flyToBag(i,t.id,this.times),this._index<this._wanbaAdAward.length-1?this._index++:(this._index=0,egret.clearInterval(this._interVal))},Object.defineProperty(t.prototype,"wanbaAdAward",{get:function(){return this._wanbaAdAward},enumerable:!0,configurable:!0}),t}();e.WanbaQQVideoAdModel=t,__reflect(t.prototype,"foxgame.WanbaQQVideoAdModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"WanbaQQVideoAdSkin")||this;return i.setIsShowBackBtn(!1),i.layer=LayerType.TOPLAYER,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.initParams(),this.ui.simpleGetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.lookAdGetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showHook=function(){this.setTouchenable(),this.showBoxAniTween();var t=this.model.wanbaAdAward.length;this.ui.itemGroup.removeChildren();for(var i=0;t>i;i++){var n=this.model.wanbaAdAward[i],o=new e.AttributeVO(n),a=new e.ItemIcon;a.setItem(o.id,o.value),this.ui.itemGroup.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAwardClick,this)}},i.prototype.showBoxAniTween=function(){var e=this;egret.Tween.removeTweens(this.ui.boxAniImage),egret.Tween.get(this.ui.boxAniImage).to({rotation:359},2e3).call(function(){e.ui.boxAniImage&&(e.ui.boxAniImage.rotation=0,e.showBoxAniTween())})},i.prototype.refreshVideoAward=function(){this.refresh()},i.prototype.onClick=function(t){switch(t.target){case this.ui.simpleGetBtn:e.WanbaQQVideoAdController.getInstance().sendMessageWanbaAdAwardReq(!1);break;case this.ui.lookAdGetBtn:e.WanbaQQVideoAdController.getInstance().showAwardPanel()}},i.prototype.setTouchenable=function(e){void 0===e&&(e=!0),this.ui.simpleGetBtn.touchEnabled=e,this.ui.lookAdGetBtn.touchEnabled=e},i.prototype.onAwardClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num)},i}(e.BasePanel);e.WanbaQQVideoAdPanel=t,__reflect(t.prototype,"foxgame.WanbaQQVideoAdPanel",["foxgame.IWanba","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.stopNum=0,e.itemArr=[],e.skinName="WanbaVideoAdNumView",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemArr.push(this.item0,this.item1)},i.prototype.playMc=function(t,i){var n=this.itemArr.length;n>=i&&(n=i),this.stopNum=0;for(var o=0;n>o;o++){var a=this.itemArr[o];a.issTop&&(this.stopNum+=1),a.playMc(t)}if(2==this.stopNum){e.WanbaQQVideoAdController.getInstance().stopRandomMc();for(var o=0;n>o;o++){var a=this.itemArr[o];a.issTop=!1}this.stopNum=0}},i.prototype.stopMc=function(e){if(e){var t=e.getTimes(),i=[0,0];10>t?(i[0]=0,i[1]=t):t>=10&&(i[0]=Math.floor(t/10),i[1]=t-10*i[0]);for(var n=this.itemArr.length,o=0;n>o;o++){var a=this.itemArr[o];a.stopMc(i[o])}}},i.prototype.checkGold=function(e){for(var t=[0,0,0,0,0,0,0],i=e+"",n=i.split(""),o=t.length,a=t.length-n.length,s=0;o>s;s++)a>s||Number(n[s-a])&&(t[s]=Number(n[s-a]));return t},i}(eui.Component);e.WanbaVideoAdNumView=t,__reflect(t.prototype,"foxgame.WanbaVideoAdNumView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ShareFriendItemSkins",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=e.JsonDataManager.instance.roleTemplate[i.getRoleItemId()];this.headImg.source=n.icon2,this.roleName.text=i.getName(),this.roleLv.text="lv."+i.getLevel(),this.roleAtt.text="战斗力："+i.getFightValue(),this.viplevelImg.source="u_vip"+i.getVipLevel()+"_png"},i}(eui.ItemRenderer);e.ShareFriendItemRender=t,__reflect(t.prototype,"foxgame.ShareFriendItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SharIngAwardItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.yilingquImg.visible=!1,this.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAwardClick,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data;this.curVO=i;var n=i.award,o=this.itemGroup.numChildren,a=n.length;if(o>a)for(var s=0;o-a>s;s++)this.itemGroup.removeChildAt(o-1-s);for(var s=0;s<n.length;s++){var r=new e.AttributeVO(n[s]),l=new e.ItemIcon;s>o-1?this.itemGroup.addChild(l):l=this.itemGroup.getChildAt(s),l.setItem(r.id,r.value,!0),l.hasEventListener(egret.TouchEvent.TOUCH_TAP)||l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.yilingquImg.visible=i.isEnd,this.getAwardBtn.visible=!this.yilingquImg.visible;var h=i.desc.split("{0}");0==Number(i.typeCond)?this.taskLabel.textFlow=(new egret.HtmlTextParser).parse(h[0]+("<font color=0x21ff03>"+i.numCond+"</font>")+h[1]+this.getCanChangedStr(i.getNum,i.numCond)):this.taskLabel.textFlow=(new egret.HtmlTextParser).parse(h[0]+("<font color=0x21ff03>"+i.typeCond+"</font>")+h[1]+this.getCanChangedStr(i.getNum,i.numCond))},i.prototype.getCanChangedStr=function(e,t){var i;return i=e>=t?'<font size=20 color=0x21ff03 fontFamily="宋体">'+e+"</font>"+('<font size=20 color=0xffffff fontFamily="宋体">/'+t+"</font>"):'<font size=20 color=0xff0000 fontFamily="宋体">'+e+"</font>"+('<font size=20 color=0xffffff fontFamily="宋体">/'+t+"</font>"),"("+i+")"},i.prototype.onClick=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.onGetAwardClick=function(t){this.curVO.isCanget?(console.log("发送领取"),e.ChannelShareController.getInstance().sendMessageGetShareAward(this.curVO.id)):e.ChannelShareController.getInstance().launchShare()},i}(eui.ItemRenderer);e.SharIngAwardItemRender=t,__reflect(t.prototype,"foxgame.SharIngAwardItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.ChannelShareModel,this.mainPanel=new e.ChannelShareMainPanel(this.model),this.sharIngAwardPanel=new e.SharIngAwardPanel(this.model),this.friendGiftsPanel=new e.ShareFriendsGiftsPanel(this.model),this.dividendPanel=new e.ShareFriendsDividendPanel(this.model),this.friendsListPanel=new e.ShareFriendsListPanel(this.model),this.panelArr=[this.sharIngAwardPanel,this.friendGiftsPanel,this.dividendPanel,this.friendsListPanel]}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.registerMsg=function(t){t.add(e.Code.CS_SHARE_IN_SUCC_S,this),t.add(e.Code.CS_SHARE_INFO_S,this),t.add(e.Code.CS_GET_SHARE_AWARD_S,this),t.add(e.Code.CS_SHARE_CHANGE_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.CS_SHARE_IN_SUCC_S:this.model.setShareSucInfo(i);break;case e.Code.CS_SHARE_INFO_S:this.model.setShareInfo(i);break;case e.Code.CS_GET_SHARE_AWARD_S:this.model.setShareAward(i);break;case e.Code.CS_SHARE_CHANGE_S:this.model.setChangeShareInfo(i)}},t.prototype.sendMessageShareSucc=function(){var t=HawkProtocolManager.newBuilder("JsProto.ShareInSuccReq");e.Message.instance.send(e.Code.CS_SHARE_IN_SUCC_C,t,!0)},t.prototype.sendMessageShareinfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.ShareInfoReq");e.Message.instance.send(e.Code.CS_SHARE_INFO_C,t,!0)},t.prototype.sendMessageGetShareAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetShareAwardReq");i.setDictId(Number(t)),e.Message.instance.send(e.Code.CS_GET_SHARE_AWARD_C,i,!0)},t.prototype.showPanel=function(){this.mainPanel.getIsShow()||this.mainPanel.show()},t.prototype.launchShare=function(){this.model.sharingTimeNum=(new Date).getTime();var t=e.Global.serverId+"*"+e.UserInfo.platform.getPuid(),i="playerIdentify="+t+"&inviteTime="+this.model.sharingTimeNum,n={code:"channelshare",title:"登录即送VIP13，百万元宝免费领！",query:i};e.UserInfo.platform.reportData_legend(n),this.sendMessageShareSucc()},t.prototype.setOffsetShareSucTime=function(){if(this.model.offsetShareSucTimes&&this.model.offsetShareSucTimes>0)this.previosTime=0,e.ActivityBarController.getInstance().setChannelShareRedPoint(!1),this.mainPanel.getIsInit()&&this.setPlayerShareRedPoint(channelSharePanelType.FENXIANGYOULI,!1),egret.startTick(this.tick,this);else{var t=this.model.shareSucTimes<Number(e.GlobalConfig.instance.getValue("SHARE_TIP_TIMES"));e.ActivityBarController.getInstance().setChannelShareRedPoint(t),this.mainPanel.getIsInit()&&this.setPlayerShareRedPoint(channelSharePanelType.FENXIANGYOULI,t)}},t.prototype.tick=function(t){if(this.model.offsetShareSucTimes&&!(this.model.offsetShareSucTimes<0)){if(t-this.previosTime>=1e3&&(this.previosTime=t,this.model.offsetShareSucTimes-=1e3,Math.floor(this.model.offsetShareSucTimes/1e3)<0)){egret.stopTick(this.tick,this);var i=this.model.shareSucTimes<Number(e.GlobalConfig.instance.getValue("SHARE_TIP_TIMES"));e.ActivityBarController.getInstance().setChannelShareRedPoint(i),this.setPlayerShareRedPoint(channelSharePanelType.FENXIANGYOULI,i)}return!1}},t.prototype.getSharePanel=function(e){return this.panelArr[e]},t.prototype.setPlayerShareRedPoint=function(e,t){this.mainPanel.getIsInit()&&this.mainPanel.refreshRedPoint(e,t)},t}();e.ChannelShareController=t,__reflect(t.prototype,"foxgame.ChannelShareController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"ChannelShareMainPanelSkin")||this;return i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){for(var e=this.ui.bottomTap.numChildren,t=0;e>t;t++)this.ui.bottomTap.getChildAt(t).addEventListener(eui.UIEvent.CHANGE,this.onChanged,this);this.ui.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnClick,this)},i.prototype.initParams=function(){this.model.initParams()},i.prototype.showHook=function(){this.ui.bottomTap.getChildAt(0).selected=!0,this.refreshChildPanel(0)},i.prototype.onShareBtnClick=function(){e.ChannelShareController.getInstance().launchShare()},i.prototype.setinviteTimeLabel=function(){this.getIsShow()&&(this.model.offsetShareSucTimes<=0?this.setinviteTimeLabelVis(!1):(this.setinviteTimeLabelVis(!0),this.ui.inviteTimeLabel.text="分享领奖CD："+e.GlobalUtil.getTimeString(Math.ceil(this.model.offsetShareSucTimes/1e3),4)))},i.prototype.setinviteTimeLabelVis=function(e){this.ui.inviteTimeLabel.visible=!1},i.prototype.panelChange=function(){this.refresh(),e.ChannelShareController.getInstance().getSharePanel(this.model.curSelectedPanel).refreshPanel()},i.prototype.onChanged=function(e){for(var t=this.ui.bottomTap.getChildIndex(e.target),i=0;i<this.ui.bottomTap.numChildren;i++)this.ui.bottomTap.getChildAt(i).selected=t==i;this.refreshChildPanel(t)},i.prototype.refreshChildPanel=function(t){if(this.model.curSelectedPanel!=t){t==channelSharePanelType.HAOYOUFENHONG?(this.ui.shareBtn.x=this.ui.shareBtn.parent.width-this.ui.shareBtn.width>>1,this.ui.shareBtn.y=670):(this.ui.shareBtn.x=455,this.ui.shareBtn.y=205),this.ui.tipsGroup.visible=t<=channelSharePanelType.HAOYOULIBAO,this.ui.shareBtn.visible=t<=channelSharePanelType.HAOYOUFENHONG,this.ui.bannerImg.source=this.model.bannerArr[t],this.model.curSelectedPanel=t;var i=e.ChannelShareController.getInstance().getSharePanel(t);this.ui.allViewGroup.removeChildren(),this.ui.allViewGroup.addChild(i),i.showPanel(),e.ChannelShareController.getInstance().sendMessageShareinfo()}},i.prototype.refreshRedPoint=function(e,t){this.ui.redPointGroup.getChildAt(e).visible=t},i.prototype.closeHook=function(){this.model.curSelectedPanel=-1},i}(e.BasePanel);e.ChannelShareMainPanel=t,__reflect(t.prototype,"foxgame.ChannelShareMainPanel",["foxgame.IChanelShare","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.shareSucTimes=0,this.observerList=[],this.shareTaskList=[],this.shareFriendList=[],this.bannerArr=[],this.sharingAwardCollection=new eui.ArrayCollection,this.shareFriendCollection=new eui.ArrayCollection}return t.prototype.initParams=function(){this.shareTaskVO={},this.shareTaskVO=e.JsonDataManager.instance.shareTaskInfoTemplate,this.shareTimeCell=Number(e.GlobalConfig.instance.getValue("SHARE_TIP_TIME_CELL")),this.bannerArr.push("banner_fxyl_01_jpg","banner_fxyl_02_jpg","banner_fxyl_03_jpg","banner_fxyl_04_jpg")},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.operateBack=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChange()},t.prototype.setShareInfo=function(t){this.shareTaskList=t.getShareInfos(),this.shareFriendList=t.getShareFriends(),this.offsetShareSucTimes=t.getCd(),e.ChannelShareController.getInstance().setOffsetShareSucTime(),this.setShareSucTimes(),this.operateBack()},t.prototype.setShareSucInfo=function(t){0==t.getErrorNo()&&(this.offsetShareSucTimes=t.getCd(),e.ChannelShareController.getInstance().setOffsetShareSucTime(),this.offsetShareSucTimes<=0&&console.log("分享成功!!!"))},t.prototype.setShareAward=function(e){return 0!=e.getErrorNo()?console.log("领取失败"):void console.log("领取成功")},t.prototype.setChangeShareInfo=function(e){this.shareTaskList=e.getShareInfos(),this.setShareSucTimes(),this.operateBack()},t.prototype.setShareSucTimes=function(){for(var t=this.shareTaskList.length,i=0;t>i;i++){var n=this.shareTaskList[i];if(n.getDictId()==ShareTaskType.SHARE_TYPE&&(this.shareSucTimes=n.getNum(),console.log("分享成功次数为:",this.shareSucTimes)),!n.getAward()){var o=n.getDictId();this.shareTaskVO||(this.shareTaskVO=e.JsonDataManager.instance.shareTaskInfoTemplate);var a=this.shareTaskVO[o];e.ChannelShareController.getInstance().setPlayerShareRedPoint(a.relationPanelId,n.getNum()>=a.numCond&&!n.getAward())}}},t.prototype.getRelationPanelByid=function(e){var t=this.shareTaskVO,i=[];
for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];o.relationPanelId==e&&i.push(o)}return i},t}();e.ChannelShareModel=t,__reflect(t.prototype,"foxgame.ChannelShareModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.ChannelShareUtils=t,__reflect(t.prototype,"foxgame.ChannelShareUtils")}(foxgame||(foxgame={}));var channelSharePanelType;!function(e){e[e.FENXIANGYOULI=0]="FENXIANGYOULI",e[e.HAOYOULIBAO=1]="HAOYOULIBAO",e[e.HAOYOUFENHONG=2]="HAOYOUFENHONG",e[e.HAOYOULIEBIAO=3]="HAOYOULIEBIAO"}(channelSharePanelType||(channelSharePanelType={}));var ShareTaskType;!function(e){e[e.SHARE_TYPE=1]="SHARE_TYPE",e[e.LOGIN_TYPE=2]="LOGIN_TYPE",e[e.LEVEL_TYPE=3]="LEVEL_TYPE",e[e.VIP_LEVEL_TYPE=4]="VIP_LEVEL_TYPE",e[e.RECHARGE_TYPE=5]="RECHARGE_TYPE"}(ShareTaskType||(ShareTaskType={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.skinName="BackButton",this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHandler,this),this.fireBackHandlerWhenRemove=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.setBackFun=function(e){this.backFun=e},t.prototype.setBackPanel=function(e){this.panel=e},t.prototype.getBackPanel=function(){return this.panel},t.prototype.backHandler=function(e){null!=this.backFun&&this.backFun()},Object.defineProperty(t.prototype,"isFireBackHandlerWhenRemove",{get:function(){return this.fireBackHandlerWhenRemove},enumerable:!0,configurable:!0}),t.prototype.setFireBackHandlerWhenRemove=function(e){this.fireBackHandlerWhenRemove=e},t.prototype.doWhenRemove=function(){if(this.fireBackHandlerWhenRemove&&this.backFun&&this.panel){var e=this.panel.getIsShowTween(),t=this.panel;this.panel.setIsShowTween(!1),this.backFun(),t.setIsShowTween(e)}},t}(eui.Button);e.BackButton=t,__reflect(t.prototype,"foxgame.BackButton")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this,"ShareFriendsDividendPanelSkin")||this;return i.model=t,i}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.showPanel=function(){},t.prototype.refreshPanel=function(){},t}(e.BaseSharePanel);e.ShareFriendsDividendPanel=t,__reflect(t.prototype,"foxgame.ShareFriendsDividendPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"ShareFriendsGiftsPanelSkin")||this;return i.relationPanelList=[],i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);this.model.shareTaskVO;this.relationPanelList=this.model.getRelationPanelByid(channelSharePanelType.HAOYOULIBAO),this.panelList.itemRenderer=e.SharIngAwardItemRender,this.panelList.dataProvider=this.model.sharingAwardCollection,this.panelList.useVirtualLayout=!1},i.prototype.showPanel=function(){this.panelScroller.viewport.scrollH=0},i.prototype.refreshPanel=function(){this.relationPanelList=this.model.getRelationPanelByid(channelSharePanelType.HAOYOULIBAO);var t=(e.JsonDataManager.instance.shareTaskTypeTemplate,this.model.shareTaskList.length);console.log(this.model.shareTaskList);for(var i=[],n=[],o=[],a=[],s=[],r=0;t>r;r++){var l=this.model.shareTaskList[r],h=l.getDictId(),c=this.model.shareTaskVO[h];switch(c.getNum=l.getNum(),c.isEnd=l.getAward(),c.isCanget=l.getNum()>=c.numCond&&!l.getAward(),Number(c.taskType)){case ShareTaskType.LOGIN_TYPE:n.push(c);break;case ShareTaskType.LEVEL_TYPE:o.push(c);break;case ShareTaskType.VIP_LEVEL_TYPE:a.push(c);break;case ShareTaskType.RECHARGE_TYPE:s.push(c)}}i=this.getResultArr(n,ShareTaskType.LOGIN_TYPE).concat(this.getResultArr(o,ShareTaskType.LEVEL_TYPE)).concat(this.getResultArr(a,ShareTaskType.VIP_LEVEL_TYPE)).concat(this.getResultArr(s,ShareTaskType.RECHARGE_TYPE)),this.model.sharingAwardCollection.replaceAll(i)},i.prototype.getResultArr=function(e,t){var i=e.length;if(i>=1)return this.deleteArrByTypeCond(e);var n=this.getInitArr(t);return n},i.prototype.getInitArr=function(t){var i=[],n=e.JsonDataManager.instance.shareTaskInfoTemplate;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];Number(a.taskType)==t&&i.push(a)}return this.deleteArrByTypeCond(i)},i.prototype.deleteArrByTypeCond=function(e){for(var t=-1,i=[],n=0;n<e.length;n++){var o=e[n],a=Number(o.typeCond);t==a||o.isEnd||(i.push(o),t=a)}return i},i}(e.BaseSharePanel);e.ShareFriendsGiftsPanel=t,__reflect(t.prototype,"foxgame.ShareFriendsGiftsPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"ShareFriendsListPanelSkin")||this;return i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.panelList.itemRenderer=e.ShareFriendItemRender,this.panelList.dataProvider=this.model.shareFriendCollection,this.panelList.useVirtualLayout=!1},i.prototype.showPanel=function(){this.model.shareFriendCollection.source=this.model.shareFriendList},i.prototype.refreshPanel=function(){console.log("好友列表:",this.model.shareFriendList),this.model.shareFriendCollection.replaceAll(this.model.shareFriendList)},i}(e.BaseSharePanel);e.ShareFriendsListPanel=t,__reflect(t.prototype,"foxgame.ShareFriendsListPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"SharIngAwardPanelSkin")||this;return i.relationPanelList=[],i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.panelList.itemRenderer=e.SharIngAwardItemRender,this.panelList.dataProvider=this.model.sharingAwardCollection,this.panelList.useVirtualLayout=!1},i.prototype.showPanel=function(){this.panelScroller.viewport.scrollH=0},i.prototype.refreshPanel=function(){var e=this,t=this.model.shareTaskList.length;this.relationPanelList=this.model.getRelationPanelByid(channelSharePanelType.FENXIANGYOULI),this.relationPanelList.forEach(function(i){var n=i.id,o=i.numCond;i.isEnd=!1,i.isCanget=!1,i.getNum=0;for(var a=0;t>a;a++){var s=e.model.shareTaskList[a];n==s.getDictId()&&(i.getNum=s.getNum(),i.isEnd=s.getAward(),i.isCanget=o<=s.getNum()&&!s.getAward())}}),this.model.sharingAwardCollection.replaceAll(this.relationPanelList)},i}(e.BaseSharePanel);e.SharIngAwardPanel=t,__reflect(t.prototype,"foxgame.SharIngAwardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SharePanelVO=t,__reflect(t.prototype,"foxgame.SharePanelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.getNum=0,this.isEnd=!1,this.isCanget=!1}return e}();e.ShareTaskVO=t,__reflect(t.prototype,"foxgame.ShareTaskVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/main/MainFightValueScroll.exml",t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.scaleX=this.scaleY=1.5},t.prototype.init=function(e,t){if(this.mAni)this.mAni.reset(),this.mAni.reinit(e,t);else{var i={useEasing:!0,easingFn:null,useGrouping:!1,separator:",",decimal:"."};this.mAni=new CountUp(this.mFv,e,t,0,3,i)}this.startValue=e,this.endValue=t,this.deltValue=t-e,this.mAni.start(),this.setData()},t.prototype.setData=function(){this.deltValue>=0?(this.mDelt.text=""+this.deltValue,this.fuhaoImg.source="add_png",this.fuhaoImg.visible=!0):(this.mDelt.text=""+this.deltValue,this.fuhaoImg.visible=!1)},t.prototype.dispose=function(){},t}(eui.Component);e.MainFightValueScroll=t,__reflect(t.prototype,"foxgame.MainFightValueScroll")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/main/LVUpSkin.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setData()},t.prototype.init=function(e){this.data=e,this.setData()},t.prototype.setData=function(){this.isInit&&null!=this.data&&(this.mLv.text=this.data)},t.prototype.dispose=function(){this.data=null},t}(e.ViewControler);e.MainLvUp=t,__reflect(t.prototype,"foxgame.MainLvUp")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){if(this.id=Number(e.id||0),this.type=Number(e.type||0),this.status=Number(e.status||0),this.name=e.name,this.title=e.title,this.point=[],e.point)for(var t=e.point.split(","),i=0;i<t.length;i++)this.point.push(Number(t[i]));this.source=e.source,this.offsetX=Number(e.offsetX||0),this.offsetY=Number(e.offsetY||0),this.nameHeight=Number(e.nameHeight||0),this.titleHeight=Number(e.titleHeight||0)}return e}();e.MainSceneNpcVO=t,__reflect(t.prototype,"foxgame.MainSceneNpcVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/loading/LoadingBarCompent.exml",t}return __extends(t,e),t.prototype.setThumb=function(e){this.thumb.source=e},t}(eui.ProgressBar);e.MainLoadingBar=t,__reflect(t.prototype,"foxgame.MainLoadingBar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.hasDoSomeInit=!1,this.preloadGroup=[],this.model=new e.MainLoadingModel,this.panel=new e.MainLoadingPanel(this.model),this.addPreload("dataConfigGroup"),this.addPreload("battleBasicGroup"),this.addPreload("commonBasicNotInPreloadingGroup"),this.addPreload("battleFontGroup"),this.addPreload("forceInMainLoadingProgressGroup")}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.registerMsg=function(t){t.add(e.Code.SYNC_START_S,this),t.add(e.MsgCMD.LOAD_RES,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.SYNC_START_S:var n=i;2==n.getType()&&(this.model._csUnionSiege=n.getCsUnionSiegePresident()),Log.trace("皇城霸主:"+n.getUnionSiegePresident()),this.model._unionsiege=""==n.getUnionSiegePresident()?"暂无":n.getUnionSiegePresident(),this.model._csUnionSiege=n.getCsUnionSiegePresident(),(null==this.model._csUnionSiege||""==this.model._csUnionSiege)&&(this.model._csUnionSiege="暂无");break;case e.MsgCMD.LOAD_RES:"progress"==i.status?this.progressHandler(i):"complete"==i.status?this.completeHandler(i):"error"==i.status&&this.errorHandler(i)}},t.prototype.getmodel=function(){return this.model},t.prototype.showMainLoadingPanel=function(){this.panel.hideProgressBarWhenCreateCharacter(),this.panel.show()},t.prototype.hidelabel=function(){this.panel.hidelabel()},t.prototype.startLoad=function(){e.Global.iLoadStep=e.LoadStep.Load_In_Main_Load_Frame,this.panel.show(),this.panel.showProgressBarAfterCreateCharacter(),this.startMainLoading()},t.prototype.startMainLoading=function(){e.LoadManager.instance.loadCombineGroup("mainLoading",this.preloadGroup),e.MtaUtils.notifyEvent("chuangjiaojinyo",{startmainloading:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_startMainLoading"}),e.AldUtils.sendEvent("game_startMainLoading","game_startMainLoading"),1==e.MtaUtils.checkEventJiaZaiJinYouXi&&e.MtaUtils.notifyEvent("jiazaijinyouxi",{startloadmainui:"true"})},t.prototype.errorHandler=function(e){this.completeHandler(e)},t.prototype.progressHandler=function(e){e&&e.combine&&"mainLoading"==e.combine&&this.model.setData(e)},t.prototype.completeHandler=function(t){t&&t.combine&&"mainLoading"==t.combine&&(Log.trace("------------------loading complete "+JSON.stringify(t)),e.Global.isWeChatXiaoChengXuBranch&&(window.writeImageVersion&&window.writeImageVersion(),window.writeTextVersion&&window.writeTextVersion(),window.delay_write_text_enable=!0,window.delay_write_image_enable=!0),this.hasDoSomeInit||(this.hasDoSomeInit=!0,e.MapViewportGroupManager.instance.initMap(),e.JsonDataManager.instance.initConfigData(),e.PlayerService.instance.registerListener(),e.BattleService.instance.registerListener(),e.WingService.instance.registerListener(),e.MapSceneService.instance.registerListener(),e.ActionManager.instance.init()),this.requestLastMessage(),this.notifySDKEnterGame(),e.GlobalUtil.destroyGroup("createCharacterPanelGroup"),e.GlobalUtil.destroyGroup("createCharactAni"))},t.prototype.requestLastMessage=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPSyncStartReq");e.Message.instance.send(e.Code.SYNC_START_C,t,!0)},t.prototype.closePanel=function(){e.Message.instance.remove(e.MsgCMD.LOAD_RES,this),this.panel&&(this.panel.close(),this.panel.freeSelf(),this.panel=null)},t.prototype.cleanNotNeededRes=function(){App.SoundManager().pauseBg(!0),App.SoundManager().setBgOn(!1),e.GlobalUtil.destroyGroup("mainLoadingPanelGroup"),e.GlobalUtil.destroyRes("mainLoadingPanel",!0),e.GlobalUtil.destroyGroup("loginPanelGroup"),e.GlobalUtil.destroyRes("loginPanel"),e.Global.iLoadStep=e.LoadStep.Load_In_Battle_Scene_Frame},t.prototype.addPreload=function(e){this.preloadGroup.push(e)},t.prototype.notifySDKEnterGame=function(){window.sdk&&window.sdk.EnterGame&&window.sdk.EnterGame()},t}();e.MainLoadingController=t,__reflect(t.prototype,"foxgame.MainLoadingController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.groupTotal=0,this.groupLoaded=0,this.combineTotal=0,this.combineLoaded=0,this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.setData=function(e){this.groupTotal=e.groupTotal,this.groupLoaded=e.groupLoaded,this.combineTotal=e.combineTotal,this.combineLoaded=e.combineLoaded;for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.updateView()},e.prototype.cleanData=function(){this.observerList=null},e}();e.MainLoadingModel=t,__reflect(t.prototype,"foxgame.MainLoadingModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/loading/MainLoading.exml")||this;return i.needHideProgressBarWhenCreateCharacter=!1,i.tryReconnectCount=0,i.tryReconnectTimestamp=0,i.isMask=!1,i.setIsShowBackBtn(!1),i.setIsShowTween(!1),i.setEffect(!1),i.setIsTextureCache(!1),i.model=e,i.isCallHideSceneObjectsWhenClose=!1,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.xX=this.ui.barImg.x,this.ui.barImg.mask=this.ui.barMask,this.ui.barImg0.mask=this.ui.barMask0,this.leftDoorX=this.ui.leftDoorImg.x,this.rightDoorX=this.ui.rightDoorImg.x,this.ui.refreshLabel.textFlow=new Array({text:e.LanguageUtils.instance.getValue("WUFAJINRUYOUXI")+",",style:{size:21,textColor:14540253}},{text:e.Global.isWeChatXiaoChengXuBranch?"重启小程序":e.LanguageUtils.instance.getValue("DIANJISHUAXIN"),style:{size:21,textColor:3403331,underline:!0,href:"event:refresh"}}),this.ui.refreshLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refreshHandler,this),ScreenAdaptation.instance.adaptLoading(this.ui);var t=(e.Global.stageWidth/this.ui.width,window.codeVersion||""),i=e.Global.version||"";this.ui.versionLab.text="v"+t+" r"+i},i.prototype.hidelabel=function(){this.ui.label_txt.text=""},i.prototype.showHook=function(){this.fireAni1=new e.FoxAni(this.ui.fireGroup1),this.fireAni1.play("loginFire","ani",-1),this.fireAni2=new e.FoxAni(this.ui.fireGroup2),this.fireAni2.play("loginFire","ani",-1),this.fireAni3=new e.FoxAni(this.ui.fireGroup3),this.fireAni3.play("loginFire","ani",-1),this.fireAni4=new e.FoxAni(this.ui.fireGroup4),this.fireAni4.play("loginFire","ani",-1),"1108023326"==getGlobalConfig().wanBaAppId?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font>本游戏由“深圳一凡”提供 \n< /font><font>如在游戏中遇到问题,请联系我们的在线客服：800824122< /font>"):"1107925907"==getGlobalConfig().wanBaAppId?this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font>本游戏由“冰玩网络”提供 \n< /font><font>如在游戏中遇到问题,请联系我们的在线客服：2322310853< /font>"):"QQdating"==getchannel()&&(this.ui.label_txt.textFlow=(new egret.HtmlTextParser).parser("<font size:10>审批文号：新广出审[2018]415号  软著登记号：2017SR148888\n</font>< font size:10>出版物号：ISBN 978-7-498-03887-6\n< /font>< font size:10>著作权人：重庆盟岩科技有限公司  出版单位：北京伯通电子出版社\n< /font>")),this.progressBarAni=new e.FoxAni(this.ui.barMaskAniGroup),this.progressBarAni.play("progressFire","ani",-1),this.ui.barMaskAniGroup.y+=20,this.progressBarAni0=new e.FoxAni(this.ui.barMaskAniGroup0),this.progressBarAni0.play("progressFire","ani",-1),this.ui&&this.needHideProgressBarWhenCreateCharacter&&(this.ui.progressGroup.visible=!1),e.Global.isWeChatXiaoChengXuBranch&&(this.ui.loadingAd1Img.source="loadingAd1_png",this.ui.loadingAd2Img.source="loadingAd2_png"),this.ui.refreshLabel.visible=!1;var t=this;setTimeout(function(){try{!e.Global.isInit&&e.Global.iLoadStep<e.LoadStep.Load_In_Battle_Scene_Frame&&t&&t.ui&&(t.ui.refreshLabel.visible=!0,e.FundebugUtils.notify("refreshLabel.visible","true"))}catch(i){console.warn("that.refreshLabel.visible = true, failed....................")}},e.Global.isNewPlayer?2e4:1e4)},i.prototype.closeHook=function(){e.GlobalUtil.destroyGroup("loginPanelGroup"),this.fireAni1.clear(),this.fireAni1=null,this.fireAni2.clear(),this.fireAni2=null,this.fireAni3.clear(),this.fireAni3=null,this.fireAni4.clear(),this.fireAni4=null,this.progressBarAni.clear,this.progressBarAni=null,this.progressBarAni0.clear,this.progressBarAni0=null},i.prototype.initParams=function(){this.hideProgressBar(!0)},i.prototype.refresh=function(){if(this.model.groupLoaded==this.model.groupTotal){var t=this.ui.leftDoorImg,i=this.ui.rightDoorImg,n=6;switch(this.model.combineLoaded){case 0:t.x=this.leftDoorX,i.x=this.rightDoorX;case 1:t.x=this.leftDoorX-1*t.width/n,i.x=this.rightDoorX+1*i.width/n;break;case 2:t.x=this.leftDoorX-2*t.width/n,i.x=this.rightDoorX+2*i.width/n;break;case 3:t.x=this.leftDoorX-3*t.width/n,i.x=this.rightDoorX+3*i.width/n;break;case 4:t.x=this.leftDoorX-4*t.width/n,i.x=this.rightDoorX+4*i.width/n;break;case 5:t.x=this.leftDoorX-5*t.width/n,i.x=this.rightDoorX+5*i.width/n;break;case 6:t.x=this.leftDoorX-6*t.width/n,i.x=this.rightDoorX+6*i.width/n,e.Global.isWeChatXiaoChengXuBranch&&(this.ui.loadingAd2Img.source="loadingAd3_png")}}var o=Math.floor(this.model.groupLoaded/(this.model.groupTotal||1)*100);this.ui.progressLabel.text=e.LanguageUtils.instance.getValue("JIAZAIZHUWENJIA")+"..."+o+"%",egret.Tween.pauseTweens(this.ui.loadingBar1),egret.Tween.removeTweens(this.ui.loadingBar1),0==o?(this.ui.barImg.x=this.xX,this.ui.loadingBar1.value=0,this.onTweenPosChange()):egret.Tween.get(this.ui.loadingBar1,{onChange:this.onTweenPosChange,onChangeObj:this}).to({value:o},300)},i.prototype.onTweenPosChange=function(){if(this.ui){if(0==this.ui.loadingBar1.value)return void(this.ui.barMaskAniGroup.x=110);var e=this.ui.loadingBar1.thumb;this.ui.barMaskAniGroup.x=e.x+e.width*this.ui.loadingBar1.value/this.ui.loadingBar1.maximum+50}},i.prototype.hideProgressBar=function(e){void 0===e&&(e=!1),this.ui&&(this.ui.progressGroup.visible=e)},i.prototype.updateView=function(){this.refresh()},i.prototype.hideProgressBarWhenCreateCharacter=function(){this.needHideProgressBarWhenCreateCharacter=!0},i.prototype.showProgressBarAfterCreateCharacter=function(){this.needHideProgressBarWhenCreateCharacter=!1,this.ui&&(this.ui.progressGroup.visible=!0,this.ui.titleImg.visible=!0)},i.prototype.refreshHandler=function(t){if(egret.Capabilities.runtimeType==egret.RuntimeType.WEB)window.location.reload();else if(e.Global.isWeChatXiaoChengXuBranch){var i=egret.getTimer(),n=i-this.tryReconnectTimestamp;if(n>2e3)if(this.tryReconnectTimestamp=i,this.tryReconnectCount++,this.tryReconnectCount<3){e.FundebugUtils.notify("MainLoading.tryReconnectCount","true"+this.tryReconnectCount),e.GameUtils.MSG_TIP("正在尝试重新加载游戏资源");var o=egret.setTimeout(function(t){egret.clearTimeout(o),e.Message.instance.reconnect()},this,500)}else e.FundebugUtils.notify("MainLoading.exitMiniProgram","true"),e.GameUtils.MSG_TIP("加载异常，请手动重启小程序"),setTimeout(function(){window.wx&&window.wx.exitMiniProgram({})},2e3)}},i}(e.BasePanel);e.MainLoadingPanel=t,__reflect(t.prototype,"foxgame.MainLoadingPanel",["foxgame.IMainLoading","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.isInit=!1,n.quality=1,n._itemData=i,n.skinName="skins.mapViewport.DropItemSkin",e.MapViewportGroupManager.instance.sceneView.DropNode.addChild(n),n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mItemSprite.scaleX=1.2,this.mItemSprite.scaleY=1.2,this.isInit=!0,this.refreshData(this._itemData)},i.prototype.refreshData=function(e){if(e){if(!this.isInit)return void(this._itemData=e);this.count=e.countNum,this.refreshItemId(e.itemid),this.visible=!0;var t=e.callback,i=e.oriPos;i.x-=this.width/2,i.y-=this.height/2;var n=e.dstPos;n.x-=this.width/2,n.y-=this.height/2,this.x=i.x,this.y=i.y,i.x==n.x&&i.y==n.y?egret.Tween.get(this).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).call(function(){t&&(t(),t=null)},this):egret.Tween.get(this).to({y:i.y+6},50,egret.Ease.backIn).to({y:i.y},50,egret.Ease.backIn).to({y:i.y+6},50,egret.Ease.backIn).to({y:i.y},50,egret.Ease.backIn).to({x:n.x,y:n.y},100).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).to({y:n.y+6},50,egret.Ease.backIn).to({y:n.y},50,egret.Ease.backIn).call(function(){t&&(t(),t=null)},this)}},i.prototype.refreshItemId=function(t){if(!this.itemId||this.itemId!=t){this.itemId=t;var i=e.JsonDataManager.instance.itemTemplate,n=i[this.itemId];this.refreshQuality(n.quality),this.mItemName.text=n.name,this.mItemSprite.source=n.icon,this.type=n.type,this.mStarSprite.source="starsprit_png",TweenMax.to(this.mStarSprite,1,{rotation:360,repeat:-1})}},i.prototype.refreshQuality=function(t){this.quality&&this.quality==t||(this.quality=t,this.mItemName.textColor=e.ColorUtils.instance.getColorByQuality(this.quality),6==this.quality?(this.mDropLight.source="drop_light_red_png",this.mDropLight.x=-18,this.mDropLight.y=-522,this.mDropLight.visible=!0):5==this.quality?(this.mDropLight.source="drop_light_yellow_png",this.mDropLight.x=-18,this.mDropLight.y=-274,this.mDropLight.visible=!0):this.mDropLight.visible=!1)},i.prototype.dispose=function(t){if(TweenMax.killTweensOf(this.mStarSprite),t){var n=this.parent.localToGlobal(this.x,this.y);e.FlyController.getInstance().flyToBag(n,this.itemId,this.count)}this.visible=!1,-1==i._pool.indexOf(this)&&i._pool.push(this)},i.addDropItem=function(e){var t=null;return this._pool.length>0?(t=this._pool.pop(),t.refreshData(e)):t=new i(e),t},i._pool=[],i}(eui.Component);e.DropItem=t,__reflect(t.prototype,"foxgame.DropItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=e.SceneType,i=function(i){function n(){var e=i.call(this)||this;return e.mStage=!1,e.lastMoveCheckMapPicChangeTime=0,e.mainMapPicArray=[],e.battleMapPicArray=[],e.skinName="skins.mapViewport.MapViewSkin",e.name="MapView",e}return __extends(n,i),Object.defineProperty(n.prototype,"mainTiledMap",{get:function(){return this._mainTiledMap},set:function(e){this._mainTiledMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"battleTitleMap",{get:function(){return this._battleTitleMap},set:function(e){this._battleTitleMap=e},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){this.mStage=!0},n.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.mButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.mMainGroup.width=e.Global.mainMapMaxX*e.Global.mainMapTileWidth,this.mMainGroup.height=e.Global.mainMapMaxY*e.Global.mainMapTileHeight,this.mButton.width=this.mMainGroup.width,this.mButton.height=this.mMainGroup.height;for(var t=0;t<e.Global.mainMapMaxY;t++)for(var n=0;n<e.Global.mainMapMaxX;n++){var o=new eui.Image;o.width=e.Global.mainMapTileWidth,o.height=e.Global.mainMapTileHeight,o.x=n*e.Global.mainMapTileWidth,o.y=t*e.Global.mainMapTileHeight,this.mMainGroup.addChild(o),this["mainBG_"+(t+1)+"_"+(n+1)]=o}this.mMainGroup.name="mMainGroup",this.mBattleGroup.name="mBattleGroup";for(var a=e.Global.mainMapMaxX*e.Global.mainMapMaxY,t=0;a>t;t++)this.mainMapPicArray.push(new e.MapPic);for(var s=e.Global.battleMapMaxX*e.Global.battleMapMaxY,t=0;s>t;t++)this.battleMapPicArray.push(new e.MapPic);for(var t=1;t<=e.Global.battleMapMaxX;++t)for(var n=1;n<=e.Global.battleMapMaxY;++n){var r=this["battleBG_"+n+"_"+t];r||(r=new eui.Image,this.mBattleGroup.addChild(r),this["battleBG_"+n+"_"+t]=r),r.x=(t-1)*e.Global.mainMapTileWidth,r.y=(n-1)*e.Global.mainMapTileHeight}},n.prototype.getStage=function(){return egret.MainContext.instance.stage},n.prototype.btnClick=function(t){var i=t.target;if(i)switch(i){case this.mButton:var n=this._mainTiledMap.SpaceToTiled(new egret.Point(t.localX,t.localY));e.MainSceneManager.instance.mainRole.MovePos(n)}},n.prototype.drawMainTile=function(){this.mainTiledMap.drawTile(),this.mainTiledMap.drawPo(),this.mMainGroup.addChild(this.mainTiledMap.lineScene),this.mMainGroup.addChild(this.mainTiledMap.pointScene)},n.prototype.drawBattleTile=function(){this.battleTitleMap.drawTile(),this.battleTitleMap.drawPo(),this.mBattleGroup.addChild(this.battleTitleMap.lineScene),this.mBattleGroup.addChild(this.battleTitleMap.pointScene)},n.prototype.clear=function(){this.mStage=!1,delete this.mainMapPicArray,this.mainMapPicArray=null,delete this.battleMapPicArray,this.battleMapPicArray=null},n.prototype.onUpdate=function(t){this.mStage&&(1==e.MainBottomControler.PageState?(this.mMainGroup.visible=!0,this.mBattleGroup.visible=!1,this.mMainGroup.touchChildren=!0,this.mBattleGroup.touchChildren=!1):2==e.MainBottomControler.PageState&&(this.mMainGroup.visible=!1,this.mBattleGroup.visible=!0,this.mMainGroup.touchChildren=!1,this.mBattleGroup.touchChildren=!0))},n.prototype.setShowHideMainBattleGroup=function(e,i){e==t.MainCity?this.mMainGroup.visible=i:e==t.Field?this.mBattleGroup.visible=i:console.error("unRecognize SceneType")},n.prototype.setBattleBG=function(t,i){var n=this;if(this.battleBgStr!=t){this.mapWidth=i.mapXGrid*e.Global.mainMapTileWidth,this.mapHeight=i.mapYGrid*e.Global.mainMapTileHeight;var o=""+this.battleBG.source;"mohu_jpg"==o?(this.battleBG.width=this.mapWidth,this.battleBG.height=this.mapHeight):this.battleBG.source="mohu_jpg",this.oldBattleBgStr=this.battleBgStr,this.oldMapVoObj=this.mapVoObj,RES.createGroup("preMap_"+t,[t+"_slt_jpg"]),App.getResourceUtils().loadGroup("preMap_"+t,function(){n.battleBG.source=t+"_slt_jpg",n.battleBG.width=n.mapWidth,n.battleBG.height=n.mapHeight,o=o.substring(0,o.indexOf("_slt_jpg")),""!=o&&RES.isGroupLoaded("preMap_"+o)&&e.GlobalUtil.destroyRes("preMap_"+o)},null,this,e.Global.LoadMapPreviewMoHuSuoLueTuPicPriority),this.battleBgStr=t,this.mapVoObj=i;var a=0,s=0;e.BattleScene.instance.actorList&&e.BattleScene.instance.actorList.length>0?(a=e.BattleScene.instance.actorList[0].x,s=e.BattleScene.instance.actorList[0].y):(a=e.Global.battleMapWidth/2,s=e.Global.battleMapHeight/2),e.CommonUtils.setBattleMapPic(a,s,this,t,i)}},n.prototype.onMoveMainCityMapPic=function(t){var i=egret.getTimer(),n=i-this.lastMoveCheckMapPicChangeTime;330>n||e.CommonUtils.getMainMapLoadOrder(t,this)},n.prototype.onMoveBattleMapPic=function(t,i){var n=egret.getTimer(),o=n-this.lastMoveCheckMapPicChangeTime;330>o||this.battleBgStr&&this.mapVoObj&&e.CommonUtils.setBattleMapPic(t,i,this,this.battleBgStr,this.mapVoObj)},n.prototype.setBattleMapPicVisible=function(e){for(var t=this.battleMapPicArray.length,i=0;t>i;++i){var n=this.battleMapPicArray[i];n&&n.image&&(n.image.visible=e)}},n.prototype.setBattleVis=function(){if(0!=this.mStage){var t=e.LoadMapPicManager.instance.isResLoadeds(e.MapViewportGroupManager.instance.mapView.battleBgStr,e.Global.battleMapMaxX);t?this.battleBG.visible=!1:this.battleBG.visible=!0}},n.prototype.setMainBgVis=function(){0==this.mStage||0==this.mButton.visible},n.prototype.getMainMapMohuSuoLueTu=function(){var t=this;RES.createGroup("preMap_MainScene",["main_scene_1_slt_jpg"]),App.getResourceUtils().loadGroup("preMap_MainScene",function(){t.mButton.source="main_scene_1_slt_jpg"},null,this,e.Global.LoadMapPreviewMoHuSuoLueTuPicPriority)},n.prototype.getOldBattleBgStr=function(){return this.oldBattleBgStr},n.prototype.getOldMapVoObj=function(){return this.oldMapVoObj},Object.defineProperty(n.prototype,"width",{get:function(){return this.mapWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.mapHeight},enumerable:!0,configurable:!0}),n}(eui.Component);e.MapView=i,__reflect(i.prototype,"foxgame.MapView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function o(){var e=t.call(this)||this;return e.mStage=!1,e.npcList={},e.safeList_used=[],e.safeList_free=[],e.skinName="skins.mapViewport.SceneViewSkin",e.name="SceneView",e}return __extends(o,t),o.prototype.childrenCreated=function(){this.mStage=!0,this.MainRoot.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.MainRoot.width=e.Global.mainMapMaxX*e.Global.mainMapTileWidth,this.MainRoot.height=e.Global.mainMapMaxY*e.Global.mainMapTileHeight,this.MainScenePeopleNode=new egret.DisplayObjectContainer,this.playGroup.addChild(this.MainScenePeopleNode),this.MSceneSkillNode=new egret.DisplayObjectContainer,this.playGroup.addChild(this.MSceneSkillNode),this.playGroup.name="playerGroup",this.MainScenePeopleNode.name="MainScenePeopleNode",this.MSceneSkillNode.name="MSceneSkillNode",this.DropNode=new egret.DisplayObjectContainer,this.BattleRoot.addChild(this.DropNode),this.DropNode.name="DropNode",this.SkillCasterNode=new egret.DisplayObjectContainer,this.BattleRoot.addChild(this.SkillCasterNode),this.SkillCasterNode.name="SkillCasterNode",this.BattleUnitNode=new egret.DisplayObjectContainer,this.BattleRoot.addChild(this.BattleUnitNode),this.BattleUnitNode.name="BattleUnitNode",this.SkillNode=new egret.DisplayObjectContainer,this.BattleRoot.addChild(this.SkillNode),this.SkillNode.name="SkillNode",this.uiTextNode=new egret.DisplayObjectContainer,this.BattleRoot.addChild(this.uiTextNode),this.uiTextNode.name="uiTextNode"},o.prototype.createNpc=function(){for(var t=this.npcGroup,n=this.npcNameGroup,o=e.JsonDataManager.instance.mainSceneNpcTemplate,a=null,s=null,r=0,l=0;l<o.length;l++){var h=o[l];if(1==h.type||2==h.type){var c=new i(h,t,n);this.npcList[h.status]=this.npcList[h.status]||[],this.npcList[h.status].push(c)}else{var u=h.point;s&&this.createSafeLine(s,u,h.nameHeight),s=u,a||(a=u,r=h.nameHeight)}}a&&s&&r&&this.createSafeLine(s,a,r)},o.prototype.createSafeLine=function(t,i,n){if(!(2>=n)){var o=n-1,a=(i[0]-t[0])/o,s=(i[1]-t[1])/o;t[0],t[1];for(o-=1;o>=0;o--){var r=null;this.safeList_free.length>0?r=this.safeList_free.pop():(r=new eui.Group,this.npcGroup.addChild(r)),r.x=t[0]+a*o,r.y=t[1]+s*o;var l=new e.FoxAni(r);l.setResGroupLoadPriority(e.Global.LoadModelActionAniMainSceneResPriority),l.play("anquanlineaniNpc","anquanlineaniNpc",-1),r.ani=l,this.safeList_used.push(r)}}},o.prototype.clearSafeLine=function(){for(var e=this.safeList_used.pop();null!=e;)e.ani&&(e.ani.dispose(),delete e.ani),this.safeList_free.push(e),e=this.safeList_used.pop()},o.prototype.loadAndShowNpc=function(){for(var e in this.npcList)for(var t in this.npcList[e]){var i=this.npcList[e][t];i.showModel()}},o.prototype.hideAndUnloadNpc=function(){for(var e in this.npcList)for(var t in this.npcList[e]){var i=this.npcList[e][t];i.hideModel()}},o.prototype.setMainScenePeopleIndex=function(){e.MainBottomControler.PageState==e.SceneType.MainCity&&this.MainScenePeopleNode.$children.sort(this.sortMainScenePeople)},o.prototype.sortMainScenePeople=function(e,t){return e.y>t.y?1:e.y<t.y?-1:0},o.prototype.btnClick=function(t){try{var i=t.localX,n=t.localY;if(t.target!=this.MainRoot)if(t.target.parent&&t.target.parent.parent==this.MainRoot)i=i+t.target.x+t.target.parent.x,n=n+t.target.y+t.target.parent.y;else{if(!t.target.parent||t.target.parent!=this.MainRoot)return;
i+=t.target.x,n+=t.target.y}if(!e.MainSceneManager.instance.mainRole)return;var o=e.MapViewportGroupManager.instance.mapView.mainTiledMap.SpaceToTiled(new egret.Point(i,n));e.MainSceneManager.instance.mainRole.MovePos(o),null!=e.MainSceneManager.instance.mainPetRole&&e.MainSceneManager.instance.mainPetRole.delayMovePos(o);var a=e.MapViewportGroupManager.instance.mapView.mainTiledMap.TiledToSpace(o),s=e.MainSceneManager.instance.mDestMarkNode,r=e.MainSceneManager.instance.mDestMark;null!=s?(s.x=a.x,s.y=a.y,s.visible=!0,r.play("anim_click")):(e.MainSceneManager.instance.mDestMarkNode=new egret.DisplayObjectContainer,this.MainScenePeopleNode.addChildAt(e.MainSceneManager.instance.mDestMarkNode,0),e.MainSceneManager.instance.mDestMark=new e.FoxAni(e.MainSceneManager.instance.mDestMarkNode),e.MainSceneManager.instance.mDestMark.play("anim_click")),e.Message.instance.send(e.MsgCMD.MAINCITY_CLICK_MAP,this)}catch(t){Log.trace("exception: "+t.toString()),console.error(t)}},o.prototype.clear=function(){this.mStage=!1},o.prototype.switchPageShowHideType=function(t){this.mStage&&(1==e.MainBottomControler.PageState?(this.MainRoot.visible=!0,this.BattleRoot.visible=!1,this.MainRoot.touchChildren=!0,this.BattleRoot.touchChildren=!1,this.refreshName()):2==e.MainBottomControler.PageState&&(this.MainRoot.visible=!1,this.BattleRoot.visible=!0,this.MainRoot.touchChildren=!1,this.BattleRoot.touchChildren=!0))},o.prototype.onUpdate=function(t){this.mStage&&(1==e.MainBottomControler.PageState||2==e.MainBottomControler.PageState)},o.prototype.showHideMainOrBattleSceneObjects=function(t){this.mStage&&(1==e.MainBottomControler.PageState?this.MainRoot.visible=t:2==e.MainBottomControler.PageState&&(this.BattleRoot.visible=t))},o.prototype.DiYiChengZhu=function(e){e.target==this.diyichengzhuBtn},o.prototype.DiYiZhanShi=function(){},o.prototype.DiYiFaShi=function(){},o.prototype.DiYiDaoShi=function(){},o.prototype.ShaChengChengZhu=function(){},o.prototype.YaJieQiuTu=function(){},o.prototype.HunLuanShenYuan=function(){},o.prototype.ZhiBaTianXia=function(){},o.prototype.ChuanQiKuangChang=function(){},o.prototype.JingJiChang=function(){},o.prototype.KuaFuShiZhe=function(){},o.prototype.refreshRank=function(t){var i=e.RankController.getInstance().getPlayerListByType(t);if(null!=i){var o=i[0];if(null!=o)if(t==e.RankType.ZHANSHENBANG){var a=o.getName();this.setNpcNameByStatus(n.DIYIZHANSHI,a)}else if(t==e.RankType.FASHENGBANG){var a=o.getName();this.setNpcNameByStatus(n.DIYIFASHI,a)}else if(t==e.RankType.DAOZUNBANG){var a=o.getName();this.setNpcNameByStatus(n.DIYIDAOSHI,a)}}},o.prototype.refreshName=function(){var t=e.MainLoadingController.instance.getmodel()._unionsiege;this.setNpcNameByStatus(n.SHACHENGCHENGZHU,t);var i=e.MainLoadingController.instance.getmodel()._csUnionSiege;this.setNpcNameByStatus(n.DIYICHENGZHU,i)},o.prototype.setNpcNameByStatus=function(e,t){if(this.npcList[e])for(var i=0;i<this.npcList[e].length;i++)this.npcList[e][i].refreshName(t)},o}(eui.Component);e.SceneView=t,__reflect(t.prototype,"foxgame.SceneView");var i=function(){function t(e,t,i){this.data=e,this.npcParent=t,this.container=new eui.Group,this.container.width=null,this.container.height=null,this.container.x=this.data.point[0],this.container.y=this.data.point[1],i.addChild(this.container);var n=new eui.Label;if(n.size=20,n.horizontalCenter=0,n.y=-e.nameHeight,this.container.addChild(n),this.name=n,this.data.name&&(n.text=this.data.name),this.data.title){var o=new eui.Image;o.source=this.data.title+"_png",o.horizontalCenter=0,o.y=-e.titleHeight,this.container.addChild(o),this.title=o}}return t.prototype.showModel=function(){if(this.data&&this.npcParent){var t=this.data;if(1==t.type){var i=new eui.Group;i.x=t.point[0]-40.5,i.y=t.point[1]-29;var n=new eui.Image;if(n.source="u_shadow2_png",i.addChild(n),this.npcParent.addChild(i),!this.ani){if(!this.aniGroup){var o=new eui.Group;o.x=t.point[0]+t.offsetX,o.y=t.point[1]+t.offsetY,this.npcParent.addChild(o),this.aniGroup=o}var a=new e.FoxAni(this.aniGroup);a.setResGroupLoadPriority(e.Global.LoadModelActionAniMainSceneResPriority),a.play(t.source,t.source,-1),this.ani=a}}else if(2==t.type){if(!this.img){var s=new eui.Image;s.x=t.point[0]+t.offsetX,s.y=t.point[1]+t.offsetY,this.npcParent.addChild(s),this.img=s}this.img.source=t.source+"_png"}}},t.prototype.hideModel=function(){if(this.data&&this.npcParent){var t=this.data;1==t.type?this.ani&&(this.ani.clear(),this.ani=null):2==t.type&&this.img&&(this.img.source="",e.GlobalUtil.destroyRes(t.source))}},t.prototype.refreshName=function(e){this.name&&(this.name.text=e)},t}();__reflect(i.prototype,"MainSceneNpcGroup");var n;!function(e){e[e.DIYICHENGZHU=1]="DIYICHENGZHU",e[e.SHACHENGCHENGZHU=2]="SHACHENGCHENGZHU",e[e.DIYIZHANSHI=3]="DIYIZHANSHI",e[e.DIYIFASHI=4]="DIYIFASHI",e[e.DIYIDAOSHI=5]="DIYIDAOSHI"}(n||(n={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panleList=[],this.model=new e.MarqueeModel,this.panel=new e.MarqueePanel(this.model),egret.startTick(this.tickHandler,this)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.MARQUEE_PUSH:this.dispatcherMsg(i)}},t.prototype.tickHandler=function(e){var t=this.model;return t&&(Math.floor((e-t.autoSendMsgLastTime)/1e3)==t.autoSendTimeDis&&(t.autoSendMsgLastTime=e,this.autoSendMsg(t.autoSendMarqueeMsgAry[0])),Math.floor((e-t.autoSendMsgLastTime2)/1e3)==t.autoSendTimeDis2&&(t.autoSendMsgLastTime2=e,this.autoSendMsg(t.autoSendMarqueeMsgAry[1]))),!0},t.prototype.dispatcherMsg=function(t){var i=e.JsonDataManager.instance.noticeMarquee,n=t.getType();if(i&&i[n])for(var o=i&&i[n].pos.length||0,a=0;o>a;a++){var s=i[n].pos[a];1==s?(this.setMsgAry(t),this.panel.show(),this.panel.y=.25*(e.Global.stageHeight-this.panel.height)):2==s?e.NewChatControler.getInstance().createNoticeMar(t):3==s&&this.addMsgToMainView(t)}},t.prototype.autoSendMsg=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPPushMarquee");i.setParams([]),i.setType(t),e.Message.instance.send(e.Code.MARQUEE_PUSH,i)},t.prototype.addMsgToMainView=function(t){e.MainControler.instance.addMsgToGroup(this.createLabel(t))},t.prototype.createLabel=function(t){var i=new eui.Label;i.size=18,i.lineSpacing=8;var n=e.LanguageUtils.instance.getValue("XITONG")+this.createLableText(t);return i.textFlow=(new egret.HtmlTextParser).parser(n),i.touchEnabled=!0,i},t.prototype.linkHandler=function(t){var i,n=e.PlayerService.instance.playerInfo.getLevel();if(-1!=t.text.indexOf("playerId")){var o=Number(t.text.split("_")[1]);e.OtherCharacterController.getInstance().showOtherCharacterPanel(o)}else if(-1!=t.text.indexOf("itemId")){var o=Number(t.text.split("_")[1]),a=e.JsonDataManager.instance.itemTemplate[o];a.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(o):e.TipsController.getInstance().showItemTips(o)}else if(-1!=t.text.indexOf("turn_xunbao"))e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.SEARCHTREASURE);else if(-1!=t.text.indexOf("turn_chibangshengjie")){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHIBANG),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHIBANG),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WINGOPEN",n));e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.WING_SYSTEM)}else if(-1!=t.text.indexOf("turn_zhuangbeishengxing")){if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEISHENGXING),0==i)return n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING),void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHUANGBEISHENGXING",n));e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.EQUIP_UP_STAR)}else if(-1!=t.text.indexOf("turn_viplibao")){if(e.PlayerService.instance.playerInfo.getVipLevel()<16)e.LegendaryEquipController.getInstance().showPanel();else if(e.PlayerService.instance.playerInfo.getVipLevel()>=16){var s=e.CreateNewVipController.instance.isReceiveAward(16);s?e.CreateNewVipController.instance.showPanel(e.PlayerService.instance.playerInfo.getVipLevel()):e.CreateNewVipController.instance.showPanel(16)}}else if(-1!=t.text.indexOf("turn_shouchong"))e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.FIRST_RECHARGE);else if("gotoWorldBoss"==t.text){if(e.WorldBossController.getInstance().isBoss)return;e.WorldBossController.getInstance().requestEnter(),e.NewChatControler.getInstance().closeChatPanel()}else"turn_linghongbao"==t.text?e.RedPacketController.getInstance().showPanel():"turn_qianghongbao"==t.text?e.RedPacketController.getInstance().showPanel():e.NewChatControler.getInstance().getPanelIsShow()||e.NewChatControler.getInstance().showPanel()},t.prototype.setMsgAry=function(e){this.model.setMsgAry(this.createLableText(e))},t.prototype.createLableText=function(t){var i=e.JsonDataManager.instance.noticeMarquee,n=e.JsonDataManager.instance.itemTemplate,o=t.getType(),a=0,s=this.dataHandler(t),r=i[o].text;if(1==o){var l=n[s[2]].quality;a=e.ColorUtils.instance.getColorByQuality(l),s.splice(2,1,a.toString(16),s[2])}else if(i[o].text.indexOf("itemId"))for(var h=0;h<s.length;h++)if(n[s[h]]&&n[s[h]].quality&&n[s[h]].name==s[h+1]){var l=n[s[h]].quality;a=e.ColorUtils.instance.getColorByQuality(l),s.splice(h,1,a.toString(16),s[h]);break}if(o>56&&64>o||70==o){var l=n[s[5]].quality;a=e.ColorUtils.instance.getColorByQuality(l),s.splice(5,1,a.toString(16),s[5])}for(var h=0;h<s.length;h++)r=r.replace("{"+h+"}",s[h]);return r},t.prototype.dataHandler=function(e){for(var t=[],i=0;i<e.getParams().length;i++){var n=e.getParams()[i];n.getIntParam()&&t.push(n.getIntParam()),n.getStrParam()&&t.push(n.getStrParam())}return t},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t}();e.MarqueeController=t,__reflect(t.prototype,"foxgame.MarqueeController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.tweentime=6e3,this.msgAry=[],this.lastTime=0,this.isTweening=!1,this.timeToClose=2,this.autoSendMarqueeMsgAry=[12,68],this.autoSendMsgLastTime=0,this.autoSendMsgLastTime2=0,this.autoSendTimeDis=900,this.autoSendTimeDis2=1500,this.observerList=[],this.speed=Number(e.GlobalConfig.instance.getValue("PAOMADENGSPEED"))}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},t.prototype.setMsgAry=function(e){this.msgAry.push(e),this.updateView()},t}();e.MarqueeModel=t,__reflect(t.prototype,"foxgame.MarqueeModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/marquee/MarqueeMainSkin.exml")||this;return n.isMask=!1,n.setIsShowBackBtn(!1),n.setIsShowTween(!1),n.setEffect(!1),n.setRegisterTick(!0),n.layer=LayerType.TOPLAYER,n.model=i,n.model.autoSendMsgLastTime=egret.getTimer(),n.model.autoSendMsgLastTime2=egret.getTimer(),n.touchEnabled=!1,n.touchChildren=!1,n.isCenter=!0,e.GamePlatform.isQQdating?n.isCenter=!0:n.isCenter=!1,n.isCallHideSceneObjectsWhenClose=!1,n}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.refresh=function(){0!=this.model.msgAry.length&&(this.model.lastTime=egret.getTimer())},i.prototype.createTextFlow=function(e){void 0!=e[0]&&(this.ui.bubble.textFlow=(new egret.HtmlTextParser).parser(e[0]))},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.bubble.mask=this.ui.marqueeBg,this.initState()},i.prototype.linkHandler=function(t){if(-1!=t.text.indexOf("playerId")){var i=Number(t.text.split("_")[1]);e.OtherCharacterController.getInstance().showOtherCharacterPanel(i)}else if(-1!=t.text.indexOf("itemId")){var i=Number(t.text.split("_")[1]),n=e.JsonDataManager.instance.itemTemplate[i];e.TipsController.getInstance().showItemTips(n.id)}else-1!=t.text.indexOf("viewId")&&(e.PlayerService.instance.playerInfo.getLevel()<30?e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("BOSSKAIFANG")):(e.NewBossMainControler.getIntance().showPanel(),e.Message.instance.send(e.MsgCMD.MODULE_SHOW,e.WindowName.BOSS_MAIN)))},i.prototype.showHook=function(){this.model.lastTime=egret.getTimer()},i.prototype.tickHook=function(e){this.tweenItem(e)},i.prototype.tweenItem=function(e){if(0==this.model.msgAry.length&&this.getIsShow())return void this.close();this.model.isTweening||this.createTextFlow(this.model.msgAry);var t=e-this.model.lastTime;this.model.lastTime=e;var i=this.ui.bubble;t>0&&(i.x-=this.model.speed*t,this.model.isTweening=!0),i.x+i.width<=0&&(this.initState(),this.model.msgAry.shift(),this.model.isTweening=!1)},i.prototype.initState=function(){var e=this.width;this.ui.bubble.x=e},i}(e.BasePanel);e.MarqueePanel=t,__reflect(t.prototype,"foxgame.MarqueePanel",["foxgame.IMarquee","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MarqueeVO=t,__reflect(t.prototype,"foxgame.MarqueeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.MedalModel,this.panel=new e.MedalPanel(this.model),this.totalAttrPanel=new e.MedalTotalAttrPanel,this.upQualityPanel=new e.MedalUpQualityPanel(this.model),this.upStarPanel=new e.MedalUpStarPanel(this.model),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this)}return t.prototype.showPanel=function(){this.panel.show(),e.CharacterController.getInstance().closePanel()},t.prototype.showUpStarPanel=function(e){this.upStarPanel.showPanel(e)},t.prototype.showUpQualityPanel=function(e){this.upQualityPanel.showPanel(e)},t.prototype.showTotalAttrPanel=function(){this.totalAttrPanel.show()},t.prototype.updateUpStarModelMedalData=function(){if(this.upStarPanel.getIsShow()){var e=this.findNeedUpdateMedalData();this.model.updateUpStarMedalData(e)}},t.prototype.updateUpQualityModelMedalData=function(){if(this.upQualityPanel.getIsShow()){var e=this.findNeedUpdateMedalData();this.model.updateUpQualityMedalData(e)}},t.prototype.findNeedUpdateMedalData=function(){for(var e=t.getInstance().getMedalMsgAry(),i=e.length,n=0;i>n;n++){var o=e[n];if(o.vo.id==this.model.moduleId)return o}},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.TITLE_SYNC_S:this.model.setMedalMsgAry(i),this.updateUpStarModelMedalData(),this.updateUpQualityModelMedalData(),e.BattleScene.instance.changeSelfActorTitleImg(i);break;case e.MsgCMD.REFRESH_PLAYERDATA:if(!this.panel.getIsShow())return;this.panel.refreshRoleData(),this.model.setMedalMsgAry(this.model.lastServerData);break;case e.Code.TITLE_QUALITY_UP_S:i.getResult()?e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XUNZHANGTIPINCHENGGONG")):(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XUNZHANGTIPINSHIBAI")),this.upQualityPanel.updateUpQualityView()),e.MainBottomControler.instance.refreshCharacterIconOperate();break;case e.Code.TITLE_ACTIVE_S:i.getResult()&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("XUNZHANGSHENGJICHENGGONG"))}},t.prototype.checkMedalRedPoint=function(t){void 0===t&&(t=!1);var i=this.model.medalMsgAry;if(void 0==i)return!1;if(0==i.length)return!1;for(var n=i.length,o=e.JsonDataManager.instance.medalTitleQuality,a=e.JsonDataManager.instance.itemTemplate,s=!1,r=0;n>r;r++){var l=i[r],h=(l.vo.id,l.qualityId),c=e.JsonDataManager.instance.medalTitleLevelByModelIdAndLevel[l.vo.id+"_"+l.level],u=e.BagController.getInstance().getCountByItemId(c.cost.id);if(u>=c.cost.value){if(c.level==this.model.medalMaxLevel)l.isShowUpStarRedPoint=!1;else if(l.isShowUpStarRedPoint=!0,s=!0,0==t)break}else l.isShowUpStarRedPoint=!1;if(0!=u&&(l.isActive=!0),void 0!=h){var p=o[h+1];if(!p){l.isShowUpQualityRedPoint=!1;continue}var g=o[h],d=g.cost[0],f=Number(d[1]),m=e.BagController.getInstance().getCountByItemId(f),y=g.cost[1],I=Number(y[1]),v=y[2],_=(a[I],e.PlayerService.instance.playerInfo.getCoin());if(m>=Number(d[2])&&_>=Number(v)){if(l.isShowUpQualityRedPoint=!0,s=!0,0==t)break}else l.isShowUpQualityRedPoint=!1}}return s?!0:!1},t.prototype.getMedalMsgAry=function(){return this.model.medalMsgAry},t.prototype.getActiveTitleLength=function(){return this.model.activeTitleLength},t.prototype.getRoleData=function(){return this.model.roleData},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t}();e.MedalController=t,__reflect(t.prototype,"foxgame.MedalController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.isActive=!1}return e}();e.MedalData=t,__reflect(t.prototype,"foxgame.MedalData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.offsetY=16,e.skinName="medalItemSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.checkBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMedalMsg,this),this.checkBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMedalMsg,this),this.medalUpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMedalUpQuality,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data;switch(this.medalIcon.source="item"+i.vo.icon2+"_png",this.isPlayEffect(i.vo),this.medalData=i,i.isActive){case!1:this.minGradeText.visible=!0,this.minGradeText.text=e.LanguageUtils.instance.getValue("XUNZHANGPINGFEN")+":"+i.vo.minGrade,this.maxGradeText.visible=!0,this.maxGradeText.text=e.LanguageUtils.instance.getValue("ZUIGAOPINGFEN")+":"+i.vo.maxGrade,this.desImg.visible=!0,this.gradeText.visible=!1,this.medalUpBtn.visible=!1,this.checkBtn.visible=!1,this.checkBtn1.visible=!0,this.getWayText.visible=!0,this.getWayText.text=i.vo.des,this.levelUpRedPoint.visible=!1,this.qualityRedPoint.visible=!1;break;case!0:0!=i.level?this.medalUpBtn.enabled=!0:this.medalUpBtn.enabled=!1,this.iconBg.y=this.iconRef.y,this.medalIcon.y=this.iconRef.y+this.offsetY,this.gradeText.visible=!0,this.desImg.visible=!1;var n=void 0;n=0==i.grade?i.vo.minGrade:i.grade,this.gradeText.text=e.LanguageUtils.instance.getValue("XUNZHANGPINGFEN")+":"+3*n,this.minGradeText.visible=!1,this.maxGradeText.visible=!1,this.medalUpBtn.visible=!0,this.checkBtn.visible=!0,this.levelUpRedPoint.visible=i.isShowUpStarRedPoint,void 0==i.isShowUpQualityRedPoint||0==i.isShowUpQualityRedPoint?this.qualityRedPoint.visible=!1:this.qualityRedPoint.visible=!0,this.checkBtn1.visible=!1,this.getWayText.visible=!1}},i.prototype.isPlayEffect=function(t){t.animation?(this.medalImg.source="",this.aniGroup.visible=!0,this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.titleAni||(this.titleAni=new e.FoxAni(this.aniGroup),this.titleAni.play(t.animation),this.lastAni=t.animation),this.lastAni&&t.animation!=this.lastAni&&(this.titleAni.clear(),this.titleAni=null,this.titleAni=new e.FoxAni(this.aniGroup),this.titleAni.play(t.animation),this.lastAni=t.animation)):t.icon1?(this.medalImg.source=t.icon1+"_png",this.aniGroup.visible=!1,this.titleAni&&(this.titleAni.clear(),this.titleAni=null)):this.aniGroup.visible=!1},i.prototype.destoryAni=function(){this.titleAni&&(this.titleAni.clear(),this.titleAni=null)},i.prototype.showMedalMsg=function(){e.MedalController.getInstance().showUpStarPanel(this.medalData)},i.prototype.showMedalUpQuality=function(){e.MedalController.getInstance().showUpQualityPanel(this.medalData)},i}(eui.ItemRenderer);e.MedalItem=t,__reflect(t.prototype,"foxgame.MedalItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MedalLevelVO=t,__reflect(t.prototype,"foxgame.MedalLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.CHEXIAOSHIYONG=1]="CHEXIAOSHIYONG",e[e.SHIYONGCHENGHAO=2]="SHIYONGCHENGHAO",e[e.YIBEISHIYONG=3]="YIBEISHIYONG",e[e.BUKESHIYONG=4]="BUKESHIYONG"}(t=e.TitlePriority||(e.TitlePriority={}));var i=function(){function i(){this.offsetY=8,this.cutOffRuleX=30,this.btnSelectIndex=0,this.medalMaxLevel=45,this.observerList=[],this.collection=new eui.ArrayCollection,this.titlecollection=new eui.ArrayCollection}return i.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},i.prototype.updataUpQualityView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateUpQualityView()},i.prototype.updataUpStarView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateUpStarView()},i.prototype.updateUpQualityMedalData=function(e){this.medalData=e,this.moduleId=e.vo.id,this.updataUpQualityView()},i.prototype.updateUpStarMedalData=function(e){this.medalData=e,this.moduleId=e.vo.id,this.updataUpStarView()},i.prototype.setTitleMsgObj=function(e){for(var i=e.getTitleInfo(),n=this.titleMsgObj={},o=i.getUseTitleInfo(),a=this.medalMsgAry.length,s=0;a>s;s++){for(var r=this.medalMsgAry[s],l=0;l<o.length;l++){var h=o[l],c=h.getRoleId(),u=h.getTitleId();r.vo.id!=u||(r.roleId=c,r.priority=t.CHEXIAOSHIYONG)}s<this.activeTitleLength?r.priority=t.SHIYONGCHENGHAO:r.priority=4}for(var p=this.roleData.roleId,g=i.getActiveInfo().length,d=this.medalMsgAry.slice(0,g),s=0;g>s;s++){var f=d[s];this.roleData.profession;f.roleId==p?f.priority=t.CHEXIAOSHIYONG:f.roleId?0==f.vo.prof?f.priority=t.YIBEISHIYONG:f.priority=t.BUKESHIYONG:f.isActive?f.priority=t.SHIYONGCHENGHAO:f.priority=t.BUKESHIYONG}d.sort(function(e,t){return e.priority-t.priority}),n[p]=d},i.prototype.setMedalMsgAry=function(t){this.lastServerData=t;var i=t.getTitleInfo(),n=(this.medalMsgAry=[],i.getActiveInfo()),o=e.JsonDataManager.instance.medalTitle,a=o.length,s=n.length;this.activeTitleLength=s;for(var r=[],l=[],h=0;a>h;h++){var c=new e.MedalData,u=o[h];c.vo=u;for(var p=0;s>p;p++){var g=n[p],d=g.getTitleId();if(d==u.id){c.grade=g.getGrade(),c.level=g.getLevelId(),c.isActive=!0,c.qualityId=g.getQualityId(),r.push(c);break}}-1==r.indexOf(c)&&(c.grade=0,c.level=0,l.push(c)),c.isShowUpStarRedPoint=!1,c.isShowUpQualityRedPoint=!1}this.medalMsgAry=r.concat(l),this.sortMedalMsgAry(),this.updateMedalView()},i.prototype.sortMedalMsgAry=function(){for(var t=this.medalMsgAry.length,i=[],n=[],o=[],a=0;t>a;a++){var s=this.medalMsgAry[a];if(a<this.activeTitleLength)i.push(s);else{var r=e.JsonDataManager.instance.medalTitleLevelByModelIdAndLevel[s.vo.id+"_"+s.level],l=e.BagController.getInstance().getCountByItemId(r.cost.id);l>0?(n.push(s),s.medalNum=l,s.isActive=!1):o.push(s)}}i.sort(function(e,t){return t.level-e.level}),n.sort(function(e,t){return t.medalNum-e.medalNum}),this.medalMsgAry=i.concat(n,o),this.activeTitleLength=i.length+n.length},i.prototype.updateMedalView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateMedalView()},i}();e.MedalModel=i,__reflect(i.prototype,"foxgame.MedalModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.WEIHUOQU=0]="WEIHUOQU",e[e.YIHUOQU=1]="YIHUOQU"}(t=e.TitleType||(e.TitleType={}));var i;!function(e){e[e.MEDAL=0]="MEDAL",e[e.TITLE=1]="TITLE"}(i=e.BtnIndex||(e.BtnIndex={}));var n=function(t){function n(e){var i=t.call(this,"resource/skins/medal/medalMainSkin.exml")||this;return i.model=e,i.isMask=!1,i.adaptionType=1,i.isMaskdown=!0,i}return __extends(n,t),n.prototype.updateUpQualityView=function(){},n.prototype.updateMedalView=function(){this.refresh()},n.prototype.updateUpStarView=function(){},n.prototype.refresh=function(){this.ui.currency.refresh(),0!=this.model.medalMsgAry.length&&this.getIsInit()&&this.updateList(),1==this.ui.titleGroup.visible&&this.updateTitleList()},n.prototype.bagItemChanged=function(){this.model.sortMedalMsgAry(),this.updateMedalView()},n.prototype.updateList=function(){e.MedalController.getInstance().checkMedalRedPoint(!0),this.model.collection.replaceAll(this.model.medalMsgAry)},n.prototype.initHook=function(){this.ui.titleGroup.visible=!1,e.BagController.getInstance().registerObserver(this),this.model.registerObserver(this),this.ui.scroller.scrollPolicyH="ScrollPolicy.OFF",this.ui.scroller.horizontalScrollBar.autoVisibility=!1,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.ui.titleScroller.scrollPolicyH="ScrollPolicy.OFF",this.ui.titleScroller.horizontalScrollBar.autoVisibility=!1,this.ui.titleScroller.verticalScrollBar.autoVisibility=!1,this.ui.totalAttrText.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.titleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.medalBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.totalAttrText.textFlow=(new egret.HtmlTextParser).parse(e.LanguageUtils.instance.getValue("XUNZHANGZONGSHUXING")),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.ui.headBar.setFigthGradeShow(!1);var t=new eui.VerticalLayout;t.gap=Number(this.model.offsetY);var i=this.ui.list;this.model.collection.source=[],i.dataProvider=this.model.collection,i.itemRenderer=e.MedalItem,i.layout=t;var n=new eui.VerticalLayout;n.gap=Number(this.model.offsetY);var o=this.ui.titleList;this.model.titlecollection.source=[],o.dataProvider=this.model.titlecollection,o.itemRenderer=e.TitleItem,o.layout=n,this.doScreenAdaptation()},n.prototype.setRoleData=function(e){this.model.roleData=e,this.updateTitleList()},n.prototype.refreshRoleData=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)},n.prototype.initParams=function(){this.updateMedalView(),this.ui.titleGroup.visible=!1,this.ui.medalGroup.visible=!0,this.model.btnSelectIndex=i.MEDAL,this.model.roleData=null,this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList())},n.prototype.btnClick=function(t){switch(t.target){case this.ui.helpBtn:e.HelpController.getInstance().showPanel("MEDALFORHELP");break;case this.ui.titleBtn:this.model.btnSelectIndex=i.TITLE,this.changeGroup();break;case this.ui.medalBtn:this.model.btnSelectIndex=i.MEDAL,this.changeGroup();break;case this.ui.totalAttrText:e.MedalController.getInstance().showTotalAttrPanel()}},n.prototype.changeGroup=function(){switch(this.model.btnSelectIndex){case i.MEDAL:if(1==this.ui.medalGroup.visible)return;this.ui.medalGroup.visible=!0,this.ui.titleGroup.visible=!1;break;case i.TITLE:if(1==this.ui.titleGroup.visible)return;this.ui.medalGroup.visible=!1,this.ui.titleGroup.visible=!0,this.updateTitleList()}},n.prototype.updateTitleList=function(){this.model.setTitleMsgObj(this.model.lastServerData);var e=this.model.titleMsgObj[this.model.roleData.roleId];this.model.titlecollection.replaceAll(e)},n.prototype.readyDestroy=function(){this.ui.list.dataProvider=null,this.ui.titleList.dataProvider=null,this.destoryAnis()},n.prototype.closeHook=function(){e.CharacterController.getInstance().showPanel(0,0,!0,!0)},n.prototype.destoryAnis=function(){if(1==this.ui.titleGroup.visible)for(var t=this.ui.titleList.numChildren,i=0;t>i;i++){var n=this.ui.titleList[i];n instanceof e.TitleItem&&n.destoryAni()}else for(var t=this.ui.list.numChildren,i=0;t>i;i++){var n=this.ui.list[i];n instanceof e.MedalItem&&n.destoryAni()}},n}(e.BasePanel);e.MedalPanel=n,__reflect(n.prototype,"foxgame.MedalPanel",["foxgame.IMedal","foxgame.IObserver","foxgame.IBag"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="medalStarItemSkin",t}return __extends(t,e),t.prototype.lightStar=function(){this.lightImg.visible=!0},t.prototype.offLightStar=function(){this.lightImg.visible=!1},t}(eui.Component);e.MedalStarItem=t,__reflect(t.prototype,"foxgame.MedalStarItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MedalTitleQualityVO=t,__reflect(t.prototype,"foxgame.MedalTitleQualityVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/medal/medalTotalSkin.exml")||this;return e.isMask=!0,e}return __extends(i,t),i.prototype.initHook=function(){this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.tou.visible=!1},i.prototype.refresh=function(){for(var t=e.MedalController.getInstance().getMedalMsgAry(),i=t.length,n=[],o=[],a=0;i>a;a++){var s=t[a],r=e.JsonDataManager.instance.medalTitleLevelByModelIdAndLevel[s.vo.id+"_"+s.level],l=this.calcAdditionGrade(s,r);if(0!=l.length)for(var h=r.attrTypeList.length,c=0;h>c;c++){var u=r.attrTypeList[c],p=l[c];if(-1==n.indexOf(u))n.push(u),o.push(p);else{var g=n.indexOf(u);o[g]+=p}}}o=this.sortAttrs(n,o)[1],n=this.sortAttrs(n,o)[0],this.ui.attrText.lineSpacing=8,this.ui.attrText.textFlow=e.GlobalUtil.getFormatAttText(n,o),this.ui.totalGrade.text=String(3*Number(this.calcTotalGrade()))},i.prototype.calcAdditionGrade=function(t,i){var n=this.getTitleQualityVO(t);if(void 0==n)return[];for(var o=Number(n.attrAddition),a=i.attrValueList,s=a.length,r=[],l=0;s>l;l++)r[l]=Math.ceil(e.GlobalUtil.calcFloat(a[l],o));return r},i.prototype.getTitleQualityVO=function(t){var i=t.qualityId;if(void 0!=i){var n=e.JsonDataManager.instance.medalTitleQuality,o=n[i];return o}},i.prototype.calcTotalGrade=function(){for(var t=e.MedalController.getInstance().getMedalMsgAry(),i=e.MedalController.getInstance().getActiveTitleLength(),n=0,o=0;i>o;o++){var a=t[o];n+=a.grade}return n+""},i.prototype.sortAttrs=function(t,i){for(var n=e.GlobalConfig.instance.getValue("TITLE_TOTAL_ATTRIBUTE_ORDER").split(","),o=n.length,a=[],s=0;o>s;s++){var r=Number(n[s]),l=t.indexOf(r);void 0==i[l]&&(i[l]=0),a.push(i[l])}return[n,a]},i}(e.BasePanel);e.MedalTotalAttrPanel=t,__reflect(t.prototype,"foxgame.MedalTotalAttrPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/medal/medalUpQualitySkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.qualityUpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.updateUpQualityView=function(){this.refresh()},i.prototype.updateMedalView=function(){},i.prototype.updateUpStarView=function(){},i.prototype.showPanel=function(e){this.model.updateUpQualityMedalData(e),this.show()},i.prototype.btnClick=function(t){switch(t.target){case this.ui.itemIcon:e.TipsController.getInstance().showItemTips(this.model.itemId);break;case this.ui.qualityUpBtn:if(this.model.itemIsEnough)if(this.model.coinIsEnough)this.ui.qualityUpBtn.enabled=!1,this.sendLevelReq();else{var i=e.JsonDataManager.instance.itemTemplate,n=i[1002];e.ItemNotEnoughController.getInstance().showPanel(n.id)}else e.ItemNotEnoughController.getInstance().showPanel(this.model.itemId)}},i.prototype.sendLevelReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.TitleQualityUpReq");t.setTitleId(this.model.moduleId),e.Message.instance.send(e.Code.TITLE_QUALITY_UP_C_VALUE,t,!0)},i.prototype.refresh=function(){var t=this.model.medalData;if(t&&this.getIsInit()){this.ui.qualityUpBtn.enabled=!0,this.ui.manjiText.visible=!1;var i=this.getTitleQualityVO(t);this.ui.currentAttrPes.text=this.calcAttrAddition(i);var n=this.getNextQualityVO(t);void 0==n&&(n=i,this.ui.manjiText.visible=!0,this.ui.nextLevelAttrAddText.visible=!1,this.ui.purposAttrPes.visible=!1,this.ui.qualityUpBtn.enabled=!1),this.ui.purposAttrPes.text=this.calcAttrAddition(n);for(var o=i.star,a=this.getStarsAry().length,s=0;a>s;s++){var r=this.getStarsAry()[s];r.offLightStar(),o>s&&r.lightStar()}this.ui.sucessRateText.text=i.successRate+"%",this.ui.qualityImg.source=i.icon+"_png";var l=i.cost[0],h=Number(l[1]);this.model.itemId=h;var c=e.JsonDataManager.instance.itemTemplate,u=c[h],p=u.name,g=e.BagController.getInstance().getCountByItemId(h);this.ui.itemIcon.setItem(h,null,!1);var d,f=e.ColorUtils.instance.getAttrColorById(u.quality);g>=Number(l[2])?(d=65280,this.model.itemIsEnough=!0):(d=16711680,this.model.itemIsEnough=!1),this.ui.consumeText.textFlow=[{text:p+":",style:{textColor:f}},{text:g+"",style:{textColor:d}},{text:"/"+l[2],style:{textColor:16777215}}];
var m,y=i.cost[1],I=Number(y[1]),v=y[2],_=c[I],T=e.PlayerService.instance.playerInfo.getCoin();T>=Number(v)?(m=65280,this.model.coinIsEnough=!0):(m=16711680,this.model.coinIsEnough=!1),this.ui.consumeText1.textFlow=[{text:_.name+":",style:{textColor:16777215}},{text:v+"",style:{textColor:m}}],this.isPlayEffect(t.vo)}},i.prototype.isPlayEffect=function(t){var i=this.model.titleEffect;t.icon1&&(this.ui.medalImg.source=t.icon1+"_png"),t.animation?(this.ui.aniGroup.visible=!0,i&&(i.clear(),i=null),void 0==i&&(i=new e.FoxAni(this.ui.aniGroup),this.model.titleEffect=i,i.play(t.animation))):this.ui.aniGroup.visible=!1},i.prototype.calcAttrAddition=function(t){var i=t.attrAddition,n=i-1,o=e.GlobalUtil.calcFloat(Number(n.toFixed(3)),100)+"%";return o},i.prototype.getTitleQualityVO=function(t){var i=t.qualityId;if(void 0!=i){var n=e.JsonDataManager.instance.medalTitleQuality,o=n[i];return o}},i.prototype.getNextQualityVO=function(t){var i=t.qualityId+1;if(void 0!=i){var n=e.JsonDataManager.instance.medalTitleQuality,o=n[i];return o}},i.prototype.readyDestroy=function(){this.model.titleEffect&&(this.model.titleEffect.clear(),this.model.titleEffect=null)},i.prototype.getStarsAry=function(){for(var e=[],t=1;9>=t;t++)e.push(this.ui["star"+t]);return e},i}(e.BasePanel);e.MedalUpQualityPanel=t,__reflect(t.prototype,"foxgame.MedalUpQualityPanel",["foxgame.IMedal","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/medal/medalUpStarSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this),this.model.registerObserver(this),this.ui.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.activeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.levelUpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.bagItemChanged=function(){e.MedalController.getInstance().updateUpStarModelMedalData()},i.prototype.updateUpQualityView=function(){this.refresh()},i.prototype.updateMedalView=function(){},i.prototype.updateUpStarView=function(){this.refresh()},i.prototype.showPanel=function(e){this.model.updateUpStarMedalData(e),this.show()},i.prototype.btnClick=function(t){switch(t.target){case this.ui.itemIcon:e.TipsController.getInstance().showItemTips(this.model.itemId);break;case this.ui.activeBtn:this.model.itemIsEnough?(this.ui.activeBtn.enabled=!1,this.sendLevelReq()):e.ItemNotEnoughController.getInstance().showPanel(this.model.itemId);break;case this.ui.levelUpBtn:this.model.itemIsEnough?(this.ui.levelUpBtn.enabled=!1,this.sendLevelReq()):e.ItemNotEnoughController.getInstance().showPanel(this.model.itemId)}},i.prototype.sendLevelReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.ActiveTitleReq");t.setTitleId(this.model.moduleId),e.Message.instance.send(e.Code.TITLE_ACTIVE_C_VALUE,t,!0)},i.prototype.refresh=function(){var t=this.model.medalData;if(t&&this.getIsInit()){var i=4;this.ui.currentAttrText.lineSpacing=i;var n=e.JsonDataManager.instance.medalTitleLevelByModelIdAndLevel[t.vo.id+"_"+t.level],o=this.calcAdditionGrade(t,n);this.ui.currentAttrText.textFlow=e.GlobalUtil.getFormatAttText(n.attrTypeList,o);var a=this.getNextMedalLevelVO(n);if(this.ui.medalActiveText.visible=!1,this.ui.medalLevelUpText.visible=!1,0==n.level?(this.ui.medalActiveText.visible=!0,this.ui.activeBtn.visible=!0,this.ui.activeBtn.enabled=!0,this.ui.levelUpBtn.visible=!1):(this.ui.medalLevelUpText.visible=!0,this.ui.activeBtn.visible=!1,this.ui.levelUpBtn.visible=!0,this.ui.levelUpBtn.enabled=!0),a){this.ui.purpsAttrText.lineSpacing=i;var s=this.calcAdditionGrade(t,a);this.ui.purpsAttrText.textFlow=e.GlobalUtil.getFormatAttText(a.attrTypeList,s),this.ui.purpsAttrText.y=this.ui.currentAttrText.y}else this.ui.purpsAttrText.text=e.LanguageUtils.instance.getValue("YIDAZUIDASHUXING"),this.ui.levelUpBtn.enabled=!1,this.ui.purpsAttrText.y=this.ui.manjiTextRef.y;this.model.itemId=n.cost.id;var r=e.JsonDataManager.instance.itemTemplate,l=r[n.cost.id],h=l.name,c=e.BagController.getInstance().getCountByItemId(n.cost.id);this.ui.itemIcon.setItem(n.cost.id,null,!1);var u,p=e.ColorUtils.instance.getAttrColorById(l.quality);c>=n.cost.value?(u=65280,this.model.itemIsEnough=!0):(u=16711680,this.model.itemIsEnough=!1),this.ui.consumeText.textFlow=[{text:h+":",style:{textColor:p}},{text:c+"",style:{textColor:u}},{text:"/"+n.cost.value,style:{textColor:16777215}}],this.ui.gradeText.text=t.grade+"",this.ui.desText.text=t.vo.des,this.ui.levelText.text=e.LanguageUtils.instance.getValue("DANGQIANJIAJIJI",t.level),this.isPlayEffect(t.vo)}},i.prototype.calcAdditionGrade=function(t,i){var n,o=this.getTitleQualityVO(t);n=null==o?1:Number(o.attrAddition);for(var a=i.attrValueList,s=a.length,r=[],l=0;s>l;l++)r[l]=Math.ceil(e.GlobalUtil.calcFloat(a[l],n));return r},i.prototype.getTitleQualityVO=function(t){var i=t.qualityId;if(void 0==i)return null;var n=e.JsonDataManager.instance.medalTitleQuality,o=n[i];return o},i.prototype.isPlayEffect=function(t){var i=this.model.titleEffect;void 0==t.icon1?this.ui.medalImg.source="":this.ui.medalImg.source=t.icon1+"_png",t.animation?(this.ui.aniGroup.visible=!0,i&&(i.clear(),i=null),void 0==i&&(i=new e.FoxAni(this.ui.aniGroup),this.model.titleEffect=i,i.play(t.animation))):this.ui.aniGroup.visible=!1},i.prototype.getNextMedalLevelVO=function(t){var i=e.JsonDataManager.instance.medalTitleLevel,n=i.indexOf(t);return void 0==i[n+1]?null:i[n+1].modelId==t.modelId?i[n+1]:null},i.prototype.readyDestroy=function(){this.model.titleEffect&&(this.model.titleEffect.clear(),this.model.titleEffect=null)},i}(e.BasePanel);e.MedalUpStarPanel=t,__reflect(t.prototype,"foxgame.MedalUpStarPanel",["foxgame.IMedal","foxgame.IObserver","foxgame.IBag"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MedalVO=t,__reflect(t.prototype,"foxgame.MedalVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="titleItemSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){switch(t.prototype.dataChanged.call(this),this.isPlayEffect(this.data.vo),this.medalData=this.data,this.data.priority){case e.TitlePriority.CHEXIAOSHIYONG:this.unuseTitleBtn.visible=!0,this.unuseTitleBtn.enabled=!0,this.useTitleBtn.visible=!1;break;case e.TitlePriority.YIBEISHIYONG:this.unuseTitleBtn.visible=!0,this.unuseTitleBtn.enabled=!1,this.useTitleBtn.visible=!1;break;case e.TitlePriority.SHIYONGCHENGHAO:this.unuseTitleBtn.visible=!1,this.useTitleBtn.visible=!0,this.useTitleBtn.enabled=!0;break;case e.TitlePriority.BUKESHIYONG:this.unuseTitleBtn.visible=!1,this.useTitleBtn.visible=!0,this.useTitleBtn.enabled=!1}},i.prototype.isPlayEffect=function(t){this.medalImg.source="",void 0!=t.icon1&&(this.medalImg.source=t.icon1+"_png"),t.animation?(this.aniGroup.visible=!0,this.titleAni&&(this.titleAni.clear(),this.titleAni=null),void 0==this.titleAni&&(this.titleAni=new e.FoxAni(this.aniGroup),this.titleAni.play(t.animation),this.lastAni=t.animation),this.lastAni&&t.animation!=this.lastAni&&(this.titleAni.clear(),this.titleAni=null,this.titleAni=new e.FoxAni(this.aniGroup),this.titleAni.play(t.animation),this.lastAni=t.animation)):this.aniGroup.visible=!1},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.unuseTitleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.useTitleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.btnClick=function(e){switch(e.target){case this.unuseTitleBtn:this.sendChooseTitleReq(2);break;case this.useTitleBtn:this.sendChooseTitleReq(1)}},i.prototype.sendChooseTitleReq=function(t){var i=HawkProtocolManager.newBuilder("JsProto.ChooseTitleId"),n=e.MedalController.getInstance().getRoleData();i.setTitleId(this.medalData.vo.id),i.setRoleId(n.roleId),i.setType(t),e.Message.instance.send(e.Code.CHANGE_TITLE_C_VALUE,i,!0)},i.prototype.destoryAni=function(){this.titleAni&&(this.titleAni.clear(),this.titleAni=null)},i}(eui.ItemRenderer);e.TitleItem=t,__reflect(t.prototype,"foxgame.TitleItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.ModuleOpenModel,this.panel=new e.ModuleOpenPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.registerMsg=function(t){t.add(e.Code.FUNCTION_OPEN_INFO_S,this),t.add(e.Code.FUNCTION_OPEN_AWARDS_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.FUNCTION_OPEN_INFO_S:this.model.setOpenModuleData(i);break;case e.Code.FUNCTION_OPEN_AWARDS_S:var n=i;0==n.getErrorNo()?(App.SoundManager().playEffect("sound_activate_mp3"),this.panel.closeNew(),this.openModuleSendData()):Log.trace("********领取功能开启奖励失败，服务端数据报错*********")}},t.prototype.showPanel=function(e){this.model.isClick=e,this.model.setModuleVO(),this.panel.show()},t.prototype.autoShowPanel=function(t){this.openModuleSendData();for(var i=e.JsonDataManager.instance.moduleOpen,n=i.length,o=0;n>o;o++){var a=i[o];if(a.level<=t&&a.type==this.model.modulePart+1)return this.model.setModuleVO(a.level),this.model.isClick=!1,void this.panel.show()}},t.prototype.setmodulepart=function(e){this.model.modulePart=e},t.prototype.getCurModuleVO=function(t){void 0===t&&(t=e.PlayerService.instance.level);var i=this.model.getOpenModuleData();return void 0==i?null:this.model.curModuleVO?this.model.curModuleVO:null},t.prototype.getIsShow=function(){return this.panel.getIsShow()},t.prototype.getFinalData=function(){var e=this.model.getOpenModuleData();if(void 0==e)return!1;var t=e.getFunctionsInfo().length;return t>0?!0:!1},t.prototype.getNextModuleVO=function(t){void 0===t&&(t=e.PlayerService.instance.level);var i=this.model.setModuleVO(t);return i?this.model.nextModuleVO:null},t.prototype.getLastModuleVO=function(t){void 0===t&&(t=e.PlayerService.instance.level);var i=this.model.setModuleVO(t);return i?this.model.lastModuleVO:null},t.prototype.sendData=function(){if(void 0!=this.model.modulePart){var t=HawkProtocolManager.newBuilder("JsProto.HPRecordTutorialStep");t.setTutorialStep(this.model.modulePart),e.Message.instance.send(e.Code.RECORD_TUTORIAL_STEP,t,!0)}},t.prototype.openModuleSendData=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPFunctionsOpenReq");e.Message.instance.send(e.Code.FUNCTION_OPEN_INFO_C,t,!0)},t.prototype.sendDataForAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPFunctionsOpenAwardsReq");i.setId(t),e.Message.instance.send(e.Code.FUNCTION_OPEN_AWARDS_C,i,!0)},t}();e.ModuleOpenController=t,__reflect(t.prototype,"foxgame.ModuleOpenController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.prototype.setCurModuleVO=function(t){void 0===t&&(t=e.PlayerService.instance.level);var i=e.JsonDataManager.instance.moduleOpen;if(void 0!=i){for(var n=i.length,o=0;n>o;o++){var a=i[o];if(t==a.level){this.curModuleVO=a;break}}return e.MainControler.instance.chengeModuleImg(),!0}},t.prototype.setModuleVO=function(t){void 0===t&&(t=e.PlayerService.instance.level);var i=e.JsonDataManager.instance.moduleOpen;if(void 0!=i){for(var n,o=i.length,a=0;o>a;a++){var s=i[a];if(t<s.level){n=a;break}t==i[o-1].level&&(this.lastModuleVO=i[o-1])}if(void 0==n)return!1;var r=i[n],l=i[n-1];return this.nextModuleVO=r,this.lastModuleVO=l,!0}},t.prototype.setOpenModuleData=function(t){if(0==t.getErrorNo()){this.openData=t;var i=this.openData.getFunctionsInfo();if(0==i.length){var n=e.PlayerService.instance.playerInfo.getLevel();this.setModuleVO(n),e.MainControler.instance.chengeModuleImgByNext(),this.curModuleVO=null}else{var o=i[0];this.setCurModuleVO(o.getLevel())}}else Log.trace("********获取功能开启数据失败，服务端数据报错*********")},t.prototype.getOpenModuleData=function(){return this.openData},t}();e.ModuleOpenModel=t,__reflect(t.prototype,"foxgame.ModuleOpenModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/modelOpen/ModelOpen.exml")||this;return i.voArr=[],i.curAwardId=0,i.isMask=!0,i.model=e,i.setIsShowBackBtn(!1),i.setIsShowTween(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.doScreenAdaptation()},i.prototype.showHook=function(){this.jiantou=new eui.Image,this.jiantou.source="wenzhijiantou_png",this.jiantou.visible=!1,this.parent.addChild(this.jiantou),this.ui.chakanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.checkOpenData=function(){var e=this.model.getOpenModuleData();if(void 0!=e){var t=e.getFunctionsInfo();if(this.curAwardId=0,0==t.length);else{var i=t[0];this.model.setModuleVO(i.getLevel()),this.model.setCurModuleVO(i.getLevel())}}},i.prototype.closeNew=function(){this.model.isClick&&this.close()},i.prototype.closeHook=function(){this.scaleX=this.scaleY=1,this.x=this.y=0},i.prototype.btnClick=function(t){switch(t.target){case this.ui.chakanBtn:e.ModuleOpenController.getInstance().sendDataForAward(this.curAwardId),this.model.isClick||this.closeFuncHandler()}},i.prototype.closeFuncHandler=function(){this.model.modulePart=this.typenumber,e.ModuleOpenController.getInstance().sendData(),this.guideclose(),App.GuideUtils().currlv=!1},i.prototype.guideclose=function(){var t=this.point,i={point:t,skin:this.skinname,time:1.8,mask:!0,backFun:this.close,flycall:this.flycall,flyback:this.flyback1};e.FlyController.getInstance().FlyGuide(this,i)},i.prototype.flyback1=function(){switch(App.GuideUtils().currdbz){case 26:e.MainControler.instance.guidefun();break;case 27:e.MainControler.instance.guidefun();break;case 28:e.MainControler.instance.guidefun();break;case 29:e.MainControler.instance.guidefun();break;case 30:e.MainControler.instance.guidefun();break;case 31:e.MainControler.instance.guidefun();break;case 32:e.MainControler.instance.guidefun();break;case 33:e.MainControler.instance.guidefun();break;case 34:e.MainControler.instance.guidefun();break;case 35:e.MainControler.instance.guidefun();break;case 36:e.MainControler.instance.guidefun();break;case 37:e.MainControler.instance.guidefun();break;case 38:e.MainControler.instance.guidefun();break;case 39:e.MainControler.instance.guidefun();break;case 40:e.MainControler.instance.guidefun();break;case 41:e.ActivityBarController.getInstance().getshowguide();break;case 42:e.ActivityBarController.getInstance().getshowguide();break;case 43:e.MainControler.instance.guidefun();break;case 44:e.MainControler.instance.guidefun();break;case 45:e.MainControler.instance.guidefun();break;case 46:e.MainControler.instance.guidefun();break;case 47:e.MainControler.instance.guidefun();break;case 48:e.MainControler.instance.guidefun()}},i.prototype.refresh=function(){this.checkOpenData();var t=[],i=0,n=0;this.voArr=[];var o,a=this.model.getOpenModuleData(),s=!1;if(this.model.isClick){if(this.ui.openLevelText.visible=!0,this.model.curModuleVO)this.ui.openLevelText.text=this.model.curModuleVO.level+"",s=!0,this.ui.bg.source=this.model.curModuleVO.bgPath+"_png",o=this.model.curModuleVO.award,this.curAwardId=this.model.curModuleVO.id;else{this.ui.openLevelText.text=this.model.nextModuleVO.level+"";var r=0;if(s=!1,a){var l=a.getFunctionsInfo().length;for(r;l>r;r++){var h=a.getFunctionsInfo()[r];h.getLevel()==this.model.nextModuleVO.level&&(s=!0,this.curAwardId=this.model.nextModuleVO.id)}}else s=!1;this.ui.bg.source=this.model.nextModuleVO.bgPath+"_png",o=this.model.nextModuleVO.award}for(this.ui.chakanBtn.visible=!1,this.ui.staticText.visible=!0,t=o.split(","),n=t.length,i;n>i;i++){var c=t[i],u=new e.AttributeVO(c),p=this.getitemIconByIndex(i);p.setItem(u.id,u.value,!0),p.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),p.visible=!0,this.voArr.push(u)}if(4>n)for(i;4>i;i++){var p=this.getitemIconByIndex(i);p.visible=!1}}else{for(this.ui.openLevelText.visible=!1,this.ui.bg.source=this.model.lastModuleVO.bgPath+"_png",o=this.model.lastModuleVO.award,this.curAwardId=this.model.lastModuleVO.id,s=!0,this.ui.chakanBtn.visible=!0,this.ui.staticText.visible=!1,this.showGuide(),t=o.split(","),n=t.length,i;n>i;i++){var c=t[i],u=new e.AttributeVO(c),p=this.getitemIconByIndex(i);p.setItem(u.id,u.value,!0),p.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),p.visible=!0,this.voArr.push(u)}if(4>n)for(i;4>i;i++){var p=this.getitemIconByIndex(i);p.visible=!1}}s?(this.ui.chakanBtn.visible=!0,this.ui.dailingqu.visible=!1,this.ui.lingquImg.visible=!1):(this.ui.chakanBtn.visible=!1,this.ui.dailingqu.visible=!0,this.ui.lingquImg.visible=!1),this.ui.chakanBtn.visible==this.ui.chakanBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n=this.voArr,o=null;switch(t.target){case this.getitemIconByIndex(0):o=n[0],i=e.JsonDataManager.instance.itemTemplate[o.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,o.num);break;case this.getitemIconByIndex(1):o=n[1],i=e.JsonDataManager.instance.itemTemplate[o.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,o.num);break;case this.getitemIconByIndex(2):o=n[2],i=e.JsonDataManager.instance.itemTemplate[o.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,o.num);break;case this.getitemIconByIndex(3):o=n[3],i=e.JsonDataManager.instance.itemTemplate[o.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,o.num)}},i.prototype.showGuide=function(){var t=0;switch(this.model.lastModuleVO.level){case 21:t=26,this.skinname="juewei_png",this.point=e.MainBottomControler.instance.getJueWeiBtnPoint(),this.flycall=e.ActivityBarController.getInstance().getpanel();break;case 25:t=27,this.skinname="main_WingsBtn_png",this.point=e.MainBottomControler.instance.getWingGroupPoint(),this.flycall=e.MainControler.instance;break;case 30:t=28,this.skinname="guide_boss",this.point=e.MainControler.instance.getbossbtn(),this.flycall=e.MainControler.instance;break;case 35:t=29,this.skinname="guide_fuben",this.point=e.MainControler.instance.getfubenbossbtn(),this.flycall=e.MainControler.instance;break;case 40:t=30,this.skinname="guide_zhuangbeishengxing",this.point=e.MainBottomControler.instance.gettheroGroupPoint(),this.flycall=e.MainBottomControler.instance;break;case 45:t=31,this.skinname="guide_yewaiPK",this.point=e.MainControler.instance.getwanfabtn(),this.flycall=e.MainControler.instance;break;case 50:t=32,this.skinname="guide_fuben",this.point=e.MainControler.instance.getfubenbossbtn(),this.flycall=e.MainControler.instance;break;case 55:t=33,this.skinname="RecycleBtn_png",this.point=e.MainBottomControler.instance.getunionBtnPoint(),this.flycall=e.ActivityBarController.getInstance().getpanel();break;case 60:t=34,this.skinname="guide_JJC",this.point=e.MainControler.instance.getwanfabtn(),this.flycall=e.MainControler.instance;break;case 65:t=35,this.skinname="guide_fuben",this.point=e.MainControler.instance.getfubenbossbtn(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("GHOST_TOWER_LEVEL_LIMIT")):t=36,this.skinname="guide_youmingta",this.point=e.MainControler.instance.getwanfabtn(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_GRADE_MIN")):t=37,this.skinname="guide_chuanqibaye",this.point=e.MainControler.instance.getwanfabtn(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("SUITOPENLEVEL")):t=38,this.skinname="guide_bayezhuangbei",this.point=e.MainBottomControler.instance.getRoleGroupPoint(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("SOUL_OPENLEVEL")):t=39,this.skinname="guide_longhun",this.point=e.MainBottomControler.instance.getRoleGroupPoint(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("GODLYEQUIP_OPENLEVEL")):t=40,this.skinname="guide_shenqi",this.point=e.MainBottomControler.instance.getRoleGroupPoint(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_LIMIT")):t=41,this.skinname="dianfengduijue",this.point=e.ActivityBarController.getInstance().getLiansaiBtnPoint(),this.flycall=e.ActivityBarController.getInstance().getpanel();break;case Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN")):t=42,this.skinname="JieMianAnNiu_BaoKu_png",this.point=e.ActivityBarController.getInstance().getSearchTreasureBtnPoint(),this.flycall=e.ActivityBarController.getInstance().getpanel();break;case Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL")):t=43,this.skinname="main_WingsBtn_png",this.point=e.MainBottomControler.instance.getWingGroupPoint(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("TWELVEPALACE_OPEN_LIMIT")):t=44,this.skinname="icon_xinggong_png",this.point=e.MainControler.instance.getwanfabtn(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("BOSS_CROSSDRESS_OPEN_LEVEL")):t=45,this.skinname="icon_kuafubossopen_png",this.point=e.MainControler.instance.getbossbtn(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("GODHEAD_OPEN_LEVEL")):t=46,this.skinname="icon_shenge_png",this.point=e.MainBottomControler.instance.getRoleGroupPoint(),this.flycall=e.MainControler.instance;break;case Number(e.GlobalConfig.instance.getValue("RED_EQUIP_QUENCHING_EQUIP_LEVEL")):t=48,this.skinname="icon_hongzhuangcl_png",this.point=e.MainBottomControler.instance.gettheroGroupPoint(),this.flycall=e.MainControler.instance;break;default:getGlobalConfig().isDebug&&e.GameUtils.MSG_TIP("未配置新手引导")}e.MainControler.instance.guidechange(this.ui.chakanBtn,this.ui.chakanBtn.parent,t,0,!0),App.GuideUtils().play_soung_guide(),this.typenumber=this.model.lastModuleVO.type},i.prototype.getitemIconByIndex=function(e){return this.ui["itemIcon"+e]},i}(e.BasePanel);e.ModuleOpenPanel=t,__reflect(t.prototype,"foxgame.ModuleOpenPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.ModuleOpenVO=t,__reflect(t.prototype,"foxgame.ModuleOpenVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.CreateNewVipModel,this.panel=new e.CreateNewVipPanel(this.model)}return t.prototype.recvMsg=function(t,i){switch(t){case e.Code.BUY_VIP_GIFT_S:var n=i.boughtCfgId,o=i.canBuyId;this.model.setVipGiftId(n),this.model.setCanBuyGiftId(o);break;case e.Code.VIP_GIFTS_INFO_S:var n=i.boughtCfgId,o=i.canBuyId;this.model.setVipGiftId(n),this.model.setCanBuyGiftId(o),e.MainControler.instance.chuanshuaobtn(),e.LegendaryEquipController.getInstance().refreshUI();break;case e.Code.VIP_WELFARE_INFO_S:var a=i.awardStatus;this.model.setDailyGiftState(a);break;case e.Code.VIP_WELFARE_AWARD_S:var a=i.awardStatus;this.model.setDailyGiftState(a)}},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.showPanel=function(e){void 0===e&&(e=-1),this.model.setScenceLevel(e),this.panel.show()},t.prototype.closePanel=function(){this.panel.close()},t.prototype.isReceiveAward=function(t){var i=this.model.getCanBuyGiftId(),n=i.length;if(e.PlayerService.instance.playerInfo.getVipLevel()<t)return!1;for(var o=0;n>o;o++)if(i[o]-1==t)return!1;return!0},t.prototype.isShowPanel=function(){return this.panel.getIsShow()},t.prototype.requestVIPInfo=function(){e.Message.instance.send(e.Code.VIP_GIFTS_INFO_C,HawkProtocolManager.emptyProtocol(),!0)},t}();e.CreateNewVipController=t,__reflect(t.prototype,"foxgame.CreateNewVipController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.scrollWidth=430,this.scenceLevel=-1,this.observerList=[],this.haveGiftIdList=[],this.canBuyGiftIdList=[],this.dailyGiftState=0}return t.prototype.setScenceLevel=function(e){this.scenceLevel=e},t.prototype.getScenceLevel=function(){return this.scenceLevel},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.getDiamondNum=function(){return e.PlayerService.instance.playerInfo.getRecharge()},t.prototype.getVipLevel=function(){return e.PlayerService.instance.playerInfo.getVipLevel()},t.prototype.setVipGiftId=function(e){this.haveGiftIdList=e,this.updateView()},t.prototype.getVipGiftId=function(){return this.haveGiftIdList.sort(function(e,t){return e-t}),this.haveGiftIdList},t.prototype.setCanBuyGiftId=function(e){this.canBuyGiftIdList=e},t.prototype.getCanBuyGiftId=function(){return this.canBuyGiftIdList},t.prototype.setDailyGiftState=function(e){this.dailyGiftState=e,this.updateView()},t.prototype.getDailyGiftState=function(){return this.dailyGiftState},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},t}();e.CreateNewVipModel=t,__reflect(t.prototype,"foxgame.CreateNewVipModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/vip/VipPanel.exml")||this;return i.bossItemGap=8,i.vipDescribeColumNUm=1,i.vipAwardColumNum=15,i.vipMaxLevel=33,i.maxVipDesNum=15,i.lessNum=0,i.autoSelected=!1,i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHander,this),this.ui.leftVipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHander,this),this.ui.rightVipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHander,this),this.ui.vipLevelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHander,this),this.ui.dailyvipLevelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHander,this),this.ui.rechargeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHander,this)},i.prototype.showHook=function(){App.GuideUtils().currPart==e.GuidePart.currPart46&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.ui.vipLevelBtn,this.ui.vipLevelBtn.parent,e.GuidePart.currPart46,1),e.Global.isYouGuSDK?this.ui.vipLevelBtn.label="购买":(this.ui.vipLevelBtn.label="领取",this.ui.youguBuyGroup.parent.removeChild(this.ui.youguBuyGroup)),this.autoSelected=!0},i.prototype.initParams=function(){var t=this.model.getScenceLevel();-1==t?this.vipPrivilegeLevel=this.model.getVipLevel():this.vipPrivilegeLevel=t,e.Message.instance.send(e.Code.VIP_GIFTS_INFO_C,HawkProtocolManager.emptyProtocol(),!0),e.Message.instance.send(e.Code.VIP_WELFARE_INFO_C,HawkProtocolManager.emptyProtocol(),!0),this.ui.vipPrivilegeScroller.verticalScrollBar.autoVisibility=!1,this.ui.awardsScroller.horizontalScrollBar.autoVisibility=!1,this.ui.dailyGiftScroller.horizontalScrollBar.autoVisibility=!1,0==this.vipPrivilegeLevel?this.ui.leftVipBtn.visible=!1:this.ui.leftVipBtn.visible=!0,this.flushProgressBar(),this.flushVipPrivilegeData()},i.prototype.flushProgressBar=function(){var t=this.model.getDiamondNum();e.PlayerService.instance.playerInfo.getRecharge;var i=this.getNextVipNeedDiamond(this.model.getVipLevel()+1),n=t/i>=1?1:t/i;this.ui.vipProBar.maximum=i,this.ui.vipProBar.value=i*n},i.prototype.getNextVipNeedDiamond=function(t){t>this.vipMaxLevel&&(t=this.vipMaxLevel);var i=e.JsonDataManager.instance.vipTemplate,n=i[t],o=n.needRechargeGold;return o},i.prototype.flushVipAwardsData=function(){this.ui.awardsGroup.removeChildren(),this.ui.awardsScroller.viewport.scrollH=0;var t=e.JsonDataManager.instance.vipGift,i=t[this.vipPrivilegeLevel];this.model.attribute=i.awards;for(var n,o,a=0;a<i.awards.length;++a){var s=i.awards[a];n=new e.ItemIcon,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dropItemClickHandler,this),o=this.getIconPos(n.width,n.height,a,this.vipAwardColumNum),n.x=o.x,n.setItem(s.id,s.value,!1),this.ui.awardsGroup.addChild(n)}this.ui.awardsScroller.width=this.model.scrollWidth;var r=this.calcGroupWidth(this.ui.awardsGroup);r<this.model.scrollWidth&&(this.ui.awardsScroller.width=r,this.ui.awardsScroller.x=ScreenAdaptation.instance.uiWidth-r>>1),e.Global.isYouGuSDK&&(this.ui.oldPrice.text=i.thePrice,this.ui.nowPrice.text=i.presentPrice)},i.prototype.calcGroupWidth=function(e){var t=e.numChildren,i=e.getChildAt(t-1).x,n=e.getChildAt(t-1).width;return i+n},i.prototype.dailyGiftItemClickHander=function(t){var i=this.getDailyGiftItems(),n=i.indexOf(t.target),o=this.model.dailyAttribute[n],a=o.id,s=e.JsonDataManager.instance.itemTemplate,r=s[a];r.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:a}):r.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(r.id):e.TipsController.getInstance().showItemTips(a)},i.prototype.dropItemClickHandler=function(t){var i=this.getDropItems(),n=i.indexOf(t.target),o=this.model.attribute[n],a=o.id,s=e.JsonDataManager.instance.itemTemplate,r=s[a];r.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:a}):r.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(r.id):e.TipsController.getInstance().showItemTips(a)},i.prototype.getDropItems=function(){for(var e=[],t=this.ui.awardsGroup.numChildren,i=0;t>i;i++)e.push(this.ui.awardsGroup.getChildAt(i));return e},i.prototype.getDailyGiftItems=function(){for(var e=[],t=this.ui.dailyGiftGroup.numChildren,i=0;t>i;i++)e.push(this.ui.dailyGiftGroup.getChildAt(i));return e},i.prototype.flushDailyAwardsData=function(){this.ui.dailyGiftGroup.removeChildren(),this.ui.dailyGiftScroller.viewport.scrollH=0;var t=e.JsonDataManager.instance.vipDailyGift,i=t[this.vipPrivilegeLevel];this.model.dailyAttribute=i.awards;for(var n,o,a=0;a<i.awards.length;++a){var s=i.awards[a];n=new e.ItemIcon,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dailyGiftItemClickHander,this),o=this.getIconPos(n.width,n.height,a,this.vipAwardColumNum),n.x=o.x,n.setItem(s.id,s.value,!1),this.ui.dailyGiftGroup.addChild(n)}this.ui.dailyGiftScroller.width=this.model.scrollWidth;var r=this.calcGroupWidth(this.ui.dailyGiftGroup);r<this.model.scrollWidth&&(this.ui.dailyGiftScroller.width=r,this.ui.dailyGiftScroller.x=ScreenAdaptation.instance.uiWidth-r>>1)},i.prototype.flushVipPrivilegeData=function(){this.ui.vipPrivilegeGroup.removeChildren(),this.ui.vipPrivilegeScroller.viewport.scrollV=0;var t=this.vipPrivilegeLevel;this.vipPrivilegeLevel-this.model.getVipLevel()>0&&(t-=1);var i=this.getNextVipNeedDiamond(t+1)-this.model.getDiamondNum(),n=e.LanguageUtils.instance.getValue("VIPEXPLAIN"+t,i);this.vipPrivilegeLevel<=this.model.getVipLevel()&&(i=this.getNextVipNeedDiamond(this.model.getVipLevel()+1)-this.model.getDiamondNum(),n=e.LanguageUtils.instance.languageTemp["VIPEXPLAIN"+(this.model.getVipLevel()+1)]?e.LanguageUtils.instance.getValue("VIPEXPLAIN"+this.model.getVipLevel(),i):e.LanguageUtils.instance.getValue("VIPMANJI")),this.ui.vipLevelExplain.textFlow=(new egret.HtmlTextParser).parser(n);for(var o,a,s=this.getVipPrivilegeTemplate()[this.vipPrivilegeLevel],r=e.JsonDataManager.instance.vipTemplate[this.vipPrivilegeLevel],l=(s.VipLevel,0);l<this.maxVipDesNum;++l){var h=s["Description"+(l+1)];"0"!=h&&(o=new e.CreateVipPrivilegeItem,o.setItem(h),a=this.getIconPos(o.width,o.height,l,this.vipDescribeColumNUm),o.y=a.y,this.ui.vipPrivilegeGroup.addChild(o))}this.ui.vipLevelImg.source="vip"+this.vipPrivilegeLevel+"_png",this.ui.vipLevImg.source="vip"+this.model.getVipLevel()+"_png",this.ui.fightup.text=r.fight.toString(),this.flushVipAwardsData(),this.flushDailyAwardsData()},i.prototype.setVipGiftButtonState=function(){var t=this.model.getVipGiftId(),i=e.PlayerService.instance.vipLevel;if(this.ui.vipLevelBtn.visible=this.ui.vipLevelBtn.enabled=!0,this.ui.yilingquImg.visible=!this.ui.vipLevelBtn.enabled,i<this.vipPrivilegeLevel)this.ui.vipLevelBtn.enabled=!1;
else for(var n=0;n<t.length;++n){var o=t[n];if(this.vipPrivilegeLevel+1==o){this.ui.vipLevelBtn.visible=this.ui.vipLevelBtn.enabled=!1,this.ui.yilingquImg.visible=!this.ui.vipLevelBtn.enabled;break}}this.ui.vipLevelBtn.enabled?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.setDailyVipGiftButtonState=function(){var e=this.model.getDailyGiftState();this.ui.dailyvipLevelBtn.visible=this.ui.dailyvipLevelBtn.enabled=!0,this.ui.yilingquImg0.visible=!1,this.vipPrivilegeLevel==this.model.getVipLevel()?e>0?(this.ui.dailyvipLevelBtn.visible=this.ui.dailyvipLevelBtn.enabled=!1,this.ui.yilingquImg0.visible=!this.ui.dailyvipLevelBtn.enabled):this.ui.dailyvipLevelBtn.enabled=!0:this.ui.dailyvipLevelBtn.enabled=!1,this.ui.dailyvipLevelBtn.enabled?this.effectLingQu0(!0):this.effectLingQu0(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.effectLingQu0=function(t){this.rechargeAni0&&(this.rechargeAni0.clear(),this.rechargeAni0=null),t&&(this.rechargeAni0||(this.rechargeAni0=new e.FoxAni(this.ui.rechargeAniGroup0),this.rechargeAni0.play("rechargeAnimation","ani",-1)))},i.prototype.getIconPos=function(e,t,i,n){var o=new egret.Point,a=Math.floor(i/n),s=i%n;return o.x=s*(e+this.bossItemGap),o.y=a*(t+this.bossItemGap),o},i.prototype.clickHander=function(t){switch(t.target){case this.ui.helpBtn:e.HelpController.getInstance().showPanel("VIPHELP");break;case this.ui.leftVipBtn:e.Message.instance.send(e.Code.VIP_WELFARE_INFO_C,HawkProtocolManager.emptyProtocol(),!0),this.ui.rightVipBtn.visible=!0,this.vipPrivilegeLevel--,this.vipPrivilegeLevel<=0&&(this.vipPrivilegeLevel=0,this.ui.leftVipBtn.visible=!1),this.setVipGiftButtonState(),this.flushVipPrivilegeData();break;case this.ui.rightVipBtn:e.Message.instance.send(e.Code.VIP_WELFARE_INFO_C,HawkProtocolManager.emptyProtocol(),!0),this.ui.leftVipBtn.visible=!0,this.vipPrivilegeLevel++,this.vipPrivilegeLevel>=this.vipMaxLevel&&(this.vipPrivilegeLevel=this.vipMaxLevel,this.ui.rightVipBtn.visible=!1),this.vipPrivilegeLevel>=23&&this.model.getVipLevel()<23&&(this.vipPrivilegeLevel=this.vipMaxLevel-10,this.ui.rightVipBtn.visible=!1),this.setVipGiftButtonState(),this.flushVipPrivilegeData();break;case this.ui.vipLevelBtn:if(App.GuideUtils().currPart==e.GuidePart.currPart46&&1==App.GuideUtils().currStep){var i=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(i,i.parent,e.GuidePart.currPart46,2)}if(e.Global.isYouGuSDK){var n=e.JsonDataManager.instance.vipGift[this.vipPrivilegeLevel],o=n.presentPrice;e.PlayerService.instance.playerInfo.getGold()>=Number(o)?(e.BagController.getInstance().checkBagEnough(this,this.getGift),App.SoundManager().playEffect("sound_award_mp3")):e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}else e.BagController.getInstance().checkBagEnough(this,this.getGift),App.SoundManager().playEffect("sound_award_mp3");break;case this.ui.dailyvipLevelBtn:e.Message.instance.send(e.Code.VIP_WELFARE_AWARD_C,HawkProtocolManager.emptyProtocol(),!0),App.SoundManager().playEffect("sound_award_mp3");break;case this.ui.rechargeBtn:var a=e.PlayerService.instance.vipLevel;a>=3?e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE):e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.FIRST_RECHARGE)}},i.prototype.getGift=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPBuyVipGift");t.setGiftCfgId(this.vipPrivilegeLevel+1),this.autoSelected=!0,e.Message.instance.send(e.Code.BUY_VIP_GIFT_C,t,!0)},i.prototype.refresh=function(){if(this.model.getVipGiftId()){var t=this.model.getVipGiftId(),i=t.length,n=0;for(n;i>n;n++){var o=t[n];if(4==o){e.MainControler.instance.chuanshuaobtn();break}}}if(this.autoSelected){var a=this.model.getVipGiftId().length;if(a>=1)if(1!=this.model.getVipGiftId()[0])this.lessNum=0;else for(var n=0;a>n;n++){if(n>0&&this.model.getVipGiftId()[n]-1>n){this.lessNum=this.model.getVipGiftId()[n-1];break}n==a-1&&(this.lessNum=this.model.getVipGiftId()[n])}else this.lessNum=0;console.log(this.lessNum),this.vipPrivilegeLevel=this.lessNum>this.model.getVipLevel()?this.model.getVipLevel():this.lessNum,this.flushVipPrivilegeData()}this.autoSelected=!1,this.setVipGiftButtonState(),this.setDailyVipGiftButtonState()},i.prototype.updateView=function(){this.refresh()},i.prototype.closeHook=function(){e.CreateNewVipController.instance.requestVIPInfo(),App.GuideUtils().currPart==e.GuidePart.currPart46&&2==App.GuideUtils().currStep&&(App.GuideUtils().currPart=App.GuideUtils().currStep=0,App.GuideUtils().hide())},i.prototype.getVipPrivilegeTemplate=function(){return e.JsonDataManager.instance.vipPrivilegeTemplate},i}(e.BasePanel);e.CreateNewVipPanel=t,__reflect(t.prototype,"foxgame.CreateNewVipPanel",["foxgame.ICreateVip","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.skinName="VipPrivilegeDes"},t.prototype.setItem=function(e){this.vipDescribe.textFlow=(new egret.HtmlTextParser).parser(e)},t}(eui.Component);e.CreateVipPrivilegeItem=t,__reflect(t.prototype,"foxgame.CreateVipPrivilegeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.VipGiftVO=t,__reflect(t.prototype,"foxgame.VipGiftVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.VipPrivilegeDecVO=t,__reflect(t.prototype,"foxgame.VipPrivilegeDecVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.VipVO=t,__reflect(t.prototype,"foxgame.VipVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.OffLineYieldModel,this.panel=new e.OffLineYieldPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.panel.show()},t.prototype.closePanel=function(){this.panel.close()},t.prototype.isShowPanel=function(){return this.panel.getIsShow()},t.prototype.setModelData=function(e){this.model.setData(e)},t}();e.OffLineYieldController=t,__reflect(t.prototype,"foxgame.OffLineYieldController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e.prototype.setData=function(e){this.offLineYieldData=e,this.updateView()},e}();e.OffLineYieldModel=t,__reflect(t.prototype,"foxgame.OffLineYieldModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/fight/FightOffLineSkin.exml")||this;return i.model=e,i.layer=LayerType.TOPLAYER,i}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.refresh=function(){if(void 0!=this.model.offLineYieldData){var t=this.model.offLineYieldData.getResult(),i=t.getUpToLevel()-t.getFromLevel(),n=t.getSmeltResult().length;this.ui.img0.visible=!0,0==n&&(this.ui.img0.visible=!1,this.ui.img1.visible=!1,this.ui.img2.visible=!1,this.getlist()[0].visible=!1,this.getlist()[1].visible=!1);for(var o=0;n>o;o++)this.getlist()[o].text=t.getSmeltResult()[o].getItemCount().toString();for(var a=t.getAward().getDrop().getEquip().length,s=0,o=0;a>o;o++)s+=Number(t.getAward().getDrop().getEquip()[o].getCount());this.ui.equipText.text=s+e.LanguageUtils.instance.getValue("JIAN");var r=Math.floor(t.getUseTime()%3600/60),l=Math.floor(t.getUseTime()%86400/3600),h=Math.floor(t.getUseTime()/86400),c=h>0?h+e.LanguageUtils.instance.getValue("DAY"):"",u=l>0?l+e.LanguageUtils.instance.getValue("HOUR"):"",p=r>0?r+e.LanguageUtils.instance.getValue("MINUTES"):"0"+e.LanguageUtils.instance.getValue("MINUTES");this.ui.offLineTImeText.text=c+u+p,this.ui.coinText.text=t.getAward().getCoin().toString(),this.ui.expText.text=t.getAward().getExp().toString(),this.ui.upLevelText.textFlow=(new egret.HtmlTextParser).parser(i>0?e.LanguageUtils.instance.getValue("LIXIANSHENGJI",i):e.LanguageUtils.instance.getValue("LIXIANMEISHENGJI"))}},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.close,this),this.doScreenAdaptation()},i.prototype.getlist=function(){var e=[];return e.push(this.ui.itemnum0),e.push(this.ui.itemnum1),e},i}(e.BasePanel);e.OffLineYieldPanel=t,__reflect(t.prototype,"foxgame.OffLineYieldPanel",["foxgame.IOffLineYield","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.OtherCharacterModel,this.panel=new e.OtherCharacterPanel(this.model)}return t.prototype.registerMsg=function(t){t.add(e.Code.SEE_OTHER_PLAYER_INFO_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.SEE_OTHER_PLAYER_INFO_S:this.receiveInfos(i)}},t.prototype.receiveInfos=function(e){this.model.setOtherInfo(e)},t.prototype.showOtherCharacterPanel=function(t,i,n){void 0===t&&(t=-1),void 0===i&&(i=""),void 0===n&&(n=0);var o=HawkProtocolManager.newBuilder("JsProto.HPSeeOtherPlayerInfo");""!=i&&o.setPlayerIdentify(i),-1!=t&&o.setPlayerId(t),0!=n&&o.setPlayType(n),e.Message.instance.send(e.Code.SEE_OTHER_PLAYER_INFO_C,o,!0),this.panel.show()},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();e.OtherCharacterController=t,__reflect(t.prototype,"foxgame.OtherCharacterController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.equipTypes1=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES],i.equipTypes2=[e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],i.equipTypes3=[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],i.skinName="CharacterEquipViewSkin",i}return __extends(i,t),i.prototype.init=function(e){this.model=e,this.equipItemList=[this.itemEquip1,this.itemEquip2,this.itemEquip3,this.itemEquip4,this.itemEquip5,this.itemEquip6,this.itemEquip7,this.itemEquip8,this.itemEquip9,this.itemEquip10],this.suitItemList=[this.itemSuit1,this.itemSuit2,this.itemSuit3,this.itemSuit4],this.godlyItemList=[this.itemGodly0,this.itemGodly1,this.itemGodly2],this.specialRingList=[this.itemSpecialRing1,this.itemSpecialRing2,this.itemSpecialRing3,this.itemSpecialRing4],this.labelDetail.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.labelDetail.text+"</u>"),this.btnChangeEquip.visible=!1,this.downBtnGroup.visible=!1;for(var t,i=this.equipItemList.length,n=0;i>n;n++)t=this.equipItemList[n],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.equipClickHandler,this);i=this.suitItemList.length;for(var n=0;i>n;n++)t=this.suitItemList[n],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.suitClickHandler,this);i=this.godlyItemList.length;for(var n=0;i>n;n++)t=this.godlyItemList[n],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.godlyClickHandler,this);i=this.specialRingList.length;for(var n=0;i>n;n++)t=this.specialRingList[n],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.specialRingHandler,this);this.btnJueWei.visible=!1,this.btnSkill.visible=!1,this.btnGem.visible=!1,this.btnGodly.visible=!1,this.suitBtnGroup.visible=!1},i.prototype.refresh=function(){var t=this.model.roleData;e.CharacterController.getInstance().showcharavatar(this.avatar,t);for(var i,n,o,a,s,r,l=this.equipItemList.length,h=0;l>h;h++){n=this.equipItemList[h],s=this.equipTypes1[h];var c=this.getEquipInfoByPart(s);i=t.getRoleEquipByPart(s),o=this.model.getCellInfoByRoleIdAndPart(t.roleId,s),a=null!=i?i.getEquipItemId():-1;var u=null!=i?i.getEquipId():-1;n.setEquip(a,s,o,u,!0,c),r=this.getEquipTemplate()[a]}l=this.suitItemList.length;for(var h=0;l>h;h++)n=this.suitItemList[h],s=this.equipTypes2[h],i=t.getRoleEquipByPart(s),a=null!=i?i.getEquipItemId():-1,n.setSuit(a,s);l=this.godlyItemList.length;for(var h=0;l>h;h++)n=this.godlyItemList[h],s=this.equipTypes3[h],i=t.getRoleEquipByPart(s),a=null!=i?i.getEquipItemId():-1,n.setGodly(a,t.profession,s);var p,g=t.getSpecialRingLvList();l=g.length;for(var h=0;h<g.length;h++)p=this.specialRingList[h],p.setSpecialRing(h,g[h])},i.prototype.equipClickHandler=function(t){var i=this.equipItemList.indexOf(t.currentTarget),n=this.equipTypes1[i],o=this.getEquipInfoByPart(n);if(null!=o){var a=this.model.getCellInfoByRoleIdAndPart(this.model.roleData.roleId,n),s={profession:this.model.roleData.profession,equipInfo:o,cellInfo:a,showReplace:!1,showLock:!1};e.TipsController.getInstance().showEquipTips(s)}},i.prototype.getEquipInfoByPart=function(e){for(var t,i=this.model.roleData,n=i.getRoleEquips(),o=n.length,a=0;o>a;a++)if(n[a].getPart()==e){t=n[a];break}if(!t)return null;var s=this.model.otherInfo.getPlayerInfo().getEquipInfo();o=s.length;for(var a=0;o>a;a++)if(Number(s[a].getId())==Number(t.getEquipId()))return s[a];return null},i.prototype.suitClickHandler=function(t){var i=this.suitItemList.indexOf(t.currentTarget),n=this.equipTypes2[i],o=this.getEquipInfoByPart(n);if(null!=o){var a=this.model.getCellInfoByRoleIdAndPart(this.model.roleData.roleId,n),s={profession:this.model.roleData.profession,equipInfo:o,cellInfo:a,showReplace:!1,showLock:!1};e.TipsController.getInstance().showEquipTips(s)}},i.prototype.godlyClickHandler=function(t){var i=this.godlyItemList.indexOf(t.currentTarget),n=this.equipTypes3[i],o=this.getEquipInfoByPart(n);if(null!=o){var a=this.model.getCellInfoByRoleIdAndPart(this.model.roleData.roleId,n),s={profession:this.model.roleData.profession,equipInfo:o,cellInfo:a,showReplace:!1,showLock:!1};e.TipsController.getInstance().showEquipTips(s)}},i.prototype.specialRingHandler=function(t){var i=this.specialRingList.indexOf(t.currentTarget),n=this.model.roleData.getSpecialRingLvList();if(!(n[i]<=0)){({index:i,roleId:this.model.roleData.roleId,lvList:this.model.roleData.getSpecialRingLvList(),isSelf:!1});e.CharacterController.getInstance().showSpecialRingPanel(i,this.model.roleData.roleId,this.model.roleData.getSpecialRingLvList(),!1)}},i.prototype.getEquipTemplate=function(){return e.JsonDataManager.instance.equipTemplate},i}(eui.Component);e.OtherCharacterEquipView=t,__reflect(t.prototype,"foxgame.OtherCharacterEquipView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.setOtherInfo=function(t){this.roleDataList=[],this.otherInfo=t;for(var i,n=this.otherInfo.getPlayerInfo().getRoles(),o=n.length,a=0;o>a;a++)i=new e.RoleData,i.setRoleInfo(n[a]),this.roleDataList.push(i);var s;o=this.observerList.length;for(var a=0;o>a;a++)s=this.observerList[a],s.getIsShow()&&s.playerInfoBack()},t.prototype.getCellInfoByRoleIdAndPart=function(e,t){for(var i,n=this.roleDataList.length,o=0;n>o;o++)if(this.roleDataList[o].roleId==e){i=this.roleDataList[o];break}if(null==i)return null;var a,s,r=this.otherInfo.getPlayerInfo().getCellsInfo();n=r.length;for(var o=0;n>o;o++)if(a=r[o],a.getRoleId()+""==e+""){s=a.getCellInfos();break}if(null==s)return null;var l;n=s.length;for(var o=0;n>o;o++)if(s[o].getCellId()+""==t+""){l=s[o];break}return l},t.prototype.getSoulInfoListByRoleId=function(e){var t,i=this.otherInfo.getPlayerInfo().getRoleSoulInfo(),n=i.length;if(0==i.length)return null;for(var o=0;n>o;o++)if(i[o].getRoleId()+""==e+""){t=i[o];break}return null==t?null:t.getGrooveInfo()},t}();e.OtherCharacterModel=t,__reflect(t.prototype,"foxgame.OtherCharacterModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.EQUIP=0]="EQUIP",e[e.DETAIL=2]="DETAIL"}(t||(t={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/otherCharacter/OtherCharacterPanelSkin.exml")||this;return t.model=e,t.isMask=!1,t.isMaskdown=!0,t.adaptionType=1,t}return __extends(n,i),n.prototype.initHook=function(){this.model.registerObserver(this),this.ui.equipView.btnGongMing.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gongmingHandler,this),this.ui.equipView.labelDetail.addEventListener(egret.TouchEvent.TOUCH_TAP,this.detailHandler,this),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.ui.equipView.init(this.model),this.doScreenAdaptation()},n.prototype.initParams=function(){this.playerInfoBack(),this.model.curViewIndex=t.EQUIP},n.prototype.refresh=function(){this.changeView(this.model.curViewIndex)},n.prototype.changeView=function(e){if(this.visible=!1,this.touchEnabled=!1,this.touchChildren=!1,null!=this.model.roleData){this.visible=!0,this.touchEnabled=!0,this.touchChildren=!0,this.model.curViewIndex=e;var i=this.ui.equipView,n=this.ui.detailView;i.visible=!1,n.visible=!1,e==t.EQUIP?(i.refresh(),i.visible=!0):e==t.DETAIL&&(n.refresh(this.model.roleData.attrList),n.visible=!0)}},n.prototype.backHandler=function(){this.model.curViewIndex==t.EQUIP?this.close():this.model.curViewIndex==t.DETAIL&&this.changeView(t.EQUIP)},n.prototype.setRoleData=function(e){this.model.roleData=e,this.refresh()},n.prototype.playerInfoBack=function(){null!=this.model.roleDataList&&this.model.roleDataList.length>0&&this.ui.headBar.setRoles(this.model.roleDataList,!1),this.refresh()},n.prototype.updateView=function(){},n.prototype.gongmingHandler=function(t){e.GongMingController.getInstance().showPanel(this.model.roleData)},n.prototype.detailHandler=function(e){this.changeView(t.DETAIL)},n}(e.BasePanel);e.OtherCharacterPanel=i,__reflect(i.prototype,"foxgame.OtherCharacterPanel",["foxgame.IOtherCharacter","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="SoulUpgradeView",t}return __extends(t,e),t.prototype.init=function(e){this.model=e,this.itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5];for(var t,i=this.itemList.length,n=0;i>n;n++)t=this.itemList[n],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.attrGroup.visible=!1,this.limitGroup.visible=!1},t.prototype.refresh=function(){for(var e,t,i=this.model.roleData,n=this.model.getSoulInfoListByRoleId(i.roleId),o=this.itemList.length,a=0;o>a;a++)e=this.itemList[a],t=null!=n?n[a]:null,e.setOtherItem(t,a),e.selected=0==a},t.prototype.itemClickHandler=function(e){var t=this.itemList.indexOf(e.currentTarget);this.selectItem(t)},t.prototype.selectItem=function(e){var t,i,n=this.itemList,o=n.length;for(t=0;o>t;t++)i=n[t],i.selected=t==e},t}(eui.Component);e.OtherCharacterSoulView=t,__reflect(t.prototype,"foxgame.OtherCharacterSoulView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var i=t.call(this)||this;i.contentList=[],i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addedToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeFromStage,i),i.touchEnabled=!1,i.touchChildren=!1;var n=e.GlobalConfig.instance;return i.startY=Number(n.getValue("ITEMFLOATPARAM1")),i.moveTime=Number(n.getValue("ITEMFLOATPARAM2")),i.existTime=Number(n.getValue("ITEMFLOATPARAM3")),i.gapTime=Number(n.getValue("ITEMFLOATPARAM4")),i.alphaTime=Number(n.getValue("ITEMFLOATPARAM5")),i}return __extends(i,t),i.prototype.addItem=function(t){this.lastTime=egret.getTimer(),this.contentList.push(t),null==this.parent&&e.Global.topLayer.addChild(this)},i.prototype.tickHandler=function(e){return this.tickPosition(e),this.tickAlpha(e),this.lastTime=e,!1},i.prototype.tickAlpha=function(t){if(0==this.numChildren)return void this.parent.removeChild(this);for(var i,n=t-this.lastTime,o=1/this.alphaTime,a=this.numChildren-1;a>=0;a--)i=this.getChildAt(a),t<i.getExitTime()||(i.alpha<=0?(i.parent.removeChild(i),i.alpha=1,e.ObjectPoolManager.instance.add(i)):i.alpha-=o*n)},i.prototype.tickPosition=function(t){for(var i,n=t-this.lastTime,o=this.numChildren,a=[],s=0;o>s;s++)i=this.getChildAt(s),a.push(i);if(i=a[a.length-1],null==i||i.getIsFinish()){var r,l,h=this.contentList.length;o=a.length;for(var s=0;o>s;s++)i=a[s],i.y=i.getTargetY(),r=i.y-h*i.height,l=(r-i.y)/this.moveTime,i.setTargetY(r),i.setSpeed(l);o=this.contentList.length;for(var s=0;o>s;s++)i=e.ObjectPoolManager.instance.get("FloatPanelItem2"),i.setItem(this.contentList[s]),i.alpha=1,r=this.startY-i.height*(o-s),l=(r-this.startY)/this.moveTime,i.setTargetY(r),i.setSpeed(l),i.setExitTime(t+this.existTime+s*this.gapTime),i.x=0,i.y=this.startY,this.addChild(i);this.contentList=[]}else{o=a.length;for(var s=0;o>s;s++)i=a[s],i.y+=i.getSpeed()*n}},i.prototype.addedToStage=function(e){egret.startTick(this.tickHandler,this)},i.prototype.removeFromStage=function(e){egret.stopTick(this.tickHandler,this)},i}(egret.DisplayObjectContainer);e.FloatPanel2=t,__reflect(t.prototype,"foxgame.FloatPanel2")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._height=47,t._width=334,t.skinName="FloatPopUp2",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.isInit=!0,null!=this.content&&this.setItem(this.content)},t.prototype.setItem=function(e){this.content=e,0!=this.isInit&&(this.contentLabel.textFlow=e)},t.prototype.setTargetY=function(e){this.targetY=e},t.prototype.getTargetY=function(){return this.targetY},t.prototype.setSpeed=function(e){this.speed=e},t.prototype.getSpeed=function(){return this.speed},t.prototype.setExitTime=function(e){this.exitTime=e},t.prototype.getExitTime=function(){return this.exitTime},t.prototype.getIsFinish=function(){return this.y<=this.targetY},Object.defineProperty(t.prototype,"width",{get:function(){return this.isInit?e.prototype.$getWidth.call(this):this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){var t;return t=this.isInit?e.prototype.$getHeight.call(this):this._height},enumerable:!0,configurable:!0}),t}(eui.Component);e.FloatPanelItem2=t,__reflect(t.prototype,"foxgame.FloatPanelItem2")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/common/FloatPopUp1.exml")||this;return e.isMask=!1,e.isCenter=!1,e.setIsShowBackBtn(!1),e.setIsShowTween(!1),e.setEffect(!1),e.setRegisterTick(!0),e.layer=LayerType.TOPLAYER,e.isCallHideSceneObjectsWhenClose=!1,e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(i,t),i.prototype.showPanel=function(e){this.content=e,this.show()},i.prototype.initHook=function(){this.tweenParams={y1:.8,scale1:.5,alpha1:.5,y2:.65,scale2:1,alpha2:1,stayTime2:1,time2:.5,y3:.55,scale3:1,alpha3:0,time3:1},e.GamePlatform.isQQdating&&(this.tweenParams={y1:.65,scale1:.5,alpha1:.1,y2:.3,scale2:1,alpha2:1,stayTime2:.8,time2:.5,y3:.1,scale3:1,alpha3:.5,time3:.5}),this.gap=Number(e.GlobalConfig.instance.getValue("FLOATPROMPTGAP")),this.ui.contentLabel.minWidth=Number(e.GlobalConfig.instance.getValue("FLOATPROMPTMINWIDTH"))-2*this.gap,this.ui.contentLabel.maxWidth=Number(e.GlobalConfig.instance.getValue("FLOATPROMPTMAXWIDTH"))-2*this.gap,this.htmlParser=new egret.HtmlTextParser,this.ui.contentLabel.x=this.gap,this.ui.contentLabel.y=this.gap,this.stateManager=new e.FloatPromptStateManager},i.prototype.initParams=function(){this.stateManager.changeState(new e.FloatPromptIdleState(this))},i.prototype.refresh=function(){var e=this.ui.contentLabel;e.textFlow=this.htmlParser.parser(this.content);e.width<e.minWidth-2*this.gap?this.ui.width=e.x+e.minWidth+this.gap:e.width>e.maxWidth-2*this.gap?this.ui.width=e.x+e.maxWidth+this.gap:this.ui.width=e.x+e.width+this.gap,this.ui.height=e.y+e.height+this.gap,this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1},i.prototype.showHook=function(){this.x=ScreenAdaptation.instance.screenWidth>>1,this.stateManager.changeState(new e.FloatPromptTweenState1(this))},i.prototype.tickHook=function(e){this.stateManager.updateState()},i.prototype.enterState1=function(){this.y=ScreenAdaptation.instance.screenWidth*Number(this.tweenParams.y1),this.scaleX=Number(this.tweenParams.scale1),this.scaleY=Number(this.tweenParams.scale1),this.alpha=Number(this.tweenParams.alpha1);var e={y:ScreenAdaptation.instance.screenWidth*Number(this.tweenParams.y2),scaleX:Number(this.tweenParams.scale2),scaleY:Number(this.tweenParams.scale2),alpha:Number(this.tweenParams.alpha2),ease:Cubic.easeOut,onComplete:this.tween1Complete,onCompleteParams:[this]};TweenMax.to(this,Number(this.tweenParams.time2),e)},i.prototype.tween1Complete=function(t){TweenMax.killTweensOf(t),t.stateManager.changeState(new e.FloatPromptTweenState2(t))},i.prototype.updateState1=function(){},i.prototype.exitState1=function(){},i.prototype.enterState2=function(){this.stayTime=egret.getTimer()},i.prototype.updateState2=function(){egret.getTimer()-this.stayTime>=1e3*Number(this.tweenParams.stayTime2)&&this.stateManager.changeState(new e.FloatPromptTweenState3(this))},i.prototype.enterState3=function(){var t={y:e.Global.stageHeight*Number(this.tweenParams.y3),scaleX:Number(this.tweenParams.scale3),scaleY:Number(this.tweenParams.scale3),alpha:Number(this.tweenParams.alpha3),ease:Cubic.easeOut,onComplete:this.tween3Complete,onCompleteParams:[this]};TweenMax.to(this,Number(this.tweenParams.time3),t)},i.prototype.tween3Complete=function(e){TweenMax.killTweensOf(e),e.close()},i.prototype.updateState3=function(){},i.prototype.exitState3=function(){},i.prototype.closeHook=function(){e.PopUpController.getInstance().collectFloatPanel(this)},i}(e.BasePanel);e.FloatPromptPanel1=t,__reflect(t.prototype,"foxgame.FloatPromptPanel1")}(foxgame||(foxgame={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.callDocumentJsFunc=null,t.textField=null,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.setCallDocumentJsFunc=function(e){this.callDocumentJsFunc=e},t.prototype.createView=function(){this.x=this.y=0,this.width=foxgame.Global.stageWidth,this.height=foxgame.Global.stageHeight,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=600,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE,this.textField.width=640,this.textField.height=100,this.textField.textAlign=egret.HorizontalAlign.CENTER},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t.prototype.show=function(){null==this.textField&&this.createView(),this.visible=!0},t.prototype.hide=function(){this.visible=!1,this.callDocumentJsFunc&&this.callDocumentJsFunc()},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var foxgame;!function(e){var t=function(){function e(){}return e}();e.PopUpModel=t,__reflect(t.prototype,"foxgame.PopUpModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/common/PopUp1.exml",null,!1)||this;return e.cancelType=0,e.confirmType=1,e.isMask=!0,e.layer=LayerType.UILAYER,e.isCallHideSceneObjectsWhenClose=!1,e.setIsShowBackBtn(!0),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(t,i,n,o,a,s,r,l,h,c,u){void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===l&&(l=null),void 0===h&&(h=20),void 0===c&&(c=!0),void 0===u&&(u=!0),this.content=t,this.target=i,this.confirmBack=n,this.confirmParam=o,this.cancelBack=a,this.confirmName=r,this.cancelName=l,this.textSizeNum=h,this.isShowCancel=c,-1!=t.indexOf("根据广电总署发布的相关通知规定")&&this.setIsTouchClose(!1),null!=r&&"hide"==r&&(this.ui.confirmGroup.visible=!1),this.setIsShowBackBtn(u),-1!=e.UserInfo.platform.prefix.indexOf("bagfquick")&&-1!=t.indexOf("您的账号在其它设备上登录")&&(this.setIsTouchClose(!1),this.isShowCancel=!1,this.setIsShowBackBtn(!1)),this.show()},i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandler,this),this.ui.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelHandler,this),this.htmlParser=new egret.HtmlTextParser,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.baseConfirmX=this.ui.confirmGroup.x},i.prototype.initParams=function(){this.ui.scroller.viewport.scrollV=0,this.operation=this.cancelType},i.prototype.refresh=function(){null==this.confirmName&&(this.confirmName=e.LanguageUtils.instance.getValue("QUEDING")),this.confirmName&&(this.ui.confirmBtn.label=this.confirmName),null==this.cancelName&&(this.cancelName=e.LanguageUtils.instance.getValue("QUXIAO")),this.cancelName&&(this.ui.cancelBtn.label=this.cancelName),this.ui.contentLabel.textFlow=this.htmlParser.parser(this.content),this.ui.contentLabel.size=this.textSizeNum,this.ui.cancelGroup.visible=this.isShowCancel,0==this.isShowCancel?this.ui.confirmGroup.x=this.width-this.ui.confirmBtn.width>>1:this.ui.confirmGroup.x=this.baseConfirmX},i.prototype.confirmHandler=function(e){this.operation=this.confirmType,this.close();var t=this.confirmParam;this.operation==this.confirmType?null!=this.confirmBack&&this.confirmBack.call(this.target,t):this.operation==this.cancelType&&null!=this.cancelBack&&this.cancelBack.call(this.target,t)},i.prototype.cancelHandler=function(e){this.operation=this.cancelType,this.close();var t=this.confirmParam;this.operation==this.confirmType?null!=this.confirmBack&&this.confirmBack.call(this.target,t):this.operation==this.cancelType&&null!=this.cancelBack&&this.cancelBack.call(this.target,t)},i}(e.BasePanel);e.TextPromptPanel=t,__reflect(t.prototype,"foxgame.TextPromptPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/common/PopUp2.exml",null,!1)||this;return e.cancelType=0,e.confirmType=1,e.isMask=!0,e.layer=LayerType.TOPLAYER,e.isCallHideSceneObjectsWhenClose=!1,e.setIsShowBackBtn(!1),e}return __extends(i,t),i.prototype.showPanel=function(e,t,i,n,o,a,s,r,l,h){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===l&&(l=20),void 0===h&&(h=!0),this.content=e,this.target=t,this.confirmBack=i,this.confirmParam=n,this.cancelBack=o,this.confirmName=s,this.cancelName=r,this.textSizeNum=l,this.isShowCancel=h,this.show()},i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandler,this),this.ui.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelHandler,this),this.ui.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickcheckBox,this),this.htmlParser=new egret.HtmlTextParser,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.baseConfirmX=this.ui.confirmGroup.x},i.prototype.clickcheckBox=function(e){this.ui.checkBoxBtn.currentState="up"==this.ui.checkBoxBtn.currentState?"down":"up"},i.prototype.initParams=function(){this.ui.scroller.viewport.scrollV=0,this.operation=this.cancelType},i.prototype.refresh=function(){null==this.confirmName&&(this.confirmName=e.LanguageUtils.instance.getValue("QUEDING")),this.confirmName&&(this.ui.confirmBtn.label=this.confirmName),null==this.cancelName&&(this.cancelName=e.LanguageUtils.instance.getValue("QUXIAO")),this.cancelName&&(this.ui.cancelBtn.label=this.cancelName),this.ui.contentLabel.textFlow=this.htmlParser.parser(this.content),this.ui.contentLabel.size=this.textSizeNum,this.ui.cancelGroup.visible=this.isShowCancel,0==this.isShowCancel?this.ui.confirmGroup.x=this.width-this.ui.confirmBtn.width>>1:this.ui.confirmGroup.x=this.baseConfirmX},i.prototype.confirmHandler=function(e){this.operation=this.confirmType,this.confirmParam="down"==this.ui.checkBoxBtn.currentState,this.close();
var t=this.confirmParam;this.operation==this.confirmType&&null!=this.confirmBack&&this.confirmBack.call(this.target,t)},i.prototype.cancelHandler=function(e){this.operation=this.cancelType,this.ui.checkBoxBtn.currentState="up",this.close();var t=this.confirmParam;this.operation==this.confirmType?null!=this.confirmBack&&this.confirmBack.call(this.target,t):this.operation==this.cancelType&&null!=this.cancelBack&&this.cancelBack.call(this.target,t)},i}(e.BasePanel);e.TextPromptPanel2=t,__reflect(t.prototype,"foxgame.TextPromptPanel2")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){this.context=e}return e.prototype.enter=function(){},e.prototype.update=function(){},e.prototype.exit=function(){},e.prototype.getType=function(){return-1},e}();e.FloatPromptIdleState=t,__reflect(t.prototype,"foxgame.FloatPromptIdleState",["foxgame.IState"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.changeState=function(e){null!=this.state&&this.state.exit(),this.state=e,this.state.enter()},e.prototype.updateState=function(){this.state.update()},e.STATE1=1,e.STATE2=2,e.STATE3=3,e}();e.FloatPromptStateManager=t,__reflect(t.prototype,"foxgame.FloatPromptStateManager")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(e){this.context=e}return t.prototype.enter=function(){this.context.enterState1()},t.prototype.update=function(){this.context.updateState1()},t.prototype.exit=function(){this.context.exitState1()},t.prototype.getType=function(){return e.FloatPromptStateManager.STATE1},t}();e.FloatPromptTweenState1=t,__reflect(t.prototype,"foxgame.FloatPromptTweenState1",["foxgame.IState"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(e){this.context=e}return t.prototype.enter=function(){this.context.enterState2()},t.prototype.update=function(){this.context.updateState2()},t.prototype.exit=function(){},t.prototype.getType=function(){return e.FloatPromptStateManager.STATE2},t}();e.FloatPromptTweenState2=t,__reflect(t.prototype,"foxgame.FloatPromptTweenState2",["foxgame.IState"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(e){this.context=e}return t.prototype.enter=function(){this.context.enterState3()},t.prototype.update=function(){this.context.updateState3()},t.prototype.exit=function(){},t.prototype.getType=function(){return e.FloatPromptStateManager.STATE3},t}();e.FloatPromptTweenState3=t,__reflect(t.prototype,"foxgame.FloatPromptTweenState3",["foxgame.IState"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerChooseViewSkin.exml")||this;return i.currentSelect=0,i.model=e,i.currentSelect=-1,i.startShuaXin=!1,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.doScreenAdaptation(),this.model.registerObserver(this)},i.prototype.panelChanged=function(){this.getIsInit()&&this.getIsShow()&&this.initUI()},i.prototype.initUI=function(){this.initListener(),this.groupList=[this.ui.select_1,this.ui.select_2,this.ui.select_3,this.ui.select_4],this.groupListChoose=[this.ui.choose_1,this.ui.choose_2,this.ui.choose_3,this.ui.choose_4],this.currentData=this.model.getPrisonerJieQuData(),-1!=this.currentSelect&&this.currentSelect!=this.currentData.getPrisonerLevel()-1?e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_PRISONERUP")):-1!=this.currentSelect&&this.startShuaXin&&(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_PRISONERNORMAL")),this.startShuaXin=!1),this.currentSelect=this.currentData.getPrisonerLevel()-1,this.setSelect(this.currentSelect),this.ui.yajieNum.text=this.currentData.getEscortNumber()+"/"+e.GlobalConfig.instance.getValue("ESCORT_PRISONE_REFRESH_NUMBER"),0==this.currentData.getRefreshNumber()?(this.ui.freeYuanBao.visible=!0,this.ui.shuaxinTxt.text=e.LanguageUtils.instance.getValue("XIAOHAO"),this.ui.shuaxinNum.text=e.GlobalConfig.instance.getValue("ESCORT_PRISONE_REFRESH")):(this.ui.freeYuanBao.visible=!1,this.ui.shuaxinTxt.text=e.LanguageUtils.instance.getValue("FREE"),this.ui.shuaxinNum.text=this.currentData.getRefreshNumber()+e.LanguageUtils.instance.getValue("CI")),this.ui.costNum.text=e.GlobalConfig.instance.getValue("ESCORT_PRISONE_ONE_REFRESH"),this.changeChoose(this.currentData.getPrisonerLevel())},i.prototype.setSelect=function(e){var t=0,i=this.groupList.length;for(t;i>t;t++)t==e?(this.groupList[t].visible=!0,this.groupListChoose[t].visible=!0,this.currentSelect=t):(this.groupList[t].visible=!1,this.groupListChoose[t].visible=!1)},i.prototype.readyDestroy=function(){this.ui.kaishiyajieBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.shuaxinBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.yijianBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.PrisonerController.getInstance().playTick()},i.prototype.initListener=function(){this.ui.kaishiyajieBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.shuaxinBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.yijianBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.group_4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i=e.PlayerService.instance.playerInfo.getGold(),n=0;switch(t.target){case this.ui.kaishiyajieBtn:this.currentData.getEscortNumber()>0?this.startYajie():e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CISHUBUZU"));break;case this.ui.shuaxinBtn:if(4==this.currentData.getPrisonerLevel())return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_FINAL"));if(0==this.currentData.getRefreshNumber()&&(n=Number(e.GlobalConfig.instance.getValue("ESCORT_PRISONE_REFRESH")),n>i))return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.shuaxin();break;case this.ui.yijianBtn:if(n=Number(e.GlobalConfig.instance.getValue("ESCORT_PRISONE_ONE_REFRESH")),n>i)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.yijian();break;case this.ui.itemIcon1:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[0].id,this.attVo[0].type,this.attVo[0].value);break;case this.ui.itemIcon2:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[1].id,this.attVo[1].type,this.attVo[1].value);break;case this.ui.itemIcon3:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[2].id,this.attVo[2].type,this.attVo[2].value);break;case this.ui.group_1:this.changeChoose(1);break;case this.ui.group_2:this.changeChoose(2);break;case this.ui.group_3:this.changeChoose(3);break;case this.ui.group_4:this.changeChoose(4)}},i.prototype.changeChoose=function(t){var i=e.JsonDataManager.instance.prisonerAwardTemPlate,n=i[t-1];this.attVo=[],this.attVo=n.awardList,this.ui.itemIcon1.setItem(this.attVo[0].id,this.attVo[0].value,!0),this.ui.itemIcon2.setItem(this.attVo[1].id,this.attVo[1].value,!0),this.attVo.length>2?(this.ui.itemIcon3.visible=!0,this.ui.lveduoImg.visible=!0,this.ui.itemIcon3.setItem(this.attVo[2].id,this.attVo[2].value,!0)):(this.ui.itemIcon3.visible=!1,this.ui.lveduoImg.visible=!1);var o=0,a=this.groupList.length;for(o;a>o;o++)this.groupList[o].visible=!1;this.groupList[t-1].visible=!0},i.prototype.shuaxin=function(){this.startShuaXin=!0,e.PrisonerController.getInstance().shuaxinInfo()},i.prototype.startYajie=function(){e.PrisonerController.getInstance().startYaJie(),this.close()},i.prototype.yijian=function(){e.PrisonerController.getInstance().yijianshuaxinInfo()},i.prototype.showHook=function(){this.model.getPrisonerJieQuData()&&(this.currentSelect=-1,this.initUI())},i}(e.BasePanel);e.PrisonerChooseView=t,__reflect(t.prototype,"foxgame.PrisonerChooseView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.currentStr="",this.model=new e.PrisonerModel,this.panel=new e.PrisonerMainView(this.model),this.awardPanel=new e.PrisonerGetAwardView(this.model),this.choosePanel=new e.PrisonerChooseView(this.model),this.lveDuoPanel=new e.PrisonerLveDuoView(this.model),this.lveDuoSPanel=new e.PrisonerLveDuoSucessViw(this.model),this.fuchouPanel=new e.PrisonerFuChouView(this.model),this.fuchouSPanel=new e.PrisonerFuChouSucessView(this.model),this.showLogPanel=new e.PrisonerShowLogView(this.model)}return t.prototype.registerMsg=function(t){t.add(e.Code.ESCORT_PRISONER_INFO_S,this),t.add(e.Code.ESCORT_PRISONER_ACCESS_AWAY_S,this),t.add(e.Code.START_ESCORT_PRISONER_S,this),t.add(e.Code.ESCORT_PRISONER_REFRESH_QUALITY_S,this),t.add(e.Code.ESCORT_PRISONER_ONE_REFRESH_S,this),t.add(e.Code.ESCORT_PRISONER_RECEIVE_AWARD_INFO_S,this),t.add(e.Code.ESCORT_QUICKLY_PRISONER_S,this),t.add(e.Code.ESCORT_PRISONER_PLUNDER_S,this),t.add(e.Code.ESCORT_PRISONER_RECEIVE_AWARD_S,this),t.add(e.Code.ESCORT_ANOTHER_BATCH_S,this),t.add(e.Code.ESCORT_PRISONER_LOG_INFO_S,this),t.add(e.Code.ESCORT_PRISONER_VENGEANCE_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ESCORT_PRISONER_INFO_S:this.model.setPrisonerInfoData(i);break;case e.Code.ESCORT_PRISONER_ACCESS_AWAY_S:this.model.setPrisonerJieQuData(i);break;case e.Code.START_ESCORT_PRISONER_S:this.model.setYaJieState(i);break;case e.Code.ESCORT_PRISONER_REFRESH_QUALITY_S:this.model.setShuaXinState(i);break;case e.Code.ESCORT_PRISONER_ONE_REFRESH_S:this.model.setYiJianShuaXinState(i);break;case e.Code.ESCORT_PRISONER_RECEIVE_AWARD_INFO_S:!this.awardPanel.getIsShow()&&this.panel.getIsShow()&&this.awardPanel.show(),this.model.setAwardInfo(i);break;case e.Code.ESCORT_QUICKLY_PRISONER_S:this.model.setKuaiSuWanCheng(i);break;case e.Code.ESCORT_PRISONER_PLUNDER_S:this.model.setLveDuoData(i);break;case e.Code.ESCORT_PRISONER_RECEIVE_AWARD_S:this.model.getAward(i),this.sendMessageToSeverForPrisonerData();break;case e.Code.ESCORT_ANOTHER_BATCH_S:this.model.shuaxinData(i);break;case e.Code.ESCORT_PRISONER_LOG_INFO_S:this.model.setPrisonerLogData(i);break;case e.Code.ESCORT_PRISONER_VENGEANCE_S:this.model.setPrisonerFuChouData(i)}},t.prototype.setAwardUpDate=function(){this.awardPanel.getIsShow()&&this.awardPanel.updateView()},t.prototype.getCiShu=function(){if(!this.model.getPrisonerInfoData()||void 0==this.model.getPrisonerInfoData())return 0;var e=this.model.getPrisonerInfoData().getEscortNumber();return null==e&&(e=0),e},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.playTick=function(){this.panel.getIsShow()&&this.panel.setTick()},t.prototype.showPanel=function(e){void 0===e&&(e=""),this.panel.getIsShow()||this.panel.show(),this.currentStr=e,"lveduo"==this.currentStr&&this.model.getLveDuoData()?(this.currentStr=null,this.lveduoshenggongShowPanel()):"fuchou"==this.currentStr&&this.model.getPrisonerFuChouData()&&(this.currentStr=null,this.fuchoushenggongShowPanel()),this.sendMessageToSeverForPrisonerData(),this.panel.show()},t.prototype.sendMessageToSeverForPrisonerData=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerInfoReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_INFO_C,t,!0)},t.prototype.sendMessageToSeverForPrisonerJieShou=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerAccessAwayReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_ACCESS_AWAY_C,t,!0)},t.prototype.showJieShouPanel=function(){this.choosePanel.getIsShow()||this.choosePanel.show(),this.sendMessageToSeverForPrisonerJieShou()},t.prototype.getAwardMessage=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerAwardInfoReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_RECEIVE_AWARD_INFO_C,t,!0)},t.prototype.startYaJie=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPStartEscortPrisonerReq");e.Message.instance.send(e.Code.START_ESCORT_PRISONER_C,t,!0)},t.prototype.shuaxinInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerRefreshReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_REFRESH_QUALITY_C,t,!0)},t.prototype.yijianshuaxinInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerOneRefreshReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_ONE_REFRESH_C,t,!0)},t.prototype.sendMessageToSeverForKuaiSuWanCheng=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPQuicklyEscortPrisonerReq");e.Message.instance.send(e.Code.ESCORT_QUICKLY_PRISONER_C,t,!0)},t.prototype.showLveDuoPanel=function(e){this.lveDuoPanel.getIsShow()||(this.lveDuoPanel.setData(e),this.lveDuoPanel.show())},t.prototype.sendMessageToSeverForLveDuo=function(t){e.MainControler.instance.jingjiPvpChangeUI();var i=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerPlunderReq");i.setPlayerId(t),e.Message.instance.send(e.Code.ESCORT_PRISONER_PLUNDER_C,i,!0)},t.prototype.lveduoshenggongShowPanel=function(){this.lveDuoSPanel.getIsShow()||this.lveDuoSPanel.show()},t.prototype.lveduochenggongsetData=function(){"lveduo"==this.currentStr&&this.model.getLveDuoData()&&(this.currentStr=null,this.lveduoshenggongShowPanel())},t.prototype.showFuChouPanel=function(e,t){this.fuchouPanel.getIsShow()||(this.fuchouPanel.setData(e,t),this.fuchouPanel.show())},t.prototype.fuchoushenggongShowPanel=function(){if(!this.fuchouSPanel.getIsShow()){if(!this.model.getPrisonerFuChouData())return void this.model.setFucHOUShow();this.fuchouSPanel.show()}},t.prototype.lingquAward=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerAwardReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_RECEIVE_AWARD_C,t,!0)},t.prototype.getmyData=function(){return this.model.getPrisonerInfoData().getEscortList()&&this.model.getPrisonerInfoData().getEscortList().length>0?this.model.getPrisonerInfoData().getEscortList()[0]:null},t.prototype.closeAllPanel=function(){this.awardPanel.getIsShow()&&this.awardPanel.close(),this.choosePanel.getIsShow()&&this.choosePanel.close(),this.lveDuoPanel.getIsShow()&&this.lveDuoPanel.close(),this.fuchouPanel.getIsShow()&&this.fuchouPanel.close(),this.panel.getIsShow()&&this.panel.close(),this.showLogPanel.getIsShow()&&this.showLogPanel.close(),e.WanFaController.getInstance().closePanel()},t.prototype.changeList=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerListReq");e.Message.instance.send(e.Code.ESCORT_ANOTHER_BATCH_C,t,!0)},t.prototype.getPrisonerLog=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerLogReq");e.Message.instance.send(e.Code.ESCORT_PRISONER_LOG_INFO_C,t,!0),this.showLogPanel.getIsShow()||this.showLogPanel.show()},t.prototype.revengePeople=function(t,i){e.MainControler.instance.jingjiPvpChangeUI();var n=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerVengeanceReq");n.setPlayerId(t),n.setPositionId(i),e.Message.instance.send(e.Code.ESCORT_PRISONER_VENGEANCE_C,n,!0)},t.prototype.getLveDuoIsShow=function(){return this.lveDuoSPanel.getIsShow()},t.prototype.getFuChouIsShow=function(){return this.fuchouSPanel.getIsShow()},t.prototype.setLveDuoSTime=function(){this.lveDuoSPanel.updataTime()},t.prototype.setFuChouSTime=function(){this.fuchouSPanel.updataTime()},t}();e.PrisonerController=t,__reflect(t.prototype,"foxgame.PrisonerController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/prisoner/PrisonerDiTuViewSkin.exml",e.ready=!1,e.monsterArr=[null,null,null,null,null],e}return __extends(i,t),i.prototype.childrenCreated=function(){this.monsterArr=[null,null,null,null,null],this.initListener(),this.initUI(),this.ready=!0},i.prototype.setReady=function(e){this.ready=e},i.prototype.initUI=function(){if(void 0==this.mosterListData||0==this.mosterListData.length){var t=0,i=this.monsterArr.length;for(t;i>t;t++)null!=this.monsterArr[t]&&(this.monsterArr[t].cleanAni(),this.monsterArr[t]=null);return void this.aniGroup.removeChildren()}var n=0,o=0;for(o=this.mosterListData.length>=5?this.monsterArr.length:this.mosterListData.length,n;o>n;n++){var a=this.mosterListData[n],s=void 0;s=null==this.monsterArr[n]?new e.PrisonerMonster:this.monsterArr[n],s.setData(a,a.getStartTime(),a.getEndTime()),this.aniGroup.addChild(s),s.x=50-150*n,n%2==1?s.y=80:s.y=-160,s.setIndex(n),this.monsterArr[n]=s}if(5>n)for(n;5>n;n++)this.monsterArr[n]&&(this.monsterArr[n].cleanAni(),this.monsterArr[n].parent.removeChild(this.monsterArr[n]),this.monsterArr[n]=null)},i.prototype.setListData=function(e){this.mosterListData=[],this.mosterListData=e,this.ready&&this.initUI()},i.prototype.initListener=function(){},i.prototype.showQuestion=function(){},i.prototype.changeItem=function(e){if(void 0!=this.mosterListData&&0!=this.mosterListData.length){var t=[],i=0,n=this.mosterListData.length;for(i;n>i;i++)for(var o=this.mosterListData[i],a=0;a<this.monsterArr.length;a++){var s=this.monsterArr[a];null!=s&&s.getData().getId()!=o.getId()&&(t.data=o,t.id=a)}if(n=t.length,0!=n&&(i=Math.floor(Math.random()*n),t[i].data.getId()!=e.getIndex())){var r=this.monsterArr[t[i].id];e.setData(t[i].data,r.getStartTime(),r.getEndTime())}}},i.prototype.changeTime=function(){if(this.monsterArr&&this.monsterArr.length>0){var e=0,t=this.monsterArr.length;for(e;t>e;e++)null!=this.monsterArr[e]&&this.monsterArr[e].changeTime()}if(this.mosterListData&&this.mosterListData.length>0){var e=0,t=this.mosterListData.length,i=0;for(e;t>e;e++){var n=this.mosterListData[e];i=Number(n.getStartTime()),i+=1e3,n.setStartTime(i)}}},i.prototype.updateTime=function(){this.top1&&this.ready&&(this.top1.x-=1.5,this.top2.x-=1.5,this.mid1.x-=4,this.mid2.x-=4,this.down1.x-=10,this.down2.x-=10,this.top1.x<-622&&(this.top1.x=622+this.top2.x),this.top2.x<-this.top2.width&&(this.top2.x=this.top1.width+this.top1.x),this.mid1.x<-622&&(this.mid1.x=622+this.mid2.x),this.mid2.x<-622&&(this.mid2.x=622+this.mid1.x),this.down1.x<-622&&(this.down1.x=622+this.down2.x),this.down2.x<-622&&(this.down2.x=622+this.down1.x));var e=0,t=this.monsterArr.length;for(e;t>e;e++){var i=this.monsterArr[e];null!=i&&(i.x<=10+this.aniGroup.width?i.x+=2:(this.changeItem(i),i.x=-i.width))}},i}(eui.Component);e.PrisonerDiTuView=t,__reflect(t.prototype,"foxgame.PrisonerDiTuView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerFuChouSuccesViewSkin.exml")||this;return i.currentTime=4,i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.currentTime=4},i.prototype.updataTime=function(){this.currentTime--,this.ui.confirmBtn1.label=e.LanguageUtils.instance.getValue("QUEDINGJISHI",this.currentTime),this.currentTime<=0&&this.close()},i.prototype.initUI=function(){this.initListener(),this.awardArr=[null,null,null],this.currentData=this.model.getPrisonerFuChouData();var t=this.currentData.getAward().split(","),i=0,n=t.length;for(i;n>i;i++){var o=new e.AttributeVO(t[i]);this.awardArr[i]=o}var a=this.awardArr[0];a?(this.ui.itemIcon1.setItem(a.id,a.value,!0),this.ui.itemIcon1.visible=!0):this.ui.itemIcon1.visible=!1,a=this.awardArr[1],a?(this.ui.itemIcon2.setItem(a.id,a.value,!0),this.ui.itemIcon2.visible=!0):this.ui.itemIcon2.visible=!1,a=this.awardArr[2],a?(this.ui.itemIcon3.setItem(a.id,a.value,!0),this.ui.itemIcon3.visible=!0):this.ui.itemIcon3.visible=!1},i.prototype.readyDestroy=function(){this.ui.confirmBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.initListener=function(){this.ui.confirmBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.confirmBtn1:this.close();break;case this.ui.itemIcon1:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[0].id,this.attVo[0].type,this.attVo[0].value);break;case this.ui.itemIcon2:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[1].id,this.attVo[1].type,this.attVo[1].value);break;case this.ui.itemIcon3:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[2].id,this.attVo[2].type,this.attVo[2].value)}},i.prototype.showHook=function(){this.initUI()},i}(e.BasePanel);e.PrisonerFuChouSucessView=t,__reflect(t.prototype,"foxgame.PrisonerFuChouSucessView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerFuChouViewSkin.exml")||this;return i.currentSelect=0,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initUI=function(){if(this.currentData){this.initListener();var t=this.currentData.getItemId(),i=e.JsonDataManager.instance.roleTemplate[t];this.ui.prisonerIcon.source=i.icon,this.ui.prisonerName.text=this.currentData.getFoodId()+e.LanguageUtils.instance.getValue("QU"),this.ui.prisonerName1.text=this.currentData.getName()+"",this.ui.fightNum.text=this.currentData.getFight()+"",this.currentSelect=this.currentData.getPrisonerLevel()-1;var n=e.JsonDataManager.instance.prisonerAwardTemPlate,o=n[this.currentSelect];this.attVo=[],this.attVo=o.vengeanceAwardsList,this.ui.itemIcon1.setItem(this.attVo[0].id,this.attVo[0].value,!0),this.ui.itemIcon2.setItem(this.attVo[1].id,this.attVo[1].value,!0),this.ui.qiangduoTime.text=this.checkTime(),this.attVo.length>2?(this.ui.itemIcon3.visible=!0,this.ui.itemIcon3.setItem(this.attVo[2].id,this.attVo[2].value,!0)):this.ui.itemIcon3.visible=!1}},i.prototype.checkTime=function(){var t=new Date;t.setTime(this.currentData.getDataTime());var i=t.getMonth()+1+e.LanguageUtils.instance.getValue("YUE"),n=t.getDate()+e.LanguageUtils.instance.getValue("RI"),o=t.getHours()+":",a=t.getMinutes(),s=i+n+o+a;return s},i.prototype.setData=function(e,t){this.currentData=e,this.currentIndex=t},i.prototype.readyDestroy=function(){this.ui.confirmBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.initListener=function(){this.ui.confirmBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.confirmBtn1:this.startLveDuo();break;case this.ui.itemIcon1:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[0].id,this.attVo[0].type,this.attVo[0].value);break;case this.ui.itemIcon2:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[1].id,this.attVo[1].type,this.attVo[1].value);break;case this.ui.itemIcon3:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[2].id,this.attVo[2].type,this.attVo[2].value)}},i.prototype.startLveDuo=function(){e.PrisonerController.getInstance().closeAllPanel(),e.PrisonerController.getInstance().revengePeople(this.currentData.getPlayerId(),this.currentIndex)},i.prototype.showHook=function(){this.initUI()},i}(e.BasePanel);e.PrisonerFuChouView=t,__reflect(t.prototype,"foxgame.PrisonerFuChouView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="PrisonerGetAwardItemViewSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this.currentData=this.data,this.time.text=this.checkTime();var i="",n=this.currentData.getName(),o=this.CheckLevel(),a=this.currentData.getCoinNumber(),s=this.currentData.getExpNumber();i=e.LanguageUtils.instance.getValue("YAJIEQUTU_BEILUEDUO",n,o,a,s),this.msg.textFlow=(new egret.HtmlTextParser).parser(i)}},i.prototype.CheckLevel=function(){var t="";switch(this.currentData.getPrisonerLevel()){case 1:t=e.LanguageUtils.instance.getValue("QUTU1");break;case 2:t=e.LanguageUtils.instance.getValue("QUTU2");break;case 3:t=e.LanguageUtils.instance.getValue("QUTU3");break;case 4:t=e.LanguageUtils.instance.getValue("QUTU4")}return t},i.prototype.checkTime=function(){var t=this.currentData.getDataTime(),i=new Date;i.setTime(t);var n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),s=i.getHours(),r=i.getMinutes(),l=n+e.LanguageUtils.instance.getValue("NIAN")+o+e.LanguageUtils.instance.getValue("YUE")+a+e.LanguageUtils.instance.getValue("RI")+" "+s+":"+r;return l},i}(eui.ItemRenderer);e.PrisonerGetAwardItemView=t,__reflect(t.prototype,"foxgame.PrisonerGetAwardItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerGetAwardViewSkin.exml")||this;return i.currentSelect=0,i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.doScreenAdaptation(),this.model.registerObserver(this)},i.prototype.panelChanged=function(){!this.getIsInit()||!this.getIsShow()},i.prototype.updateView=function(){this.initUI()},i.prototype.initUI=function(){this.initListener(),this.currentData=this.model.getAwardInfo(),this.currentSelect=this.currentData.getPrisonerLevel();var t=e.JsonDataManager.instance.prisonerAwardTemPlate,i=t[this.currentSelect-1];this.attVo=[],this.attVo=i.awardList,this.ui.itemIcon1.setItem(this.attVo[0].id,this.attVo[0].value,!0),this.ui.itemIcon2.setItem(this.attVo[1].id,this.attVo[1].value,!0),this.attVo.length>2?(this.ui.itemIcon3.visible=!0,this.ui.itemIcon3.setItem(this.attVo[2].id,this.attVo[2].value,!0),this.ui.itemIcon1.x=230,this.ui.itemIcon2.x=350):(this.ui.itemIcon3.visible=!1,this.ui.itemIcon1.x=290,this.ui.itemIcon2.x=410),this.ui.prisonerName.textFlow=(new egret.HtmlTextParser).parser(this.checkName(this.currentSelect)),this.ui.prisonerIcon.source=i.icon,this.checkRiZhi(),this.ui.confirmBtn1.visible==this.ui.confirmBtn1.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.checkRiZhi=function(){var t=this.currentData.getPrisonerLogList(),i=0,n=[],o=t.length;for(i;o>i;i++)2==t[i].getTypeId()&&n.push(t[i]);var a=this.ui.scroller;a.viewport.scrollV=0;var s=this.ui.list;this.model.collection.source=[],s.dataProvider=this.model.collection,s.itemRenderer=e.PrisonerGetAwardItemView,this.model.collection.replaceAll(n)},i.prototype.checkName=function(t){var i="";switch(t){case 1:i=e.LanguageUtils.instance.getValue("QUTU1");break;case 2:i=e.LanguageUtils.instance.getValue("QUTU2");break;case 3:i=e.LanguageUtils.instance.getValue("QUTU3");break;case 4:i=e.LanguageUtils.instance.getValue("QUTU4")}return i},i.prototype.readyDestroy=function(){this.ui.confirmBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.PrisonerController.getInstance().playTick()},i.prototype.initListener=function(){this.ui.confirmBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.confirmBtn1:e.PrisonerController.getInstance().lingquAward(),this.close();break;case this.ui.itemIcon1:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[0].id,this.attVo[0].type,this.attVo[0].value);break;case this.ui.itemIcon2:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[1].id,this.attVo[1].type,this.attVo[1].value);break;case this.ui.itemIcon3:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[2].id,this.attVo[2].type,this.attVo[2].value)}},i.prototype.showHook=function(){this.model.getAwardInfo()&&this.initUI()},i}(e.BasePanel);e.PrisonerGetAwardView=t,__reflect(t.prototype,"foxgame.PrisonerGetAwardView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerLveDuoSuccesViewSkin.exml")||this;return i.currentTime=4,i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i.awardArr=[null,null,null],i}return __extends(i,t),i.prototype.initHook=function(){this.currentTime=4},i.prototype.updataTime=function(){this.currentTime--,this.ui.confirmBtn1.label=e.LanguageUtils.instance.getValue("QUEDINGJISHI",this.currentTime),this.currentTime<=0&&this.close()},i.prototype.setData=function(){this.initUI()},i.prototype.initUI=function(){if(this.initListener(),this.awardArr=[null,null,null],this.currentData=this.model.getLveDuoData(),this.currentData){var t=this.currentData.getAward().split(","),i=0,n=t.length;for(i;n>i;i++){var o=new e.AttributeVO(t[i]);this.awardArr[i]=o}var a=this.awardArr[0];a?(this.ui.itemIcon1.setItem(a.id,a.value,!0),this.ui.itemIcon1.visible=!0):this.ui.itemIcon1.visible=!1,a=this.awardArr[1],a?(this.ui.itemIcon2.setItem(a.id,a.value,!0),this.ui.itemIcon2.visible=!0):this.ui.itemIcon2.visible=!1,a=this.awardArr[2],a?(this.ui.itemIcon3.setItem(a.id,a.value,!0),this.ui.itemIcon3.visible=!0):this.ui.itemIcon3.visible=!1}},i.prototype.readyDestroy=function(){this.ui.confirmBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)
},i.prototype.initListener=function(){this.ui.confirmBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.confirmBtn1:this.close();break;case this.ui.itemIcon1:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[0].id,this.attVo[0].type,this.attVo[0].value);break;case this.ui.itemIcon2:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[1].id,this.attVo[1].type,this.attVo[1].value);break;case this.ui.itemIcon3:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[2].id,this.attVo[2].type,this.attVo[2].value)}},i.prototype.showHook=function(){this.initUI()},i}(e.BasePanel);e.PrisonerLveDuoSucessViw=t,__reflect(t.prototype,"foxgame.PrisonerLveDuoSucessViw")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerLveDuoViewSkin.exml")||this;return i.currentSelect=0,i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initUI=function(){if(this.currentData){this.initListener();var t=this.currentData.getItemId(),i=e.JsonDataManager.instance.roleTemplate[t];this.ui.prisonerIcon.source=i.icon,this.ui.prisonerName.text=this.currentData.getFookId()+e.LanguageUtils.instance.getValue("QU"),this.ui.prisonerName1.text=this.currentData.getName()+"",this.ui.fightNum.text=this.currentData.getFight()+"",this.currentSelect=this.currentData.getPrisonerLevel()-1;var n=e.JsonDataManager.instance.prisonerAwardTemPlate,o=n[this.currentSelect];this.attVo=[],this.attVo=o.plunderAwardsList,this.ui.itemIcon1.setItem(this.attVo[0].id,this.attVo[0].value,!0),this.ui.itemIcon2.setItem(this.attVo[1].id,this.attVo[1].value,!0),this.attVo.length>2?(this.ui.itemIcon3.visible=!0,this.ui.itemIcon3.setItem(this.attVo[2].id,this.attVo[2].value,!0)):this.ui.itemIcon3.visible=!1}},i.prototype.setData=function(e){this.currentData=e},i.prototype.readyDestroy=function(){this.ui.confirmBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.initListener=function(){this.ui.confirmBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.itemIcon3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.PlayerService.instance.playerInfo.getGold();switch(t.target){case this.ui.confirmBtn1:if(this.model.getPrisonerInfoData().getPlunderNumber()<=0)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("LUEDUOCISHUBUZU"));this.currentData.getPlunderNumber()>0?this.startLveDuo():e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CISHUBUZU"));break;case this.ui.itemIcon1:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[0].id,this.attVo[0].type,this.attVo[0].value);break;case this.ui.itemIcon2:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[1].id,this.attVo[1].type,this.attVo[1].value);break;case this.ui.itemIcon3:e.ActivityController.getIntance().showTipsByItemOrEquip(this.attVo[2].id,this.attVo[2].type,this.attVo[2].value)}},i.prototype.startLveDuo=function(){e.PrisonerController.getInstance().closeAllPanel(),e.PrisonerController.getInstance().sendMessageToSeverForLveDuo(this.currentData.getId())},i.prototype.showHook=function(){this.initUI()},i}(e.BasePanel);e.PrisonerLveDuoView=t,__reflect(t.prototype,"foxgame.PrisonerLveDuoView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerMainViewSkin.exml","prisoner",!0)||this;return i.costGold=0,i.model=e,i.setRegisterTick(!0),i.resultLastTime=0,i.dituTime=0,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.closeHook=function(){e.WanFaController.getInstance().showPanel()},i.prototype.panelChanged=function(){this.getIsInit()&&this.getIsShow()&&this.initUI()},i.prototype.initHook=function(){this.doScreenAdaptation(),this.model.registerObserver(this)},i.prototype.readyDestroy=function(){this.ui.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.jiluBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.changeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.jieshouBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.jieshouBtn0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.dituView&&(this.dituView.parent.removeChild(this.dituView),this.dituView=null)},i.prototype.initListener=function(){this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.jiluBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.jieshouBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.jieshouBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.ui.helpBtn:this.showQuestion();break;case this.ui.jiluBtn:e.PrisonerController.getInstance().getPrisonerLog();break;case this.ui.changeBtn:e.PrisonerController.getInstance().changeList();break;case this.ui.jieshouBtn:var i=this.currentData.getEscortState(),n=this.currentData.getAwardState();if(n)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_FIRSTGETAWARD")),void e.PrisonerController.getInstance().getAwardMessage();if(i)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_INING"));if(0==this.currentData.getEscortNumber())return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_NONUM"));e.PrisonerController.getInstance().showJieShouPanel();break;case this.ui.jieshouBtn0:var o=this.currentData.getEscortList().concat(),a=0,s=o.length,r=[],l=e.PlayerService.instance.playerInfo.getPlayerId();for(a;s>a;a++){var h=o[a];h.getId()!=l&&r.push(h)}var c=r.length;0==c&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_SHUIJILUEDUO"));var u=Math.round(Math.random()*c),p=r[u];if(!p)return;for(a=0,s=p.getPlunderId().length,l=e.PlayerService.instance.playerInfo.getPlayerId(),a;s>a;a++){var g=p.getPlunderId()[a];if(g.getPlayerId()==l)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_NORAPE"))}if(this.currentData.getPlunderNumber()<=0)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("LUEDUOCISHUBUZU"));p.getPlunderNumber()>0?e.PrisonerController.getInstance().showLveDuoPanel(p):e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("CISHUBUZU"))}},i.prototype.showQuestion=function(){e.HelpController.getInstance().showPanel("THEPRISONERSHELP")},i.prototype.showHook=function(){this.model.getPrisonerInfoData()&&this.initUI()},i.prototype.initUI=function(){this.resultLastTime=0,this.dituTime=0,this.costGold=0,this.setRegisterTick(!0),this.initListener(),this.ui.group.removeChildren(),this.dituView?this.dituView.setReady(!0):this.dituView=new e.PrisonerDiTuView,this.ui.group.addChild(this.dituView),this.currentData=this.model.getPrisonerInfoData(),this.dituView.setListData(this.currentData.getEscortList()),this.ui.yajieNum.text=this.currentData.getEscortNumber()+"/"+e.GlobalConfig.instance.getValue("ESCORT_NUMBER"),this.ui.lveduoNum.text=this.currentData.getPlunderNumber()+"/"+e.GlobalConfig.instance.getValue("ESCORT_PRISONER_PLUNDER_NUMBER");if(this.ui.wanchengBtn.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("KUAISUWANCHENG")),this.ui.wanchengBtn.addEventListener(egret.TextEvent.LINK,this.linkHandler,this),this.currentData.getEscortState()&&this.currentData.getEscortList()[0]){var t=this.currentData.getEscortList()[0];this.currentTime=t.getEndTime()-t.getStartTime(),this.ui.myTime.text=this.checkTime(this.currentTime)}else this.currentTime=0,this.ui.myTime.text="00:00"},i.prototype.checkTime=function(e){if(0==e)return"00:00";var t="",i=(e-e%36e5)/36e5;e=Math.floor(e/1e3-60*i*60);var n=Math.floor(e-e%60)/60,o=Math.floor(e-60*n);return i>0&&(t+=i+":"),t+=n>=10?n+":":"0"+n+":",t+=o>=10?o:"0"+o},i.prototype.linkHandler=function(t){if(-1!=t.text.indexOf("quickDone")){if(this.currentTime<=0)return;var i=Number(e.GlobalConfig.instance.getValue("ESCORT_PRISONE_EVERY_MINUT")),n=Math.ceil(this.currentTime/6e4),o=e.LanguageUtils.instance.getValue("XIAOHAOYUANBAOKUAISUYAJIE",n*i);this.costGold=n*i,e.PopUpController.getInstance().showTextPanel(o,this,this.spendItem)}},i.prototype.spendItem=function(){var t=e.PlayerService.instance.playerInfo.getGold();t>=this.costGold?e.PrisonerController.getInstance().sendMessageToSeverForKuaiSuWanCheng():e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")},i.prototype.tickHook=function(t){var i=t-this.resultLastTime,n=t-this.dituTime;n>=50&&this.dituView&&(this.dituView.updateTime(),this.dituTime=t),1e3>i||(this.resultLastTime=t,this.dituView&&this.dituView.changeTime(),e.PrisonerController.getInstance().getLveDuoIsShow()&&e.PrisonerController.getInstance().setLveDuoSTime(),e.PrisonerController.getInstance().getFuChouIsShow()&&e.PrisonerController.getInstance().setFuChouSTime(),this.currentTime<=0||(this.currentTime-=1e3,this.ui.myTime.text=this.checkTime(this.currentTime)))},i.prototype.setTick=function(){this.setRegisterTick(!0)},i.prototype.refresh=function(){this.ui.currency.refresh()},i}(e.BasePanel);e.PrisonerMainView=t,__reflect(t.prototype,"foxgame.PrisonerMainView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.observerList=[],this.datasource=[],this.collection=new eui.ArrayCollection,this.collection.source=this.datasource,this.datasource_log=[],this.collection_log=new eui.ArrayCollection,this.collection_log.source=this.datasource_log}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChanged()},t.prototype.setPrisonerInfoData=function(e){this._infoData=e,this.updateView()},t.prototype.getPrisonerInfoData=function(){return this._infoData},t.prototype.setPrisonerJieQuData=function(e){this._jiequData=e,this.updateView()},t.prototype.getPrisonerJieQuData=function(){return this._jiequData},t.prototype.setYaJieState=function(t){0==t.getErrorNo()&&e.PrisonerController.getInstance().sendMessageToSeverForPrisonerData()},t.prototype.setShuaXinState=function(t){0==t.getErrorNo()&&e.PrisonerController.getInstance().sendMessageToSeverForPrisonerJieShou()},t.prototype.setYiJianShuaXinState=function(t){0==t.getErrorNo()&&e.PrisonerController.getInstance().sendMessageToSeverForPrisonerJieShou()},t.prototype.setAwardInfo=function(t){this._awardInfoData=t,0==this._awardInfoData.getErrorNo()&&this._infoData&&this._infoData.setAwardState(!0),e.PrisonerController.getInstance().setAwardUpDate()},t.prototype.getAwardInfo=function(){return this._awardInfoData},t.prototype.setKuaiSuWanCheng=function(e){0==e.getErrorNo()},t.prototype.setLveDuoData=function(t){this._lveduoData=t,e.PrisonerController.getInstance().lveduochenggongsetData(),e.PrisonerController.getInstance().sendMessageToSeverForPrisonerData()},t.prototype.getLveDuoData=function(){return this._lveduoData},t.prototype.getAward=function(e){0==e.getErrorNo()},t.prototype.shuaxinData=function(e){this._infoData=e,this.updateView()},t.prototype.setPrisonerLogData=function(t){0!=t.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()),this._logData=t,this.updateView()},t.prototype.getPrisonerLogData=function(){return this._logData},t.prototype.setPrisonerFuChouData=function(t){this._revengeData=t,this.fuchouShow&&(this.fuchouShow=!1,e.PrisonerController.getInstance().fuchoushenggongShowPanel()),0==this._revengeData.getErrorNo()&&e.PrisonerController.getInstance().sendMessageToSeverForPrisonerData()},t.prototype.getPrisonerFuChouData=function(){return this._revengeData},t.prototype.setFucHOUShow=function(){this.fuchouShow=!0},t}();e.PrisonerModel=t,__reflect(t.prototype,"foxgame.PrisonerModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.curIndex=0,e.skinName="resource/skins/prisoner/PrisonerMonsterSkin.exml",e.ready=!1,e}return __extends(i,t),i.prototype.childrenCreated=function(){this.initListener(),this.initUI(),this.ready=!0},i.prototype.setReady=function(e){this.ready=e},i.prototype.cleanAni=function(){this.mosterAni&&(this.mosterAni.clear(),this.mosterAni=null)},i.prototype.getData=function(){return this.curmosterData},i.prototype.setIndex=function(e){this.curIndex=e},i.prototype.getIndex=function(){return this.curIndex},i.prototype.setData=function(e,t,i){this.currentStartTime=e.getStartTime(),this.currentEndTime=e.getEndTime(),this.curmosterData=e,0!=this.ready&&this.initUI()},i.prototype.initUI=function(){if(void 0!=this.curmosterData){var t=e.JsonDataManager.instance.prisonerAwardTemPlate,i=t[this.curmosterData.getPrisonerLevel()-1],n=i.resourceModel;this.mosterAni&&(this.mosterAni.clear(),this.mosterAni=null),void 0==this.mosterAni&&(this.mosterAni=new e.FoxAni(this.aniGroup)),this.mosterAni.play(n,"ani",-1);var o=this.checkStr();this.monsterName.textFlow=(new egret.HtmlTextParser).parser(o),this.timeNum=0,this.timeNum=this.currentEndTime-this.currentStartTime,this.time.text=this.checkTime(this.timeNum),this.lveduo.textFlow=(new egret.HtmlTextParser).parser(this.checkLveDuo()),this.group.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.changeTime=function(){this.currentStartTime=Number(this.curmosterData.getStartTime()),this.currentEndTime=Number(this.curmosterData.getEndTime()),this.timeNum=this.currentEndTime-this.currentStartTime,this.time.text=this.checkTime(this.timeNum)},i.prototype.checkLveDuo=function(){var t="",i=this.curmosterData.getPlunderNumber();i>0&&(t=e.LanguageUtils.instance.getValue("YAJIEQUTU_YILUEDUO_CHISHU",i));var n=0,o=this.curmosterData.getPlunderId().length,a=e.PlayerService.instance.playerInfo.getPlayerId();for(n;o>n;n++){var s=this.curmosterData.getPlunderId()[n];if(s.getPlayerId()==a)return t=e.LanguageUtils.instance.getValue("YAJIEQUTU_YILUEDUO")}return t},i.prototype.getStartTime=function(){return this.currentStartTime},i.prototype.getEndTime=function(){return this.currentEndTime},i.prototype.checkTime=function(e){var t="",i=(e-e%36e5)/36e5;e=Math.floor(e/1e3-60*i*60);var n=Math.floor((e-e%60)/60),o=Math.floor(e-60*n);return i>0&&(t+=i+":"),t+=n>=10?n+":":"0"+n+":",t+=o>=10?o:"0"+o},i.prototype.checkStr=function(){var t="";t=this.curmosterData.getName(),this.curmosterData.getFookId();var i="";switch(this.curmosterData.getPrisonerLevel()){case 1:i=e.LanguageUtils.instance.getValue("YAJIEQUTU_1JI",t);break;case 2:i=e.LanguageUtils.instance.getValue("YAJIEQUTU_2JI",t);break;case 3:i=e.LanguageUtils.instance.getValue("YAJIEQUTU_3JI",t);break;case 4:i=e.LanguageUtils.instance.getValue("YAJIEQUTU_4JI",t)}return i},i.prototype.initListener=function(){},i.prototype.onClick=function(t){if(this.curmosterData.getPlunderNumber()<=0)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_NORAPE"));var i=0,n=this.curmosterData.getPlunderId().length,o=e.PlayerService.instance.playerInfo.getPlayerId();for(i;n>i;i++){var a=this.curmosterData.getPlunderId()[i];if(a.getPlayerId()==o)return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_RAPEOVER"))}return o==this.curmosterData.getId()?e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("YAJIE_NOMERAPE")):void e.PrisonerController.getInstance().showLveDuoPanel(this.getData())},i.prototype.showQuestion=function(){},i.prototype.updateTime=function(){},i}(eui.Component);e.PrisonerMonster=t,__reflect(t.prototype,"foxgame.PrisonerMonster")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/prisoner/PrisonerShowLogItemViewSkin.exml",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.currentData=this.data.item,this.timeLabel.text=this.checkTime();var e=this.checkValue();this.contentLabel.touchEnabled=!0,this.contentLabel.addEventListener(egret.TextEvent.LINK,this.linkHandle,this),this.contentLabel.textFlow=(new egret.HtmlTextParser).parser(e)},i.prototype.linkHandle=function(t){-1!=t.text.indexOf("revenge")&&e.PrisonerController.getInstance().showFuChouPanel(this.currentData,this.data.index)},i.prototype.checkTime=function(){var t=new Date;t.setTime(this.currentData.getDataTime());var i=t.getMonth()+1+e.LanguageUtils.instance.getValue("YUE"),n=t.getDate()+e.LanguageUtils.instance.getValue("RI"),o=t.getHours()+":",a=t.getMinutes(),s=i+n+o+a;return s},i.prototype.checkValue=function(){var t="",i=this.currentData.getPrisonerLevel(),n="";switch(i){case 1:n=e.LanguageUtils.instance.getValue("QUTU1");break;case 2:n=e.LanguageUtils.instance.getValue("QUTU2");break;case 3:n=e.LanguageUtils.instance.getValue("QUTU3");break;case 4:n=e.LanguageUtils.instance.getValue("QUTU0")}var o=this.currentData.getTypeId(),a=this.currentData.getResultState(),s=this.currentData.getRevenge();switch(o){case 1:t=e.LanguageUtils.instance.getValue("YAJIE_STARTYASONG",n);break;case 2:t=s?e.LanguageUtils.instance.getValue("YAJIE_FUCHOU",this.currentData.getFoodId(),this.currentData.getName(),n):e.LanguageUtils.instance.getValue("YAJIE_YIFUCHOU",this.currentData.getFoodId(),this.currentData.getName(),n);break;case 3:if(a){var r=this.currentData.getCoinNumber(),l=this.currentData.getExpNumber();t=e.LanguageUtils.instance.getValue("YAJIEQUTU_LUEDUO_CHENGGONG",this.currentData.getName(),n,r,l)}else t=e.LanguageUtils.instance.getValue("YAJIEQUTU_LUEDUO_SHIBAI",this.currentData.getName(),n)}return t},i}(eui.ItemRenderer);e.PrisonerShowLogItemView=t,__reflect(t.prototype,"foxgame.PrisonerShowLogItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/prisoner/PrisonerShowLogViewSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.doScreenAdaptation(),this.model.registerObserver(this)},i.prototype.panelChanged=function(){this.getIsInit()&&this.getIsShow()&&this.initUI()},i.prototype.initUI=function(){var t=this.model.getPrisonerLogData(),i=t.getLogList(),n=0,o=i.length,a=[];for(n;o>n;n++){var s=new Object;s.item=i[n],s.index=n,a.push(s)}this.ui.recordList.dataProvider=this.model.collection_log,this.ui.recordList.itemRenderer=e.PrisonerShowLogItemView,this.model.collection_log.replaceAll(a)},i.prototype.showHook=function(){this.model.getPrisonerLogData()&&this.initUI()},i}(e.BasePanel);e.PrisonerShowLogView=t,__reflect(t.prototype,"foxgame.PrisonerShowLogView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="privilegebtnitem",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){var e=this.data.info;this.lab.text=e.name,this.type=e.type,this.btn.currentState=this.data.stage?"down":"up"},t}(eui.ItemRenderer);e.PrivilegeBtnitem=t,__reflect(t.prototype,"foxgame.PrivilegeBtnitem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.PrivilegeModel,this.panel=new e.PrivilegePanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.showpanel=function(t){void 0===t&&(t=1),t=-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)?4:1,this.model.indexnum=t,this.panel.show()},t.prototype.registerMsg=function(t){t.add(e.Code.PRIVILEGE_CARD_INFO_S,this),t.add(e.Code.PRIVILEGE_CARD_AWARD_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.PRIVILEGE_CARD_INFO_S:this.model.setPRIVILEGE_CARD_INFO_S(i);break;case e.Code.PRIVILEGE_CARD_AWARD_S:this.model.setPRIVILEGE_CARD_AWARD_S(i)}},t.prototype.sendPRIVILEGE_CARD_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.PrivilegeCardInfoReq");e.Message.instance.send(e.Code.PRIVILEGE_CARD_INFO_C,t,!0)},t.prototype.sendPRIVILEGE_CARD_AWARD_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.PrivilegeCardAwardReq");i.setType(t),e.Message.instance.send(e.Code.PRIVILEGE_CARD_AWARD_C,i,!0)},t.prototype.sendRECHARGE_REQUEST=function(t){var i,n={};"wanba_ts"==checkPlatformStr()?("1107925907"==getGlobalConfig().wanBaAppId?i=e.JsonDataManager.instance.rechargeConfig_wanbaTemplate[t+""+e.UserInfo.platform.zoneId]:"1108023326"==getGlobalConfig().wanBaAppId&&(i=e.JsonDataManager.instance.rechargeConfig_wanbaQLDTemplate[t+""+e.UserInfo.platform.zoneId]),n.goodsId=i.productId,n.productName=i.productName,n.orderMoney=i.rewardstarmoney):(i=e.JsonDataManager.instance.rechargeProductIdTemplate[t],n.goodsId=i.productId,n.productName=i.productName,n.orderMoney=i.costMoney),n.diamondNum=0,n.giftDiamondNum=0,e.RechargeController.getInstance().setPayData(n);var o=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");o.setGoodsId(t),e.Message.instance.send(e.Code.RECHARGE_REQUEST,o,!0)},t}();e.PrivilegeController=t,__reflect(t.prototype,"foxgame.PrivilegeController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="privilegeiconitem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)},i.prototype.click=function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.dataChanged=function(){var e=this.data;this.icon.setItem(e.id,e.value,!0)},i}(eui.ItemRenderer);e.PrivilegeIconitem=t,__reflect(t.prototype,"foxgame.PrivilegeIconitem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="privilegeitem",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data;this.txt.textFlow=(new egret.HtmlTextParser).parser(e),this.itemIndex<5?this.img.source="icon_biaoshi_red_png":this.img.source="icon_biaoshi_yellow_png"},t}(eui.ItemRenderer);e.PrivilegeItem=t,__reflect(t.prototype,"foxgame.PrivilegeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.observerList=[],this.collection=new eui.ArrayCollection,this.collectionicon=new eui.ArrayCollection,this.titlecollectionicon=new eui.ArrayCollection}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.getprivilegenum=function(e){return 1==e?this.privilegenum1:2==e?this.privilegenum2:3==e?this.privilegenum3:4==e?this.privilegenum4:null},t.prototype.updateRecord=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.privilegeInfoBack()},t.prototype.refreshRedPoint=function(){this.privilegenum1&&0==this.privilegenum1.getAward()&&1==this.privilegenum1.getActivation()||this.privilegenum2&&0==this.privilegenum2.getAward()&&1==this.privilegenum2.getActivation()||this.privilegenum3&&0==this.privilegenum3.getAward()&&1==this.privilegenum3.getActivation()||this.privilegenum4&&0==this.privilegenum4.getAward()&&1==this.privilegenum4.getActivation()?e.ActivityBarController.getInstance().setPrivilegeRedPoint(!0):e.ActivityBarController.getInstance().setPrivilegeRedPoint(!1)},t.prototype.setPRIVILEGE_CARD_INFO_S=function(e){for(var t=0;t<e.getCardList().length;t++)1==e.getCardList()[t].getType()&&(this.privilegenum1=e.getCardList()[t]),2==e.getCardList()[t].getType()&&(this.privilegenum2=e.getCardList()[t]),3==e.getCardList()[t].getType()&&(this.privilegenum3=e.getCardList()[t]),4==e.getCardList()[t].getType()&&(this.privilegenum4=e.getCardList()[t]);this.refreshRedPoint(),this.updateRecord()},t.prototype.setPRIVILEGE_CARD_AWARD_S=function(t){return 0!=t.getErrorNo()?void e.GameUtils.MSG_TIP("领取失败"):(1==t.getType()&&this.privilegenum1.setAward(!0),2==t.getType()&&this.privilegenum2.setAward(!0),3==t.getType()&&this.privilegenum3.setAward(!0),4==t.getType()&&this.privilegenum4.setAward(!0),this.refreshRedPoint(),void this.updateRecord())},t}();e.PrivilegeModel=t,__reflect(t.prototype,"foxgame.PrivilegeModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/privilege/privilegeskin.exml")||this;return i.titleArr=[],i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.list.dataProvider=this.model.collection,this.ui.list.itemRenderer=e.PrivilegeItem,this.ui.scroller.scrollPolicyH="OFF",this.ui.getAll.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.tq_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.pagedown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.ui.pageup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this);var t=new e.FoxAni(this.ui.fx_btngroup);t.play("fx_btn_tequan","ani",-1),this.titleArr=[];for(var i in e.JsonDataManager.instance.privilegeCardTemplate)"function"!=typeof e.JsonDataManager.instance.privilegeCardTemplate[i]&&this.titleArr.push({info:e.JsonDataManager.instance.privilegeCardTemplate[i],stage:e.JsonDataManager.instance.privilegeCardTemplate[i].type==this.model.indexnum});this.ui.iconlist.dataProvider=this.model.collectionicon,this.ui.iconlist.itemRenderer=e.PrivilegeIconitem;var n=new eui.TileLayout;n.horizontalAlign="CENTER",n.horizontalGap=15,this.ui.iconlist.layout=n,this.ui.titlelist.dataProvider=this.model.titlecollectionicon,this.ui.titlelist.itemRenderer=e.PrivilegeBtnitem;var o=new eui.TileLayout;o.horizontalAlign="CENTER",o.horizontalGap=20,o.requestedRowCount=1,this.ui.titlelist.layout=o,this.model.titlecollectionicon.replaceAll(this.titleArr),this.ui.titlelist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.clicklist,this),e.GamePlatform.isDragonEx_qld?this.ui.lab_money.x=447:this.ui.lab_money.x=437},i.prototype.clicklist=function(e){var t=e.item.info;if(this.model.indexnum!=t.type){for(var i=0;i<this.titleArr.length;i++)this.titleArr[i].info.type==t.type?this.titleArr[i].stage=!0:this.titleArr[i].stage=!1;this.model.indexnum=t.type,this.model.titlecollectionicon.replaceAll(this.titleArr),this.refresh()}},i.prototype.clickbtn=function(t){switch(t.target){case this.ui.helpBtn:e.HelpController.getInstance().showPanel("TEQUANKAHELP");break;case this.ui.getAll:e.PrivilegeController.getInstance().sendPRIVILEGE_CARD_AWARD_C(this.model.indexnum);break;case this.ui.tq_btn:e.PrivilegeController.getInstance().sendRECHARGE_REQUEST(this.model.productId);break;case this.ui.pagedown:egret.Tween.get(this.ui.titlescroller.viewport).to({scrollH:this.ui.titlescroller.viewport.contentWidth-this.ui.titlescroller.viewport.width},300);break;case this.ui.pageup:egret.Tween.get(this.ui.titlescroller.viewport).to({scrollH:0},300)}},i.prototype.showHook=function(){this.ui.lab_003.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("TEQUANKA"))},i.prototype.refresh=function(){var t=e.JsonDataManager.instance.privilegeCardTemplate.find(this.model.indexnum),i=this.model.getprivilegenum(this.model.indexnum);this.ui.limitdayImg.visible=4==this.model.indexnum&&e.Global.isYouGuSDK,this.ui.lab_money.text=String(t.money),e.GamePlatform.isDragonEx?this.ui.normalCurrencyImg.source="jinxu_dt_png":e.GamePlatform.isDragonEx_qld?this.ui.normalCurrencyImg.source="jinxu_yb_png":this.ui.normalCurrencyImg.source="jinxu_png",this.ui.lab_money.text=String(t.money),this.model.collection.source=t.tips,this.model.collectionicon.source=t.dailyAward,this.model.productId=t.productId,this.ui.bj_tq.source=t.logo,this.ani&&(this.ani.clear(),this.ani=null),this.ui.bittxt1.text=t.attr1,this.ui.bittxt2.text=t.attr2,this.ui.bittxt3.text=t.attr3;var n=e.JsonDataManager.instance.medalTemplate[t.title];if(this.ani=new e.FoxAni(this.ui.titlegroup),this.ani.scaleX=1.3,this.ani.scaleY=1.3,this.ani.play(n.animation,"ani",-1),this.ui.bjimg_tq.source=t.logotext,i&&i.getActivation()){i.getAward()?(this.ui.gettrue.visible=!0,this.ui.getAll.visible=!1):(this.ui.gettrue.visible=!1,this.ui.getAll.visible=!0,this.ui.getAll.currentState="up"),this.ui.fx_btngroup.visible=!1,this.ui.tq_btn.visible=!1,this.ui.fx_btntxt.visible=!1;var o="";if(-1!=i.getEndDate()){var a=~~(i.getEndDate()/864e5);o="<font color=0xee3c6>剩余时间:</font><font color=0x21ff03>"+a+"</font><font color=0xee3c6>天</font>"}else o="永久激活";this.ui.lab_001.textFlow=(new egret.HtmlTextParser).parser("<font color=0xee3c6>"+t.name+"生效中</font>"),this.ui.lab_002.textFlow=(new egret.HtmlTextParser).parser(o)}else this.ui.gettrue.visible=!1,this.ui.getAll.visible=!0,this.ui.getAll.currentState="disabled",this.ui.fx_btngroup.visible=!0,this.ui.tq_btn.visible=!0,this.ui.fx_btntxt.visible=!0,this.ui.lab_001.textFlow=(new egret.HtmlTextParser).parser(""),this.ui.lab_002.textFlow=(new egret.HtmlTextParser).parser("")},i.prototype.closeHook=function(){this.ani&&(this.ani.clear(),this.ani=null)},i.prototype.privilegeInfoBack=function(){this.getIsShow()&&this.refresh()},i}(e.BasePanel);e.PrivilegePanel=t,__reflect(t.prototype,"foxgame.PrivilegePanel",["foxgame.IPrivilege","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.dailyAward=[],this.tips=[]}return e}();e.PrivilegeVO=t,__reflect(t.prototype,"foxgame.PrivilegeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.titleImgListBegin=["zhanlibang_anxia_png","dengjibang_anxia_png","shenyibang_anxia_png","baoshibang_anxia_png","shalubang_anxia_png","zhanshenbang_anxia_png","fashengbang_anxia_png","daozunbang_anxia_png"],t.titleImgListEnd=["zhanlibang_putong_png","dengjibang_putong_png","shenyibang_putong_png","baoshibang_putong_png","shalubang_putong_png","zhanshenbang_putong_png","fashengbang_putong_png","daozunbang_putong_png"],t.currentIndex=0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.skinName="RankBtnItem"},t.prototype.setItem=function(e){this.currentIndex=e-1,this.titleImg.source=this.titleImgListEnd[this.currentIndex]},t.prototype.getIsSelected=function(){return this.isSelected},t.prototype.setIsSelected=function(e){this.isSelected=e,e?this.titleImg.source=this.titleImgListBegin[this.currentIndex]:this.titleImg.source=this.titleImgListEnd[this.currentIndex]},t}(eui.Component);e.RankBtnItem=t,__reflect(t.prototype,"foxgame.RankBtnItem")
}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.RankModel,this.rankPanel=new e.RankPanel(this.model),this.rewardPanel=new e.RankRewardPanel(this.model)}return t.prototype.recvMsg=function(t,n){if(t==e.Code.RANK_S){this.model.setRankInfo(n);var o=n,a=o.getRankType();(a==i.ZHANSHENBANG||a==i.FASHENGBANG||a==i.DAOZUNBANG)&&e.MapViewportGroupManager.instance.sceneView.refreshRank(a)}else if(t==e.Code.SERVER_RANK_LIST_INFO_S){this.model.setRankInfoNew(n);var o=n,a=o.getRankType();(a==i.ZHANSHENBANG||a==i.FASHENGBANG||a==i.DAOZUNBANG)&&e.MapViewportGroupManager.instance.sceneView.refreshRank(a)}},t.prototype.requestRankInfo=function(t,i){void 0===i&&(i=0);var n=HawkProtocolManager.newBuilder("JsProto.ServerRankInfoReq");n.setRankType(t),e.Message.instance.send(e.Code.RANK_C,n,!0);var o=HawkProtocolManager.newBuilder("JsProto.ServerRankListInfoReq");o.setRankType(t),this.model.isFirstOpen||(this.model.setPage(0),this.model.cleanArrData()),o.setPagNumber(this.model.getPage()+1),e.Message.instance.send(e.Code.SERVER_RANK_LIST_INFO_C,o,!0)},t.prototype.requestRankInfoByIndex=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),!this.model.haveNewInfo&&(0==t&&(t=this.model.curType),0==i&&(i=this.model.getPage()+1),0!=this.rankPanel.getScrollV())){this.model.scrollCurV=this.rankPanel.getScrollV();var n=HawkProtocolManager.newBuilder("JsProto.ServerRankListInfoReq");n.setRankType(t),n.setPagNumber(i),e.Message.instance.send(e.Code.SERVER_RANK_LIST_INFO_C,n,!0)}},t.prototype.showRankPanel=function(){var t=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.PAIHANGBANG,!1),n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.PAIHANGBANG);return(-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp))&&(t=!0),t?(this.requestRankInfo(i.ZHANLIBANG),void this.rankPanel.show()):void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("RANKINGLIST",n))},t.prototype.showRewardPanel=function(){this.rewardPanel.show()},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getPlayerListByType=function(e){return this.model.getPlayerListByType(e)},t.prototype.getCurPage=function(){return this.model.getPage()},t.prototype.getLastPlayerInfo=function(){return this.model.getLastPlayerInfo()},t}();e.RankController=t,__reflect(t.prototype,"foxgame.RankController",["foxgame.IMessage"]);var i;!function(e){e[e.ZHANLIBANG=1]="ZHANLIBANG",e[e.DENGJIBANG=2]="DENGJIBANG",e[e.SHENYIBANG=3]="SHENYIBANG",e[e.BAOSHIBANG=4]="BAOSHIBANG",e[e.SHALUBANG=5]="SHALUBANG",e[e.ZHANSHENBANG=6]="ZHANSHENBANG",e[e.FASHENGBANG=7]="FASHENGBANG",e[e.DAOZUNBANG=8]="DAOZUNBANG"}(i=e.RankType||(e.RankType={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.clickHandler,e),e}return __extends(i,t),i.prototype.init=function(){this.skinName="RankListItemSkin"},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=e.RankController.getInstance().getLastPlayerInfo();i==this.data&&e.RankController.getInstance().requestRankInfoByIndex();var n=this.data;this.rankLabel.text=n.getRank().toString(),this.nameLabel.text=n.getName()+" [Lv."+n.getLevel()+"]",this.fightLabel.text=n.getFight().toString(),this.vipLabel.text=n.getVipLevel().toString(),n.getQqBlueInfo()?e.Global.setBlueFont(this.txt_blue,n.getQqBlueInfo().getBlueVipLevel(),n.getQqBlueInfo().getIsBlueYearVip(),n.getQqBlueInfo().getIsSuperBlueVip()):this.txt_blue.text="";var o=e.JsonDataManager.instance.roleTemplate[n.getItemId()];this.headImg.source=o.icon2},i.prototype.clickHandler=function(t){var i=this.data;e.OtherCharacterController.getInstance().showOtherCharacterPanel(i.getPlayerId())},i.createNum=0,i.updateNum=0,i}(eui.ItemRenderer);e.RankItem=t,__reflect(t.prototype,"foxgame.RankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.curType=0,this.curPage=0,this.arr={},this.scrollCurV=0,this.isFirstOpen=!1,this.observerList=[],this.rankInfoDic={},this.rankFirstInfoDic={},this.arr={},this.rankItemCollection=new eui.ArrayCollection}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.setRankInfo=function(e){this.rankFirstInfoDic[e.getRankType()]=null!=e?e:null},e.prototype.setRankInfoNew=function(e){if(0==e.getRankInfo().length)return this.curPage=0,this.rankInfoDic={},this.updateView(),void(this.scrollCurV=0);this.haveNewInfo=!1,this.curPage=0,this.arr[e.getRankType()]?this.curPage=this.arr[e.getRankType()].length:this.arr[e.getRankType()]=[],this.arr[e.getRankType()].length-1<this.curPage?(this.arr[e.getRankType()].push(e),this.curPage+=1):this.arr[e.getRankType()][this.curPage-1]=e,this.haveNewInfo=e.getState();var t=this.arr[e.getRankType()].length,i=0,n=[];for(i;t>i;i++)n=n.concat(this.arr[e.getRankType()][i].getRankInfo());this.rankInfoDic[e.getRankType()]=n,this.updateView()},e.prototype.cleanArrData=function(){this.arr={},this.rankFirstInfoDic={}},e.prototype.getPlayerListByType=function(e){var t=this.rankInfoDic[e];return null!=t?t:null},e.prototype.setPage=function(e){this.curPage=e},e.prototype.getPage=function(){return this.curPage},e.prototype.getLastPlayerInfo=function(){var e=this.rankInfoDic[this.curTypeIndex+1];return void 0!=e?e[e.length-1]:null},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e}();e.RankModel=t,__reflect(t.prototype,"foxgame.RankModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/rank/new/RankPanel.exml","rankPanel")||this;return n.firstTimeOpen=!0,n.rankTypeList=[e.RankType.ZHANLIBANG,e.RankType.DENGJIBANG,e.RankType.SHENYIBANG,e.RankType.BAOSHIBANG,e.RankType.SHALUBANG,e.RankType.ZHANSHENBANG,e.RankType.FASHENGBANG,e.RankType.DAOZUNBANG],n.model=i,n.isMask=!1,n.isMaskdown=!0,n.adaptionType=1,n}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.firstRewardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rewardHandler,this),this.ui.checkInfoImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkInfoHandler,this);for(var t,i,n=this.getTempRank(),o=n.length,a=0;o>a;a++)t=new e.RankBtnItem,i=n[a],t.setItem(i.type),t.y=a*t.height,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankBtnClickHandler,this),this.ui.btnGroup.addChild(t);var s=this.ui.itemList;s.dataProvider=this.model.rankItemCollection,s.itemRenderer=e.RankItem,this.ui.btnScroller.verticalScrollBar.autoVisibility=!1,this.ui.btnScroller.scrollPolicyH="off",this.ui.itemScroller.verticalScrollBar.autoVisibility=!1,this.ui.itemScroller.scrollPolicyH="off",this.animation&&(this.animation.clear(),this.animation=null),this.animation||(this.animation=new e.FoxAni(this.ui.aniGroup)),this.doScreenAdaptation()},i.prototype.initParams=function(){this.model.curTypeIndex=0,this.ui.btnScroller.viewport.scrollV=0,this.ui.itemScroller.viewport.scrollV=0},i.prototype.getScrollV=function(){return this.ui.itemScroller.viewport.scrollV},i.prototype.refresh=function(){this.ui.btnScroller.viewport.scrollV=0,0!=this.ui.itemScroller.viewport.scrollV&&(this.ui.itemScroller.viewport.scrollV=this.model.scrollCurV),this.refreshRankBtnStatus();var t=this.rankTypeList[this.model.curTypeIndex];this.model.curType=t;var i=this.model.rankFirstInfoDic[t],n=this.getPlayerList();if(null==n)return this.ui.firstGroup.visible=!1,this.ui.firstAvatar.visible=!1,this.animation.stop(),this.model.rankItemCollection.replaceAll([]),this.ui.vipImg.visible=!1,this.ui.firstNameLabel.text="",this.ui.myRankLabel.text="未上榜",void(this.ui.txt_blue.text="");var o=n[0];if(null!=o){if(this.ui.vipImg.visible=!0,this.animation.play("zdlhuodonghua","ani",-1),this.ui.firstNameLabel.text=o.getName()+" Lv."+o.getLevel(),o.getQqBlueInfo()?e.Global.setBlueFont(this.ui.txt_blue,o.getQqBlueInfo().getBlueVipLevel(),o.getQqBlueInfo().getIsBlueYearVip(),o.getQqBlueInfo().getIsSuperBlueVip()):this.ui.txt_blue.text="",this.ui.vipImg.source="u_"+this.getImgSource(o.getVipLevel())+"_png",this.ui.firstFightLabel.text=o.getFight()+"",i){var a=i.getDragonArmourShowGuard()?i.getDragonArmourGuardLevel():-1,s=i.getWardState()?i.getWardLevel():-1;this.ui.firstAvatar.setAvatar(o.getItemId(),i.getClothingId(),i.getWeaponId(),i.getWingId(),i.getFashionClothesId(),i.getFashionWeaponId(),i.getFashionWingId(),a,s)}this.ui.checkInfoImg.visible=!0,this.ui.firstAvatar.visible=!0,this.ui.firstGroup.visible=!0,this.ui.firstNameLabel.visible=!0}else this.ui.vipImg.visible=!1,this.ui.checkInfoImg.visible=!1,this.ui.firstAvatar.visible=!1,this.ui.firstGroup.visible=!1,this.ui.firstNameLabel.visible=!1;t==e.RankType.DENGJIBANG||t==e.RankType.SHENYIBANG||t==e.RankType.BAOSHIBANG?this.ui.firstRewardBtn.visible=!1:this.ui.firstRewardBtn.visible=!0;var r;r=t==e.RankType.ZHANSHENBANG?e.PlayerService.instance.getRoleDataByProfession(e.ProfessionType.PROFESSION1):t==e.RankType.FASHENGBANG?e.PlayerService.instance.getRoleDataByProfession(e.ProfessionType.PROFESSION2):t==e.RankType.DAOZUNBANG?e.PlayerService.instance.getRoleDataByProfession(e.ProfessionType.PROFESSION3):e.PlayerService.instance.mainRoleData,null!=r&&i?this.ui.myRankLabel.text=-1==i.getMyRank()?e.LanguageUtils.instance.getValue("WEISHANGBANG"):i.getMyRank()+"":this.ui.myRankLabel.text=e.LanguageUtils.instance.getValue("WEISHANGBANG");var l=[];l=l.concat(n),null!=l&&l.length>0&&l.shift(),this.model.rankItemCollection.replaceAll(l),this.firstTimeOpen&&(this.firstTimeOpen=!1,this.ui.itemList.validateDisplayList())},i.prototype.getImgSource=function(e){var t="vip"+e;return t},i.prototype.updateView=function(){this.refresh()},i.prototype.rankBtnClickHandler=function(t){var i=this.getRankBtnList(),n=i.indexOf(t.currentTarget);if(this.model.curTypeIndex!=n){this.model.curTypeIndex=n,this.model.setPage(0),this.model.haveNewInfo=!1;for(var o,a=i.length,s=0;a>s;s++)o=i[s],o.setIsSelected(s==n);this.ui.itemScroller.stopAnimation(),this.model.cleanArrData(),this.model.scrollCurV=0;var r=this.rankTypeList[this.model.curTypeIndex];this.model.curType=r,e.RankController.getInstance().requestRankInfo(r)}},i.prototype.refreshRankBtnStatus=function(){for(var e,t=this.getRankBtnList(),i=t.length,n=0;i>n;n++)e=t[n],e.setIsSelected(n==this.model.curTypeIndex)},i.prototype.rewardHandler=function(t){e.RankController.getInstance().showRewardPanel()},i.prototype.checkInfoHandler=function(t){var i=this.getPlayerList();if(null!=i){var n=i[0];e.OtherCharacterController.getInstance().showOtherCharacterPanel(n.getPlayerId())}},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("RANKINGHELP")},i.prototype.getPlayerList=function(){var e=this.rankTypeList[this.model.curTypeIndex];this.model.curType=e;var t=this.model.getPlayerListByType(e);return t},i.prototype.readyDestroy=function(){this.animation&&(this.animation.clear(),this.animation=null)},i.prototype.showHook=function(){this.model.isFirstOpen||(this.model.isFirstOpen=!0,this.ui.itemScroller.viewport.scrollV=0)},i.prototype.closeHook=function(){this.model.setPage(0),this.model.haveNewInfo=!1,this.model.cleanArrData(),this.model.scrollCurV=0},i.prototype.getRankBtnList=function(){for(var e=[],t=this.ui.btnGroup.numChildren,i=0;t>i;i++)e.push(this.ui.btnGroup.getChildAt(i));return e},i.prototype.getTempRank=function(){return e.JsonDataManager.instance.rankListTemplate},i}(e.BasePanel);e.RankPanel=t,__reflect(t.prototype,"foxgame.RankPanel",["foxgame.IRank","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/rank/new/RankRewardPanel.exml")||this;return i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.initHook=function(){for(var e,t=this.getIconList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this)},i.prototype.refresh=function(){var t=this.getRankTemplate()[this.model.curTypeIndex];this.ui.titleLabel.text=t.name+e.LanguageUtils.instance.getValue("JIANGLI"),this.ui.medalImg.source=t.medalUrl;for(var i,n,o,a=this.getRankRewardTemplate()[t.type],s=this.getIconList(),r=s.length,l=0;r>l;l++)i=a[l],n=i.rewardList[0],o=s[l],o.setItem(n.id,n.value)},i.prototype.itemHandler=function(t){var i=this.getIconList(),n=i.indexOf(t.target),o=this.getRankTemplate()[this.model.curTypeIndex],a=this.getRankRewardTemplate()[o.type],s=a[n],r=s.rewardList[0];e.TipsController.getInstance().showItemTips(r.id,r.value)},i.prototype.getRankTemplate=function(){return e.JsonDataManager.instance.rankListTemplate},i.prototype.getRankRewardTemplate=function(){return e.JsonDataManager.instance.rankRewardTemplate},i.prototype.getIconList=function(){for(var e=[],t=0;9>=t;t++)e.push(this.ui["icon"+t]);return e},i}(e.BasePanel);e.RankRewardPanel=t,__reflect(t.prototype,"foxgame.RankRewardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.curIndex=0,e.isLimitTime=!1,e.isXqwdServer=!1,e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="FirstRechargeItemSkin",this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.setItem=function(e,t,i){void 0===i&&(i=!1),this.isLimitTime=i,this.curIndex=t,this.data=e,this.priceLabel.textFlow=(new egret.HtmlTextParser).parser(e.exhibition1),this.goldLabel.textFlow=(new egret.HtmlTextParser).parser(e.exhibition2),this.isLimitTime&&(this.bitlab.scaleX=this.bitlab.scaleY=.82),this.bitlab.text=e.exhibition3},i.prototype.youkeYes=function(){e.RechargeController.getInstance().closeFirstRechargePanel()},i.prototype.youkeNo=function(){},i.prototype.clickHandler=function(t){e.MainControler.instance;this.isXqwdServer=-1!=String(getGlobalConfig().serverUrl).indexOf("xbtx");var i=-1!=String(getGlobalConfig().serverUrl).indexOf("yl-res");if(3==this.curIndex)this.rechargeMessage1(1);else{var n=e.RechargeController.getInstance().getModelRechargeData()[3],o=void 0,a=void 0;e.GamePlatform.isDragonEx?(o=this.data.costdt+e.LanguageUtils.instance.getValue("YUAN"),a=n.costdt+e.LanguageUtils.instance.getValue("YUAN")):e.GamePlatform.isDragonEx_qld?(o=this.data.costdt+e.LanguageUtils.instance.getValue("YUAN"),a=n.costdt+e.LanguageUtils.instance.getValue("YUAN")):(o=this.data.costMoney+e.LanguageUtils.instance.getValue("YUAN"),a=n.costMoney+e.LanguageUtils.instance.getValue("YUAN"));var s=e.LanguageUtils.instance.getValue("FirstRecharge1");this.isLimitTime&&(s=this.isXqwdServer||i?e.LanguageUtils.instance.getValue("TimeFirstRecharge2"):e.LanguageUtils.instance.getValue("TimeFirstRecharge1")),e.PopUpController.getInstance().showTextPanel(s,this,this.rechargeMessage,0,this.rechargeMessage1,1,o,a)}},i.prototype.openTips=function(t){e.PopUpController.getInstance().showTextPanel(t,this,this.youkeYes,"",this.youkeNo,"","确定","No",20,!1,!1)},i.prototype.rechargeMessage=function(t){var i=null;i=this.data;var n={};n.goodsId=i.productId,n.productName=i.productName,n.orderMoney=i.costMoney,n.diamondNum=i.amount,n.giftDiamondNum=i.addNum,e.RechargeController.getInstance().setPayData(n);var o=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");o.setGoodsId(i.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,o,!0),e.RechargeController.getInstance().closeFirstRechargePanel()},i.prototype.rechargeMessage1=function(t){var i=null;i=e.RechargeController.getInstance().getModelRechargeData()[3];var n={};n.goodsId=i.productId,n.productName=i.productName,n.orderMoney=i.costMoney,n.diamondNum=i.amount,n.giftDiamondNum=i.addNum,e.RechargeController.getInstance().setPayData(n);var o=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");o.setGoodsId(i.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,o,!0),e.RechargeController.getInstance().closeFirstRechargePanel()},i}(eui.Component);e.FirstRechargeItem=t,__reflect(t.prototype,"foxgame.FirstRechargeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/pay/FirstRechargeSkin.exml","firstPay")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){for(var t,i,n=this.getItemIconList(),o=n.length,a=e.PlayerService.instance.mainRoleData.profession,s=this.getFirstRechargeRewardTemplate()[a],r=0;o>r;r++)t=n[r],i=s.rewardList[r],t.setItem(i.id,i.value,!0,!0),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemIconClickHandker,this);var l,h=this.getRechargeItemList();o=h.length;for(var r=0;o>r;r++)l=h[r],l.setItem(this.model.rechargeTemplate[r],r);this.model.ani&&(this.model.ani.clear(),this.model.ani=null),this.model.ani||(this.model.ani=new e.FoxAni(this.ui.aniGroup),this.model.ani.play("shouchongtejiedonghua","ani",-1)),this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHandler,this),this.doScreenAdaptation(),-1!=checkPlatformStr().indexOf("opporpk")?this.ui.rpktip.visible=!0:this.ui.rpktip.visible=!1;var c=new e.FoxAni(this.ui.wanbagroup);c.play("ui_rtw_weapon10008","ani",-1),this.ui.wb_desc.source="sc3888yuandalibao_png",e.GamePlatform.isDragonEx_qld&&(this.ui.wb_desc.source="sc3888yuandalibao_yb_png")},i.prototype.refresh=function(){-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)?this.ui.tips.textFlow=(new egret.HtmlTextParser).parser("<font size=18>以上仅可选择一种获得</font><font size=22 color=0xffe400> 5 </font><font>倍元宝</font>"):this.ui.tips.textFlow=(new egret.HtmlTextParser).parser("<font size=18>以上仅可选择一种获得</font><font size=22 color=0xffe400> 多 </font><font>倍元宝</font>"),this.ui.wanbac.visible=!0,this.ui.ptc.visible=!this.ui.wanbac.visible},i.prototype.itemIconClickHandker=function(t){var i=this.getItemIconList(),n=i.indexOf(t.currentTarget),o=e.PlayerService.instance.mainRoleData.profession,a=this.getFirstRechargeRewardTemplate()[o],s=a.rewardList[n];s.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:s.id}):e.TipsController.getInstance().showItemTips(s.id,s.value)},i.prototype.readyDestroy=function(){this.model.ani&&(this.model.ani.clear(),this.model.ani=null)},i.prototype.backHandler=function(){if(App.GuideUtils().currPart==e.GuidePart.currPart13&&0==App.GuideUtils().currStep){var t=e.MainControler.instance.getFirstRechargeBtnPoint(),i={point:t,skin:"chongzhiss_png",time:1.8,mask:!0,backFun:this.close};e.FlyController.getInstance().FlyGuide(this,i),App.GuideUtils().currStep++}else this.close()},i.prototype.closeHook=function(){e.CreateNewVipController.instance.requestVIPInfo(),this.scaleX=this.scaleY=1,this.x=this.y=0},i.prototype.getFirstRechargeRewardTemplate=function(){return e.JsonDataManager.instance.firstRechargeRewardTemplate},i.prototype.getItemIconList=function(){for(var e=[],t=0;9>=t;t++)e.push(this.ui["itemIcon"+t]);return e},i.prototype.getRechargeItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e},i.prototype.showHook=function(){e.MainControler.instance.checkRechangeGroup(!1)},i}(e.BasePanel);e.FirstRechargePanel=t,__reflect(t.prototype,"foxgame.FirstRechargePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/pay/GFBTFirstRechargeSkin.exml","firstPay")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){for(var t,i,n=this.getItemIconList(),o=n.length,a=e.PlayerService.instance.mainRoleData.profession,s=this.getFirstRechargeRewardTemplate()[a],r=0;o>r;r++)t=n[r],i=s.rewardList[r],t.setItem(i.id,i.value,!0,!0),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemIconClickHandker,this);var l,h=this.getRechargeItemList();o=h.length;for(var r=0;o>r;r++)l=h[r],l.setItem(this.model.rechargeTemplate[r],r);this.model.ani&&(this.model.ani.clear(),this.model.ani=null),this.model.ani||(this.model.ani=new e.FoxAni(this.ui.aniGroup),this.model.ani.play("shouchongtejiedonghua","ani",-1)),this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHandler,this),this.doScreenAdaptation(),-1!=checkPlatformStr().indexOf("opporpk")?this.ui.rpktip.visible=!0:this.ui.rpktip.visible=!1;var c=new e.FoxAni(this.ui.wanbagroup);c.play("zs_firstrecharge","ani",-1),this.ui.wb_desc.source="sc3888yuandalibao_png",e.GamePlatform.isDragonEx_qld&&(this.ui.wb_desc.source="sc3888yuandalibao_yb_png")},i.prototype.refresh=function(){var t,i="<font size=18>以上仅可选择一种获得</font><font size=22 color=0xffe400>",n="</font><font>倍元宝</font>";t=-1!=checkPlatformStr().indexOf(e.Global.gdserverpfh5)||-1!=checkPlatformStr().indexOf(e.Global.gdserverpfapp)?i+"5"+n:i+"多"+n,this.ui.tips.textFlow=(new egret.HtmlTextParser).parser(t),this.ui.wanbac.visible=!0,this.ui.ptc.visible=!this.ui.wanbac.visible},i.prototype.itemIconClickHandker=function(t){var i=this.getItemIconList(),n=i.indexOf(t.currentTarget),o=e.PlayerService.instance.mainRoleData.profession,a=this.getFirstRechargeRewardTemplate()[o],s=a.rewardList[n];s.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:s.id}):e.TipsController.getInstance().showItemTips(s.id,s.value)},i.prototype.readyDestroy=function(){this.model.ani&&(this.model.ani.clear(),this.model.ani=null)},i.prototype.backHandler=function(){if(App.GuideUtils().currPart==e.GuidePart.currPart13&&0==App.GuideUtils().currStep){var t=e.MainControler.instance.getFirstRechargeBtnPoint(),i={point:t,skin:"chongzhiss_png",time:1.8,mask:!0,backFun:this.close};e.FlyController.getInstance().FlyGuide(this,i),App.GuideUtils().currStep++}else this.close()},i.prototype.closeHook=function(){e.CreateNewVipController.instance.requestVIPInfo(),this.scaleX=this.scaleY=1,this.x=this.y=0},i.prototype.getFirstRechargeRewardTemplate=function(){return e.JsonDataManager.instance.firstRechargeRewardTemplate},i.prototype.getItemIconList=function(){var e=[];return e.push(this.ui.itemIcon0),e.push(this.ui.itemIcon1),e.push(this.ui.itemIcon2),e.push(this.ui.itemIcon3),e.push(this.ui.itemIcon4),e},i.prototype.getRechargeItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e},i.prototype.showHook=function(){e.MainControler.instance.checkRechangeGroup(!1)},i}(e.BasePanel);e.GFBTFirstRechargePanel=t,__reflect(t.prototype,"foxgame.GFBTFirstRechargePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/pay/LimitTimesRechargeSkin.exml")||this;return i.isGuanduServer=!1,i.isXqwdServer=!1,i.model=e,i.isMask=!0,i.setRegisterTick(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this);for(var t=this.model.limitTimesData,i=this.ui.group_propItems.numChildren,n=t.getAwards().split(","),o=function(t){var i=a.ui.group_propItems.getChildAt(t),o=new e.AttributeVO(n[t]);i.setItem(o.id,o.value,!0),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var i=t.target;o.type==e.AttributeType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:i.itemId}):e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},a)},a=this,s=0;i>s;s++)o(s);for(var r=this.ui.group_priceItems.numChildren,s=0;r>s;s++){var l=this.ui.group_priceItems.getChildAt(s);l.setItem(this.model.rechargeTemplate[s],s,!0),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("充值")},this)}this.isXqwdServer=-1!=String(getGlobalConfig().serverUrl).indexOf("yl-xbtx-res");var h,c=-1!=String(getGlobalConfig().serverUrl).indexOf("yl-res");h=this.isXqwdServer||c?"medal_110242_bigger":egret.getOption("pf")&&-1!=egret.getOption("pf").indexOf("fdbt")?"ui_rtw_wing10010":"ui_rtw_wing10006";var u=this.isXqwdServer||c?1.2:1;this.model.ani&&(this.model.ani.clear(),this.model.ani=null),this.model.ani||(this.model.ani=new e.FoxAni(this.ui.group_wingAni),this.model.ani.play(h,"ani",-1),this.model.ani.scaleX=this.model.ani.scaleY=u),this.isGuanduServer=-1!=String(getGlobalConfig().serverUrl).indexOf("guandu"),this.ui.lab_tips.text=this.isGuanduServer?e.LanguageUtils.instance.getValue("XSSHOUCHONGGDMIAOSHU"):e.LanguageUtils.instance.getValue("XSSHOUCHONGFDMIAOSHU"),this.ui.txt_multiple.text=this.isGuanduServer?e.LanguageUtils.instance.getValue("XSSHOUCHONGGDBEISHU"):e.LanguageUtils.instance.getValue("XSSHOUCHONGFDBEISHU")},i.prototype.showHook=function(){},i.prototype.tickHook=function(t){var i=e.ActivityBarController.getInstance().getLimitTime();return!i||0>=i?void this.setRegisterTick(!1):(this.ui.lab_activityTime.text=e.GlobalUtil.getTimeString(Math.ceil(i/1e3),2),void(0==Math.ceil(i/1e3)&&(this.setRegisterTick(!1),e.RechargeController.getInstance().sendMessageforLimitTimes())))},i.prototype.updateView=function(){},i.prototype.readyDestroy=function(){this.model.ani&&(this.model.ani.clear(),this.model.ani=null)},i.prototype.helpHandler=function(){e.HelpController.getInstance().showPanel("DAFUWENGHELP")},i}(e.BasePanel);e.LimitTimesRechargePanel=t,__reflect(t.prototype,"foxgame.LimitTimesRechargePanel",["foxgame.IRecharge","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.payData={},this.xyw_payData={},this.model=new e.RechargeModel,this.rechargePanel=new e.RechargePanel(this.model),egret.getOption("pf")&&-1!=egret.getOption("pf").indexOf("fdbt")?this.firstRechargePanel=new e.GFBTFirstRechargePanel(this.model):this.firstRechargePanel=new e.FirstRechargePanel(this.model),this.limitTimesPanel=new e.LimitTimesRechargePanel(this.model)}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getModel=function(){return this.model},t.prototype.registerMsg=function(t){t.add(e.Code.RECHARGE_RESPONSE,this),t.add(e.Code.LITMIT_TIMES_RECHARGE_S,this),t.add(e.Code.MOTH_ADD_MB_S,this)},t.prototype.recvMsg=function(i,n){if(console.log("充值--类型："+i),i==e.Code.RECHARGE_RESPONSE){t.getInstance().getModel().payData=this.payData,t.getInstance().getModel().payData.orderId=n.orderId;var o=e.MainControler.instance;if(null!=o.xyw_platformInfo&&"xyw"==o.xyw_platformInfo)return this.model.rechargeData=n,void this.xyw_MonthRecharge();if(e.GamePlatform.isXqwd&&!e.GamePlatform.is_XqEighteen)return void this.xyw_MonthRecharge();console.log("订单数据"+n.orderId),n&&n.orderId&&""!=n.orderId?(this.payData.orderId=n.orderId,e.UserInfo.platform.payGoods(this.payData)):e.GameUtils.MSG_TIP("@OrderFailed")}else if(i==e.Code.LITMIT_TIMES_RECHARGE_S){this.model.limitTimesData=n;var a=!this.model.limitTimesData.getDisplayStatu();if(this.model.endTimes=n.getEndTime(),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.LIMITTIMESCHARGE,a),this.model.endTimes<=0)return void e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.LIMITTIMESCHARGE,!1);if(!n||0!=n.getErrorNo())return;e.ActivityBarController.getInstance().setLimitTimesEffect(a)}else i==e.Code.MOTH_ADD_MB_S&&this.xyw_MonthRechargeRsp(n)},t.prototype.xyw_MonthRecharge=function(){var t=HawkProtocolManager.newBuilder("JsProto.addMoneyReq");e.Message.instance.send(e.Code.MOTH_ADD_MB_C,t,!0)},t.prototype.payYes=function(){t.getInstance().closeFirstRechargePanel()},t.prototype.openTips=function(t){e.PopUpController.getInstance().showTextPanel(t,this,this.payYes,"",null,"","确定","No",20,!1,!1)},t.prototype.xyw_MonthRechargeRsp=function(i){var n=i.getMoney(),o=e.MainControler.instance,a=t.getInstance().getModel().rechargeData,s=a.orderMoney;if(null!=o.xyw_platformInfo&&"xyw"==o.xyw_platformInfo){if("1"==o.xyw_UserTypeInfo){var r="根据广电总署发布的相关通知规定，游客体验模式无法充值，请注册账号体验游戏！";return void this.openTips(r)}if("0"==o.xyw_isAdultInfo){if("0"==o.xyw_ageRangeInfo){var r="根据广电总署发布的相关通知规定，未满8周岁的用户无法进行充值！";return void this.openTips(r)}if("1"==o.xyw_ageRangeInfo){if(-1!=n){var l=s+n;if(l>200){var r="根据广电总署发布的相关通知规定，8-16周岁的用户每月充值金额累计不得超过200元人民币";return void this.openTips(r)}}if(s>50){var r="根据广电总署发布的相关通知规定，8-16周岁的用户单次充值金额不得超过50元人民币！";return void this.openTips(r)}}else if("2"==o.xyw_ageRangeInfo){if(-1!=n){var l=s+n;if(l>400){var r="根据广电总署发布的相关通知规定，16-18周岁的用户每月充值金额累计不得超过400元人民币！";return void this.openTips(r)}}if(s>100){var r="根据广电总署发布的相关通知规定，16-18周岁的用户单次充值金额不得超过100元人民币！";return void this.openTips(r)}}}a&&a.orderId&&""!=a.orderId?(this.xyw_payData.orderId=a.orderId,e.UserInfo.platform.payGoods(t.getInstance().getModel().payData)):e.GameUtils.MSG_TIP("@OrderFailed")}},t.prototype.getLimitEndTimes=function(){return this.model.endTimes},t.prototype.setPayData=function(e){this.payData=e},t.prototype.showPanel=function(t){if(void 0===t&&(t=!1),e.GamePlatform.isDragonEx_qld)return void e.GamePlatform.sendRechargeOasis();var i=e.PlayerService.instance.playerInfo.getFirstRechargeState(),n=e.Global.isYouGuSDK&&!e.PlayerService.instance.playerInfo.getFirstRechargeTimesState();this.model.isFirstPayAfterPay=n,t?this.model.rechargeTemplate=e.JsonDataManager.instance.limitTimesTemplate:i?this.model.rechargeTemplate=e.JsonDataManager.instance.firstRechargeTemplate:this.model.rechargeTemplate=e.JsonDataManager.instance.rechargeTemplate,t?this.limitTimesPanel.show():i?this.firstRechargePanel.show():this.rechargePanel.show()},t.prototype.sendMessageforLimitTimes=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPLTFirstRechargeReq");e.Message.instance.send(e.Code.LITMIT_TIMES_RECHARGE_C,t,!0)},t.prototype.closeFirstRechargePanel=function(){this.firstRechargePanel.close()},t.prototype.getModelRechargeData=function(){return this.model.rechargeTemplate},t.prototype.ttpayView=function(t){var i=e.Global.globalConfig.ttpay;i=i+"?cb=?&openid="+t.openid+"&appid="+t.appid+"&ts="+t.ts+"&zone_id="+t.zone_id+"&pf="+t.pf+"&amt="+t.amt+"&bill_no="+t.bill_no+"&",console.log("扣除游戏币下单请求地址:",i),e.GameUtils.httpReqsajax(i,null,this.ttBack.bind(this),null)},t.prototype.ttBack=function(e){console.log("扣款成功："+JSON.stringify(e))},t}();e.RechargeController=t,__reflect(t.prototype,"foxgame.RechargeController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="RechargeItemSkin",this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},i.prototype.setItem=function(t,i){void 0===i&&(i=!1),this.data=t,e.GamePlatform.isDragonEx?(this.priceLabel.text=t.costdt+"",this.normalUnitLabel.text="DT"):e.GamePlatform.isDragonEx_qld?(this.priceLabel.text=t.costMoney+"",this.normalUnitLabel.text="元宝"):(this.priceLabel.text=t.costMoney+"",this.normalUnitLabel.text="元"),t.icon&&(this.iconImg.source=t.icon.split("/")[2].split(".")[0]+"_png"),i?(this.normal.visible=!1,this.firstPayAfter.visible=!0):(this.normal.visible=!0,this.firstPayAfter.visible=!1,this.giveLabel.text=t.addNum+""),this.bmpLabel.text=t.amount+""},i.prototype.clickHandler=function(t){var i={};i.goodsId=this.data.productId,i.productName=this.data.productName,i.orderMoney=this.data.costMoney,i.diamondNum=this.data.amount,i.giftDiamondNum=this.data.addNum,e.RechargeController.getInstance().setPayData(i);var n=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");n.setGoodsId(this.data.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,n,!0)},i}(eui.Component);e.RechargeItem=t,__reflect(t.prototype,"foxgame.RechargeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeItemData=t,__reflect(t.prototype,"foxgame.RechargeItemData")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.limitTimesData=null,this.observerList=[],this.payData={}}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)
},e}();e.RechargeModel=t,__reflect(t.prototype,"foxgame.RechargeModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/pay/RechargeSkin.exml","recharge")||this;return i.columnNum=2,i.gap=15,i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.ui.vipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.vipHandler,this),this.ui.btn_blue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.blueHandler,this),this.ui.group_qqdt.visible="QQdating"==getchannel()?!0:!1;for(var t,i,n,o=this.model.rechargeTemplate,a=o.length,s=0;a>s;s++)t=o[s],i=new e.RechargeItem,i.setItem(t,this.model.isFirstPayAfterPay),n=this.getIconPos(i.width,i.height,s),i.x=n.x,i.y=n.y,this.ui.contentGroup.addChild(i);-1!=checkPlatformStr().indexOf("opporpk")?this.ui.rpkimg.visible=this.ui.rpktip.visible=!0:this.ui.rpkimg.visible=this.ui.rpktip.visible=!1,this.doScreenAdaptation()},i.prototype.refresh=function(){var t=e.PlayerService.instance.playerInfo.getVipLevel(),i=this.getVipTemplate()[t+1],n=e.PlayerService.instance.playerInfo.getRecharge(),o=null!=i?i.needRechargeGold:n,a=n/o;this.ui.progressText.text=n+"/"+o;var s,r;null!=i?(s=i.needRechargeGold-n,r=e.LanguageUtils.instance.getValue("VIPEXPLAIN"+t,s)):r="",this.ui.goldLabel.textFlow=(new egret.HtmlTextParser).parser(r),this.ui.barImg.width=252*a,this.ui.vipImg.source="vip"+t+"_png"},i.prototype.updateView=function(){this.refresh()},i.prototype.vipHandler=function(t){e.CreateNewVipController.instance.showPanel(),this.close()},i.prototype.blueHandler=function(t){var i={code:"showBuyQQGame",service_type:1,duration:3};e.UserInfo.platform.reportData_legend(i)},i.prototype.getIconPos=function(e,t,i){var n=new egret.Point,o=Math.floor(i/this.columnNum),a=i%this.columnNum;return n.x=a*(e+this.gap),n.y=o*(t+this.gap),n},i.prototype.showHook=function(){e.MainControler.instance.checkRechangeGroup(!1)},i.prototype.closeHook=function(){e.CreateNewVipController.instance.requestVIPInfo()},i.prototype.getVipTemplate=function(){return e.JsonDataManager.instance.vipTemplate},i}(e.BasePanel);e.RechargePanel=t,__reflect(t.prototype,"foxgame.RechargePanel",["foxgame.IRecharge","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.RedPacketModel,this.panel=new e.RedPacketListView(this.model),this.tuisongMain=new e.RedPacketTuiSongMainPanel(this.model),this.lessPanel=new e.RedPacketLessView(this.model),this.infoPanel=new e.RedPacketInfoView(this.model)}return t.prototype.registerMsg=function(t){t.add(e.Code.READ_PACKAGE_ROB_S,this),t.add(e.Code.READ_PACKAGE_ROB_INFO_S,this),t.add(e.Code.READ_PACKAGE_GOLDS_INFO_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.READ_PACKAGE_GOLDS_INFO_S:this.model.setRedPacketInForData(i);break;case e.Code.READ_PACKAGE_ROB_S:this.model.setRobData(i);break;case e.Code.READ_PACKAGE_ROB_INFO_S:this.model.setRedPacketTuiSong(i)}},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.getRedPacketInfo(),this.panel.getIsShow()||this.panel.show()},t.prototype.getRedPacketInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerInfoReq");e.Message.instance.send(e.Code.READ_PACKAGE_GOLDS_INFO_C,t,!0)},t.prototype.qiangRedPacket=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPRedPackageRobRep");i.setMarkNumber(t),e.Message.instance.send(e.Code.READ_PACKAGE_ROB_C,i,!0)},t.prototype.showLessTipPanel=function(){this.lessPanel.getIsShow()||this.lessPanel.show()},t.prototype.closeAllPanel=function(){this.lessPanel.getIsShow()&&this.lessPanel.close(),this.panel.getIsShow()&&this.panel.close(),this.tuisongMain.getIsShow()&&this.tuisongMain.close()},t.prototype.showInfoPanel=function(){this.getRedPacketInfo(),this.infoPanel.getIsShow()||this.infoPanel.show()},t.prototype.showTuiSongPanel=function(t){this.tuisongMain.getIsShow()||(e.ActivityBarController.getInstance().setRedPacketRed(!0),this.tuisongMain.setItemData(t),this.tuisongMain.show())},t}();e.RedPacketController=t,__reflect(t.prototype,"foxgame.RedPacketController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="RedPacketInfoItemViewSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this.currentData=this.data;var i=e.LanguageUtils.instance.getValue("REDPACKET_MESSAGE",this.currentData.getPlayerName(),this.currentData.getGolds());this.txt.textFlow=(new egret.HtmlTextParser).parser(i)}},i}(eui.ItemRenderer);e.RedPacketInfoItemView=t,__reflect(t.prototype,"foxgame.RedPacketInfoItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/RedPacket/RedPacketInfoViewSkin.exml")||this;return i.setIsTextureCache(!0),i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.panelChanged=function(){this.getIsInit()&&this.getIsShow()&&this.initUI()},i.prototype.initHook=function(){this.model.registerObserver(this)},i.prototype.readyDestroy=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.RedPacketController.getInstance().closeAllPanel(),e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)},i.prototype.showHook=function(){this.initUI()},i.prototype.initUI=function(){this.currentData=this.model.getRobData();var t=e.LanguageUtils.instance.getValue("HUODEYUANBAO",this.currentData.getGoldsNumber());0==this.currentData.getGoldsNumber()?(this.ui.zaijiezaili.visible=!0,this.ui.gongxi.visible=!1):(this.ui.zaijiezaili.visible=!1,this.ui.gongxi.visible=!0),this.ui.txt.text=t;var i=this.currentData.getLogList(),n=this.ui.scroller;n.viewport.scrollV=0;var o=this.ui.list;this.model.collection_info.source=[],o.dataProvider=this.model.collection_info,o.itemRenderer=e.RedPacketInfoItemView,i=i.reverse(),this.model.collection_info.replaceAll(i)},i}(e.BasePanel);e.RedPacketInfoView=t,__reflect(t.prototype,"foxgame.RedPacketInfoView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/RedPacket/RedPacketLessSkin.exml")||this;return i.setIsTextureCache(!0),i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.panelChanged=function(){this.getIsInit()&&this.getIsShow()&&this.initUI()},i.prototype.initHook=function(){this.model.registerObserver(this)},i.prototype.readyDestroy=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){e.RedPacketController.getInstance().closeAllPanel(),e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.RECHARGE)},i.prototype.showHook=function(){this.initUI()},i.prototype.initUI=function(){this.currentData=this.model.getRobData();var t=e.JsonDataManager.instance.roleTemplate,i=e.PlayerService.instance.mainRoleData.itemId,n=t[i];this.ui.playerIcon.source=n.icon,this.ui.playerName.text=e.PlayerService.instance.mainRoleData.name,this.ui.yuanbaoNum.text=this.currentData.getGoldsNumber()+"";var o=e.LanguageUtils.instance.getValue("WOYAOCHONGZHI");this.ui.chongzhiBtn.textFlow=(new egret.HtmlTextParser).parser(o),this.ui.chongzhiBtn.touchEnabled=!0,this.ui.chongzhiBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i}(e.BasePanel);e.RedPacketLessView=t,__reflect(t.prototype,"foxgame.RedPacketLessView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="RedPacketRobListItemViewSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.data){this.currentData=this.data;var i=e.JsonDataManager.instance.roleTemplate,n=i[this.currentData.getItemId()];n&&(this.player_icon.source=n.icon2),this.playerName.text=this.currentData.getPlayerName(),this.isRobTxt.text=this.checkstate(this.currentData.getRobGolds())}},i.prototype.checkstate=function(t){var i="";return i=0==t?this.currentData.getRobState()?e.LanguageUtils.instance.getValue("YIQIANGGUANG"):e.LanguageUtils.instance.getValue("WEIQIANGDUO"):e.LanguageUtils.instance.getValue("QIANGDAOYUANBAO",t),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),i},i.prototype.onClick=function(t){e.RedPacketController.getInstance().qiangRedPacket(this.currentData.getMarkNumber())},i}(eui.ItemRenderer);e.RedPacketListItemView=t,__reflect(t.prototype,"foxgame.RedPacketListItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/RedPacket/RedPacketRobListViewSkin.exml","redPacket",!1)||this;return i.model=e,i.setIsTextureCache(!0),i}return __extends(i,t),i.prototype.panelChanged=function(){this.getIsInit()&&this.getIsShow()&&this.initUI()},i.prototype.initHook=function(){this.model.registerObserver(this)},i.prototype.readyDestroy=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(e){},i.prototype.showHook=function(){void 0!=this.model.getRedPacketInForData()&&this.initUI()},i.prototype.initUI=function(){this.currentData=this.model.getRedPacketInForData();var t=this.currentData.getRedInfo(),i=[],n=[],o=0,a=t.length;for(o;a>o;o++){var s=t[o];s.getRobState()?i.push(s):n.push(s)}i.sort(this.sortGold),n.sort(this.sortGold),t=n.concat(i);var r=this.ui.scroller;r.viewport.scrollV=0;var l=this.ui.list;this.model.collection.source=[],l.dataProvider=this.model.collection,l.itemRenderer=e.RedPacketListItemView,this.model.collection.replaceAll(t),this.ui.numTxt.text=this.currentData.getRobNumber()+""},i.prototype.sortGold=function(e,t){return e.getRobGolds()>0&&t.getRobGolds()>0?0:e.getRobGolds()>0&&0==t.getRobGolds()?1:0==e.getRobGolds()&&t.getRobGolds()>0?-1:0==e.getRobGolds()&&0==t.getRobGolds()?0:void 0},i}(e.BasePanel);e.RedPacketListView=t,__reflect(t.prototype,"foxgame.RedPacketListView",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.observerList=[],this.datasource=[],this.collection=new eui.ArrayCollection,this.collection.source=this.datasource,this.datasource_info=[],this.collection_info=new eui.ArrayCollection,this.collection_info.source=this.datasource_info,this._tuisongData=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.panelChanged()},t.prototype.setRedPacketInForData=function(t){this._infoData=t;var i=this._infoData.getRedInfo(),n=i.length,o=0;for(e.ActivityBarController.getInstance().setRedPacketRed(!1),o;n>o;o++){var a=i[o];if(!a.getRobState()&&0==a.getRobGolds()){e.ActivityBarController.getInstance().setRedPacketRed(!0);break}}this._infoData.getRobNumber()<=0&&e.ActivityBarController.getInstance().setRedPacketRed(!1),this.updateView()},t.prototype.getRedPacketInForData=function(){return this._infoData},t.prototype.setRobData=function(t){this._robData=t,2==this._robData.getTypeId()?e.RedPacketController.getInstance().showLessTipPanel():1==this._robData.getTypeId()&&(e.RedPacketController.getInstance().showInfoPanel(),this.updateView())},t.prototype.getRobData=function(){return this._robData},t.prototype.setRedPacketTuiSong=function(t){e.RechargeController.getInstance().sendMessageforLimitTimes(),this._tuisongData.push(t),e.RedPacketController.getInstance().showTuiSongPanel(t)},t.prototype.getRedPacketTuiSongIndex=function(e){return this._tuisongData.indexOf(e)},t.prototype.getHongBaoXY=function(e){if(this._tuisongData.indexOf(e)<0)return null;var t=this._tuisongData.indexOf(e),i=new egret.Point,n=ScreenAdaptation.instance.uiWidth/4;return i.x=n*(t%4)/4,i},t}();e.RedPacketModel=t,__reflect(t.prototype,"foxgame.RedPacketModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.ranY=0,e.skinName="RedPacketTuiSongItemViewSkin",e.ranY=Math.floor(10*Math.random()+10),e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var i=e.ActivityController.getIntance().getModelForDaBiao();i?"duanwu"==i.getListData().getHolidayName()?this.img.source="hongbaoicon_png":"xiari"==i.getListData().getHolidayName()?this.img.source="xigua_png":"zuqiu"==i.getListData().getHolidayName()?this.img.source="zuqiu_png":"shengdanjie"==i.getListData().getHolidayName()?this.img.source="shengdanicon1_png":"yuandan"==i.getListData().getHolidayName()?this.img.source="yuandanicon_png":this.img.source="1hongbaoicon_png":this.img.source="1hongbaoicon_png"},i.prototype.updateXY=function(){this.y+=this.ranY},i.prototype.closeAll=function(){this.parent.removeChild(this)},i}(eui.Component);e.RedPacketTuiSongItemView=t,__reflect(t.prototype,"foxgame.RedPacketTuiSongItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/RedPacket/RedPacketTuiSongMainViewSkin.exml","redPacket",!1)||this;return i.model=e,i.setIsTextureCache(!0),i.layer=LayerType.TOPLAYER,i.isMask=!1,i.setIsShowBackBtn(!1),i}return __extends(i,t),i.prototype.setItemData=function(e){},i.prototype.panelChanged=function(){!this.getIsInit()||!this.getIsShow()},i.prototype.initHook=function(){this.model.registerObserver(this)},i.prototype.showHook=function(){this.itemArr=[],this.initUI()},i.prototype.initUI=function(){var t,i=5,n=5,o=0,a=0;for(t=e.GamePlatform.isQQdating?ScreenAdaptation.instance.screenWidth:ScreenAdaptation.instance.uiWidth,o;i>o;o++)for(a=0;n>a;a++){var s=new e.RedPacketTuiSongItemView;this.addChild(s),s.x=this.globalToLocal(Math.floor(Math.random()*t-62)+62,0).x,s.y=-s.height-80-s.height*o+Math.floor(100*Math.random()),this.itemArr.push(s)}this.setRegisterTick(!0)},i.prototype.tickHook=function(e){var t=e-this.lastTime;if(!(20>t)){this.lastTime=e;var i=0,n=this.itemArr,o=n.length;if(0!=o){for(i;o>i;i++){var a=this.itemArr[i];a&&(a.updateXY(),a.y>ScreenAdaptation.instance.uiHeight&&(a.closeAll(),this.itemArr.splice(i,1),a=null))}0==this.itemArr.length&&this.close()}}},i}(e.BasePanel);e.RedPacketTuiSongMainPanel=t,__reflect(t.prototype,"foxgame.RedPacketTuiSongMainPanel",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="SearchTreasureAwardItem",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data;this.item.setItem(t.getItemId(),t.getNum())},t}(eui.ItemRenderer);e.SearchTreasureAwardItem=t,__reflect(t.prototype,"foxgame.SearchTreasureAwardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.SearchTreasureModel,this.treasurePanel=new e.SearchTreasurePanel(this.model),this.resultPanel=new e.SearchTreasureRewardPanel(this.model),this.equipTips=new e.SearchTreasureEquipTips,this.godlyTips=new e.SearchTreasureGodlyEquipTips}return t.prototype.registerMsg=function(t){t.add(e.Code.TREASURE_HUNT_S,this),t.add(e.Code.TREASURE_HUNT_LOG_S,this),t.add(e.Code.TREASURE_SALE_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.TREASURE_HUNT_S:1==i.getResult()&&(this.model.resultList=i.getItems(),this.resultPanel.showPage(i.getHuntCount()));break;case e.Code.TREASURE_HUNT_LOG_S:this.model.setTreasureLog(i);break;case e.Code.TREASURE_SALE_S:this.model.updateTreasureSale(i)}},t.prototype.sendTreasureSale=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPTreasureSaleRep");e.Message.instance.send(e.Code.TREASURE_SALE_C,t,!0)},t.prototype.guideshow=function(){this.treasurePanel.showguide()},t.prototype.requestSearch=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPTreasureHuntReq");i.setHuntCount(t),e.Message.instance.send(e.Code.TREASURE_HUNT_C,i,!0)},t.prototype.showPanel=function(){var t=e.ActivityController.getIntance().getActivityById(e.ActivityId.TREASURE_HUNT);if(null!=t){for(var i,n=e.PlayerService.instance.level,o=this.getSearchTreasureTemplate()[t.getStageId()],a=o.length,s=0,r=null;a>s;s++)if(r=o[s],r.minLevel<=n&&r.maxLevel>=n){i=r;break}this.model.treasureVO=i,this.treasurePanel.show(),this.treasurePanel.sendTreasureHuntLogReq()}},t.prototype.showEquipTips=function(){this.equipTips.show()},t.prototype.showGodlyTips=function(){this.godlyTips.show()},t.prototype.setRecords=function(e){this.model.setRecords(e)},t.prototype.getSearchTreasureTemplate=function(){return e.JsonDataManager.instance.searchTreasureTemplate},t.prototype.getmodel=function(){return this.model},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();e.SearchTreasureController=t,__reflect(t.prototype,"foxgame.SearchTreasureController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this,"resource/skins/openbox/SearchTreasureEquipTips.exml")||this;return t.isMask=!0,t}return __extends(t,e),t}(e.BasePanel);e.SearchTreasureEquipTips=t,__reflect(t.prototype,"foxgame.SearchTreasureEquipTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this,"resource/skins/openbox/SearchTreasureGodlyEquipTips.exml")||this;return t.isMask=!0,t}return __extends(t,e),t}(e.BasePanel);e.SearchTreasureGodlyEquipTips=t,__reflect(t.prototype,"foxgame.SearchTreasureGodlyEquipTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.maxNum=30,this.tipbool=!1,this.recordList=[],this.observerList=[],this.tipbool=!1}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.setRecords=function(e){var t=e.getParams(),i={};for(i.playerId=t[0].getIntParam(),i.playerName=t[0].getStrParam(),t[1]&&(i.itemId=t[1].getIntParam()),this.recordList.push(i);this.recordList.length>this.maxNum;)this.recordList.shift();this.updateRecord()},t.prototype.updateRecord=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateRecords()},t.prototype.updateSale=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateSale()},t.prototype.setTreasureLog=function(e){var t=e.getHuntLog().length;this.recordList=[];for(var i=0;t>i;i++){var n=e.getHuntLog()[i],o={};for(o.playerId=n.getPlayerId(),o.playerName=n.getPlayerName(),o.itemId=n.getItemId(),this.recordList.push(o);this.recordList.length>this.maxNum;)this.recordList.shift()}this.updateRecord()},t.prototype.updateTreasureSale=function(t){this.saleList=[];var i,n=e.ActivityBarController.getInstance().getpanel().getGroupList();t.getSaleInfo().length>0?n[e.ActivityBtnType.XUNBAO].btn.$children[0].source="btn_baozang_zhekou_png":n[e.ActivityBtnType.XUNBAO].btn.$children[0].source="xunbaoxb_png";for(var o=0;o<t.getSaleInfo().length;o++)i=t.getSaleInfo()[o],this.saleList[i.getType()]=i;this.updateSale()},t.XUNBAO=1,t.XUNBAO_LONGSHEN=2,t.XUNBAO_SHENMI=3,t}();e.SearchTreasureModel=t,__reflect(t.prototype,"foxgame.SearchTreasureModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/openbox/SearchTreasureSkin.exml","searchTreasure")||this;return i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.bagItemChanged=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_1")),i=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_1")),n=e.BagController.getInstance().getCountByItemId(t.id);this.ui.priceLabel1.textFlow=e.GlobalUtil.createMaterialProTextFlow(n,i.value),this.ui.priceLabel3.textFlow=e.GlobalUtil.createMaterialProTextFlow(n,t.value)},i.prototype.initHook=function(){this.model.registerObserver(this),e.BagController.getInstance().registerObserver(this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpClickHandler,this),this.ui.buyOneBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyHandler,this),this.ui.buyMoreBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyHandler,this),this.ui.contentLabel.addEventListener(egret.TextEvent.LINK,this.linkHandler,this),this.ui.equipImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.imgClickHandler,this,!0),this.ui.godlyEquipImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.imgClickHandler,this),this.ui.closeBt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.dragongodtreasure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.goldtreasure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this);for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.saleList=[]},i.prototype.showHook=function(){this.doScreenAdaptation(),e.SearchTreasureController.getInstance().sendTreasureSale()},i.prototype.showguide=function(){if(App.GuideUtils().currPart==e.GuidePart.currPart17&&2==App.GuideUtils().currStep){var t=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart17,3,!1)}},i.prototype.refresh=function(){e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("DRAGON_GOD_TREASURE_OPEN"))?(this.ui.group_longshen.visible=!0,this.ui.group_longshen.parent.removeChild(this.ui.group_longshen),this.ui.group_allSelected.addChild(this.ui.group_longshen),this.ui.group_xunbao.visible=!0,this.ui.redpointbk.visible=e.DragongodTreasureController.getInstance().redpoint(),this.ui.redpointxb.visible=e.ActivityBarController.getInstance().refreshSearchTreasureRedPoint(),e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("TREASURE_OF_ANCIENT_GOD_OPEN_LEVEL"))?(this.ui.group_gushen.visible=!0,this.ui.group_gushen.parent.removeChild(this.ui.group_gushen),this.ui.group_allSelected.addChild(this.ui.group_gushen),this.ui.redpointgt.visible=e.GoldTreasureController.getInstance().redpoint()):this.ui.group_gushen.visible=!1):this.ui.group_allSelected.visible=!1,App.GuideUtils().currPart==e.GuidePart.currPart17&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.ui.buyOneBtn,this,e.GuidePart.currPart17,1,!1,this.getScale()),42==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.dragongodtreasure,this.ui.dragongodtreasure.parent,42,2,!0);for(var t,i,n=this.model.treasureVO.rewardList,o=n.length,a=this.getItemList(),s=0;o>s;s++)t=n[s],i=a[s],i.setItem(t.id);this.updateRecords();var r=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_1")),l=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_2")),h=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_1")),c=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_2")),u=e.BagController.getInstance().getCountByItemId(h.id);1!=this.discount?this.showDiscount(l.value,c.value):this.showOriginal(),this.ui.priceLabel1.textFlow=e.GlobalUtil.createMaterialProTextFlow(u,r.value),this.ui.priceLabel3.textFlow=e.GlobalUtil.createMaterialProTextFlow(u,h.value)},i.prototype.showOriginal=function(){var t=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_2")),i=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_2"));this.ui.priceLabel0.text=t.value+"",this.ui.priceLabel2.text=i.value+"",-1!=this.ui.group_one.getChildIndex(this.ui.group_original0)&&this.ui.group_one.removeChild(this.ui.group_original0),-1!=this.ui.group_ten.getChildIndex(this.ui.group_original1)&&this.ui.group_ten.removeChild(this.ui.group_original1),this.ui.group_one.x=this.ui.buyOneBtn.x-(this.ui.group_one.width-this.ui.buyOneBtn.width)/2,this.ui.group_ten.x=this.ui.buyMoreBtn.x-(this.ui.group_ten.width-this.ui.buyMoreBtn.width)/2,this.ui.zhekou0.visible=this.saleList[e.SearchTreasureModel.XUNBAO]?!0:!1,this.ui.zhekou1.visible=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?!0:!1,this.ui.zhekou2.visible=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?!0:!1,this.ui.tab_zhe0.text=this.saleList[e.SearchTreasureModel.XUNBAO]?10*this.saleList[e.SearchTreasureModel.XUNBAO].getSaleNumber()+"":"",this.ui.tab_zhe1.text=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?10*this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN].getSaleNumber()+"":"",this.ui.tab_zhe2.text=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?10*this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI].getSaleNumber()+"":"",this.ui.group_zhekou.visible=!1},i.prototype.playAni=function(){this.effAni&&(this.effAni.clear(),this.effAni=null),this.effAni=new e.FoxAni(this.ui.eff_group),this.effAni.play("fx_zhekou","ani",-1)},i.prototype.showDiscount=function(t,i){this.ui.priceLabel0.text=t*this.discount+"",this.ui.txt_discount0.text=t+"",this.ui.priceLabel2.text=i*this.discount+"",this.ui.txt_discount1.text=i+"",this.ui.group_one.x=this.ui.buyOneBtn.x-(this.ui.group_one.width-this.ui.buyOneBtn.width)/2,this.ui.group_ten.x=this.ui.buyMoreBtn.x-(this.ui.group_ten.width-this.ui.buyMoreBtn.width)/2,this.ui.zhekou0.visible=this.saleList[e.SearchTreasureModel.XUNBAO]?!0:!1,this.ui.zhekou1.visible=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?!0:!1,this.ui.zhekou2.visible=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?!0:!1,this.ui.tab_zhe0.text=this.saleList[e.SearchTreasureModel.XUNBAO]?10*this.saleList[e.SearchTreasureModel.XUNBAO].getSaleNumber()+"":"",this.ui.tab_zhe1.text=this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN]?10*this.saleList[e.SearchTreasureModel.XUNBAO_LONGSHEN].getSaleNumber()+"":"",this.ui.tab_zhe2.text=this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI]?10*this.saleList[e.SearchTreasureModel.XUNBAO_SHENMI].getSaleNumber()+"":"",this.ui.group_zhekou.visible=!0,this.playAni();var n=10*this.discount+"",o=n.split(".");this.ui.txt_zhekou.text=o.length>1?o[0]+".wz":" "+o[0]+"z",this.time>0&&(this.ui.txt_time.text="折扣剩余时间:"+e.GlobalUtil.secondsToTimeSimple(this.time),App.TimerManager().doTimer(1e3,0,this.timeOut,this))},i.prototype.timeOut=function(){this.time--,this.ui.txt_time.text="折扣剩余时间:"+e.GlobalUtil.secondsToTimeSimple(this.time),this.time<0&&(this.time=0,this.ui.txt_time.text="",this.showOriginal(),e.SearchTreasureController.getInstance().sendTreasureSale(),App.TimerManager().remove(this.timeOut,this))},i.prototype.updateSale=function(){this.saleList=e.SearchTreasureController.getInstance().getmodel().saleList;var t=this.saleList[e.SearchTreasureModel.XUNBAO];t?(this.time=Math.floor(t.getDateTimes()/1e3),this.discount=t.getSaleNumber()):(this.time=0,this.discount=1,this.ui.txt_time.text=""),this.refresh()},i.prototype.updateRecords=function(){var t=new egret.HtmlTextParser;this.ui.contentLabel.textFlow=t.parser("");for(var i,n,o,a,s=this.model.recordList.length,r="",l=0;s>l;l++)i=this.model.recordList[l],o=this.getItemTemplate()[i.itemId],n=e.ColorUtils.instance.getColorByQuality(o.quality),a=n.toString(16),r+=e.LanguageUtils.instance.getValue("TREASURERECORD",i.playerId,i.playerName,a,i.itemId,o.name)+"\n";r=this.cleanUpStr(r),this.ui.contentLabel.textFlow=(new egret.HtmlTextParser).parser(r),this.ui.contentLabel.height>this.ui.scroller.height?this.ui.scroller.viewport.scrollV=this.ui.contentLabel.height-this.ui.scroller.height:this.ui.scroller.viewport.scrollV=0},i.prototype.sendTreasureHuntLogReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.TreasureHuntLogReq");e.Message.instance.send(e.Code.TREASURE_HUNT_LOG_C,t,!0)},i.prototype.cleanUpStr=function(t){var i=t.split("\n"),n=[],o=i.length,a="",s=Number(e.LanguageUtils.instance.getValue("SEARCHMSGMAXLENGTH"));if(!(o>s))return t;var r=o-s-1;n=i.splice(r,o);for(var l=0;l<n.length;l++)""!=n[l]&&(a+=n[l]+"\n");return a},i.prototype.linkHandler=function(t){var i=t.text.split("_"),n=i[0],o=Number(i[1]);if("playerId"==n){if(-1==o)return;e.OtherCharacterController.getInstance().showOtherCharacterPanel(o)}else{if("itemId"!=n)throw new Error("examine parameter Error");var a=this.getItemTemplate()[o];e.TipsController.getInstance().showItemTips(a.id)}},i.prototype.imgClickHandler=function(t){t.currentTarget==this.ui.equipImg?e.SearchTreasureController.getInstance().showEquipTips():e.SearchTreasureController.getInstance().showGodlyTips()},i.prototype.itemClickHandler=function(t){var i=this.getItemList(),n=i.indexOf(t.currentTarget),o=this.model.treasureVO.rewardList,a=o[n];e.TipsController.getInstance().showItemTips(a.id,a.value)},i.prototype.buyHandler=function(t){var i,n,o=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_1")),a=e.BagController.getInstance().getCountByItemId(o.id);if(t.currentTarget==this.ui.buyOneBtn){if(i=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_1")),n=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_2")),this.count=Number(e.GlobalConfig.instance.getValue("SEARCHTREASURE_COUNT1")),a>=1)return void e.SearchTreasureController.getInstance().requestSearch(this.count)}else i=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_1")),n=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_2")),this.count=Number(e.GlobalConfig.instance.getValue("SEARCHTREASURE_COUNT2"));if(e.PlayerService.instance.playerInfo.getGold()<n.value&&e.BagController.getInstance().getCountByItemId(i.id)<i.value)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var s=this.time>0?n.value*this.discount:n.value;return(10>a&&t.currentTarget==this.ui.buyMoreBtn||1>a&&t.currentTarget==this.ui.buyOneBtn)&&!this.model.tipbool?void e.PopUpController.getInstance().showTextPanel2(e.LanguageUtils.instance.getValue("XUNBAO_GOUMAIQUAN",s),this,this.buySearch.bind(this),{tipbool:this.model.tipbool}):void e.SearchTreasureController.getInstance().requestSearch(this.count)},i.prototype.buySearch=function(t){void 0===t&&(t=null),t&&(this.model.tipbool=t),e.SearchTreasureController.getInstance().requestSearch(this.count)},i.prototype.closeHook=function(){this.scaleX=this.scaleY=1,this.x=this.y=0,App.GuideUtils().currPart==e.GuidePart.currPart17&&3==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.TimerManager().remove(this.timeOut,this),this.effAni&&(this.effAni.clear(),this.effAni=null)},i.prototype.getItemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.helpClickHandler=function(t){e.HelpController.getInstance().showPanel("TREASUREHUNTHELP")},i.prototype.getItemList=function(){for(var e=[],t=0;10>t;t++)e.push(this.ui["item"+t]);return e},i.prototype.clickskip=function(t){switch(t.target){case this.ui.xunbao:break;case this.ui.dragongodtreasure:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE),this.close();break;case this.ui.goldtreasure:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.GUSHENMIBAO),this.close()}},i}(e.BasePanel);e.SearchTreasurePanel=t,__reflect(t.prototype,"foxgame.SearchTreasurePanel",["foxgame.ISearchTreasure","foxgame.IObserver","foxgame.IBag"])
}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/openbox/SearchTreasureRewardSkin.exml")||this;return i.aniArr=[],i.tenDoneNum=0,i.model=e,i.isMask=!0,i}return __extends(i,t),i.prototype.showPage=function(e){this.lastCountType=e,this.getIsShow()?this.refresh():this.show()},i.prototype.initHook=function(){for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);if(t=i[1],this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this),App.GuideUtils().currPart==e.GuidePart.currPart17&&1==App.GuideUtils().currStep){var a=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(a,a.parent,e.GuidePart.currPart17,2,!1)}},i.prototype.backHandler=function(){if(this.tw&&(this.tw.pause(),this.tw=null),this.twArr&&this.twArr.length>0){var e=0,t=this.twArr.length;for(e;t>e;e++){var i=this.twArr[e];i.pause(),i=null}}TweenMax.killTweensOf(this),this.close()},i.prototype.closeHook=function(){App.GuideUtils().currPart==e.GuidePart.currPart17&&2==App.GuideUtils().currStep&&e.SearchTreasureController.getInstance().guideshow()},i.prototype.refresh=function(){TweenMax.killTweensOf(this),this.tw=TweenMax.delayedCall(.3,this.delayShow.bind(this));var t=Number(e.GlobalConfig.instance.getValue("SEARCHTREASURE_COUNT1")),i=Number(e.GlobalConfig.instance.getValue("SEARCHTREASURE_COUNT2"));this.lastCountType==t?(this.cost1=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_1")),this.cost2=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_SINGLE_COST_2"))):this.lastCountType==i&&(this.cost1=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_1")),this.cost2=new e.AttributeVO(e.GlobalConfig.instance.getValue("TREASURE_SEARCH_TEN_COST_2")));var n=e.SearchTreasureController.getInstance().getmodel().saleList[e.SearchTreasureModel.XUNBAO],o=n?this.cost2.value*n.getSaleNumber():this.cost2.value;this.ui.priceLabel0.text=o+"";var a=e.BagController.getInstance().getCountByItemId(this.cost1.id);this.ui.priceLabel1.textFlow=e.GlobalUtil.createMaterialProTextFlow(a,this.cost1.value)},i.prototype.delayShow=function(){this.twArr=[];var e,t=this.getItemList(),i=t.length,n=this.model.resultList,o=0;this.tenDoneNum=0;for(var a=0;i>a;a++)if(e=t[a],TweenMax.killTweensOf(e),e.visible=!1,n[a]){e.setItem(n[a].getItemId(),n[a].getNum()),o=.1*(a+1);var s=TweenMax.delayedCall(o,this.funBack.bind(this),[e,a]);this.twArr.push(s)}},i.prototype.funBack=function(e,t){var i,n,o=0;0!=this.aniArr.length&&this.aniArr[t]&&(i=this.aniArr[t]),this.getAniGroupList()[t]&&(n=this.getAniGroupList()[t]),this.effectLingQu(!0,i,n),o=.03*(t+1),TweenMax.delayedCall(o,this.funBack1.bind(this),[e,t])},i.prototype.funBack1=function(e,t){var i=0;i=this.lastCountType?this.lastCountType:1,this.tenDoneNum<i&&this.tenDoneNum++,e.visible=!0},i.prototype.itemHandler=function(t){var i=this.getItemList(),n=i.indexOf(t.target),o=this.model.resultList,a=o[n],s=e.JsonDataManager.instance.itemTemplate[a.getItemId()];s.type==e.ItemType.EQUIP?e.TipsController.getInstance().showEquipTips({equipId:s.id}):s.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(s.id):e.TipsController.getInstance().showItemTips(s.id)},i.prototype.btnClickHandler=function(t){return e.PlayerService.instance.playerInfo.getGold()<this.cost2.value&&e.BagController.getInstance().getCountByItemId(this.cost1.id)<this.cost1.value?void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):(e.SearchTreasureController.getInstance().requestSearch(this.lastCountType),void(this.tenDoneNum=0))},i.prototype.effectLingQu=function(t,i,n){i&&(i.clear(),i=null),t&&(i||(i=new e.FoxAni(n),i.play("shilianchou_fx","ani",1),this.aniArr.push(i)))},i.prototype.getItemList=function(){for(var e=[],t=0;10>t;t++)e.push(this.ui["item"+t]);return e},i.prototype.getAniGroupList=function(){var e=[],t=0;for(t;10>t;t++)e.push(this.ui["aniGroup"+t]);return e},i}(e.BasePanel);e.SearchTreasureRewardPanel=t,__reflect(t.prototype,"foxgame.SearchTreasureRewardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.EQUIPSHOPTYPE=1]="EQUIPSHOPTYPE",e[e.GEMSHOPTYPE=2]="GEMSHOPTYPE",e[e.ITEMSHOPTYPE=3]="ITEMSHOPTYPE"}(t=e.ShopItemType||(e.ShopItemType={}));var i=function(){function t(){this.model=new e.ShopModule,this.panel=new e.ShopPanel(this.model),this.buyItemPanel=new e.ShopBuyPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.panel.show(),this.panel.sendShopInfoReq();var t={code:"clickshop",datatype:2,serverid:e.Global.serverId,servername:e.Global.serverName,roleid:e.PlayerService.instance.mainRoleData.roleId,rolename:e.PlayerService.instance.mainRoleData.name,rolelevel:e.PlayerService.instance.mainRoleData.level,fightvalue:e.PlayerService.instance.mainRoleData.fight};e.UserInfo.platform.reportData_legend(t)},t.prototype.getPanelIsShow=function(){return this.panel.getIsShow()},t.prototype.showBuyItemPanel=function(e){this.buyItemPanel.setId(e),this.buyItemPanel.show(),this.buyItemPanel.initData(e)},t.prototype.closeBuyItemPanel=function(){this.buyItemPanel.close()},t.prototype.sendShopInfoReq=function(){this.panel.sendShopInfoReq()},t.prototype.getShopInfoMap=function(){return this.model.shopInfoMap},t.prototype.setShopInfoMap=function(e){this.model.shopInfoMap=e},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.SHOP_S:this.model.updateShopData(i);break;case e.Code.SHOP_LEGENDARYMART_S:0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo());break;case e.Code.PLAYER_AWARD_S:var n=i.rewards.coin;n&&this.panel.flushMoneyNum();break;case e.Code.SHOP_COIN_S:0!=i.getErrorNo()?e.GlobalUtil.showErrorCodeMsg(i.getErrorNo()):(this.closeBuyItemPanel(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SHOPBUYSUCCESS")),this.panel.getIsShow()&&this.panel.flushMoneyNum(),e.FuBenController.getInstance().refreshTopLable(),e.DailyDungeonControler.getIntance().getIsShow()&&e.DailyDungeonControler.getIntance().flushEquipPassCardNum(),e.NewBossMainControler.getIntance()&&e.PopUpManager.instance.hasPopUp(e.WindowName.BOSS_MAIN)&&e.NewBossMainControler.getIntance().refreshItemNum(),e.NewBossMainControler.getIntance().getIsShow()&&e.NewBossMainControler.getIntance().refreshItemNum())}},t.prototype.closePanel=function(){this.buyItemPanel.close(),this.panel.close()},t}();e.ShopMainControler=i,__reflect(i.prototype,"foxgame.ShopMainControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.shops=new eui.ArrayCollection,this.showShopInfos=new Array,this.columns=3,this.shopItemHeight=283,this.flushShopFreeNum=0,this.horizontalGap=4,this.verticalGap=12,this.callBack=null,this.obj=null,this.maxNum=99,this.minNum=1,this.currentBuyNum=1,this.observerList=[],this.shopInfoList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},t.prototype.updateShopData=function(e){this.flushShopFreeNum=e.getRefreshCount(),this.shopInfoList=e.getShopItems(),this.setShopModuleData(),this.equipNextFlushTime=e.getNextEquipResetTime(),this.gemNextFlushTime=e.getNextGemResetTime(),this.updateView()},t.prototype.setShopModuleData=function(){for(var t=new e.HashMap,i=0;i<this.shopInfoList.length;++i){var n=this.shopInfoList[i],o=n.getItemId();t.put(o,n)}this.shopInfoMap=t},t}();e.ShopModule=t,__reflect(t.prototype,"foxgame.ShopModule")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/shop/ShopBuy_new.exml")||this;return i.model=e,i.currentId=0,i}return __extends(i,t),i.prototype.initHook=function(){this.initData(this.currentId),this.ui.subBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.calcNum,this),this.ui.subBtn10.addEventListener(egret.TouchEvent.TOUCH_TAP,this.calcNum,this),this.ui.plusBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.calcNum,this),this.ui.plusBtn10.addEventListener(egret.TouchEvent.TOUCH_TAP,this.calcNum,this),this.ui.purchaseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)},i.prototype.setId=function(e){this.currentId=e},i.prototype.initData=function(t){this.model.currentBuyNum=1,this.ui.itemIcon.setItem(t,1,!1,!1),this.ui.buyNum.text=this.model.currentBuyNum.toString(),this.model.itemId=t;var i=e.JsonDataManager.instance.toolShopTemplate,n=i[t];this.model.currentPrice=this.model.shopInfoMap[t].getBuyPrice();var o=n.priceType;1==o?(this.ui.goldPic.visible=!0,this.ui.diamondPic.visible=!1,this.ui.needDiamondNum.text=this.model.currentPrice.toString()):2==o&&(this.ui.goldPic.visible=!1,this.ui.diamondPic.visible=!0,this.ui.needDiamondNum.text=this.model.currentPrice.toString()),this.setItemDescAndName()},i.prototype.setItemDescAndName=function(){var t=e.JsonDataManager.instance.itemTemplate,i=t[this.model.itemId],n=i.desc;this.ui.itemDesc.text=n,1==this.ui.itemDesc.numLines&&(this.ui.itemDesc.textAlign="center",this.ui.xiaobiaoImg.x=this.ui.itemDesc.x+.5*this.ui.itemDesc.width-.5*this.ui.itemDesc.textWidth-26),this.ui.xiaobiaoImg.y=this.ui.itemDesc.y+.5*this.ui.itemDesc.height-.5*this.ui.itemDesc.textHeight;var o=i.name;this.ui.itemName.text=o,this.ui.itemName.textColor=e.ColorUtils.instance.getColorByQuality(i.quality)},i.prototype.clickBtn=function(t){switch(t.target){case this.ui.purchaseBtn:var i=HawkProtocolManager.newBuilder("JsProto.BuyGoodsReq"),n=this.model.itemId,o=e.JsonDataManager.instance.toolShopTemplate,a=o[n],s=e.PlayerService.instance.playerInfo.getGold();if(s<this.model.currentPrice)return e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"),void this.close();i.setItemId(n),i.setItemType(a.itemType),i.setNum(this.model.currentBuyNum),e.Message.instance.send(e.Code.SHOP_COIN_C,i,!0)}},i.prototype.calcNum=function(e){switch(e.target){case this.ui.subBtn:this.model.currentBuyNum--,this.model.currentBuyNum<this.model.minNum&&(this.model.currentBuyNum=this.model.minNum);break;case this.ui.subBtn10:this.model.currentBuyNum-=10,this.model.currentBuyNum<this.model.minNum&&(this.model.currentBuyNum=this.model.minNum);break;case this.ui.plusBtn:this.model.currentBuyNum++,this.model.currentBuyNum>this.model.maxNum&&(this.model.currentBuyNum=this.model.maxNum);break;case this.ui.plusBtn10:this.model.currentBuyNum+=10,this.model.currentBuyNum>this.model.maxNum&&(this.model.currentBuyNum=this.model.maxNum)}this.ui.buyNum.text=this.model.currentBuyNum.toString(),this.ui.needDiamondNum.text=this.model.currentBuyNum*this.model.currentPrice+""},i}(e.BasePanel);e.ShopBuyPanel=t,__reflect(t.prototype,"foxgame.ShopBuyPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ShopItemSkin_new",e.init(),e}return __extends(i,t),i.prototype.init=function(){this.buyType=1,this.purchaseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)},i.prototype.buyEquip=function(){var t=HawkProtocolManager.newBuilder("JsProto.BuyGoodsReq");t.setItemId(this.equipId),t.setItemType(this.itemType),t.setNum(1),e.Message.instance.send(e.Code.SHOP_COIN_C,t,!0)},i.prototype.clickBtn=function(t){switch(t.target){case this.purchaseBtn:this.itemType==e.ShopItemType.EQUIPSHOPTYPE?e.BagController.getInstance().checkBagEnough(this,this.buyEquip,null,2):e.ShopMainControler.getInstance().showBuyItemPanel(this.equipId);break;case this.itemIcon:if(this.itemType==e.ShopItemType.EQUIPSHOPTYPE){var i=e.ShopMainControler.getInstance().getShopInfoMap()[this.equipId],n=i.getEquipInfo();e.TipsController.getInstance().showEquipTips({profession:-1,equipInfo:n,showReplace:!1,showLock:!1})}else{var o=e.JsonDataManager.instance.itemTemplate,a=o[this.equipId];a.type==e.ItemType.SOUL?e.TipsController.getInstance().showSoulTips(this.equipId):e.TipsController.getInstance().showItemTips(this.equipId)}}},i.prototype.createChildren=function(){t.prototype.createChildren.call(this)},i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this.equipId=this.data.equipId,this.itemType=this.data.itemType,this.buyDiscont=this.data.buyDiscont,this.currencyNum.text=this.data.currencyNum,this.buyType=this.data.buyType;var i=e.JsonDataManager.instance.itemTemplate[this.equipId];switch(1==this.buyType?(this.diamond.visible=!1,this.goldCoin.visible=!0):2==this.buyType&&(this.diamond.visible=!0,this.goldCoin.visible=!1),this.equipPartName1.text=this.data.equipPartName,this.itemName.text=this.data.equipName,this.itemName.textColor=e.ColorUtils.instance.getColorByQuality(i.quality),this.itemType){case e.ShopItemType.EQUIPSHOPTYPE:this.equipPartName.visible=this.pingfenGroup.visible=!0,this.gemDec.visible=!1,this.itemIcon.setItem(this.equipId),this.equipScore();break;case e.ShopItemType.GEMSHOPTYPE:this.equipPartName.visible=this.pingfenGroup.visible=!1,this.gemDec.visible=!0,this.itemIcon.setItem(this.equipId,1,!0,!1);break;case e.ShopItemType.ITEMSHOPTYPE:this.equipPartName.visible=this.pingfenGroup.visible=!1,this.gemDec.visible=!0,this.itemIcon.setItem(this.equipId,1,!0,!1)}switch(this.buyDiscont){case 1e4:this.zhekou5.visible=!1,this.zhekou8.visible=!1;break;case 8e3:this.zhekou5.visible=!1,this.zhekou8.visible=!0;break;case 5e3:this.zhekou5.visible=!0,this.zhekou8.visible=!1}}},i.prototype.equipScore=function(){var t=e.ShopMainControler.getInstance().getShopInfoMap()[this.equipId];if(null!=t){var i,n=t.getEquipInfo(),o=e.JsonDataManager.instance.equipTemplate,a=o[n.getEquipId()],s=e.PlayerService.instance.getRoleDataByProfession(a.profession),r=0,l=0,h=0;if(1==a.partList.length)i=s.getEquipInfoByPart(a.partList[0]),i&&(r=i.getScore());else if(2==a.partList.length){i=s.getEquipInfoByPart(a.partList[0]),i&&(l=i.getScore());var c=s.getEquipInfoByPart(a.partList[1]);c&&(h=c.getScore()),r=h>l?l:h}r>n.getScore()?(this.goUpImg.visible=!1,this.declineImg.visible=!0,this.pingfen.text=(r-n.getScore()).toString(),this.pingfenHeadText.textColor=16711680,this.pingfen.textColor=16711680):(this.goUpImg.visible=!0,this.declineImg.visible=!1,this.pingfen.text=(n.getScore()-r).toString(),this.pingfenHeadText.textColor=2227971,this.pingfen.textColor=2227971)}},i.prototype.recvMsg=function(e,t){},i}(eui.ItemRenderer);e.ShopItemRenderer=t,__reflect(t.prototype,"foxgame.ShopItemRenderer",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/shop/shopnew/shopmainskin.exml","shop",!1)||this;return n.count=0,n.model=i,n.setIsShowTween(!1),n.setMaskGapBottom(e.Global.mainBtnsPanelMaskGapBottom),n.setRegisterTick(!0),n.isInit=!1,n.isData=!1,n.isMask=!1,n.isMaskdown=!0,n.adaptionType=1,n}return __extends(i,t),i.prototype.initHook=function(){DebugTool.getInstance().addDisplayObj(this.ui,this.count++),this.model.registerObserver(this),this.model.shopBuyType=e.ShopItemType.EQUIPSHOPTYPE,this.ui.shopItemList.itemRenderer=e.ShopItemRenderer,this.ui.shopItemList.dataProvider=this.model.shops;var t=new eui.TileLayout;t.requestedColumnCount=this.model.columns,t.horizontalGap=this.model.horizontalGap,t.verticalGap=this.model.verticalGap,this.ui.shopItemList.layout=t,this.selectItemButton(e.ShopItemType.EQUIPSHOPTYPE),this.flushMoneyNum(),this.ui.shopScroll.scrollPolicyH="ScrollPolicy.OFF",this.ui.shopScroll.horizontalScrollBar.enabled=!0,this.ui.shopScroll.verticalScrollBar.autoVisibility=!1,this.doScreenAdaptation(),this.ui.equipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.gemBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.itemBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.flushShopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.goldFlushBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.flushShopBtn.visible=!0,this.ui.rechargeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this),this.ui.btn_blue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.blueHandler,this),this.ui.group_qqdt.visible="QQdating"==getchannel()?!0:!1,this.isInit=!0,this.refresh(),-1!=checkPlatformStr().indexOf("opporpk")?this.ui.rpktip.text="如有问题,请联系客服QQ：2997253306":this.ui.rpktip.text="充值可以立即获得元宝"},i.prototype.blueHandler=function(t){var i={code:"showBuyQQGame",service_type:1,duration:3};e.UserInfo.platform.reportData_legend(i)},i.prototype.updateView=function(){this.refresh()},i.prototype.refresh=function(){if(this.model.shopInfoList.length>0?this.isData=!0:this.isData=!1,this.isInit&&this.isData)switch(this.flushMoneyNum(),this.model.showShopInfos=[],this.ui.flushShopBtn.visible=!1,this.model.shopBuyType){case e.ShopItemType.EQUIPSHOPTYPE:this.ui.flushShopBtn.visible=!0,this.flushData(e.ShopItemType.EQUIPSHOPTYPE),this.setFlushPic();break;case e.ShopItemType.GEMSHOPTYPE:this.flushData(e.ShopItemType.GEMSHOPTYPE);break;case e.ShopItemType.ITEMSHOPTYPE:this.itemFlushShopVisble()}},i.prototype.flushMoneyNum=function(){0!=this.getIsShow()&&(this.ui.currency&&this.ui.currency.refresh(),this.ui.goldNum.text=e.GlobalUtil.getUnitString(e.PlayerService.instance.playerInfo.getCoin(),2),this.ui.diamondNum.text=e.GlobalUtil.getUnitString(e.PlayerService.instance.playerInfo.getGold(),2))},i.prototype.selectItemButton=function(t){switch(t){case e.ShopItemType.EQUIPSHOPTYPE:this.ui.equipBtn.enabled=!1,this.ui.gemBtn.enabled=!0,this.ui.itemBtn.enabled=!0;break;case e.ShopItemType.GEMSHOPTYPE:this.ui.equipBtn.enabled=!0,this.ui.gemBtn.enabled=!1,this.ui.itemBtn.enabled=!0;break;case e.ShopItemType.ITEMSHOPTYPE:this.ui.equipBtn.enabled=!0,this.ui.gemBtn.enabled=!0,this.ui.itemBtn.enabled=!1}},i.prototype.flushToolData=function(){this.model.shopBuyType=e.ShopItemType.ITEMSHOPTYPE,this.model.showShopInfos=[];var t=this.model.toolShopCfg=e.JsonDataManager.instance.toolShopTemplate;for(var i in t){var n=t[i];if(n.itemType==e.ShopItemType.ITEMSHOPTYPE){var o=n.itemID,a=n.price,s=n.priceType;this.model.showShopInfos.push({equipId:o,itemType:e.ShopItemType.ITEMSHOPTYPE,currencyNum:a,buyType:s,buyDiscont:1e4})}}this.ui.shopItemList.height=580,this.model.shops.replaceAll(this.model.showShopInfos),this.model.shops.refresh()},i.prototype.flushData=function(t){this.model.shopBuyType=t,this.model.showShopInfos=[];for(var i=this.model.shopInfoList.length,n=0;i>n;++n){var o=this.model.shopInfoList[n],a=o.getItemType(),s=o.getBuyPrice(),r=o.getBuyType(),l=o.getBuyDiscont(),h=o.getEquipInfo(),c=void 0,u=void 0,p=0;if(h){p=h.getEquipId();var g=e.JsonDataManager.instance.equipTemplate,d=g[p];c=d.partName,u=d.name}else p=o.getItemId();t==a&&this.model.showShopInfos.push({equipId:p,itemType:a,currencyNum:s,buyType:r,equipPartName:c,equipName:u,buyDiscont:l})}this.ui.shopItemList.height=580,this.model.shops.replaceAll(this.model.showShopInfos),this.model.shops.refresh()},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("MALLHELP")},i.prototype.clickBtn=function(t){switch(t.target){case this.ui.equipBtn:this.ui.flushGroup.visible=!0,this.ui.shopScroll.viewport.scrollV=0,this.flushData(e.ShopItemType.EQUIPSHOPTYPE),this.selectItemButton(e.ShopItemType.EQUIPSHOPTYPE),this.ui.flushShopBtn.visible=!0,this.setFlushPic();break;case this.ui.gemBtn:this.ui.flushGroup.visible=!1,this.ui.shopScroll.viewport.scrollV=0,this.flushData(e.ShopItemType.GEMSHOPTYPE),this.selectItemButton(e.ShopItemType.GEMSHOPTYPE),this.ui.goldFlushBtn.visible=this.ui.flushShopBtn.visible=!1,this.itemFlushShopVisble();break;case this.ui.itemBtn:this.ui.flushGroup.visible=!1,this.ui.shopScroll.viewport.scrollV=0,this.flushToolData(),this.itemFlushShopVisble(),this.selectItemButton(e.ShopItemType.ITEMSHOPTYPE);break;case this.ui.flushShopBtn:this.sendFlushReq();break;case this.ui.goldFlushBtn:this.sendFlushReq();break;case this.ui.rechargeBtn:e.RechargeController.getInstance().showPanel()}},i.prototype.sendFlushReq=function(){if(this.model.shopBuyType!=e.ShopItemType.ITEMSHOPTYPE){var t=HawkProtocolManager.newBuilder("JsProto.RefreshEquipShopReq");t.setVersion(1),e.Message.instance.send(e.Code.SHOP_LEGENDARYMART_C,t,!0)}},i.prototype.sendShopInfoReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.OPShopInfoReq");t.setVersion(1),e.Message.instance.send(e.Code.SHOP_C,t,!0)},i.prototype.itemFlushShopVisble=function(){this.ui.flushShopBtn.visible=!1,this.ui.goldFlushBtn.visible=!1},i.prototype.tickHook=function(t){if(void 0!=this.model.equipNextFlushTime){this.model.equipNextFlushTime-=1e3/60;var i=this.model.equipNextFlushTime;this.ui.flushTimeText.text=e.GlobalUtil.getTimeString(Math.ceil(i/1e3),1),0==Math.ceil(i/1e3)&&this.sendShopInfoReq(),0==Math.ceil((this.model.gemNextFlushTime-(new Date).getTime())/1e3)&&this.sendShopInfoReq()}},i.prototype.setFlushPic=function(){this.model.flushShopFreeNum<=5?(this.ui.flushShopBtn.visible=!0,this.ui.goldFlushBtn.visible=!1):(this.ui.flushShopBtn.visible=!1,this.ui.goldFlushBtn.visible=!0)},i.prototype.readyDestroy=function(){this.ui.shopItemList.dataProvider=null,this.isData=!1},i}(e.BasePanel);e.ShopPanel=t,__reflect(t.prototype,"foxgame.ShopPanel",["foxgame.IShop","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.WeaponSmeltModel,this.panel=new e.WeaponSmeltManager(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.refreshConsume=function(){this.panel.refreshConsume()},t.prototype.showPanel=function(e){this.panel.initPanel(e)},t.prototype.getPanel=function(){return this.panel},t.prototype.getCurrentSelectIndex=function(){return this.model.currentInedx},t.prototype.recvMsg=function(i,n){if(t.getInstance().getPanel().getIsShow())switch(i){case e.MsgCMD.REFRESH_PLAYERDATA:this.panel.getIsShow()&&this.panel.updateHeadBar()}},t.prototype.getIntensifyOperateAry=function(){return this.checkEquipIntensifyRedPoint(this.model.roleData),this.model.intensifyOperateAry},t.prototype.getUpStarOperateAry=function(){return this.checkEquipUpStarRedPoint(this.model.roleData),this.model.upStarOperateAry},t.prototype.getWeaponUpOperateAry=function(){return this.checkGoldEqIntensifyRedPoint(this.model.roleData),this.model.WeaponUpOperateAry},t.prototype.getWeaponXLOperateAry=function(){return this.checkGoldEquipXLRedPoint(this.model.roleData),this.model.WeaponXLOperateAry},t.prototype.checkWeaponSysRedPoint=function(){var t=e.PlayerService.instance.getRoleDataList();this.model.roleOperateAry=[];for(var i=0;i<t.length;i++){var n=t[i];null!=n&&void 0!=n.getRoleEquipCellInfo()?this.checkEquipUpStarRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkEquipIntensifyRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkGoldEqIntensifyRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkGoldEquipXLRedPoint(n)?this.model.roleOperateAry.push(!0):this.model.roleOperateAry.push(!1):this.model.roleOperateAry.push(!1)}for(var o=this.model.roleOperateAry.length,i=0;i<t.length;i++){var a=this.model.roleOperateAry[i];this.panel.refreshHeadBarRedTip(i,a)}for(var i=0;o>i;i++){var a=this.model.roleOperateAry[i];if(1==a)return!0}return!1},t.prototype.checkRoleWeaponRedPoint=function(e){this.checkEquipUpStarRedPoint(e),this.checkEquipIntensifyRedPoint(e),this.checkGoldEqIntensifyRedPoint(e),this.checkGoldEquipXLRedPoint(e)},t.prototype.checkEquipIntensifyRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipCellInfo().getCellInfos(),n=i.length,o=e.JsonDataManager.instance.strengthen;this.model.intensifyOperateAry=[];for(var a=0;n>a;a++){var s=i[a],r=s.getCellStrenthLevel(),l=e.BagController.getInstance().getCountByItemId(110007),h=e.PlayerService.instance.playerInfo.getCoin(),c=o[r+1];if(void 0!=c){var u=Number(c.goldCost[2]),p=Number(c.levelUpCost[2]);r<this.model.maxLevel&&r<t.roleInfo.getLevel()&&h>=u&&l>=p&&-1==this.model.intensifyOperateAry.indexOf(a)&&this.model.intensifyOperateAry.push(a)}}return this.model.intensifyOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),this.panel.refreshIntensifyRedTip(!0),!0):(this.panel.refreshIntensifyRedTip(!1),!1)},t.prototype.checkEquipUpStarRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipCellInfo().getCellInfos(),n=i.length,o=e.JsonDataManager.instance.partStarUpgrade;this.model.upStarOperateAry=[];for(var a=0;n>a;a++){var s=i[a],r=s.getCellStartLevel(),l=e.BagController.getInstance().getCountByItemId(110010),h=e.PlayerService.instance.playerInfo.getCoin(),c=e.PlayerService.instance.playerInfo.getLevel(),u=o[r+1];if(void 0!=u){var p=Number(u.levelUpCost[1][2]),g=Number(u.levelUpCost[0][2]);r<this.model.upStarMaxLevel&&c>=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING)&&h>=p&&l>=g&&-1==this.model.upStarOperateAry.indexOf(a)&&this.model.upStarOperateAry.push(a)}}return this.model.upStarOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),this.panel.refreshUpStarRedTip(!0),!0):(this.panel.refreshUpStarRedTip(!1),!1)},t.prototype.checkGoldEqIntensifyRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipsForCS(),n=e.JsonDataManager.instance.equipTemplate,o=e.JsonDataManager.instance.equipmentUpgradeTemplate,a=i.length,s=e.PlayerService.instance.playerInfo.getLevel();this.model.WeaponUpOperateAry=[];for(var r=0;a>r;r++){var l=i[r],h=n[l.getEquipItemId()];if(h.level<this.model.WeaponUpMaxLevel&&h.level<=s-10){var c=o[h.id].costList,u=c[0].value,p=e.PlayerService.instance.playerInfo.getCoin(),g=Number(c[1].value),d=e.BagController.getInstance().getCountByItemId(c[1].id);if(p>=u&&d>=g){var f=l.getPart()-1;-1==this.model.WeaponUpOperateAry.indexOf(f)&&this.model.WeaponUpOperateAry.push(f)}}}return this.model.WeaponUpOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),this.panel.refreshWeaponUpStarRedTip(!0),!0):(this.panel.refreshWeaponUpStarRedTip(!1),!1)},t.prototype.checkGoldEquipXLRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipsForCS(),n=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_1"),o=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_2"),a=n.split("_"),s=o.split("_"),r=i.length;this.model.WeaponXLOperateAry=[];for(var l=0;r>l;l++){var h=i[l],c=Number(a[2]),u=Number(s[2]),p=e.BagController.getInstance().getCountByItemId(Number(a[1])),g=e.BagController.getInstance().getCountByItemId(Number(s[1]));if(p>=c){var d=h.getPart()-1;-1==this.model.WeaponXLOperateAry.indexOf(d)&&this.model.WeaponXLOperateAry.push(d)}else if(this.checkAttrIsFull(h)&&g>=u){var d=h.getPart()-1;-1==this.model.WeaponXLOperateAry.indexOf(d)&&this.model.WeaponXLOperateAry.push(d)}}return this.model.WeaponXLOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),this.panel.refreshWeaponXLRedTip(!0),!0):(this.panel.refreshWeaponXLRedTip(!1),!1)},t.prototype.checkAttrIsFull=function(t){for(var i=e.JsonDataManager.instance.equipTemplate,n=e.BagController.getInstance().getEquipInfoById(t.getEquipId()),o=i[t.getEquipItemId()],a=n.getAttrInfos(),s=a.length,r=0;s>r;r++){for(var l=a[r],h=l.getAttrData(),c=0,u=0;u<o.attrTypeList.length;u++)if(h.getAttrId()==o.attrTypeList[u]){c=o.attrAddMaxValueList[u];break}if(h.getAdditionValue()<c)return!0}return!1},t}();e.WeaponSmeltController=t,__reflect(t.prototype,"foxgame.WeaponSmeltController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.QIANGHUA=1]="QIANGHUA",e[e.SHENGXING=2]="SHENGXING",e[e.SHENZHUANGSHENGJI=3]="SHENZHUANGSHENGJI",e[e.SHENZHUANGXILIAN=4]="SHENZHUANGXILIAN",e[e.SHENZHUANGCUILIAN=5]="SHENZHUANGCUILIAN"}(t=e.WeaponTaps||(e.WeaponTaps={}));var i=function(i){function n(t){var n=i.call(this,"resource/skins/smelt/WeaponSmelt.exml","weapon")||this;return n.model=t,n.setIsShowTween(!0),n.setMaskGapBottom(e.Global.mainBtnsPanelMaskGapBottom),n}return __extends(n,i),n.prototype.bagItemChanged=function(){this.updateChildPanel()},n.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this),this.initView(),this.ui.intensifyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.upStarBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.weaponUpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.xiLianBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.doScreenAdaptation(),e.WeaponSmeltController.getInstance().checkRoleWeaponRedPoint(this.model.roleData)},n.prototype.initPanel=function(t){if(t&&(this.model.currentInedx=t),this.show(),App.LittleLoading().hideLoading("WeaponSmeltManager"),0==App.GuideUtils().isShow()&&App.GuideUtils().currPart==e.GuidePart.currPart12&&(1==App.GuideUtils().currStep||0==App.GuideUtils().currStep)&&e.PlayerService.instance.level>=40){var i=this.ui.upStarBtn,n={x:i.x,y:i.y,width:i.width,height:i.height};App.GuideUtils().show(n,this),App.GuideUtils().currStep=1}},n.prototype.refreshConsume=function(){null!=this.intensifyPanel&&this.intensifyPanel.upDataFunc()},n.prototype.setRoleData=function(e){this.getIsShow()&&(this.model.roleData=e,this.model.roleId!=this.model.roleData.roleId&&(this.model.roleId=this.model.roleData.roleId,this.setTabState(this.model.currentInedx),this.showSelectePanel(this.model.currentInedx)))},n.prototype.initView=function(){this.ui.headBar.setBackFun(this.setRoleData.bind(this))},n.prototype.onClick=function(i){switch(i.target){case this.ui.intensifyBtn:this.model.currentInedx=t.QIANGHUA;break;case this.ui.upStarBtn:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEISHENGXING))this.model.currentInedx=t.SHENGXING;else{var n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHUANGBEISHENGXING",n))}break;case this.ui.weaponUpBtn:this.model.currentInedx=t.SHENZHUANGSHENGJI;break;case this.ui.xiLianBtn:this.model.currentInedx=t.SHENZHUANGXILIAN;break;case this.ui.helpBtn:var o="";switch(this.model.currentInedx){case 1:o="STRENGTHENHELP";break;case 2:o="STARLIFTHELP";break;case 3:o="GODOUTFITUPGRADEHELP";break;case 4:o="GODPUTTHEPOLISHHELP"}e.HelpController.getInstance().showPanel(o)}this.setTabState(this.model.currentInedx),this.showSelectePanel(this.model.currentInedx)},n.prototype.setChildPanelPos=function(e){e.init(this.model.roleData),e.y=this.model.panelOffsetY,e.x=this.width-e.width>>1,this.ui.addChildAt(e,1),e.visible=!0},n.prototype.showSelectePanel=function(t){switch(t){case 1:this.removePanel(),this.intensifyPanel?this.intensifyPanel.reExmlSkinCreate():this.intensifyPanel=new e.IntensifyPanel,this.setChildPanelPos(this.intensifyPanel);break;case 2:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEISHENGXING))this.removePanel(),this.upStarPanel?this.upStarPanel.reExmlSkinCreate():this.upStarPanel=new e.UpStarPanel,this.setChildPanelPos(this.upStarPanel);else{var i=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHUANGBEISHENGXING",i))}break;case 3:this.removePanel(),this.weaponUpPanel?this.weaponUpPanel.reExmlSkinCreate():this.weaponUpPanel=new e.WeaponUpPanel,this.setChildPanelPos(this.weaponUpPanel);break;case 4:this.removePanel(),this.xiLianPanel?this.xiLianPanel.reExmlSkinCreate():this.xiLianPanel=new e.WeaponXiLianPanel,this.setChildPanelPos(this.xiLianPanel)
}},n.prototype.removePanel=function(){this.intensifyPanel&&this.intensifyPanel.parent&&(this.intensifyPanel.visible=!1),this.upStarPanel&&this.upStarPanel.parent&&(this.upStarPanel.visible=!1),this.weaponUpPanel&&this.weaponUpPanel.parent&&(this.weaponUpPanel.visible=!1),this.xiLianPanel&&this.xiLianPanel.parent&&(this.xiLianPanel.visible=!1)},n.prototype.setTabState=function(e){this.ui.intensifyBtn.selected=1==e,this.ui.upStarBtn.selected=2==e,this.ui.weaponUpBtn.selected=3==e,this.ui.xiLianBtn.selected=4==e},n.prototype.updateChildPanel=function(){switch(this.model.currentInedx){case t.QIANGHUA:this.intensifyPanel&&this.intensifyPanel.upDataFunc();break;case t.SHENGXING:this.upStarPanel&&this.upStarPanel.upDataFunc();break;case t.SHENZHUANGSHENGJI:this.weaponUpPanel&&this.weaponUpPanel.showSelectEquipInfo();break;case t.SHENZHUANGXILIAN:this.xiLianPanel&&this.xiLianPanel.upDataFunc()}},n.prototype.refreshHeadBarRedTip=function(e,t){this.getIsShow()&&this.ui.headBar.setRedStatus(e,t)},n.prototype.refreshIntensifyRedTip=function(e){this.getIsShow()&&(this.ui.intensifyRedImg.visible=e)},n.prototype.refreshUpStarRedTip=function(e){this.getIsShow()&&(this.ui.upStarRedImg.visible=e)},n.prototype.refreshWeaponUpStarRedTip=function(e){this.getIsShow()&&(this.ui.weaponUpRedImg.visible=e)},n.prototype.refreshWeaponXLRedTip=function(e){this.getIsShow()&&(this.ui.weaponXLRedImg.visible=e)},n.prototype.closeHook=function(){this.model.currentInedx=1,this.model.roleId=0,e.NewJueweiController.getInstance().updateNobilityData(),this.intensifyPanel&&(this.intensifyPanel.bNeedReBuild=!0),this.upStarPanel&&(this.upStarPanel.bNeedReBuild=!0),this.weaponUpPanel&&(this.weaponUpPanel.bNeedReBuild=!0),this.xiLianPanel&&(this.xiLianPanel.bNeedReBuild=!0)},n.prototype.updateHeadBar=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)},n}(e.BasePanel);e.WeaponSmeltManager=i,__reflect(i.prototype,"foxgame.WeaponSmeltManager",["foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.currentInedx=1,this.panelOffsetY=192,this.maxLevel=200,this.upStarMaxLevel=50,this.WeaponUpMaxLevel=200,this.upStarOperateAry=[],this.WeaponUpOperateAry=[],this.intensifyOperateAry=[],this.WeaponXLOperateAry=[],this.roleOperateAry=[]}return e}();e.WeaponSmeltModel=t,__reflect(t.prototype,"foxgame.WeaponSmeltModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.baseCellList=[],i.jpCellList=[],i.skinName="WeaponXiLian",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.prop0=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_1"),this.prop1=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_2"),this.vipSend.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO3")),this.xunbao.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO4")),this.buyLimit.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO5")),this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9],this.baseCellList=[this.container0cell0,this.container0cell1,this.container0cell2,this.container0cell3],this.jpCellList=[this.container1cell0,this.container1cell1,this.container1cell2];for(var i=0;i<this.itemList.length;i++)this.itemList[i].Index=i,this.itemList[i].setLevel(""),this.itemList[i].setItemStar(""),this.itemList[i].setItemLevel(""),this.itemList[i].showItemType(this.model.itemTypeName[i]),this.itemList[i].setSelectedState(!1),this.itemList[i].setLevelBg(!1),this.itemList[i].setQualityIconVisible(!1),this.itemList[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this);this.setGroupState(!0),this.xilianBtn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xilianBtn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.vipSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.buyLimit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i=this;switch(t.target){case this.xilianBtn_0:if(null==this.currentSelectedRoleEquip)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO1"));if(!this.condition1)return void e.ItemNotEnoughController.getInstance().showPanel(this.prop1VO.id);e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("WEAPONXILIANPANELTIP"),this,function(t){var n=HawkProtocolManager.newBuilder("JsProto.HPEquipBaptize");n.setEquipId(t),n.setType(1),i.lastAttrs=null,e.Message.instance.send(e.Code.EQUIP_BAPTIZE_C,n,!0)},this.currentSelectedRoleEquip.getEquipId());break;case this.xilianBtn_1:if(null==this.currentSelectedRoleEquip)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO1"));if(this.isFinish)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO2"));if(!this.condition2)return void e.ItemNotEnoughController.getInstance().showPanel(this.prop2VO.id);var n=HawkProtocolManager.newBuilder("JsProto.HPEquipBaptize");n.setEquipId(this.currentSelectedRoleEquip.getEquipId()),n.setType(2),e.Message.instance.send(e.Code.EQUIP_BAPTIZE_C,n,!0);break;case this.vipSend:e.CreateNewVipController.instance.showPanel();break;case this.xunbao:e.SearchTreasureController.getInstance().showPanel();break;case this.buyLimit:e.ActivityController.getIntance().showPanel()}},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0;i<this.itemList.length;i++)this.itemList[i].setSelectedState(!1);this.model.currentSelectedIndex=t,this.lastAttrs=null,this.showSelectEquipInfo()},i.prototype.setGroupState=function(e){this.noEquip.visible=e,this.downGroup.visible=!e},i.prototype.checkLastAttrs=function(t,i,n,o){var a=0;return this.isSaveData?this.lastAttrs[o]=n:(a=n-this.lastAttrs[o],a=e.GlobalUtil.getAttrValueStr(t,Number(a)),this.lastAttrs[o]=n),a},i.prototype.getSelectIndex=function(){for(var e,t=0,i=0;i<this.equipList.length;i++)if(null!=this.equipList[i])return e=!0,this.equipList[i].getPart()-1;return e?t:0},i.prototype.showData=function(){this.lastAttrs=null,this.equipList=this.model.roleData.getRoleEquipsForCS(),this.cellInfoList=this.model.roleData.getRoleEquipCellInfo().getCellInfos();for(var t=0;t<this.itemList.length;t++)this.itemList[t].restore();for(var t=0;t<this.equipList.length;t++)if(null!=this.equipList[t]){var i=this.equipList[t].getPart()-1,n=this.model.equipCfg[this.equipList[t].getEquipItemId()],o=e.BagController.getInstance().getEquipInfoById(this.equipList[t].getEquipId());this.itemList[i].setItemIcon(n.id),this.itemList[i].showItemType(""),this.itemList[i].setQualityIconVisible(!0),this.itemList[i].setLevelBg(!0),this.itemList[i].setItemLevel(n.level.toString()),this.itemList[i].setLevel(this.cellInfoList[i].getCellStrenthLevel().toString()),this.itemList[i].setItemStar(this.cellInfoList[i].getCellStartLevel().toString()),this.itemList[i].setQualityIcon(n.quality.toString());var a=this.model.redQuenData[o.getQuenchingLevel()];this.itemList[i].setNameEvolve(a.nameEvolve),this.itemList[i].setQueneAni(a.special)}void 0==this.model.currentSelectedIndex&&(this.model.currentSelectedIndex=this.getSelectIndex()),this.showSelectEquipInfo(),this.showPropInfo()},i.prototype.showPropInfo=function(){var t=e.JsonDataManager.instance.itemTemplate;if("30000"==this.prop0.split("_")[0]){this.prop1VO=t[parseInt(this.prop0.split("_")[1])];e.BagController.getInstance().getCountByItemId(parseInt(this.prop0.split("_")[1]))}if("30000"==this.prop1.split("_")[0]){this.prop2VO=t[parseInt(this.prop1.split("_")[1])];var i=e.BagController.getInstance().getCountByItemId(parseInt(this.prop1.split("_")[1])),n=Number(this.prop1.split("_")[2]);i<parseInt(this.prop1.split("_")[2])?(this.condition2=!1,this.prop_1.textFlow=e.GlobalUtil.createMaterialProTextFlow(i,n)):(this.condition2=!0,this.prop_1.textFlow=e.GlobalUtil.createMaterialProTextFlow(i,n))}},i.prototype.showSelectEquipInfo=function(){this.showRedPoint(),this.currentSelectedRoleEquip=null;for(var t=0;t<this.equipList.length;t++)if(this.equipList[t].getPart()==this.model.currentSelectedIndex+1){this.currentSelectedRoleEquip=this.equipList[t];break}if(null!=this.currentSelectedRoleEquip){var i=e.BagController.getInstance().getEquipInfoById(this.currentSelectedRoleEquip.getEquipId()),n=i.getAttrInfos(),o=[],a=void 0,s=void 0,r=void 0,l=this.model.equipCfg[this.currentSelectedRoleEquip.getEquipItemId()];this.itemList[this.currentSelectedRoleEquip.getPart()-1].setItemIcon(this.currentSelectedRoleEquip.getEquipItemId());var h=this.model.redQuenData[i.getQuenchingLevel()],c=h.washLimitUp,u=h.changeAtt,p=Number(u.split("_")[2]),g=e.BagController.getInstance().getCountByItemId(parseInt(this.prop0.split("_")[1]));this.prop_0.textFlow=e.GlobalUtil.createMaterialProTextFlow(g,p),g>=p?this.condition1=!0:this.condition1=!1;var d=e.LanguageUtils.instance.getValue(h.nameEvolve.toUpperCase());void 0!=d?this.equipName.text=d+"·"+l.name:this.equipName.text=l.name;var f=this.model.jpCfg[l.rareGroupId];this.isFinish=!0,this.setGroupState(!1),void 0==this.lastAttrs?(this.lastAttrs=[],this.isSaveData=!0):this.isSaveData=!1;for(var m=0;m<n.length;m++)if(r=0,a=n[m],s=a.getAttrData(),a.getAttrGrade()==e.equipAttrGrade.PRIMARY_ATTR){for(var y=0;y<l.attrTypeList.length;y++)if(s.getAttrId()==l.attrTypeList[y]){r=l.attrAddMaxValueList[y];break}var I=this.checkLastAttrs(s.getAttrId(),s.getAttrValue(),s.getAdditionValue(),m);this.baseCellList[m].initData(s.getAttrId(),s.getAttrValue(),s.getAdditionValue(),r,I)}else a.getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&o.push(n[m]);o.length!=this.container1.numChildren&&this.container1.removeChildren();for(var v=0;v<o.length;v++)for(var _=0;_<f.length;_++)if(o[v].getAttrData().getAttrId()==f[_].attId){r=Math.floor((Number(c)/100+1)*f[_].intensifyMaxVal),a=o[v],s=a.getAttrData();var I=this.checkLastAttrs(s.getAttrId(),s.getAttrValue(),s.getAttrValue(),n.length+v);if(s.getAttrValue()<r&&(this.isFinish=!1),o.length!=this.container1.numChildren){var T=new e.WeaponUpXilLianBPCell;this.container1.addChild(T);var C=s.getAttrId(),A=s.getAttrValue();T.initData(C,A,A,r,I)}else this.container1.getChildAt(v).initData(s.getAttrId(),s.getAttrValue(),s.getAttrValue(),r,I)}}else this.equipName.text="",this.setGroupState(!0);this.model.currentSelectedIndex>=0&&this.itemList[this.model.currentSelectedIndex].setSelectedState(!0)},i.prototype.showRedPoint=function(){var t=e.SmeltController.getInstance().getWeaponXLOperateAry();if(void 0!=t){for(var i=0;i<this.itemList.length;i++)this.itemList[i].isShowRedPoint(!1);for(var n=t.length,i=0;n>i;i++){var o=t[i];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.CleangodequipBack=function(t,i){if(i==e.Code.EQUIP_BAPTIZE_S){var n=t;n&&this.playAni(),this.equipList=this.model.roleData.getRoleEquipsForCS(),this.showSelectEquipInfo()}},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i}(eui.Component);e.CleangodequipPanel_X=t,__reflect(t.prototype,"foxgame.CleangodequipPanel_X")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"CuiLianChooseRed")||this;return i.model=e,i.setIsShowBackBtn(!1),i.setIsTouchClose(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.ui.list.useVirtualLayout=!0,this.ui.list.dataProvider=this.model.redSelect_dataCollection,this.ui.list.itemRenderer=e.CuilianSmeltSelectItem,this.ui.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.submitHandler,this)},i.prototype.showHook=function(){this.model.selectedEquipList.length=0,this.model.selectedEquipList=[]},i.prototype.submitHandler=function(){this.close(),this.model.selectViewFlag=!0,e.SmeltController.getInstance().getPanel().cuilianPanel.showData(),e.SmeltController.getInstance().getPanel().cuilianPanel.refreshSelectEquip()},i.prototype.show=function(){t.prototype.show.call(this),this.ui.scroller.viewport.scrollV=0,this.model.redSelect_dataCollection.replaceAll(this.model.selectEquipList)},i}(e.BasePanel);e.CuiLianSelectPanel=t,__reflect(t.prototype,"foxgame.CuiLianSelectPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ChangeEquipItemSkin",e.checkBoxBtn.addEventListener(eui.UIEvent.CHANGE,e.checkBoxHandler,e),e.baseLabelList=[e.baseLabel1,e.baseLabel2,e.baseLabel3,e.baseLabel4],e.jipinLabelList=[e.jipinLabel1,e.jipinLabel2,e.jipinLabel3,e.jipinLabel4],e.equipedImg.visible=!1,e.recommendImg.visible=!1,e.selectBtn.visible=!1,e}return __extends(i,t),i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),null!=this.data.armourId&&void 0!=this.data.armourId)return void this.refreshArmorUI();var i=this.data,n=e.JsonDataManager.instance.itemTemplate[i.getEquipId()];this.item.setItem(n.id),i.getId()&&this.item.setQueneLevelProps(i.getId()),this.nameLabel.text=n.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(n.quality),this.scoreLabel.text=i.getScore()+"";var o=e.JsonDataManager.instance.equipTemplate[n.id],a=e.JsonDataManager.instance.godlyEquipTemplate,s=a[o.id];null!=s?this.scoreLabel.text=s.getScore().toString():this.scoreLabel.text=i.getScore().toString(),this.refreshAttrs(1,this.baseLabelList);var r=this.refreshAttrs(2,this.jipinLabelList);r?(this.jipinGroup.visible=!0,this.baseGroup.y=0):(this.jipinGroup.visible=!1,this.baseGroup.y=this.labelGroup.height-this.baseGroup.height>>1),this.checkBoxBtn.selected=e.SmeltController.getInstance().checkAddedToSelected(i)},i.prototype.refreshArmorUI=function(){var t=e.JsonDataManager.instance.itemTemplate[this.data.itemId],i=e.JsonDataManager.instance.dragonArmorTemplate[this.data.itemId],n=e.BagController.getInstance().getDragonArmorById(this.data.armourId);this.item.setItem(t.id),this.nameLabel.text=t.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(t.quality),this.scoreLabel.text=e.DragonArmorController.getInstance().getDragonEquipScore(n)+"";var o=!1;o?(this.jipinGroup.visible=!0,this.baseGroup.y=0):(this.jipinGroup.visible=!1,this.baseGroup.y=this.labelGroup.height-this.baseGroup.height>>1),this.checkBoxBtn.selected=e.SmeltController.getInstance().checkAddedToSelected(n),this.baseLabelList[0].text=e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[0])+":"+e.GlobalUtil.getAttrValueStr(i.attrTypeList[0],i.attrValueList[0]),this.baseLabelList[2].text=e.LanguageUtils.instance.getValue("ATT_"+i.attrTypeList[1])+":"+e.GlobalUtil.getAttrValueStr(i.attrTypeList[1],i.attrValueList[1]),this.baseLabelList[1].text=this.baseLabelList[3].text=""},i.prototype.refreshAttrs=function(t,i){for(var n,o=this.data,a=o.getAttrInfos(),s=[],r=0;r<a.length;r++)n=a[r],n.getAttrGrade()==e.equipAttrGrade.PRIMARY_ATTR&&1==t?s.push(n):n.getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&2==t&&s.push(n);for(var l,h,c,u,p=2==t&&s.length>0,g=i.length,r=0;g>r;r++)l=i[r],n=s[r],n?(h=n.getAttrData(),u=e.ColorUtils.instance.getAttrColorById(h.getAttrId()),c=e.LanguageUtils.instance.getValue("ATT_"+h.getAttrId())+":",l.text=c+e.GlobalUtil.getAttrValueStr(h.getAttrId(),h.getAttrValue()),0!=h.getAdditionValue()&&(l.text+="+"+h.getAdditionValue()),l.textColor=u,l.visible=!0):l.visible=!1;return p},i.prototype.checkBoxHandler=function(t){var i=t.currentTarget;if(0==i.selected)return e.SmeltController.getInstance().removeEquipInfoFromList(this.data),void(i.selected=!1);var n=e.SmeltController.getInstance().addEquipInfoToList(this.data);i.selected=n},i}(eui.ItemRenderer);e.CuilianSmeltSelectItem=t,__reflect(t.prototype,"foxgame.CuilianSmeltSelectItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.addList=null,i.guideNum=0,i.skinName="Smelt_Intensify",i.model=e,i}return __extends(i,t),i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=this.itemList.length,n=0,o=null;i>n;n++)o=this.itemList[n],o.setSelectedState(!1),o.showItemIcon("equipPartGray"+(n+1)+"_png");o=this.itemList[t],o.setSelectedState(!0),o.showItemIcon("equipPart"+(t+1)+"_png"),this.model.selectedIndex=t,this.model.singleCellInfo=this.model.cellInfos[t],this.showData()},i.prototype.showRedPoint=function(){var t=e.SmeltController.getInstance().getIntensifyOperateAry();if(void 0!=t){for(var i=t.length,n=0;n<this.itemList.length;n++)this.itemList[n].isShowRedPoint(!1);for(var n=0;i>n;n++){var o=t[n];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9];for(var i=0,n=this.itemList.length,o=null;n>i;i++)null!=this.model.cellInfos[i]&&this.itemList[i].showItemLevel(this.model.cellInfos[i].getCellStrenthLevel()),o=this.itemList[i],o.index=i,o.setSelectedState(!1),o.setStar(!1,-3),o.setstarBgId=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),o.showItemIcon("equipPartGray"+(i+1)+"_png");this.itemList[this.model.selectedIndex].setSelectedState(!0),this.itemList[this.model.selectedIndex].showItemIcon("equipPart"+(Number(this.model.selectedIndex)+1)+"_png"),this.intensifyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickFun,this),this.onKeyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onKeyIntensify,this),App.GuideUtils().currPart==e.GuidePart.currPart5&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.onKeyBtn,this,e.GuidePart.currPart5,1),App.GuideUtils().currPart==e.GuidePart.currPart12&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.onKeyBtn,this,e.GuidePart.currPart12,1)},i.prototype.IntensifyBack=function(t,i){if(i==e.Code.EQUIP_CELL_ONE_KEY_S_VALUE){var n="";switch(t.getErrorNo()){case 1:n=e.LanguageUtils.instance.getValue("QIANGHUASHIBUZU");break;case 2:n=e.LanguageUtils.instance.getValue("JINBIBUZU");break;case 3:n=e.LanguageUtils.instance.getValue("YIMANJI");break;case 4:n=e.LanguageUtils.instance.getValue("INTENIFYMAXLIMIT")}e.GameUtils.MSG_TIP(n)}else i==e.Code.EQUIP_CELL_SYNC&&this.model.roleId==t.roleId&&(this.playAni(),this.itemList[this.model.selectedIndex].playAni());this.showRedPoint()},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("intensifyAni","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.onKeyIntensify=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEquipsCellUP");t.setRoleId(this.model.roleId),e.Message.instance.send(e.Code.EQUIP_CELL_ONE_KEY_C,t,!0),e.SmeltController.getInstance().guideshow()},i.prototype.clickFun=function(t){if(this.selectItemLevel==this.model.maxLevel)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));if(this.selectItemLevel>=this.model.roleLevel)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("INTENIFYMAXLIMIT"));var i=this.model.strengthCfg[this.selectItemLevel+1],n=i.levelUpCost;if(this.model.currentIntensifyStoneNums<Number(n[2]))return this.guideNum=5,e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QIANGHUASHIBUZU")),void e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT);var o=this.model.currentGoldNums,a=i.goldCost;if(o<Number(a[2])){this.guideNum=5;var s=e.JsonDataManager.instance.itemTemplate,r=s[1002];return void e.ItemNotEnoughController.getInstance().showPanel(r.id)}var l=HawkProtocolManager.newBuilder("JsProto.HPEquipCellUpLevel");l.setCellId(this.model.singleCellInfo.getCellId()),l.setType(1),l.setRoleId(this.model.roleId),e.Message.instance.send(e.Code.EQUIP_CELL_UPLEVEL_C,l,!0),e.SmeltController.getInstance().guideshow()},i.prototype.showData=function(){this.addList=[],this.showRedPoint();for(var t=0,i=this.itemList.length;i>t;t++)null!=this.model.cellInfos[t]&&this.itemList[t].showItemLevel(this.model.cellInfos[t].getCellStrenthLevel());if(this.model.singleCellInfo=this.model.cellInfos[this.model.selectedIndex],this.model.equipInfoByPart=this.model.roleData.getEquipInfoByPart(this.model.selectedIndex+1),null==this.model.equipInfoByPart)this.addList=[1,1];else{var n=this.model.equipCfg[this.model.equipInfoByPart.getEquipId()],o=this.model.levelRateCfg[n.level];this.addList.push(o.rate);var a=this.model.qualityRateCfg[n.quality];this.addList.push(a.rate)}this.selectItemLevel=this.model.singleCellInfo.getCellStrenthLevel(),this.currentLvel.text=this.selectItemLevel.toString(),this.levelGroup.width=this.staticLevelText.width+this.currentLvel.width;var s=[],r=[],l="";if(0==this.selectItemLevel){var h=this.model.strengthCfg[this.selectItemLevel+1];l=h["propertiesCloaks"+(this.model.selectedIndex+1)],this.intensify_p.text=e.LanguageUtils.instance.getValue("DANGQIANJI")+e.LanguageUtils.instance.getValue("DZ_ATT_"+l[0])+"+"+~~(~~l[1]*this.addList[0]*this.addList[1]).toString(),s=h.levelUpCost;var c=Number(s[2]);this.num0.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentIntensifyStoneNums,c),r=h.goldCost;var u=Number(r[2]);this.num1.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentGoldNums,u)}else if(this.selectItemLevel>0&&this.selectItemLevel<this.model.maxLevel){var h=this.model.strengthCfg[this.selectItemLevel],p=this.model.strengthCfg[this.selectItemLevel+1];l=p["propertiesCloaks"+(this.model.selectedIndex+1)];var g=h["propertiesCloaks"+(this.model.selectedIndex+1)];this.intensify_p.text=e.LanguageUtils.instance.getValue("DANGQIAN")+":"+e.LanguageUtils.instance.getValue("DZ_ATT_"+g[0])+"+"+~~(~~g[1]*this.addList[0]*this.addList[1]).toString()+e.LanguageUtils.instance.getValue("XIAJI")+e.LanguageUtils.instance.getValue("DZ_ATT_"+l[0])+"+"+~~(~~l[1]*this.addList[0]*this.addList[1]).toString(),s=p.levelUpCost;var c=Number(s[2]);this.num0.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentIntensifyStoneNums,c),r=p.goldCost;var u=Number(r[2]);this.num1.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentGoldNums,u)}else{var h=this.model.strengthCfg[this.selectItemLevel],g=h["propertiesCloaks"+(this.model.selectedIndex+1)];this.intensify_p.text=e.LanguageUtils.instance.getValue("DANGQIAN")+":"+e.LanguageUtils.instance.getValue("DZ_ATT_"+g[0])+"+"+~~(~~g[1]*this.addList[0]*this.addList[1])+e.LanguageUtils.instance.getValue("XIAJIYIMAN"),this.num0.text=e.LanguageUtils.instance.getValue("SMELTS_PRO7"),this.num1.text=e.LanguageUtils.instance.getValue("SMELTS_PRO7")}},i}(eui.Component);e.IntensifyPanel_X=t,__reflect(t.prototype,"foxgame.IntensifyPanel_X")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.itemList=[],i.isuseBaohu=!1,i.isCanuseProtect=!1,i.costRedNum=0,i.numList=[],i.skinName="WeaponCuiLian",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.vipSend.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO3")),this.xunbao.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO4")),this.buyLimit.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO5")),this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9];for(var i=0;i<this.itemList.length;i++)this.itemList[i].Index=i,this.itemList[i].setLevel(""),this.itemList[i].setItemStar(""),this.itemList[i].setItemLevel(""),this.itemList[i].showItemType(this.model.itemTypeName[i]),this.itemList[i].setSelectedState(!1),this.itemList[i].setLevelBg(!1),this.itemList[i].setQualityIconVisible(!1),this.itemList[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this);this.setNoEquipGroupState(!0),this.btn_cuilian.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCuilianClick,this),this.btn_quickSelected.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuickSelectedClick,this);for(var n=0;n<this.group_costRed.numChildren;n++)this.group_costRed.getChildAt(n).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectClick,this);this.label_msg.textFlow=(new egret.HtmlTextParser).parse(e.LanguageUtils.instance.getValue("QUENCHINGMESSAGE")),this.vipSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.buyLimit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.checkBoxBtn.addEventListener(eui.UIEvent.CHANGE,this.onChange,this),this.selectView=new e.CuiLianSelectPanel(this.model),this.label_baohu.textFlow=e.SmeltController.getInstance().getQuenePanelText(redQuenePanelTextType.RedCost,0,0)},i.prototype.showData=function(){this.lastRoleId!=this.model.roleData.roleId&&this.clearEquipSelect(),this.equipList=this.model.roleData.getRoleEquipsForCS(),this.cellInfoList=this.model.roleData.getRoleEquipCellInfo().getCellInfos();for(var t=0;t<this.itemList.length;t++)this.itemList[t].restore();for(var t=0;t<this.equipList.length;t++)if(this.equipList[t]){var i=this.equipList[t].getPart()-1,n=e.BagController.getInstance().getEquipInfoById(this.equipList[t].getEquipId()),o=this.model.equipCfg[this.equipList[t].getEquipItemId()];this.itemList[i].setItemIcon(o.id),this.itemList[i].showItemType(""),this.itemList[i].setQualityIconVisible(!0),this.itemList[i].setLevelBg(!0),this.itemList[i].setItemLevel(o.level.toString()),this.itemList[i].setLevel(this.cellInfoList[i].getCellStrenthLevel().toString()),this.itemList[i].setItemStar(this.cellInfoList[i].getCellStartLevel().toString()),this.itemList[i].setQualityIcon(o.quality.toString());var a=this.model.redQuenData[n.getQuenchingLevel()];this.itemList[i].setNameEvolve(a.nameEvolve),this.itemList[i].setQueneAni(a.special)}void 0==this.model.currentSelectedIndex&&(this.model.currentSelectedIndex=this.getSelectIndex()),this.lastTypeId=this.model.currentInedx,this.lastRoleId=this.model.roleData.roleId,this.showSelectEquipInfo()},i.prototype.setNoEquipGroupState=function(e){this.noEquip.visible=e,this.haveEquip.visible=!e},i.prototype.showSelectEquipInfo=function(){this.showRedPoint(),this.currentSelectedRoleEquip=null;for(var t=0;t<this.equipList.length;t++)if(this.equipList[t].getPart()==this.model.currentSelectedIndex+1){this.currentSelectedRoleEquip=this.equipList[t];break}if(this.currentSelectedRoleEquip){this.setNoEquipGroupState(!1);for(var i=e.BagController.getInstance().getEquipInfoById(this.currentSelectedRoleEquip.getEquipId()),n=i.getQuenchingLevel(),o=this.model.redQuenData[n],a=i.getAttrInfos(),s=[],r=this.model.equipCfg[this.currentSelectedRoleEquip.getEquipItemId()],l=this.model.jpCfg[r.rareGroupId],h=void 0,t=0;t<a.length;t++)a[t].getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&s.push(a[t]);s.length!=this.container1.numChildren&&this.container1.removeChildren();for(var c=o.washLimitUp,t=0;t<s.length;t++)for(var u=0;u<l.length;u++){var p=s[t].getAttrData();if(p.getAttrId()==l[u].attId)if(h=l[u].intensifyMaxVal*(Number(c)/100+1),s.length!=this.container1.numChildren){var g=new e.WeaponUpXilLianBPCell;this.container1.addChild(g),g.initData(p.getAttrId(),p.getAttrValue(),p.getAttrValue(),h,0)}else this.container1.getChildAt(t).initData(p.getAttrId(),p.getAttrValue(),p.getAttrValue(),h,0)}var d=o.nameEvolve.toUpperCase(),f=e.LanguageUtils.instance.getValue(d);void 0!=f?this.equipName.text=f+"·"+r.name:this.equipName.text=r.name,this.costRedNum=o.costRedNum;var m=o.protectionCost;if(this.showPropInfo(m),this.label_nowRate.text="淬炼 LV."+n,this.label_jipinRate.text="极品属性（淬炼 LV."+n+"）",this.label_nowxilian.textFlow=e.SmeltController.getInstance().getQuenePanelText(redQuenePanelTextType.WashLimit,o.washLimitUp),this.model.redQuenData[n+1]){this.group_noMax.visible=!0,this.label_toRate.text="淬炼 LV."+(n+1),this.label_toxilian.textFlow=e.SmeltController.getInstance().getQuenePanelText(redQuenePanelTextType.WashLimit,this.model.redQuenData[n+1].washLimitUp),this.group_cuilianUp.visible=!0,this.label_cuilianMax.visible=!1,this.label_toxilian1.visible=!0;var y='<font size=16 color=0xeee3c6 fontFamily="黑体">洗练属性条目：</font><font size=16 color=0x21ff03 fontFamily="黑体">+1</font>';this.label_toxilian1.textFlow=this.model.htmlParse.parse(y),this.lastSelected!=this.currentSelectedRoleEquip&&this.clearEquipSelect()}else this.label_toRate.text="已满级",this.label_toxilian.text="",this.group_cuilianUp.visible=!1,this.label_cuilianMax.visible=!0,this.label_toxilian1.visible=!1,this.group_noMax.visible=!1;if(this.group_costRed.numChildren!=this.costRedNum){this.group_costRed.removeChildren();for(var t=0;t<this.costRedNum;t++){var I=new e.EquipSmeltItem;this.group_costRed.addChild(I),I.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectClick,this)}}this.label_suceessRate.textFlow=e.SmeltController.getInstance().getQuenePanelText(redQuenePanelTextType.SucRate,o.sucRate/100)}else this.setNoEquipGroupState(!0),this.clearEquipSelect();this.model.currentSelectedIndex>=0&&this.itemList[this.model.currentSelectedIndex].setSelectedState(!0),this.lastSelected=this.currentSelectedRoleEquip},i.prototype.showPropInfo=function(t){var i=(e.JsonDataManager.instance.itemTemplate,t.split("_"));if("30000"==i[0]){var n=e.BagController.getInstance().getCountByItemId(parseInt(i[1])),o=parseInt(i[2]);this.label_baohu.textFlow=e.SmeltController.getInstance().getQuenePanelText(redQuenePanelTextType.RedCost,n,o),n>=o?this.isCanuseProtect=!0:this.isCanuseProtect=!1}},i.prototype.showRedPoint=function(){var t=e.SmeltController.getInstance().getWeaponCLOperateAry();if(void 0!=t){for(var i=0;i<this.itemList.length;i++)this.itemList[i].isShowRedPoint(!1);for(var n=0;n<t.length;n++)this.itemList[t[n]].isShowRedPoint(!0)}},i.prototype.refreshSelectEquip=function(){var t,i=0;if(this.model.selectViewFlag){this.model.selectViewFlag=!1;for(var n=void 0,o=0,a=0;a<this.group_costRed.numChildren;a++)if(n=this.group_costRed.getChildAt(a),n.id>0)i++;else{if(this.model.selectedEquipList[o]){if(t=this.model.selectedEquipList[o],null==t)continue;n.setItem(t.getId(),e.ItemType.EQUIP,1,!1),i++}else n.setItem(-1);o++}this.model.selectedEquipList=[]}this.haveSelected=i,this.setCostLabel(i,this.costRedNum)},i.prototype.clearEquipSelect=function(){for(var e=0;e<this.group_costRed.numChildren;e++){var t=this.group_costRed.getChildAt(e);t.setItem(-1)}this.setCostLabel(0,this.costRedNum)},i.prototype.setCostLabel=function(t,i){this.label_costRed.textFlow=e.SmeltController.getInstance().getQuenePanelText(redQuenePanelTextType.RedCost,t,i)},i.prototype.getShowEquips=function(){for(var t,i,n=[],o=this.group_costRed.numChildren,a=0;o>a;a++)t=this.group_costRed.getChildAt(a),t.id<=0||(i=e.BagController.getInstance().getEquipInfoById(t.id),n.push(i));return n},i.prototype.setSelectEquipList=function(){var t,i,n=[],o=e.JsonDataManager.instance.equipTemplate,a=o[this.currentSelectedRoleEquip.getEquipItemId()].profession;i=e.SmeltController.getInstance().getAllRedWeapon(),t=this.getShowEquips();for(var s,r,l,h=i.length,c=t.length,u=0;h>u;u++){l=!1,s=i[u];for(var p=0;c>p;p++){r=t[p];var g=-1,d=-1;if(s&&(g=s.getId()),r&&(d=r.getId()),g==d){l=!0;break}}l||n.push(s)}for(var f=[],u=0;u<n.length;u++){var m=n[u],y=o[m.getEquipId()].profession;
if(a==y){var I=n.indexOf(m);I>-1&&f.push(m)}}return n=f},i.prototype.onCuilianClick=function(t){if(!this.judgeCurSeletedRed())return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO1"));var i=e.BagController.getInstance().getEquipInfoById(this.currentSelectedRoleEquip.getEquipId()),n=i.getQuenchingLevel();if(!this.model.redQuenData[n+1])return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QUENCHINGMAXLEVELTIP"));var o=this.getShowEquips(),a=[];if(0==this.getFreeCount()&&o.length==this.costRedNum){if(!this.isCanuseProtect&&this.checkBoxBtn.selected)return this.checkBoxBtn.selected=!1,void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QUENCHINGLACKPROTECTS"));this.isuseBaohu=this.checkBoxBtn.selected;for(var s=0;s<o.length;s++)a.push(o[s].getId());var r=this.currentSelectedRoleEquip.getEquipId();if(!this.model.tipbool)return void e.PopUpController.getInstance().showTextPanel2(e.LanguageUtils.instance.getValue("QUENCHINGERCTS",this.costRedNum),this,this.usePro.bind(this,r,a),{tipbool:this.model.tipbool},this.cancleUse.bind(this),{tipbool:this.model.tipbool});e.SmeltController.getInstance().sendRedEquipChing(r,a,this.isuseBaohu)}else e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QUENCHINGLACKRED"))},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0;i<this.itemList.length;i++)this.itemList[i].setSelectedState(t==i);this.model.currentSelectedIndex=t,this.showSelectEquipInfo()},i.prototype.onSelectClick=function(t){if(!this.judgeCurSeletedRed())return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO1"));var i=(this.model.equipCfg[this.currentSelectedRoleEquip.getEquipItemId()],Number(e.GlobalConfig.instance.getValue("RED_EQUIP_QUENCHING_EQUIP_LEVEL")),t.currentTarget);if(i.id>0){var n=--this.haveSelected;this.setCostLabel(n>=0?n:0,this.costRedNum),i.setItem(-1)}else this.model.selectEquipList=this.setSelectEquipList(),this.model.freeCount=this.getFreeCount(),this.selectView.show()},i.prototype.onQuickSelectedClick=function(t){if(!this.judgeCurSeletedRed())return e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO1"));this.model.selectEquipList=this.setSelectEquipList(),this.model.freeCount=this.getFreeCount();var i=this.model.selectEquipList.length;if(i>this.model.freeCount)this.model.selectedEquipList=this.model.selectEquipList.slice(0,this.model.freeCount);else{if(0==i)return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QUENCHINGLACKRED"));this.model.selectedEquipList=this.model.selectEquipList.slice(0,i)}this.model.selectViewFlag=!0,this.refreshSelectEquip()},i.prototype.onClick=function(t){switch(t.target){case this.vipSend:e.CreateNewVipController.instance.showPanel();break;case this.xunbao:e.SearchTreasureController.getInstance().showPanel();break;case this.buyLimit:e.ActivityController.getIntance().showPanel()}},i.prototype.onChange=function(){},i.prototype.usePro=function(t,i,n){void 0===n&&(n=null),n&&(this.model.tipbool=n),e.SmeltController.getInstance().sendRedEquipChing(t,i,this.isuseBaohu)},i.prototype.cancleUse=function(e){void 0===e&&(e=null),e&&(this.checkBoxBtn.selected=!1)},i.prototype.judgeCurSeletedRed=function(){for(var e=0;e<this.equipList.length;e++){var t=this.equipList[e];if(t.getPart()-1==this.model.currentSelectedIndex)return!0;if(e==this.equipList.length-1)return!1}return!0},i.prototype.getFreeCount=function(){for(var e,t=0,i=this.group_costRed.numChildren,n=0;i>n;n++)e=this.group_costRed.getChildAt(n),e.id>0||t++;return t},i.prototype.getSelectIndex=function(){for(var e,t=0,i=0;i<this.equipList.length;i++)if(null!=this.equipList[i])return e=!0,this.equipList[i].getPart()-1;return e?t:0},i.prototype.cuilianEquipback=function(t,i){if(i==e.Code.RED_EQUIP_QUENCHING_S){0==t.getErrorNo()&&this.setResultAni(t.getSucc())}},i.prototype.setResultAni=function(t){this.resultMc&&(this.resultMc.clear(),this.resultMc=null),!t&&this.isuseBaohu&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QUENCHINGBHSB")),this.resultMc=new e.FoxAni(this.ani_result),this.ani_result.visible=!0;var i=t?"chenggongFX":"fx_shibai";this.resultMc.setPlayComplete(this.onAniComplete,this),this.resultMc.play(i,"ani",1)},i.prototype.onAniComplete=function(){this.ani_result.visible=!1,this.showData(),this.clearEquipSelect()},i}(eui.Component);e.QuenchingPanel_X=t,__reflect(t.prototype,"foxgame.QuenchingPanel_X")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.SmeltModel,this.panel=new e.SmeltPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getPanel=function(){return this.panel},t.prototype.showPanel=function(t,i){void 0===t&&(t=e.SMELTTAPS.QIANGHUA),void 0===i&&(i=void 0),void 0!=i&&(this.model.currentSelectedIndex=i-1),this.panel.showPanel(t)},t.prototype.registerMsg=function(t){t.add(e.Code.EQUIP_CELL_SYNC,this),t.add(e.Code.EQUIP_CELL_UPLEVEL_C,this),t.add(e.Code.EQUIP_CELL_ONE_KEY_S_VALUE,this),t.add(e.Code.EQUIP_EVOLUTION_S,this),t.add(e.Code.EQUIP_BAPTIZE_S,this),t.add(e.Code.RED_EQUIP_QUENCHING_S,this)},t.prototype.sendRedEquipChing=function(t,i,n){var o=HawkProtocolManager.newBuilder("JsProto.RedEquipQuenchingReq");o.setEquipId(t),o.setCostEquipIds(i),o.setUseProtect(n),e.Message.instance.send(e.Code.RED_EQUIP_QUENCHING_C,o,!0)},t.prototype.guideshow=function(){this.panel.guideshow()},t.prototype.recvMsg=function(i,n){if(t.getInstance().getPanel().getIsShow()){switch(i){case e.MsgCMD.REFRESH_PLAYERDATA:this.panel.getIsShow()&&(t.getInstance().refreshredpoint(),this.panel.updateHeadBar(!0,!1));break;case e.Code.EQUIP_CELL_UPLEVEL_C:Log.trace(i);break;case e.Code.RED_EQUIP_QUENCHING_S:Log.trace(i)}i!=e.MsgCMD.REFRESH_PLAYERDATA&&this.model.operateBack(n,i)}},t.prototype.refreshredpoint=function(){var t=e.PlayerService.instance.getRoleDataList();this.model.roleOperateAry=[];var i,n,o,a,s;i=n=o=a=s=!1;for(var r=0;r<t.length;r++){var l=t[r];this.checkEquipUpStarRedPoint(l)&&(n=!0),this.checkEquipIntensifyRedPoint(l)&&(i=!0),this.checkGoldEqIntensifyRedPoint(l)&&(o=!0),this.checkGoldEquipXLRedPoint(l)&&(a=!0),this.checkRedQueneRedPoint(l)&&(s=!0)}this.panel.refreshUpStarRedTip(n),this.panel.refreshIntensifyRedTip(i),this.panel.refreshWeaponUpStarRedTip(o),this.panel.refreshWeaponXLRedTip(a),this.panel.refreshWeaponCLRedTip(s);for(var r=0;r<t.length;r++){var l=t[r];null!=l&&void 0!=l.getRoleEquipCellInfo()?this.checkEquipIntensifyRedPoint(l)&&1==this.model.currentInedx?this.model.roleOperateAry.push(!0):this.checkEquipUpStarRedPoint(l)&&2==this.model.currentInedx?this.model.roleOperateAry.push(!0):this.checkGoldEqIntensifyRedPoint(l)&&3==this.model.currentInedx?this.model.roleOperateAry.push(!0):this.checkGoldEquipXLRedPoint(l)&&4==this.model.currentInedx?this.model.roleOperateAry.push(!0):this.checkRedQueneRedPoint(l)&&5==this.model.currentInedx?this.model.roleOperateAry.push(!0):this.model.roleOperateAry.push(!1):this.model.roleOperateAry.push(!1)}for(var r=0;r<t.length;r++){var h=this.model.roleOperateAry[r];this.panel.refreshHeadBarRedTip(r,h)}},t.prototype.checkWeaponSysRedPoint=function(){var t=e.PlayerService.instance.getRoleDataList();this.model.roleOperateAry=[];for(var i=0;i<t.length;i++){var n=t[i];null!=n&&void 0!=n.getRoleEquipCellInfo()?this.checkEquipUpStarRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkEquipIntensifyRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkGoldEqIntensifyRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkGoldEquipXLRedPoint(n)?this.model.roleOperateAry.push(!0):this.checkRedQueneRedPoint(n)?this.model.roleOperateAry.push(!0):this.model.roleOperateAry.push(!1):this.model.roleOperateAry.push(!1)}for(var o=this.model.roleOperateAry.length,i=0;o>i;i++){var a=this.model.roleOperateAry[i];if(1==a)return!0}return!1},t.prototype.getIntensifyOperateAry=function(){return this.checkEquipIntensifyRedPoint(this.model.roleData),this.model.intensifyOperateAry},t.prototype.getUpStarOperateAry=function(){return this.checkEquipUpStarRedPoint(this.model.roleData),this.model.upStarOperateAry},t.prototype.getWeaponUpOperateAry=function(){return this.checkGoldEqIntensifyRedPoint(this.model.roleData),this.model.WeaponUpOperateAry},t.prototype.getWeaponXLOperateAry=function(){return this.checkGoldEquipXLRedPoint(this.model.roleData),this.model.WeaponXLOperateAry},t.prototype.getWeaponCLOperateAry=function(){return this.checkRedQueneRedPoint(this.model.roleData),this.model.WeaponCLOperateAry},t.prototype.checkEquipIntensifyRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipCellInfo().getCellInfos(),n=i.length,o=e.JsonDataManager.instance.strengthen;this.model.intensifyOperateAry=[];for(var a=0;n>a;a++){var s=i[a],r=s.getCellStrenthLevel(),l=e.BagController.getInstance().getCountByItemId(this.model.currentIntensifyStoneID),h=e.PlayerService.instance.playerInfo.getCoin(),c=o[r+1];if(void 0!=c){var u=Number(c.goldCost[2]),p=Number(c.levelUpCost[2]);r<this.model.maxLevel&&r<t.roleInfo.getLevel()&&h>=u&&l>=p&&-1==this.model.intensifyOperateAry.indexOf(a)&&this.model.intensifyOperateAry.push(a)}}return this.model.intensifyOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),!0):!1},t.prototype.checkEquipUpStarRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipCellInfo().getCellInfos(),n=i.length,o=e.JsonDataManager.instance.partStarUpgrade;this.model.upStarOperateAry=[];for(var a=0;n>a;a++){var s=i[a],r=s.getCellStartLevel(),l=e.BagController.getInstance().getCountByItemId(this.model.stoneId),h=e.PlayerService.instance.playerInfo.getCoin(),c=e.PlayerService.instance.playerInfo.getLevel(),u=o[r+1];if(void 0!=u){var p=Number(u.levelUpCost[1][2]),g=Number(u.levelUpCost[0][2]);this.model.upStarCfg&&this.model.upStarCfg[r+1]&&c>=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING)&&h>=p&&l>=g&&-1==this.model.upStarOperateAry.indexOf(a)&&this.model.upStarOperateAry.push(a)}}return this.model.upStarOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),!0):!1},t.prototype.checkRedQueneRedPoint=function(t){void 0===t&&(t=null);var i=e.JsonDataManager.instance.redQuenching,n=t.getRoleEquipsForCS(),o=e.JsonDataManager.instance.equipTemplate;this.model.WeaponCLOperateAry=[];for(var a=0;a<n.length;a++){var s=n[a],r=o[s.getEquipItemId()],l=s.getPart(),h=e.BagController.getInstance().getEquipInfoById(s.getEquipId()),c=h.getQuenchingLevel();if(i[c+1]){for(var u=i[c],p=u.costRedNum,g=r.profession,d=0,f=this.getAllRedWeapon(),m=0;m<f.length;m++){var y=f[m],I=o[y.getEquipId()].profession;g==I&&d++}d>=p&&this.model.WeaponCLOperateAry.push(l-1)}}return this.model.WeaponCLOperateAry.length>0?!0:!1},t.prototype.checkGoldEqIntensifyRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipsForCS(),n=e.JsonDataManager.instance.equipTemplate,o=e.JsonDataManager.instance.equipmentUpgradeTemplate,a=i.length,s=e.PlayerService.instance.playerInfo.getLevel();this.model.WeaponUpOperateAry=[];for(var r=0;a>r;r++){var l=i[r],h=n[l.getEquipItemId()];if(h.level<this.model.WeaponUpMaxLevel&&h.level<=s-10){var c=o[h.id].costList,u=c[0].value,p=e.PlayerService.instance.playerInfo.getCoin(),g=Number(c[1].value),d=e.BagController.getInstance().getCountByItemId(c[1].id);if(p>=u&&d>=g){var f=l.getPart()-1;-1==this.model.WeaponUpOperateAry.indexOf(f)&&this.model.WeaponUpOperateAry.push(f)}}}return this.model.WeaponUpOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),!0):!1},t.prototype.checkGoldEquipXLRedPoint=function(t){void 0===t&&(t=null);var i=t.getRoleEquipsForCS(),n=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_1"),o=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_2"),a=n.split("_"),s=o.split("_"),r=i.length;this.model.WeaponXLOperateAry=[];for(var l=0;r>l;l++){var h=i[l],c=Number(a[2]),u=Number(s[2]),p=e.BagController.getInstance().getCountByItemId(Number(a[1])),g=e.BagController.getInstance().getCountByItemId(Number(s[1]));if(p>=c){var d=h.getPart()-1;-1==this.model.WeaponXLOperateAry.indexOf(d)&&this.model.WeaponXLOperateAry.push(d)}else if(this.checkAttrIsFull(h)&&g>=u){var d=h.getPart()-1;-1==this.model.WeaponXLOperateAry.indexOf(d)&&this.model.WeaponXLOperateAry.push(d)}}return this.model.WeaponXLOperateAry.length>0?(t||e.MainBottomControler.instance.refreshWeaponIconOperate(),!0):!1},t.prototype.checkAttrIsFull=function(t){for(var i=e.JsonDataManager.instance.equipTemplate,n=e.BagController.getInstance().getEquipInfoById(t.getEquipId()),o=i[t.getEquipItemId()],a=n.getAttrInfos(),s=a.length,r=0;s>r;r++){for(var l=a[r],h=l.getAttrData(),c=0,u=0;u<o.attrTypeList.length;u++)if(h.getAttrId()==o.attrTypeList[u]){c=o.attrAddMaxValueList[u];break}if(h.getAdditionValue()<c)return!0}return!1},t.prototype.getAllRedWeapon=function(){var t,i,n,o=([e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],[e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3],e.BagController.getInstance().getModel()),a=[],s=e.JsonDataManager.instance.equipTemplate;for(var r in o.equipDic)t=o.equipDic[r],i=t.equipInfo,i.getLockPeriod()>0||(n=s[i.getEquipId()],t.itemVO.quality==e.EquipQuality.RED&&a.push(i));var l,h;return a.sort(function(e,t){return l=s[e.getEquipId()],h=s[t.getEquipId()],l.partList[0]>h.partList[0]?1:l.partList[0]<h.partList[0]?-1:0}),a},t.prototype.addEquipInfoToList=function(t){return this.model.selectedEquipList.length==this.model.freeCount?(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTNOFREECOUNT")),!1):(this.model.selectedEquipList.push(t),!0)},t.prototype.removeEquipInfoFromList=function(e){var t=this.model.selectedEquipList.indexOf(e);-1!=t&&this.model.selectedEquipList.splice(t,1)},t.prototype.checkAddedToSelected=function(e){return-1!=this.model.selectedEquipList.indexOf(e)},t.prototype.getQuenePanelText=function(e,t,i){void 0===i&&(i=0);var n="";switch(e){case redQuenePanelTextType.ProtectCost:n='<font size=20 color=0x21ff03 fontFamily="宋体">'+t+" </font>"+('<font size=20 color=0xffffff fontFamily="宋体">/ '+i+"</font>");break;case redQuenePanelTextType.RedCost:n=t>=i?'<font size=16 color=0x21ff03 fontFamily="宋体">'+t+" </font>"+('<font size=16 color=0xffffff fontFamily="宋体">/ '+i+"</font>"):'<font size=16 color=0xff0000 fontFamily="宋体">'+t+" </font>"+('<font size=16 color=0xffffff fontFamily="宋体">/ '+i+"</font>");break;case redQuenePanelTextType.WashLimit:n='<font size=16 color=0xeee3c6 fontFamily="黑体">洗练上限提升：</font>'+('<font size=16 color=0x21ff03 fontFamily="黑体">'+t+"%</font>");break;case redQuenePanelTextType.SucRate:n='<font size=16 color=0xffe400 fontFamily="黑体">成功率：</font>'+('<font size=16 color=0x21ff03 fontFamily="黑体">'+t+"%</font>")}return(new egret.HtmlTextParser).parse(n)},t}();e.SmeltController=t,__reflect(t.prototype,"foxgame.SmeltController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var redQuenePanelTextType;!function(e){e[e.ProtectCost=0]="ProtectCost",e[e.RedCost=1]="RedCost",e[e.WashLimit=3]="WashLimit",e[e.SucRate=4]="SucRate"}(redQuenePanelTextType||(redQuenePanelTextType={}));var foxgame;!function(e){var t=function(){function t(){this.currentInedx=1,this.currentIntensifyStoneID=110007,this.stoneId=110010,this.selectedIndex=0,this.roleOperateAry=[],this.upStarOperateAry=[],this.WeaponUpOperateAry=[],this.intensifyOperateAry=[],this.WeaponXLOperateAry=[],this.WeaponCLOperateAry=[],this.maxLevel=210,this.WeaponUpMaxLevel=210,this.freeCount=0,this.selectViewFlag=!1,this.tipbool=!1,this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.operateBack=function(e,t){for(var i,n=this.observerList.length,o=0;n>o;o++)i=this.observerList[o],i.getIsShow()&&i.weaponSmeltItemChanged(e,t)},t.prototype.resetSmelt=function(){this.itemTypeName=[e.LanguageUtils.instance.getValue("PARTNAME1"),e.LanguageUtils.instance.getValue("PARTNAME2"),e.LanguageUtils.instance.getValue("PARTNAME3"),e.LanguageUtils.instance.getValue("PARTNAME4"),e.LanguageUtils.instance.getValue("PARTNAME5"),e.LanguageUtils.instance.getValue("PARTNAME6"),e.LanguageUtils.instance.getValue("PARTNAME7"),e.LanguageUtils.instance.getValue("PARTNAME8"),e.LanguageUtils.instance.getValue("PARTNAME9"),e.LanguageUtils.instance.getValue("PARTNAME10")],this.maxLevel=this.WeaponUpMaxLevel=Number(e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_GRADE_MAX")),this.playerInfo=e.PlayerService.instance.playerInfo,this.currentGoldNums=e.PlayerService.instance.playerInfo.getCoin(),this.currentIntensifyStoneNums=e.BagController.getInstance().getCountByItemId(this.currentIntensifyStoneID),this.currentStoneNums=e.BagController.getInstance().getCountByItemId(this.stoneId),this.strengthCfg=e.JsonDataManager.instance.strengthen,this.levelRateCfg=e.JsonDataManager.instance.strengthenLevelRate,this.qualityRateCfg=e.JsonDataManager.instance.strengthenQualityRate,this.upStarCfg=e.JsonDataManager.instance.partStarUpgrade,this.jpCfg=e.JsonDataManager.instance.rareAttrTemplate,this.equipCfg=e.JsonDataManager.instance.equipTemplate,this.equipmentUpgradeCfg=e.JsonDataManager.instance.equipmentUpgradeTemplate,this.redQuenData=e.JsonDataManager.instance.redQuenching,this.redSelect_dataCollection=new eui.ArrayCollection,this.redSelect_dataCollection.source=[],this.selectEquipList=[],this.selectedEquipList=[],this.htmlParse=new egret.HtmlTextParser},t.prototype.setCellInfos=function(e){this.cellInfos=e},t.prototype.setRoleId=function(e){this.roleId=Number(e)},t}();e.SmeltModel=t,__reflect(t.prototype,"foxgame.SmeltModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.QIANGHUA=1]="QIANGHUA",e[e.SHENGXING=2]="SHENGXING",e[e.SHENZHUANGSHENGJI=3]="SHENZHUANGSHENGJI",e[e.SHENZHUANGXILIAN=4]="SHENZHUANGXILIAN",e[e.SHENZHUANGCUILIAN=5]="SHENZHUANGCUILIAN"}(t=e.SMELTTAPS||(e.SMELTTAPS={}));var i=function(i){function n(t){var n=i.call(this,"resource/skins/smelt/WeaponSmelt.exml","weapon",!1)||this;return n.model=t,n.setIsShowTween(!1),n.setMaskGapBottom(e.Global.mainBtnsPanelMaskGapBottom),n.isMask=!1,n.isMaskdown=!0,n.adaptionType=1,n}return __extends(n,i),n.prototype.initHook=function(){this.model.registerObserver(this),this.initView(),this.ui.intensifyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.upStarBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.weaponUpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.xiLianBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.cuiLianBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1),e.SmeltController.getInstance().refreshredpoint(),e.MainBottomControler.instance.refreshWeaponIconOperate(),this.doScreenAdaptation()},n.prototype.showHook=function(){30==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.upStarBtn,this.ui.upStarBtn.parent,30,2,!0),App.GuideUtils().currdbz==e.GuidePart.currPart48&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.cuiLianBtn,this.ui.cuiLianBtn.parent,e.GuidePart.currPart48,2,!0),this.updateHeadBar(!0,!1)},n.prototype.guideshow=function(){var t=StageFrameControl.instance.getBackBtn();App.GuideUtils().currPart==e.GuidePart.currPart5&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart5,2,!1),App.GuideUtils().currPart==e.GuidePart.currPart12&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(t,t.parent,e.GuidePart.currPart12,2,!1),30==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(t,t.parent,30,4,!0)},n.prototype.closeHook=function(){App.GuideUtils().currPart==e.GuidePart.currPart12&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart5&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart48&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),30==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel())),App.GuideUtils().currdbz==e.GuidePart.currPart48&&3==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},n.prototype.onClick=function(t){var i;switch(t.target){case this.ui.intensifyBtn:i=e.WeaponTaps.QIANGHUA,this.changeView(i);break;case this.ui.upStarBtn:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.ZHUANGBEISHENGXING))i=e.WeaponTaps.SHENGXING,this.changeView(i);else{var n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.ZHUANGBEISHENGXING);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZHUANGBEISHENGXING",n)),this.setTabState(this.model.currentInedx)}break;case this.ui.weaponUpBtn:i=e.WeaponTaps.SHENZHUANGSHENGJI,this.changeView(i);break;case this.ui.xiLianBtn:i=e.WeaponTaps.SHENZHUANGXILIAN,this.changeView(i);break;case this.ui.cuiLianBtn:if(App.GuideUtils().currdbz==e.GuidePart.currPart48&&2==App.GuideUtils().currxbz){var o=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(o,o.parent,e.GuidePart.currPart48,3,!0)}if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.QUENECHING))i=e.WeaponTaps.SHENZHUANGCUILIAN,this.changeView(i);else{var n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.QUENECHING);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QUENCHINGOPENTIP",n)),this.setTabState(this.model.currentInedx)}break;case this.ui.helpBtn:var a="";switch(this.model.currentInedx){case 1:a="STRENGTHENHELP";break;case 2:a="STARLIFTHELP";break;case 3:a="GODOUTFITUPGRADEHELP";break;case 4:a="GODPUTTHEPOLISHHELP";break;case 5:a="CUILIANHELP"}e.HelpController.getInstance().showPanel(a)}},n.prototype.initParams=function(){this.model.resetSmelt(),this.changeView(this.model.currentInedx),App.LittleLoading().hideLoading("SmeltPanel")},n.prototype.refresh=function(){switch(this.ui.currency.refresh(),this.model.currentInedx){case t.QIANGHUA:this.IntensifyPanel.showData();break;case t.SHENGXING:this.UpstarPanel.showData();break;case t.SHENZHUANGSHENGJI:this.UpgodequipPanel.showData();break;case t.SHENZHUANGXILIAN:this.CleangodequipPanel.showData();break;case t.SHENZHUANGCUILIAN:this.cuilianPanel.showData()}},n.prototype.weaponSmeltItemChanged=function(i,n){this.model.currentInedx==t.QIANGHUA?this.IntensifyPanel.IntensifyBack(i,n):this.model.currentInedx==t.SHENGXING?this.UpstarPanel.UpStarBack(i,n):this.model.currentInedx==t.SHENZHUANGSHENGJI?this.UpgodequipPanel.UpgodequipBack(i,n):this.model.currentInedx==t.SHENZHUANGXILIAN?this.CleangodequipPanel.CleangodequipBack(i,n):this.model.currentInedx==t.SHENZHUANGCUILIAN&&this.cuilianPanel.cuilianEquipback(i,n),n==e.Code.EQUIP_CELL_SYNC&&(this.model.setCellInfos(i.cellInfos),this.model.setRoleId(i.roleId),this.refresh()),this.model.resetSmelt(),e.MainBottomControler.instance.refreshWeaponIconOperate()},n.prototype.initView=function(){this.ui.headBar.setBackFun(this.setRoleData.bind(this))},n.prototype.showPanel=function(e){this.getIsShow()?this.changeView(e):(this.model.currentInedx=e,this.show())},n.prototype.clear=function(){this.IntensifyPanel=null,this.UpstarPanel=null,this.UpgodequipPanel=null,this.CleangodequipPanel=null},n.prototype.changeView=function(i){switch(this.model.currentInedx=i,this.ui.viewgroup.removeChildren(),this.clear(),this.model.currentInedx){case t.QIANGHUA:this.IntensifyPanel||(this.IntensifyPanel=new e.IntensifyPanel_X(this.model)),this.ui.viewgroup.addChild(this.IntensifyPanel);break;case t.SHENGXING:this.UpstarPanel||(this.UpstarPanel=new e.UpstarPanel_X(this.model)),this.ui.viewgroup.addChild(this.UpstarPanel);break;case t.SHENZHUANGSHENGJI:this.UpgodequipPanel||(this.UpgodequipPanel=new e.UpgodequipPanel_X(this.model)),this.ui.viewgroup.addChild(this.UpgodequipPanel);break;case t.SHENZHUANGXILIAN:this.CleangodequipPanel||(this.CleangodequipPanel=new e.CleangodequipPanel_X(this.model)),this.ui.viewgroup.addChild(this.CleangodequipPanel);break;case t.SHENZHUANGCUILIAN:this.cuilianPanel||(this.cuilianPanel=new e.QuenchingPanel_X(this.model)),this.model.selectViewFlag=!0,this.cuilianPanel.clearEquipSelect(),this.ui.viewgroup.addChild(this.cuilianPanel)}this.setTabState(this.model.currentInedx),this.refresh()},n.prototype.refreshHeadBarRedTip=function(e,t){this.getIsShow()&&this.ui.headBar.setRedStatus(e,t)},n.prototype.refreshIntensifyRedTip=function(e){this.getIsShow()&&(this.ui.intensifyRedImg.visible=e)},n.prototype.refreshUpStarRedTip=function(e){this.getIsShow()&&(this.ui.upStarRedImg.visible=e)},n.prototype.refreshWeaponUpStarRedTip=function(e){this.getIsShow()&&(this.ui.weaponUpRedImg.visible=e)},n.prototype.refreshWeaponXLRedTip=function(e){this.getIsShow()&&(this.ui.weaponXLRedImg.visible=e)},n.prototype.refreshWeaponCLRedTip=function(e){this.getIsShow()&&(this.ui.weaponCLRedImg.visible=e)},n.prototype.updateHeadBar=function(t,i){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),t,i)},n.prototype.setRoleData=function(t){this.getIsShow()&&(this.model.roleData=t,this.model.roleId=this.model.roleData.roleId,this.model.roleLevel=e.PlayerService.instance.level,this.model.playerInfo=e.PlayerService.instance.playerInfo,this.model.currentIntensifyStoneNums=e.BagController.getInstance().getCountByItemId(this.model.currentIntensifyStoneID),this.model.currentStoneNums=e.BagController.getInstance().getCountByItemId(this.model.stoneId),this.model.cellInfos=this.model.roleData.getRoleEquipCellInfo().getCellInfos(),this.model.currentGoldNums=this.model.playerInfo.getCoin(),this.setTabState(this.model.currentInedx),(this.IntensifyPanel||this.UpstarPanel||this.UpgodequipPanel||this.CleangodequipPanel||this.cuilianPanel)&&this.refresh())},n.prototype.setTabState=function(e){this.ui.intensifyBtn.selected=1==e,this.ui.upStarBtn.selected=2==e,this.ui.weaponUpBtn.selected=3==e,this.ui.xiLianBtn.selected=4==e,this.ui.cuiLianBtn.selected=5==e},n.prototype.readyDestroy=function(){this.ui.viewgroup.removeChildren(),this.model.selectedIndex=0,this.model.currentSelectedIndex=void 0,this.IntensifyPanel=null,this.UpstarPanel=null,this.UpgodequipPanel=null,this.CleangodequipPanel=null},n}(e.BasePanel);e.SmeltPanel=i,__reflect(i.prototype,"foxgame.SmeltPanel",["foxgame.IWeaponSmelt","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="Smelt_EquipUp",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.vipSend.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO3")),this.xunbao.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO4")),this.buyLimit.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("SMELTS_PRO5")),this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9],this.upItemList=[this.item0,this.item1,this.item2];for(var i=0,n=this.itemList.length,o=null;n>i;)o=this.itemList[i],o.Index=i,o.restore(),o.setLevel(""),o.setItemStar(""),o.setItemLevel(""),o.showItemType(this.model.itemTypeName[i]),o.setSelectedState(!1),o.setLevelBg(!1),o.setQualityIconVisible(!1),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),i++;for(i=0,n=this.upItemList.length;n>i;)this.upItemList[i].setLevel(""),i++;this.upItemCell.setLevel(""),this.setGroupVisible(!1),this.upBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickFun,this),this.vipSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.buyLimit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.vipSend:e.CreateNewVipController.instance.showPanel();break;case this.xunbao:e.SearchTreasureController.getInstance().showPanel();break;case this.buyLimit:e.ActivityController.getIntance().showPanel()}},i.prototype.clickFun=function(t){for(var i,n=0;n<this.equipList.length;n++)if(this.equipList[n].getPart()==this.model.currentSelectedIndex+1){i=!0;break}if(this.condition2)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO6"));if(!i)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("SMELTS_PRO1"));if(0==this.condition0){var o=e.JsonDataManager.instance.itemTemplate,a=o[1002];return void e.ItemNotEnoughController.getInstance().showPanel(a.id)}if(0==this.condition1)return void e.ItemNotEnoughController.getInstance().showPanel(this.propVO.id);for(var s,n=0;n<this.equipList.length;n++)if(this.equipList[n].getPart()==this.model.currentSelectedIndex+1){s=this.equipList[n];break}this.currentSelectPart=s.getPart();var r=HawkProtocolManager.newBuilder("JsProto.HPEquipEvolution");r.setEquipId(s.getEquipId()),r.setRefRareAtt(this.checkBoxBtn.selected),e.Message.instance.send(e.Code.EQUIP_EVOLUTION_C,r,!0)},i.prototype.UpgodequipBack=function(t,i){if(i==e.Code.EQUIP_EVOLUTION_S){if(this.showData(),0!=t.getErrorNo())return void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo());this.playAni()}},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0,n=this.itemList.length,o=null;n>i;)o=this.itemList[i],o.setSelectedState(!1),i++;this.model.currentSelectedIndex=t,this.showSelectEquipInfo()},i.prototype.setGroupVisible=function(e){this.upGroup.visible=e},i.prototype.initMaskAndTweenState=function(){this.topMask.width=0,this.leftMask.width=0,this.rightMask.width=0,TweenMax.killTweensOf(this.leftMask),TweenMax.killTweensOf(this.rightMask),TweenMax.killTweensOf(this.topMask)},i.prototype.setAniAndTween=function(){this.leftAni&&(this.leftAni.clear(),this.leftAni=null),void 0==this.leftAni&&(this.leftAni=new e.FoxAni(this.leftAniGroup),this.leftAni.play("weapupEffect"),this.leftAniGroup.mask=this.leftMask),this.rightAni&&(this.rightAni.clear(),this.rightAni=null),void 0==this.rightAni&&(this.rightAni=new e.FoxAni(this.rightAniGroup),this.rightAni.play("weapupEffect"),this.rightAniGroup.mask=this.rightMask),this.topAni&&(this.topAni.clear(),this.topAni=null),void 0==this.topAni&&(this.topAni=new e.FoxAni(this.topAniGroup),this.topAni.play("weapupEffect"),this.topAniGroup.mask=this.topMask),TweenMax.to(this.leftMask,.5,{width:this.leftAniGroup.width}),TweenMax.to(this.rightMask,.5,{width:this.rightAniGroup.width,onComplete:function(){TweenMax.to(this.topMask,.5,{width:this.topAniGroup.width})}.bind(this)})},i.prototype.createTextFlow=function(e,t){var i;i=e>=t?65280:16711680;var n=[{text:"(",style:{textColor:16777215}},{text:t+"",style:{textColor:i}},{text:")",style:{textColor:16777215}}];return n},i.prototype.getLableColor=function(t){return e.ColorUtils.instance.getAttrColorById(t).toString()},i.prototype.showRedPoint=function(){var t=e.SmeltController.getInstance().getWeaponUpOperateAry();if(void 0!=t){for(var i=0;i<this.itemList.length;i++)this.itemList[i].isShowRedPoint(!1);for(var n=t.length,i=0;n>i;i++){var o=t[i];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.showData=function(){for(var t=0;t<this.itemList.length;t++)this.itemList[t].restore();this.equipList=this.model.roleData.getRoleEquipsForCS(),this.cellInfoList=this.model.roleData.getRoleEquipCellInfo().getCellInfos();for(var i=0;i<this.equipList.length;i++)if(null!=this.equipList[i]){var n=this.equipList[i].getPart()-1,o=this.model.equipCfg[this.equipList[i].getEquipItemId()],a=e.BagController.getInstance().getEquipInfoById(this.equipList[i].getEquipId());
this.itemList[n].setItemIcon(o.id),this.itemList[n].showItemType(""),this.itemList[n].setQualityIconVisible(!0),this.itemList[n].setLevelBg(!0),this.itemList[n].setItemLevel(o.level.toString()),this.itemList[n].setLevel(this.cellInfoList[n].getCellStrenthLevel().toString()),this.itemList[n].setItemStar(this.cellInfoList[n].getCellStartLevel().toString()),this.itemList[n].setQualityIcon(o.quality.toString());var s=this.model.redQuenData[a.getQuenchingLevel()];this.itemList[n].setNameEvolve(s.nameEvolve),this.itemList[n].setQueneAni(s.special)}void 0==this.model.currentSelectedIndex&&(this.model.currentSelectedIndex=this.getSelectIndex()),this.showSelectEquipInfo()},i.prototype.getSelectIndex=function(){for(var e,t=0,i=0;i<this.equipList.length;i++)if(null!=this.equipList[i]){e=!0;var n=this.model.equipCfg[this.equipList[i].getEquipItemId()];if(n.level<this.model.maxLevel)return this.equipList[i].getPart()-1}return e?t:0},i.prototype.showSelectEquipInfo=function(){this.showRedPoint(),this.initMaskAndTweenState();for(var t,i=0;i<this.equipList.length;i++)if(this.equipList[i].getPart()==this.model.currentSelectedIndex+1){t=this.equipList[i];break}if(null!=t){var n=this.model.equipCfg[t.getEquipItemId()];n.level<this.model.maxLevel&&this.setAniAndTween(),this.currentSelectedEquipCfg=n,this.noEquip.visible=!1,this.downGroup.visible=!0,this.upGroup.visible=!0,this.item0.visible=!0,this.item0.setItem(n.id),this.item0.setLevel(n.level.toString()),this.condition2=n.level>=this.model.maxLevel;for(var o=this.model.equipmentUpgradeCfg[n.id].costList,a=e.JsonDataManager.instance.itemTemplate,i=0;i<o.length;i++)if(o[i].id==e.AttributeType.COIN||o[i].id==e.AttributeType.DIAMOND||o[i].id==e.AttributeType.EXP){this.condition0=!(this.model.currentGoldNums<o[i].value);var s=a[o[i].id];this.goldName.text=s.name,this.item1.visible=!0,this.item1.setItem(s.id);var r=o[i].value;this.goldNums.textFlow=this.createTextFlow(this.model.currentGoldNums,r)}else if(n.level<this.model.maxLevel){var l=e.BagController.getInstance().getCountByItemId(o[i].id);this.propNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(l,o[i].value,1),this.condition1=!(l<o[i].value),this.propVO=a[o[i].id],this.propName.text=this.propVO.name,this.item2.visible=!0,this.item2.setItem(this.propVO.id);break}if(this.upItemName.text="",n.level<this.model.maxLevel){var h=n.id+1,c=this.model.equipCfg[h];this.upItemCell.visible=!0,this.item0.visible=!0,this.item1.visible=!0,this.item2.visible=!0,this.upItemCell.setItem(c.id),this.upItemCell.setLevel(c.level.toString());var u=(this.model.roleData.getRoleEquipsForCS(),e.BagController.getInstance().getEquipInfoById(t.getEquipId()));this.upItemCell.setQueneLevelProps(u.getId()),this.item0.setQueneLevelProps(u.getId());var p=this.model.redQuenData[u.getQuenchingLevel()],g=e.LanguageUtils.instance.getValue(p.nameEvolve.toUpperCase());void 0!=g?(this.upItemName.text=g+"·"+c.name,this.itemName.text=g+"·"+n.name):(this.upItemName.text=c.name,this.itemName.text=n.name),this.bestPropertys=u.getAttrInfos();for(var d="",f="",i=0,m=c.attrTypeList.length;m>i;i++){var y=this.bestPropertys[i].getAttrData().getAdditionValue(),I=this.jichubuff(n.attrAddMaxValueList[i],y,c.attrAddMaxValueList[i]),v=n.attrValueList[i]+Number(y);d+="<font color =0x67F21D  >"+(Number(c.attrValueList[i])+Number(I))+"\n</font>",f+="<font color =0xdccc94 >"+e.LanguageUtils.instance.getValue("ATT_"+n.attrTypeList[i].toString())+"：</font><font color =0x67F21D  >"+v+"\n</font>"}this.intensify_p0.textFlow=(new egret.HtmlTextParser).parser(d),this.intensify_p2.textFlow=(new egret.HtmlTextParser).parser(f);var _=this.model.jpCfg[c.rareGroupId],T=this.model.jpCfg[n.rareGroupId],C="",A="",E=void 0,S=void 0,P=void 0,b=0,L=0;for(this.group_toArrow.removeChildren(),i=0,m=this.bestPropertys.length;m>i;){if(E=this.bestPropertys[i],2==E.attrGrade){this.group_toArrow.addChild(new eui.Image("littlearrow_png")),b=E.attrData.attrId,L=parseFloat(E.attrData.attrValue);var w=this.numarr(_,T,L,b);S=e.LanguageUtils.instance.getValue("ATT_"+b)+": ";var B=e.GlobalUtil.getAttrValueStr(b,L);P=e.GlobalUtil.getAttrValueStr(b,w),C+="<font color =0xdccc94 >"+S+"</font><font color =0x67F21D >"+B+"\n</font>",A+="<font color =0x67F21D >"+P+"\n</font>"}i++}this.intensify_p1.textFlow=(new egret.HtmlTextParser).parser(C),this.intensify_p3.textFlow=(new egret.HtmlTextParser).parser(A)}else{this.intensify_p0.text=this.intensify_p1.text=this.intensify_p2.text=this.intensify_p3.text=e.LanguageUtils.instance.getValue("YIMANJI"),this.propNums.text=this.propName.text=this.goldNums.text=this.goldName.text=this.itemNum.text=this.itemName.text="",this.upItemCell.visible=!1;var N=void 0;for(i=0,m=3;m>i;)N=this["item"+i],N.visible=!1,N.setLevel(""),i++;this.upItemCell.setLevel("")}this.itemList[t.getPart()-1].setSelectedState(!0),this.itemList[t.getPart()-1].setItemIcon(t.getEquipItemId())}else{for(this.currentSelectedEquipCfg=null,this.noEquip.visible=!0,this.downGroup.visible=!1,i=0;i<this.upItemList.length;i++)this.upItemList[i].visible=!1,this.upItemList[i].setLevel("");this.upItemCell.visible=!1,this.upItemCell.setLevel(""),this.setGroupVisible(!1),this.condition0=!1,this.condition1=!1,this.condition2=!1}this.model.currentSelectedIndex>=0&&this.itemList[this.model.currentSelectedIndex].setSelectedState(!0)},i.prototype.jichubuff=function(e,t,i){var n=e/t,o=i/n;return Math.round(o)},i.prototype.numarr=function(e,t,i,n){for(var o,a,s=0;s<e.length;s++)e[s].attId==n&&(o=e[s].intensifyMaxVal),t[s].attId==n&&(a=t[s].intensifyMaxVal);var r=a/i,l=o/r;return Math.round(l)},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i}(eui.Component);e.UpgodequipPanel_X=t,__reflect(t.prototype,"foxgame.UpgodequipPanel_X")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="Smelt_UpStar",i.model=e,i}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9];for(var i=0,n=this.itemList.length,o=null;n>i;i++)o=this.itemList[i],o.index=i,o.setStar(!0,-3),o.setSelectedState(!1),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),o.showItemIcon("equipPartGray"+(i+1)+"_png");this.itemList[this.model.selectedIndex].setSelectedState(!0),this.itemList[this.model.selectedIndex].showItemIcon("equipPart"+(this.model.selectedIndex+1)+"_png"),this.upStarBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upFun,this),30==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.upStarBtn,this.upStarBtn.parent,30,3,!0),this.checkRed()},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0;i<this.itemList.length;i++)this.itemList[i].setSelectedState(!1),this.itemList[i].showItemIcon("equipPartGray"+(i+1)+"_png");this.itemList[t].setSelectedState(!0),this.itemList[t].showItemIcon("equipPart"+(t+1)+"_png"),this.model.selectedIndex=t,this.model.singleCellInfo=this.model.cellInfos[t],this.lastSelectItem=t,this.showData()},i.prototype.UpStarBack=function(t,i){i==e.Code.EQUIP_CELL_SYNC&&(this.playAni(),this.itemList[this.model.selectedIndex].playAni(),this.checkRed(this.model.selectedIndex))},i.prototype.playAni=function(){this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.upStarAni=new e.FoxAni(this.aniGroup),this.upStarAni.setPlayComplete(this.playComplete,this),this.upStarAni.play("upStarAni","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_upStar_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.showRedPoint=function(){var t=e.SmeltController.getInstance().getUpStarOperateAry();if(void 0!=t){for(var i=t.length,n=0;n<this.itemList.length;n++)this.itemList[n].isShowRedPoint(!1);for(var n=0;i>n;n++){var o=t[n];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.upFun=function(t){if(30==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.SmeltController.getInstance().guideshow(),!this.model.upStarCfg[this.selectItemLevel+1])return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));if(this.selectItemLevel>this.model.roleLevel)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("LEVELNOTENOUGH"));if(this.model.currentStoneNums<this.needStoneNums)return void e.ItemNotEnoughController.getInstance().showPanel(this.model.stoneId);var i=this.model.upStarCfg[this.selectItemLevel+1];i=i?i:this.model.upStarCfg[this.selectItemLevel];var n=i.levelUpCost;if(n&&~~n[1][2]>this.model.playerInfo.getCoin()){var o=e.JsonDataManager.instance.itemTemplate,a=o[1002];return void e.ItemNotEnoughController.getInstance().showPanel(a.id)}this.lastSelectItem=this.model.singleCellInfo.getCellId();var s=HawkProtocolManager.newBuilder("JsProto.HPEquipCellUpLevel");s.setCellId(this.model.singleCellInfo.getCellId()),s.setType(3),s.setRoleId(this.model.roleId),e.Message.instance.send(e.Code.EQUIP_CELL_UPLEVEL_C,s,!0)},i.prototype.selectItem=function(e){void 0===e&&(e=0);for(var t=0;t<this.itemList.length;t++)this.itemList[t].setSelectedState(!1),this.itemList[t].showItemIcon("equipPartGray"+(t+1)+"_png");this.itemList[e].setSelectedState(!0),this.itemList[e].showItemIcon("equipPart"+(e+1)+"_png"),this.model.selectedIndex=e,this.model.singleCellInfo=this.model.cellInfos[e],this.showData()},i.prototype.checkRed=function(t){void 0===t&&(t=-1);var i=e.SmeltController.getInstance().getUpStarOperateAry();if(this.lastRoleId=this.model.roleId,void 0!=i){var n=i.length;if(n>0){var o=i.indexOf(t)>-1;o||this.selectItem(i[0])}}},i.prototype.showData=function(){this.showRedPoint(),this.lastRoleId&&this.model.roleId!=this.lastRoleId?this.checkRed():this.lastRoleId=this.model.roleId;for(var t=0;t<this.itemList.length;t++)null!=this.model.cellInfos[t]&&this.itemList[t].showItemLevel(this.model.cellInfos[t].getCellStartLevel(),!0);this.model.singleCellInfo=this.model.cellInfos[this.model.selectedIndex],this.selectItemLevel=this.model.singleCellInfo.getCellStartLevel(),this.level.text=this.selectItemLevel.toString(),this.levelGroup.width=this.staticLevelText.width+this.level.width;var i,n,o;0==this.selectItemLevel?(n=this.model.upStarCfg[this.selectItemLevel+1],o=e.GlobalUtil.calcFloat(n.addRate,100),this.baseValue.text=e.LanguageUtils.instance.getValue("BASEATTR")+"+0%",this.nextValue.text=e.LanguageUtils.instance.getValue("BASEATTR")+"+"+o+"%",this.needStoneNums=Number(n.levelUpCost[0][2]),this.diamondNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentStoneNums,this.needStoneNums),this.goldNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentGoldNums,Number(n.levelUpCost[1][2]))):this.selectItemLevel>0&&this.model.upStarCfg[this.selectItemLevel+1]?(i=this.model.upStarCfg[this.selectItemLevel],n=this.model.upStarCfg[this.selectItemLevel+1],o=e.GlobalUtil.calcFloat(n.addRate,100),this.baseValue.text=e.LanguageUtils.instance.getValue("BASEATTR")+"+"+e.GlobalUtil.calcFloat(i.addRate,100)+"%",this.nextValue.text=e.LanguageUtils.instance.getValue("BASEATTR")+"+"+o+"%",this.needStoneNums=Number(n.levelUpCost[0][2]),this.diamondNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentStoneNums,Number(n.levelUpCost[0][2])),this.goldNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.currentGoldNums,Number(n.levelUpCost[1][2]))):(i=this.model.upStarCfg[this.selectItemLevel],this.baseValue.text=e.LanguageUtils.instance.getValue("BASEATTR")+"+"+e.GlobalUtil.calcFloat(i.addRate,100)+"%",this.nextValue.text=e.LanguageUtils.instance.getValue("JICHUSHUXINGYIMAN"),this.diamondNums.text=e.LanguageUtils.instance.getValue("SMELTS_PRO7"),this.goldNums.text=e.LanguageUtils.instance.getValue("SMELTS_PRO7"),this.lastSelectItem&&this.lastSelectItem==this.model.singleCellInfo.getCellId())},i}(eui.Component);e.UpstarPanel_X=t,__reflect(t.prototype,"foxgame.UpstarPanel_X")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RedQuenchingVO=t,__reflect(t.prototype,"foxgame.RedQuenchingVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.itemTypeName=null,e.addList=null,e.bNeedReBuild=!1,e.guideNum=0,e.skinName="Smelt_Intensify",e.addList=[],e.maxLevel=200,e.itemTypeName=["武器","衣服","手镯","戒指","腰带","头盔","项链","手镯","戒指","鞋子"],e.initView(),e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initListener()},i.prototype.reExmlSkinCreate=function(){this.bNeedReBuild&&(this.bNeedReBuild=!1,this.removeChildren(),this.skinName=null,this.skinName="Smelt_Intensify",this.initView(),this.initListener())},i.prototype.init=function(t){this.roleInfo=t,this.roleId=this.roleInfo.roleId,this.roleLevel=e.PlayerService.instance.level,this.playerInfo=e.PlayerService.instance.playerInfo,this.upDataFunc()},i.prototype.initView=function(){this.strengthCfg=e.JsonDataManager.instance.strengthen,this.levelRateCfg=e.JsonDataManager.instance.strengthenLevelRate,this.qualityRateCfg=e.JsonDataManager.instance.strengthenQualityRate,this.aniGroup.touchEnabled=!1,this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9];for(var t=0,i=this.itemList.length,n=null;i>t;t++)n=this.itemList[t],n.index=t,n.setSelectedState(!1),n.setStar(!1,-3),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),n.showItemIcon("equipPartGray"+(t+1)+"_png");this.itemList[0].setSelectedState(!0),this.itemList[0].showItemIcon("equipPart1_png"),this.selectedIndex=0},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("intensifyAni","ani",1),this.aniGroup.visible=!0},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.upDataFunc=function(){if(e.WeaponSmeltController.getInstance().getPanel().getIsShow()&&e.WeaponSmeltController.getInstance().getCurrentSelectIndex()==e.WeaponTaps.QIANGHUA){this._cellInfos=this.roleInfo.getRoleEquipCellInfo().getCellInfos(),this.currentGoldNums=this.playerInfo.getCoin(),this.singleCellInfo=this._cellInfos[this.selectedIndex];for(var t=0,i=this.itemList.length;i>t;t++)null!=this._cellInfos[t]&&this.itemList[t].showItemLevel(this._cellInfos[t].getCellStrenthLevel());this.showData()}},i.prototype.showData=function(){this.addList=[],this.showRedPoint(),this.equipInfoByPart=this.roleInfo.getEquipInfoByPart(this.selectedIndex+1);var t=e.JsonDataManager.instance.equipTemplate;if(null==this.equipInfoByPart)this.addList=[1,1];else{var i=t[this.equipInfoByPart.getEquipId()],n=this.levelRateCfg[i.level];this.addList.push(n.rate);var o=this.qualityRateCfg[i.quality];this.addList.push(o.rate)}this.currentIntensifyStoneNums=e.BagController.getInstance().getCountByItemId(110007),this.selectItemLevel=this.singleCellInfo.getCellStrenthLevel(),this.currentLvel.text=this.selectItemLevel.toString(),this.levelGroup.width=this.staticLevelText.width+this.currentLvel.width;var a=[],s=[],r="",l=e.PlayerService.instance.playerInfo;if(0==this.selectItemLevel){var h=this.strengthCfg[this.selectItemLevel+1];r=h["propertiesCloaks"+(this.selectedIndex+1)],this.intensify_p.text="当前:0\n\n下级:"+e.LanguageUtils.instance.getValue("ATT_"+r[0])+"+"+~~(~~r[1]*this.addList[0]*this.addList[1]).toString(),a=h.levelUpCost;var c=Number(a[2]);this.num0.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentIntensifyStoneNums,c),s=h.goldCost;var u=Number(s[2]);this.num1.textFlow=e.GlobalUtil.createMaterialProTextFlow(l.getCoin(),u)}else if(this.selectItemLevel>0&&this.selectItemLevel<this.maxLevel){var h=this.strengthCfg[this.selectItemLevel],p=this.strengthCfg[this.selectItemLevel+1];r=p["propertiesCloaks"+(this.selectedIndex+1)];var g=h["propertiesCloaks"+(this.selectedIndex+1)];this.intensify_p.text="当前:"+e.LanguageUtils.instance.getValue("ATT_"+g[0])+"+"+~~(~~g[1]*this.addList[0]*this.addList[1]).toString()+"\n\n下级:"+e.LanguageUtils.instance.getValue("ATT_"+r[0])+"+"+~~(~~r[1]*this.addList[0]*this.addList[1]).toString(),a=p.levelUpCost;var c=Number(a[2]);this.num0.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentIntensifyStoneNums,c),s=p.goldCost;var u=Number(s[2]);this.num1.textFlow=e.GlobalUtil.createMaterialProTextFlow(l.getCoin(),u)}else{var h=this.strengthCfg[this.selectItemLevel],g=h["propertiesCloaks"+(this.selectedIndex+1)];this.intensify_p.text="当前:"+e.LanguageUtils.instance.getValue("ATT_"+g[0])+"+"+~~(~~g[1]*this.addList[0]*this.addList[1])+"\n\n下级:已满",this.num0.text="已满",this.num1.text="已满"}},i.prototype.showRedPoint=function(){var t=e.WeaponSmeltController.getInstance().getIntensifyOperateAry();if(void 0!=t){for(var i=t.length,n=0;n<this.itemList.length;n++)this.itemList[n].isShowRedPoint(!1);for(var n=0;i>n;n++){var o=t[n];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=this.itemList.length,n=0,o=null;i>n;n++)o=this.itemList[n],o.setSelectedState(!1),o.showItemIcon("equipPartGray"+(n+1)+"_png");o=this.itemList[t],o.setSelectedState(!0),o.showItemIcon("equipPart"+(t+1)+"_png"),this.selectedIndex=t,this.singleCellInfo=this._cellInfos[t],this.showData()},i.prototype.initListener=function(){e.Message.instance.add(e.Code.EQUIP_CELL_SYNC,this),e.Message.instance.add(e.Code.EQUIP_CELL_ONE_KEY_S_VALUE,this),this.intensifyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickFun,this),this.onKeyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onKeyIntensify,this)},i.prototype.onKeyIntensify=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEquipsCellUP");t.setRoleId(this.roleId),e.Message.instance.send(e.Code.EQUIP_CELL_ONE_KEY_C,t,!0)},i.prototype.clickFun=function(t){if(this.selectItemLevel==this.maxLevel)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));if(this.selectItemLevel>=this.roleLevel)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("INTENIFYMAXLIMIT"));var i=e.PlayerService.instance.playerInfo,n=this.strengthCfg[this.selectItemLevel+1],o=n.levelUpCost;if(this.currentIntensifyStoneNums=e.BagController.getInstance().getCountByItemId(110007),this.currentIntensifyStoneNums<Number(o[2]))return this.guideNum=5,this.hideGuide(),e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("QIANGHUASHIBUZU")),void e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT);var a=i.coin,s=n.goldCost;if(a<Number(s[2])){this.guideNum=5,this.hideGuide();var r=e.JsonDataManager.instance.itemTemplate,l=r[1002];return void e.ItemNotEnoughController.getInstance().showPanel(l.id)}this.hideGuide();var h=HawkProtocolManager.newBuilder("JsProto.HPEquipCellUpLevel");h.setCellId(this.singleCellInfo.getCellId()),h.setType(1),h.setRoleId(this.roleId),e.Message.instance.send(e.Code.EQUIP_CELL_UPLEVEL_C,h,!0)},i.prototype.hideGuide=function(){},i.prototype.recvMsg=function(t,i){switch(t){case e.Code.EQUIP_CELL_SYNC:this.roleId==i.roleId&&(this.playAni(),this.itemList[this.selectedIndex].playAni(),this.roleInfo.setRoleEquipCellInfo(i),this.upDataFunc(),App.SoundManager().playEffect("sound_intensify_mp3"),e.MainBottomControler.instance.refreshWeaponIconOperate());break;case e.Code.EQUIP_CELL_ONE_KEY_S_VALUE:var n="";switch(i.getErrorNo()){case 1:n=e.LanguageUtils.instance.getValue("QIANGHUASHIBUZU");break;case 2:n=e.LanguageUtils.instance.getValue("JINBIBUZU");break;case 3:n=e.LanguageUtils.instance.getValue("YIMANJI");break;case 4:n=e.LanguageUtils.instance.getValue("INTENIFYMAXLIMIT")}e.GameUtils.MSG_TIP(n)}},i.prototype.dispose=function(){e.Message.instance.remove(e.Code.EQUIP_CELL_SYNC,this),this.intensifyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickFun,this);for(var t=0,i=this.itemList.length,n=null;i>t;t++)n=this.itemList[t],n.index=t,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),n.showItemIcon("equipPartGray"+(t+1)+"_png"),n.setSelectedState(!1)},i}(eui.Component);e.IntensifyPanel=t,__reflect(t.prototype,"foxgame.IntensifyPanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.PartStarUpgradeVO=t,__reflect(t.prototype,"foxgame.PartStarUpgradeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.isSelected=!1,t.skinName="Smelt_CheckBox",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initListener()},t.prototype.initListener=function(){},t}(eui.Component);e.SmeltCheckBox=t,__reflect(t.prototype,"foxgame.SmeltCheckBox")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="Smelt_EquipItem",t}return __extends(t,e),t.prototype.setItem=function(e){this.itemIcon.setItem(e,-1,!1,!1)},t.prototype.setLevel=function(e){""==e?(this.level.text=e,this.starBgId.visible=!1):(this.level.text="Lv"+e,this.starBgId.visible=!0)},t.prototype.setIsShowBg=function(e){this.imgBg.visible=e},t.prototype.setQueneLevelProps=function(e){this.itemIcon.setQueneLevelProps(e)},t}(eui.Component);e.SmeltEquipItem=t,__reflect(t.prototype,"foxgame.SmeltEquipItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="SmeltItemCell",t}return __extends(t,e),t.prototype.setItemIcon=function(e){this.itemIcon.source=e},t.prototype.setUpLevel=function(e){this.upLevel.text=e},t.prototype.setItemCount=function(e){this.itemCount.text=e},Object.defineProperty(t.prototype,"itemData",{set:function(e){this.data=e},enumerable:!0,configurable:!0}),t}(eui.Button);e.SmeltItemCell=t,__reflect(t.prototype,"foxgame.SmeltItemCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SmeltItemSkin",e}return __extends(i,t),i.prototype.init=function(){this.level.touchEnabled=!1,this.starLevel.text="",this.starBgId.visible=!0},i.prototype.initData=function(e){this.itemObj=e,this.showItem()},i.prototype.playAni=function(){this.sucessAni&&(this.sucessAni.clear(),this.sucessAni=null),void 0==this.sucessAni&&(this.sucessAni=new e.FoxAni(this.aniGroup),this.sucessAni.setPlayComplete(this.playComplete,this),this.sucessAni.play("forgeSuccess","ani",1))},i.prototype.playComplete=function(){this.sucessAni&&(this.sucessAni.clear(),this.sucessAni=null)},i.prototype.createChildren=function(){t.prototype.createChildren.call(this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},i.prototype.setSelectedState=function(e){this.selectedImage.visible=e},i.prototype.showItem=function(){},i.prototype.setPoint=function(){this.ntPoint.setData("global_tips_tishidian_png"),this.ntPoint.scaleX=.8,this.ntPoint.scaleY=.8},i.prototype.setStar=function(e,t){void 0===t&&(t=-3),this.starId.visible=this.starBgId.visible=e,this.starId.y=t,this.starBgId.y=t-5},i.prototype.isShowRedPoint=function(e){void 0===e&&(e=!1),this.redPoint.visible=e},i.prototype.showItemIcon=function(e){this.cell.setItemIcon(e)},i.prototype.showItemLevel=function(e,t){void 0===t&&(t=!1),t?this.level.text=e+"":this.level.text=e+""},Object.defineProperty(i.prototype,"setstarBgId",{set:function(e){this.starBgId.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"intensifyValue",{set:function(e){this.intensifyNums=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"goldValue",{set:function(e){this.goldNums=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"diamondValue",{set:function(e){this.diamondNums=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tabValue",{set:function(e){this.currentTab=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"index",{set:function(e){this.idx=e},enumerable:!0,configurable:!0}),i}(eui.Component);e.SmeltItemSkin=t,__reflect(t.prototype,"foxgame.SmeltItemSkin")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="SmeltNeedButton",t}return __extends(t,e),t}(eui.Component);e.SmeltNeedButton=t,__reflect(t.prototype,"foxgame.SmeltNeedButton")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="Smelt_WeaponItemCell",e.touchChildren=!1,e}return __extends(i,t),i.prototype.restore=function(){this.isShowRedPoint(!1),this.setQualityIconVisible(!1),this.setSelectedState(!1),this.setLevelBg(!1),this.setLevel(""),this.setItemStar(""),this.setItemLevel(""),this.setQualityIcon("6"),this.setItemIcon(1),this.setlevel1(""),this.setNameEvolve("-1"),this.setQueneAni("-1"),this.queneMc&&(this.queneMc.clear(),this.queneMc=null),this.data=null},i.prototype.setlevel1=function(t){""==t?this.level1.text=t:this.level1.text=t+e.LanguageUtils.instance.getValue("JI")},i.prototype.setQueneAni=function(t){return"-1"==t?void(this.group_queneAni.visible=!1):(this.group_queneAni.visible=!0,this.queneMc||(this.queneMc=new e.FoxAni(this.group_queneAni)),this.queneMc.play("fx_"+t,"ani"),void this.itemIcon.setShowQualityGroup(!1))},i.prototype.setNameEvolve=function(e){return"-1"==e?void(this.nameEvolve.visible=!1):(this.nameEvolve.visible=!0,void(this.nameEvolve.source="icon_"+e+"_png"))},i.prototype.setItemIcon=function(e){this.itemIcon.setItem(e,-1,!1,!1)},i.prototype.setItemIconfashion=function(e){this.itemIcon.seticonImg=e},i.prototype.setLevelBg=function(e){this.levelBg.visible=e},i.prototype.setSelectedState=function(e){this.selectedImage.visible=e},i.prototype.getselectedImage=function(){return this.selectedImage.visible},i.prototype.setItemLevel=function(t){""==t?this.itemLevel.text=t:this.itemLevel.text=e.LanguageUtils.instance.getValue("LEVEL")+t},i.prototype.setItemIconname=function(e){this.itemIcon.setItem(e,-1,!0,!1)},i.prototype.setLevel=function(e){""==e?this.level.text=e:this.level.text=e},i.prototype.setItemStar=function(t){""==t?this.num.text=t:this.num.text=t+e.LanguageUtils.instance.getValue("XING")},i.prototype.isShowRedPoint=function(e){void 0===e&&(e=!1),this.redPoint.visible=e},i.prototype.showItemType=function(e){this.itemType.text=e},i.prototype.setQualityIcon=function(e){this.qualityIcon.source="0000"+e+"_png"},i.prototype.setQualityIconVisible=function(e){this.qualityIcon.visible=e},Object.defineProperty(i.prototype,"itemData",{set:function(e){this.data=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_itemData",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Index",{set:function(e){this.idx=e},enumerable:!0,configurable:!0}),i}(eui.Button);e.SmeltWeaponItemCell=t,__reflect(t.prototype,"foxgame.SmeltWeaponItemCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.StrengthenVO=t,__reflect(t.prototype,"foxgame.StrengthenVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.upStarMaxLevel=50,e.itemTypeName=["武器","衣服","手镯","戒指","腰带","头盔","项链","手镯","戒指","鞋子"],e.stoneId=110010,e.bNeedReBuild=!1,e.skinName="Smelt_UpStar",e.initView(),e.initListener(),e}return __extends(i,t),i.prototype.reExmlSkinCreate=function(){this.bNeedReBuild&&(this.bNeedReBuild=!1,this.removeChildren(),this.skinName=null,this.skinName="Smelt_UpStar",this.initView(),this.initListener())},i.prototype.init=function(t){this.roleInfo=t,this.roleId=this.roleInfo.roleId,this.playerInfo=e.PlayerService.instance.playerInfo,this.roleLevel=e.PlayerService.instance.level,this.upDataFunc()},i.prototype.initView=function(){this.upStarCfg=e.JsonDataManager.instance.partStarUpgrade,this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9];for(var t=0,i=this.itemList.length,n=null;i>t;t++)n=this.itemList[t],n.index=t,n.setStar(!0,-3),n.setSelectedState(!1),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),n.showItemIcon("equipPartGray"+(t+1)+"_png");this.itemList[0].setSelectedState(!0),this.itemList[0].showItemIcon("equipPart1_png"),this.selectedIndex=0},i.prototype.playAni=function(){this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null),this.upStarAni=new e.FoxAni(this.aniGroup),this.upStarAni.setPlayComplete(this.playComplete,this),this.upStarAni.play("upStarAni","ani",1),this.aniGroup.visible=!0,App.SoundManager().playEffect("sound_upStar_mp3")},i.prototype.playComplete=function(){this.aniGroup.visible=!1},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0;i<this.itemList.length;i++)this.itemList[i].setSelectedState(!1),this.itemList[i].showItemIcon("equipPartGray"+(i+1)+"_png");this.itemList[t].setSelectedState(!0),this.itemList[t].showItemIcon("equipPart"+(t+1)+"_png"),this.selectedIndex=t,this.singleCellInfo=this._cellInfos[t],this.showData()},i.prototype.upDataFunc=function(){this._cellInfos=this.roleInfo.getRoleEquipCellInfo().getCellInfos(),this.singleCellInfo=this._cellInfos[this.selectedIndex];for(var e=0;e<this.itemList.length;e++)null!=this._cellInfos[e]&&this.itemList[e].showItemLevel(this._cellInfos[e].getCellStartLevel(),!0);this.showData()},i.prototype.showData=function(){this.showRedPoint(),this.currentStoneNums=e.BagController.getInstance().getCountByItemId(this.stoneId),this.currentGoldNums=e.PlayerService.instance.playerInfo.getCoin(),this.selectItemLevel=this.singleCellInfo.getCellStartLevel(),this.level.text=this.selectItemLevel.toString(),this.levelGroup.width=this.staticLevelText.width+this.level.width;var t,i,n;0==this.selectItemLevel?(i=this.upStarCfg[this.selectItemLevel+1],n=e.GlobalUtil.calcFloat(i.addRate,100),this.baseValue.text="基础属性+0%",this.nextValue.text="基础属性+"+n+"%",this.needStoneNums=Number(i.levelUpCost[0][2]),this.diamondNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentStoneNums,this.needStoneNums),this.goldNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentGoldNums,Number(i.levelUpCost[1][2]))):this.selectItemLevel>0&&this.selectItemLevel<this.upStarMaxLevel?(t=this.upStarCfg[this.selectItemLevel],i=this.upStarCfg[this.selectItemLevel+1],n=e.GlobalUtil.calcFloat(i.addRate,100),this.baseValue.text="基础属性+"+e.GlobalUtil.calcFloat(t.addRate,100)+"%",this.nextValue.text="基础属性+"+n+"%",this.needStoneNums=Number(i.levelUpCost[0][2]),this.diamondNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentStoneNums,Number(i.levelUpCost[0][2])),this.goldNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.currentGoldNums,Number(i.levelUpCost[1][2]))):(t=this.upStarCfg[this.selectItemLevel],this.baseValue.text="基础属性+"+e.GlobalUtil.calcFloat(t.addRate,100)+"%",this.nextValue.text="基础属性:已满",this.diamondNums.text="已满",this.goldNums.text="已满")},i.prototype.showRedPoint=function(){var t=e.WeaponSmeltController.getInstance().getUpStarOperateAry();if(void 0!=t){for(var i=t.length,n=0;n<this.itemList.length;n++)this.itemList[n].isShowRedPoint(!1);for(var n=0;i>n;n++){var o=t[n];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.initListener=function(){e.Message.instance.add(e.Code.EQUIP_CELL_SYNC,this),this.upStarBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upFun,this)},i.prototype.upFun=function(t){if(this.selectItemLevel==this.upStarMaxLevel)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIMANJI"));
if(this.selectItemLevel>this.roleLevel)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("LEVELNOTENOUGH"));if(this.currentStoneNums<this.needStoneNums)return void e.ItemNotEnoughController.getInstance().showPanel(this.stoneId);var i=this.upStarCfg[this.selectItemLevel+1];i=i?i:this.upStarCfg[this.selectItemLevel];var n=i.levelUpCost;if(n&&~~n[1][2]>this.playerInfo.getCoin()){var o=e.JsonDataManager.instance.itemTemplate,a=o[1002];return void e.ItemNotEnoughController.getInstance().showPanel(a.id)}var s=HawkProtocolManager.newBuilder("JsProto.HPEquipCellUpLevel");s.setCellId(this.singleCellInfo.getCellId()),s.setType(3),s.setRoleId(this.roleId),e.Message.instance.send(e.Code.EQUIP_CELL_UPLEVEL_C,s,!0)},i.prototype.recvMsg=function(t,i){t==e.Code.EQUIP_CELL_SYNC&&this.roleId==i.roleId&&(this.playAni(),this.itemList[this.selectedIndex].playAni(),this.roleInfo.setRoleEquipCellInfo(i),this.upDataFunc(),e.MainBottomControler.instance.refreshWeaponIconOperate())},i.prototype.dispose=function(){e.Message.instance.remove(e.Code.EQUIP_CELL_SYNC,this),this.upStarBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.upFun,this);for(var t=0;t<this.itemList.length;t++)this.itemList[t].index=t,this.itemList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),this.itemList[t].showItemIcon("equipPartGray"+(t+1)+"_png"),this.itemList[t].setSelectedState(!1)},i}(eui.Component);e.UpStarPanel=t,__reflect(t.prototype,"foxgame.UpStarPanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.maxLevel=200,e.bNeedReBuild=!1,e.skinName="Smelt_EquipUp",e.initView(),e.initListener(),e}return __extends(i,t),i.prototype.reExmlSkinCreate=function(){this.bNeedReBuild&&(this.bNeedReBuild=!1,this.removeChildren(),this.skinName=null,this.skinName="Smelt_EquipUp",this.initView(),this.initListener())},i.prototype.init=function(e){this.roleInfo=e,this.roleId=this.roleInfo.roleId,this.initData()},i.prototype.initView=function(){this.equipmentUpgradeCfg=e.JsonDataManager.instance.equipmentUpgradeTemplate,this.vipSend.textFlow=[{text:"1、VIP赠送",style:{textColor:65280,fontFamily:"楷体",underline:!0}}],this.xunbao.textFlow=[{text:"2、寻宝",style:{textColor:65280,fontFamily:"楷体",underline:!0}}],this.buyLimit.textFlow=[{text:"3、每日限购活动",style:{textColor:65280,fontFamily:"楷体",underline:!0}}],this.itemTypeName=["武器","衣服","手镯","戒指","腰带","头盔","项链","手镯","戒指","鞋子"],this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9],this.upItemList=[this.item0,this.item1,this.item2];for(var t=0,i=this.itemList.length,n=null;i>t;)n=this.itemList[t],n.Index=t,n.setLevel(""),n.setItemStar(""),n.setItemLevel(""),n.showItemType(this.itemTypeName[t]),n.setSelectedState(!1),n.setLevelBg(!1),n.setQualityIconVisible(!1),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this),t++;for(t=0,i=this.upItemList.length;i>t;)this.upItemList[t].setLevel(""),t++;this.upItemCell.setLevel(""),this.setGroupVisible(!1)},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0,n=this.itemList.length,o=null;n>i;)o=this.itemList[i],o.setSelectedState(!1),i++;this.currentSelectedIndex=t,this.showSelectEquipInfo()},i.prototype.initData=function(){this.showRedPoint(),this.roleLevel=e.PlayerService.instance.level,this.playerInfo=e.PlayerService.instance.playerInfo,this.currentGoldNums=this.playerInfo.getCoin(),this.equipList=this.roleInfo.getRoleEquipsForCS(),this.cellInfoList=this.roleInfo.getRoleEquipCellInfo().getCellInfos();for(var t=e.JsonDataManager.instance.equipTemplate,i=0;i<this.equipList.length;i++)if(null!=this.equipList[i]){var n=this.equipList[i].getPart()-1,o=t[this.equipList[i].getEquipItemId()];this.itemList[n].setItemIcon(o.id),this.itemList[n].showItemType(""),this.itemList[n].setSelectedState(!1),this.itemList[n].setQualityIconVisible(!0),this.itemList[n].setLevelBg(!0),this.itemList[n].setItemLevel(o.level.toString()),this.itemList[n].setLevel(this.cellInfoList[n].getCellStrenthLevel().toString()),this.itemList[n].setItemStar(this.cellInfoList[n].getCellStartLevel().toString()),this.itemList[n].setQualityIcon(o.quality.toString())}void 0==this.currentSelectedIndex&&(this.currentSelectedIndex=this.getSelectIndex()),-1!=this.currentSelectedIndex&&this.itemList[this.currentSelectedIndex].setSelectedState(!0),this.showSelectEquipInfo()},i.prototype.showRedPoint=function(){var t=e.WeaponSmeltController.getInstance().getWeaponUpOperateAry();if(void 0!=t){for(var i=0;i<this.itemList.length;i++)this.itemList[i].isShowRedPoint(!1);for(var n=t.length,i=0;n>i;i++){var o=t[i];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.getSelectIndex=function(){for(var t,i=-1,n=e.JsonDataManager.instance.equipTemplate,o=0;o<this.equipList.length;o++)if(null!=this.equipList[o]){t=!0;var a=n[this.equipList[o].getEquipItemId()];if(a.level<this.maxLevel)return this.equipList[o].getPart()-1}return t?i:0},i.prototype.initMaskAndTweenState=function(){this.topMask.width=0,this.leftMask.width=0,this.rightMask.width=0,TweenMax.killTweensOf(this.leftMask),TweenMax.killTweensOf(this.rightMask),TweenMax.killTweensOf(this.topMask)},i.prototype.setAniAndTween=function(){this.leftAni&&(this.leftAni.clear(),this.leftAni=null),void 0==this.leftAni&&(this.leftAni=new e.FoxAni(this.leftAniGroup),this.leftAni.play("weapupEffect"),this.leftAniGroup.mask=this.leftMask),this.rightAni&&(this.rightAni.clear(),this.rightAni=null),void 0==this.rightAni&&(this.rightAni=new e.FoxAni(this.rightAniGroup),this.rightAni.play("weapupEffect"),this.rightAniGroup.mask=this.rightMask),this.topAni&&(this.topAni.clear(),this.topAni=null),void 0==this.topAni&&(this.topAni=new e.FoxAni(this.topAniGroup),this.topAni.play("weapupEffect"),this.topAniGroup.mask=this.topMask),TweenMax.to(this.leftMask,.5,{width:this.leftAniGroup.width}),TweenMax.to(this.rightMask,.5,{width:this.rightAniGroup.width,onComplete:function(){TweenMax.to(this.topMask,.5,{width:this.topAniGroup.width})}.bind(this)})},i.prototype.showSelectEquipInfo=function(){this.initMaskAndTweenState();for(var t,i=0;i<this.equipList.length;i++)if(this.equipList[i].getPart()==this.currentSelectedIndex+1){t=this.equipList[i];break}if(null!=t){var n=e.JsonDataManager.instance.equipTemplate,o=n[t.getEquipItemId()];o.level<this.maxLevel&&this.setAniAndTween(),this.currentSelectedEquipCfg=o,this.noEquip.visible=!1,this.downGroup.visible=!0,this.upGroup.visible=!0,this.item0.visible=!0,this.item0.setItem(o.id),this.item0.setLevel(o.level.toString()),this.itemName.text=o.name,this.condition2=o.level>=this.maxLevel;for(var a=this.equipmentUpgradeCfg[o.id].costList,s=e.JsonDataManager.instance.itemTemplate,i=0;i<a.length;i++)if(a[i].id==e.AttributeType.COIN||a[i].id==e.AttributeType.DIAMOND||a[i].id==e.AttributeType.EXP){this.condition0=!(this.currentGoldNums<a[i].value);var r=s[a[i].id];this.goldName.text=r.name,this.item1.visible=!0,this.item1.setItem(r.id);var l=a[i].value;this.goldNums.textFlow=this.createTextFlow(this.currentGoldNums,l)}else if(o.level<this.maxLevel){var h=e.BagController.getInstance().getCountByItemId(a[i].id);this.propNums.textFlow=e.GlobalUtil.createMaterialProTextFlow(h,a[i].value,1),this.condition1=!(h<a[i].value),this.propVO=s[a[i].id],this.propName.text=this.propVO.name,this.item2.visible=!0,this.item2.setItem(this.propVO.id);break}if(this.upItemName.text="",o.level<this.maxLevel){var c=o.id+1,u=n[c];this.upItemCell.visible=!0,this.item0.visible=!0,this.item1.visible=!0,this.item2.visible=!0,this.upItemCell.setItem(u.id),this.upItemCell.setLevel(u.level.toString()),this.upItemName.text=u.name;for(var p="",i=0,g=u.attrTypeList.length;g>i;i++){var d=this.getLableColor(u.attrTypeList[i]);p+="<font color ="+d+" >"+e.LanguageUtils.instance.getValue("ATT_"+u.attrTypeList[i].toString())+"："+u.attrValueList[i].toString()+"+???\n</font>"}this.intensify_p0.textFlow=(new egret.HtmlTextParser).parser(p);var f="",m=e.BagController.getInstance().getEquipInfoById(t.getEquipId());this.bestPropertys=m.getAttrInfos();var y=void 0,I=void 0,v=0,_=0;for(i=0,g=this.bestPropertys.length;g>i;)y=this.bestPropertys[i],2==y.getAttrGrade()&&(v=y.getAttrData().getAttrId(),_=y.getAttrData().getAttrValue(),I=e.LanguageUtils.instance.getValue("ATT_"+v),I+=":"+e.GlobalUtil.getAttrValueStr(v,_),f+="<font color ="+e.ColorUtils.instance.getAttrColorById(v)+" >"+I+"\n</font>"),i++;this.intensify_p1.textFlow=(new egret.HtmlTextParser).parser(f)}else{this.intensify_p0.text=this.intensify_p1.text="已满级",this.propNums.text=this.propName.text=this.goldNums.text=this.goldName.text=this.itemNum.text=this.itemName.text="",this.upItemCell.visible=!1;var T=void 0;for(i=0,g=3;g>i;)T=this["item"+i],T.visible=!1,T.setLevel(""),i++;this.upItemCell.setLevel("")}this.itemList[t.getPart()-1].setSelectedState(!0),this.itemList[t.getPart()-1].setItemIcon(t.getEquipItemId())}else{for(this.currentSelectedEquipCfg=null,this.noEquip.visible=!0,this.downGroup.visible=!1,i=0;i<this.upItemList.length;i++)this.upItemList[i].visible=!1,this.upItemList[i].setLevel("");this.upItemCell.visible=!1,this.upItemCell.setLevel(""),this.setGroupVisible(!1),this.condition0=!1,this.condition1=!1,this.condition2=!1}this.currentSelectedIndex>=0&&this.itemList[this.currentSelectedIndex].setSelectedState(!0)},i.prototype.createTextFlow=function(e,t){var i;i=e>=t?65280:16711680;var n=[{text:"(",style:{textColor:16777215}},{text:t+"",style:{textColor:i}},{text:")",style:{textColor:16777215}}];return n},i.prototype.clickItemFun=function(e){for(var t=0,i=this.itemList.length;i>t;)this.itemList[t].setSelectedState(!1),t++},i.prototype.initListener=function(){e.Message.instance.add(e.Code.EQUIP_EVOLUTION_S,this),this.upBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickFun,this),this.vipSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.buyLimit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.vipSend:e.CreateNewVipController.instance.showPanel();break;case this.xunbao:e.SearchTreasureController.getInstance().showPanel();break;case this.buyLimit:e.ActivityController.getIntance().showPanel()}},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.item0.setIsShowBg(!1),this.item1.setIsShowBg(!1),this.item2.setIsShowBg(!1),this.upItemCell.setIsShowBg(!1)},i.prototype.clickFun=function(t){for(var i,n=0;n<this.equipList.length;n++)if(this.equipList[n].getPart()==this.currentSelectedIndex+1){i=!0;break}if(this.condition2)return void e.PopUpController.getInstance().showFloatTextPanel1("当前位置神装已达最大等级");if(!i)return void e.PopUpController.getInstance().showFloatTextPanel1("当前位置没有穿戴神装");if(0==this.condition0){var o=e.JsonDataManager.instance.itemTemplate,a=o[1002];return void e.ItemNotEnoughController.getInstance().showPanel(a.id)}if(0==this.condition1)return void e.ItemNotEnoughController.getInstance().showPanel(this.propVO.id);for(var s,n=0;n<this.equipList.length;n++)if(this.equipList[n].getPart()==this.currentSelectedIndex+1){s=this.equipList[n];break}this.currentSelectPart=s.getPart();var r=HawkProtocolManager.newBuilder("JsProto.HPEquipEvolution");r.setEquipId(s.getEquipId()),r.setRefRareAtt(this.checkBoxBtn.selected),e.Message.instance.send(e.Code.EQUIP_EVOLUTION_C,r,!0)},i.prototype.setGroupVisible=function(e){this.upGroup.visible=e},i.prototype.recvMsg=function(t,i){if(t==e.Code.EQUIP_EVOLUTION_S){if(0!=i.getErrorNo())return void e.GlobalUtil.showErrorCodeMsg(i.getErrorNo());this.init(this.roleInfo)}},i.prototype.updateUpPart=function(){this.showSelectEquipInfo();for(var t=e.JsonDataManager.instance.equipTemplate,i=0;i<this.equipList.length;i++)if(this.equipList[i].getPart()==this.currentSelectPart){var n=t[this.equipList[i].getEquipId()];break}var o=this.currentSelectPart-1;this.itemList[o].setItemIcon(n.id),this.itemList[o].showItemType(""),this.itemList[o].setSelectedState(!0),this.itemList[o].setQualityIconVisible(!0),this.itemList[o].setItemLevel(n.level.toString()),this.itemList[o].setLevel(this.cellInfoList[i].getCellStrenthLevel().toString()),this.itemList[o].setItemStar(this.cellInfoList[i].getCellStartLevel().toString()),this.itemList[o].setQualityIcon(n.quality.toString())},i.prototype.getLableColor=function(t){return e.ColorUtils.instance.getAttrColorById(t).toString()},i.prototype.dispose=function(){this.leftAni&&(this.leftAni.clear(),this.leftAni=null),this.rightAni&&(this.rightAni.clear(),this.rightAni=null),this.topAni&&(this.topAni.clear(),this.topAni=null)},i}(eui.Component);e.WeaponUpPanel=t,__reflect(t.prototype,"foxgame.WeaponUpPanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="XiLianBasePCSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.additionText.text=""},i.prototype.initData=function(t,i,n,o,a){function s(i,o){return e.GlobalUtil.getAttrValueStr(t,Number(n))}var r=e.ColorUtils.instance.getAttrColorById(t).toString(),l=e.LanguageUtils.instance.getValue("ATT_"+t)+":",h="<font color ="+r+" >"+l+"</font>";this.attMsg.textFlow=(new egret.HtmlTextParser).parser(h),this.valueProgress.maximum=o,this.valueProgress.minimum=0,this.additionText.text="",this.valueProgress.value=n,this.valueProgress.labelFunction=s,0==a||"0%"==a||(-1==String(a).indexOf("-")?this.additionText.text="+"+a:this.additionText.text=a)},i}(eui.Component);e.WeaponUpXilLianBPCell=t,__reflect(t.prototype,"foxgame.WeaponUpXilLianBPCell")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.currentSelectedIndex=0,e.baseCellList=[],e.jpCellList=[],e.bNeedReBuild=!1,e.skinName="WeaponXiLian",e.initView(),e.initListener(),e}return __extends(i,t),i.prototype.reExmlSkinCreate=function(){this.bNeedReBuild&&(this.bNeedReBuild=!1,this.removeChildren(),this.skinName=null,this.skinName="WeaponXiLian",this.initView(),this.initListener())},i.prototype.init=function(t){this.roleInfo=t,this.roleId=this.roleInfo.roleId,this.roleLevel=e.PlayerService.instance.level,this.playerInfo=e.PlayerService.instance.playerInfo,this.initData()},i.prototype.initData=function(){this.lastAttrs=null,this.equipList=this.roleInfo.getRoleEquipsForCS(),this.cellInfoList=this.roleInfo.getRoleEquipCellInfo().getCellInfos();for(var t=e.JsonDataManager.instance.equipTemplate,i=0;i<this.equipList.length;i++)if(null!=this.equipList[i]){var n=this.equipList[i].getPart()-1,o=t[this.equipList[i].getEquipItemId()];this.itemList[n].setItemIcon(o.id),this.itemList[n].showItemType(""),this.itemList[n].setSelectedState(!1),this.itemList[n].setQualityIconVisible(!0),this.itemList[n].setLevelBg(!0),this.itemList[n].setItemLevel(o.level.toString()),this.itemList[n].setLevel(this.cellInfoList[n].getCellStrenthLevel().toString()),this.itemList[n].setItemStar(this.cellInfoList[n].getCellStartLevel().toString()),this.itemList[n].setQualityIcon(o.quality.toString())}this.currentSelectedIndex=this.getSelectIndex(),-1!=this.currentSelectedIndex&&this.itemList[this.currentSelectedIndex].setSelectedState(!0),this.showSelectEquipInfo(),this.showPropInfo()},i.prototype.upDataFunc=function(){this.showPropInfo()},i.prototype.showPropInfo=function(){var t=e.JsonDataManager.instance.itemTemplate;if("30000"==this.prop0.split("_")[0]){this.prop1VO=t[parseInt(this.prop0.split("_")[1])];var i=e.BagController.getInstance().getCountByItemId(parseInt(this.prop0.split("_")[1])),n=Number(this.prop0.split("_")[2]);i<parseInt(this.prop0.split("_")[2])?(this.condition1=!1,this.prop_0.textFlow=e.GlobalUtil.createMaterialProTextFlow(i,n)):(this.condition1=!0,this.prop_0.textFlow=e.GlobalUtil.createMaterialProTextFlow(i,n))}if("30000"==this.prop1.split("_")[0]){this.prop2VO=t[parseInt(this.prop1.split("_")[1])];var o=e.BagController.getInstance().getCountByItemId(parseInt(this.prop1.split("_")[1])),n=Number(this.prop1.split("_")[2]);o<parseInt(this.prop1.split("_")[2])?(this.condition2=!1,this.prop_1.textFlow=e.GlobalUtil.createMaterialProTextFlow(o,n)):(this.condition2=!0,this.prop_1.textFlow=e.GlobalUtil.createMaterialProTextFlow(o,n))}},i.prototype.getSelectIndex=function(){for(var e,t=-1,i=0;i<this.equipList.length;i++)if(null!=this.equipList[i])return e=!0,this.equipList[i].getPart()-1;return e?t:0},i.prototype.initView=function(){this.prop0=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_1"),this.prop1=e.GlobalConfig.instance.getValue("EQUIP_BAPTIZE_COST_2"),this.jpCfg=e.JsonDataManager.instance.rareAttrTemplate,this.vipSend.textFlow=(new egret.HtmlTextParser).parser("<font><u>1、VIP赠送</u></font>"),this.xunbao.textFlow=(new egret.HtmlTextParser).parser("<font><u>2、寻宝</u></font>"),this.buyLimit.textFlow=(new egret.HtmlTextParser).parser("<font><u>3、每日限购活动</u></font>"),this.itemTypeName=["武器","衣服","手镯","戒指","腰带","头盔","项链","手镯","戒指","鞋子"],this.itemList=[this.cell0,this.cell1,this.cell2,this.cell3,this.cell4,this.cell5,this.cell6,this.cell7,this.cell8,this.cell9];for(var t=0;t<this.itemList.length;t++)this.itemList[t].Index=t,this.itemList[t].setLevel(""),this.itemList[t].setItemStar(""),this.itemList[t].setItemLevel(""),this.itemList[t].showItemType(this.itemTypeName[t]),this.itemList[t].setSelectedState(!1),this.itemList[t].setLevelBg(!1),this.itemList[t].setQualityIconVisible(!1),this.itemList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this)},i.prototype.initListener=function(){e.Message.instance.add(e.Code.EQUIP_BAPTIZE_S,this),this.xilianBtn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xilianBtn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.vipSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.xunbao.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.buyLimit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){var i=this;switch(t.target){case this.xilianBtn_0:if(null==this.currentSelectedRoleEquip)return void e.PopUpController.getInstance().showFloatTextPanel1("当前位置没有穿戴神装");if(!this.condition1)return void e.ItemNotEnoughController.getInstance().showPanel(this.prop1VO.id);e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("WEAPONXILIANPANELTIP"),this,function(t){var n=HawkProtocolManager.newBuilder("JsProto.HPEquipBaptize");n.setEquipId(t),n.setType(1),i.lastAttrs=null,e.Message.instance.send(e.Code.EQUIP_BAPTIZE_C,n,!0)},this.currentSelectedRoleEquip.getEquipId());break;case this.xilianBtn_1:if(null==this.currentSelectedRoleEquip)return void e.PopUpController.getInstance().showFloatTextPanel1("当前位置没有穿戴神装");if(this.isFinish)return void e.PopUpController.getInstance().showFloatTextPanel1("该神装可洗炼属性都已达到上限");if(!this.condition2)return void e.ItemNotEnoughController.getInstance().showPanel(this.prop2VO.id);var n=HawkProtocolManager.newBuilder("JsProto.HPEquipBaptize");n.setEquipId(this.currentSelectedRoleEquip.getEquipId()),n.setType(2),e.Message.instance.send(e.Code.EQUIP_BAPTIZE_C,n,!0);break;case this.vipSend:e.CreateNewVipController.instance.showPanel();break;case this.xunbao:e.SearchTreasureController.getInstance().showPanel();break;case this.buyLimit:e.ActivityController.getIntance().showPanel()}},i.prototype.clickItem=function(e){for(var t=e.currentTarget.idx,i=0;i<this.itemList.length;i++)this.itemList[i].setSelectedState(!1);this.currentSelectedIndex=t,this.lastAttrs=null,this.showSelectEquipInfo()},i.prototype.showSelectEquipInfo=function(){this.showRedPoint(),this.currentSelectedRoleEquip=null;for(var t=0;t<this.equipList.length;t++)if(this.equipList[t].getPart()==this.currentSelectedIndex+1){this.currentSelectedRoleEquip=this.equipList[t];break}if(this.clearContainers(),null!=this.currentSelectedRoleEquip){this.equipCell.visible=!0;var i,n=e.BagController.getInstance().getEquipInfoById(this.currentSelectedRoleEquip.getEquipId()),o=n.getAttrInfos(),a=[],s=void 0,r=void 0,l=e.JsonDataManager.instance.equipTemplate,h=l[this.currentSelectedRoleEquip.getEquipItemId()];this.itemList[this.currentSelectedRoleEquip.getPart()-1].setSelectedState(!0),this.itemList[this.currentSelectedRoleEquip.getPart()-1].setItemIcon(this.currentSelectedRoleEquip.getEquipItemId()),this.equipCell.setItem(h.id),this.equipCell.setLevel(h.level.toString()),this.equipName.text=h.name,this.setGroupState(!1),void 0==this.lastAttrs?(this.lastAttrs=[],this.isSaveData=!0):this.isSaveData=!1;for(var c=0;c<o.length;c++)if(i=0,s=o[c],r=s.getAttrData(),s.getAttrGrade()==e.equipAttrGrade.PRIMARY_ATTR){for(var u=0;u<h.attrTypeList.length;u++)if(r.getAttrId()==h.attrTypeList[u]){i=h.attrAddMaxValueList[u];break}var p=this.checkLastAttrs(r.getAttrId(),r.getAttrValue(),r.getAdditionValue(),c),g=new e.WeaponUpXilLianBPCell;g.initData(r.getAttrId(),r.getAttrValue(),r.getAdditionValue(),i,p),g.x=0,g.y=0+25*c,this.container0.addChild(g),this.baseCellList.push(g)}else s.getAttrGrade()==e.equipAttrGrade.SECONDARY_ATTR&&a.push(o[c]);var d=this.jpCfg[h.rareGroupId];this.isFinish=!0;for(var f=0;f<a.length;f++)for(var m=0;m<d.length;m++)if(a[f].getAttrData().getAttrId()==d[m].attId){i=d[m].intensifyMaxVal,s=a[f],r=s.getAttrData();var p=this.checkLastAttrs(r.getAttrId(),r.getAttrValue(),r.getAttrValue(),o.length+f);r.getAttrValue()<i&&(this.isFinish=!1);var y=new e.WeaponUpXilLianBPCell;y.initData(r.getAttrId(),r.getAttrValue(),r.getAttrValue(),i,p),y.x=0,y.y=0+25*f,this.container1.addChild(y),this.jpCellList.push(y)}}else this.equipCell.setLevel(""),this.equipName.text="",this.equipCell.visible=!1,this.setGroupState(!0);this.currentSelectedIndex>=0&&this.itemList[this.currentSelectedIndex].setSelectedState(!0)},i.prototype.showRedPoint=function(){var t=e.WeaponSmeltController.getInstance().getWeaponXLOperateAry();if(void 0!=t){for(var i=0;i<this.itemList.length;i++)this.itemList[i].isShowRedPoint(!1);for(var n=t.length,i=0;n>i;i++){var o=t[i];this.itemList[o].isShowRedPoint(!0)}}},i.prototype.checkLastAttrs=function(t,i,n,o){var a=0;return this.isSaveData?this.lastAttrs[o]=n:(a=n-this.lastAttrs[o],a=e.GlobalUtil.getAttrValueStr(t,Number(a)),this.lastAttrs[o]=n),a},i.prototype.dispose=function(){this.clearContainers(),this.equipCell.setLevel(""),this.equipName.text="",this.currentSelectedRoleEquip=null;for(var e=0;e<this.itemList.length;e++)this.itemList[e].Index=e,this.itemList[e].setLevel(""),this.itemList[e].setItemStar(""),this.itemList[e].setItemLevel(""),this.itemList[e].showItemType(this.itemTypeName[e]),this.itemList[e].setSelectedState(!1),this.itemList[e].setQualityIconVisible(!1),this.itemList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItem,this);this.itemList=[]},i.prototype.clearContainers=function(){var e,t;for(e=0;e<this.baseCellList.length;e++)t=this.baseCellList[e],t&&t.parent&&this.container0.removeChild(t),t=null;for(this.baseCellList=[],e=0;e<this.jpCellList.length;e++)t=this.jpCellList[e],t&&t.parent&&this.container1.removeChild(t),t=null;this.jpCellList=[]},i.prototype.setGroupState=function(e){this.noEquip.visible=e,this.downGroup.visible=!e},i.prototype.recvMsg=function(t,i){t==e.Code.EQUIP_BAPTIZE_S&&(this.equipList=this.roleInfo.getRoleEquipsForCS(),this.showSelectEquipInfo(),this.showPropInfo(),e.MainBottomControler.instance.refreshWeaponIconOperate())},i}(e.ViewControler);e.WeaponXiLianPanel=t,__reflect(t.prototype,"foxgame.WeaponXiLianPanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="SoulAttrAreaItem"},i.prototype.setTitleType=function(e){0==e?(this.curLabel.visible=!0,this.nextLabel.visible=!1):(this.curLabel.visible=!1,this.nextLabel.visible=!0)},i.prototype.setItem=function(t){var i=this.soulTemplate[t];this.scoreLabel.text=i.score.toString();var n,o,a,s=i.attrTypeList.length,r=new Array;for(n=0;s>n;n++)o=i.attrTypeList[n],a=i.attrValueList[n],r.push({text:e.LanguageUtils.instance.getValue("ATT_"+o)+": ",style:{textColor:e.ColorUtils.instance.getAttrColorById(o)}}),r.push({text:e.GlobalUtil.getAttrValueStr(o,Number(a)),style:{textColor:e.ColorUtils.instance.getAttrValueColorById(o)}}),r.push({text:"\n"});this.attrLabel.textFlow=r,this.attrLabel.lineSpacing=6},Object.defineProperty(i.prototype,"soulTemplate",{get:function(){return e.JsonDataManager.instance.soulTemplate},enumerable:!0,configurable:!0}),i}(eui.Component);e.SoulAttrAreaItem=t,__reflect(t.prototype,"foxgame.SoulAttrAreaItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SoulAttrItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isInit=!0,this.attrId>0&&this.setItem(this.attrId,this.attrValue)},i.prototype.setItem=function(t,i){this.attrId=t,this.attrValue=i,this.isInit&&(this.attrLabel.text=e.LanguageUtils.instance.getValue("ATT_"+this.attrId)+":",this.attrLabel.textColor=e.ColorUtils.instance.getAttrColorById(this.attrId),this.valueLabel.text=e.GlobalUtil.getAttrValueStr(t,i),this.valueLabel.x=this.attrLabel.width)},i}(eui.Component);e.SoulAttrItem=t,__reflect(t.prototype,"foxgame.SoulAttrItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.specialTypeList=[32,33,34,35,36,37],e.skinName="SoulChangeItem",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.init()},i.prototype.init=function(){this.baseLabelList=[this.baseLabel1,this.baseLabel2,this.baseLabel3,this.baseLabel4],this.selectBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBtnClickHandler,this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh(this.data)},i.prototype.refresh=function(t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),this.selectBtn.visible=i,this.soulVO=t;var o=e.BagController.getInstance().getItemInfoByItemId(this.soulVO.id),a=n?-1:o.getCount();this.item.setItem(this.soulVO.id,a,!1),this.nameLabel.text=this.soulVO.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(this.soulVO.quality),this.lvLabel.text=this.soulVO.degree+e.LanguageUtils.instance.getValue("JIE"),this.scoreLabel.text=this.soulVO.score.toString(),this.equipedImg.visible=n,this.refreshAttrs();var s=e.SoulController.getInstance().getChangeSoulPanel(),r=s.checkIsFirstEquipInfo(this.soulVO);r?(this.recommendImg.visible=this.soulVO.score>s.getEquipedScore(),39==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.selectBtn,this.selectBtn.parent,39,7,!0)):this.recommendImg.visible=!1},i.prototype.refreshAttrs=function(){for(var t,i,n,o=this.soulVO.attrTypeList,a=this.soulVO.attrValueList,s=(o.length,!1),r=0;4>r;r++)if(t=this.baseLabelList[r],o[r]){if(n=e.ColorUtils.instance.getAttrColorById(o[r]),i=e.LanguageUtils.instance.getValue("ATT_"+o[r]),-1!=this.specialTypeList.indexOf(o[r])){if(t.visible=!1,s)continue;t=this.desLabel,s=!0,r--}t.text=i+":"+e.GlobalUtil.getAttrValueStr(o[r],a[r]),t.textColor=n,t.visible=!0}else t.visible=!1;s?(this.specialGroup.visible=!0,this.baseGroup.y=0):(this.specialGroup.visible=!1,this.baseGroup.y=this.labelGroup.height-this.baseGroup.height>>1)},i.prototype.selectBtnClickHandler=function(t){e.SoulController.getInstance().requestPutOnSoul(this.soulVO.id),e.SoulController.getInstance().guidelh()},Object.defineProperty(i.prototype,"tempItem",{get:function(){return e.JsonDataManager.instance.itemTemplate},enumerable:!0,configurable:!0}),i}(eui.ItemRenderer);e.SoulChangeItem=t,__reflect(t.prototype,"foxgame.SoulChangeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/soul/SoulChange.exml")||this;return i.minShowNum=3,i.maxShowNum=4,i.isMask=!0,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.itemHeight=this.ui.soulEquiped.height,this.dataSource=new eui.ArrayCollection,this.ui.itemList.dataProvider=this.dataSource,this.ui.itemList.itemRenderer=e.SoulChangeItem,this.ui.scroller.verticalScrollBar.autoVisibility=!1},i.prototype.refresh=function(){this.soulItemVOList=e.BagController.getInstance().getEnableSoulVOList(this.model.roleData.profession);var t,i,n,o,a,s=this.model.grooveInfoDic[this.model.roleData.roleId],r=s.length;for(t=0;r>t;t++)if(n=s[t],o=this.soulTemplate[n.getItemId()],null!=o){if(null!=this.model.change_equipedSoulVO&&o.type==this.model.change_equipedSoulVO.type)continue;for(i=0;i<this.soulItemVOList.length;i++)a=this.soulItemVOList[i],o.type==a.type&&(this.soulItemVOList.splice(i,1),i--)}var l=this.ui.soulEquiped,h=this.ui.scroller,c=this.ui.itemList;null!=this.model.change_equipedSoulVO?(l.refresh(this.model.change_equipedSoulVO,!1,!0),l.visible=!0,h.height=this.itemHeight*this.minShowNum,h.y=l.y+l.height):(l.visible=!1,h.height=this.itemHeight*this.maxShowNum,h.y=l.y),c.height=this.itemHeight*this.soulItemVOList.length,this.dataSource.replaceAll(this.soulItemVOList),this.dataSource.refresh(),h.viewport.scrollV=0},i.prototype.getEquipedScore=function(){return this.model.change_equipedSoulVO?this.model.change_equipedSoulVO.score:-1},i.prototype.checkIsFirstEquipInfo=function(e){var t=this.soulItemVOList.indexOf(e);return 0==t},Object.defineProperty(i.prototype,"soulTemplate",{get:function(){return e.JsonDataManager.instance.soulTemplate},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.SoulChangePanel=t,__reflect(t.prototype,"foxgame.SoulChangePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.SoulModel,this.soulPanel=new e.SoulPanel(this.model),this.soulChangePanel=new e.SoulChangePanel(this.model),this.upgradePanel=new e.SoulUpgradePanel(this.model),this.huntPanel=new e.SoulHuntPanel(this.model),this.smeltPanel=new e.SoulRefinePanel(this.model),this.previewPanel=new e.SoulPreviewPanel}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.guidelh=function(){this.soulPanel.guideshow()},t.prototype.registerMsg=function(t){e.Message.instance.add(e.Code.SOUL_SOUL_INFO_S,this),e.Message.instance.add(e.Code.SOUL_APPARE_OR_REPLACE_S,this),e.Message.instance.add(e.Code.SOUL_DEGREE_UP_S,this),e.Message.instance.add(e.Code.SOUL_HUNTING_INFO_S,this),e.Message.instance.add(e.Code.SOUL_HUNTING_S,this),e.Message.instance.add(e.Code.SOUL_LIGHT_ORANGE_S,this),e.Message.instance.add(e.Code.SOUL_SMELT_S,this),e.Message.instance.add(e.Code.SOUL_OPEN_GROOVE_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.SOUL_SOUL_INFO_S:this.model.setSoulInfo(i),e.MainBottomControler.instance.refreshCharacterIconOperate();break;case e.Code.SOUL_APPARE_OR_REPLACE_S:this.model.changeSoul(i);break;case e.Code.SOUL_DEGREE_UP_S:this.upgradePanel.getIsShow()&&this.upgradePanel.playAni(),this.model.upgradeSoulBack(i);break;case e.Code.SOUL_HUNTING_INFO_S:this.model.setHuntInfo(i),this.huntPanel.show();break;case e.Code.SOUL_HUNTING_S:var n=i;this.model.huntBack(n);break;case e.Code.SOUL_LIGHT_ORANGE_S:this.model.lightOrangeBack(i);break;case e.Code.SOUL_SMELT_S:this.model.refineBack(i);break;case e.Code.SOUL_OPEN_GROOVE_S:this.model.openGroove(i)}e.MainBottomControler.instance.refreshCharacterIconOperate()},t.prototype.requestPutOnSoul=function(t){var i=HawkProtocolManager.newBuilder("JsProto.ApparelOrReplaceSoulReq");i.setIndex(this.model.change_grooveIndex),i.setItemId(t),i.setRoleId(this.model.roleData.roleId);var n;n=null==this.model.change_equipedSoulVO?1:2,i.setType(n),e.Message.instance.send(e.Code.SOUL_APPARE_OR_REPLACE_C,i,!0),this.soulChangePanel.close()},t.prototype.requestSoulInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.SoulInfoReq");
e.Message.instance.send(e.Code.SOUL_SOUL_INFO_C,t,!0)},t.prototype.sendSOUL_OPEN_GROOVE_C=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.OpenGrooveReq");n.setIndex(i),n.setRoleId(t),e.Message.instance.send(e.Code.SOUL_OPEN_GROOVE_C,n,!0)},t.prototype.showSoulPanel=function(t){void 0===t&&(t=0);var i=parseInt(e.GlobalConfig.instance.getValue("SOUL_OPENLEVEL"));return e.PlayerService.instance.level<i?void e.GameUtils.MSG_TIP("龙神功能"+i+"级开启"):void this.soulPanel.showPanel(t)},t.prototype.closeSoulPanel=function(){this.soulPanel.getIsShow()&&this.soulPanel.close()},t.prototype.showPreviewPanel=function(){this.previewPanel.show()},t.prototype.showChangeSoulPanel=function(t,i){void 0===i&&(i=-1),this.model.change_grooveIndex=t,this.model.change_equipedSoulVO=e.JsonDataManager.instance.soulTemplate[i],this.soulChangePanel.show()},t.prototype.showUpgradePanel=function(){this.upgradePanel.show()},t.prototype.showHuntPanel=function(){var t=HawkProtocolManager.newBuilder("JsProto.HuntingSoulInfoReq");e.Message.instance.send(e.Code.SOUL_HUNTING_INFO_C,t,!0)},t.prototype.showSmeltPanel=function(){this.smeltPanel.show()},t.prototype.getChangeSoulPanel=function(){return this.soulChangePanel},t.prototype.getOpenStatus=function(e,t){var i=this.model.grooveInfoDic[e][t-1];return void 0==i?(Log.trace(i+"--------------------------",i),!1):-1==i.getItemId()?!1:!0},t.prototype.getEquipOrUpgrade=function(e){if(null==e)return!1;if(null==this.model.grooveInfoDic)return!1;var i=this.model.grooveInfoDic[e.roleId],n=t.getInstance();if(null==i)return!1;for(var o,a,s=i.length,r=0;s>r;r++){if(a=i[r].getIndex(),o=n.getEquipOperate(e,a))return!0;if(o=n.getUpgradeOperate(e,a))return!0}return!1},t.prototype.getEquipOperate=function(t,i){var n=this.getOpenStatus(t.roleId,i);if(0==n){var o=e.PlayerService.instance.playerInfo.getLevel(),a=e.PlayerService.instance.playerInfo.getVipLevel(),s=e.PlayerService.instance.playerInfo.getCoin(),r=e.PlayerService.instance.playerInfo.getGold(),l=this.model.grooveInfoDic[t.roleId][i-1],h=e.JsonDataManager.instance.soulGrooveTemplate[l.getIndex()];return o>=h.level&&a>=h.vip&&s>=h.coin&&r>=h.gold?!0:!1}for(var c,u,p,g=e.JsonDataManager.instance.soulTemplate,d=e.BagController.getInstance().getEnableSoulVOList(t.profession),f=this.model.grooveInfoDic[t.roleId],m=f.length,y=0;m>y;y++)if(c=f[y],c.getIndex()!=i){if(!(c.getItemId()<=0)){u=g[c.getItemId()];for(var I=d.length-1;I>=0;I--)u.type==d[I].type&&d.splice(I,1)}}else p=g[c.getItemId()];if(null!=p)for(var y=d.length-1;y>=0;y--)p.score>=d[y].score&&d.splice(y,1);return d.length>0},t.prototype.getmodel=function(){return this.model},t.prototype.getUpgradeOperate=function(t,i){var n=this.getOpenStatus(t.roleId,i);if(0==n)return!1;for(var o,a=e.JsonDataManager.instance.soulTemplate,s=this.model.grooveInfoDic[t.roleId],r=null,l=s.length,h=0;l>h;h++)if(!(s[h].getItemId()<=0)&&s[h].getIndex()==i){o=s[h],r=a[o.getItemId()];break}if(null==o)return!1;if(null==r)return!1;if(r.degree>=Number(e.GlobalConfig.instance.getValue("SOULMAXLEVEL")))return!1;var c=r.consumeAttrVO;return c.type!=e.AttributeType.SOUL?!1:this.model.soulExp<c.value?!1:!0},t.prototype.checkOperate=function(){var t=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.HUNYI,!1);if(!t)return!1;if(null==this.model.grooveInfoDic)return!1;for(var i,n,o=e.PlayerService.instance.getRoleDataList(),a=o.length,s=0;a>s;s++)if(i=o[s],n=this.getEquipOrUpgrade(i),1==n)return!0;return!1},t.prototype.setdragonredpoint=function(){this.soulPanel.setredpoint3(this.checkOperate()),this.soulPanel.setredpoint4(e.DragonboneController.getInstance().refreshRedPoint()),this.soulPanel.setredpoint5(e.DragonArmorController.getInstance().refreshRedPoint()),this.soulPanel.setredpoint6(e.DragongodTreasureController.getInstance().redpoint())},t}();e.SoulController=t,__reflect(t.prototype,"foxgame.SoulController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="SoulHuntItem",t.init(),t}return __extends(t,e),t.prototype.init=function(){this.soulImgList=[this.soulImg0,this.soulImg1,this.soulImg2,this.soulImg3,this.soulImg4]},t.prototype.setItem=function(e){for(var t,i=this.soulImgList.length,n=0;i>n;n++)t=this.soulImgList[n],t.visible=n==e},t.prototype.setSelected=function(e){this.selected=e,this.selectGroup.visible=e},t}(eui.Component);e.SoulHuntItem=t,__reflect(t.prototype,"foxgame.SoulHuntItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/soul/SoulHunt.exml")||this;return i.gap=40,i.columnNum=4,i.type6=6,i.isMask=!1,i.model=e,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.huntBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.huntHandler,this),this.ui.huntMultipleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.huntHandler,this),this.ui.orangeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.orangeHandler,this),this.ui.previewLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.previewHandler,this),this.ui.refineImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refineHandler,this);for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],t.setItem(o);this.ui.previewLabel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.ui.previewLabel.text+"</u>"),this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.model.registerObserver(this),39==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.huntBtn,this.ui.huntBtn.parent,39,4,!0),this.doScreenAdaptation()},i.prototype.initParams=function(){this.animComplete(),this.ui.contentGroup.removeChildren()},i.prototype.refresh=function(){this.ui.currency.refresh();for(var e,t=this.getItemList(),i=t.length,n=0;i>n;n++)e=t[n],e.setSelected(this.model.curHuntType==n+1);this.model.curHuntType==this.type6&&(e=t[i-1],e.setSelected(!0)),this.huntSoulVO=this.huntSoulTemplate[this.model.curHuntType],this.ui.priceLabel1.text=this.huntSoulVO.consume.toString();var o=this.globalTemplate.SOUL_ORANGESOULCOST.split("_");this.ui.priceLabel2.text=o[2]},i.prototype.addSoulIcon=function(){var e,t,i,n=this.model.huntBackInfo.getItemIds(),o=this.model.huntBackInfo.getHuntingCount()>1;for(e=0;e<n.length;e++)i=n[e],o?(t=this.getIconByItemId(i),t?t.setItem(t.itemId,t.num+1):t=this.addItemIconToContentGroup(i),n.splice(e,1),e--):t=this.addItemIconToContentGroup(i);var a=this.ui.contentGroup,s=a.numChildren,r=s%this.columnNum>0?Math.floor(s/this.columnNum)+1:s/this.columnNum;a.height=r*t.height+(r-1)*this.gap+this.gap;var l=this.ui.scroller;a.height>l.height?l.viewport.scrollV=a.height-l.height:l.viewport.scrollV=0},i.prototype.addItemIconToContentGroup=function(t){var i=new e.ItemIcon,n=new egret.Point;return i.setItem(t),this.ui.contentGroup.addChild(i),n=this.getIconPos(i.width,this.ui.contentGroup.numChildren-1),i.x=n.x,i.y=n.y,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this),i},i.prototype.playAnimation=function(){this.animation&&(this.animation.clear(),this.animation=null);var t=this.ui.huntAnimGroup;this.animation=new e.FoxAni(t),this.animation.setPlayComplete(this.animComplete,this),this.animation.play("13306","13306",1),t.visible=!0},i.prototype.animComplete=function(){this.ui.huntAnimGroup.visible=!1},i.prototype.getIconByItemId=function(e){var t,i,n=this.soulIconList,o=n.length;for(i=0;o>i;i++)if(t=n[i],t.itemId==e)return t;return null},i.prototype.getIconPos=function(e,t){var i=new egret.Point,n=Math.floor(t/this.columnNum),o=t%this.columnNum;return i.x=o*(e+this.gap),i.y=n*(e+this.gap),i},Object.defineProperty(i.prototype,"soulIconList",{get:function(){var e,t=[],i=this.ui.contentGroup.numChildren;for(e=0;i>e;e++)t.push(this.ui.contentGroup.getChildAt(e));return t},enumerable:!0,configurable:!0}),i.prototype.soulInfoBack=function(){},i.prototype.smeltBack=function(){},i.prototype.update=function(){this.refresh()},i.prototype.huntBack=function(){this.showPrompt(),this.addSoulIcon(),this.playAnimation(),this.refresh()},i.prototype.showPrompt=function(){for(var t,i=this.model.huntBackInfo,n=i.getCost()[0].getNum(),o=e.LanguageUtils.instance.getValue("SOULHUNTCOST",i.getHuntingCount(),n)+"\n\n",a=i.getItemIds(),s=[],r=a.length,l=0;r>l;l++)t=this.getItemTemplate()[a[l]],t.quality<e.EquipQuality.PURPLE||this.checkIds(s,a[l]);var h,c;r=s.length;for(var l=0;r>l;l++)c=s[l],t=this.getItemTemplate()[c.id],h=e.ColorUtils.instance.getColorByQuality(t.quality).toString(16),o+=e.LanguageUtils.instance.getValue("SOULHUNTPRODUCE",h,t.name,c.num)+"\n";0!=s.length&&e.PopUpController.getInstance().showTextPanel(o)},i.prototype.checkIds=function(e,t){for(var i,n=e.length,o=!1,a=0;n>a;a++)if(i=e[a],i.id==t){i.num+=1,o=!0;break}o||(i={},i.id=t,i.num=1,e.push(i))},i.prototype.closeHook=function(){e.SoulController.getInstance().guidelh()},i.prototype.huntHandler=function(t){if(e.PlayerService.instance.playerInfo.getCoin()<this.huntSoulVO.consume)return void e.ItemNotEnoughController.getInstance().showPanel(1002);var i=HawkProtocolManager.newBuilder("JsProto.HuntingSoulReq");t.target==this.ui.huntBtn?(i.setType(1),39==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.closeBtn,this.ui.closeBtn.parent,39,5,!0)):t.target==this.ui.huntMultipleBtn&&i.setType(2),e.Message.instance.send(e.Code.SOUL_HUNTING_C,i,!0)},i.prototype.orangeHandler=function(t){if(this.model.curHuntType==this.type6)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("FIREORANGEMSG"));var i=Number(this.globalTemplate.SOUL_ORANGESOULCOST.split("_")[2]),n=e.PlayerService.instance.playerInfo.getGold();return i>n?void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("FIREORANGESOUL",i),this,this.confirmOrange)},i.prototype.confirmOrange=function(){var t=HawkProtocolManager.newBuilder("JsProto.LightOrangeSoulReq");e.Message.instance.send(e.Code.SOUL_LIGHT_ORANGE_C,t,!0)},i.prototype.itemHandler=function(t){var i=t.target;e.TipsController.getInstance().showSoulTips(i.itemId)},i.prototype.previewHandler=function(t){e.SoulController.getInstance().showPreviewPanel()},i.prototype.refineHandler=function(t){this.ui.contentGroup.removeChildren(),e.SoulController.getInstance().showSmeltPanel()},i.prototype.getItemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},Object.defineProperty(i.prototype,"huntSoulTemplate",{get:function(){return e.JsonDataManager.instance.soulHuntTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalTemplate",{get:function(){return e.JsonDataManager.instance.globalTemplate},enumerable:!0,configurable:!0}),i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e.push(this.ui.item4),e},i}(e.BasePanel);e.SoulHuntPanel=t,__reflect(t.prototype,"foxgame.SoulHuntPanel",["foxgame.ISoul","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SoulItem",e.init(),e}return __extends(i,t),i.prototype.init=function(){},i.prototype.setSoulItem=function(t){this.clear(),this.grooveInfo=t;var i=e.JsonDataManager.instance.soulGrooveTemplate[this.grooveInfo.getIndex()];if(-1==this.grooveInfo.getItemId()){var n=e.PlayerService.instance.playerInfo.getLevel(),o=e.PlayerService.instance.playerInfo.getVipLevel();n>=i.level&&o>=i.vip&&0==i.coin&&0==i.gold&&e.SoulController.getInstance().sendSOUL_OPEN_GROOVE_C(e.SoulController.getInstance().getmodel().roleData.roleId,t.getIndex()),this.txtLabel.text=i.level<=0?e.LanguageUtils.instance.getValue("VIPOPEN",i.vip):e.LanguageUtils.instance.getValue("LEVELOPEN",i.level),this.isOpened=!1}else this.txtLabel.text="",this.isOpened=!0;if(this.lockImg.visible=!this.isOpened,!this.isOpened)return void(this.txtLabel.textColor=16711680);var a=e.JsonDataManager.instance.itemTemplate,s=(e.JsonDataManager.instance.soulTemplate,a[t.getItemId()]);this.plusImg.visible=null==s,null!=s&&(s.iconAnimName?(null==this.anima&&(this.anima=new e.FoxAni(this.animaGroup)),this.anima.play(s.iconAnimName,"ani",-1),this.animaGroup.visible=!0):this.iconImg.source=s.icon,this.txtLabel.text=s.name,this.txtLabel.textColor=e.ColorUtils.instance.getColorByQuality(s.quality))},i.prototype.setRedImgVisible=function(e){this.redImg.visible=e},i.prototype.setUpgradeItem=function(t){this.clear(),this.grooveInfo=t;var i=e.JsonDataManager.instance.soulGrooveTemplate[this.grooveInfo.getIndex()];if(-1==this.grooveInfo.getItemId()?(this.txtLabel.text=i.level<=0?e.LanguageUtils.instance.getValue("VIPOPEN",i.vip):e.LanguageUtils.instance.getValue("LEVELOPEN",i.level),this.isOpened=!1):(this.txtLabel.text="",this.isOpened=!0),this.lockImg.visible=!this.isOpened,this.plusImg.visible=this.isOpened,this.isOpened){var n=e.JsonDataManager.instance.itemTemplate,o=(e.JsonDataManager.instance.soulTemplate,n[t.getItemId()]);this.plusImg.visible=null==o,null!=o&&(o.iconAnimName?(null==this.anima&&(this.anima=new e.FoxAni(this.animaGroup)),this.anima.play(o.iconAnimName,"ani",-1),this.animaGroup.visible=!0):this.iconImg.source=o.icon,this.txtLabel.text=o.name,this.txtLabel.textColor=e.ColorUtils.instance.getColorByQuality(o.quality),this.nameBgImg.visible=!0)}},i.prototype.setSelected=function(e){this.isSelected=e,this.selectImg.visible=e},i.prototype.getSelected=function(){return this.isSelected},i.prototype.clear=function(){this.selectImg.visible=!1,this.iconImg.source=null,this.nameBgImg.visible=!1,this.lockImg.visible=!1,this.plusImg.visible=!1,this.txtLabel.text="",null!=this.anima&&(this.anima.stop(),this.animaGroup.visible=!1)},i}(eui.Component);e.SoulItem=t,__reflect(t.prototype,"foxgame.SoulItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.curSoulIndex=0,this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.update()},e.prototype.setSoulInfo=function(e){null==this.grooveInfoDic&&(this.grooveInfoDic=new Object);for(var t,i=e.getRoleSoulInfo(),n=i.length,o=0;n>o;o++)t=i[o],this.grooveInfoDic[t.getRoleId()]=t.getGrooveInfo();this.soulExp=e.getExp(),n=this.observerList.length;for(var a,o=0;n>o;o++)a=this.observerList[o],a.getIsShow()&&a.soulInfoBack()},e.prototype.changeSoul=function(e){var t=this.grooveInfoDic[e.getRoleId()],i=t[e.getIndex()-1];i.setItemId(e.getItemId()),this.updateView()},e.prototype.upgradeSoulBack=function(e){var t=this.grooveInfoDic[e.getRoleId()],i=t[e.getIndex()-1];i.setItemId(e.getItemId()),this.soulExp=e.getCurrSoulExp(),this.updateView()},e.prototype.setHuntInfo=function(e){this.curHuntType=e.getCurrHuntingType()},e.prototype.huntBack=function(e){this.huntBackInfo=e,this.curHuntType=e.getCurrHuntingType();for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.huntBack()},e.prototype.lightOrangeBack=function(e){this.curHuntType=e.getCurrHuntingType(),this.updateView()},e.prototype.openGroove=function(e){if(0!=e.getErrOrNo())return void Log.trace("魂槽开启失败!");this.grooveInfoDic[e.getRoleId()][e.getGrooveInfo().getIndex()-1]=e.getGrooveInfo();for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.soulInfoBack()},e.prototype.refineBack=function(e){this.soulExp=e.getSoulExp();for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.smeltBack()},e.prototype.clear=function(){this.roleData=null,this.curSoulIndex=0},e.prototype.setSoulUpGradeIndex=function(e){this.curSoulUGIndex=e},e.prototype.getSoulUpGradeIndex=function(){return this.curSoulUGIndex},e}();e.SoulModel=t,__reflect(t.prototype,"foxgame.SoulModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/soul/SoulPanelSkin.exml","soulPanel")||this;return i.isMask=!1,i.model=e,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.huntBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.huntHandler,this),this.ui.smeltBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.smeltHandler,this),this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),this.ui.longhun.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longgu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longjia.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.longshenbaoku.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openview,this),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.ui.longhun.currentState="down";for(var t=this.getSoulItemList(),i=t.length,n=0;i>n;)t[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this),n+=1;this.specialAttrIdList=[32,33,34,35,36,37],e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.model.registerObserver(this),e.BagController.getInstance().registerObserver(this),this.doScreenAdaptation(),39==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.huntBtn,this.ui.huntBtn.parent,39,3,!0)},i.prototype.openview=function(t){switch(t.target){case this.ui.longhun:this.ui.longhun.currentState="down";break;case this.ui.longgu:this.ui.longgu.currentState="up";var i=e.PlayerService.instance.getRoleDataList(),n=i.indexOf(this.model.roleData);e.DragonboneController.getInstance().showpanel(n);break;case this.ui.longjia:this.ui.longjia.currentState="up",e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_LEVEL"))?(e.DragonArmorController.getInstance().showArmorPanel(),e.SoulController.getInstance().closeSoulPanel()):e.PopUpController.getInstance().showFloatTextPanel1("龙甲"+e.GlobalConfig.instance.getValue("DRAGON_ARMOUR_OPEN_LEVEL")+"级开启");break;case this.ui.longshenbaoku:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.DRAGONGODTREASURE)}},i.prototype.guideshow=function(){39==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.item0.animaGroup,this.ui.item0.animaGroup.parent,39,6,!0),39==App.GuideUtils().currdbz&&7==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.closeBtn,this.ui.closeBtn.parent,39,8,!0)},i.prototype.showPanel=function(e){this.model.roleIndex=e,this.show()},i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.roleIndex)},i.prototype.refresh=function(){if(this.ui.currency.refresh(),e.SoulController.getInstance().setdragonredpoint(),null!=this.model.grooveInfoDic){for(var t,i=this.model.roleData,n=this.model.grooveInfoDic[i.roleId],o=this.getSoulItemList(),a=o.length,s=0;a>s;s++)t=o[s],t.setSoulItem(n[s]);this.ui.scroller.viewport.scrollV=0;var r={};a=n.length;for(var l,h,c,u,p,g=e.JsonDataManager.instance.soulTemplate,d=0,s=0;a>s;s++)if(l=n[s],h=g[l.getItemId()],null!=h){d+=h.score,c=h.attrTypeList.length;for(var f=0;c>f;f++)u=h.attrTypeList[f],p=h.attrValueList[f],null==r[u]?r[u]=p:r[u]+=p}this.ui.scoreLabel.text=d+"";var m,y=[],I=[];for(var v in r)m={},m.attrId=Number(v),m.attrValue=r[Number(v)],-1==this.specialAttrIdList.indexOf(Number(v))?y.push(m):I.push(m);y.sort(this.sortAttr),I.sort(this.sortAttr);var _=this.ui.attrGroup;_.removeChildren(),a=y.length;for(var T,C,s=0;a>s;s++)m=y[s],T=new e.SoulAttrItem,T.setItem(m.attrId,m.attrValue),T.x=s%3*170,T.y=Math.floor(s/3)*T.height+4,_.addChild(T),C=T.y+T.height;a=I.length;for(var s=0;a>s;s++)m=I[s],T=new e.SoulAttrItem,T.setItem(m.attrId,m.attrValue),T.y=Math.floor(s/3)*T.height+C,_.addChild(T),C=T.y+T.height;this.refreshOperate()}},i.prototype.refreshOperate=function(){for(var t,i,n=e.SoulController.getInstance(),o=e.PlayerService.instance.getRoleDataList(),a=o.length,s=this.ui.headBar,r=0;a>r;r++)t=o[r],i=n.getEquipOrUpgrade(t),s.setRedStatus(r,i);t=this.model.roleData;var l=this.model.grooveInfoDic[t.roleId],h=this.getSoulItemList();a=h.length;var c,u,p=!1;this.ui.upgradeRedImg.visible=!1;for(var r=0;a>r;r++)c=h[r],u=l[r].getIndex(),c.setRedImgVisible(n.getEquipOperate(t,u)),p=n.getUpgradeOperate(t,u),1==p&&(this.ui.upgradeRedImg.visible=!0)},i.prototype.sortAttr=function(e,t){return e.attrId>t.attrId?1:e.attrId<t.attrId?-1:0},i.prototype.soulInfoBack=function(){this.refresh()},i.prototype.update=function(){this.refresh()},i.prototype.huntBack=function(){},i.prototype.smeltBack=function(){},i.prototype.bagItemChanged=function(){this.refreshOperate()},i.prototype.setRoleData=function(e){this.model.roleData=e,this.refresh()},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:if(!this.getIsShow())return;this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.itemClickHandler=function(t){var i=this,n=t.currentTarget,o=n.grooveInfo,a=e.JsonDataManager.instance.soulGrooveTemplate[o.getIndex()];if(!n.isOpened){var s=e.PlayerService.instance.playerInfo.getLevel(),r=e.PlayerService.instance.playerInfo.getVipLevel(),l=e.PlayerService.instance.playerInfo.getCoin(),h=e.PlayerService.instance.playerInfo.getGold(),c=[],u="#ff0400",p="#ff0400",g="#ff0400",d="#ff0400";return s>=a.level&&(u="#21ff03"),r>=a.vip&&(p="#21ff03"),l>=a.coin&&(g="#21ff03"),h>=a.gold&&(d="#21ff03"),0!=a.level&&c.push(u),0!=a.vip&&c.push(p),0!=a.coin&&c.push(g),0!=a.gold&&c.push(d),void e.PopUpController.getInstance().showTextPanel((m=e.LanguageUtils.instance).getReplaceString.apply(m,[a.soulTips].concat(c)),this,function(){var t=e.PlayerService.instance.playerInfo.getGold(),n=e.PlayerService.instance.playerInfo.getCoin(),s=e.PlayerService.instance.playerInfo.getLevel(),r=e.PlayerService.instance.playerInfo.getVipLevel();return t<a.gold||n<a.coin||s<a.level||r<a.vip?void e.GameUtils.MSG_TIP("条件不足!"):void e.SoulController.getInstance().sendSOUL_OPEN_GROOVE_C(i.model.roleData.roleId,o.getIndex())},null,null,null,"解锁",null,24)}var f=e.JsonDataManager.instance.itemTemplate[o.getItemId()];null==f?e.SoulController.getInstance().showChangeSoulPanel(o.getIndex()):e.TipsController.getInstance().showSoulTips(f.id,o.getIndex());var m},i.prototype.closeHook=function(){e.NewJueweiController.getInstance().updateNobilityData(),39==App.GuideUtils().currdbz&&8==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.backHandler=function(){e.CharacterController.getInstance().showPanel(0,this.model.roleIndex,!1),this.close()},i.prototype.huntHandler=function(t){e.SoulController.getInstance().showHuntPanel()},i.prototype.smeltHandler=function(t){e.SoulController.getInstance().showSmeltPanel()},i.prototype.upgradeHandler=function(t){var i=this.ui.headBar.getCurIndex();this.model.setSoulUpGradeIndex(i),e.SoulController.getInstance().showUpgradePanel()},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("SOULMEANINGHELP")},i.prototype.getSoulItemList=function(){for(var e=[],t=0;9>=t;t++)e.push(this.ui["item"+t]);return e},i.prototype.setredpoint3=function(e){this.ui.dragnredpoint3.visible=e},i.prototype.setredpoint4=function(e){this.ui.dragnredpoint4.visible=e},i.prototype.setredpoint5=function(e){this.ui.dragnredpoint5.visible=e},i.prototype.setredpoint6=function(e){this.ui.dragnredpoint6.visible=e},i}(e.BasePanel);e.SoulPanel=t,__reflect(t.prototype,"foxgame.SoulPanel",["foxgame.IMessage","foxgame.ISoul","foxgame.IObserver","foxgame.IBag"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/soul/SoulPreview.exml")||this;return e.gap=40,e.columnNum=4,e}return __extends(i,t),i.prototype.initHook=function(){this.initView(),this.ui.scroller.verticalScrollBar.autoVisibility=!1},i.prototype.initView=function(){var t=this.getSoulTemplate();this.soulList=[];var i;for(var n in t)i=t[n],i.degree==Number(e.GlobalConfig.instance.getValue("SOULMAXLEVEL"))&&5==i.quality&&this.soulList.push(i);this.soulList.sort(this.sortSoul);var o,a,s,r=this.soulList.length;for(o=0;r>o;o++)a=new e.ItemIcon,a.setItem(this.soulList[o].id),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this),s=this.getIconPos(a.width,o),a.x=s.x,a.y=s.y,this.ui.contentGroup.addChild(a)},i.prototype.refresh=function(){this.ui.scroller.viewport.scrollV=0},i.prototype.getIconPos=function(e,t){var i=new egret.Point,n=Math.floor(t/this.columnNum),o=t%this.columnNum;return i.x=o*(e+this.gap),i.y=n*(e+this.gap),i},i.prototype.sortSoul=function(e,t){return e.id>t.id?-1:e.score<t.score?1:0},i.prototype.itemClickHandler=function(t){var i=t.target;e.TipsController.getInstance().showSoulTips(i.itemId)},i.prototype.getSoulTemplate=function(){return e.JsonDataManager.instance.soulTemplate},i}(e.BasePanel);e.SoulPreviewPanel=t,__reflect(t.prototype,"foxgame.SoulPreviewPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SoulRefineItem",e}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.init()},i.prototype.init=function(){this.reduceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reduceHandler,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addHandler,this),this.addItemBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addItemHandler,this),this.numLabel.addEventListener(egret.TextEvent.CHANGE,this.numChangeHandler,this),this.numLabel.addEventListener(egret.TextEvent.FOCUS_OUT,this.numFocusOutHandler,this),this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.iconHandler,this),this.refineAnimaGroup.visible=!1},i.prototype.setRefinePanel=function(e){this.refinePanel=e},i.prototype.setItem=function(t){if(this.itemInfo=e.BagController.getInstance().getItemInfoById(t),null==this.itemInfo)return void this.clear();var i=this.soulTemplate()[this.itemInfo.getItemId()];this.addItemBtn.visible=!1,this.numLabel.visible=!0,this.reduceBtn.visible=this.itemInfo.getCount()>1,this.addBtn.visible=this.itemInfo.getCount()>1,this.icon.setItem(this.itemInfo.getItemId()),this.numLabel.text=this.itemInfo.getCount().toString();var n;i.smeltAttrVO.type==e.AttributeType.SOUL?n=e.LanguageUtils.instance.getValue("SOULEXP")+":":i.smeltAttrVO.type==e.AttributeType.COIN&&(n=e.LanguageUtils.instance.getValue("COIN")+":"),this.expLabel.text=n+i.smeltAttrVO.value,this.changeExpLabel(this.itemInfo.getCount())},i.prototype.numChangeHandler=function(e){if(""!=this.numLabel.text){var t=parseInt(this.numLabel.text);t>this.itemInfo.getCount()?t=this.itemInfo.getCount():1>t&&(t=1),this.numLabel.text=t.toString(),this.changeExpLabel(t)}},i.prototype.changeExpLabel=function(t){var i,n=this.soulTemplate()[this.itemInfo.getItemId()];n.smeltAttrVO.type==e.AttributeType.SOUL?i=e.LanguageUtils.instance.getValue("SOULEXP")+":":n.smeltAttrVO.type==e.AttributeType.COIN&&(i=e.LanguageUtils.instance.getValue("COIN")+":"),this.expLabel.text=i+n.smeltAttrVO.value*t},i.prototype.numFocusOutHandler=function(e){""==this.numLabel.text&&(this.numLabel.text="1",this.changeExpLabel(1))},i.prototype.reduceHandler=function(e){var t=parseInt(this.numLabel.text);1!=t&&(t--,this.numLabel.text=t.toString(),this.changeExpLabel(t))},i.prototype.addHandler=function(e){var t=parseInt(this.numLabel.text);t!=this.itemInfo.getCount()&&(t++,this.numLabel.text=t.toString(),this.changeExpLabel(t))},i.prototype.playAnimation=function(){this.animation&&(this.animation.clear(),this.animation=null),this.itemInfo&&(this.animation=new e.FoxAni(this.refineAnimaGroup),this.animation.setPlayComplete(this.animComplete,this),this.animation.play("soulRefine","ani",1),this.refineAnimaGroup.visible=!0)},i.prototype.animComplete=function(){this.refineAnimaGroup.visible=!1},i.prototype.iconHandler=function(e){this.setItem(null)},i.prototype.addItemHandler=function(e){this.refinePanel.changePanelType(2)},i.prototype.clear=function(){this.icon.setItem(-1),this.numLabel.visible=!1,this.expLabel.text="",this.reduceBtn.visible=!1,this.addBtn.visible=!1,this.addItemBtn.visible=!0,this.expLabel.visible=!1},Object.defineProperty(i.prototype,"num",{get:function(){return parseInt(this.numLabel.text)},enumerable:!0,configurable:!0}),i.prototype.soulTemplate=function(){return e.JsonDataManager.instance.soulTemplate},i}(eui.Component);e.SoulRefineItem=t,__reflect(t.prototype,"foxgame.SoulRefineItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.refinePanel=e,i.skinName="SoulRefineItem2",i.init(),i}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this)},i.prototype.init=function(){this.checkBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkBtnHandler,this),this.attrLabelList=[this.attrLabel0,this.attrLabel1,this.attrLabel2,this.attrLabel3,this.attrLabel4,this.attrLabel5]},i.prototype.setItem=function(t){this.checkBtn.selected=!1,this.itemInfo=e.BagController.getInstance().getItemInfoByItemId(t);var i=this.soulTemplate[this.itemInfo.getItemId()];this.icon.setItem(i.id,this.itemInfo.getCount()),this.nameLabel.text=i.name,this.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(i.quality),this.scoreLabel.text=i.score.toString();var n;i.smeltAttrVO.type==e.AttributeType.SOUL?n=e.LanguageUtils.instance.getValue("SOULEXP")+":":i.smeltAttrVO.type==e.AttributeType.COIN&&(n=e.LanguageUtils.instance.getValue("COIN")+":"),this.expLabel.text=n+i.smeltAttrVO.value*this.itemInfo.getCount();var o,a,s,r,l,h,c=this.attrLabelList.length;for(o=0;c>o;o++)a=this.attrLabelList[o],o<i.attrTypeList.length?(r=i.attrTypeList[o],l=i.attrValueList[o],s=e.LanguageUtils.instance.getValue("ATT_"+r)+":",s+=e.GlobalUtil.getAttrValueStr(r,l),h=e.ColorUtils.instance.getAttrColorById(r),a.text=s,a.textColor=h,a.visible=!0):a.visible=!1},i.prototype.checkBtnHandler=function(e){var t=this.checkBtn.selected,i=this.refinePanel.addOrRemoveReadySoul(this.itemInfo.getId(),t);i||(this.checkBtn.selected=!t)},Object.defineProperty(i.prototype,"soulTemplate",{get:function(){return e.JsonDataManager.instance.soulTemplate},enumerable:!0,configurable:!0}),i}(eui.Component);e.SoulRefineItem2=t,__reflect(t.prototype,"foxgame.SoulRefineItem2")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/soul/SoulRefine.exml")||this;return i.isMask=!1,i.isMaskdown=!0,i.model=e,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.refineBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refineHandler,this),this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandler,this);var e,t,i=this.getCheckBtnList(),n=i.length;for(e=0;n>e;e++)t=i[e],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkBtnHandler,this);var o=this.getItemList();for(n=o.length,e=0;n>e;e++)o[e].setRefinePanel(this);this.model.registerObserver(this),this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.doScreenAdaptation()},i.prototype.initParams=function(){var t,i=e.GlobalConfig.instance.getValue("SOUL_REFINEDEFAULTTYPE").split(","),n=[],o=i.length;for(t=0;o>t;t++)n.push(parseInt(i[t]));var a;for(t=0;o>t;t++)a=n[t],this.setQualitySelect(t,a>0);this.readyIdList=[],this.changePanelType(1)},i.prototype.changePanelType=function(e,t){void 0===t&&(t=!0),this.panelType=e,1==this.panelType?(t&&this.refreshRefineView(),this.ui.refineGroup.visible=!0,this.ui.chooseGroup.visible=!1):2==this.panelType&&(this.refreshChooseView(),this.ui.refineGroup.visible=!1,this.ui.chooseGroup.visible=!0)
},i.prototype.refreshRefineView=function(){this.ui.currency.refresh();for(var t,i,n=e.BagController.getInstance().getSoulVOList(),o=this.selectTypeList,a=[],s=n.length-1;s>=0;s--)i=n[s],-1==o.indexOf(i.quality)||i.degree>1?n.splice(s,1):(t=e.BagController.getInstance().getItemInfoByItemId(i.id),a.push(t));for(var r,l,h=this.getItemList(),c=h.length,s=0;c>s;s++)r=h[s],t=a[s],l=null!=t?t.getId():-1,r.setItem(l);this.ui.expLabel.text=this.model.soulExp.toString()},i.prototype.refreshChooseView=function(){this.ui.contentGroup.removeChildren();var t,i,n,o,a=e.BagController.getInstance().getSoulVOList(),s=this.getItemList(),r=s.length;for(t=0;r>t;t++)if(i=s[t],null!=i.itemInfo)for(o=0;o<a.length;o++)n=a[o],i.itemInfo.getItemId()==n.id&&(a.splice(o,1),o--);var l;for(t=0;t<a.length;t++)n=a[t],l=new e.SoulRefineItem2(this),l.setItem(n.id),l.y=t*l.height,this.ui.contentGroup.addChild(l);this.ui.scroller.viewport.scrollV=0},i.prototype.addOrRemoveReadySoul=function(e,t){if(t)return this.getEmptyItemNum()-this.readyIdList.length>0&&-1==this.readyIdList.indexOf(e)?(this.readyIdList.push(e),!0):!1;if(t)throw new Error("Error");return this.readyIdList.splice(this.readyIdList.indexOf(e),1),!0},i.prototype.getEmptyItemNum=function(){var e,t,i=this.getItemList(),n=i.length,o=0;for(e=0;n>e;e++)t=i[e],null==t.itemInfo&&o++;return o},i.prototype.soulInfoBack=function(){},i.prototype.huntBack=function(){},i.prototype.update=function(){},i.prototype.smeltBack=function(){this.playRefineAnimation(),this.refreshRefineView()},i.prototype.playRefineAnimation=function(){var e,t,i=this.getItemList(),n=i.length;for(e=0;n>e;e++)t=i[e],t.playAnimation()},i.prototype.checkBtnHandler=function(e){var t=e.target,i=this.getCheckBtnList(),n=i.indexOf(t);this.setQualitySelect(n,t.selected),this.refreshRefineView()},i.prototype.setQualitySelect=function(e,t){var i=this.getCheckBtnList(),n=i[e];n.selected=t},Object.defineProperty(i.prototype,"selectTypeList",{get:function(){var e,t,i=[],n=this.getCheckBtnList(),o=n.length;for(e=0;o>e;e++)t=n[e],t.selected&&i.push(e+1);return i},enumerable:!0,configurable:!0}),i.prototype.refineHandler=function(t){var i,n,o,a,s=[],r=this.getItemList(),l=r.length;for(n=0;l>n;n++)o=r[n],a=o.itemInfo,null!=a&&(i=HawkProtocolManager.newBuilder("JsProto.SoulInfo"),i.setItemId(a.getItemId()),i.setNum(o.num),s.push(i));if(0!=s.length){var h=HawkProtocolManager.newBuilder("JsProto.SmeltSoulReq");h.setItemList(s),e.Message.instance.send(e.Code.SOUL_SMELT_C,h,!0)}},i.prototype.confirmHandler=function(e){if(this.changePanelType(1,!1),0!=this.readyIdList.length){var t,i,n=this.getItemList(),o=n.length;for(t=0;o>t;t++)i=n[t],null==i.itemInfo&&i.setItem(this.readyIdList.shift())}},i.prototype.getItemList=function(){for(var e=[],t=0;8>=t;t++)e.push(this.ui["item"+t]);return e},i.prototype.getCheckBtnList=function(){for(var e=[],t=0;4>=t;t++)e.push(this.ui["checkBtn"+t]);return e},i}(e.BasePanel);e.SoulRefinePanel=t,__reflect(t.prototype,"foxgame.SoulRefinePanel",["foxgame.ISoul","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/soul/SoulTips.exml")||this;return e.isMask=!0,e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.initHook=function(){this.ui.replaceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.replaceHandler,this),this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this)},i.prototype.showPanel=function(e,t){this.itemId=e,this.grooveIndex=t,this.show()},i.prototype.refresh=function(){var t=this.soulTemplate[this.itemId],i=e.ColorUtils.instance.getColorByQuality(t.quality);this.ui.icon.setItem(this.itemId,1,!1),this.ui.nameLabel.text=t.name,this.ui.nameLabel.textColor=i,this.ui.scoreBLabel.text=t.score.toString(),this.ui.professionLabel.text=e.LanguageUtils.instance.getValue("PROF_"+t.profession),this.ui.lvLabel.text=t.degree+e.LanguageUtils.instance.getValue("JIE");for(var n,o,a,s,r=new Array,l=0;l<t.attrTypeList.length;l++){o=t.attrTypeList[l],a=t.attrValueList[l],s=e.LanguageUtils.instance.getValue("ATT_"+o)+": ",s+=e.GlobalUtil.getAttrValueStr(o,a)+"\n",n=e.ColorUtils.instance.getAttrColorById(o);var h={text:s,style:{textColor:n}};r.push(h)}this.ui.attrLabel.textFlow=r;var c=this.soulMultiplyTemplate[t.type+"_"+t.quality+"_"+(t.degree+1)];this.ui.upgradeLabel.text=null!=c?e.LanguageUtils.instance.getValue("SOULUPGRADENEEDEXP",t.consumeAttrVO.value):"",t.smeltAttrVO.type==e.AttributeType.SOUL?this.ui.refineLabel.text=e.LanguageUtils.instance.getValue("SOULREFINEEXP",t.smeltAttrVO.value):this.ui.refineLabel.text="",this.ui.replaceBtn.visible=this.grooveIndex>0,this.ui.upgradeBtn.visible=this.grooveIndex>0},i.prototype.replaceHandler=function(t){e.SoulController.getInstance().showChangeSoulPanel(this.grooveIndex,this.itemId),this.close()},i.prototype.upgradeHandler=function(t){e.SoulController.getInstance().showUpgradePanel(),this.close()},Object.defineProperty(i.prototype,"soulMultiplyTemplate",{get:function(){return e.JsonDataManager.instance.multipleKeySoulTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soulTemplate",{get:function(){return e.JsonDataManager.instance.soulTemplate},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.SoulTips=t,__reflect(t.prototype,"foxgame.SoulTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="SoulUpgradeItem",e.init(),e}return __extends(i,t),i.prototype.init=function(){this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.iconClickHandler,this),this.equipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.equipHandler,this)},i.prototype.setItem=function(t){this.grooveIndex=t.getIndex(),this.soulVO=null,this.clear();var i,n=this.soulGrooveTemplate[this.grooveIndex];if(-1==t.getItemId()?(this.limitLabel.text=e.LanguageUtils.instance.getValue("LEVELOPEN",n.level),i=!1):(this.limitLabel.text="",i=!0),this.equipGroup.visible=i,i){var o=this.itemTemplate[t.getItemId()];this.soulVO=this.soulTemplate[t.getItemId()],this.icon.source=null!=o?o.icon:null,o.iconAnimName?(this.animation=new e.FoxAni(this.animGroup),this.animation.play(o.iconAnimName,"ani",-1)):this.animation&&(this.animation.clear(),this.animation=null),null!=this.soulVO?this.levelLabel.text=this.soulVO.degree+e.LanguageUtils.instance.getValue("JIE"):this.levelLabel.text=""}},i.prototype.setOtherItem=function(t,i){if(this.limitLabel.visible=!1,this.equipGroup.visible=!1,this.soulVO=null,this.grooveIndex=i,t.getItemId()<=0)return this.animation&&(this.animation.clear(),this.animation=null),this.icon.source=null,void(this.levelLabel.text="");var n=(this.soulGrooveTemplate[this.grooveIndex],this.itemTemplate[t.getItemId()]);this.soulVO=this.soulTemplate[t.getItemId()],this.icon.source=null!=n?n.icon:null,null!=this.soulVO&&n.iconAnimName&&(this.animation=new e.FoxAni(this.animGroup),this.animation.play(n.iconAnimName,"ani",-1)),null!=this.soulVO&&(this.levelLabel.text=this.soulVO.degree+e.LanguageUtils.instance.getValue("JIE"))},i.prototype.iconClickHandler=function(t){null!=this.soulVO&&e.TipsController.getInstance().showSoulTips(this.soulVO.id)},i.prototype.equipHandler=function(e){},i.prototype.clear=function(){this.icon.source=null,this.limitLabel.text="",this.levelLabel.text="",this.equipGroup.visible=!1,this.soulVO=null},Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.selectImg.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soulTemplate",{get:function(){return e.JsonDataManager.instance.soulTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soulGrooveTemplate",{get:function(){return e.JsonDataManager.instance.soulGrooveTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"itemTemplate",{get:function(){return e.JsonDataManager.instance.itemTemplate},enumerable:!0,configurable:!0}),i}(eui.Component);e.SoulUpgradeItem=t,__reflect(t.prototype,"foxgame.SoulUpgradeItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/soul/SoulUpgradeSkin.exml")||this;return i.isMask=!1,i.model=e,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this);for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.ui.attrItem0.setTitleType(0),this.ui.attrItem1.setTitleType(1),this.model.registerObserver(this),e.BagController.getInstance().registerObserver(this),this.doScreenAdaptation()},i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1,this.model.getSoulUpGradeIndex())},i.prototype.refresh=function(){this.ui.currency.refresh();for(var e,t=this.getItemList(),i=t.length,n=0;i>n;n++)e=t[n],e.setUpgradeItem(this.model.grooveInfoDic[this.model.roleData.roleId][n]);this.selectItem(this.model.curSoulIndex),this.refreshOperate()},i.prototype.soulInfoBack=function(){},i.prototype.huntBack=function(){},i.prototype.smeltBack=function(){},i.prototype.update=function(){this.refresh()},i.prototype.bagItemChanged=function(){this.refreshOperate()},i.prototype.refreshOperate=function(){for(var t=this.model.grooveInfoDic[this.model.roleData.roleId],i=this.getItemList(),n=i.length,o=this.model.roleData,a=e.SoulController.getInstance(),s=0;n>s;s++)i[s].setRedImgVisible(a.getUpgradeOperate(o,t[s].getIndex()))},i.prototype.refreshUpgrade=function(){var t=this.model.grooveInfoDic[this.model.roleData.roleId][this.model.curSoulIndex],i=this.soulGrooveTemplate[t.getIndex()],n=this.ui.attrGroup,o=this.ui.openLabel,a=this.ui.limitGroup;-1==t.getItemId()?(o.text=i.level<=0?e.LanguageUtils.instance.getValue("VIPOPEN",i.vip):e.LanguageUtils.instance.getValue("LEVELOPEN",i.level),n.visible=!1,a.visible=!0):(o.text="",n.visible=!0,a.visible=!1);var s,r=this.soulTemplate[t.getItemId()];null!=r&&(s=this.soulMultiplyTemplate[r.type+"_"+r.quality+"_"+(r.degree+1)]);var l=this.ui.expLabel;null!=r||null!=s?l.textFlow=e.GlobalUtil.createMaterialProTextFlow(this.model.soulExp,r.consumeAttrVO.value):(l.text="0",l.textColor=16777215),null!=r?(this.ui.attrItem0.setItem(r.id),null!=s?(this.ui.attrItem1.setItem(s.id),this.ui.nextLevelGroup.visible=!0,this.ui.topLabel.visible=!1):(this.ui.nextLevelGroup.visible=!1,this.ui.topLabel.visible=!0),this.ui.attrGroup.visible=!0):this.ui.attrGroup.visible=!1},i.prototype.recvMsg=function(t,i){if(this.getIsShow())switch(t){case e.MsgCMD.REFRESH_PLAYERDATA:this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.itemClickHandler=function(e){var t=this.getItemList(),i=e.currentTarget,n=t.indexOf(i);this.selectItem(n)},i.prototype.selectItem=function(e){this.model.curSoulIndex=e;var t,i,n=this.getItemList(),o=n.length;for(t=0;o>t;t++)i=n[t],i.setSelected(t==e);this.refreshUpgrade()},i.prototype.upgradeHandler=function(t){var i=this.model.grooveInfoDic[this.model.roleData.roleId][this.model.curSoulIndex],n=this.soulTemplate[i.getItemId()];if(this.model.soulExp<n.consumeAttrVO.value)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("SOULEXPNOTENOUGH"));var o=HawkProtocolManager.newBuilder("JsProto.UpSoulDegreeReq");o.setRoleId(this.model.roleData.roleId),o.setIndex(this.model.curSoulIndex+1),e.Message.instance.send(e.Code.SOUL_DEGREE_UP_C,o,!0)},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("SOULMEANINGHELP")},i.prototype.clear=function(){this.model.clear()},i.prototype.setRoleData=function(e){this.getIsShow()&&(this.model.roleData=e,this.refresh())},i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroup.visible=!0,App.SoundManager().playEffect("sound_intensify_mp3")},i.prototype.playComplete=function(){this.ui.aniGroup.visible=!1},Object.defineProperty(i.prototype,"soulGrooveTemplate",{get:function(){return e.JsonDataManager.instance.soulGrooveTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soulTemplate",{get:function(){return e.JsonDataManager.instance.soulTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soulMultiplyTemplate",{get:function(){return e.JsonDataManager.instance.multipleKeySoulTemplate},enumerable:!0,configurable:!0}),i.prototype.getItemList=function(){for(var e=[],t=0;9>=t;t++)e.push(this.ui["item"+t]);return e},i}(e.BasePanel);e.SoulUpgradePanel=t,__reflect(t.prototype,"foxgame.SoulUpgradePanel",["foxgame.IMessage","foxgame.ISoul","foxgame.IObserver","foxgame.IBag"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.SuitEquipModel,this.panel=new e.SuitEquipPanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.showPanel=function(e){void 0===e&&(e=0),this.panel.showPanel(e)},t.prototype.showtippanel=function(t){var i=e.PlayerService.instance.getRoleDataList(),n=i.indexOf(e.CharacterController.getInstance().getModel().roleData);this.panel.showPanel(n,t)},t}();e.SuitEquipController=t,__reflect(t.prototype,"foxgame.SuitEquipController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.init(),e}return __extends(i,t),i.prototype.init=function(){this.skinName="SuitEquipItem",this.redImg.visible=!1,this.checkLabel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.checkLabel.text+"</u>"),this.checkLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},i.prototype.setItem=function(t,i){this.model=t,this.equipInfo=this.model.roleData.getEquipInfoByPart(i),this.nameLabel.text=e.LanguageUtils.instance.getValue("PARTNAME"+i);var n,o,a,s=e.JsonDataManager.instance.equipmentUpgradeByPartTemplate,r=e.JsonDataManager.instance.equipmentUpgradeTemplate,l=e.JsonDataManager.instance.equipTemplate,h=s[i];null!=this.equipInfo?(a=this.model.roleData.getEquipInfoByPart(i),n=l[a.getEquipId()],o=r[n.id],this.levelLabel.text=o.level+e.LanguageUtils.instance.getValue("JI"),this.scoreLabel.text=a.getScore().toString(),this.equipImg.source="suit"+i+"_png"):(o=h[0],n=l[o.id],this.levelLabel.text="0"+e.LanguageUtils.instance.getValue("JI"),this.scoreLabel.text="0",this.equipImg.source="suitGray"+i+"_png")},i.prototype.touchHandler=function(t){return null==this.equipInfo?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEICHUANDAI")):void e.TipsController.getInstance().showEquipTips({profession:this.model.roleData.profession,equipInfo:this.equipInfo,showReplace:!1,showLock:!1})},i.prototype.setRedImgVisible=function(e){this.redImg.visible=e},Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.selectImg.visible=e},enumerable:!0,configurable:!0}),i}(eui.Component);e.SuitEquipItem=t,__reflect(t.prototype,"foxgame.SuitEquipItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.curSelectIndex=0}return e}();e.SuitEquipModel=t,__reflect(t.prototype,"foxgame.SuitEquipModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this,"resource/skins/suitEquipment/SuitEquipPanel.exml","suitEquipPanel")||this;return n.partList=[e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4],n.isMask=!1,n.model=i,n.isMaskdown=!0,n.adaptionType=1,n}return __extends(i,t),i.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this),this.ui.getLabel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.ui.getLabel.text+"</u>"),this.ui.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upgradeHandler,this),this.ui.getLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);var t,i,n=this.getItemList(),o=n.length;for(t=0;o>t;t++)i=n[t],i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemClickHandler,this);this.ui.headBar.setBackFun(this.setRoleData.bind(this)),e.Message.instance.add(e.Code.EQUIP_EVOLUTION_S,this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.doScreenAdaptation(),38==App.GuideUtils().currdbz&&4==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.upgradeBtn,this.ui.upgradeBtn.parent,38,5,!0)},i.prototype.initParams=function(){this.model.roleData=null,this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.roleIndex)},i.prototype.showPanel=function(e,t){void 0===t&&(t=11),this.model.roleIndex=e,this.model.curSelectIndex=this.partList.indexOf(t),this.show()},i.prototype.refresh=function(){this.ui.currency.refresh();var t,i,n,o=this.getItemList(),a=o.length;for(n=0;a>n;n++)t=o[n],i=this.model.roleData.getEquipInfoByPart(this.partList[n]),t.setItem(this.model,this.partList[n]),t.selected=n==this.model.curSelectIndex;t=o[this.model.curSelectIndex],i=t.equipInfo;var s,r=null!=i?this.tempUpgrade[i.getEquipId()]:null;if(null!=r&&r.nextId>0){s=this.getTempItem()[r.costList[0].id],this.itemId=s.id,this.ui.nameLabel.text=s.name;var l=e.BagController.getInstance().getCountByItemId(s.id);this.ui.numLabel.textFlow=e.GlobalUtil.createMaterialProTextFlow(l,r.costList[0].value),this.ui.icon.setItem(s.id,1,!0),this.ui.upgradeBtn.enabled=!0,this.ui.materialGroup.visible=!0}else this.itemId=-1,this.ui.icon.setItem(-1),this.ui.upgradeBtn.enabled=!1,this.ui.materialGroup.visible=!1;a=this.partList.length;var h=0;for(n=0;a>n;n++){if(i=this.model.roleData.getEquipInfoByPart(this.partList[n]),null==i){h=0;break}r=this.tempUpgrade[i.getEquipId()],0==h&&(h=r.level),r.level<h&&(h=r.level)}var c=e.JsonDataManager.instance.equipLinkTemplate,u=c[h],p=c[h+1],g=this.ui.attrLabel0;g.lineSpacing=3,this.ui.suitLabel0.text=u.level+e.LanguageUtils.instance.getValue("EQUIPLINKATT"),g.textFlow=this.getAttText(u.attTypeList,u.attValueList);var d=this.ui.suitLabel1,f=this.ui.attrLabel1;null!=p?(f.lineSpacing=3,d.text=p.level+e.LanguageUtils.instance.getValue("EQUIPLINKATT"),f.textFlow=this.getAttText(p.attTypeList,p.attValueList),d.visible=!0,f.visible=!0,this.ui.topLabel.visible=!1):(d.visible=!1,f.visible=!1,this.ui.topLabel.visible=!0)},i.prototype.getAttText=function(t,i){var n,o,a,s,r,l,h=new Array,c=t.length;for(o=0;c>o;o++)r=t[o],l=i[o],a=e.LanguageUtils.instance.getValue("ATT_"+r)+":",a+=e.GlobalUtil.getAttrValueStr(r,l)+"\n",s=e.ColorUtils.instance.getAttrColorById(r),n={text:a,style:{textColor:s}},h.push(n);return h},i.prototype.recvMsg=function(t,i){if(this.getIsShow())switch(t){case e.Code.EQUIP_EVOLUTION_S:this.refresh();break;case e.MsgCMD.REFRESH_PLAYERDATA:this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.bagItemChanged=function(){this.refresh()},i.prototype.setRoleData=function(e){this.model.roleData=e,this.refresh()},i.prototype.itemClickHandler=function(e){var t=this.getItemList().indexOf(e.currentTarget);this.setSelectItem(t)},i.prototype.setSelectItem=function(e){this.model.curSelectIndex=e;var t,i,n=this.getItemList(),o=n.length;for(t=0;o>t;t++)i=n[t],i.selected=t==this.model.curSelectIndex;this.refresh()},i.prototype.upgradeHandler=function(t){if(38==App.GuideUtils().currdbz&&5==App.GuideUtils().currxbz){var i=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(i,i.parent,38,6,!0)}var n=this.model.roleData.getEquipInfoByPart(this.partList[this.model.curSelectIndex]),o=this.tempUpgrade[n.getEquipId()],a=this.getTempItem()[o.costList[0].id];this.ui.nameLabel.text=a.name;var s=e.BagController.getInstance().getCountByItemId(a.id);if(s<o.costList[0].value)return void e.ItemNotEnoughController.getInstance().showPanel(a.id);var r=HawkProtocolManager.newBuilder("JsProto.HPEquipEvolution");r.setEquipId(n.getId()),r.setRefRareAtt(!1),e.Message.instance.send(e.Code.EQUIP_EVOLUTION_C,r,!0)},i.prototype.backHandler=function(){e.CharacterController.getInstance().showPanel(0,this.model.roleIndex,!1),this.close()},i.prototype.closeHook=function(){e.NewJueweiController.getInstance().updateNobilityData(),e.CharacterController.getInstance().guideshow(),38==App.GuideUtils().currdbz&&6==App.GuideUtils().currxbz&&(App.GuideUtils().hide(),App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()))},i.prototype.getHandler=function(t){e.ItemNotEnoughController.getInstance().showPanel(this.itemId)},i.prototype.helpHandler=function(t){e.HelpController.getInstance().showPanel("THISSUITTOHELP")},i.prototype.itemHandler=function(t){-1!=this.itemId&&e.TipsController.getInstance().showItemTips(this.itemId)},Object.defineProperty(i.prototype,"tempUpgrade",{get:function(){return e.JsonDataManager.instance.equipmentUpgradeTemplate},enumerable:!0,configurable:!0}),i.prototype.getTempItem=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e},i}(e.BasePanel);e.SuitEquipPanel=t,__reflect(t.prototype,"foxgame.SuitEquipPanel",["foxgame.IMessage","foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.panel=new e.TencentVideoPanel}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.recvMsg=function(e,t){},t.prototype.showpanel=function(){this.panel.showpanel()},t}();e.TencentVideoController=t,__reflect(t.prototype,"foxgame.TencentVideoController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this,"resource/skins/tencentvideo/TencentVideoPanelSkin.exml")||this;return t.setIsTextureCache(!0),t}return __extends(t,e),t.prototype.closeHook=function(){},t.prototype.showpanel=function(){this.getIsShow()||this.show()},t.prototype.panelChanged=function(){!this.getIsInit()||!this.getIsShow()},t.prototype.initHook=function(){this.initListener()},t.prototype.readyDestroy=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.initListener=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.btn_goSearch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIOSDownload,this),this.ui.img_sound.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIOSDownload,this),this.ui.label_search.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIOSDownload,this)},t.prototype.onClick=function(e){},t.prototype.onIOSDownload=function(e){window.open("https://iwan.qq.com/community/h5index?hidetitlebar=1&ADTAG=txsp.xyx.yxdl"),this.close()},t}(e.BasePanel);e.TencentVideoPanel=t,__reflect(t.prototype,"foxgame.TencentVideoPanel",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.TipsModel,this.soulTips=new e.SoulTips,this.itemTips=new e.BagItemTip,this.equipTips=new e.EquipTips,this.dragonTips=new e.DragonBoneTips,this.drangonArmorTips=new e.DragonArmorTipsPanel,this.skillTipsPanel=new e.DragonArmorSkillTipsPanel,this.beautyEquipTips=new e.BeautyEquipTips,this.usEquipTips=new e.UnionSiegeTips,this.godhoodTips=new e.GodHoodTips,this.limitBoxTips=new e.LimitBoxTip}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.showEquipTips=function(e){this.equipTips.showPanel(e)},t.prototype.showSoulTips=function(e,t){void 0===t&&(t=-1),this.soulTips.showPanel(e,t)},t.prototype.showItemTips=function(e,t,i){void 0===t&&(t=1),void 0===i&&(i=!1),this.itemTips.showPanel(e,t,i)},t.prototype.showLimiBOxItemTips=function(e,t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1),this.limitBoxTips.showPanel(e,t,i,n)},t.prototype.showGodHoodTips=function(e,t){this.godhoodTips.showPanel(e,t)},t.prototype.showDragonBoneTips=function(e){this.dragonTips.showPanel(e)},t.prototype.showDragonPanelByinfo=function(e){this.dragonTips.showPanelByinfo(e)},t.prototype.showDragonArmorTips=function(e,t){void 0===t&&(t=!0),this.drangonArmorTips.showPanel(e,t)},t.prototype.showDragonArmorBydata=function(e){this.drangonArmorTips.showAPanel(e)},t.prototype.showDragonArmorSkillTips=function(e){this.skillTipsPanel.showPanel(e)},t.prototype.showDemonkeeTips=function(e){this.beautyEquipTips.showPanel(e)},t.prototype.showDemonkeeTipsByinfo=function(e){this.beautyEquipTips.showPanelByinfo(e)},t.prototype.showUSTips=function(e){this.usEquipTips.showPanel(e)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ITEM_USE_S_VALUE:0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo());break;case e.Code.ITEM_LIMIT_GIFT_GET_S:0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo())}},t.prototype.closeAllPanel=function(){this.equipTips.getIsShow()&&this.equipTips.close(),this.soulTips.getIsShow()&&this.soulTips.close(),this.skillTipsPanel.getIsShow()&&this.skillTipsPanel.close(),this.itemTips.getIsShow()&&this.itemTips.close()},t}();e.TipsController=t,__reflect(t.prototype,"foxgame.TipsController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.TipsModel=t,__reflect(t.prototype,"foxgame.TipsModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.CAPRICORN=1]="CAPRICORN",e[e.AQUARIUS=2]="AQUARIUS",e[e.PISCES=3]="PISCES",e[e.ARIES=4]="ARIES",e[e.TAURUS=5]="TAURUS",e[e.GEMINI=6]="GEMINI",e[e.CANCER=7]="CANCER",e[e.LION=8]="LION",e[e.VIRGO=9]="VIRGO",e[e.LIBRA=10]="LIBRA",e[e.SCORPIO=11]="SCORPIO",e[e.SAGITTARIUS=12]="SAGITTARIUS"}(t=e.PalaceType||(e.PalaceType={}));var i;!function(e){e[e.CAN_BE_KILLED=1]="CAN_BE_KILLED",e[e.CAN_BE_SNATCHED=2]="CAN_BE_SNATCHED",e[e.OCCUPIED=3]="OCCUPIED",e[e.IN_CONTENTION=4]="IN_CONTENTION",e[e.HAVE_ESCAPED=5]="HAVE_ESCAPED"}(i=e.PalaceState||(e.PalaceState={}));var n;!function(e){e[e.KILL_BOSS=1]="KILL_BOSS",e[e.CHALLENGE_WIN=2]="CHALLENGE_WIN",e[e.CHALLENGE_FAIL=3]="CHALLENGE_FAIL",e[e.OCCUPIED=4]="OCCUPIED"}(n=e.TwelvePalaceLogType||(e.TwelvePalaceLogType={}));var o;!function(e){e.sourceList={1:"ShiEr_KeJiSha_png",2:"ShiEr_KeQiangDuo_png",3:"ShiEr_BeiZhanLing_png",4:"ShiEr_ZhengDuoZhong_png",5:"ShiEr_YiTaoZou_png"}}(o=e.TPConst||(e.TPConst={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.showSrc=0,this.num=1e7,this.model=new e.TwelvePalaceModel,this.panel=new e.TwelvePalacePanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(t,i){void 0===i&&(i=!0),this.showSrc=t;var n=parseInt(e.GlobalConfig.instance.getValue("TWELVEPALACE_OPEN_LIMIT"));return e.PlayerService.instance.level<n?(i&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("TWELVEPALACE_7",n)),!1):this.model.remainTime<=0?(i&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("TWELVEPALACE_6",n)),!1):(this.panel&&0==this.panel.getIsShow()&&this.panel.show(),!0)},t.prototype.hidePanel=function(){this.showSrc=0,this.panel&&1==this.panel.getIsShow()&&this.panel.close()},t.prototype.changeChooseType=function(e){this.model.CurChooseType=e,this.sendSingleTPInfo(e)},t.prototype.showRecordUI=function(){(null==this.recordPanel||void 0==this.recordPanel)&&(this.recordPanel=new e.TwelvePalaceRecordPanel(this.model)),this.recordPanel.show()},t.prototype.redPointStatus=function(){if(null==this.model.TpInfo)return!1;var e=this.model.Palaces;if(1==this.model.TpIsOpen)for(var t=0;t<e.length;t++)if(1==this.checkShowRed(e[t]))return!0;return!1},t.prototype.checkShowRed=function(t){var i=!1,n=e.PlayerService.instance.playerInfo.getVipLevel(),o=t.getChallengeCount(),a=t.getBuyCout(),s=e.JsonDataManager.instance.vipTemplate[n],r=this.model.getIsOccupy(t),l=r?s.palaceChallengeTimes:s.palaceBossBattleTimes,h=l+a,c=h-o;return i=1==this.model.showLogRed(t.getPalaceType())||c>0?!0:!1},t.prototype.registerMsg=function(t){t.add(e.Code.TIME_PLAY_METHOD_PUSH,this),t.add(e.Code.TWELVE_PALACE_INFO_S,this),t.add(e.Code.ONE_PALACE_INFO_S,this),t.add(e.Code.PALACE_STATE_CHANGE_S,this),t.add(e.Code.BUY_PALACE_CHALLENGE_NUM_S,this),t.add(e.Code.TWELVE_PALACE_CHALLENGE_OCCUPIED_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.TIME_PLAY_METHOD_PUSH:this.setTwelvePalaceTime(i);break;case e.Code.TWELVE_PALACE_INFO_S:this.tp_infoBack(i);break;case e.Code.ONE_PALACE_INFO_S:this.tp_singleInfoBack(i);break;case e.Code.PALACE_STATE_CHANGE_S:this.tp_stateChange(i);break;case e.Code.BUY_PALACE_CHALLENGE_NUM_S:this.tp_buyChallenge(i);break;case e.Code.TWELVE_PALACE_CHALLENGE_OCCUPIED_S:this.tp_challengeOcuppied(i)}},t.prototype.refreshMainUI=function(){this.panel&&1==this.panel.getIsShow()&&this.panel.refreshUI()},t.prototype.setTwelvePalaceTime=function(t){t.getPlayType()==e.TimePlayMethodType.TWELVE_PALACE&&(Log.trace("clientReceiveTp"+t.getOpen()),Log.trace("clientReceiveTpTime"+t.getRemainingTime()),this.model.remainTime=-1,this.model.lastRemainTime=-1,egret.stopTick(this.tick,this),this.model.isOpen=t.getOpen(),this.model.curTimer=Date.parse((new Date).toString()),this.model.remainTime=this.model.curTimer+t.getRemainingTime(),t.getOpen()&&(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.TWELVEPALACE,!0),egret.startTick(this.tick,this),this.panel&&this.panel.getIsShow()&&this.sendTPInfo()))},t.prototype.tick=function(e){var t=Date.parse((new Date).toString());this.model.lastRemainTime<=0&&(this.model.lastRemainTime=t);var i=t-this.model.lastRemainTime;return 1e3>i?!1:(this.model.lastRemainTime=t,this.model.remainTime-=i,this.model.remainTime<=this.model.curTimer&&egret.stopTick(this.tick,this),!0)},t.prototype.sendTPInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.TwelvePalaceInfoReq");e.Message.instance.send(e.Code.TWELVE_PALACE_INFO_C,t,!0)},t.prototype.tp_infoBack=function(e){if(this.model.TpInfo=e,this.model.CurChooseType){var t=e.getPalaces(),i=!1;for(var n in t){var o=t[n];if(o.getPalaceType()==this.model.CurChooseType){i=!0;break}}i||(this.model.CurChooseType=t[0].getPalaceType())}else this.model.CurChooseType=e.getPalaces()[0].getPalaceType();this.setRemainTime(),this.refreshMainUI()},t.prototype.setRemainTime=function(){1==this.model.TpIsOpen?this.model.TP_remainTime=this.model.TpInfo.getEntTime()-this.model.TpInfo.getCurrTime():this.model.TP_remainTime=this.model.TpInfo.getNextTime()-this.model.TpInfo.getCurrTime(),this.model.TP_remainTime>0&&(this.stopRemainTick(),egret.startTick(this.remainTick,this))},t.prototype.stopRemainTick=function(){this.model.tpLastRemainTime=-1,egret.stopTick(this.remainTick,this)},t.prototype.remainTick=function(e){this.model.tpLastRemainTime<=0&&(this.model.tpLastRemainTime=e);var t=e-this.model.tpLastRemainTime;if(1e3>t)return!1;this.model.tpLastRemainTime=e,this.model.tpRemainTime-=t;var i=Math.floor(this.model.tpRemainTime/1e3);return this.model.tpRemainTime<=0&&(i=-1,this.stopRemainTick()),!0},t.prototype.sendSingleTPInfo=function(t){var i=HawkProtocolManager.newBuilder("JsProto.OnePalaceInfoReq");i.setType(t),e.Message.instance.send(e.Code.ONE_PALACE_INFO_C,i,!0)},t.prototype.tp_singleInfoBack=function(e){e.getErrorNo()>0||(this.model.changeOneData(e.getInfo()),this.refreshMainUI())},t.prototype.tp_stateChange=function(e){null!=this.model.Palaces&&(this.model.changeOneStatus(e.getType(),e.getState()),this.panel.refreshOneStatus(e.getType(),e.getState()))
},t.prototype.sendBuyChallenge=function(){var t=HawkProtocolManager.newBuilder("JsProto.BuyChallengeNumReq"),i=this.model.CurChooseType;t.setType(i),e.Message.instance.send(e.Code.BUY_PALACE_CHALLENGE_NUM_C,t,!0)},t.prototype.tp_buyChallenge=function(e){this.model.changeChallengeTimes(e),this.refreshMainUI()},t.prototype.send_challengeOccupied=function(t){var i=HawkProtocolManager.newBuilder("JsProto.ChallengeOccupiedReq");i.setType(t),e.Message.instance.send(e.Code.TWELVE_PALACE_CHALLENGE_OCCUPIED_C,i,!0)},t.prototype.tp_challengeOcuppied=function(t){var i=t.getErrorNo();5040==i?this.showTipGiveUpOccupy():t.getBattleInfo()&&(this.challengeOccupiedBattle=t,e.BattleService.instance.battle_info(t.getBattleInfo()))},t.prototype.showTipGiveUpOccupy=function(){e.PopUpController.getInstance().showTextPanel("您已占领其他星宫，是否放弃？",this,function(){var t=HawkProtocolManager.newBuilder("JsProto.HPGiveUpHoldPalaceReq"),i=e.PlayerService.instance.playerInfo.getPlayerId();t.setPlayerId(i),e.Message.instance.send(e.Code.TWELVE_PALACE_GIVE_UP_C,t,!0)})},t.prototype.tp_challengeMonster=function(t){var i=e.WorldSceneType.TwelvePalaceBossBattleMap,n=t,o=e.WorldSceneType.OldMonsterBattleMap,a=1;e.BattleScene.instance.sendMsgSceneChangeRequest(i,n,o,a)},t.prototype.getModel=function(){return this.model},t.prototype.getRemainTime=function(){return this.model.remainTime-this.model.curTimer},t.prototype.getChanllengeCountByType=function(e){if(null==this.model.TpInfo||null==this.model.getInfoByType(e))return-1;var t=this.model.getInfoByType(e);return t.getChallengeCount()},t.prototype.setChanllengeCountByType=function(e,t){var i=this.model.getInfoByType(e);i.setChallengeCount(t)},t.prototype.refreshChallengeCountByType=function(e,t){if(null!=this.model.TpInfo&&null!=this.model.getInfoByType(e)){var i=this.model.getInfoByType(e);i.setChallengeCount(i.getChallengeCount()+t)}},t.prototype.getCanChallengeTimes=function(t){if(null==this.model.TpInfo||null==this.model.getInfoByType(t))return-1;var i=this.model.getInfoByType(t),n=this.model.getIsOccupy(i),o=e.PlayerService.instance.playerInfo.getVipLevel(),a=e.JsonDataManager.instance.vipTemplate[o],s=n?a.palaceChallengeTimes:a.palaceBossBattleTimes,r=i.getBuyCout(),l=s+r-Number(i.getChallengeCount());return l},t}();e.TwelvePalaceController=t,__reflect(t.prototype,"foxgame.TwelvePalaceController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.curChooseType=null,e.remainTime=-1,e.lastRemainTime=-1,e.curTimer=-1,e.isOpen=!1,e.tpRemainTime=-1,e.tpLastRemainTime=-1,e.tp_challengeLogDp=new eui.ArrayCollection,e.lastShowLogTm=-1,e}return __extends(i,t),Object.defineProperty(i.prototype,"TpInfo",{get:function(){return this.tpInfo},set:function(e){this.tpInfo=e},enumerable:!0,configurable:!0}),i.prototype.getTp_challengeLog=function(e){for(var t=this.Palaces,i=0;i<t.length;i++)if(t[i].getPalaceType()==e)return t[i].getLogs();return[]},Object.defineProperty(i.prototype,"LastShowLogTm",{get:function(){return this.lastShowLogTm},set:function(e){this.lastShowLogTm=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Tp_challengeLogDp",{get:function(){return this.tp_challengeLogDp},set:function(e){this.tp_challengeLogDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"TpIsOpen",{get:function(){return this.tpInfo?this.tpInfo.getOpen():!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Palaces",{get:function(){return this.tpInfo?this.tpInfo.getPalaces():null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CurChooseType",{get:function(){return this.curChooseType},set:function(e){this.curChooseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"TP_remainTime",{get:function(){return this.tpRemainTime},set:function(e){this.tpRemainTime=e},enumerable:!0,configurable:!0}),i.prototype.changeOneData=function(e){for(var t=this.Palaces,i=0;i<t.length;i++)if(t[i].getPalaceType()==e.getPalaceType())return void(t[i]=e)},i.prototype.changeOneStatus=function(e,t){for(var i=this.Palaces,n=0;n<i.length;n++)if(i[n].getPalaceType()==e)return void i[n].setPalaceState(t)},i.prototype.getTypeByIndex=function(e){var t=this.Palaces;return t[e].getPalaceType()},i.prototype.getCurTPInfo=function(){for(var e=this.Palaces,t=0;t<e.length;t++)if(e[t].getPalaceType()==this.curChooseType)return e[t];return null},i.prototype.getIsOccupy=function(t){return t.getPalaceState()==e.PalaceState.OCCUPIED?!0:!1},i.prototype.getInfoByType=function(e){for(var t=this.Palaces,i=0;i<t.length;i++)if(t[i].getPalaceType()==e)return t[i];return null},i.prototype.changeChallengeTimes=function(e){for(var t=this.Palaces,i=0;i<t.length;i++)if(t[i].getPalaceType()==e.getType()){t[i].setBuyCout(e.getBuyCout()),t[i].setChallengeCount(e.getChallengeCount());break}},i.prototype.ownHasPalace=function(){for(var t=this.Palaces,i=e.PlayerService.instance.playerInfo.getPlayerId(),n=0;n<t.length;n++)if(t[n].getOccupiedId()==i&&1!=t[n].getPalaceState())return!0;return!1},i.prototype.showLogRed=function(t){var i=this.getInfoByType(t),n=!1;return(i.getOccupiedId()==e.PlayerService.instance.playerInfo.getPlayerId()&&i.getLogs[0]&&i.getLogs[0].getTimeStamp()!=this.LastShowLogTm||-1==this.LastShowLogTm&&i.getLogs[0])&&(n=!0),n},i}(egret.EventDispatcher);e.TwelvePalaceModel=t,__reflect(t.prototype,"foxgame.TwelvePalaceModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.data=null,e.playerData=new eui.ArrayCollection,e.timeHandler=null,e.timeCount=0,e.attackHandler=null,e.attackCount=0,e.alive=!0,e.skinName="TwelvePalaceBattleSkin",e}return __extends(i,t),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.resize(),this.show()},i.prototype.initUI=function(){this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLeft,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRight,this),this.playerList.viewport=this.players;var t=this.players;t.itemRenderer=e.TwelvePalaceBattlePlayerHeadItem,t.dataProvider=this.playerData},i.prototype.show=function(){e.Message.instance.add(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,this),e.Message.instance.add(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_PLAYER,this),e.Message.instance.add(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_TARGET,this),e.Message.instance.add(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,this),StageFrameControl.instance.mainUILayer.addChild(this),e.MainControler.instance.adaptChatPos(!0),e.BossBloodGroup.getInstance().adaptButtonPos(!0),this.leftBtn.visible=!0,this.rightBtn.visible=!0;var t=250,i=1e3;egret.Tween.pauseTweens(this.zhan),egret.Tween.removeTweens(this.zhan),this.zhan.y=43,egret.Tween.get(this.zhan,{loop:!0}).to({y:this.zhan.y-5},t).to({y:this.zhan.y},t).wait(4*t+i),egret.Tween.pauseTweens(this.dou),egret.Tween.removeTweens(this.dou),this.dou.y=43,egret.Tween.get(this.dou,{loop:!0}).wait(2*t).to({y:this.dou.y-5},t).to({y:this.dou.y},t).wait(2*t+i),egret.Tween.pauseTweens(this.zhong),egret.Tween.removeTweens(this.zhong),this.zhong.y=43,egret.Tween.get(this.zhong,{loop:!0}).wait(4*t).to({y:this.zhong.y-5},t).to({y:this.zhong.y},t).wait(i)},i.prototype.close=function(){App.MessageCenter.removeListener("resizeWindowHandler",this.resize,this),e.Message.instance.remove(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON,this),e.Message.instance.remove(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_PLAYER,this),e.Message.instance.remove(e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_TARGET,this),e.Message.instance.remove(e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON,this),this.clearTimeTimer(),this.clearAttackTimer(),egret.Tween.pauseTweens(this.zhan),egret.Tween.removeTweens(this.zhan),egret.Tween.pauseTweens(this.dou),egret.Tween.removeTweens(this.dou),egret.Tween.pauseTweens(this.zhong),egret.Tween.removeTweens(this.zhong),this.parent&&this.parent.removeChild(this),e.MainControler.instance.adaptChatPos(!1),e.BossBloodGroup.getInstance().adaptButtonPos(!1)},i.prototype.resize=function(){e.GamePlatform.isQQdating?this.width=ScreenAdaptation.instance.screenWidth:this.width=ScreenAdaptation.instance.uiWidth},i.prototype.recvMsg=function(t,i){switch(t){case e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_BUTTON:this.refreshBtn(i);break;case e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_PLAYER:this.refreshPlayer(i);break;case e.MsgCMD.TWELVE_PALACE_REFRESH_BATTLE_TARGET:this.refreshTarget(i);break;case e.MsgCMD.TWELVE_PALACE_HIDE_BATTLE_BUTTON:this.hideBtn(i)}},i.prototype.refreshPlayer=function(e){if(e.blood){var t=[];e.player&&e.blood[e.player]&&(t.push(e.blood[e.player]),t[0].isOwner=!0);for(var i in e.blood)i!=e.player&&t.push(e.blood[i]);this.playerData.replaceAll(t)}},i.prototype.refreshBtn=function(e){e.alive?(this.alive=!0,this.refreshAttackBtn(e)):(this.alive=!1,this.refreshRebornBtn(e))},i.prototype.refreshAttackBtn=function(e){if(this.deadBg.visible=!1,this.clearTimeTimer(),e.type){var t=e.type,i=this.leftBtn,n=this.rightBtn;switch(t){case 1:i.currentState="down",i.labelDisplay.text="正在攻击boss",i.touchEnabled=!1,n.currentState="disabled",n.labelDisplay.text="我是归属者",n.touchEnabled=!1;break;case 2:i.currentState="down",i.labelDisplay.text="正在攻击boss",i.touchEnabled=!1,n.currentState="up",n.labelDisplay.text="攻击归属者",n.touchEnabled=!0;break;case 3:i.currentState="disabled",i.labelDisplay.text="攻击boss",i.touchEnabled=!1,n.currentState="down",n.labelDisplay.text="正在攻击归属者",n.touchEnabled=!1;break;case 4:i.currentState="disabled",i.labelDisplay.text="攻击boss",i.touchEnabled=!1,n.currentState="disabled",n.labelDisplay.text="我是归属者",n.touchEnabled=!1}this.leftLabel.visible=!1}},i.prototype.refreshRebornBtn=function(t){this.deadBg.visible=!0,this.sceneType=t.battleType;var i=this.leftBtn,n=this.rightBtn;if(Log.trace("刷新数据的type值 :"+this.sceneType),i.currentState="up",i.labelDisplay.text="立即复活",i.touchEnabled=!0,n.currentState="up",n.touchEnabled=!0,this.startTimeTimer(),this.sceneType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER)return this.leftLabel.text="",i.labelDisplay.text="等待复活",void(n.labelDisplay.text="选择BOSS");var o=this.leftLabel,a=e.TwelvePalaceController.getInstance().getCanChallengeTimes(t.sceneId);a=a>1?a-1:0,o.textFlow=new Array({text:"剩余次数:",style:{textColor:15655878}},{text:""+a,style:{textColor:2227971}}),this.leftLabel.visible=!0},i.prototype.refreshTarget=function(e){this.targetHead.source=e.icon,this.targetHead.x=e.x-e.width/2,this.targetHead.y=e.y-e.height/2,this.targetHead.width=e.width,this.targetHead.height=e.height,this.targetName.text=e.name},i.prototype.hideBtn=function(e){this.leftBtn.visible=!1,this.rightBtn.visible=!1},i.prototype.timeTick=function(){this.sceneType==e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER?this.timeCount>0?(this.leftBtn.labelDisplay.textFlow=new Array({text:"等待复活",style:{size:22}},{text:"("+this.timeCount+")",style:{size:20}}),this.timeCount--):(this.clearTimeTimer(),e.BattleScene.instance.sendMsgScenePlayerReliveRequest()):this.timeCount>0?(this.rightBtn.labelDisplay.textFlow=new Array({text:"选择星宫",style:{size:22}},{text:"("+this.timeCount+")",style:{size:20}}),this.timeCount--):(this.clearTimeTimer(),this.onBtnRight(null))},i.prototype.startTimeTimer=function(){this.clearTimeTimer(),this.timeCount=10,this.timeHandler=setInterval(this.timeTick.bind(this),1e3),this.timeTick()},i.prototype.clearTimeTimer=function(){this.timeHandler&&(clearInterval(this.timeHandler),this.timeHandler=null)},i.prototype.attackTick=function(){this.timeCount>0||(this.attackBg.visible=!1)},i.prototype.startAttackTimer=function(){this.clearAttackTimer(),this.attackCount=3,this.attackBg.visible=!0,this.attackHandler=setInterval(this.attackTick.bind(this),1e3),this.attackTick()},i.prototype.clearAttackTimer=function(){this.attackHandler&&(clearInterval(this.attackHandler),this.attackHandler=null)},i.prototype.onBtnLeft=function(t){this.alive?e.BattleScene.instance.sendMsgBattleInfoUpdateRequest(1):this.sceneType!=e.BattleType.CS_PVE_BATTLE_BOSS_AND_PALYER&&e.BattleScene.instance.sendMsgScenePlayerReliveRequest()},i.prototype.onBtnRight=function(t){this.alive?e.BattleScene.instance.sendMsgBattleInfoUpdateRequest(2):e.BattleScene.instance.quitFuBen()},i._instance=null,i}(eui.Component);e.TwelvePalaceBattlePanel=t,__reflect(t.prototype,"foxgame.TwelvePalaceBattlePanel",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/twelvePalace/TwelvePalaceBattlePlayerHeadSkin.exml",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.refresh()},t.prototype.refresh=function(){var e=this.data.curHp/this.data.maxHp||1;this.blood.mask=new egret.Rectangle(0,this.blood.height*(1-e),this.blood.width,this.blood.height*e),this.playerHead.source=this.data.icon,this.playerHead.width=66,this.playerHead.height=66,this.data.union?(this.unionName.text="【"+this.data.union+"】",this.unionName.visible=!0,this.playerName.text=this.data.name,this.playerName.y=24):(this.unionName.visible=!1,this.playerName.text=this.data.name,this.playerName.y=15),this.guishuzhe.visible=!!this.data.isOwner},t}(eui.ItemRenderer);e.TwelvePalaceBattlePlayerHeadItem=t,__reflect(t.prototype,"foxgame.TwelvePalaceBattlePlayerHeadItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="TwelvePalaceIconSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addLister()},i.prototype.addLister=function(){},i.prototype.init=function(){},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this)},i.prototype.refreshUI=function(t,i){this.tpType=t,this.status=i,this.statusImg.source=e.TPConst.sourceList[i];var n=e.TwelvePalaceController.getInstance().getModel();this.imgClick.visible=n.CurChooseType==t?!0:!1;var o=e.JsonDataManager.instance.twelvePalaceTemplate[t];this.itemName.text=o.name;var a=n.getInfoByType(this.tpType);this.redPoint.visible=1==n.TpIsOpen&&e.TwelvePalaceController.getInstance().checkShowRed(a),3==this.status?(this.itemName.y=20,this.playerName.visible=!0):(this.itemName.y=29,this.playerName.visible=!1)},i.prototype.refreshPlayerName=function(e){this.playerName.text=e||"(虚位以待)"},i.prototype.closeUI=function(){},Object.defineProperty(i.prototype,"TpType",{get:function(){return this.tpType},enumerable:!0,configurable:!0}),i}(eui.ItemRenderer);e.TwelvePalaceIconItem=t,__reflect(t.prototype,"foxgame.TwelvePalaceIconItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/twelvePalace/TwelvePalaceSkin.exml","twelvePalace")||this;return i.modelMonsterId=null,i.stayBeginTime=-1,i.status=-1,i.model=e,i.isMask=!1,i.setIsShowTween(!1),i.setRegisterTick(!0),i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.initUI(),this.addLister(),this.doScreenAdaptation()},i.prototype.initUI=function(){this.ui.challengeList.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("TWELVEPALACE_1")),this.bossUnderAni=new e.FoxAni(this.ui.bossUnderHalo),this.bossUnderAni.frameRate=6,this.bossUnderAni.play("BOSSgh","ani",-1),this.ui.openDesc.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("TWELVEPALACE_6")),egret.Tween.get(this.ui.firstAvatar,{loop:!0}).wait(350).to({scaleX:1.03,scaleY:1.04},1e3).wait(150).to({scaleX:1,scaleY:1},1e3),this.monsterModel=new egret.MovieClip,this.monsterModel.name="mChest",this.monsterModel.frameRate=6,this.monsterModel.scaleX=1.2,this.monsterModel.scaleY=1.2,this.ui.bossGroup.addChild(this.monsterModel),this.ui.playerScale.scaleX=.7,this.ui.playerScale.scaleY=.7},i.prototype.addLister=function(){this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpHandler,this),this.ui.challengeList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickChallengeLogHandler,this),this.ui.plusBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickPlusHandler,this),this.ui.challengeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickChallengeHandler,this);for(var e=this.getItemList(),t=0;t<e.length;t++)e[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItemHandler,this);for(var t=0;t<this.getAwdList().length;t++){var i=this.getAwdList()[t];i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.removeLister=function(){this.ui.challengeList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickChallengeLogHandler,this),this.ui.plusBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickPlusHandler,this),this.ui.challengeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickChallengeHandler,this);for(var e=this.getItemList(),t=0;t<e.length;t++){var i=this.getItemList();i[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickItemHandler,this)}for(var t=0;t<this.getAwdList().length;t++){var n=this.getAwdList()[t];n.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.showHook=function(){t.prototype.showHook.call(this),e.TwelvePalaceController.getInstance().sendTPInfo(),this.refreshUI()},i.prototype.helpHandler=function(t){var i="SHIERXINGGONGHELP";e.HelpController.getInstance().showPanel(i)},i.prototype.clickChallengeLogHandler=function(t){e.TwelvePalaceController.getInstance().showRecordUI()},i.prototype.clickPlusHandler=function(t){var i=e.PlayerService.instance.playerInfo.getVipLevel(),n=this.model.getCurTPInfo(),o=this.model.getIsOccupy(n),a=e.JsonDataManager.instance.vipTemplate[i],s=o?a.buyPalaceChallengeTimes:a.buyPalaceBossBattleTimes,r=n.getBuyCout(),l=Number(e.GlobalConfig.instance.getValue("SHIERXINGGONG_GMJG"))+Number(e.GlobalConfig.instance.getValue("SHIERXINGGONG_JGXS"))*(r+1);if(l>e.PlayerService.instance.playerInfo.getGold())return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");if(r>=s)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYBUYTIMESNOTICE"));var h=e.LanguageUtils.instance.getValue("CSARENA_24",l,s-r);e.PopUpController.getInstance().showTextPanel(h,this,e.TwelvePalaceController.getInstance().sendBuyChallenge.bind(e.TwelvePalaceController.getInstance()))},i.prototype.clickChallengeHandler=function(t){var i=this.model.getCurTPInfo(),n=this.model.getIsOccupy(i),o=this.model.CurChooseType,a=e.TwelvePalaceController.getInstance().getCanChallengeTimes(o);return 0>=a?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CSARENA_47")):void(n?this.challengePlayer():this.challengeBoss())},i.prototype.challengePlayer=function(){var t=this.model.ownHasPalace(),i=this.model.getCurTPInfo();if(1==t){if(i.getOccupiedId()==e.PlayerService.instance.playerInfo.getPlayerId())return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("TWELVEPALACE_8"));e.TwelvePalaceController.getInstance().showTipGiveUpOccupy()}else e.TwelvePalaceController.getInstance().send_challengeOccupied(i.getPalaceType()),i.getOccupiedId()&&0!=i.getOccupiedId()&&this.close()},i.prototype.challengeBoss=function(){var t=this.model.ownHasPalace(),i=this.model.getCurTPInfo();1==t?e.TwelvePalaceController.getInstance().showTipGiveUpOccupy():e.TwelvePalaceController.getInstance().tp_challengeMonster(i.getPalaceType())},i.prototype.clickItemHandler=function(t){var i=t.currentTarget;e.TwelvePalaceController.getInstance().changeChooseType(i.TpType),this.resetStatus()},i.prototype.refreshOneStatus=function(e,t){if(0!=this.getIsShow())for(var i=this.getItemList(),n=0;n<i.length;n++){var o=i[n];if(o.TpType==e){o.refreshUI(e,t);break}}},i.prototype.refreshUI=function(){this.ui.currency.refresh(),null!=this.model.TpInfo&&(this.resetStatus(),this.refreshItemList(),this.refreshGp(),this.refreshAwdList(),this.refreshChallengeTimes(),this.refreshChallengeBtn(),this.refreshRedPoint())},i.prototype.refreshItemList=function(){for(var e=this.model.Palaces,t=this.getItemList(),i=0;i<t.length;i++){var n=e[i];n&&(t[i].refreshUI(n.getPalaceType(),n.getPalaceState()),t[i].refreshPlayerName(n.getOccupiedName()))}},i.prototype.refreshGp=function(){this.ui.gp_1.visible=this.ui.gp_2.visible=this.ui.gp_3.visible=!1;var e=this.model.getCurTPInfo();if(null!=e){var t=this.model.getIsOccupy(e);t?e.getOccupiedId()&&0!=e.getOccupiedId()?this.showGp_2(e):this.showGp_3(e):this.showGp_1(e)}},i.prototype.showGp_1=function(t){this.ui.gp_1.visible=!0,this.ui.challengeName.text=t.getOccupiedName()?t.getOccupiedName():"    空",this.ui.challengeUnion.text=t.getOccupiedUnionName()?t.getOccupiedUnionName():"",this.ui.challengeUnion.x=this.ui.challengeName.x+this.ui.challengeName.width+5;var i=e.JsonDataManager.instance.twelvePalaceTemplate[this.model.CurChooseType],n=e.JsonDataManager.instance.mapTemplate[i.mapId],o=e.JsonDataManager.instance.monster[n.bossId],a=this.model.getInfoByType(this.model.CurChooseType);this.ui.palaceName.text=o.name,this.ui.hpText.text=a.getBoosHp()+"/"+o.hp,this.ui.barMask.scaleX=Number(a.getBoosHp())/Number(o.hp),this.refreshBossAni(o)},i.prototype.showGp_2=function(t){this.ui.gp_2.visible=!0;var i=e.JsonDataManager.instance.twelvePalaceTemplate[this.model.CurChooseType];this.ui.occupyTitle.text=i.name+"占领者";var n="",o=Number(t.getOccupiedMaxHp());t.getOccupiedName()&&(n=t.getOccupiedName()+"　Lv."+t.getOccupiedLevel()),this.ui.occupyName.text=n,this.ui.occupyUnion.text=t.getOccupiedUnionName(),this.ui.hpNum.text=t.getBoosHp()+"/"+o,this.ui.barMask0.x=76,this.ui.barMask0.scaleX=Number(t.getBoosHp())/o,this.refreshCharater(t),this.ui.vipImg.source="u_vip"+(t.getOccupiedVipLevel()||0)+"_png"},i.prototype.showGp_3=function(t){this.ui.gp_3.visible=!0;var i=e.JsonDataManager.instance.twelvePalaceTemplate[this.model.CurChooseType];this.ui.occupyTitleEmpty.text=i.name+"占领者(空)"},i.prototype.refreshBossAni=function(e){this.refreshMonster(e.id)},i.prototype.refreshMonster=function(t){if(!this.modelController||!this.modelMonsterId||this.modelMonsterId!=t){this.modelMonsterId=t;var i=e.ActionUtils.CreateActionInfoByMonsterId(t);this.modelController?this.modelController.refreshAction(i):this.modelController=new e.ActionController(i,this.ui.bossGroup),this.modelController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_RUN,5)}},i.prototype.refreshCharater=function(t){var i=t.getOccupiedAvatar();i&&(this.ui.firstAvatar.setAvatar(i.getRoleItemId(),i.getClothingId(),i.getWeaponId(),i.getWingId(),Number(i.getFashionClothesId()),Number(i.getFashionWeaponId()),Number(i.getFashionWingId()),Number(i.getDragonArmourGuardLevel()),Number(i.getDragonBoneGuardLevel())),this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.titleAni=new e.FoxAni(this.ui.aniGroup),this.titleAni.play("medal_"+t.getOccupiedTitleId(),"ani",-1))},i.prototype.refreshAwdList=function(){var t=this.model.getCurTPInfo();if(null!=t){var i=this.model.getIsOccupy(t);this.ui.awdTitle.text=i?"占领奖励":"BOSS掉落";for(var n=i?"award":"showAWD",o=e.JsonDataManager.instance.twelvePalaceTemplate[this.model.CurChooseType],a=o[n],s=a.split(","),r=0;r<s.length;r++){var l=new e.AttributeVO(s[r]),h=this.getAwdList()[r];h.setItem(l.id,l.value,!0,!0)}}},i.prototype.refreshChallengeTimes=function(){var t=e.PlayerService.instance.playerInfo.getVipLevel(),i=this.model.getCurTPInfo(),n=i.getChallengeCount(),o=i.getBuyCout(),a=e.JsonDataManager.instance.vipTemplate[t],s=this.model.getIsOccupy(i),r=s?a.palaceChallengeTimes:a.palaceBossBattleTimes,l=r+o,h=l-n;this.ui.playTimesDes.text=s?"占领剩余次数：":"BOSS剩余次数：",this.ui.playTimes.text=h+"次"},i.prototype.refreshChallengeBtn=function(){var t=0,i=this.model.TpIsOpen,n=this.model.getCurTPInfo(),o=n.getPalaceState();i?1==o||2==o||4==o?t=0:3==o&&(t=1):t=2;var a="参与挑战",s=!1;switch(t){case 0:break;case 1:a="挑战星宫";break;case 2:a="未开启",s=!0}this.ui.challengeBtn.label=a,this.ui.challengeBtn.filters=s?e.GlobalUtil.grayFilter:[]},i.prototype.refreshTime=function(){var t=this.model.TpIsOpen;this.ui.timeTitle.text=t?"活动剩余时间：":"活动即将开启：";var i=this.model.TP_remainTime;i>0&&(this.ui.timeLabel.text=e.GlobalUtil.getTimeString(i/1e3,2))},i.prototype.resetStatus=function(){this.status=0,this.stayBeginTime=-1},i.prototype.onClick=function(t){e.TipsController.getInstance().showItemTips(t.target.itemId)},i.prototype.tickHook=function(e){this.refreshSingle(e),this.refreshTime()},i.prototype.refreshSingle=function(t){switch(this.status){case-1:this.stayBeginTime=-1;break;case 0:-1==this.stayBeginTime?this.stayBeginTime=t:t-this.stayBeginTime>=2e3&&(this.status=1,this.stayBeginTime=-1);break;case 1:this.resetStatus(),e.TwelvePalaceController.getInstance().sendSingleTPInfo(this.model.CurChooseType)}},i.prototype.refreshRedPoint=function(){this.ui.redPoint.visible=1==this.model.TpIsOpen&&this.model.showLogRed(this.model.CurChooseType)},i.prototype.backHandler=function(){e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"TwelvePalacePanel",tag:"getCloseBtn",battleType:e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER}),this.close()},i.prototype.closeH=function(t){e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"TwelvePalacePanel",tag:"getCloseBtn",battleType:e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER}),this.close()},i.prototype.readyDestroy=function(){this.removeLister()},i.prototype.closeHook=function(){this.bossAni&&(this.bossAni.clear(),this.bossAni=null),this.titleAni&&(this.titleAni.clear(),this.titleAni=null),this.bossUnderAni&&(this.bossUnderAni.clear(),this.bossUnderAni=null),null!=this.modelController&&(this.modelController.release(),this.modelController=null),this.modelMonsterId=null,4==e.TwelvePalaceController.getInstance().showSrc&&e.WanFaController.getInstance().showPanel()},i.prototype.getItemList=function(){for(var e=[],t=0;5>=t;t++)e.push(this.ui["item_"+t]);return e},i.prototype.getAwdList=function(){var e=[];return e.push(this.ui.awd_0),e.push(this.ui.awd_1),e.push(this.ui.awd_2),e.push(this.ui.awd_3),e},i}(e.BasePanel);e.TwelvePalacePanel=t,__reflect(t.prototype,"foxgame.TwelvePalacePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/twelvePalace/TwelvePalaceRebornSkin.exml")||this;return e.timerCount=0,e.timerHandler=null,e.enemy="",e.sceneId=0,e.data=null,e}return __extends(i,t),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.initHook=function(){this.ui.rebornBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickReborn,this),this.ui.quitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickQuit,this)},i.prototype.closeHook=function(){this.clearTimer()},i.prototype.onClickReborn=function(t){e.BattleScene.instance.sendMsgScenePlayerReliveRequest()},i.prototype.onClickQuit=function(t){e.BattleScene.instance.quitFuBen(),e.TwelvePalaceController.getInstance().showPanel(2),this.close()},i.prototype.showPanel=function(e){this.data=e;this.show()},i.prototype.showHook=function(){if(this.data){var t=this.data;this.enemy=t.enemy,this.sceneId=t.sceneId,this.show(),this.startTimer(),this.sceneId&&(this.ui.timesLabel.text=""+e.TwelvePalaceController.getInstance().getCanChallengeTimes(this.sceneId))}},i.prototype.tick=function(){this.timerCount>0?(this.ui.timerLabel.text="你被"+this.enemy+"击败，"+this.timerCount+"秒后退出",this.timerCount--):(this.clearTimer(),this.onClickQuit(null))},i.prototype.startTimer=function(){this.clearTimer(),this.timerCount=10,this.timerHandler=setInterval(this.tick.bind(this),1e3),this.tick()},i.prototype.clearTimer=function(){this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null)},i.prototype.childrenCreated=function(){this.doScreenAdaptation()},i._instance=null,i}(e.BasePanel);e.TwelvePalaceRebornPanel=t,__reflect(t.prototype,"foxgame.TwelvePalaceRebornPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="resource/skins/twelvePalace/TwelvePalaceRecordItem.exml",e.touchEnabled=e.touchChildren=!1,e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.setTime(),this.setContent()},i.prototype.setTime=function(){var t=new Date(1e3*this.data.getTimeStamp()),i=t.getMonth()+1+e.LanguageUtils.instance.getValue("YUE"),n=t.getDate()+e.LanguageUtils.instance.getValue("RI"),o=t.getHours()+":",a=t.getMinutes(),s=i+n+o+a;this.timeLabel.text=s},i.prototype.setContent=function(){var t="TWELVEPALACE_2",i="",n=this.data,o=e.TwelvePalaceController.getInstance().getModel(),a=e.JsonDataManager.instance.twelvePalaceTemplate[o.CurChooseType];switch(this.data.getLogType()){case e.TwelvePalaceLogType.KILL_BOSS:i=e.LanguageUtils.instance.getValue(t,n.getName1(),a.name);break;case e.TwelvePalaceLogType.CHALLENGE_WIN:t="TWELVEPALACE_4",i=e.LanguageUtils.instance.getValue(t,n.getName1(),n.getName2());break;case e.TwelvePalaceLogType.CHALLENGE_FAIL:t="TWELVEPALACE_3",i=e.LanguageUtils.instance.getValue(t,n.getName1(),n.getName2());break;case e.TwelvePalaceLogType.OCCUPIED:t="TWELVEPALACE_5",i=e.LanguageUtils.instance.getValue(t,n.getName1(),a.name)}this.contentLabel.textFlow=(new egret.HtmlTextParser).parser(i)},i}(eui.ItemRenderer);e.TwelvePalaceRecordItem=t,__reflect(t.prototype,"foxgame.TwelvePalaceRecordItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/twelvePalace/TwelvePalaceRecordSkin.exml",null)||this;return i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){},i.prototype.initUI=function(){this.ui.recordList.itemRenderer=e.TwelvePalaceRecordItem,this.ui.recordList.dataProvider=this.model.Tp_challengeLogDp,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.recordList},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.showHook=function(){this.refreshUI()},i.prototype.refreshUI=function(){null!=this.model.TpInfo&&this.showScrollerList()},i.prototype.showScrollerList=function(){var t=this.model.getTp_challengeLog(this.model.CurChooseType);this.model.getCurTPInfo().getOccupiedId()==e.PlayerService.instance.playerInfo.getPlayerId()&&(this.model.LastShowLogTm=t[0]?t[0].getTimeStamp():-1),this.model.Tp_challengeLogDp.replaceAll(t)},i}(e.BasePanel);e.TwelvePalaceRecordPanel=t,__reflect(t.prototype,"foxgame.TwelvePalaceRecordPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function n(){var e=t.call(this,"resource/skins/twelvePalace/TwelvePalaceResultSkin.exml")||this;return e.timerCount=0,e.timerHandler=null,e.type=null,e.data=null,e.setIsShowBackBtn(!1),e}return __extends(n,t),n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickConfirm,this)},n.prototype.closeHook=function(){this.clearTimer()},n.prototype.onClickConfirm=function(t){1==this.type?(e.BattleScene.instance.quitFuBen(),this.close()):2==this.type&&(e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"TwelvePalaceResultPanel",tag:"win",battleType:e.BattleType.PVP_CHALLENGE_TWELVE_PALACE_OWNER}),e.TwelvePalaceController.getInstance().showPanel(3),this.close())},n.prototype.showPanel=function(e,t){this.type=e,this.data=t,this.show()},n.prototype.showHook=function(){if(this.type&&this.data){var e=this.data;if(this.startTimer(),1==this.type)if(1==e.result)if(this.ui.bossIcon.visible=!0,this.ui.failure.visible=!1,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.8,this.ui.bossIcon.scaleY=.8,e.mine){this.ui.resultLabel.textFlow=new Array({text:"你击败了",style:{textColor:16777215}},{text:e.enemy,style:{textColor:11141123}},{text:"，成为了",style:{textColor:16777215}},{text:e.palace,style:{textColor:16759296}},{text:"占领者",style:{textColor:16777215}}),this.ui.itemScroller.viewport=this.ui.itemList;
var t=[],n=e.award,o=n.getDrop().getDetailEquip();for(var a in o){var s=o[a];t.push({id:s.getItemId()})}var r=n.getDrop().getItem();for(var a in r){var s=r[a];t.push({id:s.getItemId(),num:s.getItemCount()})}var l=new eui.ArrayCollection(t),h=new eui.TileLayout;h.requestedColumnCount=4;var c=this.ui.itemList;c.layout=h,c.dataProvider=l,c.itemRenderer=i,this.ui.reward.visible=!0}else this.ui.resultLabel.textFlow=new Array({text:"很遗憾，",style:{textColor:16777215}},{text:e.enemy,style:{textColor:11141123}},{text:"已被"+e.player+"击杀，你没有获得BOSS掉落归属权，无法获得掉落奖励！",style:{textColor:16777215}}),this.ui.reward.visible=!1;else 1==e.result?(this.ui.bossIcon.visible=!1,this.ui.failure.visible=!0,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.8,this.ui.bossIcon.scaleY=.8,this.ui.reward.visible=!1):(this.ui.bossIcon.visible=!1,this.ui.failure.visible=!0,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.8,this.ui.bossIcon.scaleY=.8,this.ui.resultLabel.textFlow=new Array({text:"很遗憾，你在活动时间内没有击杀BOSS，BOSS已逃走",style:{textColor:16777215}}),this.ui.reward.visible=!1);else 2==this.type&&(1==e.result?(this.ui.bossIcon.visible=!0,this.ui.failure.visible=!1,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.9*.8,this.ui.bossIcon.scaleY=.8,this.ui.resultLabel.textFlow=new Array({text:"恭喜你，轻松击败",style:{textColor:16777215}},{text:e.enemy,style:{textColor:11141123}},{text:"，成为",style:{textColor:16777215}},{text:e.palace,style:{textColor:16759296}},{text:"的占领者，丰厚奖励即将获得！",style:{textColor:16777215}}),this.ui.reward.visible=!1):(this.ui.bossIcon.visible=!1,this.ui.failure.visible=!0,this.ui.bossIcon.source=e.enemyIcon,this.ui.bossIcon.scaleX=.9*.8,this.ui.bossIcon.scaleY=.8,this.ui.resultLabel.textFlow=new Array({text:"很遗憾，你被",style:{textColor:16777215}},{text:e.enemy,style:{textColor:11141123}},{text:"一顿爆打，落荒而逃，抢夺星宫失败了！",style:{textColor:16777215}}),this.ui.reward.visible=!1))}},n.prototype.tick=function(){this.timerCount>0?(this.ui.timeLabel.text=""+this.timerCount,this.timerCount--):(this.clearTimer(),this.onClickConfirm(null))},n.prototype.startTimer=function(){this.clearTimer(),this.timerCount=10,this.timerHandler=setInterval(this.tick.bind(this),1e3),this.tick()},n.prototype.clearTimer=function(){this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null)},n.prototype.childrenCreated=function(){this.doScreenAdaptation()},n._instance=null,n}(e.BasePanel);e.TwelvePalaceResultPanel=t,__reflect(t.prototype,"foxgame.TwelvePalaceResultPanel");var i=function(t){function i(){var i=t.call(this)||this;return i.removeChildren(),i.width=100,i.height=70,i.itemIcon=new e.ItemIcon,i.itemIcon.x=i.width/2-i.itemIcon.width/2,i.itemIcon.y=i.height/2-i.itemIcon.height/2,i.addChild(i.itemIcon),i}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refresh()},i.prototype.refresh=function(){this.removeChildren(),this.itemIcon.setItem(this.data.id,this.data.num),this.addChild(this.itemIcon)},i}(eui.ItemRenderer);__reflect(i.prototype,"TwelvePalaceResultItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/twelvePalace/TwelvePalaceRewardSkin.exml")||this;return e.palaceType=1,e}return __extends(i,t),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.showPanel=function(e){this.palaceType=e,this.show()},i.prototype.initHook=function(){for(var e=0;4>e;e++){var t=this.getDropItem(e);t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this);var i=this.getOccupyItem(e);i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)}},i.prototype.refresh=function(){for(var t=e.JsonDataManager.instance.twelvePalaceTemplate.getFashionInfoByMapId(this.palaceType).showAWD,i=t.split(","),n=0;n<i.length;n++){var o=new e.AttributeVO(i[n]),a=this.getDropItem(n);a.setItem(o.id,o.value,!0,!0)}for(var s=e.JsonDataManager.instance.twelvePalaceTemplate.getFashionInfoByMapId(this.palaceType).award,r=s.split(","),n=0;n<r.length;n++){var o=new e.AttributeVO(r[n]),a=this.getOccupyItem(n);a.setItem(o.id,o.value,!0,!0)}},i.prototype.getItemTemp=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.click=function(t){var i=t.target,n=this.getItemTemp()[i.itemId];(4==n.type||0==n.type)&&e.TipsController.getInstance().showItemTips(i.itemId,i.num)},i.prototype.childrenCreated=function(){this.doScreenAdaptation()},i.prototype.getDropItem=function(e){return this.ui["drop_"+e]},i.prototype.getOccupyItem=function(e){return this.ui["occupy_"+e]},i._instance=null,i}(e.BasePanel);e.TwelvePalaceRewardPanel=t,__reflect(t.prototype,"foxgame.TwelvePalaceRewardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.TwelvePalaceVO=t,__reflect(t.prototype,"foxgame.TwelvePalaceVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.GUILD_CHUANWEI=1]="GUILD_CHUANWEI",e[e.GUILD_RENMING=2]="GUILD_RENMING",e[e.GUILD_TIREN=3]="GUILD_TIREN",e[e.GUILD_TUICHU=4]="GUILD_TUICHU",e[e.GUILD_XIUGAIGONGGAO=5]="GUILD_XIUGAIGONGGAO",e[e.GUILD_GONGHUISHENQING=6]="GUILD_GONGHUISHENQING",e[e.GUILD_JIARENSHEZHI=7]="GUILD_JIARENSHEZHI",e[e.GUILD_SHENGJIGONGGONGJINENG=8]="GUILD_SHENGJIGONGGONGJINENG",e[e.GUILD_TANHE=9]="GUILD_TANHE"}(t=e.UnionChangeZhiWeiType||(e.UnionChangeZhiWeiType={}));var i=function(){function t(){this.isBonFire=!1,this.model=new e.UnionModel,this.bossPanel=new e.UnionBossPanel(this.model),this.joinPanel=new e.UnionJoinPanel(this.model),this.skillPanel=new e.UnionSkillPanel(this.model),this.createPannel=new e.UnionCreatePanel(this.model),this.bonFireFunPanel=new e.UnionBonFireFunPanel(this.model),this.mainPanel=new e.UnionMainPanel(this.model),this.activityPanel=new e.UnionActivityPanel(this.model),this.bossDamageRankPanel=new e.UnionBossRankPanel(this.model),this.bossResultPanel=new e.UnionBossResultPanel(this.model),this.bossTimePanel=new e.UnionBossTimePanel,this.datingPanel=new e.UnionHall(this.model),this.zhiweijiachengPanel=new e.UnionZhiWeiJiaChengView(this.model),this.guildApplyPanel=new e.UnionApplyListView(this.model),this.tipsPanel=new e.UnionZhiWeiTipsView(this.model),this.unionSignAward=new e.UnionSignAward,this.scenePanel=new e.UnionBonFireScenePanel(this.model),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.getPanelIsShow=function(){var e=this.joinPanel.getIsShow(),t=this.mainPanel.getIsShow(),i=!1;return(e||t)&&(i=!0),i},t.prototype.registerMsg=function(t){t.add(e.Code.UNION_BOSS_INFO_S,this),t.add(e.Code.UNION_ENTER_S,this),t.add(e.Code.UNION_SKILL_LEVEL_UP_S,this),t.add(e.Code.UNION_SKILL_LEVEL_UP_C,this),t.add(e.Code.UNION_SKILL_INFO_S,this),t.add(e.Code.UNION_BOSS_HARMS_S,this),t.add(e.Code.UNION_CHALLENGE_BOSS_S,this),t.add(e.Code.UNION_GET_KILL_BOSS_AWARD_S,this),t.add(e.Code.UNION_JOIN_LIST_S,this),t.add(e.Code.UNION_MEMBER_S,this),t.add(e.Code.UNION_JOIN_REQ_S,this),t.add(e.Code.UNION_REQ_INFO_S,this),t.add(e.Code.UNION_SET_JOIN_LIMIT_S,this),t.add(e.Code.UNION_GET_ACTIVITY_S,this),t.add(e.Code.UNION_SKILL_LEVEL_UP_S,this),t.add(e.Code.UNION_DO_ACTIVITY_S,this),t.add(e.Code.UNION_OPER_S,this),t.add(e.Code.UNION_PROMPT_MSG_S,this),t.add(e.Code.UNION_CREATE_S,this),t.add(e.Code.UNION_BONFIRE_ENTER_S,this),t.add(e.Code.UNION_BONFIRE_EXIT_S,this),t.add(e.Code.UNION_BONFIRE_MEM_CHANGE_S,this),t.add(e.Code.UNION_BONFIRE_EXP_AWARD_S,this),t.add(e.Code.UNION_BONFIRE_AWARD_ADD_S,this),t.add(e.Code.UNION_BONFIRE_HAPPY_S,this),t.add(e.Code.TIME_PLAY_METHOD_PUSH,this),t.add(e.Code.VESTIGES_OF_ANCIENT_GODS_INFO_S,this),t.add(e.Code.EXPLORE_VESTIGES_OF_ANCIENT_GODS_S,this),t.add(e.Code.EXPLORE_VESTIGES_BEGIN_TIME_S,this)},t.prototype.setMessageToSeverAll=function(){this.needOpen=!1,this.openViewData()},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.UNION_CREATE_S:0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo());break;case e.Code.UNION_ENTER_S:if(i){this.model.setUnionEnterData(i);var n=this.getUnionId();e.Message.instance.send(e.Code.REFRESH_PLAYER_MANAGER,{unionId:n},!1)}this.JoinViewData();break;case e.Code.UNION_BOSS_INFO_S:this.model.setBossInfo(i);break;case e.Code.UNION_SKILL_INFO_S:this.mainPanel.getIsShow()&&this.getMessageForGuild(),this.model.setUnionSkillMsg(i),this.getRedShowForSocirty(),this.changeMainRed();break;case e.MsgCMD.REFRESH_PLAYERDATA:if(!this.skillPanel.getIsShow())return;this.skillPanel.refreshRoleData();break;case e.Code.UNION_BOSS_HARMS_S:this.model.setBossDamageRank(i);break;case e.Code.UNION_CHALLENGE_BOSS_S:this.challengeBossBack(i);break;case e.Code.UNION_GET_KILL_BOSS_AWARD_S:this.bossAwardBack(i);break;case e.Code.UNION_JOIN_LIST_S:this.model.setGuildListData(i),this.openPanelView();break;case e.Code.UNION_MEMBER_S:this.model.setMeMberData(i),this.showDaTingPanel();break;case e.Code.UNION_JOIN_REQ_S:this.model.setGuildJoinData(i);var o=this.model.getGuildJoinData(),a=void 0;a=2==o.getResult()?e.LanguageUtils.instance.getValue("Guild_apply_"+o.getResult(),o.getUnionName()):5==o.getResult()?e.LanguageUtils.instance.getValue("Guild_apply_28"):6==o.getResult()?e.LanguageUtils.instance.getValue("Guild_apply_29"):7==o.getResult()?e.LanguageUtils.instance.getValue("Guild_apply_30"):e.LanguageUtils.instance.getValue("Guild_apply_"+o.getResult()),e.PopUpController.getInstance().showFloatTextPanel1(a),this.joinPanel.getIsShow()&&this.currentItem.callBackForApply(o);break;case e.Code.UNION_REQ_INFO_S:this.model.setApplyData(i),this.getRedShowForSocirty(),this.guildApplyPanel.getIsShow()?0==this.model.getApplyData().getRequestInfo().length?this.guildApplyPanel.close():this.model.updataUnionEnterAndDaTingView():this.needOpen&&this.mainPanel.getIsShow()&&this.datingPanel.getIsShow()&&this.guildApplyPanel.show();break;case e.Code.UNION_SET_JOIN_LIMIT_S:break;case e.Code.UNION_GET_ACTIVITY_S:this.model.setActivityMsg(i),this.activityPanel.getIsShow()&&this.updateUnionActivityOperate(),this.changeMainRed();break;case e.Code.UNION_SKILL_LEVEL_UP_S:0!=i.getErrorNo()?e.GlobalUtil.showErrorCodeMsg(i.getErrorNo()):(e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("LEARNSUCESS")),this.skillPanel.getIsShow()&&this.skillPanel.sendUnionSkillReq());break;case e.Code.UNION_DO_ACTIVITY_S:if(0!=i.getErrorNo())e.GlobalUtil.showErrorCodeMsg(i.getErrorNo());else{var s=this.activityPanel.getSucessTipMsg(i.getType());e.GameUtils.MSG_TIP(s)}break;case e.Code.UNION_OPER_S:this.model.setGuanLiBack(i);break;case e.Code.UNION_PROMPT_MSG_S:this.model.setTiShiMsg(i),this.mainPanel.getIsShow()||(this.canShowUnion=!1),this.openViewData(),(this.datingPanel.getIsShow()||this.mainPanel.getIsShow())&&(this.guildApplyPanel.getIsShow()&&this.guildApplyPanel.close(),this.getMessageForGuildPlayer());break;case e.Code.UNION_BONFIRE_ENTER_S:this.enterBonFireBack(i);break;case e.Code.UNION_BONFIRE_EXIT_S:this.exitBonFire();break;case e.Code.UNION_BONFIRE_MEM_CHANGE_S:this.otherPlayerStatusChange(i);break;case e.Code.UNION_BONFIRE_EXP_AWARD_S:this.bf_expAwdBack(i);break;case e.Code.UNION_BONFIRE_AWARD_ADD_S:this.award_addBack(i);break;case e.Code.UNION_BONFIRE_HAPPY_S:this.bfHappyBack(i);break;case e.Code.TIME_PLAY_METHOD_PUSH:this.setBonFireTime(i);break;case e.Code.VESTIGES_OF_ANCIENT_GODS_INFO_S:this.model.setVESTIGES_OF_ANCIENT_GODS_INFO_S(i);break;case e.Code.EXPLORE_VESTIGES_OF_ANCIENT_GODS_S:this.model.setEXPLORE_VESTIGES_OF_ANCIENT_GODS_S(i);break;case e.Code.EXPLORE_VESTIGES_BEGIN_TIME_S:this.model.setEXPLORE_VESTIGES_BEGIN_TIME_S(i)}},t.prototype.sendVESTIGES_OF_ANCIENT_GODS_INFO_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.VestigesOfAncientGodReq");e.Message.instance.send(e.Code.VESTIGES_OF_ANCIENT_GODS_INFO_C,t,!0)},t.prototype.sendEXPLORE_VESTIGES_OF_ANCIENT_GODS_C=function(t){var i=HawkProtocolManager.newBuilder("JsProto.ExploreVestigesReq");i.setXy(t),e.Message.instance.send(e.Code.EXPLORE_VESTIGES_OF_ANCIENT_GODS_C,i,!0)},t.prototype.sendEXPLORE_VESTIGES_BEGIN_TIME_C=function(){var t=HawkProtocolManager.newBuilder("JsProto.ExploreVestigesBeginTimeReq");e.Message.instance.send(e.Code.EXPLORE_VESTIGES_BEGIN_TIME_C,t,!0)},t.prototype.showGuildApplyListPanel=function(){var t=HawkProtocolManager.newBuilder("JsProto.RequestJoinCollectReq");e.Message.instance.send(e.Code.UNION_REQ_INFO_C,t,!0)},t.prototype.sendZhanLiNeed=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.SetJoinLimitReq");n.setAutoAccReq(t),n.setFightLimit(i),e.Message.instance.send(e.Code.UNION_SET_JOIN_LIMIT_C,n,!0)},t.prototype.challengeBossBack=function(t){var i=t.getResult();if(0!=i){var n=void 0;return 1==i?n=e.LanguageUtils.instance.getValue("UNIONBOSSCHALLENGEERROR1"):2==i&&(n=e.LanguageUtils.instance.getValue("UNIONBOSSCHALLENGEERROR2")),void e.PopUpController.getInstance().showFloatTextPanel1(n)}var o=t.getBossId();e.JsonDataManager.instance.monster[o];this.model.challengeBossId=o;for(var a,s=this.model.bossInfo.getBossInfos(),r=s.length,l=0;r>l;l++)if(Number(s[l].getBossId())==o){a=s[l];break}var h=Number(e.GlobalConfig.instance.getValue("UNION_BOSS_CHALLENGE_TIME"));this.showBossTimePanel(h)},t.prototype.bossAwardBack=function(e){var t=e.getResult();1==t&&this.model.bossKillAwardBack(Number(e.getBossId()))},t.prototype.requestBossInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionBossInfoReq");e.Message.instance.send(e.Code.UNION_BOSS_INFO_C,t,!0)},t.prototype.requestBossDamageRank=function(t){var i=HawkProtocolManager.newBuilder("JsProto.UnionBossHarmRankReq");i.setBossId(t),e.Message.instance.send(e.Code.UNION_BOSS_HARMS_C,i,!0)},t.prototype.requestBossKillAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.GetKillBossAwardReq");i.setBossId(t),e.Message.instance.send(e.Code.UNION_GET_KILL_BOSS_AWARD_C,i,!0)},t.prototype.requestChallengeBoss=function(t){var i=this.model.bossInfo.getDailyChallengeCount(),n=Number(e.GlobalConfig.instance.getValue("UNION_DAILY_CHALLENGE_MAX_NUM"));if(!(i>=n)){this.closeUnionPanel(),e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!0,panel:"UnionController",tag:"requestChallengeBoss",battleType:e.BattleType.BATTLE_UNION_BOSS}),this.bossPanel.close();var o=HawkProtocolManager.newBuilder("JsProto.UnionBossChallengeReq");o.setBossId(t),e.Message.instance.send(e.Code.UNION_CHALLENGE_BOSS_C,o,!0)}},t.prototype.showActivityPanel=function(){App.LittleLoading().showLoading("UnionController showActivityPanel"),this.activityPanel.show(),App.LittleLoading().hideLoading("UnionController showActivityPanel")},t.prototype.showSkillPanel=function(){App.LittleLoading().showLoading("UnionController showSkillPanel"),this.skillPanel.show(),this.skillPanel.initData(),this.skillPanel.sendUnionSkillReq(),App.LittleLoading().hideLoading("UnionController showSkillPanel")},t.prototype.showZhiWeiJiaCheng=function(){this.zhiweijiachengPanel.show()},t.prototype.showBossPanel=function(){this.requestBossInfo(),this.bossPanel.show()},t.prototype.showBonFirePanel=function(){return 0==this.getHasUnion()?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31")):(this.model.unionActivitySelectTap=e.unionActivitySelectTap.GOUHUO,void this.activityPanel.show())},t.prototype.showyijipanel=function(){return 0==this.getHasUnion()?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31")):e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL"))?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIJIOPENTIP",e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL"))):(this.model.unionActivitySelectTap=e.unionActivitySelectTap.YIJI,void this.activityPanel.show())},t.prototype.showMutualPanel=function(e,t){this.datingPanel.showMutalView(e,t)},t.prototype.addMutual=function(e){this.datingPanel.addMutual(e)},t.prototype.showSignAwardPanel=function(e,t){this.unionSignAward.show(),this.unionSignAward.refreshAward(e,t)},t.prototype.updateSignAwardPanel=function(e,t){this.unionSignAward.getIsShow()&&this.unionSignAward.refreshAward(e,t)},t.prototype.getSignAwardPanelIsShow=function(){return this.unionSignAward.getIsShow()},t.prototype.showBossTimePanel=function(e){this.bossTimePanel.showPanel(e)},t.prototype.getIsTimeShow=function(){return this.bossTimePanel.getIsShow()},t.prototype.closeBossTimePanel=function(){this.bossTimePanel.close()},t.prototype.showBossDamageRankPanel=function(e){this.requestBossDamageRank(e),this.bossDamageRankPanel.show()},t.prototype.showBossResultPanel=function(){this.bossResultPanel.show()},t.prototype.showDaTingPanel=function(){(this.mainPanel.getIsShow()||this.joinPanel.getIsShow())&&(this.datingPanel.getIsShow()?this.openView():this.model.isMyMessage?(App.LittleLoading().showLoading("UnionController showDaTingPanel"),this.datingPanel.show(),App.LittleLoading().hideLoading("UnionController showDaTingPanel")):this.model.updataUnionEnterAndDaTingView(),this.getRedShowForSocirty())},t.prototype.getMessageForGuildPlayer=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPUnionMemberReq");e.Message.instance.send(e.Code.UNION_MEMBER_C,t,!0)},t.prototype.showCreatePannel=function(){this.createPannel.show()},t.prototype.openView=function(){var t=Number(e.GlobalConfig.instance.getValue("UNION_ENTER_LEVEL"));return e.PlayerService.instance.level<t?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYOPENLEVEL",t)):(this.needOpen=!0,this.canShowUnion=!0,void this.openViewData())},t.prototype.openViewData=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPUnionEnterReq");e.Message.instance.send(e.Code.UNION_ENTER_C,t,!0)},t.prototype.JoinViewData=function(){if(!this.needOpen){var t=this.model.getUnionEnterData();if(this.requestBossInfo(),this.showGuildApplyListPanel(),this.skillPanel.sendUnionSkillReq(),e.MainBottomControler.instance.setUnionRedImgVisible(!1),t.getHasUnion())return}var i=HawkProtocolManager.newBuilder("JsProto.HPUnionJoinListReq");e.Message.instance.send(e.Code.UNION_JOIN_LIST_C,i,!0)},t.prototype.openPanelView=function(){if(this.getRedShowForSocirty(),this.needOpen){var t=this.model.getUnionEnterData();if(t.getHasUnion())this.model.setUnionCreateData(t.getUnionInfo()),this.joinPanel.getIsInit()&&this.joinPanel.getIsShow()&&this.joinPanel.close(),this.createPannel.getIsInit()&&this.createPannel.getIsShow()&&this.createPannel.close(),this.mainPanel.getIsShow()?this.model.updataUnionEnterAndDaTingView():this.canShowUnion&&(App.LittleLoading().showLoading("UnionController openPanelView getHasUnion"),this.mainPanel.show(),App.LittleLoading().hideLoading("UnionController openPanelView getHasUnion"));else if(this.joinPanel.getIsShow())this.model.updataUnionEnterAndDaTingView();else{if(!this.canShowUnion)return;this.model.getHaveUnion()?(this.closeAllPanel(),e.MainBottomControler.instance.setUnionRedImgVisible(!1),this.model.setHaveUnion(!1)):(App.LittleLoading().showLoading("UnionController openPanelView !getHasUnion"),this.joinPanel.show(),App.LittleLoading().hideLoading("UnionController openPanelView !getHasUnion"))}}},t.prototype.getHasUnion=function(){var e=!1,t=this.model.getUnionEnterData();return t&&(e=t.getHasUnion()),e},t.prototype.getUnionId=function(){var e=0,t=this.model.getUnionEnterData();return t&&t.getHasUnion()&&(e=t.getUnionInfo().getId()),e},t.prototype.changeMainRed=function(){this.mainPanel.getIsShow()&&this.model.updataUnionEnterAndDaTingView()},t.prototype.getMessageForGuild=function(){this.openViewData()},t.prototype.closeUnionPanel=function(){this.mainPanel.close()},t.prototype.checkBossOperate=function(){if(null==this.model.bossInfo.getBossInfos())return!1;for(var t,i=e.JsonDataManager.instance.unionBossTemplate1,n=i.length,o=0;n>o;o++)if(t=i[o],this.checkBossOperateById(t.bossId))return!0;return!1},t.prototype.checkBossOperateById=function(t){for(var i,n,o=e.JsonDataManager.instance.unionBossTemplate1,a=this.model.bossInfo.getBossInfos(),s=o.length,r=a.length,l=this.model.bossInfo.getRewardBossIds(),h=this.model.bossInfo.getDailyChallengeCount(),c=Number(e.GlobalConfig.instance.getValue("UNION_DAILY_CHALLENGE_MAX_NUM")),u=0;s>u;u++){n=o[u],i=null;for(var p=0;r>p;p++)if(Number(a[p].getBossId())==t){i=a[p];break}return null==i?!1:Number(i.getBossHp())>0?c>h?!0:!1:-1==l.indexOf(Number(i.getBossId()))?!0:!1}return!1},t.prototype.getRedShowForSocirty=function(){var t,i,n,o,a;if(!this.model.getUnionEnterData().getHasUnion())return void this.closeAllPanel();this.model.bossInfo&&this.model.bossInfo.getBossInfos()&&(t=this.checkBossOperate()),this.model.getApplyData()&&(i=this.checkRedApply()),this.model.currentRoleUnionSkillMsg&&(n=this.checkUnionSkillOperate()),this.model.getUnionEnterData()&&(o=this.checkUnionActivityOperate()),this.activityPanel.refreshyijiredpoint()&&(a=!0);var s;return i||t||n||o||a?(s=!0,void e.MainBottomControler.instance.setUnionRedImgVisible(s)):(s=!1,void e.MainBottomControler.instance.setUnionRedImgVisible(s))},t.prototype.checkRedApply=function(){var t=this.model.getApplyData();return t&&t.getRequestInfo().length>0&&this.checkQuanXianByType(e.UnionQuanXianType.CHULIGONGHUISHENQING)?!0:!1},t.prototype.closeAllPanel=function(){this.mainPanel.getIsShow()&&(this.bossPanel.close(),this.joinPanel.close(),this.skillPanel.close(),this.createPannel.close(),this.mainPanel.close(),this.activityPanel.close(),this.bossDamageRankPanel.close(),this.bossResultPanel.close(),this.bossTimePanel.close(),this.datingPanel.close(),this.zhiweijiachengPanel.close(),this.guildApplyPanel.close(),this.tipsPanel.close(),this.unionSignAward.close())},t.prototype.showTipsByValue=function(e,t,i){this.tipsPanel.setType(e,t,i),this.tipsPanel.show()},t.prototype.changePlayerZhiWei=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPUnionOperReq");switch(t.operType){case 1:break;case 2:i.setPosition(t.position);break;case 3:break;case 4:this.closeAllPanel();break;case 5:break;case 6:i.setJoinAgreed(t.joinAgreed);break;case 7:break;case 8:break;case 9:}switch(i.setTargetId(t.targetId),i.setOperType(t.operType),e.Message.instance.send(e.Code.UNION_OPER_C,i,!0),this.tipsPanel.getIsShow()&&this.tipsPanel.close(),t.operType){case 1:this.getMessageForGuildPlayer();break;case 2:this.getMessageForGuildPlayer();break;case 3:this.getMessageForGuildPlayer();break;case 4:break;case 5:break;case 6:this.showGuildApplyListPanel(),this.getMessageForGuildPlayer();break;case 7:i.setPosition(t.position);break;case 8:break;case 9:this.getMessageForGuildPlayer()}},t.prototype.checkUnionSkillOperate=function(){if(!this.model.getUnionEnterData().getHasUnion())return!1;for(var t=this.model.currentRoleUnionSkillMsg,i=t.getRoleUnionSkills().length,n=e.JsonDataManager.instance.unionPersonalSkill,o=e.JsonDataManager.instance.unionPublicSkill,a=this.model.getUnionEnterData().getMyInfo().getCurrContribution(),s=this.model.getUnionEnterData().getUnionInfo().getUnionFund(),r=0;i>r;r++)for(var l=t.getRoleUnionSkills()[r],h=l.getSkillIds().length,c=0;h>c;c++){var u=l.getSkillIds()[c],p=n[u],g=Number(p.levelUpCost[0][2]);if(a>=g)return!0}for(var d=t.getUnionSkillIds(),r=0;r<d.length;r++){var f=t.getUnionSkillIds()[r],p=o[f],g=Number(p.levelUpCost[0][2]);if(s>=g)return!0}return!1},t.prototype.checkUnionActivityOperate=function(){return this.model.getUnionEnterData().getActivityRedPoint()},t.prototype.updateUnionActivityOperate=function(){this.activityPanel.updateUnionActivityOperate()},t.prototype.shenqingGuild=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.JoinUnionReq");n.setTargetUnionId(t),e.Message.instance.send(e.Code.UNION_JOIN_REQ_C,n,!0),this.currentItem=i},t.prototype.checkQuanXianByType=function(e){return this.model.checkQuanXianByType(e)},t.prototype.getMyQuanXian=function(){return this.model.getMyQuanXian()},t.prototype.getGuildLevel=function(){return this.model.getUnionEnterData().getUnionInfo().getLevel()},t.prototype.setChatDataToHallPanel=function(e,t){},t.prototype.onChatClick=function(e){},t.prototype.getMyVO=function(){return this.model.getUnionEnterData().getMyInfo()},t.prototype.setBonFireTime=function(t){t.getPlayType()==e.TimePlayMethodType.UNION_BONFIRE&&(t.getOpen()?(this.model.remainTime=t.getRemainingTime(),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.BONFIRE,!0),egret.startTick(this.tick,this)):(this.model.remainTime=-1,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.BONFIRE,!1),egret.stopTick(this.tick,this),1==this.isInBonFire&&this.exitBonFire()),this.activityPanel&&this.activityPanel.getBonFire()&&this.activityPanel.getBonFire().refreshBtn())},t.prototype.tick=function(t){this.model.lastRemainTime<=0&&(this.model.lastRemainTime=t);var i=t-this.model.lastRemainTime;return 1e3>i?!1:(this.model.lastRemainTime=t,this.model.remainTime-=i,this.model.remainTime<=0&&(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.BONFIRE,!1),egret.stopTick(this.tick,this)),!0)},t.prototype.openBonFireFun=function(){this.bonFireFunPanel.show()},t.prototype.closeBonFireFun=function(){this.bonFireFunPanel.close()},t.prototype.requestBonFire=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionBonfireEnterReq");e.Message.instance.send(e.Code.UNION_BONFIRE_ENTER_C,t,!0),this.mainPanel.close(),this.activityPanel.close(),e.WanFaController.getInstance().closePanel()},t.prototype.enterBonFireBack=function(e){e.getErrorNo()>0||(this.isInBonFire=!0,this.model.setMyRoleList(e),t.getInstance().showBossTimePanel(e.getRemainingTime()),this.setBonFireStateUi(),this.setCoastCD(e.getToastCD()))},t.prototype.setBonFireStateUi=function(){this.scenePanel.show(),this.openBonFireFun(),e.MainControler.instance.mainOrBattleState(!1)},t.prototype.setCoastCD=function(e){this.model.remainTimeToast=e,egret.startTick(this.toastTick,this)},t.prototype.toastTick=function(e){this.model.lasttoastRemainTime<=0&&(this.model.lasttoastRemainTime=e);var t=e-this.model.lasttoastRemainTime;if(1e3>t)return!1;this.model.lasttoastRemainTime=e,this.model.remainTimeToast-=t;var i=Math.floor(this.model.remainTimeToast/1e3);return this.model.remainTimeToast<=0&&(i=-1,egret.stopTick(this.toastTick,this)),this.bonFireFunPanel.setToastCD(i),!0},t.prototype.requestBonFireExit=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionBonfireExitReq");e.Message.instance.send(e.Code.UNION_BONFIRE_EXIT_C,t,!0)},t.prototype.exitBonFire=function(){this.isInBonFire=!1,this.scenePanel.close(),egret.stopTick(this.toastTick,this),this.bonFireFunPanel.close(),t.getInstance().closeBossTimePanel(),this.closeBonFireFun(),e.MainControler.instance.gotoField()},t.prototype.bonFireHappy=function(t){this.bf_showFun_bar(t,function(){var i=HawkProtocolManager.newBuilder("JsProto.BonfireHappyReq");i.setType(t),e.Message.instance.send(e.Code.UNION_BONFIRE_HAPPY_C,i,!0)})},t.prototype.bfHappyBack=function(e){e.getErrorNo()>0||(this.model.setHappyCount(e.getType()),this.bonFireFunPanel.refreshUI(),this.showSucceedTips(e.getRewardInfo().getShowItems(),e.getType()))},t.prototype.showSucceedTips=function(t,i){for(var n="",o=0;o<t.length;o++)if(t[o]){var a=e.JsonDataManager.instance.itemTemplate[t[o].getItemId()];n+=e.LanguageUtils.instance.getValue("UNION_BONFIRE3",e.ColorUtils.instance.getColorByQuality(a.quality),a.name,t[o].getItemCount()),o<t.length-1&&(n+="、")}var s="UNION_BONFIRE2";2==i&&(s="UNION_BONFIRE4");var r=e.LanguageUtils.instance.getValue(s,n);e.PopUpController.getInstance().showTextPanel(r,this,function(e){},null,null,null,null,null,20,!1)},t.prototype.otherPlayerStatusChange=function(e){this.model.changePlayerList(e),this.scenePanel.getIsInit&&this.scenePanel.playerStatusChange(e)},Object.defineProperty(t.prototype,"isInBonFire",{get:function(){return this.isBonFire},set:function(e){this.isBonFire=e},enumerable:!0,configurable:!0}),t.prototype.getRemainTime=function(){return this.model.remainTime},t.prototype.award_addBack=function(e){this.model.bf_awardAdd=e.getAwardAdd(),this.bonFireFunPanel.refreshUI()},t.prototype.bf_expAwdBack=function(t){var i,n=[],o=(e.JsonDataManager.instance.itemTemplate,e.JsonDataManager.instance.itemTemplate[1004]),a=e.JsonDataManager.instance.itemTemplate[1002];i=e.LanguageUtils.instance.getValue("HUODE")+":",n.push({text:i}),n.push({text:o.name,style:{textColor:917248}}),n.push({text:" x "+t.getExp()}),n.push({text:"、"}),n.push({text:a.name,style:{textColor:44543}}),n.push({text:" x "+t.getCoin()}),e.PopUpController.getInstance().showItemFloatText(n)},t.prototype.bf_showFun_bar=function(e,t){this.scenePanel.getIsShow()&&this.scenePanel.showBar(3e3,t,e)},t.prototype.showUnionSiegePanel=function(t,i){void 0===i&&(i=!0);var n=Number(e.GlobalConfig.instance.getValue("UNION_ENTER_LEVEL"));if(e.PlayerService.instance.level<n)return i&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYOPENLEVEL",n)),!1;var o=this.getUnionId();return 0==o?(i&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31")),!1):(this.mainPanel.show(),e.UnionSiegeController.getInstance().showPanel(),!0)},t.prototype.getmodel=function(){return this.model},t}();e.UnionController=i,__reflect(i.prototype,"foxgame.UnionController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.CHUANWEI=1]="CHUANWEI",e[e.RENMING=2]="RENMING",e[e.TIREN=3]="TIREN",e[e.TUICHU=4]="TUICHU",e[e.XIUGAIGONGGAO=5]="XIUGAIGONGGAO",e[e.CHULIGONGHUISHENQING=6]="CHULIGONGHUISHENQING",e[e.XIUGAIJIARENSHEZHI=7]="XIUGAIJIARENSHEZHI",e[e.SHENGJIGONGGONGJINENG=8]="SHENGJIGONGGONGJINENG"}(t=e.UnionQuanXianType||(e.UnionQuanXianType={}));var i;!function(e){e[e.UNION_MEMBER_JOIN=1]="UNION_MEMBER_JOIN",e[e.UNION_REQUEST_BE_REJECTED=2]="UNION_REQUEST_BE_REJECTED",e[e.UNION_MEMBER_BE_KICK=3]="UNION_MEMBER_BE_KICK",e[e.UNION_POSITHON_CHANGE=4]="UNION_POSITHON_CHANGE",e[e.UNION_GUILDAPPLY=5]="UNION_GUILDAPPLY",e[e.WORLDBOSSINVITE=6]="WORLDBOSSINVITE",e[e.UNION_SIEGE_MEM_JOIN=7]="UNION_SIEGE_MEM_JOIN",e[e.UNION_SIEGE_MEM_MINING_FLAG=8]="UNION_SIEGE_MEM_MINING_FLAG"}(i=e.UnionPromptType||(e.UnionPromptType={}));var n;!function(e){e[e.UNION_BARBECUE=1]="UNION_BARBECUE",e[e.UNION_CARNIVAL=2]="UNION_CARNIVAL"}(n=e.UnionBfHappyType||(e.UnionBfHappyType={}));var o;!function(e){e[e.WORLD_BOSS=1]="WORLD_BOSS",e[e.UNION_BONFIRE=2]="UNION_BONFIRE",e[e.TWELVE_PALACE=3]="TWELVE_PALACE",e[e.UNION_SIEGE=4]="UNION_SIEGE",e[e.CS_UNION_SIEGE=5]="CS_UNION_SIEGE",e[e.CS_CAMP=6]="CS_CAMP"}(o=e.TimePlayMethodType||(e.TimePlayMethodType={}));var a=function(){function n(){this.currentSelectSkillIndex=0,this.unionActivitySelectTap=0,this.otherRoleList=[],this.remainTime=-1,this.lastRemainTime=-1,this.toastCount=0,this.revelryCount=0,this.awardAdd=0,this.remainTimeToast=-1,this.lasttoastRemainTime=-1,this.yijiinfo=null,this.observerList=[],this.obServerBonFireList=[],this.dataSource=[],this.collection=new eui.ArrayCollection,this.collection.source=this.dataSource,this.bossRankCollection=new eui.ArrayCollection,this.bossRankCollection.source=[],this.collection_hall=new eui.ArrayCollection,this.collection_hall.source=[],this.unionJiChuCollection=new eui.ArrayCollection,this.unionJiChuCollection.source=[],this.unionChengYuanCollection=new eui.ArrayCollection,this.unionChengYuanCollection.source=[],this.unionLieBiaoCollection=new eui.ArrayCollection,this.unionLieBiaoCollection.source=[],this.unionApplyListCollection=new eui.ArrayCollection,this.unionApplyListCollection.source=[]}return n.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},n.prototype.registerBonFireObserver=function(e){-1==this.obServerBonFireList.indexOf(e)&&this.obServerBonFireList.push(e)},n.prototype.setBossInfo=function(t){this.bossInfo=t;for(var i,n=this.observerList.length,o=0;n>o;o++)i=this.observerList[o],i.getIsShow()&&i.bossInfoBack();e.UnionController.getInstance().getRedShowForSocirty()},n.prototype.setEnableBossId=function(){for(var e,t=this.bossInfo.getBossInfos(),i=t.length,n=0;i>n;n++)if(e=t[n],Number(e.getBossHp())>0)return e.getBossId();
return-1},n.prototype.setGuildListData=function(e){this._unionGuildListData=e},n.prototype.getGuildListData=function(){return this._unionGuildListData},n.prototype.setBossDamageRank=function(e){this.bossDamageRankInfo=e;for(var t,i=this.observerList.length,n=0;i>n;n++)t=this.observerList[n],t.getIsShow()&&t.bossDamageRankInfoBack()},n.prototype.setGuildJoinData=function(e){this._guildApplyData=e},n.prototype.getGuildJoinData=function(){return this._guildApplyData},n.prototype.setMeMberData=function(e){this._unionMemberData=e},n.prototype.setApplyData=function(e){this._applyData=e},n.prototype.getApplyData=function(){return this._applyData},n.prototype.getMemberData=function(){return this._unionMemberData},n.prototype.bossKillAwardBack=function(e){var t=this.bossInfo.getRewardBossIds();t.push(e);for(var i,n=this.observerList.length,o=0;n>o;o++)i=this.observerList[o],i.getIsShow()&&i.bossKillAwardBack()},n.prototype.updateUnionSkillView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateRoleUnionSkill()},n.prototype.updateUnionActivityView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateUnionActivity()},n.prototype.updataUnionEnterAndDaTingView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateUnionDaTing()},n.prototype.setUnionEnterData=function(e){this._unionEnterData=e,this._unionEnterData.getHasUnion()&&(this.isHaveUnion=!0),this.CheckQuanXian()},n.prototype.setHaveUnion=function(e){this.isHaveUnion=e},n.prototype.getHaveUnion=function(){return this.isHaveUnion},n.prototype.getUnionEnterData=function(){return this._unionEnterData},n.prototype.setUnionSkillMsg=function(e){this.currentRoleUnionSkillMsg=e,this.updateUnionSkillView()},n.prototype.setActivityMsg=function(e){this.unionActivityMsg=e,this.updateUnionActivityView()},n.prototype.setTiShiMsg=function(t){t.getTargetPlayerId()!=e.PlayerService.instance.playerInfo.getPlayerId()?this.isMyMessage=!1:this.isMyMessage=!0;var n;switch(t.getPromptType()){case i.UNION_MEMBER_BE_KICK:this.isMyMessage?(n=e.LanguageUtils.instance.getValue("Guild_apply_18",e.LanguageUtils.instance.getValue("YOU")),e.PopUpController.getInstance().showFloatTextPanel1(n)):(n=e.LanguageUtils.instance.getValue("Guild_apply_18",t.getParams()[0]),e.NewChatControler.getInstance().addUnionMsg(n));break;case i.UNION_MEMBER_JOIN:this.isMyMessage&&(n=e.LanguageUtils.instance.getValue("Guild_apply_2",""),e.PopUpController.getInstance().showFloatTextPanel1(n)),n=e.LanguageUtils.instance.getValue("Guild_apply_11",t.getParams()[0]),e.NewChatControler.getInstance().addUnionMsg(n);break;case i.UNION_POSITHON_CHANGE:this.isMyMessage&&(n=e.LanguageUtils.instance.getValue("Guild_apply_19",e.LanguageUtils.instance.getValue("YOU"),t.getParams()[1]),e.PopUpController.getInstance().showFloatTextPanel1(n)),n=e.LanguageUtils.instance.getValue("Guild_apply_19",t.getParams()[0],t.getParams()[1]),e.NewChatControler.getInstance().addUnionMsg(n);break;case i.UNION_REQUEST_BE_REJECTED:this.isMyMessage&&(n=e.LanguageUtils.instance.getValue("Guild_apply_15",t.getParams()[0]),e.PopUpController.getInstance().showFloatTextPanel1(n));break;case i.UNION_GUILDAPPLY:e.UnionController.getInstance().showGuildApplyListPanel();break;case i.WORLDBOSSINVITE:n=e.LanguageUtils.instance.getValue("WORLDBOSSINVITEPROMPT",t.getParams()[0]),e.NewChatControler.getInstance().addUnionMsg(n);break;case i.UNION_SIEGE_MEM_JOIN:n=e.LanguageUtils.instance.getValue("Guild_Message_1",t.getParams()[0]),e.NewChatControler.getInstance().addUnionMsg(n);break;case i.UNION_SIEGE_MEM_MINING_FLAG:n=e.LanguageUtils.instance.getValue("Guild_Message_2",t.getParams()[0]),e.NewChatControler.getInstance().addUnionMsg(n)}},n.prototype.setGuanLiBack=function(t){var i=t.getResult();if(0==i){var n=void 0;switch(t.getOperType()){case e.UnionChangeZhiWeiType.GUILD_CHUANWEI:n=e.LanguageUtils.instance.getValue("Guild_apply_16",t.getTargetName());break;case e.UnionChangeZhiWeiType.GUILD_GONGHUISHENQING:break;case e.UnionChangeZhiWeiType.GUILD_JIARENSHEZHI:break;case e.UnionChangeZhiWeiType.GUILD_RENMING:var o=e.LanguageUtils.instance.getValue("Guild_pos"+t.getPosition());n=e.LanguageUtils.instance.getValue("Guild_apply_19",t.getTargetName(),o);break;case e.UnionChangeZhiWeiType.GUILD_SHENGJIGONGGONGJINENG:break;case e.UnionChangeZhiWeiType.GUILD_TANHE:n=e.LanguageUtils.instance.getValue("Guild_apply_21");break;case e.UnionChangeZhiWeiType.GUILD_TIREN:n=e.LanguageUtils.instance.getValue("Guild_apply_18",t.getTargetName());break;case e.UnionChangeZhiWeiType.GUILD_TUICHU:break;case e.UnionChangeZhiWeiType.GUILD_XIUGAIGONGGAO:}n&&e.PopUpController.getInstance().showFloatTextPanel1(n)}else{var a=e.JsonDataManager.instance.errorCode;if(a){var s=a[i];if(s)e.PopUpController.getInstance().showFloatTextPanel1(s);else switch(t.getResult()){case 9032:s=e.LanguageUtils.instance.getValue("Guild_apply_13"),e.PopUpController.getInstance().showFloatTextPanel1(s)}}}},n.prototype.setUnionCreateData=function(e){this._unionCreateData=e},n.prototype.getUnionCreateData=function(){return this._unionCreateData},n.prototype.CheckQuanXian=function(){if(this.myQuanXian=new Object,this.myQuanXian[t.CHUANWEI]=!1,this.myQuanXian[t.CHULIGONGHUISHENQING]=!1,this.myQuanXian[t.RENMING]=!1,this.myQuanXian[t.SHENGJIGONGGONGJINENG]=!1,this.myQuanXian[t.TIREN]=!1,this.myQuanXian[t.TUICHU]=!1,this.myQuanXian[t.XIUGAIGONGGAO]=!1,this.myQuanXian[t.XIUGAIJIARENSHEZHI]=!1,this._unionEnterData&&this._unionEnterData.getHasUnion()){for(var i=this._unionEnterData.getMyInfo(),n=i.getPostion(),o=e.JsonDataManager.instance.unionlimis,a=o.length,s=[],r=0;a>r;r++){var l=o[r];if(l.posId==n){s=l.limits;break}}a=s.length;for(var r=0;a>r;r++){var h=Number(s[r]);this.myQuanXian[h]=!0}}},n.prototype.checkQuanXianByType=function(e){return this.myQuanXian[e]},n.prototype.getMyQuanXian=function(){var e=this._unionEnterData.getMyInfo();return e?e.getPostion():0},n.prototype.getBonFireAwardList=function(){for(var t=e.GlobalConfig.instance.getValue("UNION_ZHANGSHIKU2"),i=t.split(","),n=new Array,o=i.length,a=0;o>a;a++){var s=new e.AttributeVO(i[a]);n.push(s)}return n},n.prototype.setMyRoleList=function(e){0==e.getErrorNo()&&(this.myRole=e.getMapPlayer(),this.otherRoleList=e.getOtherPlayer(),this.toastCount=e.getToastCount(),this.revelryCount=e.getRevelryCount(),this.bf_awardAdd=e.getAwardAdd(),this.updateView())},n.prototype.changePlayerList=function(e){if(1==e.getIsCome())return void this.otherRoleList.push(e.getMapPlayer());for(var t=this.otherRoleList.length-1;t>=0;t--)this.otherRoleList[t].getPlayerId()==e.getPlayerId()&&this.otherRoleList.splice(t,1)},n.prototype.updateView=function(){for(var e,t=this.obServerBonFireList.length,i=0;t>i;i++)e=this.obServerBonFireList[i],e.getIsShow()&&e.update()},n.prototype.getMyRole=function(){return this.myRole},n.prototype.getToastCount=function(){return this.toastCount},n.prototype.getRevelryCount=function(){return this.revelryCount},n.prototype.setHappyCount=function(t){switch(t){case 1:e.UnionController.getInstance().setCoastCD(e.GlobalConfig.instance.getValue("UNION_TOAST_CD")),this.toastCount--;break;case 2:this.revelryCount--}},n.prototype.bf_isOpen=function(){return this.remainTime>0?!0:!1},Object.defineProperty(n.prototype,"bf_awardAdd",{get:function(){return this.awardAdd},set:function(e){this.awardAdd=e},enumerable:!0,configurable:!0}),n.prototype.setVESTIGES_OF_ANCIENT_GODS_INFO_S=function(t){0==t.getErrorNo()&&(e.BattleScene.instance.onMsgBattleCrowdsInfo(t.getBossInfo()),this.scheduleId=0==t.getScheduleId()?1:t.getScheduleId(),this.yijiinfo=t,this.updateUnionActivityView())},n.prototype.setEXPLORE_VESTIGES_OF_ANCIENT_GODS_S=function(e){this.scheduleId=e.getScheduleId()},n.prototype.setEXPLORE_VESTIGES_BEGIN_TIME_S=function(t){e.BattleScene.instance.setruinsTime(t.getCostTime())},n}();e.UnionModel=a,__reflect(a.prototype,"foxgame.UnionModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.JUANXIAN=0]="JUANXIAN",e[e.GOUHUO=1]="GOUHUO",e[e.YIJI=2]="YIJI"}(t=e.unionActivitySelectTap||(e.unionActivitySelectTap={}));var i;!function(e){e[e.QIANDAO=1]="QIANDAO",e[e.JINBIJUANXIAN=2]="JINBIJUANXIAN",e[e.YUANBAOJUANXIAN=3]="YUANBAOJUANXIAN"}(i=e.unionActivityType||(e.unionActivityType={}));var n=function(n){function o(e){var t=n.call(this,"resource/skins/union/UnionActivity.exml")||this;return t.model=e,t.isMask=!1,t.adaptionType=1,t}return __extends(o,n),o.prototype.refresh=function(){this.ui.currency.refresh(),this.changeTap(this.model.unionActivitySelectTap)},o.prototype.updateUnionActivity=function(){this.donatePanel&&this.donatePanel.refresh(this.model.unionActivityMsg),this.bonFirePanel,this.unionRuinsPanel&&this.unionRuinsPanel.refresh(),this.refreshyijiredpoint()},o.prototype.refreshyijiredpoint=function(){var t=!1;return e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL"))?t=!1:this.model.yijiinfo?(t=0!=this.model.yijiinfo.getTimes(),this.getIsShow()&&(this.ui.yijiRedPoint.visible=t),t):t=!0},o.prototype.initHook=function(){this.model.registerObserver(this),this.ui.donateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.bonfireBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.relicBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHelpMsg,this),this.doScreenAdaptation()},o.prototype.getSucessTipMsg=function(e){return this.donatePanel.createSucessTipMsg(e)},o.prototype.btnClick=function(i){switch(i.target){case this.ui.donateBtn:this.model.unionActivitySelectTap=t.JUANXIAN;break;case this.ui.bonfireBtn:this.model.unionActivitySelectTap=t.GOUHUO;break;case this.ui.relicBtn:if(e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL")))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIJIOPENTIP",e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL")));this.model.unionActivitySelectTap=t.YIJI}var n=this.model.unionActivitySelectTap;this.changeTap(n)},o.prototype.initTapSate=function(){this.ui.donateBtn.enabled=!0,this.ui.bonfireBtn.enabled=!0,this.ui.relicBtn.enabled=!0},o.prototype.changeTap=function(i){switch(this.initTapSate(),this.ui.activityGroup.removeChildren(),this.sendUnionActivityReq(),i){case t.JUANXIAN:void 0==this.donatePanel&&(this.donatePanel=new e.UnionDonatePanel),this.ui.activityGroup.addChild(this.donatePanel),this.ui.donateBtn.enabled=!1;break;case t.GOUHUO:void 0==this.bonFirePanel&&(this.bonFirePanel=new e.UnionBonFirePanel(this.model)),this.ui.activityGroup.addChild(this.bonFirePanel),this.ui.bonfireBtn.enabled=!1;break;case t.YIJI:void 0==this.unionRuinsPanel&&(this.unionRuinsPanel=new e.UnionRuinsPanel(this.model)),e.UnionController.getInstance().sendVESTIGES_OF_ANCIENT_GODS_INFO_C(),this.ui.activityGroup.addChild(this.unionRuinsPanel),this.ui.relicBtn.enabled=!1}this.updateUnionActivityOperate()},o.prototype.sendUnionActivityReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.GetUnionActivityInfoReq");e.Message.instance.send(e.Code.UNION_GET_ACTIVITY_C,t,!0)},o.prototype.updateUnionActivityOperate=function(){this.ui.donateRedPoint.visible=this.checkDonateOperate(),this.ui.relicRedPoint.visible=!1,void 0==this.bonFirePanel&&(this.bonFirePanel=new e.UnionBonFirePanel(this.model)),this.bonFirePanel.setRedTips=this.ui.bonfireRedPoint.visible=e.UnionController.getInstance().getRemainTime()>0?!0:!1},o.prototype.checkDonateOperate=function(){var t=this.model.unionActivityMsg;if(void 0!=t){var n=t.getActivityInfo(),o=e.JsonDataManager.instance.unionActivity;this.donatePanel&&this.donatePanel.setcontributeNumText(t.getContribution()+"");for(var a=0;a<n.length;a++){var s=n[a];switch(s.getType()){case i.QIANDAO:var r=s.getProgress();if(0==r)return!0;break;case i.JINBIJUANXIAN:var l=s.getProgress(),h=o[i.JINBIJUANXIAN].dailyCount,c=Number(o[i.JINBIJUANXIAN].cost[2]),u=e.PlayerService.instance.playerInfo;if(h-l!=0&&u.getCoin()>=c)return!0;break;case i.YUANBAOJUANXIAN:var p=s.getProgress(),g=o[i.YUANBAOJUANXIAN].dailyCount,d=Number(o[i.YUANBAOJUANXIAN].cost[2]);if(g-p!=0&&u.getGold()>=d)return!0}}return!1}},o.prototype.closeHook=function(){this.model.unionActivitySelectTap=t.JUANXIAN,this.donatePanel=null,this.bonFirePanel=null,this.unionRuinsPanel=null},o.prototype.showHelpMsg=function(){switch(this.model.unionActivitySelectTap){case t.JUANXIAN:e.HelpController.getInstance().showPanel("GUILDSIGNEDFORHELP");break;case t.GOUHUO:e.HelpController.getInstance().showPanel("BONFIREHELPOFTHEGUILD");break;case t.YIJI:e.HelpController.getInstance().showPanel("OLDGODYIJIHELP")}},o.prototype.getBonFire=function(){return this.getIsShow()&&this.model.unionActivitySelectTap==t.GOUHUO&&null!=this.bonFirePanel?this.bonFirePanel:null},o.prototype.bossInfoBack=function(){},o.prototype.updateRoleUnionSkill=function(){},o.prototype.bossDamageRankInfoBack=function(){},o.prototype.bossKillAwardBack=function(){},o.prototype.updateUnionDaTing=function(){},o}(e.BasePanel);e.UnionActivityPanel=n,__reflect(n.prototype,"foxgame.UnionActivityPanel",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.UnionActivityVO=t,__reflect(t.prototype,"foxgame.UnionActivityVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionBonFireFun.exml")||this;return i.num=0,i.barbecueConfgNum=0,i.carnivalConfgNum=0,i.setIsShowBackBtn(!1),i.isMask=!1,i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.barbecueBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBarbecue,this),this.ui.carnivalBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickCarnival,this),this.ui.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBack,this),this.ui.backBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBack0,this),this.ui.backBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBack1,this),this.ui.totalNum.text=this.num.toString(),this.barbecueConfgNum=e.GlobalConfig.instance.getValue("UNION_TOAST_MAX_COUNT"),this.carnivalConfgNum=e.GlobalConfig.instance.getValue("UNION_REVELRY_MAX_COUNT"),this.refreshUI()},i.prototype.onClickBarbecue=function(t){e.UnionController.getInstance().bonFireHappy(e.UnionBfHappyType.UNION_BARBECUE)},i.prototype.onClickCarnival=function(t){var i=this,n=new e.AttributeVO(e.GlobalConfig.instance.getValue("UNION_REVELRY_COST")),o=n.value+e.JsonDataManager.instance.itemTemplate[n.id].name,a=e.GlobalConfig.instance.getValue("UNION_REVELRY_AWARD_ADD"),s=e.LanguageUtils.instance.getValue("UNION_BONFIRE1",o,a),r=e.LanguageUtils.instance.getValue("QUEDING"),l=e.LanguageUtils.instance.getValue("QUXIAO");e.PopUpController.getInstance().showTextPanel(s,this,function(t){var o=e.PlayerService.instance.playerInfo.getGold();o<n.value?e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),i,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往"):e.UnionController.getInstance().bonFireHappy(e.UnionBfHappyType.UNION_CARNIVAL)},null,null,null,r,l)},i.prototype.refreshUI=function(){var e=this.model.getToastCount(),t=this.model.getRevelryCount(),i=!1,n=!1;this.ui.barbecueText.text="("+e+"/"+this.barbecueConfgNum+")",this.ui.carnivalText.text="("+t+"/"+this.carnivalConfgNum+")",0>=e&&(i=!0,this.ui.barbecueText.textColor=16711680),0>=t&&(n=!0,this.ui.carnivalText.textColor=16711680),this.setGray(this.ui.barbecueBtn,i),this.ui.barbecueBtn.touchEnabled=!i,this.setGray(this.ui.carnivalBtn,n),this.ui.carnivalBtn.touchEnabled=!n,this.ui.awardAddText.text="+"+this.model.bf_awardAdd+"%"},i.prototype.setToastCD=function(e){var t=!0;-1==e&&this.model.getToastCount()>0&&(t=!1),this.ui.cdText.visible=t,this.ui.timeLabel.visible=t,this.ui.timeLabel.text=e+"s",this.setGray(this.ui.barbecueBtn,t),this.ui.barbecueBtn.touchEnabled=!t,this.model.getToastCount()<=0&&(this.ui.cdText.visible=!1,this.ui.timeLabel.visible=!1)},i.prototype.setGray=function(t,i){t&&(i?t.filters=e.GlobalUtil.grayFilter:t.filters=[])},i.prototype.onClickBack=function(t){e.UnionController.getInstance().requestBonFireExit()},i.prototype.onClickBack0=function(e){this.num++,this.ui.totalNum.text=this.num.toString()},i.prototype.onClickBack1=function(e){this.num--,this.ui.totalNum.text=this.num.toString()},i}(e.BasePanel);e.UnionBonFireFunPanel=t,__reflect(t.prototype,"foxgame.UnionBonFireFunPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="UnionBonFireActivity",i.model=e,i.init(),i}return __extends(i,t),i.prototype.init=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addLister(),this.refreshAwdList(),this.refreshBtn(),this.infoText.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GOUHUO_KQSJ"))},i.prototype.refreshAwdList=function(){for(var e=this.getAwardIconList(),t=e.length,i=0;t>i;i++){var n=this.model.getBonFireAwardList()[i];e[i].setItem(n.id,n.value,!0,!0)}},i.prototype.refreshBtn=function(){var t=this.model.bf_isOpen();this.takeUpText.filters=this.takeUpButton.filters=t?[]:e.GlobalUtil.grayFilter,this.takeUpButton.touchEnabled=t},i.prototype.addLister=function(){this.takeUpButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.intoBonFireActivity,this);for(var e,t=this.getAwardIconList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},i.prototype.closeHook=function(){this.takeUpButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.intoBonFireActivity,this)},i.prototype.refreshPanel=function(){},i.prototype.intoBonFireActivity=function(t){e.UnionController.getInstance().requestBonFire()},Object.defineProperty(i.prototype,"setRedTips",{set:function(e){this.redTips.visible=e},enumerable:!0,configurable:!0}),i.prototype.getAwardIconList=function(){var e=[];return e.push(this.award0),e.push(this.award1),e.push(this.award2),e.push(this.award3),e.push(this.award4),e},i}(eui.Component);e.UnionBonFirePanel=t,__reflect(t.prototype,"foxgame.UnionBonFirePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i){var n=t.call(this)||this;return n.inited=!1,n.clothMC=null,n.weaponMC=null,n.monsterMC=null,n.wingMC=null,n.roleItemId=-1,n.weaponId=-1,n.clothId=-1,n.frameRate1=8,n.actionType=0,n.speed=200,n.lastWalkTime=-1,n.moveAni=!0,n.hasC=!0,n.skinName="WorldBossRole",n.model=e,n.scene=i,n.touchEnabled=!1,n.touchChildren=!1,n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this)},i.prototype.setInfo=function(e,t,i,n,o,a,s,r){if(void 0===r&&(r=!0),this.roleInfo=e,this.roleItemId=t,this.weaponId=n,this.clothId=i,this.wingId=o,this.startPos=s,this.direction=a,this.moveAni=r,(5==a||6==a||7==a)&&(this.direction=8-a,this.changeScaleX()),0!=this.inited&&-1!=this.roleItemId){var l=new egret.Point(this.parent.x,this.parent.y),h=egret.Point.distance(l,this.startPos);this.walkTime=h/(this.speed/1e3),this.speedX=(l.x-this.startPos.x)/this.walkTime,this.speedY=(l.y-this.startPos.y)/this.walkTime,1==this.moveAni?(this.x+=this.startPos.x-l.x,this.y+=this.startPos.y-l.y,this.changeAction(1,this.direction)):(this.x=0,this.y=0,this.changeAction(2,this.direction))}},i.prototype.getPlayerId=function(){return this.roleInfo.getPlayerId()},i.prototype.play=function(){if(this.hasC=!1,null!=this.roleInfo){var t=void 0,i=this.roleInfo.getMaxHp();this.hpLabel.text=i>0?i+"/"+i:"",t=this.hpLabel.y,this.nameLabel.text=this.roleInfo.getPlayerName(),this.nameLabel.y=t-this.nameLabel.height,t=this.nameLabel.y;var n=this.roleInfo.getUnionName();this.unionLabel.text=null!=n&&""!=n?n:"",this.unionLabel.y=t-this.unionLabel.height,t=this.unionLabel.y,this.setTitle(this.roleInfo.getTitleId())}var o,a,s;if(this.clothId>0?(this.clothGroup=egret.getTimer()+"cloth",s=e.JsonDataManager.instance.roleTemplate[this.roleItemId],this.profession=s.profession,o=e.JsonDataManager.instance.equipTemplate[this.clothId],a=o.getModelId(s.sex),this.clothModelVO=e.JsonDataManager.instance.modelTemplate[a]):this.roleItemId>0&&(this.clothGroup=egret.getTimer()+"cloth",s=e.JsonDataManager.instance.roleTemplate[this.roleItemId],this.profession=s.profession,this.clothModelVO=e.JsonDataManager.instance.modelTemplate[s.defaultModel]),null!=this.clothModelVO&&(RES.createGroup(this.clothGroup,[this.clothModelVO.name+"_"+this.direction+"_png",this.clothModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.clothGroup,this.loadRoleComplete,null,this)),this.weaponId>0&&(this.weaponGroup=egret.getTimer()+"weapon",o=e.JsonDataManager.instance.equipTemplate[this.weaponId],this.weaponModelVO=e.JsonDataManager.instance.modelTemplate[o.modelIdList[0]],RES.createGroup(this.weaponGroup,[this.weaponModelVO.name+"_"+this.direction+"_png",this.weaponModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.weaponGroup,this.loadWeaponComplete,null,this)),null!=this.wingId&&""!=this.wingId&&"0"!=this.wingId){var r=this.wingId.split("_");if(r&&"0"==r[0])return;var l=e.JsonDataManager.instance.wingTemplate[this.wingId];null!=l&&(this.wingGroup=egret.getTimer()+"wing",this.wingModelVO=e.JsonDataManager.instance.modelTemplate[l.model],RES.createGroup(this.wingGroup,[this.wingModelVO.name+"_"+this.direction+"_png",this.wingModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.wingGroup,this.loadWingComplete,null,this))}},i.prototype.loadRoleComplete=function(t){if(t==this.clothGroup){null!=this.clothMC&&(this.clothMC.parent.removeChild(this.clothMC),this.clothMC.stop());var i,n=RES.getRes(this.clothModelVO.name+"_"+this.direction+"_json"),o=RES.getRes(this.clothModelVO.name+"_"+this.direction+"_png"),a=new egret.MovieClipDataFactory(n,o);1==this.actionType?i=3:this.profession==e.ProfessionType.PROFESSION1?i=4:this.profession==e.ProfessionType.PROFESSION2?i=5:this.profession==e.ProfessionType.PROFESSION3&&(i=5),this.clothMC=new egret.MovieClip(a.generateMovieClipData(this.clothModelVO.name+"_"+this.direction+"_"+i)),this.roleContainer.addChild(this.clothMC),this.clothMC.frameRate=this.frameRate1,this.clothMC.gotoAndPlay(1,-1),null!=this.weaponMC&&this.weaponMC.gotoAndPlay(1,-1),null!=this.wingMC&&this.wingMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(a)}},i.prototype.setTitle=function(t){var i=e.JsonDataManager.instance.medalTemplate[t];null!=i&&(null!=i.animation?(null!=this.titleBmp&&null!=this.titleBmp.parent&&this.titleBmp.parent.removeChild(this.titleBmp),this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleAnim=new e.FoxAni(this.titleGroup),this.titleAnim.frameRate=6,this.titleAnim.play(i.animation,"ani",-1)):null!=i.icon1&&(null!=this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleBmp=new egret.Bitmap,this.titleGroup.addChild(this.titleBmp),App.getResourceUtils().getResAsync(i.icon1+"_png",this.setTitleImg,this)))},i.prototype.setTitleImg=function(e){this.titleBmp.$bitmapData=e.bitmapData,this.titleBmp.x=-e.textureWidth>>1,this.titleBmp.y=-e.textureHeight>>1},i.prototype.changeAction=function(e,t){this.actionType=e,this.direction=t,this.play()},i.prototype.loadWeaponComplete=function(t){if(this.weaponGroup==t){null!=this.weaponMC&&(this.weaponMC.parent.removeChild(this.weaponMC),this.weaponMC.stop());var i,n=RES.getRes(this.weaponModelVO.name+"_"+this.direction+"_json"),o=RES.getRes(this.weaponModelVO.name+"_"+this.direction+"_png"),a=new egret.MovieClipDataFactory(n,o);1==this.actionType?i=3:this.profession==e.ProfessionType.PROFESSION1?i=5:this.profession==e.ProfessionType.PROFESSION2?i=4:this.profession==e.ProfessionType.PROFESSION3&&(i=4),this.weaponMC=new egret.MovieClip(a.generateMovieClipData(this.weaponModelVO.name+"_"+this.direction+"_"+i)),this.weaponMC.y=-20,this.weaponContainer.addChild(this.weaponMC),this.weaponMC.frameRate=this.frameRate1,this.weaponMC.gotoAndPlay(1,-1),null!=this.clothMC&&this.clothMC.gotoAndPlay(1,-1),null!=this.wingMC&&this.wingMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(a)}},i.prototype.loadMonsterComplete=function(t){if(this.monsterGroup==t){null!=this.monsterMC&&(this.monsterMC.parent.removeChild(this.monsterMC),this.monsterMC.stop());var i=RES.getRes(this.monsterModelVO.name+"_"+this.direction+"_json"),n=RES.getRes(this.monsterModelVO.name+"_"+this.direction+"_png"),o=new egret.MovieClipDataFactory(i,n);this.monsterMC=new egret.MovieClip(o.generateMovieClipData(this.monsterModelVO.name+"_"+this.direction+"_4")),this.roleContainer.addChild(this.monsterMC),this.monsterMC.frameRate=6,this.monsterMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(o)}},i.prototype.loadWingComplete=function(t){if(this.wingGroup==t){null!=this.wingMC&&(this.wingMC.parent.removeChild(this.wingMC),this.wingMC.stop());var i=RES.getRes(this.wingModelVO.name+"_"+this.direction+"_json"),n=RES.getRes(this.wingModelVO.name+"_"+this.direction+"_png"),o=new egret.MovieClipDataFactory(i,n),a=1==this.actionType?3:4;this.wingMC=new egret.MovieClip(o.generateMovieClipData(this.wingModelVO.name+"_"+this.direction+"_"+a)),this.wingContainer.addChild(this.wingMC),this.wingMC.frameRate=this.frameRate1,null!=this.wingMC&&this.wingMC.gotoAndPlay(1,-1),null!=this.clothMC&&this.clothMC.gotoAndPlay(1,-1),null!=this.weaponMC&&this.weaponMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(o)}},i.prototype.tick=function(e){var t;1==this.actionType?(-1==this.lastWalkTime&&(this.lastWalkTime=e),t=e-this.lastWalkTime,this.lastWalkTime=e,this.walkTime-=t,this.x+=this.speedX*t,this.y+=this.speedY*t,this.walkTime<=0&&(this.x=0,this.y=0,this.changeAction(2,this.scene.getRoleMonsterDirection(this.parent,!1)))):2==this.actionType&&1==this.hasC&&(this.hasC=!1)},i.prototype.removeHandler=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this),this.clear()},i.prototype.changeScaleX=function(){this.roleGroup.scaleX=-this.roleGroup.scaleX},i.prototype.clear=function(){null!=this.clothMC&&(this.clothMC.parent.removeChild(this.clothMC),this.clothMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.clothMC)),this.clothMC=null,RES.destroyRes(this.clothGroup,!1),null!=this.monsterMC&&(this.monsterMC.parent.removeChild(this.monsterMC),this.monsterMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.monsterMC)),this.monsterMC=null,RES.destroyRes(this.monsterGroup,!1),null!=this.weaponMC&&(this.weaponMC.parent.removeChild(this.weaponMC),this.weaponMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.monsterMC)),this.weaponMC=null,RES.destroyRes(this.weaponGroup,!1),null!=this.wingMC&&(this.wingMC.parent.removeChild(this.wingMC),this.wingMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.wingMC)),this.wingMC=null,RES.destroyRes(this.wingGroup,!1)},i}(eui.Component);e.UnionBonFireRole=t,__reflect(t.prototype,"foxgame.UnionBonFireRole")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionBonFireScene.exml")||this;return i.recordPosX=0,i.recordPosY=0,i.isShowingBar=!1,i.setRegisterTick(!0),i.isMask=!1,i.isCenter=!0,i.layer=LayerType.MAINUILAYER,i.setIsShowBackBtn(!1),i.model=e,i.model.registerBonFireObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){this.nullContainerList=[],this.nullPosPlayerList=[];for(var t=this.getRoleContainerList(),i=[],n=0;n<t.length;n++)i.push(t[n]);i.push(this.ui.bossContainer),this.ui.barImg.mask=this.ui.barMask,this.recordPosX=this.ui.barImg.x,this.recordPosY=this.ui.barImg.y,this.ui.barGroup.visible=!1,this.ui.bgRect.width=e.Global.stageWidth,this.ui.bgRect.height=e.Global.stageHeight},i.prototype.refresh=function(){if(null!=this.model.getMyRole()){var e=this.classify(),t=this.getRoleContainerList(),i=t.length;e&&e.length>i&&(this.nullPosPlayerList=e.slice(i-1,e.length-1));for(var n=0;i>n;n++)if(e[n]){var o=!1;0==n&&(o=!0),this.setRoleDisplay(t[n],e[n],o)}else this.nullContainerList.push(t[n])}},i.prototype.setRoleDisplay=function(t,i,n){var o=this;void 0===n&&(n=!1);var a,s=this.ui.startContainer,r=new egret.Point(s.x,s.y);return null==i?void t.removeChildren():void(0==t.numChildren&&(a=new e.UnionBonFireRole(this.model,this),TweenMax.delayedCall(1*Math.random(),function(){a.setInfo(i,i.getRoleItemId(),i.getEquipItemId(),i.getWeaponItemId(),i.getWingItemId(),n?o.getDirection(s,o.ui.bossContainer,a,!0):o.getRoleMonsterDirection(t),r,n)}),a.anchorOffsetX=150,a.anchorOffsetY=300,t.addChild(a)))},i.prototype.getRoleMonsterDirection=function(e,t){return void 0===t&&(t=!0),this.getDirection(e,this.ui.bossContainer,e.getChildAt(0),t)},i.prototype.classify=function(){var e=[],t=this.model.otherRoleList,i=t.length;e.push(this.model.getMyRole());for(var n=0;i>n;n++)e.push(t[n]);return e},i.prototype.getDirection=function(e,t,i,n){void 0===n&&(n=!1);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),r=180*s/Math.PI;0>r&&(r+=360);var l;return(r>112.5&&247.5>r||n)&&i.changeScaleX(),r>=292.5&&337.5>=r?l=3:r>=337.5||22.5>=r?l=2:r>=22.5&&67.5>=r?l=1:r>=67.5&&112.5>=r?l=8:r>=247.5&&292.5>=r?l=4:r>=202.5&&247.5>=r?l=5:r>=112.5&&157.5>=r?l=7:r>=157.5&&202.5>=r&&(l=6),l},i.prototype.showHook=function(){this.parent.setChildIndex(this,0),this.ani&&(this.ani.clear(),this.ani=null),this.ani=new e.FoxAni(this.ui.gouhuogroup),this.ani.play("fx_gouhuo_fire","ani",-1)},i.prototype.tickHook=function(e){var t,i=this.getRoleContainerList();i[0]&&(t=i[0].getChildAt(0),t.tick(e))},i.prototype.update=function(){this.refresh()},i.prototype.readyDestroy=function(){e.UnionController.getInstance().isInBonFire=!1,this.nullContainerList=null,1==this.isShowingBar&&(this.isShowingBar=!1,egret.Tween.removeTweens(this.ui.barImg))},i.prototype.playerStatusChange=function(e){switch(void 0==this.nullPosPlayerList&&(this.nullPosPlayerList=[]),void 0==this.nullContainerList&&(this.nullContainerList=[]),e.getIsCome()){case!0:this.nullPosPlayerList.push(e.getMapPlayer());break;case!1:var t=e.getPlayerId();0==this.playerHasNonePos(t)&&this.removePlayerFromContainer(t)}this.resetContainer()},i.prototype.playerHasNonePos=function(e){for(var t=this.nullPosPlayerList.length-1;t>=0;t--)if(this.nullPosPlayerList[t].getPlayerId()==e)return this.nullPosPlayerList.splice(t,1),!0;return!1},i.prototype.removePlayerFromContainer=function(e){for(var t,i=this.getRoleContainerList(),n=i.length,o=0;n>o;o++)if(i[o].numChildren>0&&(t=i[o].getChildAt(0)),t&&t.getPlayerId()==e){t.clear(),i[o].removeChildren(),this.nullContainerList.push(i[o]);break}},i.prototype.resetContainer=function(){if(this.nullContainerList&&this.nullContainerList.length>0&&this.nullPosPlayerList&&this.nullPosPlayerList.length>0)for(var e=Math.min(this.nullContainerList.length,this.nullPosPlayerList.length),t=0;e>t;t++)this.setRoleDisplay(this.nullContainerList.shift(),this.nullPosPlayerList.shift())},i.prototype.getRoleContainerList=function(){for(var e=[],t=11;15>=t;t++)e.push(this.ui["roleContainer"+t]);for(var t=21;25>=t;t++)e.push(this.ui["roleContainer"+t]);return e},i.prototype.showBar=function(t,i,n){var o=this;t>=0&&void 0!=i&&null!=i&&(1==this.isShowingBar&&egret.Tween.removeTweens(this.ui.barImg),this.isShowingBar=!0,this.ui.barImg.x=this.recordPosX,this.ui.barImg.y=this.recordPosY,this.ui.barGroup.visible=!0,this.ui.infoText.text=(n==e.UnionBfHappyType.UNION_BARBECUE?e.LanguageUtils.instance.getValue("KAOROUZHONG"):e.LanguageUtils.instance.getValue("KUANFHUANZHONG"))+"···",egret.Tween.get(this.ui.barImg).to({x:this.recordPosX+this.ui.barImg.width*this.ui.barImg.scaleX},t).call(function(){1==o.isShowingBar&&(o.ui.barGroup.visible=!1,o.isShowingBar=!1,i())
},this,null))},i}(e.BasePanel);e.UnionBonFireScenePanel=t,__reflect(t.prototype,"foxgame.UnionBonFireScenePanel",["foxgame.IUnionBonFire","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.UnionBossHarmRankVO=t,__reflect(t.prototype,"foxgame.UnionBossHarmRankVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.YITIAN=0]="YITIAN",e[e.LIANGTIAN=1]="LIANGTIAN",e[e.SANTIAN=2]="SANTIAN"}(t=e.SignTimes||(e.SignTimes={}));var i=function(i){function n(){var e=i.call(this)||this;return e.maxTime=3,e.skinName="UnionDonateActivity",e}return __extends(n,i),n.prototype.refresh=function(t){this.data=t;var i=t.getActivityInfo(),n=e.JsonDataManager.instance.unionActivity;this.contributeNumText.text=t.getContribution()+"";for(var o=0;o<i.length;o++){var a=i[o];switch(a.getType()){case e.unionActivityType.QIANDAO:var s=a.getContinueSign(),r=a.getProgress();this.setItemsState(s,r);break;case e.unionActivityType.JINBIJUANXIAN:var l=a.getProgress(),h=n[e.unionActivityType.JINBIJUANXIAN].dailyCount;this.coinTimeText.textFlow=this.createDonateTimeTextFLow(h-l,h),h-l==0?this.coinDonateBtn.enabled=!1:this.coinDonateBtn.enabled=!0;break;case e.unionActivityType.YUANBAOJUANXIAN:var c=a.getProgress(),u=n[e.unionActivityType.YUANBAOJUANXIAN].dailyCount;this.goldTimeText.textFlow=this.createDonateTimeTextFLow(u-c,u),u-c==0?this.goldDonateBtn.enabled=!1:this.goldDonateBtn.enabled=!0}}this.setSignAward()},n.prototype.setcontributeNumText=function(e){this.contributeNumText.text=e},n.prototype.createSucessTipMsg=function(t){var i=e.JsonDataManager.instance.unionActivity,n="";switch(t){case e.unionActivityType.QIANDAO:var o=i[e.unionActivityType.QIANDAO].award[this.unionLastSignTime];n=e.LanguageUtils.instance.getValue("Guild_apply_26",o[0][2],o[1][2],o[0][2]);break;case e.unionActivityType.JINBIJUANXIAN:var a=i[e.unionActivityType.JINBIJUANXIAN].award[0];n=e.LanguageUtils.instance.getValue("Guild_apply_27",a[0][2],a[1][2],a[0][2]);break;case e.unionActivityType.YUANBAOJUANXIAN:var s=i[e.unionActivityType.YUANBAOJUANXIAN].award[0];n=e.LanguageUtils.instance.getValue("Guild_apply_27",s[0][2],s[1][2],s[0][2])}return n},n.prototype.createDonateTimeTextFLow=function(e,t){var i;i=e>0?65280:16711680;var n=[{text:e+"",style:{textColor:i}},{text:"/"+t,style:{textColor:16777215}}];return n},n.prototype.setSignAward=function(){for(var t=e.JsonDataManager.instance.unionActivity,i=t[e.unionActivityType.QIANDAO].award,n=0;n<i.length;n++)this["item"+n].setAward(i[n])},n.prototype.setItemsState=function(i,n){switch(i>=2&&(i=2),this.unionLastSignTime=i,i){case t.YITIAN:this.item0.setSignState(e.UnionSignState.KEQIANDAO),this.item1.setSignState(e.UnionSignState.DAIQIANDAO),this.item2.setSignState(e.UnionSignState.DAIQIANDAO);break;case t.LIANGTIAN:this.item0.setSignState(e.UnionSignState.YIQIANDAO),1==n?this.item1.setSignState(e.UnionSignState.DAIQIANDAO):this.item1.setSignState(e.UnionSignState.KEQIANDAO),this.item2.setSignState(e.UnionSignState.DAIQIANDAO);break;case t.SANTIAN:this.item0.setSignState(e.UnionSignState.YIQIANDAO),this.item1.setSignState(e.UnionSignState.YIQIANDAO),1==n?this.item2.setSignState(e.UnionSignState.DAIQIANDAO):this.item2.setSignState(e.UnionSignState.KEQIANDAO)}},n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.coinDonateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendDonateReq,this),this.goldDonateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendDonateReq,this);var t=e.LanguageUtils.instance.getValue("UNIONDONATEDES");this.desText.textFlow=(new egret.HtmlTextParser).parser(t),this.desText.lineSpacing=8;var n=e.JsonDataManager.instance.unionActivity,o=n[e.unionActivityType.JINBIJUANXIAN];this.coinNumText.text=o.cost[2]+"",this.coinRewText.text=o.awardDes;var a=n[e.unionActivityType.YUANBAOJUANXIAN];this.goldNumText.text=a.cost[2]+"",this.goldRewText.text=a.awardDes},n.prototype.produceRewText=function(t){for(var i=t.length,n="",o=0;i>o;o++){var a=t[o],s=a[1],r=a[2],l=e.JsonDataManager.instance.itemTemplate[s].name;n+=r,n+=l,o!=i-1&&(n+=",")}return n},n.prototype.sendDonateReq=function(t){var i=HawkProtocolManager.newBuilder("JsProto.DoUnionActivityReq");switch(t.target){case this.coinDonateBtn:i.setType(e.unionActivityType.JINBIJUANXIAN),"0"==this.coinTimeText.text.charAt(0)&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("TONGQIANJUANXIANBUZU"));break;case this.goldDonateBtn:i.setType(e.unionActivityType.YUANBAOJUANXIAN),"0"==this.goldTimeText.text.charAt(0)&&e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YUANBAOJUANXIANBUZU"))}e.Message.instance.send(e.Code.UNION_DO_ACTIVITY_C,i,!0)},n}(eui.Component);e.UnionDonatePanel=i,__reflect(i.prototype,"foxgame.UnionDonatePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.tweenswitch=!1,i.skinName="UnionRuinsSkin",i.model=e,i.init(),i}return __extends(i,t),i.prototype.refresh=function(){if(this.model.yijiinfo){var t={1:1,2:2,3:3,4:1,5:2,6:3};if(this.times.textFlow=(new egret.HtmlTextParser).parser("<font color=0xffff00 stroke=1 strokeColor=0x000000>剩余次数:</font>"+e.GlobalUtil.createMaterialProTextFlow(this.model.yijiinfo.getTimes(),Number(e.GlobalConfig.instance.getValue("VESTIGES_DAILY_EXPLORE_NUM")),1,!1,16770048)),this.addstart.enabled=this.model.yijiinfo.getTimes()>=1,this.addstart.label=0==this.model.yijiinfo.getCostTime()?"开始探索":"继续探索",this.model.yijiinfo.getRankList().length<=0)return this.playername.text=this.unionname.text=this.time.text="",void(this.icon.source=this.zhiye.source="");this.playername.text=this.model.yijiinfo.getRankList()[0].getName(),this.unionname.text=this.model.yijiinfo.getRankList()[0].getUnionName(),this.time.text=this.dateBysign(this.model.yijiinfo.getRankList()[0].getTimeCos()),this.icon.source="proHead1_"+this.model.yijiinfo.getRankList()[0].getRoleItemId()+"_png",this.zhiye.source="zhiye_"+t[this.model.yijiinfo.getRankList()[0].getRoleItemId()]+"_png"}},i.prototype.dateBysign=function(e){var t=Math.abs(e);if(0==t)return"00:00:00";var i="",n=(t-t%36e5)/36e5;t=Math.floor(t/1e3-60*n*60);var o=Math.floor(t-t%60)/60,a=Math.floor(t-60*o);return i+=n>0?n+":":"00:",i+=o>=10?o+":":"0"+o+":",i+=a>=10?a:"0"+a},i.prototype.init=function(){this.switchbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this),this.addstart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickbtn,this);for(var t=[this.icon0,this.icon1,this.icon2,this.icon3,this.icon4],i=e.GlobalConfig.instance.getValue("YIJI_AWARD_SHOW").split(","),n=[],o=0;o<i.length;o++)n.push(new e.AttributeVO(i[o]));for(var a=0;a<t.length;a++)t[a].setItem(n[a].id,n[a].value),t[a].addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var i=t.target;e.TipsController.getInstance().showItemTips(i.itemId,i.num,!1)},this);this.refresh()},i.prototype.clickbtn=function(t){switch(t.target){case this.switchbtn:0==this.tweenswitch&&(this.tweenswitch=!0,this.barani(this.switchbtn.currentState));break;case this.addstart:if(e.UnionController.getInstance().closeUnionPanel(),e.UnionController.getInstance().activityPanel.getIsShow()&&e.UnionController.getInstance().activityPanel.close(),0==this.model.yijiinfo.getTimes())return void e.GameUtils.MSG_TIP("剩余次数不足");e.BattleScene.instance.gotoyiji(this.model.yijiinfo.getScheduleId(),this.model.yijiinfo.getBossInfo().getBattleMapId(),this.model.yijiinfo.getCostTime())}},i.prototype.barani=function(e){var t=this;"up"==e?(this.switchbtn.currentState="down",egret.Tween.get(this.bar_group,{}).to({y:this.bar_group.y-this.bar_group.height,alpha:0},500).call(function(){t.tweenswitch=!1},this)):(this.switchbtn.currentState="up",egret.Tween.get(this.bar_group,{}).to({y:this.bar_group.y+this.bar_group.height,alpha:1},500).call(function(){t.tweenswitch=!1},this))},i}(eui.Component);e.UnionRuinsPanel=t,__reflect(t.prototype,"foxgame.UnionRuinsPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/union/UnionSignAward.exml")||this;return e._award=[],e._state=0,e.readyToShow=!1,e}return __extends(i,t),i.prototype.initHook=function(){this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.signBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendSignReq,this),this.readyToShow&&this._award&&this.refreshAward(this._award,this._state)},i.prototype.sendSignReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.DoUnionActivityReq");t.setType(e.unionActivityType.QIANDAO),e.Message.instance.send(e.Code.UNION_DO_ACTIVITY_C,t,!0)},i.prototype.refreshAward=function(e,t){if(this._award=e,this._state=t,!this.getIsShow())return void(this.readyToShow=!0);for(var i=this.getItemCells().length,n=0;i-1>n;n++){var o=this.getItemCells()[n],a=e[n];o.setItem(Number(a[1]),Number(a[2]))}this.getItemCells()[2].setItem(1008,Number(e[0][2])),this.setSignState(t)},i.prototype.setSignState=function(t){switch(t){case e.UnionSignState.YIQIANDAO:this.ui.unSign.visible=!1,this.ui.signBtn.visible=!1,this.ui.alreadySign.visible=!0;break;case e.UnionSignState.DAIQIANDAO:this.ui.unSign.visible=!0,this.ui.signBtn.visible=!1,this.ui.alreadySign.visible=!1;break;case e.UnionSignState.KEQIANDAO:this.ui.unSign.visible=!1,this.ui.signBtn.visible=!0,this.ui.alreadySign.visible=!1}},i.prototype.getItemCells=function(){var e=[];return e.push(this.ui.itemCell0),e.push(this.ui.itemCell1),e.push(this.ui.itemCell2),e},i}(e.BasePanel);e.UnionSignAward=t,__reflect(t.prototype,"foxgame.UnionSignAward")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.KEQIANDAO=1]="KEQIANDAO",e[e.DAIQIANDAO=2]="DAIQIANDAO",e[e.YIQIANDAO=3]="YIQIANDAO"}(t=e.UnionSignState||(e.UnionSignState={}));var i=function(i){function n(){return i.call(this)||this}return __extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.signBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendSignReq,this),this.open.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showSignAward,this),this.unOpen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showSignAward,this),this.alreadyOpen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showSignAward,this)},n.prototype.showSignAward=function(){e.UnionController.getInstance().showSignAwardPanel(this.award,this.state)},n.prototype.sendSignReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.DoUnionActivityReq");t.setType(e.unionActivityType.QIANDAO),e.Message.instance.send(e.Code.UNION_DO_ACTIVITY_C,t,!0)},n.prototype.setAward=function(e){this.award=e},n.prototype.setSignState=function(i){switch(void 0!=this.state&&i!=this.state&&e.UnionController.getInstance().getSignAwardPanelIsShow()&&e.UnionController.getInstance().updateSignAwardPanel(this.award,i),this.state=i,i){case t.YIQIANDAO:this.unSign.visible=!1,this.signBtn.visible=!1,this.alreadySign.visible=!0,this.open.visible=!1,this.unOpen.visible=!1,this.alreadyOpen.visible=!0;break;case t.DAIQIANDAO:this.unSign.visible=!0,this.signBtn.visible=!1,this.alreadySign.visible=!1,this.open.visible=!1,this.alreadyOpen.visible=!1,this.unOpen.visible=!0;break;case t.KEQIANDAO:this.unSign.visible=!1,this.signBtn.visible=!0,this.alreadySign.visible=!1,this.alreadyOpen.visible=!1,this.unOpen.visible=!1,this.open.visible=!0}},n}(eui.Component);e.UnionTreasureItem=i,__reflect(i.prototype,"foxgame.UnionTreasureItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="UnionBossIcon",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.redImg.visible=!1},t.prototype.setItem=function(e){this.unionBossVO=e,this.headImg.source=this.unionBossVO.getMonsterVO().iconPath},t.prototype.refresh=function(e){for(var t,i=e.bossInfo.getBossInfos(),n=i.length,o=2,a=0;n>a;a++)if(t=i[a],t.getBossId()==this.unionBossVO.getMonsterVO().id){o=t.getBossHp()>0?1:3;break}this.statusImg1.visible=1==o,this.statusImg2.visible=2==o,this.statusImg3.visible=3==o,this.status=o},t.prototype.setRedImgVisible=function(e){this.redImg.visible=e},t.prototype.getBossEnabled=function(){return 1==this.status},t.prototype.setSelected=function(e){this.selected=e,this.selectImg.visible=e},t.prototype.getSelected=function(){return this.selected},t}(eui.Component);e.UnionBossIcon=t,__reflect(t.prototype,"foxgame.UnionBossIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.selectIndex=-1,e.skinName="UnionBossIconGroup",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.iconList=[this.icon0,this.icon1,this.icon2,this.icon3,this.icon4,this.icon5,this.icon6,this.icon7,this.icon8,this.icon9,this.icon10,this.icon11,this.icon12];for(var t,i,n=e.JsonDataManager.instance.unionBossTemplate1,o=this.iconList.length,a=0;o>a;a++)t=this.iconList[a],i=n[a],t.setItem(i),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.iconClickHandler,this)},i.prototype.setViewFunc=function(e){this.backFun=e},i.prototype.refresh=function(e){for(var t,i=this.iconList.length,n=0;i>n;n++)t=this.iconList[n],t.refresh(e);if(-1==this.selectIndex){for(var o=this.iconList.length-1,n=0;i>n;n++)if(t=this.iconList[n],t.getBossEnabled()){o=n;break}this.selectBoss(o)}},i.prototype.refreshOperate=function(){for(var t,i=this.iconList.length,n=e.UnionController.getInstance(),o=0;i>o;o++)t=this.iconList[o],t.setRedImgVisible(n.checkBossOperateById(t.unionBossVO.bossId))},i.prototype.iconClickHandler=function(e){var t=e.currentTarget,i=this.iconList.indexOf(t);this.selectBoss(i)},i.prototype.selectBoss=function(e){this.selectIndex=e;for(var t,i=this.iconList.length,n=0;i>n;n++)t=this.iconList[n],t.setSelected(n==e);this.backFun()},i.prototype.getCurrentBossIcon=function(){return this.iconList[this.selectIndex]},i.prototype.getIconPosByIndex=function(e){var t=this.iconList[e];if(null==t)return null;var i=new egret.Point(t.x,t.y);return i},i}(eui.Component);e.UnionBossIconGroup=t,__reflect(t.prototype,"foxgame.UnionBossIconGroup")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.YILINGJIANG=1]="YILINGJIANG",e[e.KETIAOZHAN=2]="KETIAOZHAN",e[e.KELINGJIANG=3]="KELINGJIANG",e[e.WEIJIHUO=4]="WEIJIHUO"}(t=e.UnionBossStatus||(e.UnionBossStatus={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/union/UnionBossPanel.exml")||this;return t.modelMonsterId=null,t.setIsShowBackBtn(!0),t.model=e,t.model.registerObserver(t),t.isMask=!1,t.adaptionType=1,t}return __extends(n,i),n.prototype.initHook=function(){this.ui.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftHandler,this),this.ui.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightHandler,this),this.ui.challengeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.challengeHandler,this),this.ui.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwardHandler,this),this.ui.rankBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHelpTip,this);for(var e,t=this.getKillAwardIconList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.killAwardIconHandler,this);t=this.getChallengeAwardIconList(),i=t.length;for(var n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.challengeAwardIconHandler,this);this.hpBarTotalWidth=this.ui.hpBarImg.width,this.pageTurnStep=this.ui.scroller.width,this.ui.bossIconGroup.setViewFunc(this.refreshView.bind(this)),this.ui.leftRedImg.visible=!1,this.ui.rightRedImg.visible=!1,this.monsterModel=new egret.MovieClip,this.monsterModel.name="mChest",this.monsterModel.frameRate=6,this.monsterModel.scaleX=1.2,this.monsterModel.scaleY=1.2,this.ui.bossGroup.addChild(this.monsterModel),this.doScreenAdaptation()},n.prototype.closeHook=function(){null!=this.modelController&&(this.modelController.release(),this.modelController=null),this.modelMonsterId=null,e.UnionController.getInstance().changeMainRed()},n.prototype.showHelpTip=function(){e.HelpController.getInstance().showPanel("GUILDBOSSSHELP")},n.prototype.initParams=function(){this.ui.bossIconGroup.selectIndex=-1},n.prototype.refresh=function(){this.ui.currency.refresh(),null!=this.model.bossInfo&&(this.ui.bossIconGroup.refresh(this.model),this.refreshBossIconScroll(),this.refreshView(),this.refreshBossIconOperate())},n.prototype.refreshBossIconScroll=function(){for(var e,i,n,o=this.model.bossInfo.getBossInfos(),a=o.length,s=0;a>s;s++)if(e=o[s],i=this.getBossStatus(e.getBossId()),i==t.KETIAOZHAN){n=this.ui.bossIconGroup.getIconPosByIndex(s);break}null==n&&(n=this.ui.bossIconGroup.getIconPosByIndex(a-1)),this.gotoPage(n.x)},n.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.ui.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},n.prototype.refreshView=function(){for(var i,n,o,a=this.model.bossInfo.getKillBossRank(),s=a.length,r=new Array,l=e.JsonDataManager.instance.unionBossTemplate1.length,h=0;s>h;h++)i=a[h],o=h+1+" "+i.getUnionName()+" ",n={text:o},r.push(n),o=i.getKillBossNum()+"/"+l+"\n",n={text:o,style:{textColor:16770048}},r.push(n);this.ui.rankLabel.textFlow=r;var c=this.ui.bossIconGroup.getCurrentBossIcon(),u=c.unionBossVO,p=u.getMonsterVO(),g=this.getUnionBossInfoById(p.id);this.refreshMonster(p.id);var d=this.getBossStatus(c.unionBossVO.bossId);if(this.ui.rankBtn.visible=d!=t.WEIJIHUO,null!=g){g.getBossHp().toLocaleString(),p.hp;var f=Long.fromValue(g.getBossHp()).toNumber()/Long.fromValue(p.hp).toNumber();g.getBossHp()>0?(this.ui.hpBarImg.width=this.hpBarTotalWidth*f,this.ui.hpBarLabel.text=g.getBossHp()+" ("+(100*f).toFixed(1)+"%)"):(this.ui.hpBarImg.width=0,this.ui.hpBarLabel.text="0 (0%)")}else this.ui.hpBarImg.width=this.hpBarTotalWidth,this.ui.hpBarLabel.text=p.hp+" (100%)";var m,y=this.model.bossInfo.getBossInfos();s=y.length;for(var I=!1,h=0;s>h;h++)if(m=y[h],Number(m.getBossHp())>0){Number(m.getBossId())==p.id&&(I=!0);break}this.ui.challengeGroup.visible=I,this.ui.bossNameLabel.text=p.name;var v=this.model.bossInfo.getDailyChallengeCount(),_=Number(e.GlobalConfig.instance.getValue("UNION_DAILY_CHALLENGE_MAX_NUM"));this.ui.challengeBtn.label=e.LanguageUtils.instance.getValue("TIAOZHAN")+"("+(_-v)+"/"+_+")";var T,C,A=this.getKillAwardIconList();s=u.killAward.length;for(var h=0;s>h;h++)C=A[h],T=u.killAward[h],null!=T?C.setItem(T.id,T.value):C.setItem(-1,-1);this.ui.getAwardBtn.visible=this.getBossStatus(p.id)==t.KELINGJIANG,this.ui.getAwardBtn.visible==this.ui.getAwardBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1),A=this.getChallengeAwardIconList(),s=u.challengeAward.length;for(var h=0;s>h;h++)C=A[h],T=u.challengeAward[h],null!=T?C.setItem(T.id,T.value):C.setItem(-1)},n.prototype.refreshBossIconOperate=function(){this.ui.bossIconGroup.refreshOperate()},n.prototype.bossInfoBack=function(){this.refresh()},n.prototype.bossKillAwardBack=function(){this.ui.bossIconGroup.refresh(this.model),this.refreshView(),this.refreshBossIconOperate()},n.prototype.rankHandler=function(t){var i=this.ui.bossIconGroup.getCurrentBossIcon();e.UnionController.getInstance().showBossDamageRankPanel(i.unionBossVO.getMonsterVO().id)},n.prototype.getAwardHandler=function(i){var n=this.ui.bossIconGroup.getCurrentBossIcon(),o=n.unionBossVO.getMonsterVO().id,a=this.getBossStatus(o);a==t.KELINGJIANG&&e.UnionController.getInstance().requestBossKillAward(o)},n.prototype.challengeHandler=function(t){var i=this.model.bossInfo.getDailyChallengeCount(),n=Number(e.GlobalConfig.instance.getValue("UNION_DAILY_CHALLENGE_MAX_NUM"));if(i>=n)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("UNIONBOSSCHALLENGECOUNTNOTENOUGH"));var o=this.ui.bossIconGroup.getCurrentBossIcon();e.UnionController.getInstance().requestChallengeBoss(o.unionBossVO.getMonsterVO().id)},n.prototype.leftHandler=function(e){this.ui.scroller.stopAnimation();var t=this.ui.scroller,i=t.viewport.scrollH,n=0;if(i!=n){var o=i-this.pageTurnStep;n>o&&(o=n),t.viewport.scrollH=o}},n.prototype.rightHandler=function(e){var t=this.ui.bossIconGroup,i=this.ui.scroller,n=i.viewport.scrollH,o=t.width-this.pageTurnStep;if(n!=o){var a=n+this.pageTurnStep;a>o&&(a=o),i.viewport.scrollH=a}},n.prototype.gotoPage=function(e){var t=this.ui.scroller;this.ui.scroller.stopAnimation();var i=this.ui.bossIconGroup.width-t.width,n=0;e>i?t.viewport.scrollH=i:n>e?t.viewport.scrollH=n:t.viewport.scrollH=e},n.prototype.killAwardIconHandler=function(t){var i=this.ui.bossIconGroup.getCurrentBossIcon(),n=i.unionBossVO,o=this.getKillAwardIconList(),a=t.currentTarget,s=o.indexOf(a),r=n.killAward[s];null!=r&&e.TipsController.getInstance().showItemTips(r.id,r.value,!1)},n.prototype.challengeAwardIconHandler=function(t){var i=this.ui.bossIconGroup.getCurrentBossIcon(),n=i.unionBossVO,o=this.getChallengeAwardIconList(),a=t.currentTarget,s=o.indexOf(a),r=n.challengeAward[s];null!=r&&e.TipsController.getInstance().showItemTips(r.id,r.value,!1)},n.prototype.getBossStatus=function(e){var i=this.model.bossInfo.getRewardBossIds();if(-1!=i.indexOf(e))return t.YILINGJIANG;for(var n,o=this.model.bossInfo.getBossInfos(),a=o.length,s=0;a>s;s++)if(Number(o[s].getBossId())==e){n=o[s];break}return null!=n?Number(n.getBossHp())>0?t.KETIAOZHAN:t.KELINGJIANG:t.WEIJIHUO},n.prototype.getUnionBossInfoById=function(e){for(var t,i=this.model.bossInfo.getBossInfos(),n=i.length,o=0;n>o;o++)if(t=i[o],Number(t.getBossId())==e)return t},n.prototype.backHandler=function(){e.Message.instance.send(e.MsgCMD.BATTLE_POP_HIDE,{next:!1,panel:"UnionBossPanel",tag:"backHandler",battleType:e.BattleType.BATTLE_UNION_BOSS}),this.close()},n.prototype.showHook=function(){var e=this.ui.closeBtn;null!=e&&(e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHandler,this))},n.prototype.refreshMonster=function(t){if(!this.modelController||!this.modelMonsterId||this.modelMonsterId!=t){this.modelMonsterId=t;var i=e.ActionUtils.CreateActionInfoByMonsterId(t);this.modelController?this.modelController.refreshAction(i):this.modelController=new e.ActionController(i,this.ui.bossGroup),this.modelController.updateAction(e.EnumManager.ACTION_TYPE.ACTION_RUN,5)}},n.prototype.updateRoleUnionSkill=function(){},n.prototype.bossDamageRankInfoBack=function(){},n.prototype.updateUnionActivity=function(){},n.prototype.updateUnionDaTing=function(){},n.prototype.getKillAwardIconList=function(){var e=[];return e.push(this.ui.award00),e.push(this.ui.award01),e.push(this.ui.award02),e.push(this.ui.award03),e.push(this.ui.award04),e},n.prototype.getChallengeAwardIconList=function(){var e=[];return e.push(this.ui.award10),e.push(this.ui.award11),e.push(this.ui.award12),e.push(this.ui.award13),e},n}(e.BasePanel);e.UnionBossPanel=i,__reflect(i.prototype,"foxgame.UnionBossPanel",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionBossRankItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=i.getRank(),o=e.JsonDataManager.instance.unionBossHarmRankAwardTemplate[n];this.firstImg.visible=1==n,this.secondImg.visible=2==n,this.thirdImg.visible=3==n,this.rankBLabel.text=n+"",this.nameLabel.text=i.getPlayerName(),this.damageLabel.text=i.getTotalHarm()+"",this.contributeLabel.text=o.awardVO.value+""},i}(eui.ItemRenderer);e.UnionBossRankItem=t,__reflect(t.prototype,"foxgame.UnionBossRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionBossRankPanel.exml")||this;return i.setIsShowBackBtn(!0),i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){var t=this.ui.list;t.dataProvider=this.model.bossRankCollection,t.itemRenderer=e.UnionBossRankItem,this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.scroller.verticalScrollBar.autoVisibility=!1},i.prototype.initParams=function(){this.ui.scroller.viewport.scrollV=0},i.prototype.refresh=function(){if(null==this.model.bossDamageRankInfo)return this.ui.rankBLabel.visible=!1,this.ui.noRankLabel.visible=!1,this.ui.nameLabel.visible=!1,this.ui.damageLabel.visible=!1,void(this.ui.contributeLabel.visible=!1);var t=this.model.bossDamageRankInfo.getBossHarms();this.model.bossRankCollection.replaceAll(t);for(var i,n,o=t.length,a=e.PlayerService.instance.playerInfo.getPlayerId(),s=0,r=e.PlayerService.instance.mainRoleData.name,l=0,h=0,c=!1,u=e.JsonDataManager.instance.unionBossHarmRankAwardTemplate,p=0;o>p;p++)if(i=t[p],a==Number(i.getPlayerId())){c=!0,s=i.getRank(),l=i.getTotalHarm(),n=u[s],h=n.awardVO.value;break}this.ui.noRankLabel.visible=!0,this.ui.nameLabel.visible=!0,this.ui.damageLabel.visible=!0,this.ui.contributeLabel.visible=!0,this.ui.rankBLabel.text=s+"",this.ui.rankBLabel.visible=c,this.ui.noRankLabel.visible=!c,this.ui.nameLabel.text=r,this.ui.damageLabel.text=l+"",this.ui.contributeLabel.text=h+""},i.prototype.bossInfoBack=function(){},i.prototype.updateRoleUnionSkill=function(){},i.prototype.bossKillAwardBack=function(){},i.prototype.updateUnionActivity=function(){},i.prototype.updateUnionDaTing=function(){},i.prototype.bossDamageRankInfoBack=function(){this.refresh()},i}(e.BasePanel);e.UnionBossRankPanel=t,__reflect(t.prototype,"foxgame.UnionBossRankPanel",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionBossResultPanel.exml")||this;return i.setIsShowBackBtn(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this);for(var e,t=this.getIconList(),i=t.length,n=0;i>n;n++)e=t[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.iconHandler,this)},i.prototype.refresh=function(){this.bossVO=e.JsonDataManager.instance.unionBossTemplate2[this.model.challengeBossId];for(var t,i,n=this.bossVO.challengeAward,o=this.getIconList(),a=o.length,s=0;a>s;s++)i=o[s],t=n[s],null!=t?i.setItem(t.id,t.value):i.setItem(-1)},i.prototype.iconHandler=function(t){var i=this.getIconList(),n=t.currentTarget,o=i.indexOf(n),a=this.bossVO.challengeAward[o];null!=a&&e.TipsController.getInstance().showItemTips(a.id,a.value,!1)},i.prototype.getIconList=function(){var e=[];return e.push(this.ui.icon0),e.push(this.ui.icon1),e.push(this.ui.icon2),e.push(this.ui.icon3),e},i}(e.BasePanel);e.UnionBossResultPanel=t,__reflect(t.prototype,"foxgame.UnionBossResultPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/union/UnionBossTimePanel.exml")||this;return e.isCenter=!1,e.isMask=!1,e.setIsShowBackBtn(!1),e.setRegisterTick(!0),e.isCallHideSceneObjectsWhenClose=!1,e.touchChildren=!1,e.touchEnabled=!1,e}return __extends(i,t),i.prototype.showPanel=function(e){this.totalTime=e,this.layer=0,this.show()},i.prototype.showHook=function(){var t=Number(e.GlobalConfig.instance.getValue("UNIONBOSSTIME_POSY"));this.y=t,this.lastTime=egret.getTimer(),this.tickHook(egret.getTimer())},i.prototype.tickHook=function(e){var t=e-this.lastTime;if(!(1200>t)){if(this.totalTime<0)return void this.close();this.lastTime=e,this.totalTime-=1e3;var i=Math.ceil(this.totalTime/1e3);0>i&&(i=0);var n=Math.floor(i/60),o=i%60,a=n>9?n+"":"0"+n,s=o>9?o+"":"0"+o;this.ui.timeBLabel.text=a+"m"+s}},i}(e.BasePanel);e.UnionBossTimePanel=t,__reflect(t.prototype,"foxgame.UnionBossTimePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="CreateUnionItem",e}return __extends(i,t),i.prototype.changeChooseImg=function(e){this.chooseImg.visible=e},i.prototype.setItem=function(t){var i,n,o,a,s=e.JsonDataManager.instance.unionData;switch(t){case 1:this.gonghuiLevel.text=e.LanguageUtils.instance.getValue("GONGHUIJI","1"),i=e.GlobalConfig.instance.getValue("UNION_CREATE_LEVEL_1"),n=i.split(","),o=s[1],a=new e.AttributeVO(e.GlobalConfig.instance.getValue("UNION_CREATE_COST_1")),this.bufferTxt.text=e.LanguageUtils.instance.getValue("ATT_2")+"+5%";break;case 3:this.gonghuiLevel.text=e.LanguageUtils.instance.getValue("GONGHUIJI","3"),i=e.GlobalConfig.instance.getValue("UNION_CREATE_LEVEL_3"),n=i.split(","),o=s[3],a=new e.AttributeVO(e.GlobalConfig.instance.getValue("UNION_CREATE_COST_3")),this.bufferTxt.text=e.LanguageUtils.instance.getValue("ATT_2")+"+7%"}this.vipTxt.text=e.LanguageUtils.instance.getValue("CHUANGJIANGONGHUI",n[1]),this.manNums.text=o.popSize+"",this.costTxt.text=a.value+e.LanguageUtils.instance.getValue("YUANBAO")},i}(eui.Component);e.UnionCreateItemView=t,__reflect(t.prototype,"foxgame.UnionCreateItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/CreateUnion.exml")||this;return i.setIsShowBackBtn(!0),i}return __extends(i,t),i.prototype.showHook=function(){this.strTxtDefaut=e.LanguageUtils.instance.getValue("Guild_apply_7"),this.initUI()},i.prototype.initUI=function(){this.inputTxt=this.ui.shuruTxt;var e=this.ui.item1,t=this.ui.item2;e.setItem(1),t.setItem(3),e.changeChooseImg(!0),t.changeChooseImg(!1);var i=this.ui.creatBtn;this.chooseItem=1,e.touchEnabled=!0,t.touchEnabled=!0,e.touchChildren=!1,t.touchChildren=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.inputTxt.addEventListener(egret.FocusEvent.FOCUS_IN,this.changeTxtIn,this),this.inputTxt.addEventListener(egret.FocusEvent.FOCUS_OUT,this.changeTxtOut,this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.changeTxtIn=function(e){this.inputTxt.text=""},i.prototype.changeTxtOut=function(t){var i=this.inputTxt.text,n=5;this.canCreate=!1,i.length>n?(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("Guild_apply_7")),this.inputTxt.text=this.inputTxt.text.slice(0,n)):this.canCreate=!0,this.inputTxt.text.length<2&&(this.inputTxt.text=e.LanguageUtils.instance.getValue("Guild_apply_7"))},i.prototype.checkByteLength=function(){var e,t,i=this.ui.shuruTxt.text;return i==this.strTxtDefaut?e=!1:(null!=i.match(/\s+/)&&(t=i.match(/\s+/)[0].length==i.length?!0:!1),""==this.ui.shuruTxt.text||t?(this.ui.shuruTxt.text=this.strTxtDefaut,e=!1):!0)},i.prototype.onClick=function(t){switch(t.target){case this.ui.creatBtn:var i=this.inputTxt.text;if(!this.checkByteLength())return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_5"));if(i==this.strTxtDefaut)return;var n=e.PlayerService.instance.playerInfo.getVipLevel();if(0==this.chooseItem||n<this.chooseItem)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_9"));var o=e.PlayerService.instance.playerInfo.getGold();if(1e3>o)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");if(!this.canCreate)return void(this.inputTxt.text="");if(e.Global.isYouGuSDK){var a=[];if(1==this.chooseItem?a=e.GlobalConfig.instance.getValue("UNION_CREATE_LEVEL_1").split(","):4==this.chooseItem&&(a=e.GlobalConfig.instance.getValue("UNION_CREATE_LEVEL_3").split(",")),n<Number(a[1]))return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_9"))}var s=HawkProtocolManager.newBuilder("JsProto.HPUnionCreateReq");s.setName(this.inputTxt.text),s.setThreeLevel(this.chooseItem>1?!0:!1),e.Message.instance.send(e.Code.UNION_CREATE_C,s,!0);break;case this.ui.item1:this.chooseItem=1,this.ui.item1.changeChooseImg(!0),this.ui.item2.changeChooseImg(!1);
break;case this.ui.item2:this.chooseItem=4,this.ui.item1.changeChooseImg(!1),this.ui.item2.changeChooseImg(!0)}},i}(e.BasePanel);e.UnionCreatePanel=t,__reflect(t.prototype,"foxgame.UnionCreatePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="JoinUnionItem",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){this.currentData=this.data,this.guildName.text=this.currentData.getName(),this.guildLevel.text="[LV."+this.currentData.getLevel()+"]",this.vipLevel.text="V"+this.currentData.getCdrVipLevel(),this.guildMasterName.x=this.vipLevel.x+this.vipLevel.width,this.guildMasterName.text=this.currentData.getHandName(),this.guildPlayersNum.textFlow=this.createPeopleNumTextFlow(this.currentData.getCurrnetPop(),this.currentData.getMaxPoj()),this.icon.source=this.getIconStr(),this.rankBLabel.text=this.currentData.getSort()+"";var t=this.currentData.getFightLimit();if(this.currentData.getAutoAccReq()){this.tiaoJian.text=e.LanguageUtils.instance.getValue("ZHANLIXUQIU",t/1e4);var i=e.PlayerService.instance.fightValue;i>t?(this.creatBtn.enabled=!0,this.creatBtn.touchEnabled=!0):(this.creatBtn.enabled=!1,this.creatBtn.touchEnabled=!1)}else this.tiaoJian.text=e.LanguageUtils.instance.getValue("XUSHENHE"),this.creatBtn.enabled=!0,this.creatBtn.touchEnabled=!0;this.buttonImg.source="Guild_shenqing_png",this.creatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.createPeopleNumTextFlow=function(e,t){var i;i=e==t?16711680:1111274;var n=[{text:e+"/"+t,style:{textColor:i}}];return this.peopleNumText.textColor=i,n},i.prototype.onClick=function(e){switch(e.target){case this.creatBtn:this.shenqingFun()}},i.prototype.callBackForApply=function(e){switch(e.getResult()){case 1:this.creatBtn.enabled=!1,this.creatBtn.touchEnabled=!1,this.buttonImg.source="Guild_yishenqinghui_png";break;case 2:break;case 3:break;case 4:}},i.prototype.shenqingFun=function(){e.UnionController.getInstance().shenqingGuild(this.currentData.getId(),this)},i.prototype.getIconStr=function(){var e,t=this.currentData.getSort();switch(t){case 1:e="Guild_qizijing_png",this.icon.visible=!0,this.icon0.visible=!1;break;case 2:this.icon.visible=!0,this.icon0.visible=!1,e="Guild_qiziying_png";break;case 3:this.icon.visible=!0,this.icon0.visible=!1,e="Guild_qizitong_png";break;default:this.icon.visible=!1,this.icon0.visible=!0,e="putonga_png"}return e},i}(eui.ItemRenderer);e.UnionJoinItemView=t,__reflect(t.prototype,"foxgame.UnionJoinItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/JoinUnion.exml")||this;return i.model=e,i.setIsShowBackBtn(!0),i}return __extends(i,t),i.prototype.initHook=function(){this.model.registerObserver(this)},i.prototype.bossInfoBack=function(){},i.prototype.updateRoleUnionSkill=function(){},i.prototype.bossDamageRankInfoBack=function(){},i.prototype.bossKillAwardBack=function(){},i.prototype.updateUnionActivity=function(){},i.prototype.updateUnionDaTing=function(){this.refresh()},i.prototype.showHook=function(){this.initUI()},i.prototype.initUI=function(){var t=this.ui.creatBtn;t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnCreate,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this);var i=this.model.getGuildListData(),n=i.getRankings(),o=this.ui.list;o.dataProvider=this.model.collection,o.itemRenderer=e.UnionJoinItemView,this.model.dataSource=n,this.model.collection.replaceAll(this.model.dataSource),n&&0!=n.length?this.ui.nullStr.visible=!1:this.ui.nullStr.visible=!0},i.prototype.OnCreate=function(t){this.close(),e.UnionController.getInstance().showCreatePannel()},i.prototype.refreshData=function(){this.initUI()},i}(e.BasePanel);e.UnionJoinPanel=t,__reflect(t.prototype,"foxgame.UnionJoinPanel",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.UnionVO=t,__reflect(t.prototype,"foxgame.UnionVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionApplyListItemViewSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){switch(this.currentData=this.data,this.fightNum.text=this.currentData.getFight()+"",this.vipTxt.text="V"+this.currentData.getVipLevel(),this.nameLabel.text=this.currentData.getName(),this.gongxian.text=this.checkTime(),this.type.text="[LV."+this.currentData.getLevel()+"]",this.currentData.getRoleItemId()){case 1:this.proImg1.visible=!0,this.proImg2.visible=!1,this.proImg3.visible=!1;break;case 2:this.proImg1.visible=!1,this.proImg2.visible=!0,this.proImg3.visible=!1;break;case 3:this.proImg1.visible=!1,this.proImg2.visible=!1,this.proImg3.visible=!0}var t=e.JsonDataManager.instance.roleTemplate[this.currentData.getRoleItemId()+""];this.icon.source=t.icon,this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var i=e.UnionController.getInstance().checkQuanXianByType(e.UnionQuanXianType.XIUGAIJIARENSHEZHI);i?(this.btn_1.visible=!0,this.btn_2.visible=!0,this.tongyi_img.visible=!0,this.jujue_img.visible=!0):(this.btn_1.visible=!1,this.btn_2.visible=!1,this.tongyi_img.visible=!1,this.jujue_img.visible=!1)},i.prototype.checkTime=function(){var t,i=this.currentData.getReqTime(),n=new Date;n.setTime(i);var o=n.getMonth()+1,a=n.getDate(),s=n.getHours(),r=n.getMinutes();return t=o+e.LanguageUtils.instance.getValue("YUE")+a+e.LanguageUtils.instance.getValue("RI")+" "+s+":"+r},i.prototype.onClick=function(t){var i=new e.UnionChangeZhiWeiVO;switch(t.target){case this.btn_1:i.operType=e.UnionChangeZhiWeiType.GUILD_GONGHUISHENQING,i.targetId=this.currentData.getPlayerId(),i.joinAgreed=!0;break;case this.btn_2:i.operType=e.UnionChangeZhiWeiType.GUILD_GONGHUISHENQING,i.targetId=this.currentData.getPlayerId(),i.joinAgreed=!1}e.UnionController.getInstance().changePlayerZhiWei(i)},i}(eui.ItemRenderer);e.UnionApplyListItemView=t,__reflect(t.prototype,"foxgame.UnionApplyListItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionApplyListViewSkin.exml")||this;return i._data=e,i._data.registerObserver(i),i.isMask=!1,i.adaptionType=1,i}return __extends(i,t),i.prototype.showHook=function(){this.initUI()},i.prototype.bossInfoBack=function(){},i.prototype.updateRoleUnionSkill=function(){},i.prototype.bossDamageRankInfoBack=function(){},i.prototype.bossKillAwardBack=function(){},i.prototype.updateUnionActivity=function(){},i.prototype.updateUnionDaTing=function(){this.refresh()},i.prototype.refresh=function(){this.ui.currency.refresh(),this.initUI()},i.prototype.initUI=function(){this.ui.scroller.viewport.scrollV=0,this.ui.scroller.verticalScrollBar.autoVisibility=!1,this.ui.scroller.scrollPolicyH="ScrollPolicy.OFF";var t=this.ui.list;t.dataProvider=this._data.unionApplyListCollection,t.itemRenderer=e.UnionApplyListItemView;var i=this._data.getApplyData().getRequestInfo();this._data.unionApplyListCollection.replaceAll(i);var n=this._data.checkQuanXianByType(e.UnionQuanXianType.XIUGAIJIARENSHEZHI);n?(this.ui.quanxian.visible=!0,this.ui.fightNum.text=this._data.getApplyData().getFightLimit()/1e4+"",this.ui.checkBoxBtn.selected=this._data.getApplyData().getIsAutoAccReq()):this.ui.quanxian.visible=!1},i.prototype.readyDestroy=function(){var t=1e4*Number(this.ui.fightNum.text),i=this.ui.checkBoxBtn.selected;this.ui.list.dataProvider=null,e.UnionController.getInstance().sendZhanLiNeed(i,t)},i}(e.BasePanel);e.UnionApplyListView=t,__reflect(t.prototype,"foxgame.UnionApplyListView",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.operType=1,this.targetId=2,this.joinAgreed=!1,this.position=4}return e}();e.UnionChangeZhiWeiVO=t,__reflect(t.prototype,"foxgame.UnionChangeZhiWeiVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionChengYuanItemView",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.checkLeftTime=function(e){var t=e/86400;return 3>t?!0:!1},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data,this.nameLabel.text=this.currentData.getName();var t=e.LanguageUtils.instance.getValue("Guild_pos"+this.currentData.getPostion());this.zhiwei.text=t,this.gongxian.text=this.currentData.getContribution()+"";var i=this.checkLeftTime(this.currentData.getLeftLogoutTime());this.huoyue_img.visible=i,this.qianshui_img.visible=!i;var n;switch(n=0==this.currentData.getLeftLogoutTime()?e.LanguageUtils.instance.getValue("ZAIXIAN"):e.LanguageUtils.instance.getValue("LIXIAN"),this.type.text=n,this.currentData.getProfession()){case 1:this.proImg1.visible=!0,this.proImg2.visible=!1,this.proImg3.visible=!1;break;case 2:this.proImg1.visible=!1,this.proImg2.visible=!0,this.proImg3.visible=!1;break;case 3:this.proImg1.visible=!1,this.proImg2.visible=!1,this.proImg3.visible=!0}var o=e.UnionController.getInstance().getMyVO(),a=e.JsonDataManager.instance.roleTemplate[this.currentData.getRoleItemId()+""];this.icon.source=a.icon,o.getId()!=this.currentData.getId()&&this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.fightNum.text=this.currentData.getBattlePoint()+"",this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.zhiweijiacheng.visible=!1,1==this.currentData.getPostion()&&(this.zhiweijiacheng.visible=!0,this.zhiweijiacheng.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("ZHIWEIJIACHENG")),this.zhiweijiacheng.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)),this.showMutualArea.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=e.UnionController.getInstance().getMyQuanXian();switch(s){case 1:1==this.currentData.getPostion()?(this.currentType=e.UnionChangeZhiWeiType.GUILD_CHUANWEI,this.currentType2=0):(this.currentType=e.UnionChangeZhiWeiType.GUILD_TIREN,this.currentType2=e.UnionChangeZhiWeiType.GUILD_RENMING);break;case 2:1==this.currentData.getPostion()?(this.currentType=e.UnionChangeZhiWeiType.GUILD_TANHE,this.currentType2=0):2==this.currentData.getPostion()?(this.currentType=0,this.currentType2=0):(this.currentType=e.UnionChangeZhiWeiType.GUILD_TIREN,this.currentType2=e.UnionChangeZhiWeiType.GUILD_RENMING);break;default:1==this.currentData.getPostion()?(this.currentType=e.UnionChangeZhiWeiType.GUILD_TANHE,this.currentType2=0):(this.currentType=0,this.currentType2=0)}this.checkVisible()},i.prototype.checkVisible=function(){switch(this.chuanwei.visible=!1,this.tanhe.visible=!1,this.renming.visible=!1,this.tichu.visible=!1,this.btn_1.visible=!0,this.btn_2.visible=!0,this.currentType){case e.UnionChangeZhiWeiType.GUILD_CHUANWEI:this.chuanwei.visible=!0,this.btn_1.enabled=!0,this.btn_1.touchEnabled=!0;break;case e.UnionChangeZhiWeiType.GUILD_TIREN:this.tichu.visible=!0,this.btn_1.enabled=!0,this.btn_1.touchEnabled=!0;break;case e.UnionChangeZhiWeiType.GUILD_TANHE:this.tanhe.visible=!0,this.btn_1.enabled=!this.huoyue_img.visible,this.btn_1.touchEnabled=!this.huoyue_img.visible;break;case 0:this.btn_1.visible=!1}switch(this.currentType2){case e.UnionChangeZhiWeiType.GUILD_RENMING:this.renming.visible=!0;break;case 0:this.btn_2.visible=!1}},i.prototype.onClick=function(t){switch(t.target){case this.btn_1:this.CheckSendMsg(this.currentType);break;case this.btn_2:this.CheckSendMsg(this.currentType2);break;case this.zhiweijiacheng:e.UnionController.getInstance().showZhiWeiJiaCheng();break;case this.icon:var i=new egret.Point;this.localToGlobal(this.x,this.y,i),e.UnionController.getInstance().setChatDataToHallPanel(i,this.currentData.getId());break;case this.showMutualArea:e.UnionController.getInstance().showMutualPanel(t,this.currentData.getId())}},i.prototype.CheckSendMsg=function(t){var i;switch(t){case e.UnionChangeZhiWeiType.GUILD_CHUANWEI:e.UnionController.getInstance().showTipsByValue(this.currentType,null,this.sendMsg.bind(this));break;case e.UnionChangeZhiWeiType.GUILD_TIREN:i=e.LanguageUtils.instance.getValue("Guild_apply_23",this.currentData.getName()),e.PopUpController.getInstance().showTextPanel(i,this,this.sendMsgNormal);break;case e.UnionChangeZhiWeiType.GUILD_TANHE:i=e.LanguageUtils.instance.getValue("Guild_apply_25"),e.PopUpController.getInstance().showTextPanel(i,this,this.sendMsgNormal);break;case e.UnionChangeZhiWeiType.GUILD_RENMING:e.UnionController.getInstance().showTipsByValue(this.currentType2,this.currentData,this.sendMsg2.bind(this));break;case 0:}},i.prototype.sendMsgNormal=function(){var t=new e.UnionChangeZhiWeiVO;t.operType=this.currentType,t.targetId=this.currentData.getId(),e.UnionController.getInstance().changePlayerZhiWei(t)},i.prototype.sendMsg=function(t,i){var n=new e.UnionChangeZhiWeiVO;n.operType=this.currentType,n.targetId=t.getId(),e.UnionController.getInstance().changePlayerZhiWei(n)},i.prototype.sendMsg2=function(t,i){var n=new e.UnionChangeZhiWeiVO;n.operType=this.currentType2,n.targetId=this.currentData.getId(),n.position=i.posId,e.UnionController.getInstance().changePlayerZhiWei(n)},i}(eui.ItemRenderer);e.UnionChengYuanItemView=t,__reflect(t.prototype,"foxgame.UnionChengYuanItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionChengYuanView",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onStage,e),e}return __extends(i,t),i.prototype.onStage=function(e){this.isUIOk=!0,this.initUI()},i.getIntance=function(){return this._intance||(this._intance=new i),this._intance},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,e.GlobalUtil.doTransformDisplayObjectContainerDestroyBitmapResNotUse(this),this.removeChildren(),i._intance=null},i.prototype.setData=function(t){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this._data=t,this.isDataOk=!0,this.initUI()},i.prototype.initUI=function(){if(this.isDataOk&&this.isUIOk){this.scroller.viewport.scrollV=0,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.scrollPolicyH="ScrollPolicy.OFF";var t=this.list;t.dataProvider=this._data.unionChengYuanCollection,t.itemRenderer=e.UnionChengYuanItemView;var i=this._data.getMemberData().getMemberList();this._data.unionChengYuanCollection.replaceAll(i),this.isDataOk=!1,this.isUIOk=!1}},i.prototype.refresh=function(){},i}(eui.Component);e.UnionChengYuanView=t,__reflect(t.prototype,"foxgame.UnionChengYuanView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.GUILD_JICHU=1]="GUILD_JICHU",e[e.GUILD_CHENGYUAN=2]="GUILD_CHENGYUAN",e[e.GUILD_LIEBIAO=3]="GUILD_LIEBIAO"}(t=e.UnionViewType||(e.UnionViewType={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/union/UnionHall.exml","union_hall")||this;return t.model=e,t.setIsShowBackBtn(!0),t.model.registerObserver(t),t.isMask=!1,t.adaptionType=1,t}return __extends(n,i),n.prototype.initHook=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeMutualView,this),this.doScreenAdaptation()},n.prototype.showHook=function(){this.initUI()},n.prototype.refreshData=function(){},n.prototype.initUI=function(){this.initListener();this.model.getUnionCreateData();this.myVo=this.model.getUnionEnterData();var e=this.myVo.getMyInfo().getPostion();this.changeZhiWeiStr(e),this.initJiChuView(),this.changeBtnSource("jichu")},n.prototype.refresh=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.ui.currency.refresh(),this.initUI()},n.prototype.bossInfoBack=function(){},n.prototype.updateRoleUnionSkill=function(){},n.prototype.bossDamageRankInfoBack=function(){},n.prototype.bossKillAwardBack=function(){},n.prototype.updateUnionActivity=function(){},n.prototype.updateUnionDaTing=function(){this.refresh()},n.prototype.initJiChuView=function(){this.ui.gongxianGroup.visible=!0,this.ui.gxtxt.text=e.LanguageUtils.instance.getValue("WODEGONGXIAN"),this.ui.gongxian.text=this.myVo.getMyInfo().getCurrContribution()+"",this.ui.list.removeChildren(),this.current_JieMian=t.GUILD_JICHU,this.jichuView||(this.jichuView=e.UnionJiChuView.getIntance()),this.jichuView.setData(this.model),this.ui.list.addChild(this.jichuView);var i=this.model.getMemberData().getMemberList();this.model.unionJiChuCollection.replaceAll(i),this.ui.unionBg.visible=!1},n.prototype.initChengYuanView=function(){this.ui.gongxianGroup.visible=!0,this.ui.gxtxt.text=e.LanguageUtils.instance.getValue("LISHIGONGXIAN"),this.ui.gongxian.text=this.myVo.getMyInfo().getContribution()+"",this.ui.list.removeChildren(),this.current_JieMian=t.GUILD_CHENGYUAN,this.chengyuanView||(this.chengyuanView=e.UnionChengYuanView.getIntance()),this.chengyuanView.setData(this.model),this.ui.list.addChild(this.chengyuanView)},n.prototype.initLieBiaoView=function(){this.ui.gongxianGroup.visible=!1,this.ui.gxtxt.text=e.LanguageUtils.instance.getValue("LISHIGONGXIAN"),this.ui.gongxian.text=this.myVo.getMyInfo().getContribution()+"",this.ui.list.removeChildren(),this.current_JieMian=t.GUILD_LIEBIAO,this.liebiaoView||(this.liebiaoView=e.UnionLieBiaoView.getIntance()),this.liebiaoView.setData(this.model),this.ui.list.addChild(this.liebiaoView)},n.prototype.changeZhiWeiStr=function(t){var i=e.LanguageUtils.instance.getValue("Guild_pos"+t);this.ui.myZhiWeis.text=i},n.prototype.initListener=function(){this.ui.jichu_Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.chengyuanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.liebiaoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.tuichuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.prototype.changeBtnSource=function(e){switch(this.ui.jichu_Btn.source="normalBtn3_1_png",this.ui.chengyuanBtn.source="normalBtn3_1_png",this.ui.liebiaoBtn.source="normalBtn3_1_png",e){case"jichu":this.ui.jichu_Btn.source="normalBtn3_2_png";break;case"chengyuan":this.ui.chengyuanBtn.source="normalBtn3_2_png";break;case"liebiao":this.ui.liebiaoBtn.source="normalBtn3_2_png"}},n.prototype.onClick=function(i){switch(i.target){case this.ui.jichu_Btn:this.current_JieMian!=t.GUILD_JICHU&&this.initJiChuView(),this.ui.unionBg.visible=!1,this.changeBtnSource("jichu");break;case this.ui.chengyuanBtn:this.current_JieMian!=t.GUILD_CHENGYUAN&&this.initChengYuanView(),this.ui.unionBg.visible=!0,this.changeBtnSource("chengyuan");break;case this.ui.liebiaoBtn:this.current_JieMian!=t.GUILD_LIEBIAO&&this.initLieBiaoView(),this.ui.unionBg.visible=!0,this.changeBtnSource("liebiao");break;case this.ui.tuichuBtn:var n=e.LanguageUtils.instance.getValue("Guild_exit");e.PopUpController.getInstance().showTextPanel(n,this,this.isExit)}},n.prototype.closeMutualView=function(t){e.ChatMutual.getInstance().closeMutual(t)},n.prototype.showMutalView=function(t,i){t.stopPropagation();var n=new egret.Point(t.stageX,t.stageY),o=this.globalToLocal(n.x,n.y);e.ChatMutual.getInstance().showMutual(o,this,i)},n.prototype.addMutual=function(e){this.ui.addChild(e)},n.prototype.isExit=function(){var t=this.model.getUnionEnterData(),i=new e.UnionChangeZhiWeiVO;i.operType=e.UnionChangeZhiWeiType.GUILD_TUICHU,i.targetId=t.getMyInfo().getId(),e.UnionController.getInstance().changePlayerZhiWei(i)},n.prototype.getCloseBtn=function(){return this.ui.closeBtn},n}(e.BasePanel);e.UnionHall=i,__reflect(i.prototype,"foxgame.UnionHall",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionJiChuItem",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){this.currentData=this.data,this.nameLabel.text=this.currentData.getName()+" LV."+this.currentData.getLevel();var t=e.LanguageUtils.instance.getValue("Guild_pos"+this.currentData.getPostion());this.zhiwei.text=t,this.gongxian.text=this.currentData.getContribution()+"",this.vipAsset.text="V"+this.currentData.getViplevel()},i}(eui.ItemRenderer);e.UnionJiChuItemView=t,__reflect(t.prototype,"foxgame.UnionJiChuItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionJiChuView",e}return __extends(i,t),i.getIntance=function(){return this._intance||(this._intance=new i),this._intance},i.prototype.setData=function(t){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this._data=t,this.scroller.viewport.scrollV=0,this.initUI()},i.prototype.onEventRemovedFromParent=function(e){},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this),this.parent&&this.parent.removeChild(this),this._data=null,e.GlobalUtil.doTransformDisplayObjectContainerDestroyBitmapResNotUse(this),this.removeChildren(),i._intance=null},i.prototype.initUI=function(){var t=this._data.getUnionCreateData();this.guildName.text=t.getName(),this.huizhangName.text=t.getCdrName();var i=this._data.getMemberData().getMemberList().length;this.numPlayers.text=i+"/"+t.getMaxPop(),this.level.text=t.getLevel()+"",this.exp.text=t.getCurrentExp()+"/"+t.getNextExp(),this.expImg.width=t.getCurrentExp()/t.getNextExp()*this.expAllImg.width,this.shenqingBtn.textFlow=(new egret.HtmlTextParser).parse("<u>"+this.shenqingBtn.text+"</u>"),this.shenqingBtn.touchEnabled=!0,this.shenqingBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.UnionController.getInstance().checkRedApply()?this.leftRedImg.visible=!0:this.leftRedImg.visible=!1;var n=this.list;n.dataProvider=this._data.unionJiChuCollection,n.itemRenderer=e.UnionJiChuItemView},i.prototype.onClick=function(t){switch(t.target){case this.shenqingBtn:e.UnionController.getInstance().showGuildApplyListPanel()}},i.prototype.refresh=function(){},i}(eui.Component);e.UnionJiChuView=t,__reflect(t.prototype,"foxgame.UnionJiChuView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionLieBiaoItemView",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.currentData=this.data,this.rankBLabel.text=this.currentData.getSort()+"",this.level.text=this.currentData.getLevel()+"",this.vipLevel.text="V"+this.currentData.getCdrVipLevel(),this.guildName.text=this.currentData.getName(),this.guildMasterName.text=this.currentData.getHandName(),this.guildPlayersNum.text=this.currentData.getCurrnetPop()+"/"+this.currentData.getMaxPoj(),this.icon.source=this.getIconStr()},i.prototype.getIconStr=function(){var e,t=this.currentData.getSort();switch(t){case 1:e="Guild_qizijing_png";break;case 2:e="Guild_qiziying_png";break;case 3:e="Guild_qizitong_png";break;default:e="putonga_png"}return e},i.prototype.onClick=function(e){e.target},i}(eui.ItemRenderer);e.UnionLieBiaoItemView=t,__reflect(t.prototype,"foxgame.UnionLieBiaoItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionLieBiaoViewSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onStage,e),e}return __extends(i,t),i.prototype.onStage=function(e){this.isUIOk=!0,this.initUI()},i.getIntance=function(){return this._intance||(this._intance=new i),this._intance},i.prototype.setData=function(t){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this._data=t,this.isDataOk=!0,this.initUI()},i.prototype.initUI=function(){if(this.isDataOk&&this.isUIOk){this.scroller.viewport.scrollV=0,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.scrollPolicyH="ScrollPolicy.OFF";var t=this.list;t.dataProvider=this._data.unionLieBiaoCollection,t.itemRenderer=e.UnionLieBiaoItemView;var i=this._data.getGuildListData().getRankings();this._data.unionLieBiaoCollection.replaceAll(i),this.isDataOk=!1,this.isUIOk=!1}},i.prototype.refresh=function(){},i}(eui.Component);e.UnionLieBiaoView=t,__reflect(t.prototype,"foxgame.UnionLieBiaoView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionZhiWeiJiaChengView.exml")||this;return i._data=e,i._data.registerObserver(i),i}return __extends(i,t),i.prototype.refresh=function(){this.initUI()},i.prototype.bossInfoBack=function(){},i.prototype.updateRoleUnionSkill=function(){},i.prototype.bossDamageRankInfoBack=function(){},i.prototype.bossKillAwardBack=function(){},i.prototype.updateUnionActivity=function(){},i.prototype.updateUnionDaTing=function(){this.refresh()},i.prototype.initUI=function(){for(var t,i,n=this._data.getUnionCreateData().getLevel(),o=e.JsonDataManager.instance.unionPostion,a=o.length,s=0;a>s;s++){var r=o[s];r.unionLevel==n&&(t=e.LanguageUtils.instance.getValue("Guild_pos"+r.posId),this.getTxtByName("txt_"+r.posId).text=t+":",i=e.LanguageUtils.instance.getValue("ATT_"+Number(r.posAttr[0])),this.getTxtByName("fight_"+r.posId).text=i+"+"+Number(r.posAttr[1])/100+"%")}this.ui.confirmBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},i.prototype.getTxtByName=function(e){return this.ui[e]},i}(e.BasePanel);e.UnionZhiWeiJiaChengView=t,__reflect(t.prototype,"foxgame.UnionZhiWeiJiaChengView",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="MainDestel",e}return __extends(i,t),i.prototype.initUI=function(e,t){this.yesBtn.touchEnabled=!0,this.noBtn.touchEnabled=!0,this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.message.text=e,this.message.touchEnabled=2==t||1==t},i.prototype.onClick=function(e){switch(e.target){case this.yesBtn:this.message.touchEnabled&&this.setMessageToSever();break;case this.noBtn:}this.visible=!1},i.prototype.setMessageToSever=function(){var t=HawkProtocolManager.newBuilder("JsProto.SetUnionNoticeReq");t.setNotice(this.message.text),e.Message.instance.send(e.Code.UNION_NOTICE_C,t,!0)},i}(eui.Component);e.UnionMainDestel=t,__reflect(t.prototype,"foxgame.UnionMainDestel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionMain.exml","union_mainScene")||this;return i.model=e,i.setIsShowBackBtn(!0),i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initUI=function(){this.ui.mainDestel.visible=!1;var e=this.model.getUnionEnterData().getUnionInfo(),t=this.ui.guildName;t.text=e.getName();var i=this.ui.huizhangName;i.text=e.getCdrName();var n=this.ui.numPlayers;n.text=e.getCurrentPop()+"/"+e.getMaxPop();var o=this.ui.level;o.text=e.getLevel()+"";var a=this.ui.exp;a.text=e.getCurrentExp()+"/"+e.getNextExp();var s=this.ui.expAllImg;this.setProgress(s,e.getCurrentExp(),e.getNextExp()),this.changeMessageLabel(e.getAnnoucement()),this.checkRedPoint(),this.initListener()},i.prototype.initListener=function(){var e=this.ui.shachengGroup,t=this.ui.datingGroup,i=this.ui.skillGroup,n=this.ui.bossGroup,o=this.ui.guangchangGroup;e.touchChildren=!1,t.touchChildren=!1,i.touchChildren=!1,n.touchChildren=!1,o.touchChildren=!1,this.ui.zhengbaShowImg.visible=!1,this.ui.jinengShowImg.visible=!1,this.ui.datingShowImg.visible=!1,this.ui.bossShowImg.visible=!1,this.ui.guangchangShowImg.visible=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.ui.zhengbaShowGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.ui.jinengShowGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.ui.datingShowGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.ui.bossShowGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.ui.guangchangShowGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.ui.zhengbaShowGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.ui.jinengShowGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.ui.datingShowGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.ui.bossShowGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.ui.guangchangShowGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},i.prototype.setProgress=function(e,t,i){function n(e,n){return t+"/"+i}e.maximum=i,e.value=t,e.labelFunction=n},i.prototype.onBegin=function(e){switch(e.target){case this.ui.shachengGroup:this.ui.zhengbaShowImg.visible=!0;break;case this.ui.datingGroup:this.ui.datingShowImg.visible=!0;break;case this.ui.skillGroup:this.ui.jinengShowImg.visible=!0;break;case this.ui.bossGroup:this.ui.bossShowImg.visible=!0;break;case this.ui.guangchangGroup:this.ui.guangchangShowImg.visible=!0;break;case this.ui.zhengbaShowGroup:this.ui.zhengbaShowImg.visible=!0;break;case this.ui.datingShowGroup:this.ui.datingShowImg.visible=!0;break;case this.ui.jinengShowGroup:this.ui.jinengShowImg.visible=!0;break;case this.ui.bossShowGroup:this.ui.bossShowImg.visible=!0;break;case this.ui.guangchangShowGroup:this.ui.guangchangShowImg.visible=!0}},i.prototype.onEnd=function(e){switch(e.target){case this.ui.shachengGroup:this.ui.zhengbaShowImg.visible=!1;break;case this.ui.datingGroup:this.ui.datingShowImg.visible=!1;break;case this.ui.skillGroup:this.ui.jinengShowImg.visible=!1;break;case this.ui.bossGroup:this.ui.bossShowImg.visible=!1;break;case this.ui.guangchangGroup:this.ui.guangchangShowImg.visible=!1;break;case this.ui.zhengbaShowGroup:this.inShaCheng();break;case this.ui.datingShowGroup:this.inDaTing();break;case this.ui.jinengShowGroup:this.inSkill();break;case this.ui.bossShowGroup:this.inBoss();break;case this.ui.guangchangShowGroup:this.inGuangChang()}},i.prototype.checkRedPoint=function(){e.UnionController.getInstance().checkRedApply()?this.ui.red_dating.visible=!0:this.ui.red_dating.visible=!1,this.model.bossInfo&&this.model.bossInfo.getBossInfos()&&e.UnionController.getInstance().checkBossOperate()?this.ui.redboss.visible=!0:this.ui.redboss.visible=!1,this.model.currentRoleUnionSkillMsg&&e.UnionController.getInstance().checkUnionSkillOperate()?this.ui.redskill.visible=!0:this.ui.redskill.visible=!1,this.model.getUnionEnterData()&&(e.UnionController.getInstance().checkUnionActivityOperate()||e.UnionController.getInstance().activityPanel.refreshyijiredpoint()?this.ui.redguangchang.visible=!0:this.ui.redguangchang.visible=!1)},i.prototype.changeMessageLabel=function(t){var i=this.ui.messageLabel,n="";if(n=t.length>=40?t.slice(0,40):t,e.Global.isYouGuSDK)i.textFlow=(new egret.HtmlTextParser).parse(e.LanguageUtils.instance.getValue("YG_UNION_MESSAGE")),i.touchEnabled=!1;
else{var o=n+".."+e.LanguageUtils.instance.getValue("CHAKANBIANJI");i.textFlow=(new egret.HtmlTextParser).parser(o),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.onClick=function(e){switch(e.target){case this.ui.shachengGroup:this.inShaCheng();break;case this.ui.datingGroup:this.inDaTing();break;case this.ui.skillGroup:this.inSkill();break;case this.ui.bossGroup:this.inBoss();break;case this.ui.guangchangGroup:this.inGuangChang();break;case this.ui.messageLabel:this.ui.mainDestel.visible=!0;var t=this.model.getUnionEnterData(),i=t.getMyInfo(),n=i.getPostion(),o=this.model.getUnionCreateData();this.ui.mainDestel.initUI(o.getAnnoucement(),n)}},i.prototype.inShaCheng=function(){this.ui.zhengbaShowImg.visible=!1,e.UnionSiegeController.getInstance().showPanel()},i.prototype.inDaTing=function(){this.ui.datingShowImg.visible=!1,e.UnionController.getInstance().getMessageForGuildPlayer(),this.model.isMyMessage=!0},i.prototype.inSkill=function(){this.ui.jinengShowImg.visible=!1,e.UnionController.getInstance().showSkillPanel()},i.prototype.inBoss=function(){this.ui.bossShowImg.visible=!1,e.UnionController.getInstance().showBossPanel()},i.prototype.inGuangChang=function(){this.ui.guangchangShowImg.visible=!1,e.UnionController.getInstance().showActivityPanel()},i.prototype.refreshData=function(){},i.prototype.refresh=function(){this.initUI()},i.prototype.bossInfoBack=function(){},i.prototype.updateRoleUnionSkill=function(){},i.prototype.bossDamageRankInfoBack=function(){},i.prototype.bossKillAwardBack=function(){},i.prototype.updateUnionActivity=function(){},i.prototype.updateUnionDaTing=function(){this.refresh()},i}(e.BasePanel);e.UnionMainPanel=t,__reflect(t.prototype,"foxgame.UnionMainPanel",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionSkillItem",e}return __extends(i,t),i.prototype.init=function(){this.selectImg.visible=!1},i.prototype.showSelected=function(){this.selectImg.visible=!0},i.prototype.setIcon=function(e){this.icon.source=e+"_png"},i.prototype.getIconSource=function(){return this.icon.source},i.prototype.setIndex=function(e){this.itemIndex=e},i.prototype.getIndex=function(){return this.itemIndex},i.prototype.setId=function(e){this.itemId=e},i.prototype.getId=function(){return this.itemId},i.prototype.showRedPoint=function(e){this.redPoint.visible=e},i.prototype.setSkillLevel=function(e){this.skillLevel.text="Lv."+e},i.prototype.setGray=function(t){t?this.icon.filters=e.GlobalUtil.grayFilter:this.icon.filters=[]},i}(eui.Component);e.UnionSkillItem=t,__reflect(t.prototype,"foxgame.UnionSkillItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.GEREN=1]="GEREN",e[e.GONGGONG=2]="GONGGONG"}(t=e.UnionSkillState||(e.UnionSkillState={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/union/UnionSkill.exml","union_skill")||this;return t.model=e,t.model.registerObserver(t),t.isMask=!1,t.adaptionType=1,t}return __extends(n,i),n.prototype.updateRoleUnionSkill=function(){this.refresh()},n.prototype.refresh=function(){this.ui.currency.refresh(),null!=this.model.currentRoleUnionSkillMsg&&this.getIsInit()&&this.updateRoleSkill()},n.prototype.closeHook=function(){e.UnionController.getInstance().openViewData()},n.prototype.initHook=function(){this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.learnBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.personalBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.publicBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.ui.headBar.setFigthGradeShow(!1),this.ui.skipText.textFlow=(new egret.HtmlTextParser).parse(e.LanguageUtils.instance.getValue("HUODONGGUANGCHANG")),this.ui.skipText.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.initData();for(var t=this.getPersonalSkills().length,i=0;t>i;i++)this.getPersonalSkills()[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectSkill,this),this.getPersonalSkills()[i].setIndex(i);for(var n=this.getPublicSkills().length,i=0;n>i;i++)this.getPublicSkills()[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectSkill,this),this.getPublicSkills()[i].setIndex(i);this.doScreenAdaptation()},n.prototype.setRoleData=function(e){e!=this.model.roleData&&(this.model.roleData=e,this.initData(),this.updateRoleSkill())},n.prototype.updateRoleSkill=function(){var i=e.JsonDataManager.instance.unionPersonalSkill,n=e.JsonDataManager.instance.unionPublicSkill,o=this.model.currentRoleUnionSkillMsg;if(void 0!=o){var a,s,r=o.getContribution(),l=o.getUnionFund(),h=o.getRoleUnionSkills().length;if(this.model.selectTap==t.GEREN){void 0==this.model.roleData&&(this.model.roleData=e.PlayerService.instance.getRoleDataList()[0]);for(var c=this.model.roleData.roleId,u=0,p=0;h>p;p++){var g=o.getRoleUnionSkills()[p],d=g.getRoleId();if(c==d){var f=g.getSkillIds();u=p;for(var m=0;m<f.length;m++){var y=i[f[m]].icon,I=i[f[m]].id,v=i[f[m]].level;0==i[f[m]].level?this.getPersonalSkills()[m].setGray(!0):this.getPersonalSkills()[m].setGray(!1),this.getPersonalSkills()[m].setIcon(y),this.getPersonalSkills()[m].setId(I),this.getPersonalSkills()[m].setSkillLevel(v)}}}var _=o.getRoleUnionSkills()[u].getSkillIds();a=i[_[this.model.currentSelectSkillIndex]],s=i[a.id+1],a.type!=s.type&&(s=null),this.ui.surplusNum.text=r+"",this.ui.consumeText.text=e.LanguageUtils.instance.getValue("SHENGYUGONGXIAN")+":"}else{for(var T=this.getPublicSkills().length,p=0;T>p;p++)if(this.getPublicSkills()[p].setIndex(p),o){var f=o.getUnionSkillIds(),y=n[f[p]].icon,I=n[f[p]].id,v=n[f[p]].level;0==n[f[p]].level?this.getPublicSkills()[p].setGray(!0):this.getPublicSkills()[p].setGray(!1),this.getPublicSkills()[p].setIcon(y),this.getPublicSkills()[p].setId(I),this.getPublicSkills()[p].setSkillLevel(v)}if(a=n[o.getUnionSkillIds()[this.model.currentSelectSkillIndex]],null==a)return;s=n[a.id+1],a.type!=s.type&&(s=null),this.ui.surplusNum.text=l+"",this.ui.consumeText.text=e.LanguageUtils.instance.getValue("SHENGYUZIJIN")+":"}this.refreshRedPoint(),this.updateCurrentSelectSkillId(),this.ui.skillnName.text=a.name,this.ui.skillLevel.text=e.LanguageUtils.instance.getValue("LEVEL")+":"+a.level;var C=a.attr[0][0],A=e.LanguageUtils.instance.getValue("ATT_"+C);if(this.model.selectTap==t.GEREN){if(3==this.model.currentSelectSkillIndex)this.ui.currentAttr.text=A+"+"+a.attr[0][1];else{var E=1+Number(n[o.getUnionSkillIds()[2]].attr[0][1])/1e4;this.ui.currentAttr.text=A+"+"+e.GlobalUtil.calcFloat(Number(a.attr[0][1]),E)}Number(a.levelUpCost[0][2])<=r?this.ui.consumeNum.textColor=16777215:this.ui.consumeNum.textColor=16711680}else{var S=Number(a.attr[0][1])/100;this.ui.currentAttr.text=A+"+"+S+"%",Number(a.levelUpCost[0][2])<=l?this.ui.consumeNum.textColor=16777215:this.ui.consumeNum.textColor=16711680}if(s)if(this.model.selectTap==t.GEREN)this.ui.purposAttr.text=s.attr[0][1];else{var S=Number(s.attr[0][1])/100;this.ui.purposAttr.text=A+"+"+S+"%"}else this.ui.purposAttr.text=e.LanguageUtils.instance.getValue("YIMANJI");this.ui.consumeNum.text=a.levelUpCost[0][2]}},n.prototype.refreshRedPoint=function(){this.ui.personalBtnRedPoint.visible=!1,this.ui.publicBtnRedPoint.visible=!1;for(var t=this.model.currentRoleUnionSkillMsg,i=t.getRoleUnionSkills().length,n=e.JsonDataManager.instance.unionPersonalSkill,o=e.JsonDataManager.instance.unionPublicSkill,a=t.getContribution(),s=t.getUnionFund(),r=[!1,!1,!1],l=0;i>l;l++)for(var h=t.getRoleUnionSkills()[l],c=h.getSkillIds(),u=!1,p=0;p<c.length;p++)Number(n[c[p]].levelUpCost[0][2])<=a&&(u=!0,this.ui.personalBtnRedPoint.visible=!0,r[l]=!0),h.getRoleId()==this.model.roleData.roleId&&this.getPersonalSkills()[p].showRedPoint(u);for(var g=this.getPublicSkills().length,l=0;g>l;l++)if(t){var c=t.getUnionSkillIds();Number(o[c[l]].levelUpCost[0][2])<=s?(this.getPublicSkills()[l].showRedPoint(!0),this.ui.publicBtnRedPoint.visible=!0):this.getPublicSkills()[l].showRedPoint(!1)}for(var l=0;l<r.length;l++){var d=r[l];this.ui.headBar.setRedStatus(l,d)}},n.prototype.initParams=function(){this.model.roleData=null,this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList())},n.prototype.refreshRoleData=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1),this.sendUnionSkillReq()},n.prototype.initData=function(){if(this.getIsShow()){this.ui.personalBtn.enabled=!1,this.ui.publicBtn.enabled=!0,this.ui.gerenGroup.visible=!0,this.ui.headBar.setFigthGradeShow(!0),this.ui.publicGroup.visible=!1;for(var e=this.getPersonalConsumeIcon().length,i=0;e>i;i++){var n=this.getPersonalConsumeIcon()[i],o=this.getPublicConsumeIcon()[i];n.visible=!0,o.visible=!1}this.model.selectTap=t.GEREN,this.initSkillSelect()}},n.prototype.btnClick=function(i){switch(i.target){case this.ui.helpBtn:e.HelpController.getInstance().showPanel("GUILDSKILLSHELP");break;case this.ui.learnBtn:this.sendLearnReq();break;case this.ui.personalBtn:this.ui.personalBtn.enabled=!1,this.ui.publicBtn.enabled=!0,this.ui.gerenGroup.visible=!0,this.ui.publicGroup.visible=!1,this.model.selectTap=t.GEREN;for(var n=this.getPersonalConsumeIcon().length,o=0;n>o;o++){var a=this.getPersonalConsumeIcon()[o],s=this.getPublicConsumeIcon()[o];a.visible=!0,s.visible=!1}this.initSkillSelect();break;case this.ui.publicBtn:this.ui.publicBtn.enabled=!1,this.ui.personalBtn.enabled=!0,this.ui.gerenGroup.visible=!1,this.ui.publicGroup.visible=!0,this.model.selectTap=t.GONGGONG;for(var r=this.getPublicConsumeIcon().length,o=0;r>o;o++){var a=this.getPersonalConsumeIcon()[o],s=this.getPublicConsumeIcon()[o];a.visible=!1,s.visible=!0}this.initSkillSelect();break;case this.ui.skipText:this.close(),e.UnionController.getInstance().showActivityPanel()}},n.prototype.sendLearnReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionSkillLevelUpReq"),i=this.model.roleData.roleId,n=this.model.currentSelectSkillId;t.setRoleId(i),t.setSkillId(n),e.Message.instance.send(e.Code.UNION_SKILL_LEVEL_UP_C,t,!0)},n.prototype.sendUnionSkillReq=function(){this.model.currentRoleUnionSkillMsg=null;var t=HawkProtocolManager.newBuilder("JsProto.GetUnionSkillInfoReq");e.Message.instance.send(e.Code.UNION_SKILL_INFO_C,t,!0)},n.prototype.initSkillSelect=function(){switch(this.updateRoleSkill(),this.model.selectTap){case t.GEREN:this.initSkills(this.getPersonalSkills());break;case t.GONGGONG:this.initSkills(this.getPublicSkills())}},n.prototype.initSkills=function(e){for(var t=e.length,i=0;t>i;i++){var n=e[i];n.init(),0==i&&(n.showSelected(),this.model.currentSelectSkillIndex=0,this.model.currentSelectSkillId=n.getId(),this.ui.showImg.source=n.getIconSource())}},n.prototype.updateCurrentSelectSkillId=function(){if(this.model.selectTap==t.GEREN)for(var e=this.getPersonalSkills().length,i=0;e>i;i++){var n=this.getPersonalSkills()[i];n.getIndex()==this.model.currentSelectSkillIndex&&(this.model.currentSelectSkillId=n.getId())}else for(var o=this.getPublicSkills().length,i=0;o>i;i++){var n=this.getPublicSkills()[i];n.getIndex()==this.model.currentSelectSkillIndex&&(this.model.currentSelectSkillId=n.getId())}},n.prototype.selectSkill=function(e){var i=e.currentTarget;switch(this.model.selectTap){case t.GEREN:for(var n=this.getPersonalSkills().length,o=0;n>o;o++){var a=this.getPersonalSkills()[o];a.init()}break;case t.GONGGONG:for(var s=this.getPublicSkills().length,o=0;s>o;o++){var a=this.getPublicSkills()[o];a.init()}}this.model.currentSelectSkillIndex=i.getIndex(),this.model.currentSelectSkillId=i.getId(),i.showSelected(),this.ui.showImg.source=i.getIconSource(),this.updateRoleSkill()},n.prototype.bossInfoBack=function(){},n.prototype.bossDamageRankInfoBack=function(){},n.prototype.bossKillAwardBack=function(){},n.prototype.updateUnionActivity=function(){},n.prototype.updateUnionDaTing=function(){},n.prototype.getPersonalSkills=function(){var e=[];return e.push(this.ui.skill0),e.push(this.ui.skill1),e.push(this.ui.skill2),e.push(this.ui.skill3),e},n.prototype.getPublicSkills=function(){var e=[];return e.push(this.ui.skill4),e.push(this.ui.skill5),e.push(this.ui.skill6),e},n.prototype.getPersonalConsumeIcon=function(){var e=[];return e.push(this.ui.personalConsumeIcon0),e.push(this.ui.personalConsumeIcon1),e},n.prototype.getPublicConsumeIcon=function(){var e=[];return e.push(this.ui.publicConsumeIcon0),e.push(this.ui.publicConsumeIcon1),e},n}(e.BasePanel);e.UnionSkillPanel=i,__reflect(i.prototype,"foxgame.UnionSkillPanel",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.UnionSkillVO=t,__reflect(t.prototype,"foxgame.UnionSkillVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionZhiWeiTipsItemSkin",e}return __extends(i,t),i.prototype.setItem=function(t,i,n,o){void 0===n&&(n=0),this._backF=o;var a,s,r;if(t&&(this.playerName.textFlow=(new egret.HtmlTextParser).parser(t.getName()),this.checkBoxBtn.selected=!1,this.lockImg.visible=!1),i){var l=this.checkPosNums(i.posId);s="<font color = '0x00a3ff'>"+e.LanguageUtils.instance.getValue("Guild_pos"+i.posId)+"</font>",l>100?(r="<font color = '0x21ff03'>(无限)</font>",a=s+r,this.playerName.textFlow=(new egret.HtmlTextParser).parser(a)):(r=n==l?"<font color = '0xff0000'>("+n+"/"+l+")</font>":"<font color = '0x21ff03'>("+n+"/"+l+")</font>",a=s+r,this.playerName.textFlow=(new egret.HtmlTextParser).parser(a)),this.checkBoxBtn.selected=!1,n==l?this.lockImg.visible=!0:this.lockImg.visible=!1}this.checkBoxBtn.touchEnabled=!this.lockImg.visible,this.currentVO=t,this.currentLiVO=i,this.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(e){switch(e.target){case this.checkBoxBtn:this._backF(this.checkBoxBtn.selected,this)}},i.prototype.checkPosNums=function(t){for(var i,n=e.JsonDataManager.instance.unionPostion,o=n.length,a=e.UnionController.getInstance().getGuildLevel(),s=0;o>s;s++){var r=n[s];if(r.posId==t&&r.unionLevel==a){i=r.posNum;break}}return i},i.prototype.getSelect=function(){return this.checkBoxBtn.selected},i.prototype.setSelect=function(e){this.checkBoxBtn.selected=e},i.prototype.getMember=function(){return this.currentVO},i.prototype.getUnionLimitsVO=function(){return this.currentLiVO},i}(eui.Component);e.UnionZhiWeiTipsItemView=t,__reflect(t.prototype,"foxgame.UnionZhiWeiTipsItemView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/union/UnionZhiWeiTips.exml")||this;return i.model=e,i.setIsShowBackBtn(!0),i.model.registerObserver(i),i}return __extends(i,t),i.prototype.backF=function(e,t){for(var i=this.tipsArr.length,n=0;i>n;n++){var o=this.tipsArr[n];o==t?o.setSelect(e):o.setSelect(!1)}},i.prototype.refresh=function(){this.getIsShow()&&this.getIsInit()&&this.ui&&this.initUI()},i.prototype.bossInfoBack=function(){},i.prototype.updateRoleUnionSkill=function(){},i.prototype.bossDamageRankInfoBack=function(){},i.prototype.bossKillAwardBack=function(){},i.prototype.updateUnionActivity=function(){},i.prototype.updateUnionDaTing=function(){this.refresh()},i.prototype.setType=function(e,t,i){this._callBackF=i,this.currentType=e,this.currentVO=t},i.prototype.initUI=function(){this.currentType==e.UnionQuanXianType.CHUANWEI?this.chuanweiUI():this.currentType==e.UnionQuanXianType.RENMING&&this.renmingUI(),this.ui.confirmBtn&&this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.chuanweiUI=function(){var t=e.LanguageUtils.instance.getValue("Guild_apply_22");this.ui.titleStr.textFlow=(new egret.HtmlTextParser).parser(t);for(var i=this.model.getMemberData().getMemberList(),n=i.length,o=[],a=0;n>a;a++){var s=i[a];2==s.getPostion()&&o.push(s)}n=o.length,this.ui.group.removeChildren(),this.tipsArr=[];for(var r=0;n>r;r++){var l=o[r],h=new e.UnionZhiWeiTipsItemView;h.setItem(l,null,0,this.backF.bind(this)),this.ui.group.addChild(h),h.x=r%2*(h.width+30),h.y=(r-r%2)/2*(h.height+30),this.tipsArr.push(h)}0==n&&e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("Guild_apply_17"))},i.prototype.renmingUI=function(){var t=e.LanguageUtils.instance.getValue("Guild_apply_24",this.currentVO.getName());this.ui.titleStr.textFlow=(new egret.HtmlTextParser).parser(t);for(var i=e.JsonDataManager.instance.unionlimis,n=i.length,o=[],a=this.model.getMyQuanXian(),s=0;n>s;s++){var r=i[s];r.posId>a&&r.posId!=this.currentVO.getPostion()&&o.push(r)}n=o.length,this.ui.group.removeChildren(),this.tipsArr=[];for(var l=0;n>l;l++){var h=o[l],c=new e.UnionZhiWeiTipsItemView,u=this.getPosNums(h.posId);c.setItem(null,h,u,this.backF.bind(this)),this.ui.group.addChild(c),c.x=l%2*(c.width+30),c.y=(l-l%2)/2*(c.height+5),this.tipsArr.push(c)}},i.prototype.getPosNums=function(e){for(var t=this.model.getMemberData().getMemberList(),i=t.length,n=[],o=0,a=0;i>a;a++){var s=t[a];s.getPostion()==e&&n.push(s)}return o=n.length},i.prototype.onClick=function(e){switch(e.target){case this.ui.confirmBtn:this.ConFirmBtnClick()}},i.prototype.ConFirmBtnClick=function(){for(var e,t,i=this.tipsArr.length,n=0;i>n;n++){var o=this.tipsArr[n];o.getSelect()?(e=o.getMember(),t=o.getUnionLimitsVO(),this._callBackF(e,t)):o.setSelect(!1)}this.close()},i.prototype.showHook=function(){this.initUI()},i}(e.BasePanel);e.UnionZhiWeiTipsView=t,__reflect(t.prototype,"foxgame.UnionZhiWeiTipsView",["foxgame.IUnionObserver","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.showSrc=0,this.model=new e.UnionSiegeModel,this.panel=new e.UnionSiegePanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.model.IsCrossServer=!1,this.panel&&0==this.panel.getIsShow()&&this.panel.show()},t.prototype.closePanel=function(){this.panel&&1==this.panel.getIsShow()&&(1==this.panel.tweenindex?this.panel.backHandler():this.panel.close())},t.prototype.showCrossServerPanel=function(e){this.model.IsCrossServer=!0,this.showSrc=e,this.panel&&0==this.panel.getIsShow()&&this.panel.show()},t.prototype.showRankPanel=function(){(null==this.rankPanel||void 0==this.rankPanel)&&(this.rankPanel=new e.UnionSiegeRankPanel(this.model)),this.rankPanel.show()},t.prototype.showWarAwdPanel=function(){(null==this.warAwdPanel||void 0==this.warAwdPanel)&&(this.warAwdPanel=new e.UnionSiegeWarAwdPanel(this.model)),this.warAwdPanel.show()},t.prototype.showOfficialPanel=function(){(null==this.officialPanel||void 0==this.officialPanel)&&(this.officialPanel=new e.UnionSiegeOfficialPanel(this.model)),this.officialPanel.show()},t.prototype.showMyOfficialPanel=function(){(null==this.myOfficialPanel||void 0==this.myOfficialPanel)&&(this.myOfficialPanel=new e.UnionSiegeMyOfficialPanel(this.model)),this.myOfficialPanel.show()},t.prototype.showTips=function(t){var i=e.JsonDataManager.instance.itemTemplate[t.itemId];return i.type==e.ItemType.UNIONSIEGE?void e.TipsController.getInstance().showUSTips(i.id):void e.TipsController.getInstance().showItemTips(t.itemId,t.num,!1)},t.prototype.registerMsg=function(t){t.add(e.Code.UNION_SIEGE_INFO_S,this),t.add(e.Code.UNION_SIEGE_LAST_WAR_S,this),t.add(e.Code.UNION_SIEGE_POSITION_S,this),t.add(e.Code.UNION_SIEGE_MY_POSITION_S,this),t.add(e.MsgCMD.UNION_SIEGE_ENTER_BATTLE_SCENE,this),t.add(e.MsgCMD.UNION_SIEGE_EXIT_BATTLE_SCENE,this),t.add(e.Code.TIME_PLAY_METHOD_PUSH,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.TIME_PLAY_METHOD_PUSH:if(i.getPlayType()==e.TimePlayMethodType.UNION_SIEGE){i.getOpen()?(this.model.shachengopen=!0,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.SHACHENG,!0),e.ActivityBarController.getInstance().getpanel().refreshBtnEffect(e.ActivityBtnType.SHACHENG,!0),e.ActivityBarController.getInstance().getpanel().addBtnTimer(e.ActivityBtnType.SHACHENG,i.getRemainingTime())):(this.model.shachengopen=!1,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.SHACHENG,!1));break}if(i.getPlayType()==e.TimePlayMethodType.CS_UNION_SIEGE){i.getOpen()?(this.model.csshachengopen=!0,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KFGONGCHENG,!0),e.ActivityBarController.getInstance().getpanel().refreshBtnEffect(e.ActivityBtnType.KFGONGCHENG,!0),e.ActivityBarController.getInstance().getpanel().addBtnTimer(e.ActivityBtnType.KFGONGCHENG,i.getRemainingTime())):(this.model.csshachengopen=!1,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.KFGONGCHENG,!1));break}break;case e.Code.UNION_SIEGE_INFO_S:this.siegeInfoBack(i);break;case e.Code.UNION_SIEGE_LAST_WAR_S:this.lastWarBack(i);break;case e.Code.UNION_SIEGE_POSITION_S:this.officialInfoBack(i);break;case e.Code.UNION_SIEGE_MY_POSITION_S:this.ownOfficialInfoBack(i);break;case e.MsgCMD.UNION_SIEGE_ENTER_BATTLE_SCENE:this.closePanel(),e.UnionController.getInstance().closeUnionPanel();break;case e.MsgCMD.UNION_SIEGE_EXIT_BATTLE_SCENE:e.UnionController.getInstance().showUnionSiegePanel(1,!1)}},t.prototype.refreshMainUI=function(){this.panel&&1==this.panel.getIsShow()&&this.panel.refreshUI()},t.prototype.sendInfoMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionSiegeInfoReq");this.model.IsCrossServer?t.setSceneType(e.WorldSceneType.CrossServerUnionSiegeMap):t.setSceneType(e.WorldSceneType.UnionWarBattleMap),e.Message.instance.send(e.Code.UNION_SIEGE_INFO_C,t,!0)},t.prototype.siegeInfoBack=function(t){return t.getErrorNo()>0?void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo()):(this.model.USInfo=t,void this.refreshMainUI())},t.prototype.sendLastWarMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionSiegeLastWarReq");this.model.IsCrossServer?t.setSceneType(e.WorldSceneType.CrossServerUnionSiegeMap):t.setSceneType(e.WorldSceneType.UnionWarBattleMap),e.Message.instance.send(e.Code.UNION_SIEGE_LAST_WAR_C,t,!0)},t.prototype.lastWarBack=function(e){this.model.LastWarInfo=e,this.rankPanel&&this.rankPanel.getIsShow()&&this.rankPanel.refreshUI()},t.prototype.sendOfficialInfoMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionSiegePositionReq");this.model.IsCrossServer?t.setSceneType(e.WorldSceneType.CrossServerUnionSiegeMap):t.setSceneType(e.WorldSceneType.UnionWarBattleMap),e.Message.instance.send(e.Code.UNION_SIEGE_POSITION_C,t,!0)},t.prototype.officialInfoBack=function(e){this.model.OfficialInfo=e,this.officialPanel&&this.officialPanel.getIsShow()&&this.officialPanel.refreshUI()},t.prototype.sendOwnOfficialInfoMsg=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionSiegeMyPositionReq");this.model.IsCrossServer?t.setSceneType(e.WorldSceneType.CrossServerUnionSiegeMap):t.setSceneType(e.WorldSceneType.UnionWarBattleMap),e.Message.instance.send(e.Code.UNION_SIEGE_MY_POSITION_C,t,!0)},t.prototype.ownOfficialInfoBack=function(t){if(t.getErrorNo()>0)return void e.GlobalUtil.showErrorCodeMsg(t.getErrorNo());this.model.MyOfficialInfo=t;var i=this.model.MyOfficLevel,n=e.JsonDataManager.instance.usPosTemplate[i];return null==n||void 0==n?void e.GameUtils.MSG_TIP("您还未获得任何皇城官职"):void this.showMyOfficialPanel()},t.prototype.getModel=function(){return this.model},t}();e.UnionSiegeController=t,__reflect(t.prototype,"foxgame.UnionSiegeController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isCrossServer=!1,this.rankDp=new eui.ArrayCollection,this.rankDp1=new eui.ArrayCollection,this.rankPanelIdx=e.USRankType.Panel_1,this.officalRankDp=new eui.ArrayCollection,this.awardPanelIdx=e.USAwardType.Panel_1,this.awardDp=new eui.ArrayCollection,this._shachengopen=!1,this._csshacheng=!1,this.usIntegralRankAwardVO_length=0,this.usPersonalRankAwardVO_length=0}return Object.defineProperty(t.prototype,"USInfo",{get:function(){return this.unionSeigeInfo},set:function(e){this.unionSeigeInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsOpen",{get:function(){return this.unionSeigeInfo?this.unionSeigeInfo.getOpen():!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WinnerAvatar",{get:function(){return this.USInfo?this.USInfo.getAratar():null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsCrossServer",{get:function(){return this.isCrossServer},set:function(e){this.isCrossServer=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LastWarInfo",{get:function(){return this.lastWarInfo},set:function(e){this.lastWarInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UnionRankList",{get:function(){return this.lastWarInfo?this.lastWarInfo.getUnionRank():[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PlayerRankList",{get:function(){return this.lastWarInfo?this.lastWarInfo.getPlayerRank():[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OfficialInfo",{get:function(){return this.officialInfo},set:function(e){this.officialInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OfficialDataList",{get:function(){return this.officialInfo?this.officialInfo.getPositionList():[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MyOfficialInfo",{get:function(){return this.myOfficialInfo},set:function(e){this.myOfficialInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MyOfficLevel",{get:function(){return this.myOfficialInfo?this.myOfficialInfo.getPosId():-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RankDp",{get:function(){return this.rankDp},set:function(e){this.rankDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RankDp1",{get:function(){return this.rankDp1},set:function(e){this.rankDp1=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AwardDp",{get:function(){return this.awardDp},set:function(e){this.awardDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OfficalRankDp",{get:function(){return this.officalRankDp},set:function(e){this.officalRankDp=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HasWinner",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RankPanelIdx",{get:function(){return this.rankPanelIdx},set:function(e){this.rankPanelIdx=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AwardPanelIdx",{get:function(){return this.awardPanelIdx},set:function(e){this.awardPanelIdx=e},enumerable:!0,configurable:!0}),t.prototype.timeToDate=function(t){var i="",n=new Date;n.setTime(t);var o=(n.getFullYear(),n.getMonth()+1),a=n.getDate(),s=0==n.getHours()?"00":n.getHours().toString(),r=0==n.getMinutes()?"00":n.getMinutes().toString(),l=(n.getSeconds(),e.LanguageUtils.instance.getValue("NIAN"),e.LanguageUtils.instance.getValue("YUE")),h=e.LanguageUtils.instance.getValue("RI"),c=e.LanguageUtils.instance.getValue("DATE_DESC"),u=c.split(","),p="("+u[n.getUTCDay()]+")";return i=o+l+a+h+p+s+":"+r},Object.defineProperty(t.prototype,"shachengopen",{get:function(){return this._shachengopen},set:function(e){this._shachengopen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"csshachengopen",{get:function(){return this._csshacheng},set:function(e){this._csshacheng=e},enumerable:!0,configurable:!0}),t}();e.UnionSiegeModel=t,__reflect(t.prototype,"foxgame.UnionSiegeModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.Panel_1=1]="Panel_1",e[e.Panel_2=2]="Panel_2"}(t=e.USRankType||(e.USRankType={}));var i;!function(e){e[e.Panel_1=1]="Panel_1",e[e.Panel_2=2]="Panel_2"}(i=e.USAwardType||(e.USAwardType={}));var n;!function(e){e[e.US_GATE=1]="US_GATE",e[e.US_CITY=2]="US_CITY",e[e.US_PALACE_FRONT=3]="US_PALACE_FRONT",e[e.US_PALACE=4]="US_PALACE"}(n=e.UnionSiegeScene||(e.UnionSiegeScene={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/unionSiege/UnionSiegeSkin.exml","UnionSiegeGroup")||this;return i.tweenindex=!1,i.setIsShowBackBtn(!0),i.model=e,i.setRegisterTick(!0),i.isMask=!1,i.adaptionType=1,i.isCallHideSceneObjectsWhenClose=!1,i}return __extends(i,t),i.prototype.initHook=function(){e.UnionSiegeController.getInstance().sendInfoMsg(),this.initUI(),this.addLister(),this.doScreenAdaptation()},i.prototype.initUI=function(){this.titleAni=new e.FoxAni(this.ui.aniGroup),this.model.IsCrossServer?this.titleAni.play("medal_10031","ani",-1):this.titleAni.play("medal_10029","ani",-1)},i.prototype.addLister=function(){this.ui.oldReportBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.warAwdBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.officialBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.myOfficialBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.goBattleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removeLister=function(){this.ui.oldReportBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.warAwdBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.officialBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.myOfficialBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.goBattleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.UnionSiegeController.getInstance().showTips(i)},i.prototype.showHook=function(){t.prototype.showHook.call(this),this.ui.goBattleBtn.visible=!1,this.ui.currency.refresh(),this.refreshUI()},i.prototype.refreshUI=function(){null!=this.model.USInfo&&(this.ui.goBattleBtn.visible=!0,this.refreshWinner(),this.refresAwardList(),this.refreshStatusDesc())},i.prototype.refreshWinner=function(){this.model.WinnerAvatar?(this.ui.noFirstPlayer.visible=this.ui.noFirstPlayer1.visible=!1,this.refreshGroup_1(),this.ui.group_1.visible=!0):(this.ui.noFirstPlayer.visible=this.ui.noFirstPlayer1.visible=!0,this.setShaderAni(),this.ui.group_1.visible=!1)},i.prototype.setShaderAni=function(){var e="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",t="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nuniform float customUniform;\nvoid main(void) {\nvec2 uvs = vTextureCoord.xy;\nvec4 fg = texture2D(uSampler, vTextureCoord);\nfg.rgb += sin(customUniform + uvs.x * 4. + uvs.y * 4.) * 0.2;\ngl_FragColor = fg * vColor;\n}";this.customFilter1=new egret.CustomFilter(e,t,{customUniform:0}),this.ui.noFirstPlayer.filters=[this.customFilter1]},i.prototype.tickHook=function(e){null!=this.customFilter1&&(this.customFilter1.uniforms.customUniform+=.1,this.customFilter1.uniforms.customUniform>2*Math.PI&&(this.customFilter1.uniforms.customUniform=0))
},i.prototype.refreshGroup_1=function(){var e=this.model.WinnerAvatar;if(null!=e&&void 0!=e){this.ui.firstAvatar.setAvatar(e.getRoleItemId(),e.getClothingId(),e.getWeaponId(),e.getWingId(),Number(e.getFashionClothesId()),Number(e.getFashionWeaponId()),Number(e.getFashionWingId()),Number(e.getDragonArmourGuardLevel()),Number(e.getDragonBoneGuardLevel())),this.ui.unionName.text=e.getUnionName(),this.ui.rect1.width=this.ui.unionName.width+15,this.ui.roleName.text=e.getPlayerName(),this.ui.rect2.width=this.ui.roleName.width+15;var t=e.getVipLevel();this.ui.vip_img.source=t>0?"u_vip"+t+"_png":""}},i.prototype.onClickHandler=function(t){switch(t.target){case this.ui.oldReportBtn:e.UnionSiegeController.getInstance().showRankPanel();break;case this.ui.warAwdBtn:e.UnionSiegeController.getInstance().showWarAwdPanel();break;case this.ui.officialBtn:e.UnionSiegeController.getInstance().showOfficialPanel();break;case this.ui.myOfficialBtn:e.UnionSiegeController.getInstance().sendOwnOfficialInfoMsg();break;case this.ui.goBattleBtn:var i=e.PlayerService.instance.playerInfo.getLevel(),n=Number(e.GlobalConfig.instance.getValue("UNION_SIEGE_OPEN_LEVEL")),o=Number(e.GlobalConfig.instance.getValue("UNION_CROSSDRESS_OPEN_LEVEL"));if(n>i&&0==this.model.IsCrossServer)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_Message_3",n));if(o>i&&1==this.model.IsCrossServer)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_Message_4",o));this.model.IsCrossServer?e.Message.instance.send(e.MsgCMD.CHANGE_BATTLE_SCENE,{sceneType:e.WorldSceneType.CrossServerUnionSiegeMap,sceneId:e.UnionSiegeScene.US_GATE},!1):e.Message.instance.send(e.MsgCMD.CHANGE_BATTLE_SCENE,{sceneType:e.WorldSceneType.UnionWarBattleMap,sceneId:e.UnionSiegeScene.US_GATE},!1);break;case this.ui.helpBtn:this.model.IsCrossServer?e.HelpController.getInstance().showPanel("CS_SIEGEBATTLE"):e.HelpController.getInstance().showPanel("SIEGEBATTLE");break;case this.ui.closeBtn:this.backHandler()}},i.prototype.refresAwardList=function(){var t=e.GlobalConfig.instance.getValue("UNION_SIEGE_WINNER_AWARD");this.model.IsCrossServer&&(t=e.GlobalConfig.instance.getValue("CS_UNION_SIEGE_WINNER_AWARD"));for(var i=t.split(","),n=0;n<i.length;n++){var o=new e.AttributeVO(i[n]);this.awdList[n].setItem(o.id,o.value)}},i.prototype.refreshStatusDesc=function(){var e;return this.model.IsOpen?void(0==this.tweenindex&&(this.tweenindex=!0,this.tweenstatusDesc())):(this.tweenindex&&(this.tweenindex=!1,egret.Tween.removeTweens(this.ui.statusDesc)),e=this.model.timeToDate(this.model.USInfo.getNextTime())+"开启皇城争霸",void(this.ui.statusDesc.text=e))},i.prototype.tweenstatusDesc=function(){var e=this,t=200,i={c1:"0xffffff",c2:"0x0dff00",c3:"0x00adff",c4:"0xc73fee",c5:"0xff9700",c6:"0xff0400"},n="火爆开启中...";egret.Tween.get(this.ui.statusDesc,{loop:!0}).to({},1).call(function(){1==e.tweenindex&&(e.ui.statusDesc.textFlow=(new egret.HtmlTextParser).parser("<font color="+i.c1+">"+n+"</font>"))}).wait(t).to({},1).call(function(){1==e.tweenindex&&(e.ui.statusDesc.textFlow=(new egret.HtmlTextParser).parser("<font color="+i.c2+">"+n+"</font>"))}).wait(t).to({},1).call(function(){1==e.tweenindex&&(e.ui.statusDesc.textFlow=(new egret.HtmlTextParser).parser("<font color="+i.c3+">"+n+"</font>"))}).wait(100).to({},1).call(function(){1==e.tweenindex&&(e.ui.statusDesc.textFlow=(new egret.HtmlTextParser).parser("<font color="+i.c4+">"+n+"</font>"))}).wait(t).to({},1).call(function(){1==e.tweenindex&&(e.ui.statusDesc.textFlow=(new egret.HtmlTextParser).parser("<font color="+i.c5+">"+n+"</font>"))}).wait(t).to({},1).call(function(){1==e.tweenindex&&(e.ui.statusDesc.textFlow=(new egret.HtmlTextParser).parser("<font color="+i.c6+">"+n+"</font>"))}).wait(t)},i.prototype.readyDestroy=function(){this.setRegisterTick(!1),this.removeLister(),this.titleAni&&(this.titleAni.clear(),this.titleAni=null)},i.prototype.backHandler=function(){1==this.tweenindex&&(this.tweenindex=!1,egret.Tween.removeTweens(this.ui.statusDesc)),this.close()},Object.defineProperty(i.prototype,"awdList",{get:function(){for(var e=[],t=0;4>=t;t++)e.push(this.ui["awd_"+t]);return e},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.UnionSiegePanel=t,__reflect(t.prototype,"foxgame.UnionSiegePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/unionSiege/UnionSiegeMyOfficialSkin.exml",null)||this;return i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){for(var e=0;e<this.iconList.length;e++)this.iconList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.initUI=function(){this.iconList=[],this.iconList.push(this.ui.awd_0,this.ui.awd_1,this.ui.awd_2)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.UnionSiegeController.getInstance().showTips(i)},i.prototype.showHook=function(){this.refreshUI()},i.prototype.refreshUI=function(){if(null!=this.model.MyOfficialInfo){var t=this.model.MyOfficLevel,i=e.JsonDataManager.instance.usPosTemplate[t];if(null!=i&&void 0!=i){this.ui.txt1.text=i.name+":",this.ui.txt2.text=e.PlayerService.instance.mainRoleInfo.getName();var n=e.JsonDataManager.instance.usPosAwardTemplate[t];this.model.IsCrossServer&&(n=e.JsonDataManager.instance.usCSPosAwardTemplate[t]);for(var o=n.award,a=0;a<o.length;a++)this.iconList[a].setItem(Number(o[a][1]),Number(o[a][2]))}}},i}(e.BasePanel);e.UnionSiegeMyOfficialPanel=t,__reflect(t.prototype,"foxgame.UnionSiegeMyOfficialPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="UnionSiegeOfficialItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addlister()},i.prototype.init=function(){this.iconList=[],this.iconList.push(this.awd_0,this.awd_1,this.awd_2)},i.prototype.addlister=function(){for(var e=0;e<this.iconList.length;e++)this.iconList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removelister=function(){for(var e=0;e<this.iconList.length;e++)this.iconList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.UnionSiegeController.getInstance().showTips(i)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.refreshTxt(),this.refreshAwdList()},i.prototype.refreshTxt=function(){var t=this.data,i=t.getPosId(),n=e.JsonDataManager.instance.usPosTemplate[i];if(null!=n&&void 0!=n){this.txt1.text=n.name+":";var o=t.getPlayerNames();this.txt2.text=o.length>0?o.join(","):"无";var a=!1;(1==i||2==i)&&(a=!0),this.line.visible=a}},i.prototype.refreshAwdList=function(){var t=this.data,i=t.getPosId(),n=e.JsonDataManager.instance.usPosAwardTemplate[i];if(this.parent.IsCrossServer&&(n=e.JsonDataManager.instance.usCSPosAwardTemplate[i]),null!=n&&void 0!=n)for(var o=n.award,a=0;a<o.length;a++)this.iconList[a].setItem(Number(o[a][1]),Number(o[a][2]))},i.prototype.onClose=function(){this.removelister()},i}(eui.ItemRenderer);e.UnionSiegeOfficialItem=t,__reflect(t.prototype,"foxgame.UnionSiegeOfficialItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/unionSiege/UnionSiegeOfficialSkin.exml",null)||this;return i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI()},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.UnionSiegeOfficialItem,this.ui.list.dataProvider=this.model.OfficalRankDp,this.ui.list.IsCrossServer=this.model.IsCrossServer,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.showHook=function(){e.UnionSiegeController.getInstance().sendOfficialInfoMsg(),this.refreshUI()},i.prototype.refreshUI=function(){null!=this.model.OfficialInfo&&this.showScrollerList()},i.prototype.showScrollerList=function(){var e=this.model.OfficialDataList;this.model.OfficalRankDp.replaceAll(e)},i.prototype.readyDestroy=function(){if(this.ui.list&&this.ui.list.numChildren>0)for(var e=0;e<this.ui.list.numChildren;e++)this.ui.list.getChildAt(e).onClose()},i}(e.BasePanel);e.UnionSiegeOfficialPanel=t,__reflect(t.prototype,"foxgame.UnionSiegeOfficialPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="UnionSiegeRankItem",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init(),this.addlister()},t.prototype.init=function(){},t.prototype.addlister=function(){},t.prototype.removelister=function(){},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data,i=t.getRank();this.numImg.text=i.toString(),this.firstImg.visible=1==i,this.secondImg.visible=2==i,this.thirdImg.visible=3==i,this.nameTxt1.text=t.getName1(),this.nameTxt2.text=t.getName2(),this.inteTxt.text=t.getIntegral()+"";var n=t.getVipLevel();this.vip_img.source=n>0?"u_vip"+n+"_png":""},t.prototype.onClose=function(){this.removelister()},t}(eui.ItemRenderer);e.UnionSiegeRankItem=t,__reflect(t.prototype,"foxgame.UnionSiegeRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/unionSiege/UnionSiegeRankSkin.exml",null)||this;return i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){this.ui.tapBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.tapBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this)},i.prototype.removeLister=function(){this.ui.tapBtn0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.tapBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this)},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.UnionSiegeRankItem,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.initParams=function(){this.ui.sList.viewport.scrollV=0},i.prototype.showHook=function(){e.UnionSiegeController.getInstance().sendLastWarMsg(),this.model.RankPanelIdx=e.USRankType.Panel_1,this.refreshUI()},i.prototype.onClickHandler=function(t){var i;switch(t.target){case this.ui.tapBtn0:i=e.USRankType.Panel_1;break;case this.ui.tapBtn1:i=e.USRankType.Panel_2}i!=this.model.RankPanelIdx&&(this.model.RankPanelIdx=i,this.ui.sList.stopAnimation(),this.ui.sList.viewport.scrollV=0,this.refreshUI())},i.prototype.refreshUI=function(){null!=this.model.LastWarInfo&&this.showScrollerList()},i.prototype.showScrollerList=function(){var t,i,n,o=[];switch(this.model.RankPanelIdx){case e.USRankType.Panel_1:o=this.model.UnionRankList,this.ui.list.dataProvider=this.model.RankDp,this.model.RankDp.replaceAll(o),this.ui.tapBtn0.currentState="down",this.ui.tapBtn1.currentState="up",t="公会",i="会长",n="上届攻占皇城公会",this.refreshGp_1();break;case e.USRankType.Panel_2:o=this.model.PlayerRankList,this.ui.list.dataProvider=this.model.RankDp1,this.model.RankDp1.replaceAll(o),this.ui.tapBtn0.currentState="up",this.ui.tapBtn1.currentState="down",t="公会",i="名称",n="上届最佳表现英雄",this.refreshGp_2()}this.ui.title1.text=t,this.ui.title2.text=i,this.ui.titleDesc.text=n},i.prototype.refreshGp_1=function(){this.ui.gp_1.visible=!0,this.ui.gp_2.visible=!1;var e=this.model.WinnerAvatar,t=!!e;this.ui.huizhang.visible=t,this.ui.gp1_union.text=t?e.getUnionName():"虚位以待",this.ui.gp1_role.text=t?e.getPlayerName():"";var i=t?e.getVipLevel():0;this.ui.vip_img.source=i>0?"u_vip"+i+"_png":""},i.prototype.refreshGp_2=function(){this.ui.gp_1.visible=!1,this.ui.gp_2.visible=!0;var e=this.model.PlayerRankList,t=e.length>0,i=t?e[0]:null;this.ui.gonghuitxt.visible=t,this.ui.gp2_role.text=t?i.getName2():"虚位以待",this.ui.gp2_union.text=t?i.getName1():""},i.prototype.readyDestroy=function(){if(this.removeLister(),this.ui.list&&this.ui.list.numChildren>0)for(var e=0;e<this.ui.list.numChildren;e++)this.ui.list.getChildAt(e).onClose()},i}(e.BasePanel);e.UnionSiegeRankPanel=t,__reflect(t.prototype,"foxgame.UnionSiegeRankPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/unionSiege/UnionSiegeEquipTipsSkin.exml")||this;return e.lineSpace=6,e.setIsShowBackBtn(!1),e.setIsTouchClose(!0),e}return __extends(i,t),i.prototype.showPanel=function(e){this.itemId=e,this.show()},i.prototype.refresh=function(){var t=e.JsonDataManager.instance.itemTemplate[this.itemId],i=e.JsonDataManager.instance.usEquipTemplate[this.itemId];this.ui.icon.setItem(t.id,-1,!1),this.ui.nameLabel.text=t.name,this.ui.nameLabel.textColor=e.ColorUtils.instance.getColorByQuality(t.quality),this.ui.bgImg.source="qualityBg"+t.quality+"_png",this.ui.lvLabel.text=t.levelLimit.toString(),this.ui.scoreLabel.text=3*e.GlobalUtil.getScore(i.attrTypeList,i.attrValueList)+"",this.ui.dynamicGroup.removeChildren(),this.refreshByEquipId()},i.prototype.refreshByEquipId=function(){for(var t,i,n,o=e.JsonDataManager.instance.itemTemplate[this.itemId],a=e.JsonDataManager.instance.usEquipTemplate[this.itemId],s=a.attrTypeList.length,r=[],l=0;s>l;l++){t=a.attrTypeList[l],i=a.attrValueList[l];var h=n=e.LanguageUtils.instance.getValue("ATT_"+t)+"："+e.GlobalUtil.getAttrValueStr(t,i)+"\n",c=e.ColorUtils.instance.getAttrColorById(t),u={text:h,style:{textColor:c}};r.push(u)}this.ui.baseAttr.textFlow=r,this.ui.baseAttr.lineSpacing=this.lineSpace,this.ui.baseAttr0.textFlow=(new egret.HtmlTextParser).parser(o.desc)},i}(e.BasePanel);e.UnionSiegeTips=t,__reflect(t.prototype,"foxgame.UnionSiegeTips")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.voLength=0,e.skinName="UnionSiegeWarAwdItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.addlister()},i.prototype.init=function(){this.iconList=[],this.iconList.push(this.awd_0,this.awd_1,this.awd_2,this.awd_3)},i.prototype.addlister=function(){for(var e=0;e<this.iconList.length;e++)this.iconList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removelister=function(){for(var e=0;e<this.iconList.length;e++)this.iconList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.UnionSiegeController.getInstance().showTips(i)},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=e.UnionSiegeController.getInstance().getModel(),n=i.AwardPanelIdx;switch(n){case e.USAwardType.Panel_1:this.voLength=i.usIntegralRankAwardVO_length,this.refreshType_1();break;case e.USAwardType.Panel_2:this.voLength=i.usPersonalRankAwardVO_length,this.refreshType_2()}},i.prototype.refreshType_1=function(){var e=this.data;this.refreshRank(e.rank),this.refreshAwdList(e.award)},i.prototype.refreshType_2=function(){var e=this.data;this.refreshRank(e.rank),this.refreshAwdList(e.award)},i.prototype.refreshAwdList=function(e){for(var t=e,i=0;i<t.length;i++)this.iconList[i].setItem(Number(t[i][1]),Number(t[i][2]))},i.prototype.refreshRank=function(e){this.rankIdx.text=e.toString(),this.img_jin.visible=1==e,this.img_yin.visible=2==e,this.img_tong.visible=3==e,this.rankIdx.visible=this.img_normal.visible=e==this.voLength?!1:!0,this.txtLast.visible=e==this.voLength},i.prototype.onClose=function(){this.removelister()},i}(eui.ItemRenderer);e.UnionSiegeWarAwdItem=t,__reflect(t.prototype,"foxgame.UnionSiegeWarAwdItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/unionSiege/UnionSiegeWarAwdSkin.exml",null)||this;return i.setIsTouchClose(!0),i.model=e,i}return __extends(i,t),i.prototype.initHook=function(){t.prototype.initHook.call(this),this.initUI(),this.addLister()},i.prototype.addLister=function(){this.ui.tapBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.tapBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this);for(var e=0;e<this.awardList.length;e++)this.awardList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.removeLister=function(){this.ui.tapBtn0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.ui.tapBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this);for(var e=0;e<this.awdList.length;e++)this.awdList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this);for(var e=0;e<this.awardList.length;e++)this.awardList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.awardIconHandler,this)},i.prototype.awardIconHandler=function(t){var i=t.currentTarget;e.UnionSiegeController.getInstance().showTips(i)},i.prototype.initUI=function(){this.ui.list.itemRenderer=e.UnionSiegeWarAwdItem,this.ui.list.dataProvider=this.model.AwardDp,this.ui.sList.scrollPolicyH="ScrollPolicy.OFF",this.ui.sList.bounces=!1,this.ui.sList.verticalScrollBar.autoVisibility=!1,this.ui.sList.viewport=this.ui.list},i.prototype.initParams=function(){if(this.ui.sList.viewport.scrollV=0,this.model.IsCrossServer){var t=e.JsonDataManager.instance.usCSIntegralRankAwardTemplate;this.model.usIntegralRankAwardVO_length=this.getLength(t);var i=e.JsonDataManager.instance.usCSPersonalRankAwardTemplate;this.model.usPersonalRankAwardVO_length=this.getLength(i)}else{var t=e.JsonDataManager.instance.usIntegralRankAwardTemplate;this.model.usIntegralRankAwardVO_length=this.getLength(t);var i=e.JsonDataManager.instance.usPersonalRankAwardTemplate;this.model.usPersonalRankAwardVO_length=this.getLength(i)}},i.prototype.getLength=function(e){var t=0;for(var i in e)e[i]&&t++;return t},i.prototype.onClickHandler=function(t){var i;switch(t.target){case this.ui.tapBtn0:i=e.USAwardType.Panel_1;break;case this.ui.tapBtn1:i=e.USAwardType.Panel_2}i!=this.model.AwardPanelIdx&&(this.model.AwardPanelIdx=i,this.ui.sList.stopAnimation(),this.ui.sList.viewport.scrollV=0,this.refreshUI())},i.prototype.showHook=function(){e.UnionSiegeController.getInstance().sendLastWarMsg(),this.model.AwardPanelIdx=e.USAwardType.Panel_1,this.refreshUI()},i.prototype.refreshUI=function(){this.showScrollerList()},i.prototype.showScrollerList=function(){var t="",i="";switch(this.model.AwardPanelIdx){case e.USAwardType.Panel_1:var n=e.JsonDataManager.instance.usIntegralRankAwardTemplate;this.model.IsCrossServer&&(n=e.JsonDataManager.instance.usCSIntegralRankAwardTemplate);var o=[];for(var a in n)o.push(n[a]);this.model.AwardDp.replaceAll(o),this.ui.tapBtn0.currentState="down",this.ui.tapBtn1.currentState="up",t="公会积分排名奖励",i="皇城占领公会会长奖励",this.ui.gp_1.visible=!0,this.ui.gp_2.visible=!1,this.refreshGp_1();break;case e.USAwardType.Panel_2:var s=e.JsonDataManager.instance.usPersonalRankAwardTemplate;this.model.IsCrossServer&&(s=e.JsonDataManager.instance.usCSPersonalRankAwardTemplate);var r=[];for(var a in s)r.push(s[a]);this.model.AwardDp.replaceAll(r),this.ui.tapBtn0.currentState="up",this.ui.tapBtn1.currentState="down",t="个人积分排名奖励",i="个人积分进度奖励",this.ui.gp_1.visible=!1,this.ui.gp_2.visible=!0,this.refreshGp_2()}this.ui.titleDesc.text=t,this.ui.titleDesc0.text=i},i.prototype.refreshGp_2=function(){var t=e.JsonDataManager.instance.usIntegralAwardTemplate;if(this.model.IsCrossServer&&(t=e.JsonDataManager.instance.usCSIntegralAwardTemplate),null!=t&&void 0!=t){var i=0;for(var n in t){var o=t[n];this.awardList[i].setItem(Number(o.award[1]),Number(o.award[2])),this.awdTxtList[i].text=o.integral+"",i++}}},i.prototype.refreshGp_1=function(){var t=e.GlobalConfig.instance.getValue("UNION_SIEGE_WINNER_AWARD");this.model.IsCrossServer&&(t=e.GlobalConfig.instance.getValue("CS_UNION_SIEGE_WINNER_AWARD"));for(var i=t.split(","),n=0;n<i.length;n++){var o=new e.AttributeVO(i[n]);this.awdList[n].setItem(o.id,o.value)}},i.prototype.readyDestroy=function(){if(this.removeLister(),t.prototype.readyDestroy.call(this),this.ui.list&&this.ui.list.numChildren>0)for(var e=0;e<this.ui.list.numChildren;e++)this.ui.list.getChildAt(e).onClose()},Object.defineProperty(i.prototype,"awdList",{get:function(){for(var e=[],t=0;4>=t;t++)e.push(this.ui["awd_"+t]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"awardList",{get:function(){for(var e=[],t=0;4>=t;t++)e.push(this.ui["award_"+t]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"awdTxtList",{get:function(){for(var e=[],t=0;4>=t;t++)e.push(this.ui["awdTxt_"+t]);return e},enumerable:!0,configurable:!0}),i}(e.BasePanel);e.UnionSiegeWarAwdPanel=t,__reflect(t.prototype,"foxgame.UnionSiegeWarAwdPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USEquipVO=t,__reflect(t.prototype,"foxgame.USEquipVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USIntegralAwardVO=t,__reflect(t.prototype,"foxgame.USIntegralAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USIntegralRankAwardVO=t,__reflect(t.prototype,"foxgame.USIntegralRankAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USPersonalRankAwardVO=t,__reflect(t.prototype,"foxgame.USPersonalRankAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USPosAwardVO=t,__reflect(t.prototype,"foxgame.USPosAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USPosVO=t,__reflect(t.prototype,"foxgame.USPosVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.USSceneVO=t,__reflect(t.prototype,"foxgame.USSceneVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.currPart1=1]="currPart1",e[e.currPart2=2]="currPart2",e[e.currPart3=3]="currPart3",e[e.currPart4=4]="currPart4",e[e.currPart5=5]="currPart5",e[e.currPart6=6]="currPart6",e[e.currPart7=7]="currPart7",e[e.currPart8=8]="currPart8",e[e.currPart9=9]="currPart9",e[e.currPart10=10]="currPart10",e[e.currPart11=11]="currPart11",e[e.currPart12=12]="currPart12",e[e.currPart13=13]="currPart13",e[e.currPart14=14]="currPart14",e[e.currPart15=15]="currPart15",e[e.currPart16=16]="currPart16",e[e.currPart17=17]="currPart17",e[e.currPart18=18]="currPart18",e[e.currPart19=19]="currPart19",e[e.currPart20=20]="currPart20",e[e.currPart21=21]="currPart21",e[e.currPart22=22]="currPart22",e[e.currPart23=23]="currPart23",e[e.currPart24=24]="currPart24",e[e.currPart25=25]="currPart25",e[e.currPart26=26]="currPart26",e[e.currPart27=27]="currPart27",e[e.currPart28=28]="currPart28",e[e.currPart29=29]="currPart29",e[e.currPart30=30]="currPart30",e[e.currPart31=31]="currPart31",e[e.currPart32=32]="currPart32",e[e.currPart33=33]="currPart33",e[e.currPart34=34]="currPart34",e[e.currPart35=35]="currPart35",e[e.currPart36=36]="currPart36",e[e.currPart37=37]="currPart37",e[e.currPart38=38]="currPart38",e[e.currPart39=39]="currPart39",e[e.currPart40=40]="currPart40",e[e.currPart41=41]="currPart41",e[e.currPart42=42]="currPart42",e[e.currPart43=43]="currPart43",e[e.currPart44=44]="currPart44",e[e.currPart45=45]="currPart45",e[e.currPart46=46]="currPart46",e[e.currPart48=48]="currPart48"}(t=e.GuidePart||(e.GuidePart={}));var i=function(){function e(){}return e}();e.GuideInfoVO=i,__reflect(i.prototype,"foxgame.GuideInfoVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.rate=Number(e.rate)},e}();e.StrengthenLevelRateVO=t,__reflect(t.prototype,"foxgame.StrengthenLevelRateVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.rate=Number(e.rate)},e}();e.StrengthenQualityRateVO=t,__reflect(t.prototype,"foxgame.StrengthenQualityRateVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.DAILY=1]="DAILY",e[e.LIMIT=2]="LIMIT"}(t=e.WanFaTabType||(e.WanFaTabType={}));var i=function(){function i(){this.model=new e.WanFaModel,this.panel=new e.WanFaPanel(this.model)}return i.getInstance=function(){return null==this.instance&&(this.instance=new i),this.instance},i.prototype.showPanel=function(e){void 0===e&&(e=t.DAILY),this.model.curTab=e,this.panel.show()},i.prototype.refreshRedImg=function(){0!=this.panel.getIsShow()&&this.panel.refreshRedImg()},i.prototype.closePanel=function(){this.panel.close()},i.prototype.getOperate=function(){return e.NewArenaControler.Ins.showRedPoint()?!0:e.MainControler.instance.isShowFieldPKRedImg?!0:e.WorldBossController.getInstance().getRemainTime()>0?!0:e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_LEGEDARY_EMPIRE)?!0:e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_PRISONER)?!0:e.UnionController.getInstance().getRemainTime()>0?!0:!1},i}();e.WanFaController=i,__reflect(i.prototype,"foxgame.WanFaController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.TYPE1=1]="TYPE1",e[e.TYPE2=2]="TYPE2",e[e.TYPE3=3]="TYPE3",e[e.TYPE4=4]="TYPE4",e[e.TYPE5=5]="TYPE5",e[e.TYPE6=6]="TYPE6",e[e.TYPE7=7]="TYPE7",e[e.TYPE8=8]="TYPE8",e[e.TYPE9=9]="TYPE9",e[e.TYPE10=10]="TYPE10",e[e.TYPE11=11]="TYPE11",e[e.TYPE12=12]="TYPE12",e[e.TYPE13=13]="TYPE13"}(t=e.WanFaType||(e.WanFaType={}));var i=function(i){function n(){var e=i.call(this)||this;return e.skinName="WanFaItem",e}return __extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterHandler,this)},n.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.data){var n=this.data;switch(this.labelGroup.visible=n.countType==e.WanFaCountType.TYPE1||n.countType==e.WanFaCountType.TYPE2,this.desLabel1.visible=n.countType==e.WanFaCountType.TYPE3,this.bgImg.source=n.background+"_png",this.nameImg.source=n.nameImg+"_png",this.icon.setItem(n.award.id,-1,!1),this.describeLabel.text=n.describe,this.countLabel.text=this.getCountStr(n),n.describe1&&(this.desLabel1.textFlow=(new egret.HtmlTextParser).parse(n.describe1)),this.redImg.visible=!1,n.type){case t.TYPE1:if(this.redImg.visible=e.NewArenaControler.Ins.showRedPoint(),"play_jingjichang"==n.background)var o=egret.setTimeout(function(){egret.clearTimeout(o),o=null},this,500);34==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.enterBtn,this.enterBtn.parent,34,2,!0);break;case t.TYPE2:this.redImg.visible=e.MainControler.instance.isShowFieldPKRedImg,31==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.enterBtn,this.enterBtn.parent,31,2,!0);break;case t.TYPE3:this.redImg.visible=!1,36==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.enterBtn,this.enterBtn.parent,36,2,!0);break;case t.TYPE4:e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("LEGENDARY_EMPIREENTITY_GRADE_MIN"))&&(this.redImg.visible=e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_LEGEDARY_EMPIRE)),37==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.enterBtn,this.enterBtn.parent,37,2,!0);break;case t.TYPE5:this.redImg.visible=e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_PRISONER);break;case t.TYPE6:this.redImg.visible=e.WorldBossController.getInstance().getRemainTime()>0;break;case t.TYPE10:this.redImg.visible=e.UnionController.getInstance().getRemainTime()>0;break;case t.TYPE11:this.redImg.visible=!1,44==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.enterBtn,this.enterBtn.parent,44,3,!0);break;case t.TYPE12:null!=e.UnionController.getInstance().getmodel().yijiinfo&&(this.redImg.visible=e.UnionController.getInstance().getmodel().yijiinfo.getTimes()>=Number(e.GlobalConfig.instance.getValue("VESTIGES_DAILY_EXPLORE_NUM")));break;case t.TYPE13:var a=e.FactionBattleController.getInstance().getModel();a&&(this.redImg.visible=a.factionIsSignTime||a.factionIsBattleTime&&a.factionIsSignUp);break;default:this.redImg.visible=!1}}},n.prototype.getCountStr=function(i){var n;if(i.countType==e.WanFaCountType.TYPE1)return n=e.LanguageUtils.instance.getValue("WUXIAN");var o,a;if(i.type==t.TYPE1)o=e.NewArenaControler.Ins.ChallengesNum(),a=Number(e.GlobalConfig.instance.getValue("JINGJICHANGDAILYCOUNT")),n=o+"/"+a;else if(i.type==t.TYPE2);else if(i.type==t.TYPE3);else{if(i.type==t.TYPE4)return n=e.LanguageUtils.instance.getValue("WUXIAN");i.type==t.TYPE5?n=e.PrisonerController.getInstance().getCiShu()+"/"+e.GlobalConfig.instance.getValue("ESCORT_NUMBER"):i.type==t.TYPE12&&(n=null==e.UnionController.getInstance().getmodel().yijiinfo?"1/1":e.UnionController.getInstance().getmodel().yijiinfo.getTimes()+"/"+e.GlobalConfig.instance.getValue("VESTIGES_DAILY_EXPLORE_NUM"))}return n},n.prototype.itemHandler=function(t){var i=this.data;e.TipsController.getInstance().showItemTips(i.award.id,-1,!1)},n.prototype.enterHandler=function(i){var n,o=this.data;switch(o.type){case t.TYPE1:var a=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.JINGJICHANG,!1);if(0==a){var s=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.JINGJICHANG));e.PopUpController.getInstance().showFloatTextPanel1(s),n=!1}else n=!0,e.Message.instance.send(e.MsgCMD.MODULE_SHOW,{windowName:e.WindowName.NEW_AREA_UI});break;case t.TYPE2:n=e.FieldPKController.getInstance().showPKPanel();break;case t.TYPE3:n=e.ClimbingController.getInstance().show();break;case t.TYPE4:var r=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHUANQIBAYE,!1);if(0==r){var s=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHUANQIBAYE));e.PopUpController.getInstance().showFloatTextPanel1(s)}else n=!0,e.LegendController.getInstance().showMainPanel();break;case t.TYPE5:var l=e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("ESCORT_PRISONE_START_LEVEL"));if(0==l){var s=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalConfig.instance.getValue("ESCORT_PRISONE_START_LEVEL"));e.PopUpController.getInstance().showFloatTextPanel1(s)}else n=!0,e.PrisonerController.getInstance().showPanel();break;case t.TYPE6:e.WorldBossController.getInstance().showBossPanel();break;case t.TYPE10:e.UnionController.getInstance().showBonFirePanel();break;case t.TYPE11:44==App.GuideUtils().currdbz&&3==App.GuideUtils().currxbz&&(App.GuideUtils().currdbz=App.GuideUtils().currxbz=0,App.GuideUtils().hide(),e.ModuleOpenController.getInstance().autoShowPanel(e.PlayerService.instance.playerInfo.getLevel()));var h=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.TWELVEPALACE,!1);if(0==h){var s=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.TWELVEPALACE));e.PopUpController.getInstance().showFloatTextPanel1(s)}else n=e.TwelvePalaceController.getInstance().showPanel(4);break;case t.TYPE7:var c=e.UnionController.getInstance().getUnionId();if(0==c)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31"));e.UnionSiegeController.getInstance().showPanel(),n=!0;break;
case t.TYPE9:var u=e.UnionController.getInstance().getUnionId();if(0==u)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31"));e.UnionSiegeController.getInstance().showCrossServerPanel(2),n=!0;break;case t.TYPE12:var p=e.UnionController.getInstance().getUnionId();if(0==p)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_31"));if(e.PlayerService.instance.playerInfo.getLevel()<Number(e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL")))return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YIJIOPENTIP",e.GlobalConfig.instance.getValue("VESTIGES_OF_ANCIENT_GODS_OPEN_LEVEL")));e.UnionController.getInstance().showyijipanel(),n=!0;break;case t.TYPE13:e.FactionBattleController.getInstance().showPanel(),n=!0;break;default:e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("ZANWEIKAIQI"))}n&&e.WanFaController.getInstance().closePanel()},n}(eui.ItemRenderer);e.WanFaItem=i,__reflect(i.prototype,"foxgame.WanFaItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.collection=new eui.ArrayCollection}return e}();e.WanFaModel=t,__reflect(t.prototype,"foxgame.WanFaModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/wanfa/WanFaPanel.exml","wanfaPanel",!1)||this;return i.model=e,i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.initHook=function(){this.doScreenAdaptation(),this.ui.dailyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this),this.ui.limitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tabHandler,this);var t,i=e.JsonDataManager.instance.wanfaTemplate,n=i.length;this.model.dailyDataList=[],this.model.limitDataList=[];for(var o=0;n>o;o++)t=i[o],t.countType==e.WanFaCountType.TYPE1||t.countType==e.WanFaCountType.TYPE2?this.model.dailyDataList.push(t):t.countType==e.WanFaCountType.TYPE3&&this.model.limitDataList.push(t);var a=new eui.VerticalLayout;a.gap=Number(e.GlobalConfig.instance.getValue("WANFAGAPY"));var s=this.ui.list;this.model.collection.source=[],s.dataProvider=this.model.collection,s.itemRenderer=e.WanFaItem,s.layout=a},i.prototype.showHook=function(){44==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.limitBtn,this.ui.limitBtn.parent,44,2,!0)},i.prototype.refresh=function(){this.ui.currency.refresh(),this.refreshTabBtn(),this.model.curTab==e.WanFaTabType.DAILY?this.model.collection.source=this.model.dailyDataList:this.model.curTab==e.WanFaTabType.LIMIT&&(this.model.collection.source=this.model.limitDataList),this.refreshRedImg()},i.prototype.refreshRedImg=function(){var t;t=e.NewArenaControler.Ins.showRedPoint()||e.MainControler.instance.isShowFieldPKRedImg||e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_LEGEDARY_EMPIRE)||e.RedPointController.getInstance().getOperateByType(e.RedPointId.FUNC_PRISONER),this.ui.redImg0.visible=t,t=e.WorldBossController.getInstance().getRemainTime()>0||e.UnionController.getInstance().getRemainTime()>0,this.ui.redImg1.visible=t},i.prototype.tabHandler=function(t){switch(t.currentTarget){case this.ui.dailyBtn:this.model.curTab=e.WanFaTabType.DAILY;break;case this.ui.limitBtn:this.model.curTab=e.WanFaTabType.LIMIT}this.refresh()},i.prototype.refreshTabBtn=function(){var t=this.ui.dailyBtn,i=this.ui.limitBtn;this.model.curTab==e.WanFaTabType.DAILY?(t.currentState="down",i.currentState="up"):this.model.curTab==e.WanFaTabType.LIMIT&&(t.currentState="up",i.currentState="down")},i}(e.BasePanel);e.WanFaPanel=t,__reflect(t.prototype,"foxgame.WanFaPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.wealPanel=null,this.loginModel=null,this.showRedPoint=null,this.isFirst=!0,this.fuliUIIsShow=!1,this.viewIndex=0,this.loginModel=new e.LoginRewardModel,this.loginModel.init(),this.wvPanel=new e.WealVitalityPanel}return t.prototype.changeSignRedVisble=function(e){e>0&&this.loginModel.signBoo?this.redArr[1]=1:this.redArr[1]=0},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.initView=function(){this.showRedPoint=0,this.redArr=[0,0,0,0,0]},t.prototype.update=function(){return this.wealPanel&&this.wealPanel.update(),this.requestLoginRewardInfo(),this.requestSingedInfo(),this.requestTaskInfo(),this.showRedPoint>0},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ACC_LOGIN_INFO_S:this.loginModel.setLoginRewardInfo(i),this.wealPanel&&this.wealPanel.updateLoginView();break;case e.Code.ACC_LOGIN_AWARDS_S:this.loginModel.setLoginRewardInfos(i),this.wealPanel&&this.wealPanel.getWardCllBack();break;case e.Code.EVERYDAY_SIGN_INFO_S:case e.Code.EVERYDAY_SIGN_AWARD_S:t==e.Code.EVERYDAY_SIGN_AWARD_S&&0!=i.getErrorNo()&&e.GlobalUtil.showErrorCodeMsg(i.getErrorNo()),this.loginModel.setSignedInfo(i),this.wealPanel&&this.wealPanel.updateSigned();break;case e.Code.ACTIVE_INFO_SYNC_S:this.loginModel.setTaskInfo(i),this.wealPanel&&this.wealPanel.updateTask();break;case e.Code.ACTIVE_DAILY_TASK_REWARD_S:this.requestTaskInfo();break;case e.Code.ACTIVE_GET_REWARD_S:this.requestTaskInfo();break;case e.Code.USE_CDK_S:this.wealPanel&&this.wealPanel.updateCDK(t,i);break;case e.Code.LEVEL_PACKAGE_INFO_S:this.loginModel.setLevelInfo(i),this.wealPanel&&this.wealPanel.updateLevelView();break;case e.Code.DRAW_LEVEL_PACKAGE_S:var n=i;0==n.getErrorNo()?this.sendDataForLevelMsg():Log.trace("********领取等级礼包失败，服务端数据报错*********")}this.checkRedPoint()},t.prototype.closeWealView=function(){this.wealPanel.close(),this.loginModel.setRedPointNumInit()},t.prototype.showWealPanel=function(t){void 0===t&&(t=0),this.viewIndex=~~t,this.showRedPoint=0,this.redArr=[0,0,0,0,0],this.wealPanel=new e.WealPanelPanel,this.wealPanel.show()},t.prototype.getData=function(){0!=this.wealPanel.getIsInit()&&(this.requestLoginRewardInfo(),this.requestSingedInfo(),this.requestTaskInfo(),this.sendDataForLevelMsg())},t.prototype.requestLoginRewardInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPAccLoginInfo");e.Message.instance.send(e.Code.ACC_LOGIN_INFO_C,t,!0)},t.prototype.requestLoginAward=function(t){this.redArr[0]=0;var i=HawkProtocolManager.newBuilder("JsProto.HPAccLoginAwards");i.setRewwardDay(~~t.id),e.Message.instance.send(e.Code.ACC_LOGIN_AWARDS_C,i,!0)},t.prototype.requestSingedInfo=function(){e.Message.instance.send(e.Code.EVERYDAY_SIGN_INFO_C,HawkProtocolManager.emptyProtocol(),!0)},t.prototype.requestSignAward=function(t){this.redArr[1]=0;var i=HawkProtocolManager.newBuilder("JsProto.HPGetEverydaySignAward");i.setDateId(t),e.Message.instance.send(e.Code.EVERYDAY_SIGN_AWARD_C,i,!0)},t.prototype.requestTaskInfo=function(){e.Message.instance.send(e.Code.ACTIVE_INFO_SYNC_C,HawkProtocolManager.emptyProtocol(),!0)},t.prototype.requestTaskAwardInfo=function(t){this.redArr[2]=0;var i=HawkProtocolManager.newBuilder("JsProto.HPActiveGetRewardC");i.setRewardCfgId(~~t),e.Message.instance.send(e.Code.ACTIVE_GET_REWARD_C,i,!0)},t.prototype.requestTaskDayAwardInfo=function(t){this.redArr[2]=0;var i=HawkProtocolManager.newBuilder("JsProto.GetDailyTaskRewardReq");i.setCfgId(~~t),e.Message.instance.send(e.Code.ACTIVE_DAILY_TASK_REWARD_C,i,!0)},t.prototype.getCdk=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPUseCdk");i.setCdkey(t),e.Message.instance.send(e.Code.USE_CDK_C,i,!0)},t.prototype.checkRedPoint=function(){this.showRedPoint=0;for(var t=0,i=this.redArr.length;i>t;)1==this.redArr[t]&&(this.showRedPoint=1),t+=1;e.ActivityBarController.getInstance().setFuliRedImgVisible(1==this.showRedPoint)},t.prototype.showWealVitalityPanel=function(e,t){this.wvPanel.showPanel(e,t)},t.prototype.sendDataForLevelMsg=function(){this.redArr[3]=0;var t=HawkProtocolManager.newBuilder("JsProto.HPLevelPackageInfoReq");e.Message.instance.send(e.Code.LEVEL_PACKAGE_INFO_C,t,!0)},t.prototype.getLevelData=function(){return this.loginModel.getLevelInfo()},t.prototype.getAwardByLevel=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.HPLevelPackageDrawReq");n.setLevel(t),n.setTypeId(i),e.Message.instance.send(e.Code.DRAW_LEVEL_PACKAGE_C,n,!0)},t.prototype.setRedPointNum=function(e){this.loginModel.setRedPointNum(e)},t.prototype.getRedPointNum=function(){return this.loginModel.getRedPointNum()},t.prototype.isShowPanel=function(){return null!=this.wealPanel?this.wealPanel.getIsShow():void 0},t}();e.WealPanelController=t,__reflect(t.prototype,"foxgame.WealPanelController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/wealModule/WealPanelSkin.exml","wealGroup")||this;return e.tabbar=null,e.isMask=!0,e}return __extends(i,t),i.prototype.getTabBar=function(){return this.tabbar},i.prototype.initHook=function(){this.initView(),this.doScreenAdaptation()},i.prototype.showHook=function(){e.WealPanelController.getInstance().getData()},i.prototype.initView=function(){if(null==this.tabbar){this.tabbar=new TabBarContainer(null,"WearTabbarButtonSkin",WearTabbarButton),this.tabbar.horizontalCenter=0;for(var t=[["2denglujiangli_png","2denglujiangliliang_png"],["2qiandaojiangli_png","2qiandaojiangliliang_png"],["2meirirenwu_png","2meirirenwuliang_png"],["fcmdengjijiangli_png","fcmdengjijiangliliang_png"],["2jihuoduihuan_png","2jihuoduihuanliang_png"]],i=[e.LoginRewardView,e.SingedView,e.TaskView,e.LevelBagView,e.ActivityCodeView],n=0,o=i.length;o>n;n++){var a=t[n],s=new i[n];s.init(),this.tabbar.addViewStackElement(a[0],a[1],s)}this.tabbar.setScrollEnabled(!1);for(var r=0,l=5;l>r;r++){var h=this.tabbar.viewStack.getChildAt(r);h.showRedPoint=0}}},i.prototype.update=function(){if(this.tabbar){var e=this.tabbar.tabBar;if(e&&e.numChildren)for(var t=this.tabbar.viewStack,i=0,n=5;n>i;i++){var o=t.getChildAt(i);e.getElementAt(i).showRedPoint(o.showRedPoint)}}},i.prototype.initParams=function(){this.ui.showContent.addChild(this.tabbar),this.tabbar.hideScrollerSource();var t=e.WealPanelController.getInstance().viewIndex,i=0,n=this.tabbar.viewStack.numChildren;for(this.tabbar.setTabBarIndex(t>n-1?0:t);n>i;){var o=this.tabbar.viewStack.getChildAt(i);if(o.getScroller){var a=o.getScroller().getChildAt(0);a.hasEventListener(egret.Event.CHANGE)||a.addEventListener(egret.Event.CHANGE,o.onTabBarIndexChanged,this)}i++}},i.prototype.readyDestroy=function(){for(var e=0,t=this.tabbar.viewStack.numChildren;t>e;){var i=this.tabbar.viewStack.getChildAt(e);if(i.getScroller){var n=i.getScroller().getChildAt(0);n.hasEventListener(egret.Event.CHANGE)&&n.removeEventListener(egret.Event.CHANGE,i.onTabBarIndexChanged,this)}i.dispose(),e+=1}this.tabbar&&(this.tabbar.dispose(),this.tabbar.removeChildren(),this.tabbar=null),this.removeChildren()},i.prototype.updateLoginView=function(){if(this.tabbar){var e=this.tabbar.viewStack.getElementAt(0);e&&(e.getCurIndex(),e.changeViewInfo()),this.update()}},i.prototype.getWardCllBack=function(){if(this.tabbar){var e=this.tabbar.viewStack.getElementAt(0);e&&e.getAwardCallBack(),this.update()}},i.prototype.updateSigned=function(){if(this.tabbar){var e=this.tabbar.viewStack.getElementAt(1);e&&e.changeViewInfo(),this.update()}},i.prototype.updateTask=function(){if(this.tabbar){var e=this.tabbar.viewStack.getElementAt(2);e&&e.changeViewinfo(),this.update()}},i.prototype.updateCDK=function(e,t){if(this.tabbar){var i=this.tabbar.viewStack.getElementAt(4);i&&i.changeViewinfo(e,t)}},i.prototype.updateLevelView=function(){if(this.tabbar){var e=this.tabbar.viewStack.getElementAt(3);e&&e.changeViewinfo(),this.update()}},i}(e.BasePanel);e.WealPanelPanel=t,__reflect(t.prototype,"foxgame.WealPanelPanel")}(foxgame||(foxgame={}));var WearTabbarButton=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.btn1&&(this.btn1.source=this.data.title),this.btn2&&(this.btn2.source=this.data.titleSelected)},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i),this.data&&(this.btn1==i&&(this.btn1.source=this.data.title),this.btn2==i&&(this.btn2.source=this.data.titleSelected))},t.prototype.showRedPoint=function(e){void 0===e&&(e=0),this.redPoint.visible=1==e},t}(eui.ItemRenderer);__reflect(WearTabbarButton.prototype,"WearTabbarButton");var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ActivityCodeViewSkin",e}return __extends(i,t),i.prototype.partAdded=function(i,n){t.prototype.partAdded.call(this,i,n),this.getAwardId&&this.getAwardId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getCdkHandler,this),this.infoId&&(this.infoId.addEventListener(egret.FocusEvent.FOCUS_IN,this.changeCDKIn,this),this.infoId.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.changeCDKIn,this),this.infoId.addEventListener(egret.FocusEvent.FOCUS_OUT,this.changeCDKOut,this),this.infoId.addEventListener(egret.Event.CHANGE,this.limitLabelLength,this),this.infoId.type=egret.TextFieldType.INPUT,this.infoId.inputType=egret.TextFieldInputType.TEXT,this.infoId.maxChars=40),this.desText&&(this.desText.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("GM_GONGGAO_TIP")))},i.prototype.limitLabelLength=function(e){this.infoId.text.length>20&&(this.infoId.text=this.infoId.text.substring(0,20))},i.prototype.changeCDKIn=function(e){if(this.infoId){this.infoId.textColor=16777215;var t=this.infoId.text;""!=t?this.infoId.text="":this.infoId.text=""}},i.prototype.changeCDKOut=function(t){if(this.infoId){var i=this.infoId.text;""!=i?this.infoId.textColor=16777215:(this.infoId.textColor=6381921,this.infoId.text=e.LanguageUtils.instance.getValue("QINGSHURU16WEIDUIHUANMA"))}},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.init=function(){this.infoId.textColor=6381921,this.infoId.text=e.LanguageUtils.instance.getValue("QINGSHURU16WEIDUIHUANMA"),this.getAwardId.visible==this.getAwardId.enabled==1&&this.parent?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.getCdkHandler=function(){var t=this.infoId.text;return 0==t.length||t==e.LanguageUtils.instance.getValue("QINGSHURU16WEIDUIHUANMA")?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEAK_CDK_TIP_NULL")):void(16==this.infoId.text.length||20==this.infoId.text.length?e.WealPanelController.getInstance().getCdk(this.infoId.text):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("CDKERROR")))},i.prototype.changeViewinfo=function(t,i){switch(t){case 0:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEAK_CDK_TIP_SEND"));break;case 1:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEAK_CDK_TIP_ERROR"));break;case 6:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WEAK_CDK_TIP_GETED"))}switch(i.status){case 4001:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("INVALID_CDKEY"));break;case 4002:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("EXPIRED_CDKEY"));break;case 4003:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("USED_CDKEY"));break;case 4004:e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("USAGE_REACHED"))}this.infoId.textColor=6381921,this.infoId.text=e.LanguageUtils.instance.getValue("QINGSHURU16WEIDUIHUANMA")},i.prototype.dispose=function(){this.getAwardId&&this.getAwardId.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getCdkHandler,this),this.infoId&&(this.infoId.removeEventListener(egret.FocusEvent.FOCUS_IN,this.changeCDKIn,this),this.infoId.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.changeCDKOut,this)),this.removeChildren()},i}(eui.Component);e.ActivityCodeView=t,__reflect(t.prototype,"foxgame.ActivityCodeView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.sourceArr=["fcmbukelingqu_png","fcmdengjixuanzhong_png","fcmyilingqu_png","fcmyilingqu xuanzhong_png"],e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initListener()},i.prototype.initListener=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.setData=function(t,i,n){this.curData=t,this.backF=i,this.curIndex=n,this.redPoint.visible=!1;var o="";o=this.curData.getLevelState()&&this.curData.getVipState()?this.sourceArr[2]:this.sourceArr[0],this.img.source=o,this.level.text=this.curData.getLevel()+"级";var a=e.PlayerService.instance.playerInfo.getLevel(),s=e.PlayerService.instance.playerInfo.getVipLevel();this.redPointNum=100,!this.curData.getLevelState()&&this.curData.getLevel()<=a&&(this.redPoint.visible=!0,this.redPointNum=n,!this.curData.getVipState()&&s>=this.curData.getVipLevel()&&(this.redPoint.visible=!0,this.redPointNum=n)),this.curData.getLevelState()&&this.curData.getLevel()<=a&&!this.curData.getVipState()&&s>=this.curData.getVipLevel()&&(this.redPoint.visible=!0,this.redPointNum=n),e.WealPanelController.getInstance().setRedPointNum(this.redPointNum)},i.prototype.onClick=function(e){this.backF(this.curIndex,this.curData)},i.prototype.setSelect=function(e){var t="";t=e?this.curData.getLevelState()&&this.curData.getVipState()?this.sourceArr[3]:this.sourceArr[1]:this.curData.getLevelState()&&this.curData.getVipState()?this.sourceArr[2]:this.sourceArr[0],this.img.source=t},i}(eui.Component);e.LevelBagItem=t,__reflect(t.prototype,"foxgame.LevelBagItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.boxNum=28,e.isDataOk=!1,e.isUIok=!1,e.showRedPoint=0,e.skinName="LevelBagSkin",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},i.prototype.init=function(){this.isDataOk=!1,this.isUIok=!1},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isUIok=!0,this.isDataOk&&this.changeViewinfo()},i.prototype.changeViewinfo=function(){if(!this.isUIok)return void(this.isDataOk=!0);this.boxArr=[];var t=0,i=this.boxNum;for(t;i>t;t++){var n=this["itemBox"+t];n&&this.boxArr.push(n)}this.showRedPoint=0;var o=e.WealPanelController.getInstance().getLevelData(),a=o.getLevelPackageList();t=0,i=a.length;var s=this.boxArr.length;for(t;i>t;t++){var r=a[t],n=this.boxArr[t];n.setData(r,this.backHandle.bind(this),t),n.visible=!0}if(a.length<s)for(t;s>t;t++){var n=this.boxArr[t];n.visible=!1}var l=e.WealPanelController.getInstance().getRedPointNum();100==l&&(l=0);var h=a[l];this.selectBox(l,h)},i.prototype.backHandle=function(e,t){this.selectBox(e,t)},i.prototype.selectBox=function(t,i){var n=e.WealPanelController.getInstance().getLevelData(),o=n.getLevelPackageList(),a=0,s=o.length;this.boxArr.length;for(a;s>a;a++){var r=(o[a],this.boxArr[a]);a==t?r.setSelect(!0):r.setSelect(!1),r.visible=!0}var l=i.getLevelPackage(),h=i.getVipPackage(),c=l.split(","),u=h.split(","),p="";for(a=0,s=c.length,this.voArr=[],this.voArrVip=[],a;s>a;a++){p=c[a];var g=new e.AttributeVO(p),d=this["item"+a];d.setItem(g.id,g.value,!0),d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),d.visible=!0,this.voArr.push(g)}if(4>s)for(a;4>a;a++){var d=this["item"+a];d.visible=!1}for(a=0,s=u.length,a;s>a;a++){p=u[a];var g=new e.AttributeVO(p),d=this["itemVip"+a];d.setItem(g.id,g.value,!0),d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),d.visible=!0,this.voArrVip.push(g)}if(4>s)for(a;4>a;a++){var d=this["itemVip"+a];d.visible=!1}this.vipTxt.text="VIP"+i.getVipLevel()+" 可获得额外奖励",this.curVipLevel=i.getVipLevel(),this.curBagLevel=i.getLevel();var f=e.PlayerService.instance.playerInfo.getLevel(),m=e.PlayerService.instance.playerInfo.getVipLevel();i.getLevel()>f?(this.buyBtn.enabled=!1,this.buyBtnVip.enabled=!1,this.lingquImg.visible=!1,this.lingquImgVip.visible=!1,this.buyBtn.visible=!0,this.buyBtnVip.visible=!0):(i.getLevelState()?(this.buyBtn.enabled=!1,this.lingquImg.visible=!0,this.buyBtn.visible=!1):(this.lingquImg.visible=!1,this.buyBtn.enabled=!0,this.buyBtn.visible=!0,this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=1),i.getVipLevel()>m?(this.buyBtnVip.enabled=!1,this.buyBtnVip.visible=!0,this.lingquImgVip.visible=!1):i.getVipState()?(this.buyBtnVip.enabled=!1,this.lingquImgVip.visible=!0,this.buyBtnVip.visible=!1):(this.buyBtnVip.visible=!0,this.buyBtnVip.enabled=!0,this.lingquImgVip.visible=!1,this.buyBtnVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=1)),this.buyBtn.visible&&this.buyBtn.enabled&&this.parent?this.effectLingQu(!0):this.effectLingQu(!1),this.buyBtnVip.visible&&this.buyBtnVip.enabled&&this.parent?this.effectLingQu0(!0):this.effectLingQu0(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.effectLingQu0=function(t){this.rechargeAni0&&(this.rechargeAni0.clear(),this.rechargeAni0=null),t&&(this.rechargeAni0||(this.rechargeAni0=new e.FoxAni(this.rechargeAniGroup0),this.rechargeAni0.play("rechargeAnimation","ani",-1)))},i.prototype.onClick=function(t){var i,n=this.voArr,o=this.voArrVip,a=null;switch(t.target){case this.item0:a=n[0],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.item1:a=n[1],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.item2:a=n[2],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.item3:a=n[3],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.itemVip0:a=o[0],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.itemVip1:a=o[1],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.itemVip2:a=o[2],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.itemVip3:a=o[3],i=e.JsonDataManager.instance.itemTemplate[a.id],e.ActivityController.getIntance().showTipsByItemOrEquip(i.id,i.type,a.num);break;case this.buyBtn:this.getaward();break;case this.buyBtnVip:this.getawardVip()}},i.prototype.getaward=function(){e.WealPanelController.getInstance().getAwardByLevel(this.curBagLevel,1)},i.prototype.getawardVip=function(){var t=e.PlayerService.instance.playerInfo.getVipLevel();t>=this.curVipLevel?e.WealPanelController.getInstance().getAwardByLevel(this.curBagLevel,2):e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("Guild_apply_9"))},i.prototype.dispose=function(){this.removeChildren()},i}(eui.Component);e.LevelBagView=t,__reflect(t.prototype,"foxgame.LevelBagView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoginIconRendererSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data.id.split("_");this.item.setItem(~~t[1],~~t[2],!1,!1)},t}(eui.ItemRenderer);e.LoginIconRender=t,__reflect(t.prototype,"foxgame.LoginIconRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.redPointNum=100}return t.prototype.init=function(){this.loginRewardInfo={},this.signedRewardInfo={everydaySignInfo:[{dateId:1,hasSign:2,vipDouble:3,awards:4}],nowDateId:1,signTimes:2,reSignTimes:3},this.taskInfo={}},t.prototype.setLoginRewardInfo=function(t){t.getGotAwardCfgId().length<t.getLoginDays()&&t.getAwardsInfo().length!=t.getGotAwardCfgId().length?e.WealPanelController.getInstance().redArr[0]=1:e.WealPanelController.getInstance().redArr[0]=0,t.getGotAwardCfgId()&&(this.loginRewardInfo.gotAwardCfgId=t.getGotAwardCfgId()),t.getLoginDays()&&(this.loginRewardInfo.loginDays=t.getLoginDays())},t.prototype.setLoginRewardInfos=function(e){this.loginRewardInfo.gotAwardCfgId=e.getGotAwardCfgId()},t.prototype.getLoginRewardInfo=function(){return this.loginRewardInfo},t.prototype.setSignedInfo=function(t){this.signedRewardInfo=t,this.signBoo=!1,e.JsonDataManager.instance.wealInfo.resigned.length-t.reSignTimes&&(this.signBoo=!0)},t.prototype.getSignedInfo=function(){return this.signedRewardInfo},t.prototype.setTaskInfo=function(t){this.taskInfo=t;var i=this.getTaskInfo(),n=this.cloneObjFromAry(e.JsonDataManager.instance.wealInfo.task.concat()),o=i.activeItems.concat(),a=i.rewardStatus.concat(),s=e.JsonDataManager.instance.wealInfo.taskAward.concat(),r={},l=0,h=n.length,c=0;if(o.length)for(;h>l;){var u=o[l];if(!u)break;r[u.cfgId]=u,l++}for(l=0,h=n.length;h>l;){var p=n[l],g=r[p.id];g&&(p.finishedCount=g.finishedCount,p.awardState=g.awardState,2==g.awardState?c+=~~p.point:1==g.awardState&&(e.WealPanelController.getInstance().redArr[2]=1)),l++}for(l=0,h=s.length;h>l;)s[l].needPoint<c&&(a[l]||(e.WealPanelController.getInstance().redArr[2]=1)),l+=1},t.prototype.cloneObjFromAry=function(e){for(var t=e.length,i=[],n=0;t>n;n++){var o=e[n],a=JSON.stringify(o),s=JSON.parse(a);i.push(s)}return i},t.prototype.getTaskInfo=function(){return this.taskInfo},t.prototype.setLevelInfo=function(t){if(0==t.getErrorNo()){this.redPointNum=100,this.levelInfo=t;var i=e.PlayerService.instance.playerInfo.getLevel(),n=e.PlayerService.instance.playerInfo.getVipLevel(),o=0,a=t.getLevelPackageList().length,s=!1,r=!1;for(o;a>o;o++){var l=t.getLevelPackageList()[o];if(l&&(s=l.getLevel()<=i&&!l.getLevelState(),r=l.getVipLevel()<=n&&!l.getVipState(),s||r)){e.WealPanelController.getInstance().redArr[4]=1;break}}}else Log.trace("********获取等级礼包数据失败，服务端数据报错*********")},t.prototype.getLevelInfo=function(){return this.levelInfo},t.prototype.setRedPointNum=function(e){this.redPointNum>e&&(this.redPointNum=e)},t.prototype.setRedPointNumInit=function(){this.redPointNum=100},t.prototype.getRedPointNum=function(){return this.redPointNum},t}();e.LoginRewardModel=t,__reflect(t.prototype,"foxgame.LoginRewardModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoginRewardRenderSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.initView=function(e){this._data=e,null==this.sNum&&(this.sNum=new SpecialNumber("weal_day"),this.dayGroup.addChild(this.sNum),this.sNum.y=-6),this.setDay(e.day),this.setPicSource(e.source)},t.prototype.setSelectState=function(e){this.selectBoxId.visible=e},t.prototype.setPicSource=function(e){switch(this.boxId.source=e,e){case"weal_BoxGeted_png":this.isGot.visible=!0;break;case"weal_BoxOpen_png":this.isGot.visible=!1,this.selectBoxId.source="weal_selectBox1_png";break;case"weal_Box_png":this.isGot.visible=!1,this.selectBoxId.source="weal_selectBox2_png"}},t.prototype.setDay=function(e){this.sNum.setValue(e+""),this.sNum.x=-(this.sNum.width>>1)},t.prototype.getData=function(){return this._data},t}(eui.Component);e.LoginRewardRender=t,__reflect(t.prototype,"foxgame.LoginRewardRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.dp=null,e.scroller=null,e.boxArr=null,e.showRedPoint=0,e._index=1,e._canTouch=0,e.tweenNum=0,e.skinName="LoginRewardViewSkin",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},i.prototype.init=function(){if(this.rightBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)||(this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeHandler,this),this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeHandler,this)),this.getRewardBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.getRewardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwardHandler,this),null==this.boxArr){this.boxArr=[];for(var t=0,i=7,n=0,o=0;i>t;){var a=new e.LoginRewardRender;this.boxGroup.addChild(a),this.boxArr.push(a),a.initView({day:t+1,source:"weal_Box_png"}),a.name=t+"",a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBoxHandler,this),4==t&&(n+=a.height+28),t>3&&(a.y+=n),4==t&&(o=1),a.x=o*(a.width-6)-(t>3?a.width>>1:0)-16,o++,6==t&&(a.scaleX=a.scaleY*=1.2,a.x-=a.scaleX*a.width-this.boxArr[0].width>>1,a.y-=a.scaleY*a.height-this.boxArr[0].height>>1),t++}}this.dp=new eui.ArrayCollection,this.scroller=this.createList(this.dp),this.rewardGroup.addChild(this.scroller),this.scroller.x=-(this.scroller.width>>1)},i.prototype.selectBoxHandler=function(e){var t=~~e.currentTarget.name,i=this.boxArr[t];if(!this._pre)return void(this.getRewardBtn.enabled=!1);if(this._pre!=i){i.setSelectState(!0),this._pre.setSelectState(!1),this.startSzieTween(i,100);var n=i.getData().awards.split(",");this.dp.removeAll();for(var o=0,a=n.length;a>o;o++)this.dp.addItem({id:n[o]});i||(this.getRewardBtn.enabled=!0),this.getRewardBtn.enabled="weal_BoxOpen_png"==i.boxId.source,this._pre=i,this.getRewardBtn.visible==this.getRewardBtn.enabled==1&&this.parent?this.effectLingQu(!0):this.effectLingQu(!1)}},i.prototype.onTabBarIndexChanged=function(t){var i=t.target.selectedIndex,n=t.target.dataProvider.source[i].id.split("_");e.TipsController.getInstance().showItemTips(n[1],n[2]),t.target.selectedIndex=-1},i.prototype.createList=function(t){var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE;var n=new eui.List;n.layout=i,n.itemRenderer=e.LoginIconRender,n.itemRendererSkinName="LoginIconRendererSkin",n.dataProvider=t;var o=new eui.Scroller;return o.percentWidth=o.percentHeight=100,o.viewport=n,o.top=5,o},i.prototype.changeHandler=function(e){e.target==this.leftBtn?(Log.trace("left"),this.rightBtn.visible=!0,this._index>1&&(this._index-=1,1==this._index&&(this.leftBtn.visible=!1))):(Log.trace("right"),this.leftBtn.visible=!0,this._index<4&&(this._index+=1,4==this._index&&(this.rightBtn.visible=!1))),this.changeViewInfo()},i.prototype.changeViewInfo=function(){var t=this.getLoginInfo().concat(),i=this.getSignededInfo(),n=i.gotAwardCfgId,o=null,a=null,s=0,r=0;if(n&&n.length)for(o={},s=0,r=n.length;r>s;s++)o[n[s]]=n[s];if(this.getAwardList=[],o)for(s=0,r=i.loginDays;r>s;s++){var l=t[s];l&&null==o[l.id]&&this.getAwardList.push(l)}else this.getAwardList=t.concat().splice(0,i.loginDays);if(this.getAwardList&&this.getAwardList.length)for(a={},s=0,r=this.getAwardList.length;r>s;s++)a[this.getAwardList[s].id]=this.getAwardList[s];var h=0;for(h=s=7*(this._index-1),r=s+7;r>s;s++){var l=t[s],c=this.boxArr[s-h],u="",p=void 0;p=a?a[s+1]:null,u=null!=o&&null!=o[l.id]?"weal_BoxGeted_png":p&&p.id==l.id?"weal_BoxOpen_png":"weal_Box_png",c.initView({day:l.id,source:u,awards:l.awards})}for(h=s=7*(this._index-1),r=s+7;r>s;s++){var c=this.boxArr[s-h];if("weal_BoxGeted_png"!=c.boxId.source){this._pre=c;break}}if(this.loginDatText.text=e.LanguageUtils.instance.getValue("DENGLUTIANSHU",i.loginDays),!this._pre)return void(this.getRewardBtn.enabled=!1);for(this.getRewardBtn.enabled="weal_BoxOpen_png"==this._pre.boxId.source,this.getRewardBtn.enabled?this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=1:this.showRedPoint=0,h=s=7*(this._index-1),r=s+7;r>s;s++)this.boxArr[s-h].setSelectState(!1);for(this._pre.setSelectState(!0),this.dp.removeAll(),t=this._pre.getData().awards.split(","),s=0,r=t.length;r>s;s++)this.dp.addItem({id:t[s]});this.getRewardBtn.visible==this.getRewardBtn.enabled==1?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.getCurIndex=function(){this.getSignededInfo().loginDays;this._pre=null,this.leftBtn.visible=!0,this.rightBtn.visible=!0;
var e=this.getSignededInfo().gotAwardCfgId,t=0;t=null!=e&&e.length>0?e[e.length-1]+1:0,7>=t?(this._index=1,this.leftBtn.visible=!1):14>=t?this._index=2:21>=t?this._index=3:(this._index=4,this.rightBtn.visible=!1)},i.prototype.getLoginInfo=function(){return e.JsonDataManager.instance.wealInfo.login},i.prototype.getSignededInfo=function(){return e.WealPanelController.getInstance().loginModel.getLoginRewardInfo()},i.prototype.getAwardHandler=function(t){var i=this;if(this.getAwardList&&this.getAwardList.length){if(0!=this._canTouch)return;this._canTouch=1;var n=egret.setTimeout(function(){egret.clearTimeout(n),n=null,i._canTouch=0},this,500);if(this._pre&&"weal_BoxOpen_png"!=this._pre.getData().source)return;App.SoundManager().playEffect("sound_award_mp3"),e.WealPanelController.getInstance().requestLoginAward(this.getAwardList[0])}else e.GameUtils.MSG_TIP("@SiegeHasReward")},i.prototype.getAwardCallBack=function(){var e=this.getAwardList;e.reverse(),e.splice(e.length-1,e.length),e.reverse(),this.getCurIndex(),this.changeViewInfo()},i.prototype.startSzieTween=function(e,t,i){var n=this;void 0===t&&(t=300),void 0===i&&(i=1);var o,a,s,r,l,h,c,u,p,g;l=e.x,h=e.y,o=e.width,a=e.height,p=e.scaleX,g=e.scaleY,c=p+.3,u=g+.3,s=e.x-(o*c-o>>1),r=e.y-(a*u-a>>1),TweenMax.to(e,t/1e3,{x:s,y:r,scaleX:c,scaleY:u,onComplete:function(){TweenMax.to(e,t/1e3,{x:l,y:h,scaleX:p,scaleY:g,onComplete:function(){TweenMax.killTweensOf(e),n.tweenNum<=i?n.tweenNum++:n.tweenNum=0}})}})},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.getScroller=function(){return this.scroller},i.prototype.dispose=function(){if(this.scroller&&(this.scroller.removeChildren(),this.scroller=null),this.boxArr&&this.boxArr.length){for(var e=0,t=this.boxArr.length,i=null;t>e;)i=this.boxArr[e],i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBoxHandler,this),i.removeChildren(),i=null,e+=1;this.boxArr=i=null}this.dp.removeAll(),this.dp=null,this.getAwardList=null,this.removeChildren()},i}(eui.Component);e.LoginRewardView=t,__reflect(t.prototype,"foxgame.LoginRewardView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.showRedPoint=0,e._reSignedDay=0,e.skinName="SingedViewSkin",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},i.prototype.init=function(){if(null==this.contentArr){this.contentArr=[];for(var t=0,i=30;i>t;){var n=new e.SignedRender;this.contentGroup.addChild(n),this.contentArr.push(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getSignHandler,this),n.name=t+"",n.x=30+112*~~(t%5+""),n.y=58+110*~~(t/5+""),t++}}},i.prototype.getSignHandler=function(t){var i=t.currentTarget,n=~~i.name,o=this.contentArr[n].getData(),a=this.getServiceSignedInfo(),s=e.PlayerService.instance.playerInfo,r=s.vipLevel,l=e.LanguageUtils.instance.getValue("SINGED_VIP_POPUP",o.vipDouble),h=e.LanguageUtils.instance.getValue("SINGED_VIP_CONFIRMNAME"),c=e.LanguageUtils.instance.getValue("SINGED_VIP_CANCENAME");if(~~o.dateId<=~~a.nowDateId&&1!=o.hasSign)if(0==o.hasSign)-1==o.vipDouble?e.WealPanelController.getInstance().requestSignAward(o.dateId):-1!=o.vipDouble&&(r>=o.vipDouble?e.WealPanelController.getInstance().requestSignAward(o.dateId):this.buqian(o.dateId,l,h,c));else if(0==this._reSignedDay||0==i.isGotId.visible)this.showTip(o);else{var u=this.getReSignedInfo(),p=u[Math.abs(this._reSignedDay-5)].costGold,g=o.dateId,d=e.LanguageUtils.instance.getValue("SINGED_VIP_POPDOWN",o.vipDouble,p),f=e.LanguageUtils.instance.getValue("SINGED_VIP_POPVO",p);r>=o.vipDouble?e.PopUpController.getInstance().showTextPanel(f,this,function(t){e.WealPanelController.getInstance().requestSignAward(t)},g):this.buqian(g,d,h,c)}else this.showTip(o)},i.prototype.buqian=function(t,i,n,o){e.PopUpController.getInstance().showTextPanel(i,this,function(t){e.WealPanelController.getInstance().requestSignAward(t)},t,function(t){e.RechargeController.getInstance().showPanel()},t,n,o)},i.prototype.showTip=function(t){var i=t.awards.split("_");e.TipsController.getInstance().showItemTips(i[1],i[2])},i.prototype.returndata=function(e){var t;return 3==e.length?t=e.substr(0,1):4==e.length&&(t=e.substr(0,2)),t},i.prototype.changeViewInfo=function(){for(var t=this.getSignedInfo(),i=this.getReSignedInfo().concat(),n=this.getServiceSignedInfo(),o=String(n.nowDateId),a={},s={},r=n.everydaySignInfo,l=0,h=r.length,c=this.returndata(o);h>l;l++){var u=r[l];a[u.dateId]=u}for(l=0,h=t.length;h>l;l++){var u=t[l],p=c+"";-1!=u.id.indexOf(p)&&(s[u.id]=u)}t=null;var g=!1;for(l=1,h=31;h>l;l++){var d=s[~~(c+(10>l?"0"+l:l+""))],f=this.contentArr[l-1];if(f._init||f.initView(d),a[d.id]){f.setState(a[d.id],n.nowDateId);for(var m=this.contentArr.length,y=0;m>y;y++)if(Number(d.id)<=n.nowDateId&&!a[d.id].hasSign){g=!0;break}}}this.monthId.source="global_"+c+"month_png",this._reSignedDay=i.length-n.reSignTimes,this.signedDay.text=e.LanguageUtils.instance.getValue("SHENGYUBUQIAN")+":"+this._reSignedDay,this._reSignedDay>=0?g?this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=1:this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=0:this.showRedPoint=0,e.WealPanelController.getInstance().changeSignRedVisble(this.showRedPoint)},i.prototype.getSignedInfo=function(){return e.JsonDataManager.instance.wealInfo.signed},i.prototype.getServiceSignedInfo=function(){return e.WealPanelController.getInstance().loginModel.getSignedInfo()},i.prototype.getReSignedInfo=function(){return e.JsonDataManager.instance.wealInfo.resigned},i.prototype.dispose=function(){for(var e=0,t=this.contentArr.length;t>e;)this.contentArr[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getSignHandler,this),this.contentArr[e]=null,e+=1;this.contentArr=null,this.contentGroup.removeChildren()},i}(eui.Component);e.SingedView=t,__reflect(t.prototype,"foxgame.SingedView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e._data=null,e._init=0,e.skinName="SignedRenderSkin",e}return __extends(i,t),i.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},i.prototype.initView=function(e){this._init=1;var t=e.awards.split("_");this.iconId.setItem(~~t[1],~~t[2],!0,null,!1)},i.prototype.setState=function(t,i){this.isGotId.visible=~~t.dateId<=~~i,this._data=t;var n="";switch(t.vipDouble){case-1:this.vipgroup.visible=!1;break;case 14:this.vip.source="qiandaovip_json.v14_png";break;case 15:this.vip.source="qiandaovip_json.v15_png";break;case 16:this.vip.source="qiandaovip_json.v16_png";break;case 17:this.vip.source="qiandaovip_json.v17_png";break;case 18:this.vip.source="qiandaovip_json.v18_png";break;case 19:this.vip.source="qiandaovip_json.v19_png"}switch(t.hasSign){case 0:n="4kelingqu_png",this.ani&&(this.ani.clear(),this.ani=null),this.ani=new e.FoxAni(this.select),this.ani.play("select"),this.isGotId.visible=!0;break;case 1:n="4yilingqu_png",this.ani&&(this.ani.clear(),this.ani=null),this.isGotId.visible=!0;break;case 2:n="4kebuqian_png",this.ani&&(this.ani.clear(),this.ani=null),this.isGotId.visible=!0;break;case 3:this.isGotId.visible=!1,this.ani&&(this.ani.clear(),this.ani=null)}this.isGotId.source=n+""},i.prototype.getData=function(){return this._data},i}(eui.Component);e.SignedRender=t,__reflect(t.prototype,"foxgame.SignedRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){if(null==this.data.award)return;this.nameText&&(this.nameText.text=this.data.desc),this.expText&&(this.expText.text=this.data.point);var e=this.data.award.split("_");if(this.moneyText&&(this.moneyText.text=e[2]),this.moneyIcon&&(this.moneyIcon.source=("1002"==e[1]?"5tongbi_new_png":"yuanbao_png")+""),this.infoText){var i=[];null!=this.data.finishedCount?(i.push({text:this.data.desc}),i.push({text:"("+this.data.finishedCount+"/"+this.data.finishCount+")",style:{textColor:this.data.finishedCount>=this.data.finishCount?2227971:16711680}})):(i.push({text:this.data.desc}),i.push({text:"(0/"+this.data.finishCount+")",style:{textColor:16711680}})),this.infoText.textFlow=i}this.getAwardBtn&&(this.data.awardState?this.getAwardBtn.visible=1==this.data.awardState:this.getAwardBtn.visible=!1,this.getAwardBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwardHandler,this)),this.gotoSceneBtn&&(this.data.awardState?this.gotoSceneBtn.visible=0==this.data.awardState:this.gotoSceneBtn.visible=!0,this.gotoSceneBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.gotoSceneBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwardHandler,this)),this.maskId&&(this.data.awardState?this.maskId.visible=2==this.data.awardState:this.maskId.visible=!1),this.iconId&&(this.iconId.source=this.data.icon)}this.getAwardBtn.visible==this.getAwardBtn.enabled==1&&this.parent?this.effectLingQu(!0):this.effectLingQu(!1)},i.prototype.effectLingQu=function(t){this.rechargeAni&&(this.rechargeAni.clear(),this.rechargeAni=null),t&&(this.rechargeAni||(this.rechargeAni=new e.FoxAni(this.rechargeAniGroup),this.rechargeAni.play("rechargeAnimation","ani",-1)))},i.prototype.getAwardHandler=function(t){this.data.tastPanel.stopScroller(),t.target==this.gotoSceneBtn?(null==this.data.awardState&&(this.data.awardState=0),0==this.data.awardState&&this.gotoScene(this.data.page)):1==this.data.awardState&&e.WealPanelController.getInstance().requestTaskDayAwardInfo(this.data.id)},i.prototype.gotoScene=function(t){t=~~t;var i;switch(t){case e.TaskJumpId.PAGE1:e.WealPanelController.getInstance().closeWealView(),e.EquipSmeltController.getInstance().showPanel(e.SmeltViewType.SMELT);break;case e.TaskJumpId.PAGE17:e.ShopMainControler.getInstance().showPanel(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE5:if(e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHIBANG))e.WingController.getInstance().showWingPanel(),e.WealPanelController.getInstance().closeWealView();else{var n=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHIBANG);e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WINGOPEN",n))}break;case e.TaskJumpId.PAGE45:if(e.PlayerService.instance.level<20)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYOPENLEVEL",20));e.FuBenController.getInstance().showPanel(e.FuBenType.EquipType),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE46:if(e.PlayerService.instance.level<20)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("COPYOPENLEVEL",20));e.FuBenController.getInstance().showPanel(e.FuBenType.GemType),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE12:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.JINGJICHANG),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE10:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.FIELDPK),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE7:e.CharacterController.getInstance().showPanel(e.CharacterPanelViewType.SKILLVIEW),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE15:e.NewChatControler.getInstance().showPanel(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE2:e.SmeltController.getInstance().showPanel(e.SMELTTAPS.QIANGHUA),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE39:if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.SHIJIEBOSS,!1),0==i){var o=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.SHIJIEBOSS));return void e.PopUpController.getInstance().showFloatTextPanel1(o)}e.WorldBossController.getInstance().showBossPanel(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE48:if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YOUMINGTA,!1),0==i){var o=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YOUMINGTA));return void e.PopUpController.getInstance().showFloatTextPanel1(o)}e.ClimbingController.getInstance().show(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE49:if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.CHUANQIBAYE,!1),0==i){var o=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.CHUANQIBAYE));return void e.PopUpController.getInstance().showFloatTextPanel1(o)}e.LegendController.getInstance().showMainPanel(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE50:if(i=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.YAJIEQIUTU,!1),0==i){var o=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.YAJIEQIUTU));return void e.PopUpController.getInstance().showFloatTextPanel1(o)}e.PrisonerController.getInstance().showPanel(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE51:if(i=e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_LIMIT")),0==i){var o=e.LanguageUtils.instance.getValue("COPYOPENLEVEL",e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.KUAFULIANSAI));return void e.PopUpController.getInstance().showFloatTextPanel1(o)}e.KFController.getInstance().showPanel(),e.WealPanelController.getInstance().closeWealView();break;case e.TaskJumpId.PAGE29:e.CreateNewVipController.instance.showPanel()}},i}(eui.ItemRenderer);e.TaskItemRender=t,__reflect(t.prototype,"foxgame.TaskItemRender")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.PAGE1=1]="PAGE1",e[e.PAGE2=2]="PAGE2",e[e.PAGE3=3]="PAGE3",e[e.PAGE4=4]="PAGE4",e[e.PAGE5=5]="PAGE5",e[e.PAGE6=6]="PAGE6",e[e.PAGE7=7]="PAGE7",e[e.PAGE8=8]="PAGE8",e[e.PAGE9=9]="PAGE9",e[e.PAGE10=10]="PAGE10",e[e.PAGE11=11]="PAGE11",e[e.PAGE12=12]="PAGE12",e[e.PAGE13=13]="PAGE13",e[e.PAGE14=14]="PAGE14",e[e.PAGE15=15]="PAGE15",e[e.PAGE16=16]="PAGE16",e[e.PAGE17=17]="PAGE17",e[e.PAGE18=18]="PAGE18",e[e.PAGE19=19]="PAGE19",e[e.PAGE20=20]="PAGE20",e[e.PAGE21=21]="PAGE21",e[e.PAGE22=22]="PAGE22",e[e.PAGE23=23]="PAGE23",e[e.PAGE24=24]="PAGE24",e[e.PAGE25=25]="PAGE25",e[e.PAGE26=26]="PAGE26",e[e.PAGE27=27]="PAGE27",e[e.PAGE28=28]="PAGE28",e[e.PAGE29=29]="PAGE29",e[e.PAGE30=30]="PAGE30",e[e.PAGE31=31]="PAGE31",e[e.PAGE32=32]="PAGE32",e[e.PAGE33=33]="PAGE33",e[e.PAGE34=34]="PAGE34",e[e.PAGE35=35]="PAGE35",e[e.PAGE36=36]="PAGE36",e[e.PAGE37=37]="PAGE37",e[e.PAGE38=38]="PAGE38",e[e.PAGE45=45]="PAGE45",e[e.PAGE46=46]="PAGE46",e[e.PAGE48=48]="PAGE48",e[e.PAGE49=49]="PAGE49",e[e.PAGE50=50]="PAGE50",e[e.PAGE51=51]="PAGE51",e[e.PAGE39=39]="PAGE39"}(t=e.TaskJumpId||(e.TaskJumpId={}));var i=function(t){function i(){var e=t.call(this)||this;return e.dp=null,e.scroller=null,e.dpPop=null,e.scrollerPop=null,e.showRedPoint=0,e.booAward=1,e._value=0,e.tweenNum=0,e.skinName="TaskViewSkin",e}return __extends(i,t),i.prototype.init=function(){this.dp=new eui.ArrayCollection;for(var e=0,t=5;t>e;e++)this.dp.addItem({});for(this.scroller=this.createList(this.dp),this.listGroup.addChild(this.scroller),this.boxArr=[this.box1,this.box2,this.box3,this.box4],e=0,t=this.boxArr.length;t>e;e++)this.boxArr[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwardHandler,this)},i.prototype.changeViewinfo=function(){null==this.progressBar.mask&&(this.progressBar.mask=this.progressBarMask),this.dp.removeAll(),this.progressBar.x=this.progressBarMask.x-this.progressBar.width,this.taskPopGroup.visible=this.maskId.visible=!1;var t=this.cloneObjFromAry(this.getTaskInfo().concat()),i=this.getTaskServiceInfo(),n={},o=0,a=t.length,s=0,r=i.activeItems,l=i.rewardStatus;if(r.length)for(;a>o;){var h=r[o];if(!h)break;n[h.cfgId]=h,o++}var c=[],u=[],p=[];for(o=0,a=t.length;a>o;){var g=t[o],d=n[g.id];g.tastPanel=this,d?(g.finishedCount=d.finishedCount,g.awardState=d.awardState,2==d.awardState?(s+=~~g.point,p.push(g)):1==d.awardState?(c.push(g),this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=1):u.push(g)):u.push(g),o++}for(0==c.length&&(this.showRedPoint=0),c=c.concat(u,p),o=0,a=c.length;a>o;)this.dp.addItem(c[o]),o++;this.changeBar(l,s),this.activiNumId.text=s+"/150"},i.prototype.cloneObjFromAry=function(e){for(var t=e.length,i=[],n=0;t>n;n++){var o=e[n],a=JSON.stringify(o),s=JSON.parse(a);i.push(s)}return i},i.prototype.changeBar=function(e,t){t=~~t;var i=4,n=0,o=this.getTaskAwardInfo(),a=Math.floor(t/100*100);a>150&&(a=150),this.progressBar.x=this.progressBar.width*(a/150)+(this.progressBarMask.x-this.progressBar.width);for(var s,r,l;i>n;)s=e[n],l=this.boxArr[n],r=o[n],s&&~~s==n+1?(l.source="weal_BoxGeted_png",l.name="0"):this.activitiFunc(t,r,l,n),l.scaleX*l.width==0||(l.x=this.progressBarMask.x+this.progressBarMask.width*(~~r.needPoint/150)-l.scaleX*l.width),n++;for(n=0;i>n&&(s=e[n],null!=s);)l=this.boxArr[s-1],l.source="weal_BoxGeted_png",l.name="0",l.scaleX=l.scaleY=.6,n++},i.prototype.activitiFunc=function(t,i,n,o){t>=i.needPoint?(n.source="weal_BoxOpen_png",n.name="1",this.showRedPoint=e.WealPanelController.getInstance().showRedPoint=1,n.scaleX=n.scaleY=.8):(n.source="weal_Box_png",n.name="2",n.scaleX=n.scaleY=.6),n.scaleX*n.width==0||(n.x=this.progressBarMask.x+this.progressBarMask.width*(~~i.needPoint/150)-(n.scaleX*n.width>>1))},i.prototype.getAwardHandler=function(e){var t=this;if(1==this.booAward){var i=this.getTaskAwardInfo().concat(),n=this.boxGroup.getChildIndex(e.target),o=~~e.target.name,a=i[n];this.showTip(o,a),this.booAward=0;var s=egret.setTimeout(function(){t.booAward=1,egret.clearTimeout(s)},this,500)}},i.prototype.showTip=function(t,i){this.popInfoId.text=e.LanguageUtils.instance.getValue("XUYAOHUOYUEDU",i.needPoint),1==t?(this._value=i.id,this.getAwardBtn.touchEnabled=this.getAwardBtn.enabled=!0):(this._value=0,this.getAwardBtn.touchEnabled=this.getAwardBtn.enabled=!1);for(var n=i.reward.split(","),o=0,a=n.length;a>o;o++);e.WealPanelController.getInstance().showWealVitalityPanel(1==t,i)},i.prototype.initTip=function(){null==this.dpPop&&(this.dpPop=new eui.ArrayCollection,this.scrollerPop=this.createHorizontalList(this.dpPop),this.rewardGroup.addChild(this.scrollerPop),this.getAwardBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwarHandler,this),this.maskId.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.maskId.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwarHandler,this),this.closeBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwarHandler,this))},i.prototype.getAwarHandler=function(t){t.target==this.getAwardBtn?e.WealPanelController.getInstance().requestTaskAwardInfo(this._value):this.maskId.visible=this.taskPopGroup.visible=!1},i.prototype.onTabBarIndexChanged=function(e){},i.prototype.createHorizontalList=function(t){var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.gap=3;var n=new eui.List;n.layout=i,n.itemRenderer=e.LoginIconRender,n.itemRendererSkinName="LoginIconRendererSkin",n.dataProvider=t,n.addEventListener(egret.Event.CHANGE,this.onTabBarIndexHorizontalChanged,this);var o=new eui.Scroller;return o.percentWidth=o.percentHeight=100,o.viewport=n,o.top=5,o},i.prototype.onTabBarIndexHorizontalChanged=function(t){var i=t.target.selectedIndex,n=t.target.dataProvider.source[i].id.split("_");e.TipsController.getInstance().showItemTips(n[1],n[2]),t.target.selectedIndex=-1},i.prototype.createList=function(t){var i=new eui.VerticalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER;var n=new eui.List;n.layout=i,n.itemRenderer=e.TaskItemRender,n.itemRendererSkinName="TaskRenderSkin",n.dataProvider=t;var o=new eui.Scroller;return o.percentWidth=o.percentHeight=100,o.viewport=n,o.top=5,o},i.prototype.startSzieTween=function(e,t,i){var n=this;void 0===t&&(t=300),void 0===i&&(i=1);var o,a,s,r,l,h;l=e.x,h=e.y,o=e.width,a=e.height,s=e.x-(1.3*o-o>>1),r=e.y-(1.3*a-a>>1),TweenMax.to(e,t/1e3,{x:s,y:r,scaleX:1.3,scaleY:1.3,onComplete:function(){TweenMax.to(e,t/1e3,{x:l,y:h,scaleX:1,scaleY:1,onComplete:function(){TweenMax.killTweensOf(e),n.tweenNum<=i?(n.startSzieTween(i),n.tweenNum++):n.tweenNum=0}})}})},i.prototype.getScroller=function(){return this.scroller},i.prototype.getTaskInfo=function(){return e.JsonDataManager.instance.wealInfo.task},i.prototype.getTaskServiceInfo=function(){return e.WealPanelController.getInstance().loginModel.getTaskInfo()},i.prototype.getTaskAwardInfo=function(){return e.JsonDataManager.instance.wealInfo.taskAward},i.prototype.stopScroller=function(){this.getScroller()&&(this.getScroller().stopAnimation(),this.getScroller().viewport.scrollV=0),this.scrollerPop&&(this.scrollerPop.stopAnimation(),this.scrollerPop.viewport.scrollV=0)},i.prototype.dispose=function(){this.dp&&(this.dp.removeAll(),this.dp=null),this.dpPop&&(this.dpPop.removeAll(),this.dp=null),this.stopScroller(),this.scroller&&(this.scroller.removeChildren(),App.DisplayUtils().removeFromParent(this.scroller),this.scroller=null),this.scrollerPop&&(this.scrollerPop.removeChildren(),App.DisplayUtils().removeFromParent(this.scrollerPop),this.scrollerPop=null);for(var e=0,t=this.boxArr.length;t>e;e++)this.boxArr[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getAwardHandler,this);this.boxArr=null,this.listGroup.removeChildren()},i}(eui.Component);e.TaskView=i,__reflect(i.prototype,"foxgame.TaskView")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/wealModule/task/TaskVitalitySkin.exml")||this;return e.collection=null,e}return __extends(i,t),i.prototype.initHook=function(){this.ui.getAwardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.collection=new eui.ArrayCollection;var t=new eui.HorizontalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.gap=25;var i=this.ui.list;i.layout=t,i.itemRenderer=e.LoginIconRender,i.dataProvider=this.collection,i.addEventListener(egret.Event.CHANGE,this.onTabBarIndexHorizontalChanged,this)},i.prototype.refresh=function(){this.ui.popInfoId.text=e.LanguageUtils.instance.getValue("XUYAOHUOYUEDU",this.award.needPoint),this.getFlag?this.ui.getAwardBtn.touchEnabled=this.ui.getAwardBtn.enabled=!0:this.ui.getAwardBtn.touchEnabled=this.ui.getAwardBtn.enabled=!1;for(var t=this.award.reward.split(","),i=[],n=t.length,o=0;n>o;o++)i.push({id:t[o]});this.collection.replaceAll(i)},i.prototype.getAwarHandler=function(){0!=this.getFlag&&e.WealPanelController.getInstance().requestTaskAwardInfo(this.award.id)},i.prototype.showPanel=function(e,t){this.getFlag=e,this.award=t,this.show()},i.prototype.onTabBarIndexHorizontalChanged=function(t){var i=t.target.selectedIndex,n=t.target.dataProvider.source[i].id.split("_");e.TipsController.getInstance().showItemTips(n[1],n[2]),t.target.selectedIndex=-1},i.prototype.closeHook=function(){this.getAwarHandler()},i}(e.BasePanel);e.WealVitalityPanel=t,__reflect(t.prototype,"foxgame.WealVitalityPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.RedPacketModel,this.panel=new e.WeiduanPanel(this.model),this.tuisongMain=new e.RedPacketTuiSongMainPanel(this.model),this.lessPanel=new e.RedPacketLessView(this.model),this.infoPanel=new e.RedPacketInfoView(this.model)}return t.prototype.registerMsg=function(t){t.add(e.Code.READ_PACKAGE_ROB_S,this),t.add(e.Code.READ_PACKAGE_ROB_INFO_S,this),t.add(e.Code.READ_PACKAGE_GOLDS_INFO_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.READ_PACKAGE_GOLDS_INFO_S:this.model.setRedPacketInForData(i);break;case e.Code.READ_PACKAGE_ROB_S:this.model.setRobData(i);break;case e.Code.READ_PACKAGE_ROB_INFO_S:this.model.setRedPacketTuiSong(i)}},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.getRedPacketInfo(),this.panel.getIsShow()||this.panel.show()},t.prototype.getRedPacketInfo=function(){var t=HawkProtocolManager.newBuilder("JsProto.HPEscortPrisonerInfoReq");e.Message.instance.send(e.Code.READ_PACKAGE_GOLDS_INFO_C,t,!0)},t.prototype.qiangRedPacket=function(t){var i=HawkProtocolManager.newBuilder("JsProto.HPRedPackageRobRep");i.setMarkNumber(t),e.Message.instance.send(e.Code.READ_PACKAGE_ROB_C,i,!0)},t}();e.WeiduanController=t,__reflect(t.prototype,"foxgame.WeiduanController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(t){var i=e.call(this,"resource/skins/weiduan/WeiduanViewSkin.exml")||this;return i.model=t,i.setIsTextureCache(!0),i}return __extends(t,e),t.prototype.panelChanged=function(){},t.prototype.initHook=function(){this.initListener(),this.model.registerObserver(this)},t.prototype.initListener=function(){this.ui.IOSdownloadBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIOSDownload,this),this.ui.AndownloadBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAndDownload,this)},t.prototype.onIOSDownload=function(e){window.open("https://itunes.apple.com/cn/app/id1221778297?l=zh&ls=1&mt=8")},t.prototype.onAndDownload=function(e){window.open("https://fir.im/q2b")},t}(e.BasePanel);e.WeiduanPanel=t,__reflect(t.prototype,"foxgame.WeiduanPanel",["foxgame.Iprisoner","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.mapNum=1,this.isprimaryMap=!1,this.panel=new e.WelcomePanel,this.model=new e.WelcomeModel}return t.prototype.registerMsg=function(t){t.add(e.Code.OPEN_GAME_ZI_YUAN_S,this),t.add(e.Code.OPEN_GAME_ZI_YUAN_PULL_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.ROLE_CREATE_S:this.model.isCanShow=!0;break;case e.Code.OPEN_GAME_ZI_YUAN_S:this.model.setWelcomeUIInfoData(i);break;case e.Code.OPEN_GAME_ZI_YUAN_PULL_S:}},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){},t.prototype.isShow=function(){return this.panel.getIsShow()},t.prototype.showPanelGuide=function(){this.isprimaryMap=!0,this.panel.isGuide=!0,this.panel.scaleX=0,this.panel.scaleY=0,this.panel.guideShow(!0),egret.Tween.get(this.panel).to({scaleX:1,scaleY:1},500)},t.prototype.showWelcomeUI=function(){this.panel.show()},t.prototype.sendWelComeUIReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.OpenGameZiYuanReq");e.Message.instance.send(e.Code.OPEN_GAME_ZI_YUAN_C,t,!0)},t.prototype.sendWCUIDontRemindReq=function(){var t=HawkProtocolManager.newBuilder("JsProto.OpenGameZiYuanReq");e.Message.instance.send(e.Code.OPEM_GAME_ZI_YUAN_PULL_C,t,!0)},t.prototype.limitShowWelcomeUI=function(e){var t=e,i=new Date(1e3*t),n=new Date(i.getTime()+1728e5);n.setHours(23,59,59);var o=new Date;return i.getTime()<=o.getTime()&&o.getTime()<=n.getTime()?!0:!1},t}();e.WelcomeController=t,__reflect(t.prototype,"foxgame.WelcomeController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.isCanShow=!1}return t.prototype.setWelcomeUIInfoData=function(t){return 0!=t.getErrorNo()?void console.log("错误码 "+t.getErrorNo()):void(t.getState()?e.ActivityController.getIntance().sendHPInitGroomReq():(e.WealPanelController.getInstance().fuliUIIsShow=!0,e.WelcomeController.getInstance().showWelcomeUI()))},t}();e.WelcomeModel=t,__reflect(t.prototype,"foxgame.WelcomeModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/welcome/welcomeskin.exml","guideGlobalGroup",!1)||this;return e.isGuide=!1,e.ani=null,e.guidMap=!1,e.isMask=!0,e.setIsShowBackBtn(!1),e.layer=LayerType.TOPLAYER,e}return __extends(i,t),i.prototype.initHook=function(){egret.getOption("pf")&&-1!=egret.getOption("pf").indexOf("fdbt")&&(this.ui.bgimg.source="fdbtwelcom_png")},i.prototype.showHook=function(){this.guidMap&&(this.ui.checkBoxBtn.visible=!1,this.ui.todayTips.visible=!1);var t=this.ui.ani_group,i=new e.FoxAni(t);i.play("GuideMission_start_game","GuideMission_start_game",-1),this.ani=i,t.scaleX=1,t.scaleY=1,this.ui.beginGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.ui.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkBtnClick,this)},i.prototype.btnClick=function(){this.isGuide?this.isGuide=!1:App.SoundManager().playEffect("voice_001_mp3"),this.ui.beginGame.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this.close()},i.prototype.checkBtnClick=function(){e.WelcomeController.getInstance().sendWCUIDontRemindReq()},i.prototype.closeHook=function(){for(var t=["welcome_beijingdi","welcome_start","welcome_startliang"],i=0,n=t.length;n>i;)e.GlobalUtil.destroyRes(t[i]),i+=1;t=null,this.ani&&(this.ani.dispose(),this.ani=null),e.Message.instance.send(e.MsgCMD.WELCOME_PANEL_CLOSE,null,!1)},i.prototype.guideShow=function(e){this.guidMap=e,this.show()},i}(e.BasePanel);e.WelcomePanel=t,__reflect(t.prototype,"foxgame.WelcomePanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="WingCellUpStar",t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.starList=[this.star0,this.star1,this.star2,this.star3,this.star4]},t.prototype.setAllStarState=function(e,t){void 0===t&&(t=!1);for(var i=0,n=this.starList.length;n>i;)this.starList[i].enabled=!1,i+=1;if(t)for(i=0;e>i;)this.starList[this.starList.length-i-1].enabled=!0,i+=1;else for(i=0;e>i;)this.starList[i].enabled=!0,i+=1},t}(eui.Component);e.WingCellUpStar=t,__reflect(t.prototype,"foxgame.WingCellUpStar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.wing=null,this.model=new e.WingModel,this.wing=new e.WingPanel(this.model),this.startPanel=new e.WingStarPanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.initView=function(){this.wing.addEvent()},t.prototype.closeWingView=function(){this.wing.close()},t.prototype.showWingPanel=function(t){return void 0===t&&(t=0),e.PlayerService.instance.level<25?void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ARENA_MAINSCENE_LEVELERROR_TIP")):(this.model.roleIndex=t,void this.wing.show())},t.prototype.getIsShow=function(){return this.wing&&this.wing.getIsInit()?this.wing.getIsShow():!1},t.prototype.showWingStarPanel=function(e){void 0===e&&(e=0),this.model.roleIndex=e,this.startPanel.show()},t.prototype.getOperate=function(){for(var t,i,n,o,a,s,r,l=e.PlayerService.instance.getRoleDataList(),h=l.length,c=e.JsonDataManager.instance.wingTemplate,u=e.PlayerService.instance.playerInfo.getCoin(),p=0;h>p;p++){if(t=l[p],i=e.WingService.instance.isActive(t.roleId),o=e.WingService.instance.getWingInfo(t.roleId),!i)return!1;if(n=c[o.getId()+"_"+o.getLevel()],a=e.BagController.getInstance().getCountByItemId(n.advncedCost.id),s=n.advncedCost.value,r=n.baseCost.value,a>=s||u>=r)return!0}return!1},t}();e.WingController=t,__reflect(t.prototype,"foxgame.WingController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.WingModel=t,__reflect(t.prototype,"foxgame.WingModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/wingSystem/WingSkin.exml","wingSystem",!1)||this;return i.isAvatarPlay=!1,i.isExpCriticals=0,i.setIsTextureCache(!1),i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i}return __extends(i,t),i.prototype.destroyRESHook=function(){if(!this.isDestroy){var t=this.ui.wingIcon;t&&(e.GlobalUtil.doTransformEuiComponentUniqueDestroyBitmapRes(t,"WingPanelWingImg",!0,this.getUiBaseName()),t.source="")
}},i.prototype.addUpStarValue=function(t){if(null!=this.wingStarCfg){this.upStarAdd=[];for(var i=this.roleWingInfo.getLeftStar(),n=this.wingStarCfg[i],o=n.leftTypeList,a=n.leftValueList,s=o.length,r=0;s>r;r++){var l=this.systemRelationCfg[o[0]];this.upStarAdd.push({id:l.relation,v:l.numType==e.AttDefNumType.INT?a[0]:a[0]/1e4})}var h=this.wingStarCfg[this.roleWingInfo.getRightStar()],c=h.rightTypeList,u=h.rightValueList;s=c.length;for(var r=0;s>r;r++){for(var p,g=this.systemRelationCfg[c[0]],d=0;d<this.upStarAdd.length;d++)if(this.upStarAdd[d].id==g.relation){p=!0,this.upStarAdd[d].v+=g.numType==e.AttDefNumType.INT?u[0]:u[0]/1e4;break}p||this.upStarAdd.push({id:g.relation,v:g.numType==e.AttDefNumType.INT?u[0]:u[0]/1e4})}s=this.upStarAdd.length;for(var r=0;s>r;r++)if(t==this.upStarAdd[r].id)return this.upStarAdd[r].v;return 0}},i.prototype.setRoleData=function(e){this.roleData=e,this.roleId!=this.roleData.roleId&&(this.roleId=this.roleData.roleId,this.initData())},i.prototype.referGold=function(){var t=e.PlayerService.instance.playerInfo;this.currentGoldNums=Number(t.getCoin()),this.currentGemNums=Number(t.getGold()),this.roleWingInfo=e.WingService.instance.getWingInfo(this.roleId)},i.prototype.initData=function(){this.ui.currency.refresh(),this.referGold(),this.roleId=this.roleData.roleId,this.isActive=e.WingService.instance.isActive(this.roleId),this.activateState(!this.isActive),null!=this.roleWingInfo&&(this.wingModelId=e.WingService.instance.getWingModelId(this.roleId),this.ui.wingIcon.source="wings"+this.wingModelId.toString()+"_png",this.ui.tips.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("WING_EXPALIN_1")),0==this.isAvatarPlay&&(this.isAvatarPlay=!0,this.avatarToBig()),this.activityInfo(),this.showInfo())},i.prototype.avatarToBig=function(){egret.Tween.get(this.ui.wingIcon).wait(350).to({scaleX:1.07,scaleY:1.06},1e3).wait(50).call(this.avatarToSmall,this,null)},i.prototype.avatarToSmall=function(){egret.Tween.get(this.ui.wingIcon).to({scaleX:1,scaleY:1},800).call(this.avatarToBig,this,null)},i.prototype.initParams=function(){this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.roleIndex),this.ui.checkBoxBtn_1.selected=!1,this.referGold()},i.prototype.activityInfo=function(){this.getIsShow()&&(this.isActive?(this.activateState(!this.isActive),this.wingVO=this.getWingTemp()[this.roleWingInfo.getId()+"_"+this.roleWingInfo.getLevel()],this.maxLevel=e.WingService.instance.getMaxLevelById(this.roleWingInfo.getId()),this.roleWingInfo.getLevel()>=this.maxLevel?this.isChangeWing=!0:this.isChangeWing=!1,this.moveForwardState(this.isChangeWing),this.normalState(!this.isChangeWing),this.isChangeWing?(this.roleWingInfo.getId()<e.WingService.instance.maxId?this.nextLevelWingVO=this.getWingTemp()[(this.roleWingInfo.getId()+1).toString()+"_0"]:this.nextLevelWingVO=this.wingVO,this.ui.upStarProgress.setDiffProgress(this.roleWingInfo.getExp())):(this.ui.upStarProgress.maxValue=this.wingVO.exp,this.ui.upStarProgress.setProgress(this.roleWingInfo.getExp()),this.roleWingInfo.getLevel()+1>=this.maxLevel?(this.nextLevelWingVO=this.getWingTemp()[(this.roleWingInfo.getId()+1).toString()+"_0"],void 0==this.nextLevelWingVO&&(this.nextLevelWingVO=this.getWingTemp()[this.roleWingInfo.getId().toString()+"_"+(this.roleWingInfo.getLevel()+1).toString()])):this.nextLevelWingVO=this.getWingTemp()[this.roleWingInfo.getId().toString()+"_"+(this.roleWingInfo.getLevel()+1).toString()]),this.ui.tenStar.setStarLvl(this.roleWingInfo.getLevel())):(this.ui.tenStar.setStarLvl(0),this.wingVO=this.getWingTemp()[(this.roleWingInfo.getId()+1).toString()+"_"+this.roleWingInfo.getLevel().toString()],this.nextLevelWingVO=this.wingVO,this.ui.upStarProgress.maxValue=this.wingVO.exp,this.ui.upStarProgress.setProgress(0),this.moveForwardState(this.isActive),this.normalState(this.isActive)))},i.prototype.playAni=function(t){this.wingVO&&this.wingVO.id>=4&&t?(this.starAni&&(this.starAni.clear(),this.starAni=null),this.starAni=new e.FoxAni(this.ui.starUpEffect),this.starAni.play("upStarEffect","ani"),this.ui.starUpEffect.visible=!0):this.ui.starUpEffect.visible=!1},i.prototype.initHook=function(){this.initUI(),this.initListener(),this.doScreenAdaptation()},i.prototype.showHook=function(){this.initData(),App.GuideUtils().currPart==e.GuidePart.currPart22&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.ui.normalBtn,this.ui.buttonGroup,e.GuidePart.currPart22,1,!1),App.GuideUtils().currPart==e.GuidePart.currPart21&&0==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.ui.checkBoxBtn_0,this.ui.checkBoxBtn_0.parent,e.GuidePart.currPart21,1,!1),27==App.GuideUtils().currdbz&&21!=App.GuideUtils().currPart&&(1==this.ui.activateBtn.visible?e.MainControler.instance.guidechange(this.ui.activateBtn,this.ui.activateBtn.parent,27,2,!0):e.MainControler.instance.guidechange(this.ui.closeBtn,this.ui.closeBtn.parent,27,3,!0)),43==App.GuideUtils().currdbz&&1==App.GuideUtils().currxbz&&e.MainControler.instance.guidechange(this.ui.yoajijiaanniu,this.ui.yoajijiaanniu.parent,43,2,!0),this.ui.wingIcon&&""==this.ui.wingIcon.source&&this.wingModelId&&(this.ui.wingIcon.source="wings"+this.wingModelId.toString()+"_png");var t=Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL"));this.ui.yaoji.visible=this.ui.yaojitxt.visible=this.ui.chibang.visible=this.ui.chibangtxt.visible=e.PlayerService.instance.playerInfo.getLevel()>=t},i.prototype.showInfo=function(){if(this.wingVO){var t=this.wingVO.attrTypeList,i=this.wingVO.attrValueList,n=this.nextLevelWingVO.attrTypeList,o=this.nextLevelWingVO.attrValueList,a="",s="",r="",l=0,h=0;if(this.getIsInit()){for(var c=[],u=[],p=[],g=t.length,d=0;g>d;d++)this.isActive?(l=this.addUpStarValue(t[d]),h=i[d]*(1+l),a+=e.LanguageUtils.instance.getValue("ATT_"+t[d])+": "+~~(h+"")+"\n",c.push({text:e.LanguageUtils.instance.getValue("ATT_"+t[d])+": ",style:{textColor:16777215}}),c.push({text:~~(h+"")+"",style:{textColor:6812189}}),c.push({text:"\n"})):(r+=e.LanguageUtils.instance.getValue("ATT_"+t[d])+": 0\n",p.push({text:e.LanguageUtils.instance.getValue("ATT_"+t[d])+": ",style:{textColor:16777215}}),p.push({text:"0",style:{textColor:16777215}}),p.push({text:"\n"}));g=n.length;for(var d=0;g>d;d++)l=this.addUpStarValue(n[d]),h=o[d]*(1+l),s+=e.LanguageUtils.instance.getValue("ATT_"+n[d])+": "+~~(h+"")+"\n",u.push({text:~~(h+"")+"",style:{textColor:6812189}}),u.push({text:"\n"});this.isActive?(a==s?this.ui.nextProperty.text=e.LanguageUtils.instance.getValue("YIMANJI"):this.ui.nextProperty.textFlow=u,this.ui.thisProperty.textFlow=c,this.isChangeWing?this.ui.currentLevel.text=e.LanguageUtils.instance.getValue("WINGXINGJI",this.jieShu.split(",")[~~this.wingVO.id-1],e.LanguageUtils.instance.getValue("HANZINUMBER0")):this.ui.currentLevel.text=e.LanguageUtils.instance.getValue("WINGXINGJI",this.jieShu.split(",")[~~this.wingVO.id-1],this.starNum.split(",")[this.roleWingInfo.getLevel()])):(this.ui.currentLevel.text=e.LanguageUtils.instance.getValue("WINGXINGJI",e.LanguageUtils.instance.getValue("HANZINUMBER1"),e.LanguageUtils.instance.getValue("HANZINUMBERLING")),this.ui.thisProperty.textFlow=p,this.ui.nextProperty.textFlow=p),this.wingVO.id>=4&&0==this.ui.starUpEffect.visible&&(this.ui.starUpEffect.visible=!0)}this.coinNeed=this.wingVO.baseCost.value,this.needFeatherNums=this.wingVO.advncedCost.value,this.currentFeatherNum=e.BagController.getInstance().getCountByItemId(this.wingVO.advncedCost.id);var f=e.JsonDataManager.instance.itemTemplate;this.featherVO=f[this.wingVO.advncedCost.id];var m=e.PlayerService.instance.playerInfo;if(this.currentGoldNums=Number(m.getCoin()),this.currentGemNums=Number(m.getGold()),this.getIsInit()){this.ui.currency.refresh(),this.ui.goldNums.text=this.currentGoldNums+"",this.ui.diamondNums.text=this.currentGemNums+"",this.ui.featherNums.text=this.currentFeatherNum+"",this.ui.wingName.text=this.wingVO.name;var y=this.roleWingInfo.getLeftStar(),I=this.roleWingInfo.getRightStar();I<e.WingService.instance.getUpStarLevel(this.roleWingInfo.getLevel())||y<e.WingService.instance.getUpStarLevel(this.roleWingInfo.getLevel())?this.playAni(!0):this.playAni(!1)}this.referGold()}},i.prototype.addEvent=function(){App.MessageCenter.addListener(MessageCode.REFRESH_COIN,this.refreshInfo,this)},i.prototype.refreshInfo=function(){this.refreshWing()},i.prototype.initUI=function(){this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.ui.currentLevel.text=e.LanguageUtils.instance.getValue("WINGXINGJI",e.LanguageUtils.instance.getValue("HANZINUMBER1"),e.LanguageUtils.instance.getValue("HANZINUMBERLING")),this.ui.starUpEffect.touchEnabled=!1,this.wingStarCfg=e.WingService.instance.getWingUpStarCfg(),this.systemRelationCfg=e.WingService.instance.getSystemRelationCfg(),this.jieShu=e.WingService.instance.JIESHU,this.starNum=e.WingService.instance.STARNUM},i.prototype.bagItemChanged=function(){this.refreshWing(),this.initData()},i.prototype.refreshWing=function(){this.ui&&(this.roleId||(this.roleId=e.PlayerService.instance.mainRoleInfo.getRoleId()),this.roleWingInfo||(this.roleWingInfo=e.WingService.instance.getWingInfo(this.roleId)),this.referGold(),this.isActive=e.WingService.instance.isActive(this.roleId),this.activityInfo(),this.showInfo(),this.redPointCanShow(),this.setwingpoint())},i.prototype.redPointCanShow=function(){this.isActive&&this.wingVO&&this.wingVO.id<e.WingService.instance.maxId?(this.currentFeatherNum>=this.needFeatherNums?this.ui.redTip&&(this.ui.redTip.visible=!0):this.ui.redTip&&(this.ui.redTip.visible=!1),this.currentGoldNums>=this.coinNeed?this.ui.redTip0&&(this.ui.redTip0.visible=!0):this.ui.redTip0&&(this.ui.redTip0.visible=!1)):this.ui&&this.ui.redTip0&&this.ui.redTip&&(this.ui.redTip0.visible=this.ui.redTip.visible=!1)},i.prototype.initListener=function(){e.Message.instance.add(e.Code.WING_EVOLUTION_S,this),e.Message.instance.add(e.Code.WING_LEVEL_UP_S,this),e.Message.instance.add(e.MsgCMD.UP_WING_STAR_INFO,this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.ui.normalBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.highBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.activateBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.upLvelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.upWingBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.checkBoxBtn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.chibang.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this),this.ui.yaoji.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickskip,this)},i.prototype.btClick=function(t){var i=e.JsonDataManager.instance.itemTemplate;switch(t.target){case this.ui.normalBtn:if(this.currentGoldNums<this.coinNeed){var n=i[1002];return void e.ItemNotEnoughController.getInstance().showPanel(n.id)}this.ui.checkBoxBtn_0.selected&&(this.isExpCriticals=1);var o=HawkProtocolManager.newBuilder("JsProto.HPWingLvlUpReq");if(o.setRoleId(this.roleWingInfo.getRoleId()),o.setType(1),o.setAutoLvlUp(this.ui.checkBoxBtn_0.selected),o.setAutoConvert(this.ui.checkBoxBtn_1.selected),e.Message.instance.send(e.Code.WING_LEVEL_UP_C,o,!0),App.GuideUtils().currPart==e.GuidePart.currPart22&&1==App.GuideUtils().currStep){var a=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(a,a.parent,e.GuidePart.currPart22,2,!1)}break;case this.ui.highBtn:if(App.GuideUtils().currPart==e.GuidePart.currPart21&&2==App.GuideUtils().currStep){var a=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(a,a.parent,e.GuidePart.currPart21,3,!1)}if(this.currentFeatherNum<this.needFeatherNums&&!this.ui.checkBoxBtn_1.selected)return void e.ItemNotEnoughController.getInstance().showPanel(this.featherVO.id);if(this.ui.checkBoxBtn_1.selected&&this.currentGemNums<50&&this.currentFeatherNum<this.needFeatherNums)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");this.ui.checkBoxBtn_0.selected&&(this.isExpCriticals=1);var o=HawkProtocolManager.newBuilder("JsProto.HPWingLvlUpReq");o.setRoleId(this.roleWingInfo.getRoleId()),o.setType(2),o.setAutoConvert(this.ui.checkBoxBtn_1.selected),o.setAutoLvlUp(this.ui.checkBoxBtn_0.selected),e.Message.instance.send(e.Code.WING_LEVEL_UP_C,o,!0);break;case this.ui.activateBtn:if(27==App.GuideUtils().currdbz&&2==App.GuideUtils().currxbz){var a=StageFrameControl.instance.getBackBtn();e.MainControler.instance.guidechange(a,a.parent,27,3,!0)}case this.ui.upLvelBtn:if(this.wingVO.id>=e.WingService.instance.maxId)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("WINGZUIDAJIESHU"));var s=HawkProtocolManager.newBuilder("JsProto.HPWingEvolutionReq");s.setRoleId(this.roleWingInfo.getRoleId()),e.Message.instance.send(e.Code.WING_EVOLUTION_C,s,!0);break;case this.ui.upWingBtn:if(!this.isActive)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("WINGWEIJIHUO"));var r=e.PlayerService.instance.getRoleDataList(),l=r.indexOf(this.roleData);e.WingController.getInstance().showWingStarPanel(l);break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("WINGSADVANCEDHELP");break;case this.ui.checkBoxBtn_0:App.GuideUtils().currPart==e.GuidePart.currPart21&&1==App.GuideUtils().currStep&&e.MainControler.instance.guidechange(this.ui.highBtn,this.ui.highBtn.parent,e.GuidePart.currPart21,2,!1,this.getScale())}},i.prototype.activateState=function(e){this.ui.activateBtn.visible=e},i.prototype.normalState=function(e){this.ui.buttonGroup.visible=e},i.prototype.moveForwardState=function(e){this.ui.upLvelBtn.visible=e},i.prototype.dispose=function(){e.Message.instance.remove(e.Code.WING_EVOLUTION_S,this),e.Message.instance.remove(e.Code.WING_LEVEL_UP_S,this),this.ui.normalBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.highBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.activateBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.upLvelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.upWingBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this)},i.prototype.destoryAvatarAni=function(){this.isAvatarPlay=!1,egret.Tween.removeTweens(this.ui.wingIcon)},i.prototype.playCriticalMovie=function(t){var i=new e.WingUpAnimation;i.init(t),i.x=.5*ScreenAdaptation.instance.uiWidth,i.y=.5*ScreenAdaptation.instance.uiHeight-100,i.scaleX=i.scaleY=0,i.anchorOffsetX=.5*i.width,i.anchorOffsetY=.5*i.height,this.ui.baojiEffectGroup.y=i.y,e.Global.uiLayer.addChild(i),e.Global.uiLayer.addChild(this.ui.baojiEffectGroup),TweenMax.to(i,.15,{scaleX:1,scaleY:1,onComplete:function(){TweenMax.to(i,.45,{onComplete:function(){TweenMax.to(i,.725,{y:.5*ScreenAdaptation.instance.uiHeight-200,onComplete:function(){TweenMax.to(i,.25,{alpha:0,onComplete:function(){TweenMax.killTweensOf(i),null!=i.parent&&i.parent.removeChild(i),i=null}})}})}})}})},i.prototype.playEffect=function(t){var i=this;this.baojiEffectAni&&(this.baojiEffectAni.clear(),this.baojiEffectAni=null),this.baojiEffectAni=new e.FoxAni(this.ui.baojiEffectGroup),8>t?this.baojiEffectAni.play("baojiEffect2-8","ani",1):this.baojiEffectAni.play("baojiEffect10","ani",1),TweenMax.delayedCall(.5,function(){i.baojiEffectAni&&(i.baojiEffectAni.clear(),i.baojiEffectAni=null)})},i.prototype.readyDestroy=function(){this.baojiEffectAni&&(this.baojiEffectAni.clear(),this.baojiEffectAni=null),this.starAni&&(this.starAni.clear(),this.starAni=null),this.destoryAvatarAni()},i.prototype.closeHook=function(){this.roleId=0,e.NewJueweiController.getInstance().updateNobilityData(),App.GuideUtils().currPart==e.GuidePart.currPart22&&2==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),App.GuideUtils().currPart==e.GuidePart.currPart21&&3==App.GuideUtils().currStep&&e.MainControler.instance.guidenewReward(),27!=App.GuideUtils().currdbz||2!=App.GuideUtils().currxbz&&3!=App.GuideUtils().currxbz||e.MainControler.instance.guidefun()},i.prototype.playAniJiHuo=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroup.visible=!0,App.SoundManager().playEffect("sound_activate_mp3")},i.prototype.playComplete=function(){this.ui.aniGroup.visible=!1},i.prototype.recvMsg=function(t,i){if(this.getIsInit())if(t==e.MsgCMD.UP_WING_STAR_INFO)this.initData();else if(t==e.Code.WING_EVOLUTION_S)1==i.id?this.playAniJiHuo():this.playAniJiHuo(),e.WingService.instance.upWingInfo(i.roleId,{id:i.id,level:i.level,exp:i.exp}),this.initData(),e.ActivityController.getIntance().checkWingJinJie();else if(t==e.Code.WING_LEVEL_UP_S){if(this.addExpText(i),i.hasOwnProperty("expCriticals")&&i.expCriticals.length&&i.expCriticals[0].criRate>1&&0==this.ui.checkBoxBtn_0.selected)this.playCriticalMovie(i.expCriticals[0].criRate),this.playEffect(i.expCriticals[0].criRate);else if(this.isExpCriticals){for(var n=i.getExpCriticals(),o={2:0,4:0,6:0,8:0,10:0},a=0,s=n.length,r=0,l=null;s>a;a++)l=n[a],o[l.criRate]=l.criTimes,r+=~~(l.exp*~~l.criTimes);var h=e.LanguageUtils.instance.getValue("PEIYANGBAOJI_TIP",o[10],o[8],o[6],o[4],o[2],r);e.PopUpController.getInstance().showTextPanel(h,null,null,null,null,null,null,null,20,!0,!1)}this.isExpCriticals=0,e.WingService.instance.upWingInfo(i.roleId,{level:i.level,exp:i.exp}),this.initData()}else if(t==e.MsgCMD.REFRESH_PLAYERDATA){if(!this.getIsShow())return;this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1)}},i.prototype.addExpText=function(t){if(t.getExpCriticals().length<=0)return void Log.trace("数据错误："+t);var i=e.LanguageUtils.instance.getValue("AWD_WING_EXP");t.hasOwnProperty("expCriticals")&&t.getExpCriticals().length&&t.getExpCriticals()[0].getCriRate()>1&&(i=e.LanguageUtils.instance.getValue("AWD_WING_CRITEXP")),i+=t.getExpCriticals()[0].getExp(),e.PopUpController.getInstance().showFloatTextPanel1(i)},i.prototype.getWingTemp=function(){return null==this.wingTemp&&(this.wingTemp=e.WingService.instance.getWingUpCfg()),this.wingTemp},i.prototype.clickskip=function(t){switch(t.target){case this.ui.chibang:break;case this.ui.yaoji:e.SkipCodeDataHandler.getInstance().skipTo(e.NameCode.YAOJI),this.close()}},i.prototype.setwingpoint=function(){e.PlayerService.instance.playerInfo.getLevel()>=Number(e.GlobalConfig.instance.getValue("BEAUTY_OPEN_LEVEL"))&&(this.ui.redPoint6.visible=e.BeautyController.getInstance().redpoint(),this.ui.redPoint5.visible=e.WingController.getInstance().getOperate())},i}(e.BasePanel);e.WingPanel=t,__reflect(t.prototype,"foxgame.WingPanel",["foxgame.IMessage","foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.minValue=0,t.maxValue=100,t.skinName="WingProgress_upStar",t}return __extends(t,e),t.prototype.setProgress=function(e){this.labelDisplay.text=e.toString()+"/"+this.maxValue.toString(),e>this.maxValue?this.thumb.scaleX=1:this.thumb.scaleX=e/this.maxValue},t.prototype.setDiffProgress=function(e){this.labelDisplay.text=e.toString()+"/0",this.thumb.scaleX=1},t}(eui.Component);e.WingProgressUpStar=t,__reflect(t.prototype,"foxgame.WingProgressUpStar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/wingSystem/WingUpStar.exml")||this;return i.canClickArr=null,i.model=e,i.setIsShowTween(!1),i.isMask=!1,i.adaptionType=1,i}return __extends(i,t),i.prototype.playAni=function(){this.intensifyAni&&(this.intensifyAni.clear(),this.intensifyAni=null),this.intensifyAni=new e.FoxAni(this.ui.aniGroup),this.intensifyAni.setPlayComplete(this.playComplete,this),this.intensifyAni.play("chenggongFX","ani",1),this.ui.aniGroup.visible=!0,App.SoundManager().playEffect("sound_activate_mp3")},i.prototype.playComplete=function(){this.ui.aniGroup.visible=!1},i.prototype.bagItemChanged=function(){this.initData()},i.prototype.initParams=function(){this.ui.checkBoxBtn.selected=!1,this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList()),this.ui.headBar.setSelect(this.model.roleIndex)},i.prototype.initHook=function(){e.BagController.getInstance().registerObserver(this),this.canClickArr=[0,0],this.initUI(),this.initListener(),this.doScreenAdaptation(),this.ui.tips.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("WING_EXPALIN_2"))},i.prototype.setRoleData=function(e){this.roleData=e,this.roleId!=this.roleData.roleId&&(this.roleId=this.roleData.roleId,this.initData())},i.prototype.initData=function(){this.ui.currency.refresh();var t=e.PlayerService.instance.playerInfo;if(this.currentGemNums=t.getGold(),this.roleWingInfo=e.WingService.instance.getWingInfo(this.roleId),0==this.roleWingInfo.getId())return e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WINGWEIJIHUOQINGJIHUO")),void this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1);this.leftStarLevel=this.roleWingInfo.getLeftStar(),this.rightStarLevel=this.roleWingInfo.getRightStar(),this.wingModelId=e.WingService.instance.getWingModelId(this.roleId),this.wingInfo=e.WingService.instance.getWingUpCfg()[this.roleWingInfo.getId()+"_"+this.roleWingInfo.getLevel()],this.currentFeatherNum=e.BagController.getInstance().getCountByItemId(this.wingInfo.advncedCost.id);var i=e.JsonDataManager.instance.itemTemplate;this.featherVO=i[this.wingInfo.advncedCost.id],this.showInfo()},i.prototype.showInfo=function(){this.ui.wingName.text=this.wingInfo.name,this.ui.wingIcon.source="wings"+this.wingModelId+"_png",this.ui.jie_0.text=e.LanguageUtils.instance.getValue("ZUOYICENGSHU",~~(this.leftStarLevel/6+"")+1),this.ui.jie_1.text=e.LanguageUtils.instance.getValue("YOUYICENGSHU",~~(this.rightStarLevel/6+"")+1),0==this.leftStarLevel?this.ui.leftStars.setAllStarState(0,!1):this.ui.leftStars.setAllStarState((this.leftStarLevel+1)%6==0?5:this.leftStarLevel%6,!1),0==this.rightStarLevel?this.ui.rightStars.setAllStarState(0,!0):this.ui.rightStars.setAllStarState((this.rightStarLevel+1)%6==0?5:this.rightStarLevel%6,!0);var t,i,n=this.wingStarCfg[this.leftStarLevel+1],o=0;null==n&&(n=this.wingStarCfg[this.leftStarLevel],o=1),t=n.leftTypeList,i=n.leftValueList,this.leftNeedFeatherNums=n.cost.value;var a=0,s=this.wingStarCfg[this.leftStarLevel].leftTypeList,r=this.wingStarCfg[this.leftStarLevel].leftValueList;a=s.length;for(var l=0;a>l;l++){var h=this.systemRelationCfg[s[l]];this.ui["leftP_"+l].text=e.LanguageUtils.instance.getValue("ATT_"+h.relation)+e.LanguageUtils.instance.getValue("JIACHENG")+":",this.ui["leftV_"+l].text=h.numType==e.AttDefNumType.INT?r[l]:r[l]/100+"%"}a=t.length;for(var l=0;a>l;l++){var c=this.systemRelationCfg[t[l]];this.ui["leftNextP_"+l].text=e.LanguageUtils.instance.getValue("ATT_"+c.relation)+e.LanguageUtils.instance.getValue("JIACHENG")+":",this.ui["leftNextV_"+l].text=o?e.LanguageUtils.instance.getValue("YIMANJI"):c.numType==e.AttDefNumType.INT?i[l]:i[l]/100+"%"}n=this.wingStarCfg[this.rightStarLevel+1],o=0;var u,p;null==n&&(n=this.wingStarCfg[this.rightStarLevel],o=1),u=n.rightTypeList,p=n.rightValueList,this.rightNeedFeatherNums=n.cost.value,this.ui.featherNums0&&(this.ui.featherNums0.text=this.currentFeatherNum+"/"+this.leftNeedFeatherNums),this.ui.featherNums1&&(this.ui.featherNums1.text=this.currentFeatherNum+"/"+this.rightNeedFeatherNums);var g=this.wingStarCfg[this.rightStarLevel].rightTypeList,d=this.wingStarCfg[this.rightStarLevel].rightValueList;a=g.length;for(var l=0;a>l;l++){var f=this.systemRelationCfg[g[l]];this.ui["rightP_"+l].text=e.LanguageUtils.instance.getValue("ATT_"+f.relation)+e.LanguageUtils.instance.getValue("JIACHENG")+":",this.ui["rightV_"+l].text=f.numType==e.AttDefNumType.INT?d[l]:d[l]/100+"%"}a=u.length;for(var l=0;a>l;l++){var m=this.systemRelationCfg[u[l]];this.ui["rightNextP_"+l].text=e.LanguageUtils.instance.getValue("ATT_"+m.relation)+e.LanguageUtils.instance.getValue("JIACHENG")+":",this.ui["rightNextV_"+l].text=o?e.LanguageUtils.instance.getValue("YIMANJI"):m.numType==e.AttDefNumType.INT?p[l]:p[l]/100+"%"}},i.prototype.initUI=function(){this.ui.headBar.setBackFun(this.setRoleData.bind(this)),this.wingStarCfg=e.WingService.instance.getWingUpStarCfg(),this.systemRelationCfg=e.WingService.instance.getSystemRelationCfg()},i.prototype.initListener=function(){e.Message.instance.add(e.Code.WING_STAR_UP_S,this),e.Message.instance.add(e.MsgCMD.REFRESH_PLAYERDATA,this),this.ui.leftUpStarBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.rightUpStarBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this)},i.prototype.btClick=function(t){var i=this;switch(t.target){case this.ui.leftUpStarBtn:if(this.canClickArr[0])return;this.canClickArr[0]=1;var n=egret.setTimeout(function(){i.canClickArr[0]=0,egret.clearTimeout(n),n=null},this,500),o=this.wingStarCfg[this.leftStarLevel+1];if(!o)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("ZUOYIMANJI"));var a=this.leftNeedFeatherNums-this.currentFeatherNum;if(this.currentFeatherNum<this.leftNeedFeatherNums){if(!this.ui.checkBoxBtn.selected)return e.ItemNotEnoughController.getInstance().showPanel(this.featherVO.id),void this.close();if(!(this.currentGemNums>=a*Number(e.GlobalConfig.instance.getValue("FEATHER_PRICE"))))return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}if(this.roleWingInfo.getId()<e.WingService.instance.minimumLevel)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("WINGJINJIEDAO4SHENGXING"));if(this.roleWingInfo.getId()<e.WingService.instance.getUpStarLevel(this.leftStarLevel+1)){var s=this.roleWingInfo.getId()+1,r=e.LanguageUtils.instance.getValue("WINGDENGJIBUZU",s.toString());return void e.PopUpController.getInstance().showFloatTextPanel1(r)}var l=HawkProtocolManager.newBuilder("JsProto.HPWingStarUpReq");l.setRoleId(this.roleWingInfo.getRoleId()),l.setPos(1),l.setAutoConvert(this.ui.checkBoxBtn.selected),e.Message.instance.send(e.Code.WING_STAR_UP_C,l,!0);break;case this.ui.rightUpStarBtn:if(this.canClickArr[1])return;this.canClickArr[1]=1;var h=egret.setTimeout(function(){i.canClickArr[1]=0,egret.clearTimeout(h),h=null},this,500),o=this.wingStarCfg[this.rightStarLevel+1];if(!o)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("YOUYIMANJI"));var c=this.rightNeedFeatherNums-this.currentFeatherNum;if(this.currentFeatherNum<this.rightNeedFeatherNums){if(!this.ui.checkBoxBtn.selected)return e.ItemNotEnoughController.getInstance().showPanel(this.featherVO.id),void this.close();if(!(this.currentGemNums>=c*Number(e.GlobalConfig.instance.getValue("FEATHER_PRICE"))))return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}if(this.roleWingInfo.getId()<e.WingService.instance.minimumLevel)return void e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("WINGJINJIEDAO4SHENGXING"));if(this.roleWingInfo.getId()<e.WingService.instance.getUpStarLevel(this.rightStarLevel+1)){var s=this.roleWingInfo.getId()+1,r=e.LanguageUtils.instance.getValue("WINGDENGJIBUZU",s.toString());return void e.PopUpController.getInstance().showFloatTextPanel1(r)}var l=HawkProtocolManager.newBuilder("JsProto.HPWingStarUpReq");l.setRoleId(this.roleWingInfo.getRoleId()),l.setPos(2),l.setAutoConvert(this.ui.checkBoxBtn.selected),e.Message.instance.send(e.Code.WING_STAR_UP_C,l,!0);break;case this.ui.helpBtn:e.HelpController.getInstance().showPanel("WINGSLIFTSTARSHELP");break;case this.ui.closeBtn:this.close(),e.WingController.getInstance().showWingPanel(),e.NewJueweiController.getInstance().updateNobilityData()}},i.prototype.dispose=function(){e.Message.instance.remove(e.Code.WING_STAR_UP_S,this),this.ui.leftUpStarBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.rightUpStarBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.checkBoxBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this),this.ui.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btClick,this)},i.prototype.closeHook=function(){t.prototype.closeHook.call(this),e.NewJueweiController.getInstance().updateNobilityData(),this.roleId=0,e.Message.instance.send(e.MsgCMD.UP_WING_STAR_INFO)},i.prototype.recvMsg=function(t,i){0!=this.getIsInit()&&(t==e.Code.WING_STAR_UP_S?(this.playAni(),1==i.pos?e.WingService.instance.upWingInfo(i.roleId,{leftStar:i.star}):e.WingService.instance.upWingInfo(i.roleId,{rightStar:i.star}),this.initData()):t==e.MsgCMD.REFRESH_PLAYERDATA&&this.ui.headBar.setRoles(e.PlayerService.instance.getRoleDataList(),!0,!1))},i}(e.BasePanel);e.WingStarPanel=t,__reflect(t.prototype,"foxgame.WingStarPanel",["foxgame.IMessage","foxgame.IBag","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="WingUpAnimationSkin",t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(t,e),t.prototype.init=function(e){var t="expCritical"+e+"_png";this.numIcon.source=t},t}(e.ViewControler);e.WingUpAnimation=t,__reflect(t.prototype,"foxgame.WingUpAnimation")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.inited=!1,e.rank=-1,e.skinName="WorldBossAwardItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.itemList=[this.item0,this.item1,this.item2,this.item3];for(var e,i=this.itemList.length,n=0;i>n;n++)e=this.itemList[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);this.setItem(this.rank)},i.prototype.setItem=function(t){if(this.rank=t,!(this.rank<=0)&&0!=this.inited){this.rank=this.rank>3?4:this.rank,this.firstImg.visible=1==t,this.secondImg.visible=2==t,this.thirdImg.visible=3==t,this.otherGroup.visible=t>3;for(var i,n,o=e.JsonDataManager.instance.worldBossAwardTemplate[this.rank],a=this.itemList.length,s=0;a>s;s++)i=this.itemList[s],n=o.awardList[s],null!=n?i.setItem(n.id,n.value):i.setItem(-1)}},i.prototype.itemHandler=function(t){var i=this.itemList.indexOf(t.target),n=e.JsonDataManager.instance.worldBossAwardTemplate[this.rank],o=n.awardList[i];e.TipsController.getInstance().showItemTips(o.id,o.value,!1)},i}(eui.Component);e.WorldBossAwardItem=t,__reflect(t.prototype,"foxgame.WorldBossAwardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/worldboss/WorldBossAwardPanel.exml","worldBossGroup3")||this;return e.setIsTextureCache(!1),e}return __extends(i,t),i.prototype.showPanel=function(e){this.rank=e,this.show()},i.prototype.initHook=function(){for(var e,t=this.getItemList(),i=t.length,n=0;i>n;n++)e=t[n],e.setItem(n+1)},i.prototype.refresh=function(){this.ui.rankLabel.text=this.rank>0?this.rank+"":e.LanguageUtils.instance.getValue("WU")
},i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e},i}(e.BasePanel);e.WorldBossAwardPanel=t,__reflect(t.prototype,"foxgame.WorldBossAwardPanel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.APPEAR=1]="APPEAR",e[e.DISAPPEAR=2]="DISAPPEAR",e[e.RUNAWAY=3]="RUNAWAY",e[e.KILLED=4]="KILLED"}(t=e.WorldBossStatus||(e.WorldBossStatus={}));var i=function(){function t(){this.isBoss=!1,this.fromSceneType=0,this.model=new e.WorldBossModel,this.worldBossPanel=new e.WorldBossPanel(this.model),this.awardPanel=new e.WorldBossAwardPanel,this.resultPanel=new e.WorldBossResultPanel(this.model),this.uiPanel=new e.WorldBossUIPanel(this.model),this.scenePanel=new e.WorldBossScenePanel(this.model)}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.registerMessage=function(t){t.add(e.Code.FETCH_WORLD_BOSS_INFO_S,this),t.add(e.Code.WORLD_BOSS_END_PUSH_S,this),t.add(e.Code.WORLD_BOSS_FIGHT_PUTH_S,this),t.add(e.Code.ENTER_WORLD_BOSS_S,this),t.add(e.Code.LEAVE_WORLD_BOSS_S,this),t.add(e.Code.WORLD_BOSS_INVITE_UNION_MEM_S,this),t.add(e.Code.WORLD_BOSS_TIME_S,this)},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.FETCH_WORLD_BOSS_INFO_S:this.model.setBossInfoList(i.getWorldBossInfo());break;case e.Code.WORLD_BOSS_END_PUSH_S:this.model.setResultInfo(i),this.resultPanel.show(),this.exitWorldBoss(),e.WanFaController.getInstance().refreshRedImg();break;case e.Code.WORLD_BOSS_FIGHT_PUTH_S:this.model.setFightInfo(i);break;case e.Code.ENTER_WORLD_BOSS_S:this.enterBossBack(i);break;case e.Code.LEAVE_WORLD_BOSS_S:this.exitWorldBoss();break;case e.Code.WORLD_BOSS_INVITE_UNION_MEM_S:this.model.inviteCDStartTime=egret.getTimer(),this.model.inviteCD=Number(e.GlobalConfig.instance.getValue("WORLD_BOSS_INVITE_WAIT_TIME"));break;case e.Code.WORLD_BOSS_TIME_S:this.setBossTime(i)}},t.prototype.requestEnter=function(){var t=e.GlobalUtil.checkModuleOpen(e.ModuleOpenId.SHIJIEBOSS),i=e.GlobalUtil.getModuleOpenLevel(e.ModuleOpenId.SHIJIEBOSS);if(0==t)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WORLDBOSSLEVELLIMITPROMPT1",i));var n=e.UnionController.getInstance().getUnionId();if(0>=n)return void e.GameUtils.MSG_TIP(e.LanguageUtils.instance.getValue("WORLDBOSSLEVELLIMITPROMPT2",i));(null==this.model.bossList||0==this.model.bossList.length)&&this.requestBossInfos();var o=HawkProtocolManager.newBuilder("JsProto.EnterWorldBossReq");e.Message.instance.send(e.Code.ENTER_WORLD_BOSS_C,o,!0),this.worldBossPanel.close(),e.WanFaController.getInstance().closePanel()},t.prototype.setBossTime=function(t){t.getOpen()?(this.model.remainTime=t.getRemainingTime(),e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.WORLDBOSS,!0),egret.startTick(this.tick,this)):(this.model.remainTime=-1,e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.WORLDBOSS,!1),egret.stopTick(this.tick,this))},t.prototype.tick=function(t){this.model.lastRemainTime<=0&&(this.model.lastRemainTime=t);var i=t-this.model.lastRemainTime;return 1e3>i?!1:(this.model.lastRemainTime=t,this.model.remainTime-=i,this.model.remainTime<=0&&(e.ActivityBarController.getInstance().setBtnStatus(e.ActivityBtnType.WORLDBOSS,!1),egret.stopTick(this.tick,this)),!0)},t.prototype.enterBossBack=function(t){if(!(t.getErrorNo()>0)){this.model.setMyRoleList(t),this.showScenePanel();e.JsonDataManager.instance.worldBossTemplate[t.getCfgId()];e.UnionController.getInstance().showBossTimePanel(t.getRemainingTime()),e.MainControler.instance.mainOrBattleState(!1),this.fromSceneType=e.MainBottomControler.PageState,e.MapViewportGroupManager.instance.setStopUpdateOldBattle(!0),e.MapViewportGroupManager.instance.setStopUpdateOldMainCity(!0),this.fromSceneType==e.SceneType.MainCity?(e.MapViewportGroupManager.instance.doDestroyOldMainCityMap(),e.MapViewportGroupManager.instance.doDestroyOldMainCityObjects()):this.fromSceneType==e.SceneType.Field&&(e.MapViewportGroupManager.instance.doDestroyOldBattleMap(),e.MapViewportGroupManager.instance.doDestroyOldBattleObjects())}},t.prototype.showOrHidePlayer=function(e){this.scenePanel.showOrHidePlayer(e)},t.prototype.showBossPanel=function(){this.requestBossInfos(),this.worldBossPanel.show()},t.prototype.requestBossInfos=function(){var t=HawkProtocolManager.newBuilder("JsProto.FetchWorldBossInfoReq");e.Message.instance.send(e.Code.FETCH_WORLD_BOSS_INFO_C,t,!0)},t.prototype.showAwardPanel=function(e){this.awardPanel.showPanel(e)},t.prototype.showScenePanel=function(){this.isBoss=!0,this.uiPanel.show(),this.scenePanel.show()},t.prototype.exitWorldBoss=function(){e.MapViewportGroupManager.instance.setStopUpdateOldBattle(!1),e.MapViewportGroupManager.instance.setStopUpdateOldMainCity(!1),this.fromSceneType==e.SceneType.MainCity||this.fromSceneType==e.SceneType.Field&&(e.MapViewportGroupManager.instance.doRestoreOldBattleMap(),e.MapViewportGroupManager.instance.doRestoreOldBattleObjects()),this.isBoss=!1,this.uiPanel.close(),this.scenePanel.close(),e.BossBloodGroup.getInstance().close(),e.UnionController.getInstance().closeBossTimePanel(),e.MainControler.instance.gotoField()},t.prototype.playDamage=function(e){this.scenePanel.playDamage(e)},t.prototype.playHitEffect=function(e){this.scenePanel.playHitEffect(e)},t.prototype.getRemainTime=function(){return this.model.remainTime},t}();e.WorldBossController=i,__reflect(i.prototype,"foxgame.WorldBossController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.NORMAL=0]="NORMAL",e[e.CRITICAL=1]="CRITICAL"}(t=e.WorldBossDamageType||(e.WorldBossDamageType={}));var i=function(e){function i(){var t=e.call(this)||this;return t.isInit=!1,t.skinName="WorldBossDamageItem",t}return __extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.isInit=!0,this.setItem(this.type,this.value)},i.prototype.setItem=function(e,i){this.type=e,this.value=i,0!=this.isInit&&null!=this.type&&(e==t.NORMAL?(this.normalLabel.text=i+"",this.normalLabel.visible=!0,this.baojiGroup.visible=!1):(this.baojiLabel.text=i+"",this.normalLabel.visible=!1,this.baojiGroup.visible=!0))},i}(eui.Component);e.WorldBossDamageItem=i,__reflect(i.prototype,"foxgame.WorldBossDamageItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.inited=!1,e.skinName="WorldBossItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.itemList=[this.itemIcon0,this.itemIcon1,this.itemIcon2,this.itemIcon3],this.awardLabel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.awardLabel.text+"</u>"),this.awardLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.awardHandler,this),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterHandler,this),this.group1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this);for(var e,i=this.itemList.length,n=0;i>n;n++)e=this.itemList[n],e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);this.hpTotalWidth=this.hpBarImg.width,this.setItem(this.bossInfo,this.bossPanel)},i.prototype.setItem=function(t,i){if(this.bossInfo=t,this.bossPanel=i,null!=this.bossInfo&&0!=this.inited){this.vo=e.JsonDataManager.instance.worldBossTemplate[this.bossInfo.getId()],this.bossVO=e.JsonDataManager.instance.monster[this.bossInfo.getBossId()],this.headImg.source=this.bossVO.iconPath,this.fleeImg.visible=this.bossInfo.getBossState()==e.WorldBossStatus.RUNAWAY,this.appearImg.visible=this.bossInfo.getBossState()==e.WorldBossStatus.APPEAR,this.disappearImg.visible=this.bossInfo.getBossState()==e.WorldBossStatus.DISAPPEAR,this.killedImg.visible=this.bossInfo.getBossState()==e.WorldBossStatus.KILLED,this.enterBtn.visible=this.bossInfo.getBossState()==e.WorldBossStatus.APPEAR,this.nameLabel.text=this.bossVO.name,this.timeLabel.text=this.vo.startTime.substr(0,5)+"-"+this.vo.endTime.substr(0,5);var n=Number(this.bossInfo.getCurrBossHp());this.setExpend(!1),this.bossInfo.getBossState()==e.WorldBossStatus.APPEAR?(this.hpBarImg.width=n/this.bossVO.hp*this.hpTotalWidth,this.hpLabel.text=Math.floor(n/this.bossVO.hp*100)+"%",this.setExpend(!0)):this.bossInfo.getBossState()==e.WorldBossStatus.DISAPPEAR?(this.hpBarImg.width=this.hpTotalWidth,this.hpLabel.text="100%"):(this.hpBarImg.width=0,this.hpLabel.text="0%");for(var o,a,s=this.itemList.length,r=e.JsonDataManager.instance.worldBossAwardTemplate[this.bossInfo.getId()],l=0;s>l;l++)o=r.awardList[l],a=this.itemList[l],null!=o?a.setItem(o.id,o.value):a.setItem(-1)}},i.prototype.setExpend=function(e){this.group2.visible=e,this.height=e?this.group2.height:this.group1.height},i.prototype.itemHandler=function(t){var i=t.target,n=this.itemList.indexOf(i),o=e.JsonDataManager.instance.worldBossAwardTemplate[this.bossInfo.getId()],a=o.awardList[n];e.TipsController.getInstance().showItemTips(a.id,a.value,!1)},i.prototype.awardHandler=function(t){e.WorldBossController.getInstance().showAwardPanel(this.bossInfo.getUnionHarmRank())},i.prototype.enterHandler=function(t){e.WorldBossController.getInstance().requestEnter()},i.prototype.clickHandler=function(e){this.bossPanel.selectItem(this)},i}(eui.Component);e.WorldBossItem=t,__reflect(t.prototype,"foxgame.WorldBossItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.myRoleList=[],this.otherRoleList=[],this.otherDamageList=[],this.inviteCD=0,this.inviteCDStartTime=-1,this.remainTime=-1,this.lastRemainTime=-1,this.observerList=[]}return t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.setBossInfoList=function(e){this.bossList=e,this.updateView()},t.prototype.setResultInfo=function(e){this.resultInfo=e,this.updateView()},t.prototype.setFightInfo=function(e){this.fightInfo=e,this.otherRoleList=this.fightInfo.getOtherPlayerInfo(),this.otherDamageList=this.fightInfo.getHarms(),this.updateView()},t.prototype.setMyRoleList=function(e){0==e.getErrorNo()&&(this.myRoleList=e.getMyRolesInfo(),this.myDamage=e.getHarmInfo(),this.updateView())},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.update()},t.prototype.getDamage=function(t,i){var n,o,a;if(t==e.PlayerService.instance.playerInfo.getPlayerId()){o=this.myDamage.getRoleHarms(),n=o.length;for(var s=0;n>s;s++){if(a=o[s],i==a.getItemId())return a.getHarmValue();if((null==i||0>=i)&&0==a.getItemId())return a.getHarmValue()}}else{var r=void 0;n=this.otherDamageList.length;for(var s=0;n>s;s++)if(r=this.otherDamageList[s],r.getPlayerId()==t){o=r.getRoleHarms();for(var l=0;l<o.length;l++){if(a=o[l],i==a.getItemId())return a.getHarmValue();if((null==i||0>=i)&&0==a.getItemId())return a.getHarmValue()}}}return-1},t}();e.WorldBossModel=t,__reflect(t.prototype,"foxgame.WorldBossModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/worldboss/WorldBossPanel.exml","worldBossGroup1")||this;return i.setIsTextureCache(!1),i.model=e,i.model.registerObserver(i),i.setIsTextureCache(!1),i.isMask=!1,i.isMaskdown=!0,i.adaptionType=1,i.pool=[],i}return __extends(i,t),i.prototype.refresh=function(){if(this.ui.currency.refresh(),null!=this.model.bossList){for(var e=this.ui.container;e.numChildren>0;)this.restoreItem(e.getChildAt(0));for(var t,i=[],n=0;n<this.model.bossList.length;n++)t=this.getItem(),i.push(t),t.setItem(this.model.bossList[n],this),t.setExpend(0==n),t.y=0==n?0:e.getChildAt(n-1).y+e.getChildAt(n-1).height,e.addChild(t)}},i.prototype.update=function(){this.refresh()},i.prototype.selectItem=function(e){for(var t,i=this.ui.container,n=0;n<i.numChildren;n++)t=i.getChildAt(n),t.setExpend(t==e),t.y=0==n?0:i.getChildAt(n-1).y+i.getChildAt(n-1).height},i.prototype.getItem=function(){return this.pool.length>0?this.pool.pop():new e.WorldBossItem},i.prototype.restoreItem=function(e){null!=e.parent&&e.parent.removeChild(e),this.pool.push(e)},i}(e.BasePanel);e.WorldBossPanel=t,__reflect(t.prototype,"foxgame.WorldBossPanel",["foxgame.IWorldBoss","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/worldboss/WorldBossResultPanel.exml","worldBossGroup2")||this;return i.setRegisterTick(!0),i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){for(var t,i=this.getItemList(),n=i.length,o=0;n>o;o++)t=i[o],t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemHandler,this);this.ui.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.totalTime=Number(e.GlobalConfig.instance.getValue("WORLD_BOSS_RESULTTIME"))},i.prototype.initParams=function(){this.startTime=egret.getTimer()},i.prototype.refresh=function(){var t=this.model.resultInfo;if(null!=t){var i=e.JsonDataManager.instance.monster[t.getBossId()];this.ui.headImg.source=i.iconPath,this.ui.fleeImg.visible=t.getBossState()==e.WorldBossStatus.RUNAWAY,this.ui.appearImg.visible=t.getBossState()==e.WorldBossStatus.APPEAR,this.ui.disappearImg.visible=t.getBossState()==e.WorldBossStatus.DISAPPEAR,this.ui.killedImg.visible=t.getBossState()==e.WorldBossStatus.KILLED,this.ui.rankLabel.text=t.getUnionHarmRank()+"",this.ui.countLabel.text=t.getUnionMemJoinNum()+"",this.ui.nameLabel.text=t.getBestMemberName();for(var n,o,a=t.getUnionHarmRank()>3?4:t.getUnionHarmRank(),s=e.JsonDataManager.instance.worldBossAwardTemplate[a],r=this.getItemList(),l=r.length,h=0;l>h;h++)n=r[h],o=s.awardList[h],null!=o?n.setItem(o.id,o.value):n.setItem(-1)}},i.prototype.update=function(){this.refresh()},i.prototype.tickHook=function(t){var i=Math.floor((t-this.startTime)/1e3),n=this.totalTime-i;this.ui.confirmBtn.label=e.LanguageUtils.instance.getValue("QUEDING")+"("+n+")",0>=n&&this.close()},i.prototype.itemHandler=function(t){var i=this.getItemList(),n=i.indexOf(t.target),o=this.model.resultInfo.getUnionHarmRank()>3?4:this.model.resultInfo.getUnionHarmRank(),a=e.JsonDataManager.instance.worldBossAwardTemplate[o],s=a.awardList[n];e.TipsController.getInstance().showItemTips(s.id,s.value,!1)},i.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e.push(this.ui.item3),e},i}(e.BasePanel);e.WorldBossResultPanel=t,__reflect(t.prototype,"foxgame.WorldBossResultPanel",["foxgame.IWorldBoss","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){}(t=e.WorldBossRoleAction||(e.WorldBossRoleAction={}));var i=function(t){function i(e,i){var n=t.call(this)||this;return n.inited=!1,n.lastSkilltime=-1,n.roleItemId=-1,n.monsterId=-1,n.curSkillIndex=0,n.frameRate1=8,n.actionType=0,n.isBoss=!1,n.speed=200,n.lastWalkTime=-1,n.skinName="WorldBossRole",n.model=e,n.scene=i,n.touchEnabled=!1,n.touchChildren=!1,n}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.setInfo(this.roleInfo,this.roleItemId,this.equipIdList,this.monsterId,this.wingId,this.direction,this.startPos),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this)},i.prototype.setInfo=function(e,t,i,n,o,a,s){if(this.roleInfo=e,this.roleItemId=t,this.equipIdList=i,this.monsterId=n,this.wingId=o,this.startPos=s,this.direction=a,this.parent&&0!=this.inited&&(-1!=this.roleItemId||-1!=this.monsterId))if(this.isBoss)this.changeAction(2,4);else{var r=new egret.Point(this.parent.x,this.parent.y),l=egret.Point.distance(r,this.startPos);this.walkTime=l/(this.speed/1e3),this.speedX=(r.x-this.startPos.x)/this.walkTime,this.speedY=(r.y-this.startPos.y)/this.walkTime,this.x+=this.startPos.x-r.x,this.y+=this.startPos.y-r.y,this.changeAction(1,a)}},i.prototype.play=function(){if(null!=this.roleInfo){var t=void 0,i=this.roleInfo.getMaxHp();this.hpLabel.text=i>0?i+"/"+i:"",t=this.hpLabel.y,this.nameLabel.text=this.roleInfo.getName(),this.nameLabel.y=t-this.nameLabel.height,t=this.nameLabel.y;var n=this.roleInfo.getUnionName();this.unionLabel.text=null!=n&&""!=n?n:"",this.unionLabel.y=t-this.unionLabel.height,t=this.unionLabel.y,this.setTitle(this.roleInfo.getTitleId())}var o,a=-1,s=-1;if(this.equipIdList&&this.equipIdList.length>0)for(var r=0;r<this.equipIdList.length;r++)o=e.JsonDataManager.instance.equipTemplate[this.equipIdList[r]],o.partList[0]==e.EquipPartType.WEAPON?a=this.equipIdList[r]:o.partList[0]==e.EquipPartType.CLOTHES&&(s=this.equipIdList[r]);this.monsterId=this.monsterId>0?this.monsterId:-1;var l,h;if(s>0?(this.clothGroup=egret.getTimer()+"cloth",h=e.JsonDataManager.instance.roleTemplate[this.roleItemId],this.profession=h.profession,o=e.JsonDataManager.instance.equipTemplate[s],l=o.getModelId(h.sex),this.clothModelVO=e.JsonDataManager.instance.modelTemplate[l]):this.roleItemId>0&&(this.clothGroup=egret.getTimer()+"cloth",h=e.JsonDataManager.instance.roleTemplate[this.roleItemId],this.profession=h.profession,this.clothModelVO=e.JsonDataManager.instance.modelTemplate[h.defaultModel]),null!=this.clothModelVO&&(RES.createGroup(this.clothGroup,[this.clothModelVO.name+"_"+this.direction+"_png",this.clothModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.clothGroup,this.loadRoleComplete,null,this)),this.monsterId>0){this.monsterGroup=egret.getTimer()+"monster";var c=e.JsonDataManager.instance.monster[this.monsterId];this.monsterModelVO=e.JsonDataManager.instance.modelTemplate[c.modelId],this.infoGroup.visible=0==c.isBoss,RES.createGroup(this.monsterGroup,[this.monsterModelVO.name+"_"+this.direction+"_png",this.monsterModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.monsterGroup,this.loadMonsterComplete,null,this)}if(a>0&&(this.weaponGroup=egret.getTimer()+"weapon",o=e.JsonDataManager.instance.equipTemplate[a],this.weaponModelVO=e.JsonDataManager.instance.modelTemplate[o.modelIdList[0]],RES.createGroup(this.weaponGroup,[this.weaponModelVO.name+"_"+this.direction+"_png",this.weaponModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.weaponGroup,this.loadWeaponComplete,null,this)),null!=this.wingId&&""!=this.wingId){var u=e.JsonDataManager.instance.wingTemplate[this.wingId];null!=u&&(this.wingGroup=egret.getTimer()+"wing",this.wingModelVO=e.JsonDataManager.instance.modelTemplate[u.model],RES.createGroup(this.wingGroup,[this.wingModelVO.name+"_"+this.direction+"_png",this.wingModelVO.name+"_"+this.direction+"_json"]),App.getResourceUtils().loadGroup(this.wingGroup,this.loadWingComplete,null,this))}this.profession==e.ProfessionType.PROFESSION1?this.skillList=[1105,1104,1102,1101,1101,1104,1102,1101,1101]:this.profession==e.ProfessionType.PROFESSION2?this.skillList=[1205,1204,1203,1202,1201,1204,1202,1201,1203]:this.profession==e.ProfessionType.PROFESSION3&&(this.skillList=[1303,1302,1301,1301,1302,1301,1301,1302,1301]),2==this.actionType&&this.playSkill()},i.prototype.setTitle=function(t){var i=e.JsonDataManager.instance.medalTemplate[t];null!=i&&(null!=i.animation?(null!=this.titleBmp&&null!=this.titleBmp.parent&&this.titleBmp.parent.removeChild(this.titleBmp),this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleAnim=new e.FoxAni(this.titleGroup),this.titleAnim.frameRate=6,this.titleAnim.play(i.animation,"ani",-1)):null!=i.icon1&&(null!=this.titleAnim&&(this.titleAnim.clear(),this.titleAnim=null),this.titleBmp=new egret.Bitmap,this.titleGroup.addChild(this.titleBmp),App.getResourceUtils().getResAsync(i.icon1+"_png",this.setTitleImg,this)))},i.prototype.setTitleImg=function(e){this.titleBmp.$bitmapData=e.bitmapData,this.titleBmp.x=-e.textureWidth>>1,this.titleBmp.y=-e.textureHeight>>1},i.prototype.changeAction=function(e,t){this.actionType=e,this.direction=t,this.play()},i.prototype.playSkill=function(){if(null!=this.skillList&&0!=this.skillList.length){-1==this.lastSkilltime&&(this.lastSkilltime=egret.getTimer()),null!=this.skillGroup&&RES.destroyRes(this.skillGroup,!1),null!=this.skillMC&&(this.skillMC.removeEventListener(egret.Event.COMPLETE,this.skillPlayComplete,this),this.skillMC.parent.removeChild(this.skillMC),this.skillMC.stop(),this.skillMC=null);var t,i=this.skillList[this.curSkillIndex],n=e.JsonDataManager.instance.skillEffectTemplate[i],o=n.castEffect;t=o>=1e4?e.JsonDataManager.instance.effectTemplate[o+this.direction]:e.JsonDataManager.instance.effectTemplate[o],null!=t&&(this.skillGroup=egret.getTimer()+"skill",RES.createGroup(this.skillGroup,[t.prefix+"_png",t.prefix+"_json"]),App.getResourceUtils().loadGroup(this.skillGroup,this.loadSkillComplete,null,this),this.curSkillIndex++,this.curSkillIndex>=this.skillList.length&&(this.curSkillIndex=0))}},i.prototype.loadRoleComplete=function(t){if(t==this.clothGroup){null!=this.clothMC&&(this.clothMC.parent.removeChild(this.clothMC),this.clothMC.stop());var i,n=RES.getRes(this.clothModelVO.name+"_"+this.direction+"_json"),o=RES.getRes(this.clothModelVO.name+"_"+this.direction+"_png"),a=new egret.MovieClipDataFactory(n,o);1==this.actionType?i=3:this.profession==e.ProfessionType.PROFESSION1?i=4:this.profession==e.ProfessionType.PROFESSION2?i=5:this.profession==e.ProfessionType.PROFESSION3&&(i=5),this.clothMC=new egret.MovieClip(a.generateMovieClipData(this.clothModelVO.name+"_"+this.direction+"_"+i)),this.roleContainer.addChild(this.clothMC),this.clothMC.frameRate=this.frameRate1,this.clothMC.gotoAndPlay(1,-1),null!=this.weaponMC&&this.weaponMC.gotoAndPlay(1,-1),null!=this.wingMC&&this.wingMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(a)}},i.prototype.loadWeaponComplete=function(t){if(this.weaponGroup==t){null!=this.weaponMC&&(this.weaponMC.parent.removeChild(this.weaponMC),this.weaponMC.stop());var i,n=RES.getRes(this.weaponModelVO.name+"_"+this.direction+"_json"),o=RES.getRes(this.weaponModelVO.name+"_"+this.direction+"_png"),a=new egret.MovieClipDataFactory(n,o);1==this.actionType?i=3:this.profession==e.ProfessionType.PROFESSION1?i=5:this.profession==e.ProfessionType.PROFESSION2?i=4:this.profession==e.ProfessionType.PROFESSION3&&(i=4),this.weaponMC=new egret.MovieClip(a.generateMovieClipData(this.weaponModelVO.name+"_"+this.direction+"_"+i)),this.weaponMC.y=-20,this.weaponContainer.addChild(this.weaponMC),this.weaponMC.frameRate=this.frameRate1,this.weaponMC.gotoAndPlay(1,-1),null!=this.clothMC&&this.clothMC.gotoAndPlay(1,-1),null!=this.wingMC&&this.wingMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(a)}},i.prototype.loadMonsterComplete=function(t){if(this.monsterGroup==t){null!=this.monsterMC&&(this.monsterMC.parent.removeChild(this.monsterMC),this.monsterMC.stop());var i=RES.getRes(this.monsterModelVO.name+"_"+this.direction+"_json"),n=RES.getRes(this.monsterModelVO.name+"_"+this.direction+"_png"),o=new egret.MovieClipDataFactory(i,n);this.monsterMC=new egret.MovieClip(o.generateMovieClipData(this.monsterModelVO.name+"_"+this.direction+"_4")),this.roleContainer.addChild(this.monsterMC),this.monsterMC.frameRate=6,this.monsterMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(o)}},i.prototype.loadWingComplete=function(t){if(this.wingGroup==t){null!=this.wingMC&&(this.wingMC.parent.removeChild(this.wingMC),this.wingMC.stop());var i=RES.getRes(this.wingModelVO.name+"_"+this.direction+"_json"),n=RES.getRes(this.wingModelVO.name+"_"+this.direction+"_png"),o=new egret.MovieClipDataFactory(i,n),a=1==this.actionType?3:4;this.wingMC=new egret.MovieClip(o.generateMovieClipData(this.wingModelVO.name+"_"+this.direction+"_"+a)),this.wingContainer.addChild(this.wingMC),this.wingMC.frameRate=this.frameRate1,this.wingMC.gotoAndPlay(1,-1),null!=this.clothMC&&this.clothMC.gotoAndPlay(1,-1),null!=this.weaponMC&&this.weaponMC.gotoAndPlay(1,-1),e.GlobalUtil.cleanUpMovieClipDataFactory(o)}},i.prototype.loadSkillComplete=function(t){if(this.skillGroup==t){var i,n=this.skillList[this.curSkillIndex],o=e.JsonDataManager.instance.skillEffectTemplate[n],a=o.castEffect;i=a>=1e4?e.JsonDataManager.instance.effectTemplate[a+this.direction]:e.JsonDataManager.instance.effectTemplate[a];var s=RES.getRes(i.prefix+"_json"),r=RES.getRes(i.prefix+"_png"),l=new egret.MovieClipDataFactory(s,r);this.skillMC=new egret.MovieClip(l.generateMovieClipData(i.prefix)),this.skillContainer.addChild(this.skillMC),this.skillMC.play(1),this.skillMC.addEventListener(egret.Event.COMPLETE,this.skillPlayComplete,this),e.WorldBossController.getInstance().playHitEffect(n),e.GlobalUtil.cleanUpMovieClipDataFactory(l)}},i.prototype.skillPlayComplete=function(e){this.skillMC.removeEventListener(egret.Event.COMPLETE,this.skillPlayComplete,this),this.skillMC.parent.removeChild(this.skillMC),this.skillMC.stop(),this.skillMC=null},i.prototype.tick=function(t){var i;if(1==this.actionType)-1==this.lastWalkTime&&(this.lastWalkTime=t),i=t-this.lastWalkTime,this.lastWalkTime=t,this.walkTime-=i,this.x+=this.speedX*i,this.y+=this.speedY*i,this.walkTime<=0&&(this.x=0,this.y=0,this.changeAction(2,this.scene.getRoleMonsterDirection(this.parent)));else if(2==this.actionType){if(-1==this.lastSkilltime&&(this.lastSkilltime=t),i=t-this.lastSkilltime,800>i)return;if(this.lastSkilltime=t,this.playSkill(),null==this.roleInfo)return;var n=this.model.getDamage(this.roleInfo.getPlayerId(),this.roleItemId);e.WorldBossController.getInstance().playDamage(n)}},i.prototype.removeHandler=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this),this.clear()},i.prototype.playHitEffect=function(t){var i=e.JsonDataManager.instance.skillEffectTemplate[t],n=e.JsonDataManager.instance.effectTemplate[i.hitEffect];if(null!=n){var o=n.prefix+"";RES.createGroup(o,[n.prefix+"_png",n.prefix+"_json"]),App.getResourceUtils().loadGroup(o,this.loadHitEffectComplete,null,this)}},i.prototype.loadHitEffectComplete=function(e){var t=RES.getRes(e+"_json"),i=RES.getRes(e+"_png"),n=new egret.MovieClipDataFactory(t,i),o=new egret.MovieClip(n.generateMovieClipData(e));this.skillContainer.addChild(o),o.play(1),o.addEventListener(egret.Event.COMPLETE,this.effectPlayComplete,this)},i.prototype.effectPlayComplete=function(e){var t=e.target;t.removeEventListener(egret.Event.COMPLETE,this.effectPlayComplete,this),t.stop(),t.parent.removeChild(t),t=null},i.prototype.changeScaleX=function(){this.roleGroup.scaleX=-this.roleGroup.scaleX},i.prototype.clear=function(){null!=this.clothMC&&(this.clothMC.parent.removeChild(this.clothMC),this.clothMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.clothMC)),this.clothMC=null,RES.destroyRes(this.clothGroup,!1),null!=this.monsterMC&&(this.monsterMC.parent.removeChild(this.monsterMC),this.monsterMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.monsterMC)),this.monsterMC=null,RES.destroyRes(this.monsterGroup,!1),null!=this.weaponMC&&(this.weaponMC.parent.removeChild(this.weaponMC),this.weaponMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.weaponMC)),this.weaponMC=null,RES.destroyRes(this.weaponGroup,!1),null!=this.wingMC&&(this.wingMC.parent.removeChild(this.wingMC),this.wingMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.wingMC)),this.wingMC=null,RES.destroyRes(this.wingGroup,!1),null!=this.skillMC&&(this.skillMC.parent.removeChild(this.skillMC),this.skillMC.stop(),e.GlobalUtil.cleanUpMovieClip(this.skillMC)),this.skillMC=null,RES.destroyRes(this.skillGroup,!1)},i}(eui.Component);e.WorldBossRole=i,__reflect(i.prototype,"foxgame.WorldBossRole")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/worldboss/WorldBossScene.exml","worldBossSceneMapGroup")||this;return i.dmgItemPool=[],i.dmgItemList=[],i.setRegisterTick(!0),i.isMask=!1,i.isCenter=!0,i.layer=LayerType.MAINUILAYER,i.setIsShowBackBtn(!1),i.setIsTextureCache(!1),i.model=e,i.model.registerObserver(i),i}return __extends(i,t),i.prototype.initHook=function(){for(var t,i=this.getRoleContainerList(),n=[],o=0;o<i.length;o++){t=i[o];for(var a=0;a<t.length;a++)n.push(t[a])}n.push(this.ui.bossContainer),n.sort(this.sortContainer);for(var s,o=0;o<n.length;o++)s=n[o],s.parent.setChildIndex(s,o);var r=e.GlobalConfig.instance.getValue("WORLD_BOSS_HARM_DRIFT"),l=r.split(",");this.minDamage=Number(l[0])/100,this.maxDamage=Number(l[1])/100,this.criticalRate=Number(e.GlobalConfig.instance.getValue("WORLD_BOSS_CRITICAL_RATE"))/100,this.ui.bgRect.width=e.Global.stageWidth,this.ui.bgRect.height=e.Global.stageHeight},i.prototype.sortContainer=function(e,t){return e.y<t.y?-1:e.y>t.y?1:0},i.prototype.refresh=function(){if(null!=this.model.fightInfo){var t=this.model.fightInfo.getBossInfo();e.BossBloodGroup.getInstance().showPanel(t.getBossId(),t.getCurrBossHp(),!1,!1);var i=this.ui.bossContainer;if(0==i.numChildren){var n=new e.WorldBossRole(this.model,null);n.isBoss=!0,n.setInfo(null,-1,null,t.getBossId(),null,4,null),n.anchorOffsetX=150,n.anchorOffsetY=300,i.addChild(n)}if(null!=this.model.myRoleList)for(var o,a,s=this.classify(),r=this.getRoleContainerList(),l=r.length,h=0;l>h;h++)o=r[h],a=s[h],this.setRoleDisplay(o,a)}},i.prototype.setRoleDisplay=function(t,i){for(var n,o,a,s=this,r=t.length,l=this.ui.startContainer,h=new egret.Point(l.x,l.y),c=0;r>c;c++)n=t[c],o=this.getRoleByType(c+1,i),null!=o?0==n.numChildren&&(a=new e.WorldBossRole(this.model,this),TweenMax.delayedCall(1*Math.random(),function(e,t,i,n){t.setInfo(i,i.getRoleItemId(),i.getEquipIds(),i.getMonsterId(),i.getWingItemId(),s.getDirection(e,n,t),h)},[l,a,o,n]),a.anchorOffsetX=150,a.anchorOffsetY=300,n.addChild(a)):n.removeChildren()},i.prototype.getRoleMonsterDirection=function(e){return this.getDirection(e,this.ui.bossContainer,e.getChildAt(0),!0)},i.prototype.getRoleByType=function(t,i){if(null==i)return null;for(var n,o,a=i.length,s=0;a>s;s++){if(n=i[s],o=e.JsonDataManager.instance.roleTemplate[n.getRoleItemId()],1==t&&o&&o.profession==e.ProfessionType.PROFESSION1)return n;if(2==t&&o&&o.profession==e.ProfessionType.PROFESSION2)return n;if(3==t&&o&&o.profession==e.ProfessionType.PROFESSION3)return n;if(4==t&&0!=Number(n.getMonsterId())&&s==a-2)return n;if(5==t&&0!=Number(n.getMonsterId())&&s==a-1)return n}return null},i.prototype.classify=function(){for(var e,t,i=[],n=this.model.otherRoleList,o={},a=n.length,s=0;a>s;s++)e=n[s],t=e.getPlayerId(),null==o[t]&&(o[t]=[]),o[t].push(e);i.push(this.model.myRoleList);for(var r in o)i.push(o[r]);return i},i.prototype.showOrHidePlayer=function(e){for(var t,i,n=this.getRoleContainerList(),o=1;o<n.length;o++){t=n[o];for(var a=0;a<t.length;a++)i=t[a],i.visible=e}},i.prototype.getDirection=function(e,t,i,n){void 0===n&&(n=!1);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),r=180*s/Math.PI;0>r&&(r+=360);var l;return(r>270||90>r||n)&&i.changeScaleX(),r>=202.5&&247.5>=r||r>=292.5&&337.5>=r?l=3:r>=337.5||22.5>=r||r>=157.5&&202.5>=r?l=2:r>=22.5&&67.5>=r||r>=112.5&&157.5>=r?l=1:r>=67.5&&112.5>=r?l=8:r>=247.5&&292.5>=r&&(l=4),l},i.prototype.showHook=function(){this.parent.setChildIndex(this,0),this.ui.bgimg_wb_map_01.source="wb_map_01_jpg",this.ui.bgimg_wb_map_04.source="wb_map_04_jpg",this.ui.bgimg_wb_map_07.source="wb_map_07_jpg",this.ui.bgimg_wb_map_02.source="wb_map_02_jpg",this.ui.bgimg_wb_map_03.source="wb_map_03_jpg",this.ui.bgimg_wb_map_06.source="wb_map_06_jpg",this.ui.bgimg_wb_map_05.source="wb_map_05_jpg",this.ui.bgimg_wb_map_08.source="wb_map_08_jpg",this.ui.bgimg_wb_map_09.source="wb_map_09_jpg"},i.prototype.tickHook=function(e){for(var t,i,n,o=this.getRoleContainerList(),a=o.length,s=0;a>s;s++){t=o[s];for(var r=0;r<t.length;r++)i=t[r],0!=i.numChildren&&(n=i.getChildAt(0),n.tick(e))}this.tickPlayDamage(e)},i.prototype.update=function(){this.refresh()},i.prototype.playDamage=function(t){var i=this.minDamage+(this.maxDamage-this.minDamage)*Math.random(),n=Math.floor(t*i),o=this.getDamageItem();Math.random()<=this.criticalRate?o.setItem(e.WorldBossDamageType.CRITICAL,n):o.setItem(e.WorldBossDamageType.NORMAL,-n),o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.scaleX=1,o.scaleY=1,o.alpha=1,o.x=0,o.y=0,this.dmgItemList.push(o)},i.prototype.playHitEffect=function(e){var t=this.ui.bossContainer.getChildAt(0);
t.playHitEffect(e)},i.prototype.tickPlayDamage=function(e){if(null==this.lastDmgTime&&(this.lastDmgTime=e),0!=this.dmgItemList.length){var t=e-this.lastDmgTime;if(!(100>t)){this.lastDmgTime=e;var i=this.dmgItemList.shift();this.ui.damageGroup.addChild(i),egret.Tween.get(i).to({x:i.x+50,y:i.y-100},500).to({y:i.y-150,alpha:0},500).call(this.damageComplete2,this,[i])}}},i.prototype.damageComplete2=function(e){e.parent.removeChild(e),this.getIsShow()&&this.restoreDamageItem(e)},i.prototype.getDamageItem=function(){return this.dmgItemPool.length>0?this.dmgItemPool.pop():new e.WorldBossDamageItem},i.prototype.restoreDamageItem=function(e){this.dmgItemPool.push(e)},i.prototype.closeHook=function(){e.WorldBossController.getInstance().isBoss=!1},i.prototype.getRoleContainerList=function(){for(var e=[],t=1;5>=t;t++)e.push(this.ui["roleContainer1"+t]);for(var i=[],t=1;5>=t;t++)i.push(this.ui["roleContainer2"+t]);for(var n=[],t=1;5>=t;t++)n.push(this.ui["roleContainer3"+t]);for(var o=[],t=1;5>=t;t++)o.push(this.ui["roleContainer4"+t]);var a=[e,i,n,o];return a},i}(e.BasePanel);e.WorldBossScenePanel=t,__reflect(t.prototype,"foxgame.WorldBossScenePanel",["foxgame.IWorldBoss","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.UNION=0]="UNION",e[e.PERSON=1]="PERSON"}(t=e.WorldBossRankType||(e.WorldBossRankType={}));var i=function(i){function n(e){var t=i.call(this,"resource/skins/worldboss/WorldBossUI.exml","worldBossGroup4")||this;return t.playerStatus=!0,t.setRegisterTick(!0),t.setIsShowBackBtn(!1),t.isMask=!1,t.setIsTextureCache(!1),t.model=e,t.model.registerObserver(t),t}return __extends(n,i),n.prototype.initHook=function(){this.ui.hideBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hideHandler,this),this.ui.showBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHandler,this),this.ui.hideBtn.visible=!0,this.ui.showBtn.visible=!1,this.ui.unionRankBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankTabHandler,this),this.ui.personalRankBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankTabHandler,this),this.ui.cheerBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cheerHandler,this),this.ui.inviteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inviteHandler,this),this.ui.roleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hideOrShowPlayerHandler,this),this.ui.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backClickHandler,this)},n.prototype.initParams=function(){this.rankType=t.UNION},n.prototype.refresh=function(){if(null!=this.model.fightInfo){var i,n,o=this.getRankInfoById(this.rankType);this.rankType==t.UNION?(i=this.model.fightInfo.getUnionHarms(),n=e.LanguageUtils.instance.getValue("WORLDBOSSRANKNAME1",o.getRank()),this.ui.unionRankBtn.currentState="down",this.ui.personalRankBtn.currentState="up"):this.rankType==t.PERSON&&(i=this.model.fightInfo.getPlayerHarms(),n=e.LanguageUtils.instance.getValue("WORLDBOSSRANKNAME2",o.getRank()),this.ui.unionRankBtn.currentState="up",this.ui.personalRankBtn.currentState="down"),this.ui.rankLabel.textFlow=(new egret.HtmlTextParser).parser(n);var a=Math.floor(Number(o.getHarm())/1e4);n=e.LanguageUtils.instance.getValue("WORLDBOSSDAMAGE",a),this.ui.damageLabel.textFlow=(new egret.HtmlTextParser).parser(n);for(var s,r=this.getItemList(),l=r.length,h=0;l>h;h++)o=i[h],s=r[h],s.setItem(o);var c=Number(e.GlobalConfig.instance.getValue("WORLD_BOSS_ENCOURAGE_HARM_ADD_MAX")),u=Number(e.GlobalConfig.instance.getValue("WORLD_BOSS_ENCOURAGE_MAX_MUN")),p=this.model.fightInfo;null!=p&&(this.ui.percentLabel.text="+"+p.getUnionHarmAdd()+"%",this.ui.cheerBtn.enabled=Number(p.getUnionHarmAdd())<c&&Number(p.getCheerCount())<u,this.ui.cheerBtn.filters=Number(p.getUnionHarmAdd())<c&&Number(p.getCheerCount())<u?[]:e.GlobalUtil.grayFilter)}},n.prototype.tickHook=function(e){if(-1!=this.model.inviteCDStartTime){var t=e-this.model.inviteCDStartTime;if(!(1e3>t)){this.model.inviteCDStartTime=e,this.model.inviteCD-=t;var i=Math.floor(this.model.inviteCD/1e3);this.ui.timeLabel.text=i+"s",0>i&&(this.ui.timeLabel.text="",this.model.inviteCDStartTime=-1)}}},n.prototype.update=function(){this.refresh()},n.prototype.rankTabHandler=function(e){e.currentTarget==this.ui.unionRankBtn?this.rankType=t.UNION:e.currentTarget==this.ui.personalRankBtn&&(this.rankType=t.PERSON),this.refresh()},n.prototype.cheerHandler=function(t){var i=new e.AttributeVO(e.GlobalConfig.instance.getValue("WORLD_BOSS_ENCOURAGE_COST"));if(e.PlayerService.instance.playerInfo.getGold()<i.value)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往");var n=e.GlobalConfig.instance.getValue("WORLD_BOSS_ENCOURAGE_HARM_ADD"),o=e.LanguageUtils.instance.getValue("WORLDBOSSCHEERPROMPT",i.value,n);e.PopUpController.getInstance().showTextPanel(o,this,this.confirmCheer)},n.prototype.confirmCheer=function(){var t=HawkProtocolManager.newBuilder("JsProto.UnionEncourageReq");e.Message.instance.send(e.Code.WORLD_BOSS_UNION_ENCOURAGE_C,t,!0)},n.prototype.inviteHandler=function(t){if(!(this.model.inviteCD>0)){var i=HawkProtocolManager.newBuilder("JsProto.InviteUnionMemberReq");e.Message.instance.send(e.Code.WORLD_BOSS_INVITE_UNION_MEM_C,i,!0)}},n.prototype.hideOrShowPlayerHandler=function(t){this.playerStatus=!this.playerStatus,this.playerStatus?this.ui.roleBtn.label=e.LanguageUtils.instance.getValue("YINCANGWANJIA"):this.ui.roleBtn.label=e.LanguageUtils.instance.getValue("XIANSHIWANJIA"),e.WorldBossController.getInstance().showOrHidePlayer(this.playerStatus)},n.prototype.backClickHandler=function(t){var i=HawkProtocolManager.newBuilder("JsProto.LeaveWorldBossReq");e.Message.instance.send(e.Code.LEAVE_WORLD_BOSS_C,i,!0)},n.prototype.hideHandler=function(e){this.ui.hideBtn.visible=!1,this.ui.showBtn.visible=!0,this.ui.rankGroup.visible=!1},n.prototype.showHandler=function(e){this.ui.hideBtn.visible=!0,this.ui.showBtn.visible=!1,this.ui.rankGroup.visible=!0},n.prototype.getRankInfoById=function(i){var n,o;i==t.UNION?(o=this.model.fightInfo.getUnionHarms(),n=e.UnionController.getInstance().getUnionId()):i==t.PERSON&&(o=this.model.fightInfo.getPlayerHarms(),n=e.PlayerService.instance.playerInfo.getPlayerId());for(var a,s=o.length,r=0;s>r;r++)if(a=o[r],Number(a.getId())==n)return a;return null},n.prototype.getItemList=function(){var e=[];return e.push(this.ui.item0),e.push(this.ui.item1),e.push(this.ui.item2),e},n}(e.BasePanel);e.WorldBossUIPanel=i,__reflect(i.prototype,"foxgame.WorldBossUIPanel",["foxgame.IWorldBoss","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.inited=!1,e.skinName="WorldBossUIRankItem",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.setItem(this.info)},i.prototype.setItem=function(t){if(this.info=t,null==this.info)return void(this.visible=!1);if(0!=this.inited){this.visible=!0,this.firstImg.visible=1==Number(this.info.getRank()),this.secondImg.visible=2==Number(this.info.getRank()),this.thirdImg.visible=3==Number(this.info.getRank()),this.nameLabel.text=this.info.getName();var i=Math.floor(Number(this.info.getHarm())/1e4);this.damageLabel.textFlow=(new egret.HtmlTextParser).parser(e.LanguageUtils.instance.getValue("WORLDBOSSDAMAGE",i))}},i}(eui.Component);e.WorldBossUIRankItem=t,__reflect(t.prototype,"foxgame.WorldBossUIRankItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.YieldModel,this.panel=new e.YieldPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showPanel=function(){this.panel.show()},t.prototype.setModelYieldData=function(e){this.model.setYieldData(e)},t}();e.YieldController=t,__reflect(t.prototype,"foxgame.YieldController")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){this.observerList=[]}return e.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},e.prototype.setYieldData=function(e){this.yieldData=e,this.updateView()},e}();e.YieldModel=t,__reflect(t.prototype,"foxgame.YieldModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/yield/yieldSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.updateView=function(){this.refresh()},i.prototype.refresh=function(){if(this.getIsShow()){var t=e.PlayerService.instance.playerInfo.getVipLevel(),i=e.PlayerService.instance.level,n=e.JsonDataManager.instance.vipTemplate,o=e.PlayerService.instance.mainRoleInfo.getExp(),a=e.PlayerService.instance.getRoleLevelExp(i).exp,s=n[t],r=this.model.yieldData,l=5>t?e.LanguageUtils.instance.getValue("JIHUOVIP5"):"VIP"+t,h=e.LanguageUtils.instance.getValue("GONGHUIJINENG");this.ui.coinText0.text=r.getCoinRate()+"/"+e.LanguageUtils.instance.getValue("HOUR"),this.ui.expText0.text=r.getExpRate()+"/"+e.LanguageUtils.instance.getValue("HOUR");var c=Math.floor(r.getCoinRate()/r.getFightTimes())+"";this.ui.coinText1.text=c;var u=Math.floor(r.getExpRate()/r.getFightTimes())+"";this.ui.expText1.text=u;var p=s.experienceAddition/1e4,g=s.copperMoneyAdded/1e4,d=r.getExpRate()/r.getExpRatio(),f=r.getCoinRate()/r.getCoinRatio(),m=n[5].experienceAddition/1e4,y=n[5].copperMoneyAdded/1e4,I=5>t?Math.floor(d*m):Math.floor(d*p);this.ui.vipExpText0.text=l+"+"+I,this.ui.vipExpText1.text=l+"+"+Math.floor(I/r.getFightTimes());var v=5>t?Math.floor(f*y):Math.floor(f*g);this.ui.vipCoinText0.text=l+"+"+v,this.ui.vipCoinText1.text=l+"+"+Math.floor(v/r.getFightTimes());var _=5>t?Math.floor(d*(r.getExpRatio()-1)):Math.floor(d*(r.getExpRatio()-p-1));this.ui.unionSkillExp0.text=h+"+"+_,this.ui.unionSkillExp1.text=h+"+"+Math.floor(_/r.getFightTimes());var T=5>t?Math.floor(f*(r.getCoinRatio()-1)):Math.floor(f*(r.getCoinRatio()-g-1));this.ui.unionSkillCoin0.text=h+"+"+T,this.ui.unionSkillCoin1.text=h+"+"+Math.floor(T/r.getFightTimes()),this.ui.equipText.text=r.getEquipRate()+e.LanguageUtils.instance.getValue("JIAN");var C=Math.floor((a-o)/r.getExpRate());0==r.getExpRate()&&(C=999);var A=Math.floor((a-o)%r.getExpRate()/r.getExpRate()*60),E=C>=1?"<font color=#FFFF00>"+C+"</font>"+e.LanguageUtils.instance.getValue("HOUR"):"",S=A>0?"<font color=#FFFF00>"+A+"</font>"+e.LanguageUtils.instance.getValue("MINUTES"):"<font color=#FFFF00>0</font>"+e.LanguageUtils.instance.getValue("MINUTES"),P=e.LanguageUtils.instance.getValue("SHENGJIJISUAN",i+1,a-o)+E+S;this.ui.levelUpText.textFlow=(new egret.HtmlTextParser).parser(P),this.ui.everyageKillText.text=e.LanguageUtils.instance.getValue("MEISHIZHI",r.getFightTimes())}},i.prototype.initHook=function(){this.model.registerObserver(this),this.ui.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.doScreenAdaptation()},i.prototype.readyDestroy=function(){this.ui.levelUpText.textFlow=null},i}(e.BasePanel);e.YieldPanel=t,__reflect(t.prototype,"foxgame.YieldPanel",["foxgame.IYield","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.model=new e.zhuanPanModel,this.shiLianPanel=new e.ZhuanPanShiLianView(this.model),this.panel=new e.zhuanPanPanel(this.model)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getSeverData=function(t){void 0===t&&(t=1);var i=HawkProtocolManager.newBuilder("JsProto.TurntableLotteryInfoReq");e.Message.instance.send(e.Code.TURNTABLE_LOTTERY_INFO_C,i,!0)},t.prototype.getLog=function(){var t=HawkProtocolManager.newBuilder("JsProto.TurntableLotteryLogReq");e.Message.instance.send(e.Code.TURNTABLE_LOTTERY_LOG_C,t,!0)},t.prototype.showPanel=function(){this.panel.show()},t.prototype.registerMsg=function(t){t.add(e.Code.TURNTABLE_LOTTERYy_INFO_S,this),t.add(e.Code.TURNTABLE_LOTTERY_DO_S,this),t.add(e.Code.TURNTABLE_LOTTERY_LOG_S,this),t.add(e.Code.TURNTABLE_COUNT_AWARD_S,this)},t.prototype.recvMsg=function(i,n){switch(i){case e.Code.TURNTABLE_LOTTERYy_INFO_S:this.model.setSeverData(n),t.getInstance().getLog();break;case e.Code.TURNTABLE_LOTTERY_DO_S:if(this.model.setChouJiangData(n),!this.panel.getIsShow())return;this.panel.jiangliStop(),this.getSeverData(this.model.zhuanPanType);break;case e.Code.TURNTABLE_LOTTERY_LOG_S:if(this.model.setLog(n),!this.panel.getIsShow())return;this.panel.showLog();break;case e.Code.TURNTABLE_COUNT_AWARD_S:this.model.setAward(n)}},t.prototype.startChouJiang=function(t,i){var n=HawkProtocolManager.newBuilder("JsProto.TurntableLotteryDoReq");n.setPoolType(t),n.setIsOneTime(i),e.Message.instance.send(e.Code.TURNTABLE_LOTTERY_DO_C,n,!0)},t.prototype.getAward=function(t){var i=HawkProtocolManager.newBuilder("JsProto.TurntableCountAwardReq");i.setPoolType(this.model.zhuanPanType),i.setIndex(t),e.Message.instance.send(e.Code.TURNTABLE_COUNT_AWARD_C,i,!0)},t.prototype.openShiLianPanel=function(){this.shiLianPanel.show()},t.prototype.zailaiChouShiCi=function(){this.panel.shiciChou()},t.prototype.getCiShuChouJiang=function(){return this.model.getCiShuChouJiang()},t.prototype.showHelpPanel=function(){e.HelpController.getInstance().showPanel("XINGYUNGZPHELP")},t}();e.zhuanPanControler=t,__reflect(t.prototype,"foxgame.zhuanPanControler",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ZhuanPanItemIconSkin",e}return __extends(i,t),i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.updataView()},i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curData=this.data;var t=this.curData.getAward(),i="",n=e.zhuanPanControler.getInstance().getCiShuChouJiang();i=n<this.curData.getCount()?"0xff0000":"0x21ff03";var o=this.curData.getStatus();this.keling.visible=!1,this.yiling.visible=!1,this.itemNum.textFlow=(new egret.HtmlTextParser).parser("<font color = "+i+">"+n+"</font>/"+this.curData.getCount()),o?this.keling.visible=!1:n>=this.curData.getCount()?this.keling.visible=!0:this.keling.visible=!1,this.yiling.visible=o,this.item.setItem(t.getItmeId(),t.getAmount(),!1),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.onClick=function(t){switch(t.target){case this.item:if(this.keling.visible)e.zhuanPanControler.getInstance().getAward(this.curData.getIndex());else{var i=this.curData.getAward();this.showTipsByItemOrEquip(i.getItmeId(),i.getTypeId(),i.getAmount())}}},i.prototype.showTipsByItemOrEquip=function(t,i,n){var o=e.JsonDataManager.instance.itemTemplate[t];switch(o.type){case e.ItemType.EQUIP:var a=e.JsonDataManager.instance.equipTemplate[t];e.TipsController.getInstance().showEquipTips({equipId:a.id});break;case e.ItemType.SOUL:e.TipsController.getInstance().showSoulTips(t);break;default:e.TipsController.getInstance().showItemTips(t,n)}},i.prototype.lingquAward=function(){},i}(eui.ItemRenderer);e.zhuanPanItemIcon=t,__reflect(t.prototype,"foxgame.zhuanPanItemIcon")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.skinName="ZhuanPanLogItemSkin",e}return __extends(i,t),i.prototype.onEventRemovedFromParent=function(e){this.cleanDataDelete()},i.prototype.cleanDataDelete=function(){this.removeEventListener(egret.Event.REMOVED,this.onEventRemovedFromParent,this)},i.prototype.getHeight=function(){return this.height},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.updataView()},i.prototype.updataView=function(){this.initUI()},i.prototype.initUI=function(){e.GlobalUtil.transformDisplayObjectContainerFetchBitmapSource2(this),this.curData=this.data;var t=this.getItemTemplate()[this.curData.getItemId()],i=e.ColorUtils.instance.getColorByQuality(t.quality),n=i.toString(16),o=e.LanguageUtils.instance.getValue("TREASURERECORD",this.curData.getPlayerId(),this.curData.getName(),n,this.curData.getItemId(),this.curData.getItemName());this.label.textFlow=(new egret.HtmlTextParser).parse(o),this.label.addEventListener(egret.TextEvent.LINK,this.linkHandler,this)},i.prototype.linkHandler=function(t){var i=t.text.split("_"),n=i[0],o=Number(i[1]);if("playerId"==n)o>0&&e.OtherCharacterController.getInstance().showOtherCharacterPanel(o);else{if("itemId"!=n)throw new Error("examine parameter Error");var a=this.getItemTemplate()[o];e.TipsController.getInstance().showItemTips(a.id)}},i.prototype.getItemTemplate=function(){return e.JsonDataManager.instance.itemTemplate},i.prototype.onClick=function(e){e.target},i.prototype.lingquAward=function(){},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);e.ZhuanPanLogItem=t,__reflect(t.prototype,"foxgame.ZhuanPanLogItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.zhuanPanType=1,this.curCiShu=0,this.goldKey=110179,this.yinKey=110180,this.observerList=[],this.dataSource=[],this.dataSource_log=[],this.collection=new eui.ArrayCollection,this.collection.source=this.dataSource,this.logcollection=new eui.ArrayCollection,this.logcollection.source=this.dataSource_log}return t.prototype.getIdByType=function(){var e=0;return e=1==this.zhuanPanType?this.yinKey:this.goldKey},t.prototype.getCostByType=function(t){void 0===t&&(t=-1);var i=0;i=-1==t?this.zhuanPanType:t;var n="";switch(i){case 1:n="MHZPDC_YUANBAO_XIAOHAO";break;case 2:n="ZZZPDC_YUANBAO_XIAOHAO"}var o=Number(e.GlobalConfig.instance.getValue(n));return o},t.prototype.getCostTenByType=function(t){void 0===t&&(t=-1);var i=0;i=-1==t?this.zhuanPanType:t;var n="";switch(i){case 1:n="MHZPSC_YUANBAO_XIAOHAO";break;case 2:n="ZZZPSC_YUANBAO_XIAOHAO"}var o=Number(e.GlobalConfig.instance.getValue(n));return o},t.prototype.setSeverData=function(t){this.severData=t;var i=0,n=!1,o=this.severData.getTurntableLotteryinfo().length;for(i;o>i;i++){var a=this.severData.getTurntableLotteryinfo()[i],s=a.getCountAwardInfo(),r=0,l=s.length;for(r;l>r;r++){var h=s[r];if(!h.getStatus()&&a.getActionCount()>=h.getCount()){n=!0;break}}}e.ActivityBarController.getInstance().setZhuanPanRed(n),this.updateView()},t.prototype.setCiShuChouJiang=function(e){this.curCiShu=e},t.prototype.getCiShuChouJiang=function(){return this.curCiShu},t.prototype.setChouJiangData=function(e){this.choujiangData=e},t.prototype.setLog=function(e){this.logData=e},t.prototype.setAward=function(t){0==t.getErrorNo()&&e.zhuanPanControler.getInstance().getSeverData()},t.prototype.getLog=function(){return this.logData},t.prototype.getChouJiangData=function(){return this.choujiangData},t.prototype.getSeverData=function(){return this.severData},t.prototype.registerObserver=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},t.prototype.updateView=function(){for(var e,t=this.observerList.length,i=0;t>i;i++)e=this.observerList[i],e.getIsShow()&&e.updateView()},t}();e.zhuanPanModel=t,__reflect(t.prototype,"foxgame.zhuanPanModel")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityZhuanPan/ZhuanPanMainSkin.exml")||this;return i.speedR=3,i.startTime=0,i.costM=0,i.costKey=0,i.severTime=0,i.lateLastTime=0,i.model=e,i.setRegisterTick(!0),i.resultLastTime=0,i.lateLastTime=0,i.model.registerObserver(i),i.startTime=0,i}return __extends(i,t),i.prototype.updateView=function(){this.getIsShow()&&this.initData()},i.prototype.initData=function(){if(this.dataInfo=this.model.getSeverData(),this.dataInfo){1==this.model.zhuanPanType?(this.ui.jinyaoshi.visible=!1,this.ui.yinyaoshi.visible=!0):(this.ui.jinyaoshi.visible=!0,this.ui.yinyaoshi.visible=!1);var t=e.PlayerService.instance.playerInfo.getGold(),i=this.model.getIdByType(),n=e.BagController.getInstance().getCountByItemId(i),o=this.dataInfo.getTurntableLotteryinfo(),a=o[this.model.zhuanPanType-1];this.ui.choujiangNum.text=n+"/1",this.model.setCiShuChouJiang(a.getActionCount()),this.model.dataSource=[],this.model.dataSource=a.getCountAwardInfo(),this.ui.list.dataProvider=null,this.ui.list.dataProvider=this.model.collection,this.severTime=Number(this.dataInfo.getLefttime()),this.ui.timeLabel.text=this.checkTime(),this.model.collection.replaceAll(this.model.dataSource),this.itemDataArr=a.getPool();var s=this.itemDataArr.length,r=0;for(this.itemArr=[],r;s>r;r++){var l=this.ui["item_"+r],h=this.itemDataArr[r];l.setItem(h.getItmeId(),h.getAmount(),!0),l.type=h.getTypeId(),l.curIndex=r,l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemClick,this),this.itemArr.push(l)}var c=0;this.ui.checkBoxBtn.selected?(this.costKey=10,c=this.model.getCostTenByType(),this.costM=c,this.ui.yuanbaoNum.text=c+"或",this.ui.choujiangNum.text=n+"/10"):(this.costKey=1,c=this.model.getCostByType(),this.costM=c,this.ui.yuanbaoNum.text=c+"或",this.ui.choujiangNum.text=n+"/1"),this.ui.redPointM.visible=this.checkRed(t,n,1),this.ui.redPointZ.visible=this.checkRed(t,n,2)}},i.prototype.checkRed=function(e,t,i){var n=!1,o=this.model.getCostByType(i);return(e>=o||t>=1)&&(n=!0),n},i.prototype.initListener=function(){this.ui.closeBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.zhizunBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.menghuanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.checkBoxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.ui.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i.prototype.showHelp=function(){e.zhuanPanControler.getInstance().showHelpPanel()},i.prototype.onClick=function(t){var i=this;switch(t.target){case this.ui.closeBtn2:this.close();break;case this.ui.helpBtn:this.showHelp();break;case this.ui.zhizunBtn:if(this.isStart)return;this.model.zhuanPanType=2,this.ui.zhizunBtn.currentState="down",this.ui.menghuanBtn.currentState="up",e.zhuanPanControler.getInstance().getSeverData();break;case this.ui.menghuanBtn:if(this.isStart)return;this.model.zhuanPanType=1,this.ui.zhizunBtn.currentState="up",this.ui.menghuanBtn.currentState="down",e.zhuanPanControler.getInstance().getSeverData();break;case this.ui.leftBtn:var n=this.model.dataSource.length,o=(this.ui.scroller.width-6*n)/n;this.ui.scroller.viewport.scrollH>=o&&(this.ui.scroller.viewport.scrollH-=o);break;case this.ui.rightBtn:n=this.model.dataSource.length,o=(this.ui.scroller.width-6*n)/n,this.ui.scroller.viewport.scrollH<this.ui.scroller.width-6*o&&(this.ui.scroller.viewport.scrollH+=o);break;case this.ui.checkBoxBtn:var a=this.model.getIdByType(),s=e.BagController.getInstance().getCountByItemId(a),r=0;this.ui.checkBoxBtn.selected?(this.costKey=10,r=this.model.getCostTenByType(),this.costM=r,this.ui.yuanbaoNum.text=r+"或",this.ui.choujiangNum.text=s+"/10"):(this.costKey=1,r=this.model.getCostByType(),this.costM=r,this.ui.yuanbaoNum.text=r+"或",this.ui.choujiangNum.text=s+"/1");break;case this.ui.startBtn:if(!this.dataInfo)return;if(this.isStart)return;var l=e.PlayerService.instance.playerInfo.getGold();a=this.model.getIdByType(),s=e.BagController.getInstance().getCountByItemId(a);var h=e.JsonDataManager.instance.itemTemplate,c=h[a];if(l>=this.costM||s>=this.costKey){if(0==s)return void e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("XYZPHUAFEITISHI",this.costM,c.name),this,function(){i.isStart=!0,i.isEnd=!1,i.ui.checkBoxBtn.touchEnabled=!1});this.isStart=!0,this.isEnd=!1,this.ui.checkBoxBtn.touchEnabled=!1}else e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")}},i.prototype.showLog=function(){var t=this.model.getLog(),i=t.getLogInfo();this.model.logcollection.replaceAll(i),this.logItem||(this.logItem=new e.ZhuanPanLogItem);var n=0,o=(i.length-1)*this.logItem.height;n=o<=this.ui.logList.height?0:o-this.ui.logList.height,this.ui.logScroller.viewport.scrollV=n},i.prototype.jiangliStop=function(){var t=this.model.getChouJiangData();if(t.getErrorNo()>0);else{var i=this.model.getIdByType(),n=e.BagController.getInstance().getCountByItemId(i);this.ui.choujiangNum.text=n+"/1",this.model.setCiShuChouJiang(t.getActionCount()),this.curAwardItem=t.getTurntableLotteryAward()[0],this.toStop()}},i.prototype.toStop=function(){var e=0,t=this.itemArr.length;for(this.curItem=null,e;t>e;e++)if(this.curAwardItem.getItmeId()==this.itemArr[e].itemId){this.curItem=this.itemArr[e],this.isEnd=!0;break}},i.prototype.showTipsByItemOrEquip=function(t,i,n){var o=e.JsonDataManager.instance.itemTemplate[t];switch(o.type){case e.ItemType.EQUIP:var a=e.JsonDataManager.instance.equipTemplate[t];e.TipsController.getInstance().showEquipTips({equipId:a.id});break;case e.ItemType.SOUL:e.TipsController.getInstance().showSoulTips(t);break;default:e.TipsController.getInstance().showItemTips(t,n)}},i.prototype.onItemClick=function(e){var t=e.target;this.showTipsByItemOrEquip(t.itemId,t.type,t.num)},i.prototype.tickHook=function(t){var i=t-this.resultLastTime,n=t-this.lateLastTime;if(n>=3e4&&(this.lateLastTime=t,this.ui.timeLabel.text=this.checkTime()),!(50>i))if(this.resultLastTime=t,this.isStart){if(this.startTime+=1,this.startTime>=50){if(this.isEnd){Log.trace(""+this.ui.zhuanpanGroup.rotation);var o=this.ui.zhuanpanGroup.rotation,a=o%180,s=void 0;if(s=this.curItem.curIndex<5?36*-this.curItem.curIndex:36*(10-this.curItem.curIndex),s+37>a&&a>s-37&&(this.speedR=2),s+3>a&&a>s-3)return this.speedR=0,this.isStart=!1,this.ui.checkBoxBtn.touchEnabled=!0,this.timeTosever=!1,void e.zhuanPanControler.getInstance().openShiLianPanel()}this.timeTosever||(this.timeTosever=!0,e.zhuanPanControler.getInstance().startChouJiang(this.model.zhuanPanType,!this.ui.checkBoxBtn.selected))}else this.speedR<10&&(this.speedR+=1);this.ui.zhuanpanGroup.rotation+=this.speedR}else this.startTime=0},i.prototype.checkTime=function(){var e="剩余时间：",t=0,i=0,n=0,o=(this.severTime-this.severTime%6e4)/6e4;return t=o%60,i=(o-t)/60%24,n=(o-60*i-t)/1440,e+n+"天"+i+"小时"+t+"分"},i.prototype.shiciChou=function(){var t=e.PlayerService.instance.playerInfo.getGold(),i=this.model.getIdByType(),n=e.BagController.getInstance().getCountByItemId(i);t>=this.costM||n>=this.costKey?(this.isStart=!0,this.isEnd=!1):e.PopUpController.getInstance().showTextPanel(e.LanguageUtils.instance.getValue("ZUANSHIBUZU"),this,function(){e.RechargeController.getInstance().showPanel()},null,null,null,"前往")},i.prototype.initHook=function(){e.zhuanPanControler.getInstance().getSeverData(),e.zhuanPanControler.getInstance().getLog(),this.ui.scroller.scrollPolicyH=eui.ScrollPolicy.AUTO,this.ui.scroller.horizontalScrollBar.autoVisibility=!1,this.ui.scroller.scrollPolicyV=eui.ScrollPolicy.OFF;var t=new eui.TileLayout;t.requestedColumnCount=0,t.requestedRowCount=1,t.horizontalGap=5,t.verticalGap=1,this.ui.scroller.viewport.scrollH=0,this.ui.scroller.verticalScrollBar.autoVisibility=!1;var i=this.ui.list;i.layout=t,i.dataProvider=this.model.collection,i.itemRenderer=e.zhuanPanItemIcon,this.ui.logScroller.verticalScrollBar.autoVisibility=!1;var n=this.ui.logList;n.dataProvider=this.model.logcollection,n.itemRenderer=e.ZhuanPanLogItem},i.prototype.showHook=function(){this.isStart=!1,this.isEnd=!1,this.timeTosever=!1,this.resultLastTime=0,this.lateLastTime=0,this.startTime=0,(this.model.zhuanPanType=1)?(this.ui.zhizunBtn.currentState="up",this.ui.menghuanBtn.currentState="down"):(this.ui.zhizunBtn.currentState="down",this.ui.menghuanBtn.currentState="up"),this.doScreenAdaptation(),this.initListener()},i.prototype.closeHook=function(){this.isStart=!1,this.isEnd=!1,this.timeTosever=!1,this.resultLastTime=0,this.lateLastTime=0,this.startTime=0},i}(e.BasePanel);e.zhuanPanPanel=t,__reflect(t.prototype,"foxgame.zhuanPanPanel",["foxgame.IZhuanPan","foxgame.IObserver"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this,"resource/skins/activityZhuanPan/ZhuanPanShiLianSkin.exml")||this;return i.model=e,i}return __extends(i,t),i.prototype.onClick=function(e){switch(e.target){case this.ui.btn:this.yesClick()}},i.prototype.showTipsByItemOrEquip=function(t,i,n){switch(i){case e.ItemType.EQUIP:var o=e.JsonDataManager.instance.equipTemplate[t];e.TipsController.getInstance().showEquipTips({equipId:o.id});break;case e.ItemType.SOUL:e.TipsController.getInstance().showSoulTips(t);break;default:e.TipsController.getInstance().showItemTips(t,n)}},i.prototype.onItemClick=function(e){var t=e.target;this.showTipsByItemOrEquip(t.itemId,t.type,t.num)},i.prototype.yesClick=function(){e.zhuanPanControler.getInstance().zailaiChouShiCi(),this.close()},i.prototype.showHook=function(){var e=this.model.getChouJiangData(),t=e.getTurntableLotteryAward(),i=0,n=t.length;for(i;n>i;i++){var o=this.ui["item"+i];o.visible=!0;var a=t[i];o.setItem(a.getItmeId(),a.getAmount(),!0),o.type=a.getTypeId(),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemClick,this)}for(i;10>i;i++){var o=this.ui["item"+i];o.visible=!1}this.ui.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i}(e.BasePanel);e.ZhuanPanShiLianView=t,__reflect(t.prototype,"foxgame.ZhuanPanShiLianView")}(foxgame||(foxgame={}));var Main=function(e){function t(){var t=e.call(this)||this;return t.preLoadGlobalCnt=5,t.oppoResUrl=getGlobalConfig().platformUrl,t.UIFUNC=null,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){var t=this;"newOppogame"==window.GJlenged_chanel&&setLoadingProgress(0),Global.isYouGuSDK=-1!=checkPlatformStr().indexOf(Global.ygsdk),egret.Capabilities.isMobile||(this.stage.orientation=egret.OrientationMode.AUTO),this.stage.addEventListener(egret.Event.RESIZE,this.resize,this),ScreenAdaptation.instance.init(this.stage),ScreenAdaptation.instance.setScreenSize(this.stage.stageWidth,this.stage.stageHeight),App.TimerManager().frameCount,egret.ImageLoader.crossOrigin="anonymous",this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),egret.MainContext.instance.stage.addEventListener(egret.Event.ACTIVATE,this.awakeSocket,this),egret.MainContext.instance.stage.addEventListener(egret.Event.DEACTIVATE,this.sleepGame,this),this.stage.dirtyRegionPolicy&&(this.stage.dirtyRegionPolicy=egret.DirtyRegionPolicy.OFF);var i=egret.MainContext.instance.stage,n="resource/assets2/skinsOK/activityBar/iphoneXdi.jpg";window.egret_quickgame&&(n=getGlobalConfig().platformUrl+"/"+n),RES.getResByUrl(n,function(e){var n=new egret.Bitmap(e);t.addChildAt(n,0),n.scale9Grid=new egret.Rectangle(80,57,480,3),n.width=i.stageWidth,n.height=(i.stageHeight-1136)/2,n.name="TopBitmap";var o=new egret.Bitmap(e);o.scaleY=-1,t.addChildAt(o,1),o.scale9Grid=new egret.Rectangle(80,57,480,3),o.width=i.stageWidth,o.height=(i.stageHeight-1136)/2,o.y=i.stageHeight,o.name="BottomBitmap"},this,RES.ResourceItem.TYPE_IMAGE),StageFrameControl.instance.init(this.stage),this.mainModule=new foxgame.MainModule,RES.setMaxLoadingThread(4),RES.setMaxRetryTimes(3),this.loadVersion(),GlobalUtil.notifyGlobalPreLoadingProgress(1,this.preLoadGlobalCnt),Global.globalConfig.isDebug},t.prototype.awakeSocket=function(e){App&&App.SoundManager&&(App.SoundManager().pauseBg(!1),App.SoundManager().setEffectOn(App.SoundManager().getCloseSound()))},t.prototype.sleepGame=function(e){App&&App.SoundManager&&(App.SoundManager().pauseBg(!0),App.SoundManager().setEffectOn(!1))},t.prototype.errorComplete=function(e){if(e instanceof String?console.error("GameUtils.httpReqs errorComplete, errmsg: "+e):e instanceof Object&&console.error("GameUtils.httpReqs errorComplete, errmsg: "+JSON.stringify(e)),window.gameErrorHandler){var t={type:"foxgame.GameUtils.httpReqs",msg:"url fail: "+e.retry.url,callback:function(){foxgame.GameUtils.httpReqs(e.retry.url,e.retry.params,e.retry.success,e.retry.error,e.retry.dataType)
}};window.gameErrorHandler(t)}},t.prototype.loadVersion=function(){window.egret_quickgame?App.getResourceUtils().getResByUrl(this.oppoResUrl+"/version.json?v="+Math.random(),this.versionComplete,this,RES.ResourceItem.TYPE_JSON):App.getResourceUtils().getResByUrl("version.json?v="+Math.random(),this.versionComplete,this,RES.ResourceItem.TYPE_JSON)},t.prototype.versionComplete=function(e){Global.version=e.v,GlobalUtil.notifyGlobalPreLoadingProgress(3,this.preLoadGlobalCnt,!1,Global.version),window.egret_quickgame?App.getResourceUtils().getResByUrl(this.oppoResUrl+"/versionRes.json",this.differentSourceComplete,this,RES.ResourceItem.TYPE_JSON):App.getResourceUtils().getResByUrl("versionRes.json",this.differentSourceComplete,this,RES.ResourceItem.TYPE_JSON)},t.prototype.differentSourceComplete=function(e){GlobalUtil.notifyGlobalPreLoadingProgress(4,this.preLoadGlobalCnt),App.getResourceUtils().setSourceVersion(e),this.showPreloadingPanel()},t.prototype.showPreloadingPanel=function(){this.loadingPanel=new PreloadingPanel(this.initRes.bind(this)),this.stage.addChild(this.loadingPanel),this.loadingPanel.y=0,this.loadingPanel.init()},t.prototype.initRes=function(){var e="resource/assets2.res.json",t="resource/";window.egret_quickgame&&(e=this.oppoResUrl+"/"+e,t=this.oppoResUrl+"/"+t),App.getResourceUtils().addConfig(e,t,this.onConfigCompleteHandler.bind(this)),foxgame.Global.resRootPath="resource/assets2/",App.getResourceUtils().startLoadConfig(null,this)},t.prototype.onConfigCompleteHandler=function(e){GlobalUtil.notifyGlobalPreLoadingProgress(5,this.preLoadGlobalCnt),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandler,this),GlobalUtil.ResourceInstance=e.target;var t,i=e.target.resConfig.keyMap,n=(egret.getTimer(),0);for(var o in i)t=i[o],t.url=App.getResourceUtils().getSourceVersionByUrl(t.url),n++;egret.getTimer();this.compareSourceBack()},t.prototype.delayOpt=function(e){GlobalUtil.notifyGlobalPreLoadingProgress(5,this.preLoadGlobalCnt),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandler,this),GlobalUtil.ResourceInstance=e;var t,i=e.resConfig.keyMap,n=(egret.getTimer(),0);for(var o in i)t=i[o],t.url=App.getResourceUtils().getSourceVersionByUrl(t.url),n++;egret.getTimer();this.compareSourceBack()},t.prototype.compareSourceBack=function(){var e=this;Log.trace("load preload.res.json ok:"+egret.getTimer());var t=this,i="resource/default.thm.json",n=new eui.Theme(i,t.stage);n.addEventListener(eui.UIEvent.COMPLETE,t.uiCompleteHandler,t),async.parallel({loadTheme:function(e){t.UIFUNC=e},loadGroups:function(e){App.getResourceUtils().loadGroups("preloadSource",["preloadingGroup","loginPanelGroup","preloadingNotUnloadGroup","guideGlobalGroup"],function(t){foxgame.JsonDataManager.instance.initPreloadTemplate(),e(null,"loadGroups"),Log.trace("loadGroups done!!!!!!!!")},t.preloadProgressHandler,t)}},function(t,i){e.createLoginFrame(),e.UIFUNC=null})},t.prototype.uiCompleteHandler=function(e){e.target.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompleteHandler),this.UIFUNC(null,"loadTheme"),Log.trace("loadTheme done!!!")},t.prototype.preloadProgressHandler=function(e,t){this.loadingPanel.setProgress(e,t)},t.prototype.createLoginFrame=function(){App.init(),this.mainModule.startGame();GlobalUtil.destroyGroup("preloadingGroup");this.loadingPanel&&(this.loadingPanel.removeTimer(),this.stage.removeChild(this.loadingPanel),this.loadingPanel.cleanRes(),this.loadingPanel=null),window.egret_quickgame||clearIndexBird()},t.prototype.resize=function(e){ScreenAdaptation.instance.setScreenSize(this.stage.stageWidth,this.stage.stageHeight),foxgame.Global.stageWidth=this.stage.stageWidth,foxgame.Global.stageHeight=this.stage.stageHeight,App.DeviceUtils().IsMobile(),App.MessageCenter.dispatch("resizeWindowHandler")},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.otherConstructorInit(),i.bodyClip.frameRate=10,i.weaponClip.frameRate=10,i.wingClip.frameRate=10,e&&i.simpleInitFromRoleData(e),i}return __extends(i,t),i.prototype.pvpFightInit=function(t,i){t&&i&&(this.x=t.getInitPos().getX(),this.y=t.getInitPos().getY(),this.hpTextField||(this.hpTextField=new egret.TextField,this.nameContainer.addChild(this.hpTextField),this.nameTextField=new egret.TextField,this.nameContainer.addChild(this.nameTextField),this.blueTextField=new eui.BitmapLabel,this.nameContainer.addChild(this.blueTextField)),null==this.duanWeiPic&&(this.duanWeiPic=new eui.Image,this.nameContainer.addChild(this.duanWeiPic)),null==this.unionNameTF&&(this.unionNameTF=new egret.TextField,this.nameContainer.addChild(this.unionNameTF)),t.getRole().getUnionName()?(this.unionNameTF.strokeColor=0,this.unionNameTF.stroke=1,this.unionNameTF.textColor=1096691,this.unionNameTF.size=18,this.unionNameTF.fontFamily="宋体",this.unionName=t.getRole().getUnionName(),this.unionNameTF.text=this.unionName,this.unionNameTF.anchorOffsetX=this.unionNameTF.width>>1,this.unionNameTF.y=this.nameTextField.y-this.unionNameTF.height):(this.unionNameTF.text="",this.unionNameTF.y=this.nameTextField.y),this.roleType=t.getRole().getType(),this.roleLevel=t.getRole().getLevel(),this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY||this.roleType==e.RoleType.BEAUTY?(this.roleName=t.getRole().getName(),this.blueInfo=t.getRole().getQqBlueInfo()):this.roleName="Lv"+this.roleLevel+t.getRole().getName(),this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,t.getRole().getRoleItemId()),this.updateBattleData(t,i),this.updateNameLab(),this.updateHpWidget(),(this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY)&&this.pvpFightDuanTitle(t.getRole(),i))},i.prototype.pvpFightDuanTitle=function(t,i){if(i.getBattleType()==e.BattleType.CS_ARENA_DAN||i.getBattleType()==e.BattleType.CS_ARENA_PRELIMINARY||t.getLevel()>=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_LIMIT"))){var n=e.KFController.getInstance().getDuanByLevel(t.getSegmentStar());this.duanWeiPic.source=n>=0?"sceneDuan_"+n+"_png":""}else this.duanWeiPic.source="";this.setDuanTitlePosition()},i.prototype.setDuanTitlePosition=function(){this.blueInfo&&this.blueInfo.getIsBlueVip()&&(this.blueTextField.x=this.nameTextField.x-(this.nameTextField.width>>1)-this.blueWidth),this.duanWeiPic&&(this.duanWeiPic.y=this.nameTextField.y+(this.nameTextField.height-17>>1)-11,this.blueInfo&&this.blueInfo.getIsBlueVip()?this.duanWeiPic.x=this.blueTextField.x-18-20:this.duanWeiPic.x=this.nameTextField.x-(this.nameTextField.width>>1)-50),this.duanWeiPic.scaleX=1,this.duanWeiPic.scaleY=1,this.duanWeiPic.touchEnabled=!1},i.prototype.simpleInitPosition=function(e,t,i){void 0===i&&(i=null),this.x=e,this.y=t,this.direction=4},i.prototype.simpleInitFromRoleData=function(i){this.roleType=i.type,this.isInBattle=!1,this.roleName=i.name,this.blueInfo=i.blueInfo,this.roleLevel=i.level,this.roleSex=i.sex,this.maxHp=Number(i.getAttributeValueByType(e.AttDefType.ATT_HP)),this.curHp=this.maxHp,this.isFreeWalk=!1,this.visible=!0,this.isDead=!1,this.hpBar=new e.BattleHPBar(e.RoleType.MAIN_ROLE),this.nameContainer.addChild(this.hpBar),this.hpTextField||(this.hpTextField=new egret.TextField,this.nameContainer.addChild(this.hpTextField),this.nameTextField=new egret.TextField,this.nameContainer.addChild(this.nameTextField),this.blueTextField=new eui.BitmapLabel,this.nameContainer.addChild(this.blueTextField)),null==this.duanWeiPic&&(this.duanWeiPic=new eui.Image,this.nameContainer.addChild(this.duanWeiPic)),null==this.unionNameTF&&(this.unionNameTF=new egret.TextField,this.nameContainer.addChild(this.unionNameTF)),this.modelController=e.ActionUtils.CreateRunUnitByRoleEntity(i,this.bodyNode),this.modelController.onCharLoaded=this.modelLoaded.bind(this),t.prototype.updateNameLab.call(this),t.prototype.updateHpWidget.call(this)},i.prototype.simpleInitFromMapPlayer=function(i){this.roleType=e.RoleType.MAIN_ROLE,this.isInBattle=!1,this.roleName=i.getPlayerName(),this.roleLevel=i.getPlayerLevel(),this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,i.getRoleItemId()),this.maxHp=Number(i.getMaxHp()||1),this.curHp=Number(i.getCurHp()),this.isFreeWalk=!1,this.visible=!0,this.isDead=!1,this.hpBar||(this.hpBar=new e.BattleHPBar(e.RoleType.MAIN_ROLE),this.nameContainer.addChild(this.hpBar)),this.hpTextField||(this.hpTextField=new egret.TextField,this.nameContainer.addChild(this.hpTextField),this.nameTextField=new egret.TextField,this.nameContainer.addChild(this.nameTextField),this.blueTextField=new eui.BitmapLabel,this.nameContainer.addChild(this.blueTextField)),null==this.duanWeiPic&&(this.duanWeiPic=new eui.Image,this.nameContainer.addChild(this.duanWeiPic)),null==this.unionNameTF&&(this.unionNameTF=new egret.TextField,this.nameContainer.addChild(this.unionNameTF)),this.modelController=e.ActionUtils.CreateActionInfoFromMapPlayer(i,this.bodyNode),this.modelController.onCharLoaded=this.modelLoaded.bind(this),t.prototype.updateNameLab.call(this),t.prototype.updateHpWidget.call(this)},i.prototype.simpleInitFromSimpleRole=function(t){if(t){this.simpleRole=t,this.hpTextField||(this.hpTextField=new egret.TextField,this.nameContainer.addChild(this.hpTextField)),this.nameTextField||(this.nameTextField=new egret.TextField,this.nameContainer.addChild(this.nameTextField)),this.blueTextField||(this.blueTextField=new eui.BitmapLabel,this.nameContainer.addChild(this.blueTextField)),this.duanWeiPic||(this.duanWeiPic=new eui.Image,this.nameContainer.addChild(this.duanWeiPic)),this.unionNameTF||(this.unionNameTF=new egret.TextField,this.nameContainer.addChild(this.unionNameTF)),t.getUnionName()?(this.unionNameTF.strokeColor=0,this.unionNameTF.stroke=1,this.unionNameTF.textColor=1096691,this.unionNameTF.size=18,this.unionNameTF.fontFamily="宋体",this.unionName=t.getUnionName(),this.unionNameTF.text=this.unionName,this.unionNameTF.anchorOffsetX=this.unionNameTF.width>>1,this.unionNameTF.y=this.nameTextField.y-this.unionNameTF.height):(this.unionNameTF.text="",this.unionNameTF.y=this.nameTextField.y),this.roleType=t.getType(),this.roleLevel=t.getLevel(),this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY||this.roleType==e.RoleType.BEAUTY?(this.roleName=t.getName(),this.blueInfo=t.getQqBlueInfo()):this.roleName="Lv"+this.roleLevel+t.getName(),this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,t.getRoleItemId()),this.maxHp=Number(t.getMaxHp()||1),this.curHp=Number(t.getCurrHp()||this.maxHp),this.isFreeWalk=!1,this.visible=!0,this.isDead=!1,this.isInBattle=!1,this.hpBar||(this.hpBar=new e.BattleHPBar(e.RoleType.MAIN_ROLE),this.nameContainer.addChild(this.hpBar));var i=t.getWardLevel();if(i){var n=e.JsonDataManager.instance.dragonGuardTemplate[i];0==t.getWardState()&&(i=0),0==i?(this.shadowImg.visible=!0,this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null)):(this.playAni(n.effect2),this.shadowImg.visible=!1)}if(1==t.getDragonArmourShowGuard()){var o=t.getDragonArmourGuardLevel();if(o){var a=e.JsonDataManager.instance.dragonArmorGuardTemplate[o];this.playArmorAni(a.effect2)}else this.playArmorAni("")}else this.playArmorAni("");this.updateNameLab(),this.updateHpWidget(),this.createAndChangeTitle(t.getTitleId())}},i.prototype.updateFromSimpleRole=function(t){if(t){t.getUnionName()?(this.unionNameTF.strokeColor=0,this.unionNameTF.stroke=1,this.unionNameTF.textColor=1096691,this.unionNameTF.size=18,this.unionNameTF.fontFamily="宋体",this.unionName=t.getUnionName(),this.unionNameTF.text=this.unionName,this.unionNameTF.anchorOffsetX=this.unionNameTF.width>>1,this.unionNameTF.y=this.nameTextField.y-this.unionNameTF.height):(this.unionNameTF.text="",this.unionNameTF.y=this.nameTextField.y),this.roleType=t.getType(),this.roleLevel=t.getLevel(),this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY||this.roleType==e.RoleType.BEAUTY?(this.roleName=t.getName(),this.blueInfo=t.getQqBlueInfo()):this.roleName="Lv"+this.roleLevel+t.getName(),this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,t.getRoleItemId()),this.maxHp=Number(t.getMaxHp()||1),this.curHp=Number(t.getCurrHp()||this.maxHp),this.updateNameLab(),this.updateHpWidget(),this.createAndChangeTitle(t.getTitleId());var i=t.getWardLevel();if(i){var n=e.JsonDataManager.instance.dragonGuardTemplate[i];0==t.getWardState()&&(i=0),0==i?(this.shadowImg.visible=!0,this.upStarAni&&(this.upStarAni.clear(),this.upStarAni=null)):(this.playAni(n.effect2),this.shadowImg.visible=!1)}if(1==t.getDragonArmourShowGuard()){var o=t.getDragonArmourGuardLevel();if(o){var a=e.JsonDataManager.instance.dragonArmorGuardTemplate[o];this.playArmorAni(a.effect2)}else this.playArmorAni("")}else this.playArmorAni("");this.simpleRole=t,this.modelController&&(this.setModelControllerEnable(!1),this.setModelControllerEnable(!0))}},i.prototype.updataDuanByPlayerLevel=function(t){if(this.simpleRole){var i=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_LIMIT"));if(i>t)this.duanWeiPic.source="";else{var n=this.simpleRole.getSegmentStar(),o=e.KFController.getInstance().getDuanByLevel(n);0>o?this.duanWeiPic.source="":(this.duanWeiPic.source="sceneDuan_"+o+"_png",this.setDuanTitlePosition())}}},i.prototype.updateActorRoleLook=function(t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);var o=!1,a=i,s=n;if(this.modelController){if(o=e.ActionUtils.IsRoleEntityActionControllerChanged(this.modelController.actionTable,t),!o)return!1;o=!0,a=this.modelController.desAction,s=this.modelController.desDirection,this.modelController.release(),this.modelController=null}return this.modelController=e.ActionUtils.CreateRunUnitByRoleEntity(t,this.bodyNode,a,s),this.modelController.onCharLoaded=this.modelLoaded.bind(this),o},i.prototype.updataPlayerDuanPic=function(t){var i=e.PlayerService.instance.mainRoleInfo.getLevel();if(i>=Number(e.GlobalConfig.instance.getValue("CS_ARENA_LEVEL_LIMIT"))){var n=e.KFController.getInstance().getDuanByLevel(t.getSegmentStar());this.duanWeiPic.source=n>=0?"sceneDuan_"+n+"_png":""}else this.duanWeiPic.source="";this.setDuanTitlePosition()},i.prototype.refreshArmor=function(t){if(t.getDragonArmourGuardLevel()){var i=e.JsonDataManager.instance.dragonArmorGuardTemplate[t.getDragonArmourGuardLevel()];t.getDragonArmourGuardLevel()&&1==t.getDragonArmourShowGuard()?this.playArmorAni(i.effect2):this.playArmorAni("")}},i.prototype.updateUnionName=function(t){t?(this.unionNameTF.strokeColor=0,this.unionNameTF.stroke=1,this.unionNameTF.textColor=1096691,this.unionNameTF.size=18,this.unionNameTF.fontFamily="宋体",this.unionName=t,this.unionNameTF.text=t,this.unionNameTF.anchorOffsetX=this.unionNameTF.width>>1,this.unionNameTF.y=this.nameTextField.y-this.unionNameTF.height):(this.unionNameTF.text="",this.unionNameTF.y=this.nameTextField.y),this.iUnitHeight=e.Global.actorInSceneShadowModelHeight,this.checkBodyClipBoundsChange()},i}(e.ActorInScene_Base);e.ActorInScene_Role=t,__reflect(t.prototype,"foxgame.ActorInScene_Role");var i=function(t){function i(i,n){var o=t.call(this)||this;return o.bodyClip.frameRate=10,o.weaponClip&&(o.weaponClip.frameRate=10),o.wingClip&&(o.wingClip.frameRate=10),i&&n&&(o.x=i.getInitPos().getX(),o.y=i.getInitPos().getY(),o.hpTextField||(o.hpTextField=new egret.TextField,o.nameContainer.addChild(o.hpTextField),o.nameTextField=new egret.TextField,o.nameContainer.addChild(o.nameTextField),o.blueTextField=new eui.BitmapLabel,o.nameContainer.addChild(o.blueTextField)),o.roleType=i.getRole().getType(),o.roleLevel=i.getRole().getLevel(),o.roleType==e.RoleType.MAIN_ROLE||o.roleType==e.RoleType.MERCENARY||o.roleType==e.RoleType.BEAUTY?(o.roleName=i.getRole().getName(),o.blueInfo=i.getRole().getQqBlueInfo()):o.roleName="Lv"+o.roleLevel+i.getRole().getName(),o.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(o.roleType,i.getRole().getRoleItemId()),o.updateBattleData(i,n),o.updateNameLab(),o.updateHpWidget()),o}return __extends(i,t),i.prototype.simpleInitPosition=function(e,t,i){void 0===i&&(i=null),this.x=e,this.y=t,this.direction=4},i.prototype.simpleInitFromMonsterId=function(i){this.roleType=e.RoleType.MONSTER,this.isInBattle=!1,this.maxHp=1,this.curHp=0,this.roleName="",this.roleLevel=1,this.isFreeWalk=!1,this.visible=!0,this.isDead=!1,this.hpBar||(this.hpBar=new e.BattleHPBar(e.RoleType.MONSTER),this.nameContainer.addChild(this.hpBar));var n=e.JsonDataManager.instance.monster[i];n&&(this.roleLevel=n.level,this.roleName="Lv"+this.roleLevel+n.name,0!=n.isBoss&&(this.isBOSS=!0),this.modelController=e.ActionUtils.CreateBattleUnitByMonsterId(i,this.bodyNode),this.modelController.onCharLoaded=this.modelLoaded.bind(this)),this.hpTextField||(this.hpTextField=new egret.TextField,this.nameContainer.addChild(this.hpTextField),this.nameTextField=new egret.TextField,this.nameContainer.addChild(this.nameTextField),this.blueTextField=new eui.BitmapLabel,this.nameContainer.addChild(this.blueTextField)),t.prototype.updateNameLab.call(this),t.prototype.updateHpWidget.call(this),this.moveSpeed=this.moveSpeed/3},i.prototype.simpleInitFromSimpleRole=function(t){t&&(this.simpleRole=t,this.hpTextField||(this.hpTextField=new egret.TextField,this.nameContainer.addChild(this.hpTextField),this.nameTextField=new egret.TextField,this.nameContainer.addChild(this.nameTextField),this.blueTextField=new eui.BitmapLabel,this.nameContainer.addChild(this.blueTextField)),this.roleType=t.getType(),this.roleLevel=t.getLevel(),this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY||this.roleType==e.RoleType.BEAUTY?(this.roleName=t.getName(),this.blueInfo=t.getQqBlueInfo()):this.roleName="Lv"+this.roleLevel+t.getName(),this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,t.getRoleItemId()),this.maxHp=Number(t.getMaxHp()||1),this.curHp=Number(t.getCurrHp()||this.maxHp),this.isFreeWalk=!1,this.visible=!0,this.isDead=!1,this.isInBattle=!1,this.hpBar||(this.hpBar=new e.BattleHPBar(e.RoleType.MAIN_ROLE),this.nameContainer.addChild(this.hpBar)),this.updateNameLab(),this.updateHpWidget())},i.prototype.updateFromSimpleRole=function(t){t&&(this.roleType=t.getType(),this.roleLevel=t.getLevel(),this.roleType==e.RoleType.MAIN_ROLE||this.roleType==e.RoleType.MERCENARY||this.roleType==e.RoleType.BEAUTY?(this.roleName=t.getName(),this.blueInfo=t.getQqBlueInfo()):this.roleName="Lv"+this.roleLevel+t.getName(),this.roleSex=e.CommonUtils.getRoleSexFromRoleItemId(this.roleType,t.getRoleItemId()),this.maxHp=Number(t.getMaxHp()||1),this.curHp=Number(t.getCurrHp()||this.maxHp),this.updateNameLab(),this.updateHpWidget(),this.simpleRole=t,this.modelController&&(this.setModelControllerEnable(!1),this.setModelControllerEnable(!0)))},i}(e.ActorInScene_Base);e.ActorInScene_Monster=i,__reflect(i.prototype,"foxgame.ActorInScene_Monster")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.skinName="BattleRoleHPBar",i.setActroType(e),i.name="BattleHPBar",i}return __extends(i,t),i.prototype.setActroType=function(t){t==e.RoleType.MAIN_ROLE?(this.red.visible=!1,this.green.visible=!0,this.blue.visible=!1,this.currentBar=this.green):(this.red.visible=!0,this.green.visible=!1,this.blue.visible=!1,this.currentBar=this.red)},i.prototype.setColor=function(e){switch(e){case"blue":this.blue.visible=!0,this.green.visible=!1,this.red.visible=!1,this.currentBar=this.blue;break;case"green":this.blue.visible=!1,this.green.visible=!0,this.red.visible=!1,this.currentBar=this.green;break;case"red":this.blue.visible=!1,this.green.visible=!1,this.red.visible=!0,this.currentBar=this.red}null!=this.percent&&this.setHpData(this.percent)},i.prototype.setHpData=function(e){this.currentBar.scaleX=e,this.percent=e},i.prototype.getHpData=function(){return this.currentBar.scaleX},i}(eui.Component);e.BattleHPBar=t,__reflect(t.prototype,"foxgame.BattleHPBar")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i,n,o,a,s){void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0);var r=t.call(this)||this;r.letterSpace=0,r.textObj=new e.FoxFont(r),r.imgObj=new eui.Image,r.addChild(r.imgObj),r.name="BattleMoveText",e.MapViewportGroupManager.instance.sceneView.uiTextNode.addChild(r),r.x=i.x,r.y=i.y,r.textObj.bitmapText.anchorOffsetX=r.textObj.bitmapText.width/2,r.textObj.bitmapText.anchorOffsetY=r.textObj.bitmapText.height/2;var l="",h="",c="";if(4==s?(l="yaojifightNumer",h="yaojifightbaojiNumer",c="YaoJi_BaoJi"):(l="shanghaishuzi",h="baojishuzi",c="baoji_png"),0==a)switch(o){case e.SkillEffect.SKILL_HARM:r.textObj.initAndShow(l,n),r.textObj.bitmapText.$setLetterSpacing(r.letterSpace),r.simpleMove();break;case e.SkillEffect.MISS_DMG:r.imgObj.source="shanbi_png",r.simpleMove();break;case e.SkillEffect.CRIT_DMG:r.imgObj.source=c,r.imgObj.x-=r.imgObj.width,r.imgObj.y-=5,r.textObj.initAndShow(h,n),r.textObj.bitmapText.$setLetterSpacing(r.letterSpace),r.simpleMove();break;case e.SkillEffect.ADD_HP:r.textObj.initAndShow("huixueshuzi","+"+n),r.textObj.bitmapText.$setLetterSpacing(r.letterSpace),r.simpleMove();break;case e.SkillEffect.MABI:r.imgObj.source="mabi_png",r.simpleMove();break;case e.SkillEffect.WUDI:r.imgObj.source="wudi_png",r.simpleMove();break;case e.SkillEffect.DEADLY_DMG:r.imgObj.source="zhimingyiji_png",r.simpleMove();break;case e.SkillEffect.ZHEN_SHE:r.imgObj.source="zhenshe_png",r.simpleMove();break;case e.SkillEffect.FAN_JI:r.imgObj.source="fanji_png",r.simpleMove();break;case e.SkillEffect.BU_QU:r.imgObj.source="buqu_png",r.simpleMove();break;case e.SkillEffect.ZI_BAO:r.imgObj.source="zibao_png",r.simpleMove();break;case e.SkillEffect.SI_ZHOU:r.imgObj.source="sizou_png",r.simpleMove();break;case e.SkillEffect.PO_JIA:r.imgObj.source="pojia_png",r.simpleMove();break;case e.SkillEffect.SHI_XUE:r.imgObj.source="shixue_png",r.simpleMove();break;case e.SkillEffect.ZAI_SHENG:r.textObj.initAndShow("huixueshuzi","+"+n),r.textObj.bitmapText.$setLetterSpacing(r.letterSpace),r.simpleMove()}else if(1==a)switch(o){case e.FightBuff.PARALYZED:r.imgObj.source="mabizhuangtai_png",r.simpleMove();break;case e.FightBuff.PROTECTIVE_SHIELD:r.imgObj.source="hutizhuangtai_png",r.simpleMove();break;case e.FightBuff.DMG_IMMUNITY:r.imgObj.source="wudizhuangtai_png",r.simpleMove()}return r}return __extends(i,t),i.prototype.init=function(t,i,n){void 0===n&&(n=0),this.x=t.x,this.y=t.y;switch(n){case e.SkillEffect.SKILL_HARM:this.textObj.initAndShow("shanghaishuzi",i),this.textObj.bitmapText.$setLetterSpacing(this.letterSpace),this.simpleMove();break;case e.SkillEffect.MISS_DMG:this.imgObj.source="shanbi_png",this.simpleMove();break;case e.SkillEffect.CRIT_DMG:this.imgObj.source="baoji_png",this.imgObj.x-=this.imgObj.width,this.imgObj.y-=5,this.textObj.initAndShow("baojishuzi",i),this.textObj.bitmapText.$setLetterSpacing(this.letterSpace),this.simpleMove();break;case e.SkillEffect.ADD_HP:this.textObj.initAndShow("huixueshuzi","+"+i),this.textObj.bitmapText.$setLetterSpacing(this.letterSpace),this.simpleMove()}},i.prototype.simpleMove=function(){var e=this;TweenMax.to(this,.4,{x:this.x+85,y:this.y-120,ease:Cubic.easeOut,onComplete:function(){TweenMax.to(e,.4,{onComplete:function(){TweenMax.to(e,.4,{alpha:0,scaleX:1.5,scaleY:1.5,y:e.y-50,onComplete:function(){TweenMax.killTweensOf(e),null!=e.parent&&(e.imgObj=null,e.textObj.dispose(),e.parent.removeChild(e))}})}})}})},i}(egret.DisplayObjectContainer);e.BattleMoveText=t,__reflect(t.prototype,"foxgame.BattleMoveText")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){this.id=Number(e.id),this.mapId=Number(e.mapId),e.content?this.content=e.content.split(";"):this.content=[]}return e}();e.MonstertalkVO=t,__reflect(t.prototype,"foxgame.MonstertalkVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.PARALYZED=26]="PARALYZED",e[e.PROTECTIVE_SHIELD=27]="PROTECTIVE_SHIELD",e[e.DMG_IMMUNITY=33]="DMG_IMMUNITY"}(t=e.FightBuff||(e.FightBuff={}));var i;!function(e){e[e.SKILL_HARM=1]="SKILL_HARM",e[e.CRIT_DMG=2]="CRIT_DMG",e[e.MISS_DMG=3]="MISS_DMG",e[e.ADD_HP=4]="ADD_HP",e[e.RECOVER=5]="RECOVER",e[e.MABI=6]="MABI",e[e.WUDI=7]="WUDI",e[e.HUTIDUN=8]="HUTIDUN",e[e.DEADLY_DMG=9]="DEADLY_DMG",e[e.SHEN_JUAN=10]="SHEN_JUAN",e[e.ZAI_SHENG=11]="ZAI_SHENG",e[e.ZHEN_SHE=12]="ZHEN_SHE",e[e.FAN_JI=13]="FAN_JI",e[e.BU_QU=14]="BU_QU",e[e.ZI_BAO=15]="ZI_BAO",e[e.SI_ZHOU=16]="SI_ZHOU",e[e.PO_JIA=17]="PO_JIA",e[e.SHI_XUE=18]="SHI_XUE"}(i=e.SkillEffect||(e.SkillEffect={}));var n;!function(e){e[e.SEARCH=0]="SEARCH",e[e.START=1]="START",e[e.BATTLING=3]="BATTLING",e[e.WIN=4]="WIN",e[e.LOSE=5]="LOSE",e[e.BEFOREEND=6]="BEFOREEND",e[e.END=7]="END",e[e.ERROR=8]="ERROR",e[e.WAITING=9]="WAITING",e[e.INTERRUPT=10]="INTERRUPT",e[e.BEFORESTART=11]="BEFORESTART",e[e.PICKUP=12]="PICKUP",e[e.CHANGETOWAIT=13]="CHANGETOWAIT",e[e.DOOR=14]="DOOR",e[e.POP=15]="POP",e[e.NONE=100]="NONE",e[e.NORMAL_START=101]="NORMAL_START",e[e.NORMAL_SEARCH=102]="NORMAL_SEARCH",e[e.NORMAL_BATTLING=103]="NORMAL_BATTLING",e[e.NORMAL_DROP=104]="NORMAL_DROP",e[e.NORMAL_END=105]="NORMAL_END",e[e.NORMAL_OVER=106]="NORMAL_OVER",e[e.CHALLENGE_START=111]="CHALLENGE_START",e[e.CHALLENGE_TRANS=112]="CHALLENGE_TRANS",e[e.CHALLENGE_BATTLING=113]="CHALLENGE_BATTLING",e[e.CHALLENGE_DROP=114]="CHALLENGE_DROP",e[e.CHALLENGE_POP=115]="CHALLENGE_POP",e[e.CHALLENGE_END=116]="CHALLENGE_END",e[e.CHALLENGE_DOOR=117]="CHALLENGE_DOOR",e[e.CHALLENGE_OVER=118]="CHALLENGE_OVER",e[e.YIJI_BATTLE=119]="YIJI_BATTLE",e[e.YIJI_MOVE=120]="YIJI_MOVE",e[e.YIJI_END=121]="YIJI_END",e[e.YIJI_DROP=122]="YIJI_DROP",e[e.YIJI_POP=123]="YIJI_POP"}(n=e.BattleState||(e.BattleState={}));var o;!function(e){e[e.MoveIn=0]="MoveIn",e[e.Idle=1]="Idle",e[e.Actioning=3]="Actioning",e[e.Delete=4]="Delete"}(o=e.UnitState||(e.UnitState={}));var a;!function(e){e[e.Feet=1]="Feet",e[e.Body=2]="Body",e[e.Head=3]="Head",e[e.BodyFront=4]="BodyFront",e[e.FeetFront=5]="FeetFront",e[e.BodyAside=6]="BodyAside",e[e.BodyMiddle=7]="BodyMiddle"}(a=e.BodyPosition||(e.BodyPosition={}));var s;!function(e){e[e.NORMAL_FIGHT=0]="NORMAL_FIGHT",e[e.TIAOZHAN_BOSS=1]="TIAOZHAN_BOSS",e[e.FRIEND_PK=2]="FRIEND_PK",e[e.ENEMY_PK=3]="ENEMY_PK",e[e.RANK_PK=4]="RANK_PK",e[e.ELITE_BOSS=5]="ELITE_BOSS",e[e.BATTLESHOW=6]="BATTLESHOW",e[e.FUBENQIEHUANG=7]="FUBENQIEHUANG",e[e.MAP_PK=8]="MAP_PK",e[e.PVE_BAOSHI_BOSS=9]="PVE_BAOSHI_BOSS",e[e.PVE_YAOSHI_BOSS=10]="PVE_YAOSHI_BOSS",e[e.PVE_BIANSHI_BOSS=11]="PVE_BIANSHI_BOSS",e[e.PVE_JINGPO_BOSS=12]="PVE_JINGPO_BOSS",e[e.PVE_HANGHUI_BOSS=13]="PVE_HANGHUI_BOSS"}(s=e.BATTLE_CHANGE_STATE||(e.BATTLE_CHANGE_STATE={}));var r=function(){function e(){}return e.BulletServerSpeed=2,e.egretHeartTick=1e3/30,e.BattlefieldWidth=400,e.RunningOffsetX=96,e.RunningOffsetY=48,e}();e.NewBattleDefine=r,__reflect(r.prototype,"foxgame.NewBattleDefine");var l;!function(e){e[e.MainCity=1]="MainCity",e[e.OldMonsterBattleMap=2]="OldMonsterBattleMap",e[e.OldBossBattleMap=3]="OldBossBattleMap",e[e.TwelvePalaceBossBattleMap=4]="TwelvePalaceBossBattleMap",e[e.UnionWarBattleMap=5]="UnionWarBattleMap",e[e.CrossServerBossBattleMap=6]="CrossServerBossBattleMap",e[e.GuideBattle=7]="GuideBattle",e[e.GuideMainCity=8]="GuideMainCity",e[e.CrossServerUnionSiegeMap=9]="CrossServerUnionSiegeMap"}(l=e.WorldSceneType||(e.WorldSceneType={}));var h;!function(e){e[e.ObjTypePlayer=1]="ObjTypePlayer",e[e.ObjTypeNpc=2]="ObjTypeNpc",e[e.ObjTypeMonster=3]="ObjTypeMonster"}(h=e.SceneObjectType||(e.SceneObjectType={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){},e}();e.AttDefVO=t,__reflect(t.prototype,"foxgame.AttDefVO");var i;!function(e){e[e.INT=1]="INT",e[e.NUMBER=2]="NUMBER"}(i=e.AttDefNumType||(e.AttDefNumType={}));var n;!function(e){e[e.ATT_HP=1]="ATT_HP",e[e.ATT_DMG=2]="ATT_DMG",e[e.ATT_DEF_PY=3]="ATT_DEF_PY",e[e.ATT_DEF_MAGIC=4]="ATT_DEF_MAGIC",e[e.ATT_HIT=5]="ATT_HIT",e[e.ATT_DODGE=6]="ATT_DODGE",e[e.ATT_CRITICAL=7]="ATT_CRITICAL",e[e.ATT_DEF_CRITICAL=8]="ATT_DEF_CRITICAL",e[e.ATT_BREAK_TANK=9]="ATT_BREAK_TANK",e[e.ATT_BREAK_MAGIC=10]="ATT_BREAK_MAGIC",e[e.ATT_BREAK_TAOIST=11]="ATT_BREAK_TAOIST",e[e.ATT_THROUGH_HIT=12]="ATT_THROUGH_HIT",e[e.ATT_THROUGH_SHIELD=13]="ATT_THROUGH_SHIELD",e[e.ATT_FIX_HIT_BUF=14]="ATT_FIX_HIT_BUF",e[e.ATT_FIX_HIT_DEF=15]="ATT_FIX_HIT_DEF",e[e.ATT_DIZZINESS_RATE=16]="ATT_DIZZINESS_RATE",e[e.ATT_SHIELD_POWER=17]="ATT_SHIELD_POWER",e[e.ATT_RECOVER_RATE=18]="ATT_RECOVER_RATE",e[e.ATT_DIZZINESS_DEF_RATE=19]="ATT_DIZZINESS_DEF_RATE",e[e.ATT_HIT_BUF=20]="ATT_HIT_BUF",e[e.ATT_HIT_DEF=21]="ATT_HIT_DEF",e[e.ATT_HP_BUF=22]="ATT_HP_BUF",e[e.ATT_DEF_PY_BUF=23]="ATT_DEF_PY_BUF",e[e.ATT_DEF_MAGIC_BUF=24]="ATT_DEF_MAGIC_BUF",e[e.ATT_DMG_BUF=25]="ATT_DMG_BUF",e[e.ATT_DIZZINESS_TIME=26]="ATT_DIZZINESS_TIME",e[e.ATT_RELIVE_BUFF_TIME=27]="ATT_RELIVE_BUFF_TIME",e[e.ATT_CRITICAL_BUF=28]="ATT_CRITICAL_BUF",e[e.ATT_DEF_CRITICAL_BUF=29]="ATT_DEF_CRITICAL_BUF",e[e.ATT_HIT_RATE_BUF=30]="ATT_HIT_RATE_BUF",e[e.ATT_DODGE_BUF=31]="ATT_DODGE_BUF",e[e.ATT_SOUL_TANK_SKILL_BUF=32]="ATT_SOUL_TANK_SKILL_BUF",e[e.ATT_SOUL_MAGIC_THRUNDR_BUF=33]="ATT_SOUL_MAGIC_THRUNDR_BUF",e[e.ATT_SOUL_TAOIST_MC_BUF=34]="ATT_SOUL_TAOIST_MC_BUF",e[e.ATT_SOUL_MAGIC_SHIELD_DBUF=35]="ATT_SOUL_MAGIC_SHIELD_DBUF",e[e.ATT_SOUL_MONSTER_DBUF=36]="ATT_SOUL_MONSTER_DBUF",e[e.ATT_SOUL_DEF_DBUF=37]="ATT_SOUL_DEF_DBUF",e[e.FIGHT_HP=113]="FIGHT_HP",e[e.FIGHT_SHIELD_POWER=114]="FIGHT_SHIELD_POWER"}(n=e.AttDefType||(e.AttDefType={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){if(null!=e){var t=e.split("_");"10000"==t[0]?(this.type=parseInt(t[1]),this.id=parseInt(t[1]),this.value=parseInt(t[2])):("30000"==t[0]||"40000"==t[0]||"50000"==t[0]||"60000"==t[0]||"70000"==t[0]||"80000"==t[0])&&(this.type=parseInt(t[0]),this.id=parseInt(t[1]),this.value=parseInt(t[2]))}}return e}();e.AttributeVO=t,__reflect(t.prototype,"foxgame.AttributeVO");var i;!function(e){e[e.DIAMOND=1001]="DIAMOND",e[e.COIN=1002]="COIN",e[e.EXP=1004]="EXP",e[e.SOUL=1024]="SOUL",e[e.PKHONOR=1025]="PKHONOR",e[e.ITEM=3e4]="ITEM",e[e.EQUIP=4e4]="EQUIP",e[e.LONGGU=5e4]="LONGGU",e[e.LONGJIA=6e4]="LONGJIA",e[e.YAOJI=7e4]="YAOJI"}(i=e.AttributeType||(e.AttributeType={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.parserMap=new e.HashMap,this.initParser()}return t.prototype.getParser=function(e){return this.parserMap.get(e)},t.prototype.initParser=function(){this.parserMap.put("guide",new e.ParserEntity("foxgame.GuideEntity","guide",1,"id")),this.parserMap.put("map",new e.ParserEntity("foxgame.BattleMapVO","map",1,"id")),this.parserMap.put("skill",new e.ParserEntity("foxgame.SkillVO","skill",2)),this.parserMap.put("buff",new e.ParserEntity("foxgame.BattleBuffVO","buff",1,"id")),this.parserMap.put("roleLevelExp",new e.ParserEntity("foxgame.RoleLevelExpVO","roleLevelExp",1,"level")),this.parserMap.put("FightLogConfig",new e.ParserEntity("","FightLogConfig",0)),this.parserMap.put("mission",new e.ParserEntity("foxgame.MissionVO","mission",1,"id")),this.parserMap.put("equipEnhance",new e.ParserEntity("foxgame.EquipEnhanceVO","equipStrength",1,"id")),this.parserMap.put("equipEnhanceRatio",new e.ParserEntity("foxgame.EquipEnhanceRatioVO","equipStrengthRatio",2)),this.parserMap.put("MailIdConfig",new e.ParserEntity("","MailIdConfig",0)),this.parserMap.put("ShopRefreshCost",new e.ParserEntity("foxgame.ShopRefreshCostVO","ShopRefreshCost",1,"count")),this.parserMap.put("ErrorCode",new e.ParserEntity("foxgame.ErrorCodeVO","ErrorCode",1,"id")),this.parserMap.put("vipPrivilege",new e.ParserEntity("foxgame.VipPrivilegeVO","vipPrivilege",1,"level")),this.parserMap.put("PlayerTitle",new e.ParserEntity("foxgame.PlayerTitleVO","PlayerTitle",1,"id")),this.parserMap.put("SkillOpenCfg",new e.ParserEntity("foxgame.SkillOpenCfgVO","SkillOpenCfg",2)),this.parserMap.put("MercenarySkillOpenCfg",new e.ParserEntity("foxgame.MercenarySkillOpenCfgVO","MercenarySkillOpenCfg",2)),this.parserMap.put("reward",new e.ParserEntity("foxgame.RewardVO","reward",1,"id")),this.parserMap.put("godlyAttr",new e.ParserEntity("foxgame.GodlyAttVO","godlyAttr",1,"attId")),this.parserMap.put("godlyLevelExp",new e.ParserEntity("foxgame.GodlyLevelExpVO","godlyLevelExp",2)),this.parserMap.put("godlyEquip",new e.ParserEntity("foxgame.GodlyEquipVO","godlyEquip",2)),this.parserMap.put("FreeTypeFont",new e.ParserEntity("","FreeTypeFont",0)),this.parserMap.put("battleParameter",new e.ParserEntity("foxgame.BattleParameterVO","battleParameter",2)),this.parserMap.put("EliteMapCfg",new e.ParserEntity("foxgame.EliteMapCfgVO","EliteMapCfg",1,"mapId")),this.parserMap.put("eliteMapLevelIndex",new e.ParserEntity("foxgame.EliteMapLevelIndexVO","eliteMapLevelIndex",2)),this.parserMap.put("starLevelExp",new e.ParserEntity("foxgame.StarLevelExpVO","starLevelExp",2)),this.parserMap.put("ring",new e.ParserEntity("foxgame.AuraVO","ring",2)),this.parserMap.put("VipWelfare",new e.ParserEntity("foxgame.VipWelfareVO","VipWelfare",2)),this.parserMap.put("TeamBattleKick",new e.ParserEntity("foxgame.TeamBattleKickVO","TeamBattleKick",2)),this.parserMap.put("CampWarWinStreak",new e.ParserEntity("foxgame.CampWarWinStreakVO","campWarWinStreak",1,"winStreak")),this.parserMap.put("alliance",new e.ParserEntity("foxgame.GuildBossVo","alliance",1,"id")),this.parserMap.put("activityDayLogin",new e.ParserEntity("foxgame.ActivityDayLoginVO","activityDayLogin",1,"day"))
},t}();e.MainParser=t,__reflect(t.prototype,"foxgame.MainParser")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RareAttrVO=t,__reflect(t.prototype,"foxgame.RareAttrVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.name=e[1],this.isGain="1"==e[2]?!0:!1,this.isShow="1"==e[3]?!0:!1,this.effectId=parseInt(e[4]),this.privority=parseInt(e[5])},e}();e.BattleBuffVO=t,__reflect(t.prototype,"foxgame.BattleBuffVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){throw new Error("not use")}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.name=e[1],this.bossId=parseInt(e[2]),this.iconPath=e[3],this.lvArea=e[4],this.dropRate=parseInt(e[5]),this.mapGroup=parseInt(e[6]);var t=e[7].substring(7,17);this.battleIcon=t,this.zoomRate=parseFloat(e[8]),this.rotation=parseInt(e[9])},e}();e.BattleMapVO=t,__reflect(t.prototype,"foxgame.BattleMapVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.level=parseInt(e[0]),this.attId105=parseInt(e[1]),this.attId106=parseInt(e[2]),this.attId107=parseInt(e[3]),this.attId108=parseInt(e[4]),this.attId111=parseInt(e[5]),this.attId109=parseInt(e[6]),this.attId110=parseInt(e[7]),this.attId1007=parseInt(e[8]),this.attId2103=parseInt(e[9]),this.attId2104=parseInt(e[10])},e}();e.BattleParameterVO=t,__reflect(t.prototype,"foxgame.BattleParameterVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.mapId=parseInt(e[0]),this.group=parseInt(e[1]),this.levelIndex=parseInt(e[2]),this.levelLimit=parseInt(e[3]),this.nextMapId=parseInt(e[4]),this.dependMap=parseInt(e[5]),this.rewardItem=e[6],this.monsterId=parseInt(e[7]),this.name=e[8],this.monsterLevel=parseInt(e[9]),this.isBoss=parseInt(e[10]),this.quality=parseInt(e[11]),this.stageName=e[12],this.exp=parseInt(e[13]),this.coin=parseInt(e[14]),this.monster0=parseInt(e[15]),this.monster1=parseInt(e[16]),this.monster2=parseInt(e[17])},e}();e.EliteMapCfgVO=t,__reflect(t.prototype,"foxgame.EliteMapCfgVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.level=parseInt(e[0]),this.index=parseInt(e[1])},e}();e.EliteMapLevelIndexVO=t,__reflect(t.prototype,"foxgame.EliteMapLevelIndexVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.typeId=parseInt(e.typeId),this.name=e.name,this.iconStr=e.icon,this.skipType=parseInt(e.skipType),this.turnId=parseInt(e.turnId)},e}();e.FightDefeatVO=t,__reflect(t.prototype,"foxgame.FightDefeatVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.level=parseInt(e[1])},e}();e.MercenarySkillOpenCfgVO=t,__reflect(t.prototype,"foxgame.MercenarySkillOpenCfgVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.profession=parseInt(e[1]),this.level=parseInt(e[2]),this.name=e[3],this.skills=e[4],this.iconPath=e[5],this.type=parseInt(e[6]),this.spineId=parseInt(e[7]),this.modelId=parseInt(e[8]),this.modelScale=parseInt(e[9]),this.effectType=parseInt(e[10])},e}();e.MonsterVO=t,__reflect(t.prototype,"foxgame.MonsterVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.BuffVO=t,__reflect(t.prototype,"foxgame.BuffVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.EffectVO=t,__reflect(t.prototype,"foxgame.EffectVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.type=parseInt(e[1]),this["class"]=parseInt(e[2]),this.ratio=parseFloat(e[3])},e}();e.EquipEnhanceRatioVO=t,__reflect(t.prototype,"foxgame.EquipEnhanceRatioVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]);var t,i=e[1],n=i.split(","),o=n.length;for(this.primaryAttrValues=[],t=0;o>t;t++)this.primaryAttrValues[t]=parseInt(n[t])},e}();e.EquipEnhanceVO=t,__reflect(t.prototype,"foxgame.EquipEnhanceVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.EquipGongMingLevelVO=t,__reflect(t.prototype,"foxgame.EquipGongMingLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.EquipGongMingLinkVO=t,__reflect(t.prototype,"foxgame.EquipGongMingLinkVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.EquipLinkAttVO=t,__reflect(t.prototype,"foxgame.EquipLinkAttVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.EquipmentUpgradeVO=t,__reflect(t.prototype,"foxgame.EquipmentUpgradeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.partList=[],this.attrTypeList=[],this.attrValueList=[],this.attrAddMiniValueList=[],this.attrAddMaxValueList=[],this.evolutionItemIdList=[],this.evolutionNumList=[],this.decomposeList=[],this.modelIdList=[]}return t.prototype.init=function(t){this.id=Number(t.id),this.partName=t.partName,this.name=t.name,this.rareGroupId=Number(t.rareGroupId);for(var i=t.part.split(","),n=0;n<i.length;n++)this.partList.push(Number(i[n]));this.quality=Number(t.quality),this.level=Number(t.level),this.profession=Number(t.profession),this.smeltGain=Number(t.smeltGain),this.forgeSmeltNeed=Number(t.forgeSmeltNeed),this.washCoinCost=Number(t.washCoinCost);var o,a=t.equipAttr.split(",");this.attrTypeList=[],this.attrValueList=[];for(var n=0;n<a.length;n++)o=a[n].split("_"),this.attrTypeList.push(Number(o[0])),this.attrValueList.push(Number(o[1])),this.attrAddMiniValueList.push(Number(o[2])),this.attrAddMaxValueList.push(Number(o[3]));this.starLevel=Number(t.starLevel),this.suitId=Number(t.suitId),this.evolutionStuff=t.evolution;for(var s=t.decompose?t.decompose:"",r=s.split(","),n=0;n<r.length;n++)this.decomposeList.push(new e.AttributeVO(r[n]));this.evolutionId=Number(t.evolutionTargetId);for(var l=t.modelId?t.modelId:"",h=l.split(","),n=0;n<h.length;n++)this.modelIdList[n]=Number(h[n])},t.prototype.checkPartMatch=function(e){for(var t,i=0;i<e.length;i++)if(t=e[i],-1!=this.partList.indexOf(t))return!0;return!1},t.prototype.getModelId=function(t){return void 0===t&&(t=0),t==e.RoleSexType.MAN||0==t?this.modelIdList[0]:t==e.RoleSexType.WOMAN?this.modelIdList[1]:void 0},t}();e.EquipVO=t,__reflect(t.prototype,"foxgame.EquipVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.attId=parseInt(e[1]);var t,i=e[2],n=i.split(","),o=n.length;for(this.enhanceExtraAtt=[],t=0;o>t;t++)this.enhanceExtraAtt[t]=parseInt(n[t]);this.basicAtt=parseInt(e[3]),this.extraAttPerLevel=parseInt(e[4])},e}();e.GodlyAttVO=t,__reflect(t.prototype,"foxgame.GodlyAttVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.GodlyEquipInlayVO=t,__reflect(t.prototype,"foxgame.GodlyEquipInlayVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.score=-1}return t.prototype.getScore=function(){if(-1==this.score){var t=e.JsonDataManager.instance.equipTemplate,i=t[this.id],n=e.JsonDataManager.instance.rareAttrTemplate,o=n[i.rareGroupId],a=i.attrTypeList,s=i.attrValueList,r=[],l=[],h=void 0,c=void 0,u=o.length;for(c=0;u>c;c++)h=o[c],r.push(h.attId),l.push(h.intensifyMaxVal);this.score=e.GlobalUtil.getScore(a,s,null,null,r,l)}return this.score},t}();e.GodlyEquipVO=t,__reflect(t.prototype,"foxgame.GodlyEquipVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.level=parseInt(e[0]),this.exp=parseInt(e[1]),this.exp2=parseInt(e[2])},e}();e.GodlyLevelExpVO=t,__reflect(t.prototype,"foxgame.GodlyLevelExpVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.PartStoneAttBufVO=t,__reflect(t.prototype,"foxgame.PartStoneAttBufVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.PartStoneAttVO=t,__reflect(t.prototype,"foxgame.PartStoneAttVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.getStoneList=function(){return[this.stone1Id,this.stone2Id,this.stone3Id,this.stone4Id]},e}();e.PartStoneVO=t,__reflect(t.prototype,"foxgame.PartStoneVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RareAttrStarVO=t,__reflect(t.prototype,"foxgame.RareAttrStarVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.name=e[1],this.level=parseInt(e[2]),this.contribution=parseInt(e[3]),this.nameIndex=parseInt(e[4]),this.hp=parseInt(e[5])},e}();e.GuildBossVo=t,__reflect(t.prototype,"foxgame.GuildBossVo",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.condition=parseInt(e[1]),this.itemInfo=e[2],this.itemId=parseInt(e[3]),this.iconPath=e[4]},e}();e.HalfRewardItemVO=t,__reflect(t.prototype,"foxgame.HalfRewardItemVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.ItemVO=t,__reflect(t.prototype,"foxgame.ItemVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.count=parseInt(e[0]),this.price=parseInt(e[1])},e}();e.ShopRefreshCostVO=t,__reflect(t.prototype,"foxgame.ShopRefreshCostVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MailVO=t,__reflect(t.prototype,"foxgame.MailVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.globalCfg={},this.globalCfg=e.JsonDataManager.instance.globalTemplate,null==this.globalCfg?console.log("this.globalCfg null"):console.log("this.globalCfg 正常")}return t.prototype.getValue=function(e){return this.globalCfg[e]?this.globalCfg[e]:""},Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();e.GlobalConfig=t,__reflect(t.prototype,"foxgame.GlobalConfig")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MfsqHBVO=t,__reflect(t.prototype,"foxgame.MfsqHBVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.PKPrizeVO=t,__reflect(t.prototype,"foxgame.PKPrizeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.PKRankPrizeVO=t,__reflect(t.prototype,"foxgame.PKRankPrizeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.PrisonerVO=t,__reflect(t.prototype,"foxgame.PrisonerVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.winStreak=parseInt(e[1]),this.winCoinsRatio=parseInt(e[2]),this.winReputation=parseInt(e[3]),this.loseCoinsRatio=parseInt(e[4]),this.loseReputation=parseInt(e[5])},e}();e.CampWarWinStreakVO=t,__reflect(t.prototype,"foxgame.CampWarWinStreakVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.count=parseInt(e[0]),this.kickCost=parseInt(e[1])},e}();e.TeamBattleKickVO=t,__reflect(t.prototype,"foxgame.TeamBattleKickVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RankRewardVO=t,__reflect(t.prototype,"foxgame.RankRewardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RankVO=t,__reflect(t.prototype,"foxgame.RankVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.FirstRechargeRewardVO=t,__reflect(t.prototype,"foxgame.FirstRechargeRewardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.Recharge1758VO=t,__reflect(t.prototype,"foxgame.Recharge1758VO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargehaiwanVO=t,__reflect(t.prototype,"foxgame.RechargehaiwanVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeJiuXiuVo=t,__reflect(t.prototype,"foxgame.RechargeJiuXiuVo")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeljinjunVO=t,__reflect(t.prototype,"foxgame.RechargeljinjunVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeVO=t,__reflect(t.prototype,"foxgame.RechargeVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeWanBaQLDVO=t,__reflect(t.prototype,"foxgame.RechargeWanBaQLDVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeWanbaVO=t,__reflect(t.prototype,"foxgame.RechargeWanbaVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RechargeXYWVO=t,__reflect(t.prototype,"foxgame.RechargeXYWVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.rewardItems=e[1]},e}();e.RewardVO=t,__reflect(t.prototype,"foxgame.RewardVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.rewardItems=e[1]},e}();e.VipWelfareVO=t,__reflect(t.prototype,"foxgame.VipWelfareVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.day=parseInt(e[0]),this.content=e[1]},e}();e.ActivityDayLoginVO=t,__reflect(t.prototype,"foxgame.ActivityDayLoginVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.roleItemId=parseInt(e[1]),this.activeStarLevel=parseInt(e[2]),this.activeCost=parseInt(e[3]),this.name=e[4],this.effectDesc=e[5],this.picPath=e[6],this.activeConditionDesc=e[7]},e}();e.AuraVO=t,__reflect(t.prototype,"foxgame.AuraVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.name=e[1],this.type=parseInt(e[2]),this.award=e[3],this.iconPath=e[4],this.desc=e[5]},e}();e.MissionVO=t,__reflect(t.prototype,"foxgame.MissionVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.ModelVO=t,__reflect(t.prototype,"foxgame.ModelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.NameVO=t,__reflect(t.prototype,"foxgame.NameVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.name=e[1],this.describe=e[2],this.type=parseInt(e[3]),this.picPath=e[4].replace("UI/Program/",""),this.picPath=this.picPath.replace(".png",""),this.BGPath=e[5].replace("UI/Program/",""),this.BGPath=this.BGPath.replace(".png",""),this.picForChat=e[6].replace("UI/Program/",""),this.picForChat=this.picForChat.replace(".png","")},e}();e.PlayerTitleVO=t,__reflect(t.prototype,"foxgame.PlayerTitleVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RoleLevelVO=t,__reflect(t.prototype,"foxgame.RoleLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.RoleVO=t,__reflect(t.prototype,"foxgame.RoleVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.itemId=parseInt(e[1]),this.starLevel=parseInt(e[2]),this.exp=parseInt(e[3]),this.hitAddition=parseInt(e[4]),this.dodgeAddition=parseInt(e[5]),this.criticalAddition=parseInt(e[6]),this.resilienceAddition=parseInt(e[7]),this.phyDefAddition=parseInt(e[8]),this.magDefAddition=parseInt(e[9]),this.hpAddition=parseInt(e[10]),this.dmgAddition=parseInt(e[11]),this.mpAddition=parseInt(e[12])},e}();e.StarLevelExpVO=t,__reflect(t.prototype,"foxgame.StarLevelExpVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.level=parseInt(e[0]),this.require=parseInt(e[1]),this.bagContainers=parseInt(e[2]),this.shopItemCount=parseInt(e[3]),this.buyCoinCount=parseInt(e[4]),this.quickFightCount=parseInt(e[5]),this.fightBossCount=parseInt(e[6]),this.buyFightBossCount=parseInt(e[7]),this.bossReaward=e[8],this.mercenaryDevelop=parseInt(e[9]),this.sweepBoss=parseInt(e[10]),this.guildBoss=parseInt(e[11]),this.eliteFightTimes=parseInt(e[12]),this.eliteFightBuyTimes=parseInt(e[13]),this.soulStone=parseInt(e[14]),this.quickFightExp=parseInt(e[15]),this.multiEliteBuyTimes=parseInt(e[16]),this.pkTimes=parseInt(e[17]),this.pkBuyTimes=parseInt(e[18]),this.lockEquip=parseInt(e[19]),this.maxMineCount=parseInt(e[20]),this.onAkeyToUpgrade=parseInt(e[21]),this.buyAdventureEnergy=parseInt(e[22]),this.accuseTokenMaxBuyCount=parseInt(e[23]),this.yewaiBossTimes=parseInt(e[24]),this.yewaiBossBuyTimes=parseInt(e[25]),this.mijingBossTimes=parseInt(e[26]),this.mijingBossBuyTimes=parseInt(e[7]),this.huanshouBossTimes=parseInt(e[28]),this.huanshouBossBuyTimes=parseInt(e[29]),this.lilianBossTimes=parseInt(e[30]),this.lilianBossBuyTimes=parseInt(e[31])},e}();e.VipPrivilegeVO=t,__reflect(t.prototype,"foxgame.VipPrivilegeVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SearchTreasureVO=t,__reflect(t.prototype,"foxgame.SearchTreasureVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.itemID=parseInt(e.itemID),this.price=parseInt(e.price),this.priceType=parseInt(e.priceType),this.itemType=Number(e.itemType)},e}();e.ToolShopVO=t,__reflect(t.prototype,"foxgame.ToolShopVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SkillEffectVO=t,__reflect(t.prototype,"foxgame.SkillEffectVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SkillLevelVO=t,__reflect(t.prototype,"foxgame.SkillLevelVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SoulGrooveVO=t,__reflect(t.prototype,"foxgame.SoulGrooveVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SoulHuntVO=t,__reflect(t.prototype,"foxgame.SoulHuntVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SoulVO=t,__reflect(t.prototype,"foxgame.SoulVO");var i;!function(e){e[e.CANHUN=18]="CANHUN",e[e.EXPSOUL=19]="EXPSOUL"}(i=e.SoulType||(e.SoulType={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.SpecialRingVO=t,__reflect(t.prototype,"foxgame.SpecialRingVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.id=parseInt(e[0]),this.content=e[1]},e}();e.ErrorCodeVO=t,__reflect(t.prototype,"foxgame.ErrorCodeVO",["foxgame.IParser"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.MainMissionVO=t,__reflect(t.prototype,"foxgame.MainMissionVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.prototype.getMonsterVO=function(){return null==this.monsterVO&&(this.monsterVO=e.JsonDataManager.instance.monster[this.bossId]),this.monsterVO},t}();e.UnionBossVO=t,__reflect(t.prototype,"foxgame.UnionBossVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.UnionLimitsVO=t,__reflect(t.prototype,"foxgame.UnionLimitsVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.UnionPositionVO=t,__reflect(t.prototype,"foxgame.UnionPositionVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.TYPE1=1]="TYPE1",e[e.TYPE2=2]="TYPE2",e[e.TYPE3=3]="TYPE3"}(t=e.WanFaCountType||(e.WanFaCountType={}));var i=function(){function e(){}return e}();e.WanFaVO=i,__reflect(i.prototype,"foxgame.WanFaVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.WingUpStarVO=t,__reflect(t.prototype,"foxgame.WingUpStarVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.WingVO=t,__reflect(t.prototype,"foxgame.WingVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.WorldBossAwardVO=t,__reflect(t.prototype,"foxgame.WorldBossAwardVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(){}return e}();e.WorldBossVO=t,__reflect(t.prototype,"foxgame.WorldBossVO")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.pfAppID="",this.baseUrl="",this.appId=0,this.isTest=!1,this.prefix="test_",this.uid="",this.puid="",this.username="",this.gameUid="",this.session="",this.userInfoData=null,this.token=null,this.reserved=null,this.callback=null,this.thisObject=null,this.game_id=null,this.chanel="",this.appId=e.appIdType.test;var t;"function"==typeof checkPlatform&&(t=checkPlatform()),t&&(this.pfName=t.pfName,this.pfAppID=t.pfAppID,this.appId=t.appId,this.isTest=t.isTest)}return t.prototype.reqServerList=function(t,i,n){function o(e){t.call(n,e)}function a(i,h,c){console.error("reqServerList error..."),l++,3>l?e.GameUtils.httpReqsajax(r,s,o,a):t.call(n,null)}var s={};s.appid=this.appId,e.Global.isAppStoreReview&&(s.appid=105),s.puid=i;var r=this.baseUrl+"?cb=?&puid="+s.puid+"&time="+(new Date).getTime()+"&",l=0;window.egret_quickgame?e.GameUtils.httpReqsajax(r,"",o,a):e.GameUtils.httpReqsajax(r,s,o,a)},t.prototype.reqUserInfo=function(t,i){"function"==typeof checkLogin&&(this.userInfoData=checkLogin(),e.ActivityBarController.getInstance().recordPF(this.userInfoData.prefix));var n=this;if(this.userInfoData.chanel&&(this.chanel=this.userInfoData.chanel),-1!=this.userInfoData.prefix.indexOf("xbtxlbqkl"))return this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.state=this.userInfoData.state,this.scopes=this.userInfoData.scopes,this.device=this.userInfoData.device,this.domain=this.userInfoData.domain,void this.loginByxbtxlbqkl();if(-1!=this.userInfoData.prefix.indexOf("lingo666"))return this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.uid=this.userInfoData.uid,this.username=this.userInfoData.username,this.appKey=this.userInfoData.appKey,this.stime=this.userInfoData.stime,void this.lingo666login();if(-1!=this.userInfoData.prefix.indexOf("1sdk"))return this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.sid=this.userInfoData.sid,this.clientId=this.userInfoData.channel_id,this.hlmy_gw=this.userInfoData.hlmy_gw,void this.sdk1login();if(-1!=this.userInfoData.prefix.indexOf("yjyxf"))return this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.sid=this.userInfoData.sid,this.clientId=this.userInfoData.channel_id,this.hlmy_gw=this.userInfoData.hlmy_gw,void this.yjyxflogin();if(-1!=this.userInfoData.prefix.indexOf("5wan"))return this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.appKey=this.userInfoData.appKey,void this.fivewanlogin();if(-1!=this.userInfoData.prefix.indexOf("x7app"))return this.token=this.userInfoData.token,this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.appKey=this.userInfoData.appKey,this.pid=this.userInfoData.pid,void this.xqapplogin();if(-1!=this.userInfoData.prefix.indexOf("youguand"))return this.uid=this.userInfoData.token,this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.puid=this.userInfoData.channel_id,this.uid=this.userInfoData.uid,this.token=this.userInfoData.token,void this.yougulogin();if("wifi_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.callback=t,this.thisObject=i,void this.loginwifi();if("6wwy_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.uid=this.userInfoData.uid,this.callback=t,this.thisObject=i,void this.login6wwy();if("cyqdand_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.uid=this.userInfoData.uid,this.callback=t,this.thisObject=i,void this.loginqidian();if("cycs_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.uid=this.userInfoData.uid,this.callback=t,this.thisObject=i,void this.logincycs();if("x7js_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.game_id=this.userInfoData.appKey,this.stime=this.userInfoData.stime,this.ticket=this.userInfoData.ticket,this.sign=this.userInfoData.sign,this.callback=t,this.thisObject=i,void this.loginx7js();if("333h5_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.callback=t,this.game_id=this.userInfoData.gameId,this.stime=this.userInfoData.stime,this.username=this.userInfoData.username,this.sign=this.userInfoData.sign,this.uid=this.userInfoData.uid,this.thisObject=i,void this.login333h5();if(this.userInfoData.via&&(this.via=this.userInfoData.via),"mscjzy_"==this.userInfoData.prefix)return this.prefix=this.userInfoData.prefix,this.uid=this.userInfoData.uid,this.token=this.userInfoData.token,this.sign=this.userInfoData.sign,this.thisObject=i,this.callback=t,void this.login5432u();if("wanba_ts_"==this.userInfoData.prefix){this.wanbaStr=this.userInfoData.wanbaStr,this.prefix=this.userInfoData.prefix,this.uid=this.userInfoData.uid,this.game_id=this.userInfoData.gameId,this.appKey=this.userInfoData.appKey,this.gift_id=Number(this.userInfoData.gift_id),this.isFollowingAccount=this.userInfoData.isFollowingAccount,Log.trace(this.uid+"*"+this.puid),this.callback=t;var o=egret.Capabilities.os,a=1;return"Android"==egret.Capabilities.os?(o="android",a=1):"iOS"==egret.Capabilities.os&&(o="ios",a=2),Log.trace("系统："+egret.Capabilities.os),this.puid=this.prefix+this.uid+"_"+o,this.zoneId=a.toString(),this.thisObject=i,void this.loginWanBa()}return this.userInfoData.gift_id&&(this.gift_id=this.userInfoData.gift_id),"haiwan_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.callback=t,this.game_id=this.userInfoData.gameId,this.stime=this.userInfoData.stime,this.sign=this.userInfoData.sign,this.uid=this.userInfoData.uid,this.appKey=this.userInfoData.appKey,this.thisObject=i,void this.loginhaiwan()):"jinjun_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.callback=t,this.game_id=this.userInfoData.appKey,this.username=this.userInfoData.username,this.sign=this.userInfoData.sign,this.uid=this.userInfoData.uid,this.thisObject=i,void this.jinjunlogin()):"mlqld_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.callback=t,this.game_id=this.userInfoData.appKey,this.username=this.userInfoData.username,this.sign=this.userInfoData.sign,this.uid=this.userInfoData.uid,this.thisObject=i,this.puid=this.prefix+this.uid,console.log("mlqld_"+this.prefix,this.puid,this.thisObject),void this.callback.call(this.thisObject)):"leyouxf"==this.userInfoData.chanel?(this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.callback=t,this.game_id=this.userInfoData.appKey,this.username=this.userInfoData.username,this.uid=this.userInfoData.uid,this.thisObject=i,void this.leyouxflogin()):"anqu"==this.userInfoData.chanel?(this.prefix=this.userInfoData.prefix,this.callback=t,this.game_id=this.userInfoData.appKey,this.uid=this.userInfoData.uid,this.thisObject=i,this.cpid=this.userInfoData.cpid,this.puid=this.prefix+this.uid,void this.anqulogin()):"gyyx_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.callback=t,this.game_id=this.userInfoData.appKey,this.thisObject=i,this.sign=this.userInfoData.sign,this.signType=this.userInfoData.signType,this.signg=this.userInfoData.signg,this.mType=this.userInfoData.mType,this.fp=this.userInfoData.fp,this.clientId=this.userInfoData.clientId,void this.gyyxlogin()):"iyouzu_"==this.userInfoData.prefix?(this.sid=this.userInfoData.sid,this.pid=this.userInfoData.pid,this.sign=this.userInfoData.sign,void this.iyouzulogin()):"cycqjiuxiu_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.callback=t,this.thisObject=i,this.uid=this.userInfoData.uid,void this.jiuxiuLogin()):"uuuo_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.auth=this.userInfoData.auth,this.verify=this.userInfoData.verify,this.callback=t,this.thisObject=i,void this.uuuologin()):-1!=String(this.userInfoData.prefix).indexOf("suyi")?(this.prefix=this.userInfoData.prefix,this.uid=this.userInfoData.uid,this.callback=t,this.thisObject=i,this.token=this.userInfoData.token,this.sign=this.userInfoData.sign,this.share=this.userInfoData.share,this.erweima=this.userInfoData.erweima,this.game_id=this.userInfoData.gameId,void this.suyilogin()):-1!=String(this.userInfoData.prefix).indexOf("dcerfxm")?(this.prefix=this.userInfoData.prefix,this.uid=this.userInfoData.uid,this.callback=t,this.thisObject=i,this.token=this.userInfoData.token,this.sign=this.userInfoData.sign,this.share=this.userInfoData.share,this.erweima=this.userInfoData.erweima,this.game_id=this.userInfoData.gameId,void this.sydcxmlogin()):-1!=String(this.userInfoData.prefix).indexOf("quickh5")?(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.appId=this.userInfoData.appid,void this.quicklogin()):-1!=String(this.userInfoData.prefix).indexOf("seenlove")?(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.appKey=this.userInfoData.appKey,void this.seenlovelogin()):-1!=String(this.userInfoData.prefix).indexOf("quickapp")?(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.appId=this.userInfoData.appid,this.appKey=this.userInfoData.appid,this.username=this.userInfoData.username,this.uid=this.userInfoData.uid,void this.quickcheck()):-1!=String(this.userInfoData.prefix).indexOf("quickwd_")?(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,void(this.appId=this.userInfoData.appid)):-1!=String(this.userInfoData.prefix).indexOf("xyw_")?(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,void this.loginXYW()):(-1!=String(this.userInfoData.prefix).indexOf("jywxzx_")&&console.log("无限之心登录调用开始··"),-1!=String(this.userInfoData.prefix).indexOf("jjyh5_")&&(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.appId=this.userInfoData.appKey,this.uid=this.userInfoData.uid,this.appKey=this.userInfoData.appKey,this.callback=t,this.thisObject=i,this.loginjjyh5()),-1!=String(this.userInfoData.prefix).indexOf("hsh5_")&&(this.callback=t,this.thisObject=i,this.prefix=this.userInfoData.prefix,this.token=this.userInfoData.token,this.game_id=this.userInfoData.gameId,this.uid=this.userInfoData.uid,this.appKey=this.userInfoData.gameId,this.username=this.userInfoData.username,this.loginhsh5()),"mgtv_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.callback=t,this.token=this.userInfoData.token,this.nonce=this.userInfoData.nonce,this.uid=this.userInfoData.uid,this.username=this.userInfoData.username,this.signType=this.userInfoData.signType,this.fp=this.userInfoData.fp,this.thisObject=i,void this.loginmgtv()):"qumi_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.callback=t,this.token=this.userInfoData.token,this.thisObject=i,void this.loginqumi()):"changjing_"==this.userInfoData.prefix?(this.prefix=this.userInfoData.prefix,this.callback=t,this.token=this.userInfoData.token,this.stime=this.userInfoData.stime,this.appKey=this.userInfoData.appKey,this.thisObject=i,void this.loginchangjing()):(this.userInfoData&&0==this.userInfoData.ret&&this.userInfoData.prefix&&this.userInfoData.uid||(n.userInfoData.ret=-1),this.userInfoData.prefix&&(this.prefix=this.userInfoData.prefix),this.userInfoData.uid&&(this.uid=this.userInfoData.uid),this.puid=this.prefix+this.uid,this.userInfoData.username?this.username=this.userInfoData.username:this.username=""+this.uid,this.userInfoData.pkgName&&(this.pkgName=this.userInfoData.pkgName),this.userInfoData.hlmy_gw&&(this.hlmy_gw=this.userInfoData.hlmy_gw),this.userInfoData.nonce&&(this.nonce=this.userInfoData.nonce),this.userInfoData.auth&&(this.auth=this.userInfoData.auth),this.userInfoData.token&&(this.token=this.userInfoData.token),this.userInfoData.fp&&(this.fp=this.userInfoData.fp),this.userInfoData.pid&&(this.pid=this.userInfoData.pid),null!=this.userInfoData.appKey&&(this.appKey=this.userInfoData.appKey,this.game_id=this.userInfoData.appKey),this.userInfoData.session_key&&(this.session_key=this.userInfoData.session_key),void t.call(i)))
},t.prototype.requestNotice=function(t){var i=e.Global.globalConfig.announcementUrl;(e.Global.globalConfig.isShenHeZhong||window.isCmsdkShenHe)&&(i=e.Global.globalConfig.announcementUrlShenHe);var n=checkPlatformStr();i=i+"&channel="+n+"&time="+(new Date).getTime(),console.log("公告路径"+i),e.GameUtils.httpReqsajax(i,{channel:n},t)},t.prototype.loginByxbtxlbqkl=function(){var t=this,i=e.Global.globalConfig.channelUrl+"/callback/dragonLogin";i=i+"?cb=?&code="+this.token+"&app_id=deerapp1&scopes="+this.scopes+"&state="+this.state+"&device="+this.device+"&test=0",console.log("查看dragon登陆参数 "+i),e.GameUtils.httpReqsajax(i,null,function(e){if(console.log("dragonEx登陆返回消息 "+e),0==e.ok)return void window.reloginDragonEx();var i=e.data;t.uid=i.open_id,t.puid=t.prefix+t.uid,t.callback.call(t.thisObject)},function(e){console.log("加载失败:",e)},null)},t.prototype.payByxbtxlbqkl=function(t){var i=e.JsonDataManager.instance.rechargeProductIdTemplate[t.goodsId],n="http:"+e.Global.globalConfig.platformUrl+"/client/1.0.0/dragonEx.html";console.log("充值回调链接 "+n),n=encodeURI(n),location.host;var o=e.Global.globalConfig.channelUrl+"/callback/dragonExPay";o=o+"?cb=?&app_id=deerapp1&trade_no="+t.orderId+"&coin_code=dt&volume="+i.costdt+"&scene=1&desc="+t.productName+"&device="+this.device+"&state="+this.state+"&redirect_url="+n+"&domain="+this.domain+"&test=0&scopes="+this.scopes,e.GameUtils.httpReqsajax(o,null,function(e){if(console.log(e),e&&1==e.code){var t=e.data,i=t.pay_url;window.location.href=i}},function(e){console.log("支付错误",e)})},t.prototype.lingo666login=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/LinGo666Login";i=i+"?cb=?&gameId="+this.appKey+"&time="+this.stime+"&uid="+this.uid+"&userName="+this.username+"&sign="+this.token+"&signType=md5",e.GameUtils.httpReqsajax(i,null,function(e){return console.dir(e),"0"!=String(e.errno)?void console.dir(e):(t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))})},t.prototype.lingo666pay=function(t){var i=e.Global.globalConfig.platformUrl+"/callback/LinGo666Recharge";i=i+"?cb=?&gameId="+this.appKey+"&uid="+this.uid+"&time="+(new Date).getTime()/1e3+"&server="+e.Global.serverId+"&role="+e.PlayerService.instance.mainRoleInfo.getName()+"&goodsId="+t.goodsId+"&goodsName="+t.productName+"&money="+Number(t.orderMoney).toFixed(2)+"&cpOrderId="+t.orderId+"&ext="+t.orderId+"&signType=md5",e.GameUtils.httpReqsajax(i,null,function(e){callPay(e)})},t.prototype.loginchangjing=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/ChangJingLoign";i=i+"?cb=?&time="+this.stime+"&appid="+this.appKey+"&u_token="+this.token,e.GameUtils.httpReqsajax(i,null,function(e){return console.dir(e),"true"!=e.code?void console.dir(e):(t.uid=e.data.uid,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))})},t.prototype.changjingpay=function(t){var i=e.Global.globalConfig.platformUrl+"/callback/ChangJingRechage";i=i+"?cb=?&amount="+Number(t.orderMoney).toFixed(2)+"&appid="+this.appKey+"&serverid="+e.Global.serverId+"&extinfo="+t.orderId+"&uid="+this.uid,e.GameUtils.httpReqsajax(i,null,function(e){callPay(e)})},t.prototype.loginqumi=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/QuMiLogin";i=i+"?cb=?&sessionid="+this.token+"&",e.GameUtils.httpReqsajax(i,null,function(e){return 1!=e.code?void alert(e.data):(t.uid=e.data.uid,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))})},t.prototype.qumipay=function(t){callPay({cporderid:t.orderId,serverid:e.Global.serverId,charid:e.PlayerService.instance.playerInfo.getPlayerId(),pay_money:t.orderMoney,extinfo:t.orderId})},t.prototype.loginmgtv=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/MangGuoTVLogin";i=i+"?cb=?&uuid="+this.uid+"&sign="+this.token+"&random="+this.nonce+"&nickname="+this.username+"&avatar="+this.signType+"&gender="+this.fp+"&",e.GameUtils.httpReqsajax(i,null,function(e){0==e.error&&(t.puid=t.prefix+t.uid,t.callback.call(t.thisObject))})},t.prototype.mgtvpay=function(e){callPay({amount:100*Number(e.orderMoney),productExt:e.productName,productId:e.orderId,productName:e.productName,uuid:this.uid})},t.prototype.sdk1login=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/yiJieLoginCheck";i=i+"?cb=?&sdk="+this.sid+"&app="+this.hlmy_gw+"&uin="+this.clientId+"&sess="+this.token,console.log("ganga",i),e.GameUtils.httpReqsajax(i,null,function(e){return 0!=e?void alert("登录出错"):(t.uid=t.clientId,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},function(e){console.dir(e)})},t.prototype.sdk1pay=function(e){callPay({game_price:e.orderMoney,product_name:e.productName,orderId:e.orderId})},t.prototype.yjyxflogin=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/yiJieLoginCheck";i=i+"?cb=?&sdk="+this.sid+"&app="+this.hlmy_gw+"&uin="+this.clientId+"&sess="+this.token,console.log("ganga",i),e.GameUtils.httpReqsajax(i,null,function(e){return 0!=e?void alert("登录出错"):(t.uid=t.clientId,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},function(e){console.dir(e)})},t.prototype.yjyxfpay=function(e){callPay({game_price:e.orderMoney,product_name:e.productName,orderId:e.orderId})},t.prototype.seenlovelogin=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/XinLeLoginKey";i=i+"?cb=?&appid="+this.appKey+"&token="+this.token+"&timestamp="+Math.round((new Date).getTime()/1e3),e.GameUtils.httpReqsajax(i,null,function(i){return 1!=i.success?(alert("登录失败,请重新登录!"),void(window.location.href=e.Global.globalConfig.platformUrl+"/client/1.0.0/seenlove.html")):(t.uid=i.result.openid,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},function(e){alert(e)})},t.prototype.seenlovepay=function(t){var i=(e.PlayerService.instance.playerInfo.getPlayerId(),e.Global.globalConfig.platformUrl+"/callback/XinLeRecharge");i=i+"?cb=?&amount="+100*Number(t.orderMoney)+"&appid="+this.appKey+"&callback="+e.Global.globalConfig.platformUrl+"/client/1.0.0/seenlove.html&desc="+t.productName+"&openid="+this.uid+"&notify="+e.Global.globalConfig.platformUrl+"/callback/XinLeCallBack&state="+t.orderId+"&timestamp="+Math.round((new Date).getTime()/1e3)+"&transno="+t.orderId,e.GameUtils.httpReqsajax(i,null,function(e){callPay(e)})},t.prototype.fivewanlogin=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/ZhangFengLogin";i=i+"?cb=?&code="+this.token,e.GameUtils.httpReqsajax(i,null,function(e){return 1001!=e.errno?(alert(e.message),void location.assign("./5wan.html")):(t.uid=e.data.loginid,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},function(e){alert(e)})},t.prototype.fivewanpay=function(t){var i=e.PlayerService.instance.playerInfo.getPlayerId(),n=e.Global.globalConfig.platformUrl+"/callback/ZhangFengRecharge";n=n+"?cb=?&uid="+this.uid+"&serverid="+e.Global.serverId+"&roleid="+i+"&orderid="+t.orderId+"&money="+t.orderMoney+"&goodsname="+t.productName+"&goodsnum=1&goodsdesc="+t.productName+"&sdkappid="+this.appKey+"&extstr="+t.orderId,e.GameUtils.httpReqsajax(n,null,function(e){return 0!=e.error?void console.log("参数错误"):void callPay(e)})},t.prototype.loginjjyh5=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/99youH5CheckLogin";i=i+"?cb=?&appid="+this.appKey+"&token="+this.token+"&uid="+this.uid,e.GameUtils.httpReqsajax(i,null,function(e){return 0!=e.code?void console.log(e.msg):(t.uid=e.data.uid,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},function(e){alert(e)})},t.prototype.loginjjyh5pay=function(t){var i=100*Number(t.orderMoney);callPay({appid:this.appKey,sid:e.Global.serverId,uid:this.uid,cporder:t.orderId,amount:i,item_id:1,item_name:t.productName,extra:t.orderId,sign:this.uid})},t.prototype.yybysdkpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,appid:1109595708,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.oasissdkpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.jdh5pay=function(t){var i=Number(t.orderMoney),n=100*i,o=e.Global.globalConfig.platformUrl+"/callback/JingDongRecharge";o=o+"?cb=?&uuid=2080"+t.orderId+"&userPin="+this.userInfoData.jdticket+"&currency="+this.userInfoData.currency+"&amount="+n+"&sname="+t.productName+"&extend={orderId:"+t.orderId+",money:"+i+"}",e.GameUtils.httpReqsajax(o,null,function(e){console.log(JSON.stringify(e)),e&&200==e.code&&(console.log(e.msg),callPay(e))},function(e){console.log(e.msg)})},t.prototype.loginhsh5=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/HuaShengLogin";i=i+"?cb=?&gameId="+this.appKey+"&time="+(new Date).getTime()+"&uid="+this.uid+"&userName="+this.username+"&avatar=&userSex=&fromUid=0",e.GameUtils.httpReqsajax(i,null,function(e){return e.hasOwnProperty("errno")?void console.log(e.message):(t.uid=e.uid,t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},function(e){console.log(e.message)})},t.prototype.loginhsh5pay=function(t){var i=this,n=Number(t.orderMoney),o=e.Global.globalConfig.platformUrl+"/callback/HuaShengRecharge";o=o+"?cb=?&gameId="+this.appKey+"&uid="+this.uid+"&time="+(new Date).getTime()+"&server="+e.Global.serverId+"&role="+this.username+"&goodsId="+t.orderId+"&goodsName="+t.productName+"&money="+n+"&cpOrderId="+t.orderId+"&signType=md5&ext=1",e.GameUtils.httpReqsajax(o,null,function(e){if(e.hasOwnProperty("errno"))return void console.log(e.message);var t={gameId:parseInt(e.gameId),uid:parseInt(i.uid),time:parseInt(e.time),server:e.server,role:e.role,goodsId:e.goodsId,goodsName:e.goodsName,money:parseFloat(e.money),cpOrderId:e.cpOrderId,sign:e.sign,signType:e.signType};console.log(JSON.stringify(t)),callPay(t)},function(e){console.log(e.message)})},t.prototype.yougupay=function(t){var i=this.prefix.split("_")[0],n=(Number(t.orderMoney),Number(t.rewardstarmoney),{orderId:t.orderId,pf:i},t.orderId+"_"+i),o=e.PlayerService.instance.mainRoleInfo.getRoleId().toString(),a=e.PlayerService.instance.mainRoleInfo.getName(),s=e.PlayerService.instance.mainRoleInfo.getLevel(),r={productId:t.goodsId,productName:t.productName,productDesc:t.productName,productPrice:t.orderMoney,productCount:1,productType:0,coinName:"元宝",coinRate:10,extendInfo:n,roleId:o,roleName:a,zoneId:e.Global.serverId,zoneName:e.Global.serverName,partyName:"无",roleLevel:s,roleVipLevel:e.Global.firstvipLevel,balance:0};callPay(r)},t.prototype.yougulogin=function(){var t=this,i=this.prefix.split("_")[0],n=e.Global.globalConfig.platformUrl+"/callback/YouGoLogin";n=n+"?cb=?&token="+this.token+"&pf="+i+"&uid="+this.uid,e.GameUtils.httpReqsajax(n,null,function(e){console.log("登录成功:",e),t.callback.call(t.thisObject)},function(e){console.log("登录失败",e)})},t.prototype.xqapplogin=function(){var i=this,n=e.Global.globalConfig.platformUrl+"/callback/wbXiaoQiLogin";n=n+"?cb=?&tokenkey="+this.token+"&pid="+this.pid,e.GameUtils.httpReqsajax(n,{tokenkey:this.token,pid:this.pid},function(e){return 0!=e.errorno?void console.log(e.errormsg):(i.uid=e.data.guid,i.username=e.data.username,i.puid=i.prefix+i.uid,t.is_real_user=e.data.is_real_user,t.is_eighteen=e.data.is_eighteen,void i.callback.call(i.thisObject))},function(e){alert("小7登录失败"),alert(e)})},t.prototype.wechatpay=function(t){var i="",n=Number(t.orderMoney),o="",a=e.Global.globalConfig.platformUrl+"/callback/wxPlaceAnOrder";"Android"==egret.Capabilities.os?i="android":"iOS"==egret.Capabilities.os&&(i="ios"),"wx2721de1c4d7fd228"==this.appKey?o="1496810112":"wx093dd8a50ab92138"==this.appKey?o="1483533382":"wx7f618b8bb4e3f7a9"==this.appKey?o="1536607931":"wx56d29c5f8ab4a4e4"==this.appKey?o="1483533382":"wxe30b5570886ac8b9"==this.appKey?o="1483533382":"wx1b714bb6b1e84660"==this.appKey?o="1541627031":"wx2acc1f542675a293"==this.appKey?o="1546964861":"wx83e6c06f8159311c"==this.appKey?o="1536607931":"wx51a2a2e615fde3ef"==this.appKey&&(o="1546964861"),a=a+"?cb=?&appid="+this.appKey+"&openid="+this.uid+"&mch_id="+o+"&out_trade_no="+t.orderId+"&total_fee="+n+"&plat="+i+"&trade_type=JSAPI&theFunction=?&timeStamp="+(new Date).getTime()+"&body="+t.productName,e.GameUtils.httpReqsajax(a,null,function(e){callPay(e)})},t.prototype.x7apppay=function(t){var i=(100*Number(t.orderMoney),e.PlayerService.instance.playerInfo.getLevel()),n=e.PlayerService.instance.playerInfo.getPlayerId(),o=e.PlayerService.instance.mainRoleInfo.getName(),a=Number(t.orderMoney).toFixed(2),s="1"==egret.getOption("isNew")?this.uid:null,r=e.Global.globalConfig.platformUrl+"/callback/wbXiaoQiRecharge";r=r+"?cb=?&extends_info_data="+this.pid+"&game_area="+e.Global.serverId+"&game_level="+i+"&game_orderid="+t.orderId+"&game_price="+a+"&game_role_id="+n+"&game_role_name="+o+"&notify_id=-1&subject="+t.productName+"&game_guid="+s,e.GameUtils.httpReqsajax(r,{extends_info_data:this.pid,game_area:e.Global.serverId,game_level:i,game_orderid:t.orderId,game_price:a,game_role_id:n,game_role_name:o,notify_id:-1,subject:+t.productName,game_guid:s},function(e){callPay(e)})},t.prototype.quickcheck=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/quickCheckUser";i=i+"?cb=?&token="+this.token+"&product_code="+this.appId+"&uid="+this.uid+"&channel_code="+this.chanel,e.GameUtils.httpReqsajax(i,{token:this.token,product_code:this.appId,uid:this.uid,channel_code:this.chanel},function(e){1==e&&(t.puid=t.prefix+t.uid,t.callback.call(t.thisObject))})},t.prototype.quickwdCheck=function(){var t=e.Global.globalConfig.platformUrl+"/callback/quickGetUser";t=t+"?cb=?&token="+this.token,e.GameUtils.httpReqsajax(t,{token:this.token},this.quickwdloginback.bind(this))},t.prototype.quickwdloginback=function(t){if(1==t.status){this.uid=t.data.uid,this.username=t.data.username,this.prefix+=t.data.channelId,this.chanel=t.data.channelId,this.puid=this.prefix+this.uid;var i={code:"initsdk",data:this.chanel};e.UserInfo.platform.reportData_legend(i),this.callback.call(this.thisObject)}},t.prototype.quicklogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/quickGetUser";t=t+"?cb=?&token="+this.token,e.GameUtils.httpReqsajax(t,{token:this.token},this.quickloginback.bind(this))},t.prototype.quickloginback=function(t){if(1==t.status){this.uid=t.data.uid,this.username=t.data.username,this.prefix+=t.data.channelId,this.chanel=t.data.channelId,this.puid=this.prefix+this.uid;var i={code:"initsdk",data:this.chanel};e.UserInfo.platform.reportData_legend(i),this.callback.call(this.thisObject)}},t.prototype.suyilogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/soeasyLogin";t=t+"?cb=?&uid="+this.uid+"&t="+this.sign+"&sign="+this.token+"&appid="+this.game_id,e.GameUtils.httpReqsajax(t,{uid:this.uid,t:this.sign,sign:this.token},this.suyiloginback.bind(this))},t.prototype.suyiloginback=function(e){return 0!=e.error?void alert(e.msg):(this.puid=this.prefix+this.uid,void this.callback.call(this.thisObject))},t.prototype.sydcxmlogin=function(){var t="https://h5legend.6deer.com/callback/soeasyLogin";t=t+"?cb=?&uid="+this.uid+"&t="+this.sign+"&sign="+this.token+"&appid="+this.game_id,e.GameUtils.httpReqsajax(t,{uid:this.uid,t:this.sign,sign:this.token},this.sydcxmloginback.bind(this))},t.prototype.sydcxmloginback=function(e){return 0!=e.error?void alert(e.msg):(this.puid=this.prefix+this.uid,void this.callback.call(this.thisObject))},t.prototype.suyipay=function(t){var i=100*Number(t.orderMoney),n=t.orderId,o=t.goodsId,a=e.Global.globalConfig.platformUrl+"/callback/soeasyRecharge";a=a+"?cb=?&fee="+i+"&feeid="+o+"&feename="+t.productName+"&orderId="+n+"&extradata="+t.orderId+"&appid="+this.game_id,e.GameUtils.httpReqsajax(a,{feeid:o,fee:i,feename:t.productName,orderId:n,extradata:t.orderId},this.suyipayback.bind(this))},t.prototype.suyipayback=function(t){if(0==t.error){var i=e.PlayerService.instance.mainRoleInfo.getName(),n=e.PlayerService.instance.mainRoleInfo.getRoleId().toString(),o=e.Global.serverId,a=e.Global.serverName,s={check:t.check,feeid:t.feeid,fee:t.fee,feename:t.feename,extradata:t.extradata,serverid:o,rolename:i,roleid:n,servername:a};callPay(s)}},t.prototype.xmGeneralPay=function(t){console.log("uid session "+this.uid+" "+this.session);var i=e.Global.globalConfig.gfbtxmkyPay,n=100*Number(t.orderMoney);(new Date).getTime();i=i+"?cb=?&appId="+this.userInfoData.appKey+"&appAccountId="+this.uid+"&session="+this.session+"&cpOrderId="+t.orderId+"&cpUserInfo="+t.orderId+"&displayName="+t.productName+"&feeValue="+n+"&currency=CNY",console.log("小米请求得地址 "+i),e.GameUtils.httpReqsajax(i," ",this.xmGeneralPayBack.bind(this),null)},t.prototype.xmGeneralPayBack=function(e){if("0"!=e.errcode)return void Log.trace("下单失败:",e.msg);console.log("小米bt版本 --- 支付服务器返回成功",e);var t={};t.appAccountId=e.appAccountId,t.appId=e.appId,t.cpOrderId=e.cpOrderId,t.cpUserInfo=e.cpUserInfo,t.displayName=e.displayName,t.feeValue=e.feeValue,t.session=e.session,t.sign=e.sign,callPay(t)},t.prototype.sydcxmpay=function(t){var i=100*Number(t.orderMoney),n=t.orderId,o=t.goodsId,a="https://h5legend.6deer.com/callback/soeasyRecharge";a=a+"?cb=?&fee="+i+"&feeid="+o+"&feename="+t.productName+"&orderId="+n+"&extradata="+t.orderId+"&appid="+this.game_id,e.GameUtils.httpReqsajax(a,{feeid:o,fee:i,feename:t.productName,orderId:n,extradata:t.orderId},this.sydcxmpayback.bind(this))},t.prototype.sydcxmpayback=function(t){if(0==t.error){var i=e.PlayerService.instance.mainRoleInfo.getName(),n=e.PlayerService.instance.mainRoleInfo.getRoleId().toString(),o=e.Global.serverId,a=e.Global.serverName,s={check:t.check,feeid:t.feeid,fee:t.fee,feename:t.feename,extradata:t.extradata,serverid:o,rolename:i,roleid:n,servername:a};callPay(s)}},t.prototype.uuuologin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/youWoLogin";t=t+"?cb=?&auth="+this.auth+"&verify="+this.verify,e.GameUtils.httpReqsajax(t,{auth:this.auth,verify:this.verify},this.uuuologinback.bind(this))},t.prototype.uuuologinback=function(e){this.uid=e.account,this.sign=e.time,this.puid=this.prefix+this.uid,this.callback.call(this.thisObject)},t.prototype.uuuopay=function(t){var i=e.PlayerService.instance.mainRoleInfo.getName(),n=e.Global.serverId,o=e.Global.globalConfig.platformUrl+"/callback/youWoRecharge";o=o+"?cb=?&account="+this.uid+"&g_id=1087&game_serverid="+n+"&role_name="+i+"&money="+Number(t.orderMoney).toFixed(2)+"&game_order="+t.orderId+"&extraParam="+t.orderId,e.GameUtils.httpReqsajax(o,{account:this.uid,g_id:1087,game_serverid:n,role_name:i,money:Number(t.orderMoney).toFixed(2),game_order:t.orderId,extraParam:t.orderId},this.uuuopayback.bind(this))},t.prototype.uuuopayback=function(e){callPay(e)},t.prototype.jiuxiuLogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/jiuXiuLogin";t=t+"?cb=?&pubkey="+this.userInfoData.appKey+"&actoken="+this.userInfoData.token+"&uid="+this.userInfoData.uid+"&os="+this.userInfoData.via+"&mid="+this.userInfoData.mid+"&channel="+this.userInfoData.gameId+"&subchannel="+this.userInfoData.pid,e.GameUtils.httpReqsajax(t,"",this.jiuxiuback.bind(this))},t.prototype.jiuxiuback=function(t){this.puid=this.prefix+this.uid;var i={code:"initsdk",data:t};e.UserInfo.platform.reportData_legend(i),this.callback.call(this.thisObject)},t.prototype.jiuXiuPay=function(t){var i=100*Number(t.orderMoney),n=e.JsonDataManager.instance.rechargeConfig_jiuxiu[t.orderMoney],o=(new Date).getTime()/1e3,a=e.Global.globalConfig.platformUrl+"/callback/jiuXiuRecharge";a=a+"?cb=?&mid="+this.userInfoData.mid+"&actoken="+this.userInfoData.token+"&os="+this.userInfoData.via+"&timestamp="+o+"&uid="+this.userInfoData.uid+"&gamerole="+e.PlayerService.instance.mainRoleInfo.getRoleId()+"&gamerole_name="+e.PlayerService.instance.mainRoleInfo.getName()+"&amount="+i+"&sid="+e.Global.serverId+"&user_ip="+this.userInfoData.uid+"&product_id="+n.rechargeId+"&cp_orderid="+t.orderId+"&channel="+this.userInfoData.gameId+"&subchannel="+this.userInfoData.pid,e.GameUtils.httpReqsajax(a,"",this.jiuXiuPayBack.bind(this))},t.prototype.jiuXiuPayBack=function(e){return 200!=e.status?void alert("九秀支付："+e.status+","+e.message):void callPay(e)},t.prototype.iyouzulogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/aiYouZuPlayer";t=t+"?cb=?&pid="+this.pid+"&time="+this.sign,e.GameUtils.httpReqsajax(t,{pid:this.pid,time:this.sign},this.iyouzuback.bind(this))},t.prototype.iyouzuback=function(t){var i={code:"initsdk",data:t};e.UserInfo.platform.reportData_legend(i)},t.prototype.anqupay=function(t){var i=e.PlayerService.instance.mainRoleInfo.getName(),n=e.PlayerService.instance.mainRoleInfo.getLevel(),o=e.Global.serverName,a=e.Global.globalConfig.platformUrl+"/callback/anQuRechageBack";a=a+"?cb=?&appid="+this.game_id+"&open_id="+this.uid+"&amt="+Number(t.orderMoney).toFixed(2)+"&suject="+t.productName+"&cporder="+t.orderId+"&rolename="+i+"&zonename="+o+"&rolelevel="+n,e.GameUtils.httpReqsajax(a,{appid:this.game_id,open_id:Number(this.uid),amt:Number(t.orderMoney).toFixed(2),suject:t.productName,cporder:t.orderId,rolename:i,zonename:o,rolelevel:n},this.anqupayback.bind(this),null)},t.prototype.anqupayback=function(e){callPay(e)},t.prototype.anqulogin=function(){var t=checkPlatformStr(),i=e.Global.globalConfig.platformUrl+"/callback/anQuLoginMD5";i=i+"?cb=?&appid="+this.game_id+"&cpid="+this.cpid+"&channel="+t+"&open_id="+this.uid,e.GameUtils.httpReqsajax(i,{appid:this.game_id,cpid:this.cpid,channel:t,open_id:this.uid},this.anquback.bind(this))},t.prototype.anquback=function(t){var i={code:"initsdk",data:t};e.UserInfo.platform.reportData_legend(i),this.callback.call(this.thisObject)},t.prototype.gyyxlogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/guangYuLoginMD5";t=t+"?cb=?&clientId="+this.clientId+"&token="+this.token+"&mType="+this.mType+"&timestamp="+this.sign+"&signType="+this.signType+"&sign="+this.signg,e.GameUtils.httpReqsajax(t,{clientId:this.clientId,token:this.token,tomTypeken:this.mType,timestamp:this.sign,signType:this.signType,sign:this.signg},this.gyyxback.bind(this))},t.prototype.gyyxback=function(e){this.callback.call(this.thisObject)},t.prototype.manwupay=function(t){var i=100*Number(t.orderMoney),n=e.Global.globalConfig.platformUrl+"/callback/manWuPaySign";n=n+"?cb=?&game_appid="+this.appKey+"&trade_no="+t.orderId+"&props_name="+t.productName+"&amount="+i+"&user_id="+this.uid+"&channelExt="+this.chanel,e.GameUtils.httpReqsajax(n,{game_appid:this.appKey,trade_no:t.orderId,props_name:t.productName,amount:i,user_id:this.uid,channelExt:this.chanel},function(e){callPay(e)})},t.prototype.guchuancheckPay=function(t){Math.round((new Date).getTime()/1e3),e.JsonDataManager.instance.rechargeTemplate[t.goodsId];t.uid=this.uid,t.callBack=e.Global.globalConfig.platformUrl+"/callback/guchuanCallBack",callPay(t)},t.prototype.leyouxflogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/LYXianFengLogin";t=t+"?cb=?&userid="+this.uid+"&token="+this.token+"&appkey="+this.appKey,e.GameUtils.httpReqsajax(t,{appKey:this.appKey,userid:this.uid,token:this.token},this.leyouxfback.bind(this))},t.prototype.leyouxfback=function(e){return"undefined"==e?void Log.trace("登录失败"):(this.puid=this.prefix+this.uid,void this.callback.call(this.thisObject))},t.prototype.jinjunlogin=function(){var t=e.Global.globalConfig.platformUrl+"/callback/jinJunLoginMD5";t=t+"?cb=?&appid="+this.game_id+"&username="+this.username+"&token="+this.token+"&logintime="+this.sign+"&uid="+this.uid,e.GameUtils.httpReqsajax(t,{appid:this.game_id,username:this.username,token:this.token,logintime:this.sign,uid:this.uid},this.jinjunback.bind(this))},t.prototype.jinjunback=function(e){return"undefined"==e?void Log.trace("登录失败"):(this.puid=this.prefix+this.uid,void this.callback.call(this.thisObject))},t.prototype.loginhaiwan=function(){var e=[];e.push({"&Ugameid=":this.game_id},{"&Uid=":this.uid},{"&Time=":this.stime},{"&appkey=":this.appKey}),e=e.sort();var t="&Ugameid="+this.game_id+"&Uid="+this.uid+"&Time="+this.stime+"&appkey="+this.appKey;t=e[0].toString()+e[1]+e[2]+e[3],Log.trace(t);var i=new MD5,n=i.hex_md5(t);this.puid=this.prefix+this.uid,n==this.sign?(Log.trace("签名匹配成功，登陆游戏"),this.callback.call(this.thisObject)):(Log.trace("签名匹配不成功，待定"),Log.trace("str:"+n+"*****sign:"+this.sign),this.callback.call(this.thisObject))},t.prototype.haiwanPay=function(t){var i=Math.round((new Date).getTime()/1e3),n=e.PlayerService.instance.mainRoleInfo.getRoleId(),o=(e.PlayerService.instance.mainRoleInfo.getName(),e.JsonDataManager.instance.RechargeConfig_haiwanTemplate[t.goodsId]),a={Ugameid:Number(this.game_id),Uid:Number(this.uid),Time:i,Serverid:e.Global.serverName,Roleid:n,Method:"createPay",Sku:o.id,Cp_orderid:t.orderId,Ctext:"Ctext"};this.haiwanback(a)},t.prototype.haiwanback=function(e){callPay(e)},t.prototype.turnStr=function(e){var t="";return t='"'+e+'"'},t.prototype.yzPay=function(t){var i=(e.JsonDataManager.instance.rechargeTemplate[t.goodsId],e.PlayerService.instance.playerInfo.getPlayerId()),n=e.Global.serverName,o=e.Global.serverId,a=e.Global.globalConfig.channelUrl+"/callback/wbQldYzPaySign";this.ext=this.userInfoData.ext,a=a+"?cb=?&orderid="+t.orderId+"&money="+t.orderMoney+"&product="+t.productName+"&productid="+t.productName+"&roleid="+i+"&serverid="+o+"&servername="+n+"&",e.GameUtils.httpReqsajax(a,{orderid:t.orderId,money:t.orderMoney,product:t.productName,productid:t.productName,roleid:i,serverid:o,servername:n,ext:this.userInfoData.ext},this.yzPayBack.bind(this),null)},t.prototype.yzPayBack=function(e){callPay(e)},t.prototype.chengziPay=function(t){var i=this.userInfoData.channelid,n=Math.round((new Date).getTime()/1e3),o=e.PlayerService.instance.mainRoleInfo.getName(),a=e.Global.globalConfig.platformUrl+"/callback/chengziOrderMD5";this.ext=this.userInfoData.ext,a=a+"?cb=?&cpgameid="+this.userInfoData.gameId+"&qqesuid="+this.uid+"&timestamp="+n+"&channelid="+i+"&serverID="+e.Global.serverId+"&serverName="+e.Global.serverName+"&roleName="+o+"&goodsId="+t.goodsId+"&goodsname="+t.productName+"&fee="+t.orderMoney+".00&order="+t.orderId+"&channeluid="+this.userInfoData.channeluid+"&cpguid="+this.userInfoData.cpguid+"&ext="+this.userInfoData.ext,e.GameUtils.httpReqsajax(a,{cpgameid:this.userInfoData.gameId,qqesuid:this.uid,channelid:i,timestamp:n,serverID:e.Global.serverId,serverName:e.Global.serverName,roleName:o,goodsId:t.goodsId,goodsName:t.goodsName,fee:parseFloat(t.orderMoney),order:t.orderId,channeluid:this.userInfoData.channeluid,cpguid:this.userInfoData.cpguid,ext:this.userInfoData.ext},this.chengziPayBack.bind(this),null)},t.prototype.chengziPayBack=function(e){e.ext=this.ext,callPay(e)},t.prototype.wxpay=function(t){var i=(new Date).getTime(),n=t.orderId;e.GameUtils.httpReqsajax("url",{openid:this.uid,appid:this.appKey,offer_id:"",ts:i,zone_id:e.Global.serverId,pf:"android"},this.midsBalance.bind(this,n),null)},t.prototype.midsBalance=function(t,i){var n=(new Date).getTime(),o=0,a="";"Android"==egret.Capabilities.os?(o=1,a="android"):"iOS"==egret.Capabilities.os&&(o=2,a="ios");var s=e.JsonDataManager.instance.rechargeConfig_wanbaQLDTemplate[i.goodsId+""+o],r=Number(s.rewardstarmoney),l=0;if(0!=i.errcode)console.log("获取信息错误:",i.errcode,i.errmsg);else if(l=i.balance,l>r)e.GameUtils.httpReqsajax("url",{openid:this.uid,appid:this.appKey,offer_id:getGlobalConfig().midasId,ts:n,zone_id:e.Global.serverId,pf:a,amt:r,bill_no:t},this.wxPayBack.bind(this),null);else{var h=null;h.buyQuantity=r,callPay(h)}},t.prototype.wxPayBack=function(e){console.log(e)},t.prototype.generaoppoPay=function(t){var i=e.Global.globalConfig.mfhxoppoPay,n=100*Number(t.orderMoney),o=(new Date).getTime(),a=e.Global.globalConfig.mfhxoppoCallBack,s=this.userInfoData.platformVersion;i=i+"?cb=?&appId="+this.userInfoData.appKey+"&openId="+this.userInfoData.token+"&timestamp="+o+"&productName="+t.productName+"&productDesc="+t.productName+"&count=1&price="+n+"&currency=CNY&cpOrderId="+t.orderId+"&appVersion="+e.Global.version+"&engineVersion="+s+"&callBackUrl="+a,console.log("bt版本 newOppo支付调起URL:"+i),e.GameUtils.httpReqsajax(i,"",this.mfhxoppoPayPayBack.bind(this),null)},t.prototype.mfhxoppoPayPayBack=function(e){return console.log("newOppo支付的返回回调:"+JSON.stringify(e)),"200"!=e.code?void Log.trace("下单失败:",e.msg):void callPay(e)},t.prototype.qqpay=function(t){this.userInfoData=checkLogin(),this.session_key=this.userInfoData.session_key,this.appKey=this.userInfoData.appKey,this.uid=this.userInfoData.uid;var i=(new Date).getTime();i=Math.floor(i/1e3);var n=e.Global.globalConfig.qqpay,o=0,a="";"Android"==egret.Capabilities.os?(o=1,a="qq_m_qq-2001-android-2011"):"iOS"==egret.Capabilities.os&&(o=2,a="qq_m_qq-2001-ios-2011");var s;-1!=this.prefix.indexOf("mrbjqqgame")?(s=e.JsonDataManager.instance.rechargeConfig_ziyunmoribanjiTemplate[t.goodsId+""+o],console.log("mrbjqqgame sheet goodid = "+s.rechargeId)):s=e.JsonDataManager.instance.rechargeConfig_wanbaQLDTemplate[t.goodsId+""+o];var r=Number(s.rewardstarmoney);n=n+"?cb=?&openid="+this.uid+"&appid="+this.appKey+"&ts="+i+"&zone_id=1&pf="+a+"&amt="+r+"&bill_no="+t.orderId+"&goodid="+s.rechargeId+"&good_num=1&session_key="+this.session_key+"&app_remark="+t.orderId+"_"+this.appKey+"&",console.log("预下单请求地址:",n),e.GameUtils.httpReqsajax(n,null,this.qqPayBack.bind(this,s.rewardstarmoney),null)},t.prototype.qqPayBack=function(e,t){console.log("预下单请求回调:",JSON.stringify(t));var i={prepayId:t.prepayId,starCurrency:e};callPay(i)},t.prototype.te6Pay=function(t){var i=(this.userInfoData.channelid,Math.round((new Date).getTime()/1e3)),n=e.Global.globalConfig.platformUrl+"/callback/LingHangRecharge";n=n+"?cb=?&uid="+this.uid+"&gkey="+this.userInfoData.gkey+"&skey="+this.userInfoData.skey+"&roleid="+e.PlayerService.instance.playerInfo.getPlayerId()+"&orderno="+t.orderId+"&money="+t.orderMoney+"&time="+i,e.GameUtils.httpReqsajax(n,null,this.te6PayBack.bind(this),null)},t.prototype.te6PayBack=function(e){callPay(e)},t.prototype.huaweiPay=function(t){var i=e.Global.globalConfig.hwpay;i=i+"?cb=?&amount="+t.orderMoney+".00&applicationID=101033515&country=CN&currency=CNY&productDesc="+t.productName+"&productName="+t.productName+"&requestId="+t.orderId+"&serviceCatalog=X6&merchantId=890086000102155510&merchantName=上海盼宝网络科技有限公司&urlver=2&sdkChannel=0&",e.GameUtils.httpReqsajax(i,null,this.huaweiPayBack.bind(this),null)},t.prototype.huaweiPayBack=function(e){var t={};t.amount=e.amount,t.applicationID=e.applicationID,t.country=e.country,t.currency=e.currency,t.url=e.url,t.productDesc=e.productDesc,t.productName=e.productName,t.requestId=e.requestId,t.serviceCatalog=e.serviceCatalog,t.merchantId=e.merchantId,t.merchantName=e.merchantName,t.urlver=e.urlver,t.sdkChannel=e.sdkChannel,t.sign=e.sign,t.publicKey=e.publicKey,callPay(t)},t.prototype.baiduPay=function(t){var i=100*Number(t.orderMoney),n=t.orderId,o=e.Global.globalConfig.baidupay;o=o+"?cb=?&totalAmount="+i+"&tpOrderId="+n+"&",e.GameUtils.httpReqsajax(o,null,this.baiduPayBack.bind(this,t),null)},t.prototype.baiduPayBack=function(e,t){console.log("百度支付下单回调:",t);var i={};i.dealId=t.dealId,i.appKey=t.appKey,i.totalAmount=t.totalAmount,i.tpOrderId=t.tpOrderId,i.dealTitle=e.productName,i.rsaSign=t.rsaSign,i.signFieldsRange=1,i.bizInfo=t.bizInfo||{tpData:{appkey:t.appKey,dealId:t.dealId,tpOrderId:t.tpOrderId,totalAmount:t.totalAmount,rsaSign:t.rsaSign,dealTitle:e.productName,returnData:e.productName}},callPay(i)},t.prototype.ttPay=function(t){var i=t.orderId,n=(this.token,(new Date).getTime());n=Math.round(n/1e3);var o=e.Global.globalConfig.getBalance,a=0,s="";"Android"==egret.Capabilities.os?(a=1,s="android"):"iOS"==egret.Capabilities.os&&(a=2,s="ios"),o=o+"?cb=?&openid="+this.uid+"&appid="+this.appKey+"&ts="+n+"&zone_id=1&pf="+s+"&",console.log("预下单请求地址:",o),e.GameUtils.httpReqsajax(o,null,this.ttBalance.bind(this,i,t.goodsId,t.orderMoney),null)},t.prototype.ttBalance=function(t,i,n,o){var a=e.Global.globalConfig.ttpay,s=(new Date).getTime();s=Math.round(s/1e3);var r=0,l="";"Android"==egret.Capabilities.os?(r=1,l="android"):"iOS"==egret.Capabilities.os&&(r=2,l="ios");var h=(e.JsonDataManager.instance.rechargeConfig_wanbaQLDTemplate[i+""+r],Number(100*n)),c=0;if(0!=o.errcode)console.log("获取信息错误:",o.errcode,o.errmsg);
else{c=o.balance;var u="";if(u=o.bill_no,c>=h)a=a+"?cb=?&openid="+this.uid+"&appid="+this.appKey+"&ts="+s+"&zone_id=1&pf="+l+"&amt="+h+"&bill_no="+t+"&",console.log("预下单请求地址:",a),console.log("orderId"+t),e.GameUtils.httpReqsajax(a,null,this.ttPayBack.bind(this),null);else{var p={openid:this.uid,appid:this.appKey,ts:s,zone_id:e.Global.serverId,pf:l,amt:h,bill_no:t,pfBill_no:u};callPay(p)}}},t.prototype.ttPayBack=function(e){console.log(e)},t.prototype.oppopay=function(t){var i=e.Global.globalConfig.oppoPay,n=100*Number(t.orderMoney),o=(new Date).getTime();i=i+"?cb=?&appId="+this.appKey+"&openId="+this.token+"&timestamp="+o+"&productName="+t.productName+"&productDesc="+t.productName+"&count=1&price="+n+"&currency=CNY&cpOrderId="+t.orderId+"&appVersion="+e.Global.version+"&engineVersion=5.2.4",e.GameUtils.httpReqsajax(i,{appId:this.appKey,openId:this.token,timestamp:o,productName:t.productName,productDesc:t.productName,count:1,price:n,currency:"CNY",cpOrderId:t.orderId,appVersion:e.Global.version,engineVersion:"5.2.4",attach:t.orderId},this.oppoPayBack.bind(this),null)},t.prototype.oppoPayBack=function(e){if("200"!=e.code)return void Log.trace("下单失败:",e.msg);e=e.data;var t={};t.timestamp=e.timestamp,t.orderNo=e.orderNo,t.paySign=e.paySign,t.appId=e.appId,t.cpOrderId=e.cpOrderId,t.pkgName=this.pkgName,t.token=this.token,callPay(t)},t.prototype.vivopay=function(t){var i=e.Global.globalConfig.vivopay,n=Number(t.orderMoney),o=(new Date).getTime();i=i+"?cb=?&orderTime="+o+"&orderDesc="+t.productName+"&orderAmount="+n+"&currency=CNY&cpOrderNumber="+t.orderId+"&orderTitle="+t.productName,e.GameUtils.httpReqsajax(i,"&dgh=1",this.vivoPayBack.bind(this),null)},t.prototype.vivoPayBack=function(e){return"200"!=e.respCode?void Log.trace("下单失败:",e.respMsg):void callPay(JSON.stringify(e))},t.prototype.dchwgamePay=function(t){var i=e.Global.globalConfig.dchwgamePay;i=i+"?cb=?&amount="+t.orderMoney+".00&applicationID=101901823&country=CN&currency=CNY&url="+e.Global.globalConfig.dchwgamePayCallBack+"&productDesc="+t.productName+"&productName="+t.productName+"&extReserved=101901823&requestId="+t.orderId+"&serviceCatalog=X6&merchantId=890086000300426217&merchantName=''&urlver=2&sdkChannel=3",e.GameUtils.httpReqsajax(i,"",this.dchwgamePayBack.bind(this),null)},t.prototype.dchwgamePayBack=function(e){console.log("服务器数据--star"),console.log(e),console.log("服务器数据--end");var t={};t.amount=e.amount,t.applicationID=e.applicationID,t.country=e.country,t.currency=e.currency,t.url=e.url,t.productDesc=e.productDesc,t.productName=e.productName,t.extReserved=e.extReserved,t.requestId=e.requestId,t.serviceCatalog=e.serviceCatalog,t.merchantId=e.merchantId,t.merchantName=e.merchantName,t.urlver=e.urlver,t.sdkChannel=e.sdkChannel,t.sign=e.sign,t.publicKey=e.publicKey,callPay(t)},t.prototype.newVivopay=function(t){var i=e.Global.globalConfig.newVivopay,n=100005042,o=(t.orderId,t.productName,t.productName,100*Number(t.orderMoney)),a=e.Global.globalConfig.vivoCallBack;console.log("newVivo支付money",o),i=i+"?cb=?&appId="+n+"&cpOrderNumber="+t.orderId+"&productName="+t.productName+"&productDesc="+t.productName+"&orderAmount="+o+"&notifyUrl="+a,console.log("newVivo支付调起URL",i),e.GameUtils.httpReqsajax(i,"",this.newVivoPayBack.bind(this),null)},t.prototype.newVivoPayBack=function(e){return console.log("进入支付回调BBBBBBBB "+JSON.stringify(e)),"200"!=e.respCode?void Log.trace("下单失败AAAAAAA:",e.respMsg):(console.log("解析的内容 "+JSON.stringify(e)),void callPay(JSON.stringify(e)))},t.prototype.newOppoPay=function(t){var i=e.Global.globalConfig.newOppoPay,n=100*Number(t.orderMoney),o=(new Date).getTime(),a=e.Global.globalConfig.oppoCallBack,s=this.userInfoData.platformVersion;i=i+"?cb=?&appId="+this.userInfoData.appKey+"&openId="+this.userInfoData.token+"&timestamp="+o+"&productName="+t.productName+"&productDesc="+t.productName+"&count=1&price="+n+"&currency=CNY&cpOrderId="+t.orderId+"&appVersion="+e.Global.version+"&engineVersion="+s+"&callBackUrl="+a,console.log("newOppo支付调起URL:"+i),e.GameUtils.httpReqsajax(i,"",this.newOppoPayBack.bind(this),null)},t.prototype.newOppoPayBack=function(e){return console.log("newOppo支付的返回回调:"+JSON.stringify(e)),"200"!=e.code?void Log.trace("下单失败:",e.msg):void callPay(e)},t.prototype.loginWanBa=function(){this.callback.call(this.thisObject)},t.prototype.wanbacheckPay=function(t){if(Log.trace("wanba_pay"),void 0==this.game_id||void 0==this.uid)return alert("玩吧数据链接断开 请重新登陆尝试支付");var i;Math.round((new Date).getTime()/1e3);"1107925907"==getGlobalConfig().wanBaAppId?i=e.JsonDataManager.instance.rechargeConfig_wanbaTemplate[t.goodsId+""+this.zoneId]:"1108023326"==getGlobalConfig().wanBaAppId&&(i=e.JsonDataManager.instance.rechargeConfig_wanbaQLDTemplate[t.goodsId+""+this.zoneId]);var n=e.Global.globalConfig.platformUrl+"/callback/wanBaCallBack";n+="?cb=?&appid="+this.game_id+"&openid="+this.uid+"&openkey="+getQLDOpenKey()+"&zoneid="+this.zoneId+"&itemid="+i.rechargeId+"&money="+i.rewardstarmoney+"&billno="+t.orderId+"&count=1&qua=qua&pf="+getQLDOpf()+"&format=json",e.GameUtils.httpReqsajax(n,null,this.wanbaback.bind(this),null),Log.trace(n)},t.prototype.wanbaback=function(t){Log.trace(t,t.code),"1004"==t.code||"1002"==t.code?(e.GameUtils.MSG_TIP("余额不足，请先充值"),callPay(t)):"0"==t.code&&e.GameUtils.MSG_TIP("充值成功")},t.prototype.login5432u=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/5432ULogin";i=i+"?cb=?&user_id="+this.uid+"&sign="+this.token+"&time="+this.sign,e.GameUtils.httpReqsajax(i,null,function(e){return"0"!=String(e.errno)?void alert(e.message):(t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))},null)},t.prototype.fivefourthreetwoupay=function(t){var i=e.PlayerService.instance.mainRoleInfo.getName(),n=e.Global.globalConfig.platformUrl+"/callback/5432URecharge";n=n+"?cb=?&game_id=67&user_id="+this.uid+"&role="+i+"&props_name="+t.productName+"&total_fee="+t.orderMoney+"&trade_id="+t.orderId+"&attach="+t.orderId+"&res_code=1",e.GameUtils.httpReqsajax(n,null,function(e){callPay(e)},null)},t.prototype.login333h5=function(){var t=e.Global.globalConfig.platformUrl+"/callback/touTiaoLoginMD5";t=t+"?cb=?&pf="+this.prefix+"&appKey="+this.game_id+"&stime="+this.stime+"&ticket="+this.ticket,e.GameUtils.httpReqsajax(t,{gameId:this.game_id,uid:this.uid,userName:this.username,time:this.stime,sign:this.sign},this.toutiaocallback.bind(this))},t.prototype.toutiaocallback=function(e){this.puid=this.prefix+this.uid,this.callback.call(this.thisObject)},t.prototype.toutiaopay=function(t){var i=Math.round((new Date).getTime()/1e3),n=e.PlayerService.instance.mainRoleInfo.getName(),o=e.Global.globalConfig.platformUrl+"/callback/touTiaoPayOrderMD5";o=o+"?cb=?&gameId="+this.game_id+"&uid="+this.uid+"&time="+i+"&server="+e.Global.serverName+"&role="+n+"&goodsId="+t.goodsId+"&goodsName="+t.productName+"&money="+t.orderMoney+"&cpOrderId="+t.orderId,e.GameUtils.httpReqsajax(o,{gameId:Number(this.game_id),uid:Number(this.uid),time:i,server:e.Global.serverName,role:n,goodsId:t.goodsId,goodsName:t.goodsName,money:parseFloat(t.orderMoney),cpOrderId:t.orderId},this.toutiaoback.bind(this),null)},t.prototype.toutiaoback=function(t){if("0"==t)return e.GameUtils.MSG_TIP("订单获取失败，请再试一次"),void Log.trace(t.errormsg);var i={cpOrderId:t.cpOrderId,gameId:t.gameId,goodsId:t.goodsId,goodsName:t.goodsName,money:t.money,role:t.role,server:t.server,time:t.time,uid:t.uid,ext:"test",sign:t.sign,signType:"md5"};callPay(i)},t.prototype.oppoapkpay=function(t){var i=this,n=100*Number(t.orderMoney),o=e.Global.globalConfig.oppoPay;this.stime=(new Date).getTime(),o=o+"?cb=?&appId="+this.appId+"&openId="+this.token+"&productName="+t.productName+"&productDesc="+t.productName+"&count=1&timestamp="+this.stime+"&price="+n+"&currency=CNY&attach="+t.orderId+"&cpOrderId="+t.orderId+"&appVersion="+e.Global.version+"&engineVersion=5.2.4",e.GameUtils.httpReqsajax(o,{},function(e){if(200==Number(e.code)){var t={};t={appId:i.appId,pkgName:1,token:i.token,timestamp:i.stime,orderNo:e.data.orderNo,paySign:e,success:function(e){},fail:function(e){},complete:function(e){}},callPay(t)}})},t.prototype.loginXYW=function(){var t=e.Global.globalConfig.platformUrl+"/callback/QLDXiYouLogin";t=t+"?cb=?&token="+this.token,e.GameUtils.httpReqsajax(t,null,this.loginXYWCallBack.bind(this))},t.prototype.loginXYWCallBack=function(t){if(200!=t.status)return void e.GameUtils.MSG_TIP(t.message);var i=t.data;this.uid=i.userID,this.puid=this.prefix+this.uid,this.username=i.username,this.callback.call(this.thisObject)},t.prototype.loginZYWXZX=function(){var t=e.Global.globalConfig.platformUrl+"/callback/ZiYunLogin";t=t+"?cb=?&token="+this.token,e.GameUtils.httpReqsajax(t,null,this.loginZYWXZXCallBack.bind(this))},t.prototype.loginZYWXZXCallBack=function(t){if(200!=t.status)return void e.GameUtils.MSG_TIP(t.message);var i=t.data;this.uid=i.userID,this.puid=this.prefix+this.uid,this.username=i.username,this.callback.call(this.thisObject)},t.prototype.payXYW=function(t){var i=e.JsonDataManager.instance.rechargeConfig_xiyouwang[t.goodsId],n=((new Date).getTime(),100*Number(t.orderMoney)),o=getGlobalConfig().isDebug?9996:e.Global.serverId,a=e.Global.globalConfig.platformUrl+"/callback/QLDXiYouRecharge";a=a+"?cb=?&uid="+this.uid+"&productID="+i.rechargeId+"&productName="+t.productName+"&productDesc="+t.productName+"&buyNum=1&money="+n+"&roleID="+e.PlayerService.instance.playerInfo.getPlayerId()+"&roleName="+e.PlayerService.instance.mainRoleInfo.getName()+"&roleLevel="+e.PlayerService.instance.playerInfo.getLevel()+"&serverID="+o+"&serverName="+e.Global.serverName+"&extension="+t.orderId+"&pid="+this.userInfoData.pid;var s=function(a){if(200!=a.status)return void e.GameUtils.MSG_TIP("西游支付"+a.message);var s={};s.fixedPay=!0,s.productId=i.rechargeId,s.productName=t.productName,s.productDesc=t.productName,s.ration=100,s.coinName="元宝",s.price=n,s.buyNum=1,s.orderId=a.data.orderNo,s.extension=a.data.extension,s.serverId=o,s.serverName=e.Global.serverName,callPay(s)};e.GameUtils.httpReqsajax(a,null,s.bind(this))},t.prototype.zybzscpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,appid:1110075319,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.zybsqxpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,appid:1110384112,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.zybcycjpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,appid:1110392826,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.zybjlcqpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,appid:1110361635,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.zywxzxpay=function(e){var t=Number(e.orderMoney);callPay({openid:this.uid,openkey:this.pid,appid:1110140198,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:t,billno:e.orderId})},t.prototype.zywxzxPayCallback=function(e){return console.log("￥￥￥￥￥￥￥￥"),console.info(e),console.log("$$$$$$$$$$$$$$$"),"200"!=e.respCode?void Log.trace("下单失败:",e.respMsg):void callPay({openid:this.uid,openkey:this.pid,appid:1110140198,pf:this.fp,pfkey:this.token,payitem:e.productName,zoneid:1,amt:6,billno:e.orderId})},t.prototype.loginx7js=function(){var t=e.Global.globalConfig.platformUrl+"/callback/xiaoQiLoginVerify";t=t+"?cb=?&pf="+this.prefix+"&appKey="+this.game_id+"&stime="+this.stime+"&ticket="+this.ticket,e.GameUtils.httpReqsajax(t,{game_key:this.game_id,login_stime:this.stime,login_ticket:this.ticket},this.x7jscallback.bind(this))},t.prototype.x7jscallback=function(t){if(0!=t.errorno)return void e.GameUtils.MSG_TIP(t.errormsg);var i=t.userData;this.uid=i.user_id,this.puid=this.prefix+this.uid,this.username=i.user_name,this.callback.call(this.thisObject)},t.prototype.logincycs=function(){this.puid=this.prefix+this.uid,this.callback.call(this.thisObject)},t.prototype.paycycs=function(t){var i={cp_order_id:t.orderId,product_price:Number(t.orderMoney).toFixed(2),product_count:1,product_id:t.goodsId,product_name:t.productName,product_desc:t.productName,exchange_rate:10,currency_name:"元宝",ext:t.orderId,role_type:1,server_id:e.Global.serverId,server_name:e.Global.serverName,role_id:e.PlayerService.instance.playerInfo.getPlayerId(),role_name:e.PlayerService.instance.mainRoleInfo.getName(),party_name:100,role_level:e.PlayerService.instance.playerInfo.getLevel(),role_vip:e.PlayerService.instance.playerInfo.getVipLevel(),role_balence:e.PlayerService.instance.playerInfo.getGold().toFixed(2)};callPay(i)},t.prototype.loginqidian=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/QiDianLogin";i=i+"?cb=?&mem_id="+this.uid+"&user_token="+this.token+"&app_id=64952",console.log(i),e.GameUtils.httpReqsajax(i,null,function(e){return 1!=e.status?void alert(e.msg):(t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))})},t.prototype.login6wwy=function(){var t=this,i=e.Global.globalConfig.platformUrl+"/callback/WuWangYouLogin";i=i+"?cb=?&mem_id="+this.uid+"&user_token="+this.token+"&app_id=6147",e.GameUtils.httpReqsajax(i,null,function(e){return 1!=e.status?void alert(e.msg):(t.puid=t.prefix+t.uid,void t.callback.call(t.thisObject))})},t.prototype.wwypay=function(t){var i={cp_order_id:t.orderId,product_price:Number(t.orderMoney).toFixed(2),product_count:1,product_id:t.goodsId,product_name:t.productName,product_desc:t.productName,exchange_rate:10,currency_name:"元宝",ext:t.orderId,role_type:1,server_id:e.Global.serverId,server_name:e.Global.serverName,role_id:e.PlayerService.instance.playerInfo.getPlayerId(),role_name:e.PlayerService.instance.mainRoleInfo.getName(),party_name:100,role_level:e.PlayerService.instance.playerInfo.getLevel(),role_vip:e.PlayerService.instance.playerInfo.getVipLevel(),role_balence:e.PlayerService.instance.playerInfo.getGold().toFixed(2)};callPay(i)},t.prototype.x7pay=function(t){var i=(new Date).getTime(),n=Number(t.orderMoney).toFixed(2),o=e.Global.globalConfig.platformUrl+"/callback/xiaoQiPayOrder";o=o+"?cb=?&user_id="+this.uid+"&description="+t.productName+"&game_key="+this.game_id+"&game_price="+n+"&game_role_id="+this.uid+"&game_area="+e.Global.serverId+"&game_group=konhg&game_level="+e.PlayerService.instance.playerInfo.getLevel()+"&game_orderid="+t.orderId+"&notify_id=-1&extends_data=konhg&stime="+i+"&subject="+t.productName+"_"+n,e.GameUtils.httpReqsajax(o,{description:t.productName,extends_data:"konhg",game_area:e.Global.serverId,game_group:"konhg",game_key:this.game_id,game_level:e.PlayerService.instance.playerInfo.getLevel(),game_orderid:t.orderId,game_price:n,game_role_id:this.uid,notify_id:"-1",stime:i,subject:t.productName+"_"+n,user_id:this.uid},this.x7payback.bind(this))},t.prototype.x7payback=function(e){callPay(e)},t.prototype.loginwifi=function(){var t=e.Global.globalConfig.wifiUrl;t=t+"?cb=?&token="+this.token,e.GameUtils.httpReqsajax(t,{token:this.token},this.wificallback.bind(this))},t.prototype.wificallback=function(e){if("0000"!=e.code)return void(parent.location.href="http://act1.lianwifi.com/");var t=e.data;this.uid=t.open_id,this.puid=this.prefix+this.uid,this.username=""+this.uid,this.game_id=t.game_id,this.reserved=String(t.reserved),this.callback.call(this.thisObject)},t.prototype.errorHandler=function(t){return"function"==typeof errorHandle?void errorHandle(0):void e.LoginController.instance.connectServer()},t.prototype.callWechatShare=function(e){return callWechat(e),!0},t.prototype.checkFollow=function(e){checkFollow(e)},t.prototype.follow=function(){follow()},t.prototype.wifipay=function(t){var i=e.Global.globalConfig.wifipay;i=i+"?cb=?&open_id="+this.uid+"&reserved="+this.reserved+"&game_id="+this.game_id+"&out_trade_no="+t.orderId+"&total_fee="+100*Number(t.orderMoney)+"&subject="+t.productName,e.GameUtils.httpReqsajax(i,{open_id:this.uid,out_trade_no:t.orderId,game_id:this.game_id,reserved:this.reserved,total_fee:100*Number(t.orderMoney),subject:t.productName},this.wifipaycallback.bind(this),null,"post")},t.prototype.wifipaycallback=function(t){return"0000"!=t.code?(e.GameUtils.MSG_TIP("订单获取失败，请再试一次"),void Log.trace(t.message)):void callPay(t.data.url)},t.prototype.payGoods=function(i){if(t.isQQdating||"QQdating"==getchannel()||-1!=getchannel().indexOf("x7app")||-1!=getchannel().indexOf("dcerf"))return void e.GameUtils.MSG_TIP("充值功能已关闭！");var n=!0;if(i.goodsId?i.orderId||(n=!1):n=!1,n&&"function"==typeof callPay){var o=e.PlayerService.instance.playerInfo.getPlayerId(),a=e.PlayerService.instance.mainRoleInfo.getName(),s=e.PlayerService.instance.mainRoleInfo.getLevel(),r=e.Global.serverName,l=e.Global.serverId,h=e.PlayerService.instance.playerInfo.getFirstRechargeState(),c=this.pfName+"_"+this.prefix,u=0,p={};if(("ucgame_"==this.prefix||"ucgame"==this.prefix)&&"iOS"==egret.Capabilities.os&&(u=1,console.log("UC Ios Pay Way!")),"changjing_"==this.prefix)return this.changjingpay(i),n;if("xbtxlbqkl_"==this.prefix)return console.log("查看dragonEx "+this.pfName+" "+this.prefix),this.payByxbtxlbqkl(i),n;if("lingo666_"==this.prefix)return this.lingo666pay(i),n;if("mgtv_"==this.prefix)return this.mgtvpay(i),n;if("qumi_"==this.prefix)return this.qumipay(i),n;if(-1!=this.userInfoData.prefix.indexOf("cycqjiuxiu"))return this.jiuXiuPay(i),n;if(-1!=this.userInfoData.prefix.indexOf("1sdk"))return this.sdk1pay(i),n;if(-1!=this.userInfoData.prefix.indexOf("yjyxf"))return this.yjyxfpay(i),n;if("fztlxcx_"==this.prefix)return this.wechatpay(i),n;if("sxptxcx_"==this.prefix)return this.wechatpay(i),n;if("csyxxcx_"==this.prefix)return this.wechatpay(i),n;if("tlwc7_"==this.prefix)return this.wechatpay(i),n;if("ytdjbwc8_"==this.prefix)return this.wechatpay(i),n;if("sctxwc9_"==this.prefix)return this.wechatpay(i),n;if("mscjzy_"==this.prefix)return this.fivefourthreetwoupay(i),n;if("x7js_"==this.prefix)return this.x7pay(i),n;if(-1!=this.prefix.indexOf("5wan"))return this.fivewanpay(i),n;if(-1!=this.prefix.indexOf("123456"))return this.oppoapkpay(i),n;if(-1!=this.prefix.indexOf("x7app"))return this.x7apppay(i),n;if(-1!=this.prefix.indexOf("seenlove"))return this.seenlovepay(i),n;if("333h5_"==this.prefix)return this.toutiaopay(i),n;if("weChat_"==this.prefix)return this.wechatpay(i),n;if("wanba_ts_"==this.prefix)return this.wanbacheckPay(i),n;if("acg5_"==this.prefix)return this.manwupay(i),n;if("guchuan_"==this.prefix)return this.guchuancheckPay(i),n;if("jjyh5_"==this.prefix)return this.loginjjyh5pay(i),n;if("hsh5_"==this.prefix)return this.loginhsh5pay(i),n;if("jdh5_"==this.prefix)return this.jdh5pay(i),n;if("jiayoubz_"==this.prefix||"azypadyz_"==this.prefix||"bzypadyz_"==this.prefix)return this.yybysdkpay(i),n;if((this.prefix==t.qldqkl_android+"_"||this.prefix==t.qldqkl_ios+"_")&&""==egret.getOption("dt"))return this.oasissdkpay(i),n;if("jywxzx_"==this.prefix)return console.log("无限之心支付！！ 调用开始··"),this.zywxzxpay(i),n;if("qdhjcs_"==this.prefix)return console.log("百战沙城 调用开始··"),this.zybzscpay(i),n;if("bsqx_"==this.prefix)return console.log("霸世群雄---Start"),this.zybsqxpay(i),n;if("cycj_"==this.prefix)return console.log("赤月裁决---Start"),this.zybcycjpay(i),n;if("jlcq_"==this.prefix)return console.log("君临传奇---Start"),this.zybjlcqpay(i),n;if("haiwan_"==this.prefix)return this.haiwanPay(i),n;if("anqu"==this.chanel)return this.anqupay(i),n;if("uuuo_"==this.prefix)return this.uuuopay(i),n;if("iyouzu_"==this.prefix)return p={pid:this.pid,gid:this.appKey,sid:this.sid,uid:this.uid,uname:this.username,money:String(i.orderMoney),other:i.orderId},callPay(p),n;if(-1!=this.prefix.indexOf("yougu"))return void this.yougupay(i);if(-1!=this.prefix.indexOf("xbtxhwkyx"))return void this.huaweiPay(i);if(-1!=this.prefix.indexOf("baidugame"))return void this.baiduPay(i);if(-1!=this.prefix.indexOf("ttgame"))return void this.ttPay(i);if(-1!=this.prefix.indexOf("vivogame"))return console.log("vivopay 进入方法"),void this.vivopay(i);if(-1!=this.prefix.indexOf("dchwgame"))return void this.dchwgamePay(i);if(-1!=this.prefix.indexOf("newvivogame"))return console.log("newVivopay 进入方法"),void this.newVivopay(i);if(-1!=this.prefix.indexOf("wx360game"))return void e.GameUtils.MSG_TIP("充值功能已关闭！");if(-1!=this.prefix.indexOf("opporpk"))return void this.oppopay(i);if(-1!=this.prefix.indexOf("newOppogame"))return void e.GameUtils.MSG_TIP("充值功能已关闭！");if(-1!=this.prefix.indexOf("qqgame")||-1!=this.prefix.indexOf("mfsqgame")||-1!=this.prefix.indexOf("mrbjqqgame"))return this.qqpay(i),n;if(-1!=this.prefix.indexOf("mfxyoppo"))return void this.generaoppoPay(i);if(-1!=this.prefix.indexOf("6wwy"))return this.wwypay(i),n;if("cyqdand_"==this.prefix)return this.wwypay(i),n;if(-1!=this.prefix.indexOf("cycs"))return this.paycycs(i),n;if(-1!=this.prefix.indexOf("wxgame"))return this.wxpay(i),n;if(-1!=this.prefix.indexOf("wx_xinghe")){var g=e.PlayerService.instance;return i.serverId=e.Global.serverId,i.serverName=e.Global.serverName,i.roleId=e.Global.playerId+"",i.roleName=g.mainRoleInfo.getName(),i.level=g.level,i.vipLevel=g.vipLevel,callPay(i),n}if(-1!=this.prefix.indexOf("suyi"))return this.suyipay(i),n;if(-1!=this.prefix.indexOf("dcerfxm"))return this.sydcxmpay(i),n;if(-1!=this.prefix.indexOf("mfxyxmgame")||-1!=this.prefix.indexOf("mrbjxmgame"))return this.userInfoData=checkLogin(),this.uid=this.userInfoData.uid,this.session=this.userInfoData.session,void this.xmGeneralPay(i);if("wifi_"==this.prefix)return this.wifipay(i),n;if("gyyx_"==this.prefix)p={orderNo:i.orderId,rmb:i.orderMoney,goodName:i.productName,goodDesc:i.productName,userId:this.uid,gameNotifyUrl:e.Global.globalConfig.platformUrl+"/callback/guangYuCallBack",serverId:l,gameRoleId:o,gameRoleName:a,gameRoleGrade:s,goodPrice:i.orderMoney,goodCount:1,commonParam:i.orderId};else if("leyouxf"==this.chanel)p={userid:this.uid,server_id:l,roleid:o,amt:i.orderMoney.toFixed(2),goodsid:i.goodsId,cporder:i.orderId,custom:i.orderId,appkey:this.game_id,banid:checkPlatformStr(),token:this.token};else if("jinjun_"==this.prefix){var d=e.JsonDataManager.instance.RechargeConfig_jinjunTemplate[i.goodsId];p={roleid:o,rolename:a,rolelevel:s,serverid:l,servername:r,cpbill:i.orderId,productname:i.productName,price:i.orderMoney,appid:this.game_id,productid:d.id,productdesc:d.desc,username:this.username,extension:i.orderId}}else{if("chengzi_"==this.prefix)return this.chengziPay(i),n;if("te6_"==this.prefix)return this.te6Pay(i),n;if("xyw_"==this.prefix)return this.payXYW(i),n;var d=e.JsonDataManager.instance.recharge1758Template[i.goodsId+"_"+this.appKey],f=null!=d?d.rechargeId:-1,m=(new Date).getTime(),y=new MD5,I=y.hex_md5(this.appKey+i.orderId+i.orderMoney+m+"d65f427a711e01c4805c4c9072f6b2db"),v=e.PlayerService.instance.getRoleid();p={playerId:o,playerName:a,serverId:l,servername:r,orderId:i.orderId,productName:i.productName,productId_1758:f,productId:i.goodsId,price:i.orderMoney,diamond:i.diamondNum,giftDiamond:i.giftDiamondNum,userId:this.uid,userName:this.username,isFirst:h,gameid:this.appKey,extInfo:c,time:m,level:s,ext:i.orderId,sign:I,isUcgameIos:u,roleid:v}}callPay(p)}return n},t.prototype.getDatacallRollInfo=function(e){"function"==typeof callRollInfo&&callRollInfo(e)},t.prototype.getQQminiPlatForm=function(){var e=checkLogin();return e.qqPlartForm},t.prototype.getUserInfoData=function(){return this.userInfoData},t.prototype.getPuid=function(){return this.puid},t.prototype.setPuild=function(e){this.puid=e},t.prototype.getUserName=function(){return this.username},t.prototype.isHttp=function(){return this.userInfoData.isHttp},t.prototype.reportData_legend=function(e){"function"==typeof reportData_legend_legend&&reportData_legend_legend(e)},Object.defineProperty(t,"isDragonEx",{get:function(){return egret.getOption("pf")==this.dragonEXPF},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isDragonEx_qld",{get:function(){var e=egret.getOption("pf");return e==this.qldqkl_android||e==this.qldqkl_ios},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isQQdating",{get:function(){return"Windows PC"!=egret.Capabilities.os&&"Mac OS"!=egret.Capabilities.os||"QQdating"!=egret.getOption("pf")?!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isXqwd",{get:function(){var e=egret.getOption("pf");return e&&"x7app"==e?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isXqRealUser",{get:function(){return"1"==e.GamePlatform.is_real_user?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"is_XqEighteen",{get:function(){return"1"==e.GamePlatform.is_eighteen?!0:!1},enumerable:!0,configurable:!0}),t.sendRechargeOasis=function(){var t={},i=e.JsonDataManager.instance.rechargeProductIdTemplate["com.feefoxes.qmby.101"];t.goodsId=i.productId,t.productName=i.productName,t.orderMoney=i.costMoney,t.diamondNum=0,t.giftDiamondNum=0,e.RechargeController.getInstance().setPayData(t);var n=HawkProtocolManager.newBuilder("JsProto.HPRechargeRequest");n.setGoodsId(i.productId),e.Message.instance.send(e.Code.RECHARGE_REQUEST,n,!0)},t.is_real_user="",t.is_eighteen="",t.IOS="iOS",t.ANDROID="Android",t.WINDOWSPHONE="Windows Phone",t.WINDOWSPC="Windows PC",t.MACOS="Mac OS",t.logDomain="https://log.reyun.com/receive/rest/event",t.reyunAppId="377a773a30210a86098bea778143e8ea",t.dragonEXPF="xbtxlbqkl",t.qldqkl_android="oasis",t.qldqkl_ios="iosoasis",t}();e.GamePlatform=t,__reflect(t.prototype,"foxgame.GamePlatform")}(foxgame||(foxgame={}));var JrttPlatform=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){getGlobalConfig().serverUrl=this.serverUrl="h5legend-jrtt.xiyouchat.com/gateway/servers",getGlobalConfig().serverUrl=this.announcementUrl="h5legend-jrtt.xiyouchat.com/gateway/notice?cb=?",getGlobalConfig().platformUrl=this.platformUrl="h5legend-jrtt.xiyouchat.com",getGlobalConfig().isDebug=this.isDebug="false",getGlobalConfig().I1758Url=this.I1758Url="h5legend.6deer.com/callback/1758PlaceAnOrder",getGlobalConfig().wss=this.wss="wss-jrtt.xiyouchat.com",getGlobalConfig().glFormat=this.glFormat="false",getGlobalConfig().wifiUrl=this.wifiUrl="h5legend.6deer.com/callback/getWiFiOpenId",getGlobalConfig().wifiPay=this.wifiPay="h5legend.6deer.com/callback/wifiPlaceAnOrder",getGlobalConfig().sdkUrl=this.sdkUrl="h5legend.6deer.com",getGlobalConfig().wanBaAppId=this.wanBaAppId=0,getGlobalConfig().wanBaAppId=this.wanBaAppId=0,getGlobalConfig().isFd=this.isFd=1},t}(Platform);__reflect(JrttPlatform.prototype,"JrttPlatform");var foxgame;!function(e){var t=function(){function t(){this.isWSP=!1,this.closeCount=0,this.toStartGame=!1,this.msgMap=new e.HashMap}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.tickHandler=function(t){if(!this.socket)return!1;if("mfsqgame"==window.GJlenged_chanel||"mrbjqqgame"==window.GJlenged_chanel){var i=this.socket.handler.socket.connected;i||(i=this.socket.handler.socket.socket.socketTask,i=i.readyState),this.toStartGame&&(i||1==i)&&(this.toStartGame=!1,egret.stopTick(this.tickHandler,this),e.LoginController.instance.requestLoginServer(),e.MtaUtils.notifyEvent("jibenzhuanhua",{sendlogingamesvr:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_sendLoginGameSvr"}),e.AldUtils.sendEvent("game_sendLoginGameSvr","game_sendLoginGameSvr"),1==e.MtaUtils.checkEventJiaZaiJinYouXi&&e.MtaUtils.notifyEvent("jiazaijinyouxi",{sendloginproto:"true"}))}else{var i=this.socket.handler.socket.socket.socket;i||(i=this.socket.handler.socket.socket.socketTask),i=i.readyState,this.toStartGame&&1==i&&(this.toStartGame=!1,egret.stopTick(this.tickHandler,this),e.LoginController.instance.requestLoginServer(),e.MtaUtils.notifyEvent("jibenzhuanhua",{sendlogingamesvr:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_sendLoginGameSvr"}),e.AldUtils.sendEvent("game_sendLoginGameSvr","game_sendLoginGameSvr"),1==e.MtaUtils.checkEventJiaZaiJinYouXi&&e.MtaUtils.notifyEvent("jiazaijinyouxi",{sendloginproto:"true"}))}return!1},t.prototype.connectSmart=function(t,i,n){var o=null;o=e.Global.globalConfig.isDebug?"ws://"+t+":"+i:"wss://"+e.Global.globalConfig.wss+"/wss?ip="+t+"&port="+i.toString(),Log.trace(o),this.connect(o,n)},t.prototype.connect=function(t,i){if(this.toStartGame=!1,this.socket){this.close();var n=this;return void setTimeout(function(){n.connect(t,i)},2e3)}if(this.socket)Log.trace("connect socket active");else{e.Global.wsValid||(this.isWSP=!0);var o=e.UserInfo.enableWSProxy()&&!window.WebSocket;o&&console.error("testWebSocketNotOk"),this.isWSP||o||e.UserInfo.testWSProxy()?(e.CollectUtils.event({uid:e.PlayerService.instance.puid,op:"open_wsproxy"}),this.socket=new HawkSocketProxy,Log.trace("use WSProxy:"+i),this.socket.connect(i,this.onSocketOpen,this.onSocketClose,this.onSocketError,this),this.timeOut=new egret.Timer(1e4,1),this.timeOut.addEventListener(egret.TimerEvent.TIMER,this.timeOutHandler,this),this.timeOut.start()):(this.socket=new HawkSocket,this.socket.connect(t,this.onSocketOpen,this.onSocketClose,this.onSocketError,this),this.timeOut=new egret.Timer(1e4,1),this.timeOut.addEventListener(egret.TimerEvent.TIMER,this.timeOutHandler,this),this.timeOut.start())}},t.prototype.timeOutHandler=function(i){Log.trace("socket connect timeout..."),console.log("连接超时"),e.CollectUtils.event({uid:e.PlayerService.instance.puid,op:"socket_timeout"}),this.close(),this.closeCount++,t.instance.send(e.MsgCMD.NetWork_Connect_TimeOut_Msg),this.closeCount>=3&&e.UserInfo.enableWSProxy()?(this.closeCount=0,this.isWSP=!this.isWSP,this.isWSP?(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("TryConnectGameSvrProxy")),this.connect("",e.Global.wsproxy),console.log("Global.wsproxy  "+e.Global.wsproxy)):(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("TryConnectGameSvrWebSocket")),this.connectSmart(e.Global.serverHost,e.Global.serverPort,e.Global.wsproxy),console.log(e.LanguageUtils.instance.getValue("TryConnectGameSvrWebSocket")))):e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("ConnectGameSvrFailed"))},t.prototype.removeTimer=function(){this.timeOut&&(this.timeOut.removeEventListener(egret.TimerEvent.TIMER,this.timeOutHandler,this),this.timeOut.stop(),this.timeOut=null)},t.prototype.close=function(){this.removeTimer(),this.socket&&this.socket.close(),this.socket=null,this.closeCount=0,this.toStartGame=!1},t.prototype.onSocketOpen=function(){e.Global.isKickOut=!1,this.closeCount=0,this.removeTimer();var t;return"mfsqgame"==window.GJlenged_chanel||"mrbjqqgame"==window.GJlenged_chanel?(t=this.socket.handler.socket.connected,t||(t=this.socket.handler.socket.socket.socketTask,t=t.readyState,console.log("socket连接成功readyState:"+t),Log.trace("onSocketOpen WebSocket readyState: "+t))):(t=this.socket.handler.socket.socket.socket,t||(t=this.socket.handler.socket.socket.socketTask),t=t.readyState,console.log("socket连接成功readyState:"+t),Log.trace("onSocketOpen WebSocket readyState: "+t)),this.toStartGame?void console.error("onSocketOpen toStartGame already true"):(this.toStartGame=!0,egret.startTick(this.tickHandler,this),e.MtaUtils.notifyEvent("jibenzhuanhua",{socketopengamesvr:"true"}),e.MtaUtils.notifyEvent("notify",{msg:"game_socketOpenGameSvr"}),e.AldUtils.sendEvent("game_socketOpenGameSvr","game_socketOpenGameSvr"),void(1==e.MtaUtils.checkEventJiaZaiJinYouXi&&e.MtaUtils.notifyEvent("jiazaijinyouxi",{connectopengamesvr:"true"})))},t.prototype.reloadGame=function(){-1!=e.UserInfo.platform.prefix.indexOf("bagfquick")?parent.location.reload():window.location.reload()},t.prototype.onSocketClose=function(){return console.error("服务器断开连接"),this.close(),t.instance.send(e.MsgCMD.NetWork_Closed_Msg),0==e.Global.isKickOut?(this.reconnect(),console.error("正在恢复网络通信..."),e.GameUtils.MSG_TIP("正在恢复网络通信...")):e.PopUpController.getInstance().showTextPanel("需要重新加载登录游戏！",this,this.reloadGame,null,null,null,null,null,20,!1),this.closeCount++,egret.log("network:onSocketClose "+this.closeCount),this.closeCount>=300?(this.closeCount=0,void(e.UserInfo.enableWSProxy()?(this.isWSP=!this.isWSP,this.isWSP?(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("TryConnectGameSvrProxy")),this.connect("",e.Global.wsproxy)):(e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("TryConnectGameSvrWebSocket")),this.connectSmart(e.Global.serverHost,e.Global.serverPort,e.Global.wsproxy))):e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("ConnectGameSvrFailed")))):void 0
},t.prototype.reconnect=function(){this.close(),setTimeout(function(){e.LoginController.instance.connectServer()},1500)},t.prototype.timerHandler=function(t){this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerHandler,this),this.timer=null,this.isWSP&&e.UserInfo.enableWSProxy()?(this.isWSP=!this.isWSP,egret.log("network:connect timeout try to use wsproxy"),e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("TryConnectGameSvrProxy")),this.connect("",e.Global.wsproxy)):(egret.log("network:connect timeout try to use websocket"),e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("TryConnectGameSvrWebSocket")),this.connectSmart(e.Global.serverHost,e.Global.serverPort,e.Global.wsproxy))},t.prototype.onSocketError=function(i){if(console.error("onSocketError WebSocket"),console.log("socket异常"),t.instance.send(e.MsgCMD.NetWork_Connect_Error_Msg),this.close(),0==e.Global.isKickOut?(this.reconnect(),e.GameUtils.MSG_TIP("正在恢复网络通信...")):e.PopUpController.getInstance().showTextPanel("需要重新加载登录游戏！",this,this.reloadGame,null,null,null,null,null,20,!1),this.closeCount++,egret.log("network:onSocketError"),this.closeCount>=300&&e.UserInfo.enableWSProxy())if(this.closeCount=0,e.CollectUtils.event({uid:e.PlayerService.instance.puid,op:"websocket_reader_error"}),e.UserInfo.enableWSProxy()){this.timer=new egret.Timer(100,1),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerHandler,this),this.timer.start()}else e.PopUpController.getInstance().showFloatTextPanel1(e.LanguageUtils.instance.getValue("ConnectGameSvrFailed"));else;},t.prototype.add=function(e,t){var i=this.msgMap.get(e);i||(i=[],this.msgMap.put(e,i)),-1==i.indexOf(t)&&i.push(t)},t.prototype.remove=function(e,t){var i=this.msgMap.get(e);if(i)for(var n=i.length,o=0;n>o;o++)i[o]==t&&(i[o]=null)},t.prototype.send=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);try{if(i&&this.socket){try{var n=void 0;if("mfsqgame"==window.GJlenged_chanel||"mrbjqqgame"==window.GJlenged_chanel){if(n=this.socket.handler.socket.connected,!n)return void console.error("sendProtocol WebSocket readyState: "+n)}else if(n=this.socket.handler.socket.socket.socket,n=n.readyState,1!=n)return void console.error("sendProtocol WebSocket readyState: "+n)}catch(o){}return void this.socket.sendProtocol(e,t)}var a=this.msgMap.get(e);if(a){for(var s=a.length,r=0;s>r;)a[r]?(a[r].recvMsg(e,t),r++):(a.splice(r,1),s--);if(0>=s){var l=this.msgMap.remove(e);l=null}}}catch(o){Log.trace("Message exception: "+e.toString()+"  "+o.toString()),console.error(o)}},t.prototype.initProtocol=function(){var t="resource/JsProto.txt";window.egret_quickgame&&(t=getGlobalConfig().platformUrl+"/"+t);var i=App.getResourceUtils().getSourceVersionByUrl(t);HawkProtocolManager.setType("binary"),Log.trace("begin load proto file"),console.log("protoPath"+i),HawkProtocolManager.registerProtocol(i);for(var n=e.ProtoConfig.config,o=n.length,a=0;o>a;a++)""!=n[a].proto&&HawkProtocolManager.registerHandler(n[a].code,"JsProto."+n[a].proto,this.messageHandler,this)},t.prototype.messageHandler=function(t,i){e.Global.isRelease||(Log.trace("messageHandler:"+t),Log.trace(i));try{var n=void 0;if("mfsqgame"==window.GJlenged_chanel||"mrbjqqgame"==window.GJlenged_chanel){if(n=this.socket.handler.socket.connected,!n)return void console.error("sendProtocol WebSocket readyState: "+n)}else if(n=this.socket.handler.socket.socket.socket,n=n.readyState,1!=n)return void console.error("receive messageHandler WebSocket readyState: "+n)}catch(o){}this.send(t,i)},t}();e.Message=t,__reflect(t.prototype,"foxgame.Message")}(foxgame||(foxgame={}));var PFType=function(){function e(){}return e.jrtt="test",e}();__reflect(PFType.prototype,"PFType");var PlatformManager=function(){function e(){}return e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.init=function(){var e=this.getUrlParam();-1!=e.indexOf("jrtt")&&(this.platform=new JrttPlatform)},e.prototype.getUrlParam=function(){return"function"==typeof checkPlatformStr&&(this.platformStr=checkPlatformStr()),this.platformStr},e}();__reflect(PlatformManager.prototype,"PlatformManager");var foxgame;!function(e){var t=function(){function t(){this.nextBattleTime=0,this.challengeBattleList=[],this.normalBattleList=[],this.yijiBattlelist=[]}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new e.BattleService),this._instance},enumerable:!0,configurable:!0}),t.prototype.registerListener=function(){e.Message.instance.add(e.Code.BATTLE_INFO_SYNC_S,this),e.Message.instance.add(e.Code.MAP_STATISTICS_SYNC_S,this),e.Message.instance.add(e.Code.BATTLE_OFFLINE_ACCOUNT_S,this),e.Message.instance.add(e.Code.BP_BOSS_BE_PLUNDER_NOTIFY_S,this),e.Message.instance.add(e.Code.BP_BOSS_BE_PLUNDER_RESULT_S,this)},t.prototype.clear=function(){this.challengeBattleList=[],this.normalBattleList=[],this.yijiBattlelist=[],this.mapStatistics=null,this.offlineResult=null},t.prototype.recvMsg=function(t,i){switch(t){case e.Code.BATTLE_INFO_SYNC_S:this.battle_info_sync(i);break;case e.Code.MAP_STATISTICS_SYNC_S:this.map_statistics_sync(i);break;case e.Code.BATTLE_OFFLINE_ACCOUNT_S:this.battle_offline_account(i);break;case e.Code.BP_BOSS_BE_PLUNDER_NOTIFY_S:var n=i.name;e.GameUtils.MSG_TIP(n+e.LanguageUtils.instance.getValue("QIANGDUOBOSS1"));break;case e.Code.BP_BOSS_BE_PLUNDER_RESULT_S:var o=(parseInt(i.playerId),i.name),a=i.success;e.BossBloodGroup.getInstance().getIsShow()&&e.BossBloodGroup.getInstance().close(),a?(e.GameUtils.MSG_TIP(o+e.LanguageUtils.instance.getValue("QIANGDUOBOSS2")),e.BattleScene.instance.interruptCurrentBattle()):e.GameUtils.MSG_TIP(o+e.LanguageUtils.instance.getValue("QIANGDUOBOSS3"))}},t.prototype.getBattleInfo=function(e){if("NORMAL"==e){if(this.normalBattleList.length>0)return this.normalBattleList.shift()}else if("CHALLENGE"==e){if(this.challengeBattleList.length>0)return this.challengeBattleList.shift()}else if("YIJI"==e&&this.yijiBattlelist.length>0)return this.yijiBattlelist.shift();return null},t.prototype.clearBattleInfo=function(e){"NORMAL"==e?this.normalBattleList=[]:"CHALLENGE"==e?this.challengeBattleList=[]:"YIJI"==e&&(this.yijiBattlelist=[])},t.prototype.battle_info_sync=function(e){var t=e.getBattleInfo();this.battle_info(t)},t.prototype.setCurrentChallengeType=function(e){this.currentChallengeType=e},t.prototype.getCurrentChallengeType=function(){return this.currentChallengeType},t.prototype.map_statistics_sync=function(t){this.mapStatistics=t,e.YieldController.getInstance().setModelYieldData(t)},t.prototype.getdefencePlayerId=function(){return this.defencePlayerId},t.prototype.battle_offline_account=function(i){i.getResult()&&(e.OffLineYieldController.getInstance().setModelData(i),e.OffLineYieldController.getInstance().showPanel(),e.PlayerService.instance.level>=Number(e.GlobalConfig.instance.getValue("WANBA_QLD_AD_LIMIT_LEVEL"))&&e.WanbaQQVideoAdController.getInstance().sendMessageWanbaAdReq(!0)),t.instance.nextBattleTime=1e3*i.getNextBattleTime()},t.prototype.makeRoleDataFromPlayerSnapshot=function(t){var i=new e.RoleData;return i.setRoleInfo(t.getRoles()[0]),i.setRoleEquipCellInfo(t.getCellsInfo()[0]),i},t.prototype.battle_info=function(t){t.getBattleType()==i.LEGENDARY_EMPIRE&&Log.trace("接收到服务器推送战斗胶片雄霸天下",t),t&&(this.defencePlayerId=t.getBattleData().getDefence()[0].getRole().getPlayerId(),this.curBattleType=t.getBattleType(),(this.curBattleType==i.CS_ARENA_DAN||this.curBattleType==i.CS_ARENA_PRELIMINARY)&&Log.trace("server   已经进入跨服战斗了"),this.curBattleType==i.BATTLE_PVE_MONSTER?(this.normalBattleList.push(t),e.MainControler.instance.refreshPKPlayer(),e.Message.instance.send(e.MsgCMD.BATTLE_INFO_NORMAL)):this.curBattleType==i.RUINS_BATTLE_TYPE?(this.yijiBattlelist.push(t),e.MainControler.instance.EnterFight(),e.Message.instance.send(e.MsgCMD.BATTLE_VESTIGES_INFO)):(this.challengeBattleList.push(t),e.MainControler.instance.EnterFight(),e.Message.instance.send(e.MsgCMD.BATTLE_INFO_CHALLENGE)))},t}();e.BattleService=t,__reflect(t.prototype,"foxgame.BattleService",["foxgame.IMessage"]);var i;!function(e){e[e.BATTLE_PVE_MONSTER=1]="BATTLE_PVE_MONSTER",e[e.BATTLE_PVE_BOSS=2]="BATTLE_PVE_BOSS",e[e.BATTLE_PVP_ARENA=3]="BATTLE_PVP_ARENA",e[e.BATTLE_PVP_TEAM=4]="BATTLE_PVP_TEAM",e[e.BATTLE_PVP_CAMP=5]="BATTLE_PVP_CAMP",e[e.BATTLE_PVE_ELITE_BOSS=6]="BATTLE_PVE_ELITE_BOSS",e[e.BATTLE_ALLIANCE_BATTLE=7]="BATTLE_ALLIANCE_BATTLE",e[e.BATTLE_CROSS_SERVER=8]="BATTLE_CROSS_SERVER",e[e.BATTLE_PVE_MULTI_ELITE=9]="BATTLE_PVE_MULTI_ELITE",e[e.BATTLE_REBIRTH_BOSS=10]="BATTLE_REBIRTH_BOSS",e[e.BATTLE_MAP_PK=11]="BATTLE_MAP_PK",e[e.MINE_BATTLE=12]="MINE_BATTLE",e[e.IMPERIAL_BATTLE=13]="IMPERIAL_BATTLE",e[e.FRIEND_PK_BATTLE=14]="FRIEND_PK_BATTLE",e[e.ENEMY_PK_BATTLE=15]="ENEMY_PK_BATTLE",e[e.HALFANIMAL_WAR=16]="HALFANIMAL_WAR",e[e.DAY_COPY=17]="DAY_COPY",e[e.BOSS_PLUNDER_SINGLE=18]="BOSS_PLUNDER_SINGLE",e[e.BATTLE_PVE_FIVE_BOSS3=19]="BATTLE_PVE_FIVE_BOSS3",e[e.BATTLE_PVE_FIVE_BOSS4=20]="BATTLE_PVE_FIVE_BOSS4",e[e.BATTLE_PVE_FIVE_BOSS5=21]="BATTLE_PVE_FIVE_BOSS5",e[e.BATTLE_UNION_BOSS=22]="BATTLE_UNION_BOSS",e[e.BATTLE_CHALLENGE=23]="BATTLE_CHALLENGE",e[e.GHOST_TOWER=24]="GHOST_TOWER",e[e.LEGENDARY_EMPIRE=25]="LEGENDARY_EMPIRE",e[e.PRISONER_LVEDUO=26]="PRISONER_LVEDUO",e[e.PRISONER_REWENZHI=27]="PRISONER_REWENZHI",e[e.CS_ARENA_DAN=28]="CS_ARENA_DAN",e[e.CS_ARENA_PRELIMINARY=29]="CS_ARENA_PRELIMINARY",e[e.BATTLE_GUIDE=30]="BATTLE_GUIDE",e[e.MAIN_CITY_GUIDE=31]="MAIN_CITY_GUIDE",e[e.RUINS_BATTLE_TYPE=32]="RUINS_BATTLE_TYPE",e[e.BOSS_TWELVE_PALACE_FIGHT=35]="BOSS_TWELVE_PALACE_FIGHT",e[e.PVP_ATTACK_TWELVE_PALACE_PLAYER=36]="PVP_ATTACK_TWELVE_PALACE_PLAYER",e[e.PVP_HITBACK_TWELVE_PALACE_ATTACTER=37]="PVP_HITBACK_TWELVE_PALACE_ATTACTER",e[e.PVP_CHALLENGE_TWELVE_PALACE_OWNER=38]="PVP_CHALLENGE_TWELVE_PALACE_OWNER",e[e.CS_PVE_BATTLE_BOSS_AND_PALYER=40]="CS_PVE_BATTLE_BOSS_AND_PALYER",e[e.UNION_SIEGE_GATE_BATTLE=41]="UNION_SIEGE_GATE_BATTLE",e[e.UNION_SIEGE_BATTLE_ROYAL_CITY=42]="UNION_SIEGE_BATTLE_ROYAL_CITY",e[e.UNION_SIEGE_BATTLE_PALACE_FRONT=43]="UNION_SIEGE_BATTLE_PALACE_FRONT",e[e.UNION_SIEGE_BATTLE_PALACE=44]="UNION_SIEGE_BATTLE_PALACE",e[e.CS_UNION_SIEGE_GATE_BATTLE=45]="CS_UNION_SIEGE_GATE_BATTLE",e[e.CS_UNION_SIEGE_BATTLE_ROYAL_CITY=46]="CS_UNION_SIEGE_BATTLE_ROYAL_CITY",e[e.CS_UNION_SIEGE_BATTLE_PALACE_FRONT=47]="CS_UNION_SIEGE_BATTLE_PALACE_FRONT",e[e.CS_UNION_SIEGE_BATTLE_PALACE=48]="CS_UNION_SIEGE_BATTLE_PALACE"}(i=e.BattleType||(e.BattleType={}));var n;!function(e){e[e.ACTION_RECOVERMP=1]="ACTION_RECOVERMP",e[e.ACTION_RECOVERHP=2]="ACTION_RECOVERHP",e[e.ACTION_SKILL=3]="ACTION_SKILL",e[e.ACTION_BUFF_SKIP=4]="ACTION_BUFF_SKIP",e[e.ACTION_BUFF_REDUCE_HP=5]="ACTION_BUFF_REDUCE_HP",e[e.ACTION_REVERSE_DAMAGE=6]="ACTION_REVERSE_DAMAGE",e[e.ACTION_AVOID_BUFF=7]="ACTION_AVOID_BUFF",e[e.ACTION_RAGE_DAMAGE=8]="ACTION_RAGE_DAMAGE",e[e.ACTION_DISPEL=9]="ACTION_DISPEL"}(n=e.actionType||(e.actionType={}));var o;!function(e){e[e.PERSON_FIGHT=0]="PERSON_FIGHT",e[e.PERSON_ESCAPE=1]="PERSON_ESCAPE",e[e.PERSON_DEAD=2]="PERSON_DEAD"}(o=e.personState||(e.personState={}));var a;!function(e){e[e.TREASURE_OPEN=1]="TREASURE_OPEN",e[e.TREASURE_DISCARD=2]="TREASURE_DISCARD",e[e.TREASURE_LUCKY_OPEN=3]="TREASURE_LUCKY_OPEN"}(a=e.treasureState||(e.treasureState={}));var s;!function(e){e[e.EFFECT_DAMAGE=0]="EFFECT_DAMAGE",e[e.EFFECT_CRITS=1]="EFFECT_CRITS",e[e.EFFECT_MISS=2]="EFFECT_MISS",e[e.EFFECT_HEAL=3]="EFFECT_HEAL",e[e.EFFECT_RECOVERMP=4]="EFFECT_RECOVERMP",e[e.EFFECT_RECOVERHP=5]="EFFECT_RECOVERHP"}(s=e.effectType||(e.effectType={}));var r;!function(e){e[e.ATTACK_PHY=1]="ATTACK_PHY",e[e.ATTACK_MAG=2]="ATTACK_MAG"}(r=e.attackType||(e.attackType={}));var l;!function(e){e[e.RESULT_HIT=1]="RESULT_HIT",e[e.RESULT_CRIT=2]="RESULT_CRIT",e[e.RESULT_MISS=3]="RESULT_MISS",e[e.PARALYSIS=4]="PARALYSIS",e[e.PARALYSIS_CRIT=5]="PARALYSIS_CRIT"}(l=e.attackResult||(e.attackResult={}));var h;!function(e){e[e.AVOID_REASON_RAGE=1]="AVOID_REASON_RAGE",e[e.AVOID_REASON_EQUIP=2]="AVOID_REASON_EQUIP"}(h=e.buffAvoidReason||(e.buffAvoidReason={}))}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function e(e){this._playerId=e.getPlayerInfo().getPlayerId(),this._playerInfo=e.getPlayerInfo(),this._curPos=e.getCurPos(),this._tarPos=null,this._InfoChange=!1,this._posChange=!1,this._EquipInfoChange=!1,this._halo=!1,this._armorHalo=!1}return Object.defineProperty(e.prototype,"playerId",{get:function(){return this._playerId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerInfo",{get:function(){return this._playerInfo},set:function(e){this._playerInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curPos",{get:function(){return this._curPos},set:function(e){this._curPos=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tarPos",{get:function(){return this._tarPos},set:function(e){this._tarPos=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"InfoChange",{get:function(){return this._InfoChange},set:function(e){this._InfoChange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"haloChange",{get:function(){return this._halo},set:function(e){this._halo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armorHaloChange",{get:function(){return this._armorHalo},set:function(e){this._armorHalo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"posChange",{get:function(){return this._posChange},set:function(e){this._posChange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EquipInfoChange",{get:function(){return this._EquipInfoChange},set:function(e){this._EquipInfoChange=e},enumerable:!0,configurable:!0}),e.prototype.sysFromeMapInfo=function(e){var t=e;this._EquipInfoChange=this.judgeRebuildSprite(t),this.InfoChange=!0,this._playerInfo=t.getPlayerInfo()},e.prototype.judgeRebuildSprite=function(e){return Number(e.getPlayerInfo().getFashionWeaponId())!=Number(this._playerInfo.getFashionWeaponId())?!0:Number(e.getPlayerInfo().getFashionWingId())!=Number(this._playerInfo.getFashionWingId())?!0:Number(e.getPlayerInfo().getFashionClothesId())!=Number(this._playerInfo.getFashionClothesId())?!0:Number(e.getPlayerInfo().getEquipItemId())!=Number(this._playerInfo.getEquipItemId())?!0:Number(e.getPlayerInfo().getWeaponItemId())!=Number(this._playerInfo.getWeaponItemId())?!0:e.getPlayerInfo().getWingItemId()!=this._playerInfo.getWingItemId()?!0:e.getPlayerInfo().getPetCurrentId()!=this._playerInfo.getPetCurrentId()?!0:Number(e.getPlayerInfo().getCurrentShowFashion())!=Number(this._playerInfo.getCurrentShowFashion())?!0:!1},e.prototype.clear=function(){this._playerId=null,this._playerInfo=null,this._curPos=null,this._tarPos=null,this._InfoChange=null,this._posChange=null},e}();e.PlayerData=t,__reflect(t.prototype,"foxgame.PlayerData");var i=function(){function i(){this._otherPlayerDatas=new e.HashMap,this._otherPlayerRenderQueue=new Array}return Object.defineProperty(i,"instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.registerListener=function(){e.Message.instance.add(e.Code.MAP_PLAYER_ENTER,this),e.Message.instance.add(e.Code.MAP_PLAYER_LEAVE,this),e.Message.instance.add(e.Code.MAP_PLAYER_INFO_SYNC,this),e.Message.instance.add(e.Code.MAP_PLAYER_POS_SYNC,this),e.Message.instance.add(e.Code.MAP_PLAYER_MOVE,this),e.Message.instance.add(e.Code.MAP_PLAYER_CAST_SKILL,this),e.Message.instance.add(e.Code.MAP_PLAYER_CAST_BUFF,this)},i.prototype.clear=function(){this._otherPlayerDatas.clear(),this._otherPlayerDatas=null,this._mainPlayerData=null},i.prototype.recvMsg=function(t,i){try{switch(t){case e.Code.MAP_PLAYER_ENTER:this.receivePlayerEnter(i);break;case e.Code.MAP_PLAYER_LEAVE:this.receivePlayerLeave(i);break;case e.Code.MAP_PLAYER_INFO_SYNC:this.receivePlayerInfoSync(i);break;case e.Code.MAP_PLAYER_POS_SYNC:this.receivePlayerPosSync(i);break;case e.Code.MAP_PLAYER_MOVE:this.receivePlayerMove(i);break;case e.Code.MAP_PLAYER_CAST_SKILL:e.MainSceneManager.instance.onReceivePlayerCastSkill(i);break;case e.Code.MAP_PLAYER_CAST_BUFF:e.MainSceneManager.instance.onReceivePlayerCastBuff(i)}}catch(n){Log.trace("exception: "+n.toString()),console.error(n)}},i.prototype.receivePlayerMove=function(e){var t=e;if(null!=t){var i=t.getPlayerId();if(null==this._otherPlayerDatas.get(i))return;this._otherPlayerDatas.get(i).curPos=t.getCurPos(),this._otherPlayerDatas.get(i).tarPos=t.getTarPos(),this.insertIntoRenderQueue(i)}},i.prototype.receivePlayerPosSync=function(e){var t=e;if(null!=t){var i=t.getPlayerId();if(null==this._otherPlayerDatas.get(i))return;this._otherPlayerDatas.get(i).curPos=t.getCurPos(),this.insertIntoRenderQueue(i)}},i.prototype.receivePlayerInfoSync=function(t){var i=t;if(null!=i){var n=i.getPlayerInfo().getPlayerId();if(null==n)throw"playerId is null";n==e.PlayerService.instance.playerInfo.getPlayerId()?null!=this._mainPlayerData&&this._mainPlayerData.sysFromeMapInfo(i):null!=this._otherPlayerDatas.get(n)&&(this._otherPlayerDatas.get(n).sysFromeMapInfo(i),this.insertIntoRenderQueue(n))}},i.prototype.receivePlayerEnter=function(i){var n=i;if(null!=n){if(null==n.getPlayerInfo().getPlayerId())throw"playerId is null";var o=n.getPlayerInfo().getPlayerId();if(o==e.PlayerService.instance.playerInfo.getPlayerId()){if(this._mainPlayerData)return console.error("_mainPlayerData renew"),void this._mainPlayerData.sysFromeMapInfo(n);this._mainPlayerData=new t(n)}else{this._otherPlayerDatas.keys.length;if(null!=this._otherPlayerDatas.get(o))return this._otherPlayerDatas.get(o).sysFromeMapInfo(n),this.insertIntoRenderQueue(o),void Log.trace("receivePlayerEnter exist playerId:"+o);var a=new t(n);this._otherPlayerDatas.put(o,a),this.insertIntoRenderQueue(o)}}},i.prototype.receivePlayerLeave=function(t){var i=t;if(null!=i){if(null==i.getPlayerId())throw"playerId is null";var n=i.getPlayerId();if(null==this._otherPlayerDatas.get(n))return;this.removeFromRenderQueue(n),e.Global.logLevel>e.Global.logLevelInfo&&Log.trace("onReceivePlayerLeave -- leave a player, id is %d",n)}},i.prototype.removeFromRenderQueue=function(t){for(var i=0;i<this._otherPlayerRenderQueue.length;i++)if(this._otherPlayerRenderQueue[i]==t){this._otherPlayerRenderQueue.splice(i,1);break}if(null!=this._otherPlayerDatas.get(t)){this._otherPlayerDatas.get(t).clear();var n=this._otherPlayerDatas.remove(t);n=null}e.MainSceneManager.instance.removeFromPlayerId(t)},i.prototype.insertIntoRenderQueue=function(t){this._otherPlayerRenderQueue.length>30||e.CommonUtils.array_hasValue(this._otherPlayerRenderQueue,t)||this._otherPlayerRenderQueue.push(t)},Object.defineProperty(i.prototype,"mainPlayerData",{get:function(){return this._mainPlayerData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"otherPlayerDatas",{get:function(){return this._otherPlayerDatas},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"otherPlayerRenderQueue",{get:function(){return this._otherPlayerRenderQueue},enumerable:!0,configurable:!0}),i.prototype.forceShowChangeMainPlayer=function(){this.mainPlayerData.InfoChange=!0,this.mainPlayerData.EquipInfoChange=!0},i.prototype.forceShowChangeOtherPlayer=function(){for(var t=0;t<this.otherPlayerRenderQueue.length;t++){var i=this.otherPlayerRenderQueue[t];if(null==this.otherPlayerDatas.get(i))e.Global.logLevel>e.Global.logLevelInfo&&Log.trace(i+"hava no data");else{var n=this.otherPlayerDatas.get(i);n.InfoChange=!0,n.EquipInfoChange=!0}}},i.prototype.forceHideMainPlayerRoleMainScene=function(){e.MainSceneManager.instance.mainRole&&e.MainSceneManager.instance.mainRole.mActionController&&(e.MainSceneManager.instance.mainRole.mActionController.release(),e.MainSceneManager.instance.mainRole.mActionController=null)},i.prototype.forceHideOtherPlayerMainScene=function(){for(var t=0;t<this.otherPlayerRenderQueue.length;t++){var i=this.otherPlayerRenderQueue[t];if(null==this.otherPlayerDatas.get(i))e.Global.logLevel>e.Global.logLevelInfo&&Log.trace(i+"hava no data");else{var n=e.MainSceneManager.instance.mainOtherRole.get(i);n&&n.mActionController&&(n.mActionController.release(),n.mActionController=null)}}},i}();e.MapSceneService=i,__reflect(i.prototype,"foxgame.MapSceneService",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.isPlayingReplaceModel=!1,n.$mcObject=null,n.totalPlayCount=-1,n.loadDirectionNumber=0,n.loadDirectionMaxNumber=e.Global.actionCacheResMaxDirectionNumber,n.resGroupLoadPriority=e.Global.LoadModelActionAniResPriority,n.controller=null,n.$mcObject=i,n}return __extends(i,t),i.prototype.setResGroupLoadPriority=function(e){this.resGroupLoadPriority=e},i.prototype.getName=function(){return this.name},i.prototype.play=function(t,i,n,o,a,s,r,l){if(void 0===n&&(n=null),void 0===o&&(o=e.EnumManager.ACTION_TYPE.ACTION_IDLE),void 0===a&&(a=e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),void 0===s&&(s=-1),void 0===r&&(r=null),void 0===l&&(l=null),this.curActionType!=o||this.curDirection!=a){this.modelName=i,this.name=t,this.replaceModelName=n,this.curActionType=o,this.curDirection=a,this.totalPlayCount=s,this.callBack=r,this.callBackData=l;var h=e.ActionManager.instance;h.isResLoaded(this.modelName,a)?(this.isPlayingReplaceModel=!1,h.play(this),this.onLoaded(1)):(this.isPlayingReplaceModel=!0,h.playAsync(this))}},i.prototype.playhas=function(t,i,n,o,a){if(void 0===t&&(t=e.EnumManager.ACTION_TYPE.ACTION_IDLE),void 0===i&&(i=e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT),void 0===n&&(n=-1),void 0===o&&(o=null),void 0===a&&(a=null),this.curActionType!=t||this.curDirection!=i){this.curActionType=t,this.curDirection=i,this.totalPlayCount=n,this.callBack=o,this.callBackData=a;var s=e.ActionManager.instance;s.isResLoaded(this.modelName,i)?(this.isPlayingReplaceModel=!1,s.play(this),this.onLoaded(2)):(this.isPlayingReplaceModel=!0,s.playAsync(this))}},i.prototype.startPlay=function(t,i){void 0===i&&(i=1);var n=e.JsonDataManager.instance.modelTemplate;if(e.BattleService.instance.modelId==i)this.$mcObject.x=e.BattleService.instance.dx,this.$mcObject.y=e.BattleService.instance.dy;else{var o=n[i];this.$mcObject.x=o.dx,this.$mcObject.y=o.dy}this.$mcObject.addEventListener(egret.Event.COMPLETE,this.complete,this);var a=t+"_"+this.curDirection+"_"+this.curActionType;if(null!=this.$mcObject&&null!=this.$mcObject.movieClipData)if(this.checkFrme(this.$mcObject.$movieClipData.labels,a))this.$mcObject.gotoAndPlay(a,this.totalPlayCount);else if(console.error("warn has not frame"+a),this.curActionType==e.EnumManager.ACTION_TYPE.ACTION_CASTER)return egret.warn("ACTION_CASTER change to ACTION_ATTACK and play"),this.curActionType=e.EnumManager.ACTION_TYPE.ACTION_ATTACK,void e.ActionManager.instance.play(this)},i.prototype.complete=function(e){null!=this.callBack&&(this.callBack(this.callBackData),this.callBack=null,this.callBackData=null),this.$mcObject&&this.$mcObject.removeEventListener(egret.Event.COMPLETE,this.complete,this)},i.prototype.reset=function(){this.clear(!1)},i.prototype.clear=function(e){void 0===e&&(e=!0),this.$mcObject&&(this.$mcObject.stop(),this.$mcObject.$reset(),null!=this.callBack&&e&&egret.warn("ActionCache clear removeEventListener when callBack != null, modelName:"+this.modelName),this.$mcObject.removeEventListener(egret.Event.COMPLETE,this.complete,this))},i.prototype.dispose=function(){this.clear(),this.$mcObject=null,this.curActionType=null,this.curDirection=null,this.replaceModelName=null,this.callBack=null,this.callBackData=null,this.totalPlayCount=null,e.ActionManager.instance.removeAC(this),this.modelName=null},i.prototype.checkFrme=function(e,t){if(null==e)return!1;for(var i=0;i<e.length;i++){var n=e[i];if(n.name==t)return!0}return!1},i.prototype.onLoaded=function(e){(-1!=this.modelName.indexOf("char")||-1!=this.modelName.indexOf("monster"))&&this.controller&&this.controller.onCharLoaded&&this.controller.onCharLoaded(e)},i}(egret.HashObject);e.ActionCache=t,__reflect(t.prototype,"foxgame.ActionCache",["foxgame.IDispose"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this.maxId=30,this.minimumLevel=4,this.JIESHU=e.LanguageUtils.instance.getValue("WINGJIESUANXING"),this.STARNUM=e.LanguageUtils.instance.getValue("WINGJIESUANJIE")}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new e.WingService),this._instance},enumerable:!0,configurable:!0}),t.prototype.registerListener=function(){e.Message.instance.add(e.Code.WING_SYNC_S,this)},t.prototype.clear=function(){e.Message.instance.remove(e.Code.WING_SYNC_S,this),e.Message.instance.remove(e.Code.WING_RANK_S,this)},t.prototype.recvMsg=function(t,i){t==e.Code.WING_SYNC_S&&(this._wingInfo=i.wings)},t.prototype.isActive=function(e){if(null==this._wingInfo||this._wingInfo.length<1)return!1;for(var t=0;t<this._wingInfo.length;t++)if(e==this._wingInfo[t].getRoleId()&&0==this._wingInfo[t].getId())return!1;return!0},t.prototype.getWingInfo=function(e){if(null==this._wingInfo||this._wingInfo.length<1)return null;for(var t=0;t<this._wingInfo.length;t++)if(e==this._wingInfo[t].getRoleId())return this._wingInfo[t];return null},t.prototype.getWingModelId=function(e){if(null==this._wingInfo||this._wingInfo.length<1)return 0;for(var t=0;t<this._wingInfo.length;t++)if(e==this._wingInfo[t].getRoleId()){var i=void 0;return i=this.isActive(e)?this.getWingUpCfg()[this._wingInfo[t].getId()+"_"+this._wingInfo[t].getLevel()]:this.getWingUpCfg()[this._wingInfo[t].getId()+1+"_"+this._wingInfo[t].getLevel()],i.model}return 0},t.prototype.getWingUpCfg=function(){return null==this.wingUpCfg&&(this.wingUpCfg=e.JsonDataManager.instance.wingTemplate),this.wingUpCfg},t.prototype.getWingUpStarCfg=function(){return null==this.wingUpStarCfg&&(this.wingUpStarCfg=e.JsonDataManager.instance.wingUpStarTemplate),this.wingUpStarCfg},t.prototype.getSystemRelationCfg=function(){return null==this.systemRelationCfg&&(this.systemRelationCfg=e.JsonDataManager.instance.attDefTemplate),this.systemRelationCfg},t.prototype.getMaxLevelById=function(e){return 10},t.prototype.getUpStarLevel=function(e){return this.getWingUpStarCfg()[e].limit},t.prototype.upWingInfo=function(e,t){if(!(null==this._wingInfo||this._wingInfo.length<1))for(var i=0;i<this._wingInfo.length;i++)e==this._wingInfo[i].getRoleId()&&(t.hasOwnProperty("id")&&this._wingInfo[i].setId(t.id),t.hasOwnProperty("level")&&this._wingInfo[i].setLevel(t.level),t.hasOwnProperty("exp")&&this._wingInfo[i].setExp(t.exp),t.hasOwnProperty("leftStar")&&this._wingInfo[i].setLeftStar(t.leftStar),t.hasOwnProperty("rightStar")&&this._wingInfo[i].setRightStar(t.rightStar))},t}();e.WingService=t,__reflect(t.prototype,"foxgame.WingService",["foxgame.IMessage"])}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){this._isSelfRole=!0,this.partIdList=[e.EquipPartType.WEAPON,e.EquipPartType.CLOTHES,e.EquipPartType.BRACELET1,e.EquipPartType.FINGERRING1,e.EquipPartType.BELT,e.EquipPartType.HELMET,e.EquipPartType.NECKLACE,e.EquipPartType.BRACELET2,e.EquipPartType.FINGERRING2,e.EquipPartType.SHOES,e.EquipPartType.SUIT_1,e.EquipPartType.SUIT_2,e.EquipPartType.SUIT_3,e.EquipPartType.SUIT_4,e.EquipPartType.GOD_1,e.EquipPartType.GOD_2,e.EquipPartType.GOD_3]}return t.prototype.setRoleInfo=function(t){this._roleInfo=t,this._isSelfRole=e.PlayerService.instance.isPlayerSelfsRoleInfo(t.getRoleId());var i=e.JsonDataManager.instance.roleTemplate;this._roleVO=i[this.itemId]},Object.defineProperty(t.prototype,"roleVO",{get:function(){return this._roleVO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roleInfo",{get:function(){return this._roleInfo},enumerable:!0,configurable:!0}),t.prototype.setRoleEquipCellInfo=function(e){if(this._equipCellInfo)for(var t=0;t<this._equipCellInfo.getCellInfos().length;t++)for(var i=0;i<e.getCellInfos().length;i++)this._equipCellInfo.getCellInfos()[t].getCellId()==e.getCellInfos()[i].getCellId()&&(this._equipCellInfo.getCellInfos()[t]=e.getCellInfos()[i]);else this._equipCellInfo=e},t.prototype.getRoleEquipCellInfo=function(){return this._equipCellInfo},t.prototype.getRoleEquips=function(){return this.roleInfo.getEquips()},t.prototype.getRoleEquipsForCS=function(){for(var t=[],i=e.JsonDataManager.instance.equipTemplate,n=0;n<this.getRoleEquips().length;n++){var o=i[this.getRoleEquips()[n].getEquipItemId()];o.quality==e.EquipQuality.RED&&t.push(this.getRoleEquips()[n])}return t},t.prototype.getEquipInfoByPart=function(t){for(var i,n,o=this.roleInfo.getEquips(),a=o.length,s=0;a>s;s++)if(i=o[s],i.getPart()==t){var r=i.getEquipId();n=e.BagController.getInstance().getEquipInfoById(r);break}return n},t.prototype.getRoleEquipByPart=function(e){for(var t,i=this.roleInfo.getEquips(),n=i.length,o=0;n>o;o++)if(t=i[o],t.getPart()==e)return t;return null},t.prototype.getRoleAllEquips=function(){for(var t,i,n=[],o=this.roleInfo.getEquips(),a=o.length,s=0;a>s;s++)t=o[s],i=e.BagController.getInstance().getEquipInfoById(t.getEquipId()),n.push(i);return n},t.prototype.getRoleWholeEnhanceLevel=function(){try{for(var t=e.Global.EquipMaxEnhanceLevel+1,i=this._equipCellInfo.getCellInfos(),n=0;n<i.length;n++){if(!(i[n].getCellStrenthLevel()>=10)){t=0;break}i[n].getCellStrenthLevel()<t&&(t=Math.floor(i[n].getCellStrenthLevel()/10))}return t}catch(o){Log.trace("express"+o.toString())}return 0},Object.defineProperty(t.prototype,"godlyEquipPartInfoList",{get:function(){return this.roleInfo.getGodEquipPartInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attrList",{get:function(){return this.roleInfo.getAttribute().getAttribute()},enumerable:!0,configurable:!0}),t.prototype.getAttributeValueByType=function(e){for(var t,i=this.attrList,n=i.length,o=-1,a=0;n>a;a++)if(t=i[a],t.getAttrId()==e){o=t.getAttrValue();break}return o},Object.defineProperty(t.prototype,"roleId",{get:function(){return Number(this.roleInfo.getRoleId())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.roleInfo.getLevel()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sex",{get:function(){return this.roleVO.sex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.roleInfo.getName()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blueInfo",{get:function(){return this.roleInfo.getQqBlueInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"profession",{get:function(){return this.roleInfo.getProf()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fight",{get:function(){return this.roleInfo.getFight()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.roleInfo.getType()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemId",{get:function(){return this.roleInfo.getItemId()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wingId",{get:function(){return this.roleInfo.getWingItemId()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSelfRole",{get:function(){return this._isSelfRole},enumerable:!0,configurable:!0}),t.prototype.getAvatarCharImg=function(e,t,i){var n=t.get(e.toString());if(null!=n&&null!=n.path)return i=n.hand,n.path;var o="pose_char11000";return 0>=e?4==this.itemId?o="pose_char12000":2==this.itemId?o="pose_char21000":5==this.itemId?o="pose_char22000":3==this.itemId?o="pose_char31000":6==this.itemId&&(o="pose_char32000"):o="pose_char"+e,o},t.prototype.getDefaultProfAvatarHand1Img=function(){var e="pose_hand1";return 4==this.itemId?e="pose_hand3":2==this.itemId?e="pose_hand1":5==this.itemId?e="pose_hand3":3==this.itemId?e="pose_hand1":6==this.itemId&&(e="pose_hand3"),e},t.prototype.getAvatarWeaponImg=function(e,t){var i=t.get(e.toString());if(null!=i&&null!=i.path)return i.path;var n="pose_weapon"+e;return 0>=e&&(n=""),n
},t.prototype.putOnEquip=function(e,t){for(var i,n,o=this.roleInfo.getEquips(),a=o.length,s=0;a>s;s++)if(i=o[s],i.getPart()==e){i.setEquipId(t),n=!0;break}n||(i=new Buffer.RoleEquip,i.setPart(e),i.setEquipId(t),o.push(i))},t.prototype.takeOffEquip=function(e){for(var t,i=this.roleInfo.getEquips(),n=i.length,o=0;n>o;o++)if(t=i[o],t.getPart()==e){i.splice(o,1);break}},t.prototype.getSpecialRingLvList=function(){return[this.roleInfo.getParalysisLevel(),this.roleInfo.getProtectLevel(),this.roleInfo.getReliveLevel(),this.roleInfo.getHitLevel()]},t.prototype.getFreeEquipByHighScore=function(){for(var t,i,n,o,a=(e.PlayerService.instance.level,[]),s=0;10>s;s++)n=this.partIdList[s],t=this.getEquipInfoByPart(n),i=t?t.getOriginalSocre():0,o=e.BagController.getInstance().getEquipInfosByProfAndPart(this.profession,this.partIdList[s]),o.sort(function(e,t){return e.getOriginalSocre()<t.getOriginalSocre()?1:-1}),o.length<1?a.push(null):i>=o[0].getOriginalSocre()?a.push(null):a.push(o[0]);return a},Object.defineProperty(t.prototype,"headUrl",{get:function(){var t=e.JsonDataManager.instance.roleTemplate,i=t[this.itemId];return i.icon},enumerable:!0,configurable:!0}),t}();e.RoleData=t,__reflect(t.prototype,"foxgame.RoleData")}(foxgame||(foxgame={}));var LayerType;!function(e){e[e.MAINUILAYER=0]="MAINUILAYER",e[e.UILAYER=1]="UILAYER",e[e.TOPLAYER=2]="TOPLAYER"}(LayerType||(LayerType={}));var StageFrameControl=function(){function e(){this.panelList=[]}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.stage=e,foxgame.Global.stageWidth=e.stageWidth,foxgame.Global.stageHeight=e.stageHeight,this.mapGroup=new eui.Group,this.mapGroup.name="mapGroup",this.sceneGroup=new eui.Group,this.sceneGroup.name="sceneGroup",this.sceneGroup.touchThrough=!0,this.mapViewportGroup=new eui.Group,this.mapViewportGroup.name="mapViewportGroup",this.mapViewportGroup.addChild(this.mapGroup),this.mapViewportGroup.addChild(this.sceneGroup),this.mapScroll=new eui.Scroller,this.mapScroll.name="mapScroll",ScreenAdaptation.instance.adaptMap(this.mapScroll),this.mapScroll.viewport=this.mapViewportGroup,e.addChild(this.mapScroll),foxgame.Global.rootScroller=this.mapScroll,this.mainUILayer=new egret.DisplayObjectContainer,e.addChild(this.mainUILayer),this.mainUILayer.y=foxgame.Global.heightChangeValue/2,this.mainUILayer.name="mainUILayerNotUse",this.mainUILayer.touchEnabled=!1,this.uiLayer=new egret.DisplayObjectContainer,this.uiLayer.name="uiLayer",e.addChild(this.uiLayer),this.uiLayer.width=Global.designWidth,this.uiLayer.height=Global.designHeight,foxgame.Global.uiLayer=this.uiLayer,foxgame.Global.uiLayer.y=foxgame.Global.heightChangeValue/2,this.topRootLayer=new egret.DisplayObjectContainer,this.topRootLayer.name="topRootLayer",e.addChild(this.topRootLayer),foxgame.Global.topLayer=this.topRootLayer,foxgame.Global.topLayer.y=foxgame.Global.heightChangeValue/2,this.newBeeGuideLayer=new egret.DisplayObjectContainer,this.newBeeGuideLayer.name="newBeeGuideLayer",this.newBeeGuideLayer.touchEnabled=!1,e.addChild(this.newBeeGuideLayer),foxgame.Global.newBeeGuideLayer=this.newBeeGuideLayer,foxgame.Global.newBeeGuideLayer.y=foxgame.Global.heightChangeValue/2,foxgame.MapViewportGroupManager.instance.init(this.sceneGroup,this.mapGroup,this.mapViewportGroup),e.addEventListener(egret.Event.RESIZE,this.resizeHandler,this)},e.prototype.setScrollEnabled=function(e){this.mapScroll.scrollPolicyH="OFF",this.mapScroll.scrollPolicyV="OFF"},e.prototype.getScrollViewport=function(){return this.mapViewportGroup},e.prototype.addPanel=function(e,t){-1==this.panelList.indexOf(e)&&this.panelList.push(e),t==LayerType.MAINUILAYER?this.mainUILayer.addChild(e):t==LayerType.UILAYER?this.uiLayer.addChild(e):t==LayerType.TOPLAYER&&this.topRootLayer.addChild(e),this.checkMainFunctionPanel(e)?e.setRemoveForward(!0):e.setRemoveForward(!1),e.maskShowBeforeOrAfter&&(e.isMask&&this.checkMask(1),e.getIsShowBackBtn()&&this.checkBackBtn(1,null,e.getRemoveForward()),e.setMaskHasDone(!0)),e.isMaskdown&&foxgame.MainControler.instance.setbtnmask(!0)},e.prototype.doCheckMaskAndBackBtn=function(e){if(!e.maskShowBeforeOrAfter){if(e.isMask&&this.checkMask(1),e.getIsShowBackBtn()){var t=e.getRemoveForward();this.backBtn&&this.backBtn.getBackPanel()==e&&(t=!1),this.checkBackBtn(1,null,t)}e.setMaskHasDone(!0)}},e.prototype.removePanel=function(e){null!=e.parent&&(e.parent.removeChild(e),e.isMask&&this.checkMask(2),e.isMaskdown&&foxgame.MainControler.instance.setbtnmask(!1),e.getIsShowBackBtn()&&this.checkBackBtn(2))},e.prototype.doRemoveMaskAndBackBtn=function(e){e.maskHasDone&&(e.isMask&&this.checkMask(2,e),e.getIsShowBackBtn()&&this.checkBackBtn(2,e),e.setMaskHasDone(!1))},e.prototype.checkMask=function(e,t){void 0===e&&(e=1),void 0===t&&(t=null),null!=this.maskUI&&null!=this.maskUI.parent&&this.maskUI.parent.removeChild(this.maskUI);for(var i,n,o,a=[this.topRootLayer,this.uiLayer],s=a.length,r=0;s>r;r++){i=a[r],n=i.numChildren;for(var l=!1,h=n-1;h>=0;h--)i.getChildAt(h)instanceof foxgame.BasePanel&&(o=i.getChildAt(h),(2!=e||t!=o)&&(o.isMask&&!l?(null==this.maskUI&&(this.maskUI=new egret.Sprite,this.maskUI.touchEnabled=!0),o.getIsTouchClose()?this.maskUI.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchMaskCloseHandler,this):this.maskUI.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchMaskCloseHandler,this),this.maskUI.graphics.clear(),this.maskUI.graphics.beginFill(0,.8),this.maskUI.graphics.drawRect(0,0,this.stage.stageWidth,foxgame.Global.stageHeight-o.maskGapBottom),this.maskUI.graphics.endFill(),i.addChildAt(this.maskUI,h),l=!0,2==e?o.visible=!0:o.visible=!0):o.isMask&&l&&(1==e?o.visible=!1:o.visible=!0)))}},e.prototype.touchMaskCloseHandler=function(e){for(var t,i,n,o=[this.topRootLayer,this.uiLayer],a=o.length,s=0;a>s;s++){t=o[s],i=t.numChildren;for(var r=i-1;r>=0;r--)if(t.getChildAt(r)instanceof foxgame.BasePanel&&(n=t.getChildAt(r),n.isMask&&n.getIsTouchClose()))return void n.close()}},e.prototype.checkMainFunctionPanel=function(e){var t=!1;return e.maskGapBottom>0&&(t=!0),t},e.prototype.checkBackBtn=function(e,t,i){void 0===e&&(e=1),void 0===t&&(t=null),void 0===i&&(i=!1),null!=this.backBtn&&null!=this.backBtn.parent&&(this.backBtn.parent.removeChild(this.backBtn),i&&this.backBtn.doWhenRemove());for(var n,o,a,s,r=[this.topRootLayer,this.uiLayer],l=r.length,h=0;l>h;h++){n=r[h],o=n.numChildren;for(var c=o-1;c>=0;c--)if(n.getChildAt(c)instanceof foxgame.BasePanel&&(a=n.getChildAt(c),(2!=e||t!=a)&&a.getIsShowBackBtn()))return null==this.backBtn&&(this.backBtn=new foxgame.BackButton),this.backBtn.setBackFun(a.backHandler.bind(a)),this.backBtn.setBackPanel(a),this.backBtn.setFireBackHandlerWhenRemove(this.checkMainFunctionPanel(a)),s=a.parent.getChildIndex(a),ScreenAdaptation.instance.adaptBackBtn(this.backBtn),void a.parent.addChildAt(this.backBtn,s+1)}},e.prototype.closeAllPanel=function(){this.uiLayer.removeChildren()},e.prototype.destroyResource=function(){for(var e;this.panelList.length>0;)e=this.panelList.pop(),e.destroy()},e.prototype.freePanel=function(e){this.removePanel(e);var t=this.panelList.indexOf(e);t>=0&&this.panelList.splice(t,1)},e.prototype.printInUsingPanelList=function(){this.panelList.forEach(function(e,t,i){var n="BasePanel skinUrl: "+e.getSkinUrl()+", groupName: "+e.getGroupName();egret.warn(n)},this)},e.prototype.resizeHandler=function(e){for(var t,i,n,o=[this.topRootLayer,this.uiLayer],a=o.length,s=0;a>s;s++){t=o[s],i=t.numChildren;for(var r=i-1;r>=0;r--)t.getChildAt(r)instanceof foxgame.BasePanel&&(n=t.getChildAt(r),n.resizeHandler(e))}ScreenAdaptation.instance.adaptMap(this.mapScroll),this.backBtn&&ScreenAdaptation.instance.adaptBackBtn(this.backBtn)},e.prototype.getBackBtn=function(){return this.backBtn},e}();__reflect(StageFrameControl.prototype,"StageFrameControl");var DebugTool=function(){function e(){}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.addDisplayObj=function(e,t){},e}();__reflect(DebugTool.prototype,"DebugTool");var LogTool=function(){function e(){}return e.log=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i]},e.warn=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];egret.warn(e,this.getParamStr(t))},e.error=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];egret.error(e,this.getParamStr(t))},e.getParamStr=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i="",n=e.length,o=0;n>o;o++)i+=e[o];return i},e}();__reflect(LogTool.prototype,"LogTool");var ScreenAdaptation=function(){function e(){this.screenType=0,this.designWidth=640,this.designHeight=1136,this.screenWidth=0,this.screenHeight=0,this.mapWidth=0,this.mapHeight=0,this.uiWidth=0,this.uiHeight=0}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(e){e.stageWidth<=0||e.stageHeight<=0||(egret.Capabilities.isMobile?e.stageHeight/e.stageWidth>=2||this.isHaveTitleBar()?(this.screenType=1,e.scaleMode=egret.StageScaleMode.FIXED_WIDTH):(this.screenType=0,e.scaleMode=egret.StageScaleMode.FIXED_HEIGHT):(this.screenType=2,foxgame.GamePlatform.isQQdating?e.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:e.scaleMode=egret.StageScaleMode.SHOW_ALL))},e.prototype.isHaveTitleBar=function(){return"suyi10850"==checkPlatformStr()?!0:"qqgame"==checkPlatformStr()?!0:!1},e.prototype.setScreenSize=function(e,t){switch(this.screenWidth=e,this.screenHeight=t,this.screenType){case 0:this.mapWidth=this.screenWidth,this.mapHeight=this.screenHeight,this.uiWidth=this.screenWidth,this.uiHeight=this.screenHeight;break;case 1:this.mapWidth=this.screenWidth,this.mapHeight=this.screenHeight,this.uiWidth=this.designWidth,this.uiHeight=this.designHeight;break;case 2:this.mapWidth=this.screenWidth,this.mapHeight=this.screenHeight,this.uiWidth=this.designWidth,this.uiHeight=this.designHeight}},e.prototype.adaptMap=function(e){e.width=this.mapWidth,e.height=this.mapHeight,e.x=this.screenWidth-this.mapWidth>>1,e.y=this.screenHeight-this.mapHeight>>1},e.prototype.adaptUI=function(e){e.width=this.uiWidth,e.height=this.uiHeight,e.x=this.screenWidth-this.uiWidth>>1,e.y=this.screenHeight-this.uiHeight>>1},e.prototype.adaptLogin=function(e){},e.prototype.adaptLoading=function(e){},e.prototype.adaptMain=function(e){if(foxgame.GamePlatform.isQQdating){if(1==this.screenType){var t=new eui.Image;Global.topLayer.addChild(t),t.width=this.screenWidth,t.height=60,t.source="iphoneXdi_jpg",t.x=t.y=0,e.height=this.screenHeight-60}else e.height=this.uiHeight;e.width=this.screenWidth,e.x=0,e.y=this.screenHeight-e.height}else{if(1==this.screenType){var t=new eui.Image;Global.topLayer.addChild(t),t.width=this.screenWidth,t.height=60,t.source="iphoneXdi_jpg",t.x=t.y=0,e.height=this.screenHeight-60}else e.height=this.uiHeight;e.width=this.uiWidth,e.x=this.screenWidth-this.uiWidth>>1,e.y=this.screenHeight-e.height}},e.prototype.adaptActivityBar=function(t){1==this.screenType?t.posY+=60:t.posY+=this.screenHeight-this.uiHeight,t.x=e.instance.screenWidth-t.width,t.y=t.posY},e.prototype.adaptBackBtn=function(e){e.x=(this.screenWidth+this.uiWidth)/2-109,e.y=this.screenHeight-110},e.prototype.adaptPanelBg=function(e){e.width=this.uiWidth,e.height=this.uiHeight,e.x=this.screenWidth-this.uiWidth>>1,e.y=e.parent.height-e.height},e.prototype.adaptPanelMask=function(e){e.width=this.screenWidth,e.height=this.screenHeight,e.x=this.screenWidth-this.uiWidth>>1,e.y=e.parent.height-e.height},e.prototype.adaptMask=function(e){e.width=2*this.screenWidth,e.height=2*this.screenHeight,e.x-=this.screenWidth,e.y-=this.screenHeight},e}();__reflect(ScreenAdaptation.prototype,"ScreenAdaptation");var AnchorUtil=function(){function e(){}return e.init=function(){this._isInited||(this._propertyChange=Object.create(null),this._anchorChange=Object.create(null),this.injectAnchor(),this._isInited=!0)},e.setAnchorX=function(e,t){e.anchorX=t},e.setAnchorY=function(e,t){e.anchorY=t},e.setAnchor=function(e,t){e.anchorX=e.anchorY=t},e.getAnchorX=function(e){return e.anchorX||0},e.getAnchorY=function(e){return e.anchorY||0},e.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(t){var i=this;this.$setWidth(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(t){var i=this;this.$setHeight(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(t){var i=this;this._anchorX=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(t){var i=this;this._anchorY=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchor",{get:function(){return this._anchorX},set:function(t){var i=this;this._anchorX=t,this._anchorY=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},e.changeAnchor=function(t){e._propertyChange[t.hashCode]&&e._anchorChange[t.hashCode]&&(t.anchorOffsetX=t._anchorX*t.width,t.anchorOffsetY=t._anchorY*t.height,delete e._propertyChange[t.hashCode])},e}();__reflect(AnchorUtil.prototype,"AnchorUtil");var foxgame;!function(e){var t=function(){function e(){}return e.SpeedUtil=function(e,t){},e.begin=function(e,t){if(e){var i;this.speedArray[e]?(i=this.speedArray[e],i.key=e,i.uid=t,i.begin=egret.getTimer(),i.t1=i.t2=i.t3=i.t4=i.t5=null,this.speedArray[e]=i):(i={key:e,uid:t,begin:egret.getTimer()},this.speedArray[e]=i)}},e.time1=function(e){return this.speedArray[e]?(this.speedArray[e].t1=egret.getTimer()-this.speedArray[e].begin,!0):!1},e.time2=function(e){return this.speedArray[e]?(this.speedArray[e].t2=egret.getTimer()-this.speedArray[e].begin,!0):!1},e.time3=function(e){return this.speedArray[e]?(this.speedArray[e].t3=egret.getTimer()-this.speedArray[e].begin,!0):!1},e.time4=function(e){return this.speedArray[e]?(this.speedArray[e].t4=egret.getTimer()-this.speedArray[e].begin,!0):!1},e.time5=function(e){return this.speedArray[e]?(this.speedArray[e].t5=egret.getTimer()-this.speedArray[e].begin,!0):!1},e.end=function(e){return this.speedArray[e]?(i.speed(this.speedArray[e]),delete this.speedArray[e],!0):!1},e.speedArray=[],e}();e.SpeedUtil=t,__reflect(t.prototype,"foxgame.SpeedUtil");var i=function(){function e(){}return e.getImgObj=function(){var e=this.imgIndex=this.imgIndex%this.maxImg;return this.imgObjArray[e]||egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(this.imgObjArray[e]=new Image),this.imgIndex++,this.imgObjArray[e]},e.speed=function(e,t){return},e.event=function(e,t){return},e.imgObjArray=[],e.imgIndex=0,e.maxImg=10,e.speedPicUrl="http://app1103518417.qzoneapp.com/collect/s.gif?",e.eventPicUrl="http://app1103518417.qzoneapp.com/collect/e.gif?",e.uid="",e}();e.CollectUtils=i,__reflect(i.prototype,"foxgame.CollectUtils");var n=function(){function e(){}return e.speed_1="speed_1",e.speed_2="speed_2",e.speed_3="speed_3",e}();e.SpeedCollectType=n,__reflect(n.prototype,"foxgame.SpeedCollectType");var o=function(){function e(){}return e.notify=function(e,t,i){window&&window.fundebug&&window.fundebug.notify(e,t,i)},e.notifyError=function(e,t){window&&window.fundebug&&window.fundebug.notifyError(e,t)},e}();e.FundebugUtils=o,__reflect(o.prototype,"foxgame.FundebugUtils");var a=function(){function t(){}return t.notifyEvent=function(t,i){window&&window.mta&&e.Global.globalConfig&&e.Global.globalConfig.useMta&&window.mta.Event.stat(t,i)},t.checkEventJiaZaiJinYouXi=!1,t}();e.MtaUtils=a,__reflect(a.prototype,"foxgame.MtaUtils");var s=function(){function t(){}return t.sendEvent=function(t,i){window&&window.wx&&window.wx.aldSendEvent&&e.Global.globalConfig&&e.Global.globalConfig.useAld&&window.wx.aldSendEvent(t,i)},t}();e.AldUtils=s,__reflect(s.prototype,"foxgame.AldUtils")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.config=[{code:e.Code.SYNC_START_C,proto:"HPSyncStartReq"},{code:e.Code.SYNC_START_S,proto:"HPSyncStartRsp"},{code:e.Code.HEART_BEAT,proto:"HPHeartBeat"},{code:e.Code.ERROR,proto:"HPErrorCode"},{code:e.Code.RECHARGE_REQUEST,proto:"HPRechargeRequest"},{code:e.Code.RECHARGE_RESPONSE,proto:"HPRechargeResponse"},{code:e.Code.CHECK_CDK_CAN_USE_C,proto:"UseCdk1758Req"},{code:e.Code.CHECK_CDK_CAN_USE_S,proto:"UseCdk1758Rsp"},{code:e.Code.SHARE_WECHAT_REWARD_C,proto:"HPSharingInvitationsReq"},{code:e.Code.SHARE_WECHAT_REWARD_S,proto:"HPSharingInvitationsRsp"},{code:e.Code.GAME_SHANRING_C,proto:"HPGameSharingInfoReq"},{code:e.Code.GAME_SHANRING_S,proto:"HPGameSharingInfoRsp"},{code:e.Code.GAME_SHANRING_SHOW_C,proto:"HPGameInvitationsShowReq"},{code:e.Code.GAME_SHANRING_SHOW_S,proto:"HPGameInvitationsShowRsp"},{code:e.Code.GAME_INVITATIONS_C,proto:"HPGameInvitationsReq"},{code:e.Code.GAME_INVITATIONS_S,proto:"HPGameInvitationsRsp"},{code:e.Code.GAME_FOLLOW_GET_STATE_C,proto:"HPGameFollowStateReq"},{code:e.Code.GAME_FOLLOW_GET_STATE_S,proto:"HPGameFollowStateRsp"},{code:e.Code.CHANNEL_ATTENTION_AWARD_C,proto:"HPChannelAttentionAwardRsp"},{code:e.Code.GAME_FOLLOW_GET_AWARD_C,proto:"HPGameFollowRewardReq"},{code:e.Code.GAME_FOLLOW_GET_AWARD_S,proto:"HPGameFollowRewardRsp"},{code:e.Code.PLAYER_KICKOUT_S,proto:"HPPlayerKickout"},{code:e.Code.PUSH_CHAT_S,proto:"HPPushChat"},{code:e.Code.MARQUEE_PUSH,proto:"HPPushMarquee"},{code:e.Code.PLAYER_INFO_SYNC_S,proto:"HPPlayerInfoSync"},{code:e.Code.ROLE_INFO_SYNC_S,proto:"HPRoleInfoSync"},{code:e.Code.ITEM_INFO_SYNC_S,proto:"HPItemInfoSync"},{code:e.Code.EQUIP_INFO_SYNC_S,proto:"HPEquipInfoSync"},{code:e.Code.SKILL_INFO_SYNC_S,proto:"HPSkillInfoSync"},{code:e.Code.STATE_INFO_SYNC_S,proto:"HPPlayerStateSync"},{code:e.Code.ASSEMBLE_FINISH_S,proto:"HPAssembleFinish"},{code:e.Code.PLAYER_AWARD_S,proto:"HPPlayerReward"},{code:e.Code.PLAYER_CONSUME_S,proto:"HPConsumeInfo"},{code:e.Code.BATTLE_INFO_SYNC_S,proto:"HPBattleInfoSync"},{code:e.Code.BATTLE_OFFLINE_ACCOUNT_S,proto:"HPOfflineAccount"},{code:e.Code.MAP_STATISTICS_SYNC_S,proto:"HPMapStatisticsSync"},{code:e.Code.SYSTEM_PROMPT,proto:""},{code:e.Code.NOTICE_PUSH,proto:"HPNotice"},{code:e.Code.ATTRIBUTE_CHANGE_NOTICE,proto:"AttrInfo"},{code:e.Code.DATA_NOTIFY_S,proto:"HPDataNotify"},{code:e.Code.SKILL_BAG_S,proto:"HPSkillInfo"},{code:e.Code.TITLE_SYNC_S,proto:"HPTitleInfoSyncS"},{code:e.Code.CHANGE_TITLE_C_VALUE,proto:"ChooseTitleId"},{code:e.Code.TITLE_ACTIVE_C_VALUE,proto:"ActiveTitleReq"},{code:e.Code.TITLE_ACTIVE_S,proto:"ActiveTitleRsp"},{code:e.Code.TITLE_QUALITY_UP_C_VALUE,proto:"TitleQualityUpReq"},{code:e.Code.TITLE_QUALITY_UP_S,proto:"TitleQualityUpRsp"},{code:e.Code.EQUIP_SYNC_FINISH_S,proto:"HPEquipSyncFinish"},{code:e.Code.ROLE_RING_INFO_S,proto:"HPRoleRingInfoSync"},{code:e.Code.CLIENT_SETTING_PUSH,proto:"HPClientSetting"},{code:e.Code.PLAYER_AREA_SYNC,proto:"HPPlayerAreaSync"},{code:e.Code.ELEMENT_INFO_SYNC_S,proto:"HPElementInfoSync"},{code:e.Code.GAMEING_STATE_S,proto:"HPAssembleFinish"},{code:e.Code.SYS_EVENT_PUSH,proto:"HPPushEvent"},{code:e.Code.WING_SYNC_S,proto:"HPWingInfosSync"},{code:e.Code.PET_SYNC_S,proto:"PetInfo"},{code:e.Code.BACKDOOR_LIST,proto:"BackdoorListRsp"},{code:e.Code.BACKDOOR_OPEN_S,proto:"BackdoorRsp"},{code:e.Code.TIME_PLAY_METHOD_PUSH,proto:"TimePlayMethodSync"},{code:e.Code.LEGENDS_UPREMACY_INFO_C,proto:"HPLegendSupremacyInfoReq"},{code:e.Code.LEGENDS_UPREMACY_INFO_S,proto:"HPLegendSupremacyInfoRsp"},{code:e.Code.LEGENDS_UPREMACY_CHALLENGE_C,proto:"HPChallengeSupremacyReq"},{code:e.Code.LEGENDS_UPREMACY_CHALLENGE_S,proto:"HPChallengeSupremacyRsp"},{code:e.Code.LEGENDS_UPREMACY_BUFF_BUY_C,proto:"HPSupremacyBuyBuffReq"},{code:e.Code.LEGENDS_UPREMACY_BUFF_BUY_S,proto:"HPSupremacyBuyBuffRsp"},{code:e.Code.LEGENDS_UPREMACY_PACKAGE_C,proto:"HPSupremacyAwardReq"},{code:e.Code.LEGENDS_UPREMACY_PACKAGE_S,proto:"HPSupremacyAwardRsp"},{code:e.Code.LEGENDS_UPREMACY_AWARD_C,proto:"HPSupremacyShoppingAwardReq"},{code:e.Code.LEGENDS_UPREMACY_AWARD_S,proto:"HPSupremacyShoppingAwardRsp"},{code:e.Code.LEGENDS_UPREMACY_RESET_C,proto:"HPSupremacyResetReq"},{code:e.Code.LEGENDS_UPREMACY_RESET_S,proto:"HPSupremacyResetRsp"},{code:e.Code.LEGENDS_UPREMACY_RESET_BUY_C,proto:"HPSupremacyBuyResetReq"},{code:e.Code.LEGENDS_UPREMACY_RESET_BUY_S,proto:"HPSupremacyBuyResetRsp"},{code:e.Code.LEGENDS_UPREMACY_RESURRECTION_BUY_C,proto:"HPResurrectionBuyReq"},{code:e.Code.LEGENDS_UPREMACY_RESURRECTION_BUY_S,proto:"HPResurrectionBuyRsp"},{code:e.Code.LEGENDS_UPREMACY_BUFF_INFO_S,proto:"HPsupremacyBuufInfoRsp"},{code:e.Code.ESCORT_PRISONER_INFO_C,proto:"HPEscortPrisonerInfoReq"},{code:e.Code.ESCORT_PRISONER_INFO_S,proto:"HPEscortPrisonerInfoRsp"},{code:e.Code.START_ESCORT_PRISONER_C,proto:"HPStartEscortPrisonerReq"},{code:e.Code.START_ESCORT_PRISONER_S,proto:"HPStartEscortPrisonerRsp"},{code:e.Code.ESCORT_PRISONER_ACCESS_AWAY_C,proto:"HPEscortPrisonerAccessAwayReq"},{code:e.Code.ESCORT_PRISONER_ACCESS_AWAY_S,proto:"HPEscortPrisonerAccessAwayRsp"},{code:e.Code.ESCORT_PRISONER_RECEIVE_AWARD_INFO_C,proto:"HPEscortPrisonerAwardInfoReq"},{code:e.Code.ESCORT_PRISONER_RECEIVE_AWARD_INFO_S,proto:"HPEscortPrisonerAwardInfoRsp"},{code:e.Code.ESCORT_PRISONER_RECEIVE_AWARD_C,proto:"HPEscortPrisonerAwardReq"},{code:e.Code.ESCORT_PRISONER_RECEIVE_AWARD_S,proto:"HPEscortPrisonerAwardRsp"},{code:e.Code.ESCORT_PRISONER_REFRESH_QUALITY_C,proto:"HPEscortPrisonerRefreshReq"},{code:e.Code.ESCORT_PRISONER_REFRESH_QUALITY_S,proto:"HPEscortPrisonerRefreshRsp"},{code:e.Code.ESCORT_PRISONER_ONE_REFRESH_C,proto:"HPEscortPrisonerOneRefreshReq"},{code:e.Code.ESCORT_PRISONER_ONE_REFRESH_S,proto:"HPEscortPrisonerOneRefreshRsp"},{code:e.Code.ESCORT_PRISONER_LOG_INFO_C,proto:"HPEscortPrisonerLogReq"},{code:e.Code.ESCORT_PRISONER_LOG_INFO_S,proto:"HPEscortPrisonerLogRsp"},{code:e.Code.ESCORT_PRISONER_VENGEANCE_C,proto:"HPEscortPrisonerVengeanceReq"},{code:e.Code.ESCORT_PRISONER_VENGEANCE_S,proto:"HPEscortPrisonerVengeanceRsp"},{code:e.Code.ESCORT_PRISONER_PLUNDER_C,proto:"HPEscortPrisonerPlunderReq"},{code:e.Code.ESCORT_PRISONER_PLUNDER_S,proto:"HPEscortPrisonerVengeanceRsp"},{code:e.Code.ESCORT_QUICKLY_PRISONER_C,proto:"HPQuicklyEscortPrisonerReq"},{code:e.Code.ESCORT_QUICKLY_PRISONER_S,proto:"HPQuicklyEscortPrisonerRsp"},{code:e.Code.ESCORT_ANOTHER_BATCH_C,proto:"HPEscortPrisonerListReq"},{code:e.Code.ESCORT_ANOTHER_BATCH_S,proto:"HPEscortPrisonerInfoRsp"},{code:e.Code.SEND_CHAT_C,proto:"HPSendChat"},{code:e.Code.SEND_CHAT_S,proto:"HPSendChatRsp"},{code:e.Code.RECORD_TUTORIAL_STEP,proto:"HPRecordTutorialStep"},{code:e.Code.MAP_BATTLE_REQUEST_C,proto:"HPMapBattleRequest"},{code:e.Code.EXIT_BATTLE_C,proto:"ExitBattleFightReq"},{code:e.Code.EXIT_BATTLE_S,proto:"ExitBattleFightRsp"},{code:e.Code.LOGIN_C,proto:"HPLogin"},{code:e.Code.LOGIN_S,proto:"HPLoginRet"},{code:e.Code.PLAYER_MOVE,proto:"HPPlayerMoveState"},{code:e.Code.MAP_PLAYER_ENTER,proto:"HPMapPlayerEnter"},{code:e.Code.MAP_PLAYER_INFO_SYNC,proto:"HPMapPlayerInfoSync"},{code:e.Code.MAP_PLAYER_POS_SYNC,proto:""},{code:e.Code.MAP_PLAYER_MOVE,proto:"HPMapPlayerMove"},{code:e.Code.MAP_PLAYER_LEAVE,proto:"HPMapPlayerLeave"},{code:e.Code.MAP_PLAYER_VISIT,proto:"HPMapPlayerVisit"},{code:e.Code.MAP_PLAYER_CAST_SKILL,proto:"HPMapPlayerCastSkill"},{code:e.Code.MAP_PLAYER_CAST_BUFF,proto:"HPMapPlayerCastBuff"},{code:e.Code.DOWNLOAD_REWARD_C,proto:""},{code:e.Code.DOWNLOAD_REWARD_S,proto:""},{code:e.Code.ITEM_USE_C,proto:"HPItemUse"},{code:e.Code.ITEM_USE_S_VALUE,proto:"HPItemUseRet"},{code:e.Code.ITEM_SELL_C,proto:"HPItemSell"},{code:e.Code.GEM_ONE_KEY_LEVELUP,proto:""},{code:e.Code.SKILL_CHANGE_ORDER_C,proto:"SkillUpgradeOneKeyReq"},{code:e.Code.SKILL_CHANGE_ORDER_S,proto:"SkillUpgradeOneKeyRsp"},{code:e.Code.SKILL_LEVELUP_C,proto:"SkillUpgradeReq"},{code:e.Code.SKILL_LEVELUP_S,proto:"SkillUpgradeRsp"},{code:e.Code.RED_POINT_SYNC_S,proto:"RedPointSync"},{code:e.Code.EQUIP_CELL_ONE_KEY_C,proto:"HPEquipsCellUP"},{code:e.Code.EQUIP_CELL_ONE_KEY_S_VALUE,proto:"HPEquipCellUpRsp"},{code:e.Code.EQUIP_DRESS_C,proto:"HPEquipDress"},{code:e.Code.EQUIP_DRESS_S,proto:"HPEquipDressRet"},{code:e.Code.EQUIP_BAPTIZE_C,proto:"HPEquipBaptize"},{code:e.Code.EQUIP_BAPTIZE_S,proto:"HPEquipBaptizeRet"},{code:e.Code.EQUIP_DECOMPOSE_C,proto:"HPEquipDecompose"},{code:e.Code.EQUIP_DECOMPOSE_S,proto:"HPEquipDecomposeRet"},{code:e.Code.EQUIP_EVOLUTION_C,proto:"HPEquipEvolution"},{code:e.Code.EQUIP_EVOLUTION_S,proto:"HPEquipEvolutionRet"},{code:e.Code.EQUIP_LOCK_S,proto:"HPEquipLockRsp"},{code:e.Code.EQUIP_DRESS_ONE_KEY_C,proto:"HPEquipDressOneKey"},{code:e.Code.EQUIP_DRESS_ONE_KEY_S,proto:"HPEquipDressOneKeyRet"},{code:e.Code.EQUIP_CELL_SYNC,proto:"HPEquipCellsInfo"},{code:e.Code.EQUIP_CELL_UPLEVEL_C,proto:"HPEquipCellUpLevel"},{Code:e.Code.EQUIP_CELL_UPLEVEL_S,proto:""},{code:e.Code.GEM_SYSTEM_UP_LEVEL,proto:"HPEquipCellStoneUpgradeReq"},{code:e.Code.EQUIP_GOD_INLAY_C,proto:"HPEquipGodInlayReq"},{code:e.Code.EQUIP_GOD_INLAY_S,proto:"HPEquipGodInlayRsp"},{code:e.Code.EQUIP_GOD_EVOLUTION_C,proto:"HPEquipGodEvolutionReq"},{code:e.Code.EQUIP_GOD_EVOLUTION_S,proto:"HPEquipGodEvolutionRsp"},{code:e.Code.EQUIP_GOD_COMPOUND_C,proto:"HPEquipGodCompoundReq"},{code:e.Code.EQUIP_GOD_COMPOUND_S,proto:"HPEquipGodCompoundRsp"},{code:e.Code.RED_EQUIP_QUENCHING_C,proto:"RedEquipQuenchingReq"},{code:e.Code.RED_EQUIP_QUENCHING_S,proto:"RedEquipQuenchingRsp"},{code:e.Code.ROLE_CREATE_C,proto:"HPRoleCreate"},{code:e.Code.ROLE_CREATE_S,proto:"HPRoleCreateRet"},{code:e.Code.ARENA_DEFENDER_LIST_C,proto:"HPArenaDefenderList"},{code:e.Code.ARENA_DEFENDER_LIST_SYNC_S,proto:"HPArenaDefenderListSyncS"},{code:e.Code.REPLACE_DEFENDER_LIST_C,proto:"HPReplaceDefenderList"},{code:e.Code.REPLACE_DEFENDER_LIST_S,proto:"HPReplaceDefenderListRet"},{code:e.Code.BUY_CHALLENGE_TIMES_C,proto:"HPBuyChallengeTimes"},{code:e.Code.BUY_CHALLENGE_TIMES_S,proto:"HPBuyChallengeTimesRet"},{code:e.Code.ARENA_RANKING_LIST_C,proto:"HPArenaRankingList"},{code:e.Code.ARENA_RANKING_LIST_S,proto:"HPArenaRankingListRet"},{code:e.Code.CHALLENGE_DEFENDER_C,proto:"HPChallengeDefender"},{code:e.Code.CHALLENGE_DEFENDER_S,proto:"HPChallengeDefenderRsp"},{code:e.Code.SEE_OTHER_PLAYER_INFO_C,proto:"HPSeeOtherPlayerInfo"},{code:e.Code.SEE_OTHER_PLAYER_INFO_S,proto:"HPSeeOtherPlayerInfoRet"},{code:e.Code.ARENA_RECORD_C,proto:"HPArenaRecordList"},{code:e.Code.ARENA_RECORD_S,proto:"HPArenaRecordListRet"},{code:e.Code.ARENA_SHOP_BUYITEM_C,proto:"HPBuyArenaShopItemById"},{code:e.Code.ARENA_SHOP_BUYITEM_S,proto:"HPBuyArenaShopItemByIdRet"},{code:e.Code.UNION_JOIN_LIST_C,proto:"HPUnionJoinListReq"},{code:e.Code.UNION_JOIN_LIST_S,proto:"HPUnionJoinListRsp"},{code:e.Code.UNION_ENTER_C,proto:"HPUnionEnterReq"},{code:e.Code.UNION_ENTER_S,proto:"HPUnionEnterRsp"},{code:e.Code.UNION_CREATE_C,proto:"HPUnionCreateReq"},{code:e.Code.UNION_CREATE_S,proto:"HPUnionCreateRsp"},{code:e.Code.UNION_OPER_C,proto:"HPUnionOperReq"},{code:e.Code.UNION_OPER_S,proto:"UnionOperRsp"},{code:e.Code.UNION_MEMBER_C,proto:"HPUnionMemberReq"},{code:e.Code.UNION_MEMBER_S,proto:"HPUnionMemberRsp"},{code:e.Code.UNION_NOTICE_C,proto:"HPUnionNoticeC"},{code:e.Code.UNION_NOTICE_S,proto:""},{code:e.Code.UNION_SET_JOIN_LIMIT_C,proto:"SetJoinLimitReq"},{code:e.Code.UNION_SET_JOIN_LIMIT_S,proto:"SetJoinLimitRsp"},{code:e.Code.UNION_PROMPT_MSG_S,proto:"UnionPromptMsg"},{code:e.Code.UNION_JOIN_REQ_C,proto:"JoinUnionReq"},{code:e.Code.UNION_JOIN_REQ_S,proto:"JoinUnionRsp"},{code:e.Code.UNION_REQ_INFO_C,proto:"RequestJoinCollectReq"},{code:e.Code.UNION_REQ_INFO_S,proto:"RequestJoinCollectRsp"},{code:e.Code.UNION_BONFIRE_ENTER_C,proto:"UnionBonfireEnterReq"},{code:e.Code.UNION_BONFIRE_ENTER_S,proto:"UnionBonfireEnterRsp"},{code:e.Code.UNION_BONFIRE_EXIT_C,proto:"UnionBonfireExitReq"},{code:e.Code.UNION_BONFIRE_EXIT_S,proto:"UnionBonfireExitRsp"},{code:e.Code.UNION_BONFIRE_MEM_CHANGE_S,proto:"OtherMemComeOrOutSync"},{code:e.Code.UNION_BONFIRE_EXP_AWARD_S,proto:"BonfireExpAwardSync"},{code:e.Code.UNION_BONFIRE_AWARD_ADD_S,proto:"BonfireAwardAddSync"},{code:e.Code.UNION_BONFIRE_HAPPY_C,proto:"BonfireHappyReq"},{code:e.Code.UNION_BONFIRE_HAPPY_S,proto:"BonfireHappyRsp"},{code:e.Code.UNION_SIEGE_INFO_C,proto:"UnionSiegeInfoReq"},{code:e.Code.UNION_SIEGE_INFO_S,proto:"UnionSiegeInfoRsp"},{code:e.Code.UNION_SIEGE_LAST_WAR_C,proto:"UnionSiegeLastWarReq"},{code:e.Code.UNION_SIEGE_LAST_WAR_S,proto:"UnionSiegeLastWarRsp"},{code:e.Code.UNION_SIEGE_POSITION_C,proto:"UnionSiegePositionReq"},{code:e.Code.UNION_SIEGE_POSITION_S,proto:"UnionSiegePositionRsp"},{code:e.Code.UNION_SIEGE_MY_POSITION_C,proto:"UnionSiegeMyPositionReq"},{code:e.Code.UNION_SIEGE_MY_POSITION_S,proto:"UnionSiegeMyPositionRsp"},{code:e.Code.UNION_SIEGE_SCENE_INFO_S,proto:"UnionSiegeSceneInfoSYNC"},{code:e.Code.UNION_SIEGE_BATTLE_PROGRESS_S,proto:"UnionSiegeBattleProgressSYNC"},{code:e.Code.UNION_SIEGE_MINING_FLAG_C,proto:"UnionSiegeFlagReq"},{code:e.Code.UNION_SIEGE_FLAG_STATE_S,proto:"UnionSiegeFlagStateSYNC"},{code:e.Code.UNION_SIEGE_BATTLE_RESULT_S,proto:"UnionSiegeBattleResultSYNC"},{code:e.Code.UNION_SIEGE_CHALLENGE_NPC_C,proto:"UnionSiegeChallengeNPCReq"},{code:e.Code.SHOP_C,proto:"OPShopInfoReq"},{code:e.Code.SHOP_S,proto:"OPShopInfoRsp"},{code:e.Code.SHOP_COIN_C,proto:"BuyGoodsReq"},{code:e.Code.SHOP_COIN_S,proto:"BuyGoodsRsp"},{code:e.Code.SHOP_LEGENDARYMART_C,proto:"RefreshEquipShopReq"},{code:e.Code.SHOP_LEGENDARYMART_S,proto:"RefreshEquipShopRsp"},{code:e.Code.BATTLE_FAST_FIGHT_C,proto:"HPFastBattle"},{code:e.Code.BATTLE_FAST_FIGHT_S,proto:"HPFastBattleRet"},{code:e.Code.BUY_FAST_FIGHT_TIMES_C,proto:"HPBuyFastFightTimes"},{code:e.Code.BUY_FAST_FIGHT_TIMES_S,proto:"HPBuyFastFightTimesRet"},{code:e.Code.BUY_BOSS_FIGHT_TIMES_C,proto:"HPBuyBossFightTimes"},{code:e.Code.BUY_BOSS_FIGHT_TIMES_S,proto:"HPBuyBossFightTimesRet"},{code:e.Code.BOSS_WIPE_C,proto:"HPBossWipe"},{code:e.Code.BOSS_WIPE_S,proto:"HPBossWipeRet"},{code:e.Code.BUY_ELITE_FIGHT_TIMES_C,proto:"HPBuyEliteFightTimes"},{code:e.Code.BUY_ELITE_FIGHT_TIMES_S,proto:"HPBuyEliteFightTimesRet"},{code:e.Code.BUY_FIELDORKEY_FIGHT_TIMES_C,proto:"HPBuyCopyTimesReq"},{code:e.Code.BUY_FIELDORKEY_FIGHT_TIMES_S,proto:"HPBuyCopyTimesRsp"},{code:e.Code.BP_REQUEST_BATTLE_MAP_CROWD_MONSTER_INFO_C_VALUE,proto:"HPRequestMapNearByMonsterInfo"},{code:e.Code.BP_BATTLE_MAP_CROWD_MONSTER_INFO_S_VALUE,proto:"HPMapNearByMonsterInfo"},{code:e.Code.BP_BOSS_BE_PLUNDER_NOTIFY_S,proto:"HPBossPlunderByOtherNotify"},{code:e.Code.BP_BOSS_BE_PLUNDER_RESULT_S,proto:"HPBossPlunderByOther"},{code:e.Code.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_C_VALUE,proto:"HPRequestMapPkOtherNpcPlayersInfo"},{code:e.Code.BP_REQUEST_BATTLE_MAP_NPC_PLAYER_INFO_S_VALUE,proto:"HPMapPkOtherNpcPlayersInfo"},{code:e.Code.MAINMISSION_LIST_S,proto:"HPMainMissionListS"},{code:e.Code.MAINMISSION_BONUS_C_VALUE,proto:"HPMissionBonusC"},{code:e.Code.MAINMISSION_BONUS_S_VALUE,proto:""},{code:e.Code.MAIL_INFO_C,proto:"OPMailInfo"},{code:e.Code.MAIL_INFO_S,proto:"OPMailInfoRet"},{code:e.Code.MAIL_GET_C,proto:"OPMailGet"},{code:e.Code.MAIL_GET_S,proto:"OPMailGetRet"},{code:e.Code.MAIL_READ_C,proto:"ReadMailInfo"},{code:e.Code.MAIL_READ_S,proto:"ReadMaiInfoRet"},{code:e.Code.USE_CDK_C,proto:"HPUseCdk"},{code:e.Code.USE_CDK_S,proto:"HPUseCdkRet"},{code:e.Code.LVL_GIFT_SYNC,proto:"HPLvlGiftSync"},{code:e.Code.DRAW_LVL_GIFT,proto:"HPDrawLvlGift"},{code:e.Code.NEWLY_GIFT_SYNC,proto:"HPNewlyGiftSync"},{code:e.Code.DRAW_NEWLY_GIFT,proto:"HPDrawNewlyGift"},{code:e.Code.HONOR_SHOP_BUY_C,proto:"HPHonorBuy"},{code:e.Code.HONOR_SHOP_BUY_S,proto:"HPHonorBuyRet"},{code:e.Code.HONOR_SHOP_REFRESH_C,proto:""},{code:e.Code.HONOR_SHOP_REFRESH_S,proto:"HPHonorShopListRet"},{code:e.Code.NOBILITY_NOBILITY_INFO_C,proto:"NobilityInfoReq"},{code:e.Code.NOBILITY_NOBILITY_INFO_S,proto:"NobilityInfoRsp"},{code:e.Code.NOBILITY_LEVEL_UP_C,proto:"NobilityLevelUpReq"},{code:e.Code.NOBILITY_LEVEL_UP_S,proto:"NobilityLevelUpRsp"},{code:e.Code.NOBILITY_REWARD_C,proto:"NobilityRewardReq"},{code:e.Code.NOBILITY_REWARD_S,proto:"NobilityRewardRsp"},{code:e.Code.BP_BOSS_LIST_C,proto:"HPBossPlunderListReq"},{code:e.Code.BP_BOSS_LIST_S,proto:"HPBossPlunderListRsp"},{code:e.Code.BP_BOSS_CLEAN_CD_C,proto:"HPBossPlunderCleanCdReq"},{code:e.Code.BP_BOSS_CLEAN_CD_S,proto:"HPBossPlunderCleanCdRsp"},{code:e.Code.PK_INFO_C,proto:"PKInfoReq"},{code:e.Code.PK_INFO_S,proto:"PKInfoRsp"},{code:e.Code.PK_REFRESH_OPPONENT_S,proto:"PKRefreshOpponentRsp"},{code:e.Code.PK_LOG_C,proto:"PKLogReq"},{code:e.Code.PK_LOG_S,proto:"PKLogRsp"},{code:e.Code.PK_PVALUE_CLEAN_C,proto:"PKCleanPkValueReq"},{code:e.Code.PK_PVALUE_CLEAN_S,proto:"PKCleanPkValueRsp"},{code:e.Code.PK_FIGHT_C,proto:"PKStartReq"},{code:e.Code.PK_FIGHT_S,proto:"PKStartRsp"},{code:e.Code.PK_SEARCH_PINFO_C,proto:"PKRankPlayerInfoReq"},{code:e.Code.PK_SEARCH_PINFO_S,proto:"PKRankPlayerInfoRsp"},{code:e.Code.WING_LEVEL_UP_C,proto:""},{code:e.Code.WING_LEVEL_UP_S,proto:"HPWingLvlUpRet"},{code:e.Code.WING_RANK_C,proto:""},{code:e.Code.WING_RANK_S,proto:"HPWingQualityRankRet"},{code:e.Code.WING_EVOLUTION_C,proto:"HPWingEvolutionReq"},{code:e.Code.WING_EVOLUTION_S,proto:"HPWingEvolutionRsp"},{code:e.Code.WING_STAR_UP_C,proto:"HPWingStarUpReq"},{code:e.Code.WING_STAR_UP_S,proto:"HPWingStarUpRsp"},{code:e.Code.PET_LEVEL_UP_C,proto:"PetUp"},{code:e.Code.PET_LEVEL_UP_S,proto:"PetUp"},{code:e.Code.PET_SHOW_ID_C,proto:"PetShow"},{code:e.Code.PET_SHOW_ID_S,proto:"PetShow"},{code:e.Code.UNION_SKILL_LEVEL_UP_C,proto:"UnionSkillLevelUpReq"},{code:e.Code.UNION_SKILL_LEVEL_UP_S,proto:"UnionSkillLevelUpRsp"},{code:e.Code.UNION_SKILL_INFO_C,proto:"GetUnionSkillInfoReq"},{code:e.Code.UNION_SKILL_INFO_S,proto:"GetUnionSkillInfoRsp"},{code:e.Code.UNION_GET_ACTIVITY_C,proto:"GetUnionActivityInfoReq"},{code:e.Code.UNION_GET_ACTIVITY_S,proto:"GetUnionActivityInfoRsp"},{code:e.Code.UNION_DO_ACTIVITY_C,proto:"DoUnionActivityReq"},{code:e.Code.UNION_DO_ACTIVITY_S,proto:"DoUnionActivityRsp"},{code:e.Code.CS_ARENA_INFO_C,proto:"CSArenaInfoReq"},{code:e.Code.CS_ARENA_INFO_S,proto:"CSArenaInfoRsp"},{code:e.Code.CS_MATCH_OPPONENT_C,proto:"CSMatchOpponentReq"},{code:e.Code.CS_MATCH_OPPONENT_S,proto:"CSMatchOpponentRsp"},{code:e.Code.CS_CHALLENGE_C,proto:"CSArenaChallengeReq"},{code:e.Code.CS_CHALLENGE_S,proto:"CSArenaChallengeRsp"},{code:e.Code.CS_ARENA_RANK_INFO_C,proto:"CSArenaRankInfoReq"},{code:e.Code.CS_ARENA_RANK_INFO_S,proto:"CSArenaRankInfoRsp"},{code:e.Code.CS_ARENA_BET_C,proto:"CSArenaBetReq"},{code:e.Code.CS_ARENA_BET_S,proto:"CSArenaBetRsp"},{code:e.Code.CS_ARENA_POPULAR_C,proto:"CSArenaPopularInfoReq"},{code:e.Code.CS_ARENA_POPULAR_S,proto:"CSArenaPopularInfoRsp"},{code:e.Code.CS_ARENA_MY_BET_C,proto:"CSArenaMyBetInfoReq"},{code:e.Code.CS_ARENA_MY_BET_S,proto:"CSArenaMyBetInfoRsp"},{code:e.Code.CS_ARENA_MY_FIGHT_C,proto:"CSArenaMyFightInfoReq"},{code:e.Code.CS_ARENA_MY_FIGHT_S,proto:"CSArenaMyFightInfoRsp"},{code:e.Code.CS_ARENA_OTHER_FIGHT_C,proto:"CSArenaOtherFightInfoReq"},{code:e.Code.CS_ARENA_OTHER_FIGHT_S,proto:"CSArenaOtherFightInfoRsp"},{code:e.Code.CS_ARENA_WORSHIP_C,proto:"CSArenaWorshipReq"},{code:e.Code.CS_ARENA_WORSHIP_S,proto:"CSArenaWorshipRsp"},{code:e.Code.CS_ARENA_PINNACLE_SHOP_BUY_C,proto:"CSArenaPinnacleShopBuyReq"},{code:e.Code.CS_ARENA_PINNACLE_SHOP_BUY_S,proto:"CSArenaPinnacleShopBuyRsp"},{code:e.Code.CS_ARENA_CANCEL_MATCH_C,proto:"CSArenaCancelMatchReq"},{code:e.Code.CS_ARENA_CANCEL_MATCH_S,proto:"CSArenaCancelMatchRsp"},{code:e.Code.CS_ARENA_THUMBS_UP_C,proto:"CSArenaThumbsUpReq"},{code:e.Code.CS_ARENA_THUMBS_UP_S,proto:"CSArenaThumbsUpRsp"},{code:e.Code.CS_ARENA_MATCH_TIMES_BUY_C,proto:"CSArenaDanMatchTimesBuyReq"},{code:e.Code.CS_ARENA_MATCH_TIMES_BUY_S,proto:"CSArenaDanMatchTimesBuyRsp"},{code:e.Code.CS_ARENA_PINNACLE_COIN_SYNC,proto:"CSArenaPinnacleCoinSycn"},{code:e.Code.CS_ARENA_SEASON_STAGE_CHANGE_S,proto:"CSArenaSeasonStageChange"},{code:e.Code.ACTIVE_INFO_SYNC_C,proto:""},{code:e.Code.ACTIVE_INFO_SYNC_S,proto:"HPActiveInfoSync"},{code:e.Code.ACTIVE_GET_REWARD_C,proto:"HPActiveGetRewardC"},{code:e.Code.ACTIVE_GET_REWARD_S,proto:""},{code:e.Code.ACTIVE_DAILY_TASK_REWARD_C,proto:"GetDailyTaskRewardReq"},{code:e.Code.ACTIVE_DAILY_TASK_REWARD_S,proto:""},{code:e.Code.ACHIEVEMENT_INFO_S,proto:"AchievementInfo"},{code:e.Code.ACHIEVEMENT_AWARD_C,proto:"GetAchievementAwardReq"},{code:e.Code.ACHIEVEMENT_AWARD_S,proto:"GetAchievementAwardRsp"},{code:e.Code.GET_ACTIVITY_LIST_C,proto:"HPGetActivityList"},{code:e.Code.OPEN_ACTIVITY_SYNC_S,proto:"HPOpenActivitySyncS"},{code:e.Code.ACTIVITY_LUACFG_DOWNLOAD_LIST_C,proto:""},{code:e.Code.ACTIVITY_LUACFG_DOWNLOAD_LIST_S,proto:"HPNeedDownloadListRet"},{code:e.Code.DAY_RECHARGE_AWARD_C,proto:"HPAccRechargeInfo"},{code:e.Code.DAY_RECHARGE_AWARD_S,proto:"HPAccRechargeInfoRet"},{code:e.Code.GET_DAY_RECHARGE_AWARD_C,proto:"HPGetAccRechargeAward"},{code:e.Code.GET_DAY_RECHARGE_AWARD_S,proto:"HPGetAccRechargeAwardRet"},{code:e.Code.CONTINUE_RECHARGE_INFO_C,proto:"HPContinueRechargeInfo"},{code:e.Code.CONTINUE_RECHARGE_INFO_S,proto:"HPContinueRechargeInfoRet"},{code:e.Code.GET_CONTINUE_RECHARGE_AWARD_C,proto:"HPGetContinueRechargeAward"},{code:e.Code.GET_CONTINUE_RECHARGE_AWARD_S,proto:"HPGetContinueRechargeAwardRet"},{code:e.Code.VIP_WELFARE_INFO_C,proto:""},{code:e.Code.VIP_WELFARE_INFO_S,proto:"HPVipWelfareInfoRet"},{code:e.Code.VIP_WELFARE_AWARD_C,proto:""},{code:e.Code.VIP_WELFARE_AWARD_S,proto:"HPVipWelfareRewardRet"},{code:e.Code.ACC_LOGIN_INFO_C,proto:"HPAccLoginInfo"},{code:e.Code.ACC_LOGIN_INFO_S,proto:"HPAccLoginInfoRet"},{code:e.Code.ACC_LOGIN_AWARDS_C,proto:"HPAccLoginAwards"},{code:e.Code.ACC_LOGIN_AWARDS_S,proto:"HPAccLoginAwardsRet"},{code:e.Code.OPEN_ACTIVITY_PEOPLE_WELFARE_C,proto:"HPOpenPeopleWelfareInfoReq"},{code:e.Code.OPEN_ACTIVITY_PEOPLE_WELFARE_S,proto:"HPOpenPeopleWelfareInfoRsp"},{code:e.Code.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_C,proto:"HPOpenPeopleWelfareBuyReq"},{code:e.Code.FESTIVAL_ACTIVITY_PEOPLE_WELFARE_S,proto:"HPOpenPeopleWelfareBuyRsp"},{code:e.Code.ACTIVITY_ERRORNO_S,proto:"HPActivityErrorNoRsp"},{code:e.Code.EVERYDAY_SIGN_INFO_C,proto:""},{code:e.Code.EVERYDAY_SIGN_INFO_S,proto:"HPEverydaySignInfoRet"},{code:e.Code.EVERYDAY_SIGN_AWARD_C,proto:"HPGetEverydaySignAward"},{code:e.Code.EVERYDAY_SIGN_AWARD_S,proto:"HPGetEverydaySignAwardRet"},{code:e.Code.OPEN_TEST_C,proto:""},{code:e.Code.OPEN_TEST_S,proto:"HPOpenPackageInfoRsp"},{code:e.Code.OPEN_DISCOUNT_ACTIVITY_BUY_C,proto:"HPOpenPackageBuyReq"},{code:e.Code.OPEN_DISCOUNT_ACTIVITY_BUY_S,proto:"HPOpenPackageBuyRsp"},{code:e.Code.GROW_FUND_C,proto:""},{code:e.Code.GROW_FUND_S,proto:"HPGrowFundRet"},{code:e.Code.GET_GROW_FUND_C,proto:"HPGetGrowFund"},{code:e.Code.GET_GROW_FUND_S,proto:"HPGetGrowFundRet"},{code:e.Code.BUY_GROW_FUND_C,proto:""},{code:e.Code.BUY_GROW_FUND_S,proto:"HPBuyGrowFundRet"},{code:e.Code.VIP_GIFTS_INFO_C,proto:""},{code:e.Code.VIP_GIFTS_INFO_S,proto:"HPVipGiftsInfoRet"},{code:e.Code.BUY_VIP_GIFT_C,proto:"HPBuyVipGift"},{code:e.Code.BUY_VIP_GIFT_S,proto:"HPBuyVipGiftRet"},{code:e.Code.ACC_RECHARGE2_INFO_C,proto:""},{code:e.Code.ACC_RECHARGE2_INFO_S,proto:"HPAccRecharge2InfoRet"},{code:e.Code.GET_ACC_RECHARGE2_AWARD_C,proto:""},{code:e.Code.GET_ACC_RECHARGE2_AWARD_S,proto:"HPGetAccRecharge2AwardRet"},{code:e.Code.OPEN_RECHARGE_RANKINGS_C,proto:"RechargeRankReq"},{code:e.Code.OPEN_RECHARGE_RANKINGS_S,proto:"RechargeRankRsp"},{code:e.Code.RANK_C,proto:"ServerRankInfoReq"},{code:e.Code.RANK_S,proto:"ServerRankInfoRsp"},{code:e.Code.SERVER_RANK_LIST_INFO_C,proto:"ServerRankListInfoReq"},{code:e.Code.SERVER_RANK_LIST_INFO_S,proto:"ServerRankListInfoRsp"},{code:e.Code.ONLINE_AWARD_INFO_C,proto:"OnlineAwardInfoReq"},{code:e.Code.ONLINE_AWARD_INFO_S,proto:"OnlineAwardInfoRsp"},{code:e.Code.GET_ONLINE_AWARD_C,proto:"GetOnlineAwardReq"},{code:e.Code.GET_ONLINE_AWARD_S,proto:"GetOnlineAwardRsp"},{code:e.Code.DAILY_ACC_RECHARGE_INFO_C,proto:"DailyAccRechargeInfoReq"},{code:e.Code.DAILY_ACC_RECHARGE_INFO_S,proto:"DailyAccRechargeInfoRsp"},{code:e.Code.GENERAL_REVELRY_AWARD_C,proto:"GetDailyAccRechargeAwardReq"},{code:e.Code.GENERAL_REVELRY_AWARD_S,proto:"GetDailyAccRechargeAwardRsp"},{code:e.Code.GENERAL_REVELRY_INFO_C,proto:"GeneralRevelryInfoReq"},{code:e.Code.GENERAL_REVELRY_INFO_S,proto:"GeneralRevelryInfoRsp"},{code:e.Code.DAILY_ACC_RECHARGE_AWARD_C,proto:"GetGeneralRevelryAwardReq"},{code:e.Code.DAILY_ACC_RECHARGE_AWARD_S,proto:"GetGeneralRevelryAwardRsp"},{code:e.Code.LIMIT_BUY_GIFT_INFO_C,proto:"LimitBuyGiftInfoReq"},{code:e.Code.LIMIT_BUY_GIFT_INFO_S,proto:"LimitBuyGiftInfoRsp"},{code:e.Code.BUY_LIMIT_BUY_GIFT_C,proto:"BuyLimitBuyGiftReq"},{code:e.Code.BUY_LIMIT_BUY_GIFT_S,proto:"BuyLimitBuyGiftRsp"},{code:e.Code.RING_SYNTHESIS_C,proto:"HPsynthesis"},{code:e.Code.RING_SYNTHESIS_S,proto:"HPsynthesisRet"},{code:e.Code.STANDARD_ACTIVITY_INFO_C,proto:"StandardActivityInfoReq"},{code:e.Code.STANDARD_ACTIVITY_INFO_S,proto:"StandardActivityInfoRsp"},{code:e.Code.STANDARD_ACTIVITY_REWARD_C,proto:"GetActivityProgressAwardReq"},{code:e.Code.STANDARD_ACTIVITY_REWARD_S,proto:"GetActivityProgressAwardRsp"},{code:e.Code.OPEN_GOLOD_BOX_BUY_C,proto:"HPSvrOpenRMBBoxInfoReq"},{code:e.Code.OPEN_GOLOD_BOX_BUY_S,proto:"HPSvrOpenRMBBoxInfoRsp"},{code:e.Code.OPEN_GOLOD_BOX_INFO_C,proto:"HPSvrOpenRMBBoxSignReq"},{code:e.Code.OPEN_GOLOD_BOX_INFO_S,proto:"HPSvrOpenRMBBoxSignRsp"},{code:e.Code.POKE_PIGIN_UP_C,proto:"HPPokePigreq"},{code:e.Code.POKE_PIGIN_UP_S,proto:"HPPokePigrsp"},{code:e.Code.POKE_PIGIN_INFO_C,proto:"HPPokePigInforeq"},{code:e.Code.POKE_PIGIN_INFO_S,proto:"HPPokePigInforsp"},{code:e.Code.SMASH_GOLD_EGGS_C,proto:"HPSmashGoldEggsReq"},{code:e.Code.SMASH_GOLD_EGGS_S,proto:"HPSmashGoldEggsRsp"},{code:e.Code.SMASH_GOLD_EGGS_BREAK_C,proto:"HPSmashGoldEggsBreakReq"},{code:e.Code.SMASH_GOLD_EGGS_BREAK_S,proto:"HPSmashGoldEggsBreakRsp"},{code:e.Code.SMASH_GOLD_EGGS_RECEIVE_C,proto:"HPSmashGoldEggsReceiveReq"},{code:e.Code.SMASH_GOLD_EGGS_RECEIVE_S,proto:"HPSmashGoldEggsReceiveRsp"},{code:e.Code.MAY_DAY_ACC_REHARGE_INFO_C,proto:"HPAccRecharge2Info"},{code:e.Code.MAY_DAY_ACC_REHARGE_INFO_S,proto:"HPAccRecharge2InfoRet"},{code:e.Code.MAY_DAY_ACC_REHARGE_GET_C,proto:"HPGetAccRecharge2Award"},{code:e.Code.MAY_DAY_ACC_REHARGE_GET_S,proto:"HPGetAccRecharge2AwardRet"},{code:e.Code.MAY_DAY_CONSUME_GOLD_INFO_C,proto:"HPAccRecharge2Info"},{code:e.Code.MAY_DAY_CONSUME_GOLD_INFO_S,proto:"HPAccRecharge2InfoRet"},{code:e.Code.MAY_DAY_CONSUME_GOLD_GET_C,proto:"HPGetAccRecharge2Award"},{code:e.Code.MAY_DAY_CONSUME_GOLD_GET_S,proto:"HPGetAccRecharge2AwardRet"},{code:e.Code.MAY_DAY_LOGIN_INFO_C,proto:"HPAccLoginInfo"},{code:e.Code.MAY_DAY_LOGIN_INFO_S,proto:"HPAccLoginInfoRet"},{code:e.Code.MAY_DAY_LOGIN_GET_C,proto:"HPAccLoginAwards"},{code:e.Code.MAY_DAY_LOGIN_GET_S,proto:"HPAccLoginAwardsRet"},{code:e.Code.MAY_DAY_GIFT_INFO_C,proto:"HPActivityGiftAwardInfoReq"},{code:e.Code.MAY_DAY_GIFT_INFO_S,proto:"HPActivityGiftAwardInfoRsp"},{code:e.Code.MAY_DAY_GIFT_GET_C,proto:"HPActivityGiftAwardBuyReq"},{code:e.Code.MAY_DAY_GIFT_GET_S,proto:"HPActivityGiftAwardBuyRsp"},{code:e.Code.MAY_DAY_DOUBLEUP_GOLD_INFO_C,proto:"HPRandomGetGoldsInfoReq"},{code:e.Code.MAY_DAY_DOUBLEUP_GOLD_INFO_S,proto:"HPRandomGetGoldsInfoRsp"},{code:e.Code.MAY_DAY_DOUBLEUP_GOLD_AWARD_C,proto:"HPRandomGetGoldsAwardReq"},{code:e.Code.MAY_DAY_DOUBLEUP_GOLD_AWARD_S,proto:"HPRandomGetGoldsAwardRsp"},{code:e.Code.MAY_DAY_DOUBLEUP_GOLD_LOG_S,proto:"HPRandomGetGoldsLogRsp"},{code:e.Code.READ_PACKAGE_GOLDS_INFO_C,proto:"HPRedPackageInfoRep"},{code:e.Code.READ_PACKAGE_GOLDS_INFO_S,proto:"HPRedPackageInfoRsq"},{code:e.Code.READ_PACKAGE_LOG_INFO_S,proto:"HPRedPackageRobRsq"},{code:e.Code.READ_PACKAGE_ROB_C,proto:"HPRedPackageRobRep"},{code:e.Code.READ_PACKAGE_ROB_S,proto:"HPRedPackageRobRsq"},{code:e.Code.READ_PACKAGE_ROB_INFO_S,proto:"HPRedPackageRobGoldsRsq"},{code:e.Code.CYCLE_CONSUME_GOLDS_INFO_C,proto:"HPAccRecharge2Info"},{code:e.Code.CYCLE_CONSUME_GOLDS_INFO_S,proto:"HPAccRecharge2InfoRet"},{code:e.Code.CYCLE_CONSUME_GOLDS_AWARD_C,proto:"HPGetAccRecharge2Award"},{code:e.Code.CYCLE_CONSUME_GOLDS_AWARD_S,proto:"HPGetAccRecharge2AwardRet"},{code:e.Code.CONSUM_GOLDS_RANK_INFO_C,proto:"HPConsumeGoldsRankInfoReq"},{code:e.Code.CONSUM_GOLDS_RANK_INFO_S,proto:"HPConsumeGoldsRankInfoRsp"},{code:e.Code.SOUL_SOUL_INFO_C,proto:"SoulInfoReq"},{code:e.Code.SOUL_SOUL_INFO_S,proto:"SoulInfoRsp"},{code:e.Code.SOUL_APPARE_OR_REPLACE_C,proto:"ApparelOrReplaceSoulReq"},{code:e.Code.SOUL_APPARE_OR_REPLACE_S,proto:"ApparelOrReplaceSoulRsp"},{code:e.Code.SOUL_DEGREE_UP_C,proto:"UpSoulDegreeReq"},{code:e.Code.SOUL_DEGREE_UP_S,proto:"UpSoulDegreeRsp"},{code:e.Code.SOUL_HUNTING_INFO_C,proto:"HuntingSoulInfoReq"},{code:e.Code.SOUL_HUNTING_INFO_S,proto:"HuntingSoulInfoRsp"},{code:e.Code.SOUL_OPEN_GROOVE_C,proto:"OpenGrooveReq"},{code:e.Code.SOUL_OPEN_GROOVE_S,proto:"OpenGrooveRsp"},{code:e.Code.SOUL_HUNTING_C,proto:"HuntingSoulReq"},{code:e.Code.SOUL_HUNTING_S,proto:"HuntingSoulRsp"},{code:e.Code.SOUL_LIGHT_ORANGE_C,proto:"LightOrangeSoulReq"},{code:e.Code.SOUL_LIGHT_ORANGE_S,proto:"LightOrangeSoulRsp"},{code:e.Code.SOUL_SMELT_C,proto:"SmeltSoulReq"},{code:e.Code.SOUL_SMELT_S,proto:"SmeltSoulRsp"},{code:e.Code.TREASURE_HUNT_C,proto:"HPTreasureHuntReq"},{code:e.Code.TREASURE_HUNT_S,proto:"HPTreasureHuntRsp"},{code:e.Code.TREASURE_HUNT_LOG_C,proto:"TreasureHuntLogReq"},{code:e.Code.TREASURE_HUNT_LOG_S,proto:"TreasureHuntLogRsp"},{code:e.Code.TREASURE_SALE_C,proto:"HPTreasureSaleRep"},{code:e.Code.TREASURE_SALE_S,proto:"HPTreasureSaleRsq"},{code:e.Code.CURRENCY_CHANGE_PUSH,proto:"CurrencyChangePush"},{code:e.Code.UNION_BOSS_INFO_S,proto:"UnionBossInfoRsp"},{code:e.Code.UNION_BOSS_HARMS_S,proto:"UnionBossHarmRankRsp"},{code:e.Code.UNION_CHALLENGE_BOSS_S,proto:"UnionBossChallengeRsp"},{code:e.Code.UNION_GET_KILL_BOSS_AWARD_S,proto:"GetKillBossAwardRsp"},{code:e.Code.GHOST_TOWER_INFO_C,proto:"GhostTowerInfoReq"},{code:e.Code.GHOST_TOWER_INFO_S,proto:"GhostTowerInfoRsp"},{code:e.Code.GHOST_TOWER_CHALLENGE_C,proto:"GhostTowerChallengeReq"},{code:e.Code.GHOST_TOWER_CHALLENGE_S,proto:"GhostTowerChallengeRsp"},{code:e.Code.GHOST_TOWER_HELP_PLAYER_C,proto:"HelpPlayerInfoReq"},{code:e.Code.GHOST_TOWER_HELP_PLAYER_S,proto:"HelpPlayerInfoRsp"},{code:e.Code.GHOST_TOWER_DAILY_REWARD_C,proto:"DailyRewardReq"},{code:e.Code.GHOST_TOWER_DAILY_REWARD_S,proto:"DailyRewardRsp"},{code:e.Code.CONRNUCONPIA_INFO_C,proto:"HPConrnuconpiaInfoReq"},{code:e.Code.CONRNUCONPIA_INFO_S,proto:"HPConrnuconpiaInfoRsp"},{code:e.Code.CONRNUCONPIA_AWARD_C,proto:"HPConrnuconpiaAwardReq"},{code:e.Code.CONRNUCONPIA_AWARD_S,proto:"HPConrnuconpiaAwardRsp"},{code:e.Code.FETCH_WORLD_BOSS_INFO_S,proto:"FetchWorldBossInfoRsp"},{code:e.Code.ENTER_WORLD_BOSS_S,proto:"EnterWorldBossRsp"},{code:e.Code.WORLD_BOSS_FIGHT_PUTH_S,proto:"WorldBossFightInfoSync"},{code:e.Code.WORLD_BOSS_INVITE_UNION_MEM_S,proto:"InviteUnionMemberRsp"},{code:e.Code.LEAVE_WORLD_BOSS_S,proto:"LeaveWorldBossRsp"},{code:e.Code.WORLD_BOSS_TIME_S,proto:"WorldBossTimeSync"},{code:e.Code.WORLD_BOSS_END_PUSH_S,proto:"WorldBossEndSync"},{code:e.Code.PLAYER_FASHION_INFO_C,proto:"HPFashionInfoReq"},{code:e.Code.PLAYER_FASHION_INFO_S,proto:"HPFashionInfoRsp"},{code:e.Code.FASHION_ACTIVATE_C,proto:"HPFashionBuyReq"},{code:e.Code.FASHION_ACTIVATE_S,proto:"HPFashionBuyRsp"},{code:e.Code.FASHION_WEAR_INFO_C,proto:"HPWearFashionReq"},{code:e.Code.FASHION_WEAR_INFO_S,proto:"HPWearFashionRsp"},{code:e.Code.FASHION_ROLE_INFO_S,proto:"HPFashionRoleInfoRsp"},{code:e.Code.DRAGON_BONE_INFO_C,proto:"HPDragonBoneInfoReq"},{code:e.Code.DRAGON_BONE_INFO_S,proto:"HPDragonBoneInfoRsp"},{code:e.Code.DRAGON_BONE_WEAR_C,proto:"HPDragonBoneWearReq"},{code:e.Code.DRAGON_BONE_WEAR_S,proto:"HPDragonBoneWearRsp"},{code:e.Code.DRAGON_BONE_UPDRADE_C,proto:"HPDragonBoneUpgradeReq"},{code:e.Code.DRAGON_BONE_UPDRADE_S,proto:"HPDragonBoneUpgradeRsp"},{code:e.Code.DRAGON_BONE_RISING_STAR_C,proto:"HPDragonBoneRisingStarReq"},{code:e.Code.DRAGON_BONE_RISING_STAR_S,proto:"HPDragonBoneRisingStarRsp"},{code:e.Code.DRAGON_BONE_WARD_C,proto:"HPDragonBonewardReq"},{code:e.Code.DRAGON_BONE_WARD_S,proto:"HPDragonBonewardRsp"},{code:e.Code.DRAGON_BONE_COMBINED_STAR_C,proto:"HPDragonBoneCombinedStarReq"},{code:e.Code.DRAGON_BONE_COMBINED_STAR_S,proto:"HPDragonBoneCombinedStarRsp"},{code:e.Code.DRAGON_INFO_SYNC_S,proto:"HPDragonBoneInfoSync"},{code:e.Code.DRAGON_BONE_UPDATE_S,proto:"HPDragonBoneUpdateSync"},{code:e.Code.DRAGON_BONE_DELETE_S,proto:"HPDragonBoneDeleteSync"},{code:e.Code.DRAGON_BONE_LOCK_C,proto:"HPDragonBoneLockRep"},{code:e.Code.DRAGON_BONE_LOCK_S,proto:"HPDragonBoneLockRsp"},{code:e.Code.DRAGON_BONE_WARDSYNC_S,proto:"HPDragonBoneWardSync"},{code:e.Code.DRAGON_ARMOUR_ADD_S,proto:"DragonArmourSync"},{code:e.Code.DRAGON_ARMOUR_BAG_INFO_S,proto:"DragonArmourInfoSync"},{code:e.Code.DRAGON_ARMOUR_INFO_C,proto:"DragonArmourInfoReq"},{code:e.Code.DRAGON_ARMOUR_INFO_S,proto:"DragonArmourInfoRsp"},{code:e.Code.DRAGON_ARMOUR_DRESS_C,proto:"DragonArmourDressReq"},{code:e.Code.DRAGON_ARMOUR_DRESS_S,proto:"DragonArmourDressRsp"},{code:e.Code.DRAGON_ARMOUR_ENGRAVE_C,proto:"DragonArmourEngraveReq"},{code:e.Code.DRAGON_ARMOUR_ENGRAVE_S,proto:"DragonArmourEngraveRsp"},{code:e.Code.DRAGON_ARMOUR_QUENCHING_C,proto:"DragonArmourQuenchingReq"},{code:e.Code.DRAGON_ARMOUR_QUENCHING_S,proto:"DragonArmourQuenchingRsp"},{code:e.Code.DRAGON_ARMOUR_LOCK_C,proto:"DragonArmourLockReq"},{code:e.Code.DRAGON_ARMOUR_LOCK_S,proto:"DragonArmourLockRsp"},{code:e.Code.DRAGON_ARMOUR_SHOW_GUARD_C,proto:"DragonArmourShowGuardReq"},{code:e.Code.DRAGON_ARMOUR_SHOW_GUARD_S,proto:"DragonArmourShowGuardRsp"},{code:e.Code.DRAGON_ARMOUR_OPEN_PORE_C,proto:"DragonArmourOpenPoreReq"},{code:e.Code.DRAGON_ARMOUR_OPEN_PORE_S,proto:"DragonArmourOpenPoreRsp"},{code:e.Code.DRAGON_HOARD_INFO_C,proto:"HPDragonHoardInfoReq"},{code:e.Code.DRAGON_HOARD_INFO_S,proto:"HPDragonHoardInfoRsp"},{code:e.Code.NATURAL_VALUE_AWARD_C,proto:"HPNaturalValueReq"},{code:e.Code.NATURAL_VALUE_AWARD_S,proto:"HPNaturalValueRsp"},{code:e.Code.DRAGON_HOARD_AWARD_C,proto:"HPDragonHoardAwardReq"},{code:e.Code.DRAGON_HOARD_AWARD_S,proto:"HPDragonHoardAwardRsp"},{code:e.Code.OPEN_DRAGON_HOARD_C,proto:"HPOpenDragonHoardReq"},{code:e.Code.OPEN_DRAGON_HOARD_S,proto:"HPOpenDragonHoardRsp"},{code:e.Code.DRAGON_HOARD_LOG_C,proto:"HPDragonHoardLogReq"},{code:e.Code.DRAGON_HOARD_LOG_S,proto:"HPDragonHoardLogRsp"},{code:e.Code.DRAGON_ARMOUR_YU_ENGRAVE_C,proto:"DragonArmourYuEngraveReq"},{code:e.Code.DRAGON_ARMOUR_YU_ENGRAVE_S,proto:"DragonArmourYuEngraveRsp"},{code:e.Code.TURNTABLE_LOTTERY_INFO_C,proto:"TurntableLotteryInfoReq"},{code:e.Code.TURNTABLE_LOTTERYy_INFO_S,proto:"TurntableLotteryInfoRsp"},{code:e.Code.TURNTABLE_COUNT_AWARD_C,proto:"TurntableCountAwardRsq"},{code:e.Code.TURNTABLE_COUNT_AWARD_S,proto:"TurntableCountAwardRsp"},{code:e.Code.TURNTABLE_LOTTERY_DO_C,proto:"TurntableLotteryDoReq"},{code:e.Code.TURNTABLE_LOTTERY_DO_S,proto:"TurntableLotteryDoRsp"},{code:e.Code.TURNTABLE_LOTTERY_LOG_C,proto:"TurntableLotteryLogReq"},{code:e.Code.TURNTABLE_LOTTERY_LOG_S,proto:"TurntableLotteryLogRsp"},{code:e.Code.TWELVE_PALACE_INFO_C,proto:"TwelvePalaceInfoReq"},{code:e.Code.TWELVE_PALACE_INFO_S,proto:"TwelvePalaceInfoRsp"},{code:e.Code.ONE_PALACE_INFO_C,proto:"OnePalaceInfoReq"},{code:e.Code.ONE_PALACE_INFO_S,proto:"OnePalaceInfoRsp"},{code:e.Code.PALACE_STATE_CHANGE_S,proto:"PalaceStateChangeSync"},{code:e.Code.BUY_PALACE_CHALLENGE_NUM_C,proto:"BuyChallengeNumReq"},{code:e.Code.BUY_PALACE_CHALLENGE_NUM_S,proto:"BuyChallengeNumRsp"},{code:e.Code.DEMON_KEE_INFO_C,proto:"HPDemonKeeInfoReq"},{code:e.Code.DEMON_KEE_INFO_S,proto:"HPDemonKeeInfoRsp"},{code:e.Code.DEMON_KEE_UPGRADE_C,proto:"HPDemonKeeTeachReq"},{code:e.Code.DEMON_KEE_UPGRADE_S,proto:"HPDemonKeeTeachRsp"},{code:e.Code.DEMON_KEE_DOTE_ON_C,proto:"HPDemonKeeKissReq"},{code:e.Code.DEMON_KEE_DOTE_ON_S,proto:"HPDemonKeeKissRsp"},{code:e.Code.DEMON_KEE_ROCKET_C,proto:"HPDemonKeeFlyReq"},{code:e.Code.DEMON_KEE_ROCKET_S,proto:"HPDemonKeeFlyRsp"},{code:e.Code.DEMON_KEE_BOGGART_C,proto:"HPDemonKeeFightReq"},{code:e.Code.DEMON_KEE_BOGGART_S,proto:"HPDemonKeeFightRsp"},{code:e.Code.DEMON_KEE_AWARD_C,proto:"HPDemonKeeKissAwardReq"},{code:e.Code.DEMON_KEE_AWARD_S,proto:"HPDemonKeePetInfoRsp"},{code:e.Code.DEMON_KEE_EQUIP_C,proto:"HPDemonKeeEquipWearReq"},{code:e.Code.DEMON_KEE_EQUIP_S,proto:"HPDemonKeeEquipWearRsp"},{code:e.Code.DEMON_KEE_LOCK_C,proto:"HPDemonKeeLockReq"},{code:e.Code.DEMON_KEE_LOCK_S,proto:"HPDemonKeeLockRsp"},{code:e.Code.DEMON_KEE_FREE_C,proto:"HPDemonKeeFreeReq"},{code:e.Code.DEMON_KEE_FREE_S,proto:"HPDemonKeeFlyRsp"},{code:e.Code.DEMON_KEE_EQUIP_INFO_S,proto:"HPDemonKeeEquipInfoRsp"},{code:e.Code.DEMON_KEE_EQUIP_UPDATE_S,proto:"HPDemonKeeEquipInfoRsp"},{code:e.Code.TWELVE_PALACE_CHALLENGE_OCCUPIED_C,proto:"ChallengeOccupiedReq"},{code:e.Code.TWELVE_PALACE_CHALLENGE_OCCUPIED_S,proto:"ChallengeOccupiedRsp"},{code:e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_REQUEST,proto:"HPSceneBattleMergeInfoUpdateRequest"},{code:e.Code.SCENE_BATTLE_MERGE_INFO_UPDATE_SYNC,proto:"HPSceneBattleMergeInfoUpdateSync"},{code:e.Code.SYNC_TWELVE_PALACE_SCENE_INFO,proto:"HPTwelvePalaceSceneInfoSYNC"},{code:e.Code.SYNC_TWELVE_PALACE_SCENE_RESULT_INFO,proto:"HPSceneTwelvePalaceBattleResultSync"},{code:e.Code.SCENE_PLAYER_ENTER_REQUEST,proto:"HPChangeWorldSceneC"},{code:e.Code.SCENE_PLAYER_CONFIRM_ENTER_C,proto:"HPChangeWorldSceneC"},{code:e.Code.SCENE_PLAYER_ENTER_RESPONSE,proto:"HPChangeWorldSceneS"},{code:e.Code.SCENE_PLAYER_RELIVE_REQUEST,proto:"HPScenePlayerRequestRelive"},{code:e.Code.SCENE_PLAYER_RELIVE_RESPONSE,proto:"HPScenePlayerReliveResponse"},{code:e.Code.SCENE_PLAYER_ENTER,proto:"HPScenePlayerEnterS"},{code:e.Code.SCENE_PLAYER_LEAVE,proto:"HPScenePlayerLeaveS"},{code:e.Code.SCENE_MONSTER_ENTER,proto:"HPSceneMonsterEnterS"},{code:e.Code.SCENE_MONSTER_LEAVE,proto:"HPSceneMonsterLeaveS"},{code:e.Code.SCENE_OBJECT_ID_SYNC,proto:"SceneInfoSYNC"},{code:e.Code.SCENE_OBJECT_DEATH,proto:"HPSceneObjectDeathSync"},{code:e.Code.SCENE_PLAYER_INFO_SYNC,proto:"HPScenePlayerInfoSync"},{code:e.Code.SCENE_MONSTER_INFO_SYNC,proto:"HPSceneMonsterInfoSync"},{code:e.Code.BP_REQUEST_CROSS_SERVER_PLUNDER_BOSS_FIGHT_C,proto:"HPCrossServerBossPlunderFightReq"},{code:e.Code.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_INFO_SYNC,proto:"HPCrossPlunderBossSceneInfoSYNC"},{code:e.Code.BP_CROSS_SERVER_PLUNDER_BOSS_SCENE_RESULT_SYNC,proto:"HPCrossPlunderBossSceneBattleResultSync"},{code:e.Code.SCENE_OBJECT_MOVE_REQUEST,proto:"HPSceneMoveRequest"},{code:e.Code.SCENE_OBJECT_MOVE_RESPONSE,proto:"HPSceneMoveResponse"},{code:e.Code.SCENE_OBJECT_MOVE_SYNC,proto:"HPSceneMoveSYNC"},{code:e.Code.SCENE_OBJECT_POS_SYNC,proto:"HPScenePosSYNC"},{code:e.Code.DAILY_FIRST_CHARGE_INFO_C,proto:"DailyFirstChargeInfoReq"},{code:e.Code.DAILY_FIRST_CHARGE_INFO_S,proto:"DailyFirstChargeInfoRsp"},{code:e.Code.DAILY_FIRST_CHARGE_AWARD_C,proto:"DailyFirstChargeAwardReq"},{code:e.Code.DAILY_FIRST_CHARGE_AWARD_S,proto:"DailyFirstChargeAwardRsp"},{code:e.Code.SEVENDAYS_REBATE_INFO_C,proto:"SevenDaysRebateInfoReq"},{code:e.Code.SEVENDAYS_REBATE_INFO_S,proto:"SevenDaysRebateInfoRsp"},{code:e.Code.SEVENDAYS_REBATE_AWARD_C,proto:"SevenDaysRebateAwardReq"},{code:e.Code.SEVENDAYS_REBATE_AWARD_S,proto:"SevenDaysRebateAwardRsp"},{code:e.Code.CARNIVAL_FUND_INFO_C,proto:"CarnivalFundInfoReq"},{code:e.Code.CARNIVAL_FUND_INFO_S,proto:"CarnivalFundInfoRsp"},{code:e.Code.CARNIVAL_FUND_AWARD_C,proto:"CarnivalFundAwardReq"},{code:e.Code.CARNIVAL_FUND_AWARD_S,proto:"CarnivalFundAwardRsp"},{code:e.Code.PREFERENTIAL_INFO_C,proto:"PreferentialInfoReq"},{code:e.Code.PREFERENTIAL_INFO_S,proto:"PreferentialInfoRsp"},{code:e.Code.PREFERENTIAL_AWARD_C,proto:"PreferentialAwardReq"},{code:e.Code.PREFERENTIAL_AWARD_S,proto:"PreferentialAwardRsp"},{code:e.Code.DELUXE_ATTENDANCE_INFO_C,proto:"DeluxeAttendanceInfoReq"},{code:e.Code.DELUXE_ATTENDANCE_INFO_S,proto:"DeluxeAttendanceInfoRsp"},{code:e.Code.DELUXE_ATTENDANCE_AWARD_C,proto:"DeluxeAttendanceAwardReq"},{code:e.Code.DELUXE_ATTENDANCE_AWARD_S,proto:"DeluxeAttendanceAwardRsp"},{code:e.Code.GLASS_SHOP_LIMIT_INFO_C,proto:"GlassShopLimitInfoReq"},{code:e.Code.GLASS_SHOP_LIMIT_INFO_S,proto:"GlassShopLimitInfoRsp"},{code:e.Code.GLASS_SHOP_LIMIT_BUY_C,proto:"GlassShopLimitBuyReq"},{code:e.Code.GLASS_SHOP_LIMIT_BUY_S,proto:"GlassShopLimitBuyRsp"},{code:e.Code.GLASS_SHOP_NOLIMIT_INFO_C,proto:"GlassShopNoLimitInfoReq"},{code:e.Code.GLASS_SHOP_NOLIMIT_INFO_S,proto:"GlassShopNoLimitInfoRsp"},{code:e.Code.GLASS_SHOP_NOLIMIT_BUY_C,proto:"GlassShopNoLimitBuyReq"},{code:e.Code.GLASS_SHOP_NOLIMIT_BUY_S,proto:"GlassShopNoLimitBuyRsp"},{code:e.Code.LEVEL_PACKAGE_INFO_C,proto:"HPLevelPackageInfoReq"},{code:e.Code.LEVEL_PACKAGE_INFO_S,proto:"HPLevelPackageInfoRsp"},{code:e.Code.DRAW_LEVEL_PACKAGE_C,proto:"HPLevelPackageDrawReq"},{code:e.Code.DRAW_LEVEL_PACKAGE_S,proto:"HPLevelPackageDrawRsp"},{code:e.Code.FUNCTION_OPEN_INFO_C,proto:"HPFunctionsOpenReq"},{code:e.Code.FUNCTION_OPEN_INFO_S,proto:"HPFunctionsOpenRsp"},{code:e.Code.FUNCTION_OPEN_AWARDS_C,proto:"HPFunctionsOpenAwardsReq"},{code:e.Code.FUNCTION_OPEN_AWARDS_S,proto:"HPFunctionsOpenAwardsRsp"},{code:e.Code.WANBA_INFO_C,proto:"WBInfoReq"},{code:e.Code.WANBA_INFO_S,proto:"WBInfoRsp"},{code:e.Code.WANBA_SHARE_IN_SUCC_C,proto:"WBShareInSuccessReq"},{code:e.Code.WANBA_SHARE_IN_SUCC_S,proto:"WBShareInSuccessRsp"},{code:e.Code.WANBA_AWARD_C,proto:"WBAwardReq"},{code:e.Code.WANBA_AWARD_S,proto:"WBAwardRsp"},{code:e.Code.WANBA_VIP_PACKAGE_C,proto:"HPWanBaVipAwardReq"},{code:e.Code.WANBA_VIP_PACKAGE_S,proto:"HPWanBaVipAwardRsp"},{code:e.Code.WANBA_VIP_DAY_AWARDS_C,proto:"HPWanBaVipDayReq"},{code:e.Code.WANBA_VIP_DAY_AWARDS_S,proto:"HPWanBaVipDayRsp"},{code:e.Code.WANBA_VIP_DAY_BUY_C,proto:"HPWanBaVipDayBuyReq"},{code:e.Code.WANBA_VIP_DAY_BUY_S,proto:"HPWanBaVipDayBuyRsp"},{code:e.Code.WANBA_VIP_PACKAGE_INFO_C,proto:"HPWanBanVipDayInfoReq"},{code:e.Code.WANBA_VIP_PACKAGE_INFO_S,proto:"HPWanBaVipDayInfoRsp"},{code:e.Code.DafuWeng_Info_C,proto:"HPZillionaireInfoReq"},{code:e.Code.DafuWeng_Info_S,proto:"HPZillionaireInfoRsp"},{code:e.Code.DafuWeng_Refresh_Times_C,proto:"HPZillionaireRefreshTimesReq"},{code:e.Code.DafuWeng_Refresh_Times_S,proto:"HPZillionaireRefreshTimesRsp"},{code:e.Code.DafuWeng_Rank_C,proto:"HPZillionaireRankReq"},{code:e.Code.DafuWeng_Rank_S,proto:"HPZillionaireRankRsp"},{code:e.Code.DafuWeng_Cast_C,proto:"HPZillionaireCastReq"},{code:e.Code.DafuWeng_Cast_S,proto:"HPZillionaireCastRsp"},{code:e.Code.DafuWeng_Award_C,proto:"HPZillionaireAwardReq"},{code:e.Code.DafuWeng_Award_S,proto:"HPZillionaireAwardRsp"},{code:e.Code.PRIVILEGE_CARD_INFO_C,proto:"PrivilegeCardInfoReq"},{code:e.Code.PRIVILEGE_CARD_INFO_S,proto:"PrivilegeCardInfoRsp"},{code:e.Code.PRIVILEGE_CARD_AWARD_C,proto:"PrivilegeCardAwardReq"},{code:e.Code.PRIVILEGE_CARD_AWARD_S,proto:"PrivilegeCardAwardRsp"},{code:e.Code.RECHARGE_REBATE_C,proto:"HPRechargeRebateRep"},{code:e.Code.RECHARGE_REBATE_S,proto:"HPRechargeRebateRsq"},{code:e.Code.ZERO_PACKATE_C,proto:"HPZeroPackageInfoRep"},{code:e.Code.ZERO_PACKATE_S,proto:"HPZeroPackageInfoRsq"},{code:e.Code.ZERO_PACKATE_BUY_C,proto:"HPZeroPackageBuyRep"},{code:e.Code.ZERO_PACKATE_BUY_S,proto:"HPZeroPackageBuyRsq"},{code:e.Code.WANBA_QQ_VIP_DAILY_GIFT_STATUS_C,proto:"WanBaQQVIPDailyGiftStatusReq"},{code:e.Code.WANBA_QQ_VIP_DAILY_GIFT_STATUS_S,proto:"WanBaQQVIPDailyGiftStatusRsp"},{code:e.Code.WANBA_QQ_VIP_DAILY_GIFT_AWARD_C,proto:"WanBaGetQQVIPDailyGiftReq"},{code:e.Code.WANBA_QQ_VIP_DAILY_GIFT_AWARD_S,proto:"WanBaGetQQVIPDailyGiftRsp"},{code:e.Code.LITMIT_TIMES_RECHARGE_C,proto:"HPLTFirstRechargeReq"},{code:e.Code.LITMIT_TIMES_RECHARGE_S,proto:"HPLTFirstRechargeRsp"},{code:e.Code.TREASURE_OF_ANCIENT_GOD_INFO_C,proto:"TreasureOfAncientGodInfoReq"},{code:e.Code.TREASURE_OF_ANCIENT_GOD_INFO_S,proto:"TreasureOfAncientGodInfoRsp"},{code:e.Code.OPEN_TREASURE_OF_ANCIENT_GOD_C,proto:"OpenTreasureOfAncientGodReq"},{code:e.Code.OPEN_TREASURE_OF_ANCIENT_GOD_S,proto:"OpenTreasureOfAncientGodRsp"},{code:e.Code.LITMIT_TIMES_RECHARGE_C,proto:"HPLTFirstRechargeReq"},{code:e.Code.LITMIT_TIMES_RECHARGE_S,proto:"HPLTFirstRechargeRsp"},{code:e.Code.GODHEAD_INFO_C,proto:"HPPlayerGodheadInfoReq"},{code:e.Code.GODHEAD_INFO_S,proto:"HPPlayerGodheadInfoRsp"},{code:e.Code.GODHEAD_ACTIVATE_UPGRAD_C,proto:"HPPlayerGodheadUpgradeReq"},{code:e.Code.GODHEAD_ACTIVATE_UPGRAD_S,proto:"HPPlayerGodheadUpgradeRsp"},{code:e.Code.GODHEAD_ACTIVATE_HIERON_C,proto:"HPGodheadHieronReq"},{code:e.Code.GODHEAD_ACTIVATE_HIERON_S,proto:"HPGodheadHieronRsp"},{code:e.Code.GET_XINYUE_PRIVILEGE_DAILY_GIFT_C,proto:"GetXinYuePrivilegeGiftReq"},{code:e.Code.GET_XINYUE_PRIVILEGE_DAILY_GIFT_S,proto:"GetXinYuePrivilegeGiftRsp"},{code:e.Code.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_C,proto:"XinYuePrivilegeGiftStatusReq"},{code:e.Code.XINYUE_PRIVILEGE_DAILY_GIFT_STATUS_S,proto:"XinYuePrivilegeGiftStatusRsp"},{code:e.Code.VESTIGES_OF_ANCIENT_GODS_INFO_C,proto:"VestigesOfAncientGodReq"},{code:e.Code.VESTIGES_OF_ANCIENT_GODS_INFO_S,proto:"VestigesOfAncientGodRsp"},{code:e.Code.EXPLORE_VESTIGES_OF_ANCIENT_GODS_C,proto:"ExploreVestigesReq"},{code:e.Code.EXPLORE_VESTIGES_OF_ANCIENT_GODS_S,proto:"ExploreVestigesRsp"},{code:e.Code.EXPLORE_VESTIGES_BEGIN_TIME_C,proto:"ExploreVestigesBeginTimeReq"},{code:e.Code.EXPLORE_VESTIGES_BEGIN_TIME_S,proto:"ExploreVestigesBeginTimeRsp"},{code:e.Code.CHAT_IDENTIFYING_CODE_C,proto:"ChatIdentifyingCodeC"},{code:e.Code.CHAT_IDENTIFYING_CODE_S,proto:"ChatIdentifyingCodeS"},{code:e.Code.ALCHEMY_ITME_C,proto:"HPAlchemyItmeReq"},{code:e.Code.ALCHEMY_ITME_S,proto:"HPAlchemyItmeRsp"},{code:e.Code.CAMP_INFO_C,proto:"CampInfoReq"},{code:e.Code.CAMP_INFO_S,proto:"CampInfoRsp"},{code:e.Code.CAMP_SIGN_UP_C,proto:"CampSignUpReq"},{code:e.Code.CAMP_SIGN_UP_S,proto:"CampSignUpRsp"},{code:e.Code.CAMP_ENTER_C,proto:"CampEnterBattleReq"},{code:e.Code.CAMP_ENTER_S,proto:"CampEnterBattleRsp"},{code:e.Code.CAMP_LOG_C,proto:"CampBattleLogReq"},{code:e.Code.CAMP_LOG_S,proto:"CampBattleLogRsp"},{code:e.Code.CAMP_OURS_C,proto:"CampOursInfoReq"},{code:e.Code.CAMP_OURS_S,proto:"CampOursInfoRsp"},{code:e.Code.CAMP_GARRISON_C,proto:"CampStrongPointGarrisonReq"},{code:e.Code.CAMP_GARRISON_S,proto:"CampStrongPointGarrisonRsp"},{code:e.Code.CAMP_CHALLENGE_C,proto:"CampChallengeEnemyReq"},{code:e.Code.CAMP_CHALLENGE_S,proto:"CampChallengeEnemyRsp"},{code:e.Code.CAMP_OPEN_TREASURE_C,proto:"CampOpenTreasureReq"},{code:e.Code.CAMP_OPEN_TREASURE_S,proto:"CampOpenTreasureRsp"},{code:e.Code.CAMP_BATTLE_ACHIEVEMENT_S,proto:"CampBattleAchievementInfoSYNC"},{code:e.Code.CAMP_STRONG_POINT_S,proto:"CampStrongPointInfoSYNC"},{code:e.Code.CAMP_BATTLE_RESULT_S,proto:"CampBattleResult"},{code:e.Code.CAMP_TREASURE_INFO_C,proto:"CampTreasureInfoReq"},{code:e.Code.CAMP_TREASURE_INFO_S,proto:"CampTreasureInfoRsp"},{code:e.Code.CAMP_LEAVE_C,proto:"CSCampLeaveReq"},{code:e.Code.CAMP_LEAVE_S,proto:"CSCampLeaveRsp"},{code:e.Code.WANBA_QLD_AD_C,proto:"WanBaAdReq"},{code:e.Code.WANBA_QLD_AD_S,proto:"WanBaAdRsp"},{code:e.Code.WANBA_QLD_AD_AWARD_C,proto:"WanBaAdAwardReq"},{code:e.Code.WANBA_QLD_AD_AWARD_S,proto:"WanBaAdAwardRsp"},{code:e.Code.WAN_BA_RECHARGE_INFO_C,proto:"HPAccRecharge2Info"},{code:e.Code.WAN_BA_RECHARGE_INFO_S,proto:"HPAccRecharge2InfoRet"},{code:e.Code.WAN_BA_RECHARGE_DRAW_C,proto:"HPGetAccRecharge2Award"},{code:e.Code.WAN_BA_RECHARGE_DRAW_S,proto:"HPGetAccRecharge2AwardRet"},{code:e.Code.WAN_BA_LOGIN_INF_C,proto:"HPAccLoginInfo"},{code:e.Code.WAN_BA_LOGIN_INF_S,proto:"HPAccLoginInfoRet"},{code:e.Code.WAN_BA_LOGIN_DRAW_C,proto:"HPAccLoginAwards"},{code:e.Code.WAN_BA_LOGIN_DRAW_S,proto:"HPAccLoginAwardsRet"},{code:e.Code.CS_SHARE_IN_SUCC_C,proto:"ShareInSuccReq"},{code:e.Code.CS_SHARE_IN_SUCC_S,proto:"ShareInSuccRsp"},{code:e.Code.CS_SHARE_INFO_C,proto:"ShareInfoReq"},{code:e.Code.CS_SHARE_INFO_S,proto:"ShareInfoRsp"},{code:e.Code.CS_GET_SHARE_AWARD_C,proto:"GetShareAwardReq"},{code:e.Code.CS_GET_SHARE_AWARD_S,proto:"GetShareAwardRsp"},{code:e.Code.CS_SHARE_CHANGE_S,proto:"ShareInfoSYNC"},{code:e.Code.FUNCTION_INIT_INFO_C,proto:"HPInitGroomReq"},{code:e.Code.FUNCTION_INIT_INFO_S,proto:"HPInitGroomRsp"},{code:e.Code.FUNCTION_INIT_STATUS_C,proto:"HPInitGroomStatusReq"},{code:e.Code.FUNCTION_INIT_STATUS_S,proto:"HPInitGroomStatusRsp"},{code:e.Code.QQ_BLUE_PRIVILEGE_INFO_C,proto:"QQBluePrivilegeInfoReq"},{code:e.Code.QQ_BLUE_PRIVILEGE_INFO_S,proto:"QQBluePrivilegeInfoRsp"},{code:e.Code.QQ_BLUE_PRIVILEGE_GIFT_C,proto:"GetQQBluePrivilegeGiftReq"},{code:e.Code.QQ_BLUE_PRIVILEGE_GIFT_S,proto:"GetQQBluePrivilegeGiftRsp"},{code:e.Code.QQ_HALL_PRIVILEGE_INFO_C,proto:"QQHallPrivilegeInfoReq"},{code:e.Code.QQ_HALL_PRIVILEGE_INFO_S,proto:"QQHallPrivilegeInfoRsp"},{code:e.Code.QQ_HALL_PRIVILEGE_GIFT_C,proto:"GetQQHallPrivilegeGiftReq"},{code:e.Code.QQ_HALL_PRIVILEGE_GIFT_S,proto:"GetQQHallPrivilegeGiftRsp"},{code:e.Code.JRTT_SHARE_INFO_C,proto:"JRTTShareInfoReq"},{code:e.Code.JRTT_SHARE_INFO_S,proto:"JRTTShareInfoRsp"},{code:e.Code.JRTT_SHARE_SUCC_C,proto:"JRTTShareSuccReq"},{code:e.Code.JRTT_SHARE_SUCC_S,proto:"JRTTShareSuccRsp"},{code:e.Code.JRTT_SHARE_AWARD_C,proto:"GetJRTTShareGiftReq"},{code:e.Code.JRTT_SHARE_AWARD_S,proto:"GetJRTTShareGiftRsp"},{code:e.Code.VISITOR_LIMIT_INFO_C,proto:"visitorLimitReq"},{code:e.Code.VISITOR_LIMIT_INFO_S,proto:"visitorLimitRsp"},{code:e.Code.add_LOGIN_TIMES_C,proto:"addLoginTimesReq"},{code:e.Code.add_LOGIN_TIMES_S,proto:"addLoginTimesRsp"},{code:e.Code.MOTH_ADD_MB_C,proto:"addMoneyReq"},{code:e.Code.MOTH_ADD_MB_S,proto:"addMoneyRsp"},{code:e.Code.OPEN_GAME_ZI_YUAN_C,proto:"OpenGameZiYuanReq"},{code:e.Code.OPEN_GAME_ZI_YUAN_S,proto:"OpenGameZiYuanRsp"},{code:e.Code.OPEM_GAME_ZI_YUAN_PULL_C,proto:"OpenGameZiYuanReq"},{code:e.Code.OPEN_GAME_ZI_YUAN_PULL_S,proto:"OpenGameZiYuanRsp"},{code:e.Code.ACHIEVEMENT_ONE_AWARD_C,proto:"GetAchievementOneWardReq"},{code:e.Code.ACHIEVEMENT_ONE_AWARD_S,proto:"GetAchievementOneWardRsp"},{code:e.Code.CS_RANK_PLAYER_INFO_C,proto:"HPCSRankInfoReq"},{code:e.Code.CS_RANK_PLAYER_INFO_S,proto:"HPCSRankInfoRsp"},{code:e.Code.CHANNEL_CRETIFICATION_AWARDS_C,proto:"HPChannelCretificatioAwardsReq"},{code:e.Code.CHANNEL_CRETIFICATION_AWARDS_S,proto:"HPChannelCretificatioAwardsRsp"},{code:e.Code.ITEM_LIMTI_GIFT_GET_C,proto:"HPItemLimitGiftGetReq"},{code:e.Code.ITEM_LIMIT_GIFT_GET_S,proto:"HPItemLimitGiftGetRsp"},{code:e.Code.GET_SERVER_DATETIME_C,proto:"HPDetServerDateTimeReq"},{code:e.Code.GET_SERVER_DATETIME_S,proto:"HPDetServerDateTimeRsp"},{code:e.Code.ROLE_LIMIT_TIME_GIFT_C,proto:"HPRoleLimitGiftReq"},{code:e.Code.ROLE_LIMIT_TIME_GIFT_S,proto:"HPRoleLimitGiftRsp"},{code:e.Code.GET_ROLE_LIMIT_TIME_GIFT_C,proto:"HPGetRoleLimitGiftReq"},{code:e.Code.GET_ROLE_LIMIT_TIME_GIFT_S,proto:"HPGetRoleLimitGiftRsp"},{code:e.Code.ALON_DAILY_RECHARGE_C,proto:"DailyAccRechargeInfoReq"},{code:e.Code.ALON_DAILY_RECHARGE_S,proto:"DailyAccRechargeInfoRsp"},{code:e.Code.GET_ALON_DAILY_RECHARGE_C,proto:"GetDailyAccRechargeAwardReq"},{code:e.Code.GET_ALON_DAILY_RECHARGE_S,proto:"GetDailyAccRechargeAwardRsp"},{code:e.Code.RED_RECHARGE_ITEM_C,proto:"HPRedRechargeItemReq"},{code:e.Code.RED_RECHARGE_ITEM_S,proto:"HPRedRechargeItemRsp"},{code:e.Code.REBATE_RED_PACK_C,proto:"HPRebateRechargeReq"},{code:e.Code.REBATE_RED_PACK_S,proto:"HPRebateRechargeRsp"}],t
}();e.ProtoConfig=t,__reflect(t.prototype,"foxgame.ProtoConfig")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(){function t(){}return t.randomNegetive=function(){var e=1,t=Math.random();return.5>t&&(e=-1),e},t.getMoveData=function(t,i,n,o){void 0===n&&(n=0),void 0===o&&(o=8);var a,s,r,l,h,c,u=t.x-i.x,p=t.y-i.y;h=Math.sqrt(u*u+p*p),a=Math.atan2(p,u),0!=n&&(r=n*Math.cos(a),l=n*Math.sin(a)),s=180*a/Math.PI;var g=Math.round(s/(360/o));return 0>g&&(g=Math.abs(g+o)),new e.MoveDataEntity(h,g,c,n,r,l,s)},t.MSG_TIP=function(t){e.PopUpController.getInstance().showFloatTextPanel1(t)},t.getHtml=function(e,t,i,n,o){void 0===i&&(i=12),void 0===n&&(n=0),void 0===o&&(o=!1);var a=e;return o&&(a="<u>"+e+"</u>"),a="<font color='#"+t.toString(16)+"' size='"+i.toString()+"'>"+a+"</font>",n>0&&(a="<textformat leading='"+n.toString()+"'>"+a+"</textformat>"),a},t.replaceContents=function(e,t){for(var i,n,o=[],a=e.length,s=0,r=0;a>r;r++)for(n={text:e[r].text},e[r].hasOwnProperty("style")&&(n.style=e[r].style),o.push(n),i="#v"+(s+1).toString()+"#";n.text.indexOf(i)>-1;)n.text=n.text.replace(i,t[s].toString()),s++,i="#v"+(s+1).toString()+"#";return o},t.replaceConfigContents=function(t,i,n){var o=e.DataManager.instance.getData(t);if(o){var a=o[i];if(a)return this.replaceContents(a,n)}return null},t.createTextField=function(e,t,i,n,o,a,s,r){void 0===e&&(e=""),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=16777215),void 0===o&&(o=26),void 0===a&&(a=!1),void 0===s&&(s=egret.HorizontalAlign.LEFT),void 0===r&&(r=!1);var l=new egret.TextField;return l.text=e,l.type=r?egret.TextFieldType.INPUT:egret.TextFieldType.DYNAMIC,l.touchEnabled=r,t&&(l.width=t),i&&(l.height=i),l.size=o,l.textAlign=s,l.textColor=n,l.bold=a,l},t.numberToString=function(e,t){void 0===t&&(t=1);var i;if(e=Math.floor(e*Math.pow(10,t))/Math.pow(10,t),i=e.toString(),-1==i.indexOf(".")){i+=".";for(var n=0;t>n;n++)i+="0"}return i},t.getScript=function(e,t){var i=document.createElement("script");i.readyState?i.onreadystatechange=function(){("loaded"==this.readyState||"complete"==this.readyState)&&(t&&t(),i=null)}:i.onload=function(){t&&t(),i=null},i.setAttribute("type","text/javascript"),i.setAttribute("src",e),i.setAttribute("async","true"),i.setAttribute("charset","utf-8"),document.getElementsByTagName("head")[0].appendChild(i)},t.httpReqs=function(e,t,i,n,o){var a=this;if(window.egret_quickgame){var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,s.open(e+t,egret.HttpMethod.GET),s.send(),s.addEventListener(egret.Event.COMPLETE,function(e){i.call(a,e.currentTarget.response)},this),s.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){n.call(a,e.currentTarget.response)},this)}else{var r={url:e,dataType:"jsonp",timeout:5e3,type:"GET"};o&&(r.dataType=o),t&&(r.data=t),i&&(r.success=i),n&&(r.error=n),$.ajax(r)}},t.httpSend=function(e,t){if("qqgame"==window.GJlenged_chanel){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),i.send(t),i.once(egret.Event.COMPLETE,function(e){var t=e.currentTarget,i=JSON.parse(t.response);console.log("上报数据成功:"+i.status),0!=i.status&&console.log("上报数据失败:"+i)},this),i.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("io error"),console.log(e)},this)}},t.httpWanba=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),i.send(t),i.once(egret.Event.COMPLETE,function(e){var t=e.currentTarget,i=JSON.parse(t.response);console.log("上报数据成功:"+i.status),0!=i.status&&console.log("上报数据失败:"+i)},this),i.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("io error"),console.log(e)},this)},t.httpReqsajax=function(t,i,n,o,a){var s=this;if(window.egret_quickgame){var r=new egret.HttpRequest;r.setRequestHeader("Content-Type","application/json"),r.responseType=egret.HttpResponseType.TEXT,r.open(t+i,egret.HttpMethod.GET),r.send(),r.addEventListener(egret.Event.COMPLETE,function(t){n.call(s,e.Global.setReqJsonP(t.currentTarget.response))},this),r.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){o.call(s,e.currentTarget.response)},this)}else{var l={url:t,dataType:"jsonp",timeout:5e3,type:"GET"};a&&(l.dataType=a),i&&(l.data=i),n&&(l.success=n),o&&(l.error=o),$.ajax(l)}},t.generateRandomUUID=function(e,t){var i,n="",o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||o.length,e)for(i=0;e>i;i++)a[i]=o[0|Math.random()*t];else{var s=void 0;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",i=0;36>i;i++)a[i]||(s=0|16*Math.random(),a[i]=o[19==i?3&s|8:s])}return n=a.join("")},t.getBrowserDeviceUUID=function(){var e="foxUUID";if(isLocalStorage()){var i=egret.localStorage,n=i.getItem(e);return n?n:(n=t.generateRandomUUID(null,null),i.setItem(e,n),n)}},t.formatBrowserDeviceSystemInfo=function(){var t="",i="";i="mfxyxmgame"==window.GJlenged_chanel||"mrbjxmgame"==window.GJlenged_chanel?"kyx":navigator.appCodeName;var n=egret.Capabilities.os;n="Android"==egret.Capabilities.os?"android":"iOS"==egret.Capabilities.os?"ios":egret.Capabilities.runtimeType==egret.RuntimeType.WEB?"webos":egret.Capabilities.isMobile?"mobile":"pc",null!=e.LoginController.instance.getmodel()&&(e.LoginModel.devicePlatformStr=n);var o=null;o||(o=n);var a="ssystemname";egret.Capabilities.isMobile&&(a="isMobile");var s="";if(window.egret_quickgame?s="h5-"+getchannel():egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME?s="wxPlayer":egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(s="h5-"+getchannel(),"wanba_ts"==checkPlatformStr()&&(s="h5-"+checkPlatformStr(),"H5.QZONE.PC"==e.UserInfo.platform.via&&(s="h5-qqgame"))),window.clientSysInfo&&(n=window.clientSysInfo.platform,o=window.clientSysInfo.system,i=window.clientSysInfo.model,a="wx"+window.clientSysInfo.version+"_"+window.clientSysInfo.SDKVersion),-1!=checkPlatformStr().indexOf("qqgame")||-1!=checkPlatformStr().indexOf("mfsqgame")||-1!=checkPlatformStr().indexOf("mrbjqqgame")){var r=getlaunchOptionsQQ().scene;t=i+"#"+n+"#"+o+"#"+a+"#"+s+"#"+r}else t=i+"#"+n+"#"+o+"#"+a+"#"+s+"#"+e.UserInfo.platform.via;if(e.Global.isWeChatXiaoChengXuBranch&&window.wx){var l=window.wx.getLaunchOptionsSync();l.query&&Object.keys(l.query).length>0&&(t+="#query="+JSON.stringify(l.query)),l.referrerInfo&&Object.keys(l.query).length>0&&(t+="#referrerInfo="+JSON.stringify(l.referrerInfo))}return console.log("传送id！！！！！ "+t),t},t}();e.GameUtils=t,__reflect(t.prototype,"foxgame.GameUtils")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){var e=t.call(this,"resource/skins/receiveAwardItem/ReceiveAwardItemani.exml")||this;return e.itemAry=[],e.layer=LayerType.TOPLAYER,e.isCenter=!1,e.isMask=!1,e}return __extends(i,t),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.addItem=function(t,i,n,o){void 0===i&&(i=1),void 0===o&&(o=!0),this.show(),this.x=0,this.y=0;var a=new e.receiveAwardItem(t,i,n,o),s=a.getItemPos();a.x=s.x,a.y=s.y,this.ui.addChild(a),this.itemAry.push(a),this.dispose(a)},i.prototype.dispose=function(t){var i=egret.Tween.get(t),n=e.MainBottomControler.instance.bagPosition,o=this;new egret.Point(0,t.y-30);i.to({x:n.x,y:n.y},800,egret.Ease.sineIn).call(function(){t.visible=!1,t.destory,o.itemAry.shift(),0==o.itemAry.length&&o.close()},t)},i}(e.BasePanel);e.receiveAwardAni=t,__reflect(t.prototype,"foxgame.receiveAwardAni")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(e,i,n,o,a){void 0===i&&(i=1),void 0===o&&(o=!0),void 0===a&&(a=!0);var s=t.call(this)||this;return s.itemId=e,s.position=n,s.count=i,s.isShowName=o,s.skinName="receiveAwardItem",s}return __extends(i,t),i.prototype.getItemPos=function(){return this.position},i.prototype.destory=function(){this.parent.removeChild(this),this.removeEventListener},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var i=e.JsonDataManager.instance.itemTemplate,n=i[this.itemId];this.itemSprite.source=n.icon,this.numText.text=e.GlobalUtil.getUnitString(this.count),this.isShowName?this.itemName.text=n.name:this.itemName.visible=!1},i}(eui.Component);e.receiveAwardItem=t,__reflect(t.prototype,"foxgame.receiveAwardItem")}(foxgame||(foxgame={}));var foxgame;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.GoodsItemList=function(e,t,i,n,o,a,s,r){void 0===e&&(e=2),void 0===t&&(t=2),void 0===i&&(i=6),void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s="72,72"),void 0===r&&(r=!0),this.cells=[],this.rowSpace=e,this.colSpace=t,this.rowLen=i,this.size=s,this.showNum=o},i.prototype.createItmes=function(t,i){void 0===i&&(i="ItemIconSkin"),this.itemList=t,this.clear();for(var n=0;n<t.length;n++){var o=t[n],a=o.key,s=o.value,r=new e.ItemIcon;r.skinName=i,r&&(r.setItem(Number(a),s,!0),this.cells.push(r),this.addChild(r),r.x=n*r.width+this.rowSpace,r.y=0)}},i.prototype.clear=function(){for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.clear(),this.removeChild(t)}this.cells=[]},i}(eui.Component);e.GoodsItemList=t,__reflect(t.prototype,"foxgame.GoodsItemList")}(foxgame||(foxgame={}));var foxgame;!function(e){var t;!function(e){e[e.FUNC_MOST_MAINLY=0]="FUNC_MOST_MAINLY",e[e.FUNC_NOBILITY=1]="FUNC_NOBILITY",e[e.FUNC_SKILL=2]="FUNC_SKILL",e[e.FUNC_LOGIN_AWARD=3]="FUNC_LOGIN_AWARD",e[e.FUNC_SIGN_AWARD=4]="FUNC_SIGN_AWARD",e[e.FUNC_DAILY_TASK=5]="FUNC_DAILY_TASK",e[e.FUNC_LEGEDARY_EMPIRE=6]="FUNC_LEGEDARY_EMPIRE",e[e.FUNC_PRISONER=7]="FUNC_PRISONER",e[e.FASHION_RED_DOT=8]="FASHION_RED_DOT",e[e.Func_YuanBao_Change=20]="Func_YuanBao_Change",e[e.Func_TongQian_Change=21]="Func_TongQian_Change",e[e.Func_FightValue_Change=22]="Func_FightValue_Change",e[e.Func_ExpValue_Change=23]="Func_ExpValue_Change",e[e.Func_State_Info_Change=28]="Func_State_Info_Change",e[e.Func_Player_Attr_Change=29]="Func_Player_Attr_Change",e[e.Func_Role_Attr_Change=30]="Func_Role_Attr_Change",e[e.Func_Role_Equip_Change=31]="Func_Role_Equip_Change",e[e.Func_Bag_Item_Change=40]="Func_Bag_Item_Change",e[e.Func_Bag_Equip_Change=41]="Func_Bag_Equip_Change",e[e.Func_Bag_DragonBone_Change=42]="Func_Bag_DragonBone_Change",e[e.Func_Bag_DragonArm_Change=43]="Func_Bag_DragonArm_Change",e[e.Func_Bag_Beauty_Equip_Change=44]="Func_Bag_Beauty_Equip_Change"}(t=e.RedPointId||(e.RedPointId={}));var i=function(){function i(){}return i.prototype.recvMsg=function(t,i){switch(t){case e.Code.RED_POINT_SYNC_S:this.showRedPoint(i)}},i.prototype.showRedPoint=function(n){this.data=n,e.MainBottomControler.instance.setJueWeiRedImgVisble(i.getInstance().getOperateByType(t.FUNC_NOBILITY)),e.WanFaController.getInstance().refreshRedImg(),e.WealPanelController.getInstance().update()},i.prototype.getOperateByType=function(e){if(void 0==this.data)return!1;for(var t,i=this.data.getRedPoint(),n=i.length,o=0;n>o;o++)if(t=i[o],t.getFunctionalId()==e)return 1==t.getShow();return!1},i.prototype.setOperateByType=function(e,t){if(void 0!=this.data)for(var i,n=this.data.getRedPoint(),o=n.length,a=0;o>a;a++)if(i=n[a],i.getFunctionalId()==e)return i.setShow(t)},i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i}();e.RedPointController=i,__reflect(i.prototype,"foxgame.RedPointController",["foxgame.IMessage"])}(foxgame||(foxgame={}));var MD5=function(){function e(){this.hexcase=0,this.b64pad=""}return e.prototype.hex_md5=function(e){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(e)))},e.prototype.b64_md5=function(e){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(e)))},e.prototype.any_md5=function(e,t){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(e)),t)},e.prototype.hex_hmac_md5=function(e,t){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.prototype.b64_hmac_md5=function(e,t){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.prototype.any_hmac_md5=function(e,t,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)),i)},e.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},e.prototype.rstr_md5=function(e){return this.binl2rstr(this.binl_md5(this.rstr2binl(e),8*e.length))},e.prototype.rstr_hmac_md5=function(e,t){var i=this.rstr2binl(e);i.length>16&&(i=this.binl_md5(i,8*e.length));for(var n=Array(16),o=Array(16),a=0;16>a;a++)n[a]=909522486^i[a],o[a]=1549556828^i[a];var s=this.binl_md5(n.concat(this.rstr2binl(t)),512+8*t.length);return this.binl2rstr(this.binl_md5(o.concat(s),640))},e.prototype.rstr2hex=function(e){try{this.hexcase}catch(t){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",o="",a=0;a<e.length;a++)i=e.charCodeAt(a),o+=n.charAt(i>>>4&15)+n.charAt(15&i);return o},e.prototype.rstr2b64=function(e){try{this.b64pad}catch(t){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",o=e.length,a=0;o>a;a+=3)for(var s=e.charCodeAt(a)<<16|(o>a+1?e.charCodeAt(a+1)<<8:0)|(o>a+2?e.charCodeAt(a+2):0),r=0;4>r;r++)n+=8*a+6*r>8*e.length?this.b64pad:i.charAt(s>>>6*(3-r)&63);return n},e.prototype.rstr2any=function(e,t){var i,n,o,a,s,r=t.length,l=Array(Math.ceil(e.length/2));for(i=0;i<l.length;i++)l[i]=e.charCodeAt(2*i)<<8|e.charCodeAt(2*i+1);var h=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),c=Array(h);for(n=0;h>n;n++){for(s=Array(),a=0,i=0;i<l.length;i++)a=(a<<16)+l[i],o=Math.floor(a/r),a-=o*r,(s.length>0||o>0)&&(s[s.length]=o);c[n]=a,l=s}var u="";for(i=c.length-1;i>=0;i--)u+=t.charAt(c[i]);return u},e.prototype.str2rstr_utf8=function(e){for(var t,i,n="",o=-1;++o<e.length;)t=e.charCodeAt(o),i=o+1<e.length?e.charCodeAt(o+1):0,t>=55296&&56319>=t&&i>=56320&&57343>=i&&(t=65536+((1023&t)<<10)+(1023&i),o++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n},e.prototype.str2rstr_utf16le=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i),e.charCodeAt(i)>>>8&255);return t},e.prototype.str2rstr_utf16be=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e.charCodeAt(i)>>>8&255,255&e.charCodeAt(i));return t},e.prototype.rstr2binl=function(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t},e.prototype.binl2rstr=function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t},e.prototype.binl_md5=function(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var i=1732584193,n=-271733879,o=-1732584194,a=271733878,s=0;s<e.length;s+=16){var r=i,l=n,h=o,c=a;i=this.md5_ff(i,n,o,a,e[s+0],7,-680876936),a=this.md5_ff(a,i,n,o,e[s+1],12,-389564586),o=this.md5_ff(o,a,i,n,e[s+2],17,606105819),n=this.md5_ff(n,o,a,i,e[s+3],22,-1044525330),i=this.md5_ff(i,n,o,a,e[s+4],7,-176418897),a=this.md5_ff(a,i,n,o,e[s+5],12,1200080426),o=this.md5_ff(o,a,i,n,e[s+6],17,-1473231341),n=this.md5_ff(n,o,a,i,e[s+7],22,-45705983),i=this.md5_ff(i,n,o,a,e[s+8],7,1770035416),a=this.md5_ff(a,i,n,o,e[s+9],12,-1958414417),o=this.md5_ff(o,a,i,n,e[s+10],17,-42063),n=this.md5_ff(n,o,a,i,e[s+11],22,-1990404162),i=this.md5_ff(i,n,o,a,e[s+12],7,1804603682),a=this.md5_ff(a,i,n,o,e[s+13],12,-40341101),o=this.md5_ff(o,a,i,n,e[s+14],17,-1502002290),n=this.md5_ff(n,o,a,i,e[s+15],22,1236535329),i=this.md5_gg(i,n,o,a,e[s+1],5,-165796510),a=this.md5_gg(a,i,n,o,e[s+6],9,-1069501632),o=this.md5_gg(o,a,i,n,e[s+11],14,643717713),n=this.md5_gg(n,o,a,i,e[s+0],20,-373897302),i=this.md5_gg(i,n,o,a,e[s+5],5,-701558691),a=this.md5_gg(a,i,n,o,e[s+10],9,38016083),o=this.md5_gg(o,a,i,n,e[s+15],14,-660478335),n=this.md5_gg(n,o,a,i,e[s+4],20,-405537848),i=this.md5_gg(i,n,o,a,e[s+9],5,568446438),a=this.md5_gg(a,i,n,o,e[s+14],9,-1019803690),o=this.md5_gg(o,a,i,n,e[s+3],14,-187363961),n=this.md5_gg(n,o,a,i,e[s+8],20,1163531501),i=this.md5_gg(i,n,o,a,e[s+13],5,-1444681467),a=this.md5_gg(a,i,n,o,e[s+2],9,-51403784),o=this.md5_gg(o,a,i,n,e[s+7],14,1735328473),n=this.md5_gg(n,o,a,i,e[s+12],20,-1926607734),i=this.md5_hh(i,n,o,a,e[s+5],4,-378558),a=this.md5_hh(a,i,n,o,e[s+8],11,-2022574463),o=this.md5_hh(o,a,i,n,e[s+11],16,1839030562),n=this.md5_hh(n,o,a,i,e[s+14],23,-35309556),i=this.md5_hh(i,n,o,a,e[s+1],4,-1530992060),a=this.md5_hh(a,i,n,o,e[s+4],11,1272893353),o=this.md5_hh(o,a,i,n,e[s+7],16,-155497632),n=this.md5_hh(n,o,a,i,e[s+10],23,-1094730640),i=this.md5_hh(i,n,o,a,e[s+13],4,681279174),a=this.md5_hh(a,i,n,o,e[s+0],11,-358537222),o=this.md5_hh(o,a,i,n,e[s+3],16,-722521979),n=this.md5_hh(n,o,a,i,e[s+6],23,76029189),i=this.md5_hh(i,n,o,a,e[s+9],4,-640364487),a=this.md5_hh(a,i,n,o,e[s+12],11,-421815835),o=this.md5_hh(o,a,i,n,e[s+15],16,530742520),n=this.md5_hh(n,o,a,i,e[s+2],23,-995338651),i=this.md5_ii(i,n,o,a,e[s+0],6,-198630844),a=this.md5_ii(a,i,n,o,e[s+7],10,1126891415),o=this.md5_ii(o,a,i,n,e[s+14],15,-1416354905),n=this.md5_ii(n,o,a,i,e[s+5],21,-57434055),i=this.md5_ii(i,n,o,a,e[s+12],6,1700485571),a=this.md5_ii(a,i,n,o,e[s+3],10,-1894986606),o=this.md5_ii(o,a,i,n,e[s+10],15,-1051523),n=this.md5_ii(n,o,a,i,e[s+1],21,-2054922799),i=this.md5_ii(i,n,o,a,e[s+8],6,1873313359),a=this.md5_ii(a,i,n,o,e[s+15],10,-30611744),o=this.md5_ii(o,a,i,n,e[s+6],15,-1560198380),n=this.md5_ii(n,o,a,i,e[s+13],21,1309151649),i=this.md5_ii(i,n,o,a,e[s+4],6,-145523070),a=this.md5_ii(a,i,n,o,e[s+11],10,-1120210379),o=this.md5_ii(o,a,i,n,e[s+2],15,718787259),n=this.md5_ii(n,o,a,i,e[s+9],21,-343485551),i=this.safe_add(i,r),n=this.safe_add(n,l),o=this.safe_add(o,h),a=this.safe_add(a,c)}return[i,n,o,a]},e.prototype.md5_cmn=function(e,t,i,n,o,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(n,a)),o),i)},e.prototype.md5_ff=function(e,t,i,n,o,a,s){return this.md5_cmn(t&i|~t&n,e,t,o,a,s)},e.prototype.md5_gg=function(e,t,i,n,o,a,s){return this.md5_cmn(t&n|i&~n,e,t,o,a,s)},e.prototype.md5_hh=function(e,t,i,n,o,a,s){return this.md5_cmn(t^i^n,e,t,o,a,s)},e.prototype.md5_ii=function(e,t,i,n,o,a,s){return this.md5_cmn(i^(t|~n),e,t,o,a,s)},e.prototype.safe_add=function(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i},e.prototype.bit_rol=function(e,t){return e<<t|e>>>32-t},e}();__reflect(MD5.prototype,"MD5");var MessageCode=function(){function e(){}return e.REFRESH_COIN="refreshCoin",e.REFRESH_GOLD="refreshGold",e}();__reflect(MessageCode.prototype,"MessageCode");var foxgame;!function(e){var t=function(){function t(){}return t.battleMapPosToWorldPos=function(e,t,i){var n,o=egret.Point.distance(t,e);n=t.x-e.x==0?Math.PI/2:Math.atan((t.y-e.y)/(t.x-e.x));var a;a=0==i.x?Math.PI/2:Math.atan(5*i.y/i.x),t.x>e.x?t.y>e.y||(n+=2*Math.PI):n+=t.y>e.y?Math.PI:Math.PI;var s=o/100*Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),r=s*Math.cos(n+a),l=s*Math.sin(n+a),h=egret.Point.polar(s,n+a);h.x=e.x+h.x,h.y=e.y+h.y;var c=new egret.Point(e.x+r,e.y+l);return c},t.worldPosToBattleMapPos=function(e,i,n){var o=egret.Point.distance(i,e),a=t.getAnagle(new egret.Point(i.x-e.x,i.y-e.y)),s=egret.Point.distance(n,e),r=t.getAnagle(new egret.Point(n.x-e.x,n.y-e.y)),l=r-a,h=s/o*100,c=h*Math.cos(l),u=h*Math.sin(l);return new egret.Point(c,u)},t.getAnagle=function(e){return 0==e.x&&e.y>0?.5*Math.PI:0==e.x&&e.y<0?1.5*Math.PI:e.x>0&&e.y>=0?Math.atan(Math.abs(e.y/e.x)):e.x<0&&e.y>=0?Math.atan(Math.abs(e.x/e.y))+.5*Math.PI:e.x>0&&e.y<0?Math.atan(Math.abs(e.y/e.x))+1.5*Math.PI:e.x<0&&e.y<0?Math.atan(Math.abs(e.x/e.y))+Math.PI:0},t.moveTime=function(e,t){var i=egret.Point.distance(e,t);return i/40*1e3*.8},t.moveDirection=function(t,i,n){void 0===n&&(n=null);var o=Math.atan2(i.y-t.y,i.x-t.x),a=180*o/Math.PI;return t.y==i.y&&t.x==i.x?null==n?e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT:n:20>=a&&a>=-20?e.EnumManager.DIRECTION_ENUM.DIR_RIGHT:110>=a&&a>=70?e.EnumManager.DIRECTION_ENUM.DIR_DOWN:-160>=a||a>=160?e.EnumManager.DIRECTION_ENUM.DIR_LEFT:-70>=a&&a>=-110?e.EnumManager.DIRECTION_ENUM.DIR_UP:70>a&&a>20?e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT:160>a&&a>110?e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT:-110>a&&a>-160?e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT:-20>a&&a>-70?e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT:e.EnumManager.DIRECTION_ENUM.DIR_DOWN},t.calculateRotation=function(e,t){var i=t.x-e.x,n=t.y-e.y;if(0==i)return n>0?270:90;var o=Math.atan(n/i),a=180*o/Math.PI;return a},t.fixEffectPosition=function(t,i,n,o,a,s,r){void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===r&&(r=!1);null!=e.MainSceneManager.instance.skillTestPosX&&(a=e.MainSceneManager.instance.skillTestPosX),null!=e.MainSceneManager.instance.skillTestPosY&&(s=e.MainSceneManager.instance.skillTestPosY),null!=e.MainSceneManager.instance.skillTestPosition&&0!=e.MainSceneManager.instance.skillTestPosition&&(n=e.MainSceneManager.instance.skillTestPosition);var l=(t.x,t.y,1),h=1,c=1;if(i instanceof e.ActorInScene_Base?(l=i.bodyClip.y*i.scaleY,h=i.bodyClip.getBounds().height*i.scaleY,c=i.bodyClip.getBounds().width*i.scaleX):i instanceof e.People&&(l=i.mChest.y*i.scaleY,h=i.mChest.getBounds().height*i.scaleY,c=i.mChest.getBounds().width*i.scaleX),null==n)return t;if(n==e.BodyPosition.Feet)return t.y+=l,t.y+=s,t;if(n==e.BodyPosition.Body)return t.y+=l,t.y-=h/2,t.y+=s,o==e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_RIGHT?t.x-=a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN||(o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP),t;if(n==e.BodyPosition.Head)return t.y+=l,t.y-=h,t.y+=s,o==e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_RIGHT?t.x-=a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN||(o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP),t;if(n==e.BodyPosition.BodyFront)return t.y+=l,t.y-=h/2,o=o||e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,t.y+=s,o==e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT?(t.x-=c,t.x-=.5*a):o==e.EnumManager.DIRECTION_ENUM.DIR_RIGHT?(t.x-=.5*c,t.x-=a):o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT?(t.x-=.5*c,t.x-=.5*a):o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN||(o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT?(t.x+=.5*c,t.x+=.5*a):o==e.EnumManager.DIRECTION_ENUM.DIR_LEFT?(t.x+=c,t.x+=.5*a):o==e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT?(t.x+=.5*c,t.x+=.5*a):o==e.EnumManager.DIRECTION_ENUM.DIR_UP),t;if(n==e.BodyPosition.FeetFront)o=o||e.EnumManager.DIRECTION_ENUM.DIR_RIGHT,e.ActionDefine.instance.DirectionFip.get(o)==o?t.x+=50*i.scaleX:t.x-=50*i.scaleX,t.y+=s,o==e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_RIGHT?t.x-=a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN||(o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP);else if(n==e.BodyPosition.BodyAside)return t.y+=l+48*i.scaleY,(o==e.EnumManager.DIRECTION_ENUM.DIR_UP||o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN)&&(t.x+=4*i.scaleX),t.y+=s,o==e.EnumManager.DIRECTION_ENUM.DIR_UP_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_RIGHT?t.x-=a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_RIGHT?t.x-=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN||(o==e.EnumManager.DIRECTION_ENUM.DIR_DOWN_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP_LEFT?t.x+=.5*a:o==e.EnumManager.DIRECTION_ENUM.DIR_UP),t;return t},t.convertServerBattlePosToClient45=function(i,n,o){if(null==o)return new egret.Point(i,n);t.XYPoint.normalize(1);var a=t.XYPoint,s=.65*Math.sqrt(e.Global.designWidth*e.Global.designWidth+e.Global.designHeight*e.Global.designHeight),r=n/t.BattleYMax*70+15,l=i/t.BattleXMax*(s-480)+240,h=l-240;h=0>h?0:h,l=0>h?l:240;var c=Math.tan(r*Math.PI/180),u=l/(c+1),p=c*l/(c+1);return u+=a.x*h,p+=a.y*h,p=-1*p,new egret.Point(u,p)},t.BattleAwardToFlyTextArray=function(t,i){var n=e.JsonDataManager.instance.itemTemplate;if(t&&i){if(t.getCoin()>0){var o=t.getCoin();if(t.getDrop())for(var a=t.getDrop().getItem().length,s=0;a>s;s++)1002==t.getDrop().getItem()[s].getItemId()&&(o+=t.getDrop().getItem()[s].getItemCount());i.push({text:"+金币："+o,color:e.qualityColor.ORANGE})}if(t.getExp()>0&&i.push({text:"+经验："+t.getExp(),color:e.qualityColor.GREEN}),t.getCourageValue()&&t.getCourageValue()>0&&i.push({text:"+勇气值："+t.getCourageValue(),color:e.qualityColor.PURPLE}),t.getFightScoreValue()&&t.getFightScoreValue()>0&&i.push({text:"+战功值："+t.getFightScoreValue(),color:e.qualityColor.PURPLE}),null!=t.getDrop()){for(var r=t.getDrop(),l=e.JsonDataManager.instance.equipTemplate,s=0;s<r.getDetailEquip().length;s++){var h=r.getDetailEquip()[s];if(null!=h&&h.getPickup()){var c=l[h.getItemId()];null!=c&&i.push({text:"+Lv"+c.level+c.name+"x1",color:e.ColorUtils.instance.getColorByQuality(c.quality)})}}for(var s=0;s<r.getItem().length;s++){var u=r.getItem()[s],p=n[u.getItemId()];null!=p&&i.push({text:"+"+p.name+"x"+u.getItemCount(),color:e.ColorUtils.instance.getColorByQuality(p.quality)})}for(var s=0;s<r.getDetailElement().length;s++);for(var s=0;s<r.getTreasure().length;s++){var g=r.getTreasure()[s],p=n[g.getItemId()];null!=p&&i.push({text:"+"+p.name+"x1",color:e.ColorUtils.instance.getColorByQuality(p.quality)})}}}},t.BattleXMax=100,t.BattleYMax=20,t.XYPoint=new egret.Point(1,1),t.CoinDropPng=[{coin:5e3,png:"UI/MainScene/UI/drop_money_1000.png"},{coin:4e3,png:"UI/MainScene/UI/drop_money_1000.png"},{coin:3e3,png:"UI/MainScene/UI/drop_money_1000.png"},{coin:2e3,png:"UI/MainScene/UI/drop_money_1000.png"},{coin:1e3,png:"UI/MainScene/UI/drop_money_1000.png"},{coin:500,png:"UI/MainScene/UI/drop_money_100.png"},{coin:100,png:"UI/MainScene/UI/drop_money_100.png"},{coin:50,png:"UI/MainScene/UI/drop_money_10.png"},{coin:10,png:"UI/MainScene/UI/drop_money_10.png"}],t.SkillBookIcon="UI/Battle/skill_book_icon.png",t.UnitMoveTime=100,t.oldArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t.grayArray=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],t.redArray=[1,0,0,0,100,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],t.greenArray=[1,0,0,0,0,0,2,0,0,0,0,0,1,0,0,0,0,0,1,0],t.whiteArray=[1,0,0,0,100,0,1,0,0,100,0,0,1,0,100,0,0,0,1,100],t}();e.NewBattleUtility=t,__reflect(t.prototype,"foxgame.NewBattleUtility")}(foxgame||(foxgame={}));var SpecialNumber=function(e){function t(t){var i=e.call(this)||this;return i._preName=t,i}return __extends(t,e),t.prototype.setValue=function(e){if(""!=e&&null!=e){this.removeChildren();for(var t=(e+"").split(""),i=t.length,n=0,o=0;i>o;o++){var a=t[o],s=new eui.Image;s.source=this._preName+a+"_png",s.x=n,this.addChild(s),n+=s.width}}},t}(egret.Sprite);__reflect(SpecialNumber.prototype,"SpecialNumber");var CountUp=function(e,t,i,n,o,a){for(var s=0,r=["webkit","moz","ms","o"],l=0;l<r.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[r[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[l]+"CancelAnimationFrame"]||window[r[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),i=Math.max(0,16-(t-s)),n=window.setTimeout(function(){e(t+i)},i);return s=t+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var h=this;h.options={useEasing:!0,useGrouping:!0,separator:",",decimal:".",easingFn:null,formattingFn:null};for(var c in a)a.hasOwnProperty(c)&&(h.options[c]=a[c]);""===h.options.separator&&(h.options.useGrouping=!1),h.options.prefix||(h.options.prefix=""),h.options.suffix||(h.options.suffix=""),h.d="string"==typeof e?document.getElementById(e):e,h.startVal=Number(t),h.endVal=Number(i),h.countDown=h.startVal>h.endVal,h.frameVal=h.startVal,h.decimals=Math.max(0,n||0),h.dec=Math.pow(10,h.decimals),h.duration=1e3*Number(o)||2e3,h.formatNumber=function(e){e=e.toFixed(h.decimals),e+="";var t,i,n,o;if(t=e.split("."),i=t[0],n=t.length>1?h.options.decimal+t[1]:"",o=/(\d+)(\d{3})/,h.options.useGrouping)for(;o.test(i);)i=i.replace(o,"$1"+h.options.separator+"$2");return h.options.prefix+i+n+h.options.suffix},h.easeOutExpo=function(e,t,i,n){return i*(-Math.pow(2,-10*e/n)+1)*1024/1023+t},h.easingFn=h.options.easingFn?h.options.easingFn:h.easeOutExpo,h.formattingFn=h.options.formattingFn?h.options.formattingFn:h.formatNumber,h.version=function(){return"1.7.1"},h.printValue=function(e){var t=h.formattingFn(e);h.d.tagName?"INPUT"===h.d.tagName?this.d.value=t:"text"===h.d.tagName||"tspan"===h.d.tagName?this.d.textContent=t:this.d.innerHTML=t:h.d.text=t},h.count=function(e){h.startTime||(h.startTime=e),h.timestamp=e;var t=e-h.startTime;h.remaining=h.duration-t,h.options.useEasing?h.countDown?h.frameVal=h.startVal-h.easingFn(t,0,h.startVal-h.endVal,h.duration):h.frameVal=h.easingFn(t,h.startVal,h.endVal-h.startVal,h.duration):h.countDown?h.frameVal=h.startVal-(h.startVal-h.endVal)*(t/h.duration):h.frameVal=h.startVal+(h.endVal-h.startVal)*(t/h.duration),h.countDown?h.frameVal=h.frameVal<h.endVal?h.endVal:h.frameVal:h.frameVal=h.frameVal>h.endVal?h.endVal:h.frameVal,h.frameVal=Math.round(h.frameVal*h.dec)/h.dec,h.printValue(h.frameVal),t<h.duration?h.rAF=requestAnimationFrame(h.count):h.callback&&h.callback()},h.start=function(e){return h.callback=e,h.rAF=requestAnimationFrame(h.count),!1},h.pauseResume=function(){h.paused?(h.paused=!1,delete h.startTime,h.duration=h.remaining,h.startVal=h.frameVal,requestAnimationFrame(h.count)):(h.paused=!0,cancelAnimationFrame(h.rAF))},h.reset=function(){h.paused=!1,delete h.startTime,h.startVal=t,cancelAnimationFrame(h.rAF),h.printValue(h.startVal)},h.reinit=function(e,t){h.paused=!1,delete h.startTime,h.frameVal=e,h.startVal=e,h.endVal=Number(t),h.countDown=h.startVal>h.endVal,cancelAnimationFrame(h.rAF),h.printValue(h.startVal)},h.update=function(e){cancelAnimationFrame(h.rAF),h.paused=!1,delete h.startTime,h.startVal=h.frameVal,h.endVal=Number(e),h.countDown=h.startVal>h.endVal,h.rAF=requestAnimationFrame(h.count)},h.printValue(h.startVal)},foxgame;!function(e){function t(e,t){for(var i=0;i<e.length;i++)if(t===e[i].object)return e[i].url;return null}function i(e,n,o,a,s){if(0>=s)return n+"...\n";var r="",l=[];for(var h in e)"$"==h[0]||h.length>1&&"_"==h[0]&&"_"==h[1]&&"_"==h[h.length-2]&&"_"==h[h.length-1]||"_"==h[0]||l.push(h);l.sort();for(var c=0;c<l.length;c++){var h=l[c],u=e[h];if("object"==typeof u)if(null==u)r+=n+h+" = null\n";else{var p=t(a.object,u);p?r+=n+h+" = ["+p+"]\n":isNaN(u.length)?(0!=Object.keys(u).length&&a.object.push({object:u,url:o+"."+h}),r+=n+h+" = {\n",r+=i(u,n+"	",o+"."+h,a,s-1),r+=n+"}\n"):(0!=u.length&&a.object.push({object:u,url:o+"."+h}),r+=n+h+" = [\n",r+=i(u,n+"	",o+"."+h,a,s-1),r+=n+"]\n")}else{if("function"==typeof u)continue;r+=n+h+" = "+u+"\n"}}return r}function n(e,t,n){if(void 0===e&&(e=null),void 0===t&&(t="dump"),void 0===n&&(n=3),null!=e){if("object"==typeof e){var o={object:[],"function":[]},a="\n"+t+" = ";return a+="{\n",a+=i(e,"	",t,o,n),a+="}\n",r.getInstance().log("dump",a),a}return r.getInstance().log("dump",e),e}}function o(e){var t="";return t=e%1024+"B "+t,e=Math.floor(e/1024),t=e%1024+"K "+t,e=Math.floor(e/1024),t=e+"M "+t}function a(){var e=this;if(window.delay_write_text_enable)return new Promise(function(e,t){if(window.delay_write_text_enable=!1,window.delay_write_text&&window.writeTextContent){var i=Object.keys(window.delay_write_text);if(i.length>0){var n=i[0],o=window.delay_write_text[n];window.writeTextContent(n,o,function(){window.delay_write_text&&(window.delay_write_text[n]=null,delete window.delay_write_text[n]),n=null,e()
},function(){n=null,e()})}else t()}else t()}).then(function(){window.delay_write_text_enable=!0,egret.setTimeout(function(){a()},e,1e3)})["catch"](function(){window.delay_write_text_enable=!0})}function s(){var e=this;if(window.delay_write_image_enable)return new Promise(function(e,t){if(window.delay_write_image_enable=!1,window.delay_write_image&&window.writeImageContent){var i=Object.keys(window.delay_write_image);if(i.length>0){var n=i[0],o=window.delay_write_image[n];window.writeImageContent(n,o,function(){window.delay_write_image&&(window.delay_write_image[n]=null,delete window.delay_write_image[n]),n=null,e()},function(){n=null,e()})}else t()}else t()}).then(function(){window.delay_write_image_enable=!0,egret.setTimeout(function(){s()},e,1e3)})["catch"](function(){window.delay_write_image_enable=!0})}e.dump=n;var r=function(){function e(){this.dump=!0}return e.prototype.log=function(e,t){if(void 0===e&&(e=""),void 0===t&&(t=""),this[e]||this.All){for(var i=25-e.length,n=[e];i>0;)i--,n.push(" ");e=n.join(""),Log.trace("time="+egret.getTimer()+"    tag="+e+" "+t)}},e.prototype.warn=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.log(e,t)},e.prototype.error=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.log(e,t)},e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e._instance=null,e}();e.LogUtil=r,__reflect(r.prototype,"foxgame.LogUtil");var l=function(){function t(t,i,n){void 0===n&&(n=null),this.name="",this.width=0,this.height=0,this.size=0,this.cnt=0,this.time=0,this.type="unknown",this.parent="",this.baseUiName="",this.name=t,this.baseUiName=n,this.width=i.textureWidth,this.height=i.textureHeight;var o=Math.ceil(Math.log(i.textureWidth)/Math.log(2)),a=Math.pow(2,o),s=Math.ceil(Math.log(i.textureHeight)/Math.log(2)),r=Math.pow(2,s);if(this.size=a*r*4,this.cnt=0,this.time=0,"gonggaowenzi"==t);if(e.GlobalUtil.isResOrAssetsMangerOk()&&t){var l=e.GlobalUtil.getResOrAssetsManagerRawResItem(t);l?(this.type=l.type,this.type==RES.ResourceItem.TYPE_SHEET?(this.type=l.type,this.parent=l.name,l.sheetToDestroySubKeys||(l.sheetToDestroySubKeys=l.subkeys.length),l.subkeystatemap||(l.subkeystatemap={}),l.subkeystatemap[t]=!1,i.isSheetMain?i.isSheetMain=null:c.getInstance().decreaseCache(l.name)):this.type==RES.ResourceItem.TYPE_JSON&&(this.type=l.type)):console.warn("rawResItem null, resName "+t)}}return t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getSize=function(){return this.size},t.prototype.getCnt=function(){return this.cnt},t.prototype.getTime=function(){return this.time},t.prototype.getInfo=function(){for(var e=["n=","t=","p=","   c=","   ui="],t=[this.name,this.type,this.parent,this.cnt,this.baseUiName],i=[14,15,22,0,0],n="",o=0;o<e.length&&o<t.length;){var a=e[o],s=t[o],r=i[o],l=a+s,h=r-l.length;for(h=h>0?h:0,n+=l;h>0;)n+=" ",h--;o++}if(c.getInstance().debugInfoResInfoFilter){var u=n.search(c.getInstance().debugInfoResInfoFilter);u>=0||(n="")}return n},t.prototype.increaseCnt=function(){this.cnt<0&&(this.cnt=0);return this.cnt++,this.time=egret.getTimer(),this.cnt},t.prototype.decreaseCnt=function(){this.cnt--;return this.cnt<0&&(this.cnt=0),this.cnt},t}();__reflect(l.prototype,"TextureInfo");var h;!function(e){e[e.LARGE_TO_LITTLE=1]="LARGE_TO_LITTLE",e[e.LEAST_RECENTLY_USED=2]="LEAST_RECENTLY_USED"}(h=e.ReleaseType||(e.ReleaseType={}));var c=function(){function t(){this.use={},this.totalSize=0,this.cache={},this.cacheSize=0,this.totalLimit=150,this.cacheLimit=10,this.lastGcTime=0,this.cachePvepMapCnt=0,this.cachePvepMapList=[],this._lastPrintInfoTimestamp=egret.getTimer(),this.tag={},this.tagIndex=0,this.debugInfoAniNameFilter="",this.debugInfoActionNameFilter="",this.debugInfoResInfoFilter="",this.debugInfoRESAssetsManagerResIdFilter="";var t=App.DeviceUtils().getCPU(),i=App.DeviceUtils().getMemory();if(t>=2&&i>=2&&(this.totalLimit=200,this.cacheLimit=50),e.Global.isWeChatXiaoChengXuBranch&&(window.isHighHighDevice?(this.totalLimit=200,this.cacheLimit=50):window.isLowLowDevice?(this.totalLimit=100,this.cacheLimit=20):(this.totalLimit=150,this.cacheLimit=40)),egret.RuntimeType.WEB==egret.Capabilities.runtimeType){var n=document.createElement("div");n.id="egretSysFpsTextureCache",n.style.position="absolute",n.style.background="rgba(0,0,0,0.5)",n.style.pointerEvents="none",n.style.right="0px",n.style.maxWidth="650px",n.style.wordWrap="break-word";var o=document.getElementById("egretSysFpsContainer");o?(n.style.color=o.style.color,n.style.fontSize=o.style.fontSize,n.style.lineHeight=o.style.lineHeight,document.body.appendChild(n),window.showTextureCacheInfo?n.style.display="block":n.style.display="none"):window.showTextureCacheInfo=!1,window.showTextureCacheInfo&&egret.startTick(this.textureCacheProfileTimerHandler,this)}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.restartTextureCacheProfileTimerHandler=function(e){e?egret.startTick(this.textureCacheProfileTimerHandler,this):egret.stopTick(this.textureCacheProfileTimerHandler,this)},t.prototype.textureCacheProfileTimerHandler=function(e){var t=egret.getTimer(),i=t-this._lastPrintInfoTimestamp>1500;if(egret.RuntimeType.WEB==egret.Capabilities.runtimeType&&i&&window.showTextureCacheInfo){this._lastPrintInfoTimestamp=t;var n=document.getElementById("egretSysFpsTextureCache");n.style.display="block";var o="<br/>******************Res Profile******************<br/>",a=console.log,s=console.warn,r=function(e){o=o+e+"<br/>"};console.log=r,console.warn=r,egret.Capabilities.engineVersion>="5.2.4"||RES.destroyRes("printresinfo"),console.log=a,console.warn=s,a=null,s=null,n.innerHTML=this.printRes(!1)+o}return!1},t.prototype.getSimpleInfo=function(){var e="";return e=e+this.totalLimit+","+this.cacheLimit+","+o(this.totalSize)+","+o(this.cacheSize)},t.prototype.increaseCnt=function(t,i,n){void 0===n&&(n=null);if(i instanceof egret.Texture){this.use[t]||(this.cache[t]?this.cacheToUse(t):this.increaseUse(t,i,n));if(this.use[t].increaseCnt(),this.use[t].type==RES.ResourceItem.TYPE_SHEET){var o=e.GlobalUtil.getResOrAssetsManagerRawResItem(t);o.subkeystatemap&&0==o.subkeystatemap[t]&&(o.subkeystatemap[t]=!0,o.sheetToDestroySubKeys--)}}else egret.log("TextureCache increaseCnt, not Texture resId: "+t)},t.prototype.decreaseCnt=function(t,i){void 0===i&&(i=!0);if(this.use[t]){if(this.use[t].decreaseCnt(),this.use[t].getCnt()>0)return!1;var n=!0;if(this.use[t].type==RES.ResourceItem.TYPE_SHEET){var o=e.GlobalUtil.getResOrAssetsManagerRawResItem(t);n=o.subkeys&&1==o.subkeys.length&&t==o.subkeys[0]?!0:!1;var a=null,s=!1;e.GlobalUtil.isResOrAssetsMangerOk()&&(a=e.GlobalUtil.getResOrAssetsManagerGroupItemsByName(t)),a&&a.length>0&&(s=!0,1==a.length&&a[0].name.indexOf("_json")>-1?(a=[],a.push({name:t,isGroup:s}),n=!0):n=!1)}return i&&n?(this.useToCache(t),!1):this.releaseRes(t,!i)?(this.decreaseUse(t),!0):!1}return this.releaseRes(t,!1)},t.prototype.forceDelete=function(e){return this.use[e]?this.decreaseCnt(e,!1):this.cache[e]?(this.decreaseCache(e),this.releaseRes(e,!0)):this.releaseRes(e,!0)},t.prototype.increaseUse=function(e,t,i){void 0===i&&(i=null),this.use[e]=new l(e,t,i),this.totalSize+=this.use[e].size,this.totalSize>1024*this.totalLimit*1024&&this.releaseCache(h.LEAST_RECENTLY_USED,this.cacheLimit/5*1024*1024)},t.prototype.decreaseUse=function(e){this.totalSize-=this.use[e].size,delete this.use[e]},t.prototype.useToCache=function(e){if(this.cache[e])return void Log.trace("already in cache, to add to cache twice? name: "+e);if((0==e.indexOf("pve_")||0==e.indexOf("pvp_")||0==e.indexOf("Scene_new"))&&(this.cachePvepMapCnt++,this.cachePvepMapList.push(e),this.cachePvepMapCnt>6)){var t=this.cachePvepMapList.shift();this.cachePvepMapCnt--;this.releaseRes(t,!0);this.decreaseCache(t)}this.cache[e]=this.use[e],this.cacheSize+=this.use[e].size,delete this.use[e],this.cacheSize>1024*this.cacheLimit*1024&&this.releaseCache(h.LEAST_RECENTLY_USED,this.cacheLimit/5*1024*1024)},t.prototype.cacheToUse=function(e){if(0==e.indexOf("pve_")||0==e.indexOf("pvp_")||0==e.indexOf("Scene_new")){this.cachePvepMapCnt--;var t=this.cachePvepMapList.indexOf(e);t>-1&&this.cachePvepMapList.splice(t,1)}this.use[e]=this.cache[e],this.cacheSize-=this.use[e].size,delete this.cache[e]},t.prototype.increaseCache=function(e,t){var i=new l(e,t);this.cache[e]=i,this.cacheSize+=i.size},t.prototype.decreaseCache=function(e){this.cache[e]&&(this.cacheSize-=this.cache[e].size,this.totalSize-=this.cache[e].size,delete this.cache[e])},t.prototype.releaseCache=function(e,t){if(void 0===e&&(e=h.LEAST_RECENTLY_USED),void 0===t&&(t=0),!(this.cacheSize<=t)){var i=[];for(var n in this.cache)i.push(this.cache[n]);var o=null;for(e==h.LARGE_TO_LITTLE?o=function(e,t){return t.size-e.size}:e==h.LEAST_RECENTLY_USED&&(o=function(e,t){return e.time-t.time}),i.sort(o);this.cacheSize>t;){var a=i.shift();if(this.releaseRes(a.name,!1),this.cacheSize-=a.size,this.totalSize-=a.size,delete this.cache[a.name],0==a.name.indexOf("pve_")||0==a.name.indexOf("pvp_")||0==a.name.indexOf("Scene_new")){this.cachePvepMapCnt--;var s=this.cachePvepMapList.indexOf(a.name);s>-1&&this.cachePvepMapList.splice(s,1)}}this.triggerGC()}},t.prototype.releaseRes=function(t,i){var n=this,o=RES.destroyRes(t,i),a=function(o){if(!o){var a="type",s=Log.trace,r=e.GlobalUtil.getResOrAssetsManagerRawResItem(t);if(e.GlobalUtil.isResOrAssetsMangerOk()&&t&&r&&(a=r.type),a==RES.ResourceItem.TYPE_SHEET&&r&&r.subkeystatemap&&1==r.subkeystatemap[t])if(r.subkeystatemap[t]=!1,r.sheetToDestroySubKeys++,r.sheetToDestroySubKeys>=r.subkeys.length)if(i&&"bg_common_1_json"!=r.name&&"btn_common_json"!=r.name){o=!0;var l=RES.destroyRes(r.name),h=function(e){};if(e.Global.isWeChatXiaoChengXuBranch)egret.assert(!1,"trunk is not xiaochengxu banben");else{var c=l;h(c)}}else{var u=e.GlobalUtil.ResourceInstance.analyzerDic.sheet.fileDic[r.name];u&&u.$texture&&(u.$texture.isSheetMain=!0,n.increaseCache(r.name,u.$texture),console.warn("increaseCache sheet resId: "+r.name)),o=!0}else o=!0;Log.trace=s,s=null}return!!o};if(e.Global.isWeChatXiaoChengXuBranch)return egret.assert(!1,"trunk is not xiaochengxu banben"),!0;var s=o;return a(s)},t.prototype.printRes=function(e){void 0===e&&(e=!0);var t=Log.trace,i="",n=function(e){i=i+e+"<br/>"};e||(Log.trace=n),Log.trace("total = "+this.totalSize+" = "+o(this.totalSize)),Log.trace("use   = "+(this.totalSize-this.cacheSize)+" = "+o(this.totalSize-this.cacheSize)),Log.trace("cache = "+this.cacheSize+" = "+o(this.cacheSize));for(var a=Object.keys(this.use),s=0;s<a.length;s++){for(var r=this.use[a[s]],l=s+"",h=0;h<4-l.length;h++)l+=" ";var c=r.getInfo();c&&Log.trace(l+"	"+c)}for(var u=Object.keys(this.cache),s=0;s<u.length;s++){for(var r=this.cache[u[s]],l=s+"",h=0;h<4-l.length;h++)l+=" ";var c=r.getInfo();c&&Log.trace(l+"	"+c)}return Log.trace=t,t=null,i},t.prototype.printBitmap=function(){for(var e=Object.keys(egret.BitmapData._displayList),t=0;t<e.length;t++){var i=e[t];egret.BitmapData._displayList[i]}},t.prototype.destroyRes=function(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var o=null,a=!1;if(e.GlobalUtil.isResOrAssetsMangerOk()&&(o=e.GlobalUtil.getResOrAssetsManagerGroupItemsByName(t)),o&&o.length>0&&(a=!0,1==o.length&&o[0].name.indexOf("_json")>-1&&(o=[],o.push({name:t,isGroup:a}))),o&&0!=o.length||(o=[],o.push({name:t})),i){for(var s=!0,r=[].concat(o),l=o.length,h=0;l>h;h++){var c=this.forceDelete(r[h].name);s=s&&c}return s&&a&&(RES.destroyRes(t),Log.trace("forceDelete destroyRes group success: "+t)),s}for(var s=!0,r=[].concat(o),l=o.length,h=0;l>h;h++){var c=this.decreaseCnt(r[h].name,n);s=s&&c}return s&&a&&(RES.destroyRes(t),Log.trace("decreaseCnt destroyRes group success: "+t)),s},t.prototype.triggerGC=function(){var e=egret.getTimer();e-this.lastGcTime>500&&(Log.trace("-----------------------gc-----------------------"),this.lastGcTime=e)},t.prototype.isGlobalForceCacheRes=function(t){var i=!1;if(t){var n=e.GlobalUtil.isResOrAssetsMangerOk()&&e.GlobalUtil.ResourceInstance.resConfig.keyMap&&e.GlobalUtil.ResourceInstance.resConfig.keyMap[t];n&&n.url&&(i=e.GlobalUtil.isForceCachecKeyWordsResId(n.url))}return i},t.prototype.takeTag=function(){for(var e={},t=Object.keys(this.use),i=0;i<t.length;i++){var n=t[i],o=this.use[n];e[n]=o.cnt}return this.tagIndex++,this.tag[this.tagIndex]=e,this.tagIndex},t.prototype.compareTag=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),0==e&&(e=this.tagIndex-1,e=0>e&&0||e),0==t&&(t=this.tagIndex,t=0>t&&0||t),e==t)return!0;if(!this.tag[e]||!this.tag[t])return!1;Log.trace("--------compareTag begin--------");for(var i=!0,n=[],o=Object.keys(this.tag[e]),a=0;a<o.length;a++){var s=o[a];-1==n.indexOf(s)&&n.push(s)}for(var r=Object.keys(this.tag[t]),a=0;a<r.length;a++){var s=r[a];-1==n.indexOf(s)&&n.push(s)}for(var a=0;a<n.length;a++){var s=n[a],l=this.tag[e][s]||0,h=this.tag[t][s]||0;l!=h&&(i=!1,Log.trace("--------cnt_1="+l+" cnt_2="+h+" key="+s))}return Log.trace("--------compareTag end--------"),i},t.prototype.removeTag=function(e){return void 0===e&&(e=0),0==e&&(e=this.tagIndex),this.tag[e]=null,delete this.tag[e],this.tagIndex},t.prototype.clearTag=function(){this.tag=[],this.tagIndex=0},t}();e.TextureCache=c,__reflect(c.prototype,"foxgame.TextureCache");var u=function(){function t(){if(this.mapId=0,isLocalStorage()){var e=parseInt(egret.localStorage.getItem("current_mapId"));e&&this.setUselessResByMapId(e)}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setUselessResByMapId=function(t){if(this.mapId!=t){if(0!=this.mapId){var i=e.JsonDataManager.instance.mapTemplate[this.mapId],n=e.JsonDataManager.instance.mapTemplate[t];this.deleteOldMap(i,n),this.deleteOldMonster(i,n)}this.mapId=t,isLocalStorage()&&egret.localStorage.setItem("current_mapId",t+"")}},t.prototype.deleteOldMap=function(e,t){var i=e&&e.battleIcon.split("/")||[],n=null;i.length>=2&&(n=i[1].split(".")[0]);var o=t&&t.battleIcon.split("/"),a=null;if(o.length>=2&&(a=o[1].split(".")[0]),n&&a&&n!=a)for(var s=0;s<e.mapXGrid;s++)for(var r=0;r<e.mapYGrid;r++){var l="assets2/map/newbattle/"+n+"/"+n+"_"+s+"_"+r+".jpg";window.wx&&window.wx.getFileSystemManager().removeSavedFile({filePath:l})}},t.prototype.deleteOldMonster=function(e,t){},t}();e.LocalCache=u,__reflect(u.prototype,"foxgame.LocalCache"),window.WxGameWriteDelayText=a,window.WxGameWriteDelayImage=s}(foxgame||(foxgame={})),window.Main=Main;