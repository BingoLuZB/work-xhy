(function(){return function a(o,s,l){function c(t,e){if(!s[t]){if(!o[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(d)return d(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var n=s[t]={exports:{}};o[t][0].call(n.exports,function(e){return c(o[t][1][e]||e)},n,n.exports,a,o,s,l)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}})()({1:[function(e,i,r){"use strict";(function(){var e=b8e.DelegateUtil=function(){};e.create=function(t,i,r){if(!i)throw"\u6ca1\u6709\u53ef\u4ee3\u7406\u7684\u51fd\u6570.";return function(){var e=Array.prototype.slice.call(arguments);i.apply(t,r?e.concat(r):e),t=null}},e.createExOrgParams=function(e,t,i){if(!t)throw"\u6ca1\u6709\u53ef\u4ee3\u7406\u7684\u51fd\u6570.";return function(){t.apply(e,i)}}})(),function(){var s=b8e.MathUtil=b8e.MathUtil||function(){};s.TWO_PI=Math.PI<<1,s.limitIn=function(e,t,i){return e<t?t:i<e?i:e},s.atan2=function(e,t){var i=void 0;return i=0==e?Math.PI/2:0<e?Math.atan(Math.abs(t/e)):Math.PI-Math.atan(Math.abs(t/e)),0<=t?i:-i},s.sum=function(e){var t=0;return e.forEach(function(e){t+=e},s),t},s.avg=function(e){return s.sum(e)/e.length},s.max=function(e){for(var t=NaN,i=0;i<e.length;i++)(isNaN(t)||e[i]>t)&&(t=e[i]);return t},s.min=function(e){for(var t=NaN,i=0;i<e.length;i++)(isNaN(t)||e[i]<t)&&(t=e[i]);return t},s.shortRotation=function(e,t,i){void 0===i&&(i=!0);var r=i?Math.PI<<1:360,n=(t-e)%r;return n!=n%(r/2)&&(n=n<0?n+r:n-r),n},s.getDegree=function(e,t,i,r){var n=i-e,a=r-t,o=57.33*Math.atan2(a,n);return o%=360},s.getRadian=function(e,t,i,r){var n=i-e,a=r-t;return Math.atan2(a,n)},s.getDistance=function(e,t,i,r){return Math.sqrt((e-i)*(e-i)+(t-r)*(t-r))},s.getDistanceNoSqrt=function(e,t,i,r){return(e-i)*(e-i)+(t-r)*(t-r)},s.degreeToRadian=function(e){return.0175*e},s.radianToDegree=function(e){return s.normalDegree(e*(180/Math.PI))},s.normalDegree=function(e){return(e+360)%360},s.sind=function(e){return Math.sin(s.degreeToRadian(e))},s.cosd=function(e){return Math.cos(s.degreeToRadian(e))},s.tand=function(e){return Math.tan(s.degreeToRadian(e))},s.asind=function(e){return s.radianToDegree(Math.acos(e))},s.acosd=function(e){return s.radianToDegree(Math.acos(e))},s.atand=function(e){return s.radianToDegree(Math.acos(e))},s.atan2d=function(e,t){return s.radianToDegree(Math.atan2(e,t))},s.getDxByRadian=function(e,t){return Math.cos(t)*e},s.getDyByRadian=function(e,t){return Math.sin(t)*e},s.getDxByAngle=function(e,t){return s.cosd(t)*e},s.getDyByAngle=function(e,t){return s.sind(t)*e},s.clamp=function(e,t,i){return i<e?e:t<i?t:i},s.clockwiseSortPoints=function(e){var t=s.getPolygonCenter(e);return e.sort(s._pointCmp),t},s._pointCmp=function(e,t){if(0<=e.x&&t.x<0)return 1;if(0==e.x&&0==t.x)return e.y>t.y?1:e.y<t.y?-1:0;var i=(e.x-center.x)*(t.y-center.y)-(t.x-center.x)*(e.y-center.y);if(i<0)return 1;if(0<i)return-1;var r=(e.x-center.x)*(e.x-center.x)+(e.y-center.y)*(e.y-center.y),n=(t.x-center.x)*(t.x-center.y)+(t.y-center.y)*(t.y-center.y);return n<r?1:r<n?-1:0};var l={x:0,y:0};s.getPolygonCenter=function(e){l.x=0,l.y=0;for(var t=l,i=0,r=0,n=e.length,a=0;a<n;a++){var o=e[a];i+=o.x,r+=o.y}return t.x=i/n>>0,t.y=r/n>>0,t},s.extendPolygon=function(e,a){var o=s.getPolygonCenter(e);e.forEach(function(e){var t=s.getDistance(o.x,o.y,e.x,e.y)+a,i=s.getDegree(o.x,o.y,e.x,e.y),r=s.getDxByAngle(t,i),n=s.getDyByAngle(t,i);e.x=o.x+r,e.y=o.y+n},s)},s.getDegreePos=function(e,t,i,r,n){var a=i/180*Math.PI;return s.getRadianPos(e,t,a,r,n)},s.getRadianPos=function(e,t,i,r,n){l.x=0,l.y=0;var a=n||l;return a.x=e+r*Math.cos(i),a.y=t+r*Math.sin(i),a},s.getSpaceDistance=function(e,t,i,r,n){if(n<=0)return l.x=e,l.y=t,l;if(s.getDistance(e,t,i,r)<n)return l.x=i,l.y=r,l;var a=s.getRadian(e,t,i,r);return s.getRadianPos(e,t,a,n)}}(),b8e.WireType=function(){},b8e.WireType.VARINT=0,b8e.WireType.FIXED_64_BIT=1,b8e.WireType.LENGTH_DELIMITED=2,b8e.WireType.FIXED_32_BIT=5,function(){var e;e=b8e.ByteArray.extends({slices:null,ctor:function(e){this._super(e),this.endian=b8e.Endian.LITTLE_ENDIAN,this.slices=[]},beginBlock:function(){this.slices.push(this.position);var e=this.slices.length;return this.slices.length=this.slices.length+2,this.slices.push(this.position),e},endBlock:function(e){this.slices.push(this.position);var t=this.slices[e+2];this.slices[e]=this.position,WriteUtils.write$TYPE_UINT32(this,this.position-t),this.slices[e+1]=this.position,this.slices.push(this.position)},toNormal:function(e){for(var t=void 0,i=void 0,r=void 0;i<this.slices.length;){if(t=this.slices[i],i++,r<t)e.writeBytes(this,r,t-r);else if(t<r)throw new Error;r=this.slices[i],i++}e.writeBytes(this,r)}}),b8e.RC("$$b8e","$$WritingBuffer",e)}(),b8e.WriteUtil=function(){},b8e.WriteUtil.writeSingleUnknown=function(e,t,i){switch(b8e.WriteUtils.write$TYPE_UINT32(e,t),7&t){case b8e.WireType.VARINT:b8e.WriteUtils.write$TYPE_UINT64(e,i);break;case b8e.WireType.FIXED_64_BIT:b8e.WriteUtils.write$TYPE_FIXED64(e,i);break;case b8e.WireType.LENGTH_DELIMITED:b8e.WriteUtils.write$TYPE_BYTES(e,i);break;case b8e.WireType.FIXED_32_BIT:b8e.WriteUtils.write$TYPE_FIXED32(e,i);break;default:throw new Error("Invalid wire type: "+(7&t))}},b8e.WriteUtil.writeUnknownPair=function(t,i,e){e?e.forEach(function(e){b8e.WriteUtil.writeSingleUnknown(t,i,e)}):b8e.WriteUtil.writeSingleUnknown(t,i,e)},b8e.WriteUtil.writeVarint64=function(e,t,i){var r=void 0;if(0==i)b8e.WriteUtil.write$TYPE_UINT32(e,t);else{for(r=0;r<4;)e.writeByte(127&t|128),t>>>=7,r++;0==(2147483640&i)?e.writeByte(i<<4|t):(e.writeByte(127&(i<<4|t)|128),b8e.WriteUtil.write$TYPE_UINT32(e,i>>>3))}},b8e.WriteUtil.writeTag=function(e,t,i){b8e.WriteUtil.write$TYPE_UINT32(e,i<<3|t)},b8e.WriteUtil.write$TYPE_DOUBLE=function(e,t){e.writeDouble(t)},b8e.WriteUtil.write$TYPE_FLOAT=function(e,t){e.writeFloat(t)},b8e.WriteUtil.write$TYPE_INT64=function(e,t){b8e.WriteUtil.writeVarint64(e,t.low,t.high)},b8e.WriteUtil.write$TYPE_UINT64=function(e,t){b8e.WriteUtil.writeVarint64(e,t.low,t.high)},b8e.WriteUtil.write$TYPE_INT32=function(e,t){t<0?b8e.WriteUtil.writeVarint64(e,t,4294967295):b8e.WriteUtil.write$TYPE_UINT32(e,t)},b8e.WriteUtil.write$TYPE_FIXED64=function(e,t){e.writeUnsignedInt(t.low),e.writeUnsignedInt(t.high)},b8e.WriteUtil.write$TYPE_FIXED32=function(e,t){e.writeUnsignedInt(t)},b8e.WriteUtil.write$TYPE_BOOL=function(e,t){e.writeByte(t?1:0)},b8e.WriteUtil.write$TYPE_STRING=function(e,t){var i=e.beginBlock();e.writeUTFBytes(t),e.endBlock(i)},b8e.WriteUtil.write$TYPE_BYTES=function(e,t){b8e.WriteUtil.write$TYPE_UINT32(e,t.length),e.writeBytes(t)},b8e.WriteUtil.write$TYPE_UINT32=function(e,t){for(;;){if(t<128)return void e.writeByte(t);e.writeByte(127&t|128),t>>>=7}},b8e.WriteUtil.write$TYPE_ENUM=function(e,t){b8e.WriteUtil.write$TYPE_INT32(e,t)},b8e.WriteUtil.write$TYPE_SFIXED32=function(e,t){e.writeInt(t)},b8e.WriteUtil.write$TYPE_SFIXED64=function(e,t){e.writeUnsignedInt(t.low),e.writeInt(t.high)},b8e.ReadUtil=function(){},b8e.ReadUtil.skip=function(e,t){var i=void 0;switch(t){case WireType.VARINT:do{}while(128<=e.readUnsignedByte());break;case WireType.FIXED_64_BIT:e.readInt(),e.readInt();break;case WireType.LENGTH_DELIMITED:for(i=b8e.ReadUtil.read$TYPE_UINT32(e);0!=i;)e.readByte(),i--;break;case WireType.FIXED_32_BIT:e.readInt();break;default:throw new Error("Invalid wire type: "+t)}},b8e.ReadUtil.read$TYPE_DOUBLE=function(e){return e.readDouble()},b8e.ReadUtil.read$TYPE_FLOAT=function(e){return e.readFloat()},b8e.ReadUtil.read$TYPE_INT64=function(e){for(var t=void 0,i=new b8e.Int64,r=void 0;t=e.readUnsignedByte(),28!=r;){if(!(128<=t))return i.low=i.low|t<<r,i;i.low=i.low|(127&t)<<r,r+=7}if(!(128<=t))return i.low=i.low|t<<r,i.high=t>>>4,i;for(t&=127,i.low=i.low|t<<r,i.high=t>>>4,r=3;;){if(t=e.readUnsignedByte(),r<32){if(!(128<=t)){i.high=i.high|t<<r;break}i.high=i.high|(127&t)<<r}r+=7}return i},b8e.ReadUtil.read$TYPE_UINT64=function(e){for(var t=void 0,i=new b8e.UInt64,r=void 0;t=e.readUnsignedByte(),28!=r;){if(!(128<=t))return i.low=i.low|t<<r,i;i.low=i.low|(127&t)<<r,r+=7}if(!(128<=t))return i.low=i.low|t<<r,i.high=t>>>4,i;for(t&=127,i.low=i.low|t<<r,i.high=t>>>4,r=3;;){if(t=e.readUnsignedByte(),r<32){if(!(128<=t)){i.high=i.high|t<<r;break}i.high=i.high|(127&t)<<r}r+=7}return i},b8e.ReadUtil.read$TYPE_INT32=function(e){return b8e.ReadUtil.read$TYPE_UINT32(e)>>0},b8e.ReadUtil.read$TYPE_FIXED64=function(e){var t=new b8e.UInt64;return t.low=e.readUnsignedInt(),t.high=e.readUnsignedInt(),t},b8e.ReadUtil.read$TYPE_FIXED32=function(e){return e.readUnsignedInt()},b8e.ReadUtil.read$TYPE_BOOL=function(e){return!(0==b8e.ReadUtil.read$TYPE_UINT32(e))},b8e.ReadUtil.read$TYPE_STRING=function(e){var t=b8e.ReadUtil.read$TYPE_UINT32(e);return e.readUTFBytes(t)},b8e.ReadUtil.read$TYPE_BYTES=function(e){var t=new b8e.ByteArray,i=b8e.ReadUtil.read$TYPE_UINT32(e);return 0<i&&e.readBytes(t,0,i),t},b8e.ReadUtil.read$TYPE_UINT32=function(e){for(var t=void 0,i=void 0,r=void 0;;){if(t=e.readUnsignedByte(),!(r<32)){do{}while(128<=e.readUnsignedByte());break}if(!(128<=t)){i|=t<<r;break}i|=(127&t)<<r,r+=7}return i},b8e.ReadUtil.read$TYPE_ENUM=function(e){return b8e.ReadUtil.read$TYPE_INT32(e)},b8e.ReadUtil.read$TYPE_SFIXED32=function(e){return e.readInt()},b8e.ReadUtil.read$TYPE_SFIXED64=function(e){var t=new b8e.Int64;return t.low=e.readUnsignedInt(),t.high=e.readInt(),t},function(){var e;e=b8e.Object.extends({low:0,_internalHigh:0,ctor:function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.low=e,this._internalHigh=t},div:function(e){var t=this._internalHigh%e,i=(this.low%e+6*t)%e;this._internalHigh=this._internalHigh/e;var r=(4294967296*t+this.low)/e;return this._internalHigh=this._internalHigh+r/4294967296>>0,this.low=r,i},mul:function(e){var t=this.low*e;this._internalHigh=this._internalHigh*e,this._internalHigh=this._internalHigh+t/4294967296>>0,this.low=this.low*e},add:function(e){var t=this.low+e;this._internalHigh=this._internalHigh+t/4294967296>>0,this.low=t},bitwiseNot:function(){this.low=~this.low,this._internalHigh=~this._internalHigh}}),b8e.RC("$$b8e","$$Binary64",e)}(),function(){var o=void 0;(o=b8e.Binary64.extends({ctor:function(e,t){this._super(e,t)},high:{set:function(e){this.internalHigh=e},get:function(){return this.internalHigh}},toNumber:function(){return 4294967296*this.high+this.low},toString:function(e){void 0===e&&(e=10);var t=void 0;if(e<2||36<e)throw new Error;switch(this.high){case 0:return this.low.toString(e);case-1:return(this.low>>0).toString(e)}if(0==this.low&&0==this.high)return"0";var i=[],r=new b8e.UInt64(this.low,this.high);for(this.high<0&&(r.bitwiseNot(),r.add(1));t=r.div(e),i.push((t<10?"0":"a").charCodeAt(0)+t),0!=r.high;);return this.high<0?"-"+r.low.toString(e)+String.fromCharCode.apply(String,i.reverse()):r.low.toString(e)+String.fromCharCode.apply(String,i.reverse())}})).fromNumber=function(e){return new o(e,e/4294967296>>0)},o.parseInt64=function(e,t){void 0===t&&(t=0);var i=void 0,r=0==e.search(/^\-/),n=r?1:0;if(0==t&&(0==e.search(/^\-?0x/)?(t=16,n+=2):t=10),t<2||36<t)throw new Error;e=e.toLowerCase();for(var a=new o;n<e.length;){if((i=e.charCodeAt(n))>="0".charCodeAt(0)&&i<="9".charCodeAt(0))i-="0".charCodeAt(0);else{if(!(i>="a".charCodeAt(0)&&i<="z".charCodeAt(0)))throw new Error;i-="a".charCodeAt(0)}if(t<=i)throw new Error;a.mul(t),a.add(i),n++}return r&&(a.bitwiseNot(),a.add(1)),a},b8e.RC("$$b8e","$$Int64",o)}(),function(){var a=void 0;(a=b8e.Binary64.extends({ctor:function(e,t){this._super(e,t)},high:{set:function(e){this.internalHigh=e},get:function(){return this.internalHigh}},toNumber:function(){return 4294967296*this.high+this.low},toString:function(e){void 0===e&&(e=10);var t=void 0;if(e<2||36<e)throw new Error;if(0==this.high)return this.low.toString(e);for(var i=[],r=new a(this.low,this.high);t=r.div(e),i.push((t<10?"0":"a").charCodeAt(0)+t),0!=r.high;);return r.low.toString(e)+String.fromCharCode.apply(String,i.reverse())}})).fromNumber=function(e){return new a(e,e/4294967296>>0)},a.parseUInt64=function(e,t){void 0===t&&(t=0);var i=void 0,r=void 0;if(0==t&&(0==e.search(/^0x/)?(t=16,r=2):t=10),t<2||36<t)throw new Error;e=e.toLowerCase();for(var n=new a;r<e.length;){if((i=e.charCodeAt(r))>="0".charCodeAt(0)&&i<="9".charCodeAt(0))i-="0".charCodeAt(0);else{if(!(i>="a".charCodeAt(0)&&i<="z".charCodeAt(0)))throw new Error;i-="a".charCodeAt(0)}if(t<=i)throw new Error;n.mul(t),n.add(i),r++}return n},b8e.RC("$$b8e","$$UInt64",a)}(),function(){var e;e=b8e.Object.extends({ctor:function(){this._super(),this._count=0,this._head=null,this._tail=null},head:{get:function(){return this._head}},tail:{get:function(){return this._tail}},length:{get:function(){for(var e=this._head,t=0;e;)t++,e=e._next;return t}},add:function(e){this._tail?(this._tail._next=e)._prev=this._tail:this._head=e,this._tail=e,this._count+=1},remove:function(e){for(var t=this._head,i=t;t;){if(i=t._next,t===e){e._prev?e._prev._next=e._next:this._head=e._next,e._next?e._next._prev=e._prev:this._tail=e._prev,e._next=null,e._prev=null;break}t=i}this._count-=1},forEach:function(e,t){var i=this._head;if(i){t&&(e=e.bind(t));for(var r=0,n=i;i;)n=i._next,e(i,r,this),i=n,++r}}});b8e.RC("$$b8e","$$LinkedArray",e)}(),function(){var e;e=b8e.Enum({SPACE:0,UNWALKABLE:1,MASK:2,FIGHT_DEFINE:4,PATH_FINDING_WEIGHT:8,EVENT:16}),b8e.RC("$$b8e","$$MapGridType",e)}(),function(){var e;e=b8e.Enum({nNone:"",nUp:"up",nUpRight:"upright",nRight:"right",nDownRight:"downright",nDown:"down",nDownLeft:"downleft",nLeft:"left",nUpLeft:"upleft"}),b8e.RC("$$b8e","$$DirectionType",e)}(),function(){var e;(e=b8e.Object.extends({id:0,isModal:!1,showModal:!1,allModal:!1,imageBringToTop:!1,effectBringToTop:!1,imageZOrder:0,effectZOrder:0,modalColor:2852126720,direction:null,viewClassName:null,data:null,targetImageUrl:null,targetEffectUrls:null,viewOffsetX:0,viewOffsetY:0,targetImageOffsetX:0,targetImageOffsetY:0,targetEffectOffsetX:0,targetEffectOffsetY:0,description:null,visible:!1,textOffsetX:0,textOffsetY:0,textMsg:0,fontSzie:22,ctor:function(){this._super()}})).poolCall=!0,b8e.RC("$$b8e","$$GuideData",e)}(),function(){var e;(e=b8e.Object.extends({id:0,type:null,queueGroup:0,delay:0,limitCount:0,cancelDuration:0,duration:0,rootData:null,chainData:null,nextData:null,cmdData:null,ctor:function(){this._super()}})).poolCall=!0,b8e.RC("$$b8e","$$TriggerData",e)}(),function(){var e;(e=b8e.Object.extends({id:0,viewDesc:null,openView:!1,closeView:!1,optionName:null,optionValues:null,guideData:null,completeTypes:null,completeOnViewHide:!1,completeOnViewShow:!1,viewLocalZOrder:0,ctor:function(){this._super()}})).poolCall=!0,b8e.RC("$$b8e","$$CommandData",e)}(),function(){var e;(e=b8e.Object.extends({id:0,moduleId:0,widgetName:null,ctor:function(){this._super()}})).poolCall=!0,b8e.RC("$$b8e","$$ViewDesc",e)}(),function(){var e,a=b8e.BindingUtil,t=e=b8e.Object.extends({ctor:function(e){this._super(),e?(this.type=e,this._selfAlert=!1,this._treeAlert=!1):b8e.error("SpotAlertData\u53c2\u6570\u9519\u8bef\uff1atype="+e)},set:function(e){if(e)if(e.type){var t=this.__observers__;t=t||(this.__observers__=[]),e.__owner__=this,t.indexOf(e)<0?t.push(e):b8e.error("\u91cd\u590d\u6ce8\u518cSpotAlertData\uff0cself.type="+this.type+"\uff0cchild.type="+e.type)}else b8e.error("child\u53c2\u6570\u9519\u8bef\uff1atype="+e.type);else b8e.error("child\u4e0d\u80fd\u4e3a\u7a7a\uff01")},cover:function(e){var t=this;if(e)if(e.type){var i=t.__observers__;if(!(-1<(i=i||(t.__observers__=[])).indexOf(e)&&e.__owner__===t)){var r=e.__owner__,n=r?r.__observers__:null;if(n){for(var a=n.length-1;0<=a;a--){var o=n[a];if(o.type==e.type){o.__owner__=null,n.splice(a,1);break}}r.dirty()}e.__owner__=t,i.indexOf(e)<0&&i.push(e),t.dirty()}}else b8e.error("child\u53c2\u6570\u9519\u8bef\uff1atype="+e.type);else b8e.error("child\u4e0d\u80fd\u4e3a\u7a7a\uff01")},alert:{set:function(e){this._selfAlert!=e&&(this._selfAlert=e,this.dirty())},get:function(){return this._treeAlert}},notify:function(){var e=this;if(e.__isDirty){var t=e._selfAlert,i=e.__observers__;if(i)for(var r=0,n=i.length;r<n;r++){i[r]._treeAlert&&(t=!0)}e._treeAlert=t,a.notifyCall(e)}},applyNotify:function(){this.notify()},cancelNotify:function(){}});b8e.BindingUtil.bind(t),t.poolCall=!0,b8e.RC("$$b8e","$$SpotAlertData",e)}(),function(){var e,t,o=[],i=t=b8e.PoolObject.extends({ctor:function(){this._super()},loadClip:function(e,t,i,r){var n=this;if(n._clipUrl!=e&&(n.unload(),n.reset(),n._clipUrl=e,n._loadOptions=r,n._atlasRawData=r.atlasRawData,n._onLoadComplete=t?{onComplete:t,thisArg:i}:null,n._highDefinition=!1,n._priority=0,n._sequence=null,n._sequenceScale=1,n._clipData=null,r&&(void 0!==r.priority&&(n._priority=r.priority),void 0!==r.highDefinition&&(n._highDefinition=r.highDefinition),void 0!==r.clipName&&(n._clipName=r.clipName),void 0!==r.clipData&&(n._clipData=r.clipData)),n._clipData)){var a=n._clipData;n._sequence=a.sequence,n._sequence&&(n._sequence=n._sequence.replace(".btb",".btf"));var o=a.sequenceScale;o=0<(o=isNaN(o)?0:o)?o:1,n._sequenceScale=o,n._sample=a.sample,n._speed=a.speed,n._wrapMode=a.wrapMode,2==a.dataType?n.loadAtlas():n.loadFrameAtlas()}},loadFrameAtlas:function(){var e=this;if(0<e._clipData.frames.length)e.loadAtlas();else{var t=e.addClipWithFrames(o,e._clipData);e.onAnimComplete(null,t)}},onAnimComplete:function(e,t){var i=this,r=i._onLoadComplete;i._onLoadComplete=null,e?(i._clipInfo=null,r&&r.onComplete.call(r.thisArg,e,null)):(i._clipInfo=t,r&&r.onComplete.call(r.thisArg,null,i))},onAnimConfigComplete:function(e,t){var i=this;if(e)b8e.error(3305,e.url),i.onAnimComplete(e,null);else{var r=b8e.JsUtil.jsonParse(t),n=i._clipData;if(n.sample=r.sample,n.speed=r.speed,n.wrapMode=r.wrapMode,n.duration=1e3*r.duration,n.frames=[],i._clipData)if(i._sample=i._clipData.sample,i._speed=i._clipData.speed,i._wrapMode=i._clipData.wrapMode,i.getFrameInfos(r))i.loadAtlas();else{var a=i.addClipWithFrames(o,i._clipData);i.onAnimComplete(null,a)}else b8e.error(3306,i._clipUrl),i.onAnimComplete(new Error("\u52a8\u753b\u914d\u7f6e\u6570\u636e\u9519\u8bef\uff01"+i._clipUrl),null)}},getClipData:function(){return this._clipData},getClipName:function(){return this._clipName},getClip:function(){return this._clipInfo},loadAtlas:function(){var e=this,t=e._clipUrl?e._clipUrl.substring(0,e._clipUrl.lastIndexOf("/")):null;e._atlasUrl=t+"/"+(e._sequence?e._sequence:"sequence.btf");var i=e.getAtlasResOptions();if(i){var r=i.url,n=i.type;b8e.res.loadRes(r,n,e.onAtlasComplete,e,null,i)}},getAtlasResOptions:function(){var e=this;if(!e._atlasUrl)return null;var t=e._loadOptions;return{url:e._atlasUrl,type:b8e.FrameAtlas,ownerUrl:t.ownerUrl,useManifest:!1,priority:e._priority,highDefinition:e._highDefinition,textureScale:e._sequenceScale,rawData:e._atlasRawData,recycleDelay:b8e.ResMgr.ANIMAT_SPRITE_RECYCLE_DELAY,textureFormat:t?t.textureFormat:null}},onAtlasComplete:function(e,t){var i=this;if(e)i.onAnimComplete(e,null);else{var r=i._clipData;if(2==r.dataType){var n=engine.proto.animate.AnimateFrame;i._sample=r.sample,i._speed=r.speed,i._wrapMode=r.wrapMode;var a=[],o=t._spriteFrames;for(var s in o){var l=engine.ProtobufUtil.createMessage(n);l.name=s,a[a.length]=l}a&&0<a.length&&(r.frames=a),i.createClipWithFrames(t)}else i.createClipWithFrames(t)}},setWrapMode:function(e){var t=this;t._wrapMode=e,t._clipData&&(t._clipData.wrapMode=e),t._clipInfo&&(t._clipInfo.wrapMode=e)},getWrapMode:function(){return this._wrapMode},setSample:function(e){var t=this;if(t._sample=e,t._clipData&&(t._clipData.sample=e),t._frames){var i=t.addClipWithFrames(t._frames,t._clipData);t._clipInfo=i}},getSample:function(){return this._sample},setSpeed:function(e){var t=this;t._speed=e,t._clipData&&(t._clipData.speed=e),t._clipInfo&&(t._clipInfo.speed=e)},getSpeed:function(){return this._speed},createClipWithMeta:function(e,t){var i=this;if(i._clipData&&i.getFrameInfos(t)){var r=[],n=d.length,a=void 0;for(a=0;a<n;a++){var o=d[a];if(o.value){var s=o.value.__uuid__;r[r.length]=s}}var l=e.getFrameNamesByUuid(r),c=engine.proto.animate.AnimateFrame,d=[];for(n=l.length,a=0;a<n;a++){var _=l[a],u=engine.ProtobufUtil.createMessage(c);u.name=_,d[d.length]=u}d&&0<d.length&&(i._clipData.frames=d);var h=e.getSpriteFrames(l),f=i.addClipWithFrames(h,i._clipData);i.onAnimComplete(null,f)}},createClipWithFrames:function(e){var t=this;if(t._clipData){var i=t._clipData.frames;if(i&&0<i.length){for(var r=[],n=i.length,a=0;a<n;a++){var o=i[a];r[r.length]=o.name}var s=e.getSpriteFrames(r),l=t.addClipWithFrames(s,t._clipData);t.onAnimComplete(null,l)}}},getFrameInfos:function(e){if(!e)return null;var t=e.curveData;if(!t)return null;var i=t.comps,r=i?i["cc.Sprite"]:null;return r?r.spriteFrame:null},addClipWithFrames:function(e,t){this._frames=e;var i=t.sample,r=t.speed,n=t.wrapMode,a=s.get();return a.setFrames(e,i),a.name=this._clipName,a.speed=r,a.wrapMode=n,a},getDuration:function(){return this._clipData?this._clipData.duration:0},getFrameInfoByTime:function(e){var t=this._clipData;if(t){var i=t.duration,r=0;t.wrapMode==cc.WrapMode.Normal?i<(r=e)&&(r=i):r=e%i;for(var n=1e3/t.sample,a=t.frames,o=a.length,s=null,l=0;l<o&&(s=a[l],!((r-=l*n)<0));l++);return s}return null},unload:function(){var e=this;e._clipUrl=null,e._loadOptions=null,e._atlasUrl&&(b8e.res.unloadRes(e._atlasUrl,e.onAtlasComplete,e),e._atlasUrl=null),e._onLoadComplete=null},reset:function(){var e=this;e._clipInfo&&(e._clipInfo.release(),e._clipInfo=null),e._frames=null,e._priority=0,e._highDefinition=!1,e._sequence=null,e._sequenceScale=0,e._clipName=null,e._clipData=null,e._sample=0,e._speed=0,e._wrapMode=0,e._atlasRawData=null},invalidate:function(){this.unload(),this._super()},recycle:function(){this.reset(),this._super()}}),r=new b8e.Pool(i,4096);i.get=function(){return r.get()},i.put=function(e){return r.put(e)};var s=e=b8e.Object.extends({name:null,speed:1,wrapMode:1,duration:0,sample:60,usable:!1,ctor:function(){this._super(),this.frames=[]},setFrames:function(e,t){var i=this;i.sample=t||i.sample,i.duration=e.length/i.sample;var r=i.frames;r.length=0;for(var n=1/i.sample,a=0,o=e.length;a<o;a++)r[a]={frame:a*n,value:e[a]}},release:function(){s.put(this)},recycle:function(){var e=this;e.name=null,e.speed=1,e.wrapMode=1,e.duration=0,e.sample=60,e.frames.length=0,e.usable=!1}}),n=[];s.get=function(){var e=void 0;return(e=0<n.length?n.pop():new s).usable=!0,e},s.put=function(e){if(e.usable)return e.recycle(),n[n.length]=e},s.poolCall=!0,b8e.RC("$$b8e","$$AnimationClip",t),b8e.RC("$$b8e","$$ClipInfo",e)}(),function(){b8e.AnimationActionDirection={_right:{x:1,y:0},_upRight:{x:1,y:1},_downRight:{x:1,y:-1},_up:{x:0,y:1},_down:{x:0,y:-1}};var e,t=e=b8e.Asset.extends({ctor:function(){var e=this;e._super(),e._clipByName=b8e.HashMap.get(),e._clipDataByName=b8e.HashMap.get(),e._bindNodeDatas=b8e.HashMap.get(),e._completeClipNames=b8e.HashMap.get()},setConfig:function(e,t,i,r,n){var a=this;if(a._url!=e){a.unload(),a._onLoadComplete=r?{onComplete:r,thisArg:n}:null,a._url=e,a._loadOptions=i,a._dirUrl=e?e.substring(0,e.lastIndexOf("/")):null,a._priority=0,a._highDefinition=b8e.ResMgr.HIGH_DEFINITION_ENABLED,i&&(void 0!==i.priority&&(a._priority=i.priority),void 0!==i.highDefinition&&(a._highDefinition=i.highDefinition));var o=b8e.proto.animate.AnimateConfigMessage,s=b8e.ProtobufUtil.decodeMessage(a._url,t,o);a.setProtoConfig(s);var l=a._onLoadComplete;l&&l.onComplete.call(l.thisArg,null,a)}},onBacbComplete:function(e,t){if(t){this._bacbData=t;var i=this._onLoadComplete;i&&i.onComplete.call(i.thisArg,null,this)}},load:function(e,t,i){var r=this;if(r._url!=e){r.unload(),r._onLoadComplete=t?{onComplete:t,thisArg:i}:null,r._url=e,r._cfgUrl=e,r._dirUrl=e?e.substring(0,e.lastIndexOf("/")):null;var n=b8e.proto.animate.AnimateConfigMessage;b8e.res.loadRes(r._cfgUrl,b8e.ProtobufConfig,r.onConfigComplete,r,null,{proto:n})}},onConfigComplete:function(e,t){var i=this,r=i._onLoadComplete;i._onLoadComplete=null,e?(b8e.error(3308,i._cfgUrl),r&&r.onComplete.call(r.thisArg,e,null)):(i.setProtoConfig(t.getProtoData()),r&&r.onComplete.call(r.thisArg,null,i))},setProtoConfig:function(e){var t=this;t._isLoaded=!0;var i=t._config=e,r=i.clips,n=i.bindNodes,a=Number(i.leftBorder);a=isNaN(a)?0:a,t.left=a;var o=Number(i.rightBorder);o=isNaN(o)?0:o,t.right=o;var s=Number(i.topBorder);s=isNaN(s)?0:s,t.top=s;var l=Number(i.bottomBorder);l=isNaN(l)?0:l,t.bottom=l;var c=Number(i.anchorX);c=isNaN(c)?.5:c,t.anchorX=c;var d=Number(i.anchorY);d=isNaN(d)?.5:d,t.anchorY=d;var _=Number(i.orderX);_=isNaN(_)?0:_,t.orderX=_;var u=Number(i.orderY);u=isNaN(u)?0:u,t.orderY=u;var h=Number(i.scale);h=isNaN(h)?0:h,t.scale=h,b8e.ResMgr.HIGH_DEFINITION_ENABLED&&i.highDefinition?t._highDefinition=!0:t._highDefinition=!1;var f=t._clipDataByName;r.forEach(function(e){f.get(e.name)||f.set(e.name,e)},t),n.forEach(function(e){this.addBindNodeData(e.name,e.x,e.y)},t)},addBindNodeData:function(e,t,i){e&&(this._bindNodeDatas.get(e)?b8e.error(3309,e):this._bindNodeDatas.set(e,{x:t,y:i}))},removeBindNodeData:function(e){this._bindNodeDatas.del(e)},adaptAction:function(e,t){var i=this;if(!i._isLoaded)return null;var r=i.adjustDirection(e,t),n=i.getActionDirectionName(r),a=e+"/"+n,o=i.getClipDataByName(a);return o||((e=s[e])&&(r=i.adjustDirection(e,t),a=e+"/"+(n=i.getActionDirectionName(r)),o=i.getClipDataByName(a)),o||(e="stand")),e},adjustDirection:function(e,t){var i=this;if(!i._isLoaded)return null;var r=b8e.DirectionType,n=i.getActionDirectionName(t);3==b8e.macro.DIRECTION_COUNT&&(n!=r.nUpRight&&n!=r.nDownRight||(n=r.nRight));var a=e+"/"+n,o=i.getClipDataByName(a);return o||(n==r.nUpRight?n=r.nRight:n==r.nDownRight?n=r.nRight:n==r.nRight?n=r.nDownRight:n==r.nUp?n=r.nUpRight:n==r.nDown&&(n=r.nDownRight),a=e+"/"+n,(o=i.getClipDataByName(a))||(n=r.nDown)),t=i.getActionDirection(n)},getActionDirectionName:function(e){var t=b8e.DirectionType;if(!e)return t.nDown;var i=e.x,r=e.y;return-1==i&&0==r?t.nRight:-1==i&&-1==r?t.nDownRight:0==i&&-1==r?t.nDown:1==i&&-1==r?t.nDownRight:1==i&&0==r?t.nRight:1==i&&1==r?t.nUpRight:0==i&&1==r?t.nUp:-1==i&&1==r?t.nUpRight:t.nNone},getActionDirection:function(e){var t=b8e.DirectionType;return e==t.nRight?b8e.AnimationActionDirection._right:e==t.nUpRight?b8e.AnimationActionDirection._upRight:e==t.nDownRight?b8e.AnimationActionDirection._downRight:e==t.nUp?b8e.AnimationActionDirection._up:e==t.nDown?b8e.AnimationActionDirection._down:null},addClipData:function(e){e=e.replace(/\\/g,"/");var t,i,r=b8e.proto.animate.AnimateClip,n=b8e.ProtobufUtil.createMessage(r),a=void 0;-1<(a=e).indexOf(".")&&(a=a.substring(0,a.lastIndexOf(".")));var o=a.substring(a.lastIndexOf("/")+1);t=(a=a.substring(0,a.lastIndexOf("/"))).substring(a.lastIndexOf("/")+1);var s="sequence_"+(i=o.split("_")[1])+".btf",l=t+"/"+i;n.name=l,n.sequence=s,n.sample=12,n.speed=1,n.wrapMode=cc.WrapMode.Normal,n.dataType=2,this._clipDataByName.set(l,n);for(var c=this._config.clips,d=c.length,_=0;_<d;_++)if(c[_].name==l){c.splice(_,1);break}c[c.length]=n},removeClipData:function(e){if(e){this._clipDataByName.del(e);var t=this._clipByName.get(e);t&&(t.release(),this._clipByName.del(e))}},setSpeed:function(e,t){if(t){var i=this._clipByName.get(t);i&&i.setSpeed(e)}},getSpeed:function(e){if(!e)return 0;var t=this._clipByName.get(e);return t?t.getSpeed():0},setSample:function(e,t){if(t){var i=this._clipByName.get(t);i&&i.setSample(e)}},getSample:function(e){if(!e)return 0;var t=this._clipByName.get(e);return t?t.getSample():0},setWrapMode:function(e,t){if(t){var i=this._clipByName.get(t);i&&i.setWrapMode(e)}},getWrapMode:function(e){if(!e)return 0;var t=this._clipByName.get(e);return t?t.getWrapMode():0},loadAnim:function(e,t){this._loadAnimConfig(t)},_loadAnimConfig:function(e){this._loadAnimByName(e)},_loadAnimByName:function(e){if(e){var t=this,i=t._clipDataByName.get(e);if(i){var r=t._clipByName,n=r.get(e);if(!n){var a=t._loadOptions;n=b8e.AnimationClip.get(),r.set(e,n);var o=t.getAnimUrl(i),s=e.split("/"),l=s[0]+"/sequence_"+s[1],c=t._bacbData?t._bacbData[l]:void 0;n.loadClip(o,t.onAnimClipComplete,t,{ownerUrl:t._url,priority:t._priority,highDefinition:t._highDefinition,clipName:e,clipData:i,atlasRawData:c,textureFormat:a?a.textureFormat:null})}}}},getClipData:function(e){if(!e)return null;var t=null,i=this._clipByName.get(e);return i&&(t=i.getClipData()),t},onAnimClipComplete:function(e,t){if(e)b8e.error(3310,e.url);else{var i=t.getClipName();if(!i)return void b8e.error(3311);if(!t.getClip())return void b8e.error(3312,i);var r=this;r._clipDataByName.set(i,t.getClipData()),r._completeClipNames.set(i,i),r.onClipComplete(i,t),r.isAllClipLoaded()&&r.onAllAnimComplete()}},onClipComplete:function(e,t){var i=this._clipCompleteVec;i&&0<i.count()&&b8e.CallBackUtil.exceteCallBackData(this,i,[e,t])},_loadValidClips:function(){var r=b8e.DirectionType;this._clipDataByName.forEach(function(e,t){if(3==b8e.macro.DIRECTION_COUNT){var i=e.split("/")[1];if(i==r.nLeft||i==r.nUpLeft||i==r.nDownLeft)return}this._loadAnimConfig(e)},this)},loadDepends:function(e,t){var i=this;i._onAllAnimComplete=e,i._onAllAnimThis=t,i.isAllClipLoaded()?i.onAllAnimComplete():i._loadValidClips()},onAllAnimComplete:function(){var e=this,t=e._onAllAnimComplete,i=e._onAllAnimThis;e._onAllAnimComplete=null,e._onAllAnimThis=null,t&&t.call(i,e)},isAllClipLoaded:function(){if(!this._isLoaded)return!1;var r=!0,n=b8e.DirectionType;return this._clipDataByName.every(function(e,t){if(3==b8e.macro.DIRECTION_COUNT){var i=e.split("/")[1];if(i==n.nLeft||i==n.nUpLeft||i==n.nDownLeft)return!0}return!!this._completeClipNames.get(e)||(r=!1)},this),r},isLoaded:function(){return this._isLoaded},getConfig:function(){return this._config},getUrl:function(){return this._url},getAnimUrl:function(e){var t=e.name.split("/");return this._dirUrl+"/"+t[0]+"/sequence_"+t[1]+".btf"},getClipByName:function(e){return e?this._clipByName.get(e):null},getClipMap:function(){return this._clipByName},getClipDataByName:function(e){return e?this._clipDataByName.get(e):null},getTextureScaleByName:function(e){if(!e)return 0;var t=this._clipDataByName.get(e);if(t){var i=1;return this._highDefinition||(i=t.sequenceScale,i=0<(i=isNaN(i)?0:i)?i:1),i}return 0},getClipDatas:function(){return this._clipDataByName},getBindNodeDataByName:function(e){return e?this._bindNodeDatas.get(e):null},getBindNodeDatas:function(){return this._bindNodeDatas},addClipComplete:function(e,t,i){this._clipCompleteVec||(this._clipCompleteVec=b8e.HashMap.get()),b8e.CallBackUtil.addCallBackData(this._clipCompleteVec,e,t,i)},removeClipComplete:function(e,t){var i=this._clipCompleteVec;i&&0<i.count()&&b8e.CallBackUtil.removeCallBackData(i,e,t)},removeAllClips:function(){var e=this._clipByName;e&&(e.forEach(function(e,t){t.release()},this),e.clear())},unload:function(){var e=this;e._cfgUrl&&(b8e.res.unloadRes(e._cfgUrl,e.onConfigComplete,e),e._cfgUrl=null),e._bacbUrl&&(b8e.res.unloadRes(e._bacbUrl,e.onBacbComplete,e),e._bacbUrl=null),e._bacbData=null,e._url=null,e._loadOptions=null,e._dirUrl=null,e._priority=0,e._highDefinition=!1,e._isLoaded=!1,e._config=null,e._onLoadComplete=null,e.left=0,e.right=0,e.top=0,e.bottom=0,e.anchorX=0,e.anchorY=0,e.orderX=0,e.orderY=0,e.scale=0,e.removeAllClips(),e._clipDataByName.clear(),e._bindNodeDatas.clear(),e._completeClipNames.clear(),e._clipCompleteVec&&b8e.CallBackUtil.removeAllCallBackData(e._clipCompleteVec),e._onAllAnimComplete=null,e._onAllAnimThis=null},cancelLoad:function(){this.unload(),this._super()},dispose:function(){var e=this;e._clipCompleteVec&&(e._clipCompleteVec.release(),e._clipCompleteVec=null),e._clipByName&&(e._clipByName.release(),e._clipByName=null),e._clipDataByName&&(e._clipDataByName.release(),e._clipDataByName=null),e._bindNodeDatas&&(e._bindNodeDatas.release(),e._bindNodeDatas=null),e._completeClipNames&&(e._completeClipNames.release(),e._completeClipNames=null),e._super()}}),s=t._secondActionNameMap={};t.setSecondActionName=function(e,t){s[e]=t};var i=new b8e.Pool(t,1024);t.get=function(){return i.get()},t.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$AnimatorResource",e)}(),function(){var e,t=e=b8e.Asset.extends({ctor:function(){this._super(),this._metaUrlByUuid=b8e.HashMap.get()},parseMeta:function(e,t){this._url=e;var i=b8e.JsUtil.jsonParse(t);if(!i)return null;var r=e?e.substring(0,e.lastIndexOf("/")):null,n=i.subMetas;for(var a in n){var o=n[a],s=r+"/"+a;this._metaUrlByUuid.set(o.uuid,s)}return i},getUrlByUuid:function(e){var t=this._metaUrlByUuid.get(e);return t||b8e.warn(3165,this._url,e),t},getFileNameByUuid:function(e,t){var i=this.getUrlByUuid(e);return i&&t&&(i=i.replace(t+"/","")),i},recycle:function(){this._url=null,this._metaUrlByUuid&&this._metaUrlByUuid.clear(),this._super()},dispose:function(){this._metaUrlByUuid&&(this._metaUrlByUuid.release(),this._metaUrlByUuid=null),this._super()}}),i=new b8e.Pool(t,1024);t.get=function(){return i.get()},t.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$MetaConfig",e)}(),function(){var e,t=e=b8e.Asset.extends({ctor:function(e,t,i,r){var n=this;n._super(),n._rawData=e,n._width=t,n._height=i,n._alphaRawData=r},getPixelsData:function(e,t){void 0===e&&(e="argb"),void 0===t&&(t="argb");var i=null,r=void 0,n=this,a=this._width*this._height;if("argb"==e)if(n._alphaRawData)for(i=new Uint8Array(n._width*n._height*4),r=0;r<a;++r)n._rawData[r],i[4*r]=n._rawData[4*r],i[4*r+1]=n._rawData[4*r+1],i[4*r+2]=n._rawData[4*r+2],i[4*r+3]=n._alphaRawData[4*r+2];else i=this._rawData;else if("rgb"==e){if("argb"==t)for(i=new Uint8Array(n._width*n._height*4),r=0;r<a;++r)n._rawData[r],i[4*r]=n._rawData[4*r],i[4*r+1]=n._rawData[4*r+1],i[4*r+2]=n._rawData[4*r+2],n._alphaRawData?i[4*r+3]=n._alphaRawData[4*r+2]:i[4*r+3]=255;else if("rgb"==t)for(i=new Uint8Array(n._width*n._height*3),r=0;r<a;++r)n._rawData[r],i[3*r]=n._rawData[3*r+r],i[3*r+1]=n._rawData[3*r+1+r],i[3*r+2]=n._rawData[3*r+2+r]}else if("a"==e)if("argb"==t)for(i=new Uint8Array(n._width*n._height*4),r=0;r<a;++r)n._rawData[r],i[4*r]=0,i[4*r+1]=0,i[4*r+2]=n._rawData[4*r+3],i[4*r+3]=255;else if("rgb"==t)for(i=new Uint8Array(n._width*n._height*3),r=0;r<a;++r)n._rawData[r],i[3*r]=0,i[3*r+1]=0,i[3*r+2]=n._rawData[3*r+3+r];return{data:i,width:n._width,height:n._height}},recycle:function(){var e=this;e._rawData=null,e._width=0,e._height=0,e._alphaRawData=null,e._super()}}),i=new b8e.Pool(t,1024);t.get=function(){return i.get()},t.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$TextureBitmapData",e)}();var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e,r=e=b8e.BaseDisplay.extends({__SceneDisplay:!0,ctor:function(e,t){var i=this;i._super(),i.needActiveInHierarchyEvent=!0,i.constructor===r&&(r.poolCall||b8e.warn(3187)),i._displayChildren=[],i._gridPos={x:0,y:0},i._lastGridPos={x:0,y:0},i._scenePos={x:0,y:0},i.resetSceneDisplay(),void 0===e||(void 0===e?"undefined":p(e))==b8e.TypeNumber?void 0===t||(void 0===t?"undefined":p(t))==b8e.TypeNumber?(i._type=e,i._id=t):b8e.error(3343):b8e.error(3342)},type:{get:function(){return this._type}},id:{get:function(){return this._id}},_modifyId:function(e){(void 0===e?"undefined":p(e))==b8e.TypeNumber?this._id=e:b8e.error(3344)},gridX:{set:function(e){this.setGridPosition(e,this._gridPos.y)},get:function(){return this._gridPos.x}},gridY:{set:function(e){this.setGridPosition(this._gridPos.x,e)},get:function(){return this._gridPos.y}},sceneX:{set:function(e){this.setScenePosition(e,this._scenePos.y)},get:function(){return this._scenePos.x}},sceneY:{set:function(e){this.setScenePosition(this._scenePos.x,e)},get:function(){return this._scenePos.y}},getDisplayCount:function(){return this._displayChildren.length},getDisplayChildren:function(){return this._displayChildren},removeAllDisplay:function(){if(this._displayChildren)for(var e=this._displayChildren.length-1;0<=e;e--){var t=this._displayChildren[e];t.clearDisabled||this.removeDisplay(t)}},addDisplay:function(e,t){if(this.usable)if(e)if(void 0===t&&(t=0),e.__BaseDisplay){this.addChild(e,t);var i=this._displayChildren;i.indexOf(e)<0&&(i[i.length]=e)}else b8e.error(3345,void 0===e?"undefined":p(e));else b8e.error(3345,void 0===e?"undefined":p(e))},removeDisplay:function(e){if(this._displayChildren)if(e)if(e.__BaseDisplay){this.removeChild(e),e.release();var t=this._displayChildren.indexOf(e);-1<t&&this._displayChildren.splice(t,1)}else b8e.error(3346,void 0===e?"undefined":p(e));else b8e.error(3346,void 0===e?"undefined":p(e))},onSyncInfo:function(e){var t=this;if(t._super(e),e.syncGridInfo){var i=e.lastGridPos;i.x==t._gridPos.x&&i.y==t._gridPos.y||(e.syncGridInfo(t._gridPos),i.x=t._gridPos.x,i.y=t._gridPos.y)}},getScene:function(){return this._scene},_setScene:function(e){var t=this;t._scene!=e&&(t._scene=e,t._sceneVisited=!1,t._sceneVisibled=!1,e&&e.isLoaded()?t.onSceneLoaded():t._sceneLoaded=!1)},setFixedLocalZOrder:function(e){e=null==e?void 0:0|+e,this._fixedLocalZOrder!=e&&(this._fixedLocalZOrder=e,this._adjustSceneZOrder())},fixedLocalZOrder:{get:function(){return this._fixedLocalZOrder}},_adjustSceneZOrder:function(){var e=this;if(void 0===e._fixedLocalZOrder){var t=10*-(.1*(e.y+e._orderOffset)>>0);if(e.getLocalZOrder()==t)return;e.setLocalZOrder(t)}else e.setLocalZOrder(e._fixedLocalZOrder)},_adjustOpacity:function(){var e=this,t=!1;e._sceneLoaded&&-1<e._gridPos.x&&-1<e._gridPos.y&&(t=e._scene.gridIsSpecifyType(e._gridPos.x,e._gridPos.y,b8e.MapGridType.MASK)),e.contentAlpha=t?.5:1},setOrderOffset:function(e){this._orderOffset!=e&&(this._orderOffset=e)},syncPosition:function(){var e=this;e._super(),e._sceneVisited&&e._hierarchyVisible&&(e._adjustSceneZOrder(),e._lastGridPos.x==e._gridPos.x&&e._lastGridPos.y==e._gridPos.y||e._adjustOpacity()),e._applyScenePosition(),e._lastGridPos.x=e._gridPos.x,e._lastGridPos.y=e._gridPos.y},_applyProperties:function(){var e=this;e._super(),e._sceneVisited&&e._hierarchyVisible&&(e._adjustSceneZOrder(),e._adjustOpacity())},setScenePosition:function(e,t){var i=this;if(e<0||t<0)b8e.warn(3188,e,t);else if((i._scenePos.x!=e||i._scenePos.y!=t)&&(i._scenePos.x=e,i._scenePos.y=t,i._gridPos.x=-1,i._gridPos.y=-1,i._scene)){var r=i._scene.sceneUIToGLPos(i._scenePos.x,i._scenePos.y);i.setPosition(r.x,r.y,0)}},getScenePosition:function(){return this._scenePos},onSceneLoaded:function(){var e=this;if(!e._sceneLoaded){e._sceneLoaded=!0;var t=null;0<=e._gridPos.x&&0<=e._gridPos.y?(t=e._scene.getPixelPosByGrid(e._gridPos.x,e._gridPos.y),t=e._scene.sceneUIToGLPos(t.x,t.y)):0<=e._scenePos.x&&0<=e._scenePos.y&&(t=e._scene.sceneUIToGLPos(e._scenePos.x,e._scenePos.y)),t&&e.setPosition(t.x,t.y,0)}},setGridPosition:function(e,t){var i=this;if(e<0||t<0)b8e.warn(3189,e,t);else if((i._gridPos.x!=e||i._gridPos.y!=t)&&(i._gridPos.x=e,i._gridPos.y=t,i._scenePos.x=-1,i._scenePos.y=-1,i._sceneLoaded)){var r=i._scene.getPixelPosByGrid(i._gridPos.x,i._gridPos.y);r=i._scene.sceneUIToGLPos(r.x,r.y),i.setPosition(r.x,r.y,0)}},_applyScenePosition:function(){var e=this;if(e._sceneLoaded){var t=e._scene.sceneGLToUIPos(e._pos.x,e._pos.y);e._scenePos.x=t.x,e._scenePos.y=t.y,t=e._scene.getGridPosByPixel(t.x,t.y),e._gridPos.x=t.x,e._gridPos.y=t.y}},getGridPosition:function(){return this._gridPos},interact:function(){this.interactTime=b8e.getTimer()},applyAttachVisible:function(e,t){void 0!==this._attachVisibleByType[e]&&!!this._attachVisibleByType[e]==!!t||(this._attachVisibleByType[e]=t,this.onAttachVisible(e,t))},onAttachVisible:function(){},getAttachVisible:function(e){return void 0===this._attachVisibleByType[e]||!!this._attachVisibleByType[e]},setSceneVisitCallback:function(e,t,i){this._sceneVisitCallback={callback:e,thisArg:t,args:i}},sceneVisit:function(){var e=this;if(e._sceneVisited||(e._sceneVisited=!0,e.onSceneVisit()),e._hierarchyVisible){if(!e._sceneVisibled){e._sceneVisibled=!0;var t=e._sceneVisitCallback;t&&t.callback.apply(t.thisArg,t.args)}e._adjustSceneZOrder(),e._adjustOpacity()}},_setHierarchyVisible:function(e){var t=this;if(t._super(e),e&&t._sceneVisited){if(!t._sceneVisibled){t._sceneVisibled=!0;var i=t._sceneVisitCallback;i&&i.callback.apply(i.thisArg,i.args)}t._adjustSceneZOrder(),t._adjustOpacity()}},onSceneVisit:function(){},restore:function(e,t){this._super(),void 0===e||(void 0===e?"undefined":p(e))==b8e.TypeNumber?void 0===t||(void 0===t?"undefined":p(t))==b8e.TypeNumber?(this._type=e,this._id=t):b8e.error(3348):b8e.error(3347)},resetSceneDisplay:function(){var e=this;e._type=void 0,e._id=void 0,e._scene=null,e._gridPos.x=-1,e._gridPos.y=-1,e._lastGridPos.x=-1,e._lastGridPos.y=-1,e._scenePos.x=-1,e._scenePos.y=-1,e._orderOffset=0,e._fixedLocalZOrder=void 0,e.fovLimitable=!1,e.renderLimitable=!1,e.attachLimitable=null,e._sceneVisited=!1,e._sceneVisibled=!1,e._sceneLoaded=!1,e._attachVisibleByType={},e.arrivalOrder=0,e.interactTime=0,e.isUniqueId=!1,e.lazyActive=!1,e.isLazy=!1,e.isSceneLazy=!1,e.queueDelay=0,e._sceneVisitCallback=null,e.removeAllDisplay()},invalidate:function(){this._scene&&this._scene._driveOutDisplay(this),this._super()},recycle:function(){this.resetSceneDisplay(),this._super()},release:function(){this.constructor===r?r.put(this):this.destroy()},dispose:function(){var e=this;if(e._displayChildren){for(var t=e._displayChildren.length-1;0<=t;t--){var i=e._displayChildren[t];e.removeDisplay(i)}e._displayChildren.length=0,e._displayChildren=null}e._gridPos=null,e._lastGridPos=null,e._scenePos=null,e._super()},destroy:function(){this.constructor===r&&(r.poolCall||b8e.warn(3190)),this.recycle(),this.dispose()}}),i=new b8e.Pool(r,4096);r.get=function(e,t){return i.get(e,t)},r.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$SceneDisplay",e)})(),function(){var e;(e=b8e.Object.extends({ctor:function(e,t,i){var r=this;r._super(),r._obj=e,r._syncRotation=!!t,r._syncVisible=!!i,r._offsetX=0,r._offsetY=0,r._offsetZ=0},getSyncRotation:function(){return this._syncRotation},getSyncVisible:function(){return this._syncVisible},getObj:function(){return this._obj},setOffset:function(e,t,i){this._offsetX=e,this._offsetY=t,this._offsetZ=i},syncInfo:function(e,t){var i=this;if(i._obj){var r=e.x,n=e.y,a=e.z,o=t.x,s=t.y,l=t.z;i._obj instanceof cc.Node?(i._obj.setPosition(r+i._offsetX,n+i._offsetY),i._syncRotation,i._syncVisible):i._obj.__BaseDisplay?(i._obj.setSyncPosition(r,n,a,i._offsetX,i._offsetY,i._offsetZ),i._syncRotation&&i._obj.syncRotation(o,s,l),i._syncVisible):i._obj.syncInfo&&i._obj.syncInfo(e,t)}},dispose:function(){var e=this;e._obj=null,e._syncRotation=!1,e._syncVisible=!1,e._offsetX=0,e._offsetY=0,e._offsetZ=0}})).poolCall=!0,b8e.RC("$$b8e","$$DisplaySyncInfo",e)}(),function(){var e;(e=b8e.DisplaySyncInfo.extends({lastGridPos:null,ctor:function(e,t,i){this._super(e,t,i),this.lastGridPos={x:-1,y:-1}},syncGridInfo:function(e){this._obj&&this._obj.syncGridInfo&&this._obj.syncGridInfo(e)},dispose:function(){this.lastGridPos=null,this._super()}})).poolCall=!0,b8e.RC("$$b8e","$$SceneDisplaySyncInfo",e)}(),function(){var e,t=e=b8e.BaseDisplay.extends({ctor:function(){var e=this;e.constructor===t&&(t.poolCall||b8e.warn(3171)),e._frame=null,e._super(),e.setAnchor(0,0),e.setPosition(0,0,0)},_createNode:function(){var e=new b8e.createNode,t=this._sprite=e.addComponent(cc.Sprite);t.isUseForAnimat=!0,b8e.isCocos190&&"function"==typeof t.__preload&&t.__preload();var i=this._animation=e.addComponent(cc.Animation);return b8e.isCocos190&&"function"==typeof i.__preload&&i.__preload(),e},animation:{get:function(){return this._animation}},sizeMode:{set:function(e){this._sprite.sizeMode=e},get:function(){return this._sprite.sizeMode}},setSizeMode:function(e){this.sizeMode=e},customSizeMode:function(){this.setSizeMode(cc.Sprite.SizeMode.CUSTOM)},rawSizeMode:function(){this.setSizeMode(cc.Sprite.SizeMode.RAW)},type:{set:function(e){this._sprite.type=e},get:function(){return this._sprite.type}},setColorTransfrom:function(e){b8e.isCocos190||this._sprite.setColorTransfrom(e)},setStyle:function(e){switch(e){case bui.SpriteStyle.SIMPLE:this.type=cc.Sprite.Type.SIMPLE;break;case bui.SpriteStyle.SLICED:this.type=cc.Sprite.Type.SLICED;break;case bui.SpriteStyle.TILED:this.type=cc.Sprite.Type.TILED;break;case bui.SpriteStyle.FILLED:this.type=cc.Sprite.Type.FILLED}},spriteFrame:{set:function(e){this._sprite.spriteFrame=e},get:function(){return this._sprite.spriteFrame}},setFrame:function(e){var t=this;if(t._sprite){var i=null;if(e){if(e.__SpriteFrame){if(i=e.getFrame(),t.spriteFrame==i)return}else if(e instanceof cc.SpriteFrame&&(i=e,t.spriteFrame==i))return}else if(i=null,t.spriteFrame==i)return;t.spriteFrame=i,t._frame=e}},getShader:function(){},setBlendMode:function(e){if(this._sprite){var t=void 0,i=void 0;switch(e){case b8e.BlendMode.NORMAL:t=cc.macro.SRC_ALPHA,i=cc.macro.ONE_MINUS_SRC_ALPHA;break;case b8e.BlendMode.ADD:t=cc.macro.SRC_ALPHA,i=cc.macro.ONE;break;case b8e.BlendMode.LIGHTEN:t=cc.macro.SRC_ALPHA,i=cc.macro.DST_ALPHA;break;default:t=cc.macro.SRC_ALPHA,i=cc.macro.ONE_MINUS_SRC_ALPHA}this._sprite.srcBlendFactor=t,this._sprite.dstBlendFactor=i}},resetDisplay:function(){this._super(),this.resetSprite()},resetSprite:function(){var e=this;e._materialType=null,b8e.etc1&&b8e.Texture2DAsset.ENABLE_FORMAT_ETC?e._sprite.textureFormat="rgbaEtc":e._sprite.textureFormat=null,e._sprite.trim=!1,e.setStyle(bui.SpriteStyle.SIMPLE),e.setSizeMode(cc.Sprite.SizeMode.TRIMMED),e.setColorTransfrom(null),e.resetShader()},resetShader:function(){},invalidate:function(){this.clear(),this._super()},clear:function(){this.setFrame(null)},restore:function(){this._super()},recycle:function(){this._super()},release:function(){this.constructor===t?t.put(this):this.destroy()},dispose:function(){var e=this;e._animation&&(e._node.removeComponent(e._animation),e._animation.destroy(),e._animation=null),e._sprite&&(e._node.removeComponent(e._sprite),e._sprite.destroy(),e._sprite=null),e._super()},destroy:function(){this.constructor===t&&(t.poolCall||b8e.warn(3172)),this._super()}}),i=new b8e.Pool(t,4096);t.get=function(){return i.get()},t.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$AnimatSprite",e)}();p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e,r=e=b8e.BaseDisplay.extends({ctor:function(e,t){this.constructor===r&&(r.poolCall||b8e.warn(3166));var i=this;i._super(),i.needActiveInHierarchyEvent=!0,i._defaultPrefix="default",i.resetAnim(e,t),i._sprite=b8e.AnimatSprite.get(),i._sprite.clearDisabled=!0,i.addChild(i._sprite),i._animation=i._sprite.animation,i._animation.on("play",i._onAnimationPlay,i),i._animation.on("finished",i._onAnimationFinished,i),i._bindNodeByName=b8e.HashMap.get(),i._bindChildren=b8e.HashMap.get(),i._clips=b8e.HashMap.get(),i._defaultClips=b8e.HashMap.get()},resetAnim:function(e,t){if(void 0===e||(void 0===e?"undefined":p(e))==b8e.TypeNumber)if(void 0===t||(void 0===t?"undefined":p(t))==b8e.TypeNumber){var i=this;i._type=e,i._id=t,i._speedRatio=1,i._animationActive=!0,i._sprite&&i._sprite.setVisible(!0)}else b8e.error(3314);else b8e.error(3313)},type:{get:function(){return this._type}},id:{get:function(){return this._id}},_loadDefault:function(){var e=this;e._loadDefaultStarted||e._defaultUrl&&(e._loadDefaultStarted=!0,b8e.res.loadRes(e._defaultUrl,b8e.AnimatorResource,e.onDefaultConfigComplete,e,null,{preload:e._preload,priority:e._priority,highDefinition:e._highDefinition}))},load:function(e,t,i,r){var n=this;if(n.usable){if(n._url==e)return n._onLoadComplete=t?{onComplete:t,thisArg:i}:null,void(n._resource&&n._resource.isLoaded()&&(n._preload=!1,r&&void 0!==r.preload&&(n._preload=r.preload),n.onLoadComplete(n._resource)));b8e.ResMgr.ALLOW_SET_DEFAULT_FORMAT=!1;var a=n._sprite;a&&(a.setFlippedX(!1),a.setAnchor(.5,.5),a.setPosition(0,0),a.setBlendMode(b8e.BlendMode.NORMAL)),n.unload(),n._url=e,n._loadOptions=r,n._preload=!1,n._priority=0,n._highDefinition=b8e.ResMgr.HIGH_DEFINITION_ENABLED,r&&(void 0!==r.preload&&(n._preload=r.preload),void 0!==r.priority&&(n._priority=r.priority),void 0!==r.highDefinition&&(n._highDefinition=r.highDefinition)),n._onLoadComplete=t?{onComplete:t,thisArg:i}:null,n._startLoad()}},getShader:function(){return this._sprite.getShader()},setBlendMode:function(e){this._sprite.setBlendMode(e)},onHierarchyVisible:function(e){var t=this;t._super(),e?(t._startLoad(),t._loadAndPlay()):(t._clearAnimation(),t._autoRelease?t.release():t.unload())},setAnimationActive:function(e){var t=this;t._animationActive!=e&&(t._animationActive=e,t._sprite.setVisible(e),e?t._loadAndPlay():t._clearAnimation())},getAnimationActive:function(){return this._animationActive},_clearAnimation:function(){var e=this;e._animationState=null,e._animation&&(e._animation.currentClip=null,e._animation.stop()),e._sprite&&e._sprite.clear()},_startLoad:function(){var e=this;if(!e._loadStarted&&e._url&&(e._preload||e._hierarchyVisible)){e._currResource=null,e._defaultResource&&e._defaultResource.isLoaded()?e.setAnimationConfig(e._defaultResource):e._loadDefault(),e._loadStarted=!0;var t=e._loadOptions;b8e.res.loadRes(e._url,b8e.AnimatorResource,e.onConfigComplete,e,null,{preload:e._preload,priority:e._priority,highDefinition:e._highDefinition,textureFormat:t?t.textureFormat:null})}},getResource:function(){return this._resource},setTouchable:function(e){this._touchable!=e&&(this._touchable=e,this._applyAnimatEvents())},getTouchable:function(){return this._touchable},_applyAnimatEvents:function(){var e=this;e._touchable&&e._touchCallbackVec&&0<e._touchCallbackVec.count()?e._touchEventEnable||e._setAnimatEvents(!0):e._touchEventEnable&&e._setAnimatEvents(!1)},_setAnimatEvents:function(e){var t=this;(t._touchEventEnable=e)?b8e.evt.onTouchEnd(t,t._onAnimTouchEnd,t):b8e.evt.offTouchEnd(t,t._onAnimTouchEnd,t)},_onAnimTouchEnd:function(){this._touchCallbackVec&&0<this._touchCallbackVec.count()&&b8e.CallBackUtil.exceteCallBackData(this,this._touchCallbackVec)},addTouchCallback:function(e,t,i){this._touchCallbackVec||(this._touchCallbackVec=b8e.HashMap.get()),b8e.CallBackUtil.addCallBackData(this._touchCallbackVec,e,t,i),this._applyAnimatEvents()},removeTouchCallback:function(e,t){this._touchCallbackVec&&0<this._touchCallbackVec.count()&&(b8e.CallBackUtil.removeCallBackData(this._touchCallbackVec,e,t),this._applyAnimatEvents())},onDefaultConfigComplete:function(e,t){var i=this;i.usable&&(e?i._autoRelease&&i.release():(i._defaultResource=t,i._defaultResource.addClipComplete(i.onClipComplete,i),i.setAnimationConfig(t)))},onConfigComplete:function(e,t){var i=this;i.usable&&(e?(i.onLoadComplete(t,e),i._autoRelease&&i.release()):(i._resource=t,i._resource.addClipComplete(i.onClipComplete,i),i.setAnimationConfig(t),i.onLoadComplete(t)))},onLoadComplete:function(e,t){var i=this._onLoadComplete;this._onLoadComplete=null,i&&i.onComplete.call(i.thisArg,t,this)},setAnimationConfig:function(e){var t=this;t._currResource=e,t.setAnchor(e.anchorX,e.anchorY),t.setBorder(e.left,e.right,e.top,e.bottom);var i=0<e.scale?e.scale:1;t.setResourceScale(i),t._bindNodeByName.forEach(t._updateBindNodePos,t),t.onConfigUpdate(),t._loadAndPlay()},createBindNodeByName:function(e){var t=this._bindNodeByName.get(e);return t||(t=this.createBindNode(e,0,0),this._updateBindNodePos(e,t)),t},_updateBindNodePos:function(e,t){var i=this;t.setContentScale(1/i._contentScaleX,1/i._contentScaleY);var r=i._currResource;if(r){var n=r.getBindNodeDataByName(e);n&&t.setPosition(n.x/i._contentScaleX,n.y/i._contentScaleY)}},setResourceScale:function(e){this._resourceScale=e,this.setContentScale(this._resourceScale,this._resourceScale)},getOrderX:function(){return this._currResource&&this._currResource.isLoaded()?this._currResource.orderX:0},getOrderY:function(){return this._currResource&&this._currResource.isLoaded()?this._currResource.orderY:0},getBorder:function(){return{left:this._leftBorder,right:this._rightBorder,top:this._topBorder,bottom:this._bottomBorder}},setBorder:function(e,t,i,r){var n=this;n._leftBorder=e,n._rightBorder=t,n._topBorder=i,n._bottomBorder=r;var a=n._rightBorder-n._leftBorder,o=n._topBorder-n._bottomBorder;a<=0&&o<=0&&(n._leftBorder=-10,n._rightBorder=10,n._bottomBorder=-10,n._topBorder=10,o=a=20),n.setSize(a,o)},onConfigUpdate:function(){this._configCompleteHandler&&this._configCompleteHandler.call(this._configCompleteThis,this)},setConfigUpdateHandler:function(e,t){this._configCompleteHandler=e,this._configCompleteThis=t},setAsBoundary:function(e){this._asBoundary=e},getAsBoundary:function(){return this._asBoundary},addChildToBindNode:function(e,t,i){var r=this;if(r.usable)if(e)if(void 0===i&&(i=0),e.__BaseDisplay){var n=r.createBindNodeByName(t),a=r._bindChildren.get(t);if(!a||a.child!=e){a&&(r.removeBindNodeChild(a.child),a=null);var o=e._bindAnimator;o&&o.removeBindNodeChild(e),e.setPosition(0,0),e._bindAnimator=r,a={child:e,depth:i},r._bindChildren.set(t,a),n?n.addChild(e):r.addChild(e)}a.depth=i,n?n.setLocalZOrder(i):e.setLocalZOrder(i)}else b8e.error(3315,void 0===e?"undefined":p(e));else b8e.error(3315,void 0===e?"undefined":p(e))},removeBindNodeChild:function(i){var e=this;if(e.usable)if(i)if(i.__BaseDisplay){var r=null;if(e._bindChildren.every(function(e,t){return t.child!=i||(r=e,!1)},e),r){var t=e._bindChildren.get(r);if(t){var n=t.child;n.setLocalZOrder(0),n.removeFromParent();var a=e._bindNodeByName.get(r);a&&a.setLocalZOrder(0),n._bindAnimator=null,e._bindChildren.del(r)}}}else b8e.error(3316,void 0===i?"undefined":p(i));else b8e.error(3316,void 0===i?"undefined":p(i))},getBindNode:function(e){return this._bindNodeByName.get(e)},createBindNode:function(e,t,i){var r=this,n=r._bindNodeByName.get(e);if(n)b8e.warn(3167,e);else{n=b8e.BaseDisplay.get(),r.addChild(n),n.setContentScale(1/r._contentScaleX,1/r._contentScaleY),n.setPosition(t,i),r._bindNodeByName.set(e,n);var a=r._bindChildren.get(e);a&&(a.child.setLocalZOrder(0),a.child.removeFromParent(),n.addChild(a.child),n.setLocalZOrder(a.depth))}return n},addBindNode:function(e,t,i){return this._resource&&this._resource.isLoaded()?(this._resource.addBindNodeData(e,t,i),this.createBindNode(e,t,i)):null},setBindNodePos:function(t,e,i){var r=this._resource;if(!r||!r.isLoaded())return null;var n=null,a=r.getClipDataByName(this._currClipName);a&&a.bindNodes&&a.bindNodes.every(function(e){return e.name!=t||(n=e,!1)},this);var o=this._bindNodeByName.get(t);if(o){var s=r.getBindNodeDataByName(t);s.x=e,s.y=i,o.setPosition(s.x+(n?n.x:0),s.y+(n?n.y:0))}return o},setClipBindNodePos:function(e,i,r,n){var a=this._resource;if(!a||!a.isLoaded())return null;var o=null,t=a.getClipDataByName(this._currClipName);return t&&t.bindNodes&&t.bindNodes.every(function(e){if(e.name!=i)return!0;e.x=r,e.y=n;var t=a.getBindNodeDataByName(e.name);return(o=this._bindNodeByName.get(e.name))&&o.setPosition(t.x+e.x,t.y+e.y),!1},this),o},getClipBindNodePos:function(e,t){var i=this._resource;if(!i||!i.isLoaded())return null;var r=null,n=i.getClipDataByName(this._currClipName);return n&&n.bindNodes&&n.bindNodes.every(function(e){return e.name!=t||(r=e,!1)},this),r},removeBindNode:function(e){var t=this._resource;if(t&&t.isLoaded()){t.removeBindNodeData(e);var i=this._bindNodeByName.get(e);i&&(i.release(),this._bindNodeByName.del(e))}},onClipComplete:function(e,t,i){var r=this;if(r.usable){var n=r._resource,a=e==r._defaultResource;a&&r._defaultPrefix;if(i.getClip()&&t==r._currClipName)if(a){var o=null;n&&n.isLoaded()&&(o=n.getClipByName(t)),o&&o.getClip()||r.onPlay(r._defaultResource,t)}else r.onPlay(n,t)}},getAnimClipByName:function(e,t){var i=null;if(e)this._defaultResource&&this._defaultResource.isLoaded()&&(i=this._defaultResource.getClipByName(t));else{var r=this._resource;r&&r.isLoaded()&&(i=r.getClipByName(t))}return i},addClipData:function(e){this._currResource&&this._currResource.addClipData(e)},removeClipData:function(e){this._currResource&&this._currResource.removeClipData(e)},onAddClip:function(e,t,i){if(e&&t){var r=this;i?r._defaultClips.get(e)||(r._defaultClips.set(e,t),r._animation.addClip(t,r._defaultPrefix+e)):r._clips.get(e)||(r._clips.set(e,t),r._animation.addClip(t,e))}else b8e.error(3317,e)},setDepth:function(e,t){this._depth=e,this._depthFixed=!!t},setWrapMode:function(e){if((void 0===e?"undefined":p(e))===b8e.TypeNumber){var t=this;t._resource&&t._resource.isLoaded()&&(t._resource.setWrapMode(e,t._currClipName),t._animationState&&(t._animationState.wrapMode=e))}else b8e.error(3318)},getWrapMode:function(){var e=this;return e._currClipName&&e._resource&&e._resource.isLoaded()?e._resource.getWrapMode(e._currClipName):0},setSample:function(e){if((void 0===e?"undefined":p(e))===b8e.TypeNumber){var t=this;if(t._currClipName&&t._resource&&t._resource.isLoaded()){var i=t._currClipName;t._resource.setSample(e,i);var r=t._clips.get(i);r&&(t._animation.removeClip(r,!0),t._clips.del(i));var n=t._resource.getClipByName(i);n&&(r=n.getClip())&&(t._clips.set(i,r),t._animation.addClip(r,i),t._loadAndPlay())}}else b8e.error(3319)},getSample:function(){var e=this;return e._currClipName&&e._resource&&e._resource.isLoaded()?e._resource.getSample(e._currClipName):0},setSpeed:function(e){if((void 0===e?"undefined":p(e))===b8e.TypeNumber){var t=this;t._resource&&t._resource.isLoaded()&&(t._resource.setSpeed(e,t._currClipName),t._animationState&&(t._animationState.speed=t._speedRatio*e))}else b8e.error(3320)},getSpeed:function(){var e=this;return e._currClipName&&e._resource&&e._resource.isLoaded()?e._resource.getSpeed(e._currClipName):0},setSpeedRatio:function(e){if((void 0===e?"undefined":p(e))===b8e.TypeNumber){var t=this;t._speedRatio=0<e?e:1,t._currResource&&t._currResource.isLoaded()&&t._animationState&&(t._animationState.speed=e*t._currResource.getSpeed(t._currClipName))}else b8e.error(3321)},getSpeedRatio:function(){return this._speedRatio},play:function(e,t){var i=this;i.usable&&(void 0===t&&(t=-1),e=i._actionName?e||i._actionName:e||"stand",i._actionName==e?0<=t&&(i._playToTime=t):(i._actionName=e,t<0&&(t=0),i._playToTime=t),i._lastPlayTime=b8e.getTimer(),i._isPlay=!0,i._isFinished=!1,i._loadAndPlay())},stop:function(e){var t=this;t.usable&&(void 0===e&&(e=-1),e<0?t.applyPlayToTime():t._playToTime=e,t._isPlay=!1,t._loadAndPlay())},applyPlayToTime:function(){var e=this;if(e._currResource&&e._currResource.isLoaded()){var t=e._currResource.getClipDataByName(e._currClipName);if(t){var i=b8e.getTimer();if(e._isPlay){var r=e._playToTime+(i-e._lastPlayTime)*e._speedRatio*t.speed,n=e._currResource.getClipByName(e._currClipName);if(n){var a=n.getClip();if(a){var o=1e3*a.duration/e._speedRatio*t.speed;a.wrapMode==cc.WrapMode.Normal?o<r&&(r=o):r%=o}}e._playToTime=r}e._lastPlayTime=i}}},getDuration:function(){var e=0,t=this;if(t._currResource&&t._currResource.isLoaded()){var i=t._currResource.getClipDataByName(t._currClipName);if(i){var r=t._currResource.getClipByName(t._currClipName);if(r){var n=r.getClip();n&&(e=1e3*n.duration/t._speedRatio*i.speed)}}}return e},_loadAndPlay:function(){var e=this;if(e._hierarchyVisible&&e._loadStarted&&e._actionName){var t=e._currResource;if(t&&t.isLoaded()){var i=t.adaptAction(e._actionName,e._direction),r=t.adjustDirection(i,e._direction);e._adjustDirection=r;var n=i+"/"+t.getActionDirectionName(r);if(e._currClipName=n,e._animationActive){var a=e._resource,o=null;if(a&&a.isLoaded())if(o=a.getClipDataByName(n)){if(e.soundEffectsEnabled&&o.sound){var s=b8e.SoundMgr.EFFECT_SOUND_DIR;b8e.sound.playEffectSound(s+"/"+o.sound)}}else b8e.warn(3168,n,a.getUrl());var l=e.getAnimClipByName(!1,n);if(l&&l.getClip())e.onPlay(a,n);else{if(e._defaultResource&&e._defaultResource.isLoaded())if((l=e.getAnimClipByName(!0,n))&&l.getClip())e.onPlay(e._defaultResource,n);else e._clearAnimation(),e._defaultResource.getClipDataByName(n)?e._defaultResource.loadAnim(e,n):b8e.warn(3169,n,e._defaultResource.getUrl());else e._clearAnimation();o&&a.loadAnim(e,n)}}e.flipByDirection(e._direction),e.updateClipStatus(n)}}},onPlay:function(e,t){if(e&&e.isLoaded()){var i=this,r=e==i._defaultResource,n=e.getClipDataByName(t);if(n){var a=null;a=r?i._defaultPrefix+t:t;var o=i.getAnimClipByName(r,t);if(!o)return void b8e.error(3322,e.getUrl(),t);var s=o.getClip();if(!s)return void b8e.error(3323,e.getUrl(),t);if(s){i.onAddClip(t,s,r),i.applyPlayToTime();var l=1e3*s.duration/i._speedRatio*n.speed,c=i._playToTime,d=0;s.wrapMode==cc.WrapMode.Normal?l<(d=c)&&(d=l):d=c%l,i._playToTime=d,i._animation.currentClip=null,i._animation.stop(),i._animationState=i._animation.play(a,.001*d),i._animationState&&(i._animationState.speed=i._speedRatio*n.speed),s.frames.length<1&&(i._sprite&&i._sprite.clear(),i._autoRelease&&i.release())}else b8e.error(3324,e.getUrl(),a),i._autoRelease&&i.release()}else b8e.error(3325,e.getUrl(),t),i._autoRelease&&i.release()}},updateClipStatus:function(e){var t=this;if(t._currResource&&t._currResource.isLoaded()){var i=t._currResource.getTextureScaleByName(e);t.setContentScale(t._resourceScale/i,t._resourceScale/i)}},_onAnimationPlay:function(){var e=this;if(e.usable&&!e._isPlay){var t=null;t=e._currResource==e._resource?e._currClipName:e._defaultPrefix+e._currClipName,e._animation.setCurrentTime(.001*e._playToTime,t),e._animation.stop(t)}},_onAnimationFinished:function(){this.usable&&(this._isFinished=!0,this._onFinish())},_onFinish:function(){var e=this;e._finishCallbackVec&&0<e._finishCallbackVec.count()&&b8e.CallBackUtil.exceteCallBackData(e,e._finishCallbackVec),e._autoRelease&&e.release()},isFinished:function(){return this._isFinished},addFinishCallback:function(e,t,i){this._finishCallbackVec||(this._finishCallbackVec=b8e.HashMap.get()),b8e.CallBackUtil.addCallBackData(this._finishCallbackVec,e,t,i)},removeFinishCallback:function(e,t){this._finishCallbackVec&&0<this._finishCallbackVec.count()&&b8e.CallBackUtil.removeCallBackData(this._finishCallbackVec,e,t)},setDirection:function(e){var t=this;t._direction!=e&&(t._direction&&e&&t._direction.x==e.x&&t._direction.y==e.y||(t._direction=e,t._loadAndPlay()))},getDirection:function(){return this._direction},getAdjustDirection:function(){return this._adjustDirection},flipByDirection:function(e){var t=this;if(!e)return t._sprite.setFlippedX(!1),void(void 0!==t._depth&&t.setLocalZOrder(t._depth));var i=e.x,r=e.y;-1==i&&0==r?(t._sprite.setFlippedX(!0),void 0!==t._depth&&t.setLocalZOrder(t._depth)):-1==i&&-1==r?(t._sprite.setFlippedX(!0),void 0!==t._depth&&t.setLocalZOrder(t._depth)):0==i&&-1==r?(t._sprite.setFlippedX(!1),void 0!==t._depth&&t.setLocalZOrder(t._depth)):1==i&&-1==r?(t._sprite.setFlippedX(!1),void 0!==t._depth&&t.setLocalZOrder(t._depth)):1==i&&0==r?(t._sprite.setFlippedX(!1),void 0!==t._depth&&t.setLocalZOrder(t._depth)):1==i&&1==r?(t._sprite.setFlippedX(!1),void 0!==t._depth&&t.setLocalZOrder(t._depthFixed?t._depth:-t._depth)):0==i&&1==r?(t._sprite.setFlippedX(!1),void 0!==t._depth&&t.setLocalZOrder(t._depthFixed?t._depth:-t._depth)):-1==i&&1==r?(t._sprite.setFlippedX(!0),void 0!==t._depth&&t.setLocalZOrder(t._depthFixed?t._depth:-t._depth)):(t._sprite.setFlippedX(!1),void 0!==t._depth&&t.setLocalZOrder(t._depth))},snapshot:function(e){var t=this;if(void 0===e&&(e=-1),t._currClipName){e<0&&(t.applyPlayToTime(),e=t._playToTime);var i=t.getAnimClipByName(!1,t._currClipName);if(i&&i.getClip()){var r=i.getFrameInfoByTime(e/t._speedRatio*i.getSpeed()),n={};return n.resOptions=i.getAtlasResOptions(),n.frameInfo=r,n}}return null},getCurrFrameTime:function(){return this.applyPlayToTime(),this._playToTime},autoRelease:function(){var e=this;e._autoRelease=!0,!e._sceneVisited||e._hierarchyVisible&&!e._isFinished||e.release()},isAutoRelease:function(){return this._autoRelease},sceneVisited:function(){var e=this;e._sceneVisited||(e._sceneVisited=!0,!e._autoRelease||e._hierarchyVisible&&!e._isFinished||e.release())},clearAllBindNode:function(){var e=this;e._bindNodeByName&&(e._bindNodeByName.forEach(e._releaseBindNode,e),e._bindNodeByName.clear()),e._bindChildren&&e._bindChildren.forEach(e._resetBindChild,e)},_releaseBindNode:function(e,t){t.release()},_resetBindChild:function(e,t){var i=t.child,r=t.depth;this.addChild(i),i.setLocalZOrder(r)},unload:function(){var i=this;i._resource&&(i._clips&&(i._clips.forEach(function(e,t){i._animation.removeClip(t,!0)},i),i._clips.clear()),i._resource.removeClipComplete(i.onClipComplete,i),i._resource=null),i._clearAnimation(),i._loadStarted&&i._url&&b8e.res.unloadRes(i._url,i.onConfigComplete,i),i._loadOptions=null,i._preload=!1,i._highDefinition=!1,i._priority=0,i._loadStarted=!1,i._currResource=null,i._leftBorder=0,i._rightBorder=0,i._topBorder=0,i._bottomBorder=0,i._resourceScale=0,i.setContentScale(1,1),i.onConfigUpdate()},clear:function(){var e=this;e.unload(),e.clearAllBindNode(),e._url=null,e._actionName=null,e._currClipName=null,e._onLoadComplete=null},isFree:function(){return null==this._url},setDefault:function(e){this._defaultUrl!=e&&(this.clearDefault(),this._defaultUrl=e)},clearDefault:function(){var i=this;i._defaultResource&&(i._defaultClips&&(i._defaultClips.forEach(function(e,t){i._animation.removeClip(t,!0)},i),i._defaultClips.clear()),i._defaultResource.removeClipComplete(i.onClipComplete,i),i._defaultResource=null),i._loadDefaultStarted&&i._defaultUrl&&b8e.res.unloadRes(i._defaultUrl,i.onDefaultConfigComplete,i),i._defaultUrl=null,i._loadDefaultStarted=!1},setColorTransfrom:function(e){this._sprite.setColorTransfrom(e)},resetDisplay:function(){var e=this;e._super(),e.lazyActiveInHierarchy=!0,e._clearAnimation();var t=e._sprite;t&&(t.setFlippedX(!1),t.setAnchor(.5,.5),t.setPosition(0,0),t.resetShader(),t.setBlendMode(b8e.BlendMode.NORMAL),t.setColorTransfrom(null)),e._bindAnimator=null,e._bindDisplay=null},invalidate:function(){var e=this;e.clearDefault(),e.clear(),e._sprite&&e._sprite.setVisible(!1),e._super()},restore:function(e,t){this._super(),this.resetAnim(e,t)},recycle:function(){var e=this;e._bindAnimator&&(e._bindAnimator.removeBindNodeChild(e),e._bindAnimator=null),e.soundEffectsEnabled=!1,e.ghostable=!1,e._sceneVisited=!1,e._autoRelease=!1,e._isPlay=!1,e._isFinished=!1,e._actionName=null,e._direction=null,e._adjustDirection=null,e._lastPlayTime=0,e._playToTime=0,e._speedRatio=0,e._depth=void 0,e._depthFixed=!1,e._touchable=!1,e._touchEventEnable&&(e._setAnimatEvents(!1),e._touchEventEnable=!1),e._finishCallbackVec&&b8e.CallBackUtil.removeAllCallBackData(e._finishCallbackVec),e._touchCallbackVec&&b8e.CallBackUtil.removeAllCallBackData(e._touchCallbackVec),e._bindChildren&&(e._bindChildren.forEach(e._removeBindChild,e),e._bindChildren.clear()),e._configCompleteHandler=null,e._configCompleteThis=null,e._asBoundary=!1,e._animationActive=!1,e._type=void 0,e._id=void 0,e._super()},_removeBindChild:function(e,t){var i=t.child;i.setLocalZOrder(0),i.removeFromParent(),i._bindAnimator=null},release:function(){var e=this;e._autoRelease=!1,e._bindDisplay?(e._bindDisplay.removeAnimator(e._type,e._id),e._bindDisplay=null):e.constructor===r?r.put(e):e.destroy()},dispose:function(){var e=this;e._finishCallbackVec&&(e._finishCallbackVec.release(),e._finishCallbackVec=null),e._touchCallbackVec&&(e._touchCallbackVec.release(),e._touchCallbackVec=null),e._bindChildren&&(e._bindChildren.release(),e._bindChildren=null),e._bindNodeByName&&(e._bindNodeByName.release(),e._bindNodeByName=null),e._sprite&&(e._animation&&(e._animation.off("play",e._onAnimationPlay,e),e._animation.off("finished",e._onAnimationFinished,e),e._animation=null),e._sprite.release(),e._sprite=null),e._clips&&(e._clips.release(),e._clips=null),e._defaultClips&&(e._defaultClips.release(),e._defaultClips=null),e._super()},destroy:function(){this.constructor===r&&(r.poolCall||b8e.warn(3170)),this._super()}});r.LAZY_IN_HIERARCHY=!0,r.BATCH_IN_HIERARCHY_NUM=1;var i=new b8e.Pool(r,4096);r.get=function(e,t){return i.get(e,t)},r.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$Animator",e)})();p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e;(e=b8e.BaseDisplay.extends({ctor:function(){this._super(),this._animators=b8e.HashMap.get(),this._animatorList=b8e.LinkedList.get()},_getAnimatorKey:function(e,t){return(void 0===e?"undefined":p(e))!=b8e.TypeNumber?(b8e.error(3326),0):(void 0===t?"undefined":p(t))!=b8e.TypeNumber?(b8e.error(3327),0):b8e.CommonUtil.xyToInt(e,t)},_onConfigUpdate:function(e){this._configCompleteHandler&&this._configCompleteHandler.call(this._configCompleteThis,this,e)},setConfigUpdateHandler:function(e,t){this._configCompleteHandler=e,this._configCompleteThis=t},addAnimator:function(e,t,i,r){var n=this;if(!n.usable)return null;void 0===i&&(i=0),10<n._animators.count()&&b8e.warn(3173);var a=n._getAnimatorKey(e,t),o=n._animators.get(a);return o||((o=b8e.Animator.get(e,t)).isLazy=!1,n._animators.set(a,o),n._animatorList.append(o),n.addChild(o),o._bindDisplay=n),o.setDepth(i,!!r),o.setDirection(n._direction),o.setConfigUpdateHandler(n._onConfigUpdate,n),o},removeAnimator:function(e,t){var i=this;if(i.usable){var r=i._getAnimatorKey(e,t),n=i._animators.get(r);n&&(n._bindDisplay=null,n.release(),i._animatorList.remove(n),i._animators.del(r))}},getAnimator:function(e,t){if(!this.usable)return null;var i=this._getAnimatorKey(e,t);return this._animators.get(i)},forEachAnimator:function(e,t){var i=this;i._forEachParams={callback:e,thisArg:t},i._animatorList.forEach(i._onForEach,i),i._forEachParams=null},_onForEach:function(e){var t=this._forEachParams;if(t){var i=t.callback,r=t.thisArg;i.call(r,e)}},clear:function(){var e=this;e._animatorList.forEach(e._releaseAnimat,e),e._animatorList.clear(),e._animators.clear(),e._direction=null,e._forEachParams=null},_releaseAnimat:function(e){e._bindDisplay=null,e.release()},setDirection:function(e){var t=this;t._direction!=e&&(t._direction=e,t._animatorList.forEach(t._setAnimDire,t))},_setAnimDire:function(e){e.setDirection(this._direction)},getDirection:function(){return this._direction},defaultSurface:function(){this._super(),this._defaultSurface.setAnchor(.5,.5)},dispose:function(){var e=this;e.clear(),e._animators&&(e._animators.release(),e._animation=null),e._animatorList&&(e._animatorList.release(),e._animatorList=null),e._configCompleteHandler=null,e._configCompleteThis=null,e._super()}})).poolCall=!0,b8e.RC("$$b8e","$$ComposeAnimator",e)})(),function(){var e;e=b8e.Object.extends({ctor:function(e){var t=this;t._super(),t._layer=e,t._container=b8e.BaseDisplay.get(),t._layer.addChild(t._container),t._container.setAnchor(0,0),t._container.setPosition(0,0),t._thumbImg=bui.Sprite.get(),t._container.addChild(t._thumbImg),t._tileContainer=b8e.BaseDisplay.get(),t._tileContainer.setAnchor(0,0),t._tileContainer.setPosition(0,0),t._container.addChild(t._tileContainer),t._screenRect={x:0,y:0,width:0,height:0},t._viewRect={x:0,y:0,width:0,height:0},t._offsetPoint={x:0,y:0},t._viewPos={x:0,y:0},t._tiles=b8e.HashMap.get(),t._waitAddBatchTile=[],t._loadTiles=[],t._waitRemoveBatchTile=[],t._unloadTiles=[],t._tmpPoint={x:0,y:0},t.resetProps()},loadThumb:function(e){var t=this;t._dirUrl&&(e=e||"thumb.jpg",t.clearThumbImg(),b8e.log("load "+e+"..."),t._thumbImg.setSize(t._mapWidth,t._mapHeight),t._thumbUrl=t._dirUrl+"/"+e,t._thumbImg.loadTexture(t._thumbUrl,null,null,{priority:b8e.ResMgr.MAP_THUMB_PRIOR}))},clearThumbImg:function(){this._thumbImg.unloadTexture(),this._thumbUrl=null},getThumbUrl:function(){return this._thumbUrl},startRender:function(){this._updatable=!0},stopRender:function(){this._updatable=!1},setConfig:function(e,t){var i=this;i.clear(),i._mapUrl=e?e.replace(/\\/g,"/"):null,i._dirUrl=i._mapUrl?i._mapUrl.substring(0,i._mapUrl.lastIndexOf("/")):null,i._config=t,i.parseMapData(),i.drawMap(),i._container.setSize(i._mapWidth,i._mapHeight)},drawMap:function(){},getConfig:function(){return this._config},getDirUrl:function(){return this._dirUrl},getThumbRatio:function(){return this._thumbRatio},parseMapData:function(){var e=this;e._config&&(e._loadPriority=-10,e._mapWidth=parseInt(e._config.mapWidth),e._mapHeight=parseInt(e._config.mapHeight),e._tileWidth=parseInt(e._config.tileWidth),e._tileHeight=parseInt(e._config.tileHeight),e._mapCols=0<e._tileWidth?Math.ceil(e._mapWidth/e._tileWidth):0,e._mapRows=0<e._tileHeight?Math.ceil(e._mapHeight/e._tileHeight):0,e._thumbRatio=parseInt(e._config.thumbRatio),e._thumbRatio=0<e._thumbRatio?e._thumbRatio:1)},fillInternal:function(){var e=this,t=void 0,i=void 0,r=void 0,n=void 0,a=void 0,o=void 0;if(-1==e._lastStartTileX&&-1==e._lastStartTileY){t=e._startTileY,i=e._endTileY,r=e._startTileX;var s=(n=e._endTileX)-r+1,l=i-t+1,c=(l<s?s:l)>>1>>0,d=r+(s>>1)>>0,_=t+(l>>1)>>0;b8e.ArrayUtil.getRectangularSpiralArray(e,d,_,c,e.fillReject,e.fillProcess)}else{var u=e._startTileX-e._lastStartTileX,h=e._endTileX-e._lastEndTileX,f=e._startTileY-e._lastStartTileY,p=e._endTileY-e._lastEndTileY,g=Math.abs(h)>Math.abs(u)?h:u,m=Math.abs(p)>Math.abs(f)?p:f;if(g<0?-g>e._bufferCols&&(g=-e._bufferCols):g>e._bufferCols&&(g=e._bufferCols),m<0?-m>e._bufferRows&&(m=-e._bufferRows):m>e._bufferRows&&(m=e._bufferRows),0<m)for((t=e._endTileY-m+1)<0&&(t=0),(i=e._endTileY)>=e._mapRows&&(i=e._mapRows-1),(r=e._startTileX)<0&&(r=0),(n=e._endTileX)>=e._mapCols&&(n=e._mapCols-1),a=t;a<=i;a++)for(o=n;r<=o;o--)e.loadTile(o,a);else if(m<0)for((t=e._startTileY)<0&&(t=0),(i=e._startTileY-m-1)>=e._mapRows&&(i=e._mapRows-1),(r=e._startTileX)<0&&(r=0),(n=e._endTileX)>=e._mapCols&&(n=e._mapCols-1),a=i;t<=a;a--)for(o=r;o<=n;o++)e.loadTile(o,a);if(0<g)for((t=e._startTileY)<0&&(t=0),(i=e._endTileY)>=e._mapRows&&(i=e._mapRows-1),(r=e._endTileX-g+1)<0&&(r=0),(n=e._endTileX)>=e._mapCols&&(n=e._mapCols-1),a=t;a<=i;a++)for(o=r;o<=n;o++)e.loadTile(o,a);else if(g<0)for((t=e._startTileY)<0&&(t=0),(i=e._endTileY)>=e._mapRows&&(i=e._mapRows-1),(r=e._startTileX)<0&&(r=0),(n=e._startTileX-g-1)>=e._mapCols&&(n=e._mapCols-1),a=i;t<=a;a--)for(o=n;r<=o;o--)e.loadTile(o,a)}},fillReject:function(e,t,i,r){var n=e+i,a=t+r;return!(n>=this._startTileX&&n<=this._endTileX&&a>=this._startTileY&&a<=this._endTileY)},fillProcess:function(e,t,i,r){var n=e+i,a=t+r;this.loadTile(n,a)},loadTile:function(e,t){var i=this,r=e*i._tileWidth,n=i._mapHeight-t*i._tileHeight-i._tileHeight,a=i.getTileResId(e,t),o=i._tiles.get(a);o||((o=bui.Sprite.get()).setPosition(r,n),o.setSize(i._tileWidth,i._tileHeight),o.data={tileX:e,tileY:t},i._tiles.set(a,o));var s=i._waitAddBatchTile,l=s.indexOf(o);l<0&&(s[s.length]=o),-1<(l=i._waitRemoveBatchTile.indexOf(o))&&i._waitRemoveBatchTile.splice(l,1),-1<(l=i._loadTiles.indexOf(a))&&i._loadTiles.splice(l,1),-1<(l=i._unloadTiles.indexOf(a))&&i._unloadTiles.splice(l,1),i._nextLoadTile()},_nextLoadTile:function(){var e=this,t=e._loadTiles;if(0<e._waitAddBatchTile.length&&t.length<1){var i=e._waitAddBatchTile.shift(),r=i.data.tileX,n=i.data.tileY,a=e.getTileResId(r,n);t.indexOf(a)<0&&(t[t.length]=a),e._onLoadTile(r,n)}},_onLoadTile:function(e,t){var i=this,r=i.getTileResId(e,t),n=i._loadTiles.indexOf(r);if(n<0)i._nextLoadTile(!1);else{i._loadTiles.splice(n,1);var a=i._tiles.get(r);if(a){if(i._tileContainer.addChild(a),!a.isLoaded&&!a.isLoading){var o=i.getTileResUrl(e,t);a.loadTexture(o,null,null,{priority:b8e.ResMgr.MAP_TILE_PRIOR})}i._nextLoadTile()}else i._nextLoadTile(!1)}},_nextUnloadTile:function(){var e=this,t=e._unloadTiles;if(0<e._waitRemoveBatchTile.length&&t.length<1){var i=e._waitRemoveBatchTile.shift(),r=i.data.tileX,n=i.data.tileY,a=e.getTileResId(r,n);t.indexOf(a)<0&&(t[t.length]=a),e._onUnloadTile(r,n)}},_onUnloadTile:function(e,t){var i=this,r=i.getTileResId(e,t),n=i._unloadTiles.indexOf(r);if(n<0)i._nextUnloadTile(!1);else{i._unloadTiles.splice(n,1);var a=i._tiles.get(r);a?(a.removeFromParent(),i._nextUnloadTile()):i._nextUnloadTile(!1)}},getViewGLPos:function(){return this._viewPos},setViewGLPos:function(e,t){this._viewPos.x=e,this._viewPos.y=t,this.refreshView()},refreshView:function(e){var t=this,i=t._viewPos;if(i.x<t._rightBorder&&(i.x=t._rightBorder),i.x>t._leftBorder&&(i.x=t._leftBorder),i.y>t._bottomBorder&&(i.y=t._bottomBorder),i.y<t._topBorder&&(i.y=t._topBorder),t._updatable&&!(t._tileWidth<=0||t._tileHeight<=0)){e&&(t._lastStartTileX=-1,t._lastStartTileY=-1,t._lastEndTileX=-1,t._lastEndTileY=-1,t._lastViewX=-1,t._lastViewY=-1);var r=!0;if(i.x==t._lastViewX&&i.y==t._lastViewY&&(r=!1),t._lastViewX=i.x,t._lastViewY=i.y,r){t._screenRect.x=-i.x,t._screenRect.y=t._mapHeight+i.y-t._viewHeight,t._startTileX=t._screenRect.x/t._tileWidth>>0,t._startTileY=t._screenRect.y/t._tileHeight>>0,t._endTileX=Math.ceil((t._screenRect.x+t._screenRect.width)/t._tileWidth)-1,t._endTileX=t._endTileX>=t._mapCols?t._mapCols-1:t._endTileX,t._endTileY=Math.ceil((t._screenRect.y+t._screenRect.height)/t._tileHeight)-1,t._endTileY=t._endTileY>=t._mapRows?t._mapRows-1:t._endTileY;var n=!0;t._offsetPoint.x=t._screenRect.x%t._tileWidth,t._offsetPoint.y=t._screenRect.y%t._tileHeight;var a=t._startTileX-t._lastStartTileX,o=t._endTileX-t._lastEndTileX,s=t._startTileY-t._lastStartTileY,l=t._endTileY-t._lastEndTileY,c=Math.abs(o)>Math.abs(a)?o:a,d=Math.abs(l)>Math.abs(s)?l:s;0==c&&0==d&&(n=!1),t._viewRect.x=t._offsetPoint.x,t._viewRect.y=t._offsetPoint.y,n&&t.refreshBuffer(),t._lastStartTileX=t._startTileX,t._lastStartTileY=t._startTileY,t._lastEndTileX=t._endTileX,t._lastEndTileY=t._endTileY}}},getContainer:function(){return this._container},getContainerPos:function(){return this._viewPos},containerUIToGLPos:function(e,t){var i=e,r=this._mapHeight-t;return this._tmpPoint.x=i,this._tmpPoint.y=r,this._tmpPoint},containerGLToUIPos:function(e,t){var i=e,r=this._mapHeight-t;return this._tmpPoint.x=i,this._tmpPoint.y=r,this._tmpPoint},refreshBuffer:function(){this._updatable&&(this.clearPeripheral(),this.fillInternal())},clearPeripheral:function(){var e=void 0,t=void 0,i=void 0,r=void 0,n=void 0,a=void 0,o=this;if(-1==o._lastStartTileX&&-1==o._lastStartTileY){for(e=0,t=o._startTileY-1,i=0,r=o._mapCols-1,n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n);for(e=o._endTileY+1,t=o._mapRows-1,i=0,r=o._mapCols-1,n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n);for(e=0,t=o._mapRows-1,i=0,r=o._startTileX-1,n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n);for(e=0,t=o._mapRows-1,i=o._endTileX+1,r=o._mapCols-1,n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n)}else{var s=o._startTileX-o._lastStartTileX,l=o._endTileX-o._lastEndTileX,c=o._startTileY-o._lastStartTileY,d=o._endTileY-o._lastEndTileY,_=Math.abs(l)>Math.abs(s)?l:s,u=Math.abs(d)>Math.abs(c)?d:c;if(0<u)for(e=o._startTileY-u,t=o._startTileY-1,r=0<_?(i=o._startTileX-_,o._endTileX-_):_<0?(i=o._startTileX-_,o._endTileX-_):(i=o._startTileX,o._endTileX),n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n);else if(u<0)for(e=o._endTileY+1,t=o._endTileY-u,r=0<_?(i=o._startTileX-_,o._endTileX-_):_<0?(i=o._startTileX-_,o._endTileX-_):(i=o._startTileX,o._endTileX),n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n);if(0<_)for(t=0<u?(e=o._startTileY-u,o._endTileY-u):u<0?(e=o._startTileY-u,o._endTileY-u):(e=o._startTileY,o._endTileY),i=o._startTileX-_,r=o._startTileX-1,n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n);else if(_<0)for(t=0<u?(e=o._startTileY-u,o._endTileY-u):u<0?(e=o._startTileY-u,o._endTileY-u):(e=o._startTileY,o._endTileY),i=o._endTileX+1,r=o._endTileX-_,n=e;n<=t;n++)for(a=i;a<=r;a++)o.clearTile(a,n)}},clearTile:function(e,t){var i=this;if(0<=e&&e<i._mapCols&&0<=t&&t<i._mapRows){var r=i.getTileResId(e,t),n=i._tiles.get(r);if(n){var a=i._waitAddBatchTile.indexOf(n);-1<a&&i._waitAddBatchTile.splice(a,1);var o=i._waitRemoveBatchTile;(a=o.indexOf(n))<0&&(o[o.length]=n),-1<(a=i._loadTiles.indexOf(r))&&i._loadTiles.splice(a,1),-1<(a=i._unloadTiles.indexOf(r))&&i._unloadTiles.splice(a,1),n.isLoading&&n.unloadTexture(),i._nextUnloadTile()}}},getTileResId:function(e,t){return e+"_"+t},getTileResUrl:function(e,t){var i=this.getTileResId(e,t);return this._dirUrl+"/slices/"+i+".jpg"},getViewSize:function(){return{width:this._viewWidth,height:this._viewHeight}},viewWidth:{get:function(){return this._viewWidth}},viewHeight:{get:function(){return this._viewHeight}},setViewBounds:function(e,t,i,r){this._topBorder=i,this._bottomBorder=r,this._leftBorder=e,this._rightBorder=t},setViewSize:function(e,t){var i=this;i._viewWidth=e,i._viewHeight=t,i._viewRect.x=0,i._viewRect.y=0,i._viewRect.width=i._viewWidth,i._viewRect.height=i._viewHeight,i._screenRect.x=0,i._screenRect.y=0,i._screenRect.width=i._viewWidth,i._screenRect.height=i._viewHeight,i.updateBufferSize()},updateBufferSize:function(){var e=this;e._bufferCols=0<e._tileWidth?Math.ceil(e._viewWidth/e._tileWidth):0,e._bufferRows=0<e._tileHeight?Math.ceil(e._viewHeight/e._tileHeight):0,e._bufferCols=e._bufferCols>e._mapCols?e._mapCols:e._bufferCols,e._bufferRows=e._bufferRows>e._mapRows?e._mapRows:e._bufferRows},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},clearAllTiles:function(){var e=this;e._tiles.forEach(function(e,t){bui.Sprite.put(t)},e),e._tiles.clear(),e._waitAddBatchTile.length=0,e._loadTiles.length=0,e._waitRemoveBatchTile.length=0,e._unloadTiles.length=0},getTileCount:function(){return this._tiles.count()},getCurrTilesResList:function(){var r=[];return this._tiles.forEach(function(e,t){var i=this.getTileResUrl(t.data.tileX,t.data.tileY);r[r.length]=i},this),r},getRenderCount:function(){return this._tileContainer.numChildren},clear:function(){this.clearAllTiles(),this.clearThumbImg(),this.resetProps()},resetProps:function(){var e=this;e._mapWidth=0,e._mapHeight=0,e._mapCols=0,e._mapRows=0,e._tileWidth=0,e._tileHeight=0,e._bufferCols=0,e._bufferRows=0,e._viewPos.x=0,e._viewPos.y=0,e._mapUrl=null,e._dirUrl=null,e._config=null,e._loadPriority=0,e._lastStartTileX=-1,e._lastStartTileY=-1,e._lastViewX=-1,e._lastViewY=-1,e._startTileX=-1,e._startTileY=-1,e._thumbRatio=0,e._updatable=!1}});b8e.RC("$$b8e","$$TileSurface",e)}();p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var u=void 0;(u=b8e.Object.extends({ctor:function(e,t,i){var r=this;void 0===t&&(t=128),void 0===i&&(i=!0),r._container=e,r._fillAlpha=t,r._showLabel=i,r._gridFace=bui.Graphics.get(),r._container.addChild(r._gridFace),r._gridMap=b8e.HashMap.get(),r._labels=b8e.HashMap.get()},setSurface:function(e){this._surface=e,this.redrawGridGraphics()},setScale:function(e){this._gridFace.setScale(e,e)},drawGrid:function(e,t){var i=this;if(i._surface){var r=i._surface.getPixelXByGrid(e.x),n=i._surface.getPixelYByGrid(e.y),a=r,o=i._surface._mapHeight-n,s=i._gridFace.getGraphics();if(s.fillColor=t,s.fillRect(a-(i._surface._gridWidth>>1),o-(i._surface._gridHeight>>1),i._surface._gridWidth,i._surface._gridHeight),i._showLabel&&(0<e.weight||0<e.eventType)){var l=b8e.CommonUtil.xyToInt(e.x,e.y),c=bui.Label.get();c.setAnchor(.5,.5),i._gridFace.addChild(c),c.setFontSize(12),c.setText(e.weight+"-"+e.eventType),c.setPosition(a-(c.width>>1),o-(c.height>>1)),i._labels.set(l,c)}}else b8e.error(3340)},addDraw:function(e,t){var i=b8e.CommonUtil.xyToInt(e.x,e.y);e.color=t,this._gridMap.set(i,e),this.redrawGridGraphics()},clearDraw:function(e){var t=b8e.CommonUtil.xyToInt(e.x,e.y);this._gridMap.del(t),this.redrawGridGraphics()},showWireframe:function(e,t){var i=this;i._showWireframe||(void 0===e&&(e=4280427042),void 0===t&&(t=4278190335),i._wireframeColor=e,i._wireframeCenterColor=t,i._showWireframe=!0,i.redrawGridGraphics())},hideWireframe:function(){var e=this;e._showWireframe&&(e._wireframeColor=0,e._wireframeCenterColor=0,e._showWireframe=!1,e.redrawGridGraphics())},showGridType:function(e){this._showGridType=e,this.redrawGridGraphics()},redrawByGridMap:function(i){this._gridMap.clear(),i&&i.keys().forEach(function(e){var t=i.get(e);this._gridMap.set(e,t)},this);this.redrawGridGraphics()},redrawGridGraphics:function(){var e=this;if(e._gridFace.clear(),e._labels.forEach(function(e,t){t.release()},e),e._labels.clear(),e._surface){p(e._bgColor)===b8e.TypeNumber&&(e._gridFace.fillColor(e._bgColor),e._gridFace.fillRect(0,0,e._surface._mapWidth,e._surface._mapHeight));var t=e._gridMap.values(),o=[];if(t.forEach(function(e){var t=!1,i=null;if(e.type){for(var r in i={r:0,g:0,b:0,a:255},u.drawGridDesc)if(e.type&r&&this._showGridType&r){var n=u.drawGridDesc[r].color;i.r|=n.r,i.g|=n.g,i.b|=n.b,t=!0}}else e.color&&(i=e.color,t=!0);if(t){var a=new cc.Color(i);a.a=this._fillAlpha,this.drawGrid(e,a)}e.line&&o.push(e)},e),1<o.length){o.sort(e._onSortGrid),e._gridFace.lineWidth(5),e._gridFace.strokeColor(4294967040);var i=!1;o.forEach(function(e){var t=this;i?e.line&&t._gridFace.lineTo(e.x*t._surface._gridWidth+(t._surface._gridWidth>>1),t._surface._mapHeight-e.y*t._surface._gridHeight-(t._surface._gridHeight>>1)):e.line?(i=!0,t._gridFace.moveTo(e.x*t._surface._gridWidth+(t._surface._gridWidth>>1),t._surface._mapHeight-e.y*t._surface._gridHeight-(t._surface._gridHeight>>1))):i=!1},e),e._gridFace.stroke()}if(e._showWireframe){e._gridFace.lineWidth(2),e._gridFace.strokeColor(e._wireframeColor);for(var r=e._surface.getGridXByPixel(e._surface._mapWidth),n=0;n<=r;n++){var a=n*e._surface._gridWidth;e._gridFace.moveTo(a,0),e._gridFace.lineTo(a,e._surface._mapHeight)}for(var s=e._surface.getGridYByPixel(e._surface._mapHeight),l=0;l<=s;l++){var c=e._surface._mapHeight-l*e._surface._gridHeight;e._gridFace.moveTo(0,c),e._gridFace.lineTo(e._surface._mapWidth,c)}e._gridFace.stroke(),e._gridFace.lineWidth(2),e._gridFace.strokeColor(e._wireframeCenterColor);var d=e._surface._mapWidth>>1>>0;e._gridFace.moveTo(d,0),e._gridFace.lineTo(d,e._surface._mapHeight);var _=e._surface._mapHeight>>1>>0;_=e._surface._mapHeight-_,e._gridFace.moveTo(0,_),e._gridFace.lineTo(e._surface._mapWidth,_),e._gridFace.stroke()}}},_onSortGrid:function(e,t){return e.index>t.index?-1:e.index<t.index?1:0},setBackgroundColor:function(e){this._bgColor=e,this.redrawGridGraphics()},clear:function(){var e=this;e._bgColor=null,e._wireframeColor=0,e._wireframeCenterColor=0,e._showWireframe=!1,e._showGridType=0,e._gridMap.clear(),e._gridFace.clear(),e._labels.forEach(function(e,t){t.release()},e),e._labels.clear()},destroy:function(){var e=this;e.clear(),e._gridFace.release(),e._gridFace=null,e._container=null,e._surface=null}})).drawGridDesc={},u.drawGridDesc[b8e.MapGridType.UNWALKABLE]={color:{r:255,g:0,b:0,a:255}},u.drawGridDesc[b8e.MapGridType.MASK]={color:{r:0,g:0,b:255,a:255}},u.drawGridDesc[b8e.MapGridType.FIGHT_DEFINE]={color:{r:0,g:255,b:0,a:255}},u.drawGridDesc[b8e.MapGridType.PATH_FINDING_WEIGHT]={color:{r:0,g:0,b:0,a:255}},u.drawGridDesc[b8e.MapGridType.EVENT]={color:{r:255,g:255,b:0,a:255}},b8e.RC("$$b8e","$$GridSurface",u)})(),function(){var e;e=b8e.TileSurface.extends({ctor:function(e){this._super(e)},drawMap:function(){this._super(),this._gridSurface&&this._gridSurface.redrawByGridMap(this._gridMap)},parseMapData:function(){var e=this;e._config&&(e._super(),e._gridWidth=parseInt(e._config.gridWidth),e._gridHeight=parseInt(e._config.gridHeight),e._gridDatas=e._config.gridDatas,0<e._gridWidth&&0<e._gridHeight&&(e._gridMap||(e._gridMap=b8e.HashMap.get()),e._pathFinding||(e._pathFinding=new b8e.Astar),e._gridCols=Math.ceil(e._mapWidth/e._gridWidth),e._gridRows=Math.ceil(e._mapHeight/e._gridHeight),e._pathFinding.setSquares(e._gridCols,e._gridRows),e._gridDatas&&e._gridDatas.forEach(function(e){var t=b8e.CommonUtil.xyToInt(e.x,e.y);this._gridMap.set(t,e),e.type&b8e.MapGridType.UNWALKABLE?this._pathFinding.setNodeIsSolid(e.x,e.y,!0):0<e.weight&&this._pathFinding.setNodeWeight(e.x,e.y,e.weight)},e)))},openGridGraphics:function(){var e=this;e._gridSurface||(e._gridSurface=new b8e.GridSurface(e._container,160),e._gridSurface.setSurface(e),e._gridSurface.redrawByGridMap(e._gridMap))},closeGridGraphics:function(){this._gridSurface&&(this._gridSurface.destroy(),this._gridSurface=null)},getGridSurface:function(){return this._gridSurface},addGrids:function(e,r){var t=this;t._gridMap&&(e.forEach(function(e){var t=b8e.CommonUtil.xyToInt(e.x,e.y),i=this._gridMap.get(t);i||(i=e,this._gridMap.set(t,e)),i.type|=r,r==b8e.MapGridType.UNWALKABLE&&(this._pathFinding.setNodeIsSolid(e.x,e.y,!0),i.weight=this._pathFinding.setNodeWeight(e.x,e.y,0))},t),t._gridSurface&&t._gridSurface.redrawByGridMap(t._gridMap))},removeGrids:function(e,r){var t=this;t._gridMap&&(e.forEach(function(e){var t=b8e.CommonUtil.xyToInt(e.x,e.y),i=this._gridMap.get(t);i&&i.type&r&&(i.type^=r,0==i.type&&this._gridMap.del(t),r==b8e.MapGridType.UNWALKABLE&&this._pathFinding.setNodeIsSolid(e.x,e.y,!1))},t),t._gridSurface&&t._gridSurface.redrawByGridMap(t._gridMap))},hasGrid:function(e,t,i){var r=b8e.CommonUtil.xyToInt(e,t),n=this._gridMap.get(r);return!!(n&&n.type&i)},setGridWeight:function(e,t,i){var r=this;if(r._gridMap){var n=b8e.CommonUtil.xyToInt(e,t),a=r._gridMap.get(n);return a&&a.type!=b8e.MapGridType.UNWALKABLE?(a.weight=r._pathFinding.setNodeWeight(e,t,i),r._gridSurface&&r._gridSurface.redrawByGridMap(r._gridMap),a.weight):0}},setGridEventType:function(e,t,i){var r=this;if(r._gridMap){var n=b8e.CommonUtil.xyToInt(e,t),a=r._gridMap.get(n);return a?(a.eventType=i,r._gridSurface&&r._gridSurface.redrawByGridMap(r._gridMap),a.eventType):0}},getGridEventType:function(e,t){if(this._gridMap){var i=b8e.CommonUtil.xyToInt(e,t),r=this._gridMap.get(i);return r?r.eventType:0}},getGridDatas:function(e){var t=null;return this._gridMap&&(t=this._gridMap.values(),e&&t.sort(this._onSortGrid)),t},_onSortGrid:function(e,t){var i=b8e.CommonUtil.xyToInt(e.x,e.y),r=b8e.CommonUtil.xyToInt(t.x,t.y);return r<i?1:i<r?-1:0},getGridMap:function(){return this._gridMap},getPathFinding:function(){return this._pathFinding},findPath:function(e,t,i,r,n,a){return this._pathFinding?this._pathFinding.findPath(e,t,i,r,!!n,!!a):null},gridIsSolid:function(e,t){return!!this._pathFinding&&this._pathFinding.isSolid(e,t)},gridIsSpecifyType:function(e,t,i){var r=this._gridMap;if(r){var n=b8e.CommonUtil.xyToInt(e,t),a=r.get(n);if(a&&a.type&i)return!0}return!1},getSpaceGrids:function(){var e=this,t=e._spaceGrids;if(!t){t=e._spaceGrids=[];for(var i=0;i<e._gridCols;i++)for(var r=0;r<e._gridRows;r++)if(!e.hasGrid(i,r,b8e.MapGridType.UNWALKABLE)){var n={x:i,y:r};t[t.length]=n}}return t},getPixelXByGrid:function(e){return(e+.5)*this._gridWidth>>0},getPixelYByGrid:function(e){return(e+.5)*this._gridHeight>>0},getGridXByPixel:function(e){return e/this._gridWidth>>0},getGridYByPixel:function(e){return e/this._gridHeight>>0},clear:function(){var e=this;e._super(),e._gridWidth=0,e._gridHeight=0,e._gridCols=0,e._gridRows=0,e._gridDatas=null,e._spaceGrids&&(e._spaceGrids.length=0,e._spaceGrids=null),e._gridMap&&e._gridMap.clear(),e._pathFinding&&e._pathFinding.clear(),e._gridSurface&&e._gridSurface.clear()}}),b8e.RC("$$b8e","$$EarthSurface",e)}(),function(){var e;e=b8e.Object.extends({ctor:function(e){var t=this;t._super(),t._scene=e,t._container=b8e.BaseDisplay.get(),t._container.setAnchor(0,0),t._container.setPosition(0,0),t._container.setLocalZOrder(1),t._scene._container.addChild(t._container),t._earthSurface=new b8e.EarthSurface(t._container)},getContainer:function(){return this._container},getViewSize:function(){return this._earthSurface.getViewSize()},viewWidth:{get:function(){return this._earthSurface.viewWidth}},viewHeight:{get:function(){return this._earthSurface.viewHeight}},getMapWidth:function(){return this._earthSurface?this._earthSurface.getMapWidth():0},getMapHeight:function(){return this._earthSurface?this._earthSurface.getMapHeight():0},getEarthSurface:function(){return this._earthSurface},getConfig:function(){return this._earthSurface.getConfig()},getMapUrl:function(){return this._mapUrl},getViewGLPos:function(){return this._earthSurface.getViewGLPos()},setViewGLPos:function(e,t){this._earthSurface.setViewGLPos(e,t)},getPixelXByGrid:function(e){return this._earthSurface?this._earthSurface.getPixelXByGrid(e):0},getPixelYByGrid:function(e){return this._earthSurface?this._earthSurface.getPixelYByGrid(e):0},getGridXByPixel:function(e){return this._earthSurface?this._earthSurface.getGridXByPixel(e):0},getGridYByPixel:function(e){return this._earthSurface?this._earthSurface.getGridYByPixel(e):0},startRender:function(){this._container.setVisible(!0),this._earthSurface.startRender()},stopRender:function(){this._container.setVisible(!1),this._earthSurface.stopRender()},loadMap:function(e,t,i){b8e.log("loadMap...");var r=this;r.clear(),r._onLoadComplete=t,r._onLoadCompleteThis=i,r._mapUrl=e.replace(/\\/g,"/");var n=b8e.proto.map.MapConfigMessage;b8e.res.loadRes(r._mapUrl,b8e.ProtobufConfig,r.onConfigComplete,r,null,{proto:n,priority:b8e.ResMgr.MAP_CFG_PRIOR})},onConfigComplete:function(e,t){var i=this;e?(b8e.error(e),i._onLoadComplete&&i._onLoadComplete.call(i._onLoadCompleteThis,e,null)):(b8e.log("loadMap finish!"),i.setMapConfig(i._mapUrl,t.getProtoData()),i._onLoadComplete&&i._onLoadComplete.call(i._onLoadCompleteThis,null,i))},setMapConfig:function(e,t){this._earthSurface.setConfig(e,t),e&&t&&this._earthSurface.loadThumb(t.thumbFileName)},setViewSize:function(e,t){this._earthSurface&&this._earthSurface.setViewSize(e,t)},setViewBounds:function(e,t,i,r){this._earthSurface&&this._earthSurface.setViewBounds(e,t,i,r)},refreshView:function(){this._earthSurface&&this._earthSurface.refreshView(!0)},getContainerPos:function(){return this._earthSurface.getContainerPos()},mapUIToGLPos:function(e,t){return this._earthSurface.containerUIToGLPos(e,t)},mapGLToUIPos:function(e,t){return this._earthSurface.containerGLToUIPos(e,t)},clear:function(){var e=this;e._mapUrl&&(b8e.res.unloadRes(e._mapUrl,e.onConfigComplete,e),e._mapUrl=null),e._onLoadComplete=null,e._onLoadCompleteThis=null,e._earthSurface.clear()},getTileCount:function(){return this._earthSurface.getTileCount()},getRenderCount:function(){return this._earthSurface.getRenderCount()}}),b8e.RC("$$b8e","$$SceneMapLayer",e)}(),function(){var e;e=b8e.Object.extends({ctor:function(e){var t=this;t._super(),t._container=e,t._bufferContainer=b8e.BaseDisplay.get(),t._container.addChild(t._bufferContainer),t._bufferContainer.setAnchor(0,0),t._bufferContainer.setPosition(0,0),t._thumbImg=bui.Sprite.get(),t._bufferContainer.addChild(t._thumbImg)},load:function(e,t){var i=this;i.clear(),b8e.log("loadThumb..."),i._thumbUrl=e,i._thumbRatio=t,i._thumbImg.loadTexture(i._thumbUrl,null,null,{useManifest:!1})},setSize:function(e,t){this._thumbImg.setSize(e,t)},openGridGraphics:function(){this._gridSurface||(this._gridSurface=new b8e.GridSurface(this._bufferContainer,192,!1))},closeGridGraphics:function(){this._gridSurface&&(this._gridSurface.destroy(),this._gridSurface=null)},getGridSurface:function(){return this._gridSurface},setTileSurface:function(e){this._gridSurface&&(this._gridSurface.setSurface(e),this._gridSurface.redrawByGridMap(e._gridMap),this._gridSurface.setScale(1/e._thumbRatio))},clearThumbImg:function(){this._thumbImg.unloadTexture(),this._thumbUrl=null,this._thumbRatio=0},clear:function(){this.clearThumbImg(),this._gridSurface&&this._gridSurface.clear()}}),b8e.RC("$$b8e","$$ThumbSurface",e)}(),function(){var e,i=e=b8e.Object.extends({ctor:function(e,t){var i=this;i._super(),i._scene=e,i._container=b8e.BaseDisplay.get(),i._container.setAnchor(0,0),i._container.setPosition(0,0),i._container.setLocalZOrder(2),i._scene._container.addChild(i._container),i._displayList=b8e.LinkedList.get(),i._releaseList=b8e.LinkedList.get(),i._displayIdMap=b8e.HashMap.get(),i._displayTypeMap=b8e.HashMap.get(),i._currRenderLimitNumByType={},i._lastRenderLimitNumByType={},i._maxRenderLimitNumByType={},i._maxOtherRenderLimitNum=-1,i._currOtherRenderLimitNum=0,i._lastOtherRenderLimitNum=0,i._renderCount=0,i._lastRenderCount=0,i._nextDisplay=null,i._visible=!0,i._arrivalIndex=0,i._viewFilter=t,i._nextQueueTime=0},setVisible:function(e){this._visible!=e&&(this._visible=e,this._container.setVisible(this._visible))},setViewFilter:function(e){this._viewFilter=e},onSceneLoaded:function(){this._displayList.forEach(this._onDisplaySceneLoaded,this)},_onDisplaySceneLoaded:function(e){e.onSceneLoaded()},addDisplay:function(e,t,i,r,n,a){var o=this;if(e)if(void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===n&&(n=!0),void 0===a&&(a=0),e.__SceneDisplay){if(!e.usable)return void b8e.error(3328);if(e.getScene())return void b8e.error(3329);if(o._displayList.has(e))b8e.warn(3182);else{e.fovLimitable=i,e.renderLimitable=r,e.isSceneLazy=n;var s=e.type,l=e.id;if(void 0!==s&&void 0!==l){var c=o._displayTypeMap.get(s);if(c||(c=b8e.HashMap.get(),o._displayTypeMap.set(s,c)),c.get(l))return void b8e.error(3330,s,l);if(c.set(l,e),e.isUniqueId){if(o._displayIdMap.get(l))return void b8e.error(3331,l);o._displayIdMap.set(l,e)}}if(o._displayList.append(e),e.setFixedLocalZOrder(t),e._setScene(o._scene),o._arrivalIndex++,e.arrivalOrder=o._arrivalIndex,0<a){var d=b8e.getTimer();o._nextQueueTime<d&&(o._nextQueueTime=d),o._nextQueueTime+=a,e.queueDelay=o._nextQueueTime}n||o.displayViewState(e)}}else b8e.error(3183)},removeDisplay:function(e,t){if(e&&(void 0===t&&(t=!0),this._driveOutDisplay(e),t))if(e.__SceneDisplay){if(!e.usable)return void b8e.error(3332);e.release()}else b8e.error(3333)},_driveOutDisplay:function(e){var t=this;if(e)if(e.__SceneDisplay){if(!e.usable)return void b8e.error(3334);if(!e.getScene())return void b8e.error(3335);if(t._displayList.has(e)){var i=t._scene.getCamera();i.getFocusTarget()==e&&i.setFocusTarget(null),e.setFixedLocalZOrder(void 0),t._nextDisplay===e&&(t._nextDisplay=t._displayList.getNext(e)),t._displayList.remove(e);var r=e.type,n=e.id;if(void 0!==r&&void 0!==n){var a=t._displayTypeMap.get(r);a&&a.del(n),e.isUniqueId&&t._displayIdMap.del(n)}e.removeFromParent(),e._setScene(null)}else b8e.warn(3184)}else b8e.error(3185)},getDisplayByType:function(e){var t=this._displayTypeMap.get(e);return t?t.values():[]},getCountByType:function(e){var t=this._displayTypeMap.get(e);return t?t.count():0},getDisplayById:function(e){return this._displayIdMap.get(e)},getDisplayByTypeAndId:function(e,t){var i=null,r=this._displayTypeMap.get(e);return r&&(i=r.get(t)),i},removeDisplayByType:function(e){for(var t=this.getDisplayByType(e),i=t.length-1;0<=i;i--){t[i].release()}},removeDisplayById:function(e){var t=this.getDisplayById(e);t&&t.release()},removeDisplayByTypeAndId:function(e,t){var i=null,r=this._displayTypeMap.get(e);return r&&(i=r.get(t)),!!i&&(i.release(),!0)},modifyDisplayId:function(e,t){var i=e.id;if(i!=t){var r=e.type,n=this._displayTypeMap.get(r);n.get(t)?b8e.error(3336,r,t):!e.isUniqueId||this._displayIdMap.get(t)?b8e.error(3337,t):n.get(i)?(e._modifyId(t),n.del(i),n.set(e.id,e),e.isUniqueId&&(this._displayIdMap.del(i),this._displayIdMap.set(e.id,e))):b8e.warn(3186)}},getDisplays:function(){return this._displayList},getContainer:function(){return this._container},getDisplayCount:function(){return this._displayList.count()},getRenderCount:function(){return this._lastRenderCount},getCurrOtherRenderNum:function(){return this._lastOtherRenderLimitNum},getMaxOtherRenderNum:function(){return this._maxOtherRenderLimitNum},setMaxOtherRenderNum:function(e){this._maxOtherRenderLimitNum=e,this._currOtherRenderLimitNum=0,this._lastOtherRenderLimitNum=0},getCurrRenderNum:function(e){var t=this._lastRenderLimitNumByType[e];return t?t.count:0},getMaxRenderNum:function(e){var t=this._maxRenderLimitNumByType[e];return t?t.count:0},setMaxRenderNum:function(e,t){var i=this;if(-1<t){var r=i._maxRenderLimitNumByType[e];r||(r={attaches:{},count:0},i._maxRenderLimitNumByType[e]=r),r.count=t,(r=i._currRenderLimitNumByType[e])||(r={attaches:{},count:0,limitCount:0},i._currRenderLimitNumByType[e]=r),r.count=0,r.limitCount=0,(r=i._lastRenderLimitNumByType[e])||(r={count:0,limitCount:0},i._lastRenderLimitNumByType[e]=r),r.count=0,r.limitCount=0}else delete i._maxRenderLimitNumByType[e],delete i._currRenderLimitNumByType[e],delete i._lastRenderLimitNumByType[e]},getMaxAttachNum:function(e,t){var i=this._maxRenderLimitNumByType[e],r=i?i.attaches[t]:void 0;return void 0===r?0:r},setMaxAttachNum:function(e,t,i){var r=void 0;-1<i?(r=this._maxRenderLimitNumByType[e])?(r.attaches[t]=i,(r=this._currRenderLimitNumByType[e])&&(r.attaches[t]=0)):b8e.error(3338,e,t):((r=this._maxRenderLimitNumByType[e])&&delete r.attaches[t],(r=this._currRenderLimitNumByType[e])&&delete r.attaches[t])},isOtherRenderLimit:function(){return-1<this._maxOtherRenderLimitNum&&this._lastOtherRenderLimitNum>=this._maxOtherRenderLimitNum},isRenderLimit:function(e){var t=this._maxRenderLimitNumByType[e];if(t){var i=t.count;if(t=this._lastRenderLimitNumByType[e])return t.limitCount>=i}return!1},displayViewState:function(e){var t=this;if(e.usable){var i=t._maxRenderLimitNumByType[e.type],r=t._currRenderLimitNumByType[e.type];r&&r.count++;var n=t._visible;if(n){if(e.fovLimitable){var a=t._scene.getViewSize(),o=t._scene.sceneGLToViewGLPos(e.x,e.y);n=0<=o.x&&o.x<=a.width&&0<=o.y&&o.y<=a.height}n&&t._viewFilter&&(n=t._viewFilter(e))}if(n&&e.renderLimitable)if(i&&r){var s=i.count;r.limitCount>=s?n=!1:r.limitCount++}else-1<t._maxOtherRenderLimitNum&&(t._currOtherRenderLimitNum>=t._maxOtherRenderLimitNum?n=!1:t._currOtherRenderLimitNum++);if(n&&i&&r)for(var l in i.attaches){var c=!0,d=i.attaches[l],_=r.attaches[l];if(void 0!==d&&void 0!==_&&(d<=_?c=!1:(_++,r.attaches[l]=_)),e.attachLimitable){var u=parseInt(l);-1<e.attachLimitable.indexOf(u)&&e.applyAttachVisible(u,c)}}if(n){if(!e.parent)if(e.isSceneLazy){var h=e.queueDelay;if(0<h)h<=b8e.getTimer()&&t._container.addChild(e);else t._container.addChild(e)}else t._container.addChild(e);t._renderCount++}else e.parent&&e.removeFromParent();e.usable&&e.sceneVisit(n)}else b8e.error(3339)},updateDisplayState:function(){for(var e=this._nextDisplay,t=0;t<i.MAX_BATCH_DISPLAY&&e;)this.displayViewState(e),e=this._nextDisplay=this._displayList.getNext(e),t++},startRender:function(){this._nextQueueTime=0,b8e.ticker.startTick(this.onUpdate,this,0,0)},stopRender:function(){b8e.Ticker.remove(this,this.onUpdate)},onUpdate:function(){this._visible&&(this._nextDisplay?this.updateDisplayState():this.resetViewState())},resetViewState:function(){var e=this,t=void 0,i=void 0,r=void 0,n=void 0;for(t in e._currRenderLimitNumByType)for(t in i=e._currRenderLimitNumByType[t],(r=e._lastRenderLimitNumByType[t]).count=i.count,r.limitCount=i.limitCount,i.count=0,i.limitCount=0,n=i.attaches)n[t]=0;e._lastOtherRenderLimitNum=e._currOtherRenderLimitNum,e._lastRenderCount=e._renderCount,e._currOtherRenderLimitNum=0,e._renderCount=0,e._nextDisplay=e._displayList.head()},resetLastState:function(){var e=void 0,t=void 0;for(e in this._lastRenderLimitNumByType)(t=this._lastRenderLimitNumByType[e]).count=0,t.limitCount=0;this._lastOtherRenderLimitNum=0,this._lastRenderCount=0},_onReleaseDisplay:function(e,t){!t&&e.clearDisabled||this._releaseList.append(e)},clear:function(e){var t=this,i=t._releaseList;for(i.clear(),t._displayList.forEach(t._onReleaseDisplay,t,!!e);0<i.count();){i.shift().release()}t._nextDisplay=null,t._arrivalIndex=0,t.resetViewState(),t.resetLastState()},destroy:function(){var e=this;e.clear(!0),e._scene=null,e._container.release(),e._container=null,e._displayList.release(),e._displayList=null,e._releaseList.release(),e._releaseList=null,e._displayIdMap.release(),e._displayIdMap=null,e._displayTypeMap.forEach(function(e,t){t.release()},e),e._displayTypeMap.release(),e._displayTypeMap=null,e._currRenderLimitNumByType=null,e._lastRenderLimitNumByType=null,e._maxRenderLimitNumByType=null,e._maxOtherRenderLimitNum=0,e._viewFilter=null}});i._onDisplaySort=function(e,t){var i=e._scene,r=t._scene;if(i&&!r)return 1;if(!i&&r)return-1;if(i&&r){if(e.isSceneLazy&&!t.isSceneLazy)return-1;if(!e.isSceneLazy&&t.isSceneLazy)return 1;if(void 0===e.fixedLocalZOrder&&void 0!==t.fixedLocalZOrder)return-1;if(void 0!==e.fixedLocalZOrder&&void 0===t.fixedLocalZOrder)return 1;if(e.fixedLocalZOrder<t.fixedLocalZOrder)return 1;if(e.fixedLocalZOrder>t.fixedLocalZOrder)return-1;if(e.interactTime>t.interactTime)return 1;if(e.interactTime<t.interactTime)return-1;var n=i.getCamera(),a=n.getFocusTarget(),o=void 0,s=void 0;if(a)o=a.x,s=a.y;else{var l=n.getSceneGLPos();o=l.x,s=l.y}var c=b8e.MathUtil.getDistanceNoSqrt(o,s,e.x,e.y),d=b8e.MathUtil.getDistanceNoSqrt(o,s,t.x,t.y);if(d<c)return-1;if(c<d)return 1;if(e.parent&&t.parent){if(e.arrivalOrder>t.arrivalOrder)return-1;if(e.arrivalOrder<t.arrivalOrder)return 1}else{if(e.parent&&!t.parent)return 1;if(!e.parent&&t.parent)return-1}}return 0},i.MAX_BATCH_DISPLAY=5,b8e.RC("$$b8e","$$SceneEntityLayer",e)}(),function(){var e;(e=b8e.ComposeAnimator.extends({ctor:function(){this._super()},dispose:function(){this._super()}})).poolCall=!0,b8e.RC("$$b8e","$$Avatar",e)}(),function(){var e,n=e=b8e.SceneDisplay.extends({ctor:function(e,t,i){var r=this;r.constructor===n&&(n.poolCall||b8e.warn(3174)),r._super(),r._atlasUrls=[],r._spParts=[],r._avatar=e,r._duration=t,r.playGhost(i)},restore:function(e,t,i){this._super(),this._avatar=e,this._duration=t,this.playGhost(i)},playGhost:function(_){var e=this;void 0===_&&(_=0);e._avatar.localToGlobal();e._avatar.forEachAnimator(function(e){var t=this;if(e.ghostable){var i=e.getCurrFrameTime(),r=e.snapshot(i+_);if(r){var n=bui.Sprite.get();t._spParts.push(n);e.localToGlobal();var a=e._sprite.getFlippedX(),o=e.contentScaleX,s=e.contentScaleY,l=e.getLocalZOrder();n.setAnchor(.5,.5),n.setFlippedX(a),n.setContentScale(o,s),n.setLocalZOrder(l);var c=r.resOptions,d=r.frameInfo;c&&d?t._atlasUrls.indexOf(c.url)<0&&(t._atlasUrls.push(c.url),b8e.res.loadRes(c.url,c.type,t.onAtlasComplete,t,[d,n],c)):b8e.warn(3175,e._url,e._currClipName)}}},e),b8e.Tween.get(e).to({alpha:0},e._duration).call(e.release,e)},onAtlasComplete:function(e,t,i,r){if(t){this.addChild(r);var n=t.getSpriteFrame(i.name);r.setFrame(n)}},recycle:function(){var e=this;b8e.Tween.kill(e),e._atlasUrls.forEach(function(e){b8e.res.unloadRes(e,this.onAtlasComplete,this)},e),e._atlasUrls.length=0,e._spParts.forEach(function(e){e.release()},e),e._spParts.length=0,e._avatar=null,e._duration=0,e._super()},release:function(){this.constructor===n?n.put(this):this.destroy()},dispose:function(){this._atlasUrls=null,this._spParts=null,this._super()},destroy:function(){this.constructor===n&&(n.poolCall||b8e.warn(3176)),this.recycle(),this.dispose()}}),r=new b8e.Pool(n,1024);n.get=function(e,t,i){return r.get(e,t,i)},n.put=function(e){return r.put(e)},b8e.RC("$$b8e","$$AvatarGhost",e)}(),function(){var e,r=e=b8e.SceneDisplay.extends({ctor:function(e,t){var i=this;i.constructor===r&&(r.poolCall||b8e.warn(3177)),i._super(e,t),i._avatar=new b8e.Avatar,i._avatar.clearDisabled=!0,i.addChild(i._avatar),i._touchable=!1,i._autoRelease=!1,i._ghostSpacing=0,i._ghostDuration=0},getAvatar:function(){return this._avatar},setTouchable:function(e){this._touchable!=e&&(this._touchable=e,this._avatar.forEachAnimator(function(e){var t=this;t._touchable?e.addTouchCallback(t._onAnimTouchCallback,t):e.removeTouchCallback(t._onAnimTouchCallback,t)},this))},getTouchable:function(){return this._touchable},addAnimator:function(e,t,i,r){var n=this;if(!n.usable)return null;var a=n._avatar.getAnimator(e,t),o=n._avatar.addAnimator(e,t,i,r);return a?b8e.warn(3178,e,t):(o._bindDisplay=n)._touchable&&o.addTouchCallback(n._onAnimTouchCallback,n),o},getAnimator:function(e,t){return this.usable?this._avatar.getAnimator(e,t):null},removeAnimator:function(e,t){var i=this;if(i.usable){var r=i._avatar.getAnimator(e,t);if(r){if(i._touchable&&r.removeTouchCallback(i._onAnimTouchCallback,i),!i._invalid){if(i._autoRelease&&r.isAutoRelease())return void i.release();i._avatar.removeAnimator(e,t)}}else b8e.warn(3179,e,t)}},_onAnimTouchCallback:function(){this._scene&&this._scene.dispatchEventWith(b8e.SceneEvent.SCENE_ENTITY_CLICK,this,null,null,!1)},forEachAnimator:function(t,i){var r=this;r._avatar.forEachAnimator(function(e){t.call(i,r,e)},r)},animAutoRelease:function(e,t){var i=this._avatar.getAnimator(e,t);i?(this._autoRelease=!0,i.autoRelease()):b8e.warn(3180,e,t)},onSceneVisit:function(){this._super(),this._avatar.forEachAnimator(function(e){e.sceneVisited()},this)},restore:function(e,t){this._super(e,t)},recycle:function(){var e=this;e._avatar&&(e._avatar.forEachAnimator(function(e){this._touchable&&e.removeTouchCallback(this._onAnimTouchCallback,this)},e),e._avatar.clear()),e._touchable=!1,e._autoRelease=!1,e._super()},release:function(){this.constructor===r?r.put(this):this.destroy()},setFaceRadian:function(e){var t=b8e.CommonUtil.getDirectionByRadian(e);this.setDirection(t)},setDirection:function(e){this._avatar.setDirection(e)},getDirection:function(){return this._avatar.getDirection()},faceTo:function(e,t){var i=this.getScenePosition(),r=b8e.MathUtil.getRadian(i.x,i.y,e,t);return this.setFaceRadian(-r),r},faceToGrid:function(e,t){var i=this;if((i._faceToGridX!=e||i._faceToGridY!=t)&&(i._faceToGridX=e,i._faceToGridY=t,i._scene&&i._scene.isLoaded())){var r=i.getGridPosition();if(r.x!=i._faceToGridX||r.y!=i._faceToGridY){var n=i._scene.getPixelPosByGrid(i._faceToGridX,i._faceToGridY);i.faceTo(n.x,n.y)}}},setGhost:function(e,t){var i=this;i._ghostSpacing=0<e?e:0,i._ghostDuration=0<t?t:0,i._lastGhostPos={x:i._disX,y:i._disY}},onSceneLoaded:function(){var e=this;if(e._scene&&e._scene.isLoaded()&&(e._super(),0<=e._faceToGridX&&0<=e._faceToGridY)){var t=e.getGridPosition();if(t.x==e._faceToGridX&&t.y==e._faceToGridY)return;var i=e._scene.getPixelPosByGrid(e._faceToGridX,e._faceToGridY);e.faceTo(i.x,i.y)}},syncPosition:function(){var e=this;if((e._super(),e._hierarchyVisible&&0<e._ghostSpacing&&0<e._ghostDuration)&&b8e.MathUtil.getDistanceNoSqrt(e._lastGhostPos.x,e._lastGhostPos.y,e._disX,e._disY)>=e._ghostSpacing*e._ghostSpacing){var t=b8e.AvatarGhost.get(e._avatar,e._ghostDuration);t.setPosition(e._disX,e._disY),e._scene?e._scene.addDisplay(t,void 0,!0,!0,!1):e.parent.addChild(t),e._lastGhostPos.x=e._disX,e._lastGhostPos.y=e._disY}},resetDisplay:function(){var e=this;e._faceToGridX=-1,e._faceToGridY=-1,e._ghostSpacing=0,e._ghostDuration=0,e._lastGhostPos=null,e._super()},dispose:function(){this._avatar&&(this._avatar.destroy(),this._avatar=null),this._super()},destroy:function(){this.constructor===r&&(r.poolCall||b8e.warn(3181)),this.recycle(),this.dispose()}}),i=new b8e.Pool(r,4096);r.get=function(e,t){return i.get(e,t)},r.put=function(e){return i.put(e)},b8e.RC("$$b8e","$$SceneEntity",e)}();p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e,i=e=b8e.Object.extends({ctor:function(e){var t=this;t._scene=e,t._cameraX=0,t._cameraY=0,t._cameraDistance=0,t._distanceRatio=1e3,t._sceneScale=1,t._mode=i.ThirdPersonMode,t._transitionPos={x:0,y:0}},_setPosition:function(e,t){var i=this,r=i._scene.getViewSize(),n=(i._scene.getSceneSize(),e-(r.width>>1)/i._sceneScale),a=t+(r.height>>1)/i._sceneScale,o=i._scene.viewUIToGLPos(-n,-a);i._scene._applyViewPos(o.x,o.y),i.applyCamera()},setFocus:function(e,t,i){var r=this,n=r._scene.getViewSize();b8e.Tween.kill(r._transitionPos),void 0===i&&(i=0),0<i?(r._transitionPos.x=r._cameraX,r._transitionPos.y=r._cameraY,b8e.Tween.get(r._transitionPos,{onUpdate:function(){this._setPosition(this._transitionPos.x,this._transitionPos.y)},onUpdateThis:r}).to({x:e,y:t-n.height},i)):r._setPosition(e,t-n.height)},focusX:{get:function(){return this._cameraX}},focusY:{get:function(){var e=this._scene.getViewSize();return this._cameraY+e.height}},getSceneGLPos:function(){return this._scene.sceneUIToGLPos(this._cameraX,this._cameraY)},applyCamera:function(){var e=this,t=e._scene.getViewportPos(),i=e._scene.getViewSize();e._cameraX=t.x+(i.width>>1)/e._sceneScale,e._cameraY=t.y-(i.height>>1)/e._sceneScale},setDistance:function(e){var t=this;t._cameraDistance=0<e?e:t._distanceRatio,t._sceneScale=t._distanceRatio/t._cameraDistance,t._scene.updateSceneScale(),t._setPosition(t._cameraX,t._cameraY),t._scene.dispatchEventWith(b8e.CameraEvent.CAMERA_DISTANCE_CHANGE,t)},getDistance:function(){return this._cameraDistance},getSceneScale:function(){return this._sceneScale},syncTargetFocus:function(){this._focusTarget&&this.syncInfo(this._focusTarget.getPosition(),this._focusTarget.getRotation())},setFocusTarget:function(e){var t=this;t._focusTarget!=e&&(t._focusTarget&&(t._focusTarget.__BaseDisplay&&t._focusTarget.removeSyncInfo(t),t._focusTarget=null,t._focusSyncInfo=null),e&&(e.__BaseDisplay?(t._focusTarget=e,t._focusSyncInfo=new b8e.DisplaySyncInfo(t),t._focusTarget.addSyncInfo(t._focusSyncInfo,!0)):b8e.error(3341,void 0===e?"undefined":p(e))))},getFocusTarget:function(){return this._focusTarget},syncInfo:function(e){this._mode==i.ThirdPersonMode&&(e=this._scene.sceneGLToUIPos(e.x,e.y),this.setFocus(e.x,e.y))},setMode:function(e){var t=this;t._mode=e,b8e.Tween.kill(t._transitionPos),t._mode==i.ThirdPersonMode&&t._setPosition(t._cameraX,t._cameraY)}});i.FirstPersonMode=1,i.ThirdPersonMode=2,b8e.RC("$$b8e","$$SceneCamera",e)})(),function(){var e;e=bui.SkinWidget.extends({ctor:function(){this._super()},setGuideData:function(){},setDirection:function(e){return e}}),b8e.RC("$$b8e","$$BaseGuideView",e)}(),function(){var r=b8e.ShaderUtil=function(){};r.defaultShader=null,r.grayShader=null,r.setGray=function(e,t){if(b8e.renderType===b8e.RenderType.WEBGL){if(!r.grayShader){var i=new b8e.ShaderProgram;i.setIsMix(!0),i.getColorTransfrom().setMultiplier([.2126,.7152,.0722,1]),i.update(!0),b8e.ShaderProgram.applyGlProgram(i),r.grayShader=i}r.setShader(e,r.grayShader.glProgram,t)}},r.reset=function(e,t){if(b8e.renderType===b8e.RenderType.WEBGL){if(!r.defaultShader){var i=new b8e.ShaderProgram;i.update(!0),b8e.ShaderProgram.applyGlProgram(i),r.defaultShader=i}r.setShader(e,r.defaultShader.glProgram,t)}},r.setShader=function(e,t,i){t&&e&&(e.__BaseDisplay?e=e.getNode():e instanceof cc.Node||(e=e instanceof cc.Sprite?e.node:null),e&&r.setChildShader(e,t,i))},r.setChildShader=function(e,t,i){}}(),b8e.ArrayUtil=function(){},b8e.ArrayUtil.getRectangularSpiralArray=function(i,r,n,a,o,s){a=Math.ceil(a);var l=[],c=[],d=void 0,e=void 0,t=void 0;for(e=0;e<=a;e++){for(t=-e;t<=e;t++)_(t,-e);for(t=-e;t<=e;t++)_(e,t);for(t=e;-e<=t;t--)_(t,e);for(t=e;-e<=t;t--)_(-e,t)}function _(e,t){d=b8e.CommonUtil.xyToInt(a+e,a+t),c.indexOf(d)<0&&(null==o||!o.call(i,r,n,e,t))&&(l[l.length]=[e,t],c[c.length]=d,null!=s&&s.call(i,r,n,e,t))}return l};p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e=void 0,n=b8e.ProtoBuf;(e=b8e.Object.extends({ctor:function(){if(e._singleton)throw new Error("\u53ea\u80fd\u901a\u8fc7getInstance()\u6765\u83b7\u53d6ProtobufManager\u5b9e\u4f8b\uff01");this._messages=b8e.HashMap.get()},loadProto:function(e,i){var r=this;b8e.res.loadRes(e,function(e,t){e?(b8e.error(e),i&&i(e)):(b8e.log("loadProto finish!"),r._builder=n.protoFromString(t),i&&i(null,r._builder))},this)},loadProtoFile:function(e,i){var r=this;n.loadProtoFile(e,function(e,t){e?(b8e.error("loadProtoFile failed!",e),i&&i(e)):(b8e.log("loadProtoFile complete!"),r._builder=t,i&&i(null,r._builder))})},buildClass:function(e){if(this._builder){var t=this._messages.getValue(e);return t||((t=this._builder.build(e))?(this._messages.setValue(e,t),b8e.log("build proto finish!",e)):b8e.error("build Message failed!")),t}return b8e.error("builder not init!"),null},decodeMessage:function(e,t){var i=this.buildClass(t);if(i){var r=e.buffer;return i.decode(r)}return null},buildMessage:function(e,r,n,a){var o=this;b8e.res.loadRes(e,function(e,t){if(e)b8e.error(e),n&&n.call(a,e);else if(b8e.log("buildMessage finish!",void 0===t?"undefined":p(t),t),n){var i=o.decodeMessage(t,r);n.call(a,null,i)}},this)}}))._instance=null,e._singleton=!0,e.inst=function(){return e._instance||(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$b8e","$$ProtobufMgr",e)})(),function(){var e,t=e=b8e.Object.extends({_modalZOrder:9992,_modalViewOrder:9990,_guideViewOrder:9998,_imageOrder:9994,_textOrder:9995,_effectOrder:9996,ctor:function(){var e=this;e._super(),e._targetWidgetById=b8e.HashMap.get(),e._currGuideDataById=b8e.HashMap.get(),e._targetEffectAnimById=b8e.HashMap.get(),e._targetImageById=b8e.HashMap.get(),e._targetTextById=b8e.HashMap.get(),e._targetViewById=b8e.HashMap.get(),e._orgLocalZOrderByView=b8e.HashMap.get(),e._currGuideViewById=b8e.HashMap.get(),e._guideViewPoolByType=b8e.HashMap.get(),e._initModal()},onClickGuideTarget:function(e,t){this._onClickGuideTarget={callback:e,thisArg:t}},onAdded:function(e,t){this._onAdded={callback:e,thisArg:t}},onBeforeRemove:function(e,t){this._onBeforeRemove={callback:e,thisArg:t}},onRemoved:function(e,t){this._onRemoved={callback:e,thisArg:t}},addGuide:function(e,t,i){var r=this,n=e.guideData,a=n.id;if(!r._currGuideDataById.get(a)){if(n.visible=!0,r._targetViewById.set(a,t),r._targetWidgetById.set(a,i),r._currGuideDataById.set(a,n),!i.setGuideClick){i.setGuideClick=function(e,t){var i=this;e?i._guideClickCallback||(i._guideClickCallback={callback:e,thisArg:t},b8e.evt.onC(i,i.onGuideClick,i,1e3)):i._guideClickCallback&&(b8e.evt.offC(i,i.onGuideClick,i),i._guideClickCallback=null)};var o=i.onGuideClick=function(){var e=this._guideClickCallback;e&&e.callback.call(e.thisArg)};b8e.SHC(o)}var s=e.completeTypes;s&&s.indexOf("on_show")<0&&i.setGuideClick(function(){r._clickGuideTarget(a)}),n.isModal&&r._modalGuide(n,i),r._showGuideView(n),r._timer||(r._timer=b8e.Timer.add(r,r._onUpdate,200)),r._timer.reset(),r._timer.start(),r._onAdded&&r._onAdded.callback.call(r._onAdded.thisArg,n)}},removeGuide:function(e){var t=this,i=t._currGuideDataById.get(e);if(i){i.visible=!1,t._onBeforeRemove&&t._onBeforeRemove.callback.call(t._onBeforeRemove.thisArg,i);t._targetViewById.get(e);var r=t._targetWidgetById.get(e);r&&(r.setGuideClick(null),delete r.guideRect,t._modalWidget==r&&t._removeModalGuide());var n=t._currGuideViewById.get(e);if(n){n.removeOnLoaded(t._onGuideViewLoaded,t),n.removeFromParent(),t._currGuideViewById.del(e);var a=t._guideViewPoolByType.get(n.getClass(),null);a[a.length]=n}var o=t._targetImageById.get(e);o&&(o.release(),t._targetImageById.del(e));var s=t._targetEffectAnimById.get(e);if(s){for(var l=s.length,c=0;c<l;c++){var d=s[c];d&&d.release(),s.length=0}t._targetEffectAnimById.del(e)}var _=t._targetTextById.get(e);_&&(_.removeFromParent(),_.release(),t._targetTextById.del(e)),t._targetViewById.del(e),t._targetWidgetById.del(e),t._currGuideDataById.del(e),t._currGuideDataById.count()<1&&t._timer&&t._timer.stop(),t._onRemoved&&t._onRemoved.callback.call(t._onRemoved.thisArg,i)}},getWidgetRect:function(e){var t=this._targetWidgetById.get(e);if(t){var i=null;if(t.__BaseDisplay)i=t.localToGlobal();else{if(!(t instanceof cc.Node))return null;i=b8e.CommonUtil.convertToGlobalSpace(t)}var r=t.guideRect;return(r=r||(t.guideRect={})).x=i.x,r.y=i.y,r.width=t.width,r.height=t.height,r}return null},_initModal:function(){var e=this;e._modalLeft=bui.Graphics.get(),b8e.evt.onC(e._modalLeft,e._onClickModal,e),e._modalRight=bui.Graphics.get(),b8e.evt.onC(e._modalRight,e._onClickModal,e),e._modalTop=bui.Graphics.get(),b8e.evt.onC(e._modalTop,e._onClickModal,e),e._modalBottom=bui.Graphics.get(),b8e.evt.onC(e._modalBottom,e._onClickModal,e),b8e.evt.addG(e,b8e.Event.STAGE_RESIZE,e._onResize,!1,-9999)},_onClickModal:function(){this._currGuideDataById.forEach(function(e,t){t.isModal&&this._clickGuideTarget(e,!0)},this)},_clickGuideTarget:function(e,t){var i=this;if(i._onClickGuideTarget)if(i._currGuideDataById.get(e)){var r=i._targetWidgetById.get(e);i._onClickGuideTarget.callback.call(i._onClickGuideTarget.thisArg,e,!!t,r)}else b8e.error(3351,e)},_modalGuide:function(e,t){var i=this;i._modalWidget=t;var r=b8e.layer.getGuiLayer();i._showModal=e.showModal,i._allModal=e.allModal,i._modalColor=e.modalColor,i._modalLeft.setLocalZOrder(i._modalZOrder),i._modalRight.setLocalZOrder(i._modalZOrder),i._modalTop.setLocalZOrder(i._modalZOrder),i._modalBottom.setLocalZOrder(i._modalZOrder),r.addChild(i._modalLeft),r.addChild(i._modalRight),r.addChild(i._modalTop),r.addChild(i._modalBottom),i._resizeModal()},_removeModalGuide:function(){var e=this;e._modalWidget=null,e._modalColor=0,e._showModal=!1,e._allModal=!1,e._modalLeft.clear(),e._modalLeft.removeFromParent(),e._modalRight.clear(),e._modalRight.removeFromParent(),e._modalTop.clear(),e._modalTop.removeFromParent(),e._modalBottom.clear(),e._modalBottom.removeFromParent()},_onResize:function(){var i=this;0<i._currGuideDataById.count()&&(i._resizeModal(),i._currGuideDataById.forEach(function(e,t){i.updateGuideState(e)},i))},_onUpdate:function(){var e=this;0<e._targetWidgetById.count()&&(e._resizeModal(),e._targetWidgetById.forEach(e._onTargetWidget,e))},_onTargetWidget:function(e,t){if(t){var i=null;if(t.__BaseDisplay)i=t.localToGlobal();else{if(!(t instanceof cc.Node))return;i=b8e.CommonUtil.convertToGlobalSpace(t)}var r=t.guideRect;r&&r.x==i.x&&r.y==i.y&&r.width==t.width&&r.height==t.height||((r=r||(t.guideRect={})).x=i.x,r.y=i.y,r.width=t.width,r.height=t.height,this.updateGuideState(e))}},_resizeModal:function(){var e=this;if(e._modalWidget){var t=e._modalColor,i=e._modalWidget.width,r=e._modalWidget.height,n=null;if(e._modalWidget.__BaseDisplay)n=e._modalWidget.localToGlobal();else{if(!(e._modalWidget instanceof cc.Node))return;n=b8e.CommonUtil.convertToGlobalSpace(e._modalWidget)}var a=n.x,o=n.y;e._allModal?(e._modalLeft.setPosition(0,0),e._modalLeft.setSize(b8e.stageWidth,b8e.stageHeight),e._modalLeft.clear(),e._modalRight.clear(),e._modalTop.clear()):(e._modalLeft.setPosition(0,0),e._modalLeft.setSize(a,b8e.stageHeight),e._modalLeft.clear(),e._modalRight.setPosition(a+i,0),e._modalRight.setSize(b8e.stageWidth-i-a,b8e.stageHeight),e._modalRight.clear(),e._modalTop.setPosition(a,o+r),e._modalTop.setSize(i,b8e.stageHeight-r-o),e._modalTop.clear(),e._modalBottom.setPosition(a,0),e._modalBottom.setSize(i,o)),e._modalBottom.clear(),e._showModal&&(e._modalLeft.fillColor(t),e._modalLeft.fillRect(0,0,e._modalLeft.width,e._modalLeft.height),e._modalRight.fillColor(t),e._modalRight.fillRect(0,0,e._modalRight.width,e._modalRight.height),e._modalTop.fillColor(t),e._modalTop.fillRect(0,0,e._modalTop.width,e._modalTop.height),e._modalBottom.fillColor(t),e._modalBottom.fillRect(0,0,e._modalBottom.width,e._modalBottom.height))}},_onGuideViewLoaded:function(){},_showGuideView:function(e){var t=this,i=e.id,r=e.direction,n=e.viewClassName;if(n){var a=game[n];if(a){var o=t._guideViewPoolByType.get(a.getClass(),null);o||(o=[],t._guideViewPoolByType.set(a.getClass(),o,null));var s=o.pop();if((s=s||new a)instanceof b8e.BaseGuideView)s.addOnLoaded(t._onGuideViewLoaded,t),s.setGuideData(e.data),s.setLocalZOrder(t._guideViewOrder),s.setDirection(r)||b8e.warn(3192,r),t._currGuideViewById.set(i,s);else b8e.error(3352)}else b8e.error(3353,n)}var l=e.targetImageUrl;if(l){var c=bui.Sprite.get();c.setLocalZOrder(0<e.imageZOrder?e.imageZOrder:t._imageOrder),c.loadTexture(l),t._targetImageById.set(i,c)}var d=e.targetEffectUrls;if(d){var _=t._targetEffectAnimById.get(i);if(!_){_=[],t._targetEffectAnimById.set(i,_);for(var u=d.length,h=0;h<u;h++){var f=d[h],p=b8e.Animator.get();p.load(f),p.play(),p.setLocalZOrder(0<e.effectZOrder?e.effectZOrder:t._effectOrder),_[_.length]=p}}}var g=e.textMsg;if(g){var m=b8e.RichText.get();m.setAnchor(0,1),m.setFontSize(e.fontSzie),m.setText(g),m.setLocalZOrder(0<e.imageZOrder?e.imageZOrder+1:t._textOrder),t._targetTextById.set(i,m)}t.updateGuideState(i)},updateGuideState:function(e){var t=this,i=t._currGuideDataById.get(e);if(i){var r=t._targetWidgetById.get(e);if(r){var n=r.width,a=r.height,o=null,s=!1;i.visible&&(r.__BaseDisplay?(o=r.localToGlobal(),s=r._hierarchyVisible):r instanceof cc.Node&&(o=b8e.CommonUtil.convertToGlobalSpace(r),s=r._activeInHierarchy));var l=void 0,c=t._currGuideViewById.get(e),d=t._targetEffectAnimById.get(e),_=t._targetImageById.get(e),u=t._targetTextById.get(e);if(s){var h=b8e.layer.getGuiLayer(),f=t._targetViewById.get(e);l=i.isModal?h.localToGlobal():f.localToGlobal();var p=o.x,g=o.y,m=r.anchorX,v=r.anchorY;if(c){i.isModal?h.addChild(c):f.addChild(c);var b=void 0,y=void 0,C=i.direction;y="top"==C||"left_top"==C||"right_top"==C?(b=p+(n-c.width>>1),"left_top"==C?b=b:"right_top"==C&&(b=b),g+a):"bottom"==C||"left_bottom"==C||"right_bottom"==C?(b=p+(n-c.width>>1),"left_bottom"==C?b=b:"right_bottom"==C&&(b=b),g-c.height):"left"==C?(b=p-c.width,g+(a-c.height>>1)):"right"==C?(b=p+n,g+(a-c.height>>1)):"center"==C?(b=p+(n-c.width>>1),g+(a-c.height>>1)):(b=p,g),b+=i.viewOffsetX,y+=i.viewOffsetY,i.isModal||(b-=l.x,y-=l.y),c.setPosition(b,y)}if(_){i.imageBringToTop?h.addChild(_):f.addChild(_);var T=p+(n>>1)-n*m+i.targetImageOffsetX,w=g-(a>>1)+a*(1-v)+i.targetImageOffsetY;i.imageBringToTop||(T-=l.x,w-=l.y),_.setPosition(T,w)}if(d)for(var D=d.length,S=0;S<D;S++){var x=d[S];i.effectBringToTop?h.addChild(x):f.addChild(x);var R=p+(n>>1)-n*m+i.targetEffectOffsetX,B=g-(a>>1)+a*(1-v)+i.targetEffectOffsetY;i.effectBringToTop||(R-=l.x,B-=l.y),x.setPosition(R,B)}if(u){i.imageBringToTop?h.addChild(u):f.addChild(u);var N=p+(n>>1)-n*m+i.textOffsetX,A=g-(a>>1)+a*(1-v)+i.textOffsetY;i.imageBringToTop||(N-=l.x,A-=l.y),u.setPosition(N,A)}}else if(c&&c.removeFromParent(),_&&_.removeFromParent(),d)for(var M=d.length,L=0;L<M;L++){d[L].removeFromParent()}}}}});t._instance=null,t.inst=function(){return null==t._instance&&(t._instance=new t),t._instance},b8e.RC("$$b8e","$$GuideMgr",e)}(),function(){var e,t=e=b8e.Object.extends({ctor:function(){var e=this;e._super(),e._isInited=!1,e._dataInited=!1,e._triggerInited=!1,e._limitCountById={},e._hangUpList=[],e._isTrigging={},e._isRootTrigging={},e._durationTweens={},e._cancelDurationTweens={},e._queueTriggerByGroup={},e._bindCommands={}},initData:function(e){var t=this;t._dataInited||(e.forEach(function(e){this._limitCountById[e.id]=e.triggerTimes},t),t._dataInited=!0,t._triggerInited&&t._onInit())},initTrigger:function(){this._triggerInited||(this._triggerInited=!0,this._dataInited&&this._onInit())},trigger:function(e,t){var i=this;if(!i._isInited){var r=i._hangUpList;return r.indexOf(e)<0&&(r[r.length]=e),!1}var n=e.id;if(!t&&i._isTrigging[n])return!1;var a=e.chainData;if(a&&a.id==n)return b8e.warn(3193,n),!1;var o=e.nextData;if(o&&o.id==n)return b8e.warn(3194,n),!1;if(a&&o&&o.id==a.id)return b8e.warn(3195,n),!1;var s=e.rootData,l=s.id;if(!t&&l==n&&i._isRootTrigging[l])return!1;if(!t&&l==n&&0<s.limitCount){var c=i._limitCountById[l];if((c=0|+c)>>16,(65535&c)>=s.limitCount)return!1}var d=e.queueGroup;if(l==n&&0<d){var _=i._queueTriggerByGroup[d];if(_&&0<_.length){var u=_[0];if(u&&u.id!==n&&_.indexOf(e)<0)return _.indexOf(e)<0&&(_[_.length]=e),!1}else _=[e],i._queueTriggerByGroup[d]=_}var h=i._durationTweens[n];h&&(h.kill(i),delete i._durationTweens[n]);var f=e.delay;0<f?(h=b8e.Tween.get(i).wait(f).call(i._doTrigger,this,[e,t]),i._durationTweens[n]=h):i._doTrigger(e,t)},setTriggerProgress:function(e,t){var i=e.rootData,r=i.id;if(0<i.limitCount){var n=this._limitCountById[r],a=65535&(n=0|+n);a<i.limitCount&&(a|=t<<16,this._limitCountById[r]=a,this._saveTriggerTimes(i,a))}},onCancel:function(e,t){this._onCancel={callback:e,thisArg:t}},onTrigger:function(e,t){this._onTrigger={callback:e,thisArg:t}},onSave:function(e,t){this._onSave={callback:e,thisArg:t}},complete:function(e){this._doComplete(e)},cancel:function(e){this._doCancel(e,!0)},commandComplete:function(e,t){void 0===t&&(t=!0);var i=e.id,r=this._bindCommands[i],n=this._isTrigging[r];n?this._doComplete(n,t):b8e.warn(3196,i)},_onInit:function(){this._isInited||(this._isInited=!0,this._doHangUpTrigger())},_doHangUpTrigger:function(){this._hangUpList.forEach(function(e){this._doTrigger(e)},this),this._hangUpList.length=0},_doTrigger:function(e){var t=this,i=e.id,r=e.rootData.id,n=t._durationTweens[i];n&&(n.kill(t),delete t._durationTweens[i]),(n=t._cancelDurationTweens[i])&&(n.kill(t),delete t._cancelDurationTweens[i]),b8e.log("\u89e6\u53d1\u89e6\u53d1\u5668\uff1a"+i),t._isRootTrigging[r]||(t._isRootTrigging[r]=e),t._isTrigging[i]||(t._isTrigging[i]=e);var a=e.chainData;a&&t._chainTrigger(a);var o=e.cancelDuration;0<o&&(n=b8e.Tween.get(t).wait(o).call(t._doCancel,t,[e]),t._cancelDurationTweens[i]=n);var s=e.duration;0<s&&(n=b8e.Tween.get(t).wait(s).call(t._doComplete,t,[e]),t._durationTweens[i]=n);var l=e.cmdData;if(l){var c=l.id;t._bindCommands[c]&&b8e.CommandMgr.inst().cancelCommand(c),t._bindCommands[c]=i,b8e.CommandMgr.inst().applyCommand(l)}return t._onTrigger&&t._onTrigger.callback.call(t._onTrigger.thisArg,e),!0},_chainTrigger:function(e){var t=this,i=e.id,r=e.delay;if(e.type)b8e.warn(3197,i);else{var n=t._durationTweens[i];n&&(n.kill(t),delete t._durationTweens[i]),0<r?(n=b8e.Tween.get(t).wait(r).call(t._doTrigger,t,[e]),t._durationTweens[i]=n):t._doTrigger(e)}},_gotoNextTrigger:function(e){var t=this,i=e.nextData;if(i){var r=i.id,n=i.delay;if(i.type)return b8e.warn(3198,r),void t._cancelRootTrigger(e,!0);var a=t._durationTweens[r];a&&(a.kill(t),delete t._durationTweens[r]),0<n?(a=b8e.Tween.get(t).wait(n).call(t._doTrigger,t,[i]),t._durationTweens[r]=a):t._doTrigger(i)}else t._cancelRootTrigger(e,!0)},_nextQueueTrigger:function(e){var t=e.queueGroup;if(0<t){var i=this._queueTriggerByGroup[t];if(i){var r=i.indexOf(e);-1<r&&i.splice(r,1),0<i.length?this._doTrigger(i[0]):delete this._queueTriggerByGroup[t]}}},_doCancel:function(e,t){var i=this,r=e.id;delete i._isTrigging[r];var n=i._durationTweens[r];n&&(n.kill(i),delete i._durationTweens[r]),(n=i._cancelDurationTweens[r])&&(n.kill(i),delete i._cancelDurationTweens[r]),i._onCancel&&i._onCancel.callback.call(i._onCancel.thisArg,e),t&&i._cancelRootTrigger(e)},_cancelRootTrigger:function(e,t){var i=this,r=e.rootData,n=r.id,a=e.id,o=!!i._isTrigging[a];if(delete i._isRootTrigging[n],t&&0<r.limitCount){var s=i._limitCountById[n],l=65535&(s=0|+s);if(l<r.limitCount)l+=1,l|=s>>16<<16,i._limitCountById[n]=l,i._saveTriggerTimes(r,l)}b8e.log("==============\u5b8c\u6210\u6839\u89e6\u53d1\u5668\uff1a"+n),o&&i._nextQueueTrigger(r)},_doComplete:function(e,t){void 0===t&&(t=!0);var i=this,r=e.id;if(i._isTrigging[r]){var n=e.cmdData;if(n){var a=n.id;delete i._bindCommands[a],b8e.CommandMgr.inst().cancelCommand(a)}if(b8e.log("==============\u5b8c\u6210\u89e6\u53d1\u5668\uff1a"+r),n.viewDesc&&n.viewDesc.closeModuleId){var o=b8e.module.getView(n.viewDesc.closeModuleId);o&&o.__isShow&&o.removeFromParent()}i._doCancel(e,!t),t&&i._gotoNextTrigger(e)}else i._cancelRootTrigger(e,!0)},_saveTriggerTimes:function(e,t){this._onSave&&this._onSave.callback.call(this._onSave.thisArg,e,t)}});t._instance=null,t._singleton=!0,t.inst=function(){return null==t._instance&&(t._singleton=!1,t._instance=new t,t._singleton=!0),t._instance},b8e.RC("$$b8e","$$TriggerMgr",e)}(),function(){var e,t=e=b8e.Object.extends({ctor:function(){var e=this;e._super(),e._currCommands=b8e.HashMap.get(),e._watchList=b8e.LinkedList.get(),e._removeWatchList=b8e.LinkedList.get(),e._orgLocalZOrderByView=b8e.HashMap.get(),e._cmdDatasByView=b8e.HashMap.get(),e._bindGuides={},e._watching=!1,b8e.GuideMgr.inst().onClickGuideTarget(e._onClickGuideTarget,e)},onOpenView:function(e,t){this._onOpenView={callback:e,thisArg:t}},onCloseView:function(e,t){this._onCloseView={callback:e,thisArg:t}},applyCommand:function(e){var t=this,i=e.id;t._currCommands.set(i,e);var r=e.viewDesc,n=e.viewLocalZOrder;if(r){var a=r.moduleId;if(0<a){var o=void 0,s=b8e.module.getView(a);if(s){if(s.addOnHide(t._onViewHide,t),r.nextModuleId){var l=b8e.module.getView(r.nextModuleId);if(l.__isShow)return void b8e.TriggerMgr.inst().commandComplete(e);l.addOnShow(t._onViewShow,t),(o=t._cmdDatasByView.get(l,t))||(o=[],t._cmdDatasByView.set(l,o,t)),o.indexOf(e)<0&&(o[o.length]=e)}if(r.startCloseModuleId){var c=b8e.module.getView(r.startCloseModuleId);c&&c.__isShow&&c.removeFromParent()}if((o=t._cmdDatasByView.get(s,t))||(o=[],t._cmdDatasByView.set(s,o,t)),o.indexOf(e)<0&&(o[o.length]=e),e.openView)if(t._onOpenView&&t._onOpenView.callback.call(t._onOpenView.thisArg,r),n)t._orgLocalZOrderByView.get(s,t)||t._orgLocalZOrderByView.set(s,s.getLocalZOrder(),t),s.setLocalZOrder(n);var d=e.optionName,_=r.widgetName;(d||_)&&t._watchList.append(e)}else b8e.warn(3199,a)}else b8e.warn(3200,r.id)}t._checkWatching()},cancelCommand:function(e){var t=this,i=t._currCommands.get(e);if(i){var r=i.guideData;if(r){var n=r.id;delete t._bindGuides[n],b8e.GuideMgr.inst().removeGuide(n)}var a=i.viewDesc;if(a){var o=a.moduleId,s=void 0;if(0<o){var l=b8e.module.getView(o);if(l){if(l.removeOnHide(t._onViewHide,t),a.nextModuleId){var c=b8e.module.getView(a.nextModuleId);if(c.removeOnShow(t._onViewShow,t),s=t._cmdDatasByView.get(c,t)){var d=s.indexOf(i);-1<d&&s.splice(d,1),s.length<1&&t._cmdDatasByView.del(c,t)}}if(s=t._cmdDatasByView.get(l,t)){var _=s.indexOf(i);-1<_&&s.splice(_,1),s.length<1&&t._cmdDatasByView.del(l,t)}var u=t._orgLocalZOrderByView.get(l,t);u&&(l.setLocalZOrder(u),t._orgLocalZOrderByView.del(l,t)),i.closeView&&t._onCloseView&&t._onCloseView.callback.call(t._onCloseView.thisArg,a)}else b8e.warn(3201,o)}else b8e.warn(3202,a.id)}t._currCommands.del(e),t._watchList.remove(i),t._checkWatching()}else b8e.warn(3203,e)},_checkWatching:function(){var e=this;e._watchList.count()<1?e._watching&&(e._watching=!1,b8e.Timer.remove(e,e._onUpdate)):e._watching||(e._watching=!0,b8e.Timer.add(e,e._onUpdate,100))},_onViewHide:function(e){var t=this._cmdDatasByView.get(e,this);if(t)for(var i=t.length-1;0<=i;i--){var r=t[i];r&&r.completeOnViewHide&&b8e.TriggerMgr.inst().commandComplete(r)}},_onViewShow:function(e){var t=this._cmdDatasByView.get(e,this);if(t)for(var i=t.length-1;0<=i;i--){var r=t[i];r&&r.completeOnViewShow&&b8e.TriggerMgr.inst().commandComplete(r)}},_onClickGuideTarget:function(e,t,i){var r=this._bindGuides[e],n=this._currCommands.get(r);if(n){var a=n.completeTypes;a&&(t?(-1<a.indexOf("click_modal")&&b8e.TriggerMgr.inst().commandComplete(n),-1<a.indexOf("click_auto")&&(i?(i.simulationEvent||b8e.error("\u6307\u5f15"+e+"\u81ea\u52a8\u89e6\u53d1\u5bf9\u8c61\u4e0d\u652f\u6301\u81ea\u52a8\u89e6\u53d1\u4e8b\u4ef6"),i.simulationEvent(cc.Node.EventType.TOUCH_END)||b8e.error("\u6307\u5f15"+e+"\u81ea\u52a8\u89e6\u53d1\u5bf9\u8c61\u672a\u6ce8\u518c\u70b9\u51fb\u4e8b\u4ef6")):b8e.error("\u6307\u5f15"+e+"\u81ea\u52a8\u89e6\u53d1\u5bf9\u8c61\u4e0d\u5b58\u5728"),b8e.TriggerMgr.inst().commandComplete(n))):-1<a.indexOf("click")&&b8e.TriggerMgr.inst().commandComplete(n))}else b8e.warn(3204,r)},_onUpdate:function(){var e=this;for(e._watchList.forEach(e._processCommand,e);0<e._removeWatchList.count();){var t=e._removeWatchList.shift();e._watchList.remove(t)}e._checkWatching()},_processCommand:function(e){var t=this,i=(e.id,e.viewDesc);if(i){var r=i.moduleId;if(0<r){var n=b8e.module.getView(r);if(n){if(n.parent){var a=e.optionName,o=i.widgetName;if(a){var s=e.optionValues,l=n[b8e.getAliasName(a)];if(l){b8e.applyType(l);var c=void 0;(c=l.__TypeFunction?l.apply(n,s):l)&&(t._removeWatchList.append(e),t._processOption(e,c))}}else if(o){var d=n.skin;if(d){t._removeWatchList.append(e);var _=d[o];_?t._processWidget(e,_):b8e.warn(3206,i.id,o)}}}}else b8e.warn(3207,r)}else b8e.warn(3208,i.id)}else t._removeWatchList.append(e)},_processOption:function(e,t){e.id;var i=e.viewDesc;if(i){var r=i.moduleId;if(0<r){var n=b8e.module.getView(r);n?this._onAddGuide(e,n,t):b8e.warn(3209,r)}else b8e.warn(3210,i.id)}},_processWidget:function(e,t){e.id;var i=e.viewDesc;if(i){var r=i.moduleId;if(0<r){var n=b8e.module.getView(r);n?this._onAddGuide(e,n,t):b8e.warn(3211,r)}else b8e.warn(3212,i.id)}},_onAddGuide:function(e,t,i){var r=e.guideData.id;this._bindGuides[r]&&b8e.GuideMgr.inst().removeGuide(r);var n=e.id;this._bindGuides[r]=n,i?i.__BaseDisplay?b8e.GuideMgr.inst().addGuide(e,t,i):i instanceof cc.Node?b8e.GuideMgr.inst().addGuide(e,t,i):(i=i.node)instanceof cc.Node?b8e.GuideMgr.inst().addGuide(e,t,i):b8e.warn(3213,n):b8e.warn(3213,n)}});t._instance=null,t._singleton=!0,t.inst=function(){return null==t._instance&&(t._singleton=!1,t._instance=new t,t._singleton=!0),t._instance},b8e.RC("$$b8e","$$CommandMgr",e)}(),function(){var e,t=e=b8e.Object.extends({_dataMap:null,_cbMap:null,ctor:function(){this._super(),this._dataMap=b8e.HashMap.get(),this._cbMap={}},cover:function(e,t){var i=this._dataMap,r=i.get(e);if(!r)return this.set(e,t);var n=i.get(t);n||(n=new b8e.SpotAlertData(t),i.set(t,n)),n&&n.cover(r);var a=this._cbMap[e];return a&&!a.__added&&(a.forEach(function(e,t,i){r.addNotify(e,i)},this),a.__added=!0),r},set:function(e,t){var i=this._dataMap,r=null;t&&((r=i.get(t))||(r=new b8e.SpotAlertData(t),i.set(t,r)));var n=i.get(e);n||(n=new b8e.SpotAlertData(e),i.set(e,n)),r&&r.set(n);var a=this._cbMap[e];return a&&!a.__added&&(a.forEach(function(e,t,i){n.addNotify(e,i)},this),a.__added=!0),n},get:function(e){return this._dataMap.get(e)},remove:function(e){var t=this,i=t._cbMap[e];if(i){var r=t.get(e);r&&i.__added&&i.forEach(function(e,t,i){r.removeNotify(e,i)},t),i.__added=void 0,delete i.__added,i.release(),t._cbMap[e]=void 0,delete t._cbMap[e]}t._dataMap.del(e)},setCb:function(e,t,i){if(t&&i){var r=this._cbMap[e];if(r||((r=this._cbMap[e]=b8e.HashMap.get()).__added=!1),r.get(t,i))b8e.error("\u91cd\u590d\u6ce8\u518c\u56de\u8c03\u65b9\u6cd5\uff1a",e);else{r.set(t,e,i);var n=this.get(e);n&&(r.__added=!0,n.addNotify(t,i))}}else b8e.error("\u6ce8\u518c\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u56de\u8c03\uff1a",e)},delCb:function(e,t,i){var r=this._cbMap[e];if(r&&r.get(t,i)){var n=this.get(e);n&&r.__added&&n.removeNotify(t,i),r.del(t,i),r.count()<1&&(r.__added=void 0,delete r.__added,r.release(),this._cbMap[e]=void 0,delete this._cbMap[e])}else b8e.error("\u6ca1\u6709\u6ce8\u518c\u7684\u56de\u8c03\u65b9\u6cd5\uff1a",e)}});b8e.spotAlert=new t,b8e.RC("$$b8e","$$SpotAlertMgr",e)}(),function(){var e;e=b8e.Object.extends({ctor:function(e){var t=this;t._super(),t._target=e,"mouse"in cc.sys.capabilities?(t._node=t._target,b8e.evt.onMouseDown(t._node,t.onMouseDown,t),b8e.evt.onMouseUp(t._node,t.onMouseUp,t),b8e.evt.onMouseLeave(t._node,t.onMouseLeave,t),b8e.evt.onMouseMove(t._node,t.onMouseMove,t),b8e.evt.onMouseWheel(t._node,t.onMouseScroll,t),t._node.parent&&(b8e.evt.onMouseUp(t._node.parent,t.onParentMouseUp,t),b8e.evt.onMouseMove(t._node.parent,t.onParentMouseMove,t),b8e.evt.onMouseLeave(t._node.parent,t.onParentMouseLeave,t))):b8e.warn(3191)},onParentMouseUp:function(e){var t=this;t._leftDownX=-1,t._leftDownY=-1,t._rightDownX=-1,t._rightDownY=-1;var i=e.getLocation();t._mouseX=i.x,t._mouseY=i.y;var r=e.getButton();r==cc.Event.EventMouse.BUTTON_LEFT?t._onLeftUp&&t._onLeftUp(i.x,i.y):r==cc.Event.EventMouse.BUTTON_RIGHT?t._onRightUp&&t._onRightUp(i.x,i.y):r==cc.Event.EventMouse.BUTTON_MIDDLE&&t._onMiddleUp&&t._onMiddleUp(i.x,i.y)},onParentMouseLeave:function(){},onParentMouseMove:function(e){var t=this,i=e.getLocation();if(t.draggable){if(!t._onAcceptDragDrop||t._onAcceptDragDrop(i.x,i.y))if(-1<t._leftDownX&&-1<t._leftDownY){var r=i.x-t._leftDownX+t._downTargetX,n=i.y-t._leftDownY+t._downTargetY;t._posSetter?t._posSetter(r,n):(t._target.x=r,t._target.y=n)}else if(-1<t._rightDownX&&-1<t._rightDownY){var a=i.x-t._rightDownX+t._downTargetX,o=i.y-t._rightDownY+t._downTargetY;t._posSetter?t._posSetter(a,o):(t._target.x=a,t._target.y=o)}}t._onMove&&t._onMove(i.x,i.y)},onMouseDown:function(e){var t=this;t._leftDownX=-1,t._leftDownY=-1,t._rightDownX=-1,t._rightDownY=-1;var i=e.getLocation();t._mouseX=i.x,t._mouseY=i.y;var r=e.getButton();if(r==cc.Event.EventMouse.BUTTON_LEFT?(t.draggable&&(!t._onAcceptDragDrop||t._onAcceptDragDrop(i.x,i.y))&&(t._leftDownX=i.x,t._leftDownY=i.y),t._onLeftDown&&t._onLeftDown(i.x,i.y)):r==cc.Event.EventMouse.BUTTON_RIGHT?(t.draggable&&(!t._onAcceptDragDrop||t._onAcceptDragDrop(i.x,i.y))&&(t._rightDownX=i.x,t._rightDownY=i.y),t._onRightDown&&t._onRightDown(i.x,i.y)):r==cc.Event.EventMouse.BUTTON_MIDDLE&&t._onMiddleDown&&t._onMiddleDown(i.x,i.y),t._posGetter){var n=t._posGetter();t._downTargetX=n.x,t._downTargetY=n.y}else t._downTargetX=t._target.x,t._downTargetY=t._target.y;e.stopPropagation()},onMouseUp:function(e){var t=this;t._leftDownX=-1,t._leftDownY=-1,t._rightDownX=-1,t._rightDownY=-1;var i=e.getLocation();t._mouseX=i.x,t._mouseY=i.y;var r=e.getButton();r==cc.Event.EventMouse.BUTTON_LEFT?t._onLeftUp&&t._onLeftUp(i.x,i.y):r==cc.Event.EventMouse.BUTTON_RIGHT?t._onRightUp&&t._onRightUp(i.x,i.y):r==cc.Event.EventMouse.BUTTON_MIDDLE&&t._onMiddleUp&&t._onMiddleUp(i.x,i.y)},onMouseLeave:function(){},onMouseMove:function(e){var t=this,i=e.getLocation();if(t._mouseX=i.x,t._mouseY=i.y,t.draggable){if(!t._onAcceptDragDrop||t._onAcceptDragDrop(i.x,i.y))if(-1<t._leftDownX&&-1<t._leftDownY){var r=i.x-t._leftDownX+t._downTargetX,n=i.y-t._leftDownY+t._downTargetY;t._posSetter?t._posSetter(r,n):(t._target.x=r,t._target.y=n)}else if(-1<t._rightDownX&&-1<t._rightDownY){var a=i.x-t._rightDownX+t._downTargetX,o=i.y-t._rightDownY+t._downTargetY;t._posSetter?t._posSetter(a,o):(t._target.x=a,t._target.y=o)}}t._onMove&&t._onMove(i.x,i.y)},onMouseScroll:function(e){cc.p(e.getScrollX(),e.getScrollY())},setPosGetter:function(e){this._posGetter=e},setPosSetter:function(e){this._posSetter=e},setAcceptDragDrop:function(e){this._onAcceptDragDrop=e},setOnMove:function(e){this._onMove=e},setLeftDown:function(e){this._onLeftDown=e},setLeftUp:function(e){this._onLeftUp=e},setRightDown:function(e){this._onRightDown=e},setRightUp:function(e){this._onRightUp=e},setMiddleDown:function(e){this._onMiddleDown=e},setMiddleUp:function(e){this._onMiddleUp=e},getMousePos:function(){return{x:this._mouseX,y:this._mouseY}},destroy:function(){var e=this;e._node.parent&&(b8e.evt.offMouseUp(e._node.parent,e.onParentMouseUp,e),b8e.evt.offMouseMove(e._node.parent,e.onParentMouseMove,e),b8e.evt.offMouseLeave(e._node.parent,e.onParentMouseLeave,e)),b8e.evt.offMouseDown(e._node,e.onMouseDown,e),b8e.evt.offMouseUp(e._node,e.onMouseUp,e),b8e.evt.offMouseLeave(e._node,e.onMouseLeave,e),b8e.evt.offMouseMove(e._node,e.onMouseMove,e),b8e.evt.offMouseWheel(e._node,e.onMouseScroll,e),e._posGetter=null,e._posSetter=null,e._onMove=null,e._onLeftDown=null,e._onLeftUp=null,e._onRightDown=null,e._onRightUp=null,e._onMiddleDown=null,e._onMiddleUp=null,e._onAcceptDragDrop=null,e._node=null,e._target=null}}),b8e.RC("$$b8e","$$MouseController",e)}(),function(){var e;e=b8e.Object.extends({ctor:function(){},owner:{get:function(){return this._owner}},setOwner:function(e){this._owner=e},onEnter:function(e,t,i){return this._enterCb=e?{func:e,thisArg:t,args:i}:null,this},onBeforeEnter:function(e,t,i){return this._beforeEnterCb=e?{func:e,thisArg:t,args:i}:null,this},onAfterEnter:function(e,t,i){return this._afterEnterCb=e?{func:e,thisArg:t,args:i}:null,this},onExecute:function(e,t,i){return this._executeCb=e?{func:e,thisArg:t,args:i}:null,this},onBeforeExecute:function(e,t,i){return this._beforeExecuteCb=e?{func:e,thisArg:t,args:i}:null,this},onAfterExecute:function(e,t,i){return this._afterExecuteCb=e?{func:e,thisArg:t,args:i}:null,this},onLeave:function(e,t,i){return this._leaveCb=e?{func:e,thisArg:t,args:i}:null,this},onBeforeLeave:function(e,t,i){return this._beforeLeaveCb=e?{func:e,thisArg:t,args:i}:null,this},onAfterLeave:function(e,t,i){return this._afterLeaveCb=e?{func:e,thisArg:t,args:i}:null,this},onPause:function(e,t,i){return this._pauseCb=e?{func:e,thisArg:t,args:i}:null,this},onResume:function(e,t,i){return this._resumeCb=e?{func:e,thisArg:t,args:i}:null,this},enter:function(){var e=this;if(e._enterCb){var t=void 0;t=e._enterCb.args?e._enterCb.args.concat(e):[e],e._enterCb.func.apply(e._enterCb.thisArg,t)}},beforeEnter:function(){var e=this;if(e._beforeEnterCb){var t=void 0;t=e._beforeEnterCb.args?e._beforeEnterCb.args.concat(e):[e],e._beforeEnterCb.func.apply(e._beforeEnterCb.thisArg,t)}},afterEnter:function(){var e=this;if(e._afterEnterCb){var t=void 0;t=e._afterEnterCb.args?e._afterEnterCb.args.concat(e):[e],e._afterEnterCb.func.apply(e._afterEnterCb.thisArg,t)}},execute:function(){var e=this;if(e._executeCb){var t=void 0;t=e._executeCb.args?e._executeCb.args.concat(e):[e],e._executeCb.func.apply(e._executeCb.thisArg,t)}},beforeExecute:function(){var e=this;if(e._beforeExecuteCb){var t=void 0;t=e._beforeExecuteCb.args?e._beforeExecuteCb.args.concat(e):[e],e._beforeExecuteCb.func.apply(e._beforeExecuteCb.thisArg,t)}},afterExecute:function(){var e=this;if(e._afterExecuteCb){var t=void 0;t=e._afterExecuteCb.args?e._afterExecuteCb.args.concat(e):[e],e._afterExecuteCb.func.apply(e._afterExecuteCb.thisArg,t)}},leave:function(){var e=this;if(e._leaveCb){var t=void 0;t=e._leaveCb.args?e._leaveCb.args.concat(e):[e],e._leaveCb.func.apply(e._leaveCb.thisArg,t)}},beforeLeave:function(){var e=this;if(e._beforeLeaveCb){var t=void 0;t=e._beforeLeaveCb.args?e._beforeLeaveCb.args.concat(e):[e],e._beforeLeaveCb.func.apply(e._beforeLeaveCb.thisArg,t)}},afterLeave:function(){var e=this;if(e._afterLeaveCb){var t=void 0;t=e._afterLeaveCb.args?e._afterLeaveCb.args.concat(e):[e],e._afterLeaveCb.func.apply(e._afterLeaveCb.thisArg,t)}},pause:function(){var e=this;if(e._pauseCb){var t=void 0;t=e._pauseCb.args?e._pauseCb.args.concat(e):[e],e._pauseCb.func.apply(e._pauseCb.thisArg,t)}},resume:function(){var e=this;if(e._resumeCb){var t=void 0;t=e._resumeCb.args?e._resumeCb.args.concat(e):[e],e._resumeCb.func.apply(e._resumeCb.thisArg,t)}},clear:function(){var e=this;e._beforeEnterCb=null,e._enterCb=null,e._afterEnterCb=null,e._beforeExecuteCb=null,e._executeCb=null,e._afterExecuteCb=null,e._beforeLeaveCb=null,e._leaveCb=null,e._afterLeaveCb=null,e._pauseCb=null,e._resumeCb=null,e.data=null,e._owner=null}}),b8e.RC("$$b8e","$$StateReference",e)}(),function(){var e;e=b8e.StateReference.extends({__RoleStateReference:!0,_syncAnimatFunc:null,ctor:function(){this._super()},onSyncAnimat:function(e){return this._syncAnimatFunc=e,this},syncAnimat:function(){null!=this._syncAnimatFunc&&this._syncAnimatFunc(this)},clear:function(){this._syncAnimatFunc=null,this._super()}}),b8e.RC("$$b8e","$$RoleStateReference",e)}();p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e;e=b8e.Object.extends({_type:0,_isRepeat:!1,_isPaused:!1,_isDisposed:!1,_machine:null,_ref:null,ctor:function(e){this._super(),(void 0===e?"undefined":p(e))==b8e.TypeNumber?this._type=e:b8e.error(3354)},init:function(e){this._machine=e},ref:{get:function(){return this._ref}},tribe:{get:function(){return"State"}},type:{get:function(){return this._type}},isRepeat:{get:function(){return this._isRepeat}},isPaused:{get:function(){return this._isPaused}},isDisposed:{get:function(){return this._isDisposed}},enterPass:function(){return!0},leavePass:function(){return!0},beforeEnter:function(){this._ref&&this._ref.beforeEnter()},enter:function(){this._ref&&this._ref.enter()},afterEnter:function(){this._ref&&this._ref.afterEnter()},beforeExecute:function(e){var t=this;t._machine&&t._machine.usable&&(t._ref!=e&&t._ref&&t._ref.clear(),t._ref=e,t._ref&&t._ref.setOwner(t._machine.owner)),t._isPaused=!1,t._ref&&t._ref.beforeExecute()},execute:function(){this._ref&&this._ref.execute()},afterExecute:function(){this._ref&&this._ref.afterExecute(),this._isRepeat=!0},beforeLeave:function(){this._ref&&this._ref.beforeLeave()},leave:function(){this._ref&&this._ref.leave()},afterLeave:function(){this._ref&&this._ref.afterLeave(),this._isRepeat=!1},pause:function(){this._isPaused=!0,this._ref&&this._ref.pause()},resume:function(){this._isPaused=!1,this._ref&&this._ref.resume()},transition:function(e,t,i,r,n){this._machine&&this._machine.usable&&this._machine.transition(e,t,i,r,n)},getReference:function(e){return this._machine&&this._machine.usable?this._machine.getReference(e):null},removeSelf:function(){this._machine&&this._machine.usable&&this._machine.removeState(this._type)},clear:function(){var e=this;b8e.Tween.kill(e),e._ref&&(e._ref.clear(),e._ref=null),e._machine=null,e._isRepeat=!1,e._isPaused=!1},dispose:function(){this.clear(),this._isDisposed=!0}}),b8e.RC("$$b8e","$$State",e)})(),function(){var e;e=b8e.State.extends({ctor:function(e){this._super(e)},tribe:{get:function(){return"RoleState"}}}),b8e.RC("$$b8e","$$RoleState",e)}(),function(){var e;e=b8e.RoleState.extends({_isFreeze:!1,_speedRatio:0,ctor:function(e){this._super(e)},tribe:{get:function(){return"ActionState"}},isFreeze:{get:function(){return this._isFreeze}},speedRatio:{get:function(){return this._speedRatio}},beforeEnter:function(){this._machine&&this._machine.usable&&(this._isFreeze=!1,this._super())},beforeExecute:function(e){this._machine&&this._machine.usable&&this._super(e)},pause:function(){this._super(),this.syncAnimation(!0,-1)},resume:function(){this._super(),this.syncAnimation(!1,-1)},afterExecute:function(){this._super()},syncAnimation:function(e,t){void 0===t&&(t=-1);var i=this;i._machine&&i._machine.usable&&(i._isFreeze=!!e,i._animTime=t,i._machine.owner.usable&&(i._machine.owner.forEachAnimator(i.eachPlayAnimation,i),i._ref&&i._ref.__RoleStateReference&&i._ref.syncAnimat()))},eachPlayAnimation:function(e,t){var i=this;e&&t&&(t.setSpeedRatio(i._speedRatio),i.playAnimation(e,t,i._isFreeze,i._animTime,i._speedRatio))},playAnimation:function(){},setSpeedRatio:function(e){this._speedRatio=e},clear:function(){this._isFreeze=!1,this._speedRatio=0,this._super()}}),b8e.RC("$$b8e","$$ActionState",e)}(),function(){var e;e=b8e.RoleState.extends({ctor:function(e){this._super(e)},tribe:{get:function(){return"ControlState"}}}),b8e.RC("$$b8e","$$ControlState",e)}(),function(){var e;e=b8e.State.extends({ctor:function(e){this._super(e)},tribe:{get:function(){return"AIState"}}}),b8e.RC("$$b8e","$$AIState",e)}(),function(){var e;e=b8e.PoolObject.extends({ctor:function(e){var t=this;t._owner=e,t._usePass=!0,t._states=b8e.HashMap.get(),t._refMap=b8e.HashMap.get(),t._currStates=b8e.HashMap.get()},transition:function(e,t,i){var r=this;if(!r.usable)return!1;if(!r._owner||!r._owner.usable)return!1;var n=null,a=!1;if(!n&&0<e&&(a=!!(n=(n=r.extractState(e))?n.isDisposed?null:n:null)&&r.passTo(n.type,i)),n){var o=r._currStates.get(n.tribe);if(o=o?o.isDisposed?null:o:null,a){var s=!1;return o&&(o==n||o.tribe!=n.tribe)||(o&&o.beforeLeave(),n.beforeEnter(),o&&o.leave(),r._currStates.set(n.tribe,n),r.isDebug&&b8e.log("====================transition:",n.tribe,n.type),n.enter(),s=!0),n.beforeExecute(t),n.execute(),n.afterExecute(),s&&n.afterEnter(),o&&o.afterLeave(),!0}}return!1},passTo:function(e,t){var i=this;if(!i.usable)return!1;if(!i._usePass)return!0;var r=i.extractState(e);if(!(r=r?r.isDisposed?null:r:null))return!1;var n=i._currStates.get(r.tribe),a=!(n=n?n.isDisposed?null:n:null)||n.leavePass(r,t),o=r.enterPass(n,t),s=a&&o;return i.isDebug&&!s&&b8e.log("====================no pass:",n?n.type:"",r.type),s},setStateMapping:function(e){this._stateMapping=e},removeState:function(e){if(this.usable){var t=this._states.get(e);t&&this._currStates.get(t.tribe)&&(t.beforeLeave(),t.leave(),this._currStates.del(t.tribe),t.afterLeave())}},createState:function(e){var t=null;this._stateMapping&&(t=this._stateMapping[e]);var i=null;if(t&&(i=new t),!i)throw new Error("\u4e0d\u5b58\u5728\u72b6\u6001\uff1a"+e);return i},extractState:function(e){var t=this;if(!t.usable)return null;var i=null;return 0<e&&((i=t._states.get(e))||(i=t.createState(e),t._states.set(e,i)),i.init(t)),i},getCurrState:function(e){if(!this.usable)return null;var t=this._currStates.get(e);return t||null},getReference:function(e,t){var i=this;if(!i._refMap)return null;t=t||e;var r=i._refMap.get(t,i);return r||(r=new e,i._refMap.set(t,r,i)),r},owner:{get:function(){return this._owner}},usePass:{set:function(e){this._usePass=e}},clear:function(){var e=this;e._refMap&&e._refMap.forEach(function(e,t){t.clear()},e);e._currStates&&(e._currStates.forEach(function(e,t){t.clear()},e),e._currStates.clear())},restore:function(e){this._owner=e,this._super()},recycle:function(){this.clear(),this._usePass=!0,this._owner=null,this._super()},dispose:function(){var e=this;e._states&&(e._states.forEach(function(e,t){t.dispose()},e),e._states.release(),e._states=null),e._stateMapping=null,e._refMap&&(e._refMap.release(),e._refMap=null),e._currStates&&(e._currStates.release(),e._currStates=null),e._usePass=!1,e._super()}}),b8e.RC("$$b8e","$$StateMachine",e)}(),function(){var e,t=e=b8e.PoolObject.extends({ctor:function(e,t,i){this._super(),this.setParams(e,t,i)},setParams:function(e,t,i){var r=this;r.x=e,r.y=t,r.weight=i,r.hscore=0,r.gscore=0,r.solid=!1,r.previousNode=null,r.isInOpenList=!1,r.isInCloseList=!1},reset:function(){var e=this;e.hscore=0,e.gscore=0,e.previousNode=null,e.isInOpenList=!1,e.isInCloseList=!1},clear:function(){var e=this;e.x=0,e.y=0,e.weight=0,e.hscore=0,e.gscore=0,e.solid=!1,e.previousNode=null,e.isInOpenList=!1,e.isInCloseList=!1},distance:function(e){return Math.sqrt(Math.pow(e.x-this.x,2)+Math.pow(e.y-this.y,2))},restore:function(e,t,i){this.setParams(e,t,i),this._super()},recycle:function(){this.clear(),this._super()}}),r=new b8e.Pool(t,16384);t.get=function(e,t,i){return r.get(e,t,i)},t.put=function(e){return r.put(e)},b8e.RC("$$b8e","$$AstarNode",e)}();p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e;e=b8e.Object.extends({ctor:function(){this._super(),this._resetGrids=b8e.LinkedList.get()},setSquares:function(e,t){var i=this;i.width=e,i.height=t,i._grids=new Array(i.width*i.height);for(var r=0;r<i.width;r++)for(var n=0;n<i.height;n++)i._grids[r+n*i.width]=b8e.AstarNode.get(r,n,0)},filter:function(e){return this._grids.filter(e)},getGrids:function(){return this._grids},getNode:function(e,t){return this._grids?this._grids[e+t*this.width]:null},neighbors:function(e,t){var i=this,r=[],n=void 0;return e.x+1<i.width&&((n=i._grids[e.x+1+e.y*i.width]).solid||n.isInOpenList||(r[r.length]=n)),e.y+1<i.height&&((n=i._grids[e.x+(e.y+1)*i.width]).solid||n.isInOpenList||(r[r.length]=n)),0<=e.y-1&&((n=i._grids[e.x+(e.y-1)*i.width]).solid||n.isInOpenList||(r[r.length]=n)),0<=e.x-1&&((n=i._grids[e.x-1+e.y*i.width]).solid||n.isInOpenList||(r[r.length]=n)),t&&(e.x+1<i.width&&e.y+1<i.height&&((n=i._grids[e.x+1+(e.y+1)*i.width]).solid||n.isInOpenList||(r[r.length]=n)),e.x+1<i.width&&0<=e.y-1&&((n=i._grids[e.x+1+(e.y-1)*i.width]).solid||n.isInOpenList||(r[r.length]=n)),0<=e.x-1&&e.y+1<i.height&&((n=i._grids[e.x-1+(e.y+1)*i.width]).solid||n.isInOpenList||(r[r.length]=n)),0<=e.x-1&&0<=e.y-1&&((n=i._grids[e.x-1+(e.y-1)*i.width]).solid||n.isInOpenList||(r[r.length]=n))),r},_euclideanHeuristic:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},_fewestTurn:function(e,t){var i=e.previousNode,r=0;if(i){var n=e.previousNode.previousNode;n&&(r=n.x==i.x&&n.y!=i.y&&i.y==e.y&&i.x!=e.x?10:n.x!=i.x&&n.y==i.y&&i.x==e.x&&i.y!=e.y?10:-0)}return 1.1*(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)+r)},_manhattanHeuristic:function(e,t){return 1.5*(Math.abs(e.x-t.x)+Math.abs(e.y-t.y))},_buildPath:function(e){for(var t=[];null!==e.previousNode;)t.unshift(e),e=e.previousNode;return t.unshift(e),t},findPath:function(e,t,i,r,n,a,o){var s=this;if(!s._grids)return b8e.error(3302),null;o=o||1,n=n||!0;for(var l=s._resetGrids;0<l.count();){l.shift().reset()}a=a||s._manhattanHeuristic;var c=s._grids[e+t*s.width],d=s._grids[i+r*s.width];if(!c)return b8e.error(3303,e,t,s.width,s.height),null;if(!d)return b8e.error(3304,i,r,s.width,s.height),null;if(c.solid)return null;if(d.solid)return null;s._resetGrids.append(c),s._resetGrids.append(d),c.gscore=0,c.hscore=c.gscore+a(c,d)*o;var _=[c];c.isInOpenList=!0;function u(){if(h--<1)return"break";var i=_.sort(function(e,t){return e.hscore-t.hscore})[0];if(i==d)return{v:s._buildPath(i)};_.shift(),i.isInOpenList=!1,i.isInCloseList=!0,s._resetGrids.append(i),s.neighbors(i,n).forEach(function(e){var t=a(e,i)*o+e.weight+i.gscore;e.isInCloseList&&t>=e.gscore||(e.previousNode=i,e.gscore=t,e.hscore=e.gscore+a(e,d)*o,(_[_.length]=e).isInOpenList=!0,e.isInCloseList=!1,this._resetGrids.append(e))},s)}var h=2e3;e:for(;0<_.length;){var f=u();switch(f){case"break":break e;default:if("object"===(void 0===f?"undefined":p(f)))return f.v}}return[]},clear:function(){var e=this;if(e.width=0,e.height=0,e._resetGrids.clear(),e._grids){for(var t=e._grids.length,i=0;i<t;i++)b8e.AstarNode.put(e._grids[i]);e._grids.length=0,e._grids=null}}}),b8e.RC("$$b8e","$$AstarGrids",e)})(),function(){var e;e=b8e.Object.extends({ctor:function(){this._super(),this._grids=new b8e.AstarGrids,this._tmpPoint={x:0,y:0}},setSquares:function(e,t){this._grids.setSquares(e,t)},findPath:function(e,t,i,r,n,a){if(i==e&&r==t)return[];var o=this;if(o.isSolid(e,t)){var s=o.findWalkableGrid(e,t);if(!s)return[];e=s.x,t=s.y}if(o.isSolid(i,r)){var l=o.findWalkableGrid(i,r);if(!l)return[];i=l.x,r=l.y}var c=o._grids.findPath(e,t,i,r,!0);return n&&c&&o.floyd(c,!!a),c},findWalkableGrid:function(e,t){var i=this,r=i.getNode(e,t);if(r&&r.solid){for(var n=i._grids.width,a=i._grids.height,o=0,s=0,l=1;l<=6;l++){if(0<=(o=t+l)&&o<a)for(s=e-l;0<=s&&s<e+l;s++)if((r=i.getNode(s,o))&&!r.solid)return r;if(0<=(s=e+l)&&s<n)for(o=t-l;0<=o&&o<t+l;o++)if((r=i.getNode(s,o))&&!r.solid)return r;if(0<=(o=t-l)&&o<a)for(s=e-l;0<=s&&s<e+l;s++)if((r=i.getNode(s,o))&&!r.solid)return r;if(0<=(s=e-l)&&s<n)for(o=t-l;0<=o&&o<t+l;o++)if((r=i.getNode(s,o))&&!r.solid)return r}return null}return r},floyd:function(e,t){return this.removeNonInflectionNodes(e),this.connectNodes(e),t&&this.joinGrids(e),e},removeNonInflectionNodes:function(e,t){if(void 0===t&&(t=0),t>=e.length-2)return e;var i=0;return i=this.isNodesInSameLine(e[t],e[t+1],e[t+2])?(e.splice(t+1,1),t):t+1,this.removeNonInflectionNodes(e,i)},isNodesInSameLine:function(e,t,i){return(e.y-t.y)*(e.x-i.x)==(e.y-i.y)*(e.x-t.x)},connectNodes:function(e){for(var t=0;t<e.length-2;t++)for(var i=e.length-1;t+1<i;i--)if(!this.hasAnyObstacleBetweenNodes(e[t],e[i])){var r=i-t-1;e.splice(t+1,r);break}return e},joinGrids:function(e){var t=e.slice();this.lastNode=null,t.forEach(this._onPathsJoin,this)},_onPathsJoin:function(e){if(t.lastNode)for(var i=pathNodes.indexOf(e),r=b8e.MathUtil.getRadian(lastNode.x,lastNode.y,e.x,e.y),n=0,a=b8e.MathUtil.getDistance(lastNode.x,lastNode.y,e.x,e.y);-1<i&&n<a;){n+=1;var o=b8e.MathUtil.getDxByRadian(n,r),s=b8e.MathUtil.getDyByRadian(n,r),l=Math.round(lastNode.x+o),c=Math.round(lastNode.y+s),d=this._grids.getNode(l,c);d?(i++,pathNodes.splice(i,0,d)):b8e.error(3301)}t.lastNode=e},hasAnyObstacleBetweenNodes:function(e,t){var i=this,r=45,n=Math.abs(e.y-t.y)-Math.abs(e.x-t.x);0<n?r=46:n<0&&(r=44),i._tmpPoint.x=0,i._tmpPoint.y=0;var a=i._tmpPoint,o=0,s=0;if(45<r){var l=e,c=t;for(e.y>t.y&&(l=t,c=e),a.y=l.y+1;a.y<=c.y;a.y++){o=(s=a.y-(l.y+.5))*(c.x-l.x)/(c.y-l.y),a.x=l.x+.5+o;var d=a.y,_=a.x>>0,u=d-1,h=_;if(i.isSolid(_,d)||i.isSolid(h,u))return!0}}else if(r<45){var f=e,p=t;for(e.x>t.x&&(f=t,p=e),a.x=f.x+1;a.x<=p.x;a.x++){s=(o=a.x-(f.x+.5))*(p.y-f.y)/(p.x-f.x),a.y=f.y+.5+s;var g=a.y>>0,m=a.x,v=g,b=m-1;if(i.isSolid(m,g)||i.isSolid(b,v))return!0}}else{var y=1;e.y>t.y&&(y=-1);var C=1;e.x>t.x&&(C=-1);for(var T=e.y+y,w=e.x+C;T!=t.y;){if(i.isSolid(w,T))return!0;T+=y,w+=C}}return!1},getNode:function(e,t){return this._grids.getNode(e,t)},setNodeIsSolid:function(e,t,i){var r=this.getNode(e,t);r&&(r.solid=i)},isSolid:function(e,t){var i=this.getNode(e,t);return!!i&&i.solid},setNodeWeight:function(e,t,i){i<0&&(i=0);var r=this.getNode(e,t);return r?(r.weight=i,r.weight):0},getNodeWeight:function(e,t){var i=this.getNode(e,t);return i?i.weight:0},clear:function(){this._grids.clear()}}),b8e.RC("$$b8e","$$Astar",e)}(),function(){var e;e=b8e.Object.extends({_entityUid:0,_approachSpacing:100,ctor:function(e){this._super(),this._scene=e,this._onGeneraterByType={}},start:function(){var e=this;e._timer||(e._timer=b8e.Timer.add(e,e._onUpdate,200)),e._timer.reset(),e._timer.start(),e._trackTarget=null,e._approachArrived=!1},stop:function(){this._timer&&this._timer.stop(),this._trackTarget=null,this._approachArrived=!1},setPlayer:function(e){this._player=e},setTrackTarget:function(e){this._trackTarget=e,this._trackTargetHash=e.poolHash,this._approachArrived=!1},addEntity:function(e,t,i,r,n){var a=this,o=void 0,s=null;i?(s={callBack:i,thisArg:r,args:n,options:t},a._onGeneraterByType[e]=s):s=a._onGeneraterByType[e],s?(i=s.callBack,r=s.thisArg,n=s.args,t=s.options,o=i.apply(r,n)):(delete a._onGeneraterByType[e],a._entityUid++,(o=b8e.SceneEntity.get(1e8,a._entityUid)).defaultSurface()),o.setTouchable(!0),o.setDirection(a._randomDirection());var l=a._scene.getSpaceGrids(),c=l.length,d=l[Math.random()*c>>0];o.setGridPosition(d.x,d.y);var _=void 0;return t&&(_=t.bodyRes),_&&o.setSceneVisitCallback(function(){var e=o.getAnimator(1,1);(e=e||o.addAnimator(1,1,10)).setAsBoundary(!0),e.setTouchable(!0),e.ghostable=!0,e.load(_),e.play()},this),a._scene.addDisplay(o),o},removeEntity:function(e,t){var i=this,r=i._scene.getDisplayByTypeAndId(e,t);r&&(i._onEntityBeforeRemove&&i._onEntityBeforeRemove.callBack.call(i._onEntityBeforeRemove.thisArg,r),i._scene.removeDisplayByTypeAndId(e,t)&&(i._onEntityRemoved?i._onEntityRemoved.callBack.call(i._onEntityRemoved.thisArg,e,t):i.addEntity(e)))},onEntityBeforeRemove:function(e,t){this._onEntityBeforeRemove=e?{callBack:e,thisArg:t}:null},onEntityRemoved:function(e,t){this._onEntityRemoved=e?{callBack:e,thisArg:t}:null},onApproach:function(e,t){this._onApproach=e?{callBack:e,thisArg:t}:null},onTrack:function(e,t){this._onTrack=e?{callBack:e,thisArg:t}:null},_randomDirection:function(){var e={x:0,y:0};switch(8*Math.random()>>0){case 0:e.x=0,e.y=1;break;case 1:e.x=1,e.y=1;break;case 2:e.x=1,e.y=0;break;case 3:e.x=1,e.y=-1;break;case 4:e.x=-1,e.y=-1;break;case 5:e.x=0,e.y=-1;break;case 6:e.x=-1,e.y=0;break;case 7:e.x=-1,e.y=1;break;default:e.x=0,e.y=-1}return e},setTrackTypes:function(e){this._trackTypes=e,this._trackTarget=null,this._approachArrived=!1},getNearestEntity:function(e){for(var a=this,t=e.length,i=[],r=0;r<t;r++){var n=e[r];i=i.concat(a._scene.getDisplayByType(n))}return i.sort(function(e,t){var i=a._player;if(i){var r=b8e.MathUtil.getDistanceNoSqrt(i.x,i.y,e.x,e.y),n=b8e.MathUtil.getDistanceNoSqrt(i.x,i.y,t.x,t.y);if(n<r)return 1;if(r<n)return-1}return 0}),i[0]},_onUpdate:function(){var e=this,t=e._trackTypes,i=e._trackTarget;if(i&&(i.usable&&i.poolHashUsable(e._trackTargetHash)||(i=e._trackTarget=null,e._approachArrived=!1)),!i&&t){var r=e.getNearestEntity(t);r&&(i=e._trackTarget=r,e._trackTargetHash=r.poolHash,e._approachArrived=!1)}var n=e._player;n&&i&&(e._onTrack&&e._onTrack.callBack.call(e._onTrack.thisArg,i),b8e.MathUtil.getDistanceNoSqrt(n.x,n.y,i.x,i.y)<e._approachSpacing?e._approachArrived||(e._approachArrived=!0,e._onApproach&&e._onApproach.callBack.call(e._onApproach.thisArg,i)):e._approachArrived=!1)}}),b8e.RC("$$b8e","$$GameLevelDesigner",e)}(),function(){var i=b8e.MBits=function(){};i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<i.INT_BITS-1,i.sign=function(e){return(0<e)-(e<0)},i.abs=function(e){var t=e>>i.INT_BITS-1;return(e^t)-t},i.min=function(e,t){return t^(e^t)&-(e<t)},i.max=function(e,t){return e^(e^t)&-(e<t)},i.isPow2=function(e){return!(e&e-1||!e)},i.log2=function(e){var t=void 0,i=void 0;return t=(65535<e)<<4,t|=i=(255<(e>>>=t))<<3,t|=i=(15<(e>>>=i))<<2,(t|=i=(3<(e>>>=i))<<1)|(e>>>=i)>>1},i.log10=function(e){return 1e9<=e?9:1e8<=e?8:1e7<=e?7:1e6<=e?6:1e5<=e?5:1e4<=e?4:1e3<=e?3:100<=e?2:10<=e?1:0},i.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},i.countTrailingZeros=function(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t},i.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},i.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},i.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var t=new Array(256);(function(e){for(var t=0;t<256;++t){var i=t,r=t,n=7;for(i>>>=1;i;i>>>=1)r<<=1,r|=1&i,--n;e[t]=r<<n&255}})(t),i.reverse=function(e){return t[255&e]<<24|t[e>>>8&255]<<16|t[e>>>16&255]<<8|t[e>>>24&255]},i.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},i.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},i.interleave3=function(e,t,i){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},i.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},i.nextCombination=function(e){var t=e|e-1;return 1+t|(~t&-~t)-1>>>i.countTrailingZeros(e)+1}}(),function(){b8e.EXTENSION_VERSION="4.1.5";var e=b8e.EngineExtension={};function t(e,t,i){var r=e.url,n=e.rawData,a=b8e.AnimatorResource.get();a.setConfig(r,n,e.options),e.asset=a,e.destroyRawData(),t.call(i,e)}b8e.SHC(e);var i=e.onInit=function(){b8e.EXTENSION_VERSION!==b8e.VERSION&&b8e.error("\u6ce8\u610f\uff1aExtension\u548cEngine\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u8bf7\u68c0\u67e5\uff01\nExtension:V"+b8e.EXTENSION_VERSION+" & Engine:V"+b8e.VERSION),b8e.resParser.setParser(b8e.AnimatorResource,t)};b8e.SHC(i),b8e.onInit(i,e)}()},{}]},{},[1]);