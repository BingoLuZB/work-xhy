(function(){return function a(s,o,c){function u(e,t){if(!o[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=o[e]={exports:{}};s[e][0].call(r.exports,function(t){return u(s[e][1][t]||t)},r,r.exports,a,s,o,c)}return o[e].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}})()({1:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;function s(t,e,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:s(r,e,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}var a=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(t("./HTMLAudioElement"));function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=1,f={},r=function(){function r(t){c(this,r);var e=u(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));e._$sn=h++,e.HAVE_NOTHING=0,e.HAVE_METADATA=1,e.HAVE_CURRENT_DATA=2,e.HAVE_FUTURE_DATA=3,e.HAVE_ENOUGH_DATA=4,e.readyState=0;var n=wx.createInnerAudioContext();return f[e._$sn]=n,e._canplayEvents=["load","loadend","canplay","canplaythrough","loadedmetadata"],n.onCanplay(function(){e._loaded=!0,e.readyState=e.HAVE_CURRENT_DATA,e._canplayEvents.forEach(function(t){e.dispatchEvent({type:t})})}),n.onPlay(function(){e._paused=f[e._$sn].paused,e.dispatchEvent({type:"play"})}),n.onPause(function(){e._paused=f[e._$sn].paused,e.dispatchEvent({type:"pause"})}),n.onEnded(function(){e._paused=f[e._$sn].paused,!1===f[e._$sn].loop&&e.dispatchEvent({type:"ended"}),e.readyState=4}),n.onError(function(){e._paused=f[e._$sn].paused,e.dispatchEvent({type:"error"})}),t?e.src=t:e._src="",e._loop=n.loop,e._autoplay=n.autoplay,e._paused=n.paused,e._volume=n.volume,e._muted=!1,e}return l(r,o.default),a(r,[{key:"addEventListener",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:{};s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"addEventListener",this).call(this,t,e,i),t=String(t).toLowerCase(),this._loaded&&-1!==this._canplayEvents.indexOf(t)&&this.dispatchEvent({type:t})}},{key:"load",value:function(){}},{key:"play",value:function(){f[this._$sn].play()}},{key:"resume",value:function(){f[this._$sn].resume()}},{key:"pause",value:function(){f[this._$sn].pause()}},{key:"destroy",value:function(){f[this._$sn].destroy()}},{key:"canPlayType",value:function(t){var e=0<arguments.length&&void 0!==t?t:"";return"string"!=typeof e?"":-1<e.indexOf("audio/mpeg")||e.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){var t=new r;return t.loop=this.loop,t.autoplay=this.autoplay,t.src=this.src,t}},{key:"currentTime",get:function(){return f[this._$sn].currentTime},set:function(t){f[this._$sn].seek(t)}},{key:"duration",get:function(){return f[this._$sn].duration}},{key:"src",get:function(){return this._src},set:function(t){this._src=t,this._loaded=!1,this.readyState=this.HAVE_NOTHING,f[this._$sn].src=t}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,f[this._$sn].loop=t}},{key:"autoplay",get:function(){return this.autoplay},set:function(t){this._autoplay=t,f[this._$sn].autoplay=t}},{key:"paused",get:function(){return this._paused}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._muted||(f[this._$sn].volume=t)}},{key:"muted",get:function(){return this._muted},set:function(t){this._muted=t,f[this._$sn].volume=t?0:this._volume}}]),r}();n.default=r,e.exports=n.default},{"./HTMLAudioElement":10}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var t=wx.createCanvas();t.type="canvas";t.getContext;return t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t.style={top:"0px",left:"0px",width:i.innerWidth+"px",height:i.innerHeight+"px"},t.addEventListener=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};document.addEventListener(t,e,n)},t.removeEventListener=function(t,e){document.removeEventListener(t,e)},t.dispatchEvent=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};console.log("canvas.dispatchEvent",t.type,t)},Object.defineProperty(t,"clientWidth",{enumerable:!0,get:function(){return i.innerWidth}}),Object.defineProperty(t,"clientHeight",{enumerable:!0,get:function(){return i.innerHeight}}),t};var i=t("./WindowProperties");e.exports=n.default},{"./WindowProperties":21}],3:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./Node"));function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(){function e(){a(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return o(e,r.default),e}();n.default=c,e.exports=n.default},{"./Node":18}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=t("./util");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.default=function t(e){r(this,t),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.timestampe=Date.now(),this.preventDefault=i.noop,this.stopPropagation=i.noop,this.type=e},e.exports=n.default},{"./util":29}],5:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});n.default=function t(){i(this,t)},e.exports=n.default},{}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=t("../util/index.js");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){r(this,a),this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=i.noop,this.stopPropagation=i.noop,this.type=t,this.target=window.canvas,this.currentTarget=window.canvas}function s(n){return function(t){var e=new a(n);e.touches=t.touches,e.targetTouches=Array.prototype.slice.call(t.touches),e.changedTouches=t.changedTouches,e.timeStamp=t.timeStamp,document.dispatchEvent(e)}}n.default=a,wx.onTouchStart(s("touchstart")),wx.onTouchMove(s("touchmove")),wx.onTouchEnd(s("touchend")),wx.onTouchCancel(s("touchcancel")),e.exports=n.default},{"../util/index.js":29}],7:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MouseEvent=n.TouchEvent=void 0;var i=a(t("./TouchEvent")),r=a(t("./MouseEvent"));function a(t){return t&&t.__esModule?t:{default:t}}n.TouchEvent=i.default,n.MouseEvent=r.default},{"./MouseEvent":5,"./TouchEvent":6}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=new WeakMap,s=function(){function t(){r(this,t),a.set(this,{})}return i(t,[{key:"addEventListener",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:{},r=a.get(this);r||(r={},a.set(this,r)),r[t]||(r[t]=[]),r[t].push(e),i.capture,i.once,i.passive}},{key:"removeEventListener",value:function(t,e){var n=a.get(this);if(n){var i=n[t];if(i&&0<i.length)for(var r=i.length;r--;)if(i[r]===e){i.splice(r,1);break}}}},{key:"dispatchEvent",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},n=a.get(this)[e.type];if(n)for(var i=0;i<n.length;i++)n[i](e)}}]),t}();n.default=s,e.exports=n.default},{}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(){r(this,t)}return i(t,[{key:"construct",value:function(){}}]),t}();n.default=a,e.exports=n.default},{}],10:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./HTMLMediaElement"));function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(){function t(){return a(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"audio"))}return o(t,r.default),t}();n.default=c,e.exports=n.default},{"./HTMLMediaElement":14}],11:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("./Canvas"));r(t("./HTMLElement"));function r(t){return t&&t.__esModule?t:{default:t}}GameGlobal.screencanvas=GameGlobal.screencanvas||new i.default;var a=GameGlobal.screencanvas.constructor;n.default=a,e.exports=n.default},{"./Canvas":2,"./HTMLElement":12}],12:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),a=function(t){return t&&t.__esModule?t:{default:t}}(t("./Element")),s=t("./util/index.js"),o=t("./WindowProperties");function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";c(this,n);var e=u(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.className="",e.childern=[],e.style={width:o.innerWidth+"px",height:o.innerHeight+"px"},e.insertBefore=s.noop,e.innerHTML="",e.tagName=t.toUpperCase(),e}return l(n,a.default),r(n,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:o.innerWidth,height:o.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){var t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){var t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),n}();n.default=h,e.exports=n.default},{"./Element":3,"./WindowProperties":21,"./util/index.js":29}],13:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});(function(t){t&&t.__esModule})(t("./HTMLElement"));var i=wx.createImage().constructor;n.default=i,e.exports=n.default},{"./HTMLElement":12}],14:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),a=function(t){return t&&t.__esModule?t:{default:t}}(t("./HTMLElement"));function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function e(t){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return c(e,a.default),r(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}();n.default=u,e.exports=n.default},{"./HTMLElement":12}],15:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./HTMLMediaElement"));function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(){function t(){return a(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"video"))}return o(t,r.default),t}();n.default=c,e.exports=n.default},{"./HTMLMediaElement":14}],16:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return wx.createImage()};(function(t){t&&t.__esModule})(t("./HTMLImageElement"));e.exports=n.default},{"./HTMLImageElement":13}],17:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});n.default=function t(){i(this,t)},e.exports=n.default},{}],18:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),a=function(t){return t&&t.__esModule?t:{default:t}}(t("./EventTarget.js"));function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function e(){s(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return c(e,a.default),r(e,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex(function(t){return t===e});return-1<t?this.childNodes.splice(t,1):null}}]),e}();n.default=u,e.exports=n.default},{"./EventTarget.js":8}],19:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});n.default=function t(){i(this,t)},e.exports=n.default},{}],20:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,r,a=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=new WeakMap,c=(r=i=function(){function r(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(s(this,r),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof t||!/(^ws:\/\/)|(^wss:\/\/)/.test(t))throw new TypeError("Failed to construct 'WebSocket': The URL '"+t+"' is invalid");this.url=t,this.readyState=r.CONNECTING;var i=wx.connectSocket({url:t,protocols:Array.isArray(n)?n:[n],tcpNoDelay:!0});return o.set(this,i),i.onClose(function(t){e.readyState=r.CLOSED,"function"==typeof e.onclose&&e.onclose(t)}),i.onMessage(function(t){"function"==typeof e.onmessage&&e.onmessage(t)}),i.onOpen(function(){e.readyState=r.OPEN,"function"==typeof e.onopen&&e.onopen()}),i.onError(function(t){"function"==typeof e.onerror&&e.onerror(new Error(t.errMsg))}),this}return a(r,[{key:"close",value:function(t,e){this.readyState=r.CLOSING,o.get(this).close({code:t,reason:e})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError("Failed to send message: The data "+t+" is invalid");o.get(this).send({data:t})}}]),r}(),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,r);n.default=c,e.exports=n.default},{}],21:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=wx.getSystemInfoSync(),r=i.screenWidth,a=i.screenHeight,s=i.devicePixelRatio,o=n.innerWidth=r,c=n.innerHeight=a;n.devicePixelRatio=s;n.screen={width:r,height:a,availWidth:o,availHeight:c,availLeft:0,availTop:0},n.performance={now:Date.now},n.ontouchstart=null,n.ontouchmove=null,n.ontouchend=null},{}],22:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return wx.createWorker(t)},e.exports=n.default},{}],23:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,a,s=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(t("./EventTarget.js"));function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":i(e))&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=new WeakMap,d=new WeakMap,_=new WeakMap,m=new WeakMap,p=new WeakMap;function v(t){var e="on"+t;if("function"==typeof this[e]){for(var n=arguments.length,i=Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this[e].apply(this,i)}}function y(t){this.readyState=t,v.call(this,"readystatechange")}var c=(a=r=function(){function c(){u(this,c);var t=l(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t.responseType="",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,_.set(t,{"content-type":"application/x-www-form-urlencoded"}),m.set(t,{}),t}return h(c,o.default),s(c,[{key:"abort",value:function(){var t=p.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var e=m.get(this);return Object.keys(e).map(function(t){return t+": "+e[t]}).join("\n")}},{key:"getResponseHeader",value:function(t){return m.get(this)[t]}},{key:"open",value:function(t,e){d.set(this,t),f.set(this,e),y.call(this,c.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(t){var o=this,e=0<arguments.length&&void 0!==t?t:"";if(this.readyState!==c.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:e,url:f.get(this),method:d.get(this),header:_.get(this),responseType:this.responseType,success:function(t){var e=t.data,n=t.statusCode,i=t.header;if("string"!=typeof e&&!(e instanceof ArrayBuffer))try{e=JSON.stringify(e)}catch(t){e=e}if(o.status=n,m.set(o,i),v.call(o,"loadstart"),y.call(o,c.HEADERS_RECEIVED),y.call(o,c.LOADING),(o.response=e)instanceof ArrayBuffer){o.responseText="";for(var r=new Uint8Array(e),a=r.byteLength,s=0;s<a;s++)o.responseText+=String.fromCharCode(r[s])}else o.responseText=e;y.call(o,c.DONE),v.call(o,"load"),v.call(o,"loadend")},fail:function(t){var e=t.errMsg;-1!==e.indexOf("abort")?v.call(o,"abort"):v.call(o,"error",e),v.call(o,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){var n=_.get(this);n[t]=e,_.set(this,n)}},{key:"addEventListener",value:function(t,e){if("function"==typeof e){var n=this;this["on"+t]=function(t){e.call(n,t)}}}}]),c}(),r.UNSEND=0,r.OPENED=1,r.HEADERS_RECEIVED=2,r.LOADING=3,r.DONE=4,a);n.default=c,e.exports=n.default},{"./EventTarget.js":8}],24:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}}(t("./window")),r=u(t("./HTMLElement")),a=u(t("./HTMLVideoElement")),s=u(t("./Image")),o=u(t("./Audio")),c=u(t("./Canvas"));function u(t){return t&&t.__esModule?t:{default:t}}t("./EventIniter/index.js");var l={},h={readyState:"complete",visibilityState:"visible",documentElement:i,hidden:!1,style:{},location:i.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new r.default("head"),body:new r.default("body"),createElement:function(t){return"canvas"===t?new c.default:"audio"===t?new o.default:"img"===t?new s.default:"video"===t?new a.default:new r.default(t)},createElementNS:function(t,e){return this.createElement(e)},getElementById:function(t){return t===i.canvas.id?i.canvas:null},getElementsByTagName:function(t){return"head"===t?[h.head]:"body"===t?[h.body]:"canvas"===t?[i.canvas]:[]},getElementsByName:function(t){return"head"===t?[h.head]:"body"===t?[h.body]:"canvas"===t?[i.canvas]:[]},querySelector:function(t){return"head"===t?h.head:"body"===t?h.body:"canvas"===t?i.canvas:t==="#"+i.canvas.id?i.canvas:null},querySelectorAll:function(t){return"head"===t?[h.head]:"body"===t?[h.body]:"canvas"===t?[i.canvas]:[]},addEventListener:function(t,e){l[t]||(l[t]=[]),l[t].push(e)},removeEventListener:function(t,e){var n=l[t];if(n&&0<n.length)for(var i=n.length;i--;)if(n[i]===e){n.splice(i,1);break}},dispatchEvent:function(t){var e=l[t.type];if(e)for(var n=0;n<e.length;n++)e[n](t)}};n.default=h,e.exports=n.default},{"./Audio":1,"./Canvas":2,"./EventIniter/index.js":7,"./HTMLElement":12,"./HTMLVideoElement":15,"./Image":16,"./window":30}],25:[function(t,e,n){"use strict";var s=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}}(t("./window")),o=i(t("./document"));i(t("./HTMLElement"));function i(t){return t&&t.__esModule?t:{default:t}}var c=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){s.document=o.default,s.addEventListener=function(t,e){s.document.addEventListener(t,e)},s.removeEventListener=function(t,e){s.document.removeEventListener(t,e)},s.dispatchEvent=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};console.log("window.dispatchEvent",t.type,t)};var t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(var e in s){var n=Object.getOwnPropertyDescriptor(c,e);n&&!0!==n.configurable||Object.defineProperty(window,e,{value:s[e]})}for(var i in s.document){var r=Object.getOwnPropertyDescriptor(c.document,i);r&&!0!==r.configurable||Object.defineProperty(c.document,i,{value:s.document[i]})}window.parent=window}else{for(var a in s)c[a]=s[a];c.window=s,window=c,window.top=window.parent=window}}())},{"./HTMLElement":12,"./document":24,"./window":30}],26:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};n.default=i,e.exports=n.default},{}],27:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default={href:"game.js",reload:function(){}},e.exports=n.default},{}],28:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./util/index.js"),r=wx.getSystemInfoSync();console.log(r);var a=r.system,s=r.platform,o=r.language,c=r.version,u=-1!==a.toLowerCase().indexOf("android")?"Android; CPU "+a:"iPhone; CPU iPhone OS "+a+" like Mac OS X",l={platform:s,language:o,appVersion:"5.0 ("+u+") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 ("+u+") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/"+c+" MiniGame NetType/WIFI Language/"+o,onLine:!0,geolocation:{getCurrentPosition:i.noop,watchPosition:i.noop,clearWatch:i.noop}};wx.onNetworkStatusChange&&wx.onNetworkStatusChange(function(t){l.onLine=t.isConnected}),n.default=l,e.exports=n.default},{"./util/index.js":29}],29:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.noop=function(){}},{}],30:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.cancelAnimationFrame=n.requestAnimationFrame=n.clearInterval=n.clearTimeout=n.setInterval=n.setTimeout=n.canvas=n.location=n.localStorage=n.DeviceMotionEvent=n.MouseEvent=n.TouchEvent=n.WebGLRenderingContext=n.HTMLVideoElement=n.HTMLAudioElement=n.HTMLMediaElement=n.HTMLCanvasElement=n.HTMLImageElement=n.HTMLElement=n.FileReader=n.Audio=n.ImageBitmap=n.Image=n.WebSocket=n.XMLHttpRequest=n.navigator=void 0;var i=t("./EventIniter/index.js");Object.defineProperty(n,"TouchEvent",{enumerable:!0,get:function(){return i.TouchEvent}}),Object.defineProperty(n,"MouseEvent",{enumerable:!0,get:function(){return i.MouseEvent}}),Object.defineProperty(n,"DeviceMotionEvent",{enumerable:!0,get:function(){return i.DeviceMotionEvent}});var r=t("./WindowProperties");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return r[t]}})});var a=E(t("./Canvas")),s=E(t("./navigator")),o=E(t("./XMLHttpRequest")),c=E(t("./WebSocket")),u=E(t("./Image")),l=E(t("./ImageBitmap")),h=E(t("./Audio")),f=E(t("./FileReader")),d=E(t("./HTMLElement")),_=E(t("./HTMLImageElement")),m=E(t("./HTMLCanvasElement")),p=E(t("./HTMLMediaElement")),v=E(t("./HTMLAudioElement")),y=E(t("./HTMLVideoElement")),g=E(t("./WebGLRenderingContext")),x=E(t("./localStorage")),b=E(t("./location"));function E(t){return t&&t.__esModule?t:{default:t}}n.navigator=s.default,n.XMLHttpRequest=o.default,n.WebSocket=c.default,n.Image=u.default,n.ImageBitmap=l.default,n.Audio=h.default,n.FileReader=f.default,n.HTMLElement=d.default,n.HTMLImageElement=_.default,n.HTMLCanvasElement=m.default,n.HTMLMediaElement=p.default,n.HTMLAudioElement=v.default,n.HTMLVideoElement=y.default,n.WebGLRenderingContext=g.default,n.localStorage=x.default,n.location=b.default,GameGlobal.screencanvas=GameGlobal.screencanvas||new a.default;var C=GameGlobal.screencanvas;n.canvas=C,n.setTimeout=setTimeout,n.setInterval=setInterval,n.clearTimeout=clearTimeout,n.clearInterval=clearInterval,n.requestAnimationFrame=requestAnimationFrame,n.cancelAnimationFrame=cancelAnimationFrame},{"./Audio":1,"./Canvas":2,"./EventIniter/index.js":7,"./FileReader":9,"./HTMLAudioElement":10,"./HTMLCanvasElement":11,"./HTMLElement":12,"./HTMLImageElement":13,"./HTMLMediaElement":14,"./HTMLVideoElement":15,"./Image":16,"./ImageBitmap":17,"./WebGLRenderingContext":19,"./WebSocket":20,"./WindowProperties":21,"./XMLHttpRequest":23,"./localStorage":26,"./location":27,"./navigator":28}],31:[function(t,e,n){},{}],32:[function(t,e,n){"use strict";function i(t){this.options=t||{locator:{}}}function l(i,t,r){if(!i){if(t instanceof h)return t;i=t}var a={},s=i instanceof Function;function e(e){var n=i[e];!n&&s&&(n=2==i.length?function(t){i(e,t)}:i),a[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+o(r))}||function(){}}return r=r||{},e("warning"),e("error"),e("fatalError"),a}function h(){this.cdata=!1}function f(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function o(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function r(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function d(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}i.prototype.parseFromString=function(t,e){var n=this.options,i=new m,r=n.domBuilder||new h,a=n.errorHandler,s=n.locator,o=n.xmlns||{},c=/\/x?html?$/.test(e),u=c?_.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&r.setDocumentLocator(s),i.errorHandler=l(a,r,s),i.domBuilder=n.domBuilder||r,c&&(o[""]="http://www.w3.org/1999/xhtml"),o.xml=o.xml||"http://www.w3.org/XML/1998/namespace",t?i.parse(t,o,u):i.errorHandler.error("invalid doc source"),r.doc},h.prototype={startDocument:function(){this.doc=(new a).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,n,i){var r=this.doc,a=r.createElementNS(t,n||e),s=i.length;d(this,a),this.currentElement=a,this.locator&&f(this.locator,a);for(var o=0;o<s;o++){t=i.getURI(o);var c=i.getValue(o),u=(n=i.getQName(o),r.createAttributeNS(t,n));this.locator&&f(i.getLocator(o),u),u.value=u.nodeValue=c,a.setAttributeNode(u)}},endElement:function(){var t=this.currentElement;t.tagName;this.currentElement=t.parentNode},startPrefixMapping:function(){},endPrefixMapping:function(){},processingInstruction:function(t,e){var n=this.doc.createProcessingInstruction(t,e);this.locator&&f(this.locator,n),d(this,n)},ignorableWhitespace:function(){},characters:function(t,e,n){if(t=r.apply(this,arguments)){if(this.cdata)var i=this.doc.createCDATASection(t);else i=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(t)&&this.doc.appendChild(i),this.locator&&f(this.locator,i)}},skippedEntity:function(){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=r.apply(this,arguments);var i=this.doc.createComment(t);this.locator&&f(this.locator,i),d(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var i=this.doc.implementation;if(i&&i.createDocumentType){var r=i.createDocumentType(t,e,n);this.locator&&f(this.locator,r),d(this,r)}},warning:function(t){console.warn("[xmldom warning]\t"+t,o(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,o(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]\t"+t,o(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){h.prototype[t]=function(){return null}});var _=t("./entities"),m=t("./sax").XMLReader,a=n.DOMImplementation=t("./dom").DOMImplementation;n.XMLSerializer=t("./dom").XMLSerializer,n.DOMParser=window.DOMParser=i},{"./dom":33,"./entities":34,"./sax":35}],33:[function(t,e,n){"use strict";var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t,e){for(var n in t)e[n]=t[n]}function r(t,e){var n=t.prototype;if(!(n instanceof e)){var i=function(){};for(var r in i.prototype=e.prototype,i=new i,n)i[r]=n[r];t.prototype=n=i}n.constructor!=t&&("function"!=typeof t&&console.error("unknow Class:"+t),n.constructor=t)}var v="http://www.w3.org/1999/xhtml",a={},y=a.ELEMENT_NODE=1,g=a.ATTRIBUTE_NODE=2,x=a.TEXT_NODE=3,b=a.CDATA_SECTION_NODE=4,E=a.ENTITY_REFERENCE_NODE=5,s=a.ENTITY_NODE=6,C=a.PROCESSING_INSTRUCTION_NODE=7,w=a.COMMENT_NODE=8,S=a.DOCUMENT_NODE=9,T=a.DOCUMENT_TYPE_NODE=10,M=a.DOCUMENT_FRAGMENT_NODE=11,o=a.NOTATION_NODE=12,c={},u={},l=(c.INDEX_SIZE_ERR=(u[1]="Index size error",1),c.DOMSTRING_SIZE_ERR=(u[2]="DOMString size error",2),c.HIERARCHY_REQUEST_ERR=(u[3]="Hierarchy request error",3)),f=(c.WRONG_DOCUMENT_ERR=(u[4]="Wrong document",4),c.INVALID_CHARACTER_ERR=(u[5]="Invalid character",5),c.NO_DATA_ALLOWED_ERR=(u[6]="No data allowed",6),c.NO_MODIFICATION_ALLOWED_ERR=(u[7]="No modification allowed",7),c.NOT_FOUND_ERR=(u[8]="Not found",8)),d=(c.NOT_SUPPORTED_ERR=(u[9]="Not supported",9),c.INUSE_ATTRIBUTE_ERR=(u[10]="Attribute in use",10));c.INVALID_STATE_ERR=(u[11]="Invalid state",11),c.SYNTAX_ERR=(u[12]="Syntax error",12),c.INVALID_MODIFICATION_ERR=(u[13]="Invalid modification",13),c.NAMESPACE_ERR=(u[14]="Invalid namespace",14),c.INVALID_ACCESS_ERR=(u[15]="Invalid access",15);function _(t,e){if(e instanceof Error)var n=e;else n=this,Error.call(this,u[t]),this.message=u[t],Error.captureStackTrace&&Error.captureStackTrace(this,_);return n.code=t,e&&(this.message=this.message+": "+e),n}function m(){}function p(t,e){this._node=t,this._refresh=e,A(this)}function A(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var n=t._refresh(t._node);for(var i in ct(t,"length",n.length),n)t[i]=n[i];t._inc=e}}function O(){}function R(t,e){for(var n=t.length;n--;)if(t[n]===e)return n}function D(t,e,n,i){if(i?e[R(e,i)]=n:e[e.length++]=n,t){var r=(n.ownerElement=t).ownerDocument;r&&(i&&B(r,t,i),z(r,t,n))}}function N(t,e,n){var i=R(e,n);if(!(0<=i))throw _(f,new Error(t.tagName+"@"+n));for(var r=e.length-1;i<r;)e[i]=e[++i];if(e.length=r,t){var a=t.ownerDocument;a&&(B(a,t,n),n.ownerElement=null)}}function L(t){if(this._features={},t)for(var e in t)this._features=t[e]}function I(){}function P(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function k(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(k(t,e))return!0}while(t=t.nextSibling)}function F(){}function z(t,e,n){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(e._nsMap[n.prefix?n.localName:""]=n.value)}function B(t,e,n){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete e._nsMap[n.prefix?n.localName:""]}function H(t,e,n){if(t&&t._inc){t._inc++;var i=e.childNodes;if(n)i[i.length++]=n;else{for(var r=e.firstChild,a=0;r;)r=(i[a++]=r).nextSibling;i.length=a}}}function U(t,e){var n=e.previousSibling,i=e.nextSibling;return n?n.nextSibling=i:t.firstChild=i,i?i.previousSibling=n:t.lastChild=n,H(t.ownerDocument,t),e}function j(t,e,n){var i=e.parentNode;if(i&&i.removeChild(e),e.nodeType===M){var r=e.firstChild;if(null==r)return e;var a=e.lastChild}else r=a=e;var s=n?n.previousSibling:t.lastChild;for(r.previousSibling=s,a.nextSibling=n,s?s.nextSibling=r:t.firstChild=r,null==n?t.lastChild=a:n.previousSibling=a;r.parentNode=t,r!==a&&(r=r.nextSibling););return H(t.ownerDocument||t,t),e.nodeType==M&&(e.firstChild=e.lastChild=null),e}function G(t,e){var n=e.parentNode;if(n){var i=t.lastChild;n.removeChild(e);i=t.lastChild}i=t.lastChild;return e.parentNode=t,e.previousSibling=i,e.nextSibling=null,i?i.nextSibling=e:t.firstChild=e,t.lastChild=e,H(t.ownerDocument,t,e),e}function V(){this._nsMap={}}function W(){}function q(){}function Y(){}function X(){}function $(){}function Z(){}function K(){}function Q(){}function J(){}function tt(){}function et(){}function nt(){}function it(t,e){var n=[],i=9==this.nodeType&&this.documentElement||this,r=i.prefix,a=i.namespaceURI;if(a&&null==r&&null==(r=i.lookupPrefix(a)))var s=[{namespace:a,prefix:null}];return at(this,n,t,e,s),n.join("")}function rt(t,e,n){var i=t.prefix||"",r=t.namespaceURI;if(!i&&!r)return!1;if("xml"===i&&"http://www.w3.org/XML/1998/namespace"===r||"http://www.w3.org/2000/xmlns/"==r)return!1;for(var a=n.length;a--;){var s=n[a];if(s.prefix==i)return s.namespace!=r}return!0}function at(t,e,n,i,r){if(i){if(!(t=i(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case y:r=r||[];var a=t.attributes,s=a.length,o=t.firstChild,c=t.tagName;n=v===t.namespaceURI||n,e.push("<",c);for(var u=0;u<s;u++){"xmlns"==(l=a.item(u)).prefix?r.push({prefix:l.localName,namespace:l.value}):"xmlns"==l.nodeName&&r.push({prefix:"",namespace:l.value})}for(u=0;u<s;u++){var l;if(rt(l=a.item(u),0,r)){var h=l.prefix||"",f=l.namespaceURI,d=h?" xmlns:"+h:" xmlns";e.push(d,'="',f,'"'),r.push({prefix:h,namespace:f})}at(l,e,n,i,r)}if(rt(t,0,r)){h=t.prefix||"",f=t.namespaceURI,d=h?" xmlns:"+h:" xmlns";e.push(d,'="',f,'"'),r.push({prefix:h,namespace:f})}if(o||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(c)){if(e.push(">"),n&&/^script$/i.test(c))for(;o;)o.data?e.push(o.data):at(o,e,n,i,r),o=o.nextSibling;else for(;o;)at(o,e,n,i,r),o=o.nextSibling;e.push("</",c,">")}else e.push("/>");return;case S:case M:for(o=t.firstChild;o;)at(o,e,n,i,r),o=o.nextSibling;return;case g:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,P),'"');case x:return e.push(t.data.replace(/[<&]/g,P));case b:return e.push("<![CDATA[",t.data,"]]>");case w:return e.push("\x3c!--",t.data,"--\x3e");case T:var _=t.publicId,m=t.systemId;if(e.push("<!DOCTYPE ",t.name),_)e.push(' PUBLIC "',_),m&&"."!=m&&e.push('" "',m),e.push('">');else if(m&&"."!=m)e.push(' SYSTEM "',m,'">');else{var p=t.internalSubset;p&&e.push(" [",p,"]"),e.push(">")}return;case C:return e.push("<?",t.target," ",t.data,"?>");case E:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function st(t,e,n){var i;switch(e.nodeType){case y:(i=e.cloneNode(!1)).ownerDocument=t;case M:break;case g:n=!0}if((i=i||e.cloneNode(!1)).ownerDocument=t,i.parentNode=null,n)for(var r=e.firstChild;r;)i.appendChild(st(t,r,n)),r=r.nextSibling;return i}function ot(t,e,n){var i=new e.constructor;for(var r in e){var a=e[r];"object"!=(void 0===a?"undefined":h(a))&&a!=i[r]&&(i[r]=a)}switch(e.childNodes&&(i.childNodes=new m),i.ownerDocument=t,i.nodeType){case y:var s=e.attributes,o=i.attributes=new O,c=s.length;o._ownerElement=i;for(var u=0;u<c;u++)i.setAttributeNode(ot(t,s.item(u),!0));break;case g:n=!0}if(n)for(var l=e.firstChild;l;)i.appendChild(ot(t,l,n)),l=l.nextSibling;return i}function ct(t,e,n){t[e]=n}_.prototype=Error.prototype,i(c,_),m.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var n=[],i=0;i<this.length;i++)at(this[i],n,t,e);return n.join("")}},p.prototype.item=function(t){return A(this),this[t]},r(p,m),O.prototype={length:0,item:m.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var n=this[e];if(n.nodeName==t)return n}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new _(d);var n=this.getNamedItem(t.nodeName);return D(this._ownerElement,this,t,n),n},setNamedItemNS:function(t){var e,n=t.ownerElement;if(n&&n!=this._ownerElement)throw new _(d);return e=this.getNamedItemNS(t.namespaceURI,t.localName),D(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return N(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var n=this.getNamedItemNS(t,e);return N(this._ownerElement,this,n),n},getNamedItemNS:function(t,e){for(var n=this.length;n--;){var i=this[n];if(i.localName==e&&i.namespaceURI==t)return i}return null}},L.prototype={hasFeature:function(t,e){var n=this._features[t.toLowerCase()];return!(!n||e&&!(e in n))},createDocument:function(t,e,n){var i=new F;if(i.implementation=this,i.childNodes=new m,(i.doctype=n)&&i.appendChild(n),e){var r=i.createElementNS(t,e);i.appendChild(r)}return i},createDocumentType:function(t,e,n){var i=new Z;return i.name=t,i.nodeName=t,i.publicId=e,i.systemId=n,i}},I.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return j(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return U(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return ot(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==x&&t.nodeType==x?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(t){for(var e=this;e;){var n=e._nsMap;if(n)for(var i in n)if(n[i]==t)return i;e=e.nodeType==g?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var n=e._nsMap;if(n&&t in n)return n[t];e=e.nodeType==g?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},i(a,I),i(a,I.prototype),F.prototype={nodeName:"#document",nodeType:S,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType!=M)return null==this.documentElement&&t.nodeType==y&&(this.documentElement=t),j(this,t,e),t.ownerDocument=this,t;for(var n=t.firstChild;n;){var i=n.nextSibling;this.insertBefore(n,e),n=i}return t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),U(this,t)},importNode:function(t,e){return st(this,t,e)},getElementById:function(e){var n=null;return k(this.documentElement,function(t){if(t.nodeType==y&&t.getAttribute("id")==e)return n=t,!0}),n},createElement:function(t){var e=new V;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new m,(e.attributes=new O)._ownerElement=e},createDocumentFragment:function(){var t=new tt;return t.ownerDocument=this,t.childNodes=new m,t},createTextNode:function(t){var e=new Y;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new X;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new $;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var n=new et;return n.ownerDocument=this,n.tagName=n.target=t,n.nodeValue=n.data=e,n},createAttribute:function(t){var e=new W;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new J;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var n=new V,i=e.split(":"),r=n.attributes=new O;return n.childNodes=new m,n.ownerDocument=this,n.nodeName=e,n.tagName=e,n.namespaceURI=t,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=e,r._ownerElement=n},createAttributeNS:function(t,e){var n=new W,i=e.split(":");return n.ownerDocument=this,n.nodeName=e,n.name=e,n.namespaceURI=t,n.specified=!0,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=e,n}},r(F,I),F.prototype.getElementsByTagName=(V.prototype={nodeType:y,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var n=this.ownerDocument.createAttribute(t);n.value=n.nodeValue=""+e,this.setAttributeNode(n)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===M?this.insertBefore(t,null):G(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);n&&this.removeAttributeNode(n)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);return n&&n.value||""},setAttributeNS:function(t,e,n){var i=this.ownerDocument.createAttributeNS(t,e);i.value=i.nodeValue=""+n,this.setAttributeNode(i)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(i){return new p(this,function(e){var n=[];return k(e,function(t){t===e||t.nodeType!=y||"*"!==i&&t.tagName!=i||n.push(t)}),n})},getElementsByTagNameNS:function(i,r){return new p(this,function(e){var n=[];return k(e,function(t){t===e||t.nodeType!==y||"*"!==i&&t.namespaceURI!==i||"*"!==r&&t.localName!=r||n.push(t)}),n})}}).getElementsByTagName,F.prototype.getElementsByTagNameNS=V.prototype.getElementsByTagNameNS,r(V,I),W.prototype.nodeType=g,r(W,I),q.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(){throw new Error(u[l])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,n){n=this.data.substring(0,t)+n+this.data.substring(t+e),this.nodeValue=this.data=n,this.length=n.length}},r(q,I),Y.prototype={nodeName:"#text",nodeType:x,splitText:function(t){var e=this.data,n=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var i=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}},r(Y,q),X.prototype={nodeName:"#comment",nodeType:w},r(X,q),$.prototype={nodeName:"#cdata-section",nodeType:b},r($,q),Z.prototype.nodeType=T,r(Z,I),K.prototype.nodeType=o,r(K,I),Q.prototype.nodeType=s,r(Q,I),J.prototype.nodeType=E,r(J,I),tt.prototype.nodeName="#document-fragment",tt.prototype.nodeType=M,r(tt,I),et.prototype.nodeType=C,r(et,I),nt.prototype.serializeToString=function(t,e,n){return it.call(t,e,n)},I.prototype.toString=it;try{if(Object.defineProperty){var ut=function t(e){switch(e.nodeType){case y:case M:var n=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&n.push(t(e)),e=e.nextSibling;return n.join("");default:return e.nodeValue}};Object.defineProperty(p.prototype,"length",{get:function(){return A(this),this.$$length}}),Object.defineProperty(I.prototype,"textContent",{get:function(){return ut(this)},set:function(t){switch(this.nodeType){case y:case M:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),ct=function(t,e,n){t["$$"+e]=n}}}catch(t){}n.DOMImplementation=L,n.XMLSerializer=nt},{}],34:[function(t,e,n){"use strict";n.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",nbsp:" ",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",times:"\xd7",divide:"\xf7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",euro:"\u20ac",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}},{}],35:[function(t,e,n){"use strict";var i=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,r=new RegExp("[\\-\\.0-9"+i.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+i.source+r.source+"*(?::"+i.source+r.source+"*)?$"),h=0,f=1,d=2,_=3,m=4,p=5,v=6,y=7;function s(){}function o(n,t,i,r,a){function s(t){if(65535<t){var e=55296+((t-=65536)>>10),n=56320+(1023&t);return String.fromCharCode(e,n)}return String.fromCharCode(t)}function o(t){var e=t.slice(1,-1);return e in i?i[e]:"#"===e.charAt(0)?s(parseInt(e.substr(1).replace("x","0x"))):(a.error("entity not found:"+t),t)}function e(t){if(m<t){var e=n.substring(m,t).replace(/&#?\w+;/g,o);f&&c(m),r.characters(e,0,t-m),m=t}}function c(t,e){for(;l<=t&&(e=h.exec(n));)u=e.index,l=u+e[0].length,f.lineNumber++;f.columnNumber=t-u+1}for(var u=0,l=0,h=/.*(?:\r\n?|\n)|.*$/g,f=r.locator,d=[{currentNSMap:t}],_={},m=0;;){try{var p=n.indexOf("<",m);if(p<0){if(!n.substr(m).match(/^\s*$/)){var v=r.doc,y=v.createTextNode(n.substr(m));v.appendChild(y),r.currentElement=y}return}switch(m<p&&e(p),n.charAt(p+1)){case"/":var g=n.indexOf(">",p+3),x=n.substring(p+2,g),b=d.pop();g<0?(x=n.substring(p+2).replace(/[\s<].*/,""),a.error("end tag name: "+x+" is not complete:"+b.tagName),g=p+1+x.length):x.match(/\s</)&&(x=x.replace(/[\s<].*/,""),a.error("end tag name: "+x+" maybe not complete"),g=p+1+x.length);var E=b.localNSMap,C=b.tagName==x;if(C||b.tagName&&b.tagName.toLowerCase()==x.toLowerCase()){if(r.endElement(b.uri,b.localName,x),E)for(var w in E)r.endPrefixMapping(w);C||a.fatalError("end tag name: "+x+" is not match the current start tagName:"+b.tagName)}else d.push(b);g++;break;case"?":f&&c(p),g=F(n,p,r);break;case"!":f&&c(p),g=k(n,p,r,a);break;default:f&&c(p);var S=new z,T=d[d.length-1].currentNSMap,M=(g=N(n,p,S,T,o,a),S.length);if(!S.closed&&P(n,g,S.tagName,_)&&(S.closed=!0,i.nbsp||a.warning("unclosed xml attribute")),f&&M){for(var A=D(f,{}),O=0;O<M;O++){var R=S[O];c(R.offset),R.locator=D(f,{})}r.locator=A,L(S,r,T)&&d.push(S),r.locator=f}else L(S,r,T)&&d.push(S);"http://www.w3.org/1999/xhtml"!==S.uri||S.closed?g++:g=I(n,g,S.tagName,o,r)}}catch(t){a.error("element parse error: "+t),g=-1}m<g?m=g:e(Math.max(p,m)+1)}}function D(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function N(t,e,n,i,r,a){for(var s,o=++e,c=h;;){var u=t.charAt(o);switch(u){case"=":if(c===f)s=t.slice(e,o),c=_;else{if(c!==d)throw new Error("attribute equal must after attrName");c=_}break;case"'":case'"':if(c===_||c===f){if(c===f&&(a.warning('attribute value must after "="'),s=t.slice(e,o)),e=o+1,!(0<(o=t.indexOf(u,e))))throw new Error("attribute value no end '"+u+"' match");l=t.slice(e,o).replace(/&#?\w+;/g,r),n.add(s,l,e-1),c=p}else{if(c!=m)throw new Error('attribute value must after "="');l=t.slice(e,o).replace(/&#?\w+;/g,r),n.add(s,l,e),a.warning('attribute "'+s+'" missed start quot('+u+")!!"),e=o+1,c=p}break;case"/":switch(c){case h:n.setTagName(t.slice(e,o));case p:case v:case y:c=y,n.closed=!0;case m:case f:case d:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),c==h&&n.setTagName(t.slice(e,o)),o;case">":switch(c){case h:n.setTagName(t.slice(e,o));case p:case v:case y:break;case m:case f:"/"===(l=t.slice(e,o)).slice(-1)&&(n.closed=!0,l=l.slice(0,-1));case d:c===d&&(l=s),c==m?(a.warning('attribute "'+l+'" missed quot(")!!'),n.add(s,l.replace(/&#?\w+;/g,r),e)):("http://www.w3.org/1999/xhtml"===i[""]&&l.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),n.add(l,l,e));break;case _:throw new Error("attribute value missed!!")}return o;case"\x80":u=" ";default:if(u<=" ")switch(c){case h:n.setTagName(t.slice(e,o)),c=v;break;case f:s=t.slice(e,o),c=d;break;case m:var l=t.slice(e,o).replace(/&#?\w+;/g,r);a.warning('attribute "'+l+'" missed quot(")!!'),n.add(s,l,e);case p:c=v}else switch(c){case d:n.tagName;"http://www.w3.org/1999/xhtml"===i[""]&&s.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+s+'" missed value!! "'+s+'" instead2!!'),n.add(s,s,e),e=o,c=f;break;case p:a.warning('attribute space is required"'+s+'"!!');case v:c=f,e=o;break;case _:c=m,e=o;break;case y:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function L(t,e,n){for(var i=t.tagName,r=null,a=t.length;a--;){var s=t[a],o=s.qName,c=s.value;if(0<(f=o.indexOf(":")))var u=s.prefix=o.slice(0,f),l=o.slice(f+1),h="xmlns"===u&&l;else u=null,h="xmlns"===(l=o)&&"";s.localName=l,!1!==h&&(null==r&&(r={},g(n,n={})),n[h]=r[h]=c,s.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(h,c))}for(a=t.length;a--;){(u=(s=t[a]).prefix)&&("xml"===u&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(s.uri=n[u||""]))}var f;l=0<(f=i.indexOf(":"))?(u=t.prefix=i.slice(0,f),t.localName=i.slice(f+1)):(u=null,t.localName=i);var d=t.uri=n[u||""];if(e.startElement(d,l,i,t),!t.closed)return t.currentNSMap=n,t.localNSMap=r,!0;if(e.endElement(d,l,i),r)for(u in r)e.endPrefixMapping(u)}function I(t,e,n,i,r){if(/^(?:script|textarea)$/i.test(n)){var a=t.indexOf("</"+n+">",e),s=t.substring(e+1,a);if(/[&<]/.test(s))return/^script$/i.test(n)||(s=s.replace(/&#?\w+;/g,i)),r.characters(s,0,s.length),a}return e+1}function P(t,e,n,i){var r=i[n];return null==r&&((r=t.lastIndexOf("</"+n+">"))<e&&(r=t.lastIndexOf("</"+n)),i[n]=r),r<e}function g(t,e){for(var n in t)e[n]=t[n]}function k(t,e,n,i){switch(t.charAt(e+2)){case"-":return"-"!==t.charAt(e+3)?-1:e<(r=t.indexOf("--\x3e",e+4))?(n.comment(t,e+4,r-e-4),r+3):(i.error("Unclosed comment"),-1);default:if("CDATA["==t.substr(e+3,6)){var r=t.indexOf("]]>",e+9);return n.startCDATA(),n.characters(t,e+9,r-e-9),n.endCDATA(),r+3}var a=x(t,e),s=a.length;if(1<s&&/!doctype/i.test(a[0][0])){var o=a[1][0],c=3<s&&/^public$/i.test(a[2][0])&&a[3][0],u=4<s&&a[4][0],l=a[s-1];return n.startDTD(o,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),l.index+l[0].length}}return-1}function F(t,e,n){var i=t.indexOf("?>",e);if(i){var r=t.substring(e,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){r[0].length;return n.processingInstruction(r[1],r[2]),i+2}return-1}return-1}function z(t){}function x(t,e){var n,i=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(r.lastIndex=e,r.exec(t);n=r.exec(t);)if(i.push(n),n[1])return i}s.prototype={parse:function(t,e,n){var i=this.domBuilder;i.startDocument(),g(e,e={}),o(t,e,n,i,this.errorHandler),i.endDocument()}},z.prototype={setTagName:function(t){if(!a.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,n){if(!a.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:n}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},n.XMLReader=s},{}]},{},[1,2,24,3,4,7,5,6,8,9,10,11,12,13,14,15,16,17,25,26,27,28,18,29,19,20,30,21,22,23,31,32,33,34,35]),function a(s,o,c){function u(e,t){if(!o[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=o[e]={exports:{}};s[e][0].call(r.exports,function(t){return u(s[e][1][t]||t)},r,r.exports,a,s,o,c)}return o[e].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}({1:[function(t,e,n){"use strict";t("./src/index")},{"./src/index":207}],2:[function(t,e,n){"use strict";var i=cc.js,r=t("./playable"),a=t("./animation-curves"),h=a.EventAnimCurve,f=a.EventInfo,w=a.DynamicAnimCurve,S=a.quickFindIndex,d=t("./types").WrapModeMask,T=t("../core/utils/binary-search").binarySearchEpsilon;function s(t,e){r.call(this),this.target=t,this.animation=e}i.extend(s,r);var o=s.prototype;function M(t){var e=t.split(".");return e.shift(),0<e.length?e:null}function c(t,b){var E=b.clip,i=b.curves;function C(t){if(!Array.isArray(t))return!1;for(var e=0,n=t.length;e<n;e++){var i=t[e];if(!Array.isArray(i)||6!==i.length)return!1}return!0}function r(t,e,n){e=b8e.getNormP(e,!0);var i,r=t instanceof cc.Node&&"position"===e&&n[0]&&Array.isArray(n[0].value),a=[],s=new w;s.target=t;var o=e.indexOf(".");-1!==o?t[i=e.slice(0,o)]:i=e,s.prop=i,s.subProps=M(e);for(var c=0,u=n.length;c<u;c++){var l=n[c],h=l.frame/b.duration;if(s.ratios.push(h),r){var f=l.motionPath;f&&!C(f)&&(f=null),a.push(f)}var d=l.value;s.values.push(d);var _=l.curve;if(_){if("string"==typeof _){s.types.push(_);continue}if(Array.isArray(_)){_[0]===_[1]&&_[2]===_[3]?s.types.push(w.Linear):s.types.push(w.Bezier(_));continue}}s.types.push(w.Linear)}r&&sampleMotionPaths(a,s,E.duration,E.sample);for(var m,p,v=s.ratios,y=!0,g=1,x=v.length;g<x;g++)if(m=v[g]-v[g-1],1===g)p=m;else if(1e-6<Math.abs(m-p)){y=!1;break}return s._findFrameIndex=y?S:T,s}i.length=0,b.duration=E.duration,b.speed=E.speed,b.wrapMode=E.wrapMode,b.frameRate=E.sample,(b.wrapMode&d.Loop)===d.Loop?b.repeatCount=1/0:b.repeatCount=1,function(t,e){var n=r(t.getComponent(cc.Sprite),"_$spriteFrame",e);i.push(n)}(t,E.frames);var e=E.events;if(e)for(var n,a=0,s=e.length;a<s;a++){n||((n=new h).target=t,i.push(n));var o,c=e[a],u=c.frame/b.duration,l=T(n.ratios,u);0<=l?o=n.events[l]:(o=new f,n.ratios.push(u),n.events.push(o)),o.add(c.func,c.params)}}o.playState=function(t,e){t.clip&&(t.curveLoaded||c(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},o.stopStatesExcept=function(t){},o.addAnimation=function(t){(this.anim=t)._setEventTarget(this.animation)},o.removeAnimation=function(t){this.stop(),t.animator=null,this.anim=null},o.sample=function(){this.anim&&this.anim.sample()},o.stopState=function(t){t&&t.stop()},o.pauseState=function(t){t&&t.pause()},o.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},o.setStateTime=function(t,e){void 0!==e?t&&(t.setTime(e),t.sample()):(e=t,this.anim&&(this.anim.setTime(e),this.anim.sample()))},o.onStop=function(){this.anim&&this.anim.stop()},o.onPause=function(){this.anim&&(this.anim.pause(),this.anim.animator=null)},o.onResume=function(){this.anim&&(this.anim.animator=this).anim.resume()},o._reloadClip=function(t){c(this.target,t)},e.exports=s},{"../core/utils/binary-search":155,"./animation-curves":4,"./playable":8,"./types":9}],3:[function(t,e,n){"use strict";var i=t("./types").WrapMode,o=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:"Float"},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:i.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return null;var n=new o;n.sample=e||n.sample,n._duration=t.length/n.sample;for(var i=[],r=1/n.sample,a=0,s=t.length;a<s;a++)i[a]={frame:a*r,value:t[a]};return n.curveData={comps:{"cc.Sprite":{spriteFrame:i}}},n}}});cc.AnimationClip=e.exports=o},{"./types":9}],4:[function(t,e,n){"use strict";var _=t("../core/utils/binary-search").binarySearchEpsilon,m=t("./types").WrapModeMask,p=t("./types").WrappedInfo;function d(t,e){if("string"==typeof e){var n=cc.easing[e];n&&(t=n(t))}else Array.isArray(e);return t}var i=cc.Class({name:"cc.AnimCurve",sample:function(){},onTimeChangedManually:void 0}),r=cc.Class({name:"cc.DynamicAnimCurve",extends:i,properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:_,_lerp:void 0,_lerpNumber:function(t,e,n){return t+(e-t)*n},_lerpObject:function(t,e,n){return t.lerp(e,n)},_lerpQuat:function(){var i=cc.quat();return function(t,e,n){return t.lerp(e,n,i)}}(),_lerpVector:function(){var i=cc.v3();return function(t,e,n){return t.lerp(e,n,i)}}(),sample:function(t,e){var n=this.values,i=this.ratios,r=i.length;if(0!==r){var a,s=this._findFrameIndex(i,e);if(s<0)if((s=~s)<=0)a=n[0];else if(r<=s)a=n[r-1];else{var o=n[s-1];if(this._lerp){var c=i[s-1],u=i[s],l=this.types[s-1],h=(e-c)/(u-c);l&&(h=d(h,l));var f=n[s];a=this._lerp(o,f,h)}else a=o}else a=n[s];this.target[this.prop]=a}}});function a(){this.events=[]}r.Linear=null,r.Bezier=function(t){return t},a.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var s=cc.Class({name:"cc.EventAnimCurve",extends:i,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new p}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&(t-=1),0|t},sample:function(t,e,n){var i=this.ratios.length,r=n.getWrappedInfo(n.time,this._wrappedInfo),a=r.direction,s=_(this.ratios,r.ratio);if(s<0&&(s=~s-1,a<0&&(s+=1)),this._ignoreIndex!==s&&(this._ignoreIndex=NaN),r.frameIndex=s,!this._lastWrappedInfo)return this.__fireEvent(s),void(this._lastWrappedInfo=new p(r));var o=n.wrapMode,c=this._wrapIterations(r.iterations),u=this._lastWrappedInfo,l=this._wrapIterations(u.iterations),h=u.frameIndex,f=u.direction,d=-1!==l&&c!==l;if(h===s&&d&&1===i)this.__fireEvent(0);else if(h!==s||d){a=f;do{if(h!==s){if(-1===a&&0===h&&0<s?((o&m.PingPong)===m.PingPong?a*=-1:h=i,l++):1===a&&h===i-1&&s<i-1&&((o&m.PingPong)===m.PingPong?a*=-1:h=-1,l++),h===s)break;if(c<l)break}h+=a,cc.director.getAnimationManager().pushDelayEvent(this,"_$__fireEvent",[h])}while(h!==s&&-1<h&&h<i)}this._lastWrappedInfo.set(r)},__fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid)for(var n=this.target._components,i=0;i<e.length;i++)for(var r=e[i],a=r.func,s=0;s<n.length;s++){var o=n[s],c=o[a];c&&c.apply(o,r.params)}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var n=e.getWrappedInfo(t,this._wrappedInfo),i=n.direction,r=_(this.ratios,n.ratio);r<0&&(r=~r-1,i<0&&(r+=1),this._ignoreIndex=r)}});e.exports={AnimCurve:i,DynamicAnimCurve:r,EventAnimCurve:s,EventInfo:a,computeRatioByType:d,quickFindIndex:function(t,e){var n=t.length-1;if(0==n)return 0;var i=t[0];if(e<i)return 0;var r=t[n];if(r<e)return n;var a=(e=(e-i)/(r-i))/(1/n),s=0|a;return a-s<1e-6?s:1+s-a<1e-6?1+s:~(1+s)}}},{"../core/utils/binary-search":155,"./types":9}],5:[function(t,e,n){"use strict";cc.js;var i=cc.Class({ctor:function(){this._b8eAnims=b8e.LinkedList.get(),this._delayEvents=[],cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(t){this._b8eAnims.forEach(this._b8eOnUpdate,this,t);for(var e=this._delayEvents,n=0,i=e.length;n<i;n++){var r=e[n];r.target[r.func].apply(r.target,r.args)}e.length=0},_b8eOnUpdate:function(t,e){t._isPlaying&&!t._isPaused&&t.update(e)},destruct:function(){},addAnimation:function(t){this._b8eAnims.append(t)},removeAnimation:function(t){this._b8eAnims.remove(t)},pushDelayEvent:function(t,e,n){0===e.indexOf("_$")&&(e=e.substr(2)),this._delayEvents.push({target:t,func:e,args:n})}});cc.AnimationManager=e.exports=i},{}],6:[function(t,e,n){"use strict";var i=cc.js,r=t("./playable"),a=t("./types"),h=a.WrappedInfo,s=a.WrapMode,f=a.WrapModeMask;function o(t,e){r.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new h,this._lastWrappedInfo=null,this._process=u,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=s.Normal,this.time=0,this._target=null,this._lastframeEventOn=!1,b8e.SHC(this)}i.extend(o,r);var c=o.prototype;function u(){var t,e=this.sample();this._lastframeEventOn&&(t=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new h(e),1<this.repeatCount&&(0|e.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(e)),e.stopped&&(this.stop(),this.emit("finished",this))}function l(){var t=this.time,e=this.duration;e<t?0==(t%=e)&&(t=e):t<0&&0!=(t%=e)&&(t+=e);for(var n=t/e,i=this.curves,r=0,a=i.length;r<a;r++)i[r].sample(t,n,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=n),(0<this.time&&this._lastIterations>n||this.time<0&&this._lastIterations<n)&&this.emit("lastframe",this),this._lastIterations=n)}c.emit=function(){for(var t=new Array(arguments.length),e=0,n=t.length;e<n;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_$__emit",t)},c.__emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},c.on=function(t,e,n){return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),this._target.on(t,e,n)):null},c.once=function(t,e,n){if(this._target&&this._target.isValid){"lastframe"===t&&(this._lastframeEventOn=!0);var i=this;return this._target.once(t,function(t){e.call(n,t),i._lastframeEventOn=!1})}return null},c.off=function(t,e,n){this._target&&this._target.isValid&&("lastframe"===t&&(this._target.hasEventListener(t)||(this._lastframeEventOn=!1)),this._target.off(t,e,n))},c._setEventTarget=function(t){this._target=t},c.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},c.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},c.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},c.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},c.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;for(var e=this.curves,n=0,i=e.length;n<i;n++){var r=e[n];r.onTimeChangedManually&&r.onTimeChangedManually(t,this)}},c.update=function(t){0<this._delayTime&&(this._delayTime-=t,0<this._delayTime)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},c._needRevers=function(t){var e=this.wrapMode,n=!1;return(e&f.PingPong)===f.PingPong&&(t-(0|t)==0&&0<t&&(t-=1),1&t&&(n=!n)),(e&f.Reverse)===f.Reverse&&(n=!n),n},c.getWrappedInfo=function(t,e){e=e||new h;var n=!1,i=this.duration,r=this.repeatCount,a=0<t?t/i:-t/i;if(r<=a){n=!0;var s=(a=r)-(0|r);0===s&&(s=1),t=s*i*(0<t?1:-1)}if(i<t){var o=t%i;t=0==o?i:o}else t<0&&0!=(t%=i)&&(t+=i);var c=!1,u=this._wrapMode&f.ShouldWrap;u&&(c=this._needRevers(a));var l=c?-1:1;return this.speed<0&&(l*=-1),u&&c&&(t=i-t),e.ratio=t/i,e.time=t,e.direction=l,e.stopped=n,e.iterations=a,e},c.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),e=this.curves,n=0,i=e.length;n<i;n++)e[n].sample(t.time,t.ratio,this);return t},i.get(c,"_$clip",function(){return this._clip}),i.get(c,"_$name",function(){return this._name}),i.obsolete(c,"AnimationState.length","duration"),i.getset(c,"_$curveLoaded",function(){return 0<this.curves.length},function(){this.curves.length=0}),i.getset(c,"_$wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&f.Loop?this.repeatCount=1/0:this.repeatCount=1}),i.getset(c,"_$repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t;var e=this._wrapMode&f.ShouldWrap,n=(this.wrapMode&f.Reverse)===f.Reverse;this._process=t!==1/0||e||n?u:l}),i.getset(c,"_$delay",function(){return this._delay},function(t){this._delayTime=this._delay=t}),cc.AnimationState=e.exports=o},{"./playable":8,"./types":9}],7:[function(t,e,n){"use strict";t("./types"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":2,"./animation-clip":3,"./animation-curves":4,"./animation-manager":5,"./animation-state":6,"./types":9}],8:[function(t,e,n){"use strict";var i=cc.js;function r(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var a=r.prototype;function s(){}i.get(a,"_$isPlaying",function(){return this._isPlaying},!0),i.get(a,"_$isPaused",function(){return this._isPaused},!0),a.onPlay=s,a.onPause=s,a.onResume=s,a.onStop=s,a.onError=s,a.play=function(){this._isPlaying?this._isPaused&&(this._isPaused=!1,this.onResume()):(this._isPlaying=!0,this.onPlay())},a.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},a.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},a.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},a.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=r},{}],9:[function(t,e,n){"use strict";var i={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},r=cc.Enum({Default:0,Normal:1,Reverse:i.Reverse,Loop:i.Loop,LoopReverse:i.Loop|i.Reverse,PingPong:i.PingPong,PingPongReverse:i.PingPong|i.Reverse});function a(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.WrapMode=r,a.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.exports={WrapModeMask:i,WrapMode:r,WrappedInfo:a}},{}],10:[function(t,e,n){"use strict";var o=t("../vmath"),i=t("../CCNode"),a=i.EventType,s=i._LocalDirtyFlag,c=Math.PI/180;function r(){if(this._localMatDirty){var t=this._matrix;if(o.mat4.fromRTS(t,this._quat,this._position,this._scale),this._skewX||this._skewY){var e=t.m00,n=t.m01,i=t.m04,r=t.m05,a=Math.tan(this._skewX*c),s=Math.tan(this._skewY*c);a===1/0&&(a=99999999),s===1/0&&(s=99999999),t.m00=e+i*s,t.m01=n+r*s,t.m04=i+e*a,t.m05=r+n*a}this._localMatDirty=0,this._worldMatDirty=!0}}function u(){if(this._localMatDirty&&this._updateLocalMatrix(),this._parent){var t=this._parent._worldMatrix;o.mat4.mul(this._worldMatrix,t,this._matrix)}else o.mat4.copy(this._worldMatrix,this._matrix);this._worldMatDirty=!1}function l(t,e,n){var i=void 0;n=void 0===e?(i=t.x,e=t.y,t.z||0):(i=t,n||0);var r=this._position;r.x===i&&r.y===e&&r.z===n||(r.x=i,r.y=e,r.z=n,this.setLocalDirty(s.POSITION),this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(a.POSITION_CHANGED))}var h=cc.Node.prototype,f=h._updateLocalMatrix,d=h._calculWorldMatrix,_=h._upgrade_1x_to_2x,m=h._mulMat;h.setPosition=l,h.setScale=function(t,e,n){t&&"number"!=typeof t?(e=t.y,n=t.z||1,t=t.x):void 0!==t&&void 0===e?n=e=t:void 0===n&&(n=1),this._scale.x===t&&this._scale.y===e&&this._scale.z===n||(this._scale.x=t,this._scale.y=e,this._scale.z=n,this.setLocalDirty(s.SCALE),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,2&this._eventMask&&this.emit(a.SCALE_CHANGED))},h._upgrade_1x_to_2x=function(){this._is3DNode&&this._update3DFunction(),_.call(this)},h._update3DFunction=function(){this._is3DNode?(this._updateLocalMatrix=r,this._calculWorldMatrix=u,this._mulMat=o.mat4.mul):(this._updateLocalMatrix=f,this._calculWorldMatrix=d,this._mulMat=m),this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged(),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,this._localMatDirty=s.ALL},cc.js.getset(h,"_$position",h.getPosition,l,!1,!0),cc.js.getset(h,"_$is3DNode",function(){return this._is3DNode},function(t){this._is3DNode!==t&&(this._is3DNode=t,this._update3DFunction())}),cc.js.getset(h,"_$scaleZ",function(){return this._scale.z},function(t){this._scale.z!==t&&(this._scale.z=t,this.setLocalDirty(s.SCALE),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,2&this._eventMask&&this.emit(a.SCALE_CHANGED))}),cc.js.getset(h,"_$z",function(){return this._position.z},function(t){var e=this._position;t!==e.z&&(e.z=t,this.setLocalDirty(s.POSITION),this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(a.POSITION_CHANGED))}),cc.js.getset(h,"_$eulerAngles",function(){return this._quat.toEuler(cc.v3())},function(t){this._quat.fromEuler(t),this.setLocalDirty(s.ROTATION),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM}),cc.js.getset(h,"_$quat",function(){return this._quat},h.setRotation)},{"../CCNode":13,"../vmath":184}],11:[function(t,e,n){"use strict";var i=t("./event/event-target"),r=t("./component-scheduler"),a=t("./node-activator"),u=t("./platform/CCObject"),l=t("./CCGame"),s=t("./event-manager"),o=t("./CCScheduler");cc.Director=function(){i.call(this),this.invalid=!1,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._lastUpdate=0,this._deltaTime=0,this._scheduler=null,this._compScheduler=null,this._nodeActivator=null,this._actionManager=null;var t=this;l.on(l.EVENT_SHOW,function(){t._lastUpdate=performance.now()}),l.once(l.EVENT_ENGINE_INITED,this.init,this)},cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new o,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,o.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new r,this._nodeActivator=new a,s&&s.setEnabled(!0),cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,o.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,o.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,o.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc._widgetManager&&cc._widgetManager.init(this)},calculateDeltaTime:function(t){this._deltaTime=(t-this._lastUpdate)/1e3,this._lastUpdate=t},convertToGL:function(t){var e=l.container,n=cc.view,i=e.getBoundingClientRect(),r=i.left+window.pageXOffset-e.clientLeft,a=i.top+window.pageYOffset-e.clientTop,s=n._devicePixelRatio*(t.x-r),o=n._devicePixelRatio*(a+i.height-t.y);return n._isRotated?cc.v2(n._viewportRect.width-o,s):cc.v2(s,o)},convertToUI:function(t){var e=l.container,n=cc.view,i=e.getBoundingClientRect(),r=i.left+window.pageXOffset-e.clientLeft,a=i.top+window.pageYOffset-e.clientTop,s=cc.v2(0,0);return n._isRotated?(s.x=r+t.y/n._devicePixelRatio,s.y=a+i.height-(n._viewportRect.width-t.x)/n._devicePixelRatio):(s.x=r+t.x*n._devicePixelRatio,s.y=a+i.height-t.y*n._devicePixelRatio),s},end:function(){this._purgeDirectorInNextLoop=!0},getWinSize:function(){return cc.size(cc.winSize)},getWinSizeInPixels:function(){return cc.size(cc.winSize)},pause:function(){this._paused||(this._paused=!0)},purgeCachedData:function(){},purgeDirector:function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),s&&s.setEnabled(!1),b8e.renderer.clear(),cc.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation()},reset:function(){this.purgeDirector(),s&&s.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},runSceneImmediate:function(t,e,n){t._load();for(var i=Object.keys(l._persistRootNodes).map(function(t){return l._persistRootNodes[t]}),r=0;r<i.length;r++){var a=i[r],s=t.getChildByUuid(a.uuid);if(s){var o=s.getSiblingIndex();s._destroyImmediate(),t.insertChild(a,o)}else a.setParent(t)}var c=this._scene;cc.isValid(c)&&c.destroy(),this._scene=null,u._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t),(this._scene=t)._activate(),this.startAnimation(),n&&n(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,n){t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,n)},this)},_getSceneUuid:function(t){var e=l._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://")||(t="/"+t);for(var n=0;n<e.length;n++){var i=e[n];if(i.url.endsWith(t))return i}}else if("number"==typeof t&&0<=t&&t<e.length)return e[t];return null},loadScene:function(t,e,n){if(this._loadingScene)return!1;var i=this._getSceneUuid(t);if(i){var r=i.uuid;return this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(r,e,n),!0}return!1},preloadScene:function(t,e,n){if(void 0===n&&(n=e,e=null),this._getSceneUuid(t))this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t);else{var i='Can not preload the scene "'+t+'" because it is not in the build settings.';n(new Error(i)),b8e.error("preloadScene: "+i)}},_loadSceneByUuid:function(r,a,s){console.time("LoadScene "+r),cc.AssetLibrary.loadAsset(r,function(t,e){console.timeEnd("LoadScene "+r);var n=cc.director;if(n._loadingScene="",t)t="Failed to load scene: "+t,b8e.error(t);else{if(e instanceof cc.SceneAsset){var i=e.scene;return i._id=e._uuid,i._name=e._name,void n.runSceneImmediate(i,s,a)}t="The asset "+r+" is not a scene",b8e.error(t)}a&&a(t)})},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate,this._paused=!1,this._deltaTime=0)},setDepthTest:function(t){cc.Camera.main&&(cc.Camera.main.depth=!!t)},setClearColor:function(t){cc.Camera.main&&(cc.Camera.main.backgroundColor=t)},getRunningScene:function(){return this._scene},getScene:function(){return this._scene},getAnimationInterval:function(){return 1e3/l.getFrameRate()},setAnimationInterval:function(t){l.setFrameRate(Math.round(1e3/t))},getDeltaTime:function(){return this._deltaTime},getTotalFrames:function(){return this._totalFrames},isPaused:function(){return this._paused},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},startAnimation:function(){this.invalid=!1,this._lastUpdate=performance.now()},stopAnimation:function(){this.invalid=!0},mainLoop:function(t){this.calculateDeltaTime(t),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),u._deferredDestroy()),cc.Camera.main.beforeDraw(),b8e.renderer.render(this._scene)},__fastOn:function(t,e,n){this.add(t,e,n)},__fastOff:function(t,e,n){this.remove(t,e,n)}},cc.js.addon(cc.Director.prototype,i.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_draw",cc.Director.EVENT_AFTER_VISIT="director_before_draw",cc.Director.EVENT_BEFORE_DRAW="director_before_draw",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.director=new cc.Director,e.exports=cc.director},{"./CCGame":12,"./CCScheduler":16,"./component-scheduler":34,"./event-manager":58,"./event/event-target":60,"./node-activator":79,"./platform/CCObject":87}],12:[function(i,r,t){(function(o){"use strict";var t=i("./event/event-target"),e=i("./platform/CCInputManager"),c=i("../core/renderer/utils/dynamic-atlas/manager"),n={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(){},getFrameRate:function(){return this.config.frameRate},step:function(){cc.director.mainLoop()},pause:function(){},resume:function(){},isPaused:function(){return!1},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var t in n._persistRootNodes)n.removePersistRootNode(n._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.director.purgeDirector(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),n.onStart(),n.emit(n.EVENT_RESTART)})},end:function(){close()},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED))},_prepareFinished:function(t){this._prepared=!0,this._initEngine(),this.emit(this.EVENT_GAME_INITED),t&&t()},eventTargetOn:t.prototype.on,eventTargetOnce:t.prototype.once,on:function(t,e,n){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(n):this.eventTargetOn(t,e,n)},once:function(t,e,n){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(n):this.eventTargetOnce(t,e,n)},prepare:function(t){if(this._prepared)t&&t();else{var e=this.config.jsList;e&&0<e.length||this._prepareFinished(t)}},run:function(t,e){this._initConfig(t),this.onStart=e,this.prepare(n.onStart&&n.onStart.bind(n))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var n=cc.director._scene;if(cc.isValid(n))if(t.parent){if(!(t.parent instanceof cc.Scene))return;if(t.parent!==n)return}else t.setParent(n);(this._persistRootNodes[e]=t)._persistNode=!0}}},removePersistRootNode:function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)},isPersistRootNode:function(t){return t._persistNode},_initConfig:function(t){"number"!=typeof t.debugMode&&(t.debugMode=0),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||2<e||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=!!t.showFPS,this._sceneInfos=t.scenes||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],this.config=t,this._configLoaded=!0},_determineRenderType:function(){var t=this.config,e=parseInt(t.renderMode)||0;this.renderType=this.RENDER_TYPE_CANVAS;var n=!1;if(0===e?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,n=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,n=!0):1===e&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,n=!0):2===e&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,n=!0),!n)throw new Error(debug.getError(3820,e))},_initRenderer:function(){if(!this._rendererInitialized){var t=this.config.id,e=void 0,n=void 0,i=void 0,r=void 0;if(IS_XIAOMIGAME)this.container=document.createElement("DIV"),this.frame=o.document.documentElement,this.frame.id="gameContainer",this.canvas=i=canvas,e=this.frame.clientWidth,n=this.frame.clientHeight;else if(IS_WECHATGAME||IS_RUNTIME)this.container=r=document.createElement("DIV"),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,i=cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?window.sharedCanvas||wx.getSharedCanvas():IS_RUNTIME?window.__canvas:canvas,this.canvas=i;else if(IS_QQPLAY)this.container=document.createElement("DIV"),this.frame=document.documentElement,this.canvas=i=canvas;else{var a=t instanceof HTMLElement?t:document.querySelector(t)||document.querySelector("#"+t);"CANVAS"===a.tagName?(e=a.width,n=a.height,this.canvas=i=a,this.container=r=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(r,i)):(a.tagName,e=a.clientWidth,n=a.clientHeight,this.canvas=i=document.createElement("CANVAS"),this.container=r=document.createElement("DIV"),a.appendChild(r)),r.setAttribute("id","Cocos2dGameContainer"),r.appendChild(i),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,function(t,e){-1<(" "+t.className+" ").indexOf(" "+e+" ")||(t.className&&(t.className+=" "),t.className+=e)}(i,"gameCanvas"),i.setAttribute("width",e||480),i.setAttribute("height",n||320),i.setAttribute("tabindex",99)}if(this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL){var s={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS};b8e.renderer.initWebGL(i,s),this._renderContext=b8e.renderer.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&c&&(c.enabled=!0)}this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,b8e.renderer.initCanvas(i),this._renderContext=b8e.renderer.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this._rendererInitialized=!0}},_initEvents:function(){window,this.config.registerSystemEvent&&e.registerSystemEvent(this.canvas),this.on(n.EVENT_HIDE,function(){n.pause()}),this.on(n.EVENT_SHOW,function(){n.resume()})}};t.call(n),cc.js.addon(n,t.prototype),cc.game=r.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../core/renderer/utils/dynamic-atlas/manager":124,"./event/event-target":60,"./platform/CCInputManager":85}],13:[function(t,e,n){"use strict";function i(){}var h=t("./vmath"),r=t("./utils/base-node"),a=t("./utils/prefab-helper"),s=t("./utils/math-pools"),o=t("./utils/affine-transform"),c=t("./event-manager"),u=t("./platform/CCMacro"),l=t("./platform/js"),f=(t("./event/event"),t("./event/event-target")),d=cc.Object.Flags.Destroying,v=Math.PI/180,_=!!cc.ActionManager,m=cc.v2(),p=cc.v2(),y=h.mat4.create(),g=h.vec3.create(),x=h.quat.create(),b=new Array(16);function E(t,e){var n=t.getLocation(),i=this.owner;return!!i._hitTest(n,this)&&(e.type=N.TOUCH_START,e.touch=t,e.bubbles=!0,i.dispatchEvent(e),!0)}function C(t,e){var n=this.owner;e.type=N.TOUCH_MOVE,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)}function w(t,e){var n=t.getLocation(),i=this.owner;i._hitTest(n,this)?e.type=N.TOUCH_END:e.type=N.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)}function S(t,e){t.getLocation();var n=this.owner;e.type=N.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)}function T(t){var e=t.getLocation(),n=this.owner;n._hitTest(e,this)&&(t.type=N.MOUSE_DOWN,t.bubbles=!0,n.dispatchEvent(t))}function M(t){var e=t.getLocation(),n=this.owner;if(n._hitTest(e,this))this._previousIn||(P&&P._mouseListener&&(t.type=N.MOUSE_LEAVE,P.dispatchEvent(t),P._mouseListener._previousIn=!1),P=this.owner,t.type=N.MOUSE_ENTER,n.dispatchEvent(t),this._previousIn=!0),t.type=N.MOUSE_MOVE,t.bubbles=!0,n.dispatchEvent(t);else{if(!this._previousIn)return;t.type=N.MOUSE_LEAVE,n.dispatchEvent(t),this._previousIn=!1,P=null}t.stopPropagation()}function A(t){var e=t.getLocation(),n=this.owner;n._hitTest(e,this)&&(t.type=N.MOUSE_UP,t.bubbles=!0,n.dispatchEvent(t),t.stopPropagation())}function O(t){var e=t.getLocation(),n=this.owner;n._hitTest(e,this)&&(t.type=N.MOUSE_WHEEL,t.bubbles=!0,n.dispatchEvent(t),t.stopPropagation())}b.length=0;var R=cc.Enum({DEBUG:31}),D=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,RT:7,ALL:65535}),N=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed"}),L=[N.TOUCH_START,N.TOUCH_MOVE,N.TOUCH_END,N.TOUCH_CANCEL],I=[N.MOUSE_DOWN,N.MOUSE_ENTER,N.MOUSE_MOVE,N.MOUSE_LEAVE,N.MOUSE_UP,N.MOUSE_WHEEL],P=null;function k(t){var e=cc.Mask;if(e)for(var n=0,i=t;i&&cc.Node.isNode(i);i=i._parent,++n)if(i.getComponent(e))return{index:n,node:i};return null}function F(t,e){if(t._objFlags&d)return!0;var n=0;if(t._bubblingListeners)for(;n<e.length;++n)if(t._bubblingListeners.hasEventListener(e[n]))return!0;if(t._capturingListeners)for(;n<e.length;++n)if(t._capturingListeners.hasEventListener(e[n]))return!0;return!1}function z(t,e){var n,i;for(e.target=t,b.length=0,t._getCapturingTargets(e.type,b),e.eventPhase=1,i=b.length-1;0<=i;--i)if((n=b[i])._capturingListeners&&((e.currentTarget=n)._capturingListeners.emit(e.type,e,b),e._propagationStopped))return void(b.length=0);if(b.length=0,e.eventPhase=2,(e.currentTarget=t)._capturingListeners&&t._capturingListeners.emit(e.type,e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.emit(e.type,e),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,b),e.eventPhase=3,i=0;i<b.length;++i)if((n=b[i])._bubblingListeners&&((e.currentTarget=n)._bubblingListeners.emit(e.type,e),e._propagationStopped))return void(b.length=0);b.length=0}function B(t){var e=t.groupIndex;return 0===e&&t.parent&&(e=B(t.parent)),e}function H(t){var e=B(t);t._cullingMask=1<<e;for(var n=0;n<t._children.length;n++)H(t._children[n])}var U={name:"cc.Node",extends:r,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:cc.Vec3,_scale:cc.Vec3,_quat:cc.Quat,_skewX:0,_skewY:0,_zIndex:{default:void 0,type:cc.Integer},_localZOrder:{default:0,serializable:!1},_is3DNode:!1,groupIndex:{default:0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t),H(this),this.emit(N.GROUP_CHANGED,this)}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;t!==e.x&&(e.x=t,this.setLocalDirty(D.POSITION),this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(N.POSITION_CHANGED))}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;t!==e.y&&(e.y=t,this.setLocalDirty(D.POSITION),this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(N.POSITION_CHANGED))}},rotation:{get:function(){return-this.angle},set:function(t){this.angle=-t}},angle:{get:function(){return this._eulerAngles.z},set:function(t){h.vec3.set(this._eulerAngles,0,0,t),this._fromEuler(),this.setLocalDirty(D.ROTATION),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,4&this._eventMask&&this.emit(N.ROTATION_CHANGED)}},rotationX:{get:function(){return this._eulerAngles.x},set:function(t){this._eulerAngles.x!==t&&(this._eulerAngles.x=t,this._eulerAngles.x===this._eulerAngles.y?h.quat.fromEuler(this._quat,0,0,-t):h.quat.fromEuler(this._quat,t,this._eulerAngles.y,0),this.setLocalDirty(D.ROTATION),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,4&this._eventMask&&this.emit(N.ROTATION_CHANGED))}},rotationY:{get:function(){return this._eulerAngles.y},set:function(t){this._eulerAngles.y!==t&&(this._eulerAngles.y=t,this._eulerAngles.x===this._eulerAngles.y?h.quat.fromEuler(this._quat,0,0,-t):h.quat.fromEuler(this._quat,this._eulerAngles.x,t,0),this.setLocalDirty(D.ROTATION),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,4&this._eventMask&&this.emit(N.ROTATION_CHANGED))}},scale:{get:function(){return this._scale.x},set:function(t){this.setScale(t)}},scaleX:{get:function(){return this._scale.x},set:function(t){this._scale.x!==t&&(this._scale.x=t,this.setLocalDirty(D.SCALE),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,2&this._eventMask&&this.emit(N.SCALE_CHANGED))}},scaleY:{get:function(){return this._scale.y},set:function(t){this._scale.y!==t&&(this._scale.y=t,this.setLocalDirty(D.SCALE),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,2&this._eventMask&&this.emit(N.SCALE_CHANGED))}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this.setLocalDirty(D.SKEW),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this.setLocalDirty(D.SKEW),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM}},opacity:{get:function(){return this._opacity},set:function(t){t=cc.misc.clampf(t,0,255),this._opacity!==t&&(this._opacity=t,this._renderFlag|=b8e.RenderFlow.FLAG_OPACITY)},range:[0,255]},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.set(t),32&this._eventMask&&this.emit(N.COLOR_CHANGED,t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;e.x!==t&&(e.x=t,16&this._eventMask&&this.emit(N.ANCHOR_CHANGED))}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;e.y!==t&&(e.y=t,16&this._eventMask&&this.emit(N.ANCHOR_CHANGED))}},width:{get:function(){return this._contentSize.width},set:function(t){t!==this._contentSize.width&&(this._contentSize.width=t,8&this._eventMask&&this.emit(N.SIZE_CHANGED))}},height:{get:function(){return this._contentSize.height},set:function(t){t!==this._contentSize.height&&(this._contentSize.height=t,8&this._eventMask&&this.emit(N.SIZE_CHANGED))}},zIndex:{get:function(){return this._localZOrder>>16},set:function(t){t>u.MAX_ZINDEX?t=u.MAX_ZINDEX:t<u.MIN_ZINDEX&&(t=u.MIN_ZINDEX),this.zIndex!==t&&(this._localZOrder=65535&this._localZOrder|t<<16,this._parent&&this._onSiblingIndexChanged())}}},ctor:function(){this._reorderChildDirty=!1,this._widget=null,this._renderComponent=null,this._capturingListeners=null,this._bubblingListeners=null,this._touchListener=null,this._mouseListener=null,this._scale.x=1,this._scale.y=1,this._scale.z=1,this._matrix=s.mat4.get(),this._worldMatrix=s.mat4.get(),this._localMatDirty=D.ALL,this._worldMatDirty=!0,this._eventMask=0,this._cullingMask=1,this._childArrivalOrder=1,this._eulerAngles=cc.v3()},statics:{EventType:N,_LocalDirtyFlag:D,isNode:function(t){return t instanceof j&&(t.constructor===j||!(t instanceof cc.Scene))},BuiltinGroupIndex:R},_onSiblingIndexChanged:function(){for(var t=this._parent,e=t._children,n=0,i=e.length;n<i;n++)e[n]._updateOrderOfArrival();t._delaySort()},_onPreDestroy:function(){this._onPreDestroyBase(),_&&cc.director.getActionManager().removeAllActionsFromTarget(this),P===this&&(P=null),(this._touchListener||this._mouseListener)&&(c.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null)),s.mat4.put(this._matrix),s.mat4.put(this._worldMatrix),this._matrix=this._worldMatrix=null,this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_onPostActivated:function(t){var e=_?cc.director.getActionManager():null;if(t)if(this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,e&&e.resumeTarget(this),c.resumeTarget(this),this._touchListener){var n=this._touchListener.mask=k(this);this._mouseListener&&(this._mouseListener.mask=n)}else this._mouseListener&&(this._mouseListener.mask=k(this));else e&&e.pauseTarget(this),c.pauseTarget(this)},_onHierarchyChanged:function(t){this._updateOrderOfArrival(),H(this),this._parent&&this._parent._delaySort(),this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,this._onHierarchyChangedBase(t),cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0)},_toEuler:function(){if(this.is3DNode)this._quat.toEuler(this._eulerAngles);else{var t=Math.asin(this._quat.z)/v*2;h.vec3.set(this._eulerAngles,0,0,t)}},_fromEuler:function(){this.is3DNode?this._quat.fromEuler(this._eulerAngles):h.quat.fromEuler(this._quat,0,0,this._eulerAngles.z)},_upgrade_1x_to_2x:function(){void 0!==this._scaleX&&(this._scale.x=this._scaleX,this._scaleX=void 0),void 0!==this._scaleY&&(this._scale.y=this._scaleY,this._scaleY=void 0),void 0!==this._zIndex&&(this._localZOrder=this._zIndex<<16,this._zIndex=void 0);var t=this._quat;(this._rotationX||this._rotationY)&&0===t.x&&0===t.y&&0===t.z&&1===t.w&&(this._rotationX===this._rotationY?t.fromEuler(t,0,0,-this._rotationX):t.fromEuler(t,this._rotationX,this._rotationY,0),this._rotationX=this._rotationY=void 0),this._toEuler(),this._color.a<255&&255===this._opacity&&(this._opacity=this._color.a,this._color.a=255)},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&t.root===this&&a.syncWithPrefab(this),this._upgrade_1x_to_2x(),this._updateOrderOfArrival(),this._cullingMask=1<<B(this),this._activeInHierarchy||(_&&cc.director.getActionManager().pauseTarget(this),c.pauseTarget(this));for(var e=this._children,n=0,i=e.length;n<i;n++)e[n]._onBatchCreated();0<e.length&&(this._renderFlag|=b8e.RenderFlow.FLAG_CHILDREN)},_onBatchRestored:function(){if(this._upgrade_1x_to_2x(),this._cullingMask=1<<B(this),!this._activeInHierarchy){var t=cc.director.getActionManager();t&&t.pauseTarget(this),c.pauseTarget(this)}for(var e=this._children,n=0,i=e.length;n<i;n++)e[n]._onBatchRestored();0<e.length&&(this._renderFlag|=b8e.RenderFlow.FLAG_CHILDREN)},_checknSetupSysEvent:function(t){var e=!1,n=!1;return-1!==L.indexOf(t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:k(this),onTouchBegan:E,onTouchMoved:C,onTouchEnded:w,onTouchCancelled:S}),c.addListener(this._touchListener,this),e=!0),n=!0):-1!==I.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:k(this),onMouseDown:T,onMouseMove:M,onMouseUp:A,onMouseScroll:O}),c.addListener(this._mouseListener,this),e=!0),n=!0),e&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||c.pauseTarget(this)},this,0,0,0,!1),n},on:function(t,e,n,i){if(this._checknSetupSysEvent(t))return this._onDispatch(t,e,n,i);switch(t){case N.POSITION_CHANGED:this._eventMask|=1;break;case N.SCALE_CHANGED:this._eventMask|=2;break;case N.ROTATION_CHANGED:this._eventMask|=4;break;case N.SIZE_CHANGED:this._eventMask|=8;break;case N.ANCHOR_CHANGED:this._eventMask|=16;break;case N.COLOR_CHANGED:this._eventMask|=32}return this._bubblingListeners||(this._bubblingListeners=new f),this._bubblingListeners.on(t,e,n)},once:function(s,o,c,t){var e=this._checknSetupSysEvent(s),u="__ONCE_FLAG:"+s,l=null;if(!(l=e&&t?this._capturingListeners=this._capturingListeners||new f:this._bubblingListeners=this._bubblingListeners||new f).hasEventListener(u,o,c)){var h=this;this.on(s,function t(e,n,i,r,a){h.off(s,t,c),l.remove(u,o,c),o.call(this,e,n,i,r,a)},c),l.add(u,o,c)}},_onDispatch:function(t,e,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,e){var r=null;return(r=i?this._capturingListeners=this._capturingListeners||new f:this._bubblingListeners=this._bubblingListeners||new f).hasEventListener(t,e,n)||(r.add(t,e,n),n&&n.__eventTargets&&n.__eventTargets.push(this)),e}},off:function(t,e,n,i){var r=-1!==L.indexOf(t),a=!r&&-1!==I.indexOf(t);if(r||a)this._offDispatch(t,e,n,i),r?this._touchListener&&!F(this,L)&&(c.removeListener(this._touchListener),this._touchListener=null):a&&this._mouseListener&&!F(this,I)&&(c.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners&&(this._bubblingListeners.off(t,e,n),!this._bubblingListeners.hasEventListener(t)))switch(t){case N.POSITION_CHANGED:this._eventMask&=-2;break;case N.SCALE_CHANGED:this._eventMask&=-3;break;case N.ROTATION_CHANGED:this._eventMask&=-5;break;case N.SIZE_CHANGED:this._eventMask&=-9;break;case N.ANCHOR_CHANGED:this._eventMask&=-17;break;case N.COLOR_CHANGED:this._eventMask&=-33}},_offDispatch:function(t,e,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,e){var r=i?this._capturingListeners:this._bubblingListeners;r&&(r.remove(t,e,n),n&&n.__eventTargets&&l.array.fastRemove(n.__eventTargets,this))}else this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},targetOff:function(t){var e=this._bubblingListeners;e&&(e.targetOff(t),1&this._eventMask&&!e.hasEventListener(N.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!e.hasEventListener(N.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!e.hasEventListener(N.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!e.hasEventListener(N.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!e.hasEventListener(N.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!e.hasEventListener(N.COLOR_CHANGED)&&(this._eventMask&=-33)),this._capturingListeners&&this._capturingListeners.targetOff(t),this._touchListener&&!F(this,L)&&(c.removeListener(this._touchListener),this._touchListener=null),this._mouseListener&&!F(this,I)&&(c.removeListener(this._mouseListener),this._mouseListener=null)},hasEventListener:function(t){var e=!1;return this._bubblingListeners&&(e=this._bubblingListeners.hasEventListener(t)),!e&&this._capturingListeners&&(e=this._capturingListeners.hasEventListener(t)),e},emit:function(t,e,n,i,r,a){this._bubblingListeners&&this._bubblingListeners.emit(t,e,n,i,r,a)},dispatchEvent:function(t){z(this,t),b.length=0},pauseSystemEvents:function(t){c.pauseTarget(this,t)},resumeSystemEvents:function(t){c.resumeTarget(this,t)},_hitTest:function(t,e){var n=this._contentSize.width,i=this._contentSize.height,r=m,a=p,s=cc.Camera.findCamera(this);if(s?s.getCameraToWorldPoint(t,r):r.set(t),this._updateWorldMatrix(),h.mat4.invert(y,this._worldMatrix),h.vec2.transformMat4(a,r,y),a.x+=this._anchorPoint.x*n,a.y+=this._anchorPoint.y*i,0<=a.x&&0<=a.y&&a.x<=n&&a.y<=i){if(e&&e.mask){for(var o=e.mask,c=this,u=0;c&&u<o.index;++u,c=c.parent);if(c!==o.node)return!(e.mask=null);var l=c.getComponent(cc.Mask);return!l||!l.enabledInHierarchy||l._hitTest(r)}return!0}return!1},_getCapturingTargets:function(t,e){for(var n=this.parent;n;)n._capturingListeners&&n._capturingListeners.hasEventListener(t)&&e.push(n),n=n.parent},_getBubblingTargets:function(t,e){for(var n=this.parent;n;)n._bubblingListeners&&n._bubblingListeners.hasEventListener(t)&&e.push(n),n=n.parent},runAction:_?function(t){if(this.active)return cc.director.getActionManager().addAction(t,this,!1),t}:i,pauseAllActions:_?function(){cc.director.getActionManager().pauseTarget(this)}:i,resumeAllActions:_?function(){cc.director.getActionManager().resumeTarget(this)}:i,stopAllActions:_?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:i,stopAction:_?function(t){cc.director.getActionManager().removeAction(t)}:i,stopActionByTag:_?function(t){t!==cc.Action.TAG_INVALID&&cc.director.getActionManager().removeActionByTag(t,this)}:i,getActionByTag:_?function(t){return t===cc.Action.TAG_INVALID?null:cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:_?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},getPosition:function(t){return(t=t||cc.v3()).set(this._position)},setPosition:function(t,e){var n;void 0===e?(n=t.x,e=t.y):n=t;var i=this._position;i.x===n&&i.y===e||(i.x=n,i.y=e,this.setLocalDirty(D.POSITION),this._renderFlag|=b8e.RenderFlow.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(N.POSITION_CHANGED))},getScale:function(t){return void 0!==t?t.set(this._scale):this._scale.x},setScale:function(t,e){t&&"number"!=typeof t?(e=t.y,t=t.x):void 0===e&&(e=t),this._scale.x===t&&this._scale.y===e||(this._scale.x=t,this._scale.y=e,this.setLocalDirty(D.SCALE),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,2&this._eventMask&&this.emit(N.SCALE_CHANGED))},getRotation:function(t){return t instanceof cc.Quat?t.set(this._quat):-this.angle},setRotation:function(t,e,n,i){if("number"==typeof t&&void 0===e)this.angle=-t;else{var r=t;void 0===e&&(r=t.x,e=t.y,n=t.z,i=t.w);var a=this._quat;a.x===r&&a.y===e&&a.z===n&&a.w===i||(a.x=r,a.y=e,a.z=n,a.w=i,this.setLocalDirty(D.ROTATION),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,4&this._eventMask&&this.emit(N.ROTATION_CHANGED))}},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(t,e){var n=this._contentSize;if(void 0===e){if(t.width===n.width&&t.height===n.height)return;n.width=t.width,n.height=t.height}else{if(t===n.width&&e===n.height)return;n.width=t,n.height=e}8&this._eventMask&&this.emit(N.SIZE_CHANGED)},getAnchorPoint:function(){return cc.v2(this._anchorPoint)},setAnchorPoint:function(t,e){var n=this._anchorPoint;if(void 0===e){if(t.x===n.x&&t.y===n.y)return;n.x=t.x,n.y=t.y}else{if(t===n.x&&e===n.y)return;n.x=t,n.y=e}this.setLocalDirty(D.POSITION),16&this._eventMask&&this.emit(N.ANCHOR_CHANGED)},_invTransformPoint:function(t,e){return this._parent?this._parent._invTransformPoint(t,e):h.vec3.copy(t,e),h.vec3.sub(t,t,this._position),h.quat.conjugate(x,this._quat),h.vec3.transformQuat(t,t,x),h.vec3.inverseSafe(g,this._scale),h.vec3.mul(t,t,g),t},getWorldPosition:function(t){h.vec3.copy(t,this._position);for(var e=this._parent;e;)h.vec3.mul(t,t,e._scale),h.vec3.transformQuat(t,t,e._quat),h.vec3.add(t,t,e._position),e=e._parent;return t},setWorldPosition:function(t){this._parent?this._parent._invTransformPoint(this._position,t):h.vec3.copy(this._position,t),this.setLocalDirty(D.POSITION),1&this._eventMask&&this.emit(N.POSITION_CHANGED)},getWorldRotation:function(t){h.quat.copy(t,this._quat);for(var e=this._parent;e;)h.quat.mul(t,e._quat,t),e=e._parent;return t},setWorldRotation:function(t){this._parent?(this._parent.getWorldRotation(this._quat),h.quat.conjugate(this._quat,this._quat),h.quat.mul(this._quat,this._quat,t)):h.quat.copy(this._quat,h.quat),this._toEuler(),this.setLocalDirty(D.ROTATION)},getWorldScale:function(t){h.vec3.copy(t,this._scale);for(var e=this._parent;e;)h.vec3.mul(t,t,e._scale),e=e._parent;return t},setWorldScale:function(t){this._parent?(this._parent.getWorldScale(this._scale),h.vec3.div(this._scale,t,this._scale)):h.vec3.copy(this._scale,t),this.setLocalDirty(D.SCALE)},getWorldRT:function(t){var e=g,n=x;h.vec3.copy(e,this._position),h.quat.copy(n,this._quat);for(var i=this._parent;i;)h.vec3.mul(e,e,i._scale),h.vec3.transformQuat(e,e,i._quat),h.vec3.add(e,e,i._position),h.quat.mul(n,i._quat,n),i=i._parent;return h.mat4.fromRT(t,n,e),t},lookAt:function(t,e){this.getWorldPosition(g),h.vec3.sub(g,g,t),h.vec3.normalize(g,g),h.quat.fromViewUp(x,g,e),this.setWorldRotation(x)},_updateLocalMatrix:function(){var t=this._localMatDirty;if(t){var e=this._matrix;if(t&(D.RT|D.SKEW)){var n=-this._eulerAngles.z,i=this._skewX||this._skewY,r=this._scale.x,a=this._scale.y;if(n||i){var s=1,o=0,c=0,u=1;if(n){var l=n*v;c=Math.sin(l),s=u=Math.cos(l),o=-c}if(e.m00=s*=r,e.m01=o*=r,e.m04=c*=a,e.m05=u*=a,i){var h=e.m00,f=e.m01,d=e.m04,_=e.m05,m=Math.tan(this._skewX*v),p=Math.tan(this._skewY*v);m===1/0&&(m=99999999),p===1/0&&(p=99999999),e.m00=h+d*p,e.m01=f+_*p,e.m04=d+h*m,e.m05=_+f*m}}else e.m00=r,e.m01=0,e.m04=0,e.m05=a}e.m12=this._position.x,e.m13=this._position.y,this._localMatDirty=0,this._worldMatDirty=!0}},_calculWorldMatrix:function(){this._localMatDirty&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):h.mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1},_mulMat:function(t,e,n){var i=e.m00,r=e.m01,a=e.m04,s=e.m05,o=e.m12,c=e.m13,u=n.m00,l=n.m01,h=n.m04,f=n.m05,d=n.m12,_=n.m13;0!==r||0!==a?(t.m00=u*i+l*a,t.m01=u*r+l*s,t.m04=h*i+f*a,t.m05=h*r+f*s,t.m12=i*d+a*_+o,t.m13=r*d+s*_+c):(t.m00=u*i,t.m01=l*s,t.m04=h*i,t.m05=f*s,t.m12=i*d+o,t.m13=s*_+c)},_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();for(var t=this._children,e=0,n=t.length;e<n;e++)t[e]._worldMatDirty=!0}},setLocalDirty:function(t){this._localMatDirty=this._localMatDirty|t,this._worldMatDirty=!0},setWorldDirty:function(){this._worldMatDirty=!0},getLocalMatrix:function(t){return this._updateLocalMatrix(),h.mat4.copy(t,this._matrix)},getWorldMatrix:function(t){return this._updateWorldMatrix(),h.mat4.copy(t,this._worldMatrix)},convertToNodeSpace:function(t){this._updateWorldMatrix(),h.mat4.invert(y,this._worldMatrix);var e=new cc.Vec2;return h.vec2.transformMat4(e,t,y),e.x+=this._anchorPoint.x*this._contentSize.width,e.y+=this._anchorPoint.y*this._contentSize.height,e},convertToWorldSpace:function(t){this._updateWorldMatrix();var e=new cc.Vec2(t.x-this._anchorPoint.x*this._contentSize.width,t.y-this._anchorPoint.y*this._contentSize.height);return h.vec2.transformMat4(e,e,this._worldMatrix)},convertToNodeSpaceAR:function(t){this._updateWorldMatrix(),h.mat4.invert(y,this._worldMatrix);var e=new cc.Vec2;return h.vec2.transformMat4(e,t,y)},convertToWorldSpaceAR:function(t){this._updateWorldMatrix();var e=new cc.Vec2;return h.vec2.transformMat4(e,t,this._worldMatrix)},getNodeToParentTransform:function(t){t=t||o.identity(),this._updateLocalMatrix();var e=this._contentSize;return g.x=-this._anchorPoint.x*e.width,g.y=-this._anchorPoint.y*e.height,h.mat4.copy(y,this._matrix),h.mat4.translate(y,y,g),o.fromMat4(t,y)},getNodeToParentTransformAR:function(t){return t=t||o.identity(),this._updateLocalMatrix(),o.fromMat4(t,this._matrix)},getNodeToWorldTransform:function(t){t=t||o.identity(),this._updateWorldMatrix();var e=this._contentSize;return g.x=-this._anchorPoint.x*e.width,g.y=-this._anchorPoint.y*e.height,h.mat4.copy(y,this._worldMatrix),h.mat4.translate(y,y,g),o.fromMat4(t,y)},getNodeToWorldTransformAR:function(t){return t=t||o.identity(),this._updateWorldMatrix(),o.fromMat4(t,this._worldMatrix)},getParentToNodeTransform:function(t){return t=t||o.identity(),this._updateLocalMatrix(),h.mat4.invert(y,this._matrix),o.fromMat4(t,y)},getWorldToNodeTransform:function(t){return t=t||o.identity(),this._updateWorldMatrix(),h.mat4.invert(y,this._worldMatrix),o.fromMat4(t,y)},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getBoundingBox:function(){this._updateLocalMatrix();var t=this._contentSize.width,e=this._contentSize.height,n=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return n.transformMat4(n,this._matrix)},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo(this._parent._worldMatrix)):this.getBoundingBox()},_getBoundingBoxTo:function(t){this._updateLocalMatrix();var e=this._contentSize.width,n=this._contentSize.height,i=cc.rect(-this._anchorPoint.x*e,-this._anchorPoint.y*n,e,n);if(t=h.mat4.mul(this._worldMatrix,t,this._matrix),i.transformMat4(i,t),!this._children)return i;for(var r=this._children,a=0;a<r.length;a++){var s=r[a];if(s&&s.active){var o=s._getBoundingBoxTo(t);o&&i.union(i,o)}}return i},_updateOrderOfArrival:function(){var t=this._parent?++this._parent._childArrivalOrder:0;if(this._localZOrder=4294901760&this._localZOrder|t,65535==t){var e=this._parent._children;e.forEach(function(t,e){t._localZOrder=4294901760&t._localZOrder|e+1}),this._parent._childArrivalOrder=e.length}},addChild:function(t,e,n){t.setParent(this),void 0!==e&&(t.zIndex=e),void 0!==n&&(t.name=n)},cleanup:function(){_&&cc.director.getActionManager().removeAllActionsFromTarget(this),c.removeListeners(this);var t,e,n=this._children.length;for(t=0;t<n;++t)(e=this._children[t])&&e.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){c._setDirtyForNode(this),this._reorderChildDirty=!1;var t=this._children;if(1<t.length){var e,n,i,r=t.length;for(e=1;e<r;e++){for(i=t[e],n=e-1;0<=n&&i._localZOrder<t[n]._localZOrder;)t[n+1]=t[n],n--;t[n+1]=i}this.emit(N.CHILD_REORDER,this)}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))}},j=cc.Class(U),G=j.prototype;l.getset(G,"_$position",G.getPosition,G.setPosition,!1,!0),cc.Node=e.exports=j},{"./event-manager":58,"./event/event":61,"./event/event-target":60,"./platform/CCMacro":86,"./platform/js":101,"./utils/affine-transform":153,"./utils/base-node":154,"./utils/math-pools":162,"./utils/prefab-helper":165,"./vmath":184}],14:[function(t,e,n){"use strict";var i=t("./CCNode"),r=(cc.Object.Flags.HideInHierarchy,i._LocalDirtyFlag),a=cc.Class({name:"cc.PrivateNode",extends:i,properties:{x:{get:function(){return this._originPos.x},set:function(t){var e=this._originPos;t!==e.x&&(e.x=t,this._posDirty(!0))},override:!0},y:{get:function(){return this._originPos.y},set:function(t){var e=this._originPos;t!==e.y&&(e.y=t,this._posDirty(!0))},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX},set:function(){},override:!0},showInEditor:{default:!1,editorOnly:!0,override:!0}},ctor:function(){this._localZOrder=cc.macro.MIN_ZINDEX<<16,this._originPos=cc.v2()},_posDirty:function(t){this.setLocalDirty(r.POSITION),this._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM,!0===t&&1&this._eventMask&&this.emit(i.EventType.POSITION_CHANGED)},_updateLocalMatrix:function(){if(this._localMatDirty){var t=this.parent;t&&(this._position.x=this._originPos.x-(t._anchorPoint.x-.5)*t._contentSize.width,this._position.y=this._originPos.y-(t._anchorPoint.y-.5)*t._contentSize.height),this._super()}},getPosition:function(){return new cc.Vec2(this._originPos)},setPosition:function(t,e){void 0===e&&(e=(t=t.x).y);var n=this._originPos;n.x===t&&n.y===e||(n.x=t,n.y=e,this._posDirty(!0))},setParent:function(t){var e=this._parent;this._super(t),e!==t&&(e&&e.off(i.EventType.ANCHOR_CHANGED,this._posDirty,this),t&&t.on(i.EventType.ANCHOR_CHANGED,this._posDirty,this))},_updateOrderOfArrival:function(){}});cc.js.getset(a.prototype,"_$parent",a.prototype.getParent,a.prototype.setParent),cc.js.getset(a.prototype,"_$position",a.prototype.getPosition,a.prototype.setPosition),cc.PrivateNode=e.exports=a},{"./CCNode":13}],15:[function(t,e,n){"use strict";cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{_is3DNode:{default:!0,override:!0},autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){if(cc.Object.prototype.destroy.call(this))for(var t=this._children,e=0;e<t.length;++e)t[e].active=!1;this._active=!1,this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),e.exports=cc.Scene},{"./CCNode":13}],16:[function(t,e,n){"use strict";function o(t,e,n,i){this.target=t,this.priority=e,this.paused=n,this.markedForDeletion=i}var i=t("./platform/js"),r=new(t("./platform/id-generater"))("Scheduler"),a=[];function c(t,e,n,i){this.list=t,this.entry=e,this.target=n,this.callback=i}o.get=function(t,e,n,i){var r=a.pop();return r?(r.target=t,r.priority=e,r.paused=n,r.markedForDeletion=i):r=new o(t,e,n,i),r},o.put=function(t){a.length<20&&(t.target=null,a.push(t))};var s=[];function h(t,e,n,i,r,a){var s=this;s.timers=t,s.target=e,s.timerIndex=n,s.currentTimer=i,s.currentTimerSalvaged=r,s.paused=a}c.get=function(t,e,n,i){var r=s.pop();return r?(r.list=t,r.entry=e,r.target=n,r.callback=i):r=new c(t,e,n,i),r},c.put=function(t){s.length<20&&(t.list=t.entry=t.target=t.callback=null,s.push(t))};var u=[];function f(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}h.get=function(t,e,n,i,r,a){var s=u.pop();return s?(s.timers=t,s.target=e,s.timerIndex=n,s.currentTimer=i,s.currentTimerSalvaged=r,s.paused=a):s=new h(t,e,n,i,r,a),s},h.put=function(t){u.length<20&&(t.timers=t.target=t.currentTimer=null,u.push(t))};var l=f.prototype;l.initWithCallback=function(t,e,n,i,r,a){return this._lock=!1,this._scheduler=t,this._target=n,this._callback=e,this._elapsed=-1,this._interval=i,this._delay=a,this._useDelay=0<this._delay,this._repeat=r,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},l.getInterval=function(){return this._interval},l.setInterval=function(t){this._interval=t},l.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},l.getCallback=function(){return this._callback},l.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},l.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var d=[];f.get=function(){return d.pop()||new f},f.put=function(t){d.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,d.push(t))},cc.Scheduler=function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=i.createMap(!0),this._hashForTimers=i.createMap(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(t){delete this._hashForTimers[t.target._id];for(var e=this._arrayForTimers,n=0,i=e.length;n<i;n++)if(e[n]===t){e.splice(n,1);break}h.put(t)},_removeUpdateFromHash:function(t){var e=t.target._id,n=this._hashForUpdates[e];if(n){for(var i=n.list,r=n.entry,a=0,s=i.length;a<s;a++)if(i[a]===r){i.splice(a,1);break}delete this._hashForUpdates[e],o.put(r),c.put(n)}},_priorityIn:function(t,e,n){for(var i=0;i<t.length;i++)if(n<t[i].priority)return void t.splice(i,0,e);t.push(e)},_appendIn:function(t,e){t.push(e)},enableForTarget:function(t){t._id||t.__instanceId||(t._id=r.getNewId())},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,n,i,r;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,i=(n=this._updatesNegList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updates0List).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updatesPosList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);var a,s=this._arrayForTimers;for(e=0;e<s.length;e++){if(a=s[e],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(t),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,n=this._updatesNegList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updates0List;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updatesPosList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},schedule:function(t,e,n,i,r,a){if("function"!=typeof t){var s=t;t=e,e=s}4!==arguments.length&&5!==arguments.length||(a=!!i,i=cc.macro.REPEAT_FOREVER,r=0);var o=e._id;o||e.__instanceId&&(o=e._id=e.__instanceId);var c,u,l=this._hashForTimers[o];if(l?l.paused:(l=h.get(null,e,0,null,null,a),this._arrayForTimers.push(l),this._hashForTimers[o]=l),null==l.timers)l.timers=[];else for(u=0;u<l.timers.length;++u)if((c=l.timers[u])&&t===c._callback)return void(c._interval=n);(c=f.get()).initWithCallback(this,t,e,n,i,r),l.timers.push(c),this._currentTarget===l&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(t,e,n){var i=t._id;i||t.__instanceId&&(i=t._id=t.__instanceId);var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(t)}var a,s=o.get(t,e,n,!1);0===e?(a=this._updates0List,this._appendIn(a,s)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,s,e)),this._hashForUpdates[i]=c.get(a,s,t,null)},unschedule:function(t,e){if(e&&t){var n=e._id;n||e.__instanceId&&(n=e._id=e.__instanceId);var i=this._hashForTimers[n];if(i)for(var r=i.timers,a=0,s=r.length;a<s;a++){var o=r[a];if(t===o._callback)return o!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),r.splice(a,1),f.put(o),i.timerIndex>=a&&i.timerIndex--,void(0===r.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}},unscheduleUpdate:function(t){if(t){var e=t._id;e||t.__instanceId&&(e=t._id=t.__instanceId);var n=this._hashForUpdates[e];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}},unscheduleAllForTarget:function(t){if(t){var e=t._id;e||t.__instanceId&&(e=t._id=t.__instanceId);var n=this._hashForTimers[e];if(n){var i=n.timers;-1<i.indexOf(n.currentTimer)&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,a=i.length;r<a;r++)f.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,n,i,r=this._arrayForTimers;for(e=r.length-1;0<=e;e--)n=r[e],this.unscheduleAllForTarget(n.target);var a=0;if(t<0)for(e=0;e<this._updatesNegList.length;)a=this._updatesNegList.length,(i=this._updatesNegList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)a=this._updates0List.length,(i=this._updates0List[e])&&this.unscheduleUpdate(i.target),a==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)a=this._updatesPosList.length,(i=this._updatesPosList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a==this._updatesPosList.length&&e++},isScheduled:function(t,e){var n=e._id;n||e.__instanceId&&(n=e._id=e.__instanceId);var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,a=0;a<r.length;++a)if(t===r[a]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,n,i,r,a=[],s=this._arrayForTimers;for(n=0,i=s.length;n<i;n++)(e=s[n])&&(e.paused=!0,a.push(e.target));if(t<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));if(t<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,a.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));return a},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){var e=t._id;e||t.__instanceId&&(e=t._id=t.__instanceId);var n=this._hashForTimers[e];n&&(n.paused=!0);var i=this._hashForUpdates[e];i&&(i.entry.paused=!0)},resumeTarget:function(t){var e=t._id;e||t.__instanceId&&(e=t._id=t.__instanceId);var n=this._hashForTimers[e];n&&(n.paused=!1);var i=this._hashForUpdates[e];i&&(i.entry.paused=!1)},isTargetPaused:function(t){var e=t._id;e||t.__instanceId&&(e=t._id=t.__instanceId);var n=this._hashForTimers[e];if(n)return n.paused;var i=this._hashForUpdates[e];return!!i&&i.entry.paused}},cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1,e.exports=cc.Scheduler},{"./platform/id-generater":97,"./platform/js":101}],17:[function(t,e,n){"use strict";var i=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:i,ctor:function(){this.loaded=!0},properties:{nativeUrl:{get:function(){if(this._native){var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);if(cc.AssetLibrary){var e=cc.AssetLibrary.getLibUrlNoExt(this._uuid,!0);return 46===t.charCodeAt(0)?e+t:e+"/"+t}}return""},visible:!1},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset},set:function(t){this._$nativeAsset=t}}},statics:{preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl},createNode:null,_setRawAsset:function(t,e){this._native=!1!==e?t||void 0:"/"+t}}),e.exports=cc.Asset},{"./CCRawAsset":24}],18:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null}});cc.BitmapFont=i,e.exports=i},{}],19:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.BufferAsset",extends:cc.Asset,ctor:function(){this._buffer=null},properties:{_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t},override:!0},buffer:function(){return this._buffer}}});cc.BufferAsset=e.exports=i},{}],20:[function(t,e,n){"use strict";var i=t("./CCAsset"),r=cc.Class({name:"cc.EffectAsset",extends:i,properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){for(var t=b8e.renderer._forward._programLib,e=0;e<this.shaders.length;e++)t.define(this.shaders[e])}});e.exports=cc.EffectAsset=r},{"./CCAsset":17}],21:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=e.exports=i},{}],22:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.JsonAsset",extends:cc.Asset,properties:{json:null}});e.exports=cc.JsonAsset=i},{}],23:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont});cc.LabelAtlas=i,e.exports=i},{}],24:[function(t,e,n){"use strict";var i=t("../platform/CCObject"),r=t("../platform/js");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:i,ctor:function(){Object.defineProperty(this,"_$_uuid",{value:"",writable:!0})}}),r.value(cc.RawAsset,"_$isRawAssetType",function(t){return r.isChildClassOf(t,cc.RawAsset)&&!r.isChildClassOf(t,cc.Asset)}),r.value(cc.RawAsset,"_$wasRawAssetType",function(t){return t===cc.Texture2D||t===cc.AudioClip||t===cc.ParticleAsset||t===cc.Asset}),e.exports=cc.RawAsset},{"../platform/CCObject":87,"../platform/js":101}],25:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=i,e.exports=i},{}],26:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=i;var r=cc.Class({name:"cc.JavaScript",extends:i});cc._JavaScript=r;var a=cc.Class({name:"cc.CoffeeScript",extends:i});cc._CoffeeScript=a;var s=cc.Class({name:"cc.TypeScript",extends:i});cc._TypeScript=s},{}],27:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(0<t.length){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}return null},getSpriteFrame:function(t){var e=this._spriteFrames[t];return e?(e.name||(e.name=t),e):null},getSpriteFrames:function(){var t=[],e=this._spriteFrames;for(var n in e)t.push(this.getSpriteFrame(n));return t}});cc.SpriteAtlas=i,e.exports=i},{}],28:[function(t,e,n){"use strict";var l=t("../event/event-target"),i=t("../utils/texture-util"),y=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],r=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[l],properties:{_textureSetter:{set:function(t){t&&(this._texture!==t&&this._refreshTexture(t),this._textureFilename=t.url)}},insetTop:{get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]=t,this._texture&&this._calculateSlicedUV()}},insetBottom:{get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]=t,this._texture&&this._calculateSlicedUV()}},insetLeft:{get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]=t,this._texture&&this._calculateSlicedUV()}},insetRight:{get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]=t,this._texture&&this._calculateSlicedUV()}}},ctor:function(t,e,n,i,r){l.call(this),b8e.SHC(this),b8e.SHC(this._textureLoadedCallback);var a=t,s=e,o=n,c=i,u=r;this._rect=null,this.uv=[],this._texture=null,this._original=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.vertices=null,this._capInsets=[0,0,0,0],this.uvSliced=[],this._textureFilename="",void 0!==a&&this.setTexture(a,s,o,c,u)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t,this._texture&&this._calculateUV()},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_textureLoadedCallback:function(){var t=this,e=this._texture;if(e){var n=e.width,i=e.height;t._rotated&&cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(t._rotated=!1,n=t._texture.width,i=t._texture.height,t._rect=cc.rect(0,0,n,i)),t._rect?t._checkRect(t._texture):t._rect=cc.rect(0,0,n,i),t._originalSize||t.setOriginalSize(cc.size(n,i)),t._offset||t.setOffset(cc.v2(0,0)),t._calculateUV(),t.emit("load")}},_refreshTexture:function(t){this._texture!=t&&(this._texture=t,this._textureLoadedCallback())},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new r(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,n,i,r){this._rect=e||null,i?this.setOffset(i):this._offset=null,r?this.setOriginalSize(r):this._originalSize=null,this._rotated=n||!1;var a=t;return"string"==typeof a&&a&&(this._textureFilename=a,this._loadTexture()),a instanceof b8e.Texture2D&&this._texture!==a&&this._refreshTexture(a),!0},_loadTexture:function(){if(this._textureFilename){var t=i.loadImage(this._textureFilename);this._refreshTexture(t)}},clearTexture:function(){this._texture=null},_checkRect:function(t){var e=this._rect;e.x,e.y,this._rotated?(e.height,e.width):(e.width,e.height),t.width,t.height},_calculateSlicedUV:function(){var t=this._rect,e=this._texture.width,n=this._texture.height,i=this._capInsets[0],r=this._capInsets[2],a=t.width-i-r,s=this._capInsets[1],o=this._capInsets[3],c=t.height-s-o,u=this.uvSliced;if(u.length=0,this._rotated){y[0].u=t.x/e,y[1].u=(t.x+o)/e,y[2].u=(t.x+o+c)/e,y[3].u=(t.x+t.height)/e,y[3].v=t.y/n,y[2].v=(t.y+i)/n,y[1].v=(t.y+i+a)/n,y[0].v=(t.y+t.width)/n;for(var l=0;l<4;++l)for(var h=y[l],f=0;f<4;++f){var d=y[3-f];u.push({u:h.u,v:d.v})}}else{y[0].u=t.x/e,y[1].u=(t.x+i)/e,y[2].u=(t.x+i+a)/e,y[3].u=(t.x+t.width)/e,y[3].v=t.y/n,y[2].v=(t.y+s)/n,y[1].v=(t.y+s+c)/n,y[0].v=(t.y+t.height)/n;for(var _=0;_<4;++_)for(var m=y[_],p=0;p<4;++p){var v=y[p];u.push({u:v.u,v:m.v})}}},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_calculateUV:function(){var t=this._rect,e=this._texture,n=this.uv,i=e.width,r=e.height;if(this._rotated){var a=0===i?0:t.x/i,s=0===i?0:(t.x+t.height)/i,o=0===r?0:(t.y+t.width)/r,c=0===r?0:t.y/r;n[0]=a,n[1]=c,n[2]=a,n[3]=o,n[4]=s,n[5]=c,n[6]=s,n[7]=o}else{var u=0===i?0:t.x/i,l=0===i?0:(t.x+t.width)/i,h=0===r?0:(t.y+t.height)/r,f=0===r?0:t.y/r;n[0]=u,n[1]=h,n[2]=l,n[3]=h,n[4]=u,n[5]=f,n[6]=l,n[7]=f}var d=this.vertices;if(d){d.nu.length=0;for(var _=d.nv.length=0;_<d.u.length;_++)d.nu[_]=d.u[_]/i,d.nv[_]=d.v[_]/r}this._calculateSlicedUV()},_deserialize:function(t,e){var n=t.rect;n&&(this._rect=new cc.Rect(n[0],n[1],n[2],n[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var i=t.capInsets;i&&(this._capInsets[0]=i[0],this._capInsets[1]=i[1],this._capInsets[2]=i[2],this._capInsets[3]=i[3]),this.vertices=t.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[]);var r=t.texture;r&&e.result.push(this,"_textureSetter",r)}}),a=r.prototype;a.copyWithZone=a.clone,a.copy=a.clone,a.initWithTexture=a.setTexture,cc.SpriteFrame=r,e.exports=r},{"../assets/CCAsset":17,"../event/event-target":60,"../utils/texture-util":170}],29:[function(t,e,n){"use strict";var i=t("./CCFont"),r=cc.Class({name:"cc.TTFFont",extends:i,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"},override:!0}}});cc.TTFFont=e.exports=r},{"./CCFont":21}],30:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.TextAsset",extends:cc.Asset,properties:{text:""},toString:function(){return this.text}});e.exports=cc.TextAsset=i},{}],31:[function(t,e,n){"use strict";t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCScripts"),t("./CCSceneAsset"),t("./CCSpriteFrame"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas"),t("./CCTextAsset"),t("./CCJsonAsset"),t("./CCBufferAsset"),t("./CCEffectAsset")},{"./CCAsset":17,"./CCBitmapFont":18,"./CCBufferAsset":19,"./CCEffectAsset":20,"./CCFont":21,"./CCJsonAsset":22,"./CCLabelAtlas":23,"./CCRawAsset":24,"./CCSceneAsset":25,"./CCScripts":26,"./CCSpriteAtlas":27,"./CCSpriteFrame":28,"./CCTTFFont":29,"./CCTextAsset":30}],32:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(){r(this,t),this._properties={},this._defines={},this._dirty=!1}return i(t,[{key:"setProperty",value:function(t,e){var n=this._properties[t];if(n){if(n.value===e)return}else(n=Object.create(null)).name=t,n.type=ctor2enums[e.constructor],this._properties[t]=n;this._dirty=!0,n.value=e}},{key:"getProperty",value:function(t){var e=this._properties[t];return e?e.value:null}},{key:"define",value:function(t,e){this._defines[t]!==e&&(this._dirty=!0,this._defines[t]=e)}},{key:"getDefine",value:function(t){return this._defines[t]}},{key:"extractProperties",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};return Object.assign(e,this._properties),e}},{key:"extractDefines",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};return Object.assign(e,this._defines),e}},{key:"getHash",value:function(){if(!this._dirty)return this._hash;this._dirty=!1;var t="";return t+=utils.serializeDefines(this._defines),t+=utils.serializeUniforms(this._properties),this._hash=murmurhash2(t,666)}}]),t}();n.default=a},{}],33:[function(t,e,n){"use strict";var i=a(t("../geom-utils")),r=a(t("../../renderer/scene/camera"));function a(t){return t&&t.__esModule?t:{default:t}}var s=t("../utils/affine-transform"),o=t("../CCGame"),c=cc.vmath.mat4,u=cc.vmath.vec2,l=cc.vmath.vec3,h=c.create(),f=c.create(),d=l.create(),_=l.create(),m=l.create(),p=[],v=null;function y(){if(v){var t=v.getNode(),e=cc.game.canvas;t.z=e.height/1.1566,t.x=e.width/2,t.y=e.height/2}}var g=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4}),x=cc.Enum({OPAQUE:1,TRANSPARENT:2}),b=cc.Class({name:"cc.Camera",extends:cc.Component,ctor:function(){if(o.renderType!==o.RENDER_TYPE_CANVAS){var t=new r.default;t.setStages(["opaque"]),t.dirty=!0,this._inited=!1,this._camera=t}else this._inited=!0},properties:{_cullingMask:4294967295,_clearFlags:g.DEPTH|g.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:.1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,zoomRatio:{get:function(){return this._zoomRatio},set:function(t){this._zoomRatio=t}},fov:{get:function(){return this._fov},set:function(t){this._fov=t}},orthoSize:{get:function(){return this._orthoSize},set:function(t){this._orthoSize=t}},nearClip:{get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._updateClippingpPlanes()}},farClip:{get:function(){return this._farClip},set:function(t){this._farClip=t,this._updateClippingpPlanes()}},ortho:{get:function(){return this._ortho},set:function(t){this._ortho=t,this._updateProjection()}},rect:{get:function(){return this._rect},set:function(t){this._rect=t,this._updateRect()}},cullingMask:{get:function(){return this._cullingMask},set:function(t){this._cullingMask=t,this._updateCameraMask()}},clearFlags:{get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&this._camera.setClearFlags(t)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._updateBackgroundColor()}},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera._priority=t)}},targetTexture:{get:function(){return this._targetTexture},set:function(t){this._targetTexture=t,this._updateTargetTexture()}},renderStages:{get:function(){return this._renderStages},set:function(t){this._renderStages=t,this._updateStages()}},_is3D:{get:function(){return this.node._is3DNode}}},statics:{main:null,cameras:p,ClearFlags:g,findCamera:function(t){for(var e=0,n=p.length;e<n;e++){var i=p[e];if(i.containsNode(t))return i}return null},_findRendererCamera:function(t){for(var e=b8e.renderer.scene._cameras,n=0;n<e._count;n++)if(e._data[n]._cullingMask&t._cullingMask)return e._data[n];return null},_setupDebugCamera:function(){if(!v&&o.renderType!==o.RENDER_TYPE_CANVAS){var t=new r.default;(v=t).setStages(["opaque"]),t.setFov(60*Math.PI/180),t.setNear(.1),t.setFar(4096),t.dirty=!0,t._cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,t._priority=cc.macro.MAX_ZINDEX,t.setClearFlags(0),t.setColor(0,0,0,0);var e=new cc.Node;t.setNode(e),y(),cc.view.on("design-resolution-changed",y),b8e.renderer.scene.addCamera(t)}}},_updateCameraMask:function(){if(this._camera){var t=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG);this._camera._cullingMask=t}},_updateBackgroundColor:function(){if(this._camera){var t=this._backgroundColor;this._camera.setColor(t.r/255,t.g/255,t.b/255,t.a/255)}},_updateTargetTexture:function(){if(this._camera){var t=this._targetTexture;this._camera._framebuffer=t?t._framebuffer:null}},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip))},_updateProjection:function(){if(this._camera){var t=this._ortho?1:0;this._camera.setType(t)}},_updateRect:function(){this._camera&&this._camera.setRect(this._rect)},_updateStages:function(){var t=this._renderStages,e=this._camera._stages;e.length=0,t&x.OPAQUE&&e.push("opaque"),t&x.TRANSPARENT&&e.push("transparent")},_init:function(){if(!this._inited){this._inited=!0;var t=this._camera;t&&(t.setNode(this.node),t.setClearFlags(this._clearFlags),t._priority=this._depth,this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages())}},onLoad:function(){this._init()},onEnable:function(){o.renderType!==o.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),b8e.renderer.scene.addCamera(this._camera)),p.push(this)},onDisable:function(){o.renderType!==o.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),b8e.renderer.scene.removeCamera(this._camera)),cc.js.array.remove(p,this)},getNodeToCameraTransform:function(t){var e=s.identity();return t.getWorldMatrix(f),this.containsNode(t)&&(this.getWorldToCameraMatrix(h),c.mul(f,f,h)),s.fromMat4(e,f),e},getCameraToWorldPoint:function(t,e){return e=e||cc.v2(),this.getCameraToWorldMatrix(h),u.transformMat4(e,t,h),e},getWorldToCameraPoint:function(t,e){return e=e||cc.v2(),this.getWorldToCameraMatrix(h),u.transformMat4(e,t,h),e},getCameraToWorldMatrix:function(t){return this.getWorldToCameraMatrix(t),c.invert(t,t),t},getWorldToCameraMatrix:function(t){this.node.getWorldRT(h);var e=this.zoomRatio;h.m00*=e,h.m01*=e,h.m04*=e,h.m05*=e;var n=h.m12,i=h.m13,r=cc.visibleRect.center;return h.m12=r.x-(h.m00*n+h.m04*i),h.m13=r.y-(h.m01*n+h.m05*i),t!==h&&c.copy(t,h),t},getRay:function(t){return i.default?(l.set(m,t.x,t.y,1),this._camera.screenToWorld(_,m,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(l.set(m,t.x,t.y,-1),this._camera.screenToWorld(d,m,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(d),i.default.Ray.fromPoints(i.default.Ray.create(),d,_)):t},containsNode:function(t){return t._cullingMask&this.cullingMask},render:function(t){if(!(t=t||cc.director.getScene()))return null;this.node.getWorldMatrix(h),this.beforeDraw(),b8e.RenderFlow.visit(t),b8e.renderer._forward.renderCamera(this._camera,b8e.renderer.scene)},_layout:function(){var t=cc.game.canvas.height/cc.view._scaleY,e=this._targetTexture;e&&(t=e.height);var n=this._fov*cc.macro.RAD;this.node.z=t/(2*Math.tan(n/2)),n=2*Math.atan(Math.tan(n/2)/this.zoomRatio),this._camera.setFov(n),this._camera.setOrthoHeight(t/2/this.zoomRatio)},beforeDraw:function(){this._camera&&(this.node._is3DNode?(this._camera.setFov(this._fov*cc.macro.RAD),this._camera.setOrthoHeight(this._orthoSize)):this._layout(),this._camera.dirty=!0)}});e.exports=cc.Camera=b},{"../../renderer/scene/camera":203,"../CCGame":12,"../geom-utils":65,"../utils/affine-transform":153}],34:[function(t,e,n){"use strict";function i(t){t.start(),t._objFlags|=c}function r(t,e){t.update(e)}function a(t,e){t.lateUpdate(e)}t("./platform/CCClass");var s=t("./platform/CCObject").Flags,o=t("./platform/js").array,c=s.IsStartCalled,u=s.IsOnEnableCalled;function l(t,e){for(var n=e.constructor._executionOrder,i=e._id,r=0,a=t.length-1,s=a>>>1;r<=a;s=r+a>>>1){var o=t[s],c=o.constructor._executionOrder;if(n<c)a=s-1;else if(c<n)r=s+1;else{var u=o._id;if(i<u)a=s-1;else{if(!(u<i))return s;r=s+1}}}return~r}function h(t,e){for(var n=t.array,i=t.i+1;i<n.length;){var r=n[i];r._enabled&&r.node._activeInHierarchy?++i:(t.removeAt(i),e&&(r._objFlags&=~e))}}s.IsEditorOnEnableCalled;var f=cc.Class({__ctor__:function(t){var e=o.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t},statics:{stableRemoveInactive:h},add:null,remove:null,invoke:null});function d(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}var _=cc.Class({extends:f,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){h(this._zero,t),h(this._neg,t),h(this._pos,t)},invoke:function(){var t=this._neg;0<t.array.length&&(t.array.sort(d),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;0<e.array.length&&(e.array.sort(d),this._invoke(e),e.array.length=0)}}),m=cc.Class({extends:f,add:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var n=e<0?this._neg.array:this._pos.array,i=l(n,t);i<0&&n.splice(~i,0,t)}},remove:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var n=e<0?this._neg:this._pos,i=l(n.array,t);0<=i&&n.removeAt(i)}},invoke:function(t){0<this._neg.array.length&&this._invoke(this._neg,t),this._invoke(this._zero,t),0<this._pos.array.length&&this._invoke(this._pos,t)}});function p(r,t){if("function"==typeof r)return t?function(t,e){var n=t.array;for(t.i=0;t.i<n.length;++t.i){var i=n[t.i];r(i,e)}}:function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var n=e[t.i];r(n)}};var e="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+r+"}";return t?Function("it","dt",e):Function("it",e)}function v(){this.startInvoker=new _(p(i)),this.updateInvoker=new m(p(r,!0)),this.lateUpdateInvoker=new m(p(a,!0)),this.scheduleInNextFrame=[],this._updating=!1}var y=cc.Class({ctor:v,unscheduleAll:v,statics:{LifeCycleInvoker:f,OneOffInvoker:_,createInvokeImpl:p,invokeOnEnable:function(t){var e=cc.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var i=n[t.i];i._enabled&&(i.onEnable(),i.node._activeInHierarchy&&e._onEnabled(i))}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=u,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~u;var e=this.scheduleInNextFrame.indexOf(t);0<=e?o.fastRemoveAt(this.scheduleInNextFrame,e):(!t.start||t._objFlags&c||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,e){if(!(t._objFlags&u)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&u&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){!t.start||t._objFlags&c||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this.scheduleInNextFrame,e=0,n=t.length;e<n;e++){var i=t[e];this._scheduleImmediate(i)}t.length=0},startPhase:function(){this._updating=!0,0<this.scheduleInNextFrame.length&&this._deferredSchedule(),this.startInvoker.invoke()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1}});e.exports=y},{"./platform/CCClass":81,"./platform/CCObject":87,"./platform/js":101}],35:[function(t,e,n){"use strict";var i=t("../../animation/animation-animator"),r=t("../../animation/animation-clip"),a=t("../event/event-target"),s=t("../platform/js");function o(t,e){return t===e||t&&e&&(t.name===e.name||t._uuid===e._uuid)}var c=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"}),u=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[a],statics:{EventType:c},ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState=s.createMap(!0),this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:r},defaultClip:{type:r,get:function(){return this._defaultClip},set:function(){}},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:r,visible:!1},_clips:{default:[],type:[r],visible:!0},playOnLoad:{default:!1}},start:function(){if(this.playOnLoad&&this._defaultClip&&(!this._animator||!this._animator.isPlaying)){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){var n=this.playAdditive(t,e);return this._animator.stopStatesExcept(n),n},playAdditive:function(t,e){this._init();var n=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);if(n){this.enabled=!0;var i=this._animator;i.isPlaying&&n.isPlaying?n.isPaused?i.resumeState(n):(i.stopState(n),i.playState(n,e)):i.playState(n,e),this.enabledInHierarchy||i.pause(),this.currentClip=n.clip}return n},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this.enabled=!1},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.resumeState(e)}else this.enabled=!0},setCurrentTime:function(t,e){if(this._init(),e){var n=this._nameToState[e];n&&this._animator.setStateTime(n,t)}else this._animator.setStateTime(t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e&&!e.curveLoaded&&this._animator._reloadClip(e),e||null},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var n=this._nameToState[e];if(n){if(n.clip===t)return n;var i=this._clips.indexOf(n.clip);-1!==i&&this._clips.splice(i,1)}var r=new cc.AnimationState(t,e);return this._nameToState[e]=r}},removeClip:function(e,t){if(e){this._init();var n=void 0;for(var i in this._nameToState)if((n=this._nameToState[i]).clip===e)break;if(e===this._defaultClip){if(!t)return;this._defaultClip=null}if(n&&n.isPlaying){if(!t)return;this.stop(n.name)}this._clips=this._clips.filter(function(t){return t!==e}),n&&delete this._nameToState[n.name]}},sample:function(t){if(this._init(),t){var e=this._nameToState[t];e&&e.sample()}else this._animator.sample()},on:function(t,e,n,i){this._init();var r=this._EventTargetOn(t,e,n,i);return"lastframe"===t&&(this._animator.state._lastframeEventOn=!0),r},off:function(t,e,n,i){if(this._init(),"lastframe"===t){var r=this._nameToState;for(var a in r)r[a]._lastframeEventOn=!1}this._EventTargetOff(t,e,n,i)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new i(this.node,this),this._createStates())},_createStates:function(){this._nameToState=s.createMap(!0);for(var t=null,e=!1,n=0;n<this._clips.length;++n){var i=this._clips[n];i&&(t=new cc.AnimationState(i),this._nameToState[t.name]=t,o(this._defaultClip,i)&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});u.prototype._EventTargetOn=a.prototype.on,u.prototype._EventTargetOff=a.prototype.off,cc.Animation=e.exports=u},{"../../animation/animation-animator":2,"../../animation/animation-clip":3,"../event/event-target":60,"../platform/js":101,"./CCComponent":38}],36:[function(t,e,n){"use strict";var i=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function r(t){t.stopPropagation()}var a=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var t=0;t<i.length;t++)this.node.on(i[t],r,this)},onDisable:function(){for(var t=0;t<i.length;t++)this.node.off(i[t],r,this)}});cc.BlockInputEvents=e.exports=a},{"./CCComponent":38}],37:[function(t,e,n){"use strict";var i=t("../camera/CCCamera"),r=t("./CCComponent"),a=cc.Class({name:"cc.Canvas",extends:r,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings(),this.alignWithScreen()}},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings(),this.alignWithScreen())}},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings(),this.alignWithScreen())}}},ctor:function(){this._thisOnResized=this.alignWithScreen.bind(this)},__preload:function(){if(!a.instance){a.instance=this,cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):cc.view.on("canvas-resize",this._thisOnResized),this.applySettings(),this.alignWithScreen();var t=cc.find("Main Camera",this.node);t||((t=new cc.Node("Main Camera")).setParent(this.node),t.setSiblingIndex(0));var e=t.getComponent(i);if(!e){e=t.addComponent(i);var n=i.ClearFlags;e.clearFlags=n.COLOR|n.DEPTH|n.STENCIL,e.depth=-1}i.main=e}},onDestroy:function(){cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):cc.view.off("canvas-resize",this._thisOnResized),a.instance===this&&(a.instance=null)},alignWithScreen:function(){var t,e,n=e=cc.visibleRect;t=cc.view.getDesignResolutionSize();var i=0,r=0;this.fitHeight||this.fitWidth||(i=.5*(t.width-n.width),r=.5*(t.height-n.height)),this.node.setPosition(.5*n.width+i,.5*n.height+r),this.node.width=e.width,this.node.height=e.height},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var n=this._designResolution;cc.view.setDesignResolutionSize(n.width,n.height,t)}});cc.Canvas=e.exports=a},{"../camera/CCCamera":33,"./CCComponent":38}],38:[function(t,e,n){"use strict";var i=t("../platform/CCObject"),r=t("../platform/js"),a=new(t("../platform/id-generater"))("Comp"),s=(i.Flags.IsOnEnableCalled,i.Flags.IsOnLoadCalled),o=cc.Class({name:"cc.Component",extends:i,ctor:function(){this._id=a.getNewId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return 0<=e&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},uuid:{get:function(){return this._id},visible:!1},_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy)){var e=cc.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&s}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){this.unscheduleAllCallbacks();for(var t=this.__eventTargets,e=0,n=t.length;e<n;++e){var i=t[e];i&&i.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return(t=t||cc.instantiate._clone(this,this)).node=null,t},schedule:function(t,e,n,i){e=e||0,n=isNaN(n)?cc.macro.REPEAT_FOREVER:n,i=i||0;var r=cc.director.getScheduler(),a=r.isTargetPaused(this);r.schedule(t,this,e,n,i,a)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});o._requireComponent=null,o._executionOrder=0,r.value(o,"_$_registerEditorProps",function(t,e){var n=e.requireComponent;n&&(t._requireComponent=n);var i=e.executionOrder;i&&"number"==typeof i&&(t._executionOrder=i)}),o.prototype.__scriptUuid="",cc.Component=e.exports=o},{"../platform/CCObject":87,"../platform/id-generater":97,"../platform/js":101}],39:[function(t,e,n){"use strict";cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){var e=void 0;if(0<arguments.length)for(var n=0,i=(e=new Array(arguments.length-1)).length;n<i;n++)e[n]=arguments[n+1];for(var r=0,a=t.length;r<a;r++){var s=t[r];s instanceof cc.Component.EventHandler&&s.emit(e)}}},emit:function(t){var e=this.target;if(cc.isValid(e)){this._genCompIdIfNeeded();var n=cc.js._getClassById(this._componentId),i=e.getComponent(n);if(cc.isValid(i)){var r=i[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),r.apply(i,t))}}},_compName2Id:function(t){var e=cc.js.getClassByName(t);return cc.js._getClassId(e)},_compId2Name:function(t){var e=cc.js._getClassById(t);return cc.js.getClassName(e)},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="")}})},{}],40:[function(t,e,n){"use strict";var i=t("../platform/CCMacro"),r=t("./CCRenderComponent"),a=t("../renderer/utils/label/label-frame"),s=i.TextAlignment,o=i.VerticalTextAlignment,c=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),u=cc.Enum({NONE:0,BITMAP:1,CHAR:2}),l=cc.Class({name:"cc.Label",extends:r,ctor:function(){this._actualFontSize=0,this._assemblerData=null,this._frame=null,this._letterTexture=null},properties:{_useOriginalSize:!0,_string:{default:"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string},set:function(t){var e=this._string;this._string=t.toString(),this.string!==e&&this._updateRenderData(!0,!0),this._checkStringEmpty()},multiline:!0},horizontalAlign:{default:s.LEFT,type:s,notify:function(t){this.horizontalAlign!==t&&this._updateRenderData()},animatable:!1},verticalAlign:{default:o.TOP,type:o,notify:function(t){this.verticalAlign!==t&&this._updateRenderData()},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize}},_fontSize:24,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._updateRenderData())},range:[0,512]},fontFamily:{default:"Arial",notify:function(t){this.fontFamily!==t&&this._updateRenderData()},animatable:!1},_lineHeight:28,lineHeight:{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._updateRenderData())}},overflow:{default:c.NONE,type:c,notify:function(t){this.overflow!==t&&this._updateRenderData()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this._updateRenderData())},animatable:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){this.font!==t&&(t||(this._isSystemFontUsed=!0),(this._N$file=t)&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this._renderData&&(this.destroyRenderData(this._renderData),this._renderData=null),this._fontAtlas=null,this._updateAssembler(),this._applyFontTexture(!0),this._updateRenderData())},type:cc.Font,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._renderData&&(this.destroyRenderData(this._renderData),this._renderData=null),this._isSystemFontUsed=!!t,t?(this.font=null,this._updateAssembler(),this._updateRenderData(),this._checkStringEmpty()):this._userDefinedFont||this.disableRender())},animatable:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this._updateRenderData()}},_batchAsBitmap:!1,cacheMode:{default:u.NONE,type:u,notify:function(t){this.cacheMode!==t&&(t!==u.BITMAP||this.font instanceof cc.BitmapFont||this._frame._resetDynamicAtlasFrame())},animatable:!1},_isBold:{default:!1,serializable:!1},_isItalic:{default:!1,serializable:!1},_isUnderline:{default:!1,serializable:!1}},statics:{HorizontalAlign:s,VerticalAlign:o,Overflow:c,CacheMode:u},onLoad:function(){this._batchAsBitmap&&this.cacheMode===u.NONE?(this.cacheMode=u.BITMAP,this._batchAsBitmap=!1):this.cacheMode===u.NONE&&(this.cacheMode=b8e.macro.DEFAULT_CACHE_MODE)},setColorTransfrom:function(t){this._colorTransfrom!=t&&(this._colorTransfrom=t,this._activateMaterial(!0))},onEnable:function(){this._super();var t=this._materials[0];t&&(t.release(),this._materials[0]=null),this._materials.length=0,this.font||this._isSystemFontUsed||(this.useSystemFont=!0),this.useSystemFont&&!this.fontFamily&&(this.fontFamily="Arial"),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateRenderData,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateRenderData,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._updateColor,this),this._checkStringEmpty(),this._updateRenderData(!0,!0)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateRenderData,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateRenderData,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._updateColor,this)},onDestroy:function(){b8e._labelDestroy(this),this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData),this._assemblerData=null,this._letterTexture=null,this._renderData&&(this.destroyRenderData(this._renderData),this._renderData=null),this._colorTransfrom=null,this._super()},_canRender:function(){var t=this._super(),e=this.font;return e instanceof cc.BitmapFont&&(e.spriteFrame||(t=!1)),t},_checkStringEmpty:function(){this.markForRender(!!this.string)},_on3DNodeChanged:function(){this._updateAssembler(),this._applyFontTexture(!0)},_updateAssembler:function(){var t=l._assembler.getAssembler(this);if(this._assembler!==t){this._assembler=t,this._renderData&&(this.destroyRenderData(this._renderData),this._renderData=null),this._frame=null,this._assemblerData=null,this._letterTexture=null;var e=this.sharedMaterials[0];e&&e.setTexture(null)}this._renderData||(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData(!0))},_applyFontTexture:function(t){var e=this.font;if(e instanceof cc.BitmapFont){var n=e.spriteFrame;this._frame=n;var i=this;n?(i._frame._texture=n._texture,i._activateMaterial(t),t&&i._assembler&&i._assembler.updateRenderData(i)):this.disableRender()}else{if(this._frame||(this._frame=new a),this._letterTexture=this._assembler._getAssemblerData(this),this._frame._texture!==this._letterTexture){var r=this.sharedMaterials[0];r&&r.setTexture(null)}this._letterTexture&&this._frame._refreshTexture(this._letterTexture),this._activateMaterial(t),t&&this._assembler&&this._assembler.updateRenderData(this)}},_updateColor:function(){this.font instanceof cc.BitmapFont||(this._updateRenderData(),this.node._renderFlag&=~b8e.RenderFlow.FLAG_COLOR)},_activateMaterial:function(t){if(t){var e=this._frame._texture,n=this.sharedMaterials[0];n&&n._texture===e||(n||(n=this.sharedMaterials[0]=b8e.LabelMaterial.get(),this.setMaterial(0,n)),n.setTexture(e)),n.setColorTransfrom(this._colorTransfrom),this.markForUpdateRenderData(!0),this.markForRender(!0)}},_updateRenderData:function(t,e){b8e._updateLabelRenderData(this,t,e)},_enableBold:function(t){this._isBold=!!t},_enableItalics:function(t){this._isItalic=!!t},_enableUnderline:function(t){this._isUnderline=!!t}});cc.Label=e.exports=l},{"../platform/CCMacro":86,"../renderer/utils/label/label-frame":125,"./CCRenderComponent":45}],41:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),properties:{_color:cc.Color.WHITE,_width:1,color:{get:function(){return this._color},set:function(t){this._color=t,this._updateRenderData()}},width:{get:function(){return this._width},set:function(t){this._width=t,this._updateRenderData()},range:[0,512]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t._updateRenderData()}});cc.LabelOutline=e.exports=i},{"./CCComponent":38}],42:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.LabelShadow",extends:t("./CCComponent"),properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{get:function(){return this._color},set:function(t){this._color=t,this._updateRenderData()}},offset:{get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},blur:{get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()},range:[0,1024]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t._updateRenderData()}});cc.LabelShadow=e.exports=i},{"./CCComponent":38}],43:[function(t,e,n){"use strict";var h=t("../vmath"),i=t("../utils/misc"),r=t("./CCRenderComponent"),f=(t("../graphics/graphics"),t("../CCNode"),cc.v2()),d=h.mat4.create(),_=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),a=cc.Class({name:"cc.Mask",extends:r,ctor:function(){this._graphics=null,this._createGraphics(),this._enableMaterial=null,this._exitMaterial=null,this._clearMaterial=null},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:_.RECT,type:{get:function(){return this._type},set:function(t){this._type=t,this._type!==_.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics()),this._renderData&&(this.destroyRenderData(this._renderData),this._renderData=null),this._activateMaterial()},type:_},spriteFrame:{type:cc.SpriteFrame,get:function(){return this._spriteFrame},set:function(t){var e=this._spriteFrame;e!==t&&(this._spriteFrame=t,this._applySpriteFrame(e))}},alphaThreshold:{default:0,type:cc.Float,range:[0,1,.1],slide:!0,notify:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){var t=this.sharedMaterials[0];t&&t.setProperty("alphaThreshold",this.alphaThreshold)}}},inverted:{default:!1,type:cc.Boolean,notify:function(){cc.game.renderType,cc.game.RENDER_TYPE_CANVAS}},_segments:64,segements:{get:function(){return this._segments},set:function(t){this._segments=i.clampf(t,3,1e4),this._updateGraphics()},type:cc.Integer},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:_},onLoad:function(){this._createGraphics()},onRestore:function(){this._createGraphics(),this._type!==_.IMAGE_STENCIL?this._updateGraphics():this._applySpriteFrame()},onEnable:function(){this._super(),this._type===_.IMAGE_STENCIL?this._spriteFrame||(this.markForRender(!1),this._spriteFrame&&(this.markForUpdateRenderData(!1),this._spriteFrame.once("load",this._onTextureLoaded,this),this._spriteFrame.ensureLoadTexture())):this._updateGraphics(),this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag|=b8e.RenderFlow.FLAG_POST_RENDER,this._activateMaterial()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag&=~b8e.RenderFlow.FLAG_POST_RENDER},onDestroy:function(){this._enableMaterial&&(this._enableMaterial.release(),this._enableMaterial=null),this._exitMaterial&&(this._exitMaterial.release(),this._exitMaterial=null),this._clearMaterial&&(this._clearMaterial.release(),this._clearMaterial=null),this._super(),this._removeGraphics()},_onTextureLoaded:function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderData.vertDirty=!0,this.markForUpdateRenderData(!0)),this.enabledInHierarchy&&this._activateMaterial()},_applySpriteFrame:function(){this._spriteFrame?this._onTextureLoaded(null):this.disableRender()},_activateMaterial:function(){if(this._type!==_.IMAGE_STENCIL||this.spriteFrame){if(this._enableMaterial||(this._enableMaterial=b8e.GraphicsMaterial.get()),!this._exitMaterial){this._exitMaterial=b8e.GraphicsMaterial.get();for(var t=this._exitMaterial.effect.getDefaultTechnique().passes,e=0;e<t.length;e++)t[e].setStencilEnabled(b8e.GFXEnums.STENCIL_DISABLE)}this._clearMaterial||(this._clearMaterial=b8e.ClearStencilMaterial.get());var n=this.sharedMaterials[0];if(!n){if((n=this.sharedMaterials[0]=b8e.GraphicsMaterial.get()).setProperty("useAlphaTest",!0),this._type===_.IMAGE_STENCIL){var i=this.spriteFrame.getTexture();n.setTexture(i),n.setProperty("alphaThreshold",this.alphaThreshold)}this.setMaterial(0,n)}this.markForRender(!0)}else this.markForRender(!1)},_createGraphics:function(){this._graphics||(this._graphics=b8e.GraphicsMask.get()),this._graphics.setNode(this.node)},_updateGraphics:function(){var t=this.node,e=this._graphics;if(e&&!this.isGraphMode){e.clear();var n=t._contentSize.width,i=t._contentSize.height,r=-n*t._anchorPoint.x,a=-i*t._anchorPoint.y;this._type===_.RECT?e.fillRect(r,a,n,i):this._type===_.ELLIPSE&&e.fillEllipse(r,a,n,i,this._segments)}},_removeGraphics:function(){this._graphics&&(this._graphics.release(),this._graphics=null)},_hitTest:function(t){var e=this.node,n=e.getContentSize(),i=n.width,r=n.height,a=f;e._updateWorldMatrix(),h.mat4.invert(d,e._worldMatrix),h.vec2.transformMat4(a,t,d),a.x+=e._anchorPoint.x*i,a.y+=e._anchorPoint.y*r;var s=!1;if(this.type===_.RECT||this.type===_.IMAGE_STENCIL)s=0<=a.x&&0<=a.y&&a.x<=i&&a.y<=r;else if(this.type===_.ELLIPSE){var o=i/2,c=r/2,u=a.x-.5*i,l=a.y-.5*r;s=u*u/(o*o)+l*l/(c*c)<1}return this.inverted&&(s=!s),s},markForUpdateRenderData:function(t){t&&this.enabledInHierarchy?this.node._renderFlag|=b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA:t||(this.node._renderFlag&=~b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA)},markForRender:function(t){t&&this.enabledInHierarchy?this.node._renderFlag|=b8e.RenderFlow.FLAG_RENDER|b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA|b8e.RenderFlow.FLAG_POST_RENDER:t||(this.node._renderFlag&=~(b8e.RenderFlow.FLAG_RENDER|b8e.RenderFlow.FLAG_POST_RENDER))},disableRender:function(){this.node._renderFlag&=~(b8e.RenderFlow.FLAG_RENDER|b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA|b8e.RenderFlow.FLAG_POST_RENDER)}});cc.Mask=e.exports=a},{"../CCNode":13,"../graphics/graphics":69,"../utils/misc":163,"../vmath":184,"./CCRenderComponent":45}],44:[function(t,e,n){"use strict";var i=t("../components/CCRenderComponent"),r=t("../utils/texture-util"),a=t("../../core/utils/blend-func"),s=cc.Class({name:"cc.MotionStreak",extends:i,mixins:[a],ctor:function(){this._points=[]},properties:{preview:{default:!1,editorOnly:!0,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()},animatable:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(t){this._minSeg=t},animatable:!1},_stroke:64,stroke:{get:function(){return this._stroke},set:function(t){this._stroke=t},animatable:!1},_texture:{default:null},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&((this._texture=t)&&t.loaded?this._activateMaterial():(this.disableRender(),this._ensureLoadTexture()))},animatable:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color},set:function(t){this._color=t},type:cc.Color},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(t){this._fastMode=t},animatable:!1}},onEnable:function(){this._super(),this._texture&&this._texture.loaded?this._activateMaterial():(this.disableRender(),this._ensureLoadTexture()),this.reset()},_ensureLoadTexture:function(){if(this._texture&&!this._texture.loaded){var t=this;r.postLoadTexture(this._texture,function(){t._activateMaterial()})}},_activateMaterial:function(){if(this._texture&&this._texture.loaded){var t=this.sharedMaterials[0];t.setTexture(this._texture),this.setMaterial(0,t),this.markForRender(!0)}else this.disableRender()},reset:function(){this._points.length=0;var t=this._renderData;t&&(t.dataLength=0,t.vertexCount=0,t.indiceCount=0)}});cc.MotionStreak=e.exports=s},{"../../core/utils/blend-func":156,"../components/CCRenderComponent":45,"../utils/texture-util":170}],45:[function(t,e,n){"use strict";var i=t("./CCComponent"),r=(t("../platform/CCMacro").BlendFactor,cc.Class({name:"RenderComponent",extends:i,properties:{_materials:{default:[]},sharedMaterials:{get:function(){return this._materials},set:function(t){this._materials=t,this._activateMaterial(!0)},displayName:"Materials"}},ctor:function(){this._renderData=null,this.__allocedDatas=[],this._vertexFormat=null,this._toPostHandle=!1,this._assembler=this.constructor._assembler,this._postAssembler=this.constructor._postAssembler},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),(this.node._renderComponent=this).node._renderFlag|=b8e.RenderFlow.FLAG_RENDER|b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA},onDisable:function(){this.node._renderComponent=null,this.disableRender()},onDestroy:function(){for(var t=0,e=this.__allocedDatas.length;t<e;t++)b8e.RenderData.put(this.__allocedDatas[t]);this.__allocedDatas.length=0;var n=this._materials[0];n&&(n.release(),this._materials[0]=null),this._materials.length=0,this._renderData=null;var i=this._uniforms;for(var r in i)_uniformPool.remove(_uniformPool._data.indexOf(i[r]));this._uniforms=null,this._defines=null},_canRender:function(){return this._enabled&&this.node._activeInHierarchy},markForUpdateRenderData:function(t){t&&this._canRender()?this.node._renderFlag|=b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA:t||(this.node._renderFlag&=~b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA)},markForRender:function(t){t&&this._canRender()?this.node._renderFlag|=b8e.RenderFlow.FLAG_RENDER:t||(this.node._renderFlag&=~b8e.RenderFlow.FLAG_RENDER)},markForCustomIARender:function(t){t&&this._canRender()?this.node._renderFlag|=b8e.RenderFlow.FLAG_CUSTOM_IA_RENDER:t||(this.node._renderFlag&=~b8e.RenderFlow.FLAG_CUSTOM_IA_RENDER)},disableRender:function(){this.node._renderFlag&=~(b8e.RenderFlow.FLAG_RENDER|b8e.RenderFlow.FLAG_CUSTOM_IA_RENDER|b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA)},requestRenderData:function(){var t=b8e.RenderData.get();return this.__allocedDatas.push(t),t},destroyRenderData:function(t){var e=this.__allocedDatas.indexOf(t);-1!==e&&(this.__allocedDatas.splice(e,1),b8e.RenderData.put(t))},getMaterial:function(t){return t<0||t>=this._materials.length?null:this._materials[t]?this._materials[t]:null},setMaterial:function(t,e){(this._materials[t]=e)&&this.markForUpdateRenderData(!0)},_activateMaterial:function(){}}));r._assembler=null,r._postAssembler=null,cc.RenderComponent=e.exports=r},{"../platform/CCMacro":86,"./CCComponent":38}],46:[function(t,e,n){"use strict";var u=t("../utils/misc"),f=(t("./CCComponent"),cc.Enum({HORIZONTAL:0,VERTICAL:1})),i=cc.Class({name:"cc.Scrollbar",extends:t("./CCComponent"),properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},direction:{default:f.HORIZONTAL,type:f,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1},autoHideTime:{default:1,animatable:!1}},statics:{Direction:f},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=t.convertToWorldSpace(cc.v2(0,0));return this._scrollView.node.convertToNodeSpace(e)},_setOpacity:function(t){this.handle&&(this.node.opacity=t,this.handle.node.opacity=t)},_onScroll:function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var n=e.getContentSize(),i=this._scrollView.node.getContentSize(),r=this.node.getContentSize();if(this._conditionalDisableScrollBar(n,i))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var a=0,s=0,o=0,c=0,u=0;this.direction===f.HORIZONTAL?(a=n.width,s=i.width,u=r.width,o=t.x,c=-this._convertToScrollViewSpace(e).x):this.direction===f.VERTICAL&&(a=n.height,s=i.height,u=r.height,o=t.y,c=-this._convertToScrollViewSpace(e).y);var l=this._calculateLength(a,s,u,o),h=this._calculatePosition(a,s,u,c,o,l);this._updateLength(l),this._updateHanlderPosition(h)}}},_updateHanlderPosition:function(t){if(this.handle){var e=this._fixupHandlerPosition();this.handle.node.setPosition(t.x+e.x,t.y+e.y)}},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),n=this.handle.node.getContentSize(),i=this.handle.node.parent,r=this.node.convertToWorldSpaceAR(cc.v2(-t.width*e.x,-t.height*e.y)),a=i.convertToNodeSpaceAR(r);return this.direction===f.HORIZONTAL?a=cc.v2(a.x,a.y+(t.height-n.height)/2):this.direction===f.VERTICAL&&(a=cc.v2(a.x+(t.width-n.width)/2,a.y)),this.handle.node.setPosition(a),a},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===f.HORIZONTAL||t.height<=e.height&&this.direction===f.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t.getContentSize(),n=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(e,n))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,n,i){var r=t;return i&&(r+=20*(0<i?i:-i)),n*(e/r)},_calculatePosition:function(t,e,n,i,r,a){var s=t-e;r&&(s+=Math.abs(r));var o=0;s&&(o=i/s,o=u.clamp01(o));var c=(n-a)*o;return this.direction===f.VERTICAL?cc.v2(0,c):cc.v2(c,0)},_updateLength:function(t){if(this.handle){var e=this.handle.node,n=e.getContentSize();e.setAnchorPoint(cc.v2(0,0)),this.direction===f.HORIZONTAL?e.setContentSize(t,n.height):e.setContentSize(n.width,t)}},_processAutoHide:function(t){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=i},{"../utils/misc":163,"./CCComponent":38}],47:[function(t,e,n){"use strict";function l(t){return(t-=1)*t*t*t*t+1}function i(){return(new Date).getMilliseconds()}var r=t("../CCNode").EventType,h=1e-4,a=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),s={"scroll-to-top":a.SCROLL_TO_TOP,"scroll-to-bottom":a.SCROLL_TO_BOTTOM,"scroll-to-left":a.SCROLL_TO_LEFT,"scroll-to-right":a.SCROLL_TO_RIGHT,scrolling:a.SCROLLING,"bounce-bottom":a.BOUNCE_BOTTOM,"bounce-left":a.BOUNCE_LEFT,"bounce-right":a.BOUNCE_RIGHT,"bounce-top":a.BOUNCE_TOP,"scroll-ended":a.SCROLL_ENDED,"touch-up":a.TOUCH_UP,"scroll-ended-with-threshold":a.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":a.SCROLL_BEGAN},o=cc.Class({name:"cc.ScrollView",extends:t("./CCViewGroup"),ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.v2(0,0),this._autoScrollTargetDelta=cc.v2(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._outOfBoundaryAmount=cc.v2(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,formerlySerializedAs:"content",notify:function(){this._calculateBoundary()}},horizontal:{default:!0,animatable:!1},vertical:{default:!0,animatable:!1},inertia:{default:!0},brake:{default:.5,type:"Float",range:[0,1,.1]},elastic:{default:!0,animatable:!1},bounceDuration:{default:1,range:[0,10]},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler},cancelInnerEvents:{default:!0,animatable:!1},_view:{get:function(){if(this.content)return this.content.parent}}},statics:{EventType:a},scrollToBottom:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n,!0)},scrollToTop:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToLeft:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToRight:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToTopLeft:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToTopRight:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToBottomLeft:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToBottomRight:function(t,e){var n=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},scrollToOffset:function(t,e,n){var i=this.getMaxScrollOffset(),r=cc.v2(0,0);0===i.x?r.x=0:r.x=t.x/i.x,0===i.y?r.y=1:r.y=(i.y-t.y)/i.y,this.scrollTo(r,e,n)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(e,t)},getMaxScrollOffset:function(){var t=this._view.getContentSize(),e=this.content.getContentSize(),n=e.width-t.width,i=e.height-t.height;return n=0<=n?n:0,i=0<=i?i:0,cc.v2(n,i)},scrollToPercentHorizontal:function(t,e,n){var i=this._calculateMovePercentDelta({anchor:cc.v2(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(i,e,!1!==n):this._moveContent(i)},scrollTo:function(t,e,n){var i=this._calculateMovePercentDelta({anchor:cc.v2(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(i,e,!1!==n):this._moveContent(i)},scrollToPercentVertical:function(t,e,n){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(i,e,!1!==n):this._moveContent(i)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){t.fuzzyEquals(this.getContentPosition(),h)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=cc.v2(0,0),i=-.1;IS_RUNTIME&&(i=-7),this.vertical?n=cc.v2(0,t.getScrollY()*i):this.horizontal&&(n=cc.v2(t.getScrollY()*i,0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(n),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},_checkMouseWheel:function(t){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),h))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,.1<this._mouseWheelEventElapsedTime&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(t){var e=t.anchor,n=t.applyToHorizontal,i=t.applyToVertical;this._calculateBoundary(),e=e.clampf(cc.v2(0,0),cc.v2(1,1));var r=this._view.getContentSize(),a=this.content.getContentSize(),s=this._getContentBottomBoundary()-this._bottomBoundary;s=-s;var o=this._getContentLeftBoundary()-this._leftBoundary;o=-o;var c=cc.v2(0,0),u=0;return n&&(u=a.width-r.width,c.x=o-u*e.x),i&&(u=a.height-r.height,c.y=s-u*e.y),c},_moveContentToTopLeft:function(t){var e=this.content.getContentSize(),n=this._getContentBottomBoundary()-this._bottomBoundary;n=-n;var i=cc.v2(0,0),r=0,a=this._getContentLeftBoundary()-this._leftBoundary;a=-a,e.height<t.height?(r=e.height-t.height,i.y=n-r,this.verticalScrollBar&&this.verticalScrollBar.hide()):this.verticalScrollBar&&this.verticalScrollBar.show(),e.width<t.width?(r=e.width-t.width,i.x=a,this.horizontalScrollBar&&this.horizontalScrollBar.hide()):this.horizontalScrollBar&&this.horizontalScrollBar.show(),this._moveContent(i),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var t=this.content.getComponent(cc.Layout);t&&t.enabledInHierarchy&&t.updateLayout();var e=this._view.getContentSize(),n=e.width*this._view.anchorX,i=e.height*this._view.anchorY;this._leftBoundary=-n,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e)}},_hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var n=0;n<e.length;++n){var i=e[n];if(this.node===i)return!!t.target.getComponent(cc.ViewGroup);if(i.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=t.touch;this.content&&this._handlePressLogic(n),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)}},_onTouchMoved:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=t.touch;if(this.content&&this._handleMoveLogic(n),this.cancelInnerEvents){if(7<n.getLocation().sub(n.getStartLocation()).mag()&&!this._touchMoved&&t.target!==this.node){var i=new cc.Event.EventTouch(t.getTouches(),t.bubbles);i.type=cc.Node.EventType.TOUCH_CANCEL,i.touch=t.touch,i.simulate=!0,t.target.dispatchEvent(i),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},_onTouchEnded:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent("touch-up");var n=t.touch;this.content&&this._handleReleaseLogic(n),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)}},_onTouchCancelled:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){if(!t.simulate){var n=t.touch;this.content&&this._handleReleaseLogic(n)}this._stopPropagationIfTargetIsMe(t)}},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_handleMoveLogic:function(t){var e=t.getDelta();this._processDeltaMove(e)},_scrollChildren:function(t){var e=t=this._clampDelta(t),n=void 0;this.elastic&&(n=this._getHowMuchOutOfBoundary(),e.x*=0===n.x?1:.5,e.y*=0===n.y?1:.5),this.elastic||(n=this._getHowMuchOutOfBoundary(e),e=e.add(n));var i=-1;0<e.y?this.content.y-this.content.anchorY*this.content.height+e.y>this._bottomBoundary&&(i="scroll-to-bottom"):e.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+e.y<=this._topBoundary&&(i="scroll-to-top"),e.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+e.x<=this._rightBoundary&&(i="scroll-to-right"):0<e.x&&this.content.x-this.content.anchorX*this.content.width+e.x>=this._leftBoundary&&(i="scroll-to-left"),this._moveContent(e,!1),0===e.x&&0===e.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),-1!==i&&this._dispatchEvent(i)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=i(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),n=this._view.getContentSize();return e.width<n.width&&(t.x=0),e.height<n.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var e=i();this._touchMoveTimeDeltas.push((e-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=e},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).fuzzyEquals(cc.v2(0,0),h))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(0<t.y&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),0<t.x&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.fuzzyEquals(cc.v2(0,0),h)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){var e=t.getDelta();this._gatherTouchMove(e),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),h)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return h},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),n=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/n);var i=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=l(i));var r=this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(i)),a=Math.abs(i-1)<=h;if(Math.abs(i-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var s=r.sub(this._autoScrollBrakingStartPosition);e&&(s=s.mul(n)),r=this._autoScrollBrakingStartPosition.add(s)}else{var o=r.sub(this.getContentPosition()),c=this._getHowMuchOutOfBoundary(o);c.fuzzyEquals(cc.v2(0,0),h)||(r=r.add(c),a=!0)}a&&(this._autoScrolling=!1);var u=r.sub(this.getContentPosition());this._moveContent(this._clampDelta(u),a),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(t){var e=t.mul(.7);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},_startAttenuatingAutoScroll:function(t,e){var n=this._calculateAutoScrollTimeByInitalSpeed(e.mag()),i=t.normalize(),r=this.content.getContentSize(),a=this._view.getContentSize(),s=r.width-a.width,o=r.height-a.height,c=this._calculateAttenuatedFactor(s),u=this._calculateAttenuatedFactor(o);i=cc.v2(i.x*s*(1-this.brake)*c,i.y*o*u*(1-this.brake));var l=t.mag(),h=i.mag()/l;i=i.add(t),0<this.brake&&7<h&&(h=Math.sqrt(h),i=t.mul(h).add(t)),0<this.brake&&3<h&&(n*=h=3),0===this.brake&&1<h&&(n*=h),this._startAutoScroll(i,n,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAutoScroll:function(t,e,n){var i=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=i,this._autoScrollAttenuate=n,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),h)||(this._autoScrollCurrentlyOutOfBoundary=!0)},_calculateTouchMoveVelocity:function(){var t=0;if((t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e},t))<=0||.5<=t)return cc.v2(0,0);var e=cc.v2(0,0);return e=this._touchMoveDisplacements.reduce(function(t,e){return t.add(e)},e),cc.v2(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},_moveContent:function(t,e){var n=this._flattenVectorByDirection(t),i=this.getContentPosition().add(n);this.setContentPosition(i);var r=this._getHowMuchOutOfBoundary();this._updateScrollBar(r),this.elastic&&e&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(t){if((t=t||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),h)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.v2(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.fuzzyEquals(cc.v2(0,0),h)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e)},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var e=1<<s[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,s[t]),this.node.emit(t,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var t=this._getHowMuchOutOfBoundary(cc.v2(0,0)),e=this.getContentPosition().add(t);this.content&&(this.content.setPosition(e),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&this._adjustContentOutOfBoundary()},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},_showScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.show(),this.verticalScrollBar&&this.verticalScrollBar.show()},onDisable:function(){this._unregisterEvent(),this.content&&(this.content.off(r.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(r.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(r.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(r.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(r.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.content&&(this.content.on(r.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(r.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(r.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(r.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(r.SIZE_CHANGED,this._calculateBoundary,this))),this._showScrollbar()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.ScrollView=e.exports=o},{"../CCNode":13,"./CCViewGroup":49}],48:[function(t,e,n){"use strict";var i=t("../utils/misc"),r=t("../CCNode").EventType,a=t("./CCRenderComponent"),s=t("../utils/blend-func"),o=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),c=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),u=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),l=cc.Enum({NORMAL:0,GRAY:1}),h=cc.Class({name:"cc.Sprite",extends:a,mixins:[s],properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:o.SIMPLE,_sizeMode:u.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{default:null,type:cc.SpriteAtlas,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t){var e=this._spriteFrame;e!==t&&(this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type!==t&&(this.destroyRenderData(this._renderData),this._renderData=null,this._type=t,this._updateAssembler())},type:o,animatable:!1},fillType:{get:function(){return this._fillType},set:function(t){t!==this._fillType&&(t===c.RADIAL||this._fillType===c.RADIAL?(this.destroyRenderData(this._renderData),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0),this._fillType=t,this._updateAssembler())},type:c},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===o.FILLED&&this._renderData&&this.markForUpdateRenderData(!0)}},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=i.clampf(t,-1,1),this._type===o.FILLED&&this._renderData&&this.markForUpdateRenderData(!0)}},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=i.clampf(t,-1,1),this._type===o.FILLED&&this._renderData&&this.markForUpdateRenderData(!0)}},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type!==o.SIMPLE&&this._type!==o.MESH||!this._renderData||this.markForUpdateRenderData(!0))},animatable:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){(this._sizeMode=t)!==u.CUSTOM&&this._applySpriteSize()},animatable:!1,type:u}},statics:{FillType:c,Type:o,SizeMode:u,State:l},setVisible:function(t){this.enabled=t},setState:function(){},getState:function(){},setColorTransfrom:function(t){this._colorTransfrom!=t&&(this._colorTransfrom=t,this._spriteFrame&&this._activateMaterial())},onEnable:function(){this._super();var t=this._materials[0];t&&(t.release(),this._materials[0]=null),this._materials.length=0,this._updateAssembler(),this._activateMaterial(),this.node.on(r.SIZE_CHANGED,this._onNodeSizeDirty,this),this.node.on(r.ANCHOR_CHANGED,this._onNodeSizeDirty,this)},onDisable:function(){this._super(),this.node.off(r.SIZE_CHANGED,this._onNodeSizeDirty,this),this.node.off(r.ANCHOR_CHANGED,this._onNodeSizeDirty,this)},onDestroy:function(){this._colorTransfrom=null,this._super()},_onNodeSizeDirty:function(){this._renderData&&this.markForUpdateRenderData(!0)},_on3DNodeChanged:function(){this._updateAssembler()},_updateAssembler:function(){var t=h._assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t,this._renderData=null),this._renderData||(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData(!0))},_activateMaterial:function(){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)return this.markForUpdateRenderData(!0),void this.markForRender(!0);var t=this._spriteFrame;if(t){var e=t.getTexture(),n=this.sharedMaterials[0];if(!n){var i=e._ENABLE_BLOCK_COMPACT_;n=this.sharedMaterials[0]=i?b8e.BCSpriteMaterial.get():b8e.SpriteMaterial.get(),this.setMaterial(0,n)}n.setTexture(e),n.setColorTransfrom(this._colorTransfrom),this.markForUpdateRenderData(!0),this.markForRender(!0)}else this.disableRender()},_canRender:function(){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){if(!this._enabled)return!1}else if(!(this._enabled&&this.sharedMaterials[0]&&this.sharedMaterials[0]._texture&&this.sharedMaterials[0]._texture.getImpl()&&this.node._activeInHierarchy))return!1;return!!this._spriteFrame},markForUpdateRenderData:function(t){if(t&&this._canRender()){this.node._renderFlag|=b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA;var e=this._renderData;e&&(e.uvDirty=!0,e.vertDirty=!0)}else t||(this.node._renderFlag&=~b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA)},_applySpriteSize:function(){var t=this,e=t._spriteFrame;if(e){if(u.RAW===t._sizeMode){var n=e._originalSize;t.node.setContentSize(n)}else if(u.TRIMMED===t._sizeMode){var i=e._rect;t.node.setContentSize(i.width,i.height)}t.markForUpdateRenderData(!0)}},_applySpriteFrame:function(){var t=this._spriteFrame,e=this.sharedMaterials[0];if(!t||(e&&e._texture)!==(t&&t._texture)){var n=this.sharedMaterials[0];n&&n.setTexture(null),this.markForRender(!1)}t&&(e&&e._texture===t._texture||this._activateMaterial(),this._applySpriteSize())}});cc.Sprite=e.exports=h},{"../CCNode":13,"../utils/blend-func":156,"../utils/misc":163,"./CCRenderComponent":45}],49:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.ViewGroup",extends:t("./CCComponent")});cc.ViewGroup=e.exports=i},{"./CCComponent":38}],50:[function(t,e,n){"use strict";var i,r=t("./CCComponent");i=cc.sys.platform===cc.sys.BAIDU_GAME?cc.Class({name:"cc.SwanSubContextView",extends:r,properties:{_fps:60,fps:{get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1/t,this._updateSubContextFrameRate())}}},ctor:function(){this._sprite=null,this._tex=new b8e.Texture2D,this._context=null,this._previousUpdateTime=performance.now(),this._updateInterval=0},onLoad:function(){if(swan.getOpenDataContext){this._updateInterval=1e3/this._fps,this._context=swan.getOpenDataContext();var t=this._context.canvas;t&&(t.width=this.node.width,t.height=this.node.height),this._tex.setPremultiplyAlpha(!0),this._tex.initWithElement(t),this._sprite=this.node.getComponent(cc.Sprite),this._sprite||(this._sprite=this.node.addComponent(cc.Sprite),this._sprite.srcBlendFactor=cc.macro.BlendFactor.ONE),this._sprite.spriteFrame=new cc.SpriteFrame(this._tex)}else this.enabled=!1},onEnable:function(){this._runSubContextMainLoop(),this._registerNodeEvent(),this._updateSubContextFrameRate(),this.updateSubContextViewport()},onDisable:function(){this._unregisterNodeEvent(),this._stopSubContextMainLoop()},update:function(){var t=performance.now(),e=t-this._previousUpdateTime;!this._tex||!this._context||e<this._updateInterval||(this._previousUpdateTime=t,this._tex.initWithElement(this._context.canvas),this._sprite._activateMaterial())},updateSubContextViewport:function(){if(this._context){var t=this.node.getBoundingBoxToWorld(),e=cc.view._scaleX,n=cc.view._scaleY;this._context.postMessage({fromEngine:!0,event:"viewport",x:t.x*e+cc.view._viewportRect.x,y:t.y*n+cc.view._viewportRect.y,width:t.width*e,height:t.height*n})}},_registerNodeEvent:function(){this.node.on("position-changed",this.updateSubContextViewport,this),this.node.on("scale-changed",this.updateSubContextViewport,this),this.node.on("size-changed",this.updateSubContextViewport,this)},_unregisterNodeEvent:function(){this.node.off("position-changed",this.updateSubContextViewport,this),this.node.off("scale-changed",this.updateSubContextViewport,this),this.node.off("size-changed",this.updateSubContextViewport,this)},_runSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!0})},_stopSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!1})},_updateSubContextFrameRate:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"frameRate",value:this._fps})}}):cc.Class({name:"cc.SwanSubContextView",extends:r}),cc.SwanSubContextView=e.exports=i},{"./CCComponent":38}],51:[function(t,e,n){"use strict";var i,r=t("./CCComponent");i=IS_WECHATGAME?cc.Class({name:"cc.WXSubContextView",extends:r,properties:{_fps:60,fps:{get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1/t,this._updateSubContextFrameRate())}}},ctor:function(){this._sprite=null,this._tex=new b8e.Texture2D,this._context=null,this._previousUpdateTime=performance.now(),this._updateInterval=0},onLoad:function(){wx.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._context=wx.getOpenDataContext(),this.reset(),this._tex.setPremultiplyAlpha(!0),this._tex.initWithElement(sharedCanvas),this._sprite=this.node.getComponent(cc.Sprite),this._sprite||(this._sprite=this.node.addComponent(cc.Sprite),this._sprite.srcBlendFactor=cc.macro.BlendFactor.ONE),this._sprite.spriteFrame=new cc.SpriteFrame(this._tex)):this.enabled=!1},reset:function(){if(this._context){this.updateSubContextViewport();var t=this._context.canvas;t&&(t.width=this.node.width,t.height=this.node.height)}},onEnable:function(){this._runSubContextMainLoop(),this._registerNodeEvent(),this._updateSubContextFrameRate(),this.updateSubContextViewport()},onDisable:function(){this._unregisterNodeEvent(),this._stopSubContextMainLoop()},update:function(){var t=performance.now(),e=t-this._previousUpdateTime;!this._tex||!this._context||e<this._updateInterval||(this._previousUpdateTime=t,this._deltaTime=0,this._tex.initWithElement(this._context.canvas),this._sprite._activateMaterial())},updateSubContextViewport:function(){if(this._context){var t=this.node.getBoundingBoxToWorld(),e=cc.view._scaleX,n=cc.view._scaleY;this._context.postMessage({fromEngine:!0,event:"viewport",x:t.x*e+cc.view._viewportRect.x,y:t.y*n+cc.view._viewportRect.y,width:t.width*e,height:t.height*n})}},_registerNodeEvent:function(){this.node.on("position-changed",this.updateSubContextViewport,this),this.node.on("scale-changed",this.updateSubContextViewport,this),this.node.on("size-changed",this.updateSubContextViewport,this)},_unregisterNodeEvent:function(){this.node.off("position-changed",this.updateSubContextViewport,this),this.node.off("scale-changed",this.updateSubContextViewport,this),this.node.off("size-changed",this.updateSubContextViewport,this)},_runSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!0})},_stopSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!1})},_updateSubContextFrameRate:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"frameRate",value:this._fps})}}):cc.Class({name:"cc.WXSubContextView",extends:r}),cc.WXSubContextView=e.exports=i},{"./CCComponent":38}],52:[function(t,e,n){"use strict";t("./CCComponent"),t("./CCComponentEventHandler"),t("./missing-script");var i=[t("./CCSprite"),t("./CCCanvas"),t("./CCAnimation"),t("./CCLabel"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCLabelOutline"),t("./CCLabelShadow"),t("./CCBlockInputEvents"),t("./CCMotionStreak"),t("./WXSubContextView"),t("./SwanSubContextView")];e.exports=i},{"./CCAnimation":35,"./CCBlockInputEvents":36,"./CCCanvas":37,"./CCComponent":38,"./CCComponentEventHandler":39,"./CCLabel":40,"./CCLabelOutline":41,"./CCLabelShadow":42,"./CCMask":43,"./CCMotionStreak":44,"./CCScrollBar":46,"./CCScrollView":47,"./CCSprite":48,"./SwanSubContextView":50,"./WXSubContextView":51,"./missing-script":53}],53:[function(t,e,n){"use strict";var i=cc.js,r=t("../utils/misc").BUILTIN_CLASSID_RE,a=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),s=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},statics:{safeFindClass:function(t,e){return i._getClassById(t)||(t?(cc.deserialize.reportMissingClass(t),s.getMissingWrapper(t,e)):null)},getMissingWrapper:function(t,e){return e.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||r.test(t))?s:a}},onLoad:function(){}});cc._MissingScript=e.exports=s},{"../utils/misc":163}],54:[function(t,e,n){"use strict";var i=cc.js;function r(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0}t("../event/event"),i.extend(r,cc.Event);var a=r.prototype;function s(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null}function o(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t}function c(t,e,n){cc.Event.call(this,cc.Event.KEYBOARD,n),this.keyCode=t,this.isPressed=e}a.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},a.getScrollX=function(){return this._scrollX},a.getScrollY=function(){return this._scrollY},a.setLocation=function(t,e){this._x=t,this._y=e},a.getLocation=function(){return cc.v2(this._x,this._y)},a.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y)},a._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e},a.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY)},a.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY)},a.getDeltaX=function(){return this._x-this._prevX},a.getDeltaY=function(){return this._y-this._prevY},a.setButton=function(t){this._button=t},a.getButton=function(){return this._button},a.getLocationX=function(){return this._x},a.getLocationY=function(){return this._y},r.NONE=0,r.DOWN=1,r.UP=2,r.MOVE=3,r.SCROLL=4,r.BUTTON_LEFT=0,r.BUTTON_RIGHT=2,r.BUTTON_MIDDLE=1,r.BUTTON_4=3,r.BUTTON_5=4,r.BUTTON_6=5,r.BUTTON_7=6,r.BUTTON_8=7,i.extend(s,cc.Event),(a=s.prototype).getEventCode=function(){return this._eventCode},a.getTouches=function(){return this._touches},a._setEventCode=function(t){this._eventCode=t},a._setTouches=function(t){this._touches=t},a.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},a.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},a.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},a.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},a.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},a.getID=function(){return this.touch?this.touch.getID():null},a.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},a.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},a.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},a.getLocationX=function(){return this.touch?this.touch.getLocationX():0},a.getLocationY=function(){return this.touch?this.touch.getLocationY():0},s.MAX_TOUCHES=5,s.BEGAN=0,s.MOVED=1,s.ENDED=2,s.CANCELED=3,i.extend(o,cc.Event),i.extend(c,cc.Event),cc.Event.EventMouse=r,cc.Event.EventTouch=s,cc.Event.EventAcceleration=o,cc.Event.EventKeyboard=c,e.exports=cc.Event},{"../event/event":61}],55:[function(t,e,n){"use strict";var i=t("../platform/js");function r(t,e){this._onCustomEvent=e,cc.EventListener.call(this,cc.EventListener.CUSTOM,t,this._callback)}cc.EventListener=function(t,e,n){this._onEvent=n,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}},cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8;var a=cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};function s(){cc.EventListener.call(this,cc.EventListener.MOUSE,a.MOUSE,this._callback)}function o(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,a.TOUCH_ONE_BY_ONE,null),this._claimedTouches=[]}function c(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,a.TOUCH_ALL_AT_ONCE,null)}function u(t){this._onAccelerationEvent=t,cc.EventListener.call(this,cc.EventListener.ACCELERATION,a.ACCELERATION,this._callback)}function l(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,a.KEYBOARD,this._callback)}i.extend(r,cc.EventListener),i.mixin(r.prototype,{_onCustomEvent:null,_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new r(this._listenerID,this._onCustomEvent)}}),i.extend(s,cc.EventListener),i.mixin(s.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new s;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),i.extend(o,cc.EventListener),i.mixin(o.prototype,{constructor:o,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new o;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan}}),i.extend(c,cc.EventListener),i.mixin(c.prototype,{constructor:c,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var t=new c;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled}}),i.extend(u,cc.EventListener),i.mixin(u.prototype,{constructor:u,_onAccelerationEvent:null,_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return!0},clone:function(){return new u(this._onAccelerationEvent)}}),i.extend(l,cc.EventListener),i.mixin(l.prototype,{constructor:l,onKeyPressed:null,onKeyReleased:null,_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new l;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased}}),cc.EventListener.create=function(t){var e=t.event;delete t.event;var n=null;for(var i in e===cc.EventListener.TOUCH_ONE_BY_ONE?n=new o:e===cc.EventListener.TOUCH_ALL_AT_ONCE?n=new c:e===cc.EventListener.MOUSE?n=new s:e===cc.EventListener.CUSTOM?(n=new r(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?n=new l:e===cc.EventListener.ACCELERATION&&(n=new u(t.callback),delete t.callback),t)n[i]=t[i];return n},e.exports=cc.EventListener},{"../platform/js":101}],56:[function(t,e,n){"use strict";function r(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0}function i(t){var e=cc.Event,n=t.type;return n===e.ACCELERATION?l.ACCELERATION:n===e.KEYBOARD?l.KEYBOARD:n.startsWith(e.MOUSE)?l.MOUSE:(n.startsWith(e.TOUCH),"")}t("../platform/js"),t("./CCEventListener");var l=cc.EventListener.ListenerID,c={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:(r.prototype={constructor:r,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}},!1),_renderOrderMap:{},_internalCustomListenerIDs:[],_setDirtyForNode:function(t){var e=this._nodeListenersMap[t._id];if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=e[n]._getListenerID();null==this._dirtyListeners[r]&&(this._dirtyListeners[r]=!0)}if(t.getChildren){var a=t.getChildren(),s=0;for(i=a?a.length:0;s<i;s++)this._setDirtyForNode(a[s])}},pauseTarget:function(t,e){if(t instanceof cc._BaseNode){var n,i,r=this._nodeListenersMap[t._id];if(r)for(n=0,i=r.length;n<i;n++)r[n]._setPaused(!0);if(!0===e){var a=t.getChildren();for(n=0,i=a?a.length:0;n<i;n++)this.pauseTarget(a[n],!0)}}},resumeTarget:function(t,e){if(t instanceof cc._BaseNode){var n,i,r=this._nodeListenersMap[t._id];if(r)for(n=0,i=r.length;n<i;n++)r[n]._setPaused(!1);if(this._setDirtyForNode(t),!0===e&&t.getChildren){var a=t.getChildren();for(n=0,i=a?a.length:0;n<i;n++)this.resumeTarget(a[n],!0)}}},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),n=this._listenersMap[e];if(n||(n=new r,this._listenersMap[e]=n),n.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var i=t._getSceneGraphPriority();this._associateNodeAndEventListener(i,t),i.activeInHierarchy&&this.resumeTarget(i)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){var t=this._dirtyListeners;for(var e in t)this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={}},_removeAllListenersInVector:function(t){if(t)for(var e,n=t.length-1;0<=n;n--)(e=t[n])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(t,n)},_removeListenersForListenerID:function(t){var e,n=this._listenersMap[t];if(n){var i=n.getFixedPriorityListeners(),r=n.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(i),delete this._priorityDirtyFlagMap[t],this._inDispatch||(n.clear(),delete this._listenersMap[t])}var a,s=this._toAddedListeners;for(e=s.length-1;0<=e;e--)(a=s[e])&&a._getListenerID()===t&&cc.js.array.removeAt(s,e)},_sortEventListeners:function(t){var e=this.DIRTY_NONE,n=this._priorityDirtyFlagMap;if(n[t]&&(e=n[t]),e!==this.DIRTY_NONE&&(n[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var i=cc.director.getScene();i&&this._sortListenersOfSceneGraphPriority(t,i)}},_sortListenersOfSceneGraphPriority:function(t){var e=this._getListeners(t);if(e){var n=e.getSceneGraphPriorityListeners();n&&0!==n.length&&e.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var n=c._renderOrderMap,i=t._getSceneGraphPriority(),r=e._getSceneGraphPriority(),a=n[i._id],s=n[r._id];return e&&r&&s?t&&i&&a?s-a:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var n=e.getFixedPriorityListeners();if(n&&0!==n.length){n.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,r=n.length;i<r&&!(0<=n[i]._getFixedPriority());)++i;e.gt0Index=i}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,n,i,r=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),s=this._toRemovedListeners;if(a)for(e=a.length-1;0<=e;e--)(n=a[e])._isRegistered()||(cc.js.array.removeAt(a,e),-1!==(i=s.indexOf(n))&&s.splice(i,1));if(r)for(e=r.length-1;0<=e;e--)(n=r[e])._isRegistered()||(cc.js.array.removeAt(r,e),-1!==(i=s.indexOf(n))&&s.splice(i,1));a&&0===a.length&&t.clearSceneGraphListeners(),r&&0===r.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var n in t)t[n].empty()&&(delete e[n],delete t[n]);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,a=i.length;r<a;r++)this._forceAddEventListener(i[r]);i.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(){if(!(1<this._inDispatch)){var t;(t=this._listenersMap[l.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(t),(t=this._listenersMap[l.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(t);var e=this._toAddedListeners;if(0!==e.length){for(var n=0,i=e.length;n<i;n++)this._forceAddEventListener(e[n]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var n=t[e],i=this._listenersMap[n._getListenerID()];if(i){var r,a=i.getFixedPriorityListeners(),s=i.getSceneGraphPriorityListeners();s&&-1!==(r=s.indexOf(n))&&s.splice(r,1),a&&-1!==(r=a.indexOf(n))&&a.splice(r,1)}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered())return!1;var n=e.event,i=n.currentTouch;n.currentTarget=t._node;var r,a=!1,s=n.getEventCode(),o=cc.Event.EventTouch;return s===o.BEGAN?t.onTouchBegan&&(a=t.onTouchBegan(i,n))&&t._registered&&t._claimedTouches.push(i):0<t._claimedTouches.length&&-1!==(r=t._claimedTouches.indexOf(i))&&(a=!0,s===o.MOVED&&t.onTouchMoved?t.onTouchMoved(i,n):s===o.ENDED?(t.onTouchEnded&&t.onTouchEnded(i,n),t._registered&&t._claimedTouches.splice(r,1)):s===o.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(i,n),t._registered&&t._claimedTouches.splice(r,1))),n.isStopped()?(c._updateTouchListeners(n),!0):!(!a||!t.swallowTouches||(e.needsMutableSet&&e.touches.splice(i,1),0))},_dispatchTouchEvent:function(t){b8e.captureEventEnabled&&b8e.captureEvent(t),this._sortEventListeners(l.TOUCH_ONE_BY_ONE),this._sortEventListeners(l.TOUCH_ALL_AT_ONCE);var e=this._getListeners(l.TOUCH_ONE_BY_ONE),n=this._getListeners(l.TOUCH_ALL_AT_ONCE);if(null!==e||null!==n){var i=t.getTouches(),r=cc.js.array.copy(i),a={event:t,needsMutableSet:e&&n,touches:r,selTouch:null};if(e)for(var s=0;s<i.length;s++)t.currentTouch=i[s],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,a);n&&0<r.length&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var n=cc.Event.EventTouch,i=e.event,r=e.touches,a=i.getEventCode();return i.currentTarget=t._node,a===n.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,i):a===n.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,i):a===n.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,i):a===n.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,i),!!i.isStopped()&&(c._updateTouchListeners(i),!0)},_associateNodeAndEventListener:function(t,e){var n=this._nodeListenersMap[t._id];n||(n=[],this._nodeListenersMap[t._id]=n),n.push(e)},_dissociateNodeAndEventListener:function(t,e){var n=this._nodeListenersMap[t._id];n&&(cc.js.array.remove(n,e),0===n.length&&delete this._nodeListenersMap[t._id],delete this._renderOrderMap[t._id])},_dispatchEventToListeners:function(t,e,n){var i,r,a=!1,s=t.getFixedPriorityListeners(),o=t.getSceneGraphPriorityListeners(),c=0;if(s&&0!==s.length)for(;c<t.gt0Index;++c)if((r=s[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,n)){a=!0;break}if(o&&!a)for(i=0;i<o.length;i++)if((r=o[i]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,n)){a=!0;break}if(s&&!a)for(;c<s.length;++c)if((r=s[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,n)){a=!0;break}},_setDirty:function(t,e){var n=this._priorityDirtyFlagMap;null==n[t]?n[t]=e:n[t]=e|n[t]},_sortNumberAsc:function(t,e){return t-e},_updateRenderOrder:function(t,e){void 0!==this._nodeListenersMap[t._id]&&(this._renderOrderMap[t._id]=e)},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.js.isNumber(e)||e instanceof cc._BaseNode){if(t instanceof cc.EventListener){if(t._isRegistered())return}else t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return;t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}},addCustomListener:function(t,e){var n=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(n,1),n},removeListener:function(t){if(null!=t){var e,n=this._listenersMap;for(var i in n){var r=n[i],a=r.getFixedPriorityListeners(),s=r.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(s,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(a,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete n[i]),e)break}if(!e)for(var o=this._toAddedListeners,c=o.length-1;0<=c;c--){var u=o[c];if(u===t){cc.js.array.removeAt(o,c),u._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var n=t.length-1;0<=n;n--){var i=t[n];if(i._onCustomEvent===e||i._onEvent===e)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,n):this._toRemovedListeners.push(i),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var n=t.length-1;0<=n;n--){var i=t[n];if(i===e)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,n):this._toRemovedListeners.push(i),!0}return!1},removeListeners:function(t,e){var n=this;if(cc.js.isNumber(t)||t instanceof cc._BaseNode)if(void 0!==t._id){var i,r=n._nodeListenersMap[t._id];if(r){var a=cc.js.array.copy(r);for(i=0;i<a.length;i++)n.removeListener(a[i]);delete n._nodeListenersMap[t._id],delete n._renderOrderMap[t._id]}var s=n._toAddedListeners;for(i=0;i<s.length;){var o=s[i];o._getSceneGraphPriority()===t?(o._setSceneGraphPriority(null),o._setRegistered(!1),s.splice(i,1)):++i}if(!0===e){var c,u=t.getChildren();for(i=0,c=u.length;i<c;i++)n.removeListeners(u[i],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?n._removeListenersForListenerID(l.TOUCH_ONE_BY_ONE):t===cc.EventListener.TOUCH_ALL_AT_ONCE?n._removeListenersForListenerID(l.TOUCH_ALL_AT_ONCE):t===cc.EventListener.MOUSE?n._removeListenersForListenerID(l.MOUSE):t===cc.EventListener.ACCELERATION?n._removeListenersForListenerID(l.ACCELERATION):t===cc.EventListener.KEYBOARD&&n._removeListenersForListenerID(l.KEYBOARD)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var n in t)-1===e.indexOf(n)&&this._removeListenersForListenerID(n)},setPriority:function(t,e){if(null!=t){var n=this._listenersMap;for(var i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(t))return t._getSceneGraphPriority(),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled&&(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType)){if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=i(t);this._sortEventListeners(e);var n=this._listenersMap[e];null!=n&&(this._dispatchEventToListeners(n,this._onListenerCallback,t),this._onUpdateListeners(n)),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var n=new cc.Event.EventCustom(t);n.setUserData(e),this.dispatchEvent(n)}};cc.eventManager=c,e.exports=c},{"../platform/js":101,"./CCEventListener":55}],57:[function(t,e,n){"use strict";cc.Touch=function(t,e,n){this._lastModified=0,this.setTouchInfo(n,t,e)},cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y)},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y)},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y)},getDelta:function(){return this._point.sub(this._prevPoint)},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y)},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y)},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y)},getID:function(){return this._id},setTouchInfo:function(t,e,n){this._prevPoint=this._point,this._point=cc.v2(e||0,n||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.v2(t.x,t.y):cc.v2(t||0,e||0)}}},{}],58:[function(t,e,n){"use strict";t("./CCEvent"),t("./CCTouch"),t("./CCEventListener");var i=t("./CCEventManager");e.exports=i},{"./CCEvent":54,"./CCEventListener":55,"./CCEventManager":56,"./CCTouch":57}],59:[function(t,e,n){"use strict";var i=cc.js,r=t("../platform/callbacks-invoker").CallbacksHandler;function a(){r.call(this)}i.extend(a,r),a.prototype.invoke=function(t,e){var n=t.type,i=this._callbackTable[n];if(i){var r=!i.isInvoking;i.isInvoking=!0;for(var a=i.callbacks,s=i.targets,o=0,c=a.length;o<c;++o){var u=a[o];if(u){var l=s[o]||t.currentTarget;if(u.call(l,t,e),t._propagationImmediateStopped)break}}r&&(i.isInvoking=!1,i.containCanceled&&i.purgeCanceled())}},e.exports=a},{"../platform/callbacks-invoker":94}],60:[function(t,e,n){"use strict";var i=t("../platform/js"),r=t("../platform/callbacks-invoker"),a=i.array.fastRemove;function s(){r.call(this)}i.extend(s,r);var o=s.prototype;o.on=function(t,e,n){if(e)return this.hasEventListener(t,e,n)||(this.add(t,e,n),n&&n.__eventTargets&&n.__eventTargets.push(this)),e},o.off=function(t,e,n){e?(this.remove(t,e,n),n&&n.__eventTargets&&a(n.__eventTargets,this)):this.removeAll(t)},o.targetOff=o.removeAll,o.once=function(s,o,c){var u="__ONCE_FLAG:"+s;if(!this.hasEventListener(u,o,c)){var l=this;this.on(s,function t(e,n,i,r,a){l.off(s,t,c),l.remove(u,o,c),o.call(this,e,n,i,r,a)},c),this.add(u,o,c)}},o.emit=r.prototype.invoke,o.dispatchEvent=function(t){this.invoke(t.type,t)},cc.EventTarget=e.exports=s},{"../platform/callbacks-invoker":94,"../platform/js":101}],61:[function(t,e,n){"use strict";var i=t("../platform/js");function r(t,e){cc.Event.call(this,t,e),this.detail=null}cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3,i.extend(r,cc.Event),(r.prototype.reset=r).prototype.setUserData=function(t){this.detail=t},r.prototype.getUserData=function(){return this.detail},r.prototype.getEventName=cc.Event.prototype.getType;var a=new i.Pool(10);r.put=function(t){a.put(t)},r.get=function(t,e){var n=a._get();return n?n.reset(t,e):n=new r(t,e),n},cc.Event.EventCustom=r,e.exports=cc.Event},{"../platform/js":101}],62:[function(t,e,n){"use strict";t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event")},{"./event":61,"./event-listeners":59,"./event-target":60,"./system-event":63}],63:[function(t,e,n){"use strict";var i=t("../event/event-target"),a=t("../event-manager"),r=t("../platform/CCInputManager"),s=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),o=null,c=null,u=cc.Class({name:"SystemEvent",extends:i,statics:{EventType:s},setAccelerometerEnabled:function(t){r.setAccelerometerEnabled(t)},setAccelerometerInterval:function(t){r.setAccelerometerInterval(t)},on:function(t,e,n){this._super(t,e,n),t!==s.KEY_DOWN&&t!==s.KEY_UP||(o=o||cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=s.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=s.KEY_UP,cc.systemEvent.dispatchEvent(e)}}),a.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||a.addListener(o,1)),t===s.DEVICEMOTION&&(c=c||cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=s.DEVICEMOTION,cc.systemEvent.dispatchEvent(e)}}),a.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||a.addListener(c,1))},off:function(t,e,n){if(this._super(t,e,n),o&&(t===s.KEY_DOWN||t===s.KEY_UP)){var i=this.hasEventListener(s.KEY_DOWN),r=this.hasEventListener(s.KEY_UP);i||r||a.removeListener(o)}c&&t===s.DEVICEMOTION&&a.removeListener(c)}});cc.SystemEvent=e.exports=u,cc.systemEvent=new cc.SystemEvent},{"../event-manager":58,"../event/event-target":60,"../platform/CCInputManager":85}],64:[function(t,e,n){"use strict";function a(t,e,n){c.m00=Math.abs(n.m00),c.m01=Math.abs(n.m01),c.m02=Math.abs(n.m02),c.m03=Math.abs(n.m04),c.m04=Math.abs(n.m05),c.m05=Math.abs(n.m06),c.m06=Math.abs(n.m08),c.m07=Math.abs(n.m09),c.m08=Math.abs(n.m10),o.transformMat3(t,e,c)}var o=cc.vmath.vec3,i=cc.vmath.mat3,r=o.create(),s=o.create(),c=i.create();function u(t,e,n,i,r,a){this.center=o.create(t,e,n),this.halfExtents=o.create(i,r,a)}var l=u.prototype;l.getBoundary=function(t,e){o.sub(t,this.center,this.halfExtents),o.add(e,this.center,this.halfExtents)},l.transform=function(t,e,n,i,r){r=r||this,o.transformMat4(r.center,this.center,t),a(r.halfExtents,this.halfExtents,t)},u.create=function(t,e,n,i,r,a){return new u(t,e,n,i,r,a)},u.clone=function(t){return new u(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},u.copy=function(t,e){return o.copy(t.center,e.center),o.copy(t.halfExtents,e.halfExtents),t},u.fromPoints=function(t,e,n){return o.scale(t.center,o.add(r,e,n),.5),o.scale(t.halfExtents,o.sub(s,n,e),.5),t},u.set=function(t,e,n,i,r,a,s){return o.set(t.center,e,n,i),o.set(t.halfExtents,r,a,s),t},e.exports=u},{}],65:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),cc.geomUtils={Triangle:t("./triangle"),Aabb:t("./aabb"),Ray:t("./ray"),intersect:t("./intersect")},n.default=cc.geomUtils},{"./aabb":64,"./intersect":66,"./ray":67,"./triangle":68}],66:[function(t,e,n){"use strict";var i=function(t){return t&&t.__esModule?t:{default:t}}(t("../../renderer/memop/recycle-pool")),g=t("./aabb"),r=t("./ray"),s=t("./triangle"),x=cc.vmath.mat4,b=cc.vmath.vec3,E={};E.rayAabb=function(){var m=b.create(),p=b.create();return function(t,e){var n=t.o,i=t.d,r=1/i.x,a=1/i.y,s=1/i.z;b.sub(m,e.center,e.halfExtents),b.add(p,e.center,e.halfExtents);var o=(m.x-n.x)*r,c=(p.x-n.x)*r,u=(m.y-n.y)*a,l=(p.y-n.y)*a,h=(m.z-n.z)*s,f=(p.z-n.z)*s,d=Math.max(Math.max(Math.min(o,c),Math.min(u,l)),Math.min(h,f)),_=Math.min(Math.min(Math.max(o,c),Math.max(u,l)),Math.max(h,f));return _<0||_<d?0:d}}(),E.rayTriangle=function(){var s=b.create(0,0,0),o=b.create(0,0,0),c=b.create(0,0,0),u=b.create(0,0,0),l=b.create(0,0,0);return function(t,e){b.sub(s,e.b,e.a),b.sub(o,e.c,e.a),b.cross(c,t.d,o);var n=b.dot(s,c);if(n<=0)return 0;b.sub(u,t.o,e.a);var i=b.dot(u,c);if(i<0||n<i)return 0;b.cross(l,u,s);var r=b.dot(t.d,l);if(r<0||n<i+r)return 0;var a=b.dot(o,l)/n;return a<0?0:a}}(),E.rayMesh=function(){var _=s.create(),m=1/0,p={5120:"getInt8",5121:"getUint8",5122:"getInt16",5123:"getUint16",5124:"getInt32",5125:"getUint32",5126:"getFloat32"},a=function(){var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();function v(t,e,n,i,r){b.set(t,e[n](r,a),e[n](r+=i,a),e[n](r+=i,a))}return function(t,e){m=1/0;for(var n=e._subMeshes,i=0;i<n.length;i++)if(n[i]._primitiveType===b8e.GFXEnums.PT_TRIANGLES)for(var r=e._vbs[i]||e._vbs[0],a=r.data,s=new DataView(a.buffer,a.byteOffset,a.byteLength),o=e._ibs[i].data,c=r.buffer._format.element(b8e.GFXEnums.ATTR_POSITION),u=c.offset,l=c.stride,h=p[c.type],f=0;f<o.length;f+=3){v(_.a,s,h,4,o[f]*l+u),v(_.b,s,h,4,o[f+1]*l+u),v(_.c,s,h,4,o[f+2]*l+u);var d=E.rayTriangle(t,_);0<d&&d<m&&(m=d)}return m}}(),E.raycast=function(){function o(t,e){for(var n=t.children,i=n.length-1;0<=i;i--)o(n[i],e);e(t)}function e(t,e){return t.distance-e.distance}function c(t,e,n){var i=e.x,r=e.y,a=e.z,s=n.m03*i+n.m07*r+n.m11*a;return s=s?1/s:1,t.x=(n.m00*i+n.m04*r+n.m08*a)*s,t.y=(n.m01*i+n.m05*r+n.m09*a)*s,t.z=(n.m02*i+n.m06*r+n.m10*a)*s,t}var u=new i.default(function(){return{distance:0,node:null}},1),l=[],h=g.create(),f=b.create(),d=b.create(),_=r.create(),m=x.create(),p=x.create(),v=b.create();function y(t){return 0<t&&t<1/0}return function(t,r,a,s){return u.reset(),l.length=0,o(t=t||cc.director.getScene(),function(t){if(!s||s(t)){x.invert(p,t.getWorldMatrix(m)),b.transformMat4(_.o,r.o,p),b.normalize(_.d,c(_.d,r.d,p));var e=1/0,n=t._renderComponent;if(n&&n._boundingBox?e=E.rayAabb(_,n._boundingBox):t.width&&t.height&&(b.set(f,-t.width*t.anchorX,-t.height*t.anchorY,t.z),b.set(d,t.width*(1-t.anchorX),t.height*(1-t.anchorY),t.z),g.fromPoints(h,f,d),e=E.rayAabb(_,h)),y(e)&&(a&&(e=a(_,t,e)),y(e))){b.set(v,e,0,0),c(v,v,m);var i=u.add();i.node=t,i.distance=cc.vmath.vec3.mag(v),l.push(i)}}}),l.sort(e),l}}(),e.exports=E},{"../../renderer/memop/recycle-pool":199,"./aabb":64,"./ray":67,"./triangle":68}],67:[function(t,e,n){"use strict";var s=cc.vmath.vec3;function o(t,e,n,i,r,a){this.o=s.create(t,e,n),this.d=s.create(i,r,a)}o.create=function(t,e,n,i,r,a){return new o(t,e,n,i,r,a)},o.clone=function(t){return new o(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},o.copy=function(t,e){return t.o.x=e.o.x,t.o.y=e.o.y,t.o.z=e.o.z,t.d.x=e.d.x,t.d.y=e.d.y,t.d.z=e.d.z,t},o.set=function(t,e,n,i,r,a,s){return t.o.x=e,t.o.y=n,t.o.z=i,t.d.x=r,t.d.y=a,t.d.z=s,t},o.fromPoints=function(t,e,n){return s.copy(t.o,e),s.normalize(t.d,s.sub(t.d,n,e)),t},e.exports=o},{}],68:[function(t,e,n){"use strict";var u=cc.vmath.vec3;function l(t,e,n,i,r,a,s,o,c){this.a=u.create(t,e,n),this.b=u.create(i,r,a),this.c=u.create(s,o,c)}l.create=function(t,e,n,i,r,a,s,o,c){return new l(t,e,n,i,r,a,s,o,c)},l.clone=function(t){return new l(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},l.copy=function(t,e){return u.copy(t.a,e.a),u.copy(t.b,e.b),u.copy(t.c,e.c),t},l.fromPoints=function(t,e,n,i){return u.copy(t.a,e),u.copy(t.b,n),u.copy(t.c,i),t},l.set=function(t,e,n,i,r,a,s,o,c,u){return t.a.x=e,t.a.y=n,t.a.z=i,t.b.x=r,t.b.y=a,t.b.z=s,t.c.x=o,t.c.y=c,t.c.z=u,t},e.exports=l},{}],69:[function(t,e,n){"use strict";var i=t("../components/CCRenderComponent"),r=t("./types"),a=r.LineCap,s=r.LineJoin,o=cc.Class({name:"cc.Graphics",extends:i,ctor:function(){this._impl=o._assembler.createImpl(this)},properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:s.MITER,_lineCap:a.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._impl.lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this._impl.lineJoin=t},type:s},lineCap:{get:function(){return this._lineCap},set:function(t){this._lineCap=t,this._impl.lineCap=t},type:a},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._impl.strokeColor=this._strokeColor=cc.color(t)}},fillColor:{get:function(){return this._fillColor},set:function(t){this._impl.fillColor=this._fillColor=cc.color(t)}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._miterLimit=t,this._impl.miterLimit=t}}},statics:{LineJoin:s,LineCap:a},onRestore:function(){this._impl||(this._impl=o._assembler.createImpl())},onEnable:function(){this._super(),this._activateMaterial()},onDestroy:function(){this._super(),this._impl.clear(this,!0),this._impl=null},_activateMaterial:function(){this.node._renderFlag&=~b8e.RenderFlow.FLAG_RENDER,this.node._renderFlag|=b8e.RenderFlow.FLAG_CUSTOM_IA_RENDER;var t=this.sharedMaterials[0];t||(t=this.sharedMaterials[0]=b8e.GraphicsMaterial.get(),this.setMaterial(0,t)),this.markForUpdateRenderData(!0)},moveTo:function(t,e){this._impl.moveTo(t,e)},lineTo:function(t,e){this._impl.lineTo(t,e)},bezierCurveTo:function(t,e,n,i,r,a){this._impl.bezierCurveTo(t,e,n,i,r,a)},quadraticCurveTo:function(t,e,n,i){this._impl.quadraticCurveTo(t,e,n,i)},arc:function(t,e,n,i,r,a){this._impl.arc(t,e,n,i,r,a)},ellipse:function(t,e,n,i){this._impl.ellipse(t,e,n,i)},circle:function(t,e,n){this._impl.circle(t,e,n)},rect:function(t,e,n,i){this._impl.rect(t,e,n,i)},roundRect:function(t,e,n,i,r){this._impl.roundRect(t,e,n,i,r)},fillRect:function(t,e,n,i){this.rect(t,e,n,i),this.fill()},clear:function(t){this._impl.clear(this,t)},close:function(){this._impl.close()},stroke:function(){o._assembler.stroke(this)},fill:function(){o._assembler.fill(this)}});cc.Graphics=e.exports=o},{"../components/CCRenderComponent":45,"./types":72}],70:[function(t,e,n){"use strict";var A=t("./types").PointFlags,C=Math.PI,w=Math.min,S=Math.max,T=Math.cos,M=Math.sin,O=Math.abs,c=Math.sign,u=.5522847493;e.exports={arc:function(t,e,n,i,r,a,s){var o,c,u,l=0,h=0,f=0,d=0,_=0,m=0,p=0,v=0,y=0,g=0,x=0,b=0,E=0;if(h=a-r,s=s||!1)if(O(h)>=2*C)h=2*C;else for(;h<0;)h+=2*C;else if(O(h)>=2*C)h=2*-C;else for(;0<h;)h-=2*C;for(u=0|S(1,w(O(h)/(.5*C)+.5,5)),f=O(4/3*(1-T(o=h/u/2))/M(o)),s||(f=-f),c=0;c<=u;c++)m=e+(d=T(l=r+h*(c/u)))*i,p=n+(_=M(l))*i,v=-_*i*f,y=d*i*f,0===c?t.moveTo(m,p):t.bezierCurveTo(g+b,x+E,m-v,p-y,m,p),g=m,x=p,b=v,E=y},ellipse:function(t,e,n,i,r){t.moveTo(e-i,n),t.bezierCurveTo(e-i,n+r*u,e-i*u,n+r,e,n+r),t.bezierCurveTo(e+i*u,n+r,e+i,n+r*u,e+i,n),t.bezierCurveTo(e+i,n-r*u,e+i*u,n-r,e,n-r),t.bezierCurveTo(e-i*u,n-r,e-i,n-r*u,e-i,n),t.close()},roundRect:function(t,e,n,i,r,a){if(a<.1)t.rect(e,n,i,r);else{var s=w(a,.5*O(i))*c(i),o=w(a,.5*O(r))*c(r);t.moveTo(e,n+o),t.lineTo(e,n+r-o),t.bezierCurveTo(e,n+r-o*(1-u),e+s*(1-u),n+r,e+s,n+r),t.lineTo(e+i-s,n+r),t.bezierCurveTo(e+i-s*(1-u),n+r,e+i,n+r-o*(1-u),e+i,n+r-o),t.lineTo(e+i,n+o),t.bezierCurveTo(e+i,n+o*(1-u),e+i-s*(1-u),n,e+i-s,n),t.lineTo(e+s,n),t.bezierCurveTo(e+s*(1-u),n,e,n+o*(1-u),e,n+o),t.close()}},tesselateBezier:function t(e,n,i,r,a,s,o,c,u,l,h){var f,d,_,m,p,v,y,g,x,b,E,C,w,S,T,M;10<l||(p=.5*(s+c),v=.5*(o+u),y=.5*((f=.5*(n+r))+(_=.5*(r+s))),g=.5*((d=.5*(i+a))+(m=.5*(a+o))),((T=O((r-c)*(S=u-i)-(a-u)*(w=c-n)))+(M=O((s-c)*S-(o-u)*w)))*(T+M)<e._tessTol*(w*w+S*S)?e._addPoint(c,u,0===h?h|A.PT_BEVEL:h):(t(e,n,i,f,d,y,g,E=.5*(y+(x=.5*(_+p))),C=.5*(g+(b=.5*(m+v))),l+1,0),t(e,E,C,x,b,p,v,c,u,l+1,h)))}}},{"./types":72}],71:[function(t,e,n){"use strict";t("./graphics")},{"./graphics":69}],72:[function(t,e,n){"use strict";var i=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2}),a=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});e.exports={LineCap:i,LineJoin:r,PointFlags:a}},{}],73:[function(t,e,n){"use strict";t("./platform"),t("./assets"),t("./CCNode"),t("./CCPrivateNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./camera/CCCamera"),t("./geom-utils"),t("./mesh"),t("./3d/polyfill-3d")},{"./3d/polyfill-3d":10,"./CCNode":13,"./CCPrivateNode":14,"./CCScene":15,"./assets":31,"./camera/CCCamera":33,"./components":52,"./geom-utils":65,"./graphics":71,"./mesh":76,"./platform":98}],74:[function(t,e,n){"use strict";var i=t("./mesh-data"),r=t("../event/event-target");function b(t,e,n){t[e]=n._val}function E(t,e,n){t[e]=n.x,t[e+1]=n.y}function C(t,e,n){t[e]=n.x,t[e+1]=n.y,t[e+2]=n.z}var a=cc.Class({name:"cc.Mesh",extends:cc.Asset,mixins:[r],properties:{_nativeAsset:{override:!0,get:function(){return this._buffer},set:function(t){this._buffer=ArrayBuffer.isView(t)?t.buffer:t}},_vertexBundles:{default:null,type:i.VertexBundle},_primitives:{default:null,Primitive:i.Primitive},_minPos:cc.v3(),_maxPos:cc.v3(),subMeshes:{get:function(){return this._subMeshes},set:function(t){this._subMeshes=t}}},ctor:function(){this._subMeshes=[],this._ibs=[],this._vbs=[]},onLoad:function(){this._subMeshes.length=0;for(var t=this._primitives,e=0;e<t.length;e++){var n=t[e],i=n.data,r=new Uint16Array(this._buffer,i.offset,i.length/2),a=new b8e.GFXIndexBuffer(b8e.renderer.device,n.indexUnit,b8e.GFXEnums.USAGE_STATIC,r,r.length),s=this._vertexBundles[n.vertexBundleIndices[0]],o=s.data,c=new b8e.GFXVertexFormat(s.formats),u=new Uint8Array(this._buffer,o.offset,o.length),l=new b8e.GFXVertexBuffer(b8e.renderer.device,c,b8e.GFXEnums.USAGE_STATIC,u,s.verticesCount);this._subMeshes.push(new b8e.InputAssembler(l,a)),this._ibs.push({buffer:a,data:r}),this._vbs.push({buffer:l,data:u})}},init:function(t,e,n){this.clear();var i=new Uint8Array(t._bytes*e),r=new b8e.GFXVertexBuffer(b8e.renderer.device,t,n?b8e.GFXEnums.USAGE_DYNAMIC:b8e.GFXEnums.USAGE_STATIC,i,e);this._vbs[0]={buffer:r,data:i,dirty:!0},this.emit("init-format")},setVertices:function(t,e,n){n=n||0;var i=this._vbs[n],r=i.buffer._format._attr2el[t];if(!r)return b8e.warn("Cannot find "+t+" attribute in vertex defines.");var a="number"==typeof e[0],s=r.num,o=Float32Array,c=4;t===b8e.GFXEnums.ATTR_COLOR&&(a?(o=Float32Array,c=1):o=Uint32Array);var u=i[o.name];if(!u){var l=i.data;u=i[o.name]=new o(l.buffer,l.byteOffset,l.byteLength/c)}var h=r.stride/c,f=r.offset/c;if(a)for(var d=0,_=e.length/s;d<_;d++)for(var m=d*s,p=d*h+f,v=0;v<s;v++)u[p+v]=e[m+v];else{var y=void 0;y=t===b8e.GFXEnums.ATTR_COLOR?b:2===s?E:C;for(var g=0,x=e.length;g<x;g++)y(u,g*h+f,e[g])}i.dirty=!0},setIndices:function(t,e,n){e=e||0;var i=new Uint16Array(t),r=n?b8e.GFXEnums.USAGE_DYNAMIC:b8e.GFXEnums.USAGE_STATIC,a=this._ibs[e];if(a)a.buffer._usage=r,a.data=i,a.dirty=!0;else{var s=new b8e.GFXIndexBuffer(b8e.renderer.device,b8e.GFXEnums.INDEX_FMT_UINT16,r,i,i.length);this._ibs[e]={buffer:s,data:i,dirty:!1};var o=this._vbs[0];this._subMeshes[e]=new b8e.InputAssembler(o.buffer,s)}},setPrimitiveType:function(t,e){e=e||0,this._subMeshes[e]?this._subMeshes[e]._primitiveType=t:b8e.warn("Do not have sub mesh at index "+e)},clear:function(){this._subMeshes.length=0;for(var t=this._ibs,e=0;e<t.length;e++)t[e].buffer.destroy();t.length=0;for(var n=this._vbs,i=0;i<n.length;i++)n[i].buffer.destroy();n.length=0},setBoundingBox:function(t,e){this._minPos=t,this._maxPos=e},destroy:function(){this.clear()},_uploadData:function(){for(var t=this._vbs,e=0;e<t.length;e++){var n=t[e];if(n.dirty){var i=n.buffer,r=n.data;i._numVertices=r.byteLength/i._format._bytes,i._bytes=r.byteLength,i.update(0,r),n.dirty=!1}}for(var a=this._ibs,s=0;s<a.length;s++){var o=a[s];if(o.dirty){var c=o.buffer,u=o.data;c._numIndices=u.length,c._bytes=u.byteLength,c.update(0,u),o.dirty=!1}}}});cc.Mesh=e.exports=a},{"../event/event-target":60,"./mesh-data":77}],75:[function(t,e,n){"use strict";var s=r(t("../geom-utils")),i=r(t("../assets/material/custom-properties"));function r(t){return t&&t.__esModule?t:{default:t}}var a=t("../components/CCRenderComponent"),o=t("./CCMesh"),c=cc.Enum({OFF:0,ON:1}),u=cc.Class({name:"cc.MeshRenderer",extends:a,properties:{_mesh:{default:null,type:o},_receiveShadows:!1,_shadowCastingMode:c.OFF,mesh:{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._setMesh(t),t?(this.markForRender(!0),this._activateMaterial(!0),this.markForUpdateRenderData(!0),this.node._renderFlag|=b8e.RenderFlow.FLAG_TRANSFORM):this.markForRender(!1))},type:o},textures:{default:[],visible:!1},receiveShadows:{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows=t,this._updateReceiveShadow()}},shadowCastingMode:{get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()},type:c}},statics:{ShadowCastingMode:c},ctor:function(){this._renderDatas=[],this._boundingBox=null,this._customProperties=new i.default},onEnable:function(){this._super(),this._setMesh(this._mesh),this._activateMaterial()},onDestroy:function(){this._setMesh(null)},getRenderNode:function(){return this.node},_setMesh:function(t){this._mesh&&this._mesh.off("init-format",this._updateMeshAttribute,this),t&&t.on("init-format",this._updateMeshAttribute,this),this._mesh=t},_getDefaultMaterial:function(){return b8e.Material.getBuiltinMaterial("unlit")},_activateMaterial:function(){var t=this._mesh;if(t&&0!==t.subMeshes.length){s.default&&(this._boundingBox=s.default.Aabb.fromPoints(s.default.Aabb.create(),t._minPos,t._maxPos));var e=this.textures;if(e&&0<e.length)for(var n=0;n<e.length;n++){var i=this.sharedMaterials[n];i||((i=this._getDefaultMaterial()).setProperty("diffuseTexture",e[n]),this.setMaterial(n,i))}var r=this.sharedMaterials;if(!r[0]){var a=this._getDefaultMaterial();r[0]=a}this._updateMeshAttribute(),this._updateReceiveShadow(),this._updateCastShadow(),this.markForUpdateRenderData(!0),this.markForRender(!0)}else this.disableRender()},_updateReceiveShadow:function(){this._customProperties.define("_USE_SHADOW_MAP",this._receiveShadows)},_updateCastShadow:function(){this._customProperties.define("_SHADOW_CASTING",this._shadowCastingMode===c.ON)},_updateMeshAttribute:function(){var t=this._mesh&&this._mesh.subMeshes;if(t){var e=t[0]._vertexBuffer._format._attr2el;this._customProperties.define("_USE_ATTRIBUTE_COLOR",!!e[b8e.GFXEnums.ATTR_COLOR]),this._customProperties.define("_USE_ATTRIBUTE_UV0",!!e[b8e.GFXEnums.ATTR_UV0]),this._customProperties.define("_USE_ATTRIBUTE_NORMAL",!!e[b8e.GFXEnums.ATTR_NORMAL])}}});cc.MeshRenderer=e.exports=u},{"../assets/material/custom-properties":32,"../components/CCRenderComponent":45,"../geom-utils":65,"./CCMesh":74}],76:[function(t,e,n){"use strict";t("./CCMesh"),t("./CCMeshRenderer"),t("./mesh-renderer")},{"./CCMesh":74,"./CCMeshRenderer":75,"./mesh-renderer":78}],77:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=n.BufferRange=cc.Class({name:"cc.BufferRange",properties:{offset:0,length:0}}),r=n.VertexFormat=cc.Class({name:"cc.mesh.VertexFormat",properties:{name:"",type:-1,num:-1,normalize:!1}});n.VertexBundle=cc.Class({name:"cc.mesh.VertexBundle",properties:{data:{default:null,type:i},formats:{default:[],type:r},verticesCount:0}}),n.Primitive=cc.Class({name:"cc.mesh.Primitive",properties:{vertexBundleIndices:{default:[],type:Number},data:{default:null,type:i},indexUnit:0,topology:0},ctor:function(){this.indexUnit=b8e.GFXEnums.INDEX_FMT_UINT16,this.topology=b8e.GFXEnums.PT_TRIANGLES}})},{}],78:[function(t,e,n){"use strict";var i=t("./CCMeshRenderer"),d=cc.Color.BLACK,r={updateRenderData:function(t){var e=t._renderDatas;if(e.length=0,t.mesh)for(var n=t.mesh._subMeshes,i=0;i<n.length;i++){var r=new b8e.IARenderData;r.material=t.sharedMaterials[i]||t.sharedMaterials[0],r.ia=n[i],e.push(r)}},createWireFrameData:function(t,e,n,i){var r=new b8e.IARenderData,a=new b8e.Material;a.copy(b8e.Material.getBuiltinMaterial("unlit")),a.setProperty("diffuseColor",d),a.define("USE_DIFFUSE_TEXTURE",!1),r.material=a;for(var s=[],o=0;o<e.length;o+=3){var c=e[o+0],u=e[o+1],l=e[o+2];s.push(c,u,u,l,l,c)}var h=new Uint16Array(s),f=new b8e.GFXIndexBuffer(i._device,b8e.GFXEnums.INDEX_FMT_UINT16,b8e.GFXEnums.USAGE_STATIC,h,h.length);return r.ia=new b8e.InputAssembler(t._vertexBuffer,f,b8e.GFXEnums.PT_LINES),r},fillBuffers:function(t,e){e._flush();var n=t._renderDatas,i=t.mesh._subMeshes;if(cc.macro.SHOW_MESH_WIREFRAME){if(n.length===i.length)for(var r=t.mesh._ibs,a=0;a<i.length;a++){var s=n[a];n.push(this.createWireFrameData(s.ia,r[a].data,s.material,e))}}else n.length=i.length;var o=e.material,c=e.node;e.node=t.getRenderNode(),e.customProperties=t._customProperties;var u=e.customProperties;t.mesh._uploadData();for(var l=0;l<n.length;l++){var h=n[l],f=h.material;e.material=f,e._flushIA(h)}e.customProperties=u,e.node=c,e.material=o}};e.exports=i._assembler=r},{"./CCMeshRenderer":75}],79:[function(t,e,n){"use strict";var i=t("./component-scheduler"),r=t("./platform/CCObject").Flags,a=t("./platform/js"),s=r.IsPreloadStarted,o=r.IsOnLoadStarted,c=r.IsOnLoadCalled,u=r.Deactivating,l=cc.Class({extends:i.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){i.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),h=i.createInvokeImpl(function(t){t.__preload()}),f=i.createInvokeImpl(function(t){t.onLoad(),t._objFlags|=c}),d=new a.Pool(4);function _(t,e,n){e?t._removeComponent(e):a.array.removeAt(t._components,n)}function m(){this._activatingStack=[]}d.get=function(){var t=this._get()||{preload:new l(h),onLoad:new i.OneOffInvoker(f),onEnable:new i.OneOffInvoker(i.invokeOnEnable)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var p=cc.Class({ctor:m,reset:m,_activateNodeRecursively:function(t,e,n,i){if(!(t._objFlags&u)){t._activeInHierarchy=!0;for(var r=t._components.length,a=0;a<r;++a){var s=t._components[a];s instanceof cc.Component?this.activateComp(s,e,n,i):(_(t,s,a),--a,--r)}t._childArrivalOrder=t._children.length,t.onActiveInHierarchy&&t.onActiveInHierarchy(!0);for(var o=t._children.length-1;0<=o;o--){var c=t._children[o];c._active&&this._activateNodeRecursively(c,e,n,i)}t._onPostActivated(!0)}},_deactivateNodeRecursively:function(t){t._objFlags|=u,t._activeInHierarchy=!1;for(var e=t._components.length,n=0;n<e;++n){var i=t._components[n];if(i._enabled&&(cc.director._compScheduler.disableComp(i),t._activeInHierarchy))return void(t._objFlags&=~u)}t.onActiveInHierarchy&&t.onActiveInHierarchy(!1);for(var r=t._children.length-1;0<=r;r--){var a=t._children[r];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),t._activeInHierarchy))return void(t._objFlags&=~u)}t._onPostActivated(!1),t._objFlags&=~u},activateNode:function(t,e){if(e){var n=d.get();this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),d.put(n)}else{this._deactivateNodeRecursively(t);for(var i=this._activatingStack,r=0;r<i.length;r++){var a=i[r];a.preload.cancelInactive(s),a.onLoad.cancelInactive(o),a.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,e,n,i){if(cc.isValid(t,!0)&&(t._objFlags&s||(t._objFlags|=s,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&o||(t._objFlags|=o,t.onLoad?n?n.add(t):(t.onLoad(),t._objFlags|=c):t._objFlags|=c),t._enabled)){if(!t.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(t,i)}},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&c&&t.onDestroy()}});e.exports=p},{"./component-scheduler":34,"./platform/CCObject":87,"./platform/js":101}],80:[function(t,e,n){"use strict";t("./js").createMap(!0);var i={},r={effect:{},material:{}};i._loadBuiltins=function(t){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)return t&&t();loadBuiltins("effect",cc.EffectAsset,function(){loadBuiltins("material",b8e.Material,t)})},i.getBuiltin=function(t,e){return r[t][e]},i.getBuiltins=function(t){return t?r[t]:r},i.setBuiltin=function(t,e,n){var i=r[t];(i=i||(r[t]={}))[e]=n},e.exports=cc.AssetLibrary=i},{"./js":101}],81:[function(t,e,n){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=t("./js"),_=t("./CCEnum"),i=t("./utils"),m=(i.isPlainEmptyObj_DEV,i.cloneable_DEV,t("./attribute")),p=m.DELIMETER,v=m.getTypeChecker,h=t("./preprocess-class");t("./requiring-frame");var y={name:!0,extends:!0,mixins:!0,ctor:!0,__ctor__:!0,properties:!0,statics:!0,editor:!0,__ES6__:!0};function g(t,e){t.indexOf(e)<0&&t.push(e)}var x={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout(function(){e.init()},0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var n=t[e],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var a=f.getClassName(i);r&&O(i,a,r,i.$super,n.mixins)}this.datas=null}}};function l(t,e){g(t.__props__,e)}var b=[];function E(t,e,n,i){var r=i.default;m.setClassAttr(t,n,"_$default",r),l(t,n);var a=L(t,i,e,n);if(a){for(var s=b,o=0;o<a.length;o++){var c=a[o];m.attr(t,n,c),c._onAfterProp&&s.push(c._onAfterProp)}for(var u=0;u<s.length;u++)s[u](t,n);b.length=0,a.length=0}}function C(t,e,n,i,r){var a=i.get,s=i.set,o=t.prototype,c=!Object.getOwnPropertyDescriptor(o,n);if(a){for(var u=L(t,i,e,n),l=0;l<u.length;l++)m.attr(t,n,u[l]);u.length=0,m.setClassAttr(t,n,"_$serializable",!1),r||f.get(o,n,a,c,c)}s&&(r||f.set(o,n,s,c,c))}function r(t){return"function"==typeof t?t():t}function w(t,e,n){for(var i in e)t.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(t,i,f.getPropertyDescriptor(e,i))}function c(t,e,n,i){var r,a,s=i.__ctor__,o=i.ctor,c=i.__ES6__;c?(r=[o],a=o):(r=s?[s]:A(e,n,i),a=M(r,e,t,i),f.value(a,"_$extend",function(t){return t.extends=this,R(t)},!0)),f.value(a,"_$__ctors__",0<r.length?r:null,!0);var u=a.prototype;if(e&&(c||(f.extend(a,e),u=a.prototype),a.$super=e),n){for(var l=n.length-1;0<=l;l--){var h=n[l];w(u,h.prototype),w(a,h,function(t){return h.hasOwnProperty(t)}),R._isCCClass(h)&&w(m.getClassAttrs(a).constructor.prototype,m.getClassAttrs(h).constructor.prototype)}u.constructor=a}return c||(u.__initProps__=T),f.setClassName(t,a),a}function S(t,e,n,i){var r=cc.Component,a=cc._RF.peek();if(a&&f.isChildClassOf(e,r)){if(f.isChildClassOf(a.cls,r))return null;t=t||a.script}var s=c(t,e,n,i);if(a)if(f.isChildClassOf(e,r)){var o=a.uuid;o&&f._setClassId(o,s),a.cls=s}else f.isChildClassOf(a.cls,r)||(a.cls=s);return s}function a(t,e){for(var a=[],s=[],o=[],c=[],n=0;n<e.length;++n){var i=e[n],r=i+p+"default";if(r in t){var u=t[r];"object"===(void 0===u?"undefined":d(u))&&u||"function"==typeof u?(a.push(i),s.push(u)):(o.push(i),c.push(u))}}return function(){for(var t=0;t<o.length;++t)this[o[t]]=c[t];for(var e=0;e<a.length;e++){var n,i=a[e],r=s[e];n="object"===(void 0===r?"undefined":d(r))?r instanceof cc.ValueType?r.clone():Array.isArray(r)?[]:{}:r(),this[i]=n}}}function T(t){var e=m.getClassAttrs(t),n=t.__props__;null===n&&(x.init(),n=t.__props__);var i=a(e,n);(t.prototype.__initProps__=i).call(this)}var M=function(e,t,n,i){var r,a=t&&u(t,i),s=e.length;return r=0<s?a?2===s?function(){this._super=null,this.__initProps__(r),e[0].apply(this,arguments),e[1].apply(this,arguments)}:function(){this._super=null,this.__initProps__(r);for(var t=0;t<e.length;++t)e[t].apply(this,arguments)}:3===s?function(){this.__initProps__(r),e[0].apply(this,arguments),e[1].apply(this,arguments),e[2].apply(this,arguments)}:function(){this.__initProps__(r);for(var t=r.__ctors__,e=0;e<t.length;++e)t[e].apply(this,arguments)}:function(){a&&(this._super=null),this.__initProps__(r)}};function A(t,e,n){function i(t){return R._isCCClass(t)?t.__ctors__||[]:[t]}for(var r=[],a=[t].concat(e),s=0;s<a.length;s++){var o=a[s];if(o)for(var c=i(o),u=0;u<c.length;u++)g(r,c[u])}var l=n.ctor;return l&&r.push(l),r}var s="_$_super";0===s.indexOf("_$")&&(s=s.substr(2));var o=new RegExp("\\b."+s.replace("$","\\$")+"\\b");function u(t,e){var n=!1;for(var i in e)if(!y[i]){var r=e[i];if("function"==typeof r){var a=f.getPropertyDescriptor(t.prototype,i);if(a){var s=a.value;if("function"==typeof s){o.test(r)&&(n=!0,e[i]=function(n,i){return function(){var t=this._super;this._super=n;var e=i.apply(this,arguments);return this._super=t,e}}(s,r));continue}}}}return n}function O(e,t,n,i,r,a){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),r)for(var s=0;s<r.length;++s){var o=r[s];o.__props__&&(e.__props__=e.__props__.concat(o.__props__.filter(function(t){return e.__props__.indexOf(t)<0})))}if(n)for(var c in h.preprocessAttrs(n,t,e,a),n){var u=n[c];void 0!==u.default?E(e,t,c,u):C(e,t,c,u,a)}var l=m.getClassAttrs(e);e.__values__=e.__props__.filter(function(t){return!1!==l[t+p+"serializable"]})}function R(t){var e=(t=t||{}).name,n=t.extends,i=t.mixins,r=S(e,n,i,t);e=e||cc.js.getClassName(r),r._sealed=!0,n&&(n._sealed=!1);var a=t.properties;"function"==typeof a||n&&null===n.__props__||i&&i.some(function(t){return null===t.__props__})?(x.push({cls:r,props:a,mixins:i}),r.__props__=r.__values__=null):O(r,e,a,n,t.mixins,t.__ES6__);var s,o=t.statics;if(o)for(s in o)r[s]=o[s];for(var c in t)if(!y[c]){var u=t[c];h.validateMethodWithProps(u,c,e,r,n)&&f.value(r.prototype,c,u,!0,!0)}var l=t.editor;return l&&f.isChildClassOf(n,cc.Component)&&cc.Component._registerEditorProps(r,l),r}R._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},R._fastDefine=function(t,e,n){f.setClassName(t,e);for(var i=e.__props__=e.__values__=Object.keys(n),r=m.getClassAttrsProto(e),a=0;a<i.length;a++){var s=i[a];r[s+p+"visible"]=!1,r[s+p+"default"]=n[s]}},R.Attr=m,R.attr=m.attr,R.getInheritanceChain=function(t){for(var e=[];t=f.getSuper(t);)t!==Object&&e.push(t);return e};var D={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},N=[];function L(t,i,e,n){var r=null,a="";function s(){return a=n+p,r=m.getClassAttrsProto(t)}N.length=0;var o=N,c=i.type;if(c){var u=D[c];if(u)o.push({type:c,_onAfterProp:v(u,"cc."+c)});else if("Object"!==c)if(c===m.ScriptUuid){var l=m.ObjectType(cc.ScriptAsset);l.type="Script",o.push(l)}else"object"===(void 0===c?"undefined":d(c))?_.isEnum(c)&&o.push({type:"Enum",enumList:_.getList(c)}):"function"==typeof c&&(i.url?o.push({type:"Object",ctor:c,_onAfterProp:v("String","cc.String")}):o.push(i._short?{type:"Object",ctor:c}:m.ObjectType(c)))}function h(t,e){if(t in i){var n=i[t];(void 0===n?"undefined":d(n))===e&&((r||s())[a+t]=n)}}i.editorOnly&&((r||s())[a+"editorOnly"]=!0),i.url&&((r||s())[a+"saveUrlAsAsset"]=!0),!1===i.serializable&&((r||s())[a+"serializable"]=!1),h("formerlySerializedAs","string");var f=i.range;return f&&Array.isArray(f)&&2<=f.length&&((r||s())[a+"min"]=f[0],r[a+"max"]=f[1],2<f.length&&(r[a+"step"]=f[2])),h("min","number"),h("max","number"),h("step","number"),o}cc.Class=R,e.exports={isArray:function(t){return t=r(t),Array.isArray(t)},fastDefine:R._fastDefine,getNewValueTypeCode:!1,IDENTIFIER_RE:/^[A-Za-z_$][0-9A-Za-z_$]*$/,escapeForJS:function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},getDefault:r}},{"./CCEnum":83,"./attribute":93,"./js":101,"./preprocess-class":102,"./requiring-frame":103,"./utils":105}],82:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t("./CCClass");var h=t("./preprocess-class"),f=t("./js"),s="__ccclassCache__";function r(t){return t}function o(t,e){return t[e]||(t[e]={})}function a(n){return function(e){return"function"==typeof e?n(e):function(t){return n(t,e)}}}function c(t,n,e){return function(e){return function(t){return n(t,e)}}}var u=c.bind(null);function l(){return c.bind(null)}var d=l(),_=l();function m(t){return o(t,s)}function p(t){var e;try{e=t()}catch(e){return t}return"object"!==(void 0===e?"undefined":i(e))||null===e?e:t}function v(t){var e;try{e=new t}catch(t){return{}}return e}function y(t,e,n,i,r,a){var s;i&&(s=(s=h.getFullFormOfProperty(i))||i);var o=e[n],c=f.mixin(o||{},s||{});if(r&&(r.get||r.set))r.get&&(c.get=r.get),r.set&&(c.set=r.set);else{var u=void 0;if(r)r.initializer&&(u=p(r.initializer));else{var l=a.default||(a.default=v(t));l.hasOwnProperty(n)&&(u=l[n])}c.default=u}e[n]=c}var g=a(function(t,e){var n=f.getSuper(t);n===Object&&(n=null);var i={name:e,extends:n,ctor:t,__ES6__:!0},r=t[s];if(r){var a=r.proto;a&&f.mixin(i,a),t[s]=void 0}return cc.Class(i)});function x(t,a,s){return t(function(t,e){var n=m(t);if(n){var i=void 0!==s?s:e,r=o(n,"proto");o(r,"editor")[a]=i}},a)}function b(t){return t(r)}var E=b(a),C=x(u,"requireComponent"),w=b(d),S=x(_,"executionOrder"),T=b(a),M=b(a),A=b(d),O=b(d),R=b(d);cc._decorator=e.exports={ccclass:g,property:function(t,e,n){var s=null;function i(t,e,n){var i=m(t.constructor);if(i){var r=o(i,"proto"),a=o(r,"properties");y(t.constructor,a,e,s,n,i)}}if(void 0===e)return s=t,i;i(t,e,n)},executeInEditMode:E,requireComponent:C,menu:w,executionOrder:S,disallowMultiple:T,playOnFocus:M,inspector:A,icon:O,help:R,mixins:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){var e=m(t);e&&(o(e,"proto").mixins=n)}}}},{"./CCClass":81,"./js":101,"./preprocess-class":102}],83:[function(t,e,n){"use strict";var o=t("./js");function i(t){if("__enums__"in t)return t;o.value(t,"_$__enums__",null,!0);for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var s=""+a;r!==s&&o.value(t,s,r)}return t}i.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},i.getList=function(t){if(t.__enums__)return t.__enums__;var e=t.__enums__=[];for(var n in t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort(function(t,e){return t.value-e.value}),e},e.exports=cc.Enum=i},{"./js":101}],84:[function(t,e,n){"use strict";var i=t("../event-manager"),r=t("./CCInputManager"),a=void 0;cc.Acceleration=function(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.timestamp=i||0},r.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var n=cc.director.getScheduler();n.enableForTarget(e),e._accelEnabled?(e._registerAccelerometerEvent(),e._accelCurTime=0,n.scheduleUpdate(e)):(e._unregisterAccelerometerEvent(),e._accelCurTime=0,n.unscheduleUpdate(e)),IS_RUNTIME&&jsb.device.setMotionEnabled(t)}},r.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t,IS_RUNTIME&&jsb.device.setMotionInterval(t))},r._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){i.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){i.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},r._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=window.navigator.userAgent;(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),a=this.didAccelerate.bind(this),t.addEventListener(e,a,!1)},r._unregisterAccelerometerEvent=function(){var t=window,e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";a&&t.removeEventListener(e,a,!1)},r.didAccelerate=function(t){var e=window;if(this._accelEnabled){var n=this._acceleration,i=void 0,r=void 0,a=void 0;if(this._accelDeviceEvent===window.DeviceMotionEvent){var s=t.accelerationIncludingGravity;i=this._accelMinus*s.x*.1,r=this._accelMinus*s.y*.1,a=.1*s.z}else i=t.gamma/90*.981,r=-t.beta/90*.981,a=t.alpha/90*.981;if(cc.view._isRotated){var o=i;i=-r,r=o}n.x=i,n.y=r,n.z=a,n.timestamp=t.timeStamp||Date.now();var c=n.x;90===e.orientation?(n.x=-n.y,n.y=c):-90===e.orientation?(n.x=n.y,n.y=-c):180===e.orientation&&(n.x=-n.x,n.y=-n.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(n.x=-n.x,n.y=-n.y)}}},{"../event-manager":58,"./CCInputManager":85}],85:[function(t,e,n){"use strict";var i=t("./CCMacro"),_=t("./CCSys"),m=t("../event-manager"),r=i.TOUCH_TIMEOUT,h=cc.v2(),a={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:8,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),n=0;n<this._maxTouches;n++){if(!(1&t))return this._indexBitsUsed|=1<<n,n;var i=this._touches[n];if(e-i._lastModified>r)return this._removeUsedIndexBit(n),delete this._touchesIntegerDict[i.getID()],n;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e=void 0,n=void 0,i=void 0,r=[],a=this._touchesIntegerDict,s=_.now(),o=0,c=t.length;o<c;o++)if(null==a[i=(e=t[o]).getID()]){var u=this._getUnUsedIndex();if(-1===u)continue;(n=this._touches[u]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=s,n._setPrevPoint(e._prevPoint),a[i]=u,r.push(n)}if(0<r.length){this._glView._convertTouchesWithScale(r);var l=new cc.Event.EventTouch(r);l._eventCode=cc.Event.EventTouch.BEGAN,m.dispatchEvent(l)}},handleTouchesMove:function(t){for(var e=void 0,n=void 0,i=void 0,r=[],a=this._touches,s=_.now(),o=0,c=t.length;o<c;o++)i=(e=t[o]).getID(),null!=(n=this._touchesIntegerDict[i])&&a[n]&&(a[n]._setPoint(e._point),a[n]._setPrevPoint(e._prevPoint),a[n]._lastModified=s,r.push(a[n]));if(0<r.length){this._glView._convertTouchesWithScale(r);var u=new cc.Event.EventTouch(r);u._eventCode=cc.Event.EventTouch.MOVED,m.dispatchEvent(u)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(0<e.length){this._glView._convertTouchesWithScale(e);var n=new cc.Event.EventTouch(e);n._eventCode=cc.Event.EventTouch.ENDED,m.dispatchEvent(n)}this._preTouchPool.length=0},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(0<e.length){this._glView._convertTouchesWithScale(e);var n=new cc.Event.EventTouch(e);n._eventCode=cc.Event.EventTouch.CANCELLED,m.dispatchEvent(n)}this._preTouchPool.length=0},getSetOfTouchesEndOrCancel:function(t){for(var e=void 0,n=void 0,i=void 0,r=[],a=this._touches,s=this._touchesIntegerDict,o=0,c=t.length;o<c;o++)null!=(n=s[i=(e=t[o]).getID()])&&a[n]&&(a[n]._setPoint(e._point),a[n]._setPrevPoint(e._prevPoint),r.push(a[n]),this._removeUsedIndexBit(n),delete s[i]);return r},getHTMLElementPosition:function(t){if(IS_WECHATGAME)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};var e=document.documentElement,n=window.pageXOffset-e.clientLeft,i=window.pageYOffset-e.clientTop;if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return{left:r.left+n,top:r.top+i,width:r.width,height:r.height}}return t instanceof HTMLCanvasElement?{left:n,top:i,width:t.width,height:t.height}:{left:n,top:i,width:parseInt(t.style.width),height:parseInt(t.style.height)}},getPreTouch:function(t){for(var e=null,n=this._preTouchPool,i=t.getID(),r=n.length-1;0<=r;r--)if(n[r].getID()===i){e=n[r];break}return e||t},setPreTouch:function(t){for(var e=!1,n=this._preTouchPool,i=t.getID(),r=n.length-1;0<=r;r--)if(n[r].getID()===i){n[r]=t,e=!0;break}e||(n.length<=50?n.push(t):(n[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,n){var i=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,n),a=new cc.Touch(r.x,r.y,0);return a._setPrevPoint(i.x,i.y),i.x=r.x,i.y=r.y,a},getMouseEvent:function(t,e,n){var i=this._prevMousePoint,r=new cc.Event.EventMouse(n);return r._setPrevCursor(i.x,i.y),i.x=t.x,i.y=t.y,this._glView._convertMouseToLocationInView(i,e),r.setLocation(i.x,i.y),r},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(IS_WECHATGAME?(e.left=0,e.top=0):(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop),{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var n=[],i=this._glView,r=void 0,a=void 0,s=void 0,o=this._preTouchPoint,c=t.changedTouches.length,u=0;u<c;u++)if(r=t.changedTouches[u]){var l;l=_.BROWSER_TYPE_FIREFOX===_.browserType?i.convertToLocationInView(r.pageX,r.pageY,e,h):i.convertToLocationInView(r.clientX,r.clientY,e,h),null!=r.identifier?(a=new cc.Touch(l.x,l.y,r.identifier),s=this.getPreTouch(a).getLocation(),a._setPrevPoint(s.x,s.y),this.setPreTouch(a)):(a=new cc.Touch(l.x,l.y))._setPrevPoint(o.x,o.y),o.x=l.x,o.y=l.y,n.push(a)}return n},registerSystemEvent:function(s){if(!this._isRegisterEvent){this._glView=cc.view;var o=this,t=_.isMobile,e=_.capabilities.mouse,n=_.capabilities.touches;if(IS_WECHATGAME&&(e=!(n=!(t=!1))),e){t||(window.addEventListener("mousedown",function(){o._mousePressed=!0},!1),window.addEventListener("mouseup",function(t){if(o._mousePressed){o._mousePressed=!1;var e=o.getHTMLElementPosition(s),n=o.getPointByEvent(t,e);if(!cc.rect(e.left,e.top,e.width,e.height).contains(n)){o.handleTouchesEnd([o.getTouchByXY(n.x,n.y,e)]);var i=o.getMouseEvent(n,e,cc.Event.EventMouse.UP);i.setButton(t.button),m.dispatchEvent(i)}}},!1));for(var i=cc.Event.EventMouse,r=[!t&&["mousedown",i.DOWN,function(t,e,n,i){o._mousePressed=!0,o.handleTouchesBegin([o.getTouchByXY(n.x,n.y,i)]),s.focus()}],!t&&["mouseup",i.UP,function(t,e,n,i){o._mousePressed=!1,o.handleTouchesEnd([o.getTouchByXY(n.x,n.y,i)])}],!t&&["mousemove",i.MOVE,function(t,e,n,i){o.handleTouchesMove([o.getTouchByXY(n.x,n.y,i)]),o._mousePressed||e.setButton(null)}],["mousewheel",i.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta)}],["DOMMouseScroll",i.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail)}]],a=0;a<r.length;++a){var c=r[a];c&&function(){var t=c[0],r=c[1],a=c[2];s.addEventListener(t,function(t){var e=o.getHTMLElementPosition(s),n=o.getPointByEvent(t,e),i=o.getMouseEvent(n,e,r);i.setButton(t.button),a(t,i,n,e),m.dispatchEvent(i),"undefined"!=typeof b8e&&b8e.macro.IS_ENGINE_EDITOR||t.stopPropagation(),t.preventDefault()},!1)}()}}if(window.navigator.msPointerEnabled){var u={MSPointerDown:o.handleTouchesBegin,MSPointerMove:o.handleTouchesMove,MSPointerUp:o.handleTouchesEnd,MSPointerCancel:o.handleTouchesCancel},l=function(t){var n=u[t];s.addEventListener(t,function(t){var e=o.getHTMLElementPosition(s);e.left-=document.documentElement.scrollLeft,e.top-=document.documentElement.scrollTop,n.call(o,[o.getTouchByXY(t.clientX,t.clientY,e)]),t.stopPropagation()},!1)};for(var h in u)l(h)}if(n){var f={touchstart:function(t){o.handleTouchesBegin(t),IS_WECHATGAME||s.focus()},touchmove:function(t){o.handleTouchesMove(t)},touchend:function(t){o.handleTouchesEnd(t)},touchcancel:function(t){o.handleTouchesCancel(t)}},d=void 0;for(var h in d=cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?(f={onTouchStart:f.touchstart,onTouchMove:f.touchmove,onTouchEnd:f.touchend,onTouchCancel:f.touchcancel},function(t){var i=f[t];wx[t](function(t){if(t.changedTouches){var e=o.getHTMLElementPosition(s),n=document.body;e.left-=n.scrollLeft||0,e.top-=n.scrollTop||0,i(o.getTouchesByEvent(t,e))}})}):function(t){var i=f[t];s.addEventListener(t,function(t){if(t.changedTouches){var e=o.getHTMLElementPosition(s),n=document.body;e.left-=n.scrollLeft||0,e.top-=n.scrollTop||0,i(o.getTouchesByEvent(t,e)),t.stopPropagation(),t.preventDefault()}},!1)},f)d(h)}cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&this._registerKeyboardEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,m.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};e.exports=_cc.inputManager=a},{"../event-manager":58,"./CCMacro":86,"./CCSys":90}],86:[function(t,e,n){"use strict";t("./js"),cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!0,SHOW_MESH_WIREFRAME:!1},cc.macro.SUPPORT_TEXTURE_FORMATS=[".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775}),cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e.exports=cc.macro},{"./js":101}],87:[function(t,e,n){"use strict";var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./js");function r(){this._name="",this._objFlags=0}t("./CCClass").fastDefine("cc.Object",r,{_name:"",_objFlags:0}),i.value(r,"_$Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var a=[];i.value(r,"_$_deferredDestroy",function(){for(var t=a.length,e=0;e<t;++e){var n=a[e];1&n._objFlags||n._destroyImmediate()}t===a.length?a.length=0:a.splice(0,t)});var s=r.prototype;function o(t,e){var n,i=t instanceof cc._BaseNode||t instanceof cc.Component,r=i?"_id":null,a={};for(n in t)if(t.hasOwnProperty(n)){if(n===r)continue;switch(l(t[n])){case"string":a[n]="";break;case"object":case"function":a[n]=null}}if(cc.Class._isCCClass(e))for(var s=cc.Class.Attr.getClassAttrs(e),o=e.__props__,c=0;c<o.length;c++){var u=(n=o[c])+cc.Class.Attr.DELIMETER+"default";if(u in s){if(i&&"_id"===n)continue;switch(l(s[u])){case"string":a[n]="";break;case"object":case"function":a[n]=null;break;case"undefined":a[n]=void 0}}}return function(t){for(var e in a)t[e]=a[e]}}i.getset(s,"_$name",function(){return this._name},function(t){this._name=t},!0),i.get(s,"_$isValid",function(){return!(1&this._objFlags)},!0),s.destroy=function(){return!(1&this._objFlags||4&this._objFlags||(this._objFlags|=4,a.push(this),0))},s._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=o(this,t),i.value(t,"_$__destruct__",e,!0)),e(this)},s._onPreDestroy=null,s._destroyImmediate=function(){1&this._objFlags||(this._onPreDestroy&&this._onPreDestroy(),this._objFlags|=1)},s._deserialize=null,cc.isValid=function(t,e){return"object"===(void 0===t?"undefined":l(t))?!(!t||t._objFlags&(e?5:1)):void 0!==t},cc.Object=e.exports=r},{"./CCClass":81,"./js":101}],88:[function(t,e,n){"use strict";var i=t("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}},cc.PlistParser=function(){cc.SAXParser.call(this)},i.extend(cc.PlistParser,cc.SAXParser),i.mixin(cc.PlistParser.prototype,{parse:function(t){var e=this._parseXML(t),n=e.documentElement;if("plist"!==n.tagName)return{};for(var i=null,r=0,a=n.childNodes.length;r<a&&1!==(i=n.childNodes[r]).nodeType;r++);return e=null,this._parseNode(i)},_parseNode:function(t){var e=null,n=t.tagName;if("dict"===n)e=this._parseDict(t);else if("array"===n)e=this._parseArray(t);else if("string"===n)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue}else"false"===n?e=!1:"true"===n?e=!0:"real"===n?e=parseFloat(t.firstChild.nodeValue):"integer"===n&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],n=0,i=t.childNodes.length;n<i;n++){var r=t.childNodes[n];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},n=null,i=0,r=t.childNodes.length;i<r;i++){var a=t.childNodes[i];1===a.nodeType&&("key"===a.tagName?n=a.firstChild.nodeValue:e[n]=this._parseNode(a))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,e.exports={saxParser:cc.saxParser,plistParser:cc.plistParser}},{"../platform/js":101}],89:[function(t,e,n){"use strict";cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};var t,e,n,i,r=this._fnMap;for(t=0,e=r.length;t<e;t++)if((n=r[t])&&void 0!==document[n[1]]){for(t=0,i=n.length;t<i;t++)this._fn[r[0][t]]=n[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent=window.ontouchend?"touchend":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement])},requestFullScreen:function(t,e){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&0<t.readyState)return void(t.webkitEnterFullscreen&&t.webkitEnterFullscreen());t.setAttribute("x5-video-player-fullscreen","true")}if(this._supportsFullScreen){if(t=t||document.documentElement,e){var n=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(n,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(n,e,!1)}t[this._fn.requestFullscreen]()}},exitFullScreen:function(t){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(t.webkitExitFullscreen&&t.webkitExitFullscreen());t.setAttribute("x5-video-player-fullscreen","false")}return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e)},disableAutoFullScreen:function(t){var e=cc.game.canvas||t,n=this._touchEvent;this._preOnTouch&&(e.removeEventListener(n,this._preOnTouch),this._preOnTouch=null)},_ensureFullScreen:function(t,e){var n=this,i=cc.game.canvas||t,r=this._fn.fullscreenerror,a=this._touchEvent;function s(){n._preOnFullScreenError=null,n._preOnTouch&&i.removeEventListener(a,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(t,e)},i.addEventListener(a,n._preOnTouch,{once:!0})}this._preOnFullScreenError&&t.removeEventListener(r,this._preOnFullScreenError),this._preOnFullScreenError=s,t.addEventListener(r,s,{once:!0})}},cc.screen.init()},{}],90:[function(t,e,n){"use strict";var i,D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N="baidugame"===(i=window._CCSettings?_CCSettings.platform:void 0)||"baidugame-subcontext"===i,L=!!params.isVivoGame,I=!!params.isOppoGame,P=!!params.isXiaomiGame,r=cc&&cc.sys?cc.sys:function(){cc.sys={};var n=cc.sys;if(n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_TURKISH="tr",n.LANGUAGE_UKRAINIAN="uk",n.LANGUAGE_ROMANIAN="ro",n.LANGUAGE_BULGARIAN="bg",n.LANGUAGE_UNKNOWN="unknown",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.WECHAT_GAME=104,n.QQ_PLAY=105,n.FB_PLAYABLE_ADS=106,n.BAIDU_GAME=107,n.VIVO_GAME=108,n.OPPO_GAME=109,n.HUAWEI_GAME=110,n.XIAOMI_GAME=111,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_WECHAT_GAME="wechatgame",n.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",n.BROWSER_TYPE_BAIDU_GAME="baidugame",n.BROWSER_TYPE_BAIDU_GAME_SUB="baidugamesub",n.BROWSER_TYPE_QQ_PLAY="qqplay",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_UCBS="ucbs",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=IS_RUNTIME,n.isBrowser=!("object"!==("undefined"==typeof window?"undefined":D(window))||"object"!==("undefined"==typeof document?"undefined":D(document))||IS_WECHATGAME||IS_QQPLAY||IS_RUNTIME||N),n.glExtension=function(t){return!(IS_WECHATGAME&&"OES_texture_float"===t||!b8e.renderer.device.ext(t))},IS_RUNTIME){var t,e;e=L?n.VIVO_GAME:P?n.XIAOMI_GAME:I?n.OPPO_GAME:__getPlatform(),n.platform=e,n.isMobile=e===n.ANDROID||e===n.IPAD||e===n.IPHONE||e===n.WP8||e===n.TIZEN||e===n.BLACKBERRY||L||P||I,n.os=__getOS(),n.language=__getCurrentLanguage(),!IS_RUNTIME||L||I||(t=__getCurrentLanguageCode()),n.languageCode=t?t.toLowerCase():void 0,n.osVersion=__getOSVersion(),n.osMainVersion=parseInt(n.osVersion),n.browserType=null,n.browserVersion=null;var i=window.innerWidth,r=window.innerHeight,a=window.devicePixelRatio||1;n.windowPixelResolution={width:a*i,height:a*r},n.localStorage=window.localStorage,O=n.capabilities={canvas:!1,opengl:!0,webp:!0},n.isMobile?(O.accelerometer=!0,O.touches=!0):(O.keyboard=!0,O.mouse=!0,O.touches=!1),n.__audioSupport={ONLY_ONE:!1,WEB_AUDIO:!1,DELAY_CREATE_CTX:!1,format:[".mp3"]}}else if(IS_WECHATGAME){var s=wx.getSystemInfoSync();n.isMobile=!0,n.platform=n.WECHAT_GAME,n.language=s.language.substr(0,2),n.languageCode=s.language.toLowerCase();var o=s.system.toLowerCase();"android"===s.platform?n.os=n.OS_ANDROID:"ios"===s.platform?n.os=n.OS_IOS:"devtools"===s.platform&&(n.isMobile=!1,-1<o.indexOf("android")?n.os=n.OS_ANDROID:-1<o.indexOf("ios")&&(n.os=n.OS_IOS)),"android p"===o&&(o="android p 9.0");var c=/[\d\.]+/.exec(o);n.osVersion=c?c[0]:o,n.osMainVersion=parseInt(n.osVersion),IS_WECHATGAMESUB?n.browserType=n.BROWSER_TYPE_WECHAT_GAME_SUB:n.browserType=n.BROWSER_TYPE_WECHAT_GAME,n.browserVersion=s.version,i=s.windowWidth,r=s.windowHeight,a=s.pixelRatio||1,n.windowPixelResolution={width:a*i,height:a*r},n.localStorage=window.localStorage,n.capabilities={canvas:!0,opengl:n.browserType!==n.BROWSER_TYPE_WECHAT_GAME_SUB,webp:!1},n.__audioSupport={ONLY_ONE:!1,WEB_AUDIO:!1,DELAY_CREATE_CTX:!1,format:[".mp3"]}}else if(IS_QQPLAY)s=window.BK.Director.queryDeviceInfo(),n.isMobile=!0,n.platform=n.QQ_PLAY,n.language=n.LANGUAGE_UNKNOWN,n.languageCode=void 0,"android"===s.platform?n.os=n.OS_ANDROID:"ios"===s.platform?n.os=n.OS_IOS:n.os=n.OS_UNKNOWN,n.osVersion=s.version,n.osMainVersion=parseInt(n.osVersion.split(".")[0]),n.browserType=n.BROWSER_TYPE_QQ_PLAY,n.browserVersion=0,i=s.screenWidth,r=s.screenHeight,a=s.pixelRatio||1,n.windowPixelResolution={width:a*i,height:a*r},n.localStorage=window.localStorage,n.capabilities={canvas:!1,opengl:!0,webp:!1},n.__audioSupport={ONLY_ONE:!1,WEB_AUDIO:!1,DELAY_CREATE_CTX:!1,format:[".mp3"]};else if(N){var u=__device.getSystemInfo();n.platform=u.platform,n.browserType=u.browserType,n.isMobile=u.isMobile,n.language=u.language,n.languageCode=u.language.toLowerCase(),n.os=u.os,n.osVersion=u.osVersion,n.osMainVersion=u.osMainVersion,n.browserVersion=u.browserVersion,n.windowPixelResolution=u.windowPixelResolution,n.localStorage=u.localStorage,n.capabilities=u.capabilities,n.__audioSupport=u.audioSupport}else{var l=window,h=l.navigator,f=document,d=f.documentElement,_=h.userAgent.toLowerCase();n.isMobile=/mobile|android|iphone|ipad/.test(_),"undefined"!=typeof FbPlayableAd?n.platform=n.FB_PLAYABLE_ADS:n.platform=n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER;var m=h.language;m=m||h.browserLanguage,n.languageCode=m.toLowerCase(),m=m?m.split("-")[0]:n.LANGUAGE_ENGLISH,n.language=m;var p=!1,v=!1,y="",g=0,x=/android (\d+(?:\.\d+)*)/i.exec(_)||/android (\d+(?:\.\d+)*)/i.exec(h.platform);x&&(p=!0,y=x[1]||"",g=parseInt(y)||0),(x=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(_))?(v=!0,y=x[2]||"",g=parseInt(y)||0):/(iPhone|iPad|iPod)/.exec(h.platform)&&(v=!0,y="",g=0);var b=n.OS_UNKNOWN;-1!==h.appVersion.indexOf("Win")?b=n.OS_WINDOWS:v?b=n.OS_IOS:-1!==h.appVersion.indexOf("Mac")?b=n.OS_OSX:-1!==h.appVersion.indexOf("X11")&&-1===h.appVersion.indexOf("Linux")?b=n.OS_UNIX:p?b=n.OS_ANDROID:-1===h.appVersion.indexOf("Linux")&&-1===_.indexOf("ubuntu")||(b=n.OS_LINUX),n.os=b,n.osVersion=y,n.osMainVersion=g,n.browserType=n.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(_),e=(t=(t=t||/qqbrowser|ucbrowser/i.exec(_))||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(_))?t[0].toLowerCase():n.BROWSER_TYPE_UNKNOWN;IS_WECHATGAME?e=n.BROWSER_TYPE_WECHAT_GAME:IS_QQPLAY?e=n.BROWSER_TYPE_QQ_PLAY:"micromessenger"===e?e=n.BROWSER_TYPE_WECHAT:"safari"===e&&p?e=n.BROWSER_TYPE_ANDROID:"qq"===e&&_.match(/android.*applewebkit/i)?e=n.BROWSER_TYPE_ANDROID:"trident"===e?e=n.BROWSER_TYPE_IE:"360 aphone"===e?e=n.BROWSER_TYPE_360:"mxbrowser"===e?e=n.BROWSER_TYPE_MAXTHON:"opr/"===e&&(e=n.BROWSER_TYPE_OPERA),n.browserType=e}(),n.browserVersion="",function(){var t=_.match(/(mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i);t=t||_.match(/(qqbrowser|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i),n.browserVersion=t?t[4]:""}(),i=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight,a=window.devicePixelRatio||1,n.windowPixelResolution={width:a*i,height:a*r},n._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var E=document.createElement("canvas");try{var C=n.localStorage=l.localStorage;C.setItem("storage",""),C.removeItem("storage"),C=null}catch(t){var w=function(){};n.localStorage={getItem:w,setItem:w,removeItem:w,clear:w}}var S=E.toDataURL("image/webp").startsWith("data:image/webp"),T=!!E.getContext("2d"),M=!1;n.browserType===n.BROWSER_TYPE_WECHAT_GAME?M=!0:l.WebGLRenderingContext&&(M=!0);var A,O=n.capabilities={canvas:T,opengl:M,webp:S};void 0===d.ontouchstart&&void 0===f.ontouchstart&&!h.msPointerEnabled||(O.touches=!0),void 0!==d.onmouseup&&(O.mouse=!0),void 0!==d.onkeyup&&(O.keyboard=!0),(l.DeviceMotionEvent||l.DeviceOrientationEvent)&&(O.accelerometer=!0),function(){n.browserVersion;var t=n.browserType!==n.BROWSER_TYPE_WECHAT_GAME&&!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);A={ONLY_ONE:!1,WEB_AUDIO:t,DELAY_CREATE_CTX:!1},n.os===n.OS_IOS&&(A.USE_LOADER_EVENT="loadedmetadata"),n.browserType===n.BROWSER_TYPE_FIREFOX&&(A.DELAY_CREATE_CTX=!0,A.USE_LOADER_EVENT="canplay"),n.os===n.OS_ANDROID&&n.browserType===n.BROWSER_TYPE_UC&&(A.ONE_SOURCE=!0)}();try{A.WEB_AUDIO&&(A.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),A.DELAY_CREATE_CTX&&setTimeout(function(){A.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(t){A.WEB_AUDIO=!1}var R=[];(function(){var t=document.createElement("audio");t.canPlayType&&(t.canPlayType('audio/ogg; codecs="vorbis"')&&R.push(".ogg"),t.canPlayType("audio/mpeg")&&R.push(".mp3"),t.canPlayType('audio/wav; codecs="1"')&&R.push(".wav"),t.canPlayType("audio/mp4")&&R.push(".mp4"),t.canPlayType("audio/x-m4a")&&R.push(".m4a"))})(),A.format=R,n.__audioSupport=A}return n.NetworkType={NONE:0,LAN:1,WWAN:2},n.getNetworkType=function(){return n.NetworkType.LAN},n.getBatteryLevel=function(){return 1},n.garbageCollect=function(){},n.restartVM=function(){},n.getSafeAreaRect=function(){var t=cc.view.getVisibleSize();return cc.rect(0,0,t.width,t.height)},n.isObjectValid=function(t){return!!t},n.dump=function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",t+="Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",b8e.log(t)},n.openURL=function(t){IS_RUNTIME?jsb.openURL(t):window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},n}();e.exports=r},{}],91:[function(t,e,n){"use strict";var i=t("../event/event-target"),r=t("../platform/js");t("../platform/CCClass");var o=cc.sys.platform===cc.sys.BAIDU_GAME,a={init:function(){IS_WECHATGAME||IS_QQPLAY||o||(this.html=document.getElementsByTagName("html")[0])},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(a.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),o&&(cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU_GAME_SUB?a.adaptationType=cc.sys.BROWSER_TYPE_BAIDU_GAME_SUB:a.adaptationType=cc.sys.BROWSER_TYPE_BAIDU_GAME),IS_WECHATGAME&&(cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?a.adaptationType=cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:a.adaptationType=cc.sys.BROWSER_TYPE_WECHAT_GAME),IS_QQPLAY&&(a.adaptationType=cc.sys.BROWSER_TYPE_QQ_PLAY),a.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:a.meta["minimal-ui"]="true";case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:a.availWidth=function(t){return t.clientWidth},a.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME:a.availWidth=function(){return window.innerWidth},a.availHeight=function(){return window.innerHeight};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:var s=window.sharedCanvas||wx.getSharedCanvas();a.availWidth=function(){return s.width},a.availHeight=function(){return s.height}}function c(){i.call(this);var t=this,e=cc.ContainerStrategy,n=cc.ContentStrategy;a.init(this),t._frameSize=cc.size(0,0),t._designResolutionSize=cc.size(0,0),t._originalDesignResolutionSize=cc.size(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=cc.rect(0,0,0,0),t._visibleRect=cc.rect(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=cc.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._antiAliasEnabled=!1,t._resolutionPolicy=null,t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,n.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,n.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,n.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,n.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,n.FIXED_WIDTH),cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this)}var f=null;cc.js.extend(c,i),cc.js.mixin(c.prototype,{init:function(){this._initFrameSize(),this.enableAntiAlias(!0);var t=cc.game.canvas.width,e=cc.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},_resizeEvent:function(t){var e,n=(e=this.setDesignResolutionSize?this:cc.view)._frameSize.width,i=e._frameSize.height,r=e._isRotated;if(cc.sys.isMobile,e._initFrameSize(),!0===t||e._isRotated!==r||e._frameSize.width!==n||e._frameSize.height!==i){var a=e._originalDesignResolutionSize.width,s=e._originalDesignResolutionSize.height;e._resizing=!0,0<a&&e.setDesignResolutionSize(a,s,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},resizeWithBrowserSize:function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){if((t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t){this._orientation=t;var e=this._originalDesignResolutionSize.width,n=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(e,n,this._resolutionPolicy)}},_initFrameSize:function(){"undefined"!=typeof b8e&&b8e.transformContainer&&(this._isRotated=b8e.transformContainer()),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;0<t&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var n=document.getElementById("cocosMetaElement");n&&e&&document.head.removeChild(n);var i,r,a,s=document.getElementsByName("viewport"),o=s?s[0]:null;for(r in i=o?o.content:"",(n=n||document.createElement("meta")).id="cocosMetaElement",n.name="viewport",n.content="",t)-1==i.indexOf(r)?i+=","+r+"="+t[r]:e&&(a=new RegExp(r+"s*=s*[^,]+"),i.replace(a,r+"="+t[r]));/^,/.test(i)&&(i=i.substr(1)),n.content=i,o&&(o.content=i),document.head.appendChild(n)},_adjustViewportMeta:function(){!this._isAdjustViewport||IS_RUNTIME||IS_WECHATGAME||IS_QQPLAY||o||(this._setViewportMeta(a.meta,!1),this._isAdjustViewport=!1)},adjustViewportMeta:function(t){this._isAdjustViewport=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(this._antiAliasEnabled!==t&&(this._antiAliasEnabled=t,cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL&&cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)){var e=cc.game.canvas.getContext("2d");e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame))},isAutoFullScreenEnabled:function(){return this._autoFullScreen},setCanvasSize:function(t,e){var n=cc.game.canvas,i=cc.game.container;n&&i&&(n.width=t*this._devicePixelRatio,n.height=e*this._devicePixelRatio,n.style.width=t+"px",n.style.height=e+"px",i.style.width=t+"px",i.style.height=e+"px",this._resizeEvent())},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(!0)},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var n=cc.ResolutionPolicy;t===n.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===n.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===n.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===n.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===n.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,n){if(0<t||0<e){this.setResolutionPolicy(n);var i=this._resolutionPolicy;if(i&&i.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var a=this._viewportRect,s=this._visibleRect,o=r.viewport;a.x=o.x,a.y=o.y,a.width=o.width,a.height=o.height,s.x=0,s.y=0,s.width=o.width/this._scaleX,s.height=o.height/this._scaleY}i.postApply(this),cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),b8e.renderer.updateCameraViewport(),this.emit("design-resolution-changed")}}},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,n){IS_RUNTIME||IS_WECHATGAME||IS_QQPLAY||o||(this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px"),this.setDesignResolutionSize(t,e,n)},setViewportInPoints:function(t,e,n,i){var r=this._scaleX,a=this._scaleY;cc.game._renderContext.viewport(t*r+this._viewportRect.x,e*a+this._viewportRect.y,n*r,i*a)},setScissorInPoints:function(t,e,n,i){var r=this._scaleX,a=this._scaleY,s=Math.ceil(t*r+this._viewportRect.x),o=Math.ceil(e*a+this._viewportRect.y),c=Math.ceil(n*r),u=Math.ceil(i*a),l=cc.game._renderContext;if(!f){var h=l.getParameter(l.SCISSOR_BOX);f=cc.rect(h[0],h[1],h[2],h[3])}f.x===s&&f.y===o&&f.width===c&&f.height===u||(f.x=s,f.y=o,f.width=c,f.height=u,l.scissor(s,o,c,u))},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!f){var t=gl.getParameter(gl.SCISSOR_BOX);f=cc.rect(t[0],t[1],t[2],t[3])}var e=1/this._scaleX,n=1/this._scaleY;return cc.rect((f.x-this._viewportRect.x)*e,(f.y-this._viewportRect.y)*n,f.width*e,f.height*n)},getViewportRect:function(){return this._viewportRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,n,i){return"undefined"!=typeof b8e&&b8e.convertToLocationInView?b8e.convertToLocationInView(t,e,n,i):{x:0,y:0}},_convertMouseToLocationInView:function(t,e){var n=this._viewportRect;t.x=(this._devicePixelRatio*(t.x-e.left)-n.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-n.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,n,i,r=this._viewportRect,a=this._scaleX,s=this._scaleY,o=0;o<t.length;o++)n=(e=t[o])._point,i=e._prevPoint,n.x=(n.x-r.x)/a,n.y=(n.y-r.y)/s,i.x=(i.x-r.x)/a,i.y=(i.y-r.y)/s}}),cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(){},apply:function(){},postApply:function(){},_setupContainer:function(t,e,n){var i=cc.game.canvas,r=cc.game.container;if(!IS_WECHATGAME&&!o){cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?n:e)+"px",document.body.style.height=(t._isRotated?e:n)+"px");var a=b8e.designSize?(b8e.designSize.maxWidth||b8e.designSize.width)*(n/b8e.designSize.height)>>0:0;e=a<e?a:e,r.style.width=i.style.width=e+"px",r.style.height=i.style.height=n+"px"}var s=t._devicePixelRatio=1;t.isRetinaEnabled()&&(s=t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),i.width=e*s,i.height=n*s},_fixContainer:function(){document.body.insertBefore(cc.game.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=cc.game.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null}},_buildResult:function(t,e,n,i,r,a){Math.abs(t-n)<2&&(n=t),Math.abs(e-i)<2&&(i=e);var s=cc.rect((t-n)/2,(e-i)/2,n,i);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,a],this._result.viewport=s,this._result},preApply:function(){},apply:function(){return{scale:[1,1]}},postApply:function(){}}),function(){var t=cc.Class({name:"EqualToFrame",extends:cc.ContainerStrategy,apply:function(t){t._frameSize.height;var e=cc.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),e.padding="0px"}}),e=cc.Class({name:"ProportionalToFrame",extends:cc.ContainerStrategy,apply:function(t,e){var n,i,r=t._frameSize.width,a=t._frameSize.height,s=cc.game.container.style,o=e.width,c=e.height,u=r/o,l=a/c;i=u<l?(n=r,c*u):(n=o*l,a);var h=Math.round((r-n)/2),f=Math.round((a-i)/2);n=r-2*h,i=a-2*f,this._setupContainer(t,n,i),s.paddingLeft=h+"px",s.paddingRight=h+"px",s.paddingTop=f+"px",s.paddingBottom=f+"px"}}),n=(cc.Class({name:"EqualToWindow",extends:t,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),cc.Class({name:"ProportionalToWindow",extends:e,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.Class({name:"OriginalContainer",extends:cc.ContainerStrategy,apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new n;var i=cc.Class({name:"ExactFit",extends:cc.ContentStrategy,apply:function(t,e){var n=cc.game.canvas.width,i=cc.game.canvas.height,r=n/e.width,a=i/e.height;return this._buildResult(n,i,n,i,r,a)}}),r=cc.Class({name:"ShowAll",extends:cc.ContentStrategy,apply:function(t,e){var n,i,r=cc.game.canvas.width,a=cc.game.canvas.height,s=e.width,o=e.height,c=r/s,u=a/o,l=0;return i=c<u?(n=r,o*(l=c)):(n=s*(l=u),a),this._buildResult(r,a,n,i,l,l)}}),a=cc.Class({name:"NoBorder",extends:cc.ContentStrategy,apply:function(t,e){var n,i,r,a=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,c=e.height,u=a/o,l=s/c;return r=u<l?(i=o*(n=l),s):(i=a,c*(n=u)),this._buildResult(a,s,i,r,n,n)}}),s=cc.Class({name:"FixedHeight",extends:cc.ContentStrategy,apply:function(t,e){var n=cc.game.canvas.width,i=cc.game.canvas.height,r=i/e.height,a=n,s=i;return this._buildResult(n,i,a,s,r,r)}}),o=cc.Class({name:"FixedWidth",extends:cc.ContentStrategy,apply:function(t,e){var n=cc.game.canvas.width,i=cc.game.canvas.height,r=n/e.width,a=n,s=i;return this._buildResult(n,i,a,s,r,r)}});cc.ContentStrategy.EXACT_FIT=new i,cc.ContentStrategy.SHOW_ALL=new r,cc.ContentStrategy.NO_BORDER=new a,cc.ContentStrategy.FIXED_HEIGHT=new s,cc.ContentStrategy.FIXED_WIDTH=new o}(),cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(t,e){this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),r.get(cc.ResolutionPolicy.prototype,"_$canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.view=new c,cc.winSize=cc.v2(),e.exports=cc.view},{"../event/event-target":60,"../platform/CCClass":81,"../platform/js":101}],92:[function(t,e,n){"use strict";cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,n=this.height=t.height,i=t.x,r=t.y,a=r+n,s=i+e;this.topLeft.x=i,this.topLeft.y=a,this.topRight.x=s,this.topRight.y=a,this.top.x=i+e/2,this.top.y=a,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=s,this.bottomRight.y=r,this.bottom.x=i+e/2,this.bottom.y=r,this.center.x=i+e/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=s,this.right.y=r+n/2}}},{}],93:[function(t,e,n){"use strict";var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=t("./js");function l(t,e,n){var i;i=function(){},n&&a.extend(i,n.constructor);var r=new i;return a.value(t,"_$__attrs__",r),r}function i(t){for(var e,n=cc.Class.getInheritanceChain(t),i=n.length-1;0<=i;i--){var r=n[i];r.hasOwnProperty("__attrs__")&&r.__attrs__||l(r,0,(e=n[i+1])&&e.__attrs__)}return l(t,0,(e=n[0])&&e.__attrs__),t.__attrs__}function h(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||i(t)}function s(t){return h(t).constructor.prototype}t("./utils").isPlainEmptyObj_DEV,cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String",e.exports={attr:function(t,e,n){var i,r,a;if(0===e.indexOf("_$")&&(e=e.substr(2)),"function"==typeof t)r=(i=h(t)).constructor.prototype;else{var s=t;(i=s.__attrs__)||(i=l(s,0,h(t=s.constructor))),r=i}if(void 0===n){var o=e+"$_$",c={};for(a in i)a.startsWith(o)&&(c[a.slice(o.length)]=i[a]);return c}if("object"===(void 0===n?"undefined":u(n)))for(a in n)95!==a.charCodeAt(0)&&(r[e+"$_$"+a]=n[a])},getClassAttrs:h,getClassAttrsProto:s,setClassAttr:function(t,e,n,i){var r=s(t);0===e.indexOf("_$")&&(e=e.substr(2)),0===n.indexOf("_$")&&(n=n.substr(2)),r[e+"$_$"+n]=i},DELIMETER:"$_$",getTypeChecker:function(t,e){},ObjectType:function(t){return{type:"Object",ctor:t}},ScriptUuid:{}}},{"./js":101,"./utils":105}],94:[function(t,e,n){"use strict";var i=t("./js"),o=i.array.fastRemoveAt;function r(){this.callbacks=[],this.targets=[],this.isInvoking=!1,this.containCanceled=!1}var a=r.prototype;a.removeBy=function(t,e){for(var n=this.callbacks,i=this.targets,r=0;r<t.length;++r)t[r]===e&&(o(n,r),o(i,r),--r)},a.cancel=function(t){this.callbacks[t]=this.targets[t]=null,this.containCanceled=!0},a.cancelAll=function(){for(var t=this.callbacks,e=this.targets,n=0;n<t.length;n++)t[n]=e[n]=null;this.containCanceled=!0},a.purgeCanceled=function(){this.removeBy(this.callbacks,null),this.containCanceled=!1};var s=new i.Pool(function(t){t.callbacks.length=0,t.targets.length=0,t.isInvoking=!1,t.containCanceled=!1},16);function c(){this._callbackTable=i.createMap(!0)}function u(){c.call(this)}s.get=function(){return this._get()||new r},(a=c.prototype).add=function(t,e,n){var i=this._callbackTable[t];(i=i||(this._callbackTable[t]=s.get())).callbacks.push(e),i.targets.push(n||null)},a.hasEventListener=function(t,e,n){var i=this._callbackTable[t];if(!i)return!1;var r=i.callbacks;if(!e){if(i.isInvoking){for(var a=0;a<r.length;a++)if(r[a])return!0;return!1}return 0<r.length}n=n||null;for(var s=i.targets,o=0;o<r.length;++o)if(r[o]===e&&s[o]===n)return!0;return!1},a.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(s.put(e),delete this._callbackTable[t]))}else if(t)for(var n in this._callbackTable){var i=this._callbackTable[n];if(i.isInvoking)for(var r=i.targets,a=0;a<r.length;++a)r[a]===t&&i.cancel(a);else i.removeBy(i.targets,t)}},a.remove=function(t,e,n){var i=this._callbackTable[t];if(i){n=n||null;for(var r=i.callbacks,a=i.targets,s=0;s<r.length;++s)if(r[s]===e&&a[s]===n){i.isInvoking?i.cancel(s):(o(r,s),o(a,s));break}}},i.extend(u,c),u.prototype.invoke=function(t,e,n,i,r,a){var s=this._callbackTable[t];if(s){var o=!s.isInvoking;s.isInvoking=!0;for(var c=s.callbacks,u=s.targets,l=0,h=c.length;l<h;++l){var f=c[l];if(f){var d=u[l];d?f.call(d,e,n,i,r,a):f(e,n,i,r,a)}}o&&(s.isInvoking=!1,s.containCanceled&&s.purgeCanceled())}},u.CallbacksHandler=c,e.exports=u},{"./js":101}],95:[function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];Array.isArray(i)?r(t,i):t.push(i)}}e.exports={flattenCodeArray:function(t){var e=[];return r(e,t),e.join("")}}},{}],96:[function(t,e,n){"use strict";function l(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this._stillUseUrl=f.createMap(!0)}var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=t("./js"),w=t("./attribute"),S=t("./CCClass"),i=t("../utils/misc");l.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,f.clear(this._stillUseUrl)},l.prototype.push=function(t,e,n,i){i&&(this._stillUseUrl[this.uuidList.length]=!0),this.uuidList.push(n),this.uuidObjList.push(t),this.uuidPropList.push(e)},(l.pool=new f.Pool(function(t){t.reset()},10)).get=function(){return this._get()||new l};var h=function(){function s(t,e,n,i,r){this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=n,this._idList=[],this._idObjList=[],this._idPropList=[]}function r(t){var e,n,i,r=t.deserializedList,a=t._idPropList,s=t._idList,o=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,e=0;e<s.length;e++)n=a[e],i=s[e],o[e][n]=r[i]}var t=s.prototype;t.deserialize=function(t){if(Array.isArray(t)){var e=t,n=e.length;this.deserializedList.length=n;for(var i=0;i<n;i++)e[i]&&(this.deserializedList[i]=this._deserializeObject(e[i],!1));this.deserializedData=0<n?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t,!1):null,this.deserializedList[0]=this.deserializedData;return r(this),this.deserializedData},t._deserializeObject=function(t,e,n,i,r){var a,s=null,o=null,c=t.__type__;if(c){if(!(o=this._classFinder(c,t,i,r)))return this._classFinder===f._getClassById&&cc.deserialize.reportMissingClass(c),null;if((s=new o)._deserialize)return s._deserialize(t.content,this),s;cc.Class._isCCClass(o)?l(this,s,t,o,n):this._deserializeTypedObject(s,t,o)}else if(Array.isArray(t)){s=new Array(t.length);for(var u=0;u<t.length;u++)"object"===(void 0===(a=t[u])?"undefined":C(a))&&a?this._deserializeObjField(s,a,""+u,null,e):s[u]=a}else s={},this._deserializePrimitiveObject(s,t);return s},t._deserializeObjField=function(t,e,n,i,r){var a=e.__id__;if(void 0===a){var s=e.__uuid__;s?this.result.push(t,n,s,r):t[n]=this._deserializeObject(e,r)}else{var o=this.deserializedList[a];o?t[n]=o:(this._idList.push(a),this._idObjList.push(t),this._idPropList.push(n))}},t._deserializePrimitiveObject=function(t,e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];"object"!==(void 0===i?"undefined":C(i))?"__type__"!==n&&(t[n]=i):i?this._deserializeObjField(t,i,n):t[n]=null}},t._deserializeTypedObject=function(t,e,n){if(n===cc.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(n===cc.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(n!==cc.Color){if(n===cc.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var i=w.DELIMETER+"default",r=w.getClassAttrs(n),a=n.__props__||Object.keys(t),s=0;s<a.length;s++){var o=a[s],c=e[o];void 0!==c&&e.hasOwnProperty(o)||(c=S.getDefault(r[o+i])),"object"!==(void 0===c?"undefined":C(c))?t[o]=c:c?this._deserializeObjField(t,c,o):t[o]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var u=e.a;t.a=void 0===u?255:u}};var o=function(t,_){var m,p=i.BUILTIN_CLASSID_RE.test(f._getClassId(_)),h=cc.js.isChildClassOf(_,cc._BaseNode)||cc.js.isChildClassOf(_,cc.Component),v=[],y=v,g=[],x=g,b=[],E=[];return function(){var t=_.__values__;m="_$erialized"===t[t.length-1];for(var e=w.getClassAttrs(_),n=w.DELIMETER+"type",i=w.DELIMETER+"default",r=w.DELIMETER+"saveUrlAsAsset",a=w.DELIMETER+"formerlySerializedAs",s=0;s<t.length;s++){var o=t[s],c=o;e[o+a]&&(c=e[o+a]);var u=e[o+r],l=S.getDefault(e[o+i]),h=!1;if(p){var f=e[o+n];if(void 0===l&&f)h=f===cc.String||f===cc.Integer||f===cc.Float||f===cc.Boolean;else{var d=void 0===l?"undefined":C(l);h="string"===d&&!u||"number"===d||"boolean"===d}}p&&h?(c!==o&&y===v&&(y=v.slice()),v.push(o),y!==v&&y.push(c)):(c!==o&&x===g&&(x=g.slice()),g.push(o),x!==g&&x.push(c),b.push(u),E.push(l instanceof cc.ValueType&&l.constructor))}}(),function(t,e,n,i,r){for(var a=0;a<v.length;++a){var s=n[y[a]];void 0!==s&&(e[v[a]]=s)}for(var o=0;o<g.length;++o){var c=g[o],u=n[x[o]];if(void 0!==u)if(p||"object"===(void 0===u?"undefined":C(u))){var l=E[o];l?p||u?t._deserializeTypedObject(e[c],u,l):e[c]=null:u?t._deserializeObjField(e,u,c,null,b[o]):e[c]=null}else e[c]=u}h&&n._id&&(e._id=n._id),m&&(e._$erialized=JSON.parse(JSON.stringify(n)),t._deserializePrimitiveObject(e._$erialized,n))}};function l(t,e,n,i,r){var a;i.hasOwnProperty("__deserialize__")?a=i.__deserialize__:(a=o(t,i),f.value(i,"__deserialize__",a,!0)),a(t,e,n,i,r)}return(s.pool=new f.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0},1)).get=function(t,e,n,i,r){var a=this._get();return a?(a.result=t,a.customEnv=i,a._classFinder=n,a):new s(t,e,n,i,r)},s}();cc.deserialize=function(t,e,n){var i=(n=n||{}).classFinder||f._getClassById,r=n.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,a=n.customEnv,s=n.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t));var o=!e;e=e||l.pool.get();var c=h.pool.get(e,target,i,a,s);cc.game._isCloning=!0;var u=c.deserialize(t);return cc.game._isCloning=!1,h.pool.put(c),r&&e.assignAssetsBy(Editor.serialize.asAsset),o&&l.pool.put(e),u},cc.deserialize.Details=l,cc.deserialize.reportMissingClass=function(t){}},{"../utils/misc":163,"./CCClass":81,"./attribute":93,"./js":101}],97:[function(t,e,n){"use strict";function i(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}i.prototype.getNewId=function(){return this.prefix+ ++this.id},i.global=new i("global"),e.exports=i},{}],98:[function(t,e,n){"use strict";t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCAssetLibrary"),t("./CCVisibleRect")},{"./CCAssetLibrary":80,"./CCClass":81,"./CCClassDecorator":82,"./CCEnum":83,"./CCMacro":86,"./CCObject":87,"./CCSys":90,"./CCVisibleRect":92,"./callbacks-invoker":94,"./deserialize":96,"./instantiate":100,"./instantiate-jit":99,"./js":101,"./requiring-frame":103,"./url":104}],99:[function(t,e,n){"use strict";var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=t("./CCObject"),r=s.Flags.Destroyed,o=s.Flags.PersistentMask,h=t("./attribute"),c=t("./js"),f=t("./CCClass"),u=t("./compiler"),d=h.DELIMETER+"default",i=f.IDENTIFIER_RE,_=f.escapeForJS,m={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};function a(t,e){this.varName=t,this.expression=e}function p(t,e){return e instanceof a?new a(e.varName,t+e.expression):t+e}function v(t,e,n){Array.isArray(n)?(n[0]=p(e,n[0]),t.push(n)):t.push(p(e,n)+";")}function y(t){this._exps=[],this._targetExp=t}function g(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e){if(t instanceof cc.ValueType&&t.equals(e))return!0;if(Array.isArray(t)&&Array.isArray(e)||t.constructor===Object&&e.constructor===Object)try{return Array.isArray(t)&&Array.isArray(e)&&0===t.length&&0===e.length}catch(t){}}return!1}function x(t){return i.test(t)?"."+t:"["+_(t)+"]"}function b(t,e){var n;this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=c.createMap(),c.mixin(this.funcModuleCache,m),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),c.value(t,"_$_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),0<this.globalVariables.length&&(n="var "+this.globalVariables.join(",")+";");var i=u.flattenCodeArray(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,a=this.objsToClear_iN$t.length;r<a;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}a.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},y.prototype.append=function(t,e){this._exps.push([t,e])},y.prototype.writeCode=function(t){var e;if(1<this._exps.length)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];v(t,e+x(i[0])+"=",i[1])}},(y.pool=new c.Pool(function(t){t._exps.length=0,t._targetExp=null},1)).get=function(t){var e=this._get()||new y;return e._targetExp=t,e};var E=b.prototype;E.getFuncModule=function(t,e){var n=c.getClassName(t);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=t===Function("return "+n)())return this.funcModuleCache[n]=n}catch(t){}}}var a=this.funcs.indexOf(t);a<0&&(a=this.funcs.length,this.funcs.push(t));var s="F["+a+"]";return e&&(s="("+s+")"),this.funcModuleCache[n]=s},E.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},E.setValueType=function(t,e,n,i){var r=y.pool.get(i),a=e.constructor.__props__;a=a||Object.keys(e);for(var s=0;s<a.length;s++){var o=a[s],c=n[o];if(e[o]!==c){var u=this.enumerateField(n,o,c);r.append(o,u)}}r.writeCode(t),y.pool.put(r)},E.enumerateCCClass=function(t,e,n){for(var i=n.__values__,r=h.getClassAttrs(n),a=0;a<i.length;a++){var s=i[a],o=e[s],c=r[s+d];if(!g(c,o))if("object"===(void 0===o?"undefined":l(o))&&o instanceof cc.ValueType&&(c=f.getDefault(c))&&c.constructor===o.constructor){var u="o"+x(s);this.setValueType(t,c,o,u)}else this.setObjProp(t,e,s,o)}},E.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,n=[new a(e,"new Array("+t.length+")")];c.value(t,"_$_iN$t",{globalVar:"",source:n},!0),this.objsToClear_iN$t.push(t);for(var i=0;i<t.length;++i)v(n,e+"["+i+"]=",this.enumerateField(t,i,t[i]));return n},E.enumerateField=function(t,e,n){if("object"===(void 0===n?"undefined":l(n))&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var a=i.source[0];i.source[0]=p(r+"=",a)}return r}return Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?_(n):("_objFlags"===e&&t instanceof s&&(n&=o),n)},E.setObjProp=function(t,e,n,i){v(t,"o"+x(n)+"=",this.enumerateField(e,n,i))},E.enumerateObject=function(t,e){var n=e.constructor;if(cc.Class._isCCClass(n))this.enumerateCCClass(t,e,n);else for(var i in e)if(e.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=e[i];"object"===(void 0===r?"undefined":l(r))&&r&&r===e._iN$t||this.setObjProp(t,e,i,r)}},E.instantiateObj=function(t){if(t instanceof cc.ValueType)return f.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&r)return null;var e,n=t.constructor;if(cc.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new a("o","new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)e=new a("o","{}");else{if(n)return this.getObjRef(t);e=new a("o","Object.create(null)")}var i=[e];return c.value(t,"_$_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(i,t),["(function(){",i,"return o;})();"]},e.exports={compile:function(t){return new b(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:g}},{"./CCClass":81,"./CCObject":87,"./attribute":93,"./compiler":95,"./js":101}],100:[function(t,e,n){"use strict";var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=t("./CCObject"),l=t("../value-types/value-type"),o=s.Flags.Destroyed,c=s.Flags.PersistentMask,a=t("./utils").isDomNode,h=t("./js");function i(t,e){if(!e){if("object"!==(void 0===t?"undefined":u(t))||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null}var n;if(t instanceof s){if(t._instantiate)return cc.game._isCloning=!0,n=t._instantiate(),cc.game._isCloning=!1,n;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,n=r(t),cc.game._isCloning=!1,n}var f=[];function r(t,e){if(Array.isArray(t))return null;if(a&&a(t))return null;var n;n=t._iN$t?t._iN$t:t.constructor?new t.constructor:Object.create(null),_(t,n,e);for(var i=0,r=f.length;i<r;++i)f[i]._iN$t=null;return f.length=0,n}function d(t,e,n,i){for(var r=t.__values__,a=0;a<r.length;a++){var s=r[a],o=e[s];if("object"===(void 0===o?"undefined":u(o))&&o){var c=n[s];c instanceof l&&c.constructor===o.constructor?c.set(o):n[s]=o._iN$t||m(o,i)}else n[s]=o}}function _(t,e,n){h.value(t,"_$_iN$t",e,!0),f.push(t);var i=t.constructor;if(cc.Class._isCCClass(i))d(i,t,e,n);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var a=t[r];if("object"===(void 0===a?"undefined":u(a))&&a){if(a===e)continue;e[r]=a._iN$t||m(a,n)}else e[r]=a}t instanceof s&&(e._objFlags&=c)}function m(t,e){if(t instanceof l)return t.clone();if(t instanceof cc.Asset)return t;var n;if(Array.isArray(t)){var i=t.length;n=new Array(i),h.value(t,"_$_iN$t",n,!0);for(var r=0;r<i;++r){var a=t[r];"object"===(void 0===a?"undefined":u(a))&&a?n[r]=a._iN$t||m(a,e):n[r]=a}return f.push(t),n}if(t._objFlags&o)return null;var s=t.constructor;if(cc.Class._isCCClass(s)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t;n=new s}else if(s===Object)n={};else{if(s)return t;n=Object.create(null)}return _(t,n,e),n}i._clone=r,cc.instantiate=i,e.exports=i},{"../value-types/value-type":177,"./CCObject":87,"./js":101,"./utils":105}],101:[function(t,e,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=new(t("./id-generater"))("TmpCId.");function r(t,e){for(;t;){var n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=Object.getPrototypeOf(t)}return null}function o(t,e,n){var i=r(e,t);Object.defineProperty(n,t,i)}var c={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){t=t||{};for(var e=1,n=arguments.length;e<n;e++){var i=arguments[e];if(i){if("object"!==(void 0===i?"undefined":a(i)))continue;for(var r in i)r in t||o(r,i,t)}}return t},mixin:function(t){t=t||{};for(var e=1,n=arguments.length;e<n;e++){var i=arguments[e];if(i){if("object"!==(void 0===i?"undefined":a(i)))continue;for(var r in i)o(r,i,t)}}return t},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){var e=t.prototype,n=e&&Object.getPrototypeOf(e);return n&&n.constructor},isChildClassOf:function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=c.getSuper(t)))return!1;if(t===e)return!0}}return!1},clear:function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)delete t[e[n]]},isEmptyObject:function(t){for(var e in t)return!1;return!0},getPropertyDescriptor:r},u={value:void 0,enumerable:!1,writable:!1,configurable:!0},l={get:null,set:null,enumerable:(c.value=function(t,e,n,i,r){u.value=n,u.writable=i,u.enumerable=r,0===e.indexOf("_$")&&(e=e.substr(2)),Object.defineProperty(t,e,u),u.value=void 0},!1)},h={get:null,enumerable:(c.getset=function(t,e,n,i,r,a){"function"!=typeof i&&(r=i,i=void 0),l.get=n,l.set=i,l.enumerable=r,l.configurable=a,0===e.indexOf("_$")&&(e=e.substr(2)),Object.defineProperty(t,e,l),l.get=null,l.set=null},!1),configurable:!1},f={set:null,enumerable:(c.get=function(t,e,n,i,r){h.get=n,h.enumerable=i,h.configurable=r,0===e.indexOf("_$")&&(e=e.substr(2)),Object.defineProperty(t,e,h),h.get=null},!1),configurable:!1};c.set=function(t,e,n,i,r){f.set=n,f.enumerable=i,f.configurable=r,0===e.indexOf("_$")&&(e=e.substr(2)),Object.defineProperty(t,e,f),f.set=null},c.getClassName=function(t){if("function"!=typeof t)return t&&t.constructor?c.getClassName(t.constructor):"";var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var n="";if(t.name&&(n=t.name),t.toString){var i,r=t.toString();(i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""},function(){var r={},a={};function t(r,t,a){return c.getset(c,t,function(){return Object.assign({},a)},function(t){c.clear(a),Object.assign(a,t)}),function(t,e){if(e.prototype.hasOwnProperty(r)&&delete a[e.prototype[r]],c.value(e.prototype,r,t),t){var n=a[t];if(n&&n!==e){var i="A Class already exists with the same "+r+' : "'+t+'".';b8e.log(i)}else a[t]=e}}}c._setClassId=t("__cid__","_registeredClassIds",r);var i=t("__classname__","_registeredClassNames",a);c.setClassName=function(t,e){if(i(t,e),!e.prototype.hasOwnProperty("__cid__")){var n=t||s.getNewId();n&&c._setClassId(n,e)}},c.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t].prototype,n=e.__cid__;n&&delete r[n];var i=e.__classname__;i&&delete a[i]}},c._getClassById=function(t){return r[t]},c.getClassByName=function(t){return a[t]},c._getClassId=function(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty("__cid__"))return t.__cid__}return""}}(),c.obsolete=function(t,e,n,i){var r=/([^.]+)$/,a=r.exec(e)[0],s=r.exec(n)[0];function o(){return this[s]}i?c.getset(t,a,o,function(t){this[s]=t}):c.get(t,a,o)},c.obsoletes=function(t,e,n,i){for(var r in n){var a=n[r];c.obsolete(t,e+"."+r,a,i)}};var d=/(%d)|(%s)/,_=/%s/;function i(t,e){t.splice(e,1)}function m(t,e){var n=t.indexOf(e);return 0<=n&&(i(t,n),!0)}c.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&d.test(e))for(var n=1;n<t;++n){var i=arguments[n],r="number"==typeof i?d:_;r.test(e)?e=e.replace(r,i):e+=" "+i}else for(var a=1;a<t;++a)e+=" "+arguments[a];return e},c.shiftArguments=function(){for(var t=arguments.length-1,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n+1];return e},c.createMap=function(t){var e=Object.create(null);return t&&(e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]),e};var p=Array.prototype.indexOf;function v(t,e){void 0===e&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t}c.array={remove:m,fastRemove:function(t,e){var n=t.indexOf(e);0<=n&&(t[n]=t[t.length-1],--t.length)},removeAt:i,fastRemoveAt:function(t,e){var n=t.length;e<0||n<=e||(t[e]=t[n-1],t.length=n-1)},contains:function(t,e){return 0<=t.indexOf(e)},verifyType:function(t,e){if(t&&0<t.length)for(var n=0;n<t.length;n++)if(!(t[n]instanceof e))return!1;return!0},removeArray:function(t,e){for(var n=0,i=e.length;n<i;n++)m(t,e[n])},appendObjectsAt:function(t,e,n){return t.splice.apply(t,[n,0].concat(e)),t},copy:function(t){var e,n=t.length,i=new Array(n);for(e=0;e<n;e+=1)i[e]=t[e];return i},indexOf:p,MutableForwardIterator:t("../utils/mutable-forward-iterator")},v.prototype._get=function(){if(0<this.count){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},v.prototype.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},v.prototype.resize=function(t){0<=t&&(this._pool.length=t,this.count>t&&(this.count=t))},c.Pool=v,cc.js=c,e.exports=c},{"../utils/mutable-forward-iterator":164,"./id-generater":97}],102:[function(t,e,c){"use strict";var r=t("./js"),u={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function l(t,e,n,i){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,n.call(this,e)};var a={};for(var s in i[r]=a,u){var o=u[s];t.hasOwnProperty(s)&&(a[s]=t[s],o.canUsedInGet||delete t[s])}}}function h(t,e,n,i){Array.isArray(i)&&0<i.length&&(i=i[0]),t.type=i}function f(t,e){if(Array.isArray(e)){if(!(0<e.length))return;if(cc.RawAsset.isRawAssetType(e[0]))return t.url=e[0],void delete t.type;t.type=e=e[0]}}c.getFullFormOfProperty=function(t,e,n){if(t&&t.constructor===Object)return null;if(Array.isArray(t)&&0<t.length){var i=t[0];return{default:[],type:t,_short:!0}}return"function"!=typeof t?{default:t,_short:!0}:(i=t,cc.RawAsset.isRawAssetType(i)||cc.RawAsset.wasRawAssetType(i)?{default:"",url:i,_short:!0}:{default:r.isChildClassOf(i,cc.ValueType)?new i:null,type:i,_short:!0})},c.preprocessAttrs=function(t,e,n,i){for(var r in t){var a=t[r],s=c.getFullFormOfProperty(a,r,e);if(s&&(a=t[r]=s),a){var o=a.notify;o&&l(a,r,o,t),a.type&&f(a,a.type),a.url&&h(a,0,0,a.url),a.type&&a.type}}},c.validateMethodWithProps=function(t,e,n,i,r){return"function"==typeof t||null===t}},{"./js":101}],103:[function(t,e,n){"use strict";var r=[];cc._RF={push:function(t,e,n){void 0===n&&(n=e,e=""),r.push({uuid:e,script:n,module:t,exports:t.exports,beh:null})},pop:function(){var t=r.pop(),e=t.module,n=e.exports;if(n===t.exports){for(var i in n)return;e.exports=n=t.cls}},peek:function(){return r[r.length-1]}}},{}],104:[function(t,e,n){"use strict";cc.url={_rawAssets:"",normalize:function(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t},raw:function(t){return(t=this.normalize(t)).startsWith("resources/"),this._rawAssets+t},_init:function(t){this._rawAssets=cc.path.stripSep(t)+"/"}},e.exports=cc.url},{}],105:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t("./js"),e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var n=e.parentNode;if(n)do{if(n===t)return!0;n=n.parentNode}while(null!==n);return!1},isDomNode:"object"===("undefined"==typeof window?"undefined":i(window))&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"===(void 0===t?"undefined":i(t))&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,n){t&&setTimeout(function(){t(e,n)},0)}}},{"./js":101}],106:[function(t,e,n){"use strict";t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./CCDirector"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager")},{"./CCDirector":11,"./CCScheduler":16,"./event":62,"./event-manager":58,"./platform/CCInputExtension":84,"./platform/CCInputManager":85,"./platform/CCMacro":86,"./platform/CCScreen":89,"./platform/CCSys":90,"./platform/CCView":91,"./platform/js":101,"./utils":161,"./value-types":172}],107:[function(t,e,n){"use strict";function i(t){var e;try{e=t.getContext("2d")}catch(t){return void console.error(t)}this._canvas=t,this._ctx=e,this._caps={},this._stats={drawcalls:0},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0}i.prototype._restoreTexture=function(){},i.prototype.setViewport=function(t,e,n,i){this._vx===t&&this._vy===e&&this._vw===n&&this._vh===i||(this._vx=t,this._vy=e,this._vw=n,this._vh=i)},i.prototype.setScissor=function(t,e,n,i){this._sx===t&&this._sy===e&&this._sw===n&&this._sh===i||(this._sx=t,this._sy=e,this._sw=n,this._sh=i)},i.prototype.clear=function(t){var e=this._ctx;e.clearRect(this._vx,this._vy,this._vw,this._vh),!t||0===t[0]&&0===t[1]&&0===t[2]||(e.fillStyle="rgb("+t[0]+","+t[1]+","+t[2]+")",e.globalAlpha=t[3],e.fillRect(this._vx,this._vy,this._vw,this._vh))},e.exports=i},{}],108:[function(t,e,n){"use strict";function i(t,e){this._device=t,this._width=4,this._height=4,this._image=null,e&&(void 0!==e.width&&(this._width=e.width),void 0!==e.height&&(this._height=e.height),this.updateImage(e))}i.prototype.update=function(t){this.updateImage(t)},i.prototype.updateImage=function(t){if(t.images&&t.images[0]){var e=t.images[0];e&&e!==this._image&&(this._image=e)}},i.prototype.destroy=function(){this._image=null},e.exports=i},{}],109:[function(t,e,n){"use strict";function i(){}i.prototype={constructor:i,_reset:function(){},render:function(){}},e.exports=i},{}],110:[function(t,e,n){"use strict";e.exports={ForwardRenderer:t("./forward-renderer"),RenderComponentHandle:t("./render-component-handle"),_renderers:t("./renderers")}},{"./forward-renderer":109,"./render-component-handle":111,"./renderers":114}],111:[function(t,e,n){"use strict";function i(t,e){this._device=t,this._camera=e,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0,this.walking=!1}t("./renderers");var r=t("./renderers/utils");i.prototype={constructor:i,reset:function(){var t=this._device._ctx,e=this._device._canvas,n=cc.Camera.main?cc.Camera.main.backgroundColor:cc.color(),i="rgba("+n.r+", "+n.g+", "+n.b+", "+n.a/255+")";t.fillStyle=i,t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._device._stats.drawcalls=0,r.context.reset()},terminate:function(){},_commitComp:function(t,e){var n=this._device._ctx,i=this._camera;n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n.scale(1,-1),e.draw(n,t)}},e.exports=i},{"./renderers":114,"./renderers/utils":122}],112:[function(t,e,n){"use strict";var s=t("../../../../graphics/helper"),i=t("../../../../graphics/types"),r=t("../../../../platform/js"),a=(i.PointFlags,i.LineJoin),o=i.LineCap;function c(){this.cmds=[],this.style={strokeStyle:"black",fillStyle:"white",lineCap:"butt",lineJoin:"miter",miterLimit:10}}var u=c.prototype;r.mixin(u,{moveTo:function(t,e){this.cmds.push(["moveTo",[t,e]])},lineTo:function(t,e){this.cmds.push(["lineTo",[t,e]])},bezierCurveTo:function(t,e,n,i,r,a){this.cmds.push(["bezierCurveTo",[t,e,n,i,r,a]])},quadraticCurveTo:function(t,e,n,i){this.cmds.push(["quadraticCurveTo",[t,e,n,i]])},arc:function(t,e,n,i,r,a){s.arc(this,t,e,n,i,r,a)},ellipse:function(t,e,n,i){s.ellipse(this,t,e,n,i)},circle:function(t,e,n){s.ellipse(this,t,e,n,n)},rect:function(t,e,n,i){this.moveTo(t,e),this.lineTo(t,e+i),this.lineTo(t+n,e+i),this.lineTo(t+n,e),this.close()},roundRect:function(t,e,n,i,r){s.roundRect(this,t,e,n,i,r)},clear:function(){this.cmds.length=0},close:function(){this.cmds.push(["closePath",[]])},stroke:function(){this.cmds.push(["stroke",[]])},fill:function(){this.cmds.push(["fill",[]])}}),r.set(u,"_$strokeColor",function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["strokeStyle",e]),this.style.strokeStyle=e}),r.set(u,"_$fillColor",function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["fillStyle",e]),this.style.fillStyle=e}),r.set(u,"_$lineWidth",function(t){this.cmds.push(["lineWidth",t]),this.style.lineWidth=t}),r.set(u,"_$lineCap",function(t){var e="butt";t===o.BUTT?e="butt":t===o.ROUND?e="round":t===o.SQUARE&&(e="square"),this.cmds.push(["lineCap",e]),this.style.lineCap=e}),r.set(u,"_$lineJoin",function(t){var e="bevel";t===a.BEVEL?e="bevel":t===a.ROUND?e="round":t===a.MITER&&(e="miter"),this.cmds.push(["lineJoin",e]),this.style.lineJoin=e}),r.set(u,"_$miterLimit",function(t){this.cmds.push(["miterLimit",t]),this.style.miterLimit=t}),e.exports=c},{"../../../../graphics/helper":70,"../../../../graphics/types":72,"../../../../platform/js":101}],113:[function(t,e,n){"use strict";var i=t("./impl");e.exports={createImpl:function(){return new i},draw:function(t,e){var n=e.node,i=n._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13;t.transform(r,a,s,o,c,u),t.save(),t.globalAlpha=n.opacity/255;var l=e._impl.style;t.strokeStyle=l.strokeStyle,t.fillStyle=l.fillStyle,t.lineWidth=l.lineWidth,t.lineJoin=l.lineJoin,t.miterLimit=l.miterLimit;for(var h=!0,f=e._impl.cmds,d=0,_=f.length;d<_;d++){var m=f[d],p=m[0],v=m[1];"moveTo"===p&&h?(t.beginPath(),h=!1):"fill"!==p&&"stroke"!==p&&"fillRect"!==p||(h=!0),"function"==typeof t[p]?t[p].apply(t,v):t[p]=v}return t.restore(),1},stroke:function(t){t._impl.stroke()},fill:function(t){t._impl.fill()}}},{"./impl":112}],114:[function(t,e,n){"use strict";var r=t("../../../platform/js"),i=t("../../../components/CCSprite"),a=t("../../../components/CCLabel"),s=t("../../../components/CCMask"),o=t("../../../graphics/graphics"),c=t("./sprite"),u=t("./label"),l=t("./graphics"),h=t("./mask"),f={},d={};function _(t,e,n){var i=r.getClassName(t);f[i]=e,n&&(d[i]=n),t._assembler=e,t._postAssembler=n}_(i,c),_(a,u),s&&_(s,h.beforeHandler,h.afterHandler),o&&_(o,l),e.exports={map:f,postMap:d,addRenderer:_}},{"../../../components/CCLabel":40,"../../../components/CCMask":43,"../../../components/CCSprite":48,"../../../graphics/graphics":69,"../../../platform/js":101,"./graphics":113,"./label":115,"./mask":117,"./sprite":118}],115:[function(t,e,n){"use strict";var i=t("../../../../components/CCLabel"),r=t("./ttf"),a={pool:[],get:function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),n=e.getContext("2d");t={canvas:e,context:n}}return t},put:function(t){32<=this.pool.length||this.pool.push(t)}};i._canvasPool=a,e.exports={getAssembler:function(t){var e=r;return t.font instanceof cc.BitmapFont&&(e=b8e.bmfontAssemblerCanvas),e},createData:function(t){return t._assembler.createData(t)},draw:function(t,e){if(!e._texture)return 0;var n=e._assembler;return n?(n.updateRenderData(e),n.draw(t,e)):0}}},{"../../../../components/CCLabel":40,"./ttf":116}],116:[function(t,e,n){"use strict";var i=t("../../../utils/label/ttf"),r=t("../../../../platform/js"),v=t("../utils");e.exports=r.addon({createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e},_updateVerts:function(t){var e=t._renderData,n=t.node,i=n.width,r=n.height,a=n.anchorX*i,s=n.anchorY*r,o=e._data;o[0].x=-a,o[0].y=-s,o[1].x=i-a,o[1].y=r-s},_updateTexture:function(t){i._updateTexture(t);var e=t._frame._texture;v.dropColorizedImage(e,t.node.color)},draw:function(t,e){var n=e.node,i=n._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13;t.transform(r,a,s,o,c,u),t.scale(1,-1),v.context.setGlobalAlpha(t,n.opacity/255);var l=e._frame._texture,h=e._renderData._data,f=l.getHtmlElementObj(),d=h[0].x,_=h[0].y,m=h[1].x-d,p=h[1].y-_;return _=-_-p,t.drawImage(f,d,_,m,p),1}},i)},{"../../../../platform/js":101,"../../../utils/label/ttf":126,"../utils":122}],117:[function(t,e,n){"use strict";t("../../../components/CCMask");var i=t("./graphics"),r={updateRenderData:function(){},draw:function(t,e){t.save(),i.draw(t,e._graphics._graphics),t.clip()}};e.exports={beforeHandler:r,afterHandler:{updateRenderData:function(){},draw:function(t){t.restore()}}}},{"../../../components/CCMask":43,"./graphics":113}],118:[function(t,e,n){"use strict";var i=t("../../../../components/CCSprite"),r=i.Type,a=i.FillType,s=t("./simple"),o=t("./sliced"),c=t("./tiled");e.exports={getAssembler:function(t){switch(t.type){case r.SIMPLE:return s;case r.SLICED:return o;case r.TILED:return c;case r.FILLED:return t._fillType,a.RADIAL,null}},createData:function(t){return t._assembler.createData(t)}}},{"../../../../components/CCSprite":48,"./simple":119,"./sliced":120,"./tiled":121}],119:[function(t,e,n){"use strict";var b=t("../utils"),i={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e},updateRenderData:function(t){t._material||t._activateMaterial();var e=t._renderData;e.uvDirty&&this.updateUVs(t),e.vertDirty&&this.updateVerts(t)},updateUVs:function(t){var e=t.spriteFrame,n=t._renderData,i=n._data,r=e._rect;if(e._texture,e._rotated){var a=r.x,s=r.height,o=r.y,c=r.width;i[0].u=a,i[0].v=c,i[1].u=s,i[1].v=o}else{var u=r.x,l=r.width,h=r.y,f=r.height;i[0].u=u,i[0].v=h,i[1].u=l,i[1].v=f}n.uvDirty=!1},updateVerts:function(t){var e=t._renderData,n=t.node,i=e._data,r=n.width,a=n.height,s=n.anchorX*r,o=n.anchorY*a,c=void 0,u=void 0,l=void 0,h=void 0;if(t.trim)c=-s,u=-o,l=r,h=a;else{var f=t.spriteFrame,d=f._originalSize.width,_=f._originalSize.height,m=f._rect.width,p=f._rect.height,v=f._offset,y=r/d,g=a/_,x=v.x+(d-m)/2,b=(v.x,v.y+(_-p)/2);v.y,c=x*y-s,u=b*g-o,l=r,h=a}i[0].x=c,i[0].y=u,i[1].x=l,i[1].y=h,e.vertDirty=!1},draw:function(t,e){var n=e.node,i=n._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13;t.transform(r,a,s,o,c,u),t.scale(1,-1),b.context.setGlobalAlpha(t,n.opacity/255);var l=e._spriteFrame._texture,h=e._renderData._data,f=b.getColorizedImage(l,n._color),d=h[0].x,_=h[0].y,m=h[1].x,p=h[1].y;_=-_-p;var v=h[0].u,y=h[0].v,g=h[1].u,x=h[1].v;return t.drawImage(f,v,y,g,x,d,_,m,p),1}};e.exports=i},{"../utils":122}],120:[function(t,e,n){"use strict";var A=t("../utils"),i={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e},updateRenderData:t("./simple").updateRenderData,updateUVs:function(t){var e=t.spriteFrame,n=t._renderData,i=e._rect,r=(e._texture,e.insetLeft),a=e.insetRight,s=i.width-r-a,o=e.insetTop,c=e.insetBottom,u=i.height-o-c,l=n._data;e._rotated?(l[0].u=i.x,l[1].u=c+i.x,l[2].u=c+u+i.x,l[3].u=i.x+i.height,l[3].v=i.y,l[2].v=r+i.y,l[1].v=r+s+i.y,l[0].v=i.y+i.width):(l[0].u=i.x,l[1].u=r+i.x,l[2].u=r+s+i.x,l[3].u=i.x+i.width,l[3].v=i.y,l[2].v=o+i.y,l[1].v=o+u+i.y,l[0].v=i.y+i.height),n.uvDirty=!1},updateVerts:function(t){var e=t._renderData,n=e._data,i=t.node,r=i.width,a=i.height,s=i.anchorX*r,o=i.anchorY*a,c=t.spriteFrame,u=(c._rect,c.insetLeft),l=c.insetRight,h=c.insetTop,f=c.insetBottom,d=r-u-l,_=a-h-f,m=r/(u+l),p=a/(h+f);m=isNaN(m)||1<m?1:m,p=isNaN(p)||1<p?1:p,d=d<0?0:d,_=_<0?0:_,n[0].x=-s,n[0].y=-o,n[1].x=u*m-s,n[1].y=f*p-o,n[2].x=n[1].x+d,n[2].y=n[1].y+_,n[3].x=r-s,n[3].y=a-o,e.vertDirty=!1},draw:function(t,e){var n=e.node,i=n._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13;t.transform(r,a,s,o,c,u),t.scale(1,-1),A.context.setGlobalAlpha(t,n.opacity/255);for(var l=e._spriteFrame._texture,h=e._renderData._data,f=A.getColorizedImage(l,n._color),d=0,_=void 0,m=void 0,p=void 0,v=void 0,y=void 0,g=void 0,x=void 0,b=void 0,E=void 0,C=void 0,w=void 0,S=void 0,T=0;T<3;++T){v=h[T],p=h[T+1];for(var M=0;M<3;++M)_=h[M],m=h[M+1],y=_.x,g=v.y,x=m.x-y,g=-g-(b=p.y-g),E=_.u,C=p.v,w=m.u-E,S=v.v-C,0<w&&0<S&&0<x&&0<b&&(t.drawImage(f,E,C,w,S,y,g,x,b),d++)}return d}};e.exports=i},{"../utils":122,"./simple":119}],121:[function(t,e,n){"use strict";var E=t("../utils"),i={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){t._material||t._activateMaterial()},draw:function(t,e){var n=e.node,i=n._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13;t.transform(r,a,s,o,c,u),t.scale(1,-1),E.context.setGlobalAlpha(t,n.opacity/255);var l=e.spriteFrame,h=l._rect,f=l._texture,d=h.x,_=h.y,m=l._rotated?h.height:h.width,p=l._rotated?h.width:h.height,v=E.getFrameCache(f,n._color,d,_,m,p),y=n.width,g=n.height,x=-n.anchorX*y,b=-n.anchorY*g;return b=-b-g,t.translate(x,b),t.fillStyle=t.createPattern(v,"repeat"),t.fillRect(0,0,y,g),1}};e.exports=i},{"../utils":122}],122:[function(t,e,n){"use strict";function l(t,e,n,i,r,a,s){var o=e._image,c=t.getContext("2d");return t.width=a,t.height=s,c.globalCompositeOperation="source-over",c.fillStyle="rgb("+n.r+","+n.g+","+n.b+")",c.fillRect(0,0,a,s),c.globalCompositeOperation="multiply",c.drawImage(o,i,r,a,s,0,0,a,s),c.globalCompositeOperation="destination-atop",c.drawImage(o,i,r,a,s,0,0,a,s),t}var h={canvasMap:{},canvasUsed:{},canvasPool:[],checking:!1,check:function(){var t=!1;for(var e in this.canvasUsed)if(t=!0,this.canvasUsed[e])this.canvasUsed[e]=!1;else{var n=this.canvasMap[e];n.width=0,n.height=0,this.canvasPool.length<32&&this.canvasPool.push(n),delete this.canvasMap[e],delete this.canvasUsed[e]}t||(cc.director.off(cc.Director.EVENT_AFTER_DRAW,this.check,this),this.checking=!1)},startCheck:function(){cc.director.on(cc.Director.EVENT_AFTER_DRAW,this.check,this),this.checking=!0},getCanvas:function(t){return this.canvasUsed[t]=!0,this.canvasMap[t]},cacheCanvas:function(t,e){this.canvasMap[e]=t,this.canvasUsed[e]=!0,this.checking||this.startCheck()},dropImage:function(t){this.canvasMap[t]&&delete this.canvasMap[t]}};e.exports={getColorizedImage:function(t,e){if(!t)return null;if(0===t.width||0===t.height)return t._image;var n=16777215&e._val;if(16777215==n)return t._image;var i=t.url+n,r=h.getCanvas(i);return r||(l(r=h.canvasPool.pop()||document.createElement("canvas"),t,e,0,0,t.width,t.height),h.cacheCanvas(r,i)),r},getFrameCache:function(t,e,n,i,r,a){if(!t||!t.url||n<0||i<0||r<=0||a<=0)return null;var s=t.url,o=!1,c=16777215&e._val;if(16777215!=c&&(s+=c,o=!0),(0!==n||0!==i&&r!==t.width&&a!==t.height)&&(s+="_"+n+"_"+i+"_"+r+"_"+a,o=!0),!o)return t._image;var u=h.getCanvas(s);return u||(l(u=h.canvasPool.pop()||document.createElement("canvas"),t,e,n,i,r,a),h.cacheCanvas(u,s)),u},dropColorizedImage:function(t,e){var n=t.url+(16777215&e._val);h.dropImage(n)}};var i=-1,r={setGlobalAlpha:function(t,e){i!==e&&(i=e,t.globalAlpha=i)},reset:function(){i=-1}};e.exports.context=r},{}],123:[function(t,e,n){"use strict";function i(t,e){var n=new b8e.RenderTexture2D;n.initWithSize(t,e),n.update(),this._texture=n,this._x=2,this._y=2,this._nexty=2,this._width=t,this._height=e,this._innerTextureInfos={},this._innerSpriteFrames=[]}i.DEFAULT_HASH=null,i.GET_DEFAULT_HASH=function(){return i.DEFAULT_HASH||(i.DEFAULT_HASH=(new b8e.RenderTexture2D)._getHash()),i.DEFAULT_HASH},cc.js.mixin(i.prototype,{insertSpriteFrame:function(t){var e=t._rect,n=t._texture,i=this._innerTextureInfos[n._id],r=e.x,a=e.y;if(i)r+=i.x,a+=i.y;else{var s=n.width,o=n.height;if(this._x+s+2>this._width&&(this._x=2,this._y=this._nexty),this._y+o>this._nexty&&(this._nexty=this._y+o+2),this._nexty>this._height)return null;this._texture.drawTextureAt(n,this._x-1,this._y),this._texture.drawTextureAt(n,this._x+1,this._y),this._texture.drawTextureAt(n,this._x,this._y-1),this._texture.drawTextureAt(n,this._x,this._y+1),this._texture.drawTextureAt(n,this._x,this._y),this._innerTextureInfos[n._id]={x:this._x,y:this._y,texture:n},r+=this._x,a+=this._y,this._x+=s+2,this._dirty=!0}var c={x:r,y:a,texture:this._texture};return this._innerSpriteFrames.push(t),c},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1)},reset:function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,n=t.length;e<n;e++){var i=t[e];i.isValid&&i._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},destroy:function(){this.reset(),this._texture.release(),this._texture=null}}),e.exports=i},{}],124:[function(t,e,n){"use strict";var s=t("./atlas"),o=[],c=-1,u=5,i=2048,l=512;function h(){var t=o[++c];return t||(t=new s(i,i),o.push(t)),t}function r(){a.reset()}var f=!1,a={get enabled(){return f},set enabled(t){f!==t&&(t?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,r)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,r),f=t)},get maxAtlasCount(){return u},set maxAtlasCount(t){u=t},get textureSize(){return i},set textureSize(t){i=t},get maxFrameSize(){return l},set maxFrameSize(t){l=t},insertSpriteFrame:function(t){if(!f||c===u||!t||t._original)return null;var e=t._texture;if(e instanceof b8e.RenderTexture2D||e._isCompressed())return null;var n=e.width,i=e.height;if(l<n||l<i||n<=8||i<=8||e._getHash()!==s.GET_DEFAULT_HASH())return null;var r=o[c],a=(r=r||h()).insertSpriteFrame(t);return a||c===u?a:(r=h()).insertSpriteFrame(t)},reset:function(){for(var t=0,e=o.length;t<e;t++)o[t].destroy();o.length=0,c=-1},update:function(){if(this.enabled)for(var t=0;t<=c;t++)o[t].update()}};e.exports=cc.dynamicAtlasManager=a},{"./atlas":123}],125:[function(t,e,n){"use strict";function i(){this._rect=null,this.uv=[],this._texture=null,this._original=null}i.prototype={constructor:i,getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_refreshTexture:function(t){this._texture=t,this._rect=cc.rect(0,0,t.width,t.height),this._calculateUV()},_calculateUV:function(){var t=this._rect,e=this._texture,n=this.uv,i=e.width,r=e.height,a=0===i?0:t.x/i,s=0===i?0:(t.x+t.width)/i,o=0===r?0:(t.y+t.height)/r,c=0===r?0:t.y/r;n[0]=a,n[1]=o,n[2]=s,n[3]=o,n[4]=a,n[5]=c,n[6]=s,n[7]=c}},e.exports=i},{}],126:[function(t,e,n){"use strict";var u=t("../../../platform/CCMacro"),m=t("../../../utils/text-utils"),i=(t("../../../components/CCComponent"),t("../../../components/CCLabel")),r=t("../../../components/CCLabelOutline"),a=t("../../../components/CCLabelShadow"),p=i.Overflow,l=(1/255).toFixed(3),v=null,h=null,f=null,y="",g="",x=0,b=0,d=[],E=cc.Size.ZERO,s=0,_=0,o=0,C=null,c="",w=p.NONE,S=!1,T=null,M=cc.Color.WHITE,A=null,O=cc.Color.BLACK,R=cc.rect(),D=cc.Size.ZERO,N=cc.Size.ZERO,L=!1,I=!1,P=!1,k=0,F=cc.Vec2.ZERO,z=0,B=void 0;e.exports={_getAssemblerData:function(){return(B=i._canvasPool.get()).canvas.width=B.canvas.height=1,B},_resetAssemblerData:function(t){t&&i._canvasPool.put(t)},updateRenderData:function(t){t._renderData.vertDirty&&(b8e.ttfUpdateRenderData(this,t),t._actualFontSize=x,t.node.setContentSize(N),this._updateVerts(t),t._renderData.vertDirty=t._renderData.uvDirty=!1,f=h=v=null)},_updateVerts:function(){},_updateFontFamily:function(t){c=t.useSystemFont?t.fontFamily:t.font?t.font._nativeAsset?t.font._nativeAsset:t.font.nativeUrl?cc.loader.getRes(t.font.nativeUrl):"undefined"!=typeof b8e&&b8e.macro?b8e.macro.DEFAULT_FONT_FAMILY:"Arial":"undefined"!=typeof b8e&&b8e.macro?b8e.macro.DEFAULT_FONT_FAMILY:"Arial"},_updatePaddingRect:function(){var t=0,e=0,n=0,i=0,r=0;if(D.width=D.height=0,T&&(t=e=n=i=r=T.width,D.width=D.height=2*r),A){var a=A.blur+r;n=Math.max(n,-A._offset.x+a),i=Math.max(i,A._offset.x+a),t=Math.max(t,A._offset.y+a),e=Math.max(e,-A._offset.y+a)}if(I){var s=b*Math.tan(.20943951);i+=s,D.width+=s}R.x=n,R.y=t,R.width=n+i,R.height=t+e},_updateProperties:function(t){var e=t._assemblerData;v=e.context,h=e.canvas,f=t._frame._original?t._frame._original._texture:t._frame._texture,g=t.string.toString(),x=t._fontSize,k=(b=x)/8,w=t.overflow,E.width=t.node.width,E.height=t.node.height,N=t.node.getContentSize(),s=t._lineHeight,_=t.horizontalAlign,o=t.verticalAlign,C=t.node.color,L=t._isBold,I=t._isItalic,P=t._isUnderline,S=w!==p.NONE&&(w===p.RESIZE_HEIGHT||t.enableWrapText),(T=(T=r&&t.getComponent(r))&&T.enabled&&0<T.width?T:null)&&(M.set(T.color),M.a=M.a*t.node.color.a/255),(A=(A=a&&t.getComponent(a))&&A.enabled?A:null)&&(O.set(A.color),O.a=O.a*t.node.color.a/255),this._updatePaddingRect()},_calculateFillTextStartPosition:function(){var t=0;_===u.TextAlignment.RIGHT?t=E.width-R.width:_===u.TextAlignment.CENTER&&(t=(E.width-R.width)/2);var e=0,n=this._getLineHeight()*(d.length-1);return e=o===u.VerticalTextAlignment.TOP?x:o===u.VerticalTextAlignment.CENTER?.5*(E.height-n)+x*m.MIDDLE_RATIO-R.height/2:E.height-n-x*m.BASELINE_RATIO-R.height,e+=2,cc.v2(t+R.x,e+R.y)},_setupOutline:function(){v.strokeStyle="rgba("+M.r+", "+M.g+", "+M.b+", "+M.a/255+")",v.lineWidth=2*T.width},_setupShadow:function(){v.shadowColor="rgba("+O.r+", "+O.g+", "+O.b+", "+O.a/255+")",v.shadowBlur=A.blur,v.shadowOffsetX=A.offset.x,v.shadowOffsetY=-A.offset.y},_drawUnderline:function(t){T&&(this._setupOutline(),v.strokeRect(F.x,F.y,t,k)),v.lineWidth=k,v.fillStyle="rgba("+C.r+", "+C.g+", "+C.b+", "+C.a/255+")",v.fillRect(F.x,F.y,t,k)},_updateTexture:function(){v.clearRect(0,0,h.width,h.height);var t=T?M:C;v.fillStyle="rgba("+t.r+", "+t.g+", "+t.b+", "+l+")",v.fillRect(0,0,h.width,h.height),v.font=y;var e=this._calculateFillTextStartPosition(),n=this._getLineHeight();v.lineJoin="round",v.fillStyle="rgba("+C.r+", "+C.g+", "+C.b+", 1)";var i=1<d.length,r=this._measureText(v),a=0,s=0;A&&this._setupShadow(),T&&this._setupOutline();for(var o=0;o<d.length;++o)a=e.x,s=e.y+o*n,A&&i&&(T&&v.strokeText(d[o],a,s),v.fillText(d[o],a,s)),P&&(z=r(d[o]),_===u.TextAlignment.RIGHT?F.x=e.x-z:_===u.TextAlignment.CENTER?F.x=e.x-z/2:F.x=e.x,F.y=s,this._drawUnderline(z));A&&i&&(v.shadowColor="transparent");for(var c=0;c<d.length;++c)a=e.x,s=e.y+c*n,T&&v.strokeText(d[c],a,s),v.fillText(d[c],a,s);A&&(v.shadowColor="transparent"),f.handleLoadedTexture()},_calDynamicAtlas:function(t){if(t.cacheMode===i.CacheMode.BITMAP){var e=t._frame;e._original||e.setRect(cc.rect(0,0,h.width,h.height))}},_updateLabelDimensions:function(){var t=g.split("\n");if(w===p.RESIZE_HEIGHT){var e=(d.length+m.BASELINE_RATIO)*this._getLineHeight();E.height=e+R.height,N.height=e+D.height}else if(w===p.NONE){d=t;for(var n=0,i=0,r=0;r<t.length;++r){var a=m.safeMeasureText(v,t[r]);n=a<n?n:a}i=(d.length+m.BASELINE_RATIO)*this._getLineHeight();var s=parseFloat(n.toFixed(2)),o=parseFloat(i.toFixed(2));E.width=s+R.width,E.height=o+R.height,N.width=s+D.width,N.height=o+D.height}E.width=Math.min(E.width,2048),E.height=Math.min(E.height,2048),h.width===E.width&&!CC_QQPLAY||(h.width=E.width),h.height!==E.height&&(h.height=E.height)},_calculateTextBaseline:function(){this._node;var t;t=_===u.TextAlignment.RIGHT?"right":_===u.TextAlignment.CENTER?"center":"left",v.textAlign=t,v.textBaseline="alphabetic"},_calculateSplitedStrings:function(){var t=g.split("\n");if(S){d=[];for(var e=N.width,n=0;n<t.length;++n){var i=m.safeMeasureText(v,t[n]),r=m.fragmentText(t[n],i,e,this._measureText(v));d=d.concat(r)}}else d=t},_getFontDesc:function(){var t=x.toString()+"px ";return t+=c,L&&(t="bold "+t),I&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===s?x:s*x/b)},_calculateParagraphLength:function(t,e){for(var n=[],i=0;i<t.length;++i){var r=m.safeMeasureText(e,t[i]);n.push(r)}return n},_measureText:function(e){return function(t){return m.safeMeasureText(e,t)}},_calculateLabelFont:function(){if(y=this._getFontDesc(),v.font=y,w===p.SHRINK){var t=g.split("\n"),e=this._calculateParagraphLength(t,v),n=0,i=0,r=0;if(S){var a=N.width,s=N.height;if(a<0||s<0)return y=this._getFontDesc(),void(v.font=y);i=s+1,r=a+1;for(var o=x+1,c="",u=!0,l=0|o;(s<i||a<r)&&(u?o=l/2|0:l=o=l-1,!(o<=0));){for(x=o,y=this._getFontDesc(),v.font=y,n=i=0;n<t.length;++n){var h=0,f=m.safeMeasureText(v,t[n]);for(c=m.fragmentText(t[n],f,a,this._measureText(v));h<c.length;)r=m.safeMeasureText(v,c[h]),i+=this._getLineHeight(),++h}u&&(s<i?l=0|o:(u=!1,i=s+1))}}else{for(i=t.length*this._getLineHeight(),n=0;n<t.length;++n)r<e[n]&&(r=e[n]);var d=(E.width-R.width)/r,_=E.height/i;x=b*Math.min(1,d,_)|0,y=this._getFontDesc(),v.font=y}}}}},{"../../../components/CCComponent":38,"../../../components/CCLabel":40,"../../../components/CCLabelOutline":41,"../../../components/CCLabelShadow":42,"../../../platform/CCMacro":86,"../../../utils/text-utils":169}],127:[function(t,e,n){"use strict";var i=t("./dynamic-atlas/manager");e.exports={packToDynamicAtlas:function(t,e){if(e){if(!e._original&&i){var n=i.insertSpriteFrame(e);n&&e._setDynamicAtlasFrame(n)}t.sharedMaterials[0].getProperty("texture")!==e._texture&&t._activateMaterial()}}}},{"./dynamic-atlas/manager":124}],128:[function(t,e,n){"use strict";e.exports={datas:[]}},{}],129:[function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,r,a,s,o,c,u,l=e&&e.length,h=l?e[0]*n:t.length,f=m(t,0,h,n,!0),d=[];if(!f)return d;if(l&&(f=v(t,e,f,n)),t.length>80*n){i=a=t[0],r=s=t[1];for(var _=n;_<h;_+=n)(o=t[_])<i&&(i=o),(c=t[_+1])<r&&(r=c),a<o&&(a=o),s<c&&(s=c);u=Math.max(a-i,s-r)}return p(f,d,n,i,r,u),d}function m(t,e,n,i,r){var a,s;if(r===0<D(t,e,n,i))for(a=e;a<n;a+=i)s=A(a,t[a],t[a+1],s);else for(a=n-i;e<=a;a-=i)s=A(a,t[a],t[a+1],s);return s&&o(s,s.next)&&(O(s),s=s.next),s}function l(t,e){if(!t)return t;e=e||t;var n,i=t;do{if(n=!1,i.steiner||!o(i,i.next)&&0!==C(i.prev,i,i.next))i=i.next;else{if(O(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function p(t,e,n,i,r,a,s){if(t){!s&&a&&y(t,i,r,a);for(var o,c,u=t;t.prev!==t.next;)if(o=t.prev,c=t.next,a?f(t,i,r,a):h(t))e.push(o.i/n),e.push(t.i/n),e.push(c.i/n),O(t),t=c.next,u=c.next;else if((t=c)===u){s?1===s?p(t=d(t,e,n),e,n,i,r,a,2):2===s&&_(t,e,n,i,r,a):p(l(t),e,n,i,r,a,1);break}}}function h(t){var e=t.prev,n=t,i=t.next;if(0<=C(e,n,i))return!1;for(var r=t.next.next;r!==t.prev;){if(b(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&0<=C(r.prev,r,r.next))return!1;r=r.next}return!0}function f(t,e,n,i){var r=t.prev,a=t,s=t.next;if(0<=C(r,a,s))return!1;for(var o=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,c=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,u=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,l=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,h=g(o,c,e,n,i),f=g(u,l,e,n,i),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&b(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&b(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return!1;d=d.prevZ}return!0}function d(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!o(r,a)&&s(r,i,i.next,a)&&S(r,a)&&S(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),O(i),O(i.next),i=t=a),i=i.next}while(i!==t);return i}function _(t,e,n,i,r,a){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&E(s,o)){var c=M(s,o);return s=l(s,s.next),c=l(c,c.next),p(s,e,n,i,r,a),void p(c,e,n,i,r,a)}o=o.next}s=s.next}while(s!==t)}function v(t,e,n,i){var r,a,s,o=[];for(r=0,a=e.length;r<a;r++)(s=m(t,e[r]*i,r<a-1?e[r+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),o.push(x(s));for(o.sort(c),r=0;r<o.length;r++)u(o[r],n),n=l(n,n.next);return n}function c(t,e){return t.x-e.x}function u(t,e){if(e=r(t,e)){var n=M(e,t);l(n,n.next)}}function r(t,e){var n,i=e,r=t.x,a=t.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&s<o){if((s=o)===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===s)return n.prev;var c,u=n,l=n.x,h=n.y,f=1/0;for(i=n.next;i!==u;)r>=i.x&&i.x>=l&&b(a<h?r:s,a,l,h,a<h?s:r,a,i.x,i.y)&&((c=Math.abs(a-i.y)/(r-i.x))<f||c===f&&i.x>n.x)&&S(i,t)&&(n=i,f=c),i=i.next;return n}function y(t,e,n,i){for(var r=t;null===r.z&&(r.z=g(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,a(r)}function a(t){var e,n,i,r,a,s,o,c,u=1;do{for(n=t,a=t=null,s=0;n;){for(s++,i=n,e=o=0;e<u&&(o++,i=i.nextZ);e++);for(c=u;0<o||0<c&&i;)0===o?(i=(r=i).nextZ,c--):0!==c&&i?n.z<=i.z?(n=(r=n).nextZ,o--):(i=(r=i).nextZ,c--):(n=(r=n).nextZ,o--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(1<s);return t}function g(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function x(t){for(var e=t,n=t;e.x<n.x&&(n=e),(e=e.next)!==t;);return n}function b(t,e,n,i,r,a,s,o){return 0<=(r-s)*(e-o)-(t-s)*(a-o)&&0<=(t-s)*(i-o)-(n-s)*(e-o)&&0<=(n-s)*(a-o)-(r-s)*(i-o)}function E(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!w(t,e)&&S(t,e)&&S(e,t)&&T(t,e)}function C(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function o(t,e){return t.x===e.x&&t.y===e.y}function s(t,e,n,i){return!!(o(t,e)&&o(n,i)||o(t,i)&&o(n,e))||0<C(t,e,n)!=0<C(t,e,i)&&0<C(n,i,t)!=0<C(n,i,e)}function w(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&s(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function S(t,e){return C(t.prev,t,t.next)<0?0<=C(t,e,t.next)&&0<=C(t,t.prev,e):C(t,e,t.prev)<0||C(t,t.next,e)<0}function T(t,e){for(var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;n.y>a!=n.next.y>a&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),(n=n.next)!==t;);return i}function M(t,e){var n=new R(t.i,t.x,t.y),i=new R(e.i,e.x,e.y),r=t.next,a=e.prev;return(t.next=e).prev=t,(n.next=r).prev=n,(i.next=n).prev=i,(a.next=i).prev=a,i}function A(t,e,n,i){var r=new R(t,e,n);return i?(r.next=i.next,(r.prev=i).next.prev=r,i.next=r):(r.prev=r).next=r,r}function O(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function R(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(t,e,n,i){for(var r=0,a=e,s=n-i;a<n;a+=i)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r}(e.exports=i).deviation=function(t,e,n,i){var r=e&&e.length,a=r?e[0]*n:t.length,s=Math.abs(D(t,0,a,n));if(r)for(var o=0,c=e.length;o<c;o++){var u=e[o]*n,l=o<c-1?e[o+1]*n:t.length;s-=Math.abs(D(t,u,l,n))}var h=0;for(o=0;o<i.length;o+=3){var f=i[o]*n,d=i[o+1]*n,_=i[o+2]*n;h+=Math.abs((t[f]-t[_])*(t[1+d]-t[1+f])-(t[f]-t[d])*(t[1+_]-t[1+f]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var s=0;s<e;s++)n.vertices.push(t[r][a][s]);0<r&&(i+=t[r-1].length,n.holes.push(i))}return n}},{}],130:[function(t,e,n){"use strict";var c=t("../../../../graphics/helper"),u=t("../../../../graphics/types").PointFlags,o=cc.Class({name:"cc.GraphicsPoint",extends:cc.Vec2,ctor:function(){this.reset()},reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}});function i(){this.reset()}function r(t){this._tessTol=.25,this._distTol=.01,this._updatePathOffset=!1,this._paths=null,this._pathLength=0,this._pathOffset=0,this._points=null,this._pointsOffset=0,this._commandx=0,this._commandy=0,this._paths=[],this._points=[],this._renderDatas=[],this._dataOffset=0}cc.js.mixin(i.prototype,{reset:function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]}}),cc.js.mixin(r.prototype,{moveTo:function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,u.PT_CORNER),this._commandx=t,this._commandy=e},lineTo:function(t,e){this._addPoint(t,e,u.PT_CORNER),this._commandx=t,this._commandy=e},bezierCurveTo:function(t,e,n,i,r,a){var s=this._curPath,o=s.points[s.points.length-1];o.x!==t||o.y!==e||n!==r||i!==a?(c.tesselateBezier(this,o.x,o.y,t,e,n,i,r,a,0,u.PT_CORNER),this._commandx=r,this._commandy=a):this.lineTo(r,a)},quadraticCurveTo:function(t,e,n,i){var r=this._commandx,a=this._commandy;this.bezierCurveTo(r+2/3*(t-r),a+2/3*(e-a),n+2/3*(t-n),i+2/3*(e-i),n,i)},arc:function(t,e,n,i,r,a){c.arc(this,t,e,n,i,r,a)},ellipse:function(t,e,n,i){c.ellipse(this,t,e,n,i),this._curPath.complex=!1},circle:function(t,e,n){c.ellipse(this,t,e,n,n),this._curPath.complex=!1},rect:function(t,e,n,i){this.moveTo(t,e),this.lineTo(t,e+i),this.lineTo(t+n,e+i),this.lineTo(t+n,e),this.close(),this._curPath.complex=!1},roundRect:function(t,e,n,i,r){c.roundRect(this,t,e,n,i,r),this._curPath.complex=!1},clear:function(t,e){this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._dataOffset=0,this._curPath=null;var n=this._renderDatas;if(e){this._paths.length=0;for(var i=this._points.length=0,r=n.length;i<r;i++){var a=n[i];a.meshbuffer.destroy(),a.meshbuffer=null}n.length=0}else for(var s=0,o=n.length;s<o;s++)n[s].meshbuffer.reset()},close:function(){this._curPath.closed=!0},_addPath:function(){var t=this._pathLength,e=this._paths[t];return e?e.reset():(e=new i,this._paths.push(e)),this._pathLength++,this._curPath=e},_addPoint:function(t,e,n){var i=this._curPath;if(i){var r,a=this._points,s=i.points;(r=a[this._pointsOffset++])?(r.x=t,r.y=e):(r=new o(t,e),a.push(r)),r.flags=n,s.push(r)}},requestRenderData:function(){var t=b8e.GFXVertexFormat.getVfmtPosColor(),e=new b8e.IARenderData,n=new b8e.MeshBuffer(b8e.renderer._handle,t);e.meshbuffer=n,this._renderDatas.push(e);var i=new b8e.InputAssembler;return i._vertexBuffer=n._vb,i._indexBuffer=n._ib,i._start=0,e.ia=i,e},getRenderDatas:function(){return 0===this._renderDatas.length&&this.requestRenderData(),this._renderDatas}}),e.exports=r},{"../../../../graphics/helper":70,"../../../../graphics/types":72}],131:[function(t,e,n){"use strict";var i=t("../../../../graphics/graphics"),F=t("../../../../graphics/types").PointFlags,z=i.LineJoin,B=i.LineCap,T=t("./earcut"),r=t("./impl"),H=Math.PI,b=Math.min,E=Math.max,P=Math.ceil,a=Math.acos,k=Math.cos,U=Math.sin,j=Math.atan2,G=(Math.abs,null),V=null,s=0;function W(t,e,n){var i=2*a(t/(t+n));return E(2,P(e/i))}function q(t,e,n){return t<e?e:n<t?n:t}var o={createImpl:function(t){return new r(t)},updateRenderData:function(t){for(var e=t._impl.getRenderDatas(),n=0,i=e.length;n<i;n++)e[n].material=t.sharedMaterials[0]},fillBuffers:function(t,e){e._flush();var n=e.node;e.node=t.node,this.renderIA(t,e),e.node=n},renderIA:function(t,e){for(var n=t._impl.getRenderDatas(),i=0,r=n.length;i<r;i++){var a=n[i],s=a.meshbuffer;a.ia._count=s.indiceStart,e._flushIA(a),s.uploadData()}},genRenderData:function(t,e){var n=V.getRenderDatas(),i=n[V._dataOffset],r=i.meshbuffer,a=r.vertexStart+e;return(65535<a||131070<3*a)&&(++V._dataOffset,a=e,V._dataOffset<n.length?i=n[V._dataOffset]:(i=V.requestRenderData(t),n[V._dataOffset]=i),i.material=t.sharedMaterials[0],r=i.meshbuffer),a>r.vertexOffset&&r.requestStatic(e,3*e),i},stroke:function(t){s=t._strokeColor._val,this._flattenPaths(t._impl),this._expandStroke(t),t._impl._updatePathOffset=!0},fill:function(t){s=t._fillColor._val,this._expandFill(t),t._impl._updatePathOffset=!0},_expandStroke:function(t){var e=.5*t.lineWidth,n=t.lineCap,i=t.lineJoin,r=t.miterLimit;V=t._impl;var a=W(e,H,V._tessTol);this._calculateJoins(V,e,i,r);for(var s=V._paths,o=0,c=V._pathOffset,u=V._pathLength;c<u;c++){var l=s[c],h=l.points.length;i===z.ROUND?o+=2*(h+l.nbevel*(a+2)+1):o+=2*(h+5*l.nbevel+1),l.closed||(n===B.ROUND?o+=2*(2*a+2):o+=12)}for(var f=(G=this.genRenderData(t,o)).meshbuffer,d=f._vData,_=f._iData,m=V._pathOffset,p=V._pathLength;m<p;m++){var v,y,g=s[m],x=g.points,b=x.length,E=f.vertexStart,C=void 0,w=void 0,S=void 0;if(y=(v=g.closed)?(C=x[b-1],w=x[0],S=0,b):(C=x[0],w=x[1],b-(S=1)),!v){var T=w.sub(C);T.normalizeSelf();var M=T.x,A=T.y;n===B.BUTT?this._buttCap(C,M,A,e,0):n===B.SQUARE?this._buttCap(C,M,A,e,e):n===B.ROUND&&this._roundCapStart(C,M,A,e,a)}for(var O=S;O<y;++O)i===z.ROUND?this._roundJoin(C,w,e,e,a):0!=(w.flags&(F.PT_BEVEL|F.PT_INNERBEVEL))?this._bevelJoin(C,w,e,e):(this._vset(w.x+w.dmx*e,w.y+w.dmy*e),this._vset(w.x-w.dmx*e,w.y-w.dmy*e)),C=w,w=x[O+1];if(v){var R=3*E;this._vset(d[R],d[1+R]),this._vset(d[3+R],d[4+R])}else{var D=w.sub(C);D.normalizeSelf();var N=D.x,L=D.y;n===B.BUTT?this._buttCap(w,N,L,e,0):n===B.BUTT||n===B.SQUARE?this._buttCap(w,N,L,e,e):n===B.ROUND&&this._roundCapEnd(w,N,L,e,a)}for(var I=f.indiceStart,P=E+2,k=f.vertexStart;P<k;P++)_[I++]=P-2,_[I++]=P-1,_[I++]=P;f.indiceStart=I}V=G=null},_expandFill:function(t){for(var e=(V=t._impl)._paths,n=0,i=V._pathOffset,r=V._pathLength;i<r;i++)n+=e[i].points.length;for(var a=(G=this.genRenderData(t,n)).meshbuffer,s=a._vData,o=a._iData,c=V._pathOffset,u=V._pathLength;c<u;c++){var l=e[c],h=l.points,f=h.length;if(0!==f){for(var d=a.vertexStart,_=0;_<f;++_)this._vset(h[_].x,h[_].y);var m=a.indiceStart;if(l.complex){for(var p=[],v=d,y=a.vertexStart;v<y;v++){var g=3*v;p.push(s[g]),p.push(s[1+g])}var x=T(p,null,2);if(!x||0===x.length)continue;for(var b=0,E=x.length;b<E;b++)o[m++]=x[b]+d}else for(var C=d,w=d+2,S=a.vertexStart;w<S;w++)o[m++]=C,o[m++]=w-1,o[m++]=w;a.indiceStart=m}}V=G=null},_calculateJoins:function(t,e,n,i){var r=0;0<e&&(r=1/e);for(var a=t._paths,s=t._pathOffset,o=t._pathLength;s<o;s++)for(var c=a[s],u=c.points,l=u.length,h=u[l-1],f=u[0],d=c.nbevel=0;d<l;d++){var _,m,p=h.dy,v=-h.dx,y=f.dy,g=-f.dx;if(f.dmx=.5*(p+y),f.dmy=.5*(v+g),1e-6<(_=f.dmx*f.dmx+f.dmy*f.dmy)){var x=1/_;600<x&&(x=600),f.dmx*=x,f.dmy*=x}0<f.dx*h.dy-h.dx*f.dy&&(f.flags|=F.PT_LEFT),_*(m=E(11,b(h.len,f.len)*r))*m<1&&(f.flags|=F.PT_INNERBEVEL),f.flags&F.PT_CORNER&&(_*i*i<1||n===z.BEVEL||n===z.ROUND)&&(f.flags|=F.PT_BEVEL),0!=(f.flags&(F.PT_BEVEL|F.PT_INNERBEVEL))&&c.nbevel++,h=f,f=u[d+1]}},_flattenPaths:function(t){for(var e=t._paths,n=t._pathOffset,i=t._pathLength;n<i;n++){var r=e[n],a=r.points,s=a[a.length-1],o=a[0];s.equals(o)&&(r.closed=!0,a.pop(),s=a[a.length-1]);for(var c=0,u=a.length;c<u;c++){var l=o.sub(s);s.len=l.mag(),(l.x||l.y)&&l.normalizeSelf(),s.dx=l.x,s.dy=l.y,s=o,o=a[c+1]}}},_chooseBevel:function(t,e,n,i){var r=n.x,a=n.y,s=void 0,o=void 0,c=void 0,u=void 0;return 0!==t?(s=r+e.dy*i,o=a-e.dx*i,c=r+n.dy*i,u=a-n.dx*i):(s=c=r+n.dmx*i,o=u=a+n.dmy*i),[s,o,c,u]},_buttCap:function(t,e,n,i,r){var a=t.x-e*r,s=t.y-n*r,o=n,c=-e;this._vset(a+o*i,s+c*i),this._vset(a-o*i,s-c*i)},_roundCapStart:function(t,e,n,i,r){for(var a=t.x,s=t.y,o=n,c=-e,u=0;u<r;u++){var l=u/(r-1)*H,h=k(l)*i,f=U(l)*i;this._vset(a-o*h-e*f,s-c*h-n*f),this._vset(a,s)}this._vset(a+o*i,s+c*i),this._vset(a-o*i,s-c*i)},_roundCapEnd:function(t,e,n,i,r){var a=t.x,s=t.y,o=n,c=-e;this._vset(a+o*i,s+c*i),this._vset(a-o*i,s-c*i);for(var u=0;u<r;u++){var l=u/(r-1)*H,h=k(l)*i,f=U(l)*i;this._vset(a,s),this._vset(a-o*h+e*f,s-c*h+n*f)}},_roundJoin:function(t,e,n,i,r){var a=t.dy,s=-t.dx,o=e.dy,c=-e.dx,u=e.x,l=e.y;if(0!=(e.flags&F.PT_LEFT)){var h=this._chooseBevel(e.flags&F.PT_INNERBEVEL,t,e,n),f=h[0],d=h[1],_=h[2],m=h[3],p=j(-s,-a),v=j(-c,-o);p<v&&(v-=2*H),this._vset(f,d),this._vset(u-a*i,e.y-s*i);for(var y=q(P((p-v)/H)*r,2,r),g=0;g<y;g++){var x=p+g/(y-1)*(v-p),b=u+k(x)*i,E=l+U(x)*i;this._vset(u,l),this._vset(b,E)}this._vset(_,m),this._vset(u-o*i,l-c*i)}else{var C=this._chooseBevel(e.flags&F.PT_INNERBEVEL,t,e,-i),w=C[0],S=C[1],T=C[2],M=C[3],A=j(s,a),O=j(c,o);O<A&&(O+=2*H),this._vset(u+a*i,l+s*i),this._vset(w,S);for(var R=q(P((O-A)/H)*r,2,r),D=0;D<R;D++){var N=A+D/(R-1)*(O-A),L=u+k(N)*n,I=l+U(N)*n;this._vset(L,I),this._vset(u,l)}this._vset(u+o*i,l+c*i),this._vset(T,M)}},_bevelJoin:function(t,e,n,i){var r=void 0,a=void 0,s=void 0,o=void 0,c=void 0,u=void 0,l=void 0,h=void 0,f=t.dy,d=-t.dx,_=e.dy,m=-e.dx;if(e.flags&F.PT_LEFT){var p=this._chooseBevel(e.flags&F.PT_INNERBEVEL,t,e,n);c=p[0],u=p[1],l=p[2],h=p[3],this._vset(c,u),this._vset(e.x-f*i,e.y-d*i),this._vset(l,h),this._vset(e.x-_*i,e.y-m*i)}else{var v=this._chooseBevel(e.flags&F.PT_INNERBEVEL,t,e,-i);r=v[0],a=v[1],s=v[2],o=v[3],this._vset(e.x+f*n,e.y+d*n),this._vset(r,a),this._vset(e.x+_*n,e.y+m*n),this._vset(s,o)}},_vset:function(t,e){var n=G.meshbuffer,i=3*n.vertexStart,r=n._vData,a=n._uintVData;r[i]=t,r[1+i]=e,a[2+i]=s,n.vertexStart++,n._dirty=!0}};i._assembler=o,e.exports=o},{"../../../../graphics/graphics":69,"../../../../graphics/types":72,"./earcut":129,"./impl":130}],132:[function(t,e,n){"use strict";t("./sprite"),t("./mask-assembler"),t("./graphics"),t("./label"),t("./motion-streak")},{"./graphics":131,"./label":135,"./mask-assembler":136,"./motion-streak":137,"./sprite":150}],133:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../../../../utils/label/ttf"),d=t("../../../../../components/CCLabelShadow"),a=t("../../utils").fillMeshVertices,s=cc.color(255,255,255,255);e.exports=i.addon({createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indiceCount=6,e},fillBuffers:function(t,e){var n=t.node;s._fastSetA(n.color.a),a(n,e._meshBuffer,t._renderData,s._val)},_updateVerts:function(t){var e=t._renderData,n=t._frame.uv,i=t.node,r=t._ttfTexture.width,a=t._ttfTexture.height,s=i.anchorX*i.width,o=i.anchorY*i.height,c=d&&t.getComponent(d);if(c&&c._enabled){var u=(r-i.width)/2,l=(a-i.height)/2,h=c.offset;-h.x>u?s+=r-i.width:u>h.x&&(s+=u-h.x),-h.y>l?o+=a-i.height:l>h.y&&(o+=l-h.y)}var f=e._data;f[0].x=-s,f[0].y=-o,f[1].x=r-s,f[1].y=-o,f[2].x=-s,f[2].y=a-o,f[3].x=r-s,f[3].y=a-o,f[0].u=n[0],f[0].v=n[1],f[1].u=n[2],f[1].v=n[3],f[2].u=n[4],f[2].v=n[5],f[3].u=n[6],f[3].v=n[7]}},r)},{"../../../../../components/CCLabelShadow":42,"../../../../../platform/js":101,"../../../../utils/label/ttf":126,"../../utils":151}],134:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/ttf"),a=t("../../utils").fillMeshVertices3D,s=cc.color(255,255,255,255);e.exports=i.addon({fillBuffers:function(t,e){var n=t.node;s._fastSetA(n.color.a),a(t.node,e._meshBuffer3D,t._renderData,s._val)}},r)},{"../../../../../platform/js":101,"../../utils":151,"../2d/ttf":133}],135:[function(t,e,n){"use strict";var i=t("../../../../components/CCLabel"),r=(t("./2d/ttf"),t("./3d/ttf"),{pool:[],get:function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),n=e.getContext("2d");t={canvas:e,context:n}}return t},put:function(t){32<=this.pool.length||this.pool.push(t)}}),a={getAssembler:function(t){return t.font instanceof cc.BitmapFont?b8e.bmfontAssembler:b8e.letterAssembler},updateRenderData:function(t){return t.__allocedDatas}};i._assembler=a,i._canvasPool=r,e.exports=a},{"../../../../components/CCLabel":40,"./2d/ttf":133,"./3d/ttf":134}],136:[function(t,e,n){"use strict";var o=t("../../../components/CCMask"),c=t("./sprite/2d/simple"),u=t("./graphics"),l=[];function m(){return 1<<l.length-1}function h(){for(var t=0,e=0;e<l.length;++e)t+=1<<e;return t}function p(t,e,n,i,r,a){for(var s=t.effect.getDefaultTechnique().passes,o=b8e.GFXEnums.STENCIL_OP_KEEP,c=b8e.GFXEnums.STENCIL_OP_KEEP,u=0;u<s.length;++u){var l=s[u];l.setStencilFront(b8e.GFXEnums.STENCIL_ENABLE,e,i,r,n,o,c,a),l.setStencilBack(b8e.GFXEnums.STENCIL_ENABLE,e,i,r,n,o,c,a)}}function i(t){l.length,l.push(t)}function r(t,e){l.length,l.pop(),0===l.length?e._flushMaterial(t._exitMaterial):f(e)}function a(t,e){var n=b8e.GFXEnums.DS_FUNC_NEVER,i=m(),r=i,a=i,s=t.inverted?b8e.GFXEnums.STENCIL_OP_REPLACE:b8e.GFXEnums.STENCIL_OP_ZERO;p(t._clearMaterial,n,s,i,r,a);var o=b8e.GFXVertexFormat.getVfmtPos(),c=e.getBuffer("mesh",o),u=c.request(4,6),l=u.indiceOffset,h=u.byteOffset>>2,f=u.vertexOffset,d=c._vData,_=c._iData;d[h++]=-1,d[h++]=-1,d[h++]=-1,d[h++]=1,d[h++]=1,d[h++]=1,d[h++]=1,d[h++]=-1,_[l++]=f,_[l++]=f+3,_[l++]=f+1,_[l++]=f+1,_[l++]=f+3,_[l++]=f+2,e.node=e._dummyNode,e.material=t._clearMaterial,e._flush()}function s(t,e){var n=b8e.GFXEnums.DS_FUNC_NEVER,i=m(),r=i,a=i,s=t.inverted?b8e.GFXEnums.STENCIL_OP_ZERO:b8e.GFXEnums.STENCIL_OP_REPLACE;p(t.sharedMaterials[0],n,s,i,r,a),e.node=t.node,e.material=t.sharedMaterials[0],t._type===o.Type.IMAGE_STENCIL?(c.fillBuffers(t,e),e._flush()):u.fillBuffers(t._graphics._graphics,e)}function f(t){var e=b8e.GFXEnums.DS_FUNC_EQUAL,n=b8e.GFXEnums.STENCIL_OP_KEEP,i=h(),r=i,a=m(),s=l[l.length-1];p(s._enableMaterial,e,n,i,r,a),t._flushMaterial(s._enableMaterial)}var d={updateRenderData:function(t){t._renderData||(t._type===o.Type.IMAGE_STENCIL?t._renderData=c.createData(t):t._renderData=t.requestRenderData());var e=t._renderData;if(t._type===o.Type.IMAGE_STENCIL)if(t.spriteFrame){var n=t.node._contentSize,i=t.node._anchorPoint;e.updateSizeNPivot(n.width,n.height,i.x,i.y),e.dataLength=4,c.updateRenderData(t),e.material=t.sharedMaterials[0]}else t.setMaterial(0,null);else t._graphics._graphics.setMaterial(0,t.sharedMaterials[0]),u.updateRenderData(t._graphics._graphics)},fillBuffers:function(t,e){t._type===o.Type.IMAGE_STENCIL&&!t.spriteFrame||(i(t),a(t,e),s(t,e),f(e)),t.node._renderFlag|=b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA}},_={fillBuffers:function(t,e){t._type===o.Type.IMAGE_STENCIL&&!t.spriteFrame||r(t,e),t.node._renderFlag|=b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA}};o._assembler=d,o._postAssembler=_,e.exports={front:d,end:_}},{"../../../components/CCMask":43,"./graphics":131,"./sprite/2d/simple":141}],137:[function(t,e,n){"use strict";var i=t("../../../components/CCMotionStreak");function A(t,e){this.point=t||cc.v2(),this.dir=e||cc.v2(),this.distance=0,this.time=0}A.prototype.setPoint=function(t,e){this.point.x=t,this.point.y=e},A.prototype.setDir=function(t,e){this.dir.x=t,this.dir.y=e},cc.v2(),cc.v2();var O=cc.v2(),R=cc.v2();function D(t,e){return t.x=-e.y,t.y=e.x,t}var r={updateRenderData:function(t){var e=cc.director.getDeltaTime();this.update(t,e);var n=t._renderData,i=t.node._contentSize,r=t.node._anchorPoint;n.updateSizeNPivot(i.width,i.height,r.x,r.y),n.material=t.sharedMaterials[0]},update:function(t,e){var n=t._renderData;n=n||(t._renderData=t.requestRenderData());var i=t._stroke/2,r=t.node._worldMatrix,a=(r.m00,r.m01,r.m04,r.m05,r.m12),s=r.m13,o=t._points,c=void 0;if(1<o.length){var u=o[0].point.x-a,l=o[0].point.y-s;u*u+l*l<t.minSeg&&(c=o[0])}if(c||(c=new A,o.splice(0,0,c)),c.setPoint(a,s),c.time=t._fadeTime+e,n.dataLength=0,!(o.length<2)){var h=n._data,f=t._color,d=f.r,_=f.g,m=f.b,p=f.a,v=o[1];v.distance=c.point.sub(v.point,R).mag(),R.normalizeSelf(),v.setDir(R.x,R.y),c.setDir(R.x,R.y);for(var y=t._fadeTime,g=!1,x=o.length-1;0<=x;x--){var b=o[x],E=b.point,C=b.dir;if(b.time-=e,b.time<0)o.splice(x,1);else{var w=b.time/y,S=o[x-1];if(!g){if(!S){o.splice(x,1);continue}E.x=S.point.x-C.x*w,E.y=S.point.y-C.y*w}g=!0,D(O,C),n.dataLength+=2;var T=(w*p<<24>>>0)+(m<<16)+(_<<8)+d,M=h.length-1;h[M].x=E.x-O.x*i,h[M].y=E.y-O.y*i,h[M].u=0,h[M].v=w,h[M].color=T,h[--M].x=E.x+O.x*i,h[M].y=E.y+O.y*i,h[M].u=1,h[M].v=w,h[M].color=T}}n.vertexCount=n.dataLength,n.indiceCount=n.vertexCount<=2?0:3*(n.vertexCount-2)}},fillBuffers:function(t,e){t.node;for(var n=t._renderData,i=n._data,r=e._meshBuffer,a=n.vertexCount,s=r.request(a,n.indiceCount),o=s.indiceOffset,c=s.byteOffset>>2,u=s.vertexOffset,l=r._vData,h=r._uintVData,f=r._iData,d=void 0,_=0,m=n.vertexCount;_<m;_++)d=i[_],l[c++]=d.x,l[c++]=d.y,l[c++]=d.u,l[c++]=d.v,h[c++]=d.color;for(var p=0,v=n.vertexCount;p<v;p+=2){var y=u+p;f[o++]=y,f[o++]=y+2,f[o++]=y+1,f[o++]=y+1,f[o++]=y+2,f[o++]=y+3}t.node._renderFlag|=b8e.RenderFlow.FLAG_UPDATE_RENDER_DATA}};e.exports=i._assembler=r},{"../../../components/CCMotionStreak":44}],138:[function(t,e,n){"use strict";var g=t("../../../../../components/CCSprite").FillType,c=t("../../utils").fillVerticesWithoutCalc;e.exports={updateRenderData:function(t){var e=t._renderData;if(e&&t.spriteFrame){var n=e.uvDirty,i=e.vertDirty;if(!n&&!i)return t.__allocedDatas;var r=t._fillStart,a=t._fillRange;a<0&&(r+=a,a=-a),a=(a=1<(a=r+a)?1:a)<0?0:a;var s=(r=(r=1<r?1:r)<0?0:r)+(a=(a-=r)<0?0:a);s=1<s?1:s,n&&this.updateUVs(t,r,s),i&&(this.updateVerts(t,r,s),this.updateWorldVerts(t))}},updateUVs:function(t,e,n){var i=t._spriteFrame,r=t._renderData,a=r._data,s=i._texture.width,o=i._texture.height,c=i._rect,u=void 0,l=void 0,h=void 0,f=void 0,d=void 0,_=void 0,m=void 0,p=void 0,v=void 0,y=void 0;switch(i._rotated?(u=c.x/s,l=(c.y+c.width)/o,h=d=u,m=v=(c.x+c.height)/s,_=y=l,f=p=c.y/o):(u=c.x/s,l=(c.y+c.height)/o,h=m=u,d=v=(c.x+c.width)/s,f=_=l,p=y=c.y/o),t._fillType){case g.HORIZONTAL:a[0].u=h+(d-h)*e,a[0].v=f+(_-f)*e,a[1].u=h+(d-h)*n,a[1].v=f+(_-f)*n,a[2].u=m+(v-m)*e,a[2].v=p+(y-p)*e,a[3].u=m+(v-m)*n,a[3].v=p+(y-p)*n;break;case g.VERTICAL:a[0].u=h+(m-h)*e,a[0].v=f+(p-f)*e,a[1].u=d+(v-d)*e,a[1].v=_+(y-_)*e,a[2].u=h+(m-h)*n,a[2].v=f+(p-f)*n,a[3].u=d+(v-d)*n,a[3].v=_+(y-_)*n}r.uvDirty=!1},updateVerts:function(t,e,n){var i=t._renderData,r=i._data,a=t.node,s=a.width,o=a.height,c=a.anchorX*s,u=a.anchorY*o,l=-c,h=-u,f=s-c,d=o-u,_=void 0;switch(t._fillType){case g.HORIZONTAL:_=l+(f-l)*n,l+=(f-l)*e,f=_;break;case g.VERTICAL:_=h+(d-h)*n,h+=(d-h)*e,d=_}r[4].x=l,r[4].y=h,r[5].x=f,r[5].y=h,r[6].x=l,r[6].y=d,r[7].x=f,r[7].y=d,i.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indiceCount=6;for(var n=e._data,i=0;i<n.length;i++)n[i].z=0;return e},updateWorldVerts:function(t){for(var e=t.node,n=t._renderData._data,i=e._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13,l=0;l<4;l++){var h=n[l+4],f=n[l];f.x=h.x*r+h.y*s+c,f.y=h.x*a+h.y*o+u}},fillBuffers:function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);var n=e._meshBuffer,i=t.node,r=c(i,n,t._renderData,i._color._val),a=n._iData,s=r.indiceOffset,o=r.vertexOffset;a[s++]=o,a[s++]=o+1,a[s++]=o+2,a[s++]=o+1,a[s++]=o+3,a[s++]=o+2}}},{"../../../../../components/CCSprite":48,"../../utils":151}],139:[function(t,e,n){"use strict";var f=t("../../utils").fillVerticesWithoutCalc;e.exports={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t._renderData,n=t.spriteFrame;if(e&&n){var i=n.vertices;i&&(e.vertexCount!==i.x.length&&(e.vertexCount=i.x.length,e.indiceCount=i.triangles.length,e.dataLength=2*e.vertexCount,e.uvDirty=e.vertDirty=!0),e.uvDirty&&this.updateUVs(t),e.vertDirty&&(this.updateVerts(t),this.updateWorldVerts(t)))}},updateUVs:function(t){for(var e=t.spriteFrame.vertices,n=e.nu,i=e.nv,r=t._renderData,a=r._data,s=0,o=n.length;s<o;s++){var c=a[s];c.u=n[s],c.v=i[s]}r.uvDirty=!1},updateVerts:function(t){var e=t.node,n=Math.abs(e.width),i=Math.abs(e.height),r=e.anchorX*n,a=e.anchorY*i,s=t.spriteFrame,o=s.vertices,c=o.x,u=o.y,l=s._originalSize.width,h=s._originalSize.height,f=s._rect.width,d=s._rect.height,_=s._offset.x+(l-f)/2,m=s._offset.y+(h-d)/2,p=n/(t.trim?f:l),v=i/(t.trim?d:h),y=t._renderData,g=y._data;if(t.trim)for(var x=0,b=c.length;x<b;x++){var E=g[x+b];E.x=(c[x]-_)*p-r,E.y=(h-u[x]-m)*v-a}else for(var C=0,w=c.length;C<w;C++){var S=g[C+w];S.x=c[C]*p-r,S.y=(h-u[C])*v-a}y.vertDirty=!1},updateWorldVerts:function(t){for(var e=t.node,n=t._renderData,i=n._data,r=e._worldMatrix,a=r.m00,s=r.m01,o=r.m04,c=r.m05,u=r.m12,l=r.m13,h=0,f=n.vertexCount;h<f;h++){var d=i[h+f],_=i[h];_.x=d.x*a+d.y*o+u,_.y=d.x*s+d.y*c+l}},fillBuffers:function(t,e){var n=t.spriteFrame.vertices;if(n){e.worldMatDirty&&this.updateWorldVerts(t);for(var i=e._meshBuffer,r=t.node,a=f(r,i,t._renderData,r._color._val),s=i._iData,o=a.indiceOffset,c=a.vertexOffset,u=n.triangles,l=0,h=u.length;l<h;l++)s[o++]=c+u[l]}}}},{"../../utils":151}],140:[function(t,e,n){"use strict";var h=t("../../utils").fillVertices,d=2*Math.PI,_=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],m=[0,0,0,0],l=[0,0,0,0,0,0,0,0],p=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],v=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],y=cc.v2(0,0),g=[];function x(t,e,n,i,r,a,s){var o=Math.sin(a),c=Math.cos(a),u=void 0,l=void 0;if(0!==Math.cos(a)){if(u=o/c,0<(t-r.x)*c){var h=r.y+u*(t-r.x);s[0].x=t,s[0].y=h}if(0<(e-r.x)*c){var f=r.y+u*(e-r.x);s[2].x=e,s[2].y=f}}if(0!==Math.sin(a)){if(l=c/o,0<(i-r.y)*o){var d=r.x+l*(i-r.y);s[3].x=d,s[3].y=i}if(0<(n-r.y)*o){var _=r.x+l*(n-r.y);s[1].x=_,s[1].y=n}}}function b(t){var e=t.node,n=e.width,i=e.height,r=e.anchorX*n,a=e.anchorY*i,s=-r,o=-a,c=n-r,u=i-a,l=m;l[0]=s,l[1]=o,l[2]=c,l[3]=u;var h=t._fillCenter,f=y.x=Math.min(Math.max(0,h.x),1)*(c-s)+s,d=y.y=Math.min(Math.max(0,h.y),1)*(u-o)+o;_[0].x=_[3].x=s,_[1].x=_[2].x=c,_[0].y=_[1].y=o,_[2].y=_[3].y=u,f!==l[g.length=0]&&(g[0]=[3,0]),f!==l[2]&&(g[2]=[1,2]),d!==l[1]&&(g[1]=[0,1]),d!==l[3]&&(g[3]=[2,3])}function E(t){var e=t._texture.width,n=t._texture.height,i=t._rect,r=void 0,a=void 0,s=void 0,o=void 0,c=l;t._rotated?(r=i.x/e,a=(i.x+i.height)/e,s=i.y/n,o=(i.y+i.width)/n,c[0]=c[2]=r,c[4]=c[6]=a,c[3]=c[7]=o,c[1]=c[5]=s):(r=i.x/e,a=(i.x+i.width)/e,s=i.y/n,o=(i.y+i.height)/n,c[0]=c[4]=r,c[2]=c[6]=a,c[1]=c[3]=o,c[5]=c[7]=s)}function C(t,e){var n,i;if(n=e.x-t.x,i=e.y-t.y,0!=n||0!=i){if(0==n)return 0<i?.5*Math.PI:1.5*Math.PI;var r=Math.atan(i/n);return n<0&&(r+=Math.PI),r}}function w(t,e,n,i,r){var a=m,s=a[0],o=a[1],c=a[2],u=a[3];t[e].x=n.x,t[e].y=n.y,t[e+1].x=i.x,t[e+1].y=i.y,t[e+2].x=r.x,t[e+2].y=r.y,f((n.x-s)/(c-s),(n.y-o)/(u-o),t,e),f((i.x-s)/(c-s),(i.y-o)/(u-o),t,e+1),f((r.x-s)/(c-s),(r.y-o)/(u-o),t,e+2)}function f(t,e,n,i){var r=l,a=r[0]+(r[2]-r[0])*t,s=r[4]+(r[6]-r[4])*t,o=r[1]+(r[3]-r[1])*t,c=r[5]+(r[7]-r[5])*t,u=n[i];u.u=a+(s-a)*e,u.v=o+(c-o)*e}e.exports={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t._renderData,n=t.spriteFrame;if(e&&n&&(e.vertDirty||e.uvDirty)){var i=e._data,r=t._fillStart,a=t._fillRange;for(a<0&&(r+=a,a=-a);1<=r;)r-=1;for(;r<0;)r+=1;var s=(r*=d)+(a*=d);b(t),E(n),x(m[0],m[2],m[1],m[3],y,r,p),x(m[0],m[2],m[1],m[3],y,r+a,v);for(var o=0,c=0;c<4;++c){var u=g[c];if(u)if(d<=a)e.dataLength=o+3,w(i,o,y,_[u[0]],_[u[1]]),o+=3;else{var l=C(y,_[u[0]]),h=C(y,_[u[1]]);h<l&&(h+=d),l-=d,h-=d;for(var f=0;f<3;++f)s<=l||(r<=l?(e.dataLength=o+3,w(i,o,y,_[u[0]],s<=h?v[c]:_[u[1]]),o+=3):h<=r||(h<=s?(e.dataLength=o+3,w(i,o,y,p[c],_[u[1]])):(e.dataLength=o+3,w(i,o,y,p[c],v[c])),o+=3)),l+=d,h+=d}}e.indiceCount=e.vertexCount=o,e.vertDirty=e.uvDirty=!1}},fillBuffers:function(t,e){for(var n=t.node,i=n._color._val,r=e._meshBuffer,a=t._renderData,s=h(n,r,a,i),o=s.indiceOffset,c=s.vertexOffset,u=r._iData,l=0;l<a.dataLength;l++)u[o+l]=c+l}}},{"../../utils":151}],141:[function(t,e,n){"use strict";e.exports={updateRenderData:function(t){var e=t._renderData;e&&t.spriteFrame&&e.vertDirty&&this.updateVerts(t)},fillBuffers:function(t,e){var n=t._renderData._data,i=t.node,r=i._color._val,a=i._worldMatrix,s=a.m00,o=a.m01,c=a.m04,u=a.m05,l=a.m12,h=a.m13,f=e._meshBuffer,d=f.request(4,6),_=d.indiceOffset,m=d.byteOffset>>2,p=d.vertexOffset,v=f._vData,y=f._uintVData,g=f._iData,x=t._spriteFrame.uv;v[2+m]=x[0],v[3+m]=x[1],v[7+m]=x[2],v[8+m]=x[3],v[12+m]=x[4],v[13+m]=x[5],v[17+m]=x[6],v[18+m]=x[7];var b=n[0],E=n[3],C=b.x,w=E.x,S=b.y,T=E.y,M=s*C,A=s*w,O=o*C,R=o*w,D=c*S,N=c*T,L=u*S,I=u*T;v[m]=M+D+l,v[1+m]=O+L+h,v[5+m]=A+D+l,v[6+m]=R+L+h,v[10+m]=M+N+l,v[11+m]=O+I+h,v[15+m]=A+N+l,v[16+m]=R+I+h,y[4+m]=r,y[9+m]=r,y[14+m]=r,y[19+m]=r,g[_++]=p,g[_++]=p+1,g[_++]=p+2,g[_++]=p+1,g[_++]=p+3,g[_++]=p+2},createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indiceCount=6,e},updateVerts:function(t){var e=t._renderData,n=t.node,i=e._data,r=n.width,a=n.height,s=n.anchorX*r,o=n.anchorY*a,c=void 0,u=void 0,l=void 0,h=void 0;if(t.trim)c=-s,u=-o,l=r-s,h=a-o;else{var f=t.spriteFrame,d=f._originalSize.width,_=f._originalSize.height,m=f._rect.width,p=f._rect.height,v=f._offset,y=r/d,g=a/_,x=v.x+(d-m)/2,b=v.x-(d-m)/2;c=x*y-s,u=(v.y+(_-p)/2)*g-o,l=r+b*y-s,h=a+(v.y-(_-p)/2)*g-o}i[0].x=c,i[0].y=u,i[3].x=l,i[3].y=h,e.vertDirty=!1}}},{}],142:[function(t,e,n){"use strict";e.exports={createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indiceCount=54,e},updateRenderData:function(t){var e=t._renderData;e&&t.spriteFrame&&e.vertDirty&&(this.updateVerts(t),this.updateWorldVerts(t))},updateVerts:function(t){var e=t._renderData,n=e._data,i=t.node,r=i.width,a=i.height,s=i.anchorX*r,o=i.anchorY*a,c=t.spriteFrame,u=c.insetLeft,l=c.insetRight,h=c.insetTop,f=c.insetBottom,d=r-u-l,_=a-h-f,m=r/(u+l),p=a/(h+f);m=isNaN(m)||1<m?1:m,p=isNaN(p)||1<p?1:p,d=d<0?0:d,_=_<0?0:_,n[0].x=-s,n[0].y=-o,n[1].x=u*m-s,n[1].y=f*p-o,n[2].x=n[1].x+d,n[2].y=n[1].y+_,n[3].x=r-s,n[3].y=a-o,e.vertDirty=!1},fillBuffers:function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);for(var n=t._renderData,i=t.node._color._val,r=n._data,a=e._meshBuffer,s=n.vertexCount,o=t.spriteFrame.uvSliced,c=a.request(s,n.indiceCount),u=c.indiceOffset,l=c.byteOffset>>2,h=c.vertexOffset,f=a._vData,d=a._uintVData,_=a._iData,m=4;m<20;++m){var p=r[m],v=o[m-4];f[l++]=p.x,f[l++]=p.y,f[l++]=v.u,f[l++]=v.v,d[l++]=i}for(var y=0;y<3;++y)for(var g=0;g<3;++g){var x=h+4*y+g;_[u++]=x,_[u++]=x+1,_[u++]=x+4,_[u++]=x+1,_[u++]=x+5,_[u++]=x+4}},updateWorldVerts:function(t){for(var e=t.node,n=t._renderData._data,i=e._worldMatrix,r=i.m00,a=i.m01,s=i.m04,o=i.m05,c=i.m12,u=i.m13,l=0;l<4;++l)for(var h=n[l],f=0;f<4;++f){var d=n[f],_=n[4+4*l+f];_.x=d.x*r+h.y*s+c,_.y=d.x*a+h.y*o+u}}}},{}],143:[function(t,e,n){"use strict";e.exports={vertexOffset:5,uvOffset:2,colorOffset:4,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t._renderData,n=t.spriteFrame;if(n&&e&&(e.uvDirty||e.vertDirty)){var i=t.node,r=Math.abs(i.width),a=Math.abs(i.height),s=i.anchorX*r,o=i.anchorY*a,c=n._rect,u=c.width,l=c.height,h=r/u,f=a/l,d=Math.ceil(f),_=Math.ceil(h),m=e._data;e.dataLength=Math.max(8,d+1,_+1);for(var p=0;p<=_;++p)m[p].x=Math.min(u*p,r)-s;for(var v=0;v<=d;++v)m[v].y=Math.min(l*v,a)-o;e.vertexCount=d*_*4,e.indiceCount=d*_*6,e.uvDirty=!1,e.vertDirty=!1}},fillVertices:function(t,e,n,i,r,a){for(var s=n.m00,o=n.m01,c=n.m04,u=n.m05,l=n.m12,h=n.m13,f=void 0,d=void 0,_=void 0,m=void 0,p=0,v=i;p<v;++p){_=a[p].y,m=a[p+1].y;for(var y=0,g=r;y<g;++y)f=a[y].x,d=a[y+1].x,t[e]=f*s+_*c+l,t[e+1]=f*o+_*u+h,t[e+5]=d*s+_*c+l,t[e+6]=d*o+_*u+h,t[e+10]=f*s+m*c+l,t[e+11]=f*o+m*u+h,t[e+15]=d*s+m*c+l,t[e+16]=d*o+m*u+h,e+=20}},fillBuffers:function(t,e){var n=t.node,i=n.is3DNode,r=n._color._val,a=t._renderData,s=a._data,o=i?e._meshBuffer3D:e._meshBuffer,c=o.request(a.vertexCount,a.indiceCount),u=c.indiceOffset,l=c.byteOffset>>2,h=c.vertexOffset,f=o._vData,d=o._uintVData,_=o._iData,m=t.spriteFrame._rotated,p=t.spriteFrame.uv,v=t.spriteFrame._rect,y=Math.abs(n.width),g=Math.abs(n.height),x=y/v.width,b=g/v.height,E=Math.ceil(b),C=Math.ceil(x),w=n._worldMatrix;this.fillVertices(f,l,w,E,C,s);for(var S=this.vertexOffset,T=this.uvOffset,M=this.colorOffset,A=S,O=2*S,R=3*S,D=4*S,N=void 0,L=void 0,I=0,P=E;I<P;++I){L=Math.min(1,b-I);for(var k=0,F=C;k<F;++k){N=Math.min(1,x-k);var z=l+T,B=z+1;m?(f[z]=p[0],f[B]=p[1],f[z+A]=p[0],f[B+A]=p[1]+(p[7]-p[1])*N,f[z+O]=p[0]+(p[6]-p[0])*L,f[B+O]=p[1],f[z+R]=f[z+O],f[B+R]=f[B+A]):(f[z]=p[0],f[B]=p[1],f[z+A]=p[0]+(p[6]-p[0])*N,f[B+A]=p[1],f[z+O]=p[0],f[B+O]=p[1]+(p[7]-p[1])*L,f[z+R]=f[z+A],f[B+R]=f[B+O]),d[l+M]=r,d[l+M+A]=r,d[l+M+O]=r,d[l+M+R]=r,l+=D}}for(var H=a.indiceCount,U=0;U<H;U+=6)_[u++]=h,_[u++]=h+1,_[u++]=h+2,_[u++]=h+1,_[u++]=h+3,_[u++]=h+2,h+=4}}},{}],144:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/bar-filled"),c=t("../../utils").fillVerticesWithoutCalc3D,o=cc.vmath.vec3;e.exports=i.addon({updateWorldVerts:function(t){for(var e=t.node,n=t._renderData._data,i=e._worldMatrix,r=0;r<4;r++){var a=n[r+4],s=n[r];o.transformMat4(s,a,i)}},fillBuffers:function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);var n=e._meshBuffer3D,i=t.node,r=c(i,n,t._renderData,i._color._val),a=n._iData,s=r.indiceOffset,o=r.vertexOffset;a[s++]=o,a[s++]=o+1,a[s++]=o+2,a[s++]=o+1,a[s++]=o+3,a[s++]=o+2}},r)},{"../../../../../platform/js":101,"../../utils":151,"../2d/bar-filled":138}],145:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/mesh"),f=t("../../utils").fillVerticesWithoutCalc3D,u=cc.vmath.vec3,l=u.create();e.exports=i.addon({updateWorldVerts:function(t){for(var e=t.node,n=t._renderData,i=n._data,r=e._worldMatrix,a=0,s=n.vertexCount;a<s;a++){var o=i[a+s],c=i[a];u.set(l,o.x,o.y,0),u.transformMat4(c,l,r)}},fillBuffers:function(t,e){var n=t.spriteFrame.vertices;if(n){e.worldMatDirty&&this.updateWorldVerts(t);for(var i=e._meshBuffer3D,r=t.node,a=f(r,i,t._renderData,r._color._val),s=i._iData,o=a.indiceOffset,c=a.vertexOffset,u=n.triangles,l=0,h=u.length;l<h;l++)s[o++]=c+u[l]}}},r)},{"../../../../../platform/js":101,"../../utils":151,"../2d/mesh":139}],146:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/radial-filled"),h=t("../../utils").fillVertices3D;e.exports=i.addon({fillBuffers:function(t,e){for(var n=t.node,i=n._color._val,r=e._meshBuffer3D,a=t._renderData,s=h(n,r,a,i),o=s.indiceOffset,c=s.vertexOffset,u=r._iData,l=0;l<a.dataLength;l++)u[o+l]=c+l}},r)},{"../../../../../platform/js":101,"../../utils":151,"../2d/radial-filled":140}],147:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/simple"),b=cc.vmath.vec3;e.exports=i.addon({fillBuffers:function(){for(var x=[],t=0;t<4;t++)x.push(b.create());return function(t,e){var n=t._renderData._data,i=t.node,r=i._color._val,a=i._worldMatrix,s=e._meshBuffer3D,o=s.request(4,6),c=o.byteOffset>>2,u=o.indiceOffset,l=o.vertexOffset,h=s._vData,f=s._uintVData,d=s._iData,_=n[0],m=n[3];b.set(x[0],_.x,_.y,0),b.set(x[1],m.x,_.y,0),b.set(x[2],_.x,m.y,0),b.set(x[3],m.x,m.y,0);for(var p=t._spriteFrame.uv,v=0;v<4;v++){var y=x[v];b.transformMat4(y,y,a),h[c++]=y.x,h[c++]=y.y,h[c++]=y.z;var g=2*v;h[c++]=p[0+g],h[c++]=p[1+g],f[c++]=r}d[u++]=l,d[u++]=l+1,d[u++]=l+2,d[u++]=l+1,d[u++]=l+3,d[u++]=l+2}}()},r)},{"../../../../../platform/js":101,"../2d/simple":141}],148:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/sliced"),u=cc.vmath.vec3,l=u.create();e.exports=i.addon({fillBuffers:function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);for(var n=t._renderData,i=t.node._color._val,r=n._data,a=e._meshBuffer3D,s=n.vertexCount,o=t.spriteFrame.uvSliced,c=a.request(s,n.indiceCount),u=c.byteOffset>>2,l=c.indiceOffset,h=c.vertexOffset,f=a._vData,d=a._uintVData,_=a._iData,m=4;m<20;++m){var p=r[m],v=o[m-4];f[u++]=p.x,f[u++]=p.y,f[u++]=p.z,f[u++]=v.u,f[u++]=v.v,d[u++]=i}for(var y=0;y<3;++y)for(var g=0;g<3;++g){var x=h+4*y+g;_[l++]=x,_[l++]=x+1,_[l++]=x+4,_[l++]=x+1,_[l++]=x+5,_[l++]=x+4}},updateWorldVerts:function(t){for(var e=t.node,n=t._renderData._data,i=e._worldMatrix,r=0;r<4;++r)for(var a=n[r],s=0;s<4;++s){var o=n[s],c=n[4+4*r+s];u.set(l,o.x,a.y,0),u.transformMat4(c,l,i)}}},r)},{"../../../../../platform/js":101,"../2d/sliced":142}],149:[function(t,e,n){"use strict";var i=t("../../../../../platform/js"),r=t("../2d/tiled"),y=cc.vmath.vec3;e.exports=i.addon({vertexOffset:6,uvOffset:3,colorOffset:5,fillVertices:function(){for(var v=[],t=0;t<4;t++)v.push(y.create());return function(t,e,n,i,r,a){for(var s=void 0,o=void 0,c=void 0,u=void 0,l=0,h=i;l<h;++l){c=a[l].y,u=a[l+1].y;for(var f=0,d=r;f<d;++f){s=a[f].x,o=a[f+1].x,y.set(v[0],s,c,0),y.set(v[1],o,c,0),y.set(v[2],s,u,0),y.set(v[3],o,u,0);for(var _=0;_<4;_++){var m=v[_];y.transformMat4(m,m,n);var p=6*_;t[e+p]=m.x,t[e+p+1]=m.y,t[e+p+2]=m.z}e+=24}}}}()},r)},{"../../../../../platform/js":101,"../2d/tiled":143}],150:[function(t,e,n){"use strict";var i=t("../../../../components/CCSprite"),r=i.Type,a=i.FillType,s=t("./2d/simple"),o=t("./2d/sliced"),c=t("./2d/tiled"),u=t("./2d/radial-filled"),l=t("./2d/bar-filled"),h=t("./2d/mesh"),f=t("./3d/simple"),d=t("./3d/sliced"),_=t("./3d/tiled"),m=t("./3d/radial-filled"),p=t("./3d/bar-filled"),v=t("./3d/mesh"),y={getAssembler:function(t){var e=t.node.is3DNode,n=e?f:s;switch(t.type){case r.SLICED:n=e?d:o;break;case r.TILED:n=e?_:c;break;case r.FILLED:n=t._fillType===a.RADIAL?e?m:u:e?p:l;break;case r.MESH:n=e?v:h}return n},updateRenderData:function(t){return t.__allocedDatas}};i._assembler=y,e.exports=y},{"../../../../components/CCSprite":48,"./2d/bar-filled":138,"./2d/mesh":139,"./2d/radial-filled":140,"./2d/simple":141,"./2d/sliced":142,"./2d/tiled":143,"./3d/bar-filled":144,"./3d/mesh":145,"./3d/radial-filled":146,"./3d/simple":147,"./3d/sliced":148,"./3d/tiled":149}],151:[function(t,e,n){"use strict";var g=cc.vmath.vec3,x=g.create();e.exports={fillVertices:function(t,e,n,i){for(var r=n.vertexCount,a=e.request(r,n.indiceCount),s=a.byteOffset>>2,o=e._vData,c=e._uintVData,u=t._worldMatrix,l=u.m00,h=u.m01,f=u.m04,d=u.m05,_=u.m12,m=u.m13,p=n._data,v=0;v<r;v++){var y=p[v];o[s++]=y.x*l+y.y*f+_,o[s++]=y.x*h+y.y*d+m,o[s++]=y.u,o[s++]=y.v,c[s++]=i}return a},fillMeshVertices:function(t,e,n,i){for(var r=n.vertexCount,a=e.request(r,n.indiceCount),s=a.indiceOffset,o=a.byteOffset>>2,c=a.vertexOffset,u=e._vData,l=e._uintVData,h=e._iData,f=t._worldMatrix,d=f.m00,_=f.m01,m=f.m04,p=f.m05,v=f.m12,y=f.m13,g=n._data,x=0;x<r;x++){var b=g[x];u[o++]=b.x*d+b.y*m+v,u[o++]=b.x*_+b.y*p+y,u[o++]=b.u,u[o++]=b.v,l[o++]=i}for(var E=0,C=r/4;E<C;E++){var w=c+4*E;h[s++]=w,h[s++]=w+1,h[s++]=w+2,h[s++]=w+1,h[s++]=w+3,h[s++]=w+2}return a},fillVertices3D:function(t,e,n,i){for(var r=n.vertexCount,a=e.request(r,n.indiceCount),s=a.byteOffset>>2,o=e._vData,c=e._uintVData,u=t._worldMatrix,l=n._data,h=0;h<r;h++){var f=l[h];g.set(x,f.x,f.y,0),g.transformMat4(x,x,u),o[s++]=x.x,o[s++]=x.y,o[s++]=x.z,o[s++]=f.u,o[s++]=f.v,c[s++]=i}return a},fillMeshVertices3D:function(t,e,n,i){for(var r=n.vertexCount,a=e.request(r,n.indiceCount),s=a.indiceOffset,o=a.vertexOffset,c=a.byteOffset>>2,u=e._vData,l=e._uintVData,h=e._iData,f=t._worldMatrix,d=n._data,_=0;_<r;_++){var m=d[_];g.set(x,m.x,m.y,0),g.transformMat4(x,x,f),u[c++]=x.x,u[c++]=x.y,u[c++]=x.z,u[c++]=m.u,u[c++]=m.v,l[c++]=i}for(var p=0,v=r/4;p<v;p++){var y=o+4*p;h[s++]=y,h[s++]=y+1,h[s++]=y+2,h[s++]=y+1,h[s++]=y+3,h[s++]=y+2}return a},fillVerticesWithoutCalc:function(t,e,n,i){for(var r=n.vertexCount,a=e.request(r,n.indiceCount),s=a.byteOffset>>2,o=e._vData,c=e._uintVData,u=n._data,l=0;l<r;l++){var h=u[l];o[s++]=h.x,o[s++]=h.y,o[s++]=h.u,o[s++]=h.v,c[s++]=i}return a},fillVerticesWithoutCalc3D:function(t,e,n,i){for(var r=n.vertexCount,a=e.request(r,n.indiceCount).byteOffset>>2,s=e._vData,o=e._uintVData,c=n._data,u=0;u<r;u++){var l=c[u];s[a++]=l.x,s[a++]=l.y,s[a++]=l.z,s[a++]=l.u,s[a++]=l.v,o[a++]=i}}}},{}],152:[function(t,e,n){"use strict";t("../platform/CCSys");var i=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,a=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",n=0;n<t;n++)e=(e+(""===e?"":"/")+arguments[n]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=i.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var n=t.indexOf("?");0<n&&(t=t.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!i)return null;var r=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r},dirname:function(t){var e=r.exec(t);return e?e[2]:""},changeExtname:function(t,e){e=e||"";var n=t.indexOf("?"),i="";return 0<n&&(i=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+e+i:t.substring(0,n)+e+i},changeBasename:function(t,e,n){if(0===e.indexOf("."))return this.changeExtname(t,e);var i=t.indexOf("?"),r="",a=n?this.extname(t):"";return 0<i&&(r=t.substring(i),t=t.substring(0,i)),i=(i=t.lastIndexOf("/"))<=0?0:i+1,t.substring(0,i)+e+a+r},_normalize:function(t){for(var e=t=String(t);t=(e=t).replace(a,""),e.length!==t.length;);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},e.exports=cc.path},{"../platform/CCSys":90}],153:[function(t,e,n){"use strict";function i(t,e,n,i,r,a){this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}i.create=function(t,e,n,i,r,a){return{a:t,b:e,c:n,d:i,tx:r,ty:a}},i.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},i.clone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},i.concat=function(t,e,n){var i=e.a,r=e.b,a=e.c,s=e.d,o=e.tx,c=e.ty;return t.a=i*n.a+r*n.c,t.b=i*n.b+r*n.d,t.c=a*n.a+s*n.c,t.d=a*n.b+s*n.d,t.tx=o*n.a+c*n.c+n.tx,t.ty=o*n.b+c*n.d+n.ty,t},i.invert=function(t,e){var n=e.a,i=e.b,r=e.c,a=e.d,s=1/(n*a-i*r),o=e.tx,c=e.ty;return t.a=s*a,t.b=-s*i,t.c=-s*r,t.d=s*n,t.tx=s*(r*c-a*o),t.ty=s*(i*o-n*c),t},i.fromMat4=function(t,e){return t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13,t},i.transformVec2=function(t,e,n,i){var r,a;return a=void 0===i?(i=n,r=e.x,e.y):(r=e,n),t.x=i.a*r+i.c*a+i.tx,t.y=i.b*r+i.d*a+i.ty,t},i.transformSize=function(t,e,n){return t.width=n.a*e.width+n.c*e.height,t.height=n.b*e.width+n.d*e.height,t},i.transformRect=function(t,e,n){var i=e.x,r=e.y,a=i+e.width,s=r+e.height,o=n.a*i+n.c*r+n.tx,c=n.b*i+n.d*r+n.ty,u=n.a*a+n.c*r+n.tx,l=n.b*a+n.d*r+n.ty,h=n.a*i+n.c*s+n.tx,f=n.b*i+n.d*s+n.ty,d=n.a*a+n.c*s+n.tx,_=n.b*a+n.d*s+n.ty,m=Math.min(o,u,h,d),p=Math.max(o,u,h,d),v=Math.min(c,l,f,_),y=Math.max(c,l,f,_);return t.x=m,t.y=v,t.width=p-m,t.height=y-v,t},i.transformObb=function(t,e,n,i,r,a){var s=r.x,o=r.y,c=r.width,u=r.height,l=a.a*s+a.c*o+a.tx,h=a.b*s+a.d*o+a.ty,f=a.a*c,d=a.b*c,_=a.c*u,m=a.d*u;e.x=l,e.y=h,n.x=f+l,n.y=d+h,t.x=_+l,t.y=m+h,i.x=f+_+l,i.y=d+m+h},cc.AffineTransform=e.exports=i},{}],154:[function(t,e,n){"use strict";var i=t("../platform/CCObject").Flags,r=(t("./misc"),t("../platform/js")),a=t("../platform/id-generater"),s=t("../event-manager"),c=i.Destroying,o=i.DontDestroy,u=new a("Node");function l(t){return t?"string"==typeof t?r.getClassByName(t):t:null}function h(t,e){if(e._sealed)for(var n=0;n<t._components.length;++n){var i=t._components[n];if(i.constructor===e)return i}else for(var r=0;r<t._components.length;++r){var a=t._components[r];if(a instanceof e)return a}return null}function f(t,e,n){if(e._sealed)for(var i=0;i<t._components.length;++i){var r=t._components[i];r.constructor===e&&n.push(r)}else for(var a=0;a<t._components.length;++a){var s=t._components[a];s instanceof e&&n.push(s)}}function d(t,e){for(var n=0;n<t.length;++n){var i=t[n],r=h(i,e);if(r)return r;if(0<i._children.length&&(r=d(i._children,e)))return r}return null}function _(t,e,n){for(var i=0;i<t.length;++i){var r=t[i];f(r,e,n),0<r._children.length&&_(r._children,e,n)}}var m=cc.Class({name:"cc._BaseNode",extends:cc.Object,properties:{_parent:null,_children:[],_active:!0,_level:0,_components:[],_prefab:null,_persistNode:{get:function(){return 0<(this._objFlags&o)},set:function(t){t?this._objFlags|=o:this._objFlags&=~o}},name:{get:function(){return this._name},set:function(t){this._name=t}},uuid:{get:function(){return this._id}},children:{get:function(){return this._children}},parent:{get:function(){return this._parent}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this._id=u.getNewId(),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.__eventTargets=[],this._renderFlag=b8e.RenderFlow.FLAG_TRANSFORM},getParent:function(){return this._parent},setParent:function(t){if(this._parent!==t){var e=this._parent;if(this._parent=t||null,this._onSetParent(t),t&&(this._level=t._level+1,s._setDirtyForNode(this),t._children.push(this),t.emit&&t.emit("child-added",this),t._renderFlag|=b8e.RenderFlow.FLAG_CHILDREN),e){if(!(e._objFlags&c)){var n=e._children.indexOf(this);e._children.splice(n,1),e.emit&&e.emit("child-removed",this),this._onHierarchyChanged(e),0===e._children.length&&(e._renderFlag&=~b8e.RenderFlow.FLAG_CHILDREN)}}else t&&this._onHierarchyChanged(null)}},attr:function(t){r.mixin(this,t)},getChildByUuid:function(t){if(!t)return b8e.log("Invalid uuid"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._id===t)return e[n];return null},getChildByName:function(t){if(!t)return b8e.log("Invalid name"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._name===t)return e[n];return null},addChild:function(t){t.setParent(this)},insertChild:function(t,e){t.setParent(this),t.setSiblingIndex(e)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=-1!==t?t:e.length-1;var n=e.indexOf(this);t!==n&&(e.splice(n,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},walk:function(t,e){var n,i,r,a,s=cc._BaseNode,o=1,c=s._stacks[s._stackId];c||(c=[],s._stacks.push(c)),s._stackId++,c.length=0,c[0]=this;var u=null;for(a=!1;o;)if(i=c[--o])if(!a&&t?t(i):a&&e&&e(i),c[o]=null,a){if(a=!1,n)if(n[++r])c[o]=n[r],o++;else if(u&&(c[o]=u,o++,a=!0,u._parent?(r=(n=u._parent._children).indexOf(u),u=u._parent):n=u=null,r<0))break}else 0<i._children.length?(n=(u=i)._children,r=0,c[o]=n[r],o++):(c[o]=i,o++,a=!0);c.length=0,s._stackId--},cleanup:function(){},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){-1<this._children.indexOf(t)&&(!e&&void 0!==e||t.cleanup(),t.setParent(null))},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var n=e.length-1;0<=n;n--){var i=e[n];i&&(t&&i.cleanup(),i.setParent(null))}this._children.length=0},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},getComponent:function(t){var e=l(t);return e?h(this,e):null},getComponents:function(t){var e=l(t),n=[];return e&&f(this,e,n),n},getComponentInChildren:function(t){var e=l(t);return e?d(this._children,e):null},getComponentsInChildren:function(t){var e=l(t),n=[];return e&&(f(this,e,n),_(this._children,e,n)),n},addComponent:function(t){var e;if("string"==typeof t){if(!(e=r.getClassByName(t)))return cc._RFpeek(),null}else{if(!t)return null;e=t}if("function"!=typeof e)return null;if(!r.isChildClassOf(e,cc.Component))return null;var n=e._requireComponent;if(n&&!this.getComponent(n)&&!this.addComponent(n))return null;var i=new e;return(i.node=this)._components.push(i),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(i),i},removeComponent:function(t){t&&(t instanceof cc.Component||(t=this.getComponent(t)),t&&t.destroy())},_removeComponent:function(t){if(t&&!(this._objFlags&c)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node}},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1)},destroyAllChildren:function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},_onSetParent:function(){},_onPostActivated:function(){},_onBatchRestored:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(){var t=this._parent;!this._persistNode||t instanceof cc.Scene||cc.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&cc.director._nodeActivator.activateNode(this,e)},_instantiate:function(t){t=t||cc.instantiate._clone(this,this);var e=this._prefab;return e&&this===e.root&&e.sync,t._parent=null,t._onBatchRestored(),t},_onPreDestroy:function(){var t,e;this._objFlags|=c;var n=this._parent,i=n&&n._objFlags&c,r=this._children;for(t=0,e=r.length;t<e;++t)r[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t)this._components[t]._destroyImmediate();var a=this.__eventTargets;for(t=0,e=a.length;t<e;++t){var s=a[t];s&&s.targetOff(this)}if(a.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!i&&n){var o=n._children.indexOf(this);n._children.splice(o,1),n.emit&&n.emit("child-removed",this)}return i}});m.idGenerater=u,m._stacks=[[]],m._stackId=0,m.prototype._onPreDestroyBase=m.prototype._onPreDestroy,m.prototype._onHierarchyChangedBase=m.prototype._onHierarchyChanged,cc._BaseNode=e.exports=m},{"../event-manager":58,"../platform/CCObject":87,"../platform/id-generater":97,"../platform/js":101,"./misc":163}],155:[function(t,e,n){"use strict";e.exports={binarySearchEpsilon:function(t,e){for(var n=0,i=t.length-1,r=i>>>1;n<=i;r=n+i>>>1){var a=t[r];if(e+1e-6<a)i=r-1;else{if(!(a<e-1e-6))return r;n=r+1}}return~n}}},{}],156:[function(t,e,n){"use strict";var i=t("../components/CCRenderComponent"),r=t("../platform/CCMacro").BlendFactor,a=cc.Class({properties:{_srcBlendFactor:r.SRC_ALPHA,_dstBlendFactor:r.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())},animatable:!1,type:r,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())},animatable:!1,type:r,visible:!0}},setMaterial:function(t,e){i.prototype.setMaterial.call(this,t,e),e&&this._updateMaterialBlendFunc(e)},_updateBlendFunc:function(){for(var t=this._materials,e=0;e<t.length;e++){var n=t[e];this._updateMaterialBlendFunc(n)}},_updateMaterialBlendFunc:function(t){for(var e=t._effect.getDefaultTechnique().passes,n=0;n<e.length;n++)e[n].setBlend(!0,b8e.GFXEnums.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,b8e.GFXEnums.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor);t.setDirty(!0)}});e.exports=a},{"../components/CCRenderComponent":45,"../platform/CCMacro":86}],157:[function(t,e,n){"use strict";var a=t("./misc").BASE64_VALUES,s="0123456789abcdef".split(""),i=["","","",""],o=i.concat(i,"-",i,"-",i,"-",i,"-",i,i,i),c=o.map(function(t,e){return"-"===t?NaN:e}).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;o[0]=t[0],o[1]=t[1];for(var e=2,n=2;e<22;e+=2){var i=a[t.charCodeAt(e)],r=a[t.charCodeAt(e+1)];o[c[n++]]=s[i>>2],o[c[n++]]=s[(3&i)<<2|r>>4],o[c[n++]]=s[15&r]}return o.join("")}},{"./misc":163}],158:[function(t,e,n){"use strict";cc.find=e.exports=function(t,e){if(null==t)return null;if(!e){var n=cc.director.getScene();if(!n)return null;e=n}for(var i=e,r="/"!==t[0]?0:1,a=t.split("/"),s=r;s<a.length;s++){var o=a[s],c=i._children;i=null;for(var u=0,l=c.length;u<l;++u){var h=c[u];if(h.name===o){i=h;break}}if(!i)return null}return i}},{}],159:[function(t,e,n){"use strict";function i(){this._graySpriteMaterial=null,this._spriteMaterial=null}i.prototype._switchGrayMaterial=function(t,e){var n=void 0;t?n=(n=this._graySpriteMaterial)||(this._graySpriteMaterial=b8e.Material.getBuiltinMaterial("gray-sprite")):(n=(n=this._spriteMaterial)||(this._spriteMaterial=b8e.Material.getBuiltinMaterial("sprite",e))).define("USE_TEXTURE",!0),e.setMaterial(0,n)},e.exports=i},{}],160:[function(t,e,n){"use strict";function i(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var c=/^(click)(\s)*=|(param)(\s)*=/,f=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;i.prototype={constructor:i,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,n=t.length;e<n;){var i=t.indexOf("<",e);if(i<0)this._stack.pop(),this._processResult(t.substring(e)),e=n;else{this._processResult(t.substring(e,i));var r=t.indexOf(">",e);-1===r?r=i:"/"===t.charAt(i+1)?this._stack.pop():this._addToStack(t.substring(i+1,r)),e=r+1}}return this._resultObjectArray},_attributeToObject:function(t){var e,n,i,r,a={},s=(t=t.trim()).match(/^(color|size)(\s)*=/);if(s){if(e=s[0],""===(t=t.substring(e.length).trim()))return a;switch(n=t.indexOf(" "),e[0]){case"c":a.color=-1<n?t.substring(0,n).trim():t;break;case"s":a.size=parseInt(t)}return-1<n&&(r=t.substring(n+1).trim(),i=this._processEventHandler(r),a.event=i),a}if((s=t.match(/^(br(\s)*\/)/))&&0<s[0].length&&(e=s[0].trim()).startsWith("br")&&"/"===e[e.length-1])return a.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),a;if((s=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&0<s[0].length&&(e=s[0].trim()).startsWith("img")&&"/"===e[e.length-1]){var o;s=t.match(f);for(var c=!1;s;)e=(t=t.substring(t.indexOf(s[0]))).substr(0,s[0].length),l=-1<(n=(o=t.substring(e.length).trim()).indexOf(" "))?o.substr(0,n):o,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=o.substring(n).trim(),"src"===e?(a.isImage=!0,l.endsWith("/")&&(l=l.substring(0,l.length-1)),0===l.indexOf("'")?(c=!0,l=l.substring(1,l.length-1)):0===l.indexOf('"')&&(c=!0,l=l.substring(1,l.length-1)),a.src=l):"height"===e?a.imageHeight=parseInt(l):"width"===e?a.imageWidth=parseInt(l):"click"===e&&(a.event=this._processEventHandler(e+"="+l)),a.event&&"param"===e&&(a.event.param=l.replace(/^\"|\"$/g,"")),s=t.match(f);return c&&a.isImage&&this._resultObjectArray.push({text:"",style:a}),{}}if(s=t.match(/^(outline(\s)*[^>]*)/)){var u={color:"#ffffff",width:1};if(t=s[0].substring("outline".length).trim()){var l,h=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(s=t.match(h);s;)e=(t=t.substring(t.indexOf(s[0]))).substr(0,s[0].length),l=-1<(n=(o=t.substring(e.length).trim()).indexOf(" "))?o.substr(0,n):o,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=o.substring(n).trim(),"click"===e?a.event=this._processEventHandler(e+"="+l):"color"===e?u.color=l:"width"===e&&(u.width=parseInt(l)),a.event&&"param"===e&&(a.event.param=l.replace(/^\"|\"$/g,"")),s=t.match(h)}a.outline=u}if((s=t.match(/^(on|u|b|i)(\s)*/))&&0<s[0].length){switch(e=s[0],t=t.substring(e.length).trim(),e[0]){case"u":a.underline=!0;break;case"i":a.italic=!0;break;case"b":a.bold=!0}if(""===t)return a;i=this._processEventHandler(t),a.event=i}return a},_processEventHandler:function(t){for(var e=0,n={},i=t.match(c),r=!1;i;){var a=i[0],s="";if(r=!1,'"'===(t=t.substring(a.length).trim()).charAt(0))-1<(e=t.indexOf('"',1))&&(s=t.substring(1,e).trim(),r=!0),e++;else if("'"===t.charAt(0))-1<(e=t.indexOf("'",1))&&(s=t.substring(1,e).trim(),r=!0),e++;else{var o=t.match(/(\S)+/);e=(s=o?o[0]:"").length}r&&(n[a=a.substring(0,a.length-1).trim()]=s),i=(t=t.substring(e).trim()).match(c)}return n},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var n=this._stack[this._stack.length-1];for(var i in n)e[i]||(e[i]=n[i]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),0<this._stack.length?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var n=this._specialSymbolArray[e][0],i=this._specialSymbolArray[e][1];t=t.replace(n,i)}return t}},cc.HtmlTextParser=i,e.exports=i},{}],161:[function(t,e,n){"use strict";t("./CCPath"),t("./profiler/CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":152,"./find":158,"./mutable-forward-iterator":164,"./profiler/CCProfiler":166}],162:[function(t,e,n){"use strict";var i=t("../vmath"),r=t("../platform/js"),a=new r.Pool(128);a.get=function(){var t=this._get();return t?i.mat4.identity(t):t=i.mat4.create(),t};var s=new r.Pool(64);s.get=function(){var t=this._get();return t?(t.x=t.y=t.z=0,t.w=1):t=i.quat.create(),t},e.exports={mat4:a,quat:s}},{"../platform/js":101,"../vmath":184}],163:[function(t,e,n){"use strict";for(var u=t("../platform/js"),i={propertyDefine:function(t,e,n){function i(t,e,n,i){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[n]=r.get),r.set&&i&&(t[i]=r.set);else{var a=t[n];u.getset(t,e,a,t[i])}}for(var r,a=t.prototype,s=0;s<e.length;s++){r=e[s];var o=(r=b8e.getNormP(r,!0))[0].toUpperCase()+r.slice(1);i(a,r,"get"+o,"set"+o)}for(r in n){var c=n[r];i(a,r,c[0],c[1])}},NextPOT:function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)},BUILTIN_CLASSID_RE:/^(?:cc|dragonBones|sp|ccsg)\..+/},r=new Array(123),a=0;a<123;++a)r[a]=64;for(var s=0;s<64;++s)r["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(s)]=s;i.BASE64_VALUES=r,i.pushToMap=function(t,e,n,i){var r=t[e];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):t[e]=i?[n,r]:[r,n]:t[e]=n},i.clampf=function(t,e,n){if(n<e){var i=e;e=n,n=i}return t<e?e:t<n?t:n},i.clamp01=function(t){return t<0?0:t<1?t:1},i.lerp=function(t,e,n){return t+(e-t)*n},i.degreesToRadians=function(t){return t*cc.macro.RAD},i.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.misc=e.exports=i},{"../platform/js":101}],164:[function(t,e,n){"use strict";function i(t){this.i=0,this.array=t}var r=i.prototype;r.remove=function(t){var e=this.array.indexOf(t);0<=e&&this.removeAt(e)},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.fastRemove=function(t){var e=this.array.indexOf(t);0<=e&&this.fastRemoveAt(e)},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=i},{}],165:[function(t,e,n){"use strict";var d=t("../vmath");cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,e.asset){var n=t._objFlags,i=t._parent,r=t._id,a=t._name,s=t._active,o=t._position.x,c=t._position.y,u=t._quat,l=t._localZOrder,h=t._globalZOrder;cc.game._isCloning=!0;var f=e.asset.data;f._prefab._synced=!0,f._iN$t=t,cc.instantiate._clone(f,f),cc.game._isCloning=!1,t._objFlags=n,t._parent=i,t._id=r,t._prefab=e,t._name=a,t._active=s,t._position.x=o,t._position.y=c,d.quat.copy(t._quat,u),t._localZOrder=l,t._globalZOrder=h}else t._prefab=null}}},{"../vmath":184}],166:[function(t,e,n){"use strict";var r=t("../../platform/CCMacro"),i=t("./perf-counter"),a=!1,h=15,f=null,s=null,o=null,c=null;function u(){if(!f){var t=document.createElement("canvas");t.style.width=t.width=256,t.style.height=t.height=256;var e=t.getContext("2d");e.font=h+"px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="#fff";var n=2,i=2,r=h;(f=new cc.LabelAtlas)._fntConfig={atlasName:"profiler-arial",commonHeight:r,fontSize:h,kerningDict:{},fontDefDictionary:{}},f._name="profiler-arial",f.fontSize=h;for(var a=f._fntConfig.fontDefDictionary,s=32;s<=126;s++){var o=String.fromCharCode(s),c=e.measureText(o).width;256<=n+c&&(i+=r+(n=2)),e.fillText(o,n,i),a[s]={xAdvance:c,xOffset:0,yOffset:0,rect:{x:n,y:i,width:c,height:r}},n+=c+2}var u=new cc.Texture2D;u.initWithElement(t);var l=new cc.SpriteFrame;l.setTexture(u),f.spriteFrame=l}}function l(){if(!s){s={frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};var t=performance.now();for(var e in s)s[e]._counter=new i(e,s[e],t)}}function d(){if(!o||!o.isValid){(o=new cc.Node("PROFILER-NODE")).x=o.y=10,o.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),o.zIndex=r.MAX_ZINDEX,cc.game.addPersistRootNode(o);var t=new cc.Node("LEFT-PANEL");t.anchorX=t.anchorY=0,t.setParent(o);var e=t.addComponent(cc.Label);e.font=f,e.fontSize=h,e.lineHeight=h;var n=new cc.Node("RIGHT-PANEL");n.anchorX=1,n.anchorY=0,n.x=200,n.setParent(o);var i=n.addComponent(cc.Label);i.horizontalAlign=cc.Label.HorizontalAlign.RIGHT,i.font=f,i.fontSize=h,i.lineHeight=h,c={left:e,right:i}}}function _(){d();var t=cc.director._lastUpdate;s.frame._counter.start(t),s.logic._counter.start(t)}function m(){var t=performance.now();cc.director.isPaused()?s.frame._counter.start(t):s.logic._counter.end(t),s.render._counter.start(t)}function p(){var t=performance.now();s.render._counter.end(t),s.draws._counter.value=b8e.renderer.drawCalls,s.frame._counter.end(t),s.fps._counter.frame(t);var e="",n="";for(var i in s){var r=s[i];r._counter.sample(t),e+=r.desc+"\n",n+=r._counter.human()+"\n"}c.left.string=e,c.right.string=n}cc.profiler=e.exports={isShowingStats:function(){return a},hideStats:function(){a&&(o&&(o.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,_),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,m),cc.director.off(cc.Director.EVENT_AFTER_DRAW,p),a=!1)},showStats:function(){a||(u(),l(),o&&(o.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,_),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,m),cc.director.on(cc.Director.EVENT_AFTER_DRAW,p),a=!0)}}},{"../../platform/CCMacro":86,"./perf-counter":168}],167:[function(t,e,n){"use strict";var i=cc.Class({name:"cc.Counter",ctor:function(t,e,n){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=n},properties:{value:{get:function(){return this._value},set:function(t){this._value=t}}},_average:function(t,e){if(this._opts.average){this._accumValue+=t,++this._accumSamples;var n=e;n-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=n,this._accumSamples=0)}},sample:function(t){this._average(this._value,t)},human:function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}});e.exports=i},{}],168:[function(t,e,n){"use strict";var i=t("./counter"),r=cc.Class({name:"cc.PerfCounter",extends:i,ctor:function(t,e,n){this._time=n},start:function(t){this._time=t},end:function(t){this._value=t-this._time,this._average(this._value)},tick:function(){this.end(),this.start()},frame:function(t){var e=t,n=e-this._time;this._total++,(this._opts.average||1e3)<n&&(this._value=1e3*this._total/n,this._total=0,this._time=e,this._average(this._value))}});e.exports=r},{"./counter":167}],169:[function(t,e,n){"use strict";var i=.26;IS_RUNTIME&&(i=0);var r={BASELINE_RATIO:i,MIDDLE_RATIO:(i+1)/2-i,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,label_firstEmoji:/^[\uD83C\uDF00-\uDFFF\uDC00-\uDE4F]/,label_lastEmoji:/([\uDF00-\uDFFF\uDC00-\uDE4F]+|\S)$/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(t){return this.__CHINESE_REG.test(t)||this.__JAPANESE_REG.test(t)||this.__KOREAN_REG.test(t)},isUnicodeSpace:function(t){return 9<=(t=t.charCodeAt(0))&&t<=13||32===t||133===t||160===t||5760===t||8192<=t&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},safeMeasureText:function(t,e){var n=t.measureText(e);return n&&n.width||0},fragmentText:function(t,e,n,i){var r=[];if(0===t.length||n<0)return r.push(""),r;for(var a=t;n<e&&1<a.length;){for(var s=a.length*(n/e)|0,o=a.substr(s),c=e-i(o),u=o,l=0,h=0;n<c&&h++<10;)s*=n/c,s|=0,c=e-i(o=a.substr(s));for(h=0;c<=n&&h++<10;){if(o){var f=this.label_wordRex.exec(o);l=f?f[0].length:1,u=o}s+=l,c=e-i(o=a.substr(s))}0==(s-=l)&&(s=1,u=u.substr(1));var d,_=a.substr(0,s);this.label_wrapinspection&&this.label_symbolRex.test(u||o)&&(0==(s-=(d=this.label_lastWordRex.exec(_))?d[0].length:0)&&(s=1),u=a.substr(s),_=a.substr(0,s)),this.label_firstEmoji.test(u)&&(d=this.label_lastEmoji.exec(_))&&_!==d[0]&&(s-=d[0].length,u=a.substr(s),_=a.substr(0,s)),this.label_firstEnglish.test(u)&&(d=this.label_lastEnglish.exec(_))&&_!==d[0]&&(s-=d[0].length,u=a.substr(s),_=a.substr(0,s)),0===r.length?r.push(_):0<(_=_.trim()).length&&r.push(_),e=i(a=u||o)}return 0===r.length?r.push(a):0<(a=a.trim()).length&&r.push(a),r}};cc.textUtils=r,e.exports=r},{}],170:[function(t,e,n){"use strict";cc.textureUtil=e.exports={postLoadTexture:function(t,e){t.loaded?e&&e():t.url||e&&e()}}},{}],171:[function(i,t,e){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i("./value-type"),s=i("../platform/js"),n=function(){function o(t,e,n,i){"object"===(void 0===t?"undefined":r(t))&&(e=t.g,n=t.b,i=t.a,t=t.r),t=t||0,e=e||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+t}s.extend(o,a),i("../platform/CCClass").fastDefine("cc.Color",o,{r:0,g:0,b:0,a:255});var t={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var e in t)s.get(o,e,function(t){return function(){return new o(t[0],t[1],t[2],t[3])}}(t[e]));var n=o.prototype;return n.clone=function(){var t=new o;return t._val=this._val,t},n.equals=function(t){return t&&this._val===t._val},n.lerp=function(t,e,n){n=n||new o;var i=this.r,r=this.g,a=this.b,s=this.a;return n.r=i+(t.r-i)*e,n.g=r+(t.g-r)*e,n.b=a+(t.b-a)*e,n.a=s+(t.a-s)*e,n},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.getR=function(){return 255&this._val},n.setR=function(t){return t=~~cc.misc.clampf(t,0,255),this._val=(4294967040&this._val|t)>>>0,this},n.getG=function(){return(65280&this._val)>>8},n.setG=function(t){return t=~~cc.misc.clampf(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0,this},n.getB=function(){return(16711680&this._val)>>16},n.setB=function(t){return t=~~cc.misc.clampf(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0,this},n.getA=function(){return(4278190080&this._val)>>>24},n.setA=function(t){return t=~~cc.misc.clampf(t,0,255),this._val=(16777215&this._val|t<<24)>>>0,this},n._fastSetA=function(t){this._val=(16777215&this._val|t<<24)>>>0},s.getset(n,"_$r",n.getR,n.setR,!0),s.getset(n,"_$g",n.getG,n.setG,!0),s.getset(n,"_$b",n.getB,n.setB,!0),s.getset(n,"_$a",n.getA,n.setA,!0),n.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},n.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||255;return this._val=(r<<24>>>0)+(i<<16)+(n<<8)+e,this},n.toHEX=function(t){var e=[(this.r<16?"0":"")+(0|this.r).toString(16),(this.g<16?"0":"")+(0|this.g).toString(16),(this.b<16?"0":"")+(0|this.b).toString(16)],n=-1;if("#rgb"===t)for(n=0;n<e.length;++n)1<e[n].length&&(e[n]=e[n][0]);else if("#rrggbb"===t)for(n=0;n<e.length;++n)1===e[n].length&&(e[n]="0"+e[n]);else"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+(0|this.a).toString(16));return e.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(t,e,n){var i,r,a;if(0===e)i=r=a=n;else if(0===n)i=r=a=0;else{1===t&&(t=0),t*=6,e=e,n=n;var s=Math.floor(t),o=t-s,c=n*(1-e),u=n*(1-e*o),l=n*(1-e*(1-o));switch(s){case 0:i=n,r=l,a=c;break;case 1:i=u,r=n,a=c;break;case 2:i=c,r=n,a=l;break;case 3:i=c,r=u,a=n;break;case 4:i=l,r=c,a=n;break;case 5:i=n,r=c,a=u}}return i*=255,r*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(r<<8)+i,this},n.toHSV=function(){var t=this.r/255,e=this.g/255,n=this.b/255,i={h:0,s:0,v:0},r=Math.max(t,e,n),a=Math.min(t,e,n),s=0;return i.v=r,i.s=r?(r-a)/r:0,i.s?(s=r-a,i.h=t===r?(e-n)/s:e===r?2+(n-t)/s:4+(t-e)/s,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(t){t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a)},o}();cc.Color=n,cc.color=function(t,e,n,i){return"string"!=typeof t?"object"===(void 0===t?"undefined":r(t))?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,n,i):(new cc.Color).fromHEX(t)},t.exports=cc.Color},{"../platform/CCClass":81,"../platform/js":101,"./value-type":177}],172:[function(t,e,n){"use strict";t("./value-type"),cc.vmath=t("../vmath").default,cc.valueTypes={Vec2:t("./vec2"),Vec3:t("./vec3"),Vec4:t("./vec4"),Quat:t("./quat"),Mat4:t("./mat4"),Size:t("./size"),Rect:t("./rect"),Color:t("./color")}},{"../vmath":184,"./color":171,"./mat4":173,"./quat":174,"./rect":175,"./size":176,"./value-type":177,"./vec2":178,"./vec3":179,"./vec4":180}],173:[function(t,e,n){"use strict";var i=t("../vmath"),r=t("./value-type"),a=t("../platform/js"),s=t("../platform/CCClass");function p(t,e,n,i,r,a,s,o,c,u,l,h,f,d,_,m){var p=this;p.m00=t,p.m01=e,p.m02=n,p.m03=i,p.m04=r,p.m05=a,p.m06=s,p.m07=o,p.m08=c,p.m09=u,p.m10=l,p.m11=h,p.m12=f,p.m13=d,p.m14=_,p.m15=m}a.extend(p,r),s.fastDefine("cc.Mat4",p,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),a.mixin(p.prototype,{clone:function(){var t=this;return new p(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},set:function(t){var e=this;return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,this},equals:function(t){return i.mat4.exactEquals(this,t)},fuzzyEquals:function(t){return i.mat4.equals(this,t)},toString:function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+",\n"+t.m04+", "+t.m05+", "+t.m06+", "+t.m07+",\n"+t.m08+", "+t.m09+", "+t.m10+", "+t.m11+",\n"+t.m12+", "+t.m13+", "+t.m14+", "+t.m15+"\n]"},identity:function(){return i.mat4.identity(this)},transpose:function(t){return t=t||new cc.Mat4,i.mat4.transpose(t,this)},invert:function(t){return t=t||new cc.Mat4,i.mat4.invert(t,this)},adjoint:function(t){return t=t||new cc.Mat4,i.mat4.adjoint(t,this)},determinant:function(){return i.mat4.determinant(this)},add:function(t,e){return e=e||new cc.Mat4,i.mat4.add(e,this,t)},sub:function(t,e){return e=e||new cc.Mat4,i.mat4.subtract(e,this,t)},mul:function(t,e){return e=e||new cc.Mat4,i.mat4.multiply(e,this,t)},mulScalar:function(t,e){return e=e||new cc.Mat4,i.mat4.mulScalar(e,this,t)},translate:function(t,e){return e=e||new cc.Mat4,i.mat4.translate(e,this,t)},scale:function(t,e){return e=e||new cc.Mat4,i.mat4.scale(e,this,t)},rotate:function(t,e,n){return n=n||new cc.Mat4,i.mat4.rotate(n,this,t,e)},getTranslation:function(t){return t=t||new cc.Vec3,i.mat4.getTranslation(t,this)},getScale:function(t){return t=t||new cc.Vec3,i.mat4.getScaling(t,this)},getRotation:function(t){return t=t||new cc.Quat,i.mat4.getRotation(t,this)},fromRTS:function(t,e,n){return i.mat4.fromRTS(this,t,e,n)},fromQuat:function(t){return i.mat4.fromQuat(this,t)}}),cc.mat4=function(t,e,n,i,r,a,s,o,c,u,l,h,f,d,_,m){return new p(t,e,n,i,r,a,s,o,c,u,l,h,f,d,_,m)},e.exports=cc.Mat4=p},{"../platform/CCClass":81,"../platform/js":101,"../vmath":184,"./value-type":177}],174:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./value-type"),a=t("../platform/js"),s=t("../platform/CCClass"),o=t("../vmath/quat");function c(t,e,n,i){t&&"object"===(void 0===t?"undefined":r(t))&&(n=t.z,e=t.y,i=t.w,t=t.x),this.x=t||0,this.y=e||0,this.z=n||0,this.w=i||1}a.extend(c,i),s.fastDefine("cc.Quat",c,{x:0,y:0,z:0,w:1});var u=c.prototype;u.clone=function(){return new c(this.x,this.y,this.z,this.w)},u.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},u.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},u.toEuler=function(t){return o.toEuler(t,this),t},u.fromEuler=function(t){return o.fromEuler(this,t.x,t.y,t.z),this},u.lerp=function(t,e,n){return n=n||new cc.Quat,o.slerp(n,this,t,e),n},u.mul=function(t,e){return e=e||new cc.Quat,o.mul(e,this,t),e},cc.quat=function(t,e,n,i){return new c(t,e,n,i)},e.exports=cc.Quat=c},{"../platform/CCClass":81,"../platform/js":101,"../vmath/quat":189,"./value-type":177}],175:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./value-type"),a=t("../platform/js");function o(t,e,n,i){t&&"object"===(void 0===t?"undefined":r(t))&&(e=t.y,n=t.width,i=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0}a.extend(o,i),t("../platform/CCClass").fastDefine("cc.Rect",o,{x:0,y:0,width:0,height:0}),o.fromMinMax=function(t,e){var n=Math.min(t.x,e.x),i=Math.min(t.y,e.y);return new o(n,i,Math.max(t.x,e.x)-n,Math.max(t.y,e.y)-i)};var s=o.prototype;s.clone=function(){return new o(this.x,this.y,this.width,this.height)},s.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},s.lerp=function(t,e,n){n=n||new o;var i=this.x,r=this.y,a=this.width,s=this.height;return n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n.width=a+(t.width-a)*e,n.height=s+(t.height-s)*e,n},s.set=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},s.intersects=function(t){var e=this.x+this.width,n=this.y+this.height,i=t.x+t.width,r=t.y+t.height;return!(e<t.x||i<this.x||n<t.y||r<this.y)},s.intersection=function(t,e){var n=this.x,i=this.y,r=this.x+this.width,a=this.y+this.height,s=e.x,o=e.y,c=e.x+e.width,u=e.y+e.height;return t.x=Math.max(n,s),t.y=Math.max(i,o),t.width=Math.min(r,c)-t.x,t.height=Math.min(a,u)-t.y,t},s.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},s.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},s.union=function(t,e){var n=this.x,i=this.y,r=this.width,a=this.height,s=e.x,o=e.y,c=e.width,u=e.height;return t.x=Math.min(n,s),t.y=Math.min(i,o),t.width=Math.max(n+r,s+c)-t.x,t.height=Math.max(i+a,o+u)-t.y,t},s.transformMat4=function(t,e){var n=this.x,i=this.y,r=n+this.width,a=i+this.height,s=e.m00*n+e.m04*i+e.m12,o=e.m01*n+e.m05*i+e.m13,c=e.m00*r+e.m04*i+e.m12,u=e.m01*r+e.m05*i+e.m13,l=e.m00*n+e.m04*a+e.m12,h=e.m01*n+e.m05*a+e.m13,f=e.m00*r+e.m04*a+e.m12,d=e.m01*r+e.m05*a+e.m13,_=Math.min(s,c,l,f),m=Math.max(s,c,l,f),p=Math.min(o,u,h,d),v=Math.max(o,u,h,d);return t.x=_,t.y=p,t.width=m-_,t.height=v-p,t},s.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},a.getset(s,"_$xMin",function(){return this.x},function(t){this.width+=this.x-t,this.x=t}),a.getset(s,"_$yMin",function(){return this.y},function(t){this.height+=this.y-t,this.y=t}),a.getset(s,"_$xMax",function(){return this.x+this.width},function(t){this.width=t-this.x}),a.getset(s,"_$yMax",function(){return this.y+this.height},function(t){this.height=t-this.y}),a.getset(s,"_$center",function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}),a.getset(s,"_$origin",function(){return new cc.Vec2(this.x,this.y)},function(t){this.x=t.x,this.y=t.y}),a.getset(s,"_$size",function(){return new cc.Size(this.width,this.height)},function(t){this.width=t.width,this.height=t.height}),cc.Rect=o,cc.rect=function(t,e,n,i){return new o(t,e,n,i)},e.exports=cc.Rect},{"../platform/CCClass":81,"../platform/js":101,"./value-type":177}],176:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=t("./value-type"),a=t("../platform/js");function s(t,e){t&&"object"===(void 0===t?"undefined":i(t))&&(e=t.height,t=t.width),this.width=t||0,this.height=e||0}a.extend(s,r),t("../platform/CCClass").fastDefine("cc.Size",s,{width:0,height:0}),a.get(s,"_$ZERO",function(){return new s(0,0)});var o=s.prototype;o.clone=function(){return new s(this.width,this.height)},o.equals=function(t){return t&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,n){n=n||new s;var i=this.width,r=this.height;return n.width=i+(t.width-i)*e,n.height=r+(t.height-r)*e,n},o.set=function(t){this.width=t.width,this.height=t.height},o.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new s(t,e)},cc.Size=e.exports=s},{"../platform/CCClass":81,"../platform/js":101,"./value-type":177}],177:[function(t,e,n){"use strict";function i(){}t("../platform/js").setClassName("cc.ValueType",i),i.prototype.toString=function(){return""+{}},cc.ValueType=e.exports=i},{"../platform/js":101}],178:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=t("../vmath"),a=t("./value-type"),s=t("../platform/js"),o=t("../platform/CCClass"),c=t("../utils/misc");function u(t,e){t&&"object"===(void 0===t?"undefined":i(t))&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0}s.extend(u,a),o.fastDefine("cc.Vec2",u,{x:0,y:0});var l=u.prototype;s.value(l,"_$z",0,!0),l.clone=function(){return new u(this.x,this.y)},l.set=function(t){return this.x=t.x,this.y=t.y,this},l.equals=function(t){return t&&this.x===t.x&&this.y===t.y},l.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e},l.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},l.lerp=function(t,e,n){n=n||new u;var i=this.x,r=this.y;return n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n},l.clampf=function(t,e){return this.x=c.clampf(this.x,t.x,e.x),this.y=c.clampf(this.y,t.y,e.y),this},l.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},l.add=function(t,e){return(e=e||new u).x=this.x+t.x,e.y=this.y+t.y,e},l.subSelf=function(t){return this.x-=t.x,this.y-=t.y,this},l.sub=function(t,e){return(e=e||new u).x=this.x-t.x,e.y=this.y-t.y,e},l.mulSelf=function(t){return this.x*=t,this.y*=t,this},l.mul=function(t,e){return(e=e||new u).x=this.x*t,e.y=this.y*t,e},l.scaleSelf=function(t){return this.x*=t.x,this.y*=t.y,this},l.scale=function(t,e){return(e=e||new u).x=this.x*t.x,e.y=this.y*t.y,e},l.divSelf=function(t){return this.x/=t,this.y/=t,this},l.div=function(t,e){return(e=e||new u).x=this.x/t,e.y=this.y/t,e},l.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},l.neg=function(t){return(t=t||new u).x=-this.x,t.y=-this.y,t},l.dot=function(t){return this.x*t.x+this.y*t.y},l.cross=function(t){return this.x*t.y-this.y*t.x},l.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},l.magSqr=function(){return this.x*this.x+this.y*this.y},l.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1==t)return this;if(0==t)return this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},l.normalize=function(t){return(t=t||new u).x=this.x,t.y=this.y,t.normalizeSelf(),t},l.angle=function(t){var e=this.magSqr(),n=t.magSqr();if(0===e||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(t)/Math.sqrt(e*n);return i=c.clampf(i,-1,1),Math.acos(i)},l.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},l.rotate=function(t,e){return(e=e||new u).x=this.x,e.y=this.y,e.rotateSelf(t)},l.rotateSelf=function(t){var e=Math.sin(t),n=Math.cos(t),i=this.x;return this.x=n*i-e*this.y,this.y=e*i+n*this.y,this},l.project=function(t){return t.mul(this.dot(t)/t.dot(t))},l.transformMat4=function(t,e){e=e||new u,r.vec2.transformMat4(e,this,t)},s.get(u,"_$ONE",function(){return new u(1,1)}),s.get(u,"_$ZERO",function(){return new u(0,0)}),s.get(u,"_$UP",function(){return new u(0,1)}),s.get(u,"_$RIGHT",function(){return new u(1,0)}),cc.Vec2=u,cc.v2=function(t,e){return new u(t,e)},cc.p=cc.v2,e.exports=cc.Vec2},{"../platform/CCClass":81,"../platform/js":101,"../utils/misc":163,"../vmath":184,"./value-type":177}],179:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=t("../vmath"),a=t("./value-type"),s=t("../platform/js"),o=t("../platform/CCClass"),c=t("../utils/misc"),u=t("./vec2").prototype;function l(t,e,n){t&&"object"===(void 0===t?"undefined":i(t))&&(n=t.z,e=t.y,t=t.x),this.x=t||0,this.y=e||0,this.z=n||0}s.extend(l,a),o.fastDefine("cc.Vec3",l,{x:0,y:0,z:0});var h=l.prototype;h.clone=function(){return new l(this.x,this.y,this.z)},h.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},h.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},h.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e&&this.z-e<=t.z&&t.z<=this.z+e},h.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},h.lerp=function(t,e,n){return n=n||new l,r.vec3.lerp(n,this,t,e),n},h.clampf=function(t,e){return this.x=c.clampf(this.x,t.x,e.x),this.y=c.clampf(this.y,t.y,e.y),this.z=c.clampf(this.z,t.z,e.z),this},h.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},h.add=function(t,e){return(e=e||new l).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e},h.subSelf=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},h.sub=function(t,e){return(e=e||new l).x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e},h.mulSelf=function(t){return this.x*=t,this.y*=t,this.z*=t,this},h.mul=function(t,e){return(e=e||new l).x=this.x*t,e.y=this.y*t,e.z=this.z*t,e},h.scaleSelf=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},h.scale=function(t,e){return(e=e||new l).x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e},h.divSelf=function(t){return this.x/=t,this.y/=t,this.z/=t,this},h.div=function(t,e){return(e=e||new l).x=this.x/t,e.y=this.y/t,e.z=this.z/t,e},h.negSelf=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},h.neg=function(t){return(t=t||new l).x=-this.x,t.y=-this.y,t.z=-this.z,t},h.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},h.cross=function(t,e){return e=e||new l,r.vec3.cross(e,this,t),e},h.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},h.magSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},h.normalizeSelf=function(){return r.vec3.normalize(this,this),this},h.normalize=function(t){return t=t||new l,r.vec3.normalize(t,this),t},h.transformMat4=function(t,e){e=e||new l,r.vec3.transformMat4(e,this,t)},h.angle=u.angle,h.project=u.project,h.signAngle=function(t){var e=new cc.Vec2(this.x,this.y),n=new cc.Vec2(t.x,t.y);return e.signAngle(n)},h.rotate=function(t,e){return u.rotate.call(this,t,e)},h.rotateSelf=function(t){return u.rotateSelf.call(this,t)},s.get(l,"_$ONE",function(){return new l(1,1,1)}),s.get(l,"_$ZERO",function(){return new l(0,0,0)}),s.get(l,"_$UP",function(){return new l(0,1,0)}),s.get(l,"_$RIGHT",function(){return new l(1,0,0)}),s.get(l,"_$FRONT",function(){return new l(0,0,1)}),cc.v3=function(t,e,n){return new l(t,e,n)},e.exports=cc.Vec3=l},{"../platform/CCClass":81,"../platform/js":101,"../utils/misc":163,"../vmath":184,"./value-type":177,"./vec2":178}],180:[function(t,e,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),r=u(t("./value-type")),a=u(t("../platform/CCClass")),o=t("../vmath"),c=t("../utils/misc");function u(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var d=function(){function a(t,e,n,i){l(this,a);var r=h(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return t&&"object"===(void 0===t?"undefined":s(t))&&(i=t.w,n=t.z,e=t.y,t=t.x),r.x=t||0,r.y=e||0,r.z=n||0,r.w=i||0,r}return f(a,r.default),i(a,[{key:"clone",value:function(){return new a(this.x,this.y,this.z,this.w)}},{key:"set",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"equals",value:function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}},{key:"fuzzyEquals",value:function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e&&this.z-e<=t.z&&t.z<=this.z+e&&this.w-e<=t.w&&t.w<=this.w+e}},{key:"toString",value:function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"}},{key:"lerp",value:function(t,e,n){return n=n||new a,o.vec4.lerp(n,this,t,e),n}},{key:"clampf",value:function(t,e){return this.x=(0,c.clampf)(this.x,t.x,e.x),this.y=(0,c.clampf)(this.y,t.y,e.y),this.z=(0,c.clampf)(this.z,t.z,e.z),this.w=(0,c.clampf)(this.w,t.w,e.w),this}},{key:"addSelf",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"add",value:function(t,e){return(e=e||new a).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,e}},{key:"subSelf",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"sub",value:function(t,e){return(e=e||new a).x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,e}},{key:"mulSelf",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"mul",value:function(t,e){return(e=e||new a).x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t,e}},{key:"scaleSelf",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"scale",value:function(t,e){return(e=e||new a).x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e.w=this.w*t.w,e}},{key:"divSelf",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"div",value:function(t,e){return(e=e||new a).x=this.x/t,e.y=this.y/t,e.z=this.z/t,e.w=this.w/t,e}},{key:"negSelf",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"neg",value:function(t){return(t=t||new a).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=-this.w,t}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"cross",value:function(t,e){return e=e||new a,o.vec4.cross(e,this,t),e}},{key:"mag",value:function(){var t=this.x,e=this.y,n=this.z,i=this.w;return Math.sqrt(t*t+e*e+n*n+i*i)}},{key:"magSqr",value:function(){var t=this.x,e=this.y,n=this.z,i=this.w;return t*t+e*e+n*n+i*i}},{key:"normalizeSelf",value:function(){return o.vec4.normalize(this,this),this}},{key:"normalize",value:function(t){return t=t||new a,o.vec4.normalize(t,this),t}},{key:"transformMat4",value:function(t,e){return e=e||new a,o.vec4.transformMat4(e,this,t),e}}]),a}();a.default.fastDefine("cc.Vec4",d,{x:0,y:0,z:0,w:0}),cc.v4=function(t,e,n,i){return new d(t,e,n,i)},e.exports=cc.Vec4=d},{"../platform/CCClass":81,"../utils/misc":163,"../vmath":184,"./value-type":177}],181:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.sign=function(t){return(0<t)-(t<0)},n.abs=function(t){var e=t>>i-1;return(t^e)-e},n.min=function(t,e){return e^(t^e)&-(t<e)},n.max=function(t,e){return t^(t^e)&-(t<e)},n.isPow2=function(t){return!(t&t-1||!t)},n.log2=function(t){var e=void 0,n=void 0;return e=(65535<t)<<4,e|=n=(255<(t>>>=e))<<3,e|=n=(15<(t>>>=n))<<2,(e|=n=(3<(t>>>=n))<<1)|(t>>>=n)>>1},n.log10=function(t){return 1e9<=t?9:1e8<=t?8:1e7<=t?7:1e6<=t?6:1e5<=t?5:1e4<=t?4:1e3<=t?3:100<=t?2:10<=t?1:0},n.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},n.countTrailingZeros=r,n.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)},n.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},n.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},n.reverse=function(t){return a[255&t]<<24|a[t>>>8&255]<<16|a[t>>>16&255]<<8|a[t>>>24&255]},n.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},n.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},n.interleave3=function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},n.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},n.nextCombination=function(t){var e=t|t-1;return 1+e|(~e&-~e)-1>>>r(t)+1};var i=n.INT_BITS=32;function r(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}n.INT_MAX=2147483647,n.INT_MIN=-1<<i-1;var a=new Array(256);(function(t){for(var e=0;e<256;++e){var n=e,i=e,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;t[e]=i<<r&255}})(a)},{}],182:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),c=t("./utils");function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;a(this,i),this.r=t,this.g=e,this.b=n}return r(i,null,[{key:"create",value:function(t,e,n){return new i(0<arguments.length&&void 0!==t?t:1,1<arguments.length&&void 0!==e?e:1,2<arguments.length&&void 0!==n?n:1)}},{key:"clone",value:function(t){return new i(t.r,t.g,t.b)}},{key:"copy",value:function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t}},{key:"set",value:function(t,e,n,i){return t.r=e,t.g=n,t.b=i,t}},{key:"fromHex",value:function(t,e){var n=(e>>16)/255,i=(e>>8&255)/255,r=(255&e)/255;return t.r=n,t.g=i,t.b=r,t}},{key:"add",value:function(t,e,n){return t.r=e.r+n.r,t.g=e.g+n.g,t.b=e.b+n.b,t}},{key:"subtract",value:function(t,e,n){return t.r=e.r-n.r,t.g=e.g-n.g,t.b=e.b-n.b,t}},{key:"sub",value:function(t,e,n){return i.subtract(t,e,n)}},{key:"multiply",value:function(t,e,n){return t.r=e.r*n.r,t.g=e.g*n.g,t.b=e.b*n.b,t}},{key:"mul",value:function(t,e,n){return i.multiply(t,e,n)}},{key:"divide",value:function(t,e,n){return t.r=e.r/n.r,t.g=e.g/n.g,t.b=e.b/n.b,t}},{key:"div",value:function(t,e,n){return i.divide(t,e,n)}},{key:"scale",value:function(t,e,n){return t.r=e.r*n,t.g=e.g*n,t.b=e.b*n,t}},{key:"lerp",value:function(t,e,n,i){var r=e.r,a=e.g,s=e.b;return t.r=r+i*(n.r-r),t.g=a+i*(n.g-a),t.b=s+i*(n.b-s),t}},{key:"str",value:function(t){return"color3("+t.r+", "+t.g+", "+t.b+")"}},{key:"array",value:function(t,e){var n=e instanceof cc.Color?1/255:1;return t[0]=e.r*n,t[1]=e.g*n,t[2]=e.b*n,t}},{key:"exactEquals",value:function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b}},{key:"equals",value:function(t,e){var n=t.r,i=t.g,r=t.b,a=e.r,s=e.g,o=e.b;return Math.abs(n-a)<=c.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=c.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=c.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))}},{key:"hex",value:function(t){return 255*t.r<<16|255*t.g<<8|255*t.b}}]),i}();n.default=i},{"./utils":190}],183:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),l=t("./utils");function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;a(this,r),this.r=t,this.g=e,this.b=n,this.a=i}return i(r,null,[{key:"create",value:function(t,e,n,i){return new r(0<arguments.length&&void 0!==t?t:1,1<arguments.length&&void 0!==e?e:1,2<arguments.length&&void 0!==n?n:1,3<arguments.length&&void 0!==i?i:1)}},{key:"clone",value:function(t){return new r(t.r,t.g,t.b,t.a)}},{key:"copy",value:function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t}},{key:"set",value:function(t,e,n,i,r){return t.r=e,t.g=n,t.b=i,t.a=r,t}},{key:"fromHex",value:function(t,e){var n=(e>>24)/255,i=(e>>16&255)/255,r=(e>>8&255)/255,a=(255&e)/255;return t.r=n,t.g=i,t.b=r,t.a=a,t}},{key:"add",value:function(t,e,n){return t.r=e.r+n.r,t.g=e.g+n.g,t.b=e.b+n.b,t.a=e.a+n.a,t}},{key:"subtract",value:function(t,e,n){return t.r=e.r-n.r,t.g=e.g-n.g,t.b=e.b-n.b,t.a=e.a-n.a,t}},{key:"sub",value:function(t,e,n){return r.subtract(t,e,n)}},{key:"multiply",value:function(t,e,n){return t.r=e.r*n.r,t.g=e.g*n.g,t.b=e.b*n.b,t.a=e.a*n.a,t}},{key:"mul",value:function(t,e,n){return r.multiply(t,e,n)}},{key:"divide",value:function(t,e,n){return t.r=e.r/n.r,t.g=e.g/n.g,t.b=e.b/n.b,t.a=e.a/n.a,t}},{key:"div",value:function(t,e,n){return r.divide(t,e,n)}},{key:"scale",value:function(t,e,n){return t.r=e.r*n,t.g=e.g*n,t.b=e.b*n,t.a=e.a*n,t}},{key:"lerp",value:function(t,e,n,i){var r=e.r,a=e.g,s=e.b,o=e.a;return t.r=r+i*(n.r-r),t.g=a+i*(n.g-a),t.b=s+i*(n.b-s),t.a=o+i*(n.a-o),t}},{key:"str",value:function(t){return"color4("+t.r+", "+t.g+", "+t.b+", "+t.a+")"}},{key:"array",value:function(t,e){var n=e instanceof cc.Color||1<e.a?1/255:1;return t[0]=e.r*n,t[1]=e.g*n,t[2]=e.b*n,t[3]=e.a*n,t}},{key:"exactEquals",value:function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}},{key:"equals",value:function(t,e){var n=t.r,i=t.g,r=t.b,a=t.a,s=e.r,o=e.g,c=e.b,u=e.a;return Math.abs(n-s)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-c)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-u)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))}},{key:"hex",value:function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0}}]),r}();n.default=r},{"./utils":190}],184:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.color4=n.color3=n.mat4=n.mat3=n.mat23=n.mat2=n.quat=n.vec4=n.vec3=n.vec2=n.bits=void 0;var i=t("./utils");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return i[t]}})});var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(t("./bits")),a=m(t("./vec2")),s=m(t("./vec3")),o=m(t("./vec4")),c=m(t("./quat")),u=m(t("./mat2")),l=m(t("./mat23")),h=m(t("./mat3")),f=m(t("./mat4")),d=m(t("./color3")),_=m(t("./color4"));function m(t){return t&&t.__esModule?t:{default:t}}n.bits=r,n.vec2=a.default,n.vec3=s.default,n.vec4=o.default,n.quat=c.default,n.mat2=u.default,n.mat23=l.default,n.mat3=h.default,n.mat4=f.default,n.color3=d.default,n.color4=_.default,n.default={vec2:a.default,vec3:s.default,vec4:o.default,quat:c.default,mat2:u.default,mat23:l.default,mat3:h.default,mat4:f.default,color3:d.default,color4:_.default}},{"./bits":181,"./color3":182,"./color4":183,"./mat2":185,"./mat23":186,"./mat3":187,"./mat4":188,"./quat":189,"./utils":190,"./vec2":191,"./vec3":192,"./vec4":193}],185:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),l=t("./utils");function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;a(this,r),this.m00=t,this.m01=e,this.m02=n,this.m03=i}return i(r,null,[{key:"create",value:function(t,e,n,i){return new r(0<arguments.length&&void 0!==t?t:1,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:1)}},{key:"clone",value:function(t){return new r(t.m00,t.m01,t.m02,t.m03)}},{key:"copy",value:function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t}},{key:"identity",value:function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=1,t}},{key:"set",value:function(t,e,n,i,r){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t}},{key:"transpose",value:function(t,e){if(t===e){var n=e.m01;t.m01=e.m02,t.m02=n}else t.m00=e.m00,t.m01=e.m02,t.m02=e.m01,t.m03=e.m03;return t}},{key:"invert",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=n*a-r*i;return s?(s=1/s,t.m00=a*s,t.m01=-i*s,t.m02=-r*s,t.m03=n*s,t):null}},{key:"adjoint",value:function(t,e){var n=e.m00;return t.m00=e.m03,t.m01=-e.m01,t.m02=-e.m02,t.m03=n,t}},{key:"determinant",value:function(t){return t.m00*t.m03-t.m02*t.m01}},{key:"multiply",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=n.m00,c=n.m01,u=n.m02,l=n.m03;return t.m00=i*o+a*c,t.m01=r*o+s*c,t.m02=i*u+a*l,t.m03=r*u+s*l,t}},{key:"mul",value:function(t,e,n){return r.multiply(t,e,n)}},{key:"rotate",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=Math.sin(n),c=Math.cos(n);return t.m00=i*c+a*o,t.m01=r*c+s*o,t.m02=i*-o+a*c,t.m03=r*-o+s*c,t}},{key:"scale",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=n.x,c=n.y;return t.m00=i*o,t.m01=r*o,t.m02=a*c,t.m03=s*c,t}},{key:"fromRotation",value:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=-n,t.m03=i,t}},{key:"fromScaling",value:function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=e.y,t}},{key:"str",value:function(t){return"mat2("+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+")"}},{key:"array",value:function(t,e){return t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m03,t}},{key:"frob",value:function(t){return Math.sqrt(Math.pow(t.m00,2)+Math.pow(t.m01,2)+Math.pow(t.m02,2)+Math.pow(t.m03,2))}},{key:"LDU",value:function(t,e,n,i){t.m02=i.m02/i.m00,n.m00=i.m00,n.m01=i.m01,n.m03=i.m03-t.m02*n.m01}},{key:"add",value:function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t}},{key:"subtract",value:function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t}},{key:"sub",value:function(t,e,n){return r.subtract(t,e,n)}},{key:"exactEquals",value:function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03}},{key:"equals",value:function(t,e){var n=t.m00,i=t.m01,r=t.m02,a=t.m03,s=e.m00,o=e.m01,c=e.m02,u=e.m03;return Math.abs(n-s)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-c)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-u)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))}},{key:"multiplyScalar",value:function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t}},{key:"multiplyScalarAndAdd",value:function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t}}]),r}();n.default=r},{"./utils":190}],186:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),_=t("./utils");function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;o(this,s),this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a}return i(s,null,[{key:"create",value:function(t,e,n,i,r,a){return new s(0<arguments.length&&void 0!==t?t:1,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:1,4<arguments.length&&void 0!==r?r:0,5<arguments.length&&void 0!==a?a:0)}},{key:"clone",value:function(t){return new s(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05)}},{key:"copy",value:function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t}},{key:"identity",value:function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=1,t.m04=0,t.m05=0,t}},{key:"set",value:function(t,e,n,i,r,a,s){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=s,t}},{key:"invert",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=e.m04,o=e.m05,c=n*a-i*r;return c?(c=1/c,t.m00=a*c,t.m01=-i*c,t.m02=-r*c,t.m03=n*c,t.m04=(r*o-a*s)*c,t.m05=(i*s-n*o)*c,t):null}},{key:"determinant",value:function(t){return t.m00*t.m03-t.m01*t.m02}},{key:"multiply",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=n.m00,l=n.m01,h=n.m02,f=n.m03,d=n.m04,_=n.m05;return t.m00=i*u+a*l,t.m01=r*u+s*l,t.m02=i*h+a*f,t.m03=r*h+s*f,t.m04=i*d+a*_+o,t.m05=r*d+s*_+c,t}},{key:"mul",value:function(t,e,n){return s.multiply(t,e,n)}},{key:"rotate",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=Math.sin(n),l=Math.cos(n);return t.m00=i*l+a*u,t.m01=r*l+s*u,t.m02=i*-u+a*l,t.m03=r*-u+s*l,t.m04=o,t.m05=c,t}},{key:"scale",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=n.x,l=n.y;return t.m00=i*u,t.m01=r*u,t.m02=a*l,t.m03=s*l,t.m04=o,t.m05=c,t}},{key:"translate",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=n.x,l=n.y;return t.m00=i,t.m01=r,t.m02=a,t.m03=s,t.m04=i*u+a*l+o,t.m05=r*u+s*l+c,t}},{key:"fromRotation",value:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=-n,t.m03=i,t.m04=0,t.m05=0,t}},{key:"fromScaling",value:function(t,e){return t.m00=e.m00,t.m01=0,t.m02=0,t.m03=e.m01,t.m04=0,t.m05=0,t}},{key:"fromTranslation",value:function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=1,t.m04=e.x,t.m05=e.y,t}},{key:"fromRTS",value:function(t,e,n,i){var r=Math.sin(e),a=Math.cos(e);return t.m00=a*i.x,t.m01=r*i.x,t.m02=-r*i.y,t.m03=a*i.y,t.m04=n.x,t.m05=n.y,t}},{key:"str",value:function(t){return"mat23("+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+", "+t.m04+", "+t.m05+")"}},{key:"array",value:function(t,e){return t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m03,t[4]=e.m04,t[5]=e.m05,t}},{key:"array4x4",value:function(t,e){return t[0]=e.m00,t[1]=e.m01,t[2]=0,t[3]=0,t[4]=e.m02,t[5]=e.m03,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e.m04,t[13]=e.m05,t[14]=0,t[15]=1,t}},{key:"frob",value:function(t){return Math.sqrt(Math.pow(t.m00,2)+Math.pow(t.m01,2)+Math.pow(t.m02,2)+Math.pow(t.m03,2)+Math.pow(t.m04,2)+Math.pow(t.m05,2)+1)}},{key:"add",value:function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t}},{key:"subtract",value:function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t}},{key:"sub",value:function(t,e,n){return s.subtract(t,e,n)}},{key:"multiplyScalar",value:function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t}},{key:"multiplyScalarAndAdd",value:function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t.m04=e.m04+n.m04*i,t.m05=e.m05+n.m05*i,t}},{key:"exactEquals",value:function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05}},{key:"equals",value:function(t,e){var n=t.m00,i=t.m01,r=t.m02,a=t.m03,s=t.m04,o=t.m05,c=e.m00,u=e.m01,l=e.m02,h=e.m03,f=e.m04,d=e.m05;return Math.abs(n-c)<=_.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-u)<=_.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-l)<=_.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-h)<=_.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-f)<=_.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-d)<=_.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))}}]),s}();n.default=r},{"./utils":190}],187:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),x=t("./utils"),s=function(t){return t&&t.__esModule?t:{default:t}}(t("./vec3"));function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function u(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,o=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:1;l(this,u),this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=s,this.m07=o,this.m08=c}return i(u,null,[{key:"create",value:function(t,e,n,i,r,a,s,o,c){return new u(0<arguments.length&&void 0!==t?t:1,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:0,4<arguments.length&&void 0!==r?r:1,5<arguments.length&&void 0!==a?a:0,6<arguments.length&&void 0!==s?s:0,7<arguments.length&&void 0!==o?o:0,8<arguments.length&&void 0!==c?c:1)}},{key:"clone",value:function(t){return new u(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)}},{key:"copy",value:function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t}},{key:"set",value:function(t,e,n,i,r,a,s,o,c,u){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=s,t.m06=o,t.m07=c,t.m08=u,t}},{key:"identity",value:function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}},{key:"transpose",value:function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=n,t.m05=e.m07,t.m06=i,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t}},{key:"invert",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=e.m04,o=e.m05,c=e.m06,u=e.m07,l=e.m08,h=l*s-o*u,f=-l*a+o*c,d=u*a-s*c,_=n*h+i*f+r*d;return _?(_=1/_,t.m00=h*_,t.m01=(-l*i+r*u)*_,t.m02=(o*i-r*s)*_,t.m03=f*_,t.m04=(l*n-r*c)*_,t.m05=(-o*n+r*a)*_,t.m06=d*_,t.m07=(-u*n+i*c)*_,t.m08=(s*n-i*a)*_,t):null}},{key:"adjoint",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=e.m04,o=e.m05,c=e.m06,u=e.m07,l=e.m08;return t.m00=s*l-o*u,t.m01=r*u-i*l,t.m02=i*o-r*s,t.m03=o*c-a*l,t.m04=n*l-r*c,t.m05=r*a-n*o,t.m06=a*u-s*c,t.m07=i*c-n*u,t.m08=n*s-i*a,t}},{key:"determinant",value:function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,s=t.m05,o=t.m06,c=t.m07,u=t.m08;return e*(u*a-s*c)+n*(-u*r+s*o)+i*(c*r-a*o)}},{key:"multiply",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=e.m06,l=e.m07,h=e.m08,f=n.m00,d=n.m01,_=n.m02,m=n.m03,p=n.m04,v=n.m05,y=n.m06,g=n.m07,x=n.m08;return t.m00=f*i+d*s+_*u,t.m01=f*r+d*o+_*l,t.m02=f*a+d*c+_*h,t.m03=m*i+p*s+v*u,t.m04=m*r+p*o+v*l,t.m05=m*a+p*c+v*h,t.m06=y*i+g*s+x*u,t.m07=y*r+g*o+x*l,t.m08=y*a+g*c+x*h,t}},{key:"mul",value:function(t,e,n){return u.multiply(t,e,n)}},{key:"translate",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=e.m06,l=e.m07,h=e.m08,f=n.x,d=n.y;return t.m00=i,t.m01=r,t.m02=a,t.m03=s,t.m04=o,t.m05=c,t.m06=f*i+d*s+u,t.m07=f*r+d*o+l,t.m08=f*a+d*c+h,t}},{key:"rotate",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=e.m06,l=e.m07,h=e.m08,f=Math.sin(n),d=Math.cos(n);return t.m00=d*i+f*s,t.m01=d*r+f*o,t.m02=d*a+f*c,t.m03=d*s-f*i,t.m04=d*o-f*r,t.m05=d*c-f*a,t.m06=u,t.m07=l,t.m08=h,t}},{key:"scale",value:function(t,e,n){var i=n.x,r=n.y;return t.m00=i*e.m00,t.m01=i*e.m01,t.m02=i*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t}},{key:"fromMat4",value:function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t}},{key:"fromTranslation",value:function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t}},{key:"fromRotation",value:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=-n,t.m04=i,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}},{key:"fromScaling",value:function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}},{key:"fromMat2d",value:function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=0,t.m03=e.m02,t.m04=e.m03,t.m05=0,t.m06=e.m04,t.m07=e.m05,t.m08=1,t}},{key:"fromQuat",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,s=n+n,o=i+i,c=r+r,u=n*s,l=i*s,h=i*o,f=r*s,d=r*o,_=r*c,m=a*s,p=a*o,v=a*c;return t.m00=1-h-_,t.m03=l-v,t.m06=f+p,t.m01=l+v,t.m04=1-u-_,t.m07=d-m,t.m02=f-p,t.m05=d+m,t.m08=1-u-h,t}},{key:"fromViewUp",value:function(t,e,n){return function(){var i=s.default.create(0,1,0),r=s.default.create(0,0,0),a=s.default.create(0,0,0);return function(t,e,n){return s.default.sqrMag(e)<x.EPSILON*x.EPSILON?u.identity(t):(n=n||i,s.default.normalize(r,s.default.cross(r,n,e)),s.default.sqrMag(r)<x.EPSILON*x.EPSILON?u.identity(t):(s.default.cross(a,e,r),u.set(t,r.x,r.y,r.z,a.x,a.y,a.z,e.x,e.y,e.z))),t}}()(t,e,n)}},{key:"normalFromMat4",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=e.m04,o=e.m05,c=e.m06,u=e.m07,l=e.m08,h=e.m09,f=e.m10,d=e.m11,_=e.m12,m=e.m13,p=e.m14,v=e.m15,y=n*o-i*s,g=n*c-r*s,x=n*u-a*s,b=i*c-r*o,E=i*u-a*o,C=r*u-a*c,w=l*m-h*_,S=l*p-f*_,T=l*v-d*_,M=h*p-f*m,A=h*v-d*m,O=f*v-d*p,R=y*O-g*A+x*M+b*T-E*S+C*w;return R?(R=1/R,t.m00=(o*O-c*A+u*M)*R,t.m01=(c*T-s*O-u*S)*R,t.m02=(s*A-o*T+u*w)*R,t.m03=(r*A-i*O-a*M)*R,t.m04=(n*O-r*T+a*S)*R,t.m05=(i*T-n*A-a*w)*R,t.m06=(m*C-p*E+v*b)*R,t.m07=(p*x-_*C-v*g)*R,t.m08=(_*E-m*x+v*y)*R,t):null}},{key:"str",value:function(t){return"mat3("+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+", "+t.m04+", "+t.m05+", "+t.m06+", "+t.m07+", "+t.m08+")"}},{key:"array",value:function(t,e){return t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m03,t[4]=e.m04,t[5]=e.m05,t[6]=e.m06,t[7]=e.m07,t[8]=e.m08,t}},{key:"frob",value:function(t){return Math.sqrt(Math.pow(t.m00,2)+Math.pow(t.m01,2)+Math.pow(t.m02,2)+Math.pow(t.m03,2)+Math.pow(t.m04,2)+Math.pow(t.m05,2)+Math.pow(t.m06,2)+Math.pow(t.m07,2)+Math.pow(t.m08,2))}},{key:"add",value:function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t}},{key:"subtract",value:function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t}},{key:"sub",value:function(t,e,n){return u.subtract(t,e,n)}},{key:"multiplyScalar",value:function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t}},{key:"multiplyScalarAndAdd",value:function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t.m04=e.m04+n.m04*i,t.m05=e.m05+n.m05*i,t.m06=e.m06+n.m06*i,t.m07=e.m07+n.m07*i,t.m08=e.m08+n.m08*i,t}},{key:"exactEquals",value:function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08}},{key:"equals",value:function(t,e){var n=t.m00,i=t.m01,r=t.m02,a=t.m03,s=t.m04,o=t.m05,c=t.m06,u=t.m07,l=t.m08,h=e.m00,f=e.m01,d=e.m02,_=e.m03,m=e.m04,p=e.m05,v=e.m06,y=e.m07,g=e.m08;return Math.abs(n-h)<=x.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-f)<=x.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(r-d)<=x.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-_)<=x.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-m)<=x.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-p)<=x.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-v)<=x.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-y)<=x.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-g)<=x.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))}}]),u}();n.default=r},{"./utils":190,"./vec3":192}],188:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),I=t("./utils");function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function p(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,o=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:0,l=10<arguments.length&&void 0!==arguments[10]?arguments[10]:1,h=11<arguments.length&&void 0!==arguments[11]?arguments[11]:0,f=12<arguments.length&&void 0!==arguments[12]?arguments[12]:0,d=13<arguments.length&&void 0!==arguments[13]?arguments[13]:0,_=14<arguments.length&&void 0!==arguments[14]?arguments[14]:0,m=15<arguments.length&&void 0!==arguments[15]?arguments[15]:1;v(this,p),this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=s,this.m07=o,this.m08=c,this.m09=u,this.m10=l,this.m11=h,this.m12=f,this.m13=d,this.m14=_,this.m15=m}return i(p,null,[{key:"create",value:function(t,e,n,i,r,a,s,o,c,u,l,h,f,d,_,m){return new p(0<arguments.length&&void 0!==t?t:1,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:0,4<arguments.length&&void 0!==r?r:0,5<arguments.length&&void 0!==a?a:1,6<arguments.length&&void 0!==s?s:0,7<arguments.length&&void 0!==o?o:0,8<arguments.length&&void 0!==c?c:0,9<arguments.length&&void 0!==u?u:0,10<arguments.length&&void 0!==l?l:1,11<arguments.length&&void 0!==h?h:0,12<arguments.length&&void 0!==f?f:0,13<arguments.length&&void 0!==d?d:0,14<arguments.length&&void 0!==_?_:0,15<arguments.length&&void 0!==m?m:1)}},{key:"clone",value:function(t){return new p(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)}},{key:"copy",value:function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t}},{key:"set",value:function(t,e,n,i,r,a,s,o,c,u,l,h,f,d,_,m,p){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=s,t.m06=o,t.m07=c,t.m08=u,t.m09=l,t.m10=h,t.m11=f,t.m12=d,t.m13=_,t.m14=m,t.m15=p,t}},{key:"identity",value:function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}},{key:"transpose",value:function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m03,a=e.m06,s=e.m07,o=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=n,t.m06=e.m09,t.m07=e.m13,t.m08=i,t.m09=a,t.m11=e.m14,t.m12=r,t.m13=s,t.m14=o}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t}},{key:"invert",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=e.m04,o=e.m05,c=e.m06,u=e.m07,l=e.m08,h=e.m09,f=e.m10,d=e.m11,_=e.m12,m=e.m13,p=e.m14,v=e.m15,y=n*o-i*s,g=n*c-r*s,x=n*u-a*s,b=i*c-r*o,E=i*u-a*o,C=r*u-a*c,w=l*m-h*_,S=l*p-f*_,T=l*v-d*_,M=h*p-f*m,A=h*v-d*m,O=f*v-d*p,R=y*O-g*A+x*M+b*T-E*S+C*w;return R?(R=1/R,t.m00=(o*O-c*A+u*M)*R,t.m01=(r*A-i*O-a*M)*R,t.m02=(m*C-p*E+v*b)*R,t.m03=(f*E-h*C-d*b)*R,t.m04=(c*T-s*O-u*S)*R,t.m05=(n*O-r*T+a*S)*R,t.m06=(p*x-_*C-v*g)*R,t.m07=(l*C-f*x+d*g)*R,t.m08=(s*A-o*T+u*w)*R,t.m09=(i*T-n*A-a*w)*R,t.m10=(_*E-m*x+v*y)*R,t.m11=(h*x-l*E-d*y)*R,t.m12=(o*S-s*M-c*w)*R,t.m13=(n*M-i*S+r*w)*R,t.m14=(m*g-_*b-p*y)*R,t.m15=(l*b-h*g+f*y)*R,t):null}},{key:"adjoint",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,s=e.m04,o=e.m05,c=e.m06,u=e.m07,l=e.m08,h=e.m09,f=e.m10,d=e.m11,_=e.m12,m=e.m13,p=e.m14,v=e.m15;return t.m00=o*(f*v-d*p)-h*(c*v-u*p)+m*(c*d-u*f),t.m01=-(i*(f*v-d*p)-h*(r*v-a*p)+m*(r*d-a*f)),t.m02=i*(c*v-u*p)-o*(r*v-a*p)+m*(r*u-a*c),t.m03=-(i*(c*d-u*f)-o*(r*d-a*f)+h*(r*u-a*c)),t.m04=-(s*(f*v-d*p)-l*(c*v-u*p)+_*(c*d-u*f)),t.m05=n*(f*v-d*p)-l*(r*v-a*p)+_*(r*d-a*f),t.m06=-(n*(c*v-u*p)-s*(r*v-a*p)+_*(r*u-a*c)),t.m07=n*(c*d-u*f)-s*(r*d-a*f)+l*(r*u-a*c),t.m08=s*(h*v-d*m)-l*(o*v-u*m)+_*(o*d-u*h),t.m09=-(n*(h*v-d*m)-l*(i*v-a*m)+_*(i*d-a*h)),t.m10=n*(o*v-u*m)-s*(i*v-a*m)+_*(i*u-a*o),t.m11=-(n*(o*d-u*h)-s*(i*d-a*h)+l*(i*u-a*o)),t.m12=-(s*(h*p-f*m)-l*(o*p-c*m)+_*(o*f-c*h)),t.m13=n*(h*p-f*m)-l*(i*p-r*m)+_*(i*f-r*h),t.m14=-(n*(o*p-c*m)-s*(i*p-r*m)+_*(i*c-r*o)),t.m15=n*(o*f-c*h)-s*(i*f-r*h)+l*(i*c-r*o),t}},{key:"determinant",value:function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,s=t.m05,o=t.m06,c=t.m07,u=t.m08,l=t.m09,h=t.m10,f=t.m11,d=t.m12,_=t.m13,m=t.m14,p=t.m15;return(e*s-n*a)*(h*p-f*m)-(e*o-i*a)*(l*p-f*_)+(e*c-r*a)*(l*m-h*_)+(n*o-i*s)*(u*p-f*d)-(n*c-r*s)*(u*m-h*d)+(i*c-r*o)*(u*_-l*d)}},{key:"multiply",value:function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,s=e.m03,o=e.m04,c=e.m05,u=e.m06,l=e.m07,h=e.m08,f=e.m09,d=e.m10,_=e.m11,m=e.m12,p=e.m13,v=e.m14,y=e.m15,g=n.m00,x=n.m01,b=n.m02,E=n.m03;return t.m00=g*i+x*o+b*h+E*m,t.m01=g*r+x*c+b*f+E*p,t.m02=g*a+x*u+b*d+E*v,t.m03=g*s+x*l+b*_+E*y,g=n.m04,x=n.m05,b=n.m06,E=n.m07,t.m04=g*i+x*o+b*h+E*m,t.m05=g*r+x*c+b*f+E*p,t.m06=g*a+x*u+b*d+E*v,t.m07=g*s+x*l+b*_+E*y,g=n.m08,x=n.m09,b=n.m10,E=n.m11,t.m08=g*i+x*o+b*h+E*m,t.m09=g*r+x*c+b*f+E*p,t.m10=g*a+x*u+b*d+E*v,t.m11=g*s+x*l+b*_+E*y,g=n.m12,x=n.m13,b=n.m14,E=n.m15,t.m12=g*i+x*o+b*h+E*m,t.m13=g*r+x*c+b*f+E*p,t.m14=g*a+x*u+b*d+E*v,t.m15=g*s+x*l+b*_+E*y,t}},{key:"mul",value:function(t,e,n){return p.multiply(t,e,n)}},{key:"translate",value:function(t,e,n){var i=n.x,r=n.y,a=n.z,s=void 0,o=void 0,c=void 0,u=void 0,l=void 0,h=void 0,f=void 0,d=void 0,_=void 0,m=void 0,p=void 0,v=void 0;return e===t?(t.m12=e.m00*i+e.m04*r+e.m08*a+e.m12,t.m13=e.m01*i+e.m05*r+e.m09*a+e.m13,t.m14=e.m02*i+e.m06*r+e.m10*a+e.m14,t.m15=e.m03*i+e.m07*r+e.m11*a+e.m15):(s=e.m00,o=e.m01,c=e.m02,u=e.m03,l=e.m04,h=e.m05,f=e.m06,d=e.m07,_=e.m08,m=e.m09,p=e.m10,v=e.m11,t.m00=s,t.m01=o,t.m02=c,t.m03=u,t.m04=l,t.m05=h,t.m06=f,t.m07=d,t.m08=_,t.m09=m,t.m10=p,t.m11=v,t.m12=s*i+l*r+_*a+e.m12,t.m13=o*i+h*r+m*a+e.m13,t.m14=c*i+f*r+p*a+e.m14,t.m15=u*i+d*r+v*a+e.m15),t}},{key:"scale",value:function(t,e,n){var i=n.x,r=n.y,a=n.z;return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*a,t.m09=e.m09*a,t.m10=e.m10*a,t.m11=e.m11*a,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t}},{key:"rotate",value:function(t,e,n,i){var r,a,s,o,c,u,l,h,f,d,_,m,p,v,y,g,x,b,E,C,w,S,T,M,A=i.x,O=i.y,R=i.z,D=Math.sqrt(A*A+O*O+R*R);return Math.abs(D)<I.EPSILON?null:(A*=D=1/D,O*=D,R*=D,r=Math.sin(n),s=1-(a=Math.cos(n)),o=e.m00,c=e.m01,u=e.m02,l=e.m03,h=e.m04,f=e.m05,d=e.m06,_=e.m07,m=e.m08,p=e.m09,v=e.m10,y=e.m11,g=A*A*s+a,x=O*A*s+R*r,b=R*A*s-O*r,E=A*O*s-R*r,C=O*O*s+a,w=R*O*s+A*r,S=A*R*s+O*r,T=O*R*s-A*r,M=R*R*s+a,t.m00=o*g+h*x+m*b,t.m01=c*g+f*x+p*b,t.m02=u*g+d*x+v*b,t.m03=l*g+_*x+y*b,t.m04=o*E+h*C+m*w,t.m05=c*E+f*C+p*w,t.m06=u*E+d*C+v*w,t.m07=l*E+_*C+y*w,t.m08=o*S+h*T+m*M,t.m09=c*S+f*T+p*M,t.m10=u*S+d*T+v*M,t.m11=l*S+_*T+y*M,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t)}},{key:"rotateX",value:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m04,s=e.m05,o=e.m06,c=e.m07,u=e.m08,l=e.m09,h=e.m10,f=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=a*r+u*i,t.m05=s*r+l*i,t.m06=o*r+h*i,t.m07=c*r+f*i,t.m08=u*r-a*i,t.m09=l*r-s*i,t.m10=h*r-o*i,t.m11=f*r-c*i,t}},{key:"rotateY",value:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,s=e.m01,o=e.m02,c=e.m03,u=e.m08,l=e.m09,h=e.m10,f=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r-u*i,t.m01=s*r-l*i,t.m02=o*r-h*i,t.m03=c*r-f*i,t.m08=a*i+u*r,t.m09=s*i+l*r,t.m10=o*i+h*r,t.m11=c*i+f*r,t}},{key:"rotateZ",value:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,s=e.m01,o=e.m02,c=e.m03,u=e.m04,l=e.m05,h=e.m06,f=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r+u*i,t.m01=s*r+l*i,t.m02=o*r+h*i,t.m03=c*r+f*i,t.m04=u*r-a*i,t.m05=l*r-s*i,t.m06=h*r-o*i,t.m07=f*r-c*i,t}},{key:"fromTranslation",value:function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t}},{key:"fromScaling",value:function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}},{key:"fromRotation",value:function(t,e,n){var i,r,a,s=n.x,o=n.y,c=n.z,u=Math.sqrt(s*s+o*o+c*c);return Math.abs(u)<I.EPSILON?null:(s*=u=1/u,o*=u,c*=u,i=Math.sin(e),a=1-(r=Math.cos(e)),t.m00=s*s*a+r,t.m01=o*s*a+c*i,t.m02=c*s*a-o*i,t.m03=0,t.m04=s*o*a-c*i,t.m05=o*o*a+r,t.m06=c*o*a+s*i,t.m07=0,t.m08=s*c*a+o*i,t.m09=o*c*a-s*i,t.m10=c*c*a+r,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t)}},{key:"fromXRotation",value:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=i,t.m06=n,t.m07=0,t.m08=0,t.m09=-n,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}},{key:"fromYRotation",value:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=0,t.m02=-n,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=n,t.m09=0,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}},{key:"fromZRotation",value:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=0,t.m04=-n,t.m05=i,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}},{key:"fromRT",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=e.w,o=i+i,c=r+r,u=a+a,l=i*o,h=i*c,f=i*u,d=r*c,_=r*u,m=a*u,p=s*o,v=s*c,y=s*u;return t.m00=1-(d+m),t.m01=h+y,t.m02=f-v,t.m03=0,t.m04=h-y,t.m05=1-(l+m),t.m06=_+p,t.m07=0,t.m08=f+v,t.m09=_-p,t.m10=1-(l+d),t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t}},{key:"getTranslation",value:function(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t}},{key:"getScaling",value:function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m04,s=e.m05,o=e.m06,c=e.m08,u=e.m09,l=e.m10;return t.x=Math.sqrt(n*n+i*i+r*r),t.y=Math.sqrt(a*a+s*s+o*o),t.z=Math.sqrt(c*c+u*u+l*l),t}},{key:"getRotation",value:function(t,e){var n=e.m00+e.m05+e.m10,i=0;return 0<n?(i=2*Math.sqrt(n+1),t.w=.25*i,t.x=(e.m06-e.m09)/i,t.y=(e.m08-e.m02)/i,t.z=(e.m01-e.m04)/i):e.m00>e.m05&e.m00>e.m10?(i=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/i,t.x=.25*i,t.y=(e.m01+e.m04)/i,t.z=(e.m08+e.m02)/i):e.m05>e.m10?(i=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/i,t.x=(e.m01+e.m04)/i,t.y=.25*i,t.z=(e.m06+e.m09)/i):(i=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/i,t.x=(e.m08+e.m02)/i,t.y=(e.m06+e.m09)/i,t.z=.25*i),t}},{key:"fromRTS",value:function(t,e,n,i){var r=e.x,a=e.y,s=e.z,o=e.w,c=r+r,u=a+a,l=s+s,h=r*c,f=r*u,d=r*l,_=a*u,m=a*l,p=s*l,v=o*c,y=o*u,g=o*l,x=i.x,b=i.y,E=i.z;return t.m00=(1-(_+p))*x,t.m01=(f+g)*x,t.m02=(d-y)*x,t.m03=0,t.m04=(f-g)*b,t.m05=(1-(h+p))*b,t.m06=(m+v)*b,t.m07=0,t.m08=(d+y)*E,t.m09=(m-v)*E,t.m10=(1-(h+_))*E,t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t}},{key:"fromRTSOrigin",value:function(t,e,n,i,r){var a=e.x,s=e.y,o=e.z,c=e.w,u=a+a,l=s+s,h=o+o,f=a*u,d=a*l,_=a*h,m=s*l,p=s*h,v=o*h,y=c*u,g=c*l,x=c*h,b=i.x,E=i.y,C=i.z,w=r.x,S=r.y,T=r.z;return t.m00=(1-(m+v))*b,t.m01=(d+x)*b,t.m02=(_-g)*b,t.m03=0,t.m04=(d-x)*E,t.m05=(1-(f+v))*E,t.m06=(p+y)*E,t.m07=0,t.m08=(_+g)*C,t.m09=(p-y)*C,t.m10=(1-(f+m))*C,t.m11=0,t.m12=n.x+w-(t.m00*w+t.m04*S+t.m08*T),t.m13=n.y+S-(t.m01*w+t.m05*S+t.m09*T),t.m14=n.z+T-(t.m02*w+t.m06*S+t.m10*T),t.m15=1,t}},{key:"fromQuat",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,s=n+n,o=i+i,c=r+r,u=n*s,l=i*s,h=i*o,f=r*s,d=r*o,_=r*c,m=a*s,p=a*o,v=a*c;return t.m00=1-h-_,t.m01=l+v,t.m02=f-p,t.m03=0,t.m04=l-v,t.m05=1-u-_,t.m06=d+m,t.m07=0,t.m08=f+p,t.m09=d-m,t.m10=1-u-h,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}},{key:"frustum",value:function(t,e,n,i,r,a,s){var o=1/(n-e),c=1/(r-i),u=1/(a-s);return t.m00=2*a*o,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*a*c,t.m06=0,t.m07=0,t.m08=(n+e)*o,t.m09=(r+i)*c,t.m10=(s+a)*u,t.m11=-1,t.m12=0,t.m13=0,t.m14=s*a*2*u,t.m15=0,t}},{key:"perspective",value:function(t,e,n,i,r){var a=1/Math.tan(e/2),s=1/(i-r);return t.m00=a/n,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=a,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r+i)*s,t.m11=-1,t.m12=0,t.m13=0,t.m14=2*r*i*s,t.m15=0,t}},{key:"perspectiveFromFieldOfView",value:function(t,e,n,i){var r=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(s+o),u=2/(r+a);return t.m00=c,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=u,t.m06=0,t.m07=0,t.m08=-(s-o)*c*.5,t.m09=(r-a)*u*.5,t.m10=i/(n-i),t.m11=-1,t.m12=0,t.m13=0,t.m14=i*n/(n-i),t.m15=0,t}},{key:"ortho",value:function(t,e,n,i,r,a,s){var o=1/(e-n),c=1/(i-r),u=1/(a-s);return t.m00=-2*o,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=-2*c,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=2*u,t.m11=0,t.m12=(e+n)*o,t.m13=(r+i)*c,t.m14=(s+a)*u,t.m15=1,t}},{key:"lookAt",value:function(t,e,n,i){var r,a,s,o=void 0,c=void 0,u=void 0,l=void 0,h=void 0,f=void 0,d=void 0,_=e.x,m=e.y,p=e.z,v=i.x,y=i.y,g=i.z;return l=_-n.x,h=m-n.y,f=p-n.z,o=y*(f*=d=1/Math.sqrt(l*l+h*h+f*f))-g*(h*=d),c=g*(l*=d)-v*f,u=v*h-y*l,r=h*(u*=d=1/Math.sqrt(o*o+c*c+u*u))-f*(c*=d),a=f*(o*=d)-l*u,s=l*c-h*o,t.m00=o,t.m01=r,t.m02=l,t.m03=0,t.m04=c,t.m05=a,t.m06=h,t.m07=0,t.m08=u,t.m09=s,t.m10=f,t.m11=0,t.m12=-(o*_+c*m+u*p),t.m13=-(r*_+a*m+s*p),t.m14=-(l*_+h*m+f*p),t.m15=1,t}},{key:"str",value:function(t){return"mat4("+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+", "+t.m04+", "+t.m05+", "+t.m06+", "+t.m07+", "+t.m08+", "+t.m09+", "+t.m10+", "+t.m11+", "+t.m12+", "+t.m13+", "+t.m14+", "+t.m15+")"}},{key:"array",value:function(t,e){return t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m03,t[4]=e.m04,t[5]=e.m05,t[6]=e.m06,t[7]=e.m07,t[8]=e.m08,t[9]=e.m09,t[10]=e.m10,t[11]=e.m11,t[12]=e.m12,t[13]=e.m13,t[14]=e.m14,t[15]=e.m15,t}},{key:"frob",value:function(t){return Math.sqrt(Math.pow(t.m00,2)+Math.pow(t.m01,2)+Math.pow(t.m02,2)+Math.pow(t.m03,2)+Math.pow(t.m04,2)+Math.pow(t.m05,2)+Math.pow(t.m06,2)+Math.pow(t.m07,2)+Math.pow(t.m08,2)+Math.pow(t.m09,2)+Math.pow(t.m10,2)+Math.pow(t.m11,2)+Math.pow(t.m12,2)+Math.pow(t.m13,2)+Math.pow(t.m14,2)+Math.pow(t.m15,2))}},{key:"add",value:function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t.m09=e.m09+n.m09,t.m10=e.m10+n.m10,t.m11=e.m11+n.m11,t.m12=e.m12+n.m12,t.m13=e.m13+n.m13,t.m14=e.m14+n.m14,t.m15=e.m15+n.m15,t}},{key:"subtract",value:function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t.m09=e.m09-n.m09,t.m10=e.m10-n.m10,t.m11=e.m11-n.m11,t.m12=e.m12-n.m12,t.m13=e.m13-n.m13,t.m14=e.m14-n.m14,t.m15=e.m15-n.m15,t}},{key:"sub",value:function(t,e,n){return p.subtract(t,e,n)}},{key:"multiplyScalar",value:function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t.m09=e.m09*n,t.m10=e.m10*n,t.m11=e.m11*n,t.m12=e.m12*n,t.m13=e.m13*n,t.m14=e.m14*n,t.m15=e.m15*n,t}},{key:"multiplyScalarAndAdd",value:function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t.m04=e.m04+n.m04*i,t.m05=e.m05+n.m05*i,t.m06=e.m06+n.m06*i,t.m07=e.m07+n.m07*i,t.m08=e.m08+n.m08*i,t.m09=e.m09+n.m09*i,t.m10=e.m10+n.m10*i,t.m11=e.m11+n.m11*i,t.m12=e.m12+n.m12*i,t.m13=e.m13+n.m13*i,t.m14=e.m14+n.m14*i,t.m15=e.m15+n.m15*i,t}},{key:"exactEquals",value:function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15}},{key:"equals",value:function(t,e){var n=t.m00,i=t.m01,r=t.m02,a=t.m03,s=t.m04,o=t.m05,c=t.m06,u=t.m07,l=t.m08,h=t.m09,f=t.m10,d=t.m11,_=t.m12,m=t.m13,p=t.m14,v=t.m15,y=e.m00,g=e.m01,x=e.m02,b=e.m03,E=e.m04,C=e.m05,w=e.m06,S=e.m07,T=e.m08,M=e.m09,A=e.m10,O=e.m11,R=e.m12,D=e.m13,N=e.m14,L=e.m15;return Math.abs(n-y)<=I.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-g)<=I.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(r-x)<=I.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-b)<=I.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-E)<=I.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-C)<=I.EPSILON*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(c-w)<=I.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-S)<=I.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-T)<=I.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-M)<=I.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-A)<=I.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-O)<=I.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(_-R)<=I.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(m-D)<=I.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(p-N)<=I.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(v-L)<=I.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))}}]),p}();n.default=r},{"./utils":190}],189:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),o=s(t("./vec3")),r=s(t("./vec4")),a=s(t("./mat3")),d=t("./utils");function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var l=.5*Math.PI/180,c=function(){function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;u(this,c),this.x=t,this.y=e,this.z=n,this.w=i}return i(c,null,[{key:"create",value:function(t,e,n,i){return new c(0<arguments.length&&void 0!==t?t:0,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:1)}},{key:"clone",value:function(t){return new c(t.x,t.y,t.z,t.w)}},{key:"copy",value:function(t,e){return r.default.copy(t,e)}},{key:"set",value:function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t}},{key:"identity",value:function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t}},{key:"rotationTo",value:function(t,e,n){return function(){var r=o.default.create(0,0,0),a=o.default.create(1,0,0),s=o.default.create(0,1,0);return function(t,e,n){var i=o.default.dot(e,n);return i<-.999999?(o.default.cross(r,a,e),o.default.magnitude(r)<1e-6&&o.default.cross(r,s,e),o.default.normalize(r,r),c.fromAxisAngle(t,r,Math.PI),t):.999999<i?(t.x=0,t.y=0,t.z=0,t.w=1,t):(o.default.cross(r,e,n),t.x=r.x,t.y=r.y,t.z=r.z,t.w=1+i,c.normalize(t,t))}}()(t,e,n)}},{key:"getAxisAngle",value:function(t,e){var n=2*Math.acos(e.w),i=Math.sin(n/2);return 0!=i?(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i):(t.x=1,t.y=0,t.z=0),n}},{key:"multiply",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=e.w,o=n.x,c=n.y,u=n.z,l=n.w;return t.x=i*l+s*o+r*u-a*c,t.y=r*l+s*c+a*o-i*u,t.z=a*l+s*u+i*c-r*o,t.w=s*l-i*o-r*c-a*u,t}},{key:"mul",value:function(t,e,n){return c.multiply(t,e,n)}},{key:"scale",value:function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t}},{key:"rotateX",value:function(t,e,n){n*=.5;var i=e.x,r=e.y,a=e.z,s=e.w,o=Math.sin(n),c=Math.cos(n);return t.x=i*c+s*o,t.y=r*c+a*o,t.z=a*c-r*o,t.w=s*c-i*o,t}},{key:"rotateY",value:function(t,e,n){n*=.5;var i=e.x,r=e.y,a=e.z,s=e.w,o=Math.sin(n),c=Math.cos(n);return t.x=i*c-a*o,t.y=r*c+s*o,t.z=a*c+i*o,t.w=s*c-r*o,t}},{key:"rotateZ",value:function(t,e,n){n*=.5;var i=e.x,r=e.y,a=e.z,s=e.w,o=Math.sin(n),c=Math.cos(n);return t.x=i*c+r*o,t.y=r*c-i*o,t.z=a*c+s*o,t.w=s*c-a*o,t}},{key:"rotateAround",value:function(t,e,n,i){return function(){var r=o.default.create(0,0,0),a=c.create();return function(t,e,n,i){return c.invert(a,e),o.default.transformQuat(r,n,a),c.fromAxisAngle(a,r,i),c.mul(t,e,a),t}}()(t,e,n,i)}},{key:"rotateAroundLocal",value:function(t,e,n,i){return function(){var r=c.create();return function(t,e,n,i){return c.fromAxisAngle(r,n,i),c.mul(t,e,r),t}}()(t,e,n,i)}},{key:"calculateW",value:function(t,e){var n=e.x,i=e.y,r=e.z;return t.x=n,t.y=i,t.z=r,t.w=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}},{key:"lerp",value:function(t,e,n,i){var r=e.x,a=e.y,s=e.z,o=e.w;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t.z=s+i*(n.z-s),t.w=o+i*(n.w-o),t}},{key:"slerp",value:function(t,e,n,i){var r,a=e.x,s=e.y,o=e.z,c=e.w,u=n.x,l=n.y,h=n.z,f=n.w,d=void 0,_=void 0,m=void 0,p=void 0;return(_=a*u+s*l+o*h+c*f)<0&&(_=-_,u=-u,l=-l,h=-h,f=-f),r=1e-6<1-_?(d=Math.acos(_),m=Math.sin(d),p=Math.sin((1-i)*d)/m,Math.sin(i*d)/m):(p=1-i,i),t.x=p*a+r*u,t.y=p*s+r*l,t.z=p*o+r*h,t.w=p*c+r*f,t}},{key:"sqlerp",value:function(t,e,n,i,r,a){return function(){var s=c.create(),o=c.create();return function(t,e,n,i,r,a){return c.slerp(s,e,r,a),c.slerp(o,n,i,a),c.slerp(t,s,o,2*a*(1-a)),t}}()(t,e,n,i,r,a)}},{key:"invert",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,s=n*n+i*i+r*r+a*a,o=s?1/s:0;return t.x=-n*o,t.y=-i*o,t.z=-r*o,t.w=a*o,t}},{key:"conjugate",value:function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t}},{key:"magnitude",value:function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return Math.sqrt(e*e+n*n+i*i+r*r)}},{key:"mag",value:function(t){return c.magnitude(t)}},{key:"squaredMagnitude",value:function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return e*e+n*n+i*i+r*r}},{key:"sqrMag",value:function(t){return c.squaredMagnitude(t)}},{key:"normalize",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,s=n*n+i*i+r*r+a*a;return 0<s&&(s=1/Math.sqrt(s),t.x=n*s,t.y=i*s,t.z=r*s,t.w=a*s),t}},{key:"fromAxes",value:function(t,e,n,i){return function(){var r=a.default.create();return function(t,e,n,i){return a.default.set(r,e.x,e.y,e.z,n.x,n.y,n.z,i.x,i.y,i.z),c.normalize(t,c.fromMat3(t,r))}}()(t,e,n,i)}},{key:"fromViewUp",value:function(t,e,n){return function(){var i=a.default.create();return function(t,e,n){return a.default.fromViewUp(i,e,n),i?c.normalize(t,c.fromMat3(t,i)):null}}()(t,e,n)}},{key:"fromAxisAngle",value:function(t,e,n){n*=.5;var i=Math.sin(n);return t.x=i*e.x,t.y=i*e.y,t.z=i*e.z,t.w=Math.cos(n),t}},{key:"fromMat3",value:function(t,e){var n=e.m00,i=e.m03,r=e.m06,a=e.m01,s=e.m04,o=e.m07,c=e.m02,u=e.m05,l=e.m08,h=n+s+l;if(0<h){var f=.5/Math.sqrt(h+1);t.w=.25/f,t.x=(u-o)*f,t.y=(r-c)*f,t.z=(a-i)*f}else if(s<n&&l<n){var d=2*Math.sqrt(1+n-s-l);t.w=(u-o)/d,t.x=.25*d,t.y=(i+a)/d,t.z=(r+c)/d}else if(l<s){var _=2*Math.sqrt(1+s-n-l);t.w=(r-c)/_,t.x=(i+a)/_,t.y=.25*_,t.z=(o+u)/_}else{var m=2*Math.sqrt(1+l-n-s);t.w=(a-i)/m,t.x=(r+c)/m,t.y=(o+u)/m,t.z=.25*m}return t}},{key:"fromEuler",value:function(t,e,n,i){e*=l,n*=l,i*=l;var r=Math.sin(e),a=Math.cos(e),s=Math.sin(n),o=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return t.x=r*o*u+a*s*c,t.y=a*s*u+r*o*c,t.z=a*o*c-r*s*u,t.w=a*o*u-r*s*c,t}},{key:"toEuler",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,s=void 0,o=void 0,c=void 0,u=n*i+r*a;if(.499<u&&(s=2*Math.atan2(n,a),o=Math.PI/2,c=0),u<-.499&&(s=-2*Math.atan2(n,a),o=-Math.PI/2,c=0),isNaN(s)){var l=n*n,h=i*i,f=r*r;s=Math.atan2(2*i*a-2*n*r,1-2*h-2*f),o=Math.asin(2*u),c=Math.atan2(2*n*a-2*i*r,1-2*l-2*f)}return t.y=(0,d.toDegree)(s),t.z=(0,d.toDegree)(o),t.x=(0,d.toDegree)(c),t}},{key:"str",value:function(t){return"quat("+t.x+", "+t.y+", "+t.z+", "+t.w+")"}},{key:"array",value:function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w,t}},{key:"exactEquals",value:function(t,e){return r.default.exactEquals(t,e)}},{key:"equals",value:function(t,e){return r.default.equals(t,e)}}]),c}();n.default=c},{"./mat3":187,"./utils":190,"./vec3":192,"./vec4":193}],190:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.equals=function(t,e){return Math.abs(t-e)<=a*Math.max(1,Math.abs(t),Math.abs(e))},n.approx=function(t,e,n){return n=n||a,Math.abs(t-e)<=n},n.clamp=function(t,e,n){return t<e?e:n<t?n:t},n.clamp01=function(t){return t<0?0:1<t?1:t},n.lerp=function(t,e,n){return t+(e-t)*n},n.toRadian=function(t){return t*i},n.toDegree=function(t){return t*r},n.randomRange=s,n.randomRangeInt=function(t,e){return Math.floor(s(t,e))},n.pseudoRandom=o,n.pseudoRandomRange=c,n.pseudoRandomRangeInt=function(t,e,n){return Math.floor(c(t,e,n))},n.nextPow2=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},n.repeat=u,n.pingPong=function(t,e){return t=u(t,2*e),e-Math.abs(t-e)},n.inverseLerp=function(t,e,n){return(n-t)/(e-t)};var i=Math.PI/180,r=180/Math.PI,a=n.EPSILON=1e-6;function s(t,e){return Math.random()*(e-t)+t}function o(t){return(t=(9301*t+49297)%233280)/233280}function c(t,e,n){return o(t)*(n-e)+e}function u(t,e){return t-Math.floor(t/e)*e}n.random=Math.random},{}],191:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),o=t("./utils");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;r(this,s),this.x=t,this.y=e}return i(s,null,[{key:"create",value:function(t,e){return new s(0<arguments.length&&void 0!==t?t:0,1<arguments.length&&void 0!==e?e:0)}},{key:"zero",value:function(t){return t.x=0,t.y=0,t}},{key:"clone",value:function(t){return new s(t.x,t.y)}},{key:"copy",value:function(t,e){return t.x=e.x,t.y=e.y,t}},{key:"set",value:function(t,e,n){return t.x=e,t.y=n,t}},{key:"add",value:function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t}},{key:"subtract",value:function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t}},{key:"sub",value:function(t,e,n){return s.subtract(t,e,n)}},{key:"multiply",value:function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t}},{key:"mul",value:function(t,e,n){return s.multiply(t,e,n)}},{key:"divide",value:function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t}},{key:"div",value:function(t,e,n){return s.divide(t,e,n)}},{key:"ceil",value:function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t}},{key:"floor",value:function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t}},{key:"min",value:function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t}},{key:"max",value:function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t}},{key:"round",value:function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t}},{key:"scale",value:function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t}},{key:"scaleAndAdd",value:function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t}},{key:"distance",value:function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}},{key:"dist",value:function(t,e){return s.distance(t,e)}},{key:"squaredDistance",value:function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}},{key:"sqrDist",value:function(t,e){return s.squaredDistance(t,e)}},{key:"magnitude",value:function(t){var e=t.x,n=t.y;return Math.sqrt(e*e+n*n)}},{key:"mag",value:function(t){return s.magnitude(t)}},{key:"squaredMagnitude",value:function(t){var e=t.x,n=t.y;return e*e+n*n}},{key:"sqrMag",value:function(t){return s.squaredMagnitude(t)}},{key:"negate",value:function(t,e){return t.x=-e.x,t.y=-e.y,t}},{key:"inverse",value:function(t,e){return t.x=1/e.x,t.y=1/e.y,t}},{key:"inverseSafe",value:function(t,e){var n=e.x,i=e.y;return Math.abs(n)<o.EPSILON?t.x=0:t.x=1/n,Math.abs(i)<o.EPSILON?t.y=0:t.y=1/e.y,t}},{key:"normalize",value:function(t,e){var n=e.x,i=e.y,r=n*n+i*i;return 0<r&&(r=1/Math.sqrt(r),t.x=e.x*r,t.y=e.y*r),t}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"cross",value:function(t,e,n){var i=e.x*n.y-e.y*n.x;return t.x=t.y=0,t.z=i,t}},{key:"lerp",value:function(t,e,n,i){var r=e.x,a=e.y;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t}},{key:"random",value:function(t,e){e=e||1;var n=2*(0,o.random)()*Math.PI;return t.x=Math.cos(n)*e,t.y=Math.sin(n)*e,t}},{key:"transformMat2",value:function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m02*r,t.y=n.m01*i+n.m03*r,t}},{key:"transformMat23",value:function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m02*r+n.m04,t.y=n.m01*i+n.m03*r+n.m05,t}},{key:"transformMat3",value:function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m03*r+n.m06,t.y=n.m01*i+n.m04*r+n.m07,t}},{key:"transformMat4",value:function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m04*r+n.m12,t.y=n.m01*i+n.m05*r+n.m13,t}},{key:"forEach",value:function(t,e,n,i,r,a){return s._forEach(t,e,n,i,r,a)}},{key:"str",value:function(t){return"vec2("+t.x+", "+t.y+")"}},{key:"array",value:function(t,e){return t[0]=e.x,t[1]=e.y,t}},{key:"exactEquals",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"equals",value:function(t,e){var n=t.x,i=t.y,r=e.x,a=e.y;return Math.abs(n-r)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-a)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))}},{key:"angle",value:function(t,e){return s._angle(t,e)}}]),s}();a._forEach=function(){var c=a.create(0,0);return function(t,e,n,i,r,a){var s,o=void 0;for(e=e||2,n=n||0,s=i?Math.min(i*e+n,t.length):t.length,o=n;o<s;o+=e)c.x=t[o],c.y=t[o+1],r(c,c,a),t[o]=c.x,t[o+1]=c.y;return t}}(),a._angle=function(){var i=a.create(0,0),r=a.create(0,0);return function(t,e){a.normalize(i,t),a.normalize(r,e);var n=a.dot(i,r);return 1<n?0:n<-1?Math.PI:Math.acos(n)}}(),n.default=a},{"./utils":190}],192:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),c=t("./utils");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;r(this,s),this.x=t,this.y=e,this.z=n}return i(s,null,[{key:"create",value:function(t,e,n){return new s(0<arguments.length&&void 0!==t?t:0,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0)}},{key:"zero",value:function(t){return t.x=0,t.y=0,t.z=0,t}},{key:"clone",value:function(t){return new s(t.x,t.y,t.z)}},{key:"copy",value:function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t}},{key:"set",value:function(t,e,n,i){return t.x=e,t.y=n,t.z=i,t}},{key:"add",value:function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t}},{key:"subtract",value:function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t}},{key:"sub",value:function(t,e,n){return s.subtract(t,e,n)}},{key:"multiply",value:function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t}},{key:"mul",value:function(t,e,n){return s.multiply(t,e,n)}},{key:"divide",value:function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t}},{key:"div",value:function(t,e,n){return s.divide(t,e,n)}},{key:"ceil",value:function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t}},{key:"floor",value:function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t}},{key:"min",value:function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t}},{key:"max",value:function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t}},{key:"round",value:function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t}},{key:"scale",value:function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}},{key:"scaleAndAdd",value:function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t}},{key:"distance",value:function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return Math.sqrt(n*n+i*i+r*r)}},{key:"dist",value:function(t,e){return s.distance(t,e)}},{key:"squaredDistance",value:function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return n*n+i*i+r*r}},{key:"sqrDist",value:function(t,e){return s.squaredDistance(t,e)}},{key:"magnitude",value:function(t){var e=t.x,n=t.y,i=t.z;return Math.sqrt(e*e+n*n+i*i)}},{key:"mag",value:function(t){return s.magnitude(t)}},{key:"squaredMagnitude",value:function(t){var e=t.x,n=t.y,i=t.z;return e*e+n*n+i*i}},{key:"sqrMag",value:function(t){return s.squaredMagnitude(t)}},{key:"negate",value:function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}},{key:"inverse",value:function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t}},{key:"inverseSafe",value:function(t,e){var n=e.x,i=e.y,r=e.z;return Math.abs(n)<c.EPSILON?t.x=0:t.x=1/n,Math.abs(i)<c.EPSILON?t.y=0:t.y=1/i,Math.abs(r)<c.EPSILON?t.z=0:t.z=1/r,t}},{key:"normalize",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=n*n+i*i+r*r;return 0<a&&(a=1/Math.sqrt(a),t.x=n*a,t.y=i*a,t.z=r*a),t}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"cross",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=n.x,o=n.y,c=n.z;return t.x=r*c-a*o,t.y=a*s-i*c,t.z=i*o-r*s,t}},{key:"lerp",value:function(t,e,n,i){var r=e.x,a=e.y,s=e.z;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t.z=s+i*(n.z-s),t}},{key:"hermite",value:function(t,e,n,i,r,a){var s=a*a,o=s*(2*a-3)+1,c=s*(a-2)+a,u=s*(a-1),l=s*(3-2*a);return t.x=e.x*o+n.x*c+i.x*u+r.x*l,t.y=e.y*o+n.y*c+i.y*u+r.y*l,t.z=e.z*o+n.z*c+i.z*u+r.z*l,t}},{key:"bezier",value:function(t,e,n,i,r,a){var s=1-a,o=s*s,c=a*a,u=o*s,l=3*a*o,h=3*c*s,f=c*a;return t.x=e.x*u+n.x*l+i.x*h+r.x*f,t.y=e.y*u+n.y*l+i.y*h+r.y*f,t.z=e.z*u+n.z*l+i.z*h+r.z*f,t}},{key:"random",value:function(t,e){e=e||1;var n=2*(0,c.random)()*Math.PI,i=Math.acos(2*(0,c.random)()-1);return t.x=Math.sin(i)*Math.cos(n)*e,t.y=Math.sin(i)*Math.sin(n)*e,t.z=Math.cos(i)*e,t}},{key:"transformMat4",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=n.m03*i+n.m07*r+n.m11*a+n.m15;return s=s?1/s:1,t.x=(n.m00*i+n.m04*r+n.m08*a+n.m12)*s,t.y=(n.m01*i+n.m05*r+n.m09*a+n.m13)*s,t.z=(n.m02*i+n.m06*r+n.m10*a+n.m14)*s,t}},{key:"transformMat4Normal",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=n.m03*i+n.m07*r+n.m11*a;return s=s?1/s:1,t.x=(n.m00*i+n.m04*r+n.m08*a)*s,t.y=(n.m01*i+n.m05*r+n.m09*a)*s,t.z=(n.m02*i+n.m06*r+n.m10*a)*s,t}},{key:"transformMat3",value:function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=i*n.m00+r*n.m03+a*n.m06,t.y=i*n.m01+r*n.m04+a*n.m07,t.z=i*n.m02+r*n.m05+a*n.m08,t}},{key:"transformQuat",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=n.x,o=n.y,c=n.z,u=n.w,l=u*i+o*a-c*r,h=u*r+c*i-s*a,f=u*a+s*r-o*i,d=-s*i-o*r-c*a;return t.x=l*u+d*-s+h*-c-f*-o,t.y=h*u+d*-o+f*-s-l*-c,t.z=f*u+d*-c+l*-o-h*-s,t}},{key:"rotateX",value:function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,s=e.z-n.z,o=r,c=a*Math.cos(i)-s*Math.sin(i),u=a*Math.sin(i)+s*Math.cos(i);return t.x=o+n.x,t.y=c+n.y,t.z=u+n.z,t}},{key:"rotateY",value:function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,s=e.z-n.z,o=s*Math.sin(i)+r*Math.cos(i),c=a,u=s*Math.cos(i)-r*Math.sin(i);return t.x=o+n.x,t.y=c+n.y,t.z=u+n.z,t}},{key:"rotateZ",value:function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,s=e.z-n.z,o=r*Math.cos(i)-a*Math.sin(i),c=r*Math.sin(i)+a*Math.cos(i),u=s;return t.x=o+n.x,t.y=c+n.y,t.z=u+n.z,t}},{key:"str",value:function(t){return"vec3("+t.x+", "+t.y+", "+t.z+")"}},{key:"array",value:function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t}},{key:"exactEquals",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}},{key:"equals",value:function(t,e){var n=t.x,i=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return Math.abs(n-a)<=c.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=c.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=c.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))}},{key:"forEach",value:function(t,e,n,i,r,a){return s._forEach(t,e,n,i,r,a)}},{key:"angle",value:function(t,e){return s._angle(t,e)}},{key:"projectOnPlane",value:function(t,e,n){return s.sub(t,e,s.project(t,e,n))}},{key:"project",value:function(t,e,n){var i=s.squaredMagnitude(n);return i<1e-6?s.set(t,0,0,0):s.scale(t,n,s.dot(e,n)/i)}}]),s}();a._forEach=function(){var c=a.create(0,0,0);return function(t,e,n,i,r,a){var s,o=void 0;for(e=e||3,n=n||0,s=i?Math.min(i*e+n,t.length):t.length,o=n;o<s;o+=e)c.x=t[o],c.y=t[o+1],c.z=t[o+2],r(c,c,a),t[o]=c.x,t[o+1]=c.y,t[o+2]=c.z;return t}}(),a._angle=function(){var i=a.create(0,0,0),r=a.create(0,0,0);return function(t,e){a.copy(i,t),a.copy(r,e),a.normalize(i,i),a.normalize(r,r);var n=a.dot(i,r);return 1<n?0:n<-1?Math.PI:Math.acos(n)}}(),n.default=a},{"./utils":190}],193:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),l=t("./utils");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;r(this,s),this.x=t,this.y=e,this.z=n,this.w=i}return i(s,null,[{key:"create",value:function(t,e,n,i){return new s(0<arguments.length&&void 0!==t?t:0,1<arguments.length&&void 0!==e?e:0,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:1)}},{key:"zero",value:function(t){return t.x=0,t.y=0,t.z=0,t.w=0,t}},{key:"clone",value:function(t){return new s(t.x,t.y,t.z,t.w)}},{key:"copy",value:function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}},{key:"set",value:function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t}},{key:"add",value:function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t.w=e.w+n.w,t}},{key:"subtract",value:function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t.w=e.w-n.w,t}},{key:"sub",value:function(t,e,n){return s.subtract(t,e,n)}},{key:"multiply",value:function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t.w=e.w*n.w,t}},{key:"mul",value:function(t,e,n){return s.multiply(t,e,n)}},{key:"divide",value:function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t.w=e.w/n.w,t}},{key:"div",value:function(t,e,n){return s.divide(t,e,n)}},{key:"ceil",value:function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t}},{key:"floor",value:function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t}},{key:"min",value:function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t.w=Math.min(e.w,n.w),t}},{key:"max",value:function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t.w=Math.max(e.w,n.w),t}},{key:"round",value:function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t}},{key:"scale",value:function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t}},{key:"scaleAndAdd",value:function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t}},{key:"distance",value:function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return Math.sqrt(n*n+i*i+r*r+a*a)}},{key:"dist",value:function(t,e){return s.distance(t,e)}},{key:"squaredDistance",value:function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return n*n+i*i+r*r+a*a}},{key:"sqrDist",value:function(t,e){return s.squaredDistance(t,e)}},{key:"magnitude",value:function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return Math.sqrt(e*e+n*n+i*i+r*r)}},{key:"mag",value:function(t){return s.magnitude(t)}},{key:"squaredMagnitude",value:function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return e*e+n*n+i*i+r*r}},{key:"sqrMag",value:function(t){return s.squaredMagnitude(t)}},{key:"negate",value:function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t}},{key:"inverse",value:function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t}},{key:"inverseSafe",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w;return Math.abs(n)<l.EPSILON?t.x=0:t.x=1/n,Math.abs(i)<l.EPSILON?t.y=0:t.y=1/i,Math.abs(r)<l.EPSILON?t.z=0:t.z=1/r,Math.abs(a)<l.EPSILON?t.w=0:t.w=1/a,t}},{key:"normalize",value:function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,s=n*n+i*i+r*r+a*a;return 0<s&&(s=1/Math.sqrt(s),t.x=n*s,t.y=i*s,t.z=r*s,t.w=a*s),t}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}},{key:"lerp",value:function(t,e,n,i){var r=e.x,a=e.y,s=e.z,o=e.w;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t.z=s+i*(n.z-s),t.w=o+i*(n.w-o),t}},{key:"random",value:function(t,e){e=e||1;var n=2*(0,l.random)()*Math.PI,i=Math.acos(2*(0,l.random)()-1);return t.x=Math.sin(i)*Math.cos(n)*e,t.y=Math.sin(i)*Math.sin(n)*e,t.z=Math.cos(i)*e,t.w=0,t}},{key:"transformMat4",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=e.w;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12*s,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13*s,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14*s,t.w=n.m03*i+n.m07*r+n.m11*a+n.m15*s,t}},{key:"transformQuat",value:function(t,e,n){var i=e.x,r=e.y,a=e.z,s=n.x,o=n.y,c=n.z,u=n.w,l=u*i+o*a-c*r,h=u*r+c*i-s*a,f=u*a+s*r-o*i,d=-s*i-o*r-c*a;return t.x=l*u+d*-s+h*-c-f*-o,t.y=h*u+d*-o+f*-s-l*-c,t.z=f*u+d*-c+l*-o-h*-s,t.w=e.w,t}},{key:"str",value:function(t){return"vec4("+t.x+", "+t.y+", "+t.z+", "+t.w+")"}},{key:"array",value:function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w,t}},{key:"exactEquals",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}},{key:"equals",value:function(t,e){var n=t.x,i=t.y,r=t.z,a=t.w,s=e.x,o=e.y,c=e.z,u=e.w;return Math.abs(n-s)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-c)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-u)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))}},{key:"forEach",value:function(t,e,n,i,r,a){return s._forEach(t,e,n,i,r,a)}}]),s}();a._forEach=function(){var c=a.create(0,0,0,0);return function(t,e,n,i,r,a){var s,o=void 0;for(e=e||4,n=n||0,s=i?Math.min(i*e+n,t.length):t.length,o=n;o<s;o+=e)c.x=t[o],c.y=t[o+1],c.z=t[o+2],c.w=t[o+3],r(c,c,a),t[o]=c.x,t[o+1]=c.y,t[o+2]=c.z,t[o+3]=c.w;return t}}(),n.default=a},{"./utils":190}],194:[function(t,e,n){"use strict";t("./core/CCGame")},{"./core/CCGame":12}],195:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RenderQueue={OPAQUE:0,TRANSPARENT:1,OVERLAY:2},n.PassStage={DEFAULT:1,FORWARD:2,SHADOWCAST:4}},{}],196:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function i(t,e){a(this,i),this._cursor=0,this._data=new Array(e);for(var n=0;n<e;++n)this._data[n]=t()}return r(i,[{key:"request",value:function(){var t=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,t}}]),i}();n.default=i},{}],197:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./circular-pool");Object.defineProperty(n,"CircularPool",{enumerable:!0,get:function(){return s(i).default}});var r=t("./recycle-pool");Object.defineProperty(n,"RecyclePool",{enumerable:!0,get:function(){return s(r).default}});var a=t("./typed-array-pool");function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"TypedArrayPool",{enumerable:!0,get:function(){return s(a).default}})},{"./circular-pool":196,"./recycle-pool":199,"./typed-array-pool":202}],198:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.OptimizedArray=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;a(this,e),this._size=t,this._data=new Array(t)}return r(e,[{key:"push",value:function(t){this._size>this._data.length&&this._extends(this._data.length),this._data[this._size]=t,++this._size}},{key:"pop",value:function(){if(0!=this._size){--this._size;var t=this._data[this._size];return this._data[this._size]=void 0,t}}},{key:"clear",value:function(){for(var t=0;t<this._data.length;++t)this._data[t]=void 0;this._size=0}},{key:"_extends",value:function(t){for(var e=this._data.length+t,n=this._data.length;n<e;++n)this._data[n]=void 0}},{key:"size",get:function(){return this._size}},{key:"data",get:function(){return this._data}},{key:"capacity",get:function(){return this._data.length}}]),e}(),n.OptimizedValueArray=function(){function i(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;a(this,i),this._size=n,this._data=new Array,this._ctor=t,this._dtor=e,this._extends(n)}return r(i,[{key:"push",value:function(){this._size>=this._data.length&&this._extends(this._data.length+1);var t=this._data[this._size];return++this._size,t}},{key:"pop",value:function(){0!=this._size&&(--this._size,this._dtor(this._data[this._size]))}},{key:"clear",value:function(){for(var t=this._size=0;t<this._data.length;++t)this._dtor(this._data[t])}},{key:"splice",value:function(t,e){if(0!=e&&!(t>=this.size)){e=Math.min(this.size-t,e);var n=this._size;this._size-=e;for(var i=0,r=t+e,a=n-r;i<a;++i){var s=this._data[t+i];this._data[t+i]=this._data[r+i],this._data[r+i]=s}for(var o=this._size;o!=n;++o)this._dtor(this._data[o])}}},{key:"forEach",value:function(t){for(var e=0;e<this.size;++e)t(this.data[e],e,this)}},{key:"map",value:function(t){for(var e=new Array,n=0;n<this.size;++n)e.push(t(this.data[n],n,this));return e}},{key:"_extends",value:function(t){for(var e=this._data.length+t,n=this._data.length;n<e;++n)this._data[n]=this._ctor()}},{key:"size",get:function(){return this._size}},{key:"data",get:function(){return this._data}},{key:"capacity",get:function(){return this._data.length}}]),i}()},{}],199:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),a=function(t){return t&&t.__esModule?t:{default:t}}(t("./timsort"));function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function i(t,e){s(this,i),this._fn=t,this._count=0,this._data=new Array(e);for(var n=0;n<e;++n)this._data[n]=t()}return r(i,[{key:"reset",value:function(){this._count=0}},{key:"resize",value:function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()}},{key:"add",value:function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]}},{key:"remove",value:function(t){if(!(t>=this._count)){var e=this._count-1,n=this._data[t];this._data[t]=this._data[e],this._data[e]=n,this._count-=1}}},{key:"sort",value:function(t){return(0,a.default)(this._data,0,this._count,t)}},{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),i}();n.default=i},{"./timsort":201}],200:[function(t,e,n){"use strict";function r(t,e){return t-e}function a(t,e,n,y){function g(t,e,n){for(var i=e+1;i<n;i++){var r=t[i],a=void 0;for(a=i-1;e<=a;a--){var s=t[a];if(!(0<y(s,r)))break;t[a+1]=s}t[a+1]=r}}return n-e<2||function t(e,n,i){for(var r=0;;){if(i-n<=10)return void g(e,n,i);r=n+(i-n>>1);var a=e[n],s=e[i-1],o=e[r];if(0<y(a,s)){var c=a;a=s,s=c}if(0<=y(a,o)){var u=a;a=o,o=s,s=u}else if(0<y(s,o)){var l=s;s=o,o=l}e[n]=a,e[i-1]=o;var h=s,f=n+1,d=i-1;e[r]=e[f],e[f]=h;t:for(var _=f+1;_<d;_++){var m=e[_],p=y(m,h);if(p<0)e[_]=e[f],e[f]=m,f++;else if(0<p){do{if(--d==_)break t;var v=e[d];p=y(v,h)}while(0<p);e[_]=e[d],e[d]=m,p<0&&(m=e[_],e[_]=e[f],e[f]=m,f++)}}i-d<f-n?(t(e,d,i),i=f):(t(e,n,f),n=d)}}(t,e,n),t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,e,n,i){return void 0===e&&(e=0),void 0===n&&(n=t.length),void 0===i&&(i=r),a(t,e,n,i)}},{}],201:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.default=function(t,e,n,i){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");void 0===e&&(e=0),void 0===n&&(n=t.length),void 0===i&&(i=l);var r=n-e;if(!(r<2)){var a=0;if(r<u)d(t,e,n,e+(a=f(t,e,n,i)),i);else{var s=new _(t,i),o=h(r);do{if((a=f(t,e,n,i))<o){var c=r;o<c&&(c=o),d(t,e,e+c,e+a,i),a=c}s.pushRun(e,a),s.mergeRuns(),r-=a,e+=a}while(0!==r);s.forceMergeRuns()}}};var u=32,o=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function c(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function l(t,e){if(t===e)return 0;if(~~t===t&&~~e===e){if(0===t||0===e)return t<e?-1:1;if(t<0||e<0){if(0<=e)return-1;if(0<=t)return 1;t=-t,e=-e}var n=c(t),i=c(e),r=0;return n<i?(t*=o[i-n-1],e/=10,r=-1):i<n&&(e*=o[n-i-1],t/=10,r=1),t===e?r:t<e?-1:1}var a=String(t),s=String(e);return a===s?0:a<s?-1:1}function h(t){for(var e=0;u<=t;)e|=1&t,t>>=1;return t+e}function f(t,e,n,i){var r=e+1;if(r===n)return 1;if(i(t[r++],t[e])<0){for(;r<n&&i(t[r],t[r-1])<0;)r++;a(t,e,r)}else for(;r<n&&0<=i(t[r],t[r-1]);)r++;return r-e}function a(t,e,n){for(n--;e<n;){var i=t[e];t[e++]=t[n],t[n--]=i}}function d(t,e,n,i,r){for(i===e&&i++;i<n;i++){for(var a=t[i],s=e,o=i;s<o;){var c=s+o>>>1;r(a,t[c])<0?o=c:s=1+c}var u=i-s;switch(u){case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;0<u;)t[s+u]=t[s+u-1],u--}t[s]=a}}function v(t,e,n,i,r,a){var s=0,o=0,c=1;if(0<a(t,e[n+r])){for(o=i-r;c<o&&0<a(t,e[n+r+c]);)(c=1+((s=c)<<1))<=0&&(c=o);o<c&&(c=o),s+=r,c+=r}else{for(o=r+1;c<o&&a(t,e[n+r-c])<=0;)(c=1+((s=c)<<1))<=0&&(c=o);o<c&&(c=o);var u=s;s=r-c,c=r-u}for(s++;s<c;){var l=s+(c-s>>>1);0<a(t,e[n+l])?s=l+1:c=l}return c}function y(t,e,n,i,r,a){var s=0,o=0,c=1;if(a(t,e[n+r])<0){for(o=r+1;c<o&&a(t,e[n+r-c])<0;)(c=1+((s=c)<<1))<=0&&(c=o);o<c&&(c=o);var u=s;s=r-c,c=r-u}else{for(o=i-r;c<o&&0<=a(t,e[n+r+c]);)(c=1+((s=c)<<1))<=0&&(c=o);o<c&&(c=o),s+=r,c+=r}for(s++;s<c;){var l=s+(c-s>>>1);a(t,e[n+l])<0?c=l:s=l+1}return c}var _=function(){function n(t,e){r(this,n),this.array=t,this.compare=e,this.minGallop=7,this.length=t.length,this.tmpStorageLength=256,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}return i(n,[{key:"pushRun",value:function(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1}},{key:"mergeRuns",value:function(){for(;1<this.stackSize;){var t=this.stackSize-2;if(1<=t&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||2<=t&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}}},{key:"forceMergeRuns",value:function(){for(;1<this.stackSize;){var t=this.stackSize-2;0<t&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}}},{key:"mergeAt",value:function(t){var e=this.compare,n=this.array,i=this.runStart[t],r=this.runLength[t],a=this.runStart[t+1],s=this.runLength[t+1];this.runLength[t]=r+s,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;var o=y(n[a],n,i,r,0,e);i+=o,0!=(r-=o)&&0!==(s=v(n[i+r-1],n,a,s,s-1,e))&&(r<=s?this.mergeLow(i,r,a,s):this.mergeHigh(i,r,a,s))}},{key:"mergeLow",value:function(t,e,n,i){var r=this.compare,a=this.array,s=this.tmp,o=0;for(o=0;o<e;o++)s[o]=a[t+o];var c=0,u=n,l=t;if(a[l++]=a[u++],0!=--i)if(1!==e){for(var h=this.minGallop;;){var f=0,d=0,_=!1;do{if(r(a[u],s[c])<0){if(a[l++]=a[u++],d++,(f=0)==--i){_=!0;break}}else if(a[l++]=s[c++],f++,d=0,1==--e){_=!0;break}}while((f|d)<h);if(_)break;do{if(0!==(f=y(a[u],s,c,e,0,r))){for(o=0;o<f;o++)a[l+o]=s[c+o];if(l+=f,c+=f,(e-=f)<=1){_=!0;break}}if(a[l++]=a[u++],0==--i){_=!0;break}if(0!==(d=v(s[c],a,u,i,0,r))){for(o=0;o<d;o++)a[l+o]=a[u+o];if(l+=d,u+=d,0==(i-=d)){_=!0;break}}if(a[l++]=s[c++],1==--e){_=!0;break}h--}while(7<=f||7<=d);if(_)break;h<0&&(h=0),h+=2}if((this.minGallop=h)<1&&(this.minGallop=1),1===e){for(o=0;o<i;o++)a[l+o]=a[u+o];a[l+i]=s[c]}else{if(0===e)throw new Error("mergeLow preconditions were not respected");for(o=0;o<e;o++)a[l+o]=s[c+o]}}else{for(o=0;o<i;o++)a[l+o]=a[u+o];a[l+i]=s[c]}else for(o=0;o<e;o++)a[l+o]=s[c+o]}},{key:"mergeHigh",value:function(t,e,n,i){var r=this.compare,a=this.array,s=this.tmp,o=0;for(o=0;o<i;o++)s[o]=a[n+o];var c=t+e-1,u=i-1,l=n+i-1,h=0,f=0;if(a[l--]=a[c--],0!=--e)if(1!==i){for(var d=this.minGallop;;){var _=0,m=0,p=!1;do{if(r(s[u],a[c])<0){if(a[l--]=a[c--],_++,(m=0)==--e){p=!0;break}}else if(a[l--]=s[u--],m++,_=0,1==--i){p=!0;break}}while((_|m)<d);if(p)break;do{if(0!=(_=e-y(s[u],a,t,e,e-1,r))){for(e-=_,f=1+(l-=_),h=1+(c-=_),o=_-1;0<=o;o--)a[f+o]=a[h+o];if(0===e){p=!0;break}}if(a[l--]=s[u--],1==--i){p=!0;break}if(0!=(m=i-v(a[c],s,0,i,i-1,r))){for(i-=m,f=1+(l-=m),h=1+(u-=m),o=0;o<m;o++)a[f+o]=s[h+o];if(i<=1){p=!0;break}}if(a[l--]=a[c--],0==--e){p=!0;break}d--}while(7<=_||7<=m);if(p)break;d<0&&(d=0),d+=2}if((this.minGallop=d)<1&&(this.minGallop=1),1===i){for(f=1+(l-=e),h=1+(c-=e),o=e-1;0<=o;o--)a[f+o]=a[h+o];a[l]=s[u]}else{if(0===i)throw new Error("mergeHigh preconditions were not respected");for(h=l-(i-1),o=0;o<i;o++)a[h+o]=s[o]}}else{for(f=1+(l-=e),h=1+(c-=e),o=e-1;0<=o;o--)a[f+o]=a[h+o];a[l]=s[u]}else for(h=l-(i-1),o=0;o<i;o++)a[h+o]=s[o]}}]),n}()},{}],202:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});for(var i=Array(8),r=0;r<8;++r)i[r]=[];function a(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function s(t){var e=void 0,n=void 0;return e=(65535<t)<<4,e|=n=(255<(t>>>=e))<<3,e|=n=(15<(t>>>=n))<<2,(e|=n=(3<(t>>>=n))<<1)|(t>>>=n)>>1}function o(t){var e=a(t),n=i[s(e)>>2];return 0<n.length?n.pop():new ArrayBuffer(e)}function c(t){i[s(t.byteLength)>>2].push(t)}n.default={alloc_int8:function(t){var e=new Int8Array(o(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint8:function(t){var e=new Uint8Array(o(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int16:function(t){var e=new Int16Array(o(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint16:function(t){var e=new Uint16Array(o(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int32:function(t){var e=new Int32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint32:function(t){var e=new Uint32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float32:function(t){var e=new Float32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float64:function(t){var e=new Float64Array(o(8*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_dataview:function(t){var e=new DataView(o(t),0,t);return e.length!==t?e.subarray(0,t):e},free:function(t){c(t.buffer)},reset:function(){for(var t=Array(8),e=0;e<8;++e)t[e]=[]}}},{}],203:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),l=t("../../core/vmath"),h=function(t){return t&&t.__esModule?t:{default:t}}(t("../../core/geom-utils"));function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var f=l.vec3.create(),d=l.vec3.create(),s=l.mat4.create(),o=l.mat4.create(),c=l.mat4.create(),u=l.mat4.create(),_=l.mat4.create(),a=function(){function e(){r(this,e);var t=b8e.RendererEnums;this._poolID=-1,this._node=null,this._projection=t.PROJ_PERSPECTIVE,this._priority=0,this._color=l.color4.create(.2,.3,.47,1),this._depth=1,this._stencil=0,this._clearFlags=t.CLEAR_COLOR|t.CLEAR_DEPTH,this._clearModel=null,this._stages=[],this._framebuffer=null,this._near=.01,this._far=1e3,this._fov=Math.PI/4,this._rect={x:0,y:0,w:1,h:1},this._orthoHeight=10,this._cullingMask=4294967295}return i(e,[{key:"getNode",value:function(){return this._node}},{key:"setNode",value:function(t){this._node=t}},{key:"getType",value:function(){return this._projection}},{key:"setType",value:function(t){this._projection=t}},{key:"getPriority",value:function(){return this._priority}},{key:"setPriority",value:function(t){this._priority=t}},{key:"getOrthoHeight",value:function(){return this._orthoHeight}},{key:"setOrthoHeight",value:function(t){this._orthoHeight=t}},{key:"getFov",value:function(){return this._fov}},{key:"setFov",value:function(t){this._fov=t}},{key:"getNear",value:function(){return this._near}},{key:"setNear",value:function(t){this._near=t}},{key:"getFar",value:function(){return this._far}},{key:"setFar",value:function(t){this._far=t}},{key:"getColor",value:function(t){return l.color4.copy(t,this._color)}},{key:"setColor",value:function(t,e,n,i){l.color4.set(this._color,t,e,n,i)}},{key:"getDepth",value:function(){return this._depth}},{key:"setDepth",value:function(t){this._depth=t}},{key:"getStencil",value:function(){return this._stencil}},{key:"setStencil",value:function(t){this._stencil=t}},{key:"getClearFlags",value:function(){return this._clearFlags}},{key:"setClearFlags",value:function(t){this._clearFlags=t}},{key:"getRect",value:function(t){return t.x=this._rect.x,t.y=this._rect.y,t.w=this._rect.w,t.h=this._rect.h,t}},{key:"setRect",value:function(t,e,n,i){this._rect.x=t,this._rect.y=e,this._rect.w=n,this._rect.h=i}},{key:"getStages",value:function(){return this._stages}},{key:"setStages",value:function(t){this._stages=t}},{key:"getFramebuffer",value:function(){return this._framebuffer}},{key:"setFramebuffer",value:function(t){this._framebuffer=t}},{key:"_calcMatrices",value:function(t,e){var n=b8e.RendererEnums;this._node.getWorldRT(o),l.mat4.invert(o,o);var i=t/e;if(this._projection===n.PROJ_PERSPECTIVE)l.mat4.perspective(c,this._fov,i,this._near,this._far);else{var r=this._orthoHeight*i,a=this._orthoHeight;l.mat4.ortho(c,-r,r,-a,a,this._near,this._far)}l.mat4.mul(u,c,o),l.mat4.invert(_,u)}},{key:"extractView",value:function(t,e,n){this._framebuffer&&(e=this._framebuffer._width,n=this._framebuffer._height),t._priority=this._priority,t._rect.x=this._rect.x*e,t._rect.y=this._rect.y*n,t._rect.w=this._rect.w*e,t._rect.h=this._rect.h*n,this.getColor(t._color),t._depth=this._depth,t._stencil=this._stencil,t._clearFlags=this._clearFlags,t._clearModel=this._clearModel,t._stages=this._stages,t._framebuffer=this._framebuffer,this._calcMatrices(e,n),l.mat4.copy(t._matView,o),l.mat4.copy(t._matProj,c),l.mat4.copy(t._matViewProj,u),l.mat4.copy(t._matInvViewProj,_),t._cullingMask=this._cullingMask}},{key:"screenPointToRay",value:function(t,e,n,i,r){var a=b8e.RendererEnums;if(!h.default)return r;r=r||h.default.Ray.create(),this._calcMatrices(n,i);var s=this._rect.x*n,o=this._rect.y*i,c=this._rect.w*n,u=this._rect.h*i;return l.vec3.set(d,(t-s)/c*2-1,(e-o)/u*2-1,1),l.vec3.transformMat4(d,d,_),this._projection===a.PROJ_PERSPECTIVE?this._node.getWorldPosition(f):(l.vec3.set(f,(t-s)/c*2-1,(e-o)/u*2-1,-1),l.vec3.transformMat4(f,f,_)),h.default.Ray.fromPoints(r,f,d)}},{key:"screenToWorld",value:function(t,e,n,i){var r=b8e.RendererEnums;this._calcMatrices(n,i);var a=this._rect.x*n,s=this._rect.y*i,o=this._rect.w*n,c=this._rect.h*i;return this._projection===r.PROJ_PERSPECTIVE?(l.vec3.set(t,(e.x-a)/o*2-1,(e.y-s)/c*2-1,1),l.vec3.transformMat4(t,t,_),this._node.getWorldPosition(f),l.vec3.lerp(t,f,t,(0,l.lerp)(this._near/this._far,1,e.z))):(l.vec3.set(t,(e.x-a)/o*2-1,(e.y-s)/c*2-1,2*e.z-1),l.vec3.transformMat4(t,t,_)),t}},{key:"worldToScreen",value:function(t,e,n,i){this._calcMatrices(n,i);var r=this._rect.x*n,a=this._rect.y*i,s=this._rect.w*n,o=this._rect.h*i;return l.vec3.transformMat4(t,e,u),t.x=r+.5*(t.x+1)*s,t.y=a+.5*(t.y+1)*o,t.z=.5*t.z+.5,t}},{key:"worldMatrixToScreen",value:function(t,e,n,i){this._calcMatrices(n,i),l.mat4.mul(t,u,e);var r=n/2,a=i/2;return l.mat4.identity(s),l.mat4.translate(s,s,l.vec3.set(f,r,a,0)),l.mat4.scale(s,s,l.vec3.set(f,r,a,1)),l.mat4.mul(t,s,t),t}}]),e}();n.default=a},{"../../core/geom-utils":65,"../../core/vmath":184}],204:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),r=t("../../core/vmath");function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=r.vec3.create(0,0,-1),o=r.mat4.create(),c=r.mat3.create(),u=r.vec3.create(0,0,0);function l(t,e,n){t._node.getWorldRT(e),r.mat4.invert(e,e),r.mat4.perspective(n,t._spotAngle*t._spotAngleScale,1,t._shadowMinDepth,t._shadowMaxDepth)}function h(t,e,n){t._node.getWorldRT(e),r.mat4.invert(e,e);var i=t._shadowFrustumSize/2;r.mat4.ortho(n,-i,i,-i,i,t._shadowMinDepth,t._shadowMaxDepth)}function f(t,e,n){t._node.getWorldRT(e),r.mat4.invert(e,e),r.mat4.perspective(n,(0,r.toRadian)(179),1,t._shadowMinDepth,t._shadowMaxDepth)}var d=function(){function e(){a(this,e);var t=b8e.RendererEnums;this._poolID=-1,this._node=null,this._type=t.LIGHT_DIRECTIONAL,this._color=r.color3.create(1,1,1),this._intensity=1,this._range=1,this._spotAngle=(0,r.toRadian)(60),this._spotExp=1,this._directionUniform=new Float32Array(3),this._positionUniform=new Float32Array(3),this._colorUniform=new Float32Array([this._color.r*this._intensity,this._color.g*this._intensity,this._color.b*this._intensity]),this._spotUniform=new Float32Array([Math.cos(.5*this._spotAngle),this._spotExp]),this._shadowType=t.SHADOW_NONE,this._shadowFrameBuffer=null,this._shadowMap=null,this._shadowMapDirty=!1,this._shadowDepthBuffer=null,this._shadowResolution=1024,this._shadowBias=5e-4,this._shadowDarkness=1,this._shadowMinDepth=1,this._shadowMaxDepth=1e3,this._shadowDepthScale=50,this._frustumEdgeFalloff=0,this._viewProjMatrix=r.mat4.create(),this._spotAngleScale=1,this._shadowFrustumSize=50}return i(e,[{key:"getNode",value:function(){return this._node}},{key:"setNode",value:function(t){this._node=t}},{key:"setColor",value:function(t,e,n){r.color3.set(this._color,t,e,n),this._colorUniform[0]=t*this._intensity,this._colorUniform[1]=e*this._intensity,this._colorUniform[2]=n*this._intensity}},{key:"setIntensity",value:function(t){this._intensity=t,this._colorUniform[0]=t*this._color.r,this._colorUniform[1]=t*this._color.g,this._colorUniform[2]=t*this._color.b}},{key:"setType",value:function(t){this._type=t}},{key:"setSpotAngle",value:function(t){this._spotAngle=t,this._spotUniform[0]=Math.cos(.5*this._spotAngle)}},{key:"setSpotExp",value:function(t){this._spotExp=t,this._spotUniform[1]=t}},{key:"setRange",value:function(t){this._range=t}},{key:"setShadowType",value:function(t){var e=b8e.RendererEnums;this._shadowType===e.SHADOW_NONE&&t!==e.SHADOW_NONE&&(this._shadowMapDirty=!0),this._shadowType=t}},{key:"setShadowResolution",value:function(t){this._shadowResolution!==t&&(this._shadowMapDirty=!0),this._shadowResolution=t}},{key:"setShadowBias",value:function(t){this._shadowBias=t}},{key:"setShadowDarkness",value:function(t){this._shadowDarkness=t}},{key:"setShadowMinDepth",value:function(t){this._shadowMinDepth=t}},{key:"setShadowMaxDepth",value:function(t){this._shadowMaxDepth=t}},{key:"setShadowDepthScale",value:function(t){this._shadowDepthScale=t}},{key:"setFrustumEdgeFalloff",value:function(t){this._frustumEdgeFalloff=t}},{key:"setShadowFrustumSize",value:function(t){this._shadowFrustumSize=t}},{key:"extractView",value:function(t,e){var n=b8e.RendererEnums;switch(t._shadowLight=this,t._priority=-1,t._rect.x=0,t._rect.y=0,t._rect.w=this._shadowResolution,t._rect.h=this._shadowResolution,r.color4.set(t._color,1,1,1,1),t._depth=1,t._stencil=1,t._clearFlags=n.CLEAR_COLOR|n.CLEAR_DEPTH,t._stages=e,t._framebuffer=this._shadowFrameBuffer,this._type){case n.LIGHT_SPOT:l(this,t._matView,t._matProj);break;case n.LIGHT_DIRECTIONAL:h(this,t._matView,t._matProj);break;case n.LIGHT_POINT:f(this,t._matView,t._matProj);break;default:console.warn("shadow of this light type is not supported")}r.mat4.mul(t._matViewProj,t._matProj,t._matView),this._viewProjMatrix=t._matViewProj,r.mat4.invert(t._matInvViewProj,t._matViewProj),t._cullingMask=4294967295}},{key:"_updateLightPositionAndDirection",value:function(){this._node.getWorldMatrix(o),r.mat3.fromMat4(c,o),r.vec3.transformMat3(u,s,c),r.vec3.array(this._directionUniform,u);var t=this._positionUniform;t[0]=o.m12,t[1]=o.m13,t[2]=o.m14}},{key:"_generateShadowMap",value:function(t){this._shadowMap=b8e.GLTexture2D.get(t,{width:this._shadowResolution,height:this._shadowResolution,format:b8e.GFXEnums.TEXTURE_FMT_RGBA8,wrapS:b8e.GFXEnums.WRAP_CLAMP,wrapT:b8e.GFXEnums.WRAP_CLAMP}),this._shadowDepthBuffer=new b8e.GFXRenderBuffer(t,b8e.GFXEnums.RB_FMT_D16,this._shadowResolution,this._shadowResolution),this._shadowFrameBuffer=new b8e.GFXFrameBuffer(t,this._shadowResolution,this._shadowResolution,{colors:[this._shadowMap],depth:this._shadowDepthBuffer})}},{key:"_destroyShadowMap",value:function(){this._shadowMap&&(this._shadowMap.destroy(),this._shadowDepthBuffer.destroy(),this._shadowFrameBuffer.destroy(),this._shadowMap=null,this._shadowDepthBuffer=null,this._shadowFrameBuffer=null)}},{key:"update",value:function(t){var e=b8e.RendererEnums;this._updateLightPositionAndDirection(),this._shadowType===e.SHADOW_NONE?this._destroyShadowMap():this._shadowMapDirty&&(this._destroyShadowMap(),this._generateShadowMap(t),this._shadowMapDirty=!1)}},{key:"color",get:function(){return this._color}},{key:"intensity",get:function(){return this._intensity}},{key:"type",get:function(){return this._type}},{key:"spotAngle",get:function(){return this._spotAngle}},{key:"spotExp",get:function(){return this._spotExp}},{key:"range",get:function(){return this._range}},{key:"shadowType",get:function(){return this._shadowType}},{key:"shadowMap",get:function(){return this._shadowMap}},{key:"viewProjMatrix",get:function(){return this._viewProjMatrix}},{key:"shadowResolution",get:function(){return this._shadowResolution}},{key:"shadowBias",get:function(){return this._shadowBias}},{key:"shadowDarkness",get:function(){return this._shadowDarkness}},{key:"shadowMinDepth",get:function(){var t=b8e.RendererEnums;return this._type===t.LIGHT_DIRECTIONAL?1:this._shadowMinDepth}},{key:"shadowMaxDepth",get:function(){var t=b8e.RendererEnums;return this._type===t.LIGHT_DIRECTIONAL?1:this._shadowMaxDepth}},{key:"shadowDepthScale",get:function(){return this._shadowDepthScale}},{key:"frustumEdgeFalloff",get:function(){return this._frustumEdgeFalloff}},{key:"shadowFrustumSize",get:function(){return this._shadowFrustumSize}}]),e}();n.default=d},{"../../core/vmath":184}],205:[function(t,e,n){"use strict";t("./cocos2d/core"),t("./cocos2d/animation"),t("./extensions/ccpool/CCNodePool")},{"./cocos2d/animation":7,"./cocos2d/core":73,"./extensions/ccpool/CCNodePool":206}],206:[function(t,e,n){"use strict";cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent(!1);var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;var n=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return n&&n.reuse&&n.reuse.apply(n,arguments),e}},e.exports=cc.NodePool},{}],207:[function(n,i,t){(function(t){"use strict";var e="undefined"==typeof window?t:window;e.cc=e.cc||{},e._cc=e._cc||{},"undefined"==typeof params&&(e.params={}),e.IS_RUNTIME=!!params.isRuntime,e.IS_WECHATGAME=params.isWeChatGame&&"undefined"!=typeof wx&&(wx.getSystemInfoSync||wx.getSharedCanvas),e.IS_QQPLAY=params.isQQPlay&&"undefined"!=typeof bk,e.IS_WECHATGAMESUB=!("undefined"==typeof wx||!wx.getSharedCanvas),e.IS_XIAOMIGAME=!!params.isXiaomiGame,e.IS_VIVOGAME=!!params.isVivoGame,n("./predefine"),n("./polyfill/string"),n("./polyfill/misc"),n("./polyfill/array"),n("./polyfill/object"),n("./polyfill/array-buffer"),n("./polyfill/number"),n("./polyfill/typescript"),n("./cocos2d/core/predefine"),n("./cocos2d/index"),n("./extends"),i.exports=e.cc}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cocos2d/core/predefine":106,"./cocos2d/index":194,"./extends":205,"./polyfill/array":209,"./polyfill/array-buffer":208,"./polyfill/misc":211,"./polyfill/number":212,"./polyfill/object":213,"./polyfill/string":214,"./polyfill/typescript":215,"./predefine":216}],208:[function(t,e,n){"use strict";if(!ArrayBuffer.isView){var i=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor;ArrayBuffer.isView=function(t){return t instanceof i}}},{}],209:[function(t,e,n){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.find||(Array.prototype.find=function(t){for(var e=this.length,n=0;n<e;n++){var i=this[n];if(t.call(this,i,n,this))return i}})},{}],210:[function(t,e,n){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){}function n(){return r.apply(this instanceof e&&t?this:t,i.concat(Array.prototype.slice.call(arguments)))}var i=Array.prototype.slice.call(arguments,1),r=this;return this.prototype&&(e.prototype=this.prototype),n.prototype=new e,n})},{}],211:[function(t,e,n){"use strict";if(Math.sign||(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:0<t?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),IS_RUNTIME||!console.time){var i=window.performance||Date,r=Object.create(null);console.time=function(t){r[t]=i.now()},console.timeEnd=function(t){var e=r[t],n=i.now()-e;console.log(t+": "+n+"ms")}}},{}],212:[function(t,e,n){"use strict";Number.parseFloat=Number.parseFloat||parseFloat,Number.parseInt=Number.parseInt||parseInt},{}],213:[function(t,e,n){"use strict";Object.assign||(Object.assign=function(t,e){return cc.js.mixin(t,e)}),Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(t){for(var e={},n=Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)),i=0;i<n.length;++i){var r=n[i];e[r]=Object.getOwnPropertyDescriptor(t,r)}return e})},{}],214:[function(t,e,n){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;var n=this.indexOf(t,e);return-1!==n&&n===e})},{}],215:[function(t,e,n){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};window.__extends=function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},window.__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},window.__rest=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&(n[i[r]]=t[i[r]])}return n},window.__decorate=function(t,e,n,i){var r,a=arguments.length,s=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;0<=o;o--)(r=t[o])&&(s=(a<3?r(s):3<a?r(e,n,s):r(e,n))||s);return 3<a&&s&&Object.defineProperty(e,n,s),s},window.__param=function(n,i){return function(t,e){i(t,e,n)}},window.__metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},window.__awaiter=function(a,s,o,c){return new(o=o||Promise)(function(t,e){function n(t){try{r(c.next(t))}catch(t){e(t)}}function i(t){try{r(c.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new o(function(t){t(e.value)}).then(n,i)}r((c=c.apply(a,s||[])).next())})},window.__generator=function(t,n){var i,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function o(e){return function(t){return c([e,t])}}function c(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(a=2&e[0]?r.return:e[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,e[1])).done)return a;switch(r=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,r=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(t,s)}catch(t){e=[6,t],r=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}},window.__exportStar=function(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])},window.__values=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},window.__read=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,a=n.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(i=a.next()).done;)s.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return s},window.__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},window.__asyncGenerator=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(t,e||[]),s=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(i){a[i]&&(r[i]=function(n){return new Promise(function(t,e){1<s.push([i,n,t,e])||o(i,n)})})}function o(t,e){try{c(a[t](e))}catch(t){h(s[0][3],t)}}function c(t){t.value instanceof __await?Promise.resolve(t.value.v).then(u,l):h(s[0][2],t)}function u(t){o("next",t)}function l(t){o("throw",t)}function h(t,e){t(e),s.shift(),s.length&&o(s[0][0],s[0][1])}},window.__asyncDelegator=function(i){var t,r;return t={},e("next"),e("throw",function(t){throw t}),e("return"),t[Symbol.iterator]=function(){return this},t;function e(e,n){t[e]=i[e]?function(t){return(r=!r)?{value:__await(i[e](t)),done:"return"===e}:n?n(t):t}:n}},window.__asyncValues=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=r[Symbol.asyncIterator];return e?e.call(r):(r="function"==typeof __values?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(n){return new Promise(function(t,e){a(t,e,(n=r[i](n)).done,n.value)})}}function a(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)}},window.__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},window.__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},window.__importDefault=function(t){return t&&t.__esModule?t:{default:t}}},{}],216:[function(t,e,n){(function(t){"use strict";var e="undefined"==typeof window?t:window;e.CocosEngine=cc.ENGINE_VERSION="2.0.0 alpha",e.Black8CocosEngine=cc.BLACK8_COCOS_VERSION="2.7.5"}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1,2,3,4,5,6,7,8,9,10,17,18,19,20,21,22,23,24,25,26,27,28,30,29,31,32,33,11,12,13,14,15,16,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,53,50,51,59,60,61,62,63,54,55,56,57,58,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,93,94,80,81,82,83,84,85,86,87,88,89,90,91,92,95,96,97,98,99,100,101,102,103,104,105,106,107,109,110,111,112,113,114,115,116,117,118,119,120,121,122,108,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,152,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216]),function(){return function a(s,o,c){function u(e,t){if(!o[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=o[e]={exports:{}};s[e][0].call(r.exports,function(t){return u(s[e][1][t]||t)},r,r.exports,a,s,o,c)}return o[e].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}}()({1:[function(t,e,n){"use strict";(function(){var e=60;cc.game.setFrameRate=function(t){e=t,wx.setPreferredFramesPerSecond(t)},cc.game.getFrameRate=function(){return e},cc.game._runMainLoop=function(){var t,e=this,n=e.config,i=cc.director;n.frameRate;cc.debug.setDisplayStats(n.showFPS),t=function(){e._paused||(e._intervalId=window.requestAnimFrame(t),i.mainLoop())},e._intervalId=window.requestAnimFrame(t),e._paused=!1},cc.game.end=function(){}})(),function(){function s(){this.type="devicemotion",this.accelerationIncludingGravity=null}var t=!1,e=_cc.inputManager._registerAccelerometerEvent.bind(_cc.inputManager);_cc.inputManager._registerAccelerometerEvent=function(){e(),t?wx.startAccelerometer&&wx.startAccelerometer({fail:function(t){cc.error("register Accelerometer failed ! err: "+t)},success:function(){},complete:function(){}}):(t=!0,wx.onAccelerometerChange&&wx.onAccelerometerChange(function(t){var e=new s,n={};n.x=t.x,n.y=t.y,n.z=t.z;var i=wx.getSystemInfoSync(),r=i.windowWidth;if(i.windowHeight<r){var a=n.x;n.x=n.y,n.y=a,n.x*=10,n.y*=-10}else n.x*=-10,n.y*=-10;e.accelerationIncludingGravity=n,document.dispatchEvent(e)}))};var n=_cc.inputManager._unregisterAccelerometerEvent.bind(_cc.inputManager);_cc.inputManager._unregisterAccelerometerEvent=function(){n(),wx.stopAccelerometer&&wx.stopAccelerometer({fail:function(t){cc.error("unregister Accelerometer failed ! err: "+t)},success:function(){},complete:function(){}})}}(),cc&&cc.audioEngine&&(cc.audioEngine._maxAudioInstance=10),cc.macro.DOWNLOAD_MAX_CONCURRENT=10},{}]},{},[1]);