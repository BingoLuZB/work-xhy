(function(){return function s(r,o,g){function u(t,e){if(!o[t]){if(!r[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(l)return l(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[t]={exports:{}};r[t][0].call(n.exports,function(e){return u(r[t][1][e]||e)},n,n.exports,s,r,o,g)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<g.length;e++)u(g[e]);return u}})()({1:[function(e,a,i){"use strict";(function(){var e;e=b8e.Enum({None:0,V_UPDATE_VIEW:-1,V_BUY_ITEM:-1}),b8e.RC("$$game","$$SpecialGiftEvts",e)})(),function(){var e=game.Control.extends({init:function(){var e=this,t=game.spotAlert;e.spotSpecialGiftAlert1=t.set(game.SAE.SPECIAL_GIFT_ALERT_1,game.SAE.GOOD_GIFT_ALERT),e.spotSpecialGiftAlert2=t.set(game.SAE.SPECIAL_GIFT_ALERT_2,game.SAE.GOOD_GIFT_ALERT),e.spotSpecialGiftAlert3=t.set(game.SAE.SPECIAL_GIFT_ALERT_3,game.SAE.GOOD_GIFT_ALERT)},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.initOpenServer},MainRole:{C_RESET_DAILY:e.resetDaily},Back:{C_UPDATE_AMOUNT:e.updateAmount}},e.handels={SalePrizeResp:e.salePrizeResp}},updateAmount:function(){var e=this;e.checkAllAlert(),e.send(e.Evts.V_UPDATE_VIEW)},checkAllAlert:function(){var e=this,t=game.GoodGiftType;e.spotSpecialGiftAlert1.alert=game.specialGiftData.canBuyByType(t.SPECIAL_GIFT_1),e.spotSpecialGiftAlert2.alert=game.specialGiftData.canBuyByType(t.SPECIAL_GIFT_2),e.spotSpecialGiftAlert3.alert=game.specialGiftData.canBuyByType(t.SPECIAL_GIFT_3),game.specialGiftData.checkAllAlert()},initOpenServer:function(e){var t=e?e.data:null;t&&(game.specialGiftData.initCfg(),game.specialGiftData.setData(t.salePrize),this.checkAllAlert())},resetDaily:function(){this.send(this.Evts.V_UPDATE_VIEW)},salePrizeResp:function(e){var t=this,a=e.readProtobuf(game.pb.SalePrizeResponse);if(0<a.code){game.notice.noticeError(a.code)}else game.specialGiftData.setBuyNum(a.id,a.times),t.checkAllAlert(),t.send(t.Evts.V_UPDATE_VIEW)},notify:function(e,t){switch(e){case this.Evts.V_BUY_ITEM:this.sender.SalePrizeReq(t)}}}),t=game.Sender.extends({ipc:function(){this.msg={SalePrizeReq:this.salePrizeReq}},salePrizeReq:function(e){var t=game.pb.SalePrizeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.SpecialGift,e,game.SpecialGiftEvts,t)}(),function(){var e=b8e.Object.extends({curGroup:1,isInit:!1,endTime:0,ctor:function(){var e=this;e._super(),e.curGiftList=[],e.buyMap=b8e.HashMap.get(),e.specialGiftTypeMap=b8e.HashMap.get(),e.specialGiftMap=b8e.HashMap.get(),e.specialGiftListTypeMap=b8e.HashMap.get()},setData:function(e){if(e&&e.length){var t,a,i=e.length;for(t=0;t<i;t++)a=e[t],this.buyMap.set(a.goodsId,a.buyNum)}},setCurGroup:function(e){game.miscData.openServerDay;this.curGroup=e,this.endTime=this.getCurEndTime(e)},getCurBanner:function(){var e=game.GoodGiftBtnCfg.getData(this.curGroup);return e?e.banner:""},getEndTime:function(){return this.endTime-game.SysTime.curTime},initCfg:function(){var e=this,t=game.SalePrizeCfg.getDatas();if(t&&t.length&&!e.isInit){var a,i,n,s,r=t.length;for(a=0;a<r;a++)n=t[a],(i=new game.SpecialGiftInfo).id=n.id,i.cfg=n,i.buyNum=e.buyMap.get(n.id)||0,i.alert=e.checkAlert(i),(s=e.specialGiftTypeMap.get(n.tab))||(s=b8e.HashMap.get(),e.specialGiftTypeMap.set(n.tab,s)),s.set(i.id,i),e.specialGiftMap.set(i.id,i);e.isInit=!0}},getGiftListById:function(e){var t=this,a=t.specialGiftListTypeMap.get(e);a||(a=[],t.specialGiftListTypeMap.set(e,a)),a.length=0;var i=t.specialGiftTypeMap.get(e);if(!i)return a;for(var n,s=i.values(),r=0,o=0,g=s.length;o<g;o++)n=s[o],t.checkIsOpen(n)&&(r=t.buyMap.get(n.id)||0,n.buyNum=r,n.alert=t.checkAlert(n),a.push(n));return a.sort(t.listSort),a},listSort:function(e,t){var a=e.cfg.times<=e.buyNum,i=t.cfg.times<=t.buyNum;return!a&&i?-1:a&&!i?1:e.cfg.sortId-t.cfg.sortId},setBuyNum:function(e,t){this.buyMap.set(e,t);var a=this.specialGiftMap.get(e);a&&(a.buyNum=t,a.alert=this.checkAlert(a))},checkAllAlert:function(){for(var e,t=this.specialGiftMap.values(),a=0,i=t.length;a<i;a++){e=t[a];var n=this.buyMap.get(e.id)||0;e.buyNum=n,e.alert=this.checkAlert(e)}},checkAlert:function(e){var t=!1;if(e.buyNum<e.cfg.times){var a=e.cfg.cost[0];game.UpgradeUtil.checkAmountById(a.Id,a.Num,!1)&&(t=!0)}return t},canBuyByType:function(e){var t=game.goodGiftData.getBtns();if(t&&!(t.length<1)){for(var a=t.length,i=void 0,n=void 0,s=0;s<a;s++)e!=(i=t[s]).redPoint||(n=i.id);if(!n)return!1;var r=this.getGiftListById(n);if(r&&!(r.length<1)){for(var o=0,g=r.length;o<g;o++)if(this.checkAlert(r[o]))return!0;return!1}}},checkIsOpen:function(e){var t=game.miscData.openServerDay,a=e.cfg;return!(!a.serverStart&&!a.serverStart)&&(a.serverStart<=t&&a.serverEnd>t)},isOpen:function(e){var t=this.getGiftListById(e);return!(!t||!t.length)},getCurEndTime:function(e){var t=this.getGiftListById(e);if(!t||!t.length)return 0;var a=game.miscData,i=t[0].cfg;return a.openServerTime+(i.serverEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS}});game.specialGiftData=game.specialGiftData||new e}(),function(){var e=void 0;e=b8e.Object.extends({id:0,cfg:null,alert:!1,buyNum:0}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$SpecialGiftInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(977),this.setSize(600,176)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.priceList),t.layout.paddingLeft=6,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=15},setData:function(){var e=this.skin,t=this.data,a=game.CfgUtil.getPrizeListInfo(t.cfg.award);this.prizeList.setData(a.items),e.lb_tips.string=t.cfg.name,e.buyNumLab.string="("+t.buyNum+"/"+t.cfg.times+")",e.redPoint.node.active=t.alert;var i=t.cfg.times<=t.buyNum;e.buyBtn.node.active=!i,e.buyNumLab.node.active=!i,e.shouwan.node.active=i},buyBtn:function(){this.send(game.SpecialGiftEvts.V_BUY_ITEM,this.data.id)}}),b8e.RC("$$game","$$SpecialGiftItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(978)},init:function(){var e=this,t=e.skin;e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.list.itemRender=game.SpecialGiftItem,e.list.bindEnum=game.ME.SpecialGift,e.list.layout.spacingY=5,e.list.addToParent(t.list);var a=e.bannerBg=b8e.Sprite.get();a.setAnchor(.5,.5),a.addToParent(e.skin.banner),e.timer=b8e.Timer.add(e,e.updateTime,500)},updateTime:function(){if(!this.endTime){return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime()}this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e){switch(e){case game.SpecialGiftEvts.V_UPDATE_VIEW:this.updateData()}},onShow:function(){this.updateData()},updateData:function(){var e=this;e.skin;e.endTime=game.specialGiftData.endTime,e.timer.reset(),e.timer.start(),e.updateTime(),e.datas=game.specialGiftData.getGiftListById(game.specialGiftData.curGroup),e.list.setData(e.datas),e.updateBanner()},updateBanner:function(){var e=game.specialGiftData.getCurBanner();(e||0<e.length)&&this.bannerBg.loadTexture(game.ResCfg.getImgUrl(e))},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){t.setPosition(0,0)}});b8e.module.registerView(game.ME.SpecialGift,e)}(),function(){var e;e=b8e.Enum({None:0,V_UPDATE_VIEW:-1,V_RECEIVE_ITEM:-1}),b8e.RC("$$game","$$SingleRechargeEvts",e)}(),function(){var e=game.Control.extends({init:function(){var e=game.spotAlert;this.spotSingleRechargeAlert=e.set(game.SAE.SINGLE_RECHARGE_ALERT,game.SAE.GOOD_GIFT_ALERT)},ipc:function(){var e=this;e.evts={Recharge:{C_INIT_MODEL:e.initRechargeData,C_RECHARGE_SUCCESS:e.rechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily}},e.handels={SingleRechargeResp:e.singleRechargeResp}},singleRechargeResp:function(e){var t=e.readProtobuf(game.pb.SingleRechargeResponse);0<t.code?game.notice.noticeError(t.code):(game.singleRechargeData.setAward(t.id),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW))},notify:function(e,t){switch(e){case this.Evts.V_RECEIVE_ITEM:this.sender.SingleRechargeReq(t)}},initRechargeData:function(){var e=game.rechargeData;game.singleRechargeData.setupData(e.singleRechargeAwards,e.singleRechargeGroup,e.singleRechargeMoney),this.checkSpotAlert()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data,a=0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;game.singleRechargeData.updataAccRechargeMoney(a),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW)}},resetDaily:function(){game.singleRechargeData.resetDaily(),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)},checkSpotAlert:function(){var e=game.singleRechargeData;this.spotSingleRechargeAlert.alert=e.checkAlert()}}),t=game.Sender.extends({ipc:function(){this.msg={SingleRechargeReq:this.singleRechargeReq}},singleRechargeReq:function(e){var t=game.pb.SingleRechargeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.SingleRecharge,e,game.SingleRechargeEvts,t)}(),function(){var e=b8e.Object.extends({selectId:0,awardList:null,curGroup:0,endTime:0,isGetAllAward:!0,ctor:function(){var e=this;e._super(),e.activityList=[],e.awardList=[],e.moneyMap=b8e.HashMap.get(),e.activityMap=b8e.HashMap.get()},setupData:function(e,t,a){var i=this;e&&(i.awardList=e);var n=game.miscData,s=n.openServerDay;if(i.curGroup=game.SingleRechargeCfg.getCurGroup(s),t){var r=b8e.HashMap.get();if(a&&a.length)for(var o=0,g=a.length;o<g;o++)r.set(a[o],1);i.moneyMap.set(t,r)}if(i.curGroup){var u=game.SingleRechargeCfg.getOneDataByDay(i.curGroup);u&&(i.endTime=n.openServerTime+(u.serverEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS),i.initList()}},initList:function(){var e=this;e.activityList.length=0;var t=game.SingleRechargeCfg.getListByDay(e.curGroup);if(t&&!(t.length<1)){var a=0,i=t.length;if(e.isGetAllAward=!0,!e.getAccRechargeMoney())return t;for(var n=0;n<i;n++){var s=t[n],r=new game.SingleRechargeInfo;r.index=a,a++,r.setData(s),r.isGetAward=e.getIsGetAward(r.id),e.isGetAllAward&&(e.isGetAllAward=r.isGetAward),r.canGet=e.getCanGet(s.money),e.activityMap.set(r.id,r),e.activityList.push(r)}}},getCanGet:function(a){var e=this.getAccRechargeMoney();if(!e)return!1;var i=!1;return e.forEach(function(e,t){Number(e)>=a&&(i=!0)},this),i},getIsGetAward:function(e){return-1<this.awardList.indexOf(e)},setAward:function(e){var t=this;if(t.activityMap.get(e).isGetAward=!0,t.awardList.push(e),t.isGetAllAward=!0,t.activityList&&!(t.activityList.length<1))for(var a=t.activityList.length,i=0;i<a;i++){if(!t.activityList[i].isGetAward)return void(t.isGetAllAward=!1)}},updataAccRechargeMoney:function(e){var t=this,a=t.moneyMap.get(t.curGroup);if(a||(a=b8e.HashMap.get(),t.moneyMap.set(t.curGroup,a)),a.has(e)||a.set(e,1),t.activityList&&!(t.activityList.length<1))for(var i=t.activityList.length,n=0;n<i;n++){var s=t.activityList[n];s.canGet=t.getCanGet(s.needMoney)}},resetDaily:function(){var e=this,t=game.miscData,a=t.openServerDay,i=game.SingleRechargeCfg.getCurGroup(a);if(i!=e.curGroup){if(e.curGroup=i){var n=b8e.HashMap.get();e.moneyMap.set(i,n)}if(e.curGroup){var s=game.SingleRechargeCfg.getOneDataByDay(e.curGroup);s&&(e.endTime=t.openServerTime+(s.serverEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS),e.initList()}}},isOpen:function(){game.miscData.openServerDay;return!!game.moduleOpen.checkOpen(game.ME.SingleRecharge)&&!!this.curGroup},getAllAward:function(){return this.isGetAllAward},getAccRechargeMoney:function(){var e=this.moneyMap.get(this.curGroup);return e||(e=b8e.HashMap.get(),this.moneyMap.set(this.curGroup,e),e)},getActivityList:function(){return this.activityList.sort(this.listSort)},listSort:function(e,t){return!e.isGetAward&&t.isGetAward?-1:e.isGetAward&&!t.isGetAward?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.id-t.id},getActivityInfo:function(e){return this.activityMap.get(e)},getEndTime:function(){return this.endTime-game.SysTime.curTime},getMaxId:function(){return!this.activityList||this.activityList.length<1?0:this.activityList[this.activityList.length-1].id},checkAlert:function(){var e=this;if(e.curGroup&&e.activityList&&!(e.activityList.length<1)){if(e.isGetAllAward)return!1;for(var t=e.activityList.length,a=0;a<t;a++){var i=e.activityList[a];if(i.canGet&&!i.isGetAward)return!0}return!1}}});game.singleRechargeData=game.singleRechargeData||new e}(),function(){var e;e=b8e.Object.extends({id:0,isGetAward:!1,select:!1,canGet:!1,needMoney:0,value:0,name:"",index:0,setData:function(e){this.id=e.id,this.needMoney=e.money,this.value=e.value,this.name=e.name},getCfg:function(){var e=game.SingleRechargeCfg.getDataById(this.id);return e||null},getPrizeList:function(){var e=this;if(e.prizeList)return e.prizeList;var t=game.SingleRechargeCfg.getDataById(e.id);if(!t)return null;var a=game.CfgUtil.getPrizeListInfo(t.award);return e.prizeInfo=a.items,e.prizeInfo}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$SingleRechargeInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(974),this.setSize(550,145)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.priceList),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingY=10,e.anima1=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima1.addToParent(e.skin.anim),e.anima1.load(game.ResCfg.getUrl(5019,1061))},setData:function(){var e=this,t=e.skin,a=e.data,i=a.getPrizeList();this.prizeList.setData(i),t.lb_tips.string=a.name,t.rechargeBtn.node.active=!a.canGet&&!a.isGetAward,t.getBtn.node.active=a.canGet&&!a.isGetAward,t.already_got.node.active=a.isGetAward,e.anima1.play()},getBtn:function(){this.send(game.SingleRechargeEvts.V_RECEIVE_ITEM,this.data.id)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),b8e.RC("$$game","$$SingleRechargeItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(975)},init:function(){var e=this,t=e.skin;e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.list.itemRender=game.SingleRechargeItem,e.list.bindEnum=game.ME.SingleRecharge,e.list.layout.paddingLeft=14,e.list.layout.paddingTop=11,e.list.layout.spacingY=5,e.list.addToParent(t.list),e.timer=b8e.Timer.add(e,e.updateTime,500),e.anima1=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima1.addToParent(e.skin.anim),e.anima1.load(game.ResCfg.getUrl(5019,1061))},updateTime:function(){if(!this.endTime){return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime()}this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e){switch(e){case game.SingleRechargeEvts.V_UPDATE_VIEW:this.updateData()}},onShow:function(){var e=this;e.skin;e.anima1.play(),e.updateData()},updateData:function(){var e=this;e.skin;e.endTime=game.singleRechargeData.endTime,e.timer.reset(),e.timer.start(),e.updateTime(),e.datas=game.singleRechargeData.getActivityList(),e.list.setData(e.datas)},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){}});b8e.module.registerView(game.ME.SingleRecharge,e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_VIEW:-1}),b8e.RC("$$game","$$CsGuildBossChallengeEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,V_SELECT_CHANGE:-1,C2C_SYS_RANK:-1}),b8e.RC("$$game","$$CsGuildBossRankEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,C2C_SYS_DATA:-1,C2C_SYS_BOSS_DATA:-1,C2C_CHALLENGE:-1,C2C_JOIN:-1,C2C_OPEN_STATE:-1,C2V_SHOW_VIEW:-1,V2C_TIME_OVER:-1,V2C_SHOW_VIEW:-1,C2C_GUILD_BOSS_CHALLENGE:-1,C2C_UPDATE_SHOP_COUNT:-1,C_SHOW_JUNTUAN:b8e.enc()}),b8e.RC("$$game","$$CsGuildBossEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_VIEW:-1,C2V_UPDATE_TIME:-1,C2V_UPDATE_CHECK:-1,C2V_UPDATE_PRO:-1,C2C_SHOW_RANK:-1,V_FOLLOW_CHAT:-1}),b8e.RC("$$game","$$CsGuildBossBottomEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,V_FOLLOW_CHAT:-1,C2V_UPDATE_VIEW:-1,C2V_SKILL_HIT:-1}),b8e.RC("$$game","$$CsGuildBossBattleEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_VIEW:-1,C2V_UPDATE_TIME:-1,V2C_SHOW_INFO:-1,V2C_PAGE_UP:-1,V2C_PAGE_DOWN:-1,V2C_SHOW_RANK:-1,V2C_RELIVETIME_OVER:-1,C2C_SHOW_INFO:-1,C2C_UPDATA_RELIVETIME:-1,C2C_SHOW_RANK:-1}),b8e.RC("$$game","$$CsGuildBossTopRightEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,V_SELECT_CHANGE:-1}),b8e.RC("$$game","$$CsGuildBossAwardEvts",e)}(),function(){var e;e=b8e.Object.extends({rank:0,setData:function(e){this.rank=e.rank},getCfg:function(){return game.CsGuildAwardCfg.getDataByRank(this.rank)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$csGuildBossAwardInfo",e)}(),function(){var e;e=b8e.Object.extends({rank:0,setData:function(e){this.rank=e.rank},getCfg:function(){return game.GuildBossRankAwardCfg.getData(this.rank)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$csGuildBossPlayerAwardInfo",e)}(),function(){var e;e=b8e.Object.extends({unitId:0,name:0,isMale:!1,dmg:0,level:0,refresh:0,ctor:function(e){this._super(),this.rank=e},setData:function(e){var t=this;e?(t.unitId=e.roleId,t.name=e.name,t.isMale=e.isMale,t.dmg=e.dmg,t.level=e.rank,t.refresh++):t.clear()},clear:function(){var e=this;e.unitId=0,e.name="",e.isMale=!0,e.level=0,e.dmg=0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$csGuildBossPlayerRankInfo",e)}(),function(){var e;e=b8e.Object.extends({refresh:0,ctor:function(){var e=this;e._super(),e.guildName="",e.dmg=0,e.rank=0,e.zone=0},setData:function(e){var t=this;t.guildName=e.guildName,t.dmg=e.dmg,t.rank=e.rank,t.zone=e.zone,t.refresh++}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$csGuildBossGuildRankInfo",e)}(),function(){var e=b8e.Object.extends({state:1,reliveTime:0,hp:0,maxHp:0,shield:0,maxShield:0,isAutoChallenge:!1,isHideBoss:!1,isHidePlayer:!1,reviveTime:0,guildRanks:0,myGuildRank:0,enterTime:0,oldGuildRanks:null,oldPlayerRanks:null,oldPlayerRankData:null,playerRanks:null,curPlayerRanks:null,curPlayerRankData:null,playerRankInfoPool:null,enterBtnShow:!1,firstTime:!0,setup:function(e){var t=this;t.guildRanks=[],t.oldGuildRanks=[],t.curPlayerRanks=[],t.oldPlayerRanks=[],t.reliveTime=e.remTime,t.owner=e.owner,t.initPlayerRanks(),t._initEnter||(t._initEnter=!0,t.enterBtnShow=0==e.remTime)},setupData:function(e){var t=this;t.hp=e.hp,t.maxHp=e.maxHp,t.shield=e.shield,t.maxShield=e.maxShield,t.setupPlayerRanks(e.ranks)},setupGuildRanks:function(e,t){var a=t;if(a.length=0,!e||e.length<1)return 0;for(var i,n=0,s=0,r=e.length;s<r;s++)(i=new game.csGuildBossGuildRankInfo).setData(e[s]),a.push(i),e[s].guildId==game.guildData.id&&(n=e[s].rank);return n},getGuildRanks:function(){return game.sceneData.getSceneType()==game.SceneType.CS_GUILD?this.guildRanks:this.oldGuildRanks},getMyGuildRank:function(){return game.sceneData.getSceneType()==game.SceneType.CS_GUILD?this.myGuildRank:this.oldMyGuildRank},initPlayerRanks:function(){var e=this;if(e.playerRanks||(e.playerRanks=[]),!(0<e.playerRanks.length))for(var t,a=0;a<10;a++)(t=e.getPlayerRanksInfo(a+1)).clear(),e.playerRanks.push(t)},setupPlayerRanks:function(e){if(e&&!(e.length<1)){var t=this.playerRanks;if(t){e.sort(function(e,t){return e.rank-t.rank});for(var a=this.playerRank=0,i=t.length;a<i;a++)t[a].setData(e[a])}}},setupViewPlayerRanks:function(e,t){for(var a,i=0,n=t.length;i<n;i++)this.recyclePlayerRanksInfo(t[i]);if(t.length=0,!e||e.length<1)return null;for(i=0,n=e.length;i<n;i++){var s=e[i];(a=this.getPlayerRanksInfo(s.rank)).setData(s),a.rank=s.rank,t.push(a)}return t},getMyRank:function(){var e=this.getPlayerRanks();if(e)for(var t=0;t<e.length;t++)if(e[t].unitId==game.mainRoleData.roleId)return e[t];return null},getPlayerRanks:function(){return this.curPlayerRank},getPlayerRanksInfo:function(e){var t=0<arguments.length&&void 0!==e?e:0;return this.playerRankInfoPool||(this.playerRankInfoPool=[]),0<this.playerRankInfoPool.length?this.playerRankInfoPool.pop():new game.csGuildBossPlayerRankInfo(t)},recyclePlayerRanksInfo:function(e){this.playerRankInfoPool||(this.playerRankInfoPool=[]),e&&(e.clear(),this.playerRankInfoPool.push(e))},setupRanks:function(e){this.curPlayerRank=this.setupViewPlayerRanks(e,this.curPlayerRanks)},getGuildAwards:function(){var e=this.guildAwards;if(e)return e;this.guildAwards=e=[];for(var t,a=game.CsGuildAwardCfg.getDatas(),i=0,n=a.length;i<n;i++)(t=new game.csGuildBossAwardInfo).setData(a[i]),e.push(t);return e},getPlayerAwards:function(){var e=this.playerAwards;if(e)return e;this.playerAwards=e=[];for(var t,a=game.GuildBossRankAwardCfg.getDatas(),i=0,n=a.length;i<n;i++)(t=new game.csGuildBossPlayerAwardInfo).setData(a[i]),e.push(t);return e},getOpenTime:function(){var e=game.GuildMiscCfg.getData("crossGuildTime"),t=game.GuildMiscCfg.getData("crossGuildEnd"),a=b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+60*e.value*60*1e3,i=b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+60*t.value*60*1e3;return game.SysTime.curTime>=a&&game.SysTime.curTime<=i},setPlayerName:function(e){e.data.guildId!=game.guildData.id&&(e.updateNameColor(game.Color.RED),e._guildBar.setNameColor(game.Color.RED))}});game.csGuildBossData=game.csGuildBossData||new e}(),function(){var e=game.Control.extends({ipc:function(){this.evts={CsGuildTopRight:{C2C_SHOW_RANK:this.showRank}},this.handels={GuildBossRankResp:this.onCrossBossRankRsp}},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_SELECT_CHANGE,e)},showRank:function(){this.sender.GuildBossRankReq()},onCrossBossRankRsp:function(e){var t=e.readProtobuf(game.pb.GuildBossRankResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.csGuildBossData.setupRanks(t.ranks);game.module.show(game.ME.CsGuildRank)}}}),t=game.Sender.extends({ipc:function(){this.msg={GuildBossRankReq:null}}});b8e.module.registerControl(game.ME.CsGuildRank,e,game.CsGuildBossRankEvts,t)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={CsGuild:{C2C_SYS_DATA:this.sysData,C2C_SYS_BOSS_DATA:this.sysData}}},sysData:function(e){var t=e.data;if(t){this.send(this.Evts.C2V_UPDATE_VIEW,t)}},updateTime:function(){var e=game.csGuildBossData;this.send(this.Evts.C2V_UPDATE_TIME,e)},notify:function(e,t){var a=this;switch(e){case a.Evts.V2C_SHOW_INFO:a.dpt(a.Evts.C2C_SHOW_INFO,t);break;case a.V2C_RELIVETIME_OVER:a.dpt(a.Evts.C2C_UPDATA_RELIVETIME)}},upBtn:function(){this.send(this.Evts.V2C_PAGE_UP)},downBtn:function(){this.send(this.Evts.V2C_PAGE_DOWN)},showRankBtn:function(){this.send(this.Evts.V2C_SHOW_RANK)},hideRankBtn:function(){this.send(this.Evts.V2C_SHOW_RANK)},rankBtn:function(){this.dpt(this.Evts.C2C_SHOW_RANK)}}),t=[game.ME.CsGuildTop];b8e.module.registerControl(game.ME.CsGuildTopRight,e,game.CsGuildBossTopRightEvts,null,t)}(),function(){var e=game.Control.extends({ipc:function(){this.gevts={InstanceEvts:{G_SKILL_HIT:this.onSkillHit}}},onSkillHit:function(e){var t=this;if(b8e.module.isShowView(game.ME.CsGuildBattle)){var a=e.data;a&&a.roleData.type==game.RoleType.Monster&&game.MonsterCfg.getDataAsync(a.roleId,function(e){e&&1==e.type&&t.send(t.Evts.C2V_SKILL_HIT,a)},t)}}});b8e.module.registerControl(game.ME.CsGuildBattle,e,game.CsGuildBossBattleEvts,null)}(),function(){var e=game.Control.extends({btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_SELECT_CHANGE,e)}});b8e.module.registerControl(game.ME.CsGuildAward,e,game.CsGuildBossAwardEvts,null)}(),function(){var e=game.Control.extends({init:function(){var e=this;e._alertOptions={lang:6012,okcb:e.onClickGameAlert,thisArg:e},e._reliveOptions={lang:732,okcb:e.onClickReliveAlert,thisArg:e}},ipc:function(){var e=this;e.gevts={SceneGEvts:{MAIN_ROLE_REVIVE:e.onRevive,ENTER_SCENE:e.enterScene,CANCEL_AUTO_CHALLENGE:e.onCancelAuto}},e.evts={CsGuild:{C2C_SYS_DATA:e.sysData,C2C_SYS_BOSS_DATA:e.sysBossData}}},sysData:function(e){var t=e.data;if(t){var a=this;1==t.state&&(b8e.Tween.kill(a),b8e.Tween.get(a).wait(1e3*t.remTime).call(a.autoChallage,a)),a.send(a.Evts.C2V_UPDATE_VIEW,t)}},sysBossData:function(e){var t=e.data;if(t){this.send(this.Evts.C2V_UPDATE_PRO,t)}},autoChallage:function(){game.csGuildBossData.isAutoChallenge&&2==game.csGuildBossData.state&&b8e.evt.dptG(game.SceneGEvts.SCENE_AUTO_CHALLENGE)},onRevive:function(){this.autoChallage()},btn_back:function(){game.alert.showTwo(this._alertOptions)},onClickGameAlert:function(){b8e.evt.dptG(game.SceneGEvts.SCENE_EXIT)},reliveBtn:function(){this._reliveOptions.okcb=this.onClickRelive,game.alert.showTwo(this._reliveOptions)},onClickRelive:function(){b8e.evt.dptG(game.SceneGEvts.SCENE_REVIVE,2)},onCancelAuto:function(){game.csGuildBossData.isAutoChallenge=!1,this.send(this.Evts.C2V_UPDATE_CHECK)},autoChallageBtn:function(){game.csGuildBossData.isAutoChallenge=!game.csGuildBossData.isAutoChallenge,this.send(this.Evts.C2V_UPDATE_CHECK),game.csGuildBossData.isAutoChallenge&&2==game.csGuildBossData.state&&b8e.evt.dptG(game.SceneGEvts.SCENE_AUTO_CHALLENGE)},autoReliveBtn:function(){game.sceneData.isAutoRelive?this.onClickReliveAlert():(this._reliveOptions.okcb=this.onClickReliveAlert,game.alert.showTwo(this._reliveOptions))},enterScene:function(){var e=this;if(game.sceneData.getSceneType()==game.SceneType.CS_GUILD){var t=game.csGuildBossData;t.isHideBoss=!1,e.hideBoss(t.isHideBoss),t.isHidePlayer=!1,e.hideOtherPlayer(t.isHidePlayer),e.hideNickName(),e.send(e.Evts.C2V_UPDATE_VIEW)}},onClickReliveAlert:function(){game.sceneData.isAutoRelive=!game.sceneData.isAutoRelive,this.send(this.Evts.C2V_UPDATE_CHECK)},hideNickName:function(){b8e.scene.setMaxAttachNum(game.RoleType.Hero,game.AnimType.NICK_NAME,0),game.playBackScene.scene.setMaxAttachNum(game.RoleType.Hero,game.AnimType.NICK_NAME,0)},hideBoss:function(e){b8e.scene.setMaxRenderNum(game.RoleType.Monster,e?0:9999)},hideOtherPlayer:function(e){b8e.scene.setMaxRenderNum(game.RoleType.Hero,e?0:9999)},hideBossBtn:function(){var e=game.csGuildBossData,t=e.isHideBoss=!e.isHideBoss;this.hideBoss(t),this.send(this.Evts.C2V_UPDATE_CHECK)},hidePlayerBtn:function(){var e=game.csGuildBossData,t=e.isHidePlayer=!e.isHidePlayer;this.hideOtherPlayer(t),this.send(this.Evts.C2V_UPDATE_CHECK)}});b8e.module.registerControl(game.ME.CsGuildBottom,e,game.CsGuildBossBottomEvts,null)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={CsGuildTopRight:{C2C_SHOW_INFO:this.showInfo}}},showInfo:function(e){game.module.show(game.ME.CsGuildChallenge),this.send(this.Evts.C2V_UPDATE_VIEW,e.data)},challengeBtn:function(){if(game.sceneHelper.isSameGuild(game.scenePick.target))game.notice.show(733);else switch(game.csGuildBossData.state){case 1:game.notice.show(734);break;case 2:case 3:b8e.evt.dptG(game.SceneGEvts.SCENE_CHALLENGE)}}});b8e.module.registerControl(game.ME.CsGuildChallenge,e,game.CsGuildBossChallengeEvts,null)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.CS_GUILD,game.SAE.NORMAL_ACTIVITY_ALERT)},ipc:function(){var e=this;e.gevts={SceneGEvts:{MAIN_MOVE_COMPLETE:e.onMoveComplete}},e.evts={CsGuildTopRight:{C2C_UPDATA_RELIVETIME:e.resetReliveTime},MainUIChat:{C2C_CSGUILD_RELIVE:e.chatBossRelive,C2C_CSGUILD_KILL:e.chatBossDeah}},e.handels={GuildBossDataResp:e.onGuildBossDataRsp,GuildBossJoinResp:e.onGuildBossJoinRsp,GuildBossDataMsg:e.onGuildBossDataMsg}},notify:function(e){switch(e){case this.Evts.V2C_SHOW_VIEW:this.sender.GuildBossDataReq()}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.GuildBossDataReq()},checkAlert:function(){},onGuildBossDataRsp:function(e){var t=e.readProtobuf(game.pb.GuildBossDataResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this;game.csGuildBossData.setup(t),a.remTime(t.remTime),a.bossRelive(),a.checkAlert(),a.send(a.Evts.C2V_SHOW_VIEW),a.dpt(a.Evts.C2C_SYS_DATA,game.csGuildBossData),a.dpt(a.Evts.C2C_OPEN_STATE),a.dpt(a.Evts.C_SHOW_JUNTUAN),game.csGuildBossData.firstTime&&(game.csGuildBossData.firstTime=!1,a.createTimer())}},createTimer:function(){var e=this,t=game.SysTime.curTime,a=game.GuildMiscCfg.getData("crossGuildEnd"),i=b8e.TimeUtil.getTodayTime(t)+60*a.value*60*1e3-t;!e.timer&&0<i?e.timer=b8e.setTimeout(e.setCountDown,e,i):(e.timer.reset(),e.timer.start())},setCountDown:function(){this.dpt(this.Evts.C_SHOW_JUNTUAN),this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onGuildBossDataMsg:function(e){var t=e.readProtobuf(game.pb.GuildBossDataNotify);if(0<t.code)game.notice.noticeError(t.code);else{game.csGuildBossData.setupData(t);var a=this;a.updataBossHp(),a.dpt(a.Evts.C2C_SYS_BOSS_DATA,game.csGuildBossData),a.dpt(a.Evts.C_SHOW_JUNTUAN)}},onGuildBossJoinRsp:function(e){var t=e.readProtobuf(game.pb.GuildBossJoinResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.csGuildBossData.isAutoChallenge=!1;this.dpt(this.Evts.C2C_SYS_BOSS_DATA,game.csGuildBossData),this.dpt(this.Evts.C2C_GUILD_BOSS_CHALLENGE)}},remTime:function(e){var t=this;t.remEndTime=game.SysTime.curTime+1e3*e,t.remTimer||(t.remTimer=b8e.Timer.add(t,t.updateRemTime,1e3)),t.remTimer.reset(),t.remTimer.start()},updateRemTime:function(){0<this.remEndTime-game.SysTime.curTime?game.csGuildBossData.reliveTime--:this.remTimer.stop()},resetReliveTime:function(){game.csGuildBossData.reliveTime=0,this.bossRelive(),this.checkAlert(),this.dpt(this.Evts.C2C_SYS_BOSS_DATA,game.csGuildBossData)},bossRelive:function(){var e=game.csGuildBossData,t=game.GuildMiscCfg.getData("crossGuildTime");b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+60*t*60*1e3>game.SysTime.curTime?e.state=1:0==e.reliveTime?e.state=2:0<e.reliveTime&&(e.state=3)},updataBossHp:function(){var e=this,t=game.csGuildBossData;0<t.hp?10*(t.hp/t.maxHp).toFixed(2)<10&&(e._firstBlood||(e._firstBlood=!0,e.chat={chatType:game.ChatChannelType.CSARROW,marqueeKey:"guild_fight",funcType:game.ChatFuncType.CHAT_FUNC_CS_GUILD_FIGHT})):(e._firstBlood=!1,0==t.reliveTime&&(t.reliveTime=1),e.chat={chatType:game.ChatChannelType.CSARROW,marqueeKey:"guild_kill",funcType:game.ChatFuncType.CHAT_FUNC_CS_GUILD_KILL})},prizeBtn:function(){game.module.show(game.ME.CsGuildAward)},challengeBtn:function(){game.moduleOpen.checkOpenWithTips(this.moduleEnum)&&(game.playBack.isInstanceFighting()||this.challenge())},challenge:function(){this.sender.GuildBossJoinReq()},onMoveComplete:function(e){var t=game.sceneData.getConfig();if(t&&t.type==game.SceneType.CS_GUILD)switch(e.data){case game.SceneMoveType.CLICK_PLAYER:game.challengeIcon.show(game.scenePick.target);break;case game.SceneMoveType.CLICK_MONSTER:game.csGuildBossData.isAutoChallenge?b8e.evt.dptG(game.SceneGEvts.SCENE_CHALLENGE):game.challengeIcon.show(game.scenePick.target);break;case game.SceneMoveType.CLICK_BOX:b8e.evt.dptG(game.SceneGEvts.CLICK_BOX)}},chatBossRelive:function(){this.bossStateSend(!0)},chatBossDeah:function(){this.bossStateSend(!1)},bossStateSend:function(e){game.csGuildBossData.enterBtnShow=e,this.sender.GuildBossDataReq()}}),t=[game.ME.CsGuildBossAward,game.ME.CsGuildPlayerAward,game.ME.CsGuildTopLeft],a=game.Sender.extends({ipc:function(){this.msg={GuildBossDataReq:null,GuildBossJoinReq:null}}});b8e.module.registerControl(game.ME.CsGuild,e,game.CsGuildBossEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(234),this.setSize(550,145)},init:function(){var e=this;e._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._prizeList.itemRender=game.ShowItemListItem,e._prizeList.layout.paddingLeft=0,e._prizeList.layout.spacingX=20,e._prizeList.layout.paddingTop=10,e._prizeList.addToParent(e.skin.prizeView)},setData:function(e){var t=e.getCfg();this.skin.rankLab.string=t.range,this._rankBg&&(this._rankBg.node.active=!0);var a=game.CfgUtil.getPrizeListInfo(t.items,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84);a&&a.items&&this._prizeList.setData(a.items)},clearData:function(){this._rankBg&&(this._rankBg.node.active=!1),this._prizeList&&this._prizeList.clear()}}),b8e.RC("$$game","$$CsGuildBossAwardItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(235),this.setSize(550,170)},init:function(){var e=this;e._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._prizeList.itemRender=game.ShowItemListItem,e._prizeList.layout.paddingLeft=-10,e._prizeList.layout.spacingX=20,e._prizeList.layout.paddingTop=5,e._prizeList.addToParent(e.skin.prizeView)},setData:function(e){var t=e.getCfg();this.skin.rankLab.string=t.range,this._rankBg&&(this._rankBg.node.active=!0);var a=game.CfgUtil.getPrizeListInfo(t.items,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84);a&&a.items&&this._prizeList.setData(a.items)},clearData:function(){this._rankBg&&(this._rankBg.node.active=!1),this._prizeList&&this._prizeList.clear()}}),b8e.RC("$$game","$$CsGuildBossAwardItem2",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(241),this.setSize(540,94)},setData:function(e){var t=this;t.skin.nameLab.string=game.Lang.get(1348,e.name),t.skin.hurtLab.string=game.Lang.get(5980,game.CCommonUtil.replaceNum(e.dmg,1)),t.skin.rankLab.active=3<e.rank,t.skin.rankIcon1.active=1==e.rank,t.skin.rankIcon2.active=2==e.rank,t.skin.rankIcon3.active=3==e.rank,t.skin.rankIcon4.active=3<e.rank,t.skin.rankLab.string=e.rank}}),b8e.RC("$$game","$$CsGuildBossRankItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(240),this.setSize(100,110)},init:function(){var e=this;e._headIcon=b8e.Sprite.get(),e._headIcon.setAnchor(.5,.5),e._headIcon.setSize(64,64),e._headIcon.addToParent(e.skin.icon)},setData:function(e){var t=this;t.skin.rankLab.string=e.rank,t.skin.own.active=1==e.rank&&e.unitId;var a=e.unitId<1;if(t.skin.nameBg.node.active=!a,t.skin.hintLab.node.active=a)t._headIcon.unloadTexture();else{var i=game.ResCfg.getHead(e.isMale);t._headIcon.loadTexture(i),t.skin.nameLab.string=game.HtmlUtil.getText(game.Color.BLACK,e.name)}},clickBtn:function(){var e=this.data;if(!(e.unitId<1)){b8e.scene.getDisplayByTypeAndId(game.RoleType.Hero,e.unitId);this.send(game.CsGuildBossTopRightEvts.V2C_SHOW_INFO,e)}}}),b8e.RC("$$game","$$CsGuildBossPlayerItem",e)}(),function(){var e;e=game.CsGuildBossRankItem.extends({setData:function(e){var t=this;t.skin.nameLab.string=game.HtmlUtil.getColorStrByRank(e.rank,e.name),t.skin.hurtLab.string=game.Lang.get(5332,game.CCommonUtil.replaceNum(e.dmg,1)),t.skin.rankLab.string=e.rank;var a=3<e.rank?4:e.rank;t._rankBg=t.getComponent("rank"+a),t._rankBg&&(t._rankBg.node.active=!0),t.createPrize(e.rank)},createPrize:function(e){var t=game.CsBossRankPlayerAwardCfg.getDataByRank(e);if(t){var a=game.CfgUtil.getPrizeListInfo(t.items);a&&a.items&&this._prizeList.setData(a.items)}}}),b8e.RC("$$game","$$CsGuildBossPlayerRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(233),this.toggles={toggle_btn_1:game.ME.CsGuildPlayerAward}},notify:function(e,t){switch(e){case this.Evts.V_SELECT_CHANGE:this.toggleSelect(t)}},onStageResize:function(){this._super()},toggleSelect:function(e){this._super(e)&&(this.skin.title_rankAward.active=0==e)}});b8e.module.registerView(game.ME.CsGuildAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(236)},init:function(){var e=this;e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._list.itemRender=game.CsGuildBossAwardItem2,e._list.layout.paddingLeft=0,e._list.layout.spacingY=5,e._list.addToParent(e.skin.prizeView)},createPrize:function(){var e=game.csGuildBossData.getGuildAwards();this._list.setData(e)},onShow:function(){this.createPrize()},onStageResize:function(){this.setPosition(0,-0)}});b8e.module.registerView(game.ME.CsGuildBossAward,e)}(),function(){var e=game.View.extends({_isMoveUp:!1,_specialLayer:!0,ctor:function(){this._super(237),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView(t);break;case this.Evts.C2V_SKILL_HIT:this.onSkillHit(t)}},updateView:function(e){if(e){var t=this;t.lastData=e;var a=t.skin,i=.7*b8e.stageWidth;t.skin.hpBg_1.width=i,t.skin.hpBg_2.width=i,t.barLen=i-21;var n=game.csGuildBossData.shield,s=game.csGuildBossData.maxShield;a.hpBg1.node.active=0<n,a.shieldLab.x=t.skin.hpBg_1.x+.5*i,a.hpLab.x=t.skin.hpBg_2.x+.5*i;var r=n/s;a.shield.node.width=t.barLen*r,a.shieldLab.string=(100*r).toFixed(2)+"%",r=e.hp/e.maxHp||0,a.hp.node.width=t.barLen*r,a.hpLab.string=0!=r?(100*r).toFixed(2)+"%":r+"%"}},onSkillHit:function(e){this.updateView(e.roleData)},onStageResize:function(){b8e.stageHeight,b8e.stageWidth;this.setPosition(5,this.height+130),this.updateView(this.lastData)}});b8e.module.registerView(game.ME.CsGuildBattle,e)}(),function(){var e=game.View.extends({_isMoveUp:!1,_specialLayer:!0,ctor:function(){this._super(238),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_UPDATE_VIEW:a.updateView(t);break;case a.Evts.C2V_UPDATE_CHECK:a.setAutoBtnState();break;case a.Evts.C2V_UPDATE_PRO:a.setBossPro(t)}},onShow:function(){this.updateView(game.csGuildBossData)},updateView:function(e){if(e){this.lastData=e;this.skin;this.setBossPro(e),this.setAutoBtnState(e)}},setBossPro:function(e){var t=this,a=t.skin,i=.7*b8e.stageWidth;t.skin.hpBg_1.width=i,t.skin.hpBg_2.width=i,t.barLen=i-21,a.shieldLab.x=t.skin.hpBg_1.x+.5*i,a.hpLab.x=t.skin.hpBg_2.x+.5*i,a.hpBg1.node.active=0<e.shield;var n=e.shield/e.maxShield;a.shield.node.width=t.barLen*n,a.shieldLab.string=(100*n).toFixed(2)+"%",n=e.hp/e.maxHp||0,a.hp.node.width=t.barLen*n,a.hpLab.string=0!=n?(100*n).toFixed(2)+"%":n+"%"},setAutoBtnState:function(){var e=this.skin,t=game.csGuildBossData;e.autoRelive.node.active=game.sceneData.isAutoRelive,e.autoChallage.node.active=t.isAutoChallenge,e.check3.node.active=t.isHideBoss,e.check4.node.active=t.isHidePlayer},onStageResize:function(){b8e.stageHeight,b8e.stageWidth;this.setPosition(0,this.height+120),this.updateView(this.lastData)}});b8e.module.registerView(game.ME.CsGuildBottom,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(239)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView(t)}},onHide:function(){var e=this.role;e&&e.removeFromParent(),this.selectData=null},updateView:function(e){var t=this;t.selectData=e;var a=t.skin;a.nameLab.string=e.name,a.powerLab.string=e.power,a.lvLab.string=e.level,a.guildLab.string=e.guildName,a.rankLab.string=e.rank,a.hurtLab.string=game.CCommonUtil.replaceNum(e.dmg),a.hpLab.string=e.hp+"/"+e.maxHp,a.hp.node.width=383*e.hp/e.maxHp;var i=b8e.scene.getDisplayByTypeAndId(game.RoleType.Hero,e.unitId);if(i&&i.data){t.role=game.sceneRoleCreate.createUIRole(i.data);var n=game.AvatarUtil;n.updateUIModel(t.role,n.ID_2),t.role.addToParent(a.modelRoot)}},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.CsGuildChallenge,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(236)},init:function(){var e=this;e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._list.itemRender=game.CsGuildBossAwardItem,e._list.layout.paddingLeft=0,e._list.layout.spacingY=10,e._list.addToParent(e.skin.prizeView)},createPrize:function(){var e=game.csGuildBossData.getPlayerAwards();this._list.setData(e)},onShow:function(){this.createPrize()},onStageResize:function(){this.setPosition(0,-0)}});b8e.module.registerView(game.ME.CsGuildPlayerAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(242)},init:function(){var e=this;e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._list.itemRender=game.CsGuildBossRankItem,e._list.layout.paddingLeft=0,e._list.layout.spacingY=5,e._list.addToParent(e.skin.scrollView)},onShow:function(){this.updataView()},onHide:function(){this._list&&this._list.clear()},updataView:function(){var e=game.csGuildBossData,t=e.getMyRank();t&&0<t.rank?this.skin.lbl_rank.string=game.Lang.get(506,t.rank):this.skin.lbl_rank.string=game.Lang.get(706);var a=t?t.dmg:0;this.skin.lbl_hunt.string=game.Lang.get(1348,a),this._list.setData(e.getPlayerRanks())}});b8e.module.registerView(game.ME.CsGuildRank,e)}(),function(){var e=game.View.extends({_specialLayer:!0,ctor:function(){this._super(243),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},onStageResize:function(){var e=b8e.stageHeight;this.setPosition(0,e-43-120)}});b8e.module.registerView(game.ME.CsGuildTopLeft,e)}(),function(){var e=game.View.extends({_specialLayer:!0,ctor:function(){this._super(244),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},init:function(){var e=this;e._rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._rankList.itemRender=game.CsGuildBossPlayerItem,e._rankList.bindEnum=game.ME.CsGuildTopRight,e._rankList.layout.paddingLeft=5,e._rankList.layout.spacingX=10,e._rankList.addToParent(e.skin.playerView)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_UPDATE_VIEW:a.updateView(t);break;case a.Evts.C2V_UPDATE_TIME:a.updateTime(t);break;case a.Evts.V2C_PAGE_UP:a._rankList.scrollToTop();break;case a.Evts.V2C_PAGE_DOWN:a._rankList.scrollToBottom();break;case a.Evts.V2C_SHOW_RANK:a.showRank()}},showRank:function(){var e=this.skin.mask,t=e.height<580,a=t?580:40,i=200*e.height/580;b8e.Tween.kill(e),b8e.Tween.get(e).to({height:a},i),this.setShowRankBtn(t)},setShowRankBtn:function(e){this.skin.hideRankBtn.active=!e,this.skin.showRankBtn.active=e},updateView:function(e){this._rankList.setData(e.playerRanks),this.updateTime(e)},updateTime:function(e){var t=this,a=t.skin;if(0!=e.hp&&(t._timeStar=!1),!t._timeStar){var i;e.state;if(0==e.hp){t._timeStar=!0;var n=game.GuildMiscCfg.getData("crossGuildMountRelive"),s=1<game.csGuildBossData.reliveTime?game.csGuildBossData.reliveTime:n.value;t.remEndTime=game.SysTime.curTime+1e3*s,i=b8e.TimeUtil.formatTime(1e3*s),a.exitTimeLab.string=game.Lang.get(6014,i),t._fightDay=0}else t.remEndTime=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime),i=b8e.TimeUtil.formatTime(t.remEndTime-game.SysTime.curTime),a.exitTimeLab.string=game.Lang.get(6015,i),t._fightDay=1;t.remTimer||(t.remTimer=b8e.Timer.add(t,t.updateFestivalTime,1e3)),t.remTimer.reset(),t.remTimer.start()}},onShow:function(){this._rankList.setData(game.csGuildBossData.playerRanks),this.skin.mask.height=580,this.setShowRankBtn(!0)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(e-10,t-55)},updateFestivalTime:function(){var e=this;if(0<e.remEndTime-game.SysTime.curTime){var t=b8e.TimeUtil.formatTime(e.remEndTime-game.SysTime.curTime),a=0==e._fightDay?6014:6015;e.skin.exitTimeLab.string=game.Lang.get(a,t)}else e.send(e.Evts.V2C_RELIVETIME_OVER)}});b8e.module.registerView(game.ME.CsGuildTopRight,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(246)},init:function(){var e=this;e.awardsList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.awardsList.itemRender=game.CsGuildBossAwardListItem,e.awardsList.bindEnum=e.moduleEnum,e.awardsList.addToParent(e.skin.prizeNode1),e.awardsList.layout.paddingLeft=3,e.awardsList.layout.spacingX=3,e.awardsList.layout.paddingTop=-3,e._monModel=b8e.SceneEntity.get(),e._monModel.addToParent(e.skin.model)},_createPrizeItems:function(e){for(var t,a,i=e.value.split("|"),n=[],s=0,r=i.length;s<r;s++)a=i[s].split(","),(t=game.ItemInfo.get()).id=parseInt(a[0]),t.num=parseInt(a[1]),t.iconSize=game.IconSizeEnum.GRID_SIZE_84,n.push(t);return n},_createSaleItems:function(e){for(var t,a,i=[],n=0,s=e.length;n<s;n++)a=e[n],(t=game.ItemInfo.get()).id=a.Id,t.num=a.Num,t.iconSize=game.IconSizeEnum.GRID_SIZE_84,i.push(t);return i},notify:function(e){switch(e){case this.Evts.C2V_SHOW_VIEW:this.updataList(),this.updataOwn(),this.updataModel()}},onShow:function(){this.send(this.Evts.V2C_SHOW_VIEW)},onStageResize:function(){this._super()},updataList:function(){var e=game.GuildMiscCfg.getData("guildBossAward3");if(e){var t=this._createPrizeItems(e);this.awardsList.setData(t)}},updataOwn:function(){var e=game.csGuildBossData.owner||"";this.skin.lbl_player.string=e,this.updataPanelTime()},updataPanelTime:function(){var e,t=this;if(game.csGuildBossData.reliveTime)t.remEndTime=game.SysTime.curTime+1e3*game.csGuildBossData.reliveTime,e=b8e.TimeUtil.formatTime(1e3*game.csGuildBossData.reliveTime),t.skin.hintLab.string=game.Lang.get(5981,e),t._fightDay=0;else{t.remEndTime=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime);var a=game.GuildMiscCfg.getData("crossGuildEnd");t.remEndTime=b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+60*a.value*60*1e3,e=b8e.TimeUtil.formatTime(t.remEndTime-game.SysTime.curTime),t.skin.hintLab.string=game.Lang.get(5983,e),t._fightDay=1}t.remTimer||(t.remTimer=b8e.Timer.add(t,t.updateFestivalTime,1e3)),t.remTimer.reset(),t.remTimer.start()},updateFestivalTime:function(){var e=this;if(0<e.remEndTime-game.SysTime.curTime){var t=b8e.TimeUtil.formatTime(e.remEndTime-game.SysTime.curTime),a=0==e._fightDay?5981:5983;e.skin.hintLab.string=game.Lang.get(a,t)}else game.csGuildBossData.reliveTime=0,e.updataPanelTime()},updataModel:function(){var t=this,e=game.GuildMiscCfg.getData("crossGuildMount");game.CfgUtil.getMosterModelRes(parseInt(e.value),function(e){t.setAnim(game.ResCfg.getUrl(5e3,e))},t)},setAnim:function(e){var t;e?((t=(t=this._monModel.getAnimator(game.AnimType.BOSS,1))||this._monModel.addAnimator(game.AnimType.BOSS,1)).load(e),t.play()):t&&t.clear()}});b8e.module.registerView(game.ME.CsGuild,e)}(),function(){var e;e=b8e.Enum({None:0,V_SELECT_BTN:-1,V_SHOW_VIEW:-1,V_HIDE_VIEW:-1,C2C_CHANGE_ACC_CON_OPEN:-1,C2V_CHANGE_ACC_CON_OPEN:-1}),b8e.RC("$$game","$$AccConCarnivalEvts",e)}(),function(){var e=game.OpenServerData.extends({});game.accConCarnivalData=game.accConCarnivalData||new e}(),function(){var e=game.Control.extends({lastModuleEnum:-1,lastId:-1,normalOpen:!0,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.ACC_CON_CARNIVAL_ALERT,game.SAE.HOME)},ipc:function(){this.evts={ConRecharge2:{C2C_CHANGE_ACC_CON:this.setServerData},ContinuousRecharge:{C2C_CHANGE_ACC_CON:this.setServerData},AccCost2:{C2C_CHANGE_ACC_COST2:this.setServerData}}},notify:function(e,t){var a=this.Evts;switch(e){case a.V_SELECT_BTN:this.selectBtn(t);break;case a.V_SHOW_VIEW:this.showView();break;case a.V_HIDE_VIEW:this.hideView()}},setServerData:function(e){var t=this;if(e&&e.data){var a=e.data,i=a.openServerType,n=a.type?a.type:0,s=a.isActive,r=a.sae?a.sae:null,o=a.param?a.param:null;game.accConCarnivalData.setServerInfo(i,n,s,r,o),t.dpt(t.Evts.C2C_CHANGE_ACC_CON_OPEN),t.send(t.Evts.C2V_CHANGE_ACC_CON_OPEN);var g=game.OpenServerClientCfg.getData(i,n);g&&game.accConCarnivalData.curIndex==g.id&&t.showView()}else b8e.warn("\u8bbe\u7f6e\u5f00\u670d\u6d3b\u52a8\u6ca1\u6709\u4f20\u5165\u6570\u636e!!!")},showView:function(){var e=this,t=game.accConCarnivalData,a=t.getOpenServerList();if(!a||a.length<1)game.module.hide(e.moduleEnum);else{var i;if(-1==e.lastId)i=t.getCanOpenId();else if(t.getIsOpenById(e.lastId))i=t.checkOpenById(e.lastId)?e.lastId:t.getCanOpenId();else i=t.getCanOpenId();e.lastId=-1,e.selectBtn(i,!0)}},hideView:function(){var e=this;0<e.lastModuleEnum&&game.module.hide(e.lastModuleEnum),game.accConCarnivalData.selectPage(0,e.lastId),e.lastModuleEnum=-1,e.selectId=0},selectBtn:function(e){var t=this,a=game.accConCarnivalData.getOpenServerById(e);if(a){var i=a.getCfg();if(i&&game.moduleOpen.checkOpenWithTips(i.moduleId)){var n=i.moduleId;n?t.lastId!=e&&(-1<t.lastModuleEnum&&game.module.hide(t.lastModuleEnum),game.accConCarnivalData.selectPage(e,t.lastId),game.module.showTab(n,t.moduleEnum),t.send(t.Evts.V_SELECT_BTN),t.lastId=e,t.lastModuleEnum=n):b8e.error("\u7c7b\u578b:"+i.openServerType+"\u6ca1\u6709\u5bf9\u5e94\u7684moduleEnum")}}}});b8e.module.registerControl(game.ME.AccConCarnival,e,game.AccConCarnivalEvts)}(),function(){var e;e=game.OpenServerBtnItem.extends({ctor:function(){this._super(1),this.setSize(86,96)},onClickBtn:function(){this.send(game.AccConCarnivalEvts.V_SELECT_BTN,this.data.id)}}),b8e.RC("$$game","$$AccConCarnivalItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(2)},init:function(){var e=this.btns=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.AccConCarnivalItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.AccConCarnival,e.layout.spacingX=15},notify:function(e){var t=this;switch(e){case t.Evts.V_SELECT_BTN:t.setTitleImg();break;case t.Evts.C2V_CHANGE_ACC_CON_OPEN:t.btnInfos=game.accConCarnivalData.getOpenServerList(),t.btns.setData(t.btnInfos)}},onShow:function(){var e=this;e.btnInfos=game.accConCarnivalData.getOpenServerList(),e.btns.setData(e.btnInfos),e.send(e.Evts.V_SHOW_VIEW),e.selectBtn()},onHide:function(){this.send(this.Evts.V_HIDE_VIEW),this.btns.scrollToLeft(0)},selectBtn:function(){if(game.accConCarnivalData.normalOpen);else{var e=game.accConCarnivalData.curIndex;game.accConCarnivalData.normalOpen=!0;var t=game.accConCarnivalData.getOpenServerList();if(!t||t.length<=0);else{for(var a,i=this,n=t.length,s=0;s<n;s++){if(t[s].id==e&&t[s].select){a=s}}if(a&&0!=a){i.btns.scrollToRight(96*a/2,50)}else i.btns.scrollToLeft(0)}}},setTitleImg:function(){var e=game.accConCarnivalData.getCurBtnInfo();if(e){var t,a=e.getCfg();if(a)t=a.titleImg&&""!=a.titleImg?game.ResCfg.getImgUrl(a.titleImg):game.ResCfg.getUrl(50),this.skin.titleImg.loadTexture(t)}},viewLeftBtn:function(){this.btns.scrollContainerLeft()},viewRightBtn:function(){this.btns.scrollContainerRight()},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.AccConCarnival,e)}(),function(){var e;e=game.Widget.extends({init:function(e){var t=this.skin;this._index>e&&(t.win1.scaleX=-1,t.win2.scaleX=-1,t.lose1.scaleX=-1,t.lose2.scaleX=-1)},show:function(e){this._vsData=e,this._super()},onShow:function(){this.updateView(this._vsData)},onHide:function(){},updateView:function(e){var t=this;if(e){var a=t.skin;if(a){a.win1.active=1==e.result,a.win2.active=2==e.result,a.lose1.active=2==e.result||3==e.result,a.lose2.active=1==e.result||3==e.result;var i=t.matchData.matchData,n=0==e.result&&i.top==t._vsType;a.bettingBtn1.active=n&&t.matchData.canBet,a.bettingBtn2.active=n&&!t.matchData.canBet,a.lookBtn.active=0<e.result}}},setEvtsClass:function(e){this.evtsClass=e},bettingBtn1:function(){this.send(this.evtsClass.C_BET_LOOK,this._vsData.id)},bettingBtn2:function(){this.matchData.isPrediction()?this.send(this.evtsClass.C_BET_LOOK,this._vsData.id):game.notice.show(7593)},lookBtn:function(){this.send(this.evtsClass.C_BATTLE_LOG_LOOK,this._vsData)}}),b8e.RC("$$game","$$MatchVsItem",e)}(),function(){var e;e=game.MatchVsItem.extends({ctor:function(e,t,a,i){this._index=e,this._vsType=t,this.matchData=a,this._super(i)},init:function(){this._headIcon=b8e.Sprite.get(),this._headIcon.setAnchor(.5,.5),this.skin.headBg.addChild(this._headIcon)},onHide:function(){this._headIcon&&this._headIcon.unloadTexture()},updateView:function(e){if(this._super(e),e){var t=this.skin;if(t&&(t.headBg.active=0<e.result,!(e.result<1))){var a=1==e.result?e.player1:e.player2;if(a&&this._headIcon){var i=game.ResCfg.getHead(a.isMale);this._headIcon.loadTexture(i)}}}}}),b8e.RC("$$game","$$MatchVsItem2",e)}(),function(){var e;e=game.MatchVsItem.extends({ctor:function(e,t,a,i){this._index=e,this._vsType=t,this.matchData=a,this._super(i)},init:function(){this._super(0)}}),b8e.RC("$$game","$$MatchVsItem4",e)}(),function(){var e;e=game.MatchVsItem.extends({ctor:function(e,t,a,i){this._index=e,this._vsType=t,this.matchData=a,this._super(i)},init:function(){this._super(1)},updateView:function(e){if(e){var t=this.skin;if(t){this._super(e);var a=this._index/2>>0;t.bettingBtn1.x=a?-15:15,t.bettingBtn2.x=a?-15:15,t.redPoint.x=a?-12:17,t.lookBtn.x=a?-10:10}}}}),b8e.RC("$$game","$$MatchVsItem8",e)}(),function(){var e;e=game.MatchVsItem.extends({ctor:function(e,t,a,i){this._index=e,this._vsType=t,this.matchData=a,this._super(i)},init:function(){this._super(3)},updateView:function(e){if(e){var t=this.skin;if(t){var a=this.matchData.isPrediction(),i=this.matchData.getBetRoleId();t.name1.string=e.player1.name+".S"+e.player1.zone,t.name2.string=e.player2.name+".S"+e.player2.zone,t.bettingFlag1.active=a&&e.player1.roleId==i,t.bettingFlag2.active=a&&e.player2.roleId==i,t.name1.setColor(0==e.result||1==e.result?game.Color.GREEN:game.Color.WHITE),t.name2.setColor(0==e.result||2==e.result?game.Color.GREEN:game.Color.WHITE),t.bg1_1.active=0==e.result||1==e.result,t.bg1_2.active=2==e.result||3==e.result,t.bg2_1.active=0==e.result||2==e.result,t.bg2_2.active=1==e.result||3==e.result,this._super(e)}}}}),b8e.RC("$$game","$$MatchVsItem16",e)}(),function(){var e;e=game.Widget.extends({_isInit:!1,ctor:function(e){this._super(e)},init:function(){var e=this;e._isInit=!0,e._vsItems16=[],e._vsItems8=[],e._vsItems4=[],e._vsItems2=[];var t=game.MatchVsType;e._initVsItems(e._vsItems16,"vsItem16_",t.VS16,game.MatchVsItem16,e.itemSkin+16),e._initVsItems(e._vsItems8,"vsItem8_",t.VS8,game.MatchVsItem8,e.itemSkin+8),e._initVsItems(e._vsItems4,"vsItem4_",t.VS4,game.MatchVsItem4,e.itemSkin+4),e._initVsItems(e._vsItems2,"vsItem2_",t.VS2,game.MatchVsItem2,e.itemSkin+2),e._bg=b8e.Sprite.get(),e._bg.setAnchor(.5,.5),e._bg.loadTexture(game.ResCfg.getImgUrl("worldChallenge/vs_bg",!0)),e.skin.bg.addChild(e._bg)},_initVsItems:function(e,t,a,i,n){for(var s=this,r=(s.skin,void 0),o=a/2,g=0;g<o;g++)(r=new i(g,a,s.data,n)).bindEnum=s.itemBindEnum,r.setEvtsClass(s.evtsClass),s.getComponent(t+g).addChild(r),e.push(r)},onShow:function(){this.updateView()},onHide:function(){var e=this,t=game.MatchVsType;e._vsItemShow(!1,e._vsItems16,t.VS16),e._vsItemShow(!1,e._vsItems8,t.VS8),e._vsItemShow(!1,e._vsItems4,t.VS4),e._vsItemShow(!1,e._vsItems2,t.VS2)},updateView:function(){var e=this;if(e._isInit){var t=e.skin,a=game.MatchVsType;e._vsItemShow(!0,e._vsItems16,a.VS16),e._vsItemShow(!0,e._vsItems8,a.VS8),e._vsItemShow(!0,e._vsItems4,a.VS4),e._vsItemShow(!0,e._vsItems2,a.VS2),t.tintLab.string=e.data.getScheduleStr(),t.tintTimeLab.string=e.data.getScheduleTimeStr();var i=e.data.getVsData(a.VS2);if(i&&i.length&&i[0].result){var n=i[0],s=1==n.result?n.player1:n.player2;t.nameLab.string=s.name+".S"+s.zone,t.nameLab.active=!0}else t.nameLab.active=!1}},_vsItemShow:function(e,t,a){if(t){var i;e&&(i=this.data.getVsData(a));for(var n=void 0,s=0,r=t.length;s<r;s++)n=t[s],e&&i&&i[s]?n.show(i[s]):n.hide()}},rankBtn:function(){game.module.show(this.rankEnum)},shopBtn:function(){this.send(this.evtsClass.C_OPEN_SHOP)},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$MatchVsView",e)}(),function(){var e;e=game.View.extends({_showModel:!0,ctor:function(e){this._super(e)},init:function(){},onShow:function(){var e=this.betCfg.getData(this.data.selectBetType).desc.split("|"),t=this.skin;t.awardLab1.string=e[0],t.awardLab2.string=e[1]},onHide:function(){}}),b8e.RC("$$game","$$MatchBetTips",e)}(),function(){var e;e=game.View.extends({matCostIcon1:null,matCostIcon2:null,matCostIcon3:null,_showModel:!0,ctor:function(e){this._super(e)},init:function(){var e=this;e._super();e.skin;e.matCostIcon1=b8e.Sprite.get(),e.matCostIcon1.setAnchor(.5,.5),e.matCostIcon1.addToParent(e.skin.gold1),e.matCostIcon1.setSize(40,40),e.matCostIcon2=b8e.Sprite.get(),e.matCostIcon2.setAnchor(.5,.5),e.matCostIcon2.addToParent(e.skin.gold2),e.matCostIcon2.setSize(40,40),e.matCostIcon3=b8e.Sprite.get(),e.matCostIcon3.setAnchor(.5,.5),e.matCostIcon3.addToParent(e.skin.gold3),e.matCostIcon3.setSize(40,40),e.roleData=game.BaseRoleData.get(game.RoleType.Hero,1),e.model=game.sceneRoleCreate.createUIRole(e.roleData),e.model.addToParent(e.skin.modelNode1),e.skin.modelNode1.setScale(.5,.5),e.roleData2=game.BaseRoleData.get(game.RoleType.Hero,1),e.model2=game.sceneRoleCreate.createUIRole(e.roleData2),e.model2.addToParent(e.skin.modelNode2),e.skin.modelNode2.setScale(.5,.5)},notify:function(e){switch(e){case this.Evts.V_BET_COMPLETE:case this.Evts.V_BET_SELECT:this.updateView()}},onShow:function(){this.updateView(),this.updateMode()},updateView:function(){var e=this,t=e.skin,a=e.data.betData,i=e.data.betIndex,n=(e.data.matchData,e.data.getIsBetMatch(e.data.betMatchId));if(a){t.check_select.x=1==i?t.roleNode1.x:t.roleNode2.x,t.role1Select.active=1==i,t.role2Select.active=2==i;var s=e.data.isPrediction();t.costNode.node.active=!s,t.bettingFlag2.node.active=s&&n,(t.stopTips.node.active=s)&&n&&(t.bettingFlag2.x=a.type==e.betType.LOW?t.betIcon1.x:a.type==e.betType.MIDDLE?t.betIcon2.x:t.betIcon3.x);var r=e.betCfg.getData(e.betType.LOW),o=e.betCfg.getData(e.betType.MIDDLE),g=e.betCfg.getData(e.betType.HIGH),u=r.betCost[0],l=game.ItemInfoCfg.getData(u.Id),c=game.ResCfg.getUrl(137,l.icon);e.matCostIcon1.loadTexture(c),t.costLab1.string=u.Num,u=o.betCost[0],l=game.ItemInfoCfg.getData(u.Id),c=game.ResCfg.getUrl(137,l.icon),e.matCostIcon2.loadTexture(c),t.costLab2.string=u.Num,u=g.betCost[0],l=game.ItemInfoCfg.getData(u.Id),c=game.ResCfg.getUrl(137,l.icon),e.matCostIcon3.loadTexture(c),t.costLab3.string=u.Num}},updateMode:function(){var e=this,t=e.skin,a=e.data.betData;t.lvLab1.string="LV."+a.player1.level,t.nameLab1.string=a.player1.name+".S"+a.player1.zone,t.lab_power1.string=a.player1.power,t.lvLab2.string="LV."+a.player2.level,t.nameLab2.string=a.player2.name+".S"+a.player2.zone,t.lab_power2.string=a.player2.power,e.updatePlayer(a.player1,e.roleData,e.model),e.updatePlayer(a.player2,e.roleData2,e.model2)},updatePlayer:function(e,t,a){t.setMale(e.isMale);var i=t.heroModel;i.clear(),i.setMale(e.isMale),i.setBody(game.RoleType.Hero,e.isMale?1001:1002),i.setSurface(e.surface),game.AvatarUtil.updateUIModel(a),a.transition(game.RoleStateType.ACTION_IDLE)},onHide:function(){}}),b8e.RC("$$game","$$MatchBetView",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(e){this._super(e),this.setSize(540,68)},setData:function(){var e=this.skin,t=this.data;e.roundLab.string=game.Lang.get(7592,game.CCommonUtil.replaceChineseNum(t.round)),e.nameLab.string=1==t.result?t.player1.name+".S"+t.player1.zone:t.player2.name+".S"+t.player2.zone},lookBtn:function(){}}),b8e.RC("$$game","$$MatchLogItem",e)}(),function(){var e;e=game.View.extends({_showModel:!0,ctor:function(e){this._super(e)},onShow:function(){var e=this,t=e.data.lookMatchInfo;if(t){var a=e.data.getBattleLogList(),i=e.skin;i.nameLab1.string=t.player1.name+".S"+t.player1.zone,i.nameLab2.string=t.player2.name+".S"+t.player2.zone,i.scoreLab.string=e.getBattleScoreStr(a),e.battleList.setData(a)}},getBattleScoreStr:function(e){for(var t=0,a=0,i=0,n=e.length;i<n;i++)1==e[i].result?t++:a++;return t+":"+a},onHide:function(){}}),b8e.RC("$$game","$$MatchLogView",e)}(),function(){var e;e=b8e.Enum({None:0,C_GET_DATA:b8e.enc(),V_UPDATE_MATCH:b8e.enc(),C_UPDATE_MATCH:b8e.enc(),C_APPLY:b8e.enc(),C_BET_LOOK:b8e.enc(),V_BET_COMPLETE:b8e.enc(),C_BET_COMPLETE:b8e.enc(),V_BET_SELECT:b8e.enc(),C_CHECK_BTTALE_LOG:b8e.enc(),C_SHOW_WORLD_CHALLENGE:b8e.enc(),C_BET_RESP:b8e.enc(),C_GET_BET_RESP:b8e.enc(),C_BATTLE_LOG_RESP:b8e.enc(),C_BATTLE_LOG_LOOK:b8e.enc()}),b8e.RC("$$game","$$WorldChallengeEvts",e)}(),function(){var e;e=b8e.Enum({None:0,LOW:1,MIDDLE:2,HIGH:3}),b8e.RC("$$game","$$BetType",e)}(),function(){var e;e=b8e.Enum({None:0,WORLD:1,ALL_SERVER:2,TEAMLEAGUE:3,CS_OVERLORD:4}),b8e.RC("$$game","$$MatchType",e)}(),function(){var e;e=b8e.Enum({VS2:2,VS4:4,VS8:8,VS16:16}),b8e.RC("$$game","$$MatchVsType",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({round:0,player1:null,player2:null,result:0,battleId:"",setData:function(e){this.round=e.round,this.result=e.result,this.battleId=e.battleId},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.round=0,e.player1=null,e.player2=null,e.result=0,e.battleId=""}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$BattleLogInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,top:0,player1:null,player2:null,result:0,battleId:"",logs:null,setData:function(e){var t=this;t.id=e.id,t.top=e.top,t.player1=e.player1,t.player2=e.player2,t.result=e.result,t.battleId=e.battleId,t.logs=e.logs},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.id=0,e.top=0,e.player1=null,e.player2=null,e.result=0,e.battleId="",e.logs=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MatchInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({roleId:0,name:"",isMale:0,level:0,zone:0,score:0,power:0,fashion:0,fosters:null,rank:0,setData:function(e){var t=this;t.roleId=e.roleId,t.name=e.name,t.isMale=e.isMale,t.level=e.level,t.zone=e.zone,t.score=e.score,t.power=e.power,t.fashion=e.fashion,t.fosters=e.fosters},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.roleId=0,e.isMale=0,e.level=0,e.zone=0,e.score=0,e.power=0,e.fashion=0,e.fosters=null,e.name="",e.rank=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MatchPlayer",t)}(),function(){var e;e=b8e.Object.extends({startTime:0,endTime:0,timeArr:null}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$WorldChallengeTime",e)}(),function(){var e=b8e.Object.extends({applyTime:null,eliminationTime:null,top16Time:null,top8Time:null,top4Time:null,top2Time:null,matchData:null,isApply:!1,eliminationMatchList:null,eliminationRankList:null,myPlayerInfo:null,battleLogList:null,betData:null,betIndex:0,betMatchId:0,selectBetType:null,lookMatchInfo:null,canBet:!1,isShowView:!1,ctor:function(){var e=this;e._super(),e.applyTime=new game.WorldChallengeTime,e.eliminationTime=new game.WorldChallengeTime,e.top16Time=new game.WorldChallengeTime,e.top8Time=new game.WorldChallengeTime,e.top4Time=new game.WorldChallengeTime,e.top2Time=new game.WorldChallengeTime,e.benBetTime=new game.WorldChallengeTime,e.eliminationMatchList=[],e.eliminationRankList=[],e.vsData16=[],e.vsData8=[],e.vsData4=[],e.vsData2=[],e.battleLogList=[]},setData:function(e){this.matchData=e,this.isApply=!(!e.top||999==e.top)||e.isSignUp,this.splitVsData()},initOpenTime:function(){var e=this;e.setTimes("applyTimes",e.applyTime),e.setTimes("eliminationTimes",e.eliminationTime),e.setTimes("top16Times",e.top16Time),e.setTimes("top8Times",e.top8Time),e.setTimes("top4Times",e.top4Time),e.setTimes("top2Times",e.top2Time);var t=e.getTimeArr("banBetTimes"),a=t[0].split(":"),i=+a[0],n=+a[1],s=game.SysTime.curTime,r=b8e.TimeUtil.getTodayTime(s);e.benBetTime.startTime=r+b8e.TimeUtil.HOUR_MICRO_SECONDS*i+b8e.TimeUtil.MINUTE_MICRO_SECONDS*n;var o=t[1].split(":"),g=+o[0],u=+o[1];e.benBetTime.endTime=r+b8e.TimeUtil.HOUR_MICRO_SECONDS*g+b8e.TimeUtil.MINUTE_MICRO_SECONDS*u},setTimes:function(e,t){var a=this.getTimeArr(e);if(a){var i=(t.timeArr=a)[0],n=i.split("|"),s=n[1].split(":"),r=+s[0],o=+s[1],g=game.SysTime.curTime,u=0!=+n[0]?+n[0]:7,l=0!=b8e.TimeUtil.getDay(g)?b8e.TimeUtil.getDay(g):7,c=u-l>>0,h=b8e.TimeUtil.getTodayTime(g);t.startTime=h+b8e.TimeUtil.HOUR_MICRO_SECONDS*r+b8e.TimeUtil.MINUTE_MICRO_SECONDS*o+c*b8e.TimeUtil.DAY_MICRO_SECONDS;var m=(n=(i=a[1]).split("|"))[1].split(":"),d=+m[0],f=+m[1];return g=game.SysTime.curTime,c=(u=0!=+n[0]?+n[0]:7)-(l=0!=b8e.TimeUtil.getDay(g)?b8e.TimeUtil.getDay(g):7)>>0,h=b8e.TimeUtil.getTodayTime(g),t.endTime=h+b8e.TimeUtil.HOUR_MICRO_SECONDS*d+b8e.TimeUtil.MINUTE_MICRO_SECONDS*f+c*b8e.TimeUtil.DAY_MICRO_SECONDS,t}},getTimeArr:function(e){var t=game.MatchMiscCfg.getData(e);return!(!t||""==t.value)&&t.value.split("-")},getIsApplyIng:function(){var e=this,t=game.SysTime.curTime;return!(!e.applyTime.startTime||!e.applyTime.endTime)&&(e.applyTime.startTime<=t&&e.applyTime.endTime>t||e.applyTime.startTime<=t&&e.eliminationTime.startTime>t)},getIsEliminationIng:function(){var e=this;game.SysTime.curTime;return!!e.matchData&&!(0!=e.matchData.top&&999!=e.matchData.top||!e.matchData.players||!e.matchData.players.length)},getIsTopIng:function(){var e=this;game.SysTime.curTime;return!!e.matchData&&!!(0<e.matchData.top&&999!=e.matchData.top&&e.matchData.matches&&e.matchData.matches.length)},getEliminationMatchList:function(){var e,t=this;if(t.clearList(t.eliminationMatchList),!t.matchData||!t.matchData.matches)return t.eliminationMatchList;for(var a=t.matchData.matches,i=0,n=a.length;i<n;i++)(e=game.MatchInfo.get()).setData(a[i]),t.eliminationMatchList.push(e);return t.eliminationMatchList.sort(t.sortMatchList),t.eliminationMatchList},sortMatchList:function(e,t){return e.top-t.top},getEliminationRankList:function(){var e,t=this;if(t.myPlayerInfo=null,t.clearList(t.eliminationRankList),!t.matchData||!t.matchData.players)return t.eliminationRankList;for(var a=t.matchData.players,i=0,n=a.length;i<n;i++)(e=game.MatchPlayer.get()).setData(a[i]),t.eliminationRankList.push(e);for(t.eliminationRankList.sort(t.sortRankList),i=0,n=t.eliminationRankList.length;i<n;i++)t.eliminationRankList[i].rank=i+1,t.eliminationRankList[i].roleId==game.mainRoleData.roleId&&(t.myPlayerInfo=t.eliminationRankList[i]);return t.eliminationRankList},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},sortRankList:function(e,t){return t.score-e.score},getGroupLevel:function(e){return game.Lang.get(6051+e)},getVsData:function(e){var t=game.MatchVsType;switch(e){case t.VS2:return this.vsData2;case t.VS4:return this.vsData4;case t.VS8:return this.vsData8;case t.VS16:return this.vsData16;default:return null}},splitVsData:function(){var e=this;e.vsData2.length=0,e.vsData4.length=0,e.vsData8.length=0,e.vsData16.length=0;for(var t=game.MatchVsType,a=e.matchData.matches,i=void 0,n=0,s=a.length;n<s;n++)switch((i=a[n]).top){case t.VS2:e.vsData2.push(i);break;case t.VS4:e.vsData4.push(i);break;case t.VS8:e.vsData8.push(i);break;case t.VS16:e.vsData16.push(i)}e.vsData4.length/2==e.vsData2.length&&e.resetResult(e.vsData2,e.vsData4),e.vsData8.length/2==e.vsData4.length&&e.resetResult(e.vsData4,e.vsData8),e.vsData16.length/2==e.vsData8.length&&e.resetResult(e.vsData8,e.vsData16)},resetResult:function(e,t){if(!(!e||e.length<1||!t||t.length<1))for(var a=void 0,i=0,n=e.length;i<n;i++)1==(a=e[i]).result?t[2*i+1].result=3:2==a.result?t[2*i].result=3:3==a.result&&(t[2*i].result=3,t[2*i+1].result=3)},getBattleLogList:function(){var e,t=this;if(t.clearList(t.battleLogList),!t.lookMatchInfo||!t.lookMatchInfo.logs)return t.battleLogList;for(var a=t.lookMatchInfo.logs,i=0,n=a.length;i<n;i++)(e=game.BattleLogInfo.get()).setData(a[i]),e.player1=t.lookMatchInfo.player1,e.player2=t.lookMatchInfo.player2,t.battleLogList.push(e);return t.battleLogList.sort(t.sortLogList),t.battleLogList},sortLogList:function(e,t){return e.round-t.round},checkOpenApply:function(){if(!game.moduleOpen.checkOpen(game.ME.WorldChallenge)||!this.applyTime||this.isApply)return!1;var e=game.SysTime.curTime;return this.applyTime.startTime<=e&&this.applyTime.endTime>e},checkOpenElimination:function(){var e=this;if(!e.eliminationTime||!e.isApply||!e.matchData||999==e.matchData.top)return!1;var t=game.SysTime.curTime;return!!(e.eliminationTime.startTime<=t&&e.eliminationTime.endTime>t&&0==e.matchData.top&&e.matchData.players&&e.matchData.players.length)},checkCanBet:function(){var e=this;return!(!e.matchData||!e.matchData.top||e.isPrediction()||!e.matchData.matches.length)&&e.getTopCanBet(e.matchData.top)},getTopCanBet:function(){var e=this.getTopTime(this.matchData.top);if(!e)return!1;var t=game.SysTime.curTime;return e.startTime>t&&!(this.benBetTime.startTime<=t&&this.benBetTime.endTime>t)},getScheduleStr:function(){if(!this.matchData||!this.matchData.top)return"";var e="";switch(this.matchData.top){case game.MatchVsType.VS16:e=game.Lang.get(6098);break;case game.MatchVsType.VS8:e=game.Lang.get(6099);break;case game.MatchVsType.VS4:e=game.Lang.get(6200);break;case game.MatchVsType.VS2:e=game.Lang.get(6201)}return e},getScheduleTimeStr:function(){if(!this.matchData||!this.matchData.top)return"";var e=this.getTopTime(this.matchData.top),t=(game.SysTime.curTime,0!=b8e.TimeUtil.getDay(e.startTime)?b8e.TimeUtil.getDay(e.startTime):7),a=7==t?game.Lang.get(9386):game.CCommonUtil.replaceChineseNum(t),i=e.timeArr[0].split("|");return game.Lang.get(6096,a,i[1])},getTopTime:function(e){var t;switch(e){case game.MatchVsType.VS16:t=this.top16Time;break;case game.MatchVsType.VS8:t=this.top8Time;break;case game.MatchVsType.VS4:t=this.top4Time;break;case game.MatchVsType.VS2:t=this.top2Time}return t},isPrediction:function(){return!!(this.matchData&&this.matchData.matches.length&&this.matchData.prediction&&this.matchData.prediction.matchId)},getBetRoleId:function(){var e=this,t=0;if(e.matchData&&e.isPrediction()){for(var a,i=e.matchData.prediction.matchId,n=e.matchData.prediction.win,s=e.matchData.matches,r=0,o=s.length;r<o;r++)(a=s[r]).id==i&&(t=1==n?a.player1.roleId:a.player2.roleId);return t}},getIsBetMatch:function(e){return!!this.isPrediction()&&this.matchData.prediction.matchId==e}});game.worldChallengeData=game.worldChallengeData||new e}(),function(){var e=game.Control.extends({init:function(){this.alertOptions={lang:6071,langArgs:null,okcb:this.onClickGameAlert,thisArg:this,args:null}},ipc:function(){var e=this;e.evts={WorldChallenge:{C_BET_LOOK:e.lookBet},AllServerWarBet:{C_GET_BET_REQ:e.getBetReq,C_BET_REQ:e.betReq}},e.handels={MatchPredictionResp:e.matchPredictionResp,MatchPredictionDataResp:e.matchPredictionDataResp}},lookBet:function(e){game.worldChallengeData.betMatchId=e,this.sender.MatchPredictionDataReq(e,game.MatchType.WORLD)},notify:function(e,t){switch(e){case this.Evts.C_BET_LOOK:this.lookBet(t);break;case this.Evts.C_BATTLE_LOG_LOOK:game.worldChallengeData.lookMatchInfo=t,game.module.show(game.ME.WorldChallengeLog)}},getBetReq:function(e){var t=e.data;this.sender.MatchPredictionDataReq(t.matchId,t.type)},betReq:function(e){var t=e.data;this.sender.MatchPredictionReq(t.func,t.type,t.matchId,t.roleId)},matchPredictionResp:function(e){var t=this,a=e.readProtobuf(game.pb.MatchPredictionResponse);if(0<a.code){game.notice.noticeError(a.code)}else{if(a.func==game.MatchType.WORLD&&null!=game.worldChallengeData.betData){game.worldChallengeData.betData.roleId=a.roleId,game.worldChallengeData.betData.type=a.type;var i=game.worldChallengeData.betData.player1.roleId==a.roleId?1:2;game.worldChallengeData.matchData.prediction={matchId:game.worldChallengeData.betMatchId,win:i},t.dpt(t.Evts.C_BET_COMPLETE),t.send(t.Evts.V_BET_COMPLETE)}a.func==game.MatchType.ALL_SERVER&&t.dpt(t.Evts.C_BET_RESP,a)}},matchPredictionDataResp:function(e){var t=e.readProtobuf(game.pb.MatchPredictionDataResponse);if(0<t.code){game.notice.noticeError(t.code)}else t.func==game.MatchType.ALL_SERVER&&this.dpt(this.Evts.C_GET_BET_RESP,t),t.func==game.MatchType.WORLD&&(game.worldChallengeData.betData=t,game.worldChallengeData.betIndex=t.win?t.win:1,game.module.show(game.ME.WorldChallengeBet))},roleNode1:function(){null!=game.worldChallengeData.betData&&(0==game.worldChallengeData.betData.type?(game.worldChallengeData.betIndex=1,this.send(this.Evts.V_BET_SELECT,1)):game.notice.show(9385))},roleNode2:function(){null!=game.worldChallengeData.betData&&(0==game.worldChallengeData.betData.type?(game.worldChallengeData.betIndex=2,this.send(this.Evts.V_BET_SELECT,2)):game.notice.show(9385))},betIcon1:function(){game.worldChallengeData.selectBetType=game.BetType.LOW,this.showTips()},betIcon2:function(){game.worldChallengeData.selectBetType=game.BetType.MIDDLE,this.showTips()},betIcon3:function(){game.worldChallengeData.selectBetType=game.BetType.HIGH,this.showTips()},showTips:function(){game.module.show(game.ME.WorldChallengeBetTips)},betBtn1:function(){this.matchPredictionReq(game.BetType.LOW)},betBtn2:function(){this.matchPredictionReq(game.BetType.MIDDLE)},betBtn3:function(){this.matchPredictionReq(game.BetType.HIGH)},matchPredictionReq:function(e){if(null!=game.worldChallengeData.betData){var t=game.worldChallengeData.betData,a=game.worldChallengeData.betMatchId,i=game.MatchType.WORLD,n=1==game.worldChallengeData.betIndex?t.player1.roleId:t.player2.roleId,s=game.BetsCfg.getData(e).betCost[0];if(s){var r=game.ItemInfoCfg.getData(s.Id);this.alertOptions.langArgs=[s.Num+r.name],this.alertOptions.args=[i,e,a,n],game.alert.showTwo(this.alertOptions)}}},onClickGameAlert:function(e,t,a,i){this.sender.MatchPredictionReq(e,t,a,i)}}),t=[game.ME.WorldChallengeBetTips],a=game.Sender.extends({ipc:function(){this.msg={MatchPredictionDataReq:this.matchPredictionDataReq,MatchPredictionReq:this.matchPredictionReq}},matchPredictionDataReq:function(e,t){var a=game.pb.MatchPredictionDataRequest;a.matchId=e,a.func=t,this.write(a)},matchPredictionReq:function(e,t,a,i){var n=game.pb.MatchPredictionRequest;n.func=e,n.type=t,n.matchId=a,n.roleId=i,this.write(n)}});b8e.module.registerControl(game.ME.WorldChallengeBet,e,game.WorldChallengeEvts,a,t)}(),function(){var e=game.Control.extends({type:0,init:function(){},ipc:function(){var e=this;e.evts={AllServerWarLog:{C_BATTLE_LOG_REQ:e.battleLogReq},TeamLeagueMatchLog:{C_BATTLE_LOG_REQ:e.teamLeagueBattleLogReq},TeamLeagueMyLog:{C_BATTLE_LOG_REQ:e.teamLeagueBattleLogReq},TeamLeagueMatch:{C_BATTLE_LOG_REQ:e.teamLeagueBattleLogReq},CsOverlordMatchLog:{C_BATTLE_LOG_REQ:e.csOverlordLogReq}},e.handels={ReplayResp:e.replayResp}},csOverlordLogReq:function(e){var t=e.data;this.type=game.MatchType.CS_OVERLORD,this.rePlayReq(t)},teamLeagueBattleLogReq:function(e){var t=e.data;this.type=game.MatchType.TEAMLEAGUE,this.rePlayReq(t)},battleLogReq:function(e){var t=e.data;this.type=game.MatchType.ALL_SERVER,this.rePlayReq(t)},rePlayReq:function(e){game.sceneData.isGuildMap()||this.sender.ReplayReq(e)},replayResp:function(e){var t=e.readProtobuf(game.pb.ReplayResponse);if(0<t.code){game.notice.noticeError(t.code)}else if(this.type==game.MatchType.WORLD){var a={type:game.InstanceType.WORLD_CHALLENGE,exp:0};game.playBack.play(t.battlelog,a),game.module.hide(game.ME.WorldChallengeLog)}else this.dpt(this.Evts.C_BATTLE_LOG_RESP,{log:t,type:this.type})},notify:function(e,t){switch(e){case this.Evts.C_CHECK_BTTALE_LOG:if(!t)return;if(this.type=game.MatchType.WORLD,game.sceneData.isGuildMap())return;this.sender.ReplayReq(t)}}}),t=game.Sender.extends({ipc:function(){this.msg={ReplayReq:this.rerplayReq}},rerplayReq:function(e){var t=game.pb.ReplayRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.WorldChallengeLog,e,game.WorldChallengeEvts,t)}(),function(){var e=game.Control.extends({intervalTime:0,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.WORLD_CHALLENGE,game.SAE.ARENA)},ipc:function(){var e=this;e.evts={MainRole:{C_RESET_DAILY:e.resetDaily},WorldChallengeBet:{C_BET_COMPLETE:e.betComplete},AllServerWar:{C_GET_MATCH_REQ:e.matchReq}},e.handels={MatchDataResp:e.matchDataResp,MatchSignUpResp:e.matchSignUpResp}},triggerOpen:function(e){e==this.moduleEnum&&(game.worldChallengeData.initOpenTime(),this.sender.MatchDataReq(game.MatchType.WORLD),this.checkStartTime())},resetDaily:function(){game.moduleOpen.checkOpen(game.ME.WorldChallenge)&&(game.worldChallengeData.initOpenTime(),this.sender.MatchDataReq(game.MatchType.WORLD))},betComplete:function(){this.changeBetState(),this.send(this.Evts.V_UPDATE_MATCH)},matchReq:function(e){var t=e.data;this.sender.MatchDataReq(t.matchType,t.type,t.group)},notify:function(e){switch(e){case this.Evts.C_APPLY:this.sender.MatchSignUpReq();break;case this.Evts.C_GET_DATA:this.sender.MatchDataReq(game.MatchType.WORLD)}},matchSignUpResp:function(e){var t=e.readProtobuf(game.pb.MatchSignUpResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.worldChallengeData.isApply=!0,game.worldChallengeData.matchData.isSignUp=!0,this.send(this.Evts.V_UPDATE_MATCH),game.notice.show(9447)},matchDataResp:function(e){var t=this,a=e.readProtobuf(game.pb.MatchDataResponse);if(0<a.code){game.notice.noticeError(a.code)}else game.MatchType.WORLD==a.func&&(game.worldChallengeData.setData(a),t.changeBetState(),t.send(t.Evts.V_UPDATE_MATCH)),t.dpt(t.Evts.C_UPDATE_MATCH,a)},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.WORLD_SHOP)},refreshBtn:function(){this.dpt(this.Evts.C_SHOW_WORLD_CHALLENGE)},checkStartTime:function(){var e=this;e.taskTimer||(e.intervalTime=0,e.taskTimer=b8e.Timer.add(e,e.updateTime,1e3),e.taskTimer.start())},updateTime:function(){var e=this,t=game.worldChallengeData,a=t.checkOpenApply();(a&&!game.mainCenterData.worldChallenge||!a&&game.mainCenterData.worldChallenge)&&e.refreshBtn(),t.isShowView&&t.checkOpenElimination()&&(e.intervalTime++,10==e.intervalTime&&(e.sender.MatchDataReq(game.MatchType.WORLD),e.intervalTime=0));var i=game.worldChallengeData.matchData;i&&i.top&&t.checkCanBet()!=t.canBet&&(e.changeBetState(),e.send(e.Evts.V_UPDATE_MATCH))},changeBetState:function(){var e=game.worldChallengeData.checkCanBet();this.spotAlert.alert=e,game.worldChallengeData.canBet=e}}),t=game.Sender.extends({ipc:function(){this.msg={MatchDataReq:this.matchDataReq,MatchSignUpReq:null}},matchDataReq:function(e,t,a){var i=1<arguments.length&&void 0!==t?t:0,n=2<arguments.length&&void 0!==a?a:0,s=game.pb.MatchDataRequest;s.func=e,s.type=i,s.group=n,this.write(s)}});b8e.module.registerControl(game.ME.WorldChallenge,e,game.WorldChallengeEvts,t)}(),function(){var e;e=game.Widget.extends({isInit:!1,ctor:function(){this._super(36)},init:function(){this.isInit=!0},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){if(this.isInit){var e=this.skin;e.descLab.string=game.Lang.get(6051);var t=game.worldChallengeData.applyTime,a=game.SysTime.curTime,i=t.startTime<=a&&t.endTime>a,n=game.worldChallengeData.matchData&&game.worldChallengeData.matchData.isSignUp;e.applyGrayBtn.node.active=!i||n,e.applyBtn.node.active=i&&!n,e.baoming.string=n?game.Lang.get(9448):game.Lang.get(9449)}},applyBtn:function(){this.send(game.WorldChallengeEvts.C_APPLY)},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$WorldChallengeApplyView",e)}(),function(){var e;e=game.MatchLogItem.extends({ctor:function(){this._super(1113)},lookBtn:function(){this.send(game.WorldChallengeEvts.C_CHECK_BTTALE_LOG,this.data.battleId)}}),b8e.RC("$$game","$$WorldChallengeBattleLogItem",e)}(),function(){var e=game.MatchBetTips.extends({ctor:function(){this._super(37)},init:function(){this.betCfg=game.BetsCfg,this.data=game.worldChallengeData,this._super()}});b8e.module.registerView(game.ME.WorldChallengeBetTips,e)}(),function(){var e=game.MatchBetView.extends({ctor:function(){this._super(38)},init:function(){this.data=game.worldChallengeData,this.betType=game.BetType,this.betCfg=game.BetsCfg,this._super()}});b8e.module.registerView(game.ME.WorldChallengeBet,e)}(),function(){var e=game.MatchLogView.extends({ctor:function(){this._super(39)},init:function(){this.skin;var e=this.battleList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.WorldChallengeBattleLogItem,e.bindEnum=game.ME.WorldChallengeLog,e.addToParent(this.skin.list),e.layout.spacingY=5,this.data=game.worldChallengeData}});b8e.module.registerView(game.ME.WorldChallengeLog,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1114),this.setSize(604,64)},setData:function(){var e=this.skin,t=this.data,a=game.mainRoleData.roleId,i=a==t.player1.roleId?1:2,n=a==t.player1.roleId?t.player1:t.player2,s=a!=t.player1.roleId?t.player1:t.player2,r=i==t.result;e.roundLab.string=game.Lang.get(7592,game.CCommonUtil.replaceChineseNum(t.top)),e.nameLab1.string=n.name+".S"+n.zone,e.nameLab2.string=s.name+".S"+s.zone,e.lose1.node.active=0!=t.result&&!r,e.win1.node.active=0!=t.result&&r,e.lose2.node.active=0!=t.result&&r,e.win2.node.active=0!=t.result&&!r}}),b8e.RC("$$game","$$WorldChallengeMyLogItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1115),this.setSize(604,64)},setData:function(){var e=this.skin,t=this.data;e.rankIcon1.active=1==t.rank,e.rankIcon2.active=2==t.rank,e.rankIcon3.active=3==t.rank,e.rankIcon4.active=3<t.rank,e.powerLab.string=t.score,e.rankLab.string=t.rank,e.nameLab.string=t.name+".S"+t.zone}}),b8e.RC("$$game","$$WorldChallengeRankItem",e)}(),function(){var e;e=game.Widget.extends({isInit:!1,ctor:function(){this._super(40)},init:function(){var e=this,t=(e.skin,e.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical));t.itemRender=game.WorldChallengeRankItem,t.addToParent(e.skin.rankList),t.layout.spacingY=5;var a=e.logList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.WorldChallengeMyLogItem,a.addToParent(e.skin.myList),a.layout.spacingY=5,e.isInit=!0},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){if(this.isInit){var e=this.skin,t=game.worldChallengeData,a=t.matchData,i=t.getEliminationRankList(),n=t.getEliminationMatchList();e.titleLab.string=t.getGroupLevel(a.type),t.myPlayerInfo?(e.myRankLab.string=t.myPlayerInfo.rank,e.myIntegralLab.string=t.myPlayerInfo.score):(e.myRankLab.string=game.Lang.get(9387),e.myIntegralLab.string="0"),this.rankList.setData(i),this.logList.setData(n)}},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$WorldChallengeRankView",e)}(),function(){var e=game.View.extends({applyView:null,rankView:null,topView:null,curView:null,ctor:function(){this._super(41)},init:function(){this.skin.title2.node.active=!1},notify:function(e){switch(e){case this.Evts.V_UPDATE_MATCH:this.updateView()}},onShow:function(){game.worldChallengeData.isShowView=!0,this.send(this.Evts.C_GET_DATA),this.updateView()},onHide:function(){game.worldChallengeData.isShowView=!1},updateView:function(){this.showView(),this.curView&&this.curView.updateView()},showView:function(){var e=game.SysTime.curTime,t=(b8e.TimeUtil.formatTimestamp(e),this),a=t.skin;a.contianer.removeAllChildren(),t.curView=null,game.worldChallengeData.getIsApplyIng()||!game.worldChallengeData.isApply?(t.applyView||(t.applyView=new game.WorldChallengeApplyView),a.shopBtn.active=!0,t.curView=t.applyView):game.worldChallengeData.getIsEliminationIng()?(t.rankView||(t.rankView=new game.WorldChallengeRankView),a.shopBtn.active=!1,t.curView=t.rankView):game.worldChallengeData.getIsTopIng()?(t.vsView||(t.vsView=new game.WorldChallengeVsView),a.shopBtn.active=!0,t.curView=t.vsView):(t.applyView||(t.applyView=new game.WorldChallengeApplyView),a.shopBtn.active=!0,t.curView=t.applyView),t.curView&&(t.curView.bindEnum=game.ME.WorldChallenge,a.contianer.addChild(t.curView))},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.WorldChallenge,e)}(),function(){var e;e=game.MatchVsView.extends({ctor:function(){this._super(42)},init:function(){var e=this;e.data=game.worldChallengeData,e.evtsClass=game.WorldChallengeEvts,e.itemBindEnum=game.ME.WorldChallengeBet,e.itemSkin="match/MatchVsItem",e._super()},updateView:function(){var e=this;e._super(),e._isInit&&(e.skin.titleLab.string=e.data.getGroupLevel(e.data.matchData.type))},downBtn:function(){}}),b8e.RC("$$game","$$WorldChallengeVsView",e)}(),function(){var e;e=b8e.GameConfig.extends({ctor:function(){this._super()},onInited:function(){this.obj={id:0},this.obj1={serverStart:0},this.obj2={group:0}},getListByDay:function(e){var t=this,a=t.getKeys("serverStart");if(!a||a.length<1)return null;for(var i=!1,n=void 0,s=void 0,r=a.length,o=0;o<r;o++)if(s=a[o],t.obj1.serverStart=s,(n=t.getData(t.obj1,!1,!0,!1))&&n.serverStart<=e&&n.serverEnd>e){i=!0;break}return i&&n?(t.obj1.serverStart=n.serverStart,t.getData(t.obj1,!0)):null},getDataByDay:function(e){var t=this.getListByDay(e);return!t||t.length<1?null:t[0]},getDataById:function(e){return this.obj.id=e,this.getData(this.obj)},getDataByGroup:function(e){return this.obj2.group=e,this.getData(this.obj2,!1,!0,!1)}}),b8e.RC("$$game","$$GrowthPrizeCfg",e)}(),function(){var e;e=b8e.Enum({None:0,V_SELECT_BTN:-1,V_SHOW_VIEW:-1,V_HIDE_VIEW:-1,C2V_UPDATE_BTNS:-1,V2C_GET_PRIZE:-1,C2C_RECHARGE:-1,C2V_UPDATE_LIST:-1,C2V_UPDATE_BUY_GIFT:-1,C2C_CHANGE_GROW_GIFT_OPEN:-1,C2V_CHANGE_GROW_GIFT_OPEN:-1,V2C_SHOW_PAGE:-1}),b8e.RC("$$game","$$GrowGiftEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,isGet:!1,canGet:!1,day:0,group:0,bought:!1,ctor:function(){this._super(),this.award=[]},setData:function(e){var t=this;t.cfg=e,t.id=e.id,t.day=e.day,t.group=e.group,t.title=e.title,t.getPrizeList(!0)},setComplete:function(e){if(this.cfg){var t=e-this.cfg.serverStart+1;this.canGet=t>=this.day}},getPrizeList:function(e){var t=0<arguments.length&&void 0!==e&&e,a=this;if(a.award&&!t)return a.award;for(var i=a.cfg.award,n=i.length,s=void 0,r=0;r<n;r++)s=i[r],a.award[r]=game.ItemUtil.createBaseItemInfo(s.Id,s.Num,a.award[r]);return a.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GrowGiftInfo",e)}(),function(){var e=game.OpenServerData.extends({bought:!1,curGroup:0,ctor:function(){this._super()},initData:function(e,t){e=e||[],t=t||[],this.growthGroups=e,this.growthCollected=t,this.initInfoList()},initInfoList:function(){var e=this,t=game.miscData.openServerDay,a=game.GrowthPrizeCfg.getListByDay(t);if(e.infoList?e.infoList.length=0:e.infoList=[],a&&!(a.length<1)){e.curGroup=a[0].group,e.curCfg=a[0];var i=a[0].serverEnd;e.endTime=game.miscData.openServerTime+(i-1)*b8e.TimeUtil.DAY_MICRO_SECONDS,e.bought=-1<e.growthGroups.indexOf(e.curGroup),e.infoPool||(e.infoPool=[]);for(var n=a.length,s=void 0,r=void 0,o=0;o<n;o++)r=a[o],e.infoPool[o]||(e.infoPool[o]=new game.GrowGiftInfo),s=e.infoPool[o],(e.infoList[o]=s).setData(r)}},getInfoList:function(){return this.infoList},checkOpen:function(){return this.infoList&&0<this.infoList.length},resetDaily:function(){this.initInfoList()},setBuyGift:function(e){var t=this;t.growthGroups.indexOf(e)<0&&t.growthGroups.push(e),t.bought=-1<t.growthGroups.indexOf(t.curGroup)},checkAlert:function(){var e=this;if(!e.infoList||e.infoList.length<1)return!1;for(var t=!1,a=void 0,i=e.growthCollected,n=e.growthGroups,s=game.miscData.openServerDay,r=e.infoList.length,o=0;o<r;o++)(a=e.infoList[o]).setComplete(s),a.bought=n&&-1<n.indexOf(a.group),a.isGet=i&&-1<i.indexOf(a.id),a.bought&&a.canGet&&!a.isGet&&(t=!0);return e.infoList.sort(e.onSort1),t},getPrize:function(e){this.growthCollected.indexOf(e)<0&&this.growthCollected.push(e)},getBannerUrl:function(){if(!this.infoList||this.infoList.length<1)return null;var e=this.infoList[0].cfg;return e?game.ResCfg.getImgUrl(e.banner,!0):null},onSort1:function(e,t){return e.isGet==t.isGet?e.canGet==t.canGet?e.id-t.id:e.canGet?-1:1:e.isGet?1:-1},setCollect:function(e){this.growthCollected.indexOf(e)<0&&this.growthCollected.push(e)}});game.growGiftData=game.growGiftData||new e}(),function(){var e=game.ServerControl.extends({lastModuleEnum:-1,lastId:-1,init:function(){this.serverData=game.growGiftData,this.spotAlert=game.spotAlert.set(game.SAE.GROW_GIFT_PAGE_ALERT,game.SAE.GROW_GIFT_ALERT)},ipc:function(){var e=this;e.evts={MainRole:{C_RESET_DAILY:e.resetDaily},Recharge:{C_INIT_MODEL:e.initRechargeData,C_RECHARGE_SUCCESS:e.rechargeSuccess},DailyGift:{C2C_DAILY_GIFT_CHECK_OPEN:e.setServerData}},e.handels={GrowthPrizeBuyResp:e.gpbResp,GrowthPrizeCollectResp:e.gpcResp}},gpbResp:function(e){var t=e.readProtobuf(game.pb.GrowthPrizeBuyResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.growGiftData.setBuyGift(t.group),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_BUY_GIFT)}},gpcResp:function(e){var t=e.readProtobuf(game.pb.GrowthPrizeCollectResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.growGiftData.getPrize(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_LIST)}},triggerOpen:function(e){e==this.moduleEnum&&this.initData&&this.checkOpen()},setServerData:function(e){if(e&&e.data){var t=e.data;this._setServerData(t)}else b8e.warn("\u8bbe\u7f6e\u5f00\u670d\u6d3b\u52a8\u6ca1\u6709\u4f20\u5165\u6570\u636e!!!")},_setServerData:function(e){var t=this,a=e.openServerType,i=e.type?e.type:0,n=e.isActive,s=e.sae?e.sae:null,r=e.param?e.param:null;game.growGiftData.setServerInfo(a,i,n,s,r),t.dpt(t.Evts.C2C_CHANGE_GROW_GIFT_OPEN),t.send(t.Evts.C2V_CHANGE_GROW_GIFT_OPEN);var o=game.OpenServerClientCfg.getData(a,i);o&&game.growGiftData.curIndex==o.id&&t.showView()},initRechargeData:function(){this.initData=!0;var e=game.rechargeData;game.growGiftData.initData(e.growthGroups,e.growthCollected),game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkOpen()},checkOpen:function(){var e=this,t=game.growGiftData.checkOpen();e.obj||(e.obj={openServerType:game.OpenServerType.GROW_GIFT,isActive:!0,sae:game.SAE.GROW_GIFT_PAGE_ALERT}),e.obj.isActive=t,e._setServerData(e.obj),e.checkAlert()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data;if(t.id){var a=game.RechargeCfg.getDataById(t.id);a&&a.rechargeType==game.RechargeType.GROWTH_PRIZE&&(game.growGiftData.setBuyGift(a.rechargeId),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_BUY_GIFT))}}},resetDaily:function(){var e=this,t=game.growGiftData.curGroup;game.growGiftData.resetDaily();var a=game.growGiftData.curGroup;e.isShowView&&(e.isShowView=t==a),e.checkOpen(),e.send(e.Evts.C2V_UPDATE_LIST)},notify:function(e,t){var a=this,i=a.Evts;switch(e){case i.V2C_GET_PRIZE:if(!game.growGiftData.bought)return void game.notice.show(9152);a.sender.GrowthPrizeCollectReq(t);break;case i.V_SELECT_BTN:a.selectBtn(t);break;case i.V_SHOW_VIEW:a.showView();break;case i.V_HIDE_VIEW:a.hideView();break;case i.V2C_SHOW_PAGE:a.isShowView=!0,a.checkAlert()}},buyBtn:function(){var e=game.growGiftData;if(!e.bought&&e.curGroup){var t=game.GrowthPrizeCfg.getDataByGroup(e.curGroup);if(t)if(1==t.type)game.UpgradeUtil.checkItemList(t.cost)&&this.sender.GrowthPrizeBuyReq(e.curGroup);else this.dpt(this.Evts.C2C_RECHARGE,e.curGroup)}},checkAlert:function(){this.spotAlert.alert=!this.isShowView||game.growGiftData.checkAlert()}}),t=[game.ME.GrowGiftPage],a=game.Sender.extends({ipc:function(){this.msg={GrowthPrizeCollectReq:this.gpcReq,GrowthPrizeBuyReq:this.gpbReq}},gpbReq:function(e){var t=game.pb.GrowthPrizeBuyRequest;t.group=e,this.write(t)},gpcReq:function(e){var t=game.pb.GrowthPrizeCollectRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.GrowGift,e,game.GrowGiftEvts,a,t)}(),function(){var e;e=game.OpenServerBtnItem.extends({ctor:function(){this._super(1),this.setSize(86,96)},onClickBtn:function(){this.send(game.GrowGiftEvts.V_SELECT_BTN,this.data.id)}}),b8e.RC("$$game","$$GrowGiftBtnItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(496),this.setSize(600,176)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=6,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=15,e.addToParent(this.skin.prizeList)},setData:function(){var e=this,t=e.skin,a=e.data;t.title.string=e.data.title,e.prizeInfoList=e.data.getPrizeList(),e.prizeList.setData(e.prizeInfoList),t.cantGetBtn.active=!a.canGet,t.getBtn.active=a.canGet&&!a.isGet,t.spotAlert.active=a.bought,t.isGetImg.active=a.canGet&&a.isGet},clearData:function(){this.prizeList&&this.prizeList.clear()},getBtn:function(){this.send(game.GrowGiftEvts.V2C_GET_PRIZE,this.data.id)}}),b8e.RC("$$game","$$GrowGiftItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(497)},init:function(){var e=this,t=e.list=new game.List;t.itemRender=game.GrowGiftItem,t.bindEnum=game.ME.GrowGift,t.layout.spacingY=5,t.addToParent(e.skin.list),e.timer=b8e.Timer.add(e,e.updateTime,500),e.anima1=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima1.addToParent(e.skin.anim),e.anima1.load(game.ResCfg.getUrl(5019,1061))},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_BUY_GIFT:t.updateBuyBtn();break;case t.Evts.C2V_UPDATE_LIST:t.infoList=game.growGiftData.getInfoList(),t.list.setData(t.infoList)}},onShow:function(){var e=this;e.anima1.play(),e.updateBuyBtn(),e.refresh(),e.send(e.Evts.V2C_SHOW_PAGE)},updateBuyBtn:function(){this.skin.buyBtn.active=!game.growGiftData.bought,this.skin.boughtBtn.active=game.growGiftData.bought},refresh:function(){var e=this,t=game.growGiftData;e.infoList=t.getInfoList(),e.list.setData(e.infoList),e.endTime=t.endTime,t.curCfg&&(e.skin.costDesc.string=t.curCfg.costDesc),e.timer.reset(),e.timer.start();var a=e.skin.banner,i=t.getBannerUrl();if(!i||""==i){var n=game.OpenServerClientCfg.getData(game.OpenServerType.GROW_GIFT,0);n&&(i=game.ResCfg.getImgUrl(n.bannerImg,!0))}i&&a.loadTexture(i)},onHide:function(){this.stopTime()},updateTime:function(){var e=this;if(e.endTime){var t=e.endTime-game.SysTime.curTime;t<=0?e.stopTime(!0):e.skin.time.string=game.TimeUtil.formatTimeSpace(t,3)}else e.stopTime(!0)},stopTime:function(e){if(0<arguments.length&&void 0!==e&&e&&(this.skin.time.string=game.Lang.get(9053)),this.timer){this.timer.stop()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GrowGiftPage,e)}(),function(){var e=game.ServerView.extends({ctor:function(){this._super(136)},init:function(){this.serverItem=game.GrowGiftBtnItem,this.serverData=game.growGiftData,this._super()},notify:function(e){var t=this;switch(e){case t.Evts.V_SELECT_BTN:t.setTitleImg();break;case t.Evts.C2V_CHANGE_GROW_GIFT_OPEN:t.btnInfos=t.serverData.getOpenServerList(),t.openServerBtns.setData(t.btnInfos)}}});b8e.module.registerView(game.ME.GrowGift,e)}(),function(){var e;e=b8e.GameConfig.extends({ctor:function(){this._super()},onInited:function(){this.obj={rechargeId:0},this.obj1={serverStart:0},this.obj2={clientGroup:0}},getDataByDay:function(e){return this.obj1.serverStart=e,this.getData(this.obj1)},getDataById:function(e){return this.obj.rechargeId=e,this.getData(this.obj)},getDataByGroup:function(e){return this.obj2.clientGroup=e,this.getData(this.obj2,!0)}}),b8e.RC("$$game","$$DailySalePrizeCfg",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_REFRESH_VIEW:-1,C2C_RECHARGE:-1,C2V_UPDATE_BTNS:-1,C2C_DAILY_GIFT_CHECK_OPEN:-1}),b8e.RC("$$game","$$DailyGiftEvts",e)}(),function(){var e=b8e.Object.extends({initData:function(e,t){this.dailySalePrizeCollected=t,this.dailySalePrizeBuy=e,this.initInfoList()},resetDaily:function(){this.initInfoList()},initInfoList:function(){var e=this,t=game.miscData.openServerDay,a=game.DailySalePrizeCfg.getDataByDay(t);a?(e.curCfg=a,e.curId=a.rechargeId,e.setPrizeList(),e.setEndTime()):e.curCfg=null},checkOpen:function(){return!!this.curCfg},setPrizeList:function(){var e=this;e.prizeList||(e.prizeList=[]);for(var t=e.getCfg().award,a=void 0,i=t.length,n=0;n<i;n++)a=t[n],e.prizeList[n]=game.ItemUtil.createBaseItemInfo(a.Id,a.Num,e.prizeList[n]),e.prizeList[n].iconLayoutEnum=2},setEndTime:function(){var e=this.curCfg.clientGroup,t=game.DailySalePrizeCfg.getDataByGroup(e);if(t&&!(t.length<1)){t.sort(this.onTimeSort);var a=t[0].serverEnd;this.endTime=game.miscData.openServerTime+(a-1)*b8e.TimeUtil.DAY_MICRO_SECONDS}},getBannerUrl:function(){return this.curCfg?game.ResCfg.getImgUrl(this.curCfg.banner,!0):null},onTimeSort:function(e,t){return t.serverEnd-e.serverEnd},getIsGetById:function(e){return-1<this.dailySalePrizeCollected.indexOf(e)},getBoughtById:function(e){return-1<this.dailySalePrizeBuy.indexOf(e)},setCollect:function(e){this.dailySalePrizeCollected.indexOf(e)<0&&this.dailySalePrizeCollected.push(e)},setBougth:function(e){this.dailySalePrizeBuy.indexOf(e)<0&&this.dailySalePrizeBuy.push(e)},getPrizeList:function(){return this.prizeList},getCfg:function(){return this.curCfg},checkAlert:function(){if(!this.curId)return!1;var e=this.curId,t=this.getIsGetById(e),a=this.getBoughtById(e);return!(t||!a)}});game.dailyGiftData=game.dailyGiftData||new e}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.DAILY_GIFT_ALERT,game.SAE.GROW_GIFT_ALERT)},ipc:function(){var e=this;e.evts={Recharge:{C_INIT_MODEL:e.initRechargeData,C_RECHARGE_SUCCESS:e.rechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily}},e.handels={DailySalePrizeResp:e.dailySalePrizeResp}},dailySalePrizeResp:function(e){var t=e.readProtobuf(game.pb.DailySalePrizeResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.dailyGiftData.setCollect(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_BTNS)}},triggerOpen:function(e){e==this.moduleEnum&&this.initData&&this.checkOpen()},initRechargeData:function(){this.initData=!0;var e=game.rechargeData;game.dailyGiftData.initData(e.dailySalePrizeBuy,e.dailySalePrizeCollected),game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkOpen()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data;if(t.id){var a=game.RechargeCfg.getDataById(t.id);a&&a.rechargeType==game.RechargeType.DAILY_SALE_PRIZE&&(game.dailyGiftData.setBougth(a.rechargeId),game.dailyGiftData.setCollect(a.rechargeId),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_BTNS))}}},checkOpen:function(){var e=this,t=game.dailyGiftData.checkOpen();e.obj||(e.obj={openServerType:game.OpenServerType.DAILY_GIFT,isActive:!0,sae:game.SAE.DAILY_GIFT_ALERT}),e.obj.isActive=t,e.dpt(e.Evts.C2C_DAILY_GIFT_CHECK_OPEN,e.obj),e.checkAlert()},resetDaily:function(){game.dailyGiftData.resetDaily(),this.checkOpen(),this.send(this.Evts.C2V_REFRESH_VIEW)},buyBtn:function(){var e=game.dailyGiftData;e.getBoughtById(e.curId)||this.dpt(this.Evts.C2C_RECHARGE,e.curId)},getBtn:function(){var e=game.dailyGiftData;e.getIsGetById(e.curId)||this.sender.DailySalePrizeReq(e.curId)},checkAlert:function(){this.spotAlert.alert=game.dailyGiftData.checkAlert()}}),t=game.Sender.extends({ipc:function(){this.msg={DailySalePrizeReq:this.dailySalePrizeReq}},dailySalePrizeReq:function(e){var t=game.pb.DailySalePrizeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.DailyGift,e,game.DailyGiftEvts,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(298)},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_BTNS:t.updataBtn();break;case t.Evts.C2V_REFRESH_VIEW:t.refreshView(),t.updataBtn()}},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.layout.spacingX=25,t.layout.paddingLeft=50,t.addToParent(e.skin.prizeList),e.timer=b8e.Timer.add(e,e.updateTime,500)},onShow:function(){this.refreshView(),this.updataBtn()},refreshView:function(){var e=this,t=e.skin,a=game.dailyGiftData,i=a.getPrizeList();e.prizeList.setData(i),e.endTime=a.endTime,e.timer.reset(),e.timer.start();var n=a.getCfg();n&&(t.nowMoney.string=game.Lang.get(9499,n.nowMoney),t.oldMoney.string=game.Lang.get(9499,n.oldMoney),t.title.string=n.title);var s=t.banner,r=a.getBannerUrl();if(!r||""==r){var o=game.OpenServerClientCfg.getData(game.OpenServerType.DAILY_GIFT,0);o&&(r=game.ResCfg.getImgUrl(o.bannerImg,!0))}r&&s.loadTexture(r)},updataBtn:function(){var e=this.skin,t=game.dailyGiftData,a=t.getCfg();if(a){var i=a.rechargeId,n=t.getBoughtById(i),s=t.getIsGetById(i);e.buyBtn.active=!n,e.getBtn.active=n&&!s,e.getImg.active=n&&s}},onHide:function(){this.stopTime()},updateTime:function(){if(this.endTime){var e=this.endTime-game.SysTime.curTime;if(e<=0){this.stopTime(!0)}else this.skin.time.string=game.TimeUtil.formatTimeSpace(e,3)}else{this.stopTime(!0)}},stopTime:function(e){if(0<arguments.length&&void 0!==e&&e&&(this.skin.time.string=game.Lang.get(9053)),this.timer){this.timer.stop()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.DailyGift,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SWITCH_PAGE:-1,C2V_UPDATE_MS_LIST:-1,C2V_UPDATE_MSS_LIST:-1,C2V_UPDATE_AMOUNT:-1,V2C_BUY_ITEM:-1,V2C_SHOW_VIEW:-1,C2V_UPDATE_ENDTIME:-1,V2C_BUY_SCORE_ITEM:-1,C2V_VIP_LV_CHANGE:-1,V2C_ALL_BUY:-1,V2C_ALL_OB_BUY:-1,V2C_ALL_FLAG_BUY:-1,V2C_REFRESH_BTN:-1,C2C_UPDATA_INFO:-1}),b8e.RC("$$game","$$Mystery2ShopEvts",e)}(),function(){var e=void 0;e=b8e.Object.extends({id:0,itemId:0,itemNum:0,times:0,buyTimes:0,sortId:0,mysterType:0,group:0,setData:function(e){var t=this;t.id=e.id,t.itemId=e.itemId,t.itemNum=e.itemNum,t.discountCost=e.discountCost,t.normalCost=e.normalCost,t.times=e.times,t.buyTimes=e.buyTimes,t.sortId=e.sortId,t.setDiscount(),t.setSoldOut()},setDiscount:function(){var e=this,t=e.discountCost,a=e.normalCost;if(!t||t.length<1||!a||a.length<1)return e.oldMoney=0,e.nowMoney=0,e.costId=0,void(e.discount=0);var i=a[0],n=t[0];e.oldMoney=i.num,e.nowMoney=n.num,e.costId=i.id,e.discount=n.num/i.num*10,1<e.discount?e.discount=Math.floor(e.discount):e.discount=1},setBuyTimes:function(e){this.buyTimes=e,this.setSoldOut()},setSoldOut:function(){this.soldOut=this.buyTimes>=this.times}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$Mystery2ShopInfo",e)}(),function(){var e;e=b8e.Enum({SHOP_1:0,SHOP_2:1,SHOP_3:2,SHOP_4:3}),b8e.RC("$$game","$$Mystery2ShopType",e)}(),function(){var e=b8e.Object.extends({refreshCount:0,endTime:0,amounts:null,buyTimes:0,initData:function(e){this.amounts=b8e.HashMap.get(),this.setEndTime(e.mysteryNextRefreshTime),this.initMysteiesData(e.mysteries),this.buyTimes=e.mysteryBuyTimes},initMysteiesData:function(e){if(e&&!(e.length<1)){this.infoListMap&&this.infoListMap.clear(),this.initInfoMap();for(var t=void 0,a=e.length,i=0;i<a;i++)t=e[i],this.initMysterData(t)}},initMysterData:function(e){this.setRefreshCount(e.group,e.mysteryRefreshCount),this.setFreeTimes(e.group,e.freeTimes),this.initInfoList(e.group,e.mystery)},initInfoMap:function(){this.infoMap?this.infoMap.clear():this.infoMap=b8e.HashMap.get()},setEndTime:function(e){this.endTime=e},initInfoList:function(e,t){var a=this;a.infoListMap||(a.infoListMap=b8e.HashMap.get());var i=a.infoListMap.get(e);i?i.length=0:(i=[],a.infoListMap.set(e,i)),a.infoPoolMap||(a.infoPoolMap=b8e.HashMap.get());var n=a.infoPoolMap.get(e);if(n||(n=[],a.infoPoolMap.set(e,n)),t&&!(t.length<1)){for(var s=t.length,r=void 0,o=void 0,g=0;g<s;g++)r=t[g],n[g]||(n[g]=new game.Mystery2ShopInfo),(o=n[g]).setData(r),o.group=e,i.push(o),a.infoMap.set(o.id,o);i.sort(a.onSort)}},mysteryBuyResp:function(e,t){if(t&&!(t.length<1)){for(var a=t.length,i=void 0,n=void 0,s=0;s<a;s++)i=t[s],(n=this.infoMap.get(i.goodsId))&&n.setBuyTimes(i.buyNum);var r=this.infoListMap.get(e);r&&r.sort(this.onSort),this.buyTimes++}},setRefreshCount:function(e,t){this.refreshCountMap||(this.refreshCountMap=b8e.HashMap.get()),this.refreshCountMap.set(e,t)},setFreeTimes:function(e,t){this.freeTimesMap||(this.freeTimesMap=b8e.HashMap.get()),this.freeTimesMap.set(e,t)},addFreeTimes:function(e){var t=game.privilegeShopData.getMysteryFreeTimes(),a=this.freeTimesMap.get(e);a<t&&this.freeTimesMap.set(e,a+1)},mysteryRefreshData:function(e,t){this.initInfoList(e,t)},getCostCfg:function(e){var t=this;if(!t.refreshCountMap)return null;var a=t.refreshCountMap.get(e),i=0|t.freeTimesMap.get(e);if(isNaN(a))return null;var n=t.getMaxRefreshCount();if(0<n&&n<=a)return null;var s=t._costCfgs;if(t._costCfgs||(s=t._costCfgs=game.CostCfg.getDatasByType(game.CostType.MYSTER_SHOP,!0))&&0<s.length&&s.sort(t._onCostSort),!s||s.length<1)return null;for(var r=void 0,o=s.length,g=a-i+1,u=o-1;-1<u;u--)if(g>=(r=s[u]).num)return r;return r[o-1]},getMaxRefreshCount:function(){return isNaN(this.maxRefreshCount)&&(this.maxRefreshCount=+game.CfgUtil.getMiscValue(game.OpenServiceMiscCfg,"mysteryMaxCount",!1)),this.maxRefreshCount},_onCostSort:function(e,t){return e.num-t.num},getRefreshCount:function(e){if(!this.refreshCountMap)return 0;var t=this.refreshCountMap.get(e);return t||0},getFreeTimes:function(e){if(!this.freeTimesMap)return 0;var t=this.freeTimesMap.get(e);return t||0},checkOpen:function(e){if(!this.infoListMap)return!1;var t=this.infoListMap.get(e);return!(!t||t.length<1)&&0<t.length},getMSInfoList:function(e){return this.infoListMap?this.infoListMap.get(e):null},getMSSInfoList:function(){var e=this;if(e.scoreList&&0<e.scoreList.length)return e.scoreList;e.scoreList=[];var t=game.ShopItemCfg.getShopList(game.ShopIdEnum.MYSTER_SCORE_SHOP);if(t&&0<t.length)for(var a=t.length,i=void 0,n=0;n<a;n++)i=t[n],e.scoreList[n]||(e.scoreList[n]=new game.ShopItemInfo),e.scoreList[n].setData(i,0);return e.scoreList},getAllBuy:function(e){if(!this.infoListMap)return!1;var t=this.infoListMap.get(e);if(!t||t.length<1)return!1;for(var a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n]).buyTimes<i.times)return!0;return!1},getAlreadyBuy:function(e,t){var a=1<arguments.length&&void 0!==t?t:0;if(!this.infoListMap)return!1;var i=this.infoListMap.get(e);if(!i||i.length<1)return!1;for(var n=i.length,s=void 0,r=0,o=[],g=0;g<n;g++)s=i[g],0!=a&&game.amount.getAmountTypeById(s.costId)!=a||(r++,s.buyTimes>=s.times&&o.push(s));return o.length==r},getAllBuyList:function(e,t){var a=1<arguments.length&&void 0!==t?t:0,i=this;if(!i.infoListMap)return null;var n=i.infoListMap.get(e);if(!n||n.length<1)return null;i.buyList?i.buyList.length=0:i.buyList=[],i.buyPool||(i.buyPool=[]),i.amounts.clear();for(var s=n.length,r=void 0,o=void 0,g=void 0,u=void 0,l=0;l<s;l++)(r=n[l]).buyTimes>=r.times||0!=a&&game.amount.getAmountTypeById(r.costId)!=a||(i.buyPool[l]||(i.buyPool[l]={goodsId:0,buyNum:0}),(g=i.buyPool[l]).goodsId=r.id,g.buyNum=r.times-r.buyTimes,o=g.buyNum*r.nowMoney,i.amounts.get(r.costId)||i.amounts.set(r.costId,game.itemData.getCountById(r.costId)),o<=(u=i.amounts.get(r.costId)||0)&&(u-=o,i.amounts.set(r.costId,u),i.buyList.push(g)));return i.buyList},getAllAmountId:function(e){var t=[],a=this.infoListMap.get(e);if(!a||a.length<1)return t;for(var i=void 0,n=0,s=a.length;n<s;n++)i=a[n],-1==t.indexOf(i.costId)&&t.push(i.costId);return t},getCurShopItemInfo:function(){return this.curShopItemInfo},setCurShopItemInfo:function(e){this.curShopItemInfo=e},onSort:function(e,t){return e.soldOut==t.soldOut?e.sortId-t.sortId:e.soldOut?1:-1},resetDaily:function(){var a=this;a.refreshCountMap&&a.refreshCountMap.forEach(function(e,t){a.refreshCountMap.set(e,0)},a),a.freeTimesMap&&a.freeTimesMap.forEach(function(e,t){a.freeTimesMap.set(e,0)},a)},getGroups:function(){return this.infoListMap?this.infoListMap.keys():null}});game.mystery2ShopData=game.mystery2ShopData||new e}(),function(){var e=void 0;(e=game.View.extends({shopId:0,itemId:0,goodsId:0,_modelTouchClose:!1,_showModel:!0,count:0,boughtNum:0,maxNum:0,ctor:function(){this._super(747)},showBuyView:function(){this.parent?this.isInit&&this.setData():game.GameViewMgr.inst().showView(this,null,!1,2,!0)},init:function(){var e=this,t=e.skin;e._itemGrid=game.GridUtil.createShopIcon(),e._itemGrid.addToParent(t.icon);var a=e._amountSp=b8e.Sprite.get();a.addToParent(t.amountSp),a.setAnchor(.5,.5),a.setSize(40,40),t.count._editBox._textLabel.horizontalAlign=b8e.HorizontalAlign.CENTER,t.count.onEditingEnded(e.editingEnd,e),e.patt=/^[0-9]*[1-9][0-9]*$/},notify:function(e){switch(e){case this.Evts.V_CHANGE_COUNT:this.setCount()}},onShow:function(){this.setData()},onHide:function(){},setData:function(){var e=this,t=e.shopItemInfo=game.mystery2ShopData.getCurShopItemInfo();if(t){e.count=1;var a=e.skin;e.itemInfo=game.ItemUtil.createBaseItemInfo(t.itemId,t.itemNum,e.itemInfo),game.GridUtil.setItemIcon(e._itemGrid,e.itemInfo,!1,2);var i=game.ItemInfoCfg.getData(t.itemId);if(i?(a.desc.string=game.Lang.get(1331,i.des,i.des2),a.name.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name)):(a.desc.string="",a.name.string=""),t.costId){var n=game.ItemInfoCfg.getData(t.costId);if(n){var s=game.ResCfg.getUrl(137,n.icon);e._amountSp.loadTexture(s)}}else e._amountSp.unloadTexture();e.maxNum=t.times,a.content.height=a.desc.height,e.refreshCount(),e.refreshBought()}},refreshCount:function(){var e=this;e.skin.count.string=e.count+"",e.skin.amountNum.string=game.Lang.get(1330,0);var t=e.shopItemInfo;if(t&&t.nowMoney){var a=t.nowMoney*e.count;e.skin.amountNum.string=game.Lang.get(1330,a)}},refreshBought:function(){var e=this;e.maxNum<=0?e.skin.limitBuyLab.string="":(e.boughtNum=e.shopItemInfo.buyTimes,e.skin.limitBuyLab.string=game.Lang.get(1324,e.boughtNum,e.maxNum))},onStageResize:function(){var e=b8e.stageWidth,t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(.5*(e-this.width),t)},closeBtn:function(){this.removeFromParent()},returnBtn:function(){this.removeFromParent()},addBtn:function(){var e=this.count+1;this.check(e)},lessBtn:function(){var e=this.count-1;this.check(e)},addTenBtn:function(){this.check(9999)},lessTenBtn:function(){this.check(1)},editingEnd:function(){var e=this,t=e.skin.count.string;if(!e.patt.test(t)||""===t)return e.skin.count.string=e.count+"",void game.notice.show(1607);e.check(+t)},check:function(e){var t=this,a=1,i=1;if(t.shopItemInfo){if(1<e){var n=t.shopItemInfo,s=n.nowMoney,r=game.itemData.getCountById(n.costId);s<r&&(i=r/s|0);var o=n.buyTimes;if(0<t.maxNum){if(t.maxNum>o){var g=t.maxNum-o;a=e<=(g=g<i?g:i)?e:g}}else a=(i=9999<i?9999:i)<e?i:e}t.count=a,t.refreshCount()}},buyBtn:function(){var e=this,t=e.shopItemInfo;if(t&&!(0<e.maxNum&&t.buyTimes>=e.maxNum)){var a=t.nowMoney*e.count;game.UpgradeUtil.checkItemInfo(t.costId,a)&&(b8e.module.sendToControl(game.ME.Mystery2Shop,[game.Mystery2ShopEvts.V2C_BUY_ITEM,t.id,e.count,t.group]),e.removeFromParent())}}}))._instance=null,e.inst=function(){return e._instance||(e._instance=new e),e._instance},b8e.RC("$$game","$$Mystery2BuyView",e)}(),function(){var e=game.Control.extends({mysteryFreeCount:0,init:function(){var e=this;e.buyTempList=[],e.spotAlert=game.spotAlert.set(game.SAE.MYSTERY2_SHOP_ALERT),e.spotAlert2=game.spotAlert.set(game.SAE.MYSTERY2_SHOP2_ALERT),e.spotAlert3=game.spotAlert.set(game.SAE.MYSTERY2_SHOP3_ALERT),e.spotAlert4=game.spotAlert.set(game.SAE.MYSTERY2_SHOP4_ALERT),e.spotAlert5=game.spotAlert.set(game.SAE.MYSTERY2_SHOP_PAGE_ALERT,game.SAE.MYSTERYSHOPFRAME_ALERT),e.spotAlert6=game.spotAlert.set(game.SAE.MYSTERY2_SCORE_SHOP_ALERT,game.SAE.MYSTERYSHOPFRAME_ALERT),e._alertOptions={lang:6092,okcb:e.onGameAlert,thisArg:e};var t=game.OpenServiceMiscCfg.getData("mysteryFreeCount");t&&t.value&&(e.mysteryFreeCount=+t.value)},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.initOpenServer},Back:{C_UPDATE_AMOUNT:e.updateAmount,C_BACK_UPDATE_ITEMINFO:e.updateAmount},MainRole:{C_VIP_LEVEL_CHANGE:e.vipLvChange,C_RESET_DAILY:e.resetDaily},PrivilegeShop:{C2C_PRIVILEGE_UPDATE:e.checkAllAlert}},e.handels={MysteryBuyResp:e.mysteryBuyResp,MysteryRefreshResp:e.mysteryRefreshResp,MysteryRefreshMsg:e.mysteryRefreshMsg}},mysteryBuyResp:function(e){var t=e.readProtobuf(game.pb.MysteryBuyResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.mystery2ShopData.mysteryBuyResp(t.group,t.data),this.send(this.Evts.C2V_UPDATE_MS_LIST),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeConsume),this.dpt(this.Evts.C2C_UPDATA_INFO)}},mysteryRefreshResp:function(e){var t=e.readProtobuf(game.pb.MysteryRefreshResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this,i=game.mystery2ShopData;i.setRefreshCount(t.group,t.count),i.mysteryRefreshData(t.group,t.data),game.privilegeShopData.isActByType(game.PrivilegeType.MYSTERY)&&i.addFreeTimes(t.group),a.checkAlertByGroup(t.group),a.send(a.Evts.C2V_UPDATE_MS_LIST),a.send(a.Evts.C2V_UPDATE_REFRESH),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeConsume)}},mysteryRefreshMsg:function(e){var t=e.readProtobuf(game.pb.MysteryRefreshNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=this,i=t.mysteries,n=game.mystery2ShopData;if(n.initMysteiesData(i),n.setEndTime(t.nextRefreshTime),i&&0<i.length)for(var s=void 0,r=i.length,o=0;o<r;o++)s=i[o],a.checkAlertByGroup(s.group);a.checkAlert(!0),a.send(a.Evts.C2V_UPDATE_MS_LIST),a.send(a.Evts.C2V_UPDATE_ENDTIME)}},initOpenServer:function(e){if(e&&e.data){game.mystery2ShopData.initData(e.data),game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkOpen()}},resetDaily:function(){game.mystery2ShopData.resetDaily(),this.send(this.Evts.C2V_UPDATE_REFRESH)},triggerOpen:function(e){e!=this.moduleEnum&&e!=game.ME.Mystery2ShopPage&&e!=game.ME.Mystery2ShopPage2||this.checkOpen()},checkOpen:function(){var e=this;e.dpt(e.Evts.C2C_REFRESH_BTNS);var t=game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_1);e.checkAlert(t),t=game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_2),e.checkAlert2(t),t=game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_3),e.checkAlert3(t),t=game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_4),e.checkAlert4(t);var a=game.mystery2ShopData.getGroups();if(a&&0<a.length)for(var i=void 0,n=a.length,s=0;s<n;s++)i=a[s],e.checkAlertByGroup(i)},notify:function(e,t,a,i){var n=this;switch(e){case n.Evts.V2C_BUY_ITEM:n.buyTempList.length=0,n.obj||(n.obj={goodsId:t,buyNum:a}),n.obj.goodsId=t,n.obj.buyNum=a;var s=i;if(isNaN(s))return;n.buyTempList[0]=n.obj,n.sender.MysteryBuyReq(s,n.buyTempList);break;case n.Evts.V2C_SHOW_VIEW:n.checkAlert(!1),n.checkAlert2(!1),n.checkAlert3(!1),n.checkAlert4(!1);break;case n.Evts.V2C_BUY_SCORE_ITEM:game.ShopBuyView.inst().showBuyView(t);break;case n.Evts.V2C_REFRESH_BTN:n.refreshBtn(t);break;case n.Evts.V2C_ALL_BUY:n.allBuyBtn(t);break;case n.Evts.V2C_ALL_OB_BUY:n.allBuyBtn(t,game.AmountType.OB);break;case n.Evts.V2C_ALL_FLAG_BUY:n.allBuyBtn(t,game.AmountType.FLAGWAR)}},updateAmount:function(){this.send(this.Evts.C2V_UPDATE_AMOUNT)},checkAlert:function(e){this.spotAlert.alert=e},checkAlert2:function(e){this.spotAlert2.alert=e},checkAlert3:function(e){this.spotAlert3.alert=e},checkAlert4:function(e){this.spotAlert4.alert=e},checkAllAlert:function(){this.checkAlertByGroup(game.Mystery2ShopType.SHOP_1),this.checkAlertByGroup(game.Mystery2ShopType.SHOP_2)},checkAlertByGroup:function(e){if(this.mysteryFreeCount){var t=game.mystery2ShopData.getRefreshCount(e),a=game.mystery2ShopData.getMaxRefreshCount(),i=game.privilegeShopData.getMysteryFreeTimes(),n=game.mystery2ShopData.getFreeTimes(e),s=!1;game.mystery2ShopData.checkOpen(e)&&t<a&&(s=n<i||t<this.mysteryFreeCount+i),0==e?(game.moduleOpen.checkOpen(game.ME.Mystery2ShopPage)||(s=!1),this.spotAlert5.alert=s):1==e&&(game.moduleOpen.checkOpen(game.ME.Mystery2ShopPage2)||(s=!1),this.spotAlert6.alert=s)}},allBuyBtn:function(e,t){var a=1<arguments.length&&void 0!==t?t:0,i=game.mystery2ShopData.getAllBuy(e),n=game.mystery2ShopData.getAlreadyBuy(e,a);if(i&&!n){var s=game.mystery2ShopData.getAllBuyList(e,a);if(!s||s.length<1){var r="",o=void 0,g=void 0;if(a)o=game.amount.getCfgByType(a),r=game.Lang.get(7251,o.name);else{for(var u=game.mystery2ShopData.getAllAmountId(e),l=0;l<u.length;l++)(o=game.ItemInfoCfg.getData(u[l]))&&(g=o.cfgType==game.ItemCfgType.Amount?o.type:0,(n=game.mystery2ShopData.getAlreadyBuy(e,g))?u.splice(l,1):u[l]=o.name);r=game.Lang.get(7251,u.join(","))}return""==r&&(r=game.Lang.get(9434)),void game.notice.show(r)}a==game.AmountType.OB||a==game.AmountType.FLAGWAR?this._alertOptions.lang=7243:this._alertOptions.lang=6092,this._alertOptions.args=[e,s],game.alert.showTwo(this._alertOptions)}else game.notice.show(6097)},onGameAlert:function(e,t){this.sender.MysteryBuyReq(e,t)},refreshBtn:function(e){var t=game.mystery2ShopData.getCostCfg(e);if(t){var a=game.mystery2ShopData.getRefreshCount(e);if(game.VipCfg.getMysterShopNum(game.mainRoleData.vipLevel)<=a)game.notice.show(6093);else game.UpgradeUtil.checkItemList(t.items)&&this.sender.MysteryRefreshReq(e)}},vipLvChange:function(){this.send(this.Evts.C2V_VIP_LV_CHANGE)},mSBtn:function(){this.selectToggle(0)},mSSBtn:function(){this.selectToggle(2)},mSBtn2:function(){this.selectToggle(1)},obBtn:function(){this.selectToggle(3)},mSBtn5:function(){this.selectToggle(4)},selectToggle:function(e){this.send(this.Evts.C2V_SWITCH_PAGE,e)}}),t=[game.ME.Mystery2ShopPage,game.ME.Mystery2ScoreShopPage,game.ME.Mystery2ShopPage2,game.ME.OccupiedShop,game.ME.FlagWarShop],a=game.Sender.extends({ipc:function(){this.msg={MysteryBuyReq:this.mysteryBuyReq,MysteryRefreshReq:this.mysteryRefreshReq}},mysteryBuyReq:function(e,t){var a=game.pb.MysteryBuyRequest;a.group=e,a.data=t,this.write(a)},mysteryRefreshReq:function(e){var t=game.pb.MysteryRefreshRequest;t.group=e,this.write(t)}});b8e.module.registerControl(game.ME.Mystery2Shop,e,game.Mystery2ShopEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(748),this.setSize(294,172)},init:function(){var e=this._itemGrid=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105);e.addToParent(this.skin.icon),e.setClickCb(this.click,this)},setData:function(){var e=this,t=e.data,a=e.skin;e.itemInfo=game.ItemUtil.createBaseItemInfo(t.id,t.num,e.itemInfo),game.GridUtil.setItemIcon(e._itemGrid,e.itemInfo,!1,2),t.costItems&&0<t.costItems.length?a.score.string=t.costItems[0].Num:a.score.string="";var i=game.ItemInfoCfg.getData(t.id);if(i){a.name.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name)}else a.name.string=""},click:function(){var e=this.data;0<e.maxNum&&e.buyNum>=e.maxNum?game.notice.show(1326):this.send(game.Mystery2ShopEvts.V2C_BUY_SCORE_ITEM,e.goodsId)}}),b8e.RC("$$game","$$Mystery2ScoreShopItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(749)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_MSS_LIST:this.updateList();break;case this.Evts.C2V_UPDATE_AMOUNT:this.updateScore()}},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.Mystery2ScoreShopItem,e.bindEnum=game.ME.Mystery2Shop,e.layout.paddingTop=0,e.layout.paddingLeft=0,e.layout.spacingY=5,e.layout.spacingX=13,e.addToParent(this.skin.scrollGrid)},onShow:function(){this.updateList(),this.updateScore()},onHide:function(){},updateScore:function(){this.skin.score.string=game.amount.get(game.AmountType.MYSTERY_SCORE)},updateList:function(){this.infoList=game.mystery2ShopData.getMSSInfoList(),this.list.setData(this.infoList)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.Mystery2ScoreShopPage,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(750),this.setSize(294,172)},setData:function(){var e=this,t=e.skin,a=e.data;t.oldMoney.string=game.Lang.get(2306,a.oldMoney),t.nowMoney.string=game.Lang.get(2307,a.nowMoney);var i=t.oldMoney.width,n=t.nowMoney.width;t.line.width=i+5,t.oldIcon.x=t.oldMoney.x+i+10,t.nowIcon.x=t.nowMoney.x+n+10;var s=a.costId;if(s){var r=game.ItemInfoCfg.getData(s);if(r&&r.icon){var o=game.ResCfg.getUrl(137,r.icon);if(t.oldIcon.loadTexture(o),t.nowIcon.loadTexture(o),e.itemInfo=game.ItemUtil.createBaseItemInfo(a.itemId,a.itemNum,e.itemInfo),!e._itemGrid)(e._itemGrid=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105)).addToParent(e.skin.icon);game.GridUtil.setItemIcon(e._itemGrid,e.itemInfo,!1,2);var g=game.ItemInfoCfg.getData(a.itemId);g&&(t.title.string=game.HtmlUtil.getColorStrByQuality(g.quality,g.name,!0)),t.soldOut.active=a.soldOut,t.limitNum.active=!a.soldOut,t.limitNum.string=game.Lang.get(6094,a.buyTimes,a.times),10<=a.discount?e.skin.discount.unloadTexture():(o=game.ResCfg.getUrl(126,a.discount),e.skin.discount.loadTexture(o))}}},clickGrid:function(){this.click()},click:function(){var e=this.data;0<e.times&&e.buyTimes>=e.times?game.notice.show(1326):(game.mystery2ShopData.setCurShopItemInfo(e),game.Mystery2BuyView.inst().showBuyView())}}),b8e.RC("$$game","$$Mystery2ShopItem",e)}(),function(){var e;e=game.View.extends({group:1,amountType:0,mysteryFreeCount:0,ctor:function(e,t){this.group=e,this.amountType=t,this._super(751)},notify:function(e){var t=this,a=t.Evts;switch(e){case a.C2V_UPDATE_MS_LIST:t.updateList();break;case a.C2V_UPDATE_AMOUNT:t.updateAmount();break;case a.C2V_UPDATE_REFRESH:t.updateRefresh();break;case a.C2V_UPDATE_ENDTIME:t.updateEndTime();break;case a.C2V_VIP_LV_CHANGE:}},init:function(){var e=this,t=e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.Mystery2ShopItem,t.bindEnum=game.ME.Mystery2Shop,t.layout.paddingTop=0,t.layout.paddingLeft=0,t.layout.spacingY=5,t.layout.spacingX=13,t.addToParent(e.skin.scrollGrid),e.timer=b8e.Timer.add(e,e.updateTime,500),e.skin.refreshLab2.string=game.Lang.get(6087),e.mysteryFreeCount=0;var a=game.OpenServiceMiscCfg.getData("mysteryFreeCount");a&&a.value&&(e.mysteryFreeCount=+a.value)},onShow:function(){this.updateEndTime(),this.updateAmount(),this.updateRefresh(),this.updateList()},onHide:function(){this.stopTime()},updateEndTime:function(){this.endTime=game.mystery2ShopData.endTime,this.timer.reset(),this.timer.start()},updateAmount:function(){var e=this;e.skin.score.string=game.amount.get(game.AmountType.MYSTERY_SCORE);var t=game.amount.get(e.amountType);if(e.skin.costNum.string=game.CCommonUtil.replaceNum(t,2),!e.costIcon){e.costIcon=b8e.Sprite.get(),e.costIcon.setAnchor(.5,.5),e.costIcon.addToParent(e.skin.costIcon),e.costIcon.setSize(40,40);var a=game.amount.getCfgByType(e.amountType),i=game.ResCfg.getUrl(137,a.icon);e.costIcon.loadTexture(i),b8e.evt.onC(e.costIcon,e.view_gotoBtn,e)}e.skin.costIcon.x=e.skin.costNum.x-e.skin.costNum.width-18},updateRefresh:function(){var e=this,t=e.skin,a=game.mystery2ShopData.getRefreshCount(e.group),i=(game.VipCfg.getMysterShopNum(game.mainRoleData.vipLevel),game.mystery2ShopData.getCostCfg(e.group));e.setRefreshState(!1);var n=game.mystery2ShopData.getMaxRefreshCount();if(i){var s=game.privilegeShopData.getMysteryFreeTimes(),r=game.mystery2ShopData.getFreeTimes(e.group);if(a<n&&0<s&&r<s){t.view_refreshBtn.active=!0,t.refreshGrayBtn.active=!1;var o=0,g=0;return g=a-r>e.mysteryFreeCount?(o=r,s):(o=a,e.mysteryFreeCount+s),void(t.refreshLab2.string=game.Lang.get(6088,o,g))}if(i.items.length<1)return t.view_refreshBtn.active=!0,t.refreshGrayBtn.active=!1,void(t.refreshLab2.string=game.Lang.get(6088,a,e.mysteryFreeCount+s));e.setRefreshState(!0);var u=i.items[0],l=game.ItemInfoCfg.getData(u.Id);if(l&&l.icon){var c=game.ResCfg.getUrl(137,l.icon);t.refreshIcon.loadTexture(c),a-=e.mysteryFreeCount,e.mysteryFreeCount,t.refreshLab.string=game.HtmlUtil.getText(game.Color.BLACK,u.Num)}}else t.refreshLab2.string=a<n?"":game.Lang.get(6087)},setRefreshState:function(e){var t=this.skin;t.refreshIcon.active=e,t.refreshLab.active=e,t.view_refreshBtn.active=e,t.refreshGrayBtn.active=!e,t.refreshLab2.active=!e},updateTime:function(){var e=this;if(e.endTime){var t=e.endTime-game.SysTime.curTime;if(t<=0)e.stopTime(!0);else{var a=game.TimeUtil.formatTimeSpace(t,3);e.skin.refreshDesc.string=game.Lang.get(6090,a)}}else e.stopTime(!0)},stopTime:function(e){if(0<arguments.length&&void 0!==e&&e&&(this.skin.refreshDesc.string=game.Lang.get(6091)),this.timer){this.timer.stop()}},updateList:function(){this.infoList=game.mystery2ShopData.getMSInfoList(this.group),this.list.setData(this.infoList)},view_allBuyBtn:function(){this.send(this.Evts.V2C_ALL_BUY,this.group)},view_refreshBtn:function(){this.send(this.Evts.V2C_REFRESH_BTN,this.group)},view_obBuyBtn:function(){this.send(this.Evts.V2C_ALL_OB_BUY,this.group)},view_flagBuyBtn:function(){this.send(this.Evts.V2C_ALL_FLAG_BUY,this.group)},onStageResize:function(){this.setPosition(0,0)},view_gotoBtn:function(){var e=game.amount.getCfgByType(this.amountType);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))},$$getShopItem:function(e){var t=this,a=void 0;if(!t.infoList||!t.infoList.length)return null;for(var i=0,n=t.infoList.length;i<n;i++)if(t.infoList[i].itemId==e){a=t.infoList[i];break}if(!a)return null;var s=t.list.getItemRender(a);return s&&s.skin&&s.skin.click?s.skin.click:null}}),b8e.RC("$$game","$$Mystery2ShopPage",e)}(),function(){var e=game.View.extends({ctor:function(){var e=this;e._super(752),e.toggles={mSBtnSelect:game.ME.Mystery2ShopPage,mSBtnSelect2:game.ME.Mystery2ShopPage2,mSSBtnSelect:game.ME.Mystery2ScoreShopPage,obBtnSelect:game.ME.OccupiedShop,mSBtnSelect5:game.ME.FlagWarShop},e.spotAlerts={MYSTERY2_SHOP_PAGE_ALERT:e.spotAlert1,MYSTERY2_SCORE_SHOP_ALERT:e.spotAlert2,MYSTERY2_SHOP2_ALERT:e.spotAlert3,MYSTERY2_SHOP3_ALERT:e.spotAlert4}},spotAlert1:function(e){this.skin.red_spot_1.active=e.alert},spotAlert2:function(e){this.skin.red_spot_2.active=e.alert},spotAlert3:function(e){this.skin.red_spot_3.active=e.alert},spotAlert4:function(e){this.skin.red_spot_4.active=e.alert},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_PAGE:this.toggleSelect(t)}},onShow:function(){this.toggleSelect(0),this.layoutBtns(),this.send(this.Evts.V2C_SHOW_VIEW)},onHide:function(){},layoutBtns:function(){var e,t=0,a=this.skin;game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_1)?(e=133*t+67,t++,a.mSBtn.active=!0,a.mSBtn.x=e):a.mSBtn.active=!1,game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_2)?(e=133*t+67,t++,a.mSBtn2.x=e,a.mSBtn2.active=!0):a.mSBtn2.active=!1,a.mSSBtn.x=133*t+67,game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_3)?(a.obBtn.x=a.mSSBtn.x+133,a.obBtn.active=!0):a.obBtn.active=!1,game.mystery2ShopData.checkOpen(game.Mystery2ShopType.SHOP_4)?(a.mSBtn5.x=a.mSSBtn.x+266,a.mSBtn5.active=!0):a.mSBtn5.active=!1},toggleSelect:function(e){if(game.moduleOpen.checkOpenWithTips(this.getToggleIndex(e))){if(!this._super(e));}else;}});b8e.module.registerView(game.ME.Mystery2Shop,e)}(),function(){var e=game.Control.extends({btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.C2V_SWITCH_PAGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={}}});b8e.module.registerControl(game.ME.MysteryShopFrame,e,game.Mystery2ShopEvts,t)}(),function(){var e=game.View.extends({ctor:function(){var e=this;e._super("mysteryShop/MysteryShopFrame"),e.toggles={toggle_btn_1:game.ME.Mystery2ShopPage,toggle_btn_2:game.ME.Mystery2ShopPage2},e.spotAlerts={MYSTERY2_SHOP_PAGE_ALERT:e.checkSpotAlert1,MYSTERY2_SCORE_SHOP_ALERT:e.checkSpotAlert2}},checkSpotAlert1:function(e){this.skin.red_spot_1.active=e.alert},checkSpotAlert2:function(e){this.skin.red_spot_2.active=e.alert},init:function(){game.shopData.initData(),this.send(this.Evts.V2C_INIT_SHOP)},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_PAGE:this.toggleSelect(t)}},onShow:function(){this.toggleSelect(0),this.skin.btn_2.active=game.moduleOpen.checkOpen(game.ME.Mystery2ShopPage2)},onHide:function(){}});b8e.module.registerView(game.ME.MysteryShopFrame,e)}(),function(){var e=game.Mystery2ShopPage.extends({ctor:function(){this._super(game.Mystery2ShopType.SHOP_1,game.AmountType.YUAN_BAO)},init:function(){var e=this;e.skin.titleImg.active=!0,e.skin.partnerTit.active=!1,e.skin.ocTitle.active=!1,e.skin.flagWarTitle.active=!1,e._super()}});b8e.module.registerView(game.ME.Mystery2ShopPage,e)}(),function(){var e=game.Mystery2ShopPage.extends({costId:332003,ctor:function(){this._super(game.Mystery2ShopType.SHOP_2,game.AmountType.YUAN_BAO)},init:function(){var e=this;e.skin.titleImg.active=!1,e.skin.partnerTit.active=!0,e.skin.ocTitle.active=!1,e.skin.flagWarTitle.active=!1,e._super()},updateAmount:function(){var e=this;e.skin.score.string=game.amount.get(game.AmountType.MYSTERY_SCORE);var t=game.itemData.getNumById(e.costId);e.skin.costNum.string=game.CCommonUtil.replaceNum(t,2),e.costIcon||(e.costIcon=b8e.Sprite.get(),e.costIcon.setAnchor(.5,.5),e.costIcon.addToParent(e.skin.costIcon),e.costIcon.setSize(40,40),b8e.evt.onC(e.costIcon,e.view_gotoBtn,e));var a=game.ItemInfoCfg.getData(e.costId);if(a&&a.icon){var i=game.ResCfg.getUrl(137,a.icon);e.costIcon.loadTexture(i),e.skin.costIcon.x=e.skin.costNum.x-e.skin.costNum.width-18}},view_gotoBtn:function(){var e=game.ItemInfoCfg.getData(this.costId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}});b8e.module.registerView(game.ME.Mystery2ShopPage2,e)}(),function(){var e;e=b8e.Enum({None:0,C_GET_DATA:b8e.enc(),V_UPDATE_MATCH:b8e.enc(),C_UPDATE_MATCH:b8e.enc(),C_APPLY:b8e.enc(),C_BET_LOOK:b8e.enc(),V_BET_COMPLETE:b8e.enc(),C_BET_COMPLETE:b8e.enc(),V_BET_SELECT:b8e.enc(),C_CHECK_BTTALE_LOG:b8e.enc(),C_GET_BET_REQ:b8e.enc(),C_BET_REQ:b8e.enc(),C_BATTLE_LOG_REQ:b8e.enc(),C_GET_MATCH_REQ:b8e.enc(),C_SELECT_ZONE:b8e.enc(),HIDE_ZONE_LIST:b8e.enc(),C_BATTLE_LOG_LOOK:b8e.enc()}),b8e.RC("$$game","$$AllServerWarEvts",e)}(),function(){var e;e=b8e.Enum({None:0,LOW:11,MIDDLE:12,HIGH:13}),b8e.RC("$$game","$$AllServerWarBetType",e)}(),function(){var e=b8e.Object.extends({eliminationTime:null,top16Time:null,top8Time:null,top4Time:null,top2Time:null,matchData:null,isApply:!1,eliminationMatchList:null,eliminationRankList:null,myPlayerInfo:null,battleLogList:null,betData:null,betIndex:0,betMatchId:0,selectBetType:null,lookMatchInfo:null,canBet:!1,isShowView:!1,matchZoneList:null,ctor:function(){var e=this;e._super(),e.eliminationTime=new game.WorldChallengeTime,e.top16Time=new game.WorldChallengeTime,e.top8Time=new game.WorldChallengeTime,e.top4Time=new game.WorldChallengeTime,e.top2Time=new game.WorldChallengeTime,e.benBetTime=new game.WorldChallengeTime,e.benBetTime2=new game.WorldChallengeTime,e.eliminationMatchList=[],e.eliminationRankList=[],e.vsData16=[],e.vsData8=[],e.vsData4=[],e.vsData2=[],e.battleLogList=[],e.matchZoneList=[]},setData:function(e){this.matchData=e,this.isApply=!(!e.top||999==e.top)||e.isSignUp,this.splitVsData()},initOpenTime:function(){var e=this;e.setTimes("eliminationTimes2",e.eliminationTime),e.setTimes("top16Times2",e.top16Time),e.setTimes("top8Times2",e.top8Time),e.setTimes("top4Times2",e.top4Time),e.setTimes("top2Times2",e.top2Time),e.setBetTimes("banBetTimes",e.benBetTime),e.setBetTimes("banBetTimes2",e.benBetTime2)},setBetTimes:function(e,t){var a=this.getTimeArr(e),i=a[0].split(":"),n=+i[0],s=+i[1],r=game.SysTime.curTime,o=b8e.TimeUtil.getTodayTime(r);t.startTime=o+b8e.TimeUtil.HOUR_MICRO_SECONDS*n+b8e.TimeUtil.MINUTE_MICRO_SECONDS*s;var g=a[1].split(":"),u=+g[0],l=+g[1];t.endTime=o+b8e.TimeUtil.HOUR_MICRO_SECONDS*u+b8e.TimeUtil.MINUTE_MICRO_SECONDS*l},setTimes:function(e,t){var a=this.getTimeArr(e);if(a){var i=(t.timeArr=a)[0],n=i.split("|"),s=n[1].split(":"),r=+s[0],o=+s[1],g=game.SysTime.curTime,u=0!=+n[0]?+n[0]:7,l=0!=b8e.TimeUtil.getDay(g)?b8e.TimeUtil.getDay(g):7,c=u-l>>0,h=b8e.TimeUtil.getTodayTime(g);t.startTime=h+b8e.TimeUtil.HOUR_MICRO_SECONDS*r+b8e.TimeUtil.MINUTE_MICRO_SECONDS*o+c*b8e.TimeUtil.DAY_MICRO_SECONDS;var m=(n=(i=a[1]).split("|"))[1].split(":"),d=+m[0],f=+m[1];return g=game.SysTime.curTime,c=(u=0!=+n[0]?+n[0]:7)-(l=0!=b8e.TimeUtil.getDay(g)?b8e.TimeUtil.getDay(g):7)>>0,h=b8e.TimeUtil.getTodayTime(g),t.endTime=h+b8e.TimeUtil.HOUR_MICRO_SECONDS*d+b8e.TimeUtil.MINUTE_MICRO_SECONDS*f+c*b8e.TimeUtil.DAY_MICRO_SECONDS,t}},getTimeArr:function(e){var t=game.MatchMiscCfg.getData(e);return!(!t||""==t.value)&&t.value.split("-")},getIsEliminationIng:function(){var e=this;game.SysTime.curTime;return!!e.matchData&&!(0!=e.matchData.top&&999!=e.matchData.top||!e.matchData.players||!e.matchData.players.length)},getIsTopIng:function(){var e=this;game.SysTime.curTime;return!!e.matchData&&!!(0<e.matchData.top&&999!=e.matchData.top&&e.matchData.matches&&e.matchData.matches.length)},getEliminationMatchList:function(){var e,t=this;if(t.clearList(t.eliminationMatchList),!t.matchData||!t.matchData.matches)return t.eliminationMatchList;for(var a=t.matchData.matches,i=0,n=a.length;i<n;i++)(e=game.MatchInfo.get()).setData(a[i]),t.eliminationMatchList.push(e);return t.eliminationMatchList.sort(t.sortMatchList),t.eliminationMatchList},sortMatchList:function(e,t){return e.top-t.top},getEliminationRankList:function(){var e,t=this;if(t.myPlayerInfo=null,t.clearList(t.eliminationRankList),!t.matchData||!t.matchData.players)return t.eliminationRankList;for(var a=t.matchData.players,i=0,n=a.length;i<n;i++)(e=game.MatchPlayer.get()).setData(a[i]),t.eliminationRankList.push(e);for(t.eliminationRankList.sort(t.sortRankList),i=0,n=t.eliminationRankList.length;i<n;i++)t.eliminationRankList[i].rank=i+1,t.eliminationRankList[i].roleId==game.mainRoleData.roleId&&(t.myPlayerInfo=t.eliminationRankList[i]);return t.eliminationRankList},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},sortRankList:function(e,t){return t.score-e.score},getGroupLevel:function(e){return game.Lang.get(6051+e)},getVsData:function(e){var t=game.MatchVsType;switch(e){case t.VS2:return this.vsData2;case t.VS4:return this.vsData4;case t.VS8:return this.vsData8;case t.VS16:return this.vsData16;default:return null}},splitVsData:function(){var e=this;e.vsData2.length=0,e.vsData4.length=0,e.vsData8.length=0,e.vsData16.length=0;for(var t=game.MatchVsType,a=e.matchData.matches,i=void 0,n=0,s=a.length;n<s;n++)switch((i=a[n]).top){case t.VS2:e.vsData2.push(i);break;case t.VS4:e.vsData4.push(i);break;case t.VS8:e.vsData8.push(i);break;case t.VS16:e.vsData16.push(i)}e.vsData4.length/2==e.vsData2.length&&e.resetResult(e.vsData2,e.vsData4),e.vsData8.length/2==e.vsData4.length&&e.resetResult(e.vsData4,e.vsData8),e.vsData16.length/2==e.vsData8.length&&e.resetResult(e.vsData8,e.vsData16)},resetResult:function(e,t){if(!(!e||e.length<1||!t||t.length<1))for(var a=void 0,i=0,n=e.length;i<n;i++)1==(a=e[i]).result?t[2*i+1].result=3:2==a.result?t[2*i].result=3:3==a.result&&(t[2*i].result=3,t[2*i+1].result=3)},getBattleLogList:function(){var e,t=this;if(t.clearList(t.battleLogList),!t.lookMatchInfo||!t.lookMatchInfo.logs)return t.battleLogList;for(var a=t.lookMatchInfo.logs,i=0,n=a.length;i<n;i++)(e=game.BattleLogInfo.get()).setData(a[i]),e.player1=t.lookMatchInfo.player1,e.player2=t.lookMatchInfo.player2,t.battleLogList.push(e);return t.battleLogList.sort(t.sortLogList),t.battleLogList},sortLogList:function(e,t){return e.round-t.round},checkOpenElimination:function(){var e=this;if(!e.eliminationTime||!e.isApply||!e.matchData||999==e.matchData.top)return!1;var t=game.SysTime.curTime;return!!(e.eliminationTime.startTime<=t&&e.eliminationTime.endTime>t&&0==e.matchData.top&&e.matchData.players&&e.matchData.players.length)},checkCanBet:function(){var e=this;return!(!e.matchData||!e.matchData.top||e.isPrediction()||!e.matchData.matches.length)&&e.getTopCanBet(e.matchData.top)},getTopCanBet:function(){var e=this,t=e.getTopTime(e.matchData.top);if(!t)return!1;var a=game.SysTime.curTime;return t.startTime>a&&e.eliminationTime.startTime<a&&(!(e.benBetTime.startTime<=a&&e.benBetTime.endTime>a)&&!(e.benBetTime2.startTime<=a&&e.benBetTime2.endTime>a))},getScheduleStr:function(){if(!this.matchData||!this.matchData.top)return"";var e="";switch(this.matchData.top){case game.MatchVsType.VS16:e=game.Lang.get(6098);break;case game.MatchVsType.VS8:e=game.Lang.get(6099);break;case game.MatchVsType.VS4:e=game.Lang.get(6200);break;case game.MatchVsType.VS2:e=game.Lang.get(6201)}return e},getScheduleTimeStr:function(){if(!this.matchData||!this.matchData.top)return"";var e=this.getTopTime(this.matchData.top),t=(game.SysTime.curTime,0!=b8e.TimeUtil.getDay(e.startTime)?b8e.TimeUtil.getDay(e.startTime):7),a=7==t?game.Lang.get(9386):game.CCommonUtil.replaceChineseNum(t),i=e.timeArr[0].split("|");return game.Lang.get(6096,a,i[1])},getTopTime:function(e){var t;switch(e){case game.MatchVsType.VS16:t=this.top16Time;break;case game.MatchVsType.VS8:t=this.top8Time;break;case game.MatchVsType.VS4:t=this.top4Time;break;case game.MatchVsType.VS2:t=this.top2Time}return t},isPrediction:function(){return!!(this.matchData&&this.matchData.matches.length&&this.matchData.prediction&&this.matchData.prediction.matchId)},getBetRoleId:function(){var e=this,t=0;if(e.matchData&&e.isPrediction()){for(var a,i=e.matchData.prediction.matchId,n=e.matchData.prediction.win,s=e.matchData.matches,r=0,o=s.length;r<o;r++)(a=s[r]).id==i&&(t=1==n?a.player1.roleId:a.player2.roleId);return t}},getIsBetMatch:function(e){return!!this.isPrediction()&&this.matchData.prediction.matchId==e},getMatchZoneList:function(){var e,t=this;if(t.clearList(t.matchZoneList),!t.matchData||!t.matchData.zones)return t.matchZoneList;for(var a=t.matchData.zones,i=0,n=0,s=0,r=0,o=a.length;r<o;r++){n=a[r].type,s=a[r].count;for(var g=0;g<s;g++)i++,(e=game.AllServerWarZoneInfo.get()).index=i,e.type=n,e.group=g+1,t.matchZoneList.push(e)}return t.matchZoneList},getCurZone:function(){var e,t=this;if(!t.matchData||!t.matchZoneList.length)return null;for(var a=0,i=t.matchZoneList.length;a<i;a++)if((e=t.matchZoneList[a]).type==t.matchData.type&&e.group==t.matchData.group)return e;return null}});game.allServerWarData=game.allServerWarData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({index:0,type:0,group:0,recycle:function(){this.reset(),this._super()},reset:function(){this.index=0,this.type=0,this.group=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$AllServerWarZoneInfo",t)}(),function(){var e=game.Control.extends({init:function(){this.alertOptions={lang:6071,langArgs:null,okcb:this.onClickGameAlert,thisArg:this,args:null}},ipc:function(){this.evts={WorldChallengeBet:{C_BET_RESP:this.betResp,C_GET_BET_RESP:this.betDataResp}}},lookBet:function(e){game.allServerWarData.betMatchId=e;var t={};t.matchId=e,t.type=game.MatchType.ALL_SERVER,this.dpt(this.Evts.C_GET_BET_REQ,t)},notify:function(e,t){switch(e){case this.Evts.C_BET_LOOK:this.lookBet(t);break;case this.Evts.C_BATTLE_LOG_LOOK:game.allServerWarData.lookMatchInfo=t,game.module.show(game.ME.AllServerWarLog)}},betResp:function(e){var t=e.data;game.allServerWarData.betData.roleId=t.roleId,game.allServerWarData.betData.type=t.type;var a=game.allServerWarData.betData.player1.roleId==t.roleId?1:2;game.allServerWarData.matchData.prediction={matchId:game.allServerWarData.betMatchId,win:a},this.dpt(this.Evts.C_BET_COMPLETE),this.send(this.Evts.V_BET_COMPLETE)},betDataResp:function(e){var t=e.data;game.allServerWarData.betData=t,game.allServerWarData.betIndex=t.win?t.win:1,game.module.show(game.ME.AllServerWarBet)},roleNode1:function(){null!=game.allServerWarData.betData&&(0==game.allServerWarData.betData.type?(game.allServerWarData.betIndex=1,this.send(this.Evts.V_BET_SELECT,1)):game.notice.show(9385))},roleNode2:function(){null!=game.allServerWarData.betData&&(0==game.allServerWarData.betData.type?(game.allServerWarData.betIndex=2,this.send(this.Evts.V_BET_SELECT,2)):game.notice.show(9385))},betIcon1:function(){game.allServerWarData.selectBetType=game.AllServerWarBetType.LOW,this.showTips()},betIcon2:function(){game.allServerWarData.selectBetType=game.AllServerWarBetType.MIDDLE,this.showTips()},betIcon3:function(){game.allServerWarData.selectBetType=game.AllServerWarBetType.HIGH,this.showTips()},showTips:function(){game.module.show(game.ME.AllServerWarBetTips)},betBtn1:function(){this.matchPredictionReq(game.AllServerWarBetType.LOW)},betBtn2:function(){this.matchPredictionReq(game.AllServerWarBetType.MIDDLE)},betBtn3:function(){this.matchPredictionReq(game.AllServerWarBetType.HIGH)},matchPredictionReq:function(e){if(null!=game.allServerWarData.betData){var t=game.allServerWarData.betData,a=game.allServerWarData.betMatchId,i=game.MatchType.ALL_SERVER,n=1==game.allServerWarData.betIndex?t.player1.roleId:t.player2.roleId,s=game.BetsCfg.getData(e).betCost[0];if(s){var r=game.ItemInfoCfg.getData(s.Id);this.alertOptions.langArgs=[s.Num+r.name],this.alertOptions.args=[i,e,a,n],game.alert.showTwo(this.alertOptions)}}},onClickGameAlert:function(e,t,a,i){var n={};n.func=e,n.type=t,n.matchId=a,n.roleId=i,this.dpt(this.Evts.C_BET_REQ,n)}}),t=[game.ME.AllServerWarBetTips];b8e.module.registerControl(game.ME.AllServerWarBet,e,game.AllServerWarEvts,null,t)}(),function(){var e=game.Control.extends({intervalTime:0,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.ALL_SERVER_WAR,game.SAE.ARENA)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},AllServerWarBet:{C_BET_COMPLETE:this.betComplete},WorldChallenge:{C_UPDATE_MATCH:this.matchDataResp}}},triggerOpen:function(e){e==this.moduleEnum&&(game.allServerWarData.initOpenTime(),this.matchDataReq(),this.checkStartTime())},resetDaily:function(){game.moduleOpen.checkOpen(game.ME.AllServerWar)&&(game.allServerWarData.initOpenTime(),this.matchDataReq())},matchDataReq:function(e,t){var a=0<arguments.length&&void 0!==e?e:0,i=1<arguments.length&&void 0!==t?t:0,n={};n.matchType=game.MatchType.ALL_SERVER,n.type=a,n.group=i,this.dpt(this.Evts.C_GET_MATCH_REQ,n)},betComplete:function(){this.changeBetState(),this.send(this.Evts.V_UPDATE_MATCH)},notify:function(e,t){var a=this;switch(e){case a.Evts.C_GET_DATA:a.matchDataReq();break;case a.Evts.C_SELECT_ZONE:if(!t)return;a.matchDataReq(t.type,t.group),a.send(a.Evts.HIDE_ZONE_LIST)}},matchDataResp:function(e){var t=e.data;game.MatchType.ALL_SERVER==t.func&&(game.allServerWarData.setData(t),this.changeBetState(),this.send(this.Evts.V_UPDATE_MATCH))},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.WORLD_SHOP)},checkStartTime:function(){var e=this;e.taskTimer||(e.intervalTime=0,e.taskTimer=b8e.Timer.add(e,e.updateTime,1e3),e.taskTimer.start())},updateTime:function(){var e=this,t=game.allServerWarData;t.isShowView&&t.checkOpenElimination()&&(e.intervalTime++,10==e.intervalTime&&(e.matchDataReq(),e.intervalTime=0));var a=game.allServerWarData.matchData;a&&a.top&&t.checkCanBet()!=t.canBet&&(e.changeBetState(),e.send(e.Evts.V_UPDATE_MATCH))},changeBetState:function(){var e=game.allServerWarData.checkCanBet();this.spotAlert.alert=e,game.allServerWarData.canBet=e}});b8e.module.registerControl(game.ME.AllServerWar,e,game.AllServerWarEvts)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={WorldChallengeLog:{C_BATTLE_LOG_RESP:this.battleLogResp}}},battleLogResp:function(e){var t=e.data;if(t.type==game.MatchType.ALL_SERVER){var a=t.log,i={type:game.InstanceType.ALL_SERVER_WAR,exp:0};game.playBack.play(a.battlelog,i),game.module.hide(game.ME.AllServerWarLog)}},notify:function(e,t){switch(e){case this.Evts.C_CHECK_BTTALE_LOG:if(!t)return;this.dpt(this.Evts.C_BATTLE_LOG_REQ,t)}}});b8e.module.registerControl(game.ME.AllServerWarLog,e,game.AllServerWarEvts)}(),function(){var e;e=game.Widget.extends({isInit:!1,ctor:function(){this._super(36)},init:function(){this.isInit=!0},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){if(this.isInit){var e=this.skin;e.descLab.string=game.Lang.get(6208),e.applyBtn.node.active=!1,e.applyGrayBtn.node.active=!1}},applyBtn:function(){},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$AllServerWarApplyView",e)}(),function(){var e;e=game.WorldChallengeBattleLogItem.extends({lookBtn:function(){this.send(game.AllServerWarEvts.C_CHECK_BTTALE_LOG,this.data.battleId)}}),b8e.RC("$$game","$$AllServerWarBattleLogItem",e)}(),function(){var e=game.MatchBetView.extends({ctor:function(){this._super(37)},init:function(){this.betCfg=game.BetsCfg,this.data=game.allServerWarData,this._super()}});b8e.module.registerView(game.ME.AllServerWarBetTips,e)}(),function(){var e=game.MatchBetView.extends({ctor:function(){this._super(38)},init:function(){this.data=game.allServerWarData,this.betType=game.AllServerWarBetType,this.betCfg=game.BetsCfg,this._super()}});b8e.module.registerView(game.ME.AllServerWarBet,e)}(),function(){var e=game.MatchLogView.extends({ctor:function(){this._super(39)},init:function(){this.skin;var e=this.battleList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.AllServerWarBattleLogItem,e.bindEnum=game.ME.AllServerWarLog,e.addToParent(this.skin.list),e.layout.spacingY=5,this.data=game.allServerWarData}});b8e.module.registerView(game.ME.AllServerWarLog,e)}(),function(){var e;e=game.Widget.extends({isInit:!1,ctor:function(){this._super(40)},init:function(){var e=this,t=(e.skin,e.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical));t.itemRender=game.WorldChallengeRankItem,t.addToParent(e.skin.rankList),t.layout.spacingY=5;var a=e.logList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.WorldChallengeMyLogItem,a.addToParent(e.skin.myList),a.layout.spacingY=5,e.isInit=!0},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){if(this.isInit){var e=this.skin,t=game.allServerWarData,a=(t.matchData,t.getEliminationRankList()),i=t.getEliminationMatchList();e.titleLab.node.active=!1,e.title_bg.node.active=!1,t.myPlayerInfo?(e.myRankLab.string=t.myPlayerInfo.rank,e.myIntegralLab.string=t.myPlayerInfo.score):(e.myRankLab.string=game.Lang.get(9387),e.myIntegralLab.string="0"),this.rankList.setData(a),this.logList.setData(i)}},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$AllServerWarRankView",e)}(),function(){var e=game.View.extends({applyView:null,rankView:null,vsView:null,curView:null,ctor:function(){this._super(41)},init:function(){this.skin.title.node.active=!1},notify:function(e){var t=this;switch(e){case t.Evts.V_UPDATE_MATCH:t.updateView();break;case t.Evts.HIDE_ZONE_LIST:t.vsView&&t.vsView.hideZoneList()}},onShow:function(){game.allServerWarData.isShowView=!0,this.send(this.Evts.C_GET_DATA),this.updateView()},onHide:function(){game.allServerWarData.isShowView=!1},updateView:function(){this.showView(),this.curView&&this.curView.updateView()},showView:function(){var e=game.SysTime.curTime,t=(b8e.TimeUtil.formatTimestamp(e),this),a=t.skin;a.contianer.removeAllChildren(),t.curView=null,game.allServerWarData.getIsEliminationIng()?(t.rankView||(t.rankView=new game.AllServerWarRankView),t.curView=t.rankView):game.allServerWarData.getIsTopIng()?(t.vsView||(t.vsView=new game.AllServerWarVsView),t.curView=t.vsView):(t.applyView||(t.applyView=new game.AllServerWarApplyView),t.curView=t.applyView),t.curView&&(t.curView.bindEnum=game.ME.AllServerWar,a.contianer.addChild(t.curView))},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.AllServerWar,e)}(),function(){var e;e=game.MatchVsView.extends({ctor:function(){this._super(42)},init:function(){var e=this;e.data=game.allServerWarData,e.evtsClass=game.AllServerWarEvts,e.itemBindEnum=game.ME.AllServerWarBet,e.itemSkin="match/MatchVsItem";var t=e.zoneList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.AllServerWarZoneItem,t.bindEnum=game.ME.AllServerWar,t.addToParent(e.skin.downList),t.layout.spacingY=-1,e.skin.titleBg.active=!1,e.skin.titleLab.active=!1,e.skin.matchZone.active=!0,e._super()},updateView:function(){var e=this;if(e._super(),e._isInit){e.skin.titleLab.string=e.data.getGroupLevel(e.data.matchData.type);var t=e.data.getMatchZoneList();if(e.zoneList.setData(t),t){e.skin.matchZone.node.active=!0;var a=e.data.getCurZone();a&&(e.skin.curZoneLab.string=game.Lang.get(9602,a.index))}else e.skin.matchZone.node.active=!1}},downBtn:function(){this.skin.downBg.node.active=!this.skin.downBg.node.active,this.skin.downList.node.active=!this.skin.downList.node.active},hideZoneList:function(){this.skin.downBg.node.active=!1,this.skin.downList.node.active=!1}}),b8e.RC("$$game","$$AllServerWarVsView",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(43),this.setSize(170,27)},setData:function(){var e=this.skin,t=this.data;e.zoneLab.string=game.Lang.get(9602,t.index)},zoneBtn:function(){this.send(game.AllServerWarEvts.C_SELECT_ZONE,this.data)}}),b8e.RC("$$game","$$AllServerWarZoneItem",e)}(),function(){var e;e=b8e.Enum({None:0,V2C_SHOW:-1,C2V_UPDATE_LIST:-1,C2V_RECYCLE_SURFACE:-1}),b8e.RC("$$game","$$RecycleSurfaceEvts",e)}(),function(){var e;e=b8e.Enum({None:0,NICK_NAME:1,SKIN:2}),b8e.RC("$$game","$$RecycleSurfaceType",e)}(),function(){var e;e=b8e.Enum({None:0,FASHION:5}),b8e.RC("$$game","$$SurfaceSkinType",e)}(),function(){var e=b8e.Object.extends({power:0,setRecycleList:function(){var e=this;e.tempList||(e.tempList=[]),e.tempList.length=0;var t=game.itemData.getListByItemType(game.ItemType.Surface);if(!t||t.length<1)return e.tempList;for(var a=8,i=void 0,n=void 0,s=t.length,r=0;r<s;r++){if(a<1)return;if(i=t[r],e.getSurfaceIsIsActive(i)&&((n=game.itemData.getNumById(i))&&!(n<1))){a<n&&(n=a),a-=n;for(var o=0;o<n;o++)e.tempList.push(i)}}},getRecycleList:function(){return this.tempList},sysData:function(e){var t=this;if(t.initSpriteStat(),e&&!(e.length<1)){var a=void 0,i=void 0,n=void 0,s=void 0,r=e.length;t.spriteStat.clear();for(var o=0;o<r;o++)a=(n=e[o]).id,i=n.num,(s=game.SurfaceRecycleCfg.getData(a))&&(t.tempSpriteStat.setupByCfg(s),t.spriteStat.addSpriteStat(t.tempSpriteStat,i))}},recycleSurfaceResp:function(e){if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)t=e[n],(a=game.SurfaceRecycleCfg.getData(t))&&(this.tempSpriteStat.setupByCfg(a),this.spriteStat.addSpriteStat(this.tempSpriteStat))},initSpriteStat:function(){var e=this;e.spriteStat||(e.spriteStat=game.SpriteStat.get(),e.spriteStat.setStatValue(game.SpriteStatType.TeamHp,0),e.spriteStat.setStatValue(game.SpriteStatType.TeamAtk,0),e.spriteStat.setStatValue(game.SpriteStatType.TeamDef,0)),e.tempSpriteStat||(e.tempSpriteStat=game.SpriteStat.get())},getSpriteStat:function(){return this.spriteStat},setNextSpriteStat:function(e){var t=this;if(e&&(e.addSpriteStat(t.spriteStat),t.tempList&&!(t.tempList.length<1)))for(var a=void 0,i=void 0,n=t.tempList.length,s=0;s<n;s++)a=t.tempList[s],(i=game.SurfaceRecycleCfg.getData(a))&&(t.tempSpriteStat.setupByCfg(i),e.addSpriteStat(t.tempSpriteStat,void 0))},getSurfaceIsIsActive:function(e){var t=game.SurfaceRecycleCfg.getData(e);if(!t)return!1;var a,i=!1,n=t.surfaceId;return(a=game.surfaceData.getInfo(n))&&a.isActive&&(i=!0),i},getFTBySST:function(e){return this.list||(this.list=[game.FosterType.NONE]),this.list[e]}});game.recycleSurfaceData=game.recycleSurfaceData||new e}(),function(){var e=game.Control.extends({init:function(){this.spotAlert1=game.spotAlert.set(game.SAE.RECYCLE_SURFACE1_ALERT,game.SAE.SURFACE)},ipc:function(){var e=this;e.evts={Back:{C_BACK_SYN_BACK_INFO:e.updateSurface,C2C_UPDATE_SURFACE:e.updateSurface,C2C_REMOVE_SURFACE:e.removeSurface},Surface:{UPDATE_MODULE_DATA:e.sysSurfaceModel}},e.handels={RecycleSurfaceResp:e.recycleSurfaceResp}},recycleSurfaceResp:function(e){this.selling=!1;var t=e.readProtobuf(game.pb.RecycleSurfaceResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.FightAmount.inst().showTeamStatPower(),game.recycleSurfaceData.recycleSurfaceResp(t.ids);var a=t.ids.length;this.send(this.Evts.C2V_RECYCLE_SURFACE,a)}},sysSurfaceModel:function(e){e&&e.data&&game.recycleSurfaceData.sysData(e.data.recycles)},removeSurface:function(){this.updateSurface(),this.setRecycleList()},updateSurface:function(){if(game.moduleOpen.checkOpen(game.ME.Surface)){var e=game.itemData.getListByItemType(game.ItemType.Surface);if(!e||e.length<1)this.checkAlert(!1);else{for(var t=void 0,a=e.length,i=!1,n=0;n<a&&(t=e[n],!(i=game.recycleSurfaceData.getSurfaceIsIsActive(t)));n++);this.checkAlert(i)}}else this.checkAlert(!1)},notify:function(e){switch(e){case this.Evts.V2C_SHOW:this.selling=!1,this.setRecycleList()}},setRecycleList:function(){game.recycleSurfaceData.setRecycleList(),this.send(this.Evts.C2V_UPDATE_LIST)},recycleBtn:function(){var e=game.recycleSurfaceData.getRecycleList();!e||e.length<1?game.notice.show(9287):(this.selling=!0,this.sender.RecycleSurfaceReq(e))},checkAlert:function(e){this.spotAlert1.alert=e}}),t=game.Sender.extends({ipc:function(){this.msg={RecycleSurfaceReq:this.recycleSurfaceReq}},recycleSurfaceReq:function(e){var t=game.pb.RecycleSurfaceRequest;t.ids=e,b8e.net.getBytes().writeProtobuf(t)}});b8e.module.registerControl(game.ME.RecycleSurface,e,game.RecycleSurfaceEvts,t)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super(906)},init:function(){var e=this,t=e.gridList=[];e.itemInfoList=[],e.tempIds=[],e.animaList=[];for(var a=void 0,i=void 0,n=void 0,s=0;s<8;s++){e.itemInfoList[s]=game.ItemInfo.get(),(a=t[s]=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105)).addToParent(e.skin.list),i=s%4*146+40,n=s<4?-53:-163,a.x=i,a.y=n,game.GridUtil.setItemIcon(a,null,!0,game.IconLayoutEnum.SHOW_NONE);var r=e.animaList[s]=b8e.Animator.get(game.AnimType.UI_EFFECT,s);r.addToParent(e.skin.list),r.load(game.ResCfg.getUrl(5019,1008)),r.setVisible(!1),r.x=i,r.y=n,r.addFinishCallback(e.finishFun,e,r)}},finishFun:function(e){e&&e.setVisible(!1)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_UPDATE_LIST:a.updateGridList(),a.setNewSpriteLab();break;case a.Evts.C2V_RECYCLE_SURFACE:a.clearGridList(),a.setCurSpriteLab(),a.setPower(),a.recycleSurface(t)}},recycleSurface:function(e){for(var t=0;t<e;t++)this.animaList[t].setVisible(!0),this.animaList[t].play(null,0)},onShow:function(){var e=this;e.setAnima(),e.setCurSpriteLab(),e.setPower(),e.send(e.Evts.V2C_SHOW)},onHide:function(){},setCurSpriteLab:function(){var a=this,e=(a.skin,game.recycleSurfaceData.getSpriteStat());if(e){var i=0,n="",s=void 0;e.getSpriteStats().forEach(function(e,t){s=game.AttrRulesCfg.getData(e),n=game.Lang.get(51448,s.name,t),a.getComponent("spriteLab_1_"+i).string=n,a.getComponent("spriteLab_2_"+i).string=n,i++},a)}},setNewSpriteLab:function(){var a=this;a.nextSpriteStat||(a.nextSpriteStat=game.SpriteStat.get()),a.nextSpriteStat.setZero(),game.recycleSurfaceData.setNextSpriteStat(a.nextSpriteStat);var i=0,n="",s=void 0,e=a.nextSpriteStat.getSpriteStats();a.skin;e.forEach(function(e,t){s=game.AttrRulesCfg.getData(e),n=game.Lang.get(51448,s.name,t),a.getComponent("spriteLab_2_"+i).string=n,i++},a)},updateGridList:function(){var e=game.recycleSurfaceData.getRecycleList();if(!e||e.length<1)this.clearGridList();else for(var t=void 0,a=e.length,i=this.gridList,n=this.itemInfoList,s=0;s<a;s++)t=e[s],n[s].id=t,game.GridUtil.setItemIcon(i[s],n[s],!0,game.IconLayoutEnum.SHOW_NONE)},clearGridList:function(){for(var e=this.gridList,t=e.length,a=0;a<t;a++)e[a].setItemInfo(null,!0)},setPower:function(){var e=this.skin,t=game.recycleSurfaceData.getSpriteStat();if(t){var a=game.CCommonUtil.getPower(t);e.lab_power.string=a,game.AutoLayoutUtil.layoutPower(e.img_power,e.lab_power,e.img_power0,e.btn_pre)}else e.lab_power.string=0},setAnima:function(){var e=this;if(game.mainRoleData){e.model||(e.model=game.sceneRoleCreate.createUIRole(game.mainRoleData),e.model.addToParent(e.skin.node_model));var t=game.AvatarUtil;if(t.updateAmbition(e.model),!e.followModel){var a=this.followData=game.BaseRoleData.get(game.RoleType.Rank,1);this.followModel=game.sceneRoleCreate.createUIRole(a),this.followModel.addToParent(this.skin.followModelNode)}t.updateUIModel(e.model),e.model.transition(game.RoleStateType.ACTION_IDLE),t.updateUIModel(e.followModel,t.ID_5),e.followModel.transition(game.RoleStateType.ACTION_IDLE)}},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.RecycleSurface,e)}(),function(){var e;e=b8e.Enum({NONE:0,V_UPDATE_ACTIVITY:-1,V_FOLLOW_CHAT:-1,C_GET_ACTIVITY:-1,V_TOGGLECHANGE:-1,V_UPDATE_RANK:-1,C_GET_RANK:-1,V_UPDATE_LEFT_RANK:-1,V_UPDATE_SCORE:-1,V_UPDATE_HP:-1,V_UPDATE_TS:-1,C2V_SKILL_HIT:-1}),b8e.RC("$$game","$$GuildWarEvts",e)}(),function(){var e,t,a;a=b8e.Enum({None:0,HLG:1,LY:2,HG:3,LD:4}),t=b8e.Enum({None:0,GUILD:1,SINGE:2,HIT:3}),e=b8e.Enum({None:0,GUILD_WAR_GUILD:1,GUILD_WAR_PERSONAL:2,GUILD_WAR_BOSS_GUILD:3,GUILD_WAR_BOSS_PERSONAL:4}),b8e.RC("$$game","$$GuildWarLevelType",a),b8e.RC("$$game","$$GuildWarAwardType",t),b8e.RC("$$game","$$GuildWarRankType",e)}(),function(){var e;e=b8e.Object.extends({prizesInfo:null,range:"",type:0,setData:function(e){this.range=e.range,this.prizesInfo=game.CfgUtil.getPrizeListInfo(e.items,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildWarAwardInfo",e)}(),function(){var e=b8e.Object.extends({guildWarIsOpen:!1,startTime:0,endTime:0,canTeam:!1,guildWarActivity:null,singeAwardList:null,guildAwardList:null,hitAwardList:null,singeRankList:null,guildRankList:null,scoreRankList:null,mySingeRank:null,myGuildRank:null,myScoreRank:null,collected:0,topRanks:null,curMyRanks:null,num:0,hgNum:0,settlementInfo:null,layer:0,score:0,hgEnter:null,isAutoChallenge:!1,isClickChallenge:!1,endCDTime:0,ctor:function(){var e=this;this._super(),e.singeAwardList=[],e.guildAwardList=[],e.hitAwardList=[],e.singeRankList=[],e.guildRankList=[],e.scoreRankList=[],e.bossInfo={hp:0,maxHp:1,shield:0,maxShield:1},e.monsterTs=[0,0,0,0]},getPreviewAward:function(){if(this.prizesInfo)return this.prizesInfo;for(var e,t=game.CsMiscCfg.getData("guildWarPreview").value.split("|"),a=[],i=0;i<t.length;i++){var n=t[i].split(" "),s=n[0].split(":"),r=n[1].split(":");(e={}).Id=s[1],e.Num=r[1],a[i]=e}return this.prizesInfo=game.CfgUtil.getPrizeListInfo(a),this.prizesInfo},challengeDistance:{get:function(){if(!this._challengeDistance){var e=game.CsMiscCfg.getData("guildWarDis");this._challengeDistance=e&&e.value?+e.value:9999}return this._challengeDistance}},getStartTime:function(){var e=this;if(0<e.startTime)return e.startTime;var t=e.getOpenTimeArr();if(!t||t.length<1)return 0;var a=t[0];return e.startTime=b8e.TimeUtil.dateParse(a,"hh:mm").getTime(),e.startTime},getEndTime:function(){var e=this;if(0<e.endTime)return e.endTime;var t=e.getOpenTimeArr();if(!t||t.length<1)return 0;var a=t[t.length-1];return e.endTime=b8e.TimeUtil.dateParse(a,"hh:mm").getTime(),e.endTime},getOpenDays:function(){if(!this.guildWarOpenDays||this.guildWarOpenDays.length<1){var e=game.CsMiscCfg.getData("guildWarDays");if(!e||""==e.value)return!1;this.guildWarOpenDays=e.value.split("|")}return this.guildWarOpenDays},getOpenTimeArr:function(){if(!this.guildWarOpenTimeArr||this.guildWarOpenTimeArr.length<1){var e=game.CsMiscCfg.getData("guildWarTime");if(!e||""==e.value)return!1;this.guildWarOpenTimeArr=e.value.split("-")}return this.guildWarOpenTimeArr},getAwardListByType:function(e){var t,a,i;switch(e){case game.GuildWarAwardType.GUILD:a=this.guildAwardList,t=game.GuildWarGuildScoreRankAwardCfg.getDatas();break;case game.GuildWarAwardType.SINGE:a=this.singeAwardList,t=game.GuildWarPersonalScoreRankAwardCfg.getCurDayCfgs();break;case game.GuildWarAwardType.HIT:a=this.hitAwardList,t=game.GuildWarBossRankAwardCfg.getDatas()}if(a&&a.length)return a;for(var n=0,s=t.length;n<s;n++)(i=new game.GuildWarAwardInfo).type=e,i.setData(t[n]),a.push(i);return a},resetDaily:function(){this.singeAwardList=[]},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},setRankList:function(e,t){var a,i=this;switch(e){case game.GuildWarRankType.GUILD_WAR_BOSS_PERSONAL:a=i.singeRankList,i.mySingeRank=t.urank;break;case game.GuildWarRankType.GUILD_WAR_BOSS_GUILD:a=i.guildRankList,i.myGuildRank=t.urank;break;case game.GuildWarRankType.GUILD_WAR_PERSONAL:a=i.scoreRankList,i.myScoreRank=t.urank}var n,s=t.rank;if(!a||!s)return null;i.clearList(a);for(var r=0,o=s.length;r<o;r++)(n=game.GuildWarRankInfo.get()).type=e,n.setData(s[r]),a.push(n)},getSettementAward:function(e){for(var t,a=0,i=game.GuildWarPersonalScoreRankAwardCfg.getCurDayCfgs(),n=null,s=0,r=i.length;s<r;s++)e>=(t=i[s]).rank&&a<t.rank&&(a=t.rank);var o=game.GuildWarPersonalScoreRankAwardCfg.getCfgByRank(a);return o&&(n=game.CfgUtil.getPrizeListInfo(o.items)),n},getIsOpen:function(e){var t=0<arguments.length&&void 0!==e&&e;return!!game.moduleOpen.checkOpenWithTips(game.ME.GuildWar,t)&&(!!this.isFitOpen()||(t&&game.notice.show(9423),!1))},isFitOpen:function(){return!!this.isFitWeek()&&!!this.isFitTime()},isFitWeek:function(){var e=this.getOpenDays();if(!e||e.length<1)return!1;var t=b8e.TimeUtil.getDay(game.SysTime.curTime);return-1!=e.indexOf(t+"")},isFitTime:function(){var e=this.getOpenTimeArr();if(!e||e.length<1)return!1;var t=game.SysTime.curTime,a=this.getStartTime(),i=this.getEndTime();return a<=t&&t<=i},updeteUnclaimedScores:function(){var e=this,t=e.getFitScoreArr();if(t&&!(t.length<1)){e._unclaimedScoreArr?e._unclaimedScoreArr.length=0:e._unclaimedScoreArr=[];for(var a,i=0,n=t.length;i<n;i++)(a=t[i])>e.collected&&e._unclaimedScoreArr.push(a)}},getUnclaimedScores:function(){return this._unclaimedScoreArr},getFitScoreArr:function(){var e=game.GuildWarScoreAwardCfg.getDatas();if(!e||e.length<1)return null;var t=this;t._fitScoreArr?t._fitScoreArr.length=0:t._fitScoreArr=[];for(var a,i=0,n=e.length;i<n;i++)a=e[i],t.score>=a.score&&t._fitScoreArr.push(a.score);return t._fitScoreArr},getRemainArr:function(){var e=this,t=game.GuildWarScoreAwardCfg.getDatas();if(!t||t.length<1)return null;e._collectedArr?e._collectedArr.length=0:e._collectedArr=[];for(var a,i=0,n=t.length;i<n;i++)(a=t[i]).score>e.score&&e._collectedArr.push(a.score);return e._collectedArr},getMonsterConfigId:function(e){var t=this._key;(t=t||(this._key={})).index=e;var a=game.GuildWarBossScoreCfg.getData(t);return a?a.bossId:0},getMonsterIndex:function(e){var t=this._key1;(t=t||(this._key1={})).bossId=e;var a=game.GuildWarBossScoreCfg.getData(t);return a?a.index:-1},isCanAutoChallage:function(e){var t=0<arguments.length&&void 0!==e&&e,a=game.csWarTeamData;return!a||(!(a.isInTeam&&!a.isLeader)||(t&&game.notice.show(6530),!1))},clearMonsterTs:function(){var e=game.guildWarData.monsterTs;if(e)for(var t=0,a=e.length;t<a;t++)e[t]=0},setEndCDTime:function(){var e=game.throneData.getThroneCoolTime();this.endCDTime=game.SysTime.curTime+e*b8e.TimeUtil.SECOND_MICRO_SECONDS},isEndCD:function(){var e=game.SysTime.curTime;if(0<this.endCDTime&&this.endCDTime>e){var t=(this.endCDTime-e)/1e3>>0;return 0<t&&game.notice.show(3821,t),!1}return!0}});game.guildWarData=game.guildWarData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",zone:0,score:0,guildId:0,guildName:"",rank:0,type:0,setData:function(e){var t=this;t.name=e.name,t.zone=e.zone,t.score=e.score,t.guildId=e.guildId,t.guildName=e.guildName,t.rank=e.rank},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.name="",e.zone=0,e.score=0,e.guildId=0,e.guildName="",e.rank=0,e.type=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildWarRankInfo",t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(545),this.setSize(598,148)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.ShowItemListItem,t.layout.spacingX=20,t.addToParent(e.skin.list)},setData:function(){var e=this.skin,t=this.data;this.prizeList.setData(t.prizesInfo.items);var a=game.GuildWarAwardType;t.type==a.GUILD&&(e.rankDesc.string=game.Lang.get(9516,t.range)),t.type==a.SINGE&&(e.rankDesc.string=game.Lang.get(9517,t.range)),t.type==a.HIT&&(e.rankDesc.string=game.Lang.get(9518,t.range))}}),b8e.RC("$$game","$$GuildWarAwardItem",e)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={},this.handels={GuildWarRankResp:this.guildWarRankResp}},guildWarRankResp:function(e){var t=e.readProtobuf(game.pb.GuildWarRankResponse);0<t.code?game.notice.noticeError(t.code):(game.guildWarData.setRankList(t.type,t),this.send(this.Evts.V_UPDATE_RANK))},notify:function(e,t){switch(e){case this.Evts.C_GET_RANK:this.sender.GuildWarRankReq(t)}},btn1:function(){this.selectToggle(0)},btn2:function(){this.selectToggle(1)},btn3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={GuildWarRankReq:this.guildWarRankReq}},guildWarRankReq:function(e){var t=game.pb.GuildWarRankRequest;t.type=e,this.write(t)}}),a=[game.ME.GuildWarRankSinge,game.ME.GuildWarRankGuild,game.ME.GuildWarRankScore];b8e.module.registerControl(game.ME.GuildWarRank,e,game.GuildWarEvts,t,a)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily}}},resetDaily:function(){game.guildWarData.resetDaily(),game.GuildWarPersonalScoreRankAwardCfg.resetDaily(),this.send(this.Evts.C2V_RESET_DAILY)},btn1:function(){this.selectToggle(0)},btn2:function(){this.selectToggle(1)},btn3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}}),t=[game.ME.GuildWarAwardGuild,game.ME.GuildWarAwardSinge,game.ME.GuildWarAwardHit];b8e.module.registerControl(game.ME.GuildWarAward,e,game.GuildWarEvts,null,t)}(),function(){var e=game.Control.extends({ipc:function(){this.gevts={InstanceEvts:{G_SKILL_HIT:this.onSkillHit}}},onSkillHit:function(e){if(b8e.module.isShowView(game.ME.GuildWarPlay)){var t=e.data;if(t&&t.roleData.type==game.RoleType.Monster){var a=this;game.MonsterCfg.getDataAsync(t.roleId,function(e){e&&1==e.type&&a.send(a.Evts.C2V_SKILL_HIT,t)},a)}}}});b8e.module.registerControl(game.ME.GuildWarPlay,e,game.GuildWarEvts,null)}(),function(){var e=game.View.extends({ctor:function(){this._super(544)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildWarAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){var e=game.guildWarData.getAwardListByType(game.GuildWarAwardType.GUILD);this.prizeList.setData(e)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildWarAwardGuild,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(544)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildWarAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){var e=game.guildWarData.getAwardListByType(game.GuildWarAwardType.HIT);this.prizeList.setData(e)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildWarAwardHit,e)}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:6012,okcb:this.onClickGameAlert,cancelCloseCb:!0,thisArg:this},this.chat={chatType:game.ChatChannelType.CROSS,marqueeKey:"guild_war_open",funcType:game.ChatFuncType.CHAT_FUNC_GUILD_WAR}},ipc:function(){var e=this;e.evts={CsActivity:{C2C_GUILDWAR_GOTO:e.openGuildWar},CsWarTeam:{C2C_JOIN_TEAM:e.joinTeam,C2C_LEAVE_TEAM:e.exitTeam}},e.gevts={SceneGEvts:{MAIN_MOVE_COMPLETE:e.onMoveComplete,SCENE_GUILD_WAR_CHALLENGE:e.onChallenge,SCENE_GUILD_WAR_SNATCH:e.onSnatch,MAIN_ROLE_DIE:e.mainRoleDie,TOWER_STATE:e.towerStateMsg,MAIN_ROLE_REVIVE:e.onRevive},InstanceEvts:{G_STOP_PLAY:e.playEnd}},e.handels={GuildWarActivityResp:e.guildWarActivityResp,GuildWarHlgChallengeResp:e.guildWarHlgChallengeResp,GuildWarScoreAwardResp:e.guildWarScoreAwardResp,GuildWarMsg:e.guildWarMsg,GuildWarScoreMsg:e.guildWarScoreMsg,GuildWarRankMsg:e.guildWarRankMsg,GuildWarJoinResp:e.guildWarJoinResp,GuildWarChallengeResp:e.guildWarChallengeResp,GuildWarChallengeMsg:e.guildWarChallengeMsg,GuildWarBattleMsg:e.guildWarBattleMsg,GuildWarMemberMsg:e.guildWarMemberMsg,GuildWarBossMsg:e.guildWarBossMsg,GuildWarOwnerDataResp:e.guildWarOwnerDataResp}},sendChat:function(e,t){var a=1<arguments.length&&void 0!==t?t:null,i=this;game.moduleOpen.checkOpen(i.moduleEnum)&&(i.chat.params=a,i.chat.clientParams=null,i.chat.marqueeKey=e,game.chatData.addChat(i.chat),i.dptG(game.ChatEvts.SHOW_CLIENT_CHAT,null))},openGuildWar:function(){game.moduleOpen.checkOpenWithTips(game.ME.GuildWar,!0)&&(game.module.show(game.ME.GuildWar),game.module.hide(game.ME.ActivitiesHall))},triggerOpen:function(e){e==this.moduleEnum&&this.sender.GuildWarActivityReq()},notify:function(e){switch(e){case this.Evts.C_GET_ACTIVITY:this.sender.GuildWarActivityReq()}},guildWarActivityResp:function(e){var t=e.readProtobuf(game.pb.GuildWarActivityResponse);if(0<t.code)game.notice.noticeError(t.code);else{t.state;game.guildWarData.guildWarIsOpen=game.guildWarData.getIsOpen(),game.guildWarData.guildWarActivity=t,game.guildWarData.collected=t.collected,this.send(this.Evts.V_UPDATE_ACTIVITY)}},guildWarHlgChallengeResp:function(e){var t=e.readProtobuf(game.pb.GuildWarHlgChallengeResponse);if(0<t.code)return game.notice.noticeError(t.code),void(2106==t.code&&this.sender.GuildWarActivityReq());var a={type:game.InstanceType.GUILD_WAR,exp:0,rewards:t.pbItems};game.playBack.play(t.battlelog,a)},guildWarScoreAwardResp:function(e){var t=e.readProtobuf(game.pb.GuildWarScoreAwardResponse);0<t.code?game.notice.noticeError(t.code):(game.guildWarData.collected=t.collected,game.guildWarData.updeteUnclaimedScores(),this.send(this.Evts.V_UPDATE_SCORE))},towerStateMsg:function(e){if(game.sceneData.getSceneType()==game.SceneType.CS_GUILD_WAR_LD){var t=e.data;if(t){var a=b8e.scene.getDisplayByTypeAndId(game.RoleType.Tower,t.towerUnitId);if(a&&a.data){if(a.data.master&&0<a.data.master){var i=b8e.scene.getDisplayByTypeAndId(game.RoleType.Hero,a.data.master);i&&(i.data.guildWarOwner=!1,i.setVisible(!0))}if(t.state){a.data.master=t.playerUnitId;var n=b8e.scene.getDisplayByTypeAndId(game.RoleType.Hero,a.data.master);n&&(n.data.guildWarOwner=!0,n.setVisible(!1));this.sendChat("guild_war_snatch",t.playerName)}else a.data.master=0}}}},guildWarMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.state;if(game.guildWarData.guildWarIsOpen=a)game.moduleOpen.checkOpen(this.moduleEnum)&&game.module.show(game.ME.GuildWarQuickEntry),this.sendChat("guild_war_open");else{var i=t.guildRank,n=t.personalRank;if(i&&i.length){var s={guildRank:0,personalRank:0};s.winner=i[0];for(var r=0,o=i.length;r<o;r++)game.guildData.id==i[r].guildId&&(s.guildRank=i[r].rank);if(n)for(var g=0,u=n.length;g<u;g++)game.mainRoleData.roleId==n[g].playerId&&(s.personalRank=n[g].rank);game.guildWarData.settlementInfo=s,game.module.show(game.ME.GuildWarSettlement),this.sendChat("guild_war_paimai",i[0].guildName)}this.sendChat("guild_war_close")}}},guildWarMemberMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarMemberNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.num;game.guildWarData.num=a,game.guildWarData.hgNum=t.hgNum,this.send(this.Evts.V_UPDATE_LEFT_RANK)}},guildWarScoreMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarScoreNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.score;game.guildWarData.score=a,game.guildWarData.updeteUnclaimedScores(),this.send(this.Evts.V_UPDATE_SCORE)}},guildWarRankMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarRankNotify);if(0<t.code)game.notice.noticeError(t.code);else{for(var a=t.ranks,i=null,n=0,s=(game.guildWarData.topRanks=a).length;n<s;n++)game.guildData.id==a[n].guildId&&(i=a[n]);game.guildWarData.curMyRanks=i,this.send(this.Evts.V_UPDATE_LEFT_RANK)}},guildWarJoinResp:function(e){var t=e.readProtobuf(game.pb.GuildWarJoinResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this,i=t.score,n=t.layer,s=t.ranks,r=t.urank;game.guildWarData.score=i,game.guildWarData.num=t.players,game.guildWarData.layer=n,game.guildWarData.topRanks=s,game.guildWarData.curMyRanks=r,game.guildWarData.hgNum=t.hgPlayers,game.guildWarData.hgEnter=t.hgEnter,game.guildWarData.updeteUnclaimedScores(),a._updateBossInfo(t.hp,t.maxHp,t.shield,t.maxShield),a.send(a.Evts.V_UPDATE_LEFT_RANK),a.send(a.Evts.V_UPDATE_SCORE)}},guildWarChallengeResp:function(e){var t=e.readProtobuf(game.pb.GuildWarChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{this._monsterDie(t.monsterId,t.targetReliveTs),this._playBattleLog(t.battlelog,t.pbItems,t.pvp)}},guildWarChallengeMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarChallengeNotify);if(0<t.code)game.notice.noticeError(t.code);else{this._monsterDie(t.monsterId,t.targetReliveTs),this._playBattleLog(t.battlelog,t.pbItems,t.pvp)}},guildWarBattleMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarBattleNotify);0<t.code?game.notice.noticeError(t.code):this._playBattleLog(t.battlelog,null,!0,!0)},_playBattleLog:function(e,t,a,i){var n=3<arguments.length&&void 0!==i&&i;if(e){var s;if(2<arguments.length&&void 0!==a&&a)s=game.InstanceType.GUILD_WAR_PVP;else s=game.sceneData.getSceneType()==game.SceneType.CS_GUILD_WAR_HG?game.InstanceType.GUILD_WAR_BOSS:game.InstanceType.GUILD_WAR_PVE;var r={type:s,turn:n,rewards:t};game.playBack.play(e,r)}},guildWarOwnerDataResp:function(e){var t=e.readProtobuf(game.pb.GuildWarOwnerDataResponse);0<t.code?game.notice.noticeError(t.code):t.team&&t.team.members&&(game.csWarTeamData.setOccupiedMember(t.team.members),game.module.show(game.ME.GuildWarSnatch))},guildWarBossMsg:function(e){var t=e.readProtobuf(game.pb.GuildWarBossNotify);0<t.code?game.notice.noticeError(t.code):(game.guildWarData.hgEnter=t.hgEnter,this._updateBossInfo(t.hp,t.maxHp,t.shield,t.maxShield))},_updateBossInfo:function(e,t,a,i){var n=game.guildWarData.bossInfo;n.hp=e,n.maxHp=t||1,n.shield=a,n.maxShield=i||1;this.send(this.Evts.V_UPDATE_HP,n)},_monsterDie:function(e,t){if(e&&!(t<1)){var a=game.guildWarData.getMonsterIndex(e);if(!(a<0||3<a)){game.guildWarData.monsterTs[a]=1e3*t;this.send(this.Evts.V_UPDATE_TS)}}},onMoveComplete:function(e){var t=game.sceneData.getConfig();if(t&&(t.type==game.SceneType.CS_GUILD_WAR_LY||t.type==game.SceneType.CS_GUILD_WAR_HG||t.type==game.SceneType.CS_GUILD_WAR_LD)){switch(e.data){case game.SceneMoveType.CLICK_PLAYER:case game.SceneMoveType.CLICK_TOWER:game.challengeIcon.show(game.scenePick.target);break;case game.SceneMoveType.CLICK_MONSTER:game.guildWarData.isClickChallenge||game.guildWarData.isAutoChallenge?(game.guildWarData.isClickChallenge=!1,b8e.evt.dptG(game.SceneGEvts.SCENE_GUILD_WAR_CHALLENGE)):game.challengeIcon.show(game.scenePick.target);break;case game.SceneMoveType.CLICK_MAP:game.guildWarData.isAutoChallenge=!1,this.send(this.Evts.V_UPDATE_AUTO)}}},onSnatch:function(){this.sender.GuildWarOwnerDataReq()},onChallenge:function(){var e=game.scenePick.target;e&&e.data&&e.data.id&&this.sender.GuildWarChallengeReq(e.data.id)},rankAwardBtn:function(){game.module.show(game.ME.GuildWarAward)},enterBtn:function(){game.guildWarData.guildWarIsOpen?game.guildWarData.isEndCD()&&(game.guildWarData.guildWarActivity.state?(game.csWarTeamData.clearTeamData(),this.sender.GuildWarJoinReq(!0)):this.sender.GuildWarHlgChallengeReq()):game.notice.show(9171)},outBtn:function(){game.module.hide(game.ME.GuildWarSettlement)},lookBtn:function(){game.module.show(game.ME.GuildWarRank)},tzBtn:function(){b8e.evt.dptG(game.SceneGEvts.SCENE_AUTO_CHALLENGE)},joinNextBtn:function(){this.sender.GuildWarJoinReq(!0),game.module.hide(game.ME.GuildWarEnter)},exitBtn:function(){var e=this,t=game.mainRole.data;if(game.guildWarData.isCanAutoChallage(!0)){if(t&&!t.guildWarOwner){var a=game.sceneData.getSceneType(),i=game.SceneType;a===i.CS_GUILD_WAR_HG||a===i.CS_GUILD_WAR_LD?(e._alertOptions.lang=6543,e._alertOptions.btn=game.Lang.get(9172),e._alertOptions.cancelcb=e.onClickGameAlert,e._alertOptions.closeNotCallCancel=!0,e._alertOptions.okcb=e.returnMap):(e._alertOptions.lang=6012,e._alertOptions.btn=game.Lang.get(9173),e._alertOptions.okcb=e.onClickGameAlert,e._alertOptions.closeNotCallCancel=!1,e._alertOptions.cancelcb=null)}else e._alertOptions.lang=6536,e._alertOptions.btn=game.Lang.get(9173),e._alertOptions.cancelcb=null,e._alertOptions.closeNotCallCancel=!1,e._alertOptions.okcb=e.onClickGameAlert;game.alert.show(e._alertOptions)}},returnMap:function(){this.sender.GuildWarJoinReq(!1)},onClickGameAlert:function(){b8e.evt.dptG(game.SceneGEvts.SCENE_EXIT)},onRevive:function(){this._playEnd()},teamBtn:function(){var e=game.mainRole.data;e&&e.guildWarOwner?game.notice.show(6537):game.csWarTeamData.isInTeam?game.module.show(game.ME.CsWarBattleTeam):game.module.show(game.ME.CsWarTeam)},hgBtn:function(){if(game.guildWarData.isCanAutoChallage(!0)){var e=game.CsMiscCfg.getData("lyPlayers").value,t=game.CsMiscCfg.getData("lyScore").value;game.guildWarData.score>=t||game.guildWarData.hgNum>=e?this.sender.GuildWarJoinReq(!0):game.notice.show(9421)}},ldBtn:function(){game.guildWarData.isCanAutoChallage(!0)&&(this.canGotoLd()?game.module.show(game.ME.GuildWarEnter):game.notice.show(9422))},get_prize:function(){var e=game.guildWarData.getRemainArr(),t=game.guildWarData.getUnclaimedScores();e&&e.length||t&&t.length?this.sender.GuildWarScoreAwardReq():game.notice.show(3816)},bossName0:function(){this._clickBoss(0)},bossName1:function(){this._clickBoss(1)},bossName2:function(){this._clickBoss(2)},bossName3:function(){this._clickBoss(3)},_clickBoss:function(e){game.guildWarData.isCanAutoChallage(!0)&&this._autoChallenge(e)},_autoChallenge:function(e){var t=game.guildWarData.getMonsterConfigId(e);return 0<t&&(game.guildWarData.isClickChallenge=!0,b8e.evt.dptG(game.SceneGEvts.SCENE_AUTO_CHALLENGE,t),!0)},autoChallage:function(){game.guildWarData.isAutoChallenge&&b8e.evt.dptG(game.SceneGEvts.SCENE_AUTO_CHALLENGE)},autoChallageBtn:function(){game.guildWarData.isCanAutoChallage(!0)&&(game.guildWarData.isAutoChallenge=!game.guildWarData.isAutoChallenge,this.autoChallage(),this.send(this.Evts.V_UPDATE_AUTO))},joinTeam:function(){game.scenePick.pick(null),game.guildWarData.isClickChallenge=!1,game.guildWarData.isAutoChallenge=!1;this.send(this.Evts.V_UPDATE_AUTO)},exitTeam:function(){game.guildWarData.clearMonsterTs(),this._removePlayEnd(),this._checkRelive()},_removePlayEnd:function(){b8e.hasTimeout(this._playEnd,this)&&b8e.removeTimeout(this._playEnd,this)},mainRoleDie:function(){this._removePlayEnd()},_checkRelive:function(){if(!b8e.hasTimeout(this._playEnd,this)){for(var e=999999999,t=0,a=game.guildWarData.monsterTs,i=0,n=a.length;i<n;i++){if(a[i]<1){e=0;break}(t=a[i]-game.SysTime.curTime)<e&&(e=t)}b8e.setTimeout(this._playEnd,this,2e3+(e>>0))}},playEnd:function(e){var t=e.data;t&&t.type==game.InstanceType.GUILD_WAR_PVE&&this._checkRelive()},_playEnd:function(){game.guildWarData.isAutoChallenge&&game.guildWarData.isCanAutoChallage()&&this.autoChallage()},canGotoLd:function(){var e,t=game.sceneData.monsterIds;if(t.length<1)return!0;for(var a=0,i=t.length;a<i;a++)if((e=b8e.scene.getDisplayByTypeAndId(game.RoleType.Monster,t[a]))&&!e.getStateMachine().isDeath())return!1;return!0},snatchBtn:function(){for(var e=game.csWarTeamData.occupiedMemberList,t=0,a=e.length;t<a;t++)e[t].isLeader&&e[t].id;game.scenePick.target&&this.sender.GuildWarChallengeReq(game.scenePick.target.id),game.module.hide(game.ME.GuildWarSnatch)},abortBtn:function(){game.module.hide(game.ME.GuildWarSnatch)},quickEntryBtn:function(){game.module.show(game.ME.GuildWar),game.module.hide(game.ME.GuildWarQuickEntry)},loseOwner:function(){},recruitBtn:function(){},leaveTeamBtn:function(){},challengeBtn:function(){},giveUpBtn:function(){},lootBtn:function(){}}),t=game.Sender.extends({ipc:function(){this.msg={GuildWarActivityReq:null,GuildWarHlgChallengeReq:null,GuildWarJoinReq:this.guildWarJoinReq,GuildWarScoreAwardReq:null,GuildWarChallengeReq:this.guildWarChallengeReq,GuildWarOwnerDataReq:null}},guildWarJoinReq:function(e){var t=game.pb.GuildWarJoinRequest;t.flag=e,this.write(t)},guildWarChallengeReq:function(e){var t=game.pb.GuildWarChallengeRequest;t.targetUnitId=e,this.write(t)}}),a=[game.ME.GuildWarBattle,game.ME.GuildWarEnter,game.ME.GuildWarSettlement,game.ME.GuildWarSnatch,game.ME.GuildWarQuickEntry];b8e.module.registerControl(game.ME.GuildWar,e,game.GuildWarEvts,t,a)}(),function(){var e=game.View.extends({ctor:function(){this._super(544)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildWarAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){this.createPrizeItems()},onHide:function(){},notify:function(e){switch(e){case this.Evts.C2V_RESET_DAILY:this.createPrizeItems()}},createPrizeItems:function(){var e=game.guildWarData.getAwardListByType(game.GuildWarAwardType.SINGE);this.prizeList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildWarAwardSinge,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(546),this.toggles={tab1_select:game.ME.GuildWarAwardSinge,tab2_select:game.ME.GuildWarAwardHit}},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},init:function(){var e=game.ResCfg.getUrl(10002);e&&this.skin.banner.loadTexture(e)},onShow:function(){this.toggleSelect(0)},onHide:function(){},toggleSelect:function(e){if(this._super(e)){var t=this.skin;t.t_geren.node.active=0==e,t.t_hg.node.active=1==e}else;}});b8e.module.registerView(game.ME.GuildWarAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(551)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildWarRankItem,e.layout.spacingY=5,e.layout.paddingLeft=12,e.layout.paddingTop=28,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=game.guildWarData.guildRankList,a=game.guildWarData.myGuildRank;this.rankList.setData(t),a?(e.myRankLab.string=a.rank,e.myHitLab.string=a.score):(e.myRankLab.string=game.Lang.get(9424),e.myHitLab.string="0")},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildWarRankGuild,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(e){var t=0<arguments.length&&void 0!==e?e:"";t=t||1209,this._super(t),this.setSize(540,94)},setData:function(){var e=this.skin,t=this.data,a="";this.rankIconSp||(this.rankIconSp=b8e.Sprite.get(),this.rankIconSp.setAnchor(.5,.5),this.rankIconSp.addToParent(e.rankIcon)),3<t.rank?(a="4",e.rankLab.string=t.rank):(a=t.rank,e.rankLab.string=""),a=game.ResCfg.getUrl(108,a),this.rankIconSp.loadTexture(a);var i=t.type==game.GuildWarRankType.GUILD_WAR_BOSS_GUILD?t.guildName:t.name;i+=".S"+t.zone,e.nameLab.string=i,e.hitLab.string=t.score}}),b8e.RC("$$game","$$GuildWarRankItem",e)}(),function(){var e;e=game.GuildWarRankItem.extends({ctor:function(){this._super(552)},setData:function(){var e=this.skin,t=this.data;this._super(),e.guildLab.string=t.guildName+".S"+t.zone}}),b8e.RC("$$game","$$GuildWarRankItem2",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(553)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildWarRankItem2,e.layout.spacingY=5,e.layout.paddingLeft=12,e.layout.paddingTop=28,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=game.guildWarData.scoreRankList,a=game.guildWarData.myScoreRank;this.rankList.setData(t),a?(e.myRankLab.string=a.rank,e.myHitLab.string=a.score):(e.myRankLab.string=game.Lang.get(9424),e.myHitLab.string="0")},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildWarRankScore,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(554)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildWarRankItem2,e.layout.spacingY=5,e.layout.paddingLeft=12,e.layout.paddingTop=28,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=game.guildWarData.singeRankList,a=game.guildWarData.mySingeRank;this.rankList.setData(t),a?(e.myRankLab.string=a.rank,e.myHitLab.string=a.score):(e.myRankLab.string=game.Lang.get(9424),e.myHitLab.string="0")},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildWarRankSinge,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(555),this.toggles={tab1_select:game.ME.GuildWarRankSinge,tab2_select:game.ME.GuildWarRankGuild,tab3_select:game.ME.GuildWarRankScore}},init:function(){},onShow:function(){this.toggleSelect(0)},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},onHide:function(){},toggleSelect:function(e){if(this._super(e))switch(e){case 0:this.send(this.Evts.C_GET_RANK,game.GuildWarRankType.GUILD_WAR_BOSS_PERSONAL);break;case 1:this.send(this.Evts.C_GET_RANK,game.GuildWarRankType.GUILD_WAR_BOSS_GUILD);break;case 2:this.send(this.Evts.C_GET_RANK,game.GuildWarRankType.GUILD_WAR_PERSONAL)}else;},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.GuildWarRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(557)},init:function(){var e=this;e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.prizeList.itemRender=game.ShowItemListItem,e.prizeList.layout.paddingLeft=30,e.prizeList.layout.spacingX=20,e.prizeList.addToParent(e.skin.awardList),e.prizeList.layout.spacingX=50,e.bg=b8e.Sprite.get(),e.bg.setAnchor(.5,.5),e.bg.loadTexture(game.ResCfg.getImgUrl("guildWar/bg",!0)),e.skin.bgNode.addChild(e.bg),e.timer=b8e.Timer.add(e,e.updateTime,500)},notify:function(e){switch(e){case this.Evts.V_UPDATE_ACTIVITY:this.updateView()}},onShow:function(){this.send(this.Evts.C_GET_ACTIVITY),this.updateView()},onHide:function(){this.stopTime()},updateTime:function(){if(!this.endTime)return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime();this.skin.timeLab.string=b8e.TimeUtil.formatTime(e)},stopTime:function(){if(this.timer){this.timer.stop()}},updateView:function(){var e=this,t=e.skin,a=game.guildWarData,i=a.guildWarActivity;if(i){var n=a.guildWarIsOpen,s=n?i.layer+1:0;if(t.awardNode.node.active=!n,t.rankNode.node.active=n,t.statusNode.node.active=n){t.myGuildRankLab.string=game.Lang.get(6327,i.urank?i.urank.rank:game.Lang.get(9387)),t.peopleNumLab.string=game.Lang.get(6326,i?i.players:0);for(var r=i.rank,o=0;o<3;o++)if(r&&r.length>o){var g=r[o];e.getComponent("rankLab"+(o+1)).string=o+1+"",e.getComponent("nameLab"+(o+1)).string=g.guildName+".S"+g.zone,e.getComponent("scoreLab"+(o+1)).string=g.score}else e.getComponent("rankLab"+(o+1)).string="",e.getComponent("nameLab"+(o+1)).string="",e.getComponent("scoreLab"+(o+1)).string="";t.statusLab.string=i.state?game.Lang.get(9426):game.Lang.get(9427),t.enterLabel.string=i.state?game.Lang.get(50121):game.Lang.get(50122),e.endTime=a.getEndTime(),e.timer.running||e.timer.start()}else{t.enterLabel.string=game.Lang.get(9430);var u=a.getPreviewAward();e.prizeList.setData(u.items);var l=game.CsMiscCfg.getData("guildWarTime").value,c=game.CsMiscCfg.getData("guildWarTimeDes").value;t.openTimeLab.string=game.Lang.get(6325,l,c),i.lastMaster?(t.playerNameLab.string=i.lastMaster.name+".S"+i.lastMaster.zone,t.guildNameLab.string="("+i.lastMaster.guildName+")"):(t.playerNameLab.string=game.Lang.get(9387),t.guildNameLab.string=""),t.peopleNumLab.string=""}for(var h=1;h<5;h++)e.getComponent("passPoint"+h).node.active=h<=s,0<h-1&&(e.getComponent("yellow_line"+(h-1)).node.active=h<=s);0==s?t.arrow.node.active=!1:(t.arrow.node.active=!0,t.arrow.x=e.getComponent("passPoint"+s).x)}}});b8e.module.registerView(game.ME.GuildWar,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(547),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},init:function(){var e=this;e.anima1=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima1.addToParent(e.skin.anima1),e.anima1.load(game.ResCfg.getUrl(5019,1017)),e.anima2=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima2.addToParent(e.skin.anima2),e.anima2.load(game.ResCfg.getUrl(5019,1019)),e.anima3=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima3.addToParent(e.skin.anima3),e.anima3.load(game.ResCfg.getUrl(5019,1020)),e.timer=b8e.Timer.add(e,e.updateTime,500),e.matCostIcon=b8e.Sprite.get(),e.matCostIcon.setAnchor(.5,.5),e.matCostIcon.addToParent(e.skin.awardIcon),e.matCostIcon.setSize(30,30)},notify:function(e){var t=this;switch(e){case t.Evts.V_UPDATE_LEFT_RANK:t.updateRank(),t.updateLevel();break;case t.Evts.V_UPDATE_SCORE:t.updateSocre();break;case t.Evts.V_UPDATE_HP:t.updateHP();break;case t.Evts.V_UPDATE_AUTO:t.updateAuto();break;case t.Evts.V_UPDATE_TS:t.createMonsterTimer()}},onShow:function(){this.anima1.play(),this.anima2.play(),this.anima3.play(),this.setShow()},setShow:function(){var e=this,t=e.skin,a=game.SceneType;switch(e._sceneType=game.sceneData.getSceneType()){case a.CS_GUILD_WAR_LY:t.bossNode.active=!0,t.title1.active=!0,t.scoreNode.active=!0,t.autoPanel.active=!0,t.rankNode.height=195,t.lookBtn.active=!1,t.leftNode.y=106,t.rightNode.y=66,e.showBossInfo(),e.createMonsterTimer();break;case a.CS_GUILD_WAR_HG:t.title2.active=!0,t.ldBtn.active=!0,t.hpNode.active=!0,t.lookBtn.active=!0,t.tzBtn.active=!0,t.leftNode.y=86,t.rightNode.y=46,e.updateHP();break;case a.CS_GUILD_WAR_LD:t.lookBtn.active=!0,t.leftNode.y=0,t.rightNode.y=-36}e.updateRank(),e.updateLevel(),e.updateSocre(),e.updateAuto(),e.endTime=game.guildWarData.getEndTime(),e.timer.running||e.timer.start()},showBossInfo:function(){var e=game.GuildWarBossScoreCfg.getData(this._sceneType,!0);if(e&&!(e.length<1))for(var t=void 0,a=0,i=e.length;a<i;a++)t=e[a],this.getComponent("bossName"+a).string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name),this.getComponent("scoreLab"+a).string=game.Lang.get(9519,t.score)},updateHP:function(){var e=game.guildWarData.bossInfo;if(e){var t=this.skin,a=e.shield/e.maxShield;t.shieldLab.string=(100*a).toFixed(2)+"%",t.shield.width=510*a,a=e.hp/e.maxHp,t.hpLab.string=(100*a).toFixed(2)+"%",t.hp.width=510*a}},updateAuto:function(){var e=game.guildWarData.isAutoChallenge;this.skin.autoChallage.active=e},updateLevel:function(){for(var e=game.guildWarData.layer+1,t=this.skin,a=1;a<5;a++)this.getComponent("passPoint"+a).node.active=a<=e,0<a-1&&(this.getComponent("yellow_line"+(a-1)).node.active=a<=e);t.arrow.node.active=!0,t.arrow.x=this.getComponent("passPoint"+e).x,t.peopleNumLab.string=game.Lang.get(6326,game.guildWarData.num)},updateRank:function(){var e=this.skin,t=game.SceneType,a=game.sceneData.getSceneType(),i=game.guildWarData,n=i.curMyRanks?i.curMyRanks.rank:0,s=i.curMyRanks?i.curMyRanks.score:0,r=game.CsMiscCfg.getData("lyPlayers").value;switch(e.title1.node.active=a!=t.CS_GUILD_WAR_HG,e.title2.node.active=a==t.CS_GUILD_WAR_HG,a){case t.CS_GUILD_WAR_LY:e.rankTitle3.string=game.Lang.get(6596),e.myGuildRankLab.string=game.Lang.get(6598,i.hgNum,s,r);break;case t.CS_GUILD_WAR_HG:e.rankTitle3.string=game.Lang.get(6597),e.myGuildRankLab.string=game.Lang.get(6599,n,s);break;case t.CS_GUILD_WAR_LD:e.rankTitle3.string=game.Lang.get(6596),e.myGuildRankLab.string=game.Lang.get(6600,s)}for(var o=i.topRanks,g=0;g<3;g++)if(o&&o.length>g){var u=o[g];this.getComponent("rankLab"+(g+1)).string=g+1+"",this.getComponent("nameLab"+(g+1)).string=u.guildName+".S"+u.zone,this.getComponent("scoreLab1_"+(g+1)).string=u.score}else this.getComponent("rankLab"+(g+1)).string="",this.getComponent("nameLab"+(g+1)).string="",this.getComponent("scoreLab1_"+(g+1)).string=""},updateSocre:function(){var e=this.skin,t=game.CsMiscCfg.getData("lyScore").value,a=game.guildWarData.score>=Number(t);e.scoreLab.string=game.Lang.get(a?6594:6595,game.guildWarData.score,t);var i=game.guildWarData.getUnclaimedScores();if(i&&0<i.length)e.anima.active=!0,this.updateScoreInfo(i);else{e.anima.active=!1;var n=game.guildWarData.getRemainArr();if(n&&0<n.length)this.updateScoreInfo(n);else{var s=game.CsMiscCfg.getData("guildWarScoreMax").value;e.lab_desc.string=game.Lang.get(3806,game.guildWarData.score,s),e.awardLab2.string=game.Lang.get(3816),e.awardNumLab.active=!1,e.awardIcon.active=!1}}},updateScoreInfo:function(e){var t=this.skin,a=e[0],i=6533;game.guildWarData.score>=a&&(i=3806),t.lab_desc.string=game.Lang.get(i,game.guildWarData.score,a);var n=game.GuildWarScoreAwardCfg.getData(a).award[0];if(n){var s=game.ItemInfoCfg.getData(n.Id),r=game.ResCfg.getUrl(137,s.icon);this.matCostIcon.loadTexture(r),t.awardNumLab.string=n?"X"+n.Num:""}},updateTime:function(){if(!this.endTime){return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime()}this.skin.timeLab.string=b8e.TimeUtil.formatTime(e)},stopTime:function(){if(this.timer){this.timer.stop()}},createMonsterTimer:function(){this._monsterTimer||(this._monsterTimer=b8e.Timer.add(this,this._updateMonsterTime,500),this._monsterTimer.start())},clearMonsterTimer:function(){this._monsterTimer&&(b8e.Timer.remove(this,this._updateMonsterTime),this._monsterTimer=null)},_updateMonsterTime:function(){for(var e=game.guildWarData.monsterTs,t=0,a=(this.skin,!0),i=0,n=4<e.length?4:e.length;i<n;i++)0<e[i]?0<(t=e[i]-game.SysTime.curTime)?(a=!1,this.getComponent("reLiveLab"+i).active=!0,this.getComponent("reLiveLab"+i).string=game.Lang.get(6602,1+(.001*t>>0))):(e[i]=0,this.getComponent("reLiveLab"+i).active=!1):this.getComponent("reLiveLab"+i).active=!1;a&&this.clearMonsterTimer()},onHide:function(){var e=this.skin;e.bossNode.active=!1,e.hpNode.active=!1,e.tzBtn.active=!1,e.helpBtn.active=!1,e.title1.active=!1,e.title2.active=!1,e.scoreNode.active=!1,e.ldBtn.active=!1,e.rankNode.height=170,e.hpNode.active=!1,e.autoPanel.active=!1,e.tzBtn.active=!1,this._sceneType=null,this.stopTime()},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth;this.setPosition(0,e-50);var a=this.skin;if(a&&a.bottomNode){var i=this.getY();a.bottomNode.y=i,a.rightNode.x=t-40}a.scheduleNode.setPosition(t-140,-90)},getY:function(){return 400-b8e.stageHeight}});b8e.module.registerView(game.ME.GuildWarBattle,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(548)},init:function(){var e=game.ResCfg.getUrl(10003);e&&this.skin.dc.loadTexture(e)},onShow:function(){this.upDateView()},upDateView:function(){for(var e=game.guildWarData.hgEnter,t=0;t<3;t++)this.getComponent("nameLab"+(t+1)).string=e&&e.length>t?e[t].guildName+".S"+e[t].zone:""},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*e,.5*t+60)}});b8e.module.registerView(game.ME.GuildWarEnter,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(556)},init:function(){this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.prizeList.itemRender=game.ShowItemListItem,this.prizeList.layout.spacingX=40,this.prizeList.addToParent(this.skin.list)},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.guildWarData.settlementInfo;if(e.guildNameLab.string=t.winner?game.Lang.get(6513,t.winner.guildName,t.winner.zone):game.Lang.get(9387),e.rankLab.string=game.Lang.get(608,t.guildRank),t.personalRank){var a=game.guildWarData.getSettementAward(t.personalRank);a&&this.prizeList.setData(a.items)}},onHide:function(){game.sceneData.isGuildWar()&&b8e.evt.dptG(game.SceneGEvts.SCENE_EXIT)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.GuildWarSettlement,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(267)},init:function(){var e=this.skin;e.masterPage.active=!1,e.challengeBtn.active=!1,e.snatchBtn.active=!0,e.abortBtn.active=!0,e.desc2.active=!1;var t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.CsWarBattleTeamItem,t.addToParent(e.list),t.bindEnum=game.ME.CsWarTeam},onShow:function(){this.updateList()},onHide:function(){},updateList:function(){this.teamInfoList=game.csWarTeamData.occupiedMemberList,this.list.setData(this.teamInfoList)},view_changeBtn:function(){},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.GuildWarSnatch,e)}(),function(){var e=game.View.extends({_isMoveUp:!1,_specialLayer:!0,ctor:function(){this._super(549),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},notify:function(e,t){switch(e){case this.Evts.C2V_SKILL_HIT:this.onSkillHit(t)}},onShow:function(){this.updateView(game.guildWarData.bossInfo),this.stageResize()},updateView:function(e){if(e){var t=this.skin;this.lastData=e,t.hpBg1.node.active=0<e.shield,t.shield.node.width=this.barLen*e.shield/e.maxShield,t.shieldLab.string=e.shield+"/"+e.maxShield,t.hp.node.width=this.barLen*e.hp/e.maxHp,t.hpLab.string=e.hp+"/"+e.maxHp}},stageResize:function(){var e=this.skin,t=.6*b8e.stageWidth;this.skin.hp_pb_bg1.width=t,this.skin.hp_pb_bg2.width=t,this.barLen=t-21,e.shieldLab.x=this.skin.hp_pb_bg1.x+.5*t,e.hpLab.x=this.skin.hp_pb_bg2.x+.5*t,this.updateView(this.lastData)},onSkillHit:function(e){this.updateView(e.roleData)},onHide:function(){},onStageResize:function(){this.stageResize();b8e.stageHeight,b8e.stageWidth;this.setPosition(40,this.height+125)}});b8e.module.registerView(game.ME.GuildWarPlay,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(550)},notify:function(e){e},onShow:function(){},onHide:function(){},onStageResize:function(){var e=b8e.stageWidth-this.width;this.setPosition(e-17,320)}});b8e.module.registerView(game.ME.GuildWarQuickEntry,e)}(),function(){var e;e=b8e.Enum({C2V_UPDATE_CHECK_ITEM:-1,V2C_SING_REQ:-1}),b8e.RC("$$game","$$WalfCheckinEvt",e)}(),function(){var e,t=e=b8e.PoolObject.extends({cfg:null,signState:-1,isFreeSigned:!1,isRechargeSinged:!1,isSigned:!1,isCanSign:!1,isAlert:!1,ctor:function(){this._super()},clearData:function(){this.cfg=null,this.signState=-1,this.isFreeSigned=!1,this.isRechargeSinged=!1,this.isSigned=!1,this.isCanSign=!1,this.isAlert=!1},recycle:function(){this.clearData(),this._super()}});b8e.BindingUtil.bind(t);var a=new b8e.Pool(t,64);t.get=function(e){return a.get(e)},t.put=function(e){return a.put(e)},b8e.RC("$$game","$$WalfCheckinItemInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.signGroup=0,this.signTimes=0,this.isTodaySign=!1,this.isTodayRechargeSign=!1,this.isAlert=!1,this.curSignInfo=null},setWalfData:function(e){e&&(this.setData(e),this.isTodaySign=e.isTodaySign)},setSignAward:function(e){this.isTodaySign=!0,this.setData(e),this.isTodaySign&&this.updateSignList(this.signTimes)},setData:function(e){e&&(this.signGroup=e.signGroup,this.signTimes=e.signTimes,this.isTodayRechargeSign=e.isTodayRechargeSign)},initSignList:function(e){var t=this;if(t._signList&&0<t._signList.length)return t._signList;var a=t.getSignsByGroup(t.signGroup);if(!a||a.length<1)return null;t._signList||(t._signList=[]);for(var i=0,n=a.length,s=void 0,r=void 0;i<n;i++)(r=a[i])&&((s=game.WalfCheckinItemInfo.get()).index=i,s.cfg=r,t.updateSignState(s,e),t._signList.push(s));return t._signList},getSignList:function(){return this._signList},updateSignList:function(e){var t=this;if(!t._signList||t._signList.length<1)t.initSignList(e);else{var a=0,i=t._signList[0],n=t._signList.length;if(i&&i.cfg&&i.cfg.group!=t.signGroup){for(;a<n;a++)(i=t._signList[a])&&i.release();return t._signList.length=0,void t.initSignList(e)}for(a=0,n=t._signList.length;a<n;a++)(i=t._signList[a])&&t.updateSignState(i,e)}},updateSignState:function(e,t){e.isAlert=!1;var a=e.cfg.signTimes,i=game.rechargeData.rechargeMoneyDaily;a<t?(e.signState=0,e.isCanSign=!1,e.isSigned=!0,e.isFreeSigned=!1,e.isRechargeSinged=!1):a==t?(e.signState=1,this.isAlert=!1,e.isAlert=!1,this.isTodaySign?!this.isTodayRechargeSign&&0<i?(e.isCanSign=!0,e.isSigned=!1,e.isFreeSigned=!0,e.isRechargeSinged=!1,this.isAlert=!0,e.isAlert=!0):!this.isTodayRechargeSign&&i<1?(e.isCanSign=!1,e.isSigned=!1,e.isFreeSigned=!0,e.isRechargeSinged=!1):(e.isCanSign=!1,e.isSigned=!0,e.isFreeSigned=!0,e.isRechargeSinged=!0):(e.isCanSign=!0,e.isSigned=!1,e.isFreeSigned=!1,e.isRechargeSinged=!1,this.isAlert=!0,e.isAlert=!0)):(e.signState=2,e.isSigned=!1,e.isCanSign=!1,e.isFreeSigned=!1,e.isRechargeSinged=!1)},getSignsByGroup:function(e){return this._groupObj||(this._groupObj=b8e.createMap()),this._groupObj.group=e,game.DaySignCfg.getData(this._groupObj,!0)}});game.walfCheckinData=game.walfCheckinData||new e}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.DAILY_SIGN,game.SAE.WELFARE_ALERT)},ipc:function(){this.evts={Welfare:{C_INIT_MODEL:this.updateWalfCheckinInfo},Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess}},this.handels={SignAward2Resp:this.onSignAward2Resp}},notify:function(e){switch(e){case this.Evts.V2C_SING_REQ:this.sender.SignAward2Req()}},rechargeSuccess:function(e){if(e&&e.data){game.walfCheckinData.isTodaySign&&game.walfCheckinData.isTodayRechargeSign?this._updateWalfCheckinInfo(game.walfCheckinData.signTimes):!game.walfCheckinData.isTodaySign||game.walfCheckinData.isTodayRechargeSign?this._updateWalfCheckinInfo(game.walfCheckinData.signTimes+1):this._updateWalfCheckinInfo(game.walfCheckinData.signTimes)}},updateWalfCheckinInfo:function(){game.walfCheckinData.isTodaySign?this._updateWalfCheckinInfo(game.walfCheckinData.signTimes):this._updateWalfCheckinInfo(game.walfCheckinData.signTimes+1)},_updateWalfCheckinInfo:function(e){game.walfCheckinData.updateSignList(e),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_CHECK_ITEM)},checkAlert:function(){this.spotAlert.alert=game.walfCheckinData.isAlert&&game.moduleOpen.checkOpen(game.ME.WalfCheckin)},onSignAward2Resp:function(e){var t=e.readProtobuf(game.pb.SignAward2Response);0<t.code?game.notice.noticeError(t.code):(game.walfCheckinData.setSignAward(t),this.send(this.Evts.C2V_UPDATE_CHECK_ITEM),this.checkAlert(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))}}),t=game.Sender.extends({ipc:function(){this.msg={SignAward2Req:null}}});b8e.module.registerControl(game.ME.WalfCheckin,e,game.WalfCheckinEvt,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(1101)},init:function(){var e=this.skin;e.ban.loadTexture(game.ResCfg.getUrl(253));var t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.WalfCheckItemView,t.bindEnum=game.ME.WalfCheckin,t.layout.paddingLeft=1,t.layout.spacingX=9,t.layout.spacingY=9,t.addToParent(e.list),t.setScrollParams(this)},onShow:function(){this.updateView()},onHide:function(){this.clearData()},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_CHECK_ITEM:this.updateView()}},updateView:function(){var e=this.checkinInfos=game.walfCheckinData.getSignList();this._awardMax=e.length-5,this._list&&this._list.setData(e)},clearData:function(){this._list&&this._list.clear()},$$getCheckinItem:function(e){if(!this._list||!this.checkinInfos||this.checkinInfos.length<=e)return null;var t=this.checkinInfos[e];if(!t)return null;var a=this._list.getItemRender(t);return a&&a.skin?a.skin.clickBtn:null},onStageResize:function(){}});b8e.module.registerView(game.ME.WalfCheckin,e)}(),function(){var e;e=game.ListItem.extends({__itemIcon:null,ctor:function(){this._super(1102),this.setSize(112,151)},init:function(){this.__itemIcon=game.GridUtil.createPrizeIcon(),this.__itemIcon.addToParent(this.skin.iconNode),this._alertOptions={lang:"\u5f53\u5929\u5145\u503c\u4efb\u610f\u91d1\u989d\u53ef\u989d\u5916\u83b7\u5f97\u4e00\u6b21\u5956\u52b1",okcb:this.onClickFunc,thisArg:this}},setData:function(){var e=this.data;if(e){var t=e.cfg,a=game.ItemInfoCfg.getData(t.itemId);this.__itemIcon.setItemInfo(a,!1,!1),this.__itemIcon.setNum(t.itemNum);var i=this.skin;i.attrTxt.string=game.Lang.get(9556,t.signTimes),i.already_got.active=!1,i.mask2.active=!1,i.clickBtn.active=!0,i.againImg.active=!1,i.singin.active=!1;var n=game.rechargeData.rechargeMoneyDaily;switch(e.signState){case 0:i.already_got.active=!0,i.mask2.active=!0,i.clickBtn.active=!1;break;case 1:e.isSigned?(i.already_got.active=!0,i.mask2.active=!0,i.clickBtn.active=!1):e.isCanSign?e.isFreeSigned&&!e.isRechargeSinged&&0<n?(i.mask2.active=!0,i.againImg.active=!0):i.singin.active=!0:e.isFreeSigned&&!e.isRechargeSinged&&(i.mask2.active=!0,i.againImg.active=!0);break;case 2:i.clickBtn.active=!1}}},clickBtn:function(){var e=this.data;e&&e.isCanSign?this.send(game.WalfCheckinEvt.V2C_SING_REQ,e.cfg.signTimes):this.skin.againImg&&game.alert.showTwo(this._alertOptions)},onClickFunc:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.DAY_GIFT)}}),b8e.RC("$$game","$$WalfCheckItemView",e)}(),function(){var e;e=b8e.Enum({None:0,V_SELECT_BTN:-1,V_SHOW_VIEW:-1,V_HIDE_VIEW:-1,C2C_CHANGE_OPENSERVER:-1,C2C_INIT_OPENSERVER:-1,C2C_CHANGE_OPENSERVER_OPEN:-1,C2V_CHANGE_OPENSERVER_OPEN:-1}),b8e.RC("$$game","$$MergeServerEvts",e)}(),function(){var e;e=b8e.Enum({C2C_CHANGE_MERGESERVER:b8e.enc(),C2C_SHOW_MERGESERVER:b8e.enc(),C2C_CHANGE_MERGESERVER_LIST:b8e.enc()}),b8e.RC("$$game","$$MergeServerGEvts",e)}(),function(){var e=game.OpenServerData.extends({getCanOpenId:function(){var e=this.getOpenServerList();if(!e||e.length<1)return 0;for(var t,a,i=e.length,n=0;n<i;n++)if((a=(t=e[n]).getCfg())&&game.moduleOpen.checkOpen(a.mergeModule))return t.id;return 0},checkOpenById:function(e){var t=this.getOpenServerById(e);if(!t)return!1;var a=t.getCfg();return!(!a||!game.moduleOpen.checkOpen(a.mergeModule))}});game.mergeServerData=game.mergeServerData||new e}(),function(){var e=game.ServerControl.extends({init:function(){this.serverData=game.mergeServerData,this.spotAlert=game.spotAlert.set(game.SAE.MERGE_SERVER_ALERT,game.SAE.HOME)},ipc:function(){this.gevts={MergeServerGEvts:{C2C_CHANGE_MERGESERVER:this.setServerData,C2C_SHOW_MERGESERVER:this.showOpenserver,C2C_CHANGE_MERGESERVER_LIST:this.setServerDataList}}},selectBtn:function(e){var t=this,a=t.serverData.getOpenServerById(e);if(a){var i=a.getCfg();if(i&&game.moduleOpen.checkOpenWithTips(i.mergeModule)){var n=i.mergeModule;n?t.lastId!=e&&(-1<t.lastModuleEnum&&game.module.hide(t.lastModuleEnum),t.serverData.selectPage(e,t.lastId),game.module.showTab(n,t.moduleEnum),t.send(t.Evts.V_SELECT_BTN),t.lastId=e,t.lastModuleEnum=n):b8e.error("\u7c7b\u578b:"+i.openServerType+"\u6ca1\u6709\u5bf9\u5e94\u7684moduleEnum")}}}});b8e.module.registerControl(game.ME.MergeServer,e,game.MergeServerEvts)}(),function(){var e;e=game.OpenServerBtnItem.extends({ctor:function(){this._super(1),this.setSize(86,96)},setData:function(){var e=this,t=e.data;e.skin.titleImgSelect.node.active=t.select;var a=t.getCfg();if(a)if(a.mergeTitleBg){var i=game.ResCfg.getImgUrl(a.mergeTitleBg);e.btn.loadTexture(i),this.skin.alert.node.active=t.alert}else b8e.error("\u5f00\u670d\u6d3b\u52a8\u6309\u94ae\u914d\u7f6e\u6ca1\u6709\u5bf9\u5e94\u7684\u5408\u670d\u6807\u9898\u6309\u94ae\u5e95\u56fe,id:",a.id)},onClickBtn:function(){this.send(game.MergeServerEvts.V_SELECT_BTN,this.data.id)}}),b8e.RC("$$game","$$MergeServerBtnItem",e)}(),function(){var e=game.ServerView.extends({ctor:function(){this._super()},init:function(){this.serverItem=game.MergeServerBtnItem,this.serverData=game.mergeServerData,this._super()},getBannerImg:function(e){return e?e.mergeBannerImg:null},getTitleImg:function(e){return e?e.mergeTitleImg:null}});b8e.module.registerView(game.ME.MergeServer,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_GET_PRIZE:b8e.enc(),C2V_UPDATE_VIEW:b8e.enc()}),b8e.RC("$$game","$$MergeLoginEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,day:0,isGet:!1,isEnoughDay:!1,isRed:!1,awards:null,setCfg:function(e){this.id=e.id,this.days=e.days;var t=game.miscData.mergeVersion;this.isEnoughDay=e.mergeVer==t&&e.days<=game.MergeLoginData.loginDays;var a=void 0,i=void 0,n=e.award.length;this.awards=[];for(var s=0;s<n;s++)a=e.award[s],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.awards.push(i)},setGetPrise:function(){this.isRed=this.isEnoughDay&&!this.isGet}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$MergeLoginInfo",e)}(),function(){var e=b8e.Object.extends({loginDays:0,getAwards:null,endTime:0,ctor:function(){this._super(),this.login=b8e.HashMap.get()},initInfo:function(){var e=game.MergeLoginCfg.getDatas();if(e&&!(e.length<1)){for(var t=game.miscData.mergeVersion,a=e.length,i=void 0,n=void 0,s=0;s<a;s++)(i=e[s]).mergeVer==t&&((n=(n=this.login.get(i.id))||new game.MergeLoginInfo).setCfg(i),this.getAwards&&0<this.getAwards.length&&(n.isGet=-1!=this.getAwards.indexOf(i.id)),n.setGetPrise(),this.login.set(i.id,n));this.login.values().sort(this.sortArry)}},initData:function(e){this.loginDays=e.mergeLoginDays||0,this.getAwards=e.mergeLoginAwards||[],this.initInfo(),this.setEndTime()},setData:function(e){var t=this.login.get(e.id);t?(this.getAwards.push(e.id),t.isGet=!0,t.setGetPrise(),this.login.values().sort(this.sortArry)):b8e.log("\u65e0\u5bf9\u5e94id",e.id,"\u7684\u6570\u636e")},setEndTime:function(){if(this.loginDays){var e=game.MergeLoginCfg.getData(this.loginDays,!0);if(e&&!(e.length<1)){for(var t=void 0,a=void 0,i=e.length,n=game.miscData.mergeVersion,s=0;s<i;s++)if((t=e[s]).mergeVer==n){a=t.mergeEnd;break}if(a){var r=a-game.miscData.serverMergeDays;this.endTime=r?b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,r):0}}}},getRedPoint:function(){for(var e=this.login.values(),t=e.length,a=0;a<t;a++)if(e[a].isRed)return!0;return!1},getIsOpen:function(){return this.endTime>game.SysTime.curTime},sortArry:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.id-t.id}});game.MergeLoginData=game.MergeLoginData||new e}(),function(){var e=game.Control.extends({init:function(){this.spotMergeLoginAlert=game.spotAlert.set(game.SAE.MERGELOGIN_ALERT,game.SAE.MERGE_SERVER_ALERT)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},OpenServer:{C2C_INIT_OPENSERVER:this.initOpenserver}},this.handels={MergeLoginResp:this.mergeLoginResp}},mergeLoginResp:function(e){var t=e.readProtobuf(game.pb.MergeLoginResponse);0<t.code?game.notice.noticeError(t.code):(game.MergeLoginData.setData(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))},notify:function(e,t){switch(e){case this.Evts.V2C_GET_PRIZE:this.getPrizeReq(t)}},initOpenserver:function(e){if(e&&e.data){var t=e.data;game.MergeLoginData.initData(t),this.checkAlert(),this.checkOpen()}},resetDaily:function(){game.miscData.serverMergeDays<=0||(game.MergeLoginData.loginDays++,game.MergeLoginData.initInfo(),game.MergeLoginData.setEndTime(),this.checkAlert(),this.checkOpen(),this.send(this.Evts.C2V_UPDATE_VIEW))},checkOpen:function(){var e=game.MergeLoginData.getIsOpen(),t={openServerType:game.OpenServerType.LOGIN,isActive:e,sae:game.SAE.MERGELOGIN_ALERT};this.dptG(game.MergeServerGEvts.C2C_CHANGE_MERGESERVER,t)},checkAlert:function(){var e=game.MergeLoginData.getRedPoint();this.spotMergeLoginAlert.alert=e},getPrizeReq:function(e){this.sender.MergeLoginReq(e)}}),t=game.Sender.extends({ipc:function(){this.msg={MergeLoginReq:this.mergeLoginReq}},mergeLoginReq:function(e){var t=game.pb.MergeLoginRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.MergeLogin,e,game.MergeLoginEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(32),this.setSize(600,177)},init:function(){this.skin;var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=0,e.layout.paddingTop=0,e.layout.paddingTop=-5,e.layout.spacingX=15},setData:function(){var e=this.skin,t=this.data;if(t){this.prizeList.setData(t.awards);var a=game.MergeLoginData.loginDays,i=t.isEnoughDay?game.Color.GREEN:game.Color.RED,n=game.HtmlUtil.getText(i,a),s=game.Lang.get(4201,t.days,n,t.days);e.lab.string=s,e.getPrize.active=t.isRed,e.grayBtn.active=!t.isEnoughDay,e.isGetImg.active=t.isGet}},getPrizeBtn:function(){this.send(game.MergeLoginEvts.V2C_GET_PRIZE,this.data.id)}}),b8e.RC("$$game","$$MergeLoginItemView",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(33)},init:function(){var e=this.skin,t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.MergeLoginItemView,t.bindEnum=game.ME.MergeLogin,t.layout.paddingLeft=0,t.layout.paddingTop=0,t.layout.spacingY=5,t.addToParent(e.listNode)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView()}},onShow:function(){this.updateView(),this.createTimer()},updateView:function(){game.MergeLoginData;var e=game.MergeLoginData.login.values();this._list.setData(e)},createTimer:function(){this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){this.skin;var e=game.MergeLoginData.endTime-game.SysTime.curTime;if(e<0)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.labTime.string=t}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this._super(),this.setPosition(0,0)}});b8e.module.registerView(game.ME.MergeLogin,e)}(),function(){var e;e=b8e.Object.extends({isEnough:!1,isJoined:!1,canGet:!1,isGray:!1,setData:function(e){this.cfg=e,this.id=e.id,this.costGold=e.costGold,this.group=e.group,this.updateInfo(),this.setAwardList()},setAwardList:function(){var e,t,a=this.cfg.award,i=a.length;this.prizeList=[];for(var n=0;n<i;n++)e=a[n],(t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(t)},getAwardList:function(){return this.prizeList},setIsJoin:function(){this.isJoined=!0,this.updateInfo()},updateInfo:function(){var e=this.cfg.costGold,t=game.mergeAccCostData.getPayCount(this.group);this.isEnough=e<=t,this.canGet=this.isEnough&&!this.isJoined,this.isGray=!this.isEnough&&!this.isJoined}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$MergeAccCostInfo",e)}(),function(){var e;e=b8e.Object.extends({ctor:function(){this._super()},setData:function(e){this.group=e.group,this.costGold=e.costGold,this.costAwards=e.costAwards},initData:function(e){this.group=e,this.costGold=0,this.costAwards=[]}}),b8e.RC("$$game","$$MergeACGoldInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super()},setMergeAccCost:function(e){var t=e.mergeAccCost;if(t&&!(t.length<1)){this.mergeACGoldMap||(this.mergeACGoldMap=b8e.HashMap.get());for(var a=void 0,i=void 0,n=void 0,s=t.length,r=0;r<s;r++){if(!(n=t[r]))return;i=n.group,(a=this.mergeACGoldMap.get(i))||(a=new game.MergeACGoldInfo,this.mergeACGoldMap.set(i,a)),a.setData(n)}}},initData:function(){var e=this;e.infoMap||(e.infoMap=b8e.HashMap.get()),e.groupListMap?e.groupListMap.clear():e.groupListMap=b8e.HashMap.get(),e.groupList?e.groupList.length=0:e.groupList=[],e.mergeACGoldMap||(e.mergeACGoldMap=b8e.HashMap.get()),e.typeToGroupList?e.typeToGroupList.length=0:e.typeToGroupList=[];var t=game.miscData.serverMergeDays,a=game.miscData.mergeVersion,i=game.MergeCostGoldCfg.getGroupListByDay(t,a);if(!i||i.length<1)return!1;for(var n=void 0,s=void 0,r=void 0,o=void 0,g=i.length,u=0;u<g;u++){if(!(r=i[u]))return;s=r.group,(n=e.infoMap.get(r.id))||(n=new game.MergeAccCostInfo,e.infoMap.set(r.id,n)),n.setData(r),(o=e.groupListMap.get(s))||(o=[],e.groupListMap.set(s,o)),o.push(n),(n=e.mergeACGoldMap.get(s))||((n=new game.MergeACGoldInfo).initData(),e.mergeACGoldMap.set(s,n)),e.groupList.indexOf(s)<0&&e.groupList.push(s),e.typeToGroupList[r.type]=r.group}return!0},getInfoListByGroup:function(e){if(!this.groupListMap)return null;var t=this.groupListMap.get(e);return t||null},getAwardSuccess:function(e,t){var a=this.mergeACGoldMap.get(t);a&&a.costAwards.push(e)},checkAllAlert:function(){if(!this.groupListMap)return!1;var e=this.groupListMap.keys();if(!e||e.length<1)return!1;for(var t=void 0,a=!1,i=e.length,n=0;n<i;n++)t=+e[n],this.checkAlert(t)&&!a&&(a=!0);return a},checkAlert:function(e){if(!this.groupListMap)return!1;var t=this.groupListMap.get(e);if(!t||t.length<1)return!1;var a=!1,i=this.mergeACGoldMap.get(e),n=void 0;n=i?i.costAwards:[];for(var s=t.length,r=void 0,o=0;o<s;o++)r=t[o],n&&0<n.length?r.isJoined=-1<n.indexOf(r.id):r.isJoined=!1,r.updateInfo(),a||!r.canGet||r.isJoined||(a=!0);return a},getPayCount:function(e){if(!this.mergeACGoldMap)return 0;var t=this.mergeACGoldMap.get(e);return t?t.costGold:0},updatePayCount:function(a){return!!this.mergeACGoldMap&&(this.mergeACGoldMap.forEach(function(e,t){t.costGold+=a},this),!0)},getOpenGroupList:function(){return this.typeToGroupList},getTypeByGroup:function(e){return this.typeToGroupList.indexOf(e)}});game.mergeAccCostData=game.mergeAccCostData||new e}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.MERGE_ACC_COST_ALERT,game.SAE.MERGE_SERVER_ALERT)},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.initOpenserver},Back:{C2C_REMOVE_AMOUNT:this.removeAmount},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={MergeAccCostResp:this.mergeAccCostResp}},triggerOpen:function(){this.initData(),this.checkAllAlert()},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)},initOpenserver:function(e){game.moduleOpen.checkOpen(this.moduleEnum)&&(e&&e.data&&game.mergeAccCostData.setMergeAccCost(e.data),this.initData(),this.checkAllAlert())},initData:function(){if(!this.initConRechargeData){this.initConRechargeData=!0,this.tempList?this.tempList.length=0:this.tempList=[];var e=game.mergeAccCostData;e.initData();var t=game.MergeCostGoldCfg.getTypeList();if(t&&!(t.length<1)){for(var a=void 0,i=void 0,n=t.length,s=e.getOpenGroupList(),r=0;r<n;r++)i=t[r],(a={openServerType:game.OpenServerType.MERGE_ACC_COST,isActive:!0,sae:game.SAE.MERGE_ACC_COST_ALERT,type:0,param:0}).sae=i,a.sae=this.getSAEByType(i),!s||s.length<0?a.isActive=!1:(s[i]&&(a.param=s[i]),a.isActive=!!s[i]),this.tempList.push(a);this.dptG(game.MergeServerGEvts.C2C_CHANGE_MERGESERVER_LIST,this.tempList)}}},getSAEByType:function(e){var t=game.SAE.MERGE_ACC_COST_ALERT;switch(e){case 0:t=game.SAE.MERGE_ACC_COST_ALERT}return t},updateAmount:function(e){var t=!!e.data;game.mergeAccCostData.updatePayCount(t)&&(this.checkAllAlert(),this.send(this.Evts.C2V_UPDATE_COST))},removeAmount:function(e){if(e&&e.data){game.mergeAccCostData.updatePayCount(e.data)&&(this.checkAllAlert(),this.send(this.Evts.C2V_UPDATE_COST))}},mergeAccCostResp:function(e){var t=e.readProtobuf(game.pb.MergeAccCostResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=game.MergeCostGoldCfg.getDataById(a);if(i){var n=i.group;game.mergeAccCostData.getAwardSuccess(a,n),this.checkAlertByGroup(n),this.dpt(this.Evts.C2V_UPDATE_LIST)}}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_PRIZE:game.UpgradeUtil.checkEquipTooMuch()||this.sender.MergeAccCostReq(t)}},checkAllAlert:function(){var e=game.mergeAccCostData.getOpenGroupList();if(e)for(var t=void 0,a=e.length,i=0;i<a;i++)(t=e[i])&&this.checkAlertByGroup(t);else this.spotAlert.alert=!1},checkAlertByGroup:function(e){var t=game.mergeAccCostData,a=t.getTypeByGroup(e),i=t.checkAlert(e);switch(a){case 0:this.spotAlert.alert=i}}}),t=game.Sender.extends({ipc:function(){this.msg={MergeAccCostReq:this.mergeAccCostReq}},mergeAccCostReq:function(e){var t=game.pb.MergeAccCostRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.MergeAccCost,e,game.AccCostEvts,t)}(),function(){var e=game.View.extends({endTime:0,ctor:function(){this._super(3)},init:function(){var e=this.skin,t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.AccCostItem,t.bindEnum=this.moduleEnum,t.layout.paddingLeft=0,t.layout.paddingTop=0,t.layout.spacingY=5,t.addToParent(e.listNode)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_COST:this.updateCost();break;case this.Evts.C2V_UPDATE_VIEW:this.updateView()}},onShow:function(){var e=this,t=e.info=game.mergeServerData.getCurBtnInfo();if(t&&t.param){e.curGroup=t.param,e.updateView(),e.updateCost();var a=game.MergeCostGoldCfg.getOnceDataByGroup(e.curGroup);if(a){var i=void 0;a.banner&&(i=game.ResCfg.getImgUrl(a.banner,!0)),i&&e.skin.banner.loadTexture(i),e.endTime=game.miscData.mergeServerTime+(a.mergeEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS,e.timer||(e.timer=b8e.Timer.add(e,e.updateTime,1e3)),e.timer.reset(),e.timer.start()}}},onHide:function(){this.timer&&this.timer.stop()},updateView:function(){if(this.curGroup){var e=game.mergeAccCostData.getInfoListByGroup(this.curGroup);this._list.setData(e)}},updateCost:function(){if(this.curGroup){var e=game.mergeAccCostData.getPayCount(this.curGroup);this.skin.labMoney.string=game.Lang.get(9599,e)}},updateTime:function(){this.skin;var e=this.endTime,t=game.SysTime.curTime;if(e<t)this.clearTimer();else{var a=e-t,i=game.TimeUtil.formatTimeSpace(a,3);this.skin.labTime.string=i}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.MergeAccCost,e)}(),function(){var e;e=b8e.Enum({TaskNone:0,TaskLogin:1,TaskRecharge:2,TaskEscort:3,TaskTeam:4,TaskWild:5,TaskGuildBoss:6,TaskCostGold:7,TaskTaoFa:8,TaskQuanMin:9,TaskGoldXunBao:10,TaskArena:11,TaskAnswer:12,TaskMaterial:13,TaskPersonBoss:14,TaskVipBoss:15,TaskRecruit:16,TaskQuickBattle:17,TaskPartnerMemoir:18,TaskZhuanJi:19,TaskEnd:20}),b8e.RC("$$game","$$PuzzleTaskType",e)}(),function(){var e;e=b8e.Enum({Type_0:0,Type_4:4,Type_9:9,Type_16:16}),b8e.RC("$$game","$$PuzzleChipType",e)}(),function(){var e;e=b8e.Enum({C2C_INIT_MODEL:b8e.enc(),V_UPDATE_DATA:b8e.enc(),V_UPDATE_LOG:b8e.enc(),ON_GOTO_HELP:b8e.enc(),ON_HELP_RESP:b8e.enc(),C2V_REFRESH_HELPNUM:b8e.enc(),C2C_GET_TASK_REWARD:b8e.enc(),V2C_ONSHOW:b8e.enc(),ON_TASK_NUM_RESP:b8e.enc()}),b8e.RC("$$game","$$PuzzleEvts",e)}(),function(){var e;e=b8e.Enum({SIZE_68:81,SIZE_91:108,SIZE_139:165}),b8e.RC("$$game","$$PuzzleSizeEnum",e)}(),function(){var e;e=b8e.Object.extends({type:0,roleId:0,name:"",lv:0,isMale:!1,beHelpedNum:0,ctor:function(){this._super()},setData:function(e,t){this.type=e,this.roleId=t.roleId,this.name=t.name,this.lv=t.level,this.isMale=t.isMale,this.beHelpedNum=t.beHelpedNum}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PuzzleHelpItemInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,taskId:0,taskType:0,prog:0,isAllGetReward:!1,isAlert:!1,ctor:function(){this._super()},setData:function(e,t){var a=this;a.cfg=e,a.taskId=e.id,a.taskType=e.TaskType,a.prog=t;var i=game.puzzleData.getRewardTasks.get(a.taskType);a.isAllGetReward=a.taskId==i,a.isAllGetReward?a.isAlert=!1:a.isAlert=a.prog>=a.cfg.condition},updateProg:function(e,t){t?this.prog=e:this.prog+=e,this.isAllGetReward?this.isAlert=!1:this.isAlert=this.prog>=this.cfg.condition},changeTaskId:function(){var e=this,t=e.cfg.nextId;if(0==t)return e.isAllGetReward=!0,void(e.isAlert=!1);e.taskId=t,e.cfg=game.PuzzleTaskCfg.getTaskByIdTyp(e.taskId,e.taskType),e.isAlert=e.prog>=e.cfg.condition}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PuzzleTaskInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,id:0,chipId:0,uniqueId:0,active:!1,type:0,size:0,ctor:function(){this._super()},setData:function(e,t){var a=this;if(a.active=t,e)switch(a.id=e.id,a.cfg=e,a.chipId=e.chip,a.type=e.type,a.uniqueId=e.id+"_"+a.chipId,a.type){case game.PuzzleChipType.Type_4:a.size=game.PuzzleSizeEnum.SIZE_139;break;case game.PuzzleChipType.Type_9:a.size=game.PuzzleSizeEnum.SIZE_91;break;case game.PuzzleChipType.Type_16:a.size=game.PuzzleSizeEnum.SIZE_68}},chipActive:function(){this.active=!0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PuzzleChipInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){var e=this;e.openHelpType=0,e.endTime=0,e.todayActiveNum=0,e.todayBeHelpNum=0,e.todayHelpNum=0,e.logData=[],e.todayBeHelpMaxNum=0,e.todayHelpMaxNum=0,e.curPuzzleChipInfos=b8e.HashMap.get(),e.puzzleChipType=0,e.curGroup=0,e.curPuzzleId=0,e.puzzleActive=!1,e.puzzleTasks=[],e.puzzleTaskMap=b8e.HashMap.get(),e.getRewardTasks=b8e.HashMap.get(),e.puzzleHelpFriendsMap=b8e.HashMap.get(),e.puzzleHelpCorpsMap=b8e.HashMap.get(),e.allComplete=!1,e.rewardcfg=null,e.hasGetGuildBossNum=!1},getIsOpen:function(){var e=!1,t=game.miscData.openServerDay;return 0!=game.PuzzleCfg.getCurGroup(t)&&(e=!0),e},getTimeByActId:function(){var e=0,t=game.miscData.openServerDay,a=game.PuzzleCfg.getCurGroupTime(t);if(!a)return e;var i=a.serverEnd;return e=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,i-t)-game.SysTime.curTime},syncModelDatas:function(e){var t=this;t.initCfgs();var a=game.miscData.openServerDay,i=game.PuzzleCfg.getCurGroup(a);if(0!=i){t.rewardcfg=game.PuzzleRewardCfg.getData(i);var n=0,s=[],r=[],o=!1;e.jigsawGroup!=i?(t.todayActiveNum=0,t.todayBeHelpNum=0,t.todayHelpNum=0,t.hasGetGuildBossNum=!1):(t.todayActiveNum=e.jigsawNum,t.todayBeHelpNum=e.beHelpedNum,t.todayHelpNum=e.helpNum,n=e.jigsawId,s=e.jigsawChip,r=e.jigsawTask,e.taskProgress,o=e.isActivateJigsaw,t.hasGetGuildBossNum=e.isGuildBoss),t.curGroup=i,t.curPuzzleId=n,t.puzzleActive=o,t.updatePuzzleList(i,n,s),t.checkAllComplete(i),t.updateTasks(r),t.puzzleHelpFriendsMap.clear(),t.puzzleHelpCorpsMap.clear()}},checkAllComplete:function(e){var t=game.PuzzleCfg.getMaxPuzzleByGroup(e);if(t){var a=t.id,i=game.PuzzleCfg.getChipsById(a)||[];this.allComplete=this.curPuzzleChipInfos.count()>=i.length&&this.puzzleActive}},updatePuzzleList:function(e,t,a){0==t&&(this.curPuzzleId=game.PuzzleCfg.getFirstPuzzleId(e));for(var i={},n=0;n<a.length;n++){var s=a[n];i[this.curPuzzleId+"_"+s]=s}this.puzzleChipType=0,this.curPuzzleChipInfos.clear();for(var r=game.PuzzleCfg.getChipsById(this.curPuzzleId)||[],o=0;o<r.length;o++){var g=r[o].id+"_"+r[o].chip,u=!0;i[g]||(u=!1);var l=new game.PuzzleChipInfo;l.setData(r[o],u),this.curPuzzleChipInfos.set(g,l),0==this.puzzleChipType&&(this.puzzleChipType=l.cfg.type)}},initCfgs:function(){var e=game.PuzzleMiscCfg.getData("todayHelpNum");e&&(this.todayHelpMaxNum=parseInt(e.value));var t=game.PuzzleMiscCfg.getData("todayBeHelpedNum");t&&(this.todayBeHelpMaxNum=parseInt(t.value))},onChipActive:function(e,t){var a=e+"_"+t,i=this.curPuzzleChipInfos.get(a);i&&(i.chipActive(),this.todayActiveNum=this.todayActiveNum-1)},onPuzzleActive:function(e){this.puzzleActive=e.isActivateJigsaw,this.checkAllComplete(this.curGroup);var t=e.id;this.curPuzzleId=t,this.updatePuzzleList(this.curGroup,t,e.chip)},onHelpResp:function(e,t){this.todayHelpNum=e;var a=this.puzzleHelpFriendsMap.get(t);a&&(a.beHelpedNum=a.beHelpedNum+1);var i=this.puzzleHelpCorpsMap.get(t);i&&(i.beHelpedNum=i.beHelpedNum+1)},onQryHelps:function(e,t){1==e?this.onUpdateQryHelpsMap(t,this.puzzleHelpFriendsMap,1):this.onUpdateQryHelpsMap(t,this.puzzleHelpCorpsMap,2)},onUpdateQryHelpsMap:function(e,t,a){for(var i={},n=0;n<e.length;n++){var s=e[n],r=s.roleId;i[r]=s;var o=t.get(r);if(!(o&&s.beHelpedNum<o.beHelpedNum)){var g=new game.PuzzleHelpItemInfo;g.setData(a,s),t.set(r,g)}}var u=[];t.forEach(function(e,t){i[e]||u.push(e)},this);for(var l=0;l<u.length;l++)t.del(u[l])},getPuzzleHelpData:function(e){var a=this,i=[];return 1==e?a.puzzleHelpFriendsMap.forEach(function(e,t){0<a.todayBeHelpMaxNum-t.beHelpedNum&&i.push(t)},a):a.puzzleHelpCorpsMap.forEach(function(e,t){0<a.todayBeHelpMaxNum-t.beHelpedNum&&i.push(t)},a),i.sort(function(e,t){return t.lv-e.lv}),i},updateTasks:function(e){var t=b8e.HashMap.get();this.getRewardTasks.clear();for(var a=0;a<e.length;a++){var i=e[a];this.getRewardTasks.set(i.taskType,i.taskId);var n=null;0!=i.taskId&&(n=game.PuzzleTaskCfg.getTaskByIdTyp(i.taskId,i.taskType))&&0!=n.nextId&&(n=game.PuzzleTaskCfg.getTaskByIdTyp(n.nextId,i.taskType)),t.set(i.taskType,{cfg:n,prog:i.progress})}this.puzzleTasks=[],this.puzzleTaskMap.clear();for(var s=game.PuzzleTaskType.TaskNone+1;s<game.PuzzleTaskType.TaskEnd;s++){var r=t.get(s);if(!(r=r||{cfg:null,prog:0}).cfg){var o=game.PuzzleTaskCfg.getFirstTaskByType(s);if(!o)continue;r.cfg=o}var g=new game.PuzzleTaskInfo;g.setData(r.cfg,r.prog),g.isAllGetReward||(this.puzzleTasks.push(g),this.puzzleTaskMap.set(s,g))}},getPuzzleTaskData:function(){return this.puzzleTasks.sort(this.sortFunc),this.puzzleTasks||[]},sortFunc:function(e,t){return e.isAlert&&t.isAlert?e.isAllGetReward&&t.isAllGetReward?-1:!e.isAllGetReward&&t.isAllGetReward?-1:e.isAllGetReward&&!t.isAllGetReward?1:e.taskId-t.taskId:e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:e.taskId-t.taskId},onCompleteTask:function(e){var t=this.puzzleTaskMap.get(e);if(t&&(this.todayActiveNum+=t.cfg.num,t.changeTaskId(),t.isAllGetReward)){this.puzzleTaskMap.del(e);for(var a=-1,i=0;i<this.puzzleTasks.length;i++)if(this.puzzleTasks[i].taskType==e){a=i;break}-1!=a&&this.puzzleTasks.splice(a,1)}},checkActiveChipAlert:function(){return!!game.moduleOpen.checkOpen(game.ME.Puzzle)&&(!this.allComplete&&0<this.todayActiveNum)},checkTaskAlerts:function(){if(!game.moduleOpen.checkOpen(game.ME.Puzzle))return!1;for(var e=0;e<this.puzzleTasks.length;e++){if(this.puzzleTasks[e].isAlert)return!0}return!1},updateTaskProg:function(e,t,a){var i=2<arguments.length&&void 0!==a&&a;if(0!=this.puzzleTaskMap.count()){var n=this.puzzleTaskMap.get(e);if(n){var s=game.miscData.openServerDay;0!=game.PuzzleCfg.getCurGroup(s)&&n.updateProg(t,i)}}},insertLog:function(e){3<=this.logData.length&&this.logData.pop(),this.logData.push({roleId:e.roleId,time:e.time,name:e.name,num:e.num}),this.todayActiveNum+=e.num,this.todayBeHelpNum+=e.num},updateLogs:function(e){e.sort(function(e,t){return t.time-e.time});for(var t=0;t<e.length;t++){var a=e[t];if(3<=this.logData.length)break;this.logData.push({roleId:a.roleId,time:a.time,name:a.name,num:a.num})}}});game.puzzleData=game.puzzleData||new e}(),function(){var e;e=game.Control.extends({ipc:function(){this.handels={}},notify:function(){},onClickGotoHelp:function(e){var t=e.roleId;e.type;game.puzzleData.todayHelpMaxNum-game.puzzleData.todayHelpNum<=0?game.notice.show(game.Lang.get(6577)):this.sender.HelpFriendReq(t)},helpFriendResp:function(e){var t=e.readProtobuf(game.pb.HelpFriendResponse);0<t.code?game.notice.noticeError(t.code):(game.puzzleData.onHelpResp(t.helpNum,t.roleId),this.dpt(this.Evts.ON_HELP_RESP),this.send(this.Evts.V_UPDATE_DATA))},qryHelpsResp:function(e){var t=e.readProtobuf(game.pb.QryHelpResponse);0<t.code?game.notice.noticeError(t.code):(game.puzzleData.onQryHelps(t.type,t.helpList),this.send(this.Evts.V_UPDATE_DATA))},onViewShow:function(){this.sender.QryHelpReq(game.puzzleData.openHelpType)}});var t=game.Sender.extends({ipc:function(){this.msg={QryHelpReq:this.qryHelpReq,HelpFriendReq:this.helpFriendReq}},qryHelpReq:function(e){var t=game.pb.QryHelpRequest;t.type=e,this.write(t)},helpFriendReq:function(e){var t=game.pb.HelpFriendRequest;t.roleId=e,this.write(t)}});b8e.module.registerControl(game.ME.PuzzleHelp,e,game.PuzzleEvts,t),b8e.RC("$$game","$$PuzzleHelpCtrl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.taskSpotAlert=game.spotAlert.set(game.SAE.PUZZLE_TASK,game.SAE.PUZZLE)},notify:function(e,t){switch(e){case this.Evts.C2C_GET_TASK_REWARD:this.getTaskReward(t)}},ipc:function(){var e=this;e.handels={JigsawTaskResp:e.puzzleTaskResp},e.evts={Puzzle:{C2C_INIT_MODEL:e.checkAllAlerts},Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},EscortList:{C2C_ESCORT_START:e.escortStart},CsTeam:{C2C_CSTEAM_NOTIFY:e.teamBattle},Instance:{C_UPDATE_CHALLENGE_NUM:e.addInstanceNum},CsGuild:{C2C_GUILD_BOSS_CHALLENGE:e.addGuildBossNum},Back:{C2C_REMOVE_AMOUNT:e.removeAmount},TaoFaPage:{C2C_TAOFA:e.addTaofaNum},PublicBoss:{C2C_BATTLE_RESULT:e.updatePublicBossNum},Arena:{C2C_UPDATE_MINE_RANK:e.updateArenaNum},Exam:{C2C_EXAM_QUESTION_RIGHT:e.updateExamSuccessNum},InstanceMaterial:{C2C_MATERIAL_RESULT:e.updateMaterialNum},PersonalBoss:{C2C_ADD_FINISH_COUNT:e.updatePerson},VipBossChallenge:{C2C_BATTLE_RESULT:e.battleResult},Recruit:{C2C_CHOUJIANG_LEN:e.chouJiangLen},Guaji:{C2C_UPDATE_QUICK:e.updataInstance},ZhuanJiBattle:{C2C_CHALLENGE_SUCCEED:e.updatePartnerBiography}}},updatePartnerBiography:function(e){var t=e?e.data:null;t&&(game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskZhuanJi,t),this.send(this.Evts.V_UPDATE_DATA))},updataInstance:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskQuickBattle,1),this.send(this.Evts.V_UPDATE_DATA)},chouJiangLen:function(e){var t=e?e.data:null;t&&(10<t&&(t=10),game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskRecruit,t),this.send(this.Evts.V_UPDATE_DATA))},battleResult:function(e){(e?e.data:null)&&(game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskVipBoss,1),this.send(this.Evts.V_UPDATE_DATA))},updatePerson:function(e){var t=e?e.data:null;t&&(game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskPersonBoss,t),this.send(this.Evts.V_UPDATE_DATA))},updateMaterialNum:function(e){e&&e.data&&(game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskMaterial,e.data),this.send(this.Evts.V_UPDATE_DATA))},updateExamSuccessNum:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskAnswer,1),this.send(this.Evts.V_UPDATE_DATA)},updateArenaNum:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskArena,1),this.send(this.Evts.V_UPDATE_DATA)},updateXunBaoNum:function(e){if(e&&e.data){var t=e.data;if(t){var a=t.xunbaoType,i=t.count;2==a||1==a&&game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskGoldXunBao,i),this.send(this.Evts.V_UPDATE_DATA)}}},updatePublicBossNum:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskQuanMin,1),this.send(this.Evts.V_UPDATE_DATA)},addTaofaNum:function(e){e&&e.data&&(game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskTaoFa,e.data),this.send(this.Evts.V_UPDATE_DATA))},updataAmount:function(e){if(!!!e.data){var t=game.amount.get(game.AmountType.YUAN_BAO);if(this.lastYuanbaoCount||(this.lastYuanbaoCount=t),this.lastYuanbaoCount>t){var a=this.lastYuanbaoCount-t;game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskCostGold,a)}this.lastYuanbaoCount=t}},removeAmount:function(e){e&&e.data&&game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskCostGold,e.data)},addGuildBossNum:function(){var e=game.PuzzleTaskType.TaskGuildBoss;game.puzzleData.hasGetGuildBossNum||(game.puzzleData.updateTaskProg(e,1),this.checkAllAlerts(),game.puzzleData.hasGetGuildBossNum=!0,this.send(this.Evts.V_UPDATE_DATA))},addInstanceNum:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskWild,1),this.checkAllAlerts(),this.send(this.Evts.V_UPDATE_DATA)},teamBattle:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskTeam,1),this.checkAllAlerts(),this.send(this.Evts.V_UPDATE_DATA)},escortStart:function(){game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskEscort,1),this.checkAllAlerts(),this.send(this.Evts.V_UPDATE_DATA)},rechargeSuccess:function(e){if(e&&e.data){var t=e.data,a=0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;game.puzzleData.updateTaskProg(game.PuzzleTaskType.TaskRecharge,a),this.checkAllAlerts(),this.send(this.Evts.V_UPDATE_DATA)}},checkAllAlerts:function(){this.taskSpotAlert.alert=game.puzzleData.checkTaskAlerts()},getTaskReward:function(e){var t=e.type,a=e.id;0!=t&&0!=a&&this.sender.JigsawTaskReq(t,a)},puzzleTaskResp:function(e){var t=e.readProtobuf(game.pb.JigsawTaskResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.puzzleData.onCompleteTask(t.taskType,t.taskId),this.send(this.Evts.V_UPDATE_DATA),this.checkAllAlerts(),this.dpt(this.Evts.ON_TASK_NUM_RESP)}});var t=game.Sender.extends({ipc:function(){this.msg={JigsawTaskReq:this.puzzleTaskReq}},puzzleTaskReq:function(e,t){var a=game.pb.JigsawTaskRequest;a.taskType=e,a.taskId=t,this.write(a)}});b8e.module.registerControl(game.ME.PuzzleTask,e,game.PuzzleEvts,t),b8e.RC("$$game","$$PuzzleTaskCtrl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.activeSpotAlert=game.spotAlert.set(game.SAE.PUZZLE_ACTIVE_CHIP,game.SAE.PUZZLE)},ipc:function(){this.handels={JigsawModelResp:this.puzzleModelResp,ActivateChipResp:this.activateChipResp,ActivateJigsawResp:this.activatePuzzleResp},this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},PuzzleHelp:{ON_HELP_RESP:this.refreshNum},PuzzleTask:{ON_TASK_NUM_RESP:this.refreshNum}}},refreshNum:function(){this.checkActiveAlert(),this.send(this.Evts.C2V_REFRESH_HELPNUM)},resetDaily:function(){this.sender.JigsawModelReq()},triggerOpen:function(e){e==this.moduleEnum&&(this.sender.JigsawModelReq(),this.sender.HelpLogReq())},activePuzzle_btn:function(){0!=game.puzzleData.curPuzzleId&&this.sender.ActivateJigsawReq()},activeChip_btn:function(){var e=game.puzzleData;if(e)if(0!=e.todayActiveNum){var a=0,i=0;e.curPuzzleChipInfos.forEach(function(e,t){t.active||0!=a||(i=t.id,a=t.chipId)},this),0!=i&&0!=a&&this.sender.ActivateChipReq(i,a)}else game.notice.show(game.Lang.get(6561))},checkActiveAlert:function(){this.activeSpotAlert.alert=game.puzzleData.checkActiveChipAlert()},task_btn:function(){game.module.show(game.ME.PuzzleTask)},puzzleModelResp:function(e){var t=e.readProtobuf(game.pb.JigsawModel);if(0<t.code){game.notice.noticeError(t.code)}else game.puzzleData.syncModelDatas(t),this.checkActiveAlert(),this.dpt(this.Evts.C2C_INIT_MODEL)},onChatHelpNotify:function(e){var t=e.readProtobuf(game.pb.JigsawGuildHelpResponse);if(0<t.code){game.notice.noticeError(t.code)}else;},helpLogResp:function(e){var t=e.readProtobuf(game.pb.HelpLogResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.puzzleData.updateLogs(t.logs),this.send(this.Evts.V_UPDATE_LOG)},activatePuzzleResp:function(e){var t=e.readProtobuf(game.pb.ActivateJigsawResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.puzzleData.onPuzzleActive(t),this.send(this.Evts.V_UPDATE_DATA),this.checkActiveAlert()},activateChipResp:function(e){var t=e.readProtobuf(game.pb.ActivateChipResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.puzzleData.onChipActive(t.id,t.chip),this.send(this.Evts.V_UPDATE_DATA),this.checkActiveAlert()}});var t=game.Sender.extends({ipc:function(){this.msg={JigsawModelReq:null,ActivateChipReq:this.activateChipReq,ActivateJigsawReq:null,HelpLogReq:null,JigsawGuildHelpReq:null}},activateChipReq:function(e,t){var a=game.pb.ActivateChipRequest;a.id=e,a.chip=t,this.write(a)}});b8e.module.registerControl(game.ME.Puzzle,e,game.PuzzleEvts,t),b8e.RC("$$game","$$PuzzleCtrl",e)}(),function(){var e=void 0;(e=game.ListItem.extends({roleId:0,icon:null,type:0,ctor:function(){this._super(865),this.setSize(540,126)},init:function(){this.headIcon=b8e.Sprite.get(),this.headIcon.setAnchor(.5,.5),this.headIcon.setSize(84,84),this.headIcon.addToParent(this.skin.iconBg)},setData:function(){var e=this.data;this.roleId=e.roleId,this.type=e.type;var t=this.skin;t.lab_name.string=game.Lang.get(6575,e.name,e.lv),t.lab_progress.string=game.Lang.get(6574,e.beHelpedNum,game.puzzleData.todayBeHelpMaxNum),this.headIcon.loadTexture(game.ResCfg.getHead(e.isMale))},btn_goto:function(){0!=this.roleId&&0!=this.type&&this.send(game.PuzzleEvts.ON_GOTO_HELP,{roleId:this.roleId,type:this.type})}})).poolCall=!0,b8e.RC("$$game","$$PuzzleHelpItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(866)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PuzzleHelpItem,e.bindEnum=game.ME.PuzzleHelp,e.addToParent(this.skin.helpList),e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updataList()}},onShow:function(){this.send(this.Evts.V2C_ONSHOW)},updataList:function(){var e=game.puzzleData;if(e){var t=e.getPuzzleHelpData(e.openHelpType);this.list.setData(t)}}});b8e.module.registerView(game.ME.PuzzleHelp,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(868),this.setSize(540,94)},setData:function(){var e=this,t=e.data,a=e.skin;a.lab_name.string=game.HtmlUtil.getText(game.Color.BLACK,t.cfg.title)+"\n"+game.Lang.get(t.prog>=t.cfg.condition?6573:6572,t.prog,t.cfg.condition),a.lab_desc.string=game.Lang.get(6571,t.cfg.num),e.me=e.data.cfg.moduleId,e.data.isAllGetReward?(e.skin.btn_getReward.setVisible(!1),e.skin.btn_goto.setVisible(!1)):(e.skin.btn_getReward.setVisible(t.prog>=t.cfg.condition),e.skin.btn_goto.setVisible(t.prog<t.cfg.condition&&0!=e.me))},btn_goto:function(){if(this.data.cfg&&0!=this.me){var e=this.data.taskType;if(e==game.PuzzleTaskType.TaskCostGold||e==game.PuzzleTaskType.TaskCostBindGold){var t=game.ShopIdEnum.YUANBAO_SHOP;return e==game.PuzzleTaskType.TaskCostBindGold&&(t=game.ShopIdEnum.EQUIP_SHOP),void this.dptG(game.ShopGEvts.SHOW_SHOP,t)}if(0<this.data.cfg.toggleIndex){var a=this.data.cfg.toggleIndex-1;game.module.showToggle(this.me,a)}else game.module.show(this.me)}},btn_getReward:function(){if(this.data){var e=this.data.taskType,t=this.data.taskId;this.send(game.PuzzleEvts.C2C_GET_TASK_REWARD,{type:e,id:t})}}}),b8e.RC("$$game","$$PuzzleTaskItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(869)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PuzzleTaskItem,e.bindEnum=game.ME.PuzzleTask,e.addToParent(this.skin.taskList),e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updataPanel()}},onShow:function(){this.updataPanel()},updataPanel:function(){this.updataNum(),this.updataTaskList()},updataNum:function(){this.skin.lbl_lightNum.string=game.puzzleData.todayActiveNum},updataTaskList:function(){var e=game.puzzleData.getPuzzleTaskData();this.list.setData(e)}});b8e.module.registerView(game.ME.PuzzleTask,e)}(),function(){var e=void 0;(e=game.Widget.extends({_itemGrid:null,ctor:function(){this._super(867),this.puzzleId=0},onShow:function(){var e=this,t=e.data;if(t){var a=e.data.size;e._itemGrid||(e._itemGrid=game.GridUtil.createPuzzleIcon(a),e._itemGrid.addToParent(e.skin.icon)),game.GridUtil.setPuzzleIcon(e._itemGrid,t,a,e.isNeedClear),e.puzzleId=t.id,e.skin.mask.setSize(a,a),e.skin.mask.setVisible(!t.active)}else;},show:function(e){this.isNeedClear=!0,this.data&&(this.isNeedClear=e.id!=this.data.id),this.data=e,this.hide(),this._super()}})).poolCall=!0,b8e.RC("$$game","$$PuzzleItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(870),this.spotAlerts={PUZZLE_ACTIVE_CHIP:this.activeAlert,PUZZLE_TASK:this.taskAlert}},activeAlert:function(e){this.skin.btn_redPoint2.setVisible(e.alert)},taskAlert:function(e){this.skin.btn_redPoint1.setVisible(e.alert)},init:function(){var e=this,t=e.skin;e.data=game.puzzleData;var a=game.puzzleData.rewardcfg.fullAwardSkinId,i=game.puzzleData.rewardcfg.fightPower;e.surfaceModel||(e.surfaceModel=new game.SurfaceModel,e.surfaceModel.addToParent(t.modelNode),e.surfaceModel.initModel(),e.surfaceModel.roleData.heroModel.type=game.RoleType.Partner);var n=game.PartnerCfg.getData(a);game.AvatarUtil.updateModel(n,e.surfaceModel,game.RoleType.Partner),e.skin.fightAmountLbl.string=i,e._fullItemGrid=game.GridUtil.createPrizeIcon(),e._fullItemGrid.addToParent(e.skin.reward_2_Node),e._activeItemGrid=game.GridUtil.createPrizeIcon(),e._activeItemGrid.addToParent(e.skin.reward_1_Node),e.cacheChips=[],e.puzzleWidth=340,e.puzzleHeight=340,e.effAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.effAnim.addToParent(e.skin.activePuzzle_btn),e.effAnim.load(game.ResCfg.getUrl(5019,1060)),e.effAnim.setScale(1,1)},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updataPanel();break;case this.Evts.V_UPDATE_LOG:this.updataLog();break;case this.Evts.C2V_REFRESH_HELPNUM:this.updateRewards(),this.updateInfos()}},onShow:function(){this.updataPanel()},updataPanel:function(){this.rewardcfg=game.puzzleData.rewardcfg,this.updateRewards(),this.updatePuzzles(),this.updateInfos(),this.createTimer()},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=this.data.getTimeByActId();if(e<1)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.timeLab.string=game.Lang.get(51900,t)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},updateRewards:function(){var e=this;if(!e._activePrizeInfo&&e.rewardcfg){var t=e.rewardcfg.activeAward;if(t&&0<t.length){var a=t[0];e._activePrizeInfo=game.ItemUtil.createBaseItemInfo(a.Id,a.Num,e._activePrizeInfo),game.GridUtil.setPrizeIcon(e._activeItemGrid,e._activePrizeInfo)}}if(!e._fullPrizeInfo&&e.rewardcfg){var i=e.rewardcfg.oneFullAward;if(i&&0<i.length){var n=i[0];e._fullPrizeInfo=game.ItemUtil.createBaseItemInfo(n.Id,n.Num,e._fullPrizeInfo),game.GridUtil.setPrizeIcon(e._fullItemGrid,e._fullPrizeInfo)}}},updateInfos:function(){var e=game.puzzleData.allComplete;this.skin.isAllCollected.setVisible(e),this.skin.hasNoCollected.setVisible(!e),e||(this.skin.hasActiveNum.string=game.Lang.get(6564,game.puzzleData.todayActiveNum))},updatePuzzles:function(){var s=this,e=game.puzzleData.curPuzzleChipInfos,t=e.count(),a=t-s.cacheChips.length;if(a<0)for(var i=s.cacheChips.length-1;t<i;i--)s.cacheChips[i].setVisible(!1);else for(var n=1;n<=a;n++){var r=new game.PuzzleItem;r.addToParent(s.skin.puzzleList),s.cacheChips[s.cacheChips.length]=r}var o=game.puzzleData.puzzleChipType,g=game.PuzzleSizeEnum.SIZE_68;switch(o){case game.PuzzleChipType.Type_4:g=game.PuzzleSizeEnum.SIZE_139;break;case game.PuzzleChipType.Type_9:g=game.PuzzleSizeEnum.SIZE_91;break;case game.PuzzleChipType.Type_16:g=game.PuzzleSizeEnum.SIZE_68}var u=parseInt(s.puzzleWidth/g),l=parseInt(s.puzzleHeight/g),c=s.puzzleWidth%g/(u-1),h=s.puzzleHeight%g/(l-1),m=0,d=0,f=0,p=0,v=0;e.forEach(function(e,t){t.active&&m++,0==v&&(v=t.cfg.puzzleIdx);var a=p*g;0!=p&&(a+=h*p,a*=-1);var i=f*g;0!=f&&(i+=c*f),f==u-1?(f=0,p++):f++;var n=s.cacheChips[d];n.show(t),n.setPosition(i,a),s.cacheChips[d].setVisible(!0),d++},s);var E=0;s.rewardcfg&&(E=s.rewardcfg.maxPuzzleNum),s.skin.proj.string=v+"/"+E,s.skin.activePuzzle_btn.setVisible(m==t&&!game.puzzleData.puzzleActive),s.skin.activeChip_btn.setVisible(m!=t),m!=t||game.puzzleData.puzzleActive||s.effAnim.play(),m!=t&&s.skin.btn_redPoint2.setVisible(game.puzzleData.checkActiveChipAlert())}});b8e.module.registerView(game.ME.Puzzle,e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_COUNT:-1,V2C_SELECT_ITEM:-1,C2C_USE_EFFECT_ITEM:-1,V2C_EDITING_END:-1}),b8e.RC("$$game","$$SelectGiftEvts",e)}(),function(){var e=b8e.Object.extends({itemId:0,itemInfo:null,gifts:null,itemPool:null,selectGiftId:0,curCount:1,createGift:function(e){if(e){this.gifts||(this.gifts=[]),this.itemId=e,this.curCount=1,this._clearItemInfos();var t=game.ItemInfoCfg.getData(e);if(t&&9==t.effectType&&!(t.effectValue.length<1))for(var a=void(this.selectGiftId=0),i=void 0,n=t.effectValue,s=0,r=n.length;s<r;s++)1<(a=n[s].split(",")).length&&((i=this._getItemInfo()).clear(),i.id=+a[0],i.num=+a[1],i.selected&&(this.selectGiftId=i.id),this.gifts.push(i))}},selectGift:function(e){var t=this.gifts;if(e&&t&&!(t.length<1)){this.selectGiftId=e;for(var a=null,i=0,n=t.length;i<n;i++)(a=t[i]).selected=a.id==e}},_getItemInfo:function(){var e=this.itemPool;return 0<(e=e||(this.itemPool=[])).length?e.shift():new game.SelectItemInfo},_clearItemInfos:function(){if(this.gifts&&this.itemPool){for(var e=0,t=this.gifts.length;e<t;e++)this.itemPool.push(this.gifts[e]);this.gifts.length=0}}});game.selectGiftData=game.selectGiftData||new e}(),function(){var e;e=b8e.Object.extends({id:0,selected:!1,isShowNum:!1,isShowLab:!1,clear:function(){this.id=0,this.num=0,this.selected=!1,this.isShowNum=!1,this.isShowLab=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$SelectItemInfo",e)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={},this.handels={}},notify:function(e,t){switch(e){case this.Evts.V2C_SELECT_ITEM:game.selectGiftData.selectGift(t);break;case this.Evts.V2C_EDITING_END:var a=+t;this.changeCount(a,!0)}},getBtn:function(){game.selectGiftData.selectGiftId<1?game.notice.show(52279):(this.dpt(this.Evts.C2C_USE_EFFECT_ITEM),game.module.hide(this.moduleEnum))},addBtn:function(){this.changeCount(1)},maxBtn:function(){this.changeCount(9999999)},lessBtn:function(){this.changeCount(-1)},minBtn:function(){this.changeCount(-9999999)},changeCount:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=game.selectGiftData,n=game.itemData.getNumById(i.itemInfo.id),s=void 0;(s=a?e:i.curCount+e)<1&&(s=1),n<s&&(s=n),i.curCount=s,this.send(this.Evts.C2V_UPDATE_COUNT,s)}});b8e.module.registerControl(game.ME.SelectGift,e,game.SelectGiftEvts,null)}(),function(){var e;e=game.ListItem.extends({itemCfgType:0,ctor:function(){this._super(938),this.setSize(156,252)},init:function(){this._icon=game.GridUtil.createItemIcon(),this._icon.addToParent(this.skin.iconNode)},setData:function(){var e=this,t=e.data;if(t){e.setByCfg(),t.isDarkBg=!0,game.GridUtil.setItemIcon(e._icon,t),e._icon.setLabNamePos(0,140),e._icon.setRichLabNamePos(0,140),e.skin.selectImg.active=t.selected,e.skin.battleImg.active=e.isShowLab,e.itemCfgType=game.ItemInfoCfg.getCfgTypeById(e.data.id);var a=0;a=e.itemCfgType==game.ItemCfgType.Equip||e.itemCfgType==game.ItemCfgType.PartnerProper?game.equipData.getItemNumById(t.id):game.itemData.getCountById(t.id),e.skin.haveNumLab.string=e.isShowNum?game.Lang.get(53513,a):""}},setByCfg:function(){var e=this;e.isShowLab=!1,e.isShowNum=!1;var t=game.ItemInfoCfg.getData(e.data.id);if(t){if(2==t.effectType||9==t.effectType||t.isPartner||(e.isShowNum=!0),0<t.partnerId){var a=game.partnerData.getInfoById(t.partnerId);a&&0<a.battlePos&&(e.isShowLab=!0)}if(!e.isShowLab&&t.functionType){var i=game.ItemFunctionType,n=t.functionValue;switch(t.functionType){case i.TYPE_1:var s=game.partnerData.getInfoById(n);s&&0<s.battlePos&&(e.isShowLab=!0);break;case i.TYPE_2:e.isShowLab=game.fosterData.getIsInBattle(game.NewFosterType.SHENHUN,n);break;case i.TYPE_3:e.isShowLab=game.fosterData.getIsInBattle(game.NewFosterType.MOUNT,n);break;case i.TYPE_4:e.isShowLab=game.fosterData.getIsInBattle(game.NewFosterType.ZHANJI,n);break;case i.TYPE_5:e.isShowLab=game.fosterData.getIsInBattle(game.NewFosterType.WING,n);break;case i.TYPE_6:e.isShowLab=game.fosterData.getIsInBattle(game.NewFosterType.HALO,n);break;case i.TYPE_7:game.shenQiData.battleId==n&&(e.isShowLab=!0);break;case i.TYPE_8:game.zhenXingData.battleId==n&&(e.isShowLab=!0);break;default:b8e.error("\u672a\u5b9a\u4e49\u7684\u9053\u5177\u6240\u5c5e\u529f\u80fd\u7c7b\u578b...")}}}},selectBtn:function(){this.send(game.SelectGiftEvts.V2C_SELECT_ITEM,this.data.id)},iconBtn:function(){game.tipsData.setInfo(this.data);var e=game.ItemCfgType;switch(this.itemCfgType){case e.Equip:case e.PartnerProper:var t=game.partnerEquipData.createInfoById(this.data.id);t.setData(this.data),game.tipsData.setInfo(t),game.partnerEquipData.selInfo=t,this.itemCfgType==e.Equip&&game.module.show(game.ME.EquipDetailsTips),this.itemCfgType==e.PartnerProper&&game.module.show(game.ME.ExcEquipDetailsTips);break;default:game.module.show(game.ME.ItemTips)}}}),b8e.RC("$$game","$$SelectGiftItem",e)}(),function(){var e=game.View.extends({_showModel:!0,scrollViewH1:262,scrollViewH2:410,bg3H1:722,bg3H2:870,rinkBgH1:337,rinkBgH2:485,usePageY1:-436,usePageY2:-584,ctor:function(){this._super(939)},init:function(){var e=this.skin,t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.SelectGiftItem,t.bindEnum=game.ME.SelectGift,t.layout.paddingTop=0,t.layout.paddingLeft=15,t.layout.spacingX=18,t.layout.spacingY=8,t.addToParent(e.scrollview),e.count._editBox._textLabel.horizontalAlign=b8e.HorizontalAlign.CENTER,e.count.onEditingEnded(this.editingEnd,this),this.patt=/^[0-9]*[1-9][0-9]*$/},notify:function(e){switch(e){case game.SelectGiftEvts.C2V_UPDATE_COUNT:this.updateCount()}},onShow:function(){var e=this,t=e.skin;e.updateCount();var a=game.selectGiftData.gifts,i=a&&3<a.length,n=i?e.scrollViewH2:e.scrollViewH1;e._list.setContainerSize(538,n),t.bg_3.height=i?e.bg3H2:e.bg3H1,t.rink_bg.height=i?e.rinkBgH2:e.rinkBgH1,t.usePage.y=i?e.usePageY2:e.usePageY1,e._list.setData(game.selectGiftData.gifts),e.height=i?e.bg3H2:e.bg3H1,e.skin.returnBtn.y=50-e.height,e.onStageResize()},updateCount:function(){this.skin.count.string=game.selectGiftData.curCount},editingEnd:function(){var e=this.skin.count.string;if(!this.patt.test(e)||""===e)return this.skin.count.string=1,void game.notice.show(1607);this.send(this.Evts.V2C_EDITING_END,e)},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.SelectGift,e)}(),function(){var e;e=b8e.GameConfig.extends({obj1:null,obj2:null,rechargeList:null,ctor:function(){this._super(),this.groupMap=b8e.HashMap.get(),this.groupList=[]},onInited:function(){this.obj1={id:0},this.obj2={mergeStart:0},this.obj3={group:0}},getListByDay:function(e){return this.obj3.group=e,this.getData(this.obj3,!0,!1)},getDataById:function(e){return this.obj1.id=e,this.getData(this.obj1)},getOneDataByDay:function(e){return this.obj3.group=e,this.getData(this.obj3,!1,!1,!1)},getCurGroup:function(e,t){if(!this.groupList.length){var a=this.getKeys("group");if(!a||!a.length)return;for(var i=a.length,n=0;n<i;n++){var s=a[n];this.obj3.group=s;var r=this.getData(this.obj3,!1,!1,!1);this.groupList.push(r)}}var o=this.groupList;for(i=o.length,n=0;n<i;n++){if((r=o[n]).mergeVer==t&&(e>=r.mergeStart&&e<r.mergeEnd))return r.group}return 0}}),b8e.RC("$$game","$$MergeAccuRechargeCfg",e)}(),function(){var e;e=b8e.Enum({None:0,V_UPDATE_VIEW:-1,V_RECEIVE_ITEM:-1}),b8e.RC("$$game","$$MergeTotalRechargeEvts",e)}(),function(){var e=b8e.Object.extends({selectId:0,accRechargeMoney:0,awardList:null,curGroup:0,endTime:0,isGetAllAward:!0,ctor:function(){this._super(),this.activityList=[],this.awardList=[],this.moneyMap=b8e.HashMap.get(),this.awardMap=b8e.HashMap.get(),this.activityMap=b8e.HashMap.get()},setupData:function(e){var t;if(e)for(var a=0,i=e.length;a<i;a++)t=e[a],this.awardMap.set(t.group,t.rechargeAwards),this.moneyMap.set(t.group,t.rechargeMoney);var n=game.miscData,s=n.serverMergeDays,r=game.miscData.mergeVersion;if(this.curGroup=game.MergeAccuRechargeCfg.getCurGroup(s,r),this.curGroup){var o=game.MergeAccuRechargeCfg.getOneDataByDay(this.curGroup);o&&(this.endTime=n.mergeServerTime+(o.mergeEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS),this.initList()}},initList:function(){var e=this;if(e.activityList.length=0,e.curGroup){var t=game.MergeAccuRechargeCfg.getListByDay(e.curGroup);if(t&&!(t.length<1)){var a=0,i=t.length;e.isGetAllAward=!0;for(var n=e.getAccRechargeMoney(),s=0;s<i;s++){var r=t[s],o=new game.MergeTotalRechargeInfo;o.index=a,a++,o.setData(r),o.diffMoney=o.needMoney-e.getAccRechargeMoney(),o.isGetAward=e.getIsGetAward(o.id),e.isGetAllAward&&(e.isGetAllAward=o.isGetAward),r.money<=n?o.canGet=!0:o.canGet=!1,e.activityMap.set(o.id,o),e.activityList.push(o)}}}},getIsGetAward:function(e){return!!this.curGroup&&-1<this.getAwardList(this.curGroup).indexOf(e)},getAwardList:function(e){var t=this.awardMap.get(e);return t||(t=[],this.awardMap.set(e,t)),t},setAward:function(e){var t=this;if((t.activityMap.get(e).isGetAward=!0,t.curGroup)&&(t.getAwardList(t.curGroup).push(e),t.isGetAllAward=!0,t.activityList&&!(t.activityList.length<1)))for(var a=t.activityList.length,i=0;i<a;i++){if(!t.activityList[i].isGetAward)return void(t.isGetAllAward=!1)}},updataAccRechargeMoney:function(e){var t=this;if(t.curGroup){var a=t.moneyMap.get(t.curGroup);if(a?a+=e:a=e,t.moneyMap.set(t.curGroup,a),t.activityList&&!(t.activityList.length<1))for(var i=t.activityList.length,n=0;n<i;n++){var s=t.activityList[n];s.diffMoney=s.needMoney-t.getAccRechargeMoney(),s.needMoney<=a?s.canGet=!0:s.canGet=!1}}},resetDaily:function(){if(this.curGroup){var e=game.miscData,t=e.serverMergeDays,a=game.MergeAccuRechargeCfg.getCurGroup(t);if(a!=this.curGroup&&((this.curGroup=a)&&this.moneyMap.set(a,0),this.curGroup)){var i=game.MergeAccuRechargeCfg.getOneDataByDay(this.curGroup);i&&(this.endTime=e.mergeServerTime+(i.mergeEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS),this.initList()}}},isOpen:function(){game.miscData.serverMergeDays;return!!game.moduleOpen.checkOpen(game.ME.MergeTotalRecharge)&&!!this.curGroup},getAllAward:function(){return this.isGetAllAward},getAccRechargeMoney:function(){if(!this.curGroup)return 0;var e=this.moneyMap.get(this.curGroup);return e||0},getActivityList:function(){return this.activityList.sort(this.listSort)},listSort:function(e,t){return!e.isGetAward&&t.isGetAward?-1:e.isGetAward&&!t.isGetAward?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.id-t.id},getActivityInfo:function(e){return this.activityMap.get(e)},getEndTime:function(){return this.endTime-game.SysTime.curTime},getMaxId:function(){return!this.activityList||this.activityList.length<1?0:this.activityList[this.activityList.length-1].id},checkAlert:function(){if(this.curGroup&&this.activityList&&!(this.activityList.length<1)){if(this.isGetAllAward)return!1;for(var e=this.activityList.length,t=0;t<e;t++){var a=this.activityList[t];if(a.canGet&&!a.isGetAward)return!0}return!1}}});game.mergeTotalRechargeData=game.mergeTotalRechargeData||new e}(),function(){var e;e=b8e.Object.extends({id:0,isGetAward:!1,select:!1,canGet:!1,needMoney:0,diffMoney:0,value:0,name:"",index:0,setData:function(e){this.id=e.id,this.needMoney=e.money,this.value=e.value,this.name=e.name},getCfg:function(){var e=game.MergeAccuRechargeCfg.getDataById(this.id);return e||null},getPrizeList:function(){if(this.prizeList)return this.prizeList;var e=game.MergeAccuRechargeCfg.getDataById(this.id);if(!e)return null;var t=game.CfgUtil.getPrizeListInfo(e.award);return this.prizeInfo=t.items,this.prizeInfo}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$MergeTotalRechargeInfo",e)}(),function(){var e=game.Control.extends({init:function(){var e=game.spotAlert;this.spotTotalRechargeAlert=e.set(game.SAE.MERGE_TOTAL_RECHARGE,game.SAE.MERGE_SERVER_ALERT)},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.initRechargeData,C_RECHARGE_SUCCESS:this.rechargeSuccess},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={MergeAccRechargeResp:this.mergeAccRechargeResp}},mergeAccRechargeResp:function(e){var t=e.readProtobuf(game.pb.MergeAccRechargeResponse);0<t.code?game.notice.noticeError(t.code):(game.mergeTotalRechargeData.setAward(t.id),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW))},notify:function(e,t){switch(e){case this.Evts.V_RECEIVE_ITEM:this.sender.MergeAccRechargeReq(t)}},initRechargeData:function(){var e=game.rechargeData;game.mergeTotalRechargeData.setupData(e.mergeAccRecharges),this.checkSpotAlert(),this.checkOpen()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data,a=0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;game.mergeTotalRechargeData.updataAccRechargeMoney(a),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW)}},resetDaily:function(){game.mergeTotalRechargeData.resetDaily(),this.checkSpotAlert(),this.checkOpen(),this.send(this.Evts.V_UPDATE_VIEW)},checkOpen:function(){var e=game.mergeTotalRechargeData.isOpen(),t={openServerType:game.OpenServerType.MERGE_TOTAL_RECHARGE,isActive:e,sae:game.SAE.MERGE_TOTAL_RECHARGE};this.dptG(game.MergeServerGEvts.C2C_CHANGE_MERGESERVER,t)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)},checkSpotAlert:function(){var e=game.mergeTotalRechargeData;this.spotTotalRechargeAlert.alert=e.checkAlert()}}),t=game.Sender.extends({ipc:function(){this.msg={MergeAccRechargeReq:this.mergeAccRechargeReq}},mergeAccRechargeReq:function(e){var t=game.pb.MergeAccRechargeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.MergeTotalRecharge,e,game.MergeTotalRechargeEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1040),this.setSize(600,177)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.priceList),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=15},setData:function(){var e=this.skin,t=this.data,a=t.getPrizeList();this.prizeList.setData(a),e.lb_tips.string=t.name,e.diffNumLab.string=game.Lang.get(9553,t.diffMoney),e.diffNumLab.node.active=!t.canGet&&!t.isGetAward,e.getBtn.node.active=t.canGet&&!t.isGetAward,e.already_got.node.active=t.isGetAward},getBtn:function(){this.send(game.MergeTotalRechargeEvts.V_RECEIVE_ITEM,this.data.id)}}),b8e.RC("$$game","$$MergeTotalRechargeItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(698)},init:function(){var e=this,t=e.skin;e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.list.itemRender=game.MergeTotalRechargeItem,e.list.bindEnum=game.ME.MergeTotalRecharge,e.list.layout.paddingLeft=0,e.list.layout.paddingTop=0,e.list.layout.spacingY=5,e.list.addToParent(t.list),e.timer=b8e.Timer.add(e,e.updateTime,500)},updateTime:function(){if(!this.endTime){return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime()}this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateData()}},onShow:function(){var e=this,t=game.mergeTotalRechargeData.curGroup;if(t){var a=game.MergeAccuRechargeCfg.getOneDataByDay(t);if(!a)return;var i=void 0;a.banner&&(i=game.ResCfg.getImgUrl(a.banner,!0)),i&&e.skin.banner.loadTexture(i)}e.updateData()},updateData:function(){var e=this,t=e.skin;e.endTime=game.mergeTotalRechargeData.endTime,e.timer.reset(),e.timer.start(),e.updateTime(),t.rechargeNumLab.string=game.Lang.get(9531,game.mergeTotalRechargeData.getAccRechargeMoney()),e.datas=game.mergeTotalRechargeData.getActivityList(),e.list.setData(e.datas)},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){}});b8e.module.registerView(game.ME.MergeTotalRecharge,e)}(),function(){var e;e=b8e.Enum({None:0,V_UPDATE_VIEW:-1,V_GET_ITEM:-1,V_GOTO:-1}),b8e.RC("$$game","$$MarryMissionEvts",e)}(),function(){var e=void 0;e=b8e.Object.extends({activityMap:null,activityList:null,awardList:null,conditionMap:null,endTimeMap:null,ctor:function(){this.activityList=[],this.activityMap=b8e.HashMap.get(),this.conditionMap=b8e.HashMap.get(),this.endTimeMap=b8e.HashMap.get(),this._super()},setupData:function(e,t){for(var a=0,i=e.length;a<i;a++){var n=e[a];this.conditionMap.set(n.activityType,n.process)}t&&(this.awardList=t);var s=game.SocialGoalCfg.getDatas();if(s){for(var r=0,o=s.length;r<o;r++){var g=s[r],u=new game.ActivityMissionInfo;u.setData(g),this.activityMap.set(u.id,u)}this.initList()}},initList:function(){var e,t=this.activityMap.values();this.activityList.length=0,this.endTimeMap.clear();for(var a=game.miscData,i=0,n=t.length;i<n;i++){var s=t[i];if(s.isGetAward=this.getIsGetAward(s.id),s.canGet=this.canGet(s.activityType,s.subType),this.checkOpen(s))e=a.openServerTime+(s.serverEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS,(this.endTimeMap.get(s.tab)||0)<e&&this.endTimeMap.set(s.tab,e),this.activityList.push(s)}},checkAllCanGet:function(){for(var e=0,t=this.activityList.length;e<t;e++){var a=this.activityList[e];a.canGet=this.canGet(a.activityType,a.subType)}},checkOpen:function(e){var t=game.miscData;return e.serverStart<=t.openServerDay&&e.serverEnd>t.openServerDay},setCondition:function(e,t){this.conditionMap.set(e,t)},canGet:function(e,t){var a=this.conditionMap.get(e)||0;if(t){if(t<=a)return!0}else if(a)return!0;return!1},getIsGetAward:function(e){return-1<this.awardList.indexOf(e)},setAward:function(e){this.activityMap.get(e).isGetAward=!0,this.awardList.push(e),this.isGetAllAward=!0,this.activityList&&this.activityList.length},resetDaily:function(){this.initList()},isOpen:function(e){return!!this.endTimeMap.get(e)},getEndTime:function(e){return this.endTimeMap.get(e)||0},getActivityList:function(e){for(var t=[],a=0,i=this.activityList.length;a<i;a++){var n=this.activityList[a];e==n.tab&&t.push(n)}return t.sort(this.listSort)},listSort:function(e,t){return!e.isGetAward&&t.isGetAward?-1:e.isGetAward&&!t.isGetAward?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.id-t.id},checkAlert:function(e){if(this.activityList&&!(this.activityList.length<1)){for(var t=this.activityList.length,a=0;a<t;a++){var i=this.activityList[a];if(i.tab==e&&i.canGet&&!i.isGetAward)return!0}return!1}}}),game.activityMissionData=game.activityMissionData||new e,b8e.RC("$$game","$$ActivityMissionData",e)}(),function(){var e,t;t=b8e.Enum({None:0,BAI_SHI:1,SHOU_TU:2,HUN_LI:3,CREATE_GUILD:4,JION_GUILD:5}),e=b8e.Enum({None:0,MARRY:1,GUILD:2}),b8e.RC("$$game","$$ActivityMissionType",t),b8e.RC("$$game","$$ActivityMissionTabType",e)}(),function(){var e;e=b8e.Object.extends({id:0,isGetAward:!1,canGet:!1,condition:0,activityType:0,subType:0,name:"",serverStart:0,serverEnd:0,award:null,tab:0,setData:function(e){this.id=e.id,this.condition=e.condition,this.activityType=e.activityType,this.name=e.name,this.subType=e.subType,this.serverStart=e.serverStart,this.serverEnd=e.serverEnd,this.award=e.award,this.tab=e.tab},getPrizeList:function(){if(this.prizeList)return this.prizeList;if(!this.award)return null;var e=game.CfgUtil.getPrizeListInfo(this.award);return this.prizeInfo=e.items,this.prizeInfo}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ActivityMissionInfo",e)}(),function(){var e=game.Control.extends({init:function(){var e=game.spotAlert;this.spotMarryMissionAlert=e.set(game.SAE.MARRY_MISSION_ALERT,game.SAE.OPEN_SERVER_ALERT),this.spotGuildMissionAlert=e.set(game.SAE.GUILD_MISSION_ALERT,game.SAE.OPEN_SERVER_ALERT)},ipc:function(){var e=this;e.evts={MainRole:{C_RESET_DAILY:e.resetDaily},MasterApprentice:{C_UPDATEMASTER:e.updateMaster,C_UPDATEAPPRENTICE:e.updateApprentice},OpenServer:{C2C_INIT_OPENSERVER:e.openServerInit},Marry:{C_MARRY_COMPLETE:e.updateMarry},CreateGuild:{C_CREATE_GUILD:e.createGuild},Guild:{C_JOIN_GUILD:e.joinGuild},GuildRecommend:{C_JOIN_GUILD:e.joinGuild}},e.handels={SocialGoalResp:e.socialGoalResp}},socialGoalResp:function(e){var t=e.readProtobuf(game.pb.SocialGoalResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.activityMissionData.setAward(t.id),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW)},triggerOpen:function(){this.moduleEnum},openServerInit:function(){this.checkSpotAlert(),this.checkOpen(),this.checkAllGet(),this.send(this.Evts.V_UPDATE_VIEW)},notify:function(e,t){switch(e){case this.Evts.V_GET_ITEM:this.sender.SocialGoalReq(t);break;case this.Evts.V_GOTO:this.goto(t)}},goto:function(e){var t=game.ActivityMissionType;switch(e){case t.BAI_SHI:case t.SHOU_TU:game.module.showToggle(game.ME.PeachGarden,2);break;case t.HUN_LI:game.module.showToggle(game.ME.PeachGarden,0);break;case t.JION_GUILD:case t.CREATE_GUILD:game.module.show(game.ME.GuildRecommend)}},updateMaster:function(){game.activityMissionData.setCondition(game.ActivityMissionType.BAI_SHI,1),this.checkAllGet()},updateApprentice:function(){game.activityMissionData.setCondition(game.ActivityMissionType.SHOU_TU,1),this.checkAllGet()},updateMarry:function(e){var t=e.data;game.activityMissionData.setCondition(game.ActivityMissionType.HUN_LI,t),this.checkAllGet()},createGuild:function(){game.activityMissionData.setCondition(game.ActivityMissionType.CREATE_GUILD,1),game.activityMissionData.setCondition(game.ActivityMissionType.JION_GUILD,1),this.checkAllGet()},joinGuild:function(){game.activityMissionData.setCondition(game.ActivityMissionType.JION_GUILD,1),this.checkAllGet()},checkAllGet:function(){game.activityMissionData.checkAllCanGet(),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW)},resetDaily:function(){game.activityMissionData.resetDaily(),this.checkSpotAlert(),this.checkOpen(),this.checkAllGet(),this.send(this.Evts.V_UPDATE_VIEW)},checkSpotAlert:function(){this.spotMarryMissionAlert.alert=game.activityMissionData.checkAlert(game.ActivityMissionTabType.MARRY),this.spotGuildMissionAlert.alert=game.activityMissionData.checkAlert(game.ActivityMissionTabType.GUILD)},checkOpen:function(){var e=game.activityMissionData.isOpen(game.ActivityMissionTabType.MARRY),t={openServerType:game.OpenServerType.MARRYMISSION,isActive:e,sae:game.SAE.MARRY_MISSION_ALERT};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,t);var a=game.activityMissionData.isOpen(game.ActivityMissionTabType.GUILD),i={openServerType:game.OpenServerType.GUILDMISSION,isActive:a,sae:game.SAE.GUILD_MISSION_ALERT};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,i)}}),t=[game.ME.GuildMission],a=game.Sender.extends({ipc:function(){this.msg={SocialGoalReq:this.socialGoalReq}},socialGoalReq:function(e){var t=game.pb.SocialGoalRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.MarryMission,e,game.MarryMissionEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(671),this.setSize(600,176)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.prizeList),t.layout.paddingLeft=6,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=15},setData:function(){var e=this,t=e.skin,a=e.data;t.title.string=a.name,e.prizeInfoList=this.data.getPrizeList(),e.prizeList.setData(e.prizeInfoList),t.getBtn.node.active=a.canGet&&!a.isGetAward,t.gotoBtn.node.active=!a.canGet&&!a.isGetAward,t.isGetImg.node.active=a.isGetAward},getBtn:function(){this.send(game.MarryMissionEvts.V_GET_ITEM,this.data.id)},gotoBtn:function(){this.send(game.MarryMissionEvts.V_GOTO,this.data.activityType)}}),b8e.RC("$$game","$$MarryMissionItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(542)},init:function(){var e=this,t=e.skin;e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.list.itemRender=game.MarryMissionItem,e.list.bindEnum=game.ME.MarryMission,e.list.layout.spacingY=5,e.list.addToParent(t.list),e.skin.banner.active=!1,e.timer=b8e.Timer.add(e,e.updateTime,500),e.skin.view_gotoBtn.active=!1,e.skin.curState.active=!1},updateTime:function(){if(!this.endTime){return this.skin.time.string=game.Lang.get(6601),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.time.string=game.Lang.get(6601),void this.stopTime()}this.skin.time.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateData()}},onShow:function(){var e=this;e.skin;e.updateData()},updateData:function(){var e=this;e.skin;e.endTime=game.activityMissionData.getEndTime(game.ActivityMissionTabType.MARRY),e.timer.reset(),e.timer.start(),e.updateTime(),e.datas=game.activityMissionData.getActivityList(game.ActivityMissionTabType.MARRY),e.list.setData(e.datas)},view_gotoBtn:function(){},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){}});b8e.module.registerView(game.ME.MarryMission,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(542)},init:function(){var e=this,t=e.skin;e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.list.itemRender=game.MarryMissionItem,e.list.bindEnum=game.ME.MarryMission,e.list.layout.spacingY=5,e.list.addToParent(t.list),e.skin.banner.active=!1,e.timer=b8e.Timer.add(e,e.updateTime,500),e.skin.view_gotoBtn.active=!1,e.skin.curState.active=!1},updateTime:function(){if(!this.endTime){return this.skin.time.string=game.Lang.get(6601),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.time.string=game.Lang.get(6601),void this.stopTime()}this.skin.time.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateData()}},onShow:function(){var e=this;e.skin;e.updateData()},updateData:function(){var e=this;e.skin;e.endTime=game.activityMissionData.getEndTime(game.ActivityMissionTabType.GUILD),e.timer.reset(),e.timer.start(),e.updateTime(),e.datas=game.activityMissionData.getActivityList(game.ActivityMissionTabType.GUILD),e.list.setData(e.datas)},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},view_gotoBtn:function(){},onStageResize:function(){}});b8e.module.registerView(game.ME.GuildMission,e)}(),function(){var e;e=b8e.Enum({None:0,GET_PRIZE:-1,C2V_GETPRIZE:-1,C2C_GETALLPRIZE:-1}),b8e.RC("$$game","$$MillionsLoginEvts",e)}(),function(){var e=b8e.Object.extends({getAwardsList:null,initData:function(){this.MLoginMap=b8e.HashMap.get();var e=game.MillionsLoginCfg.getDatas();if(e){for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)a=e[n],(t=new game.MillionsLoginItemInfo).setConfig(a),this.MLoginMap.set(a.loginDays,t);this.getAwardsList=[]}},getList:function(){var e=this.MLoginMap.values();return e&&0<e.length&&e.sort(this.onSort),e},syncData:function(e){if(e){e.millionsLoginAwards&&(this.getAwardsList=e.millionsLoginAwards),this.checkPoint()}},onSort:function(e,t){var a=game.millionsLoginData;return a.isGetPrize(e.loginDay)==a.isGetPrize(t.loginDay)?e.canGetPrize==t.canGetPrize?e.loginDay-t.loginDay:e.canGetPrize?-1:1:a.isGetPrize(e.loginDay)?1:a.isGetPrize(t.loginDay)?-1:void 0},checkPoint:function(){var e=this.MLoginMap;if(!e)return!1;var t=game.MillionsLoginCfg.getDatas();if(t){for(var a,i=void 0,n=t.length,s=0;s<n;s++)if(i=t[s],(a=e.get(i.loginDays)).isGetPrize=this.isGetPrize(i.loginDays),a.canGetPrize=this.canGetPrize(i.loginDays),a.canGetPrize)return!0;return!1}},isGetPrize:function(e){return-1<this.getAwardsList.indexOf(e)},canGetPrize:function(e){return!this.isGetPrize(e)&&e<=game.miscData.loginDay},setPrizeComplete:function(e){var t=this.getAwardsList;-1<t.indexOf(e)?b8e.warn("\u91cd\u590d\u9886\u53d6\u6210\u529f\uff1f"):t.push(e)},isGetAllPrize:function(){if(!this.MLoginMap)return!0;var e=game.MillionsLoginCfg.getDatas();if(e){for(var t=void 0,a=e.length,i=0;i<a;i++)if(t=e[i],!this.isGetPrize(t.loginDays))return!1;return!0}}});game.millionsLoginData=game.millionsLoginData||new e}(),function(){var e;e=b8e.Object.extends({isGetPrize:!1,canGetPrize:!1,setConfig:function(e){this.config=e,this.loginDay=e.loginDays},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e,t,a=this.config.award,i=a.length;this.awards=[];for(var n=0;n<i;n++)e=a[n],t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num),this.awards.push(t);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$MillionsLoginItemInfo",e)}(),function(){var e=game.Control.extends({init:function(){game.millionsLoginData.initData(),this.spotAlert=game.spotAlert.set(game.SAE.MILLIONS_LOGIN,game.SAE.WELFARE_ALERT)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.checkAlert},Welfare:{C_INIT_MODEL:this.checkAlert}},this.handels={MillionsLoginResp:this.onMillionsLoginRequest}},notify:function(e,t){switch(e){case this.Evts.GET_PRIZE:t<=game.miscData.loginDay&&this.sender.MillionsLoginReq(t)}},onMillionsLoginRequest:function(e){var t=e.readProtobuf(game.pb.MillionsLoginResponse);if(0<t.code)game.notice.noticeError(t.code);else{if(game.millionsLoginData.setPrizeComplete(t.loginDays),this.send(this.Evts.C2V_GETPRIZE),game.millionsLoginData.isGetAllPrize()){this.dpt(this.Evts.C2C_GETALLPRIZE)}this.checkAlert()}},checkAlert:function(){this.spotAlert.alert=game.millionsLoginData.checkPoint()}}),t=game.Sender.extends({ipc:function(){this.msg={MillionsLoginReq:this.MLoginReq}},MLoginReq:function(e){var t=game.pb.MillionsLoginRequest;t.loginDays=e,this.write(t)}});b8e.module.registerControl(game.ME.MillionsLogin,e,game.MillionsLoginEvts,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(720)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.MillionsLoginItem,this.list.bindEnum=game.ME.MillionsLogin,this.list.layout.paddingLeft=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.skin.banne.loadTexture(game.ResCfg.getUrl(152))},notify:function(e){switch(e){case this.Evts.C2V_GETPRIZE:this.awardsList=game.millionsLoginData.getList(),this.list.setData(this.awardsList)}},onShow:function(){this.data=game.millionsLoginData.getList(),this.list.setData(this.data)},onStageResize:function(){}});b8e.module.registerView(game.ME.MillionsLogin,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(719),this.setSize(601,177)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prize),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=17,e.layout.spacingY=-5},setData:function(){var e=this.skin,t=this.data,a=t.config,i=a.loginDays;if(a){e.level.string=game.Lang.get(6631,i);var n=t.getPrizeItems();this.prizeList.setData(n);var s=game.miscData.loginDay;i<=s?(e.getBtn.active=!t.isGetPrize,e.isGetImg.active=t.isGetPrize,e.cantGetLbl.active=!1):(e.cantGetLbl.string=game.Lang.get(6637,s,i),e.getBtn.active=!1,e.isGetImg.active=!1)}},getBtn:function(){this.send(game.MillionsLoginEvts.GET_PRIZE,this.data.loginDay)}}),b8e.RC("$$game","$$MillionsLoginItem",e)}(),function(){var e;e=b8e.Enum({C2C_INIT_MODEL:b8e.enc(),V_UPDATE_DATA:b8e.enc(),V2C_ONSHOW:b8e.enc(),C2V_SWITCH_SMASH_ANI:b8e.enc(),C2C_ALL_COMPLETE:b8e.enc()}),b8e.RC("$$game","$$SmashGoldEggEvts",e)}(),function(){var e;e=b8e.Object.extends({subId:0,idx:0,isComplete:!1,rewardId:0,rewardNum:0,ctor:function(){this._super()},setData:function(e,t,a,i){this.idx=e,this.subId=t,this.rewardId=a.Id,this.rewardNum=a.Num,this.isComplete=i}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$SmashGoldEggRewardInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this.goldEggInfoMap=b8e.HashMap.get(),this.isAllComplete=!1,this.costGoldVal=0,this.maxAwardNum=10,this.rewardcfg=[],this.smashNum=0,this.alreadyGetAwards=[],this.subId=1,this.curGroup=0},getIsOpen:function(){if(!game.moduleOpen.checkOpen(game.ME.SmashGoldEgg))return!1;var e=!1;return 0==game.SmashGoldEggOpenCfg.getCurGroup()||this.isAllComplete||(e=!0),e},initMiscCfg:function(){var e=game.SmashGoldEggMiscCfg.getData("SmashEggsCostGold");e&&(this.costGoldVal=parseInt(e.value))},initData:function(){var e=game.SmashGoldEggOpenCfg.getCurGroup();0!=e&&(this.curGroup=e,this.updateSmashData(e))},resetDaily:function(){if(game.moduleOpen.checkOpen(game.ME.SmashGoldEgg)){var e=game.SmashGoldEggOpenCfg.getCurGroup();0!=e&&this.curGroup!=e&&(this.initMiscCfg(),this.smashNum=0,this.alreadyGetAwards=[],this.subId=1,this.isAllComplete=!1,this.updateSmashData(e))}},syncModelDatas:function(e){if(this.getIsOpen()){this.initMiscCfg(),this.smashNum=e.smashEggsNumber,this.alreadyGetAwards=e.awardsIndex,this.subId=e.smashEggsSub;var t=e.smashEggsActiveId;this.updateSmashData(t)}},updateSmashData:function(e){var t=game.SmashGoldEggCfg.getData(e,this.subId);t&&(this.curGroup=e,this.rewardcfg=t.store,this.updateRewards(this.subId,this.alreadyGetAwards),this.checkAllComplete())},checkAllComplete:function(){var a=0,i=game.SmashGoldEggCfg.getMaxSubIdCfgByGroup(this.curGroup);this.goldEggInfoMap.forEach(function(e,t){t.isComplete&&t.subId>=i&&(a+=1)},this),this.isAllComplete=a>=this.maxAwardNum},updateRewards:function(e,t){for(var a=b8e.HashMap.get(),i=0;i<t.length;i++)a.set(t[i],!0);for(var n=0;n<this.rewardcfg.length;n++){var s=this.goldEggInfoMap.get(n);s=s||new game.SmashGoldEggRewardInfo;var r=this.rewardcfg[n],o=!1;a.get(n)&&(o=!0),s.setData(n,e,r,o),this.goldEggInfoMap.set(n,s)}},onCompleteAward:function(e,t){0<this.smashNum&&(this.smashNum-=1),this.alreadyGetAwards=t,this.subId=e,this.updateSmashData(this.curGroup)},updateSmashNum:function(e){this.smashNum=e},checkSmashAlert:function(){return!!game.moduleOpen.checkOpen(game.ME.SmashGoldEgg)&&0<this.getSurplusNum()},getSurplusNum:function(){var a=0;return this.goldEggInfoMap.forEach(function(e,t){t.isComplete&&(a+=1)},this),this.maxAwardNum-a},getSmashEndTime:function(){return game.SmashGoldEggOpenCfg.getEndTime(this.curGroup)}});game.smashGoldEggData=game.smashGoldEggData||new e}(),function(){var e;e=game.Control.extends({init:function(){this.smashSpotAlert=game.spotAlert.set(game.SAE.SMASH_GOLD_EGG_SMASH,game.SAE.SMASH_GOLD_EGG)},notify:function(e){switch(e){case this.Evts.V2C_ONSHOW:this.lockClick=!1,this.checkSmashAlert()}},checkSmashAlert:function(){this.smashSpotAlert.alert=game.smashGoldEggData.checkSmashAlert()},ipc:function(){this.handels={SmashEggsResp:this.smashEggsResp,SmashEggsMsg:this.smashEggsNumNotify},this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},OpenServer:{C2C_INIT_OPENSERVER:this.smashEggModelResp}}},resetDaily:function(){game.smashGoldEggData.resetDaily(),this.send(this.Evts.V_UPDATE_DATA)},smash_btn:function(){if(!game.smashGoldEggData.isAllComplete){var e=game.smashGoldEggData.smashNum,t=game.smashGoldEggData.costGoldVal;if(0==e)if(!game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,t,!0))return;this.lockClick||(this.send(this.Evts.C2V_SWITCH_SMASH_ANI,!0),this.lockClick=!0,b8e.setTimeout(this.timeoutFunc,this,1e3))}},timeoutFunc:function(){this.send(this.Evts.C2V_SWITCH_SMASH_ANI,!1),this.sender.SmashEggsReq()},triggerOpen:function(e){e==game.ME.SmashGoldEgg&&game.smashGoldEggData.initData()},smashEggModelResp:function(){this.checkSmashAlert(),this.dpt(this.Evts.C2C_INIT_MODEL)},smashEggsResp:function(e){this.send(this.Evts.C2V_SWITCH_SMASH_ANI,!1),this.lockClick=!1;var t=e.readProtobuf(game.pb.SmashEggsResponse);if(0<t.code){game.notice.noticeError(t.code)}else if(game.smashGoldEggData.onCompleteAward(t.smashEggsSub,t.awardsIndex),this.send(this.Evts.V_UPDATE_DATA),this.checkSmashAlert(),game.getRewardResultData.setData(t.awards,5),game.module.show(game.ME.GetRewardResult),game.smashGoldEggData.isAllComplete)return game.module.hide(this.moduleEnum),void this.dpt(this.Evts.C2C_ALL_COMPLETE)},smashEggsNumNotify:function(e){var t=e.readProtobuf(game.pb.SmashEggsNumNotify);if(0<t.code){game.notice.noticeError(t.code)}else game.smashGoldEggData.updateSmashNum(t.smashEggsNum),this.send(this.Evts.V_UPDATE_DATA),this.checkSmashAlert()}});var t=game.Sender.extends({ipc:function(){this.msg={SmashEggsReq:null}}});b8e.module.registerControl(game.ME.SmashGoldEgg,e,game.SmashGoldEggEvts,t),b8e.RC("$$game","$$SmashGoldEggCtrl",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(976)},init:function(){this.rewardGridsMap=b8e.HashMap.get(),this.prizeInfoMap=b8e.HashMap.get(),this.timer=b8e.Timer.add(this,this.updateTime,500)},updateTime:function(){if(!this.endTime){return this.skin.timeLab.string="",void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.timeLab.string="",this.stopTime(),void game.module.hide(this.moduleEnum)}this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},stopTime:function(){this.timer&&this.timer.stop()},onHide:function(){this.stopTime()},notify:function(e,t){switch(e){case this.Evts.V_UPDATE_DATA:this.prizeInfoMap.clear(),this.updataPanel();break;case this.Evts.C2V_SWITCH_SMASH_ANI:this.switchSmashAni(t)}},onShow:function(){this.timer&&this.timer.start(),this.switchSmashAni(!1),this.updataPanel(),this.send(this.Evts.V2C_ONSHOW)},updataPanel:function(){var e=game.smashGoldEggData;e&&(this.goldEggInfoMap=e.goldEggInfoMap,this.endTime=e.getSmashEndTime(),this.updateRewards(),this.updateCost(),this.updateTime(),this.updateNum())},updateNum:function(){this.skin.surplusNum.string=game.smashGoldEggData.getSurplusNum(),this.skin.hasNum.string=game.Lang.get(6641,game.smashGoldEggData.smashNum)},updateCost:function(){var e=0;game.smashGoldEggData.smashNum<=0&&(e=game.smashGoldEggData.costGoldVal),this.skin.smashCostGold.string=e},switchSmashAni:function(e){this.skin.egg_noSmash.setVisible(!e),this.skin.egg_smash.setVisible(e)},updateRewards:function(){if(this.goldEggInfoMap)for(var e=0;e<10;e++){var t=this.goldEggInfoMap.get(e);if(t){var a=this.rewardGridsMap.get(e);a||((a=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_84)).addToParent(this.getComponent("reward_"+(e+1))),this.rewardGridsMap.set(e,a));var i=t.rewardId,n=t.rewardNum,s=this.prizeInfoMap.get(e);s||(s=game.ItemUtil.createBaseItemInfo(i,n,this.prizeInfo),this.prizeInfoMap.set(e,s)),game.GridUtil.setPrizeIcon(a,s),this.getComponent("yinzhang_"+(e+1)).setVisible(t.isComplete)}}}});b8e.module.registerView(game.ME.SmashGoldEgg,e)}(),function(){var e;e=b8e.Enum({C2V_CHECK_AUTOBUY:b8e.enc(),C2V_UPDATA_PAGE:b8e.enc(),C2V_UPDATA_TIP:b8e.enc(),C2V_UPDATA_FIGHT_TIME:b8e.enc(),V2C_GET_AWARD:b8e.enc(),V2C_START_FIGHT:b8e.enc()}),b8e.RC("$$game","$$ZSShiLianEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,award:null,isCanGet:!1,isGet:!1,ctor:function(){this._super()},setData:function(e){this.id=e.id,this.award=e.firstItems[0]},setCanGet:function(e){this.isCanGet=e},setGet:function(){this.isCanGet=!1,this.isGet=!0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZSShiLianAwardInfo",e)}(),function(){var e=b8e.Object.extends({fightId:1,fightLv:1,fightTime:0,collected:null,autoFight:!1,enemy:null,maxId:0,buyTime:0,firstAward:0,ctor:function(){this._super(),this.finishAward=b8e.HashMap.get()},setup:function(e){var t=this;t.fightId=e.id,t.fightLv=e.level,t.fightTime=e.challenges,t.collected=e.collected,t.maxId=e.maxId,t.buyTime=e.buys,t.firstAward={},t.enemy={},t.setEnemy(e),t.setAward()},setEnemy:function(e){this.enemy.hp=e.hp,this.enemy.maxhp=e.maxhp},setAward:function(){for(var e=game.CfgUtil.getMiscValue(game.InstanceMiscCfg,"rebirthFirstItems",!0,"|"),t=e.length,a=void 0,i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=0;g<t;g++){(n=e[g].split(","))&&3<=n.length&&(o=Number(n[0]),r=Number(n[1]),s=Number(n[2]));for(var u=0;u<s;u+=r)!(a=game.RebirthCfg.getData(u,o,!1,!1,!1))||!a.firstItems||a.firstItems.length<1||((i=this.finishAward.get(a.id))||(i=new game.ZSShiLianAwardInfo,this.finishAward.set(a.id,i)),i.setData(a),-1==this.collected.indexOf(i.id)?this.fightId>i.id&&i.setCanGet(!0):i.setGet())}},getAwardList:function(){var e=this.finishAward.values();return e.sort(this.listSort),e},isGet:function(e){for(var t=0,a=this.collected.length;t<a;t++)if(this.collected[t].id==e.id)return!0;return!1},setCheck:function(e){this.autoFight=e},updataIsGet:function(){for(var e=this.getAwardList(),t=void 0,a=0,i=e.length;a<i;a++)t=e[a],-1==this.collected.indexOf(t.id)?this.fightId>t.id&&t.setCanGet(!0):t.setGet()},setGetAward:function(){this.finishAward.get(this.firstAward.id).setGet()},listSort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.sortId-t.sortId},isAwardCanGet:function(){for(var e=this.getAwardList(),t=0,a=e.length;t<a;t++)if(e[t].isCanGet)return!0;return!1}});game.zsshiLianData=game.zsshiLianData||new e}(),function(){var e=game.Control.extends({isAssist:!1,init:function(){this.awardAlert=game.spotAlert.set(game.SAE.REBITRH_AWARD),this._alertOptions={lang:611,btn:game.Lang.get(9059),okcb:this.onClickGameAlert,thisArg:this},this._conData=game.zsshiLianData},ipc:function(){this.evts={Instance:{SYNC_INSTANCE_DATA:this.syncShilian}},this.handels={RebirthInstanceChallengeResp:this.onRespRebirthInstanceChallenge,RebirthInstanceBuyResp:this.onRespRebirthInstanceBuy,RebirthInstanceCollectResp:this.onRespRebirthInstanceCollect}},syncShilian:function(e){var t=e.data;t&&t.rebirth&&(game.zsshiLianData.setup(t.rebirth),game.moduleOpen.checkOpen(game.ME.ZSShiLian)&&this.checkAllAlert())},notify:function(e,t){switch(e){case this.Evts.V2C_GET_AWARD:this.sender.RebirthInstanceCollectReq(t);break;case this.Evts.V2C_START_FIGHT:this.starFight()}},onRespRebirthInstanceChallenge:function(e){var t=e.readProtobuf(game.pb.RebirthInstanceChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{this._conData.fightId=t.id,this._conData.fightTime++,game.GameViewMgr.inst().hideUnStrongViews();var a={type:game.InstanceType.REBIRTH,rewards:t.useritem};game.playBack.play(t.battlelog,a),this._conData.setEnemy(t),this._conData.updataIsGet();var i=game.InstanceMiscCfg.getData("rebirthChallenges");this._conData.fightTime>=i.value&&(this._conData.autoFight=!1),1==t.type&&game.teamLeagueAssistData.updateAssistCount(),this.checkAllAlert(),this.send(this.Evts.C2V_UPDATA_PAGE)}},onRespRebirthInstanceBuy:function(e){var t=e.readProtobuf(game.pb.RebirthInstanceBuyResponse);0<t.code?game.notice.noticeError(t.code):(this._conData.buyTime++,this._conData.fightTime--,this.checkAllAlert(),this.send(this.Evts.C2V_UPDATA_FIGHT_TIME))},onRespRebirthInstanceCollect:function(e){var t=e.readProtobuf(game.pb.RebirthInstanceCollectResponse);0<t.code?game.notice.noticeError(t.code):(this._conData.collected.push(this._conData.firstAward.id),this._conData.setGetAward(),this.checkAllAlert(),this.send(this.Evts.C2V_UPDATA_TIP))},onClickGameAlert:function(){var e=game.mainRoleData.vipLevel;if(game.VipCfg.getData(e).rebirthIns-this._conData.buyTime<1)game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.VIP);else{var t=game.InstanceMiscCfg.getData("rebirthBuyCost").value.split("|"),a=t.length-1,i=t[this._conData.buyTime>a?a:this._conData.buyTime];game.amount.get(game.AmountType.YUAN_BAO)<i?game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE):this.sender.RebirthInstanceBuyReq()}},checkAllAlert:function(){this.checkAward(),this.checkFight()},checkFight:function(){},checkAward:function(){var e=this._conData.isAwardCanGet();this.awardAlert.alert=e},starFight:function(){this.isAssist=!1,this.rebirthInstanceChallengeReq()},assistBtn:function(){game.teamLeagueAssistData.canChallenge()&&(this.isAssist=!0,this.rebirthInstanceChallengeReq())},rebirthInstanceChallengeReq:function(){this._conData&&this._conData.enemy&&(0!=this._conData.enemy.hp?this.sender.RebirthInstanceChallengeReq(this.isAssist?1:0):game.notice.show(6713))},buy:function(){if(0!=this._conData.fightTime){var e=game.mainRoleData.vipLevel,t=game.VipCfg.getMaxLv(),a=game.VipCfg.getData(e),i=game.VipCfg.getData(Math.min(t,e+1)),n=a.rebirthIns-this._conData.buyTime,s=game.InstanceMiscCfg.getData("rebirthBuyCost").value.split("|"),r=s.length-1,o=this._conData.buyTime>r?r:this._conData.buyTime,g=s[o];t<=e?(this._alertOptions.lang=6712,this._alertOptions.langArgs=[g,n]):(this._alertOptions.lang=6711,this._alertOptions.langArgs=[g,n,e+1,i.arena-a.arena]),game.alert.show(this._alertOptions)}else game.notice.show(715)},checkBtn:function(){this._conData.setCheck(!this._conData.autoFight),this.send(this.Evts.C2V_CHECK_AUTOBUY)},prizeBtn:function(){game.module.show(game.ME.ZSShiLianTip)},challengeBtn:function(){this.starFight()},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.ZHUANSHEN_SHOP)}}),t=[game.ME.ZSShiLianTip],a=game.Sender.extends({ipc:function(){this.msg={RebirthInstanceChallengeReq:this.rebirthInstanceChallengeReq,RebirthInstanceBuyReq:null,RebirthInstanceCollectReq:this.reqRebirthInstanceCollect}},reqRebirthInstanceCollect:function(e){var t=game.pb.RebirthInstanceCollectRequest;t.id=e,this.write(t)},rebirthInstanceChallengeReq:function(e){var t=game.pb.RebirthInstanceChallengeRequest;t.type=e,this.write(t)}});b8e.module.registerControl(game.ME.ZSShiLian,e,game.ZSShiLianEvts,a,t)}(),function(){var e;e=game.ListItem.extends({_infoList:null,ctor:function(){this._super(1159),this.setSize(540,127)},init:function(){this._icon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.SIZE_84),this._icon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin;this.data=e,t.lbl_title.string=game.Lang.get(6709,e.id),t.getBtn.active=e.isCanGet&&!e.isGet,t.gray_btn.active=!e.isCanGet&&!e.isGet,t.finish.active=e.isGet;var a=e.award,i=game.ItemInfoCfg.getData(a.Id);this._icon.setItemInfo(i,!1,!1),this._icon.setNum(a.Num)},getBtn:function(){game.zsshiLianData.firstAward=this.data,this.send(game.ZSShiLianEvts.V2C_GET_AWARD,this.data.id)}}),b8e.RC("$$game","$$ZSShiLianIItemModel",e)}(),function(){var e=game.View.extends({maxCount:0,maxWidth:513,ctor:function(){this._super(1161)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.ZSShiLianIItemModel,this.list.bindEnum=game.ME.ZSShiLian,this.list.layout.spacingY=6,this.list.addToParent(this.skin.scrollView)},notify:function(e){switch(e){case this.Evts.C2V_UPDATA_TIP:this.updataList()}},onShow:function(){this.updataList()},updataList:function(){var e=game.zsshiLianData.getAwardList();this.list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.ZSShiLianTip,e)}(),function(){var e=game.CultivateBaseModelView.extends({_modelList:null,_barwidthList:null,barWidth:514,proWidth:560,ctor:function(){this._super(1160),this.spotAlerts={REBITRH_AWARD:this.changeAlert}},init:function(){var e=this;e.fightList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.fightList.itemRender=game.CsGuildBossAwardListItem,e.fightList.bindEnum=e.moduleEnum,e.fightList.addToParent(e.skin.prizeNode1),e.fightList.layout.paddingLeft=0,e.fightList.layout.spacingX=3,e.passList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.passList.itemRender=game.CsGuildBossAwardListItem,e.passList.bindEnum=e.moduleEnum,e.passList.addToParent(e.skin.prizeNode2),e.passList.layout.paddingLeft=0,e.passList.layout.spacingX=3,e._monModel=b8e.SceneEntity.get(),e._monModel.addToParent(e.skin.model),e._pageData=game.zsshiLianData,e.insAutoTime=game.CfgUtil.getInsAutoTimeSpace(),e.insAutoTimeDesc=game.CfgUtil.getInsAutoTime(),e.skin.bg.loadTexture(game.ResCfg.getUrl(5052))},onShow:function(){this.updataFight(),this.updataBoss(),this.updateAuto(),this.updataFightTime()},onHide:function(){var e=this._monModel.getAnimator(game.AnimType.BODY,1);e&&e.clear(),this.autoFightTimer&&this.autoFightTimer.stop(),this.skin.autoTips.string=game.Lang.get(5306)},onStageResize:function(){this.setPosition(0,-0)},notify:function(e){switch(e){case this.Evts.C2V_CHECK_AUTOBUY:this.updateAuto();break;case this.Evts.C2V_UPDATA_PAGE:this.updataFight(),this.updataBoss(),this.updateAuto();break;case this.Evts.C2V_UPDATA_FIGHT_TIME:this.updataFightTime()}},changeAlert:function(e){this.skin.redPoint.active=e.alert},updateAuto:function(){var e=this,t=e._pageData.autoFight;e.skin.check.node.active=t;game.InstanceMiscCfg.getData("instanceAutoTime").value;t?(e.autoFightEndTime=game.SysTime.curTime+e.insAutoTime,e.autoFightTimer||(e.autoFightTimer=b8e.Timer.add(e,e.updateTime,500)),e.autoFightTimer.reset(),e.autoFightTimer.start(),e.skin.autoTips.string=game.Lang.get(5305,e.insAutoTimeDesc)):(e.autoFightTimer&&e.autoFightTimer.stop(),e.skin.autoTips.string=game.Lang.get(5306))},updateTime:function(){var e=this,t=e.autoFightEndTime-game.SysTime.curTime;0<t?e.skin.autoTips.string=game.Lang.get(5305,t/1e3>>0):(e.autoFightTimer.stop(),e.skin.autoTips.string=game.Lang.get(5307),e.send(e.Evts.V2C_START_FIGHT))},updataFightTime:function(){var e=game.InstanceMiscCfg.getData("rebirthChallenges"),t=e.value-this._pageData.fightTime;this.skin.lbl_fightTime.string=game.Lang.get(6705,t,e.value)},updataFight:function(){var e=this.skin,t=game.RebirthCfg.getData(this._pageData.fightId,this._pageData.fightLv);if(t.showItems){var a=this._createPrizeItems(t.showItems);this.fightList.setData(a)}if(t.items){var i=this._createPrizeItems(t.items);this.passList.setData(i)}var n=this._pageData.enemy;n&&n.hp&&n.maxhp&&(e.lab_progress.string=(Math.round(n.hp/n.maxhp*1e4)/100).toFixed(2)+"%",e.img_progress.node.width=this.proWidth*(n.hp/n.maxhp))},updataBoss:function(){var a=this,e=a.skin,t=game.RebirthCfg.getData(a._pageData.fightId,a._pageData.fightLv),i=game.InstanceMiscCfg.getData("ZSShilianMaxLayer");e.lbl_check.string=game.Lang.get(1621,a._pageData.fightId,i.value),e.lbl_boss.string=t.name,game.CfgUtil.getMonsterCfgByMonGroup(t.monGroup,1,function(e){var t=game.AvatarUtil.getUIModel(e);a.setAnim(game.ResCfg.getUrl(5e3,t)),a.setElementBtn(e)},a)},setAnim:function(e){var t;e?((t=(t=this._monModel.getAnimator(game.AnimType.BOSS,1))||this._monModel.addAnimator(game.AnimType.BOSS,1)).load(e),t.play()):t&&t.clear()},_createPrizeItems:function(e){for(var t,a,i=[],n=0,s=e.length;n<s;n++)a=e[n],(t=game.ItemInfo.get()).id=a.Id,t.num=a.Num,i.push(t);return i},setElementBtn:function(e){var t=this.skin;e&&e.element?(this.elementAttr=e.element,t.view_elementBtn.active=!0,t.view_elementBtn.loadTexture(game.ResCfg.getUrl(10050,e.element))):t.view_elementBtn.active=!1},view_elementBtn:function(){this.elementAttr&&(game.elementData.setElementInfo(this.elementAttr,50369,this.skin.view_elementBtn.localToGlobal(),!1),game.module.show(game.ME.ElementAttr))}});b8e.module.registerView(game.ME.ZSShiLian,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1084)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.PrizeListItem,this._list.bindEnum=game.ME.VerifyAward,this._list.addToParent(this.skin.node_scrollview)},onShow:function(){var e=game.verifyAwardData.getQQVipDailyAward();this._list.setData(e);var t=40,a=e?e.length:0;0<a&&(t=560-94*a>>1),this._list.x=t<40?40:t},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)},viewqqVipDailyBtn:function(){this.send(game.VerifyAwardEvts.V2C_GET_VIP_PRIZE,game.verifyAwardData.getQQVipDailyAwardId()),game.module.hide(game.ME.QQVipDailyGift)}});b8e.module.registerView(game.ME.QQVipDailyGift,e)}(),function(){var e;e=b8e.Object.extends({day:0,title:"",isGet:!1,isEnough:!1,select:!1,setData:function(e){this.cfg=e,this.day=e.day,this.title=e.title,this.giveItems=e.giveItems,this.rechargeTimes=e.rechargeTimes,this.rechargeMoney=e.rechargeMoney,this.prizeListInfo=null},getPrizeListInfo:function(){return this.prizeListInfo||(this.prizeListInfo=game.CfgUtil.getPrizeListInfo(this.giveItems)),this.prizeListInfo}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ManyFirstTitleInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(663),this.setSize(166,82)},setData:function(){var e=this.data,t=this.skin,a=game.Lang.get(6715,e.title);t.title_label1.string=a,t.title_label2.string=a,t.select.active=e.select,t.redPoint_1.active=!e.isGet&&e.isEnough},onClick:function(){this.send(game.ManyFirstChargeEvts.V2C_SELECT_TITLE,this.data.day)}}),b8e.RC("$$game","$$ManyFirstTitleItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1095)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_BTN:this.updateBtn()}},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=0;var t=game.verifyAwardData.getXinyueCfg();if(t){var a=game.CfgUtil.getPrizeListInfo(t.Award);e.setData(a.items)}},onShow:function(){this.updateBtn()},updateBtn:function(){var e=this.skin,t=game.verifyAwardData.collectedWanbaXinyuePrize;e.view_getBtn.active=!t,e.isGetImg.active=t},view_getBtn:function(){var e=game.verifyAwardData.getXinyueAwardId();e&&this.send(this.Evts.V2C_GET_VIP_PRIZE,e)},view_gotoBtn:function(){this.send(this.Evts.V2C_XINYUE_GOTO_URL)},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.XinyueAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1083)},view_gotoBtn:function(){this.send(this.Evts.V2C_GOTO_EXPLORE)},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.MoreExciting,e)}(),function(){var e;e=b8e.GameConfig.extends({ctor:function(){this._super()},getEndTime:function(e){var t=this.getData(e);return t&&t.endTime?b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd  hh:mm:ss").getTime():0},getCurGroup:function(){var e=game.miscData.openServerDay,t=game.SysTime.curTime;this.groupList||(this.groupList=this.getDatas());for(var a=0;a<this.groupList.length;a++){var i=this.groupList[a];if(!(e<i.serverStart||e>=i.serverEnd)){if(0!=i.startTime&&0!=i.endTime){var n=b8e.TimeUtil.dateParse(i.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),s=b8e.TimeUtil.dateParse(i.endTime,"yyyy-MM-dd  hh:mm:ss").getTime();if(t<n||s<=t)continue}return i.id}}return 0}}),b8e.RC("$$game","$$MonopolyOpenCfg",e)}(),function(){var e;e=b8e.Enum({None:0,V_UPDATE_VIEW:-1,V_UPDATE_NUM:-1,V_START_THROW:-1,C2C_REFRESH_BTNS:-1,C_SHOW_AWARD:-1}),b8e.RC("$$game","$$MonopolyEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.MONOPOLY,game.SAE.HOME)},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.initOpenServer},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={MonopolyResp:this.monopolyResp,MonopolyMsg:this.monopolyMsg}},notify:function(e){switch(e){case this.Evts.C_SHOW_AWARD:this.showAward()}},resetDaily:function(){game.monopolyData.resetDaily(),this.checkAlert(),this.send(this.Evts.V_UPDATE_VIEW),this.dpt(this.Evts.C2C_REFRESH_BTNS)},initOpenServer:function(e){var t=e.data;game.monopolyData.setupData(t.monopolyId,t.monopolyNum,t.monopolyPos,t.monopolyTotal),this.checkAlert(),this.dpt(this.Evts.C2C_REFRESH_BTNS)},checkAlert:function(){this.spotAlert.alert=game.monopolyData.checkAlert()},monopolyResp:function(e){var t=e.readProtobuf(game.pb.MonopolyResponse);if(0<t.code){game.notice.noticeError(t.code)}else{var a=game.monopolyData.pos,i=game.monopolyData.pos+t.point;game.monopolyData.pos=20<i?i-20:i,game.monopolyData.openPoint=t.point,game.monopolyData.num-=1,game.monopolyData.totalNum+=1,this.checkAlert(),this.send(this.Evts.V_START_THROW,a),this.send(this.Evts.V_UPDATE_NUM)}},monopolyMsg:function(e){var t=e.readProtobuf(game.pb.MonopolyNumNotify);0<t.code?game.notice.noticeError(t.code):(game.monopolyData.num=t.num,this.checkAlert(),this.send(this.Evts.V_UPDATE_NUM))},throwBtn:function(){var e=game.monopolyData.curGroup;e&&this.sender.MonopolyReq(e)},showAward:function(){var e=game.monopolyData.awardList;if(e&&e.length){var t={},a=e[game.monopolyData.pos-1];t.id=a.itemId,t.num=a.itemNum,game.getRewardResultData.setData([t],5),game.module.show(game.ME.GetRewardResult)}}}),t=game.Sender.extends({ipc:function(){this.msg={MonopolyReq:this.monopolyReq}},monopolyReq:function(e){var t=game.pb.MonopolyRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.Monopoly,e,game.MonopolyEvts,t)}(),function(){var e=b8e.Object.extends({curGroup:0,endTime:0,pos:0,num:0,totalNum:0,awardList:null,curCfg:null,openPoint:0,ctor:function(){this._super(),this.awardList=[]},setupData:function(e,t,a,i){var n=this;n.num=t,n.pos=a,n.totalNum=i,n.curGroup=game.MonopolyOpenCfg.getCurGroup(),n.curGroup&&(n.curCfg=game.MonopolyOpenCfg.getData(n.curGroup),n.endTime=game.MonopolyOpenCfg.getEndTime(n.curGroup),n.initList())},initList:function(){if(this.curCfg){this.awardList.length=0;for(var e=game.MonopolyAwardCfg.getDatas(),t=0,a=e.length;t<a;t++)e[t].store==this.curCfg.store&&this.awardList.push(e[t]);this.awardList.sort(this.listSort)}},listSort:function(e,t){return e.pos-t.pos},resetDaily:function(){var e=this,t=game.MonopolyOpenCfg.getCurGroup();t!=e.curGroup&&(e.curGroup=t,e.pos=0,e.num=0,e.totalNum=0,e.curGroup&&(e.curCfg=game.MonopolyOpenCfg.getData(e.curGroup),e.endTime=game.MonopolyOpenCfg.getEndTime(e.curGroup),e.initList()))},getIsOpen:function(){return!!game.moduleOpen.checkOpen(game.ME.Monopoly)&&!!this.curGroup},checkAlert:function(){return!!game.moduleOpen.checkOpen(game.ME.Monopoly)&&(!!this.curGroup&&0<this.num)},isMax:function(){if(!this.curCfg)return!1;var e=this.curCfg.activityType;return!(3!=e&&2!=e||this.num)||1==e&&this.totalNum>=this.curCfg.numLimit}});game.monopolyData=game.monopolyData||new e}(),function(){var e=game.View.extends({timeId:0,maxPos:20,isPlay:!1,_showModel:!0,ctor:function(){this._super(736),this.spotAlerts={MONOPOLY:this.monopolyAlert}},init:function(){var e,t,a,i,n=this;for(n._super(),n.shaiziEffect=b8e.Animator.get(game.AnimType.UI_EFFECT,1),n.shaiziEffect.addToParent(n.skin.shaiziEffectNode),n.shaiziEffect.load(game.ResCfg.getUrl(5019,1065)),n.shaiziEffect.addFinishCallback(n.animaCB,n),n.shaiziEffect.active=!1,n.shaiziImgs=[],n.awardList=[],e=0;e<20;e++)e<6&&((t=b8e.Sprite.get()).setAnchor(.5,.5),i=game.ResCfg.getUrl(163,e+1),t.loadTexture(i),n.shaiziImgs.push(t)),(a=b8e.Sprite.get()).setAnchor(.5,.5),a.setScale(.6,.6),a.addToParent(n.getComponent("award"+(e+1))),b8e.evt.onC(a,n.onClickAward,n),n.awardList.push(a);n.skin.shaiziNode.addChild(n.shaiziImgs[0]),n.headIcon=b8e.Sprite.get(),n.headIcon.setAnchor(.5,.5),n.headIcon.setScale(.55,.55),n.headIcon.loadTexture(game.ResCfg.getHead(game.mainRoleData.isMale)),n.skin.avatarNode.addChild(n.headIcon),n.timer=b8e.Timer.add(n,n.updateTime,500)},onClickAward:function(e){for(var t=0,a=this.awardList.length;t<a;t++)if(e.currentTarget&&e.currentTarget._b8eDisplay==this.awardList[t]){var i=game.monopolyData.awardList[t];if(i){var n=game.ItemInfoCfg.getData(i.itemId);if(!n){return}game.tipsData.setInfo(n),game.module.show(game.ME.ItemTips)}return}},playEffect:function(){this.skin.shaiziNode.removeAllChildren(),this.shaiziEffect.active=!0,this.shaiziEffect.play(null,0),this.timeId=b8e.setTimeout(this.showShaizi,this,1500)},showShaizi:function(){var e=this.shaiziImgs[game.monopolyData.openPoint-1];this.skin.shaiziNode.addChild(e),this.tweenPos()},tweenPos:function(){var e=this;b8e.Tween.kill(e.skin.avatarBg);var t=game.monopolyData;if(e.curPos!=t.pos){var a=e.curPos+1;a>e.maxPos&&(a-=e.maxPos),e.curPos=a;var i=e.getComponent("award"+e.curPos);i&&b8e.Tween.get(e.skin.avatarBg).wait(100).to({x:i.x,y:i.y},150).call(e.tweenPos,e)}else e.send(e.Evts.C_SHOW_AWARD),e.updateNum()},animaCB:function(){this.shaiziEffect&&(this.shaiziEffect.active=!1),this.isPlay=!1},monopolyAlert:function(e){this.skin.red_spot_throw.node.active=e.alert},updateTime:function(){if(!this.endTime){return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime()}this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e,t){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateData(),this.updateNum();break;case this.Evts.V_UPDATE_NUM:this.updateNum();break;case this.Evts.V_START_THROW:this.starThrow(t)}},updateData:function(){var e,t,a,i=game.monopolyData,n=this.skin;if(i.pos){var s=this.getComponent("award"+i.pos);s&&(n.avatarBg.x=s.x,n.avatarBg.y=s.y)}else n.avatarBg.x=272,n.avatarBg.y=-613;for(var r=0,o=i.awardList.length;r<o;r++)(e=i.awardList[r])&&this.awardList.length>r&&(a=game.ItemInfoCfg.getData(e.itemId),t=game.ResCfg.getUrl(137,a.icon),this.awardList[r].loadTexture(t));if(i.curCfg){var g=i.curCfg.activityType,u=1==g?6908:2==g?6909:6910;n.costLab.string=game.Lang.get(u,i.curCfg.condition)}this.endTime=i.endTime,this.timer.reset(),this.timer.start(),this.updateTime()},updateNum:function(){var e=this,t=game.monopolyData,a=t.curCfg.activityType;e.isPlay||(t.isMax()?(2==a||3==a)&&t.totalNum<t.curCfg.numLimit?(e.skin.costLab.active=!0,e.skin.maxLab.active=!1,e.skin.throwBtn.active=!0,e.skin.countLab.active=!0,e.skin.countLab.string=game.Lang.get(6911,game.monopolyData.num)):(e.skin.throwBtn.active=!1,e.skin.costLab.active=!1,e.skin.maxLab.active=!0,e.skin.countLab.active=!1):(e.skin.throwBtn.active=!0,e.skin.costLab.active=!0,e.skin.maxLab.active=!1,game.monopolyData.curCfg&&1==game.monopolyData.curCfg.activityType?e.skin.countLab.active=!1:(e.skin.countLab.active=!0,e.skin.countLab.string=game.Lang.get(6911,game.monopolyData.num))))},starThrow:function(e){this.skin.throwBtn.active=!1,this.isPlay=!0;var t=this.getComponent("award"+e);t&&(this.skin.avatarBg.x=t.x,this.skin.avatarBg.y=t.y),this.curPos=e,this.playEffect()},onShow:function(){this.skin.throwBtn.active=!0,this.animaCB(),this.updateData(),this.updateNum()},onHide:function(){this.stopTime(),this.timeId&&b8e.clearTimeout(this.timeId),b8e.Tween.kill(this.skin.avatarNode)},stopTime:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.Monopoly,e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_ENTER_SCENE:-1}),b8e.RC("$$game","$$MapEvts",e)}(),function(){var e;e=b8e.Object.extends({_callback:null,_thisArg:null,ctor:function(e,t){this._callback=e,this._thisArg=t},syncInfo:function(e){this._callback.call(this._thisArg,e)}}),b8e.RC("$$game","$$MapSync",e)}(),function(){var e=game.Control.extends({ipc:function(){this.gevts={SceneGEvts:{ENTER_SCENE:this._onEnterScene}}},_onEnterScene:function(){this.send(this.Evts.C2V_ENTER_SCENE)}});b8e.module.registerControl(game.ME.Map,e,game.MapEvts)}(),function(){var e=game.View.extends({ctor:function(){this._super(664)},init:function(){var e=this,t=e.skin;e._sceneLayer=b8e.BaseDisplay.get(),e._sceneLayer.addToParent(t.currentMap),e._scene=b8e.SceneMgr.inst().createScene("panorama",e._sceneLayer),e._scene.setSize(t.currentMap.width,t.currentMap.height);var a=e._scene.getViewDisplay();a&&a.setMask(0),t.player.node.setPosition(0,0),e._mainChar=b8e.SceneDisplay.get(),e._mainChar.addChild(t.player.node),e._mainChar.clearDisabled=!0,e._scene.addDisplay(e._mainChar),e._scene.getCamera().setFocusTarget(e._mainChar)},onShow:function(){b8e.scene.addEventListener(b8e.SceneEvent.SCENE_MAP_LOAD_COMPLETE,this.onSceneMapLoadComplete,this),this.updateMiniMap(),this.updateSyncInfo()},onHide:function(){this._scene&&this._scene.stopRender(),b8e.scene.removeEventListener(b8e.SceneEvent.SCENE_MAP_LOAD_COMPLETE,this.onSceneMapLoadComplete,this)},notify:function(e){switch(e){case this.Evts.C2V_ENTER_SCENE:this.updateSyncInfo()}},updateSyncInfo:function(){var e=game.mainRoleData.mapId;if(this._lastSceneId!=e){this._lastSceneId=e;var t=new game.MapSync(this.updateMiniPos,this),a=new b8e.DisplaySyncInfo(t);game.mainRole.addSyncInfo(a)}},onSceneMapLoadComplete:function(){this.updateMiniMap()},updateMiniMap:function(){var e=this;if(e._scene){var t=b8e.scene.getPanoramaRatio(),a=b8e.scene.getSceneSize(),i=b8e.scene.getMapUrl();e._config||(e._config={}),e._config.mapWidth=a.width/t,e._config.mapHeight=a.height/t,e._config.thumbFileName="panorama.jpg",e._scene.setMapConfig(i,e._config),e._scene.startRender();var n=game.sceneData.getConfig(),s=n.name;n&&n.layerName&&(s=n.name+n.layerName),e.skin.title.string=s,e.updateMiniPos(),e.setMiniMapPosition()}},setMiniMapPosition:function(){var e=this.skin,t=0,a=0,i=b8e.scene.getPanoramaRatio(),n=b8e.scene.getSceneSize(),s=n.width/i,r=n.height/i;s<e.currentMap.width&&(t=~~((e.currentMap.width-s)/2)),r<e.currentMap.height&&(a=~~((e.currentMap.height-r)/2)),this._sceneLayer.setPosition(t,-a)},updateMiniPos:function(){var e=b8e.scene.getPanoramaRatio(),t=game.mainRole;this._mainChar.setPosition(t.x/e,t.y/e),this._mainChar.rotation=t.getDirection()?270-b8e.CommonUtil.getAngleByDirection(t.getDirection()):0},onStageResize:function(){var e=b8e.stageWidth-this.width>>1,t=b8e.stageHeight+this.height>>1;this.setPosition(e,t)}});b8e.module.registerView(game.ME.Map,e)}(),function(){var e;e=b8e.Enum({None:0,V_FOLLOW_CHAT:-1,C2V_UPATE_KEY:-1,C2V_UPDATE_END_TIME:-1}),b8e.RC("$$game","$$CSTreasureEvts",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.isOpening=!1,this._coolEndTime=0,this.keys=0,this.nextChallengeTm=0},mainLeaveScene:function(){game.csWarTeamData.clearTeamData(),this.setCoolTime()},setCoolTime:function(){var e=game.SysTime.curTime,t=this.getCoolTime();this._coolEndTime=e+t*b8e.TimeUtil.SECOND_MICRO_SECONDS},getCoolTime:function(){if(this._coolTime)return this._coolTime;var e=game.ThroneMiscCfg.getData("throneCoolTime");return e&&""!=e.value?(this._coolTime=+e.value,this._coolTime):void 0},isOpen:function(e){var t=!(0<arguments.length&&void 0!==e)||e;if(!game.moduleOpen.checkOpenWithTips(game.ME.CSTreasure,t))return!1;if(!this.isOpening)return t&&game.notice.show(6913),!1;var a=game.SysTime.curTime;if(0<this._coolEndTime&&this._coolEndTime>a){var i=(this._coolEndTime-a)/1e3>>0;return t&&0<i&&game.notice.show(3821,i),!1}return!0},isTreasureScene:function(){return game.sceneData.getSceneType()==game.SceneType.TREASURE},getEndTime:function(){if(0<this._endTime)return this._endTime;var e=this.getOpenTimeArr();if(!e||e.length<1)return 0;var t=e[e.length-1].split(":");if(!t||t.length<1)return 0;var a=game.SysTime.curTime,i=b8e.TimeUtil.getTodayTime(a);return this._endTime=i+b8e.TimeUtil.HOUR_MICRO_SECONDS*t[0]+b8e.TimeUtil.MINUTE_MICRO_SECONDS*t[1],this._endTime},getOpenTimeArr:function(){if(!this._openTimeArr||this._openTimeArr.length<1){var e=game.CsMiscCfg.getData("treasureTime");if(!e||""==e.value)return!1;this._openTimeArr=e.value.split("-")}return this._openTimeArr},getRemainChallengeTm:function(){var e=game.SysTime.curTime;return(this.nextChallengeTm-e)/b8e.TimeUtil.SECOND_MICRO_SECONDS>>0},updateKeys:function(e){var t=e.keys-this.keys;0<t&&game.notice.show(6925,t),this.keys=e.keys;var a=game.mainRole;a&&a.data&&(a.data.keys=this.keys),b8e.evt.dptG(game.SceneGEvts.UPDATE_TREASURE_KEYS)},getKillMonsterCD:function(){if(this._killMonsterCD)return this._killMonsterCD;if(!this._killMonsterCD){var e=game.CsMiscCfg.getData("treasurekillMonsterCD");if(!e||""==e.value)return;this._killMonsterCD=+e.value}return this._killMonsterCD}});game.csTreasureData=game.csTreasureData||new e}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:6901,okcb:this.onClickGameAlert,thisArg:this},this._exitOptions={lang:6905,okcb:this.onClickReturn,thisArg:this},this._chat={chatType:game.ChatChannelType.CROSS,marqueeKey:"treasure_open",funcType:game.ChatFuncType.CHAT_FUNC_TREASURE},this.spotAlert=game.spotAlert.set(game.SAE.CS_TREASURE_ALERT,game.SAE.CS_ACTIVITY_ALERT)},ipc:function(){var e=this;e.evts={MainUIChat:{C2C_REQ_ENTER_TREASURE:e.enterTreasureScene},CsActivity:{C2C_TREASURE_GOTO:e.enterTreasureScene}},e.gevts={SceneGEvts:{ENTER_SCENE:e.onEnterScene,SCENE_COLLECT_FINISH:e.onSceneCollectFinish,SCENE_COLLECT_FINISH_NOTIFY:e.onSceneCollectFinishNotify,UPDATE_TREASURE_KEYS:e.onUpdateKeys,SCENE_ADD_DISPLAY:e.onSceneAddDisplay,MAIN_MOVE_COMPLETE:e.onMoveComplete}},e.handels={TreasureJoinResp:e.onTreasureJoinResp,TreasureMsg:e.onTreasureMsg}},onMoveComplete:function(e){if(e&&e.data&&game.csTreasureData.isTreasureScene()){var t=game.SceneMoveType;switch(e.data){case t.CLICK_MONSTER:game.challengeIcon.show(game.scenePick.target);break;case t.CLICK_BOX:this.reqCollect();break;case t.CLICK_NPC:game.alert.show(this._alertOptions)}}},reqCollect:function(){game.challengeIcon.show(game.scenePick.target,3,!1,this,this._callCChallengeFun)},_callCChallengeFun:function(){if(game.csTreasureData.keys<1)return game.notice.show(6906),void game.challengeIcon.hide();var e=game.csWarTeamData.getMineTeam();if(!e||e.length<1)return b8e.evt.dptG(game.SceneGEvts.CLICK_BOX),void game.challengeIcon.hide();for(var t=0,a=e.length,i=void 0;t<a&&!((i=e[t])&&i.id!=game.mainRole.id&&i.keys<1);t++);i.keys<1?game.notice.show(6907,i.name):b8e.evt.dptG(game.SceneGEvts.CLICK_BOX),game.challengeIcon.hide()},onClickGameAlert:function(){var e=game.scenePick.target;e&&e.data&&this.dptG(game.SceneGEvts.SCENE_REQ_NPC,{npcId:e.data.roleId,unitId:e.data.id})},onSceneAddDisplay:function(){if(game.csTreasureData.isTreasureScene()){var e=game.mainRole;e&&e.data&&(game.csTreasureData.keys=e.data.keys,this.onUpdateKeys())}},onUpdateKeys:function(){this.send(this.Evts.C2V_UPATE_KEY)},onEnterScene:function(){if(game.csTreasureData.isOpen(!1)&&(this.spotAlert.alert=game.csTreasureData.isOpening,game.csTreasureData.isTreasureScene())){var e=game.sceneData.getLastConfig();if(!e||e.type==game.SceneType.TREASURE){game.mainRoleData.mapId,game.sceneData.lastSceneId;var t,a=game.sceneData.getConfig();t=game.Lang.get(6917,a.name,a.layerName),game.notice.showNotice(game.notice.WINDOW_BIG_CENTER,t)}}},onTreasureJoinResp:function(e){var t=e.readProtobuf(game.pb.TreasureJoinResponse);0<t.code?game.notice.noticeError(t.code):(b8e.module.isShowView(game.ME.CSTEnter)&&game.module.hide(game.ME.CSTEnter),b8e.module.isShowView(game.ME.ActivitiesHall)&&game.module.hide(game.ME.ActivitiesHall))},onTreasureMsg:function(){game.csTreasureData.isOpening=!0,this.spotAlert.alert=!0,game.module.show(game.ME.CSTEnter);this.sendChat(null,"treasure_open"),this._startCalculateEndTime()},_startCalculateEndTime:function(){this._timeObj||(this._timeObj=b8e.Timer.add(this,this._updateTime,1e3)),this._timeObj.reset(),this._timeObj.start()},_updateTime:function(){var e=game.csTreasureData.getEndTime();if(e<1)this.clearTime();else{var t=game.SysTime.curTime;if(e<t)this.clearTime();else{var a=e-t;this.send(this.Evts.C2V_UPDATE_END_TIME,a)}}},clearTime:function(){this._timeObj&&(b8e.Timer.remove(this,this._updateTime),this._timeObj=null,game.throneData.isOpening=!1,this.spotAlert.alert=!1)},sendChat:function(e,t){this._chat.chatType=game.ChatChannelType.CROSS,this._chat.funcType=game.ChatFuncType.CHAT_FUNC_TREASURE,this._chat.params=e,this._chat.clientParams=null,this._chat.marqueeKey=t,game.chatData.addChat(this._chat),this.dptG(game.ChatEvts.SHOW_CLIENT_CHAT,null)},onSceneCollectFinish:function(){game.csTreasureData.isTreasureScene()&&(this._onUpdateSelfKeys(),game.csWarTeamData.isInTeam&&b8e.evt.dptG(game.CsWarTeamEvts.C2C_REQ_TEAM_DATA))},onSceneCollectFinishNotify:function(){game.csTreasureData.isTreasureScene()&&this._onUpdateSelfKeys()},_onUpdateSelfKeys:function(){game.csTreasureData.keys--;var e=game.csTreasureData.keys;e<0&&(e=0);var t=game.mainRole;t&&t.data&&(t.data.keys=e),this.send(this.Evts.C2V_UPATE_KEY)},btn_enter:function(){this.enterTreasureScene()},enterTreasureScene:function(){game.csTreasureData.isOpen()&&this.sender.TreasureJoinReq()},btn_back:function(){game.alert.show(this._exitOptions)},onClickReturn:function(){this.leaveScene()},leaveScene:function(){b8e.evt.dptG(game.SceneGEvts.SCENE_EXIT)},bt_help:function(){game.RuleView.inst().showView(game.ME.CSTreasure)},bt_team:function(){var e=game.csWarTeamData.isInTeam;game.module.show(e?game.ME.CsWarBattleTeam:game.ME.CsWarTeam)},mapBtn:function(){b8e.module.isShowView(game.ME.Map)||game.module.show(game.ME.Map)}}),t=game.Sender.extends({ipc:function(){this.msg={TreasureJoinReq:null}}}),a=[game.ME.CSTMain,game.ME.CSTTime,game.ME.CSTExit,game.ME.CSTEnter];b8e.module.registerControl(game.ME.CSTreasure,e,game.CSTreasureEvts,t,a)}(),function(){var e=game.View.extends({_showModel:!1,ctor:function(){this._super(262)},closeBtn:function(){this._super()},onStageResize:function(){var e=b8e.stageWidth;this.setPosition(e-17,320)}});b8e.module.registerView(game.ME.CSTEnter,e)}(),function(){var e=game.View.extends({_isMoveUp:!1,_specialLayer:!0,ctor:function(){this._super(263),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},onStageResize:function(){var e=b8e.stageWidth-this.width-10;this.setPosition(e,this.height+110)}});b8e.module.registerView(game.ME.CSTExit,e)}(),function(){var e=game.View.extends({_showModel:!1,_specialLayer:!0,ctor:function(){this._super(264),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},notify:function(e){switch(e){case this.Evts.C2V_UPATE_KEY:this.updateKey()}},onShow:function(){this.updateKey()},updateKey:function(){this.skin.labNum.string=game.csTreasureData.keys},onStageResize:function(){this.setPosition(0,b8e.stageHeight-200)}});b8e.module.registerView(game.ME.CSTMain,e)}(),function(){var e=game.View.extends({_isMoveUp:!1,_specialLayer:!0,ctor:function(){this._super(265),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_END_TIME:this.skin.labTime.string=game.Lang.get(2353,b8e.TimeUtil.formatTime(t))}},onShow:function(){this.skin.labTime.string=game.Lang.get(2353,""),this.updateLayer()},updateLayer:function(){if(0!=game.sceneData.sceneId){var e=game.sceneData.getConfig();if(e){this.skin.labMapName.string=e.name,this.skin.labMapLayer.string=e.layerName}}},onStageResize:function(){var e=b8e.stageWidth;this.setPosition(e-5,b8e.stageHeight-50)}});b8e.module.registerView(game.ME.CSTTime,e)}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:6012,okcb:this.onClickGameAlert,thisArg:this}},btn_back:function(){game.alert.showTwo(this._alertOptions)},onClickGameAlert:function(){b8e.evt.dptG(game.SceneGEvts.SCENE_EXIT)}});b8e.module.registerControl(game.ME.CsGuildExit,e,game.CsBossTopRightEvts,null)}(),function(){var e=game.View.extends({_isMoveUp:!1,_specialLayer:!0,ctor:function(){this._super(247),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},onStageResize:function(){b8e.stageHeight;var e=b8e.stageWidth;this.setPosition(e,this.height+170)}});b8e.module.registerView(game.ME.CsGuildExit,e)}(),function(){var e=game.View.extends({_specialLayer:!0,ctor:function(){this._super(245),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},init:function(){},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView(t);break;case this.Evts.C2V_UPDATE_TIME:this.updateTime(t)}},updateView:function(e){this.updateTime(e)},updateTime:function(e){var t=this,a=t.skin;if(0!=e.hp&&(t._timeStar=!1),!t._timeStar){var i;e.state;if(0==e.hp){t._timeStar=!0;var n=game.GuildMiscCfg.getData("crossGuildMountRelive"),s=1<game.csGuildBossData.reliveTime?game.csGuildBossData.reliveTime:n.value;t.remEndTime=game.SysTime.curTime+1e3*s,i=b8e.TimeUtil.formatTime(1e3*s),a.exitTimeLab.string=game.Lang.get(6014,i),t._fightDay=0}else t.remEndTime=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime),i=b8e.TimeUtil.formatTime(t.remEndTime-game.SysTime.curTime),a.exitTimeLab.string=game.Lang.get(6015,i),t._fightDay=1;t.remTimer||(t.remTimer=b8e.Timer.add(t,t.updateFestivalTime,1e3)),t.remTimer.reset(),t.remTimer.start()}},onShow:function(){},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*e,t-200)},updateFestivalTime:function(){if(0<this.remEndTime-game.SysTime.curTime){var e=b8e.TimeUtil.formatTime(this.remEndTime-game.SysTime.curTime),t=0==this._fightDay?6014:6015;this.skin.exitTimeLab.string=game.Lang.get(t,e)}else this.send(this.Evts.V2C_RELIVETIME_OVER)}});b8e.module.registerView(game.ME.CsGuildTop,e)}(),function(){var e=game.View.extends({_specialLayer:!0,ctor:function(){this._super(504),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},notify:function(e){switch(e){case this.Evts.C2V_CAMP:this.setCamp();break;case this.Evts.C2V_UPDATA_BTN:this.updataBtn();break;case this.Evts.C2V_UPDATA_TEAM:this.hideTopTeam()}},hideTopTeam:function(){this.skin.teamBtn.active=!1},setCamp:function(){11==game.guanDuData.activeCamp?this.skin.icon1.active=!0:this.skin.icon2.active=!0},updataBtn:function(){var e=this.skin;game.guanDuData.canTeam?e.teamBtn.active=!1:game.guanDuData.isHasTeam?e.teamBtn.active=!0:e.teamBtn.active=!1},onStageResize:function(){b8e.stageWidth;var e=b8e.stageHeight;this.setPosition(0,e)}});b8e.module.registerView(game.ME.GuanDuRightTop,e)}(),function(){var e;e=b8e.Enum({None:0,V2V_SHOW_VIEW:-1,V2C_SELECT_BTN:-1,C2C_REFRESH_BTNS:-1}),b8e.RC("$$game","$$VipWelfareEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,QQ_VIP_LOGIN:1}),b8e.RC("$$game","$$VipWelfareType",e)}(),function(){var e;e=b8e.Object.extends({select:!1,alert:!1,id:0,sortId:0,isShow:!1,setData:function(e){this.id=e.id,this.sortId=e.sortId,this.bindAlert(e.spotAlert)},bindAlert:function(e){if(!this._bindAlert&&e&&""!=e){var t=b8e.getDPV(game.SAE,e);t&&(game.spotAlert.setCb(t,this.updateAlert,this),this._bindAlert=!0)}},updateAlert:function(e){this.alert=e.alert}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$VipWelfareBtnInfo",e)}(),function(){var e=b8e.Object.extends({selectId:0,ctor:function(){this._super(),this.welfareBtns=[],this.welfareBtnsMap=b8e.HashMap.get()},refreshBtns:function(e){var t=this;t.welfareBtns.length=0;var a=game.VipWelfareBtnCfg.getDatas();if(a&&!(a.length<1)){e||t.selectBtn(0);for(var i=void 0,n=void 0,s=void 0,r=a.length,o=0;o<r;o++)(i=a[o])&&((s=t.welfareBtnsMap.get(i.id))||(s=new game.VipWelfareBtnInfo,t.welfareBtnsMap.set(i.id,s)),s.setData(i),n=t.isShowActive(i),(s.isShow=n)?t.welfareBtns.push(s):t.selectId==i.id&&(t.selectId=0));t.welfareBtns.sort(t.onSort),!t.selectId&&0<t.welfareBtns.length&&(t.selectId=t.welfareBtns[0].id,t.welfareBtns[0].select=!0)}},onSort:function(e,t){return e.sortId-t.sortId},isShowActive:function(e){if(!e)return!1;if(!game.moduleOpen.checkOpen(e.moduleEnum))return!1;switch(e.id){case game.VipWelfareType.QQ_VIP_LOGIN:return game.qqVipLoginData.getIsOpen()}return!1},getIsOpen:function(){return 0<this.welfareBtns.length},selectBtn:function(e){if(this.selectId!=e){var t=this.welfareBtnsMap.get(this.selectId);t&&(t.select=!1);var a=this.welfareBtnsMap.get(e);a&&(a.select=!0),this.selectId=e}},getBtns:function(){return this.welfareBtns}});game.vipWelfareData=game.vipWelfareData||new e}(),function(){var e=game.Control.extends({isShowView:!1,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.VIP_WELFARE_ALERT,game.SAE.HOME)},ipc:function(){this.evts={QqVipLogin:{C2C_REFRESH_BTN:this.refreshBtns}}},triggerOpen:function(e){e==this.moduleEnum&&this.refreshBtns()},notify:function(e,t){switch(e){case this.Evts.V2V_SHOW_VIEW:this.isShowView=!0,this.showView(game.vipWelfareData.selectId);break;case this.Evts.V2C_SELECT_BTN:this.selectBtn(t)}},selectBtn:function(e){var t=game.vipWelfareData,a=t.selectId;if(a!=e){var i=game.VipWelfareBtnCfg.getData(a);i&&i.moduleEnum&&game.module.hide(i.moduleEnum),this.showView(e),t.selectBtn(e)}},showView:function(e){var t=game.VipWelfareBtnCfg.getData(e);t&&t.moduleEnum&&game.module.showTab(t.moduleEnum,this.moduleEnum)},refreshBtns:function(){var e=game.vipWelfareData;e.refreshBtns(this.isShowView);var t=e.getIsOpen();b8e.module.isShowView(this.moduleEnum)&&(t?this.send(this.Evts.C2V_UPDATE_LIST):game.module.hide(this.moduleEnum)),this.dpt(this.Evts.C2C_REFRESH_BTNS)}}),t=game.Sender.extends({ipc:function(){this.msg={}}});b8e.module.registerControl(game.ME.VipWelfare,e,game.VipWelfareEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1099),this.setSize(86,96)},init:function(){var e=this.btn=b8e.Sprite.get();e.addToParent(this.skin.btn),e.setAnchor(.5,.5)},setData:function(){var e=this.data;this.skin.btnSelect.active=e.select;var t,a=game.VipWelfareBtnCfg.getData(e.id);a&&(a.btnImg?(t=game.ResCfg.getImgUrl(a.btnImg),this.btn.loadTexture(t),this.skin.alert.active=e.alert):b8e.error("\u798f\u5229\u6309\u94ae\u914d\u7f6e\u6ca1\u6709\u5bf9\u5e94\u7684\u6807\u9898\u6309\u94ae\u5e95\u56fe,id:",a.id,"\u798f\u5229\u6309\u94ae:",a.desc))},clickBtn:function(){this.send(game.VipWelfareEvts.V2C_SELECT_BTN,this.data.id)}}),b8e.RC("$$game","$$VipWelfareBtnItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1100)},init:function(){var e=this.btns=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.VipWelfareBtnItem,e.addToParent(this.skin.scrollView),e.bindEnum=this.moduleEnum,e.layout.spacingX=15},notify:function(e,t){switch(e){case this.Evts.C2V_SELECT_ITEM:this.selectTitle(t);break;case this.Evts.C2V_UPDATE_LIST:this.updateBtns()}},onShow:function(){this.send(this.Evts.V2V_SHOW_VIEW),this.updateBtns(),this.selectTitle(game.vipWelfareData.selectId)},onHide:function(){},updateBtns:function(){this.btnInfos=game.vipWelfareData.getBtns(),this.btnInfos&&this.btns.setData(this.btnInfos)},selectTitle:function(e){var t=this.skin,a=game.VipWelfareBtnCfg.getData(e);if(a&&a.title&&""!=a.title){var i=game.ResCfg.getImgUrl(a.title);t.title.loadTexture(i)}},viewLeftBtn:function(){this.btns.scrollContainerLeft()},viewRightBtn:function(){this.btns.scrollContainerRight()},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.VipWelfare,e)}(),function(){var e;e=b8e.Enum({None:0,C2C_REFRESH_BTN:-1,V2C_GET_PRIZE:-1,C2V_UPDATE_LIST:-1}),b8e.RC("$$game","$$QqVipLoginEvts",e)}(),function(){var e=b8e.Object.extends({isInitList:!1,qqVipLoginDays:0,qqVipLoginAward:0,initData:function(e){this.qqVipLoginDays=e.qqVipLoginDays,this.qqVipLoginAward=e.qqVipLoginAward},checkAlert:function(){this.infoList||this.initInfoList();var e=this.infoList;if(!e||e.length<1)return!1;for(var t=!1,a=void 0,i=e.length,n=this.qqVipLoginAward?this.qqVipLoginDays:this.qqVipLoginDays+1,s=0;s<i;s++)(a=e[s]).canGet=n>=a.days,a.isGet=a.days<n||a.days==n&&this.qqVipLoginAward,a.needDay=a.days-n,a.canGet&&!a.isGet&&(t=!0);return e.sort(this.onSort),t},initInfoList:function(){if(!this.isInitList){this.isInitList=!0,this.infoList=[];var e=game.QQVipLoginCfg.getDatas();if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)t=e[n],(a=new game.QqVipLoginInfo).setData(t),this.infoList.push(a)}},resetDaily:function(){this.qqVipLoginAward&&this.qqVipLoginDays++},getIsOpen:function(){if(!game.IS_WANBA||"QQVip"!==game.JunHaiSdk.getChannel())return!1;this.infoList||this.initInfoList();var e=this.infoList;if(!e||e.length<1)return!1;for(var t=!1,a=void 0,i=e.length,n=0;n<i;n++)(a=e[n])&&!a.isGet&&(t=!0);return t},getInfoList:function(){return this.infoList},getPrizeSuccess:function(){this.qqVipLoginAward=!0,this.qqVipLoginDays++},onSort:function(e,t){return e.isGet===t.isGet?e.days-t.days:e.isGet?1:-1}});game.qqVipLoginData=game.qqVipLoginData||new e}(),function(){var e;e=b8e.Object.extends({days:0,award:null,desc:"",isGet:!1,canGet:!1,needDay:0,setData:function(e){this.cfg=e,this.days=e.days,this.award=e.days,this.desc=e.desc},getPrizeList:function(){if(this.prizeList)return this.prizeList;if(this.prizeList=[],this.cfg){var e=game.CfgUtil.getPrizeListInfo(this.cfg.award);return this.prizeList=e.items,this.prizeList}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$QqVipLoginInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.QQ_VIP_LOGIN_ALERT,game.SAE.VIP_WELFARE_ALERT),this.noticeAlert={lang:6962,okcb:this.okcb,thisArg:this,align:b8e.HorizontalAlign.CENTER}},okcb:function(){game.module.show(game.ME.VipWelfare)},ipc:function(){this.evts={Welfare:{C_INIT_MODEL:this.initWelfareModel},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={QQLoginResp:this.qqVipLoginResp}},qqVipLoginResp:function(e){var t=e.readProtobuf(game.pb.QQVipLoginResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.qqVipLoginData.getPrizeSuccess(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_LIST)}},notify:function(e){switch(e){case this.Evts.V2C_GET_PRIZE:this.sender.QQLoginReq()}},triggerOpen:function(e){if(e==this.moduleEnum){this.checkAlert();var t=game.qqVipLoginData;t.getIsOpen()&&!t.qqVipLoginAward&&game.alert.showTwo(this.noticeAlert),this.dpt(this.Evts.C2C_REFRESH_BTN)}},initWelfareModel:function(e){if(e&&e.data){game.qqVipLoginData.initData(e.data),game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkAlert()}},checkAlert:function(){var e=game.qqVipLoginData;this.spotAlert.alert=e.checkAlert(),e.getIsOpen()||this.dpt(this.Evts.C2C_REFRESH_BTN)},resetDaily:function(){game.qqVipLoginData.resetDaily(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_LIST)}}),t=game.Sender.extends({ipc:function(){this.msg={QQLoginReq:null}}});b8e.module.registerControl(game.ME.QqVipLogin,e,game.QqVipLoginEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(871),this.setSize(550,145)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.prizeList),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingY=-10},setData:function(){var e=this.skin,t=this.data;e.lab_title.string=t.desc,this.prizeInfoList=t.getPrizeList(),this.prizeList.setData(this.prizeInfoList),e.btn_get.active=t.canGet&&!t.isGet;var a=!t.canGet&&!t.isGet;(e.cantGetNode.active=a)&&(e.needDay.active=1<t.needDay,e.needDay.string=game.Lang.get(6963,t.needDay),e.nextDay.active=1==t.needDay);var i=game.ResCfg.getUrl(173,t.days);e.loginDay.loadTexture(i),e.isGetImg.active=t.isGet},btn_get:function(){this.send(game.QqVipLoginEvts.V2C_GET_PRIZE,this.data.days)}}),b8e.RC("$$game","$$QqVipLoginItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(872)},init:function(){var e=this.list=new game.List;e.itemRender=game.QqVipLoginItem,e.addToParent(this.skin.list),e.bindEnum=this.moduleEnum},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_LIST:this.updataList()}},onShow:function(){this.updataList()},onHide:function(){},updataList:function(){this.infoList=game.qqVipLoginData.getInfoList(),!this.infoList||this.infoList.length<1||this.list.setData(this.infoList)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.QqVipLogin,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(684)},init:function(){this.skin.tipsLab.string=game.Lang.get(6982)}});b8e.module.registerView(game.ME.ZhuChu,e)}(),function(){var e;e=b8e.Enum({C_SELECT_OK:b8e.enc(),C2V_UPDATA_VIEW:b8e.enc(),C2V_CHANGE_CHECK:b8e.enc()}),b8e.RC("$$game","$$NotOpenEvts",e)}(),function(){var e=b8e.Object.extends({checkTag:!1,ctor:function(){this._super()},setCheckTag:function(e){this.checkTag=e}});game.notOpenTipData=game.notOpenTipData||new e}(),function(){var e=game.Control.extends({ipc:function(){this.evts={}},updataInfo:function(e){(e||e.data)&&this.send(this.Evts.C2V_UPDATA_VIEW,e.data)},enter:function(){this.dpt(this.Evts.C_SELECT_OK)},cancel:function(){game.module.hide(game.ME.NotOpenTip)},checkBtn:function(){game.notOpenTipData.setCheckTag(!game.notOpenTipData.checkTag),this.send(this.Evts.C2V_CHANGE_CHECK)}});b8e.module.registerControl(game.ME.NotOpenTip,e,game.NotOpenEvts)}(),function(){var e=game.View.extends({barWidth:514,_bgTag:0,ctor:function(){this._super(755)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATA_VIEW:this.updataPage(t);break;case this.Evts.C2V_CHANGE_CHECK:this.changeCheck()}},onShow:function(){this.changeCheck()},updataPage:function(e){this.skin.lbl_info.string=game.Lang.get(e.lang,e.cost,e.text)},changeCheck:function(){this.skin.ok1.active=game.notOpenTipData.checkTag}});b8e.module.registerView(game.ME.NotOpenTip,e)}(),function(){var e;e=b8e.Object.extends({initData:function(e){if(e){var t,a,i=e.datas.length;for(this.infoMap.clear(),t=0;t<i;t++)(a=new game.NewYearDiscountMallInfo).setData(e.datas[t]),this.infoMap.set(a.id,a);this.endTime=e.endTime}},initBuyTimes:function(e){var t,a,i,n=e.length;for(t=0;t<n;t++)i=e[t],(a=this.infoMap.get(i.id))&&(a.buyTimes=i.count,a.canBuy=a.buyTimes<a.limitNum)},setBuyTimesAdd:function(e){var t=this.infoMap.get(e);t&&(t.buyTimes++,t.canBuy=t.buyTimes<t.limitNum),b8e.log("===========")},getList:function(){var e=this.infoMap.values();return e.sort(this.onSort),e},onSort:function(e,t){return e.sortId-t.sortId}}),b8e.RC("$$game","$$DiscountMallDataModule",e)}(),function(){var e;e=b8e.Object.extends({initOpenServer:function(){var e=this;e._change||(e._change={});for(var t=game.festivalData.getModelData("activities"),a=void 0,i=0;i<t.length;i++)a=t[i],e._change[a.id]=a;var n=[],s=void 0,r=void 0,o=game.festivalData.getData(e._dataType);if(o){var g=o.datas;e.setEndTime(o.endTime);for(var u=void 0,l=0,c=g.length;l<c;l++)(u=g[l]).exchangeExt&&(e.changeService||2!=u.exchangeExt.limitType||(e.changeService=!0),s=new game.NewYearExchargeInfo,(r=game.festivalData.getExtByExtName(e._dataType,"itemBG_big"))&&(s.extVal=r),s.setData(u),n.push(s),e.infoList.set(e._dataType,n));e.updataFinish(e._dataType,!0)}},getListByType:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=this.infoList.get(e);if(i)return a&&i.sort(this.listSort),i},listSort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.sortId-t.sortId},updataChangeFinish:function(e,t){for(var a=e.length,i=void 0,n=void 0,s=void 0,r=0;r<a;r++)i=e[r],n=this.getChangeCost(i),(s=this._change[i.id])&&t&&(i.num-=s.count),0<i.num&&i.setCanGet(n>=i.value.length)},getChangeCost:function(e){for(var t=0,a=e.value,i=a.length,n=void 0,s=void 0,r=void 0,o=0;o<i;o++)s=21==(r=(n=a[o]).id)||22==r||23==r?game.amount.getAmountById(r):game.itemData.getNumById(r),e.itemNum+=s,s>=n.num&&t++;return t},updataGet:function(e){var t=this.getListByType(e.subType);if(t)for(var a=0;a<t.length;a++){var i=t[a];i.id==e.id&&i.setGet(!0)}},updataAlert:function(e){var t=0,a=this.getListByType(e);if(a){for(var i=0;i<a.length;i++){a[i].isCanGet&&t++}return t}},updataChangeGet:function(e){var t=void 0,a=void 0,i=void 0,n=this.getListByType(e.subType);if(n)for(var s=0;s<n.length;s++)t=n[s],a=this.getChangeCost(t),t.id==e.id&&(t.num--,i=0<t.num&&a>=t.value.length,t.setCanGet(i))},updataServiceNum:function(e,t){var a=void 0,i=void 0,n=void 0,s=this.getListByType(t,!1);if(s){for(var r=0;r<s.length;r++)if(2==(a=s[r]).type){i=a;break}for(var o=0;o<e.length;o++)if(n=e[o],i.id==n.id){i.num=n.count;break}}}}),b8e.RC("$$game","$$ExchangeDataModule",e)}(),function(){var e;e=b8e.Object.extends({initOpenServer:function(){var e=this;e.setContFinish(),e._award||(e._award=[]);for(var t=game.festivalData.getModelData("activities"),a=void 0,i=0;i<t.length;i++)a=t[i],e._award.push(a.id);var n=[],s=void 0,r=void 0,o=game.festivalData.getData(e._dataType);if(o){var g=o.datas;e.contModel[e._dataType]=o.clientModel,e.setEndTime(o.endTime);for(var u=void 0,l=0,c=g.length;l<c;l++)(u=g[l]).exchangeExt||((s=new game.NewYearRechargeInfo).type=e._dataType,(r=game.festivalData.getExtByExtName(e._dataType,"itemBG_big"))&&(s.extVal=r),s.setData(u),n.push(s),e.infoList.set(e._dataType,n));e.updataFinish(e._dataType,!0)}},getListByType:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=this.infoList.get(e);if(i)return a&&i.sort(this.listSort),i},listSort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.sortId-t.sortId},updataCumuFinish:function(e){for(var t,a=this.cumuRecharge,i=e.length,n=0;n<i;n++)(t=e[n]).num=a,this._award&&0<this._award.length?-1==this._award.indexOf(t.id)?t.isGet||t.setCanGet(a>=t.value):t.setGet(!0):t.isGet||t.setCanGet(a>=t.value)},updataGet:function(e){var t=this.getListByType(e.subType);if(t)for(var a=0;a<t.length;a++){var i=t[a];i.id==e.id&&i.setGet(!0)}},updataAlert:function(e){var t=0,a=this.getListByType(e);if(a){for(var i=0;i<a.length;i++){a[i].isCanGet&&t++}return t}},addAccuNum:function(e){this.cumuRecharge+=e},setContFinish:function(){var e=game.festivalData.getModelData("conditions"),t=void 0;if(this.cumuRecharge=0,e&&0<e.length)for(var a=e.length,i=0;i<a;i++)if((t=e[i]).subType==this._dataType){this.cumuRecharge=t.value;break}},setEndTime:function(e){this.cumuTime=e},updataFinish:function(e){var t=this.getListByType(e);t&&this.updataCumuFinish(t)}}),b8e.RC("$$game","$$RechargeAccuDataModule",e)}(),function(){var e;e=b8e.Object.extends({initOpenServer:function(){var e=this;e.setContFinish(),e.contRecharge||(e.contRecharge=1),e._award||(e._award=[]);for(var t=game.festivalData.getModelData("activities"),a=void 0,i=0;i<t.length;i++)a=t[i],e._award.push(a.id);var n=[],s=void 0,r=void 0,o=game.festivalData.getData(e._dataType);if(o){var g=o.datas;e.contModel[e._dataType]=o.clientModel,e.setEndTime(o.endTime);for(var u=void 0,l=0,c=g.length;l<c;l++)(u=g[l]).exchangeExt||((s=new game.NewYearRechargeInfo).type=e._dataType,(r=game.festivalData.getExtByExtName(e._dataType,"itemBG_big"))&&(s.extVal=r),s.setData(u),n.push(s),e.infoList.set(e._dataType,n));e.updataFinish(e._dataType)}},dailyReset:function(){this.contFinish=!1},getListByType:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=this.infoList.get(e);if(i)return a&&i.sort(this.listSort),i},listSort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.sortId-t.sortId},updataContFinish:function(e){for(var t=game.rechargeData.rechargeMoneyDaily,a=e.length,i=this.contRecharge,n=(this.contFinish,0);n<a;n++){var s=e[n];s.num=t,this._award&&0<this._award.length?-1==this._award.indexOf(s.id)?s.value<i?s.setCanGet(!0):s.value==i&&(s.isGet||(s.setCanGet(t>=s.recharge),t>=s.recharge)):s.setGet(!0):s.value<i?s.setCanGet(!0):s.value==i&&(s.isGet||(s.setCanGet(t>=s.recharge),t>=s.recharge))}},updataGet:function(e){var t=this.getListByType(e.subType);if(t)for(var a=0;a<t.length;a++){var i=t[a];i.id==e.id&&i.setGet(!0)}},updataAlert:function(e){var t=0,a=this.getListByType(e);if(a){for(var i=0;i<a.length;i++){a[i].isCanGet&&t++}return t}},setContFinish:function(){var e=game.festivalData.getModelData("conditions"),t=void 0;if(e&&0<e.length)for(var a=e.length,i=0;i<a;i++)if((t=e[i]).subType==this._dataType){this.contRecharge=t.finish?t.value:t.value+1,this.contFinish=t.finish;break}},setEndTime:function(e){0<this.contTime&&this.contTime!=e&&(this.contRecharge=1),this.contTime=e},updataFinish:function(e){var t=this.getListByType(e);t&&this.updataContFinish(t)}}),b8e.RC("$$game","$$RechargeDataModule",e)}(),function(){var e;e=b8e.Object.extends({initItemInfoArr:function(){var e=null,t=null,a=this.idData.datas,i=a.length,n=this.infoPool;n=n||(this.infoPool=[]),this.itemInfoArr.clear();for(var s=0;s<i;s++)e=a[s],(t=(t=n[s])||(n[s]=new game.NewYearSignInInfo)).setCfg(e),this.itemInfoArr.set(e.id,t);this.endTime=this.idData.endTime,this.setImgMap()},_sort:function(e,t){return e.days-t.days},getItemList:function(){var e=this.itemInfoArr.values();return e.sort(this._sort),e},getItemInfoArr:function(){for(var e,t=this.getItemList(),a=t.length,i=[],n=[],s=0;s<a;s++)(e=t[s]).isGetPrise?n.push(e):i.push(e);return i=i.concat(n)},checkRedPoint:function(){for(var e=this.getItemList(),t=e.length,a=0;a<t;a++)if(e[a].isRed)return!0;return!1},getBanner:function(){if(this.idData)return game.festivalData.getCExtByType(this.idData.subType,"banner")},getItemBg:function(){var e=this.imgMap.get("itemBG_big");return game.ResCfg.getImgUrl(e)},setLoginTime:function(){for(var e,t=this.conditionsData,a=t.length,i=0;i<a;i++)if((e=t[i]).subType==this._dataType)return void(this.loginDays=e.value)},setImgMap:function(){if(this.idData){var e=game.festivalData.getCExtByType(this.idData.subType,"ext");if(e&&!(e.length<1)){var t,a=e.length;this.imgMap=b8e.HashMap.get();for(var i=0;i<a;i++){t=e[i];var n=b8e.getFPV(t,"extName"),s=b8e.getFPV(t,"extVal");this.imgMap.set(n,s)}}}},updateItemInfoArr:function(){var e,t=this.activitiesData;e=t.length;var a,i,n,s=[];for(n=0;n<e;n++)a=t[n].id,s.push(a);var r,o=this.getItemList();for(e=o.length,n=0;n<e;n++)(r=o[n])&&(i=-1<s.indexOf(r.id),r.isGetPrise=i,r.setGetPrise())},updateItemInfo:function(e){for(var t,a=this.getItemList(),i=a.length,n=0;n<i;n++)(t=a[n])&&t.id==e&&(t.isGetPrise=!0,t.setGetPrise())}}),b8e.RC("$$game","$$SignInDataModule",e)}(),function(){var e;e=b8e.Object.extends({lastCount:0,updateConditions:function(){for(var e,t=game.festivalData.getModelData("activities"),a=0;a<t.length;a++)(e=t[a])&&(this.stateDic[e.id]=e.count)},getPayCount:function(){return this.payCount},updatePayCount:function(e){var t=0<arguments.length&&void 0!==e&&e,a=game.amount.get(game.AmountType.YUAN_BAO);if(0==this.lastCount||t)this.lastCount=a;else if(this.lastCount<=a)this.lastCount=a;else{var i=this.lastCount-a;this.payCount+=i,this.lastCount=a,this.updataGet()}},updataGet:function(){var e=game.festivalData.getModelData("conditions");if(e){for(var t,a=0,i=0;i<e.length;i++)if((t=e[i]).subType==this._dataType){a=t.value,t.finish;break}this.payCount<a?this.payCount=a:a=this.payCount;var n=this.payDatas.get(this._dataType),s=game.festivalData.getModelData("activities");if(n&&s)for(var r=void 0,o=void 0,g=0,u=n.length;g<u;g++){(r=n[g]).currentCount!=a&&(r.currentCount=a),a>=r.conditionValue&&(n[g].canGet||(n[g].canGet=!0));for(var l=0;l<s.length;l++)if(o=s[l],r.id==o.id){n[g].setIsGet(!0);break}}}},getPayDatas:function(e){if(e){var t=this.payDatas.get(e);return t||(this.setPayDatas(e),this.updataGet(),t=this.payDatas.get(e)),t.sort(this.listSort),t}},listSort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.getSortId()-t.getSortId()},setPayDatas:function(e){var t,a,i=game.festivalData.getData(e);if(i){var n=i.datas;this.payData=[];for(var s=0,r=n.length;s<r;s++)t=n[s],(a=new game.YearPayItemInfo).setData(t),this.payData.push(a);this.payDatas.set(e,this.payData)}}}),b8e.RC("$$game","$$YearPayDataModule",e)}(),function(){var e;e=b8e.Object.extends({group:0,curGroup:0,sRechargeList:null,awardsMap:null,awardList:null,configList:null,endTime:0,ctor:function(){this.sRechargeList=[],this.awardList=[],this.awardsMap=b8e.HashMap.get()},synData:function(e){e&&(this.configList=e.datas,this.endTime=e.endTime)},synModelData:function(){var e=game.festivalData.getModelData("conditions");if(e&&!(e.length<1)){for(var t=void 0,a=0;a<e.length;a++)if((t=e[a]).subType===this._dataType){this.setRechargeList1(t.singleValue);break}var i=game.festivalData.getModelData("activities");if(i&&!(i.length<1))for(var n=0;n<i.length;n++)this.setAward(i[n].id)}},initList:function(){var e,t=void(this.sRechargeList.length=0),a=void 0,i=void 0,n=this.configList;e=n.length;for(var s=0;s<e;s++)a=n[s],(t=new game.FestSRechargeInfo).setData(a),i=this.sRechargeList.length,this.sRechargeList[i]=t},getUIJson:function(){return game.festivalData.getCExtByType(this._dataType,"banner")},setAward:function(e){var t=this.sRechargeList;if(t&&t.length){for(var a=t.length,i=void 0,n=0;n<a;n++)if(e==t[n].id){i=t[n];break}i&&(-1<this.awardList.indexOf(e)||this.awardList.push(e),i.isGetAward=!0)}},isGetAward:function(e){return-1<this.awardList.indexOf(e)},isAlert:function(){for(var e=this.sRechargeList,t=e.length,a=void 0,i=0,n=0;n<t;n++)(a=e[n]).canGet&&!a.isGetAward&&i++;return i},getRechargeList:function(){return this.sRechargeList.sort(this.listSort)},listSort:function(e,t){return!e.isGetAward&&t.isGetAward?-1:e.isGetAward&&!t.isGetAward?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.needMoney-t.needMoney},setRechargeList1:function(e){var t=this.sRechargeList;if(t&&!(t.length<1)&&e&&!(e.length<1))for(var a=void 0,i=this.awardList,n=0;n<t.length;n++)if(a=t[n],-1<e.indexOf(a.needMoney)){if(-1<i.indexOf(a.id))continue;a.canGet=!0}},setRechargeList2:function(e){var t=this.sRechargeList;if(t&&!(t.length<1))for(var a=void 0,i=this.awardList,n=0;n<t.length;n++)if((a=t[n]).needMoney==e){if(-1<i.indexOf(a.id))continue;a.canGet=!0}}}),b8e.RC("$$game","$$SingleRechargeDataModule",e)}(),function(){var e;e=game.FestivalItemCtrl.extends({ipc:function(){this.gevts={FestivalEvts:{SERV_UPDATE_DATA:this.updateDataMall,GET_ATTEND_ACTIVITY_RESP:this.attendActivityResp}}},saeCb:function(e){this.spotAlert=e},attendActivityResp:function(e){var t=e.data;if(t.subType==this.fSubType)if(0<t.code){game.notice.noticeError(t.code)}else this.dpt(this.Evts.C2C_ATTEND_ACTIVE,t),this._conData.setBuyTimesAdd(t.id)},notify:function(e,t){switch(e){case this.Evts.V2C_BUY_ITEM:this.reqAttendActivity(null,t)}},updateDataMall:function(){var e=this.getData(),t=this.getModelData("activities");this._conData.initData(e),this._conData.initBuyTimes(t),this.send(this.Evts.UPDATE_MALL_INFO)}}),b8e.RC("$$game","$$DiscountMallControlModule",e)}(),function(){var e;e=game.FestivalItemCtrl.extends({ipc:function(){this.gevts={FestivalEvts:{SERV_UPDATE_DATA:this.initInfo,GET_ATTEND_ACTIVITY_RESP:this.AttendActivityResp}},this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess},NewYearDiscountMall:{C2C_ATTEND_ACTIVE:this.AttendActivityResp},MainRole:{C_RESET_DAILY:this.dailyReset}}},saeCb:function(e){this.spotAlert=e},initInfo:function(){this._conData.initOpenServer(),this.checkAlter()},dailyReset:function(){this._conData.dailyReset(),this.updataAwardFinish(),this.checkAlter()},AttendActivityResp:function(e){var t=e.data;this._conData.updataGet(t),this.send(this.Evts.V_UPGRADE_RECHARGE),this.checkAlter()},notify:function(e,t){switch(e){case this.Evts.C_GET_AWARD:this.reqAttendActivity(t.type,t.id)}},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},checkAlter:function(){var e=this._conData.updataAlert(this._conType);this.spotAlert&&(this.spotAlert.alert=0!=e)},updataAwardFinish:function(){this._conData.updataFinish(this._conType,!1)}}),b8e.RC("$$game","$$RechargeControlModule",e)}(),function(){var e;e=game.FestivalItemCtrl.extends({init:function(){},saeCb:function(e){this.spotAlert=e},ipc:function(){this.gevts={FestivalEvts:{SERV_UPDATE_DATA:this.initData,GET_ATTEND_ACTIVITY_RESP:this.joinRes}}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_PRIZE:this.getPrizeReq(t)}},joinRes:function(e){var t=e.data;t.subType==this._conType&&(this._conData.updateItemInfo(t.id),this.updateRedPonit(),this.send(this.Evts.C2V_UPDATE_VIEW))},initData:function(){var e=this,t=e.getData();if(t){var a=e.getModelData("conditions");e._conData.conditionsData=a,e._conData.setLoginTime(),e._conData.idData=t,e._conData.initItemInfoArr();var i=e.getModelData("activities");e._conData.activitiesData=i,e._conData.updateItemInfoArr(),e.send(e.Evts.C2V_UPDATE_VIEW),e.updateRedPonit()}},updateRedPonit:function(){if(this.spotAlert){var e=this._conData.checkRedPoint();this.spotAlert.alert=e}},getPrizeReq:function(e){this.reqAttendActivity(this._conType,e)}}),b8e.RC("$$game","$$SignInControlModule",e)}(),function(){var e;e=game.FestivalItemCtrl.extends({csArrowAlert:null,stateDic:null,ipc:function(){this.evts={Back:{C2C_REMOVE_AMOUNT:this.removeAmount}},this.gevts={FestivalEvts:{GET_ATTEND_ACTIVITY_RESP:this.attendActivityResp,SERV_UPDATE_DATA:this.initInfo}}},initInfo:function(){this.showAlert()},alertCall:function(e){this.csArrowAlert=e},showAlert:function(){this.csArrowAlert&&(this.csArrowAlert.alert=this.checkAlert())},checkAlert:function(){var e,t=game.festivalData.getData(this._conType);t&&(e=t.datas);var a,i=game.festivalData.getModelData("activities"),n=game.festivalData.getModelData("conditions");if(this.stateDic||(this.stateDic={}),i)for(var s=0;s<i.length;s++)(a=i[s])&&(this.stateDic[a.id]=a.count);var r,o,g=0;if(n){var u;for(s=0;s<n.length;s++)if((u=n[s]).subType==this._conType){g=u.value;break}}if(this._conData.payCount<g?this._conData.payCount=g:g=this._conData.payCount,e)for(s=0;s<e.length;s++)if(r=e[s],o=this.stateDic[r.id],r.conditionValue<=g&&(!o||0==o))return!0;return!1},attendActivityResp:function(e){var t=e.data,a=t.id,i=game.festivalData.getModelData("activities");if(t.subType==this._conType){var n={};n.id=a,n.count=1,i.push(n),this._conData.updataGet(),this.send(game.YearTaskEvent.UPDATE_YUANBAO_COUNT)}this.showAlert()},updateAmount:function(e){var t=!!e.data;game.festivalData.getFestivalIsOpen(this._conType)&&(this._conData.updatePayCount(t),this.showAlert())},removeAmount:function(e){if(e&&e.data){game.festivalData.getFestivalIsOpen(this._conType)&&(this._conData.payCount+=e.data,this._conData.updataGet(),this.showAlert())}},notify:function(e,t){switch(e){case game.YearTaskEvent.GET_TASK_REWARD_REQ:this.reqAttendActivity(this._conType,t)}}}),b8e.RC("$$game","$$YearPayControlModule",e)}(),function(){var e;e=game.FestivalItemCtrl.extends({init:function(){},ipc:function(){this.gevts={FestivalEvts:{SERV_UPDATE_DATA:this.updateData,GET_ATTEND_ACTIVITY_RESP:this.getAwards}},this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess}}},notify:function(e,t){switch(e){case this.Evts.ITEM_GETAWARDS:this.reqAttendActivity(this._conType,t)}},redPoint:function(e){this.spotAlert=e},getAwards:function(e){var t=e.data;t.subType==this._conType&&(this._conData.setAward(t.id),this.send(game.FestSRechargeEvts.GET_AWARDS_SUCCESS),this.isAlert())},isAlert:function(){if(this.spotAlert){var e=this._conData.isAlert();this.spotAlert.alert=0<e}},updateData:function(){var e=this.getData();e&&(this._conData.synData(e),this._conData.initList(),this._conData.synModelData(),this.isAlert())},rechargeSuccess:function(e){if(e&&e.data){if(game.festivalData.getFestivalIsOpen(this._conType)){var t=e.data,a=void 0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;this._conData.setRechargeList2(a),this.isAlert(),this.send(game.FestSRechargeEvts.RECHARGE_SUCCESS)}}},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),b8e.RC("$$game","$$SingleRechargeControlModule",e)}(),function(){var e;e=game.View.extends({ctor:function(){this._super(28)},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500)},initPageData:function(e){this._pageData=e},notify:function(e){switch(e){case this.Evts.C2V_FOSTER_UPGRADE:this.onShow()}},onShow:function(){var e=game.festivalData.getBannerNameByType(game.festivalData.curSType),t=game.ResCfg.getImgUrl(e,!0);if(this.skin.banner.loadTexture(t),this.infoList=this._pageData.getList(),this.list.setData(this.infoList),this.endTime=this._pageData.endTime,this.endTime){this.timer.reset(),this.timer.start()}},onHide:function(){this.stopTime()},updateTime:function(){if(!this.endTime){return this.skin.time.string=game.Lang.get(9053),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.time.string=game.Lang.get(9053),void this.stopTime()}this.skin.time.string=b8e.TimeUtil.formatDayTime(e)},stopTime:function(){if(this.timer){this.timer.stop()}},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$DiscountMallViewModule",e)}(),function(){var e;e=game.View.extends({ctor:function(){this._super(29)},notify:function(e){switch(e){case this.Evts.V_UPGRADE_VIEW:this.updataPanel();break;case this.Evts.V_UPGRADE_RECHARGE:this.updataRecharge(),this.updataList()}},init:function(){var e=this;e.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.awardList.itemRender=game.NewYearAccuRechargeItem,e.awardList.bindEnum=game.ME.NewYearAccuRecharge,e.awardList.layout.spacingY=5,e.awardList.layout.paddingTop=0,e.awardList.addToParent(e.skin.list),e.surfaceModel=new game.SurfaceModel,e.surfaceModel.addToParent(e.skin.model)},initPageData:function(e,t){this._pageData=e,this._pageType=t},onShow:function(){this.updataPanel()},onHide:function(){},onStageResize:function(){this.setPosition(0,0)},updataPanel:function(){this.updataTimer(),this.updataRecharge(),this.updataList(),this.updataModel()},updataModel:function(){var e=game.festivalData.getBannerNameByType(this._pageType);this.skin.banner.loadTexture(game.ResCfg.getImgUrl(e,!0)),this._pageData.contModel&&this.surfaceModel.showJSONSurface(this._pageData.contModel[this._pageType])},updataTimer:function(){var e=this._pageData.cumuTime-game.SysTime.curTime,t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.active=0<e,this.skin.time.string=game.Lang.get(4509,t),this.cdTimer?(this.cdTimer.reset(),this.cdTimer.start()):this.cdTimer=b8e.Timer.add(this,this.updateFestivalTimer,1e3)},updateFestivalTimer:function(){var e=this._pageData.cumuTime-game.SysTime.curTime;if(0<e){var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.string=game.Lang.get(4509,t)}else this.skin.time.string=b8e.TimeUtil.formatTime(0),this.skin.time.active=!1,this.cdTimer&&this.cdTimer.stop()},updataRecharge:function(){var e=this.skin;e.lbl_recharge.string=this._pageData.cumuRecharge,e.lbl.x=e.lbl_recharge.x-e.lbl_recharge.width},updataList:function(){var e=this._pageData.getListByType(this._pageType);this.awardList.setData(e)}}),b8e.RC("$$game","$$NewYearAccuRechargeView",e)}(),function(){var e;e=game.ListItem.extends({_infoList:null,ctor:function(){this._super(30),this.setSize(600,177)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.ShowItemListItem,this.awardList.layout.paddingLeft=0,this.awardList.layout.paddingRight=0,this.awardList.layout.paddingTop=0,this.awardList.layout.spacingX=35,this.awardList.addToParent(this.skin.prizeList)},clearData:function(){if(this.awardList){this.awardList.clear()}},setData:function(e){var t=this.skin;this.initItemData();var a="",i=this._itemData.contRecharge,n=game.rechargeData.rechargeMoneyDaily,s=e.recharge;e.value<i?a=game.Lang.get(4505,s,s,s):e.value==i?(a=game.Lang.get(4504,s),a+=s<=n?game.Lang.get(4507,s,s):game.Lang.get(4508,n,s)):e.value==i+1&&(a=game.Lang.get(9056)),t.lbl_target.string=a,t.lbl_target.active=!e.isGet,t.title.string=game.Lang.get(4503,e.value),t.getBtnLab.node.string=e.isCanGet?game.Lang.get(9057):game.Lang.get(9058),e.value<=i?t.getBtn.active=!e.isGet:t.getBtn.active=!1,t.isGetImg.active=e.isGet,t.spotAlert.node.active=e.isCanGet;var r=game.CfgUtil.getPrizeListInfo2(e.award,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_105);this.awardList.setData(r.items)},getBtn:function(){this.data.isCanGet?this.send(game.NewYearRechargeEvts.C_GET_AWARD,this.data):game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),b8e.RC("$$game","$$RechargeItemModuel",e)}(),function(){var e;e=game.View.extends({ctor:function(){this._super(31)},notify:function(e){switch(e){case this.Evts.V_UPGRADE_VIEW:this.updataPanel();break;case this.Evts.V_UPGRADE_RECHARGE:this.updataRecharge(),this.updataList()}},init:function(){this.surfaceModel=new game.SurfaceModel,this.surfaceModel.addToParent(this.skin.model)},onShow:function(){this.initPageData(),this._showType=game.festivalData.curSType,this.updataPanel()},onHide:function(){},onStageResize:function(){this.setPosition(0,0)},updataPanel:function(){this.updataTimer(),this.updataRecharge(),this.updataList(),this.updataModel()},updataModel:function(){var e=game.festivalData.getBannerNameByType(this._showType);this.skin.banner.loadTexture(game.ResCfg.getImgUrl(e,!0)),this._pageData.contModel&&this.surfaceModel.showJSONSurface(this._pageData.contModel[this._showType])},updataTimer:function(){var e=this._pageData.contTime-game.SysTime.curTime,t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.active=0<e,this.skin.time.string=game.Lang.get(4509,t),this.cdTimer?(this.cdTimer.reset(),this.cdTimer.start()):this.cdTimer=b8e.Timer.add(this,this.updateFestivalTimer,1e3)},updateFestivalTimer:function(){var e=this._pageData.contTime-game.SysTime.curTime;if(0<e){var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.string=game.Lang.get(4509,t)}else this.skin.time.string=b8e.TimeUtil.formatTime(0),this.skin.time.active=!1,this.cdTimer&&this.cdTimer.stop()},updataRecharge:function(){var e=this.skin;e.lbl_recharge.string=game.rechargeData.rechargeMoneyDaily,e.lbl.x=e.lbl_recharge.x-e.lbl_recharge.width},updataList:function(){var e=this._pageData.getListByType(this._showType);this.awardList.setData(e)}}),b8e.RC("$$game","$$RechargeViewModuel",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(32),this.setSize(600,177)},init:function(){var e=this.skin,t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.ShowItemListItem,t.addToParent(this.skin.prizeList),t.layout.paddingLeft=0,t.layout.paddingTop=0,t.layout.spacingX=35,this.itemBg=b8e.Sprite.get(),this.itemBg.setAnchor(0,1),this.itemBg.addToParent(e.itemBg),this.initItemData()},setData:function(){var e=this.skin,t=this.data,a=t.getAwardList();if(a){this.prizeList.setData(a);var i=this._itemData.loginDays,n=t.isEnoughDay?game.Color.GREEN:game.Color.RED,s=game.HtmlUtil.getText(n,i),r=game.Lang.get(4201,t.days,s,t.days);e.lab.string=r,e.getPrize.active=t.isRed,e.grayBtn.active=!t.isEnoughDay,e.isGetImg.active=t.isGetPrise}},getPrizeBtn:function(){this.send(game.NewYearSignInEvts.V2C_GET_PRIZE,this.data.id)}}),b8e.RC("$$game","$$SignInItemViewModule",e)}(),function(){var e;e=game.View.extends({ctor:function(){this._super(33)},initViewData:function(e){this._viewData=e},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView()}},onShow:function(){this.updateView(),this.createTimer()},updateView:function(){var e=this._viewData.getBanner();if(e){var t=game.ResCfg.getImgUrl(e,!0);this._banner.loadTexture(t);var a=this._viewData.getItemInfoArr();this._list.setData(a)}},createTimer:function(){this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){this.skin;var e=this._viewData.endTime-game.SysTime.curTime;if(e<0)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.labTime.string=t}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this._super(),this.setPosition(0,0)}}),b8e.RC("$$game","$$SignInViewModule",e)}(),function(){var e;e=game.ListItem.extends({_prizeList:null,ctor:function(){this._super(34),this.setSize(600,177)},init:function(){var e=this;e.bg=b8e.Sprite.get(),e.bg.setAnchor(0,1),e.bg.addToParent(e.skin.bgContainer),e._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._prizeList.itemRender=game.ShowItemListItem,e._prizeList.layout.paddingLeft=0,e._prizeList.layout.spacingX=35,e._prizeList.addToParent(e.skin.itemContainer)},initItemData:function(e,t){this._pageData=e,this._pageType=t},onShow:function(){},setData:function(e){var t=e.canGet||e.isGet?e.conditionValue:e.currentCount,a=this.skin;a.conditionTxt.string=game.Lang.get(9601,e.conditionValue,t,e.conditionValue),a.getBtn.setVisible(e.canGet&&!e.isGet),a.getEnBtn.setVisible(!e.canGet&&!e.isGet),a.getBtnTxt2.string=e.canGet||e.isGet?game.Lang.get(9384):game.Lang.get(9383),a.already_got.setVisible(e.isGet);var i=game.CfgUtil.getPrizeListInfo2(e.awards);this._prizeList.setData(i.items)},getBtn:function(){this.data&&this.send(game.YearTaskEvent.GET_TASK_REWARD_REQ,this.data.id)},getEnBtn:function(){}}),b8e.RC("$$game","$$YearPayItemModule",e)}(),function(){var e;e=game.View.extends({list:null,endTime:0,timeVt:6e3,ctor:function(){this._super(35)},onStageResize:function(){this.setPosition(0,0)},init:function(){var e=this._banner=b8e.Sprite.get();e.setAnchor(.5,.5),e.addToParent(this.skin.ban)},initPageData:function(e,t){this._pageData=e,this._pageType=t},onShow:function(){var e=game.festivalData.getBannerNameByType(this._pageType);if(e&&""!=e){var t=game.ResCfg.getImgUrl(e,!0);this._banner.loadTexture(t)}this.updateView()},notify:function(e){switch(e){case game.YearTaskEvent.UPDATE_YUANBAO_COUNT:this.updateView()}},updateView:function(){var e=this;e.clearData(),e.waitSv=!1,e._pageData.updateConditions();var t=game.festivalData.getData(e._pageType);if(t){var a=e._pageData.getPayDatas(e._pageType);e.list.setData(a),e.endTime=t.endTime,e.skin.timeTxt.string=b8e.TimeUtil.formatDayTime(e.endTime-game.SysTime.curTime),e.startTime()}},startTime:function(){this.endTime<game.SysTime.curTime?this.clearTimer():this._timer||(this._timer=b8e.Timer.add(this,this.updateTime,this.timeVt),this._timer.start())},clearTimer:function(){this._timer&&(b8e.Timer.remove(this,this.updateTime),this._timer=null)},updateTime:function(){this.skin.timeTxt.string=b8e.TimeUtil.formatDayTime(this.endTime-game.SysTime.curTime),this.endTime<game.SysTime.curTime&&this.clearTimer()},clearData:function(){this.clearTimer(),this.list&&this.list.clear()},onHide:function(){this.clearData()}}),b8e.RC("$$game","$$YearPayViewModule",e)}(),function(){var e;e=game.View.extends({ctor:function(){this._super(375)},init:function(){var e=this.banner=b8e.Sprite.get();e.setAnchor(0,1),e.addToParent(this.skin.banner);var t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.FestSRechargeItem,t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.bindEnum=this.moduleEnum,t.addToParent(this.skin.list),this.timer=b8e.Timer.add(this,this.updateTime,500)},notify:function(e){switch(e){case this.Evts.RECHARGE_SUCCESS:case this.Evts.GET_AWARDS_SUCCESS:this.updateList()}},onShow:function(){this.setBg(),this.changeTime(),this.updateList()},updateList:function(){var e=this._pageData.getRechargeList();!e||e.lengt<1||this.list.setData(e)},changeTime:function(){this.endTime=this._pageData.endTime,this.timer.reset(),this.timer.start()},setBg:function(){var e=this._pageData.getUIJson();this.banner.loadTexture(game.ResCfg.getImgUrl(e,!0))},updateTime:function(){if(!this.endTime)return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.timeLab.string=game.Lang.get(9053),void this.stopTime();this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e)},stopTime:function(){this.timer&&this.timer.stop()},onHide:function(){this.stopTime()},onStageResize:function(){this._super(),this.setPosition(0,0)}}),b8e.RC("$$game","$$SingleRechargeViewModule",e)}(),function(){var e;e=b8e.Enum({None:0,V2C_GET_PRIZE:b8e.enc(),C2V_UPDATE_VIEW:b8e.enc()}),b8e.RC("$$game","$$NewYearSignInEvts",e)}(),function(){var e=game.SignInDataModule.extends({loginDays:0,ctor:function(){this._super(),this.itemInfoArr=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_LOGIN}});game.newYearSignInData=game.newYearSignInData||new e}(),function(){var e;e=b8e.Object.extends({id:0,isGetPrise:!1,isEnoughDay:!1,isRed:!1,setCfg:function(e){this.id=e.id,this.days=e.conditionValue;var t=game.newYearSignInData.loginDays;this.isEnoughDay=this.days<=t,this.isRed=this.isEnoughDay&&!this.isGetPrise,this.awardArr=e.awards,this.initAwardList()},initAwardList:function(){if(this.awardArr){var e,t,a=this.awardArr,i=a.length;this.prizeList=[];for(var n=0;n<i;n++)e=a[n],(t=game.ItemUtil.createBaseItemInfo(e.id,e.num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(t)}},setGetPrise:function(){var e=game.newYearSignInData.loginDays;this.isEnoughDay=this.days<=e,this.isRed=this.isEnoughDay&&!this.isGetPrise},getAwardList:function(){var e=this.prizeList;if(e&&!(e.length<1))return e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$NewYearSignInInfo",e)}(),function(){var e=game.SignInControlModule.extends({init:function(){this._super(),this.spotAlert=null,this.regFestival(game.FestivalSubType.FST_LOGIN,game.ME.NewYearSignIn,game.SAE.NEWYEAR_SIGNIN,this.saeCb,!1),this._conData=game.newYearSignInData,this._conType=game.FestivalSubType.FST_LOGIN}});b8e.module.registerControl(game.ME.NewYearSignIn,e,game.NewYearSignInEvts)}(),function(){var e;e=game.SignInItemViewModule.extends({initItemData:function(){this._itemData=game.newYearSignInData}}),b8e.RC("$$game","$$NewYearSignInItemView",e)}(),function(){var e=game.SignInViewModule.extends({init:function(){var e=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.NewYearSignInItemView,e.bindEnum=game.ME.NewYearSignIn,e.layout.paddingLeft=0,e.layout.paddingTop=0,e.layout.spacingY=10,e.addToParent(this.skin.listNode);var t=this._banner=b8e.Sprite.get();t.setAnchor(0,1),t.addToParent(this.skin.bannerNode),this.initViewData(game.newYearSignInData)}});b8e.module.registerView(game.ME.NewYearSignIn,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C_GET_AWARD:-1,C_GET_CHANGE:-1,V_UPGRADE_VIEW:-1,V_UPGRADE_RECHARGE:-1,V_UPGRADE_EXCHARGE:-1,V2C_SERVICE_NUM:-1}),b8e.RC("$$game","$$NewYearRechargeEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,sortId:0,num:0,value:0,type:0,award:null,recharge:0,change:null,extVal:null,isCanGet:!1,isGet:!1,ctor:function(){this._super()},setData:function(e){this.id=e.id,this.sortId=e.sortId,this.value=e.conditionValue,this.award=e.awards,e.keepRechargeExt&&(this.recharge=e.keepRechargeExt.money)},setGet:function(e){(this.isGet=e)&&this.setCanGet(!e)},setCanGet:function(e){this.isCanGet=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$NewYearRechargeInfo",e)}(),function(){var e=game.RechargeDataModule.extends({contTime:0,contRecharge:0,contModel:null,contFinish:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_KEEP_RECHARGE}});game.newYearRechargeData=game.newYearRechargeData||new e}(),function(){var e=game.RechargeDataModule.extends({contTime:0,contRecharge:0,contModel:null,contFinish:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_KEEP_RECHARGE2}});game.newYearRecharge2Data=game.newYearRecharge2Data||new e}(),function(){var e=game.RechargeDataModule.extends({contTime:0,contRecharge:0,contModel:null,contFinish:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_KEEP_RECHARGE3}});game.newYearRecharge3Data=game.newYearRecharge3Data||new e}(),function(){var e=game.RechargeDataModule.extends({contTime:0,contRecharge:0,contModel:null,contFinish:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_KEEP_RECHARGE4}});game.newYearRecharge4Data=game.newYearRecharge4Data||new e}(),function(){var e=game.RechargeDataModule.extends({contTime:0,contRecharge:0,contModel:null,contFinish:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_KEEP_RECHARGE5}});game.newYearRecharge5Data=game.newYearRecharge5Data||new e}(),function(){var e=game.RechargeDataModule.extends({contTime:0,contRecharge:0,contModel:null,contFinish:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_KEEP_RECHARGE6}});game.newYearRecharge6Data=game.newYearRecharge6Data||new e}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_KEEP_RECHARGE,game.ME.NewYearRecharge,game.SAE.NEWYEARKEEP_ALERT,this.saeCb),this._conData=game.newYearRechargeData,this._conType=game.FestivalSubType.FST_KEEP_RECHARGE}});b8e.module.registerControl(game.ME.NewYearRecharge,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_KEEP_RECHARGE2,game.ME.NewYearRecharge2,game.SAE.NEWYEARKEEP_ALERT2,this.saeCb),this._conData=game.newYearRecharge2Data,this._conType=game.FestivalSubType.FST_KEEP_RECHARGE2}});b8e.module.registerControl(game.ME.NewYearRecharge2,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_KEEP_RECHARGE3,game.ME.NewYearRecharge3,game.SAE.NEWYEARKEEP_ALERT3,this.saeCb),this._conData=game.newYearRecharge3Data,this._conType=game.FestivalSubType.FST_KEEP_RECHARGE3}});b8e.module.registerControl(game.ME.NewYearRecharge3,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_KEEP_RECHARGE4,game.ME.NewYearRecharge4,game.SAE.NEWYEARKEEP_ALERT4,this.saeCb),this._conData=game.newYearRecharge4Data,this._conType=game.FestivalSubType.FST_KEEP_RECHARGE4}});b8e.module.registerControl(game.ME.NewYearRecharge4,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_KEEP_RECHARGE5,game.ME.NewYearRecharge5,game.SAE.NEWYEARKEEP_ALERT5,this.saeCb),this._conData=game.newYearRecharge5Data,this._conType=game.FestivalSubType.FST_KEEP_RECHARGE5}});b8e.module.registerControl(game.ME.NewYearRecharge5,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_KEEP_RECHARGE6,game.ME.NewYearRecharge6,game.SAE.NEWYEARKEEP_ALERT6,this.saeCb),this._conData=game.newYearRecharge6Data,this._conType=game.FestivalSubType.FST_KEEP_RECHARGE6}});b8e.module.registerControl(game.ME.NewYearRecharge6,e,game.NewYearRechargeEvts)}(),function(){var e;e=game.RechargeItemModuel.extends({initItemData:function(){this._itemData=game.newYearRechargeData}}),b8e.RC("$$game","$$NewYearRechargeItem",e)}(),function(){var e;e=game.RechargeItemModuel.extends({initItemData:function(){this._itemData=game.newYearRecharge2Data}}),b8e.RC("$$game","$$NewYearRecharge2Item",e)}(),function(){var e;e=game.RechargeItemModuel.extends({initItemData:function(){this._itemData=game.newYearRecharge3Data}}),b8e.RC("$$game","$$NewYearRecharge3Item",e)}(),function(){var e;e=game.RechargeItemModuel.extends({initItemData:function(){this._itemData=game.newYearRecharge4Data}}),b8e.RC("$$game","$$NewYearRecharge4Item",e)}(),function(){var e;e=game.RechargeItemModuel.extends({initItemData:function(){this._itemData=game.newYearRecharge5Data}}),b8e.RC("$$game","$$NewYearRecharge5Item",e)}(),function(){var e;e=game.RechargeItemModuel.extends({initItemData:function(){this._itemData=game.newYearRecharge6Data}}),b8e.RC("$$game","$$NewYearRecharge6Item",e)}(),function(){var e=game.RechargeViewModuel.extends({init:function(){this._super(),this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearRechargeItem,this.awardList.bindEnum=game.ME.NewYearRecharge,this.awardList.layout.spacingY=5,this.awardList.layout.paddingTop=0,this.awardList.addToParent(this.skin.list)},initPageData:function(){this._pageData=game.newYearRechargeData}});b8e.module.registerView(game.ME.NewYearRecharge,e)}(),function(){var e=game.RechargeViewModuel.extends({init:function(){this._super(),this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearRecharge2Item,this.awardList.bindEnum=game.ME.NewYearRecharge2,this.awardList.layout.paddingTop=0,this.awardList.layout.spacingY=5,this.awardList.addToParent(this.skin.list)},initPageData:function(){this._pageData=game.newYearRecharge2Data}});b8e.module.registerView(game.ME.NewYearRecharge2,e)}(),function(){var e=game.RechargeViewModuel.extends({init:function(){this._super(),this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearRecharge3Item,this.awardList.bindEnum=game.ME.NewYearRecharge3,this.awardList.layout.spacingY=5,this.awardList.layout.paddingTop=0,this.awardList.addToParent(this.skin.list)},initPageData:function(){this._pageData=game.newYearRecharge3Data}});b8e.module.registerView(game.ME.NewYearRecharge3,e)}(),function(){var e=game.RechargeViewModuel.extends({init:function(){this._super(),this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearRecharge4Item,this.awardList.bindEnum=game.ME.NewYearRecharge4,this.awardList.layout.spacingY=5,this.awardList.layout.paddingTop=0,this.awardList.addToParent(this.skin.list)},initPageData:function(){this._pageData=game.newYearRecharge4Data}});b8e.module.registerView(game.ME.NewYearRecharge4,e)}(),function(){var e=game.RechargeViewModuel.extends({init:function(){this._super(),this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearRecharge5Item,this.awardList.bindEnum=game.ME.NewYearRecharge5,this.awardList.layout.spacingY=5,this.awardList.layout.paddingTop=0,this.awardList.addToParent(this.skin.list)},initPageData:function(){this._pageData=game.newYearRecharge5Data}});b8e.module.registerView(game.ME.NewYearRecharge5,e)}(),function(){var e=game.RechargeViewModuel.extends({init:function(){this._super(),this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearRecharge6Item,this.awardList.bindEnum=game.ME.NewYearRecharge6,this.awardList.layout.spacingY=5,this.awardList.layout.paddingTop=0,this.awardList.addToParent(this.skin.list)},initPageData:function(){this._pageData=game.newYearRecharge6Data}});b8e.module.registerView(game.ME.NewYearRecharge6,e)}(),function(){var e;e=b8e.Object.extends({id:0,sortId:0,num:0,itemNum:0,value:0,type:0,award:null,extVal:null,isCanGet:!1,isGet:!1,ctor:function(){this._super()},setData:function(e){var t=e.exchangeExt;this.id=e.id,this.sortId=e.sortId,this.award=e.awards,this.value=t.costs,this.num=t.limitNum,this.type=t.limitType},setGet:function(e){(this.isGet=e)&&this.setCanGet(!e)},setCanGet:function(e){this.isCanGet=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$NewYearExchargeInfo",e)}(),function(){var e=game.ExchangeDataModule.extends({changeTime:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_EXCHANGE},setEndTime:function(e){this.changeTime=e},updataFinish:function(e,t){var a=this.getListByType(e);a&&this.updataChangeFinish(a,t)}});game.newYearExchangeData=game.newYearExchangeData||new e}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_EXCHANGE,game.ME.NewYearExcharge,game.SAE.NEWYEAREXCHANGE_ALERT,this.saeCb),this._conData=game.newYearExchangeData,this._conType=game.FestivalSubType.FST_EXCHANGE},ipc:function(){var e=this;e.gevts={FestivalEvts:{SERV_UPDATE_DATA:e.initInfo,GET_ATTEND_ACTIVITY_RESP:e.AttendActivityResp}},e.evts={Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},NewYearDiscountMall:{C2C_ATTEND_ACTIVE:e.AttendActivityResp},MainRole:{C_RESET_DAILY:e.dailyReset},Back:{C_BACK_UPDATE_ITEMINFO:e.updateItemInfo}},e.handels={ExchangeCountResp:e.updataServiceNum}},AttendActivityResp:function(e){var t=e.data;this._conData.updataChangeGet(t),this.send(this.Evts.V_UPGRADE_EXCHARGE),this.checkAlter()},updataServiceNum:function(e){var t=e.readProtobuf(game.pb.ExchangeCountResponse);if(0<t.code){game.notice.noticeError(t.code)}else this._conData.updataServiceNum(t.datas,this._conType),this.send(this.Evts.V_UPGRADE_VIEW)},notify:function(e,t){switch(e){case this.Evts.C_GET_AWARD:this.reqAttendActivity(t.type,t.id);break;case this.Evts.C_GET_CHANGE:this.reqAttendActivity(this._conType,t.id);break;case this.Evts.V2C_SERVICE_NUM:var a={subType:this._conType};this.updataChangeNum(a)}},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},updataChangeNum:function(e){e.subType==this._conType&&this.sender.ExchangeCountReq()},updateItemInfo:function(){game.festivalData.getData(this._conType)&&(this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_EXCHARGE))}}),t=game.Sender.extends({ipc:function(){this.msg={ExchangeCountReq:null}}});b8e.module.registerControl(game.ME.NewYearExcharge,e,game.NewYearRechargeEvts,t)}(),function(){var e,v="icon";e=game.ListItem.extends({_infoList:null,ctor:function(){this._super(753),this.setSize(500,177)},init:function(){for(var e=1;e<10;e++)this[v+e]=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this[v+e].addToParent(this.getComponent("q"+e))},setData:function(e){var t=this,a=t.skin,i=e.value,n=i.length,s=1==e.type?4511:4512;a.title.string=game.Lang.get(s,e.num),a.spotAlert.node.active=e.isCanGet,a.condition1.active=1==n,a.condition2.active=2==n,a.condition3.active=3==n;var r=0;switch(n){case 1:r=1;break;case 2:r=3;break;case 3:r=6}t._itemInfoList||(t._itemInfoList=[]),t._infoList||(t._infoList=[]);for(var o=void(t._infoList.length=0),g=void 0,u=0,l=void 0,c=void 0,h=void 0,m=0;m<n;m++)0<(l=(o=i[m]).id)&&(t._itemInfoList[m]=game.ItemUtil.createBaseItemInfo(l,0,t._itemInfoList[m]),game.GridUtil.setItemIcon(t[v+r],t._itemInfoList[m],!1,2),0<o.num&&(c=(u=21==l||22==l||23==l?game.amount.getAmountById(l):game.itemData.getNumById(l))>=o.num?game.Color.GREEN:game.Color.RED,h=(u=game.CCommonUtil.replaceNum(u,0))+"/"+o.num,t[v+r].setNum(h,c,18,!1))),r++;for(var d=e.award,f=void 0,p=0;p<d.length;p++)0<(f=d[p]).id&&(g=game.ItemUtil.createBaseItemInfo(f.id,f.num,g),game.GridUtil.setItemIcon(t[v+r],g,!1,2)),r++},getBtn:function(){this.data.isCanGet?this.send(game.NewYearRechargeEvts.C_GET_CHANGE,this.data):0<this.data.num?game.notice.show(game.Lang.get(4513)):game.notice.show(game.Lang.get(4514))}}),b8e.RC("$$game","$$NewYearExchargeItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(754)},notify:function(e){switch(e){case this.Evts.V_UPGRADE_VIEW:this.updataPanel();break;case this.Evts.V_UPGRADE_EXCHARGE:this.updataList()}},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.NewYearExchargeItem,this.awardList.addToParent(this.skin.list),this.awardList.bindEnum=game.ME.NewYearExcharge,this.awardList.layout.spacingY=5},onShow:function(){game.newYearExchangeData.changeService?this.send(game.NewYearRechargeEvts.V2C_SERVICE_NUM):this.updataPanel()},onHide:function(){},onStageResize:function(){this.setPosition(0,0)},updataPanel:function(){this.updataTimer(),this.updataList(),this.updataModel()},updataModel:function(){var e=game.festivalData.getBannerNameByType(game.FestivalSubType.FST_EXCHANGE);e&&this.skin.banner.loadTexture(game.ResCfg.getImgUrl(e,!0))},updataTimer:function(){var e=game.newYearExchangeData.changeTime-game.SysTime.curTime,t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.active=0<e,this.skin.time.string=game.Lang.get(4509,t),this.cdTimer?(this.cdTimer.reset(),this.cdTimer.start()):this.cdTimer=b8e.Timer.add(this,this.updateFestivalTimer,1e3)},updateFestivalTimer:function(){var e=game.newYearExchangeData.changeTime-game.SysTime.curTime;if(0<e){var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.string=game.Lang.get(4509,t)}else game.newYearExchangeData.setEndTime(0),this.skin.time.string=b8e.TimeUtil.formatTime(0),this.skin.time.active=!1,this.cdTimer&&this.cdTimer.stop()},updataList:function(){var e=game.newYearExchangeData.getListByType(game.FestivalSubType.FST_EXCHANGE);this.awardList.setData(e)}});b8e.module.registerView(game.ME.NewYearExcharge,e)}(),function(){var e=game.RechargeAccuDataModule.extends({cumuTime:0,cumuRecharge:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_ACCU_RECHARGE}});game.rechargeAccuData=game.rechargeAccuData||new e}(),function(){var e=game.RechargeAccuDataModule.extends({cumuTime:0,cumuRecharge:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_ACCU_RECHARGE2}});game.rechargeAccu2Data=game.rechargeAccu2Data||new e}(),function(){var e=game.RechargeAccuDataModule.extends({cumuTime:0,cumuRecharge:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_ACCU_RECHARGE3}});game.rechargeAccu3Data=game.rechargeAccu3Data||new e}(),function(){var e=game.RechargeAccuDataModule.extends({cumuTime:0,cumuRecharge:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_ACCU_RECHARGE4}});game.rechargeAccu4Data=game.rechargeAccu4Data||new e}(),function(){var e=game.RechargeAccuDataModule.extends({cumuTime:0,cumuRecharge:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_ACCU_RECHARGE5}});game.rechargeAccu5Data=game.rechargeAccu5Data||new e}(),function(){var e=game.RechargeAccuDataModule.extends({cumuTime:0,cumuRecharge:0,changeService:!1,ctor:function(){this._super(),this.infoList=b8e.HashMap.get(),this.finishList=b8e.HashMap.get(),this.contModel={},this._dataType=game.FestivalSubType.FST_ACCU_RECHARGE6}});game.rechargeAccu6Data=game.rechargeAccu6Data||new e}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_ACCU_RECHARGE,game.ME.NewYearAccuRecharge,game.SAE.NEWYEARACCU_ALERT,this.saeCb),this._conData=game.rechargeAccuData,this._conType=game.FestivalSubType.FST_ACCU_RECHARGE},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAccuNum(e.data),this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},updataAccuNum:function(e){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&this._conData.addAccuNum(a.money)}}});b8e.module.registerControl(game.ME.NewYearAccuRecharge,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_ACCU_RECHARGE2,game.ME.NewYearAccuRecharge2,game.SAE.NEWYEARACCU_ALERT2,this.saeCb),this._conData=game.rechargeAccu2Data,this._conType=game.FestivalSubType.FST_ACCU_RECHARGE2},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAccuNum(e.data),this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},updataAccuNum:function(e){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&this._conData.addAccuNum(a.money)}}});b8e.module.registerControl(game.ME.NewYearAccuRecharge2,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_ACCU_RECHARGE3,game.ME.NewYearAccuRecharge3,game.SAE.NEWYEARACCU_ALERT3,this.saeCb),this._conData=game.rechargeAccu3Data,this._conType=game.FestivalSubType.FST_ACCU_RECHARGE3},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAccuNum(e.data),this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},updataAccuNum:function(e){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&this._conData.addAccuNum(a.money)}}});b8e.module.registerControl(game.ME.NewYearAccuRecharge3,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_ACCU_RECHARGE4,game.ME.NewYearAccuRecharge4,game.SAE.NEWYEARACCU_ALERT4,this.saeCb),this._conData=game.rechargeAccu4Data,this._conType=game.FestivalSubType.FST_ACCU_RECHARGE4},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAccuNum(e.data),this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},updataAccuNum:function(e){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&this._conData.addAccuNum(a.money)}}});b8e.module.registerControl(game.ME.NewYearAccuRecharge4,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_ACCU_RECHARGE5,game.ME.NewYearAccuRecharge5,game.SAE.NEWYEARACCU_ALERT5,this.saeCb),this._conData=game.rechargeAccu5Data,this._conType=game.FestivalSubType.FST_ACCU_RECHARGE5},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAccuNum(e.data),this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},updataAccuNum:function(e){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&this._conData.addAccuNum(a.money)}}});b8e.module.registerControl(game.ME.NewYearAccuRecharge5,e,game.NewYearRechargeEvts)}(),function(){var e=game.RechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FST_ACCU_RECHARGE6,game.ME.NewYearAccuRecharge6,game.SAE.NEWYEARACCU_ALERT6,this.saeCb),this._conData=game.rechargeAccu6Data,this._conType=game.FestivalSubType.FST_ACCU_RECHARGE6},dailyReset:function(){this.updataAwardFinish(),this.checkAlter()},rechargeSuccess:function(e){e&&e.data&&game.festivalData.getFestivalIsOpen(this._conType)&&(this.updataAccuNum(e.data),this.updataAwardFinish(),this.checkAlter(),this.send(this.Evts.V_UPGRADE_RECHARGE))},updataAccuNum:function(e){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&this._conData.addAccuNum(a.money)}}});b8e.module.registerControl(game.ME.NewYearAccuRecharge6,e,game.NewYearRechargeEvts)}(),function(){var e;e=game.ListItem.extends({_infoList:null,ctor:function(){this._super(30),this.setSize(600,177)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.ShowItemListItem,this.awardList.layout.paddingLeft=0,this.awardList.layout.paddingRight=0,this.awardList.layout.paddingTop=0,this.awardList.layout.spacingX=35,this.awardList.addToParent(this.skin.prizeList)},clearData:function(){this.awardList&&this.awardList.clear()},setData:function(e){var t=this.skin,a="",i=e.num,n=e.value;a=n<=i?game.Lang.get(4507,n,n):game.Lang.get(4508,i,n),t.title.string=game.Lang.get(4506,n)+a,t.getBtnLab.node.string=e.isCanGet?game.Lang.get(9057):game.Lang.get(9058),t.getBtn.active=!e.isGet,t.isGetImg.active=e.isGet,t.spotAlert.node.active=e.isCanGet;var s=game.CfgUtil.getPrizeListInfo2(e.award,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_105);this.awardList.setData(s.items)},getBtn:function(){this.data.isCanGet?this.send(game.NewYearRechargeEvts.C_GET_AWARD,this.data):game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),b8e.RC("$$game","$$NewYearAccuRechargeItem",e)}(),function(){var e=game.NewYearAccuRechargeView.extends({init:function(){this._super(),this.initPageData(game.rechargeAccuData,game.FestivalSubType.FST_ACCU_RECHARGE)}});b8e.module.registerView(game.ME.NewYearAccuRecharge,e)}(),function(){var e=game.NewYearAccuRechargeView.extends({init:function(){this._super(),this.initPageData(game.rechargeAccu2Data,game.FestivalSubType.FST_ACCU_RECHARGE2)}});b8e.module.registerView(game.ME.NewYearAccuRecharge2,e)}(),function(){var e=game.NewYearAccuRechargeView.extends({init:function(){this._super(),this.initPageData(game.rechargeAccu3Data,game.FestivalSubType.FST_ACCU_RECHARGE3)}});b8e.module.registerView(game.ME.NewYearAccuRecharge3,e)}(),function(){var e=game.NewYearAccuRechargeView.extends({init:function(){this._super(),this.initPageData(game.rechargeAccu4Data,game.FestivalSubType.FST_ACCU_RECHARGE4)}});b8e.module.registerView(game.ME.NewYearAccuRecharge4,e)}(),function(){var e=game.NewYearAccuRechargeView.extends({init:function(){this._super(),this.initPageData(game.rechargeAccu5Data,game.FestivalSubType.FST_ACCU_RECHARGE5)}});b8e.module.registerView(game.ME.NewYearAccuRecharge5,e)}(),function(){var e=game.NewYearAccuRechargeView.extends({init:function(){this._super(),this.initPageData(game.rechargeAccu6Data,game.FestivalSubType.FST_ACCU_RECHARGE6)}});b8e.module.registerView(game.ME.NewYearAccuRecharge6,e)}(),function(){var e=game.YearPayDataModule.extends({stateDic:null,payPool:null,payCount:0,lastCount:0,ctor:function(){this._super(),this.stateDic={},this.payPool=[],this.payData=[],this.payDatas=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_COST_GOLD}});game.yearTaskPayData=game.yearTaskPayData||new e}(),function(){var e=game.YearPayDataModule.extends({stateDic:null,payPool:null,payCount:0,lastCount:0,ctor:function(){this._super(),this.stateDic={},this.payPool=[],this.payData=[],this.payDatas=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_COST_GOLD2}});game.yearTaskPay2Data=game.yearTaskPay2Data||new e}(),function(){var e=game.YearPayDataModule.extends({stateDic:null,payPool:null,payCount:0,lastCount:0,ctor:function(){this._super(),this.stateDic={},this.payPool=[],this.payData=[],this.payDatas=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_COST_GOLD3}});game.yearTaskPay3Data=game.yearTaskPay3Data||new e}(),function(){var e=game.YearPayDataModule.extends({stateDic:null,payPool:null,payCount:0,lastCount:0,ctor:function(){this._super(),this.stateDic={},this.payPool=[],this.payData=[],this.payDatas=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_COST_GOLD4}});game.yearTaskPay4Data=game.yearTaskPay4Data||new e}(),function(){var e=game.YearPayDataModule.extends({stateDic:null,payPool:null,payCount:0,lastCount:0,ctor:function(){this._super(),this.stateDic={},this.payPool=[],this.payData=[],this.payDatas=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_COST_GOLD5}});game.yearTaskPay5Data=game.yearTaskPay5Data||new e}(),function(){var e=game.YearPayDataModule.extends({stateDic:null,payPool:null,payCount:0,lastCount:0,ctor:function(){this._super(),this.stateDic={},this.payPool=[],this.payData=[],this.payDatas=b8e.HashMap.get(),this._dataType=game.FestivalSubType.FST_COST_GOLD6}});game.yearTaskPay6Data=game.yearTaskPay6Data||new e}(),function(){var e=game.YearPayControlModule.extends({init:function(){this.regFestival(game.FestivalSubType.FST_COST_GOLD,game.ME.YearPay,game.SAE.YEAR_COST,this.alertCall),this._conData=game.yearTaskPayData,this._conType=game.FestivalSubType.FST_COST_GOLD}});b8e.module.registerControl(game.ME.YearPay,e,game.YearTaskEvent)}(),function(){var e=game.YearPayControlModule.extends({init:function(){this.regFestival(game.FestivalSubType.FST_COST_GOLD2,game.ME.YearPay2,game.SAE.YEAR_COST2,this.alertCall),this._conData=game.yearTaskPay2Data,this._conType=game.FestivalSubType.FST_COST_GOLD2}});b8e.module.registerControl(game.ME.YearPay2,e,game.YearTaskEvent)}(),function(){var e=game.YearPayControlModule.extends({init:function(){this.regFestival(game.FestivalSubType.FST_COST_GOLD3,game.ME.YearPay3,game.SAE.YEAR_COST3,this.alertCall),this._conData=game.yearTaskPay3Data,this._conType=game.FestivalSubType.FST_COST_GOLD3}});b8e.module.registerControl(game.ME.YearPay3,e,game.YearTaskEvent)}(),function(){var e=game.YearPayControlModule.extends({init:function(){this.regFestival(game.FestivalSubType.FST_COST_GOLD4,game.ME.YearPay4,game.SAE.YEAR_COST4,this.alertCall),this._conData=game.yearTaskPay4Data,this._conType=game.FestivalSubType.FST_COST_GOLD4}});b8e.module.registerControl(game.ME.YearPay4,e,game.YearTaskEvent)}(),function(){var e=game.YearPayControlModule.extends({init:function(){this.regFestival(game.FestivalSubType.FST_COST_GOLD5,game.ME.YearPay5,game.SAE.YEAR_COST5,this.alertCall),this._conData=game.yearTaskPay5Data,this._conType=game.FestivalSubType.FST_COST_GOLD5}});b8e.module.registerControl(game.ME.YearPay5,e,game.YearTaskEvent)}(),function(){var e=game.YearPayControlModule.extends({init:function(){this.regFestival(game.FestivalSubType.FST_COST_GOLD6,game.ME.YearPay6,game.SAE.YEAR_COST6,this.alertCall),this._conData=game.yearTaskPay6Data,this._conType=game.FestivalSubType.FST_COST_GOLD6}});b8e.module.registerControl(game.ME.YearPay6,e,game.YearTaskEvent)}(),function(){var e;e=game.YearPayItemModule.extends({init:function(){this._super(),this.initItemData(game.yearTaskPayData,game.FestivalSubType.FST_COST_GOLD)}}),b8e.RC("$$game","$$YearPayItemView",e)}(),function(){var e;e=game.YearPayItemModule.extends({init:function(){this._super(),this.initItemData(game.yearTaskPay2Data,game.FestivalSubType.FST_COST_GOLD2)}}),b8e.RC("$$game","$$YearPayItem2View",e)}(),function(){var e;e=game.YearPayItemModule.extends({init:function(){this._super(),this.initItemData(game.yearTaskPay3Data,game.FestivalSubType.FST_COST_GOLD3)}}),b8e.RC("$$game","$$YearPayItem3View",e)}(),function(){var e;e=game.YearPayItemModule.extends({init:function(){this._super(),this.initItemData(game.yearTaskPay4Data,game.FestivalSubType.FST_COST_GOLD4)}}),b8e.RC("$$game","$$YearPayItem4View",e)}(),function(){var e;e=game.YearPayItemModule.extends({init:function(){this._super(),this.initItemData(game.yearTaskPay5Data,game.FestivalSubType.FST_COST_GOLD5)}}),b8e.RC("$$game","$$YearPayItem5View",e)}(),function(){var e;e=game.YearPayItemModule.extends({init:function(){this._super(),this.initItemData(game.yearTaskPay6Data,game.FestivalSubType.FST_COST_GOLD6)}}),b8e.RC("$$game","$$YearPayItem6View",e)}(),function(){var e=game.YearPayViewModule.extends({init:function(){this._super(),this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.YearPayItemView,this.list.bindEnum=game.ME.YearPay,this.list.layout.paddingTop=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.initPageData(game.yearTaskPayData,game.FestivalSubType.FST_COST_GOLD)}});b8e.module.registerView(game.ME.YearPay,e)}(),function(){var e=game.YearPayViewModule.extends({init:function(){this._super(),this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.YearPayItem2View,this.list.bindEnum=game.ME.YearPay2,this.list.layout.paddingTop=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.initPageData(game.yearTaskPay2Data,game.FestivalSubType.FST_COST_GOLD2)}});b8e.module.registerView(game.ME.YearPay2,e)}(),function(){var e=game.YearPayViewModule.extends({init:function(){this._super(),this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.YearPayItem3View,this.list.bindEnum=game.ME.YearPay3,this.list.layout.paddingTop=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.initPageData(game.yearTaskPay3Data,game.FestivalSubType.FST_COST_GOLD3)}});b8e.module.registerView(game.ME.YearPay3,e)}(),function(){var e=game.YearPayViewModule.extends({init:function(){this._super(),this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.YearPayItem4View,this.list.bindEnum=game.ME.YearPay4,this.list.layout.paddingTop=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.initPageData(game.yearTaskPay4Data,game.FestivalSubType.FST_COST_GOLD4)}});b8e.module.registerView(game.ME.YearPay4,e)}(),function(){var e=game.YearPayViewModule.extends({init:function(){this._super(),this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.YearPayItem5View,this.list.bindEnum=game.ME.YearPay5,this.list.layout.paddingTop=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.initPageData(game.yearTaskPay5Data,game.FestivalSubType.FST_COST_GOLD5)}});b8e.module.registerView(game.ME.YearPay5,e)}(),function(){var e=game.YearPayViewModule.extends({init:function(){this._super(),this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.YearPayItem6View,this.list.bindEnum=game.ME.YearPay6,this.list.layout.paddingTop=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list),this.initPageData(game.yearTaskPay6Data,game.FestivalSubType.FST_COST_GOLD6)}});b8e.module.registerView(game.ME.YearPay6,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_GET_PRIZE:b8e.enc(),V2C_DIG_REQ:b8e.enc(),C2V_UPDATE_DESC:b8e.enc(),C2V_UPDATE_AWARDS:b8e.enc(),C2V_UPDATE_VIEW:b8e.enc(),V2C_DIG_LOG_REQ:b8e.enc(),C2V_UPDATE_LOG:b8e.enc(),C2V_SWITCH_LOG:b8e.enc(),C2V_UPDATE_RESULT:b8e.enc()}),b8e.RC("$$game","$$DigTreasureEvts",e)}(),function(){var e=b8e.Object.extends({id:0,sysData:function(){},resetData:function(){},setDigId:function(){},onDigResp:function(){},onDigAwardsResp:function(){},updateLog:function(){},onDigTreasureNotifyResp:function(){},_updateLog:function(){},isDigOpen:function(){},getCurOpenId:function(){},checkOpenById:function(){},getEndTime:function(){},getShowItems:function(){},setShowItms:function(){},getAwardsArr:function(){},digSort:function(){},initAwardsArr:function(){},updatePrizeArr:function(){},checkDigBtnAlert:function(){},checkPrizeAlert:function(){},setPrizes:function(){},setDigAgainTimes:function(){},getResData:function(){}});game.digTreasureData=game.digTreasureData||new e}(),function(){var e;e=b8e.Object.extends({isHadGet:!1,canGet:!1,setData:function(e){this.cfg=e,this.num=e.num,this.setAwardList(),this.updateInfo()},setAwardList:function(){var e=this.cfg;this.prizeList=[];var t=e.awards;if(t&&!(t.length<1))for(var a,i,n=t.length,s=0;s<n;s++)a=t[s],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,i.iconSize=game.IconSizeEnum.GRID_SIZE_84,this.prizeList.push(i)},getAwardList:function(){return this.prizeList},updateInfo:function(){var e=game.digTreasureData.digTreasureAwards;if(e)if(this.isHadGet=-1<e.indexOf(this.num),this.isHadGet)this.canGet=!1;else{var t=game.digTreasureData.digTreasureConsumeNum;this.canGet=t>=this.num}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$DigAwardInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.MD=game.digTreasureData,this.digAlert=game.spotAlert.set(game.SAE.DIG_ALERT),this.digBtnAlert_1=game.spotAlert.set(game.SAE.DIG_BTN_ALERT_1,game.SAE.DIG_ALERT),this.digBtnAlert_10=game.spotAlert.set(game.SAE.DIG_BTN_ALERT_10,game.SAE.DIG_ALERT),this.digPrizeAlert=game.spotAlert.set(game.SAE.DIG_PRIZE_ALERT,game.SAE.DIG_ALERT)},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.onSysData},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={DigTreasureResp:this.onDigTreasureResp,DigTreasureAwardsResp:this.onDigTreasureAwardsResp,DigTreasureLogResp:this.onDigTreasureLogResp,DigTreasureMsg:this.onDigTreasureNotify}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_PRIZE:this.getPrize(t);break;case this.Evts.V2C_DIG_REQ:this.digReq();break;case this.Evts.V2C_DIG_LOG_REQ:this.diglogReq()}},onSysData:function(e){var t=e?e.data:null;if(t){var a=game.digTreasureData;if(a.isDigOpen()){a.sysData(t);var i=a.getCurOpenId();a.setDigId(i),t.digTreasureId!=i&&a.resetData(),this.checkAlert()}}},resetDaily:function(){var e=game.digTreasureData;if(e.isDigOpen()){var t=e.getCurOpenId();e.id!=t&&(e.resetData(),e.setDigId(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))}else game.module.hide(game.ME.DigTreasure)},logBtn:function(){game.module.show(game.ME.DigLog)},digBtn_1:function(){this.digTimes(1)},digBtn_10:function(){this.digTimes(10)},digTimes:function(e){this.times=e,this.MD.setDigAgainTimes(e),this.digBtn()},digBtn:function(){if(!this.isDiging){var e=game.DigTreasureOpenCfg.getData(this.MD.id);if(e)if(game.digTreasureData.digTreasureConsumeNum>=e.numLimit)game.notice.show(7015);else{if(1==e.activityType){if(game.amount.get(game.AmountType.YUAN_BAO)<e.condition*this.times)return void game.notice.show(7012)}else if(game.digTreasureData.digTreasureUseNum<this.times)return void game.notice.show(7013);this.isDiging=!0,game.module.show(game.ME.DigBar)}}},awardBtn:function(){game.module.show(game.ME.DigAward)},logAllBtn:function(){this.send(this.Evts.C2V_SWITCH_LOG,1)},logSelfBtn:function(){this.send(this.Evts.C2V_SWITCH_LOG,2)},getPrize:function(e){this.sender.DigTreasureAwardsReq(e)},digReq:function(){this.sender.DigTreasureReq(this.times)},onDigTreasureResp:function(e){var t=this,a=e.readProtobuf(game.pb.DigTreasureResponse);if(0<a.code)return game.notice.noticeError(a.code),void(t.isDiging=!1);t.MD.onDigResp(t.times),t.checkAlert(),t.send(t.Evts.C2V_UPDATE_DESC),t.MD.setPrizes(a.award),game.module.show(game.ME.DigResult),t.send(t.Evts.C2V_UPDATE_RESULT),t.isDiging=!1},onDigTreasureAwardsResp:function(e){var t=e.readProtobuf(game.pb.DigTreasureAwardsResponse);0<t.code?game.notice.noticeError(t.code):(this.MD.onDigAwardsResp(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_AWARDS))},checkAlert:function(){this.digBtnAlert_1.alert=this.MD.checkDigBtnAlert(1),this.digBtnAlert_10.alert=this.MD.checkDigBtnAlert(10),this.digPrizeAlert.alert=this.MD.checkPrizeAlert()},diglogReq:function(){this.sender.DigTreasureLogReq()},onDigTreasureLogResp:function(e){var t=e.readProtobuf(game.pb.DigTreasureLogResponse);0<t.code?game.notice.noticeError(t.code):(this.MD.updateLog(t),this.send(this.Evts.C2V_UPDATE_LOG))},onDigTreasureNotify:function(e){var t=e.readProtobuf(game.pb.DigTreasureNotify);0<t.code?game.notice.noticeError(t.code):(this.MD.onDigTreasureNotifyResp(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_DESC))},gaiLvBtn:function(){game.RuleView.inst().showView(game.ME.DigTreasureHelpBtn)},okBtn:function(){game.module.hide(game.ME.DigResult)},buyBtn:function(){this.digReq()}}),t=[game.ME.DigAward,game.ME.DigLog,game.ME.DigBar,game.ME.DigResult],a=game.Sender.extends({ipc:function(){this.msg={DigTreasureReq:this.digTreasureReq,DigTreasureAwardsReq:this.digTreasureAwardsReq,DigTreasureLogReq:null}},digTreasureReq:function(e){var t=game.pb.DigTreasureRequest;t.num=e,this.write(t)},digTreasureAwardsReq:function(e){var t=game.pb.DigTreasureAwardsRequest;t.num=e,this.write(t)}});b8e.module.registerControl(game.ME.DigTreasure,e,game.DigTreasureEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(331),this.setSize(540,165)},init:function(){this.skin;var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=-10,e.layout.paddingTop=10},setData:function(){var e=this.skin,t=this.data,a=t.getAwardList();this.prizeList.setData(a);var i=game.DigTreasureOpenCfg.getData(game.digTreasureData.id);if(i){var n=game.DigTreasureResCfg.getData(i.urlId);n?(e.lab.string=game.Lang.get(n.jipinAward,t.num),e.isGet.active=t.isHadGet,e.notGet.active=!t.isHadGet,e.getPrizeBtn.active=t.canGet,e.gray.active=!t.canGet):b8e.warn("res \u672a\u914d\u7f6e ")}else b8e.warn(game.digTreasureData.id,"     \u7684\u914d\u7f6e\u4e3a\u7a7a")},getPrizeBtn:function(){this.send(game.DigTreasureEvts.V2C_GET_PRIZE,this.data.num)}}),b8e.RC("$$game","$$DigAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(332)},init:function(){var e=this.skin,t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.DigAwardItem,t.bindEnum=game.ME.DigTreasure,t.layout.spacingY=5,t.addToParent(e.listNode)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_AWARDS:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.digTreasureData.getAwardsArr();!e||e.length<1||this._list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width)-6,.5*(t+this.height)+20)}});b8e.module.registerView(game.ME.DigAward,e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(333)},init:function(){this._maxBarWidth=this.skin.bar.node.width},onShow:function(){var e=this.skin,t=this.skin.bar.node;t.width=0;var a=game.DigTreasureOpenCfg.getData(game.digTreasureData.id);if(a){var i=game.DigTreasureResCfg.getData(a.urlId);i?1==i.isTouch?(e.root.active=!0,b8e.Tween.kill(t),b8e.Tween.get(t).to({width:this._maxBarWidth},1e3).call(function(){game.module.hide(game.ME.DigBar)},this)):(game.module.hide(game.ME.DigBar),e.root.active=!1):b8e.warn("\u6316\u5b9d\u85cf  res \u672a\u914d\u7f6e ")}else b8e.warn(game.digTreasureData.id,"     \u7684\u914d\u7f6e\u4e3a\u7a7a - \u6316\u5b9d\u85cf")},onHide:function(){b8e.Tween.kill(this.skin.bar.node),this.send(game.DigTreasureEvts.V2C_DIG_REQ)},onStageResize:function(){this._super();var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),t-500)}});b8e.module.registerView(game.ME.DigBar,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(334)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.XunBaoLogItem,this._list.layout.spacingY=10,this._list.addToParent(this.skin.listNode)},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_LOG:this.switchLog(t);break;case this.Evts.C2V_UPDATE_LOG:this.switchLog(this.logId)}},onShow:function(){this.logId=1,this.send(game.DigTreasureEvts.V2C_DIG_LOG_REQ);var e=game.DigTreasureOpenCfg.getData(game.digTreasureData.id);if(e){var t=game.DigTreasureResCfg.getData(e.urlId);t?this.skin.title.string=t.logName2:b8e.warn("res \u672a\u914d\u7f6e ")}else b8e.warn(game.digTreasureData.id,"     \u7684\u914d\u7f6e\u4e3a\u7a7a")},switchLog:function(e){var t=this.skin,a=1==(this.logId=e);t.logAllBtnLight.active=a,t.logSelfBtnLight.active=!a;var i=a?game.digTreasureData.wholeLogs:game.digTreasureData.ownLogs;this._list.setData(i)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height))}});b8e.module.registerView(game.ME.DigLog,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(336),this.spotAlerts={DIG_BTN_ALERT_1:this.digAlert_1,DIG_BTN_ALERT_10:this.digAlert_10,DIG_PRIZE_ALERT:this.prizeAlert}},digAlert_1:function(e){this.skin.digRed_1.active=e.alert},digAlert_10:function(e){this.skin.digRed_10.active=e.alert},prizeAlert:function(e){this.skin.prizeRed.active=e.alert},init:function(){var e=this.skin;this.MD=game.digTreasureData;var t=this.title=b8e.Sprite.get();t.setAnchor(.5,.5),t.addToParent(e.title);var a=this.banner=b8e.Sprite.get();a.setAnchor(.5,.5),a.addToParent(e.banner);var i=this.award=b8e.Sprite.get();i.setAnchor(.5,.5),i.addToParent(e.awardBtn),b8e.evt.onTouchEnd(e.hotPlace,this._onTouchEnd,this);var n=b8e.Sprite.get();n.setAnchor(.5,.5),n.setScale(.55,.55),n.loadTexture(game.ResCfg.getHead(game.mainRoleData.isMale)),n.addToParent(e.headIcon);var s=this.headList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);s.itemRender=game.JsTurnplateListItem,s.layout.paddingTop=10,s.bindEnum=game.ME.DigTreasure,s.addToParent(e.headList),s.touchMovable=!1;var r=this.listBg=b8e.Sprite.get();r.setAnchor(.5,.5),r.addToParent(e.listBg)},_onTouchEnd:function(e){e.target;var t=e.touch.getLocation(),a=t.x;if(640<b8e.stageWidth){var i=(b8e.stageWidth-640)/2;a=t.x-i}var n=t.y-b8e.stageHeight+80;this.skin.point.setPosition(a,n)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_DESC:this.updateDesc();break;case this.Evts.C2V_UPDATE_VIEW:this.updateImg(),this.updateDesc(),this.createItemGrid(),this.createTimer()}},onShow:function(){this.updateImg(),this.updateDesc(),this.createItemGrid(),this.createTimer()},updateImg:function(){var e=game.DigTreasureOpenCfg.getData(this.MD.id);if(e){var t=game.DigTreasureResCfg.getData(e.urlId);if(t){if(t.title&&""!=t.title){var a=game.ResCfg.getImgUrl(t.title);this.title.loadTexture(a)}if(t.viewBg&&""!=t.viewBg){var i=game.ResCfg.getImgUrl(t.viewBg,!0);this.banner.loadTexture(i)}if(t.awardBg&&""!=t.awardBg){var n=game.ResCfg.getImgUrl(t.awardBg);this.award.loadTexture(n)}if(this.skin.listBg_0.active=!0,t.listBg&&""!=t.listBg){var s=game.ResCfg.getImgUrl(t.listBg);this.skin.listBg_0.active=!1,this.listBg.loadTexture(s)}this.skin.point.active=t.isTouch,this.skin.hotPlace.active=t.isTouch}}},updateDesc:function(){var e=this.skin,t=game.DigTreasureOpenCfg.getData(this.MD.id);if(t){var a=1==t.activityType;e.prizeLab.active=a,e.accNode.active=!a;var i,n=game.DigTreasureResCfg.getData(t.urlId);if(n)if(e.digLabel_1.string=n.btnName1,e.digLabel_10.string=n.btnName2,e.logLab.string=n.logName,e.times1.string=game.Lang.get(n.countStr,this.MD.digTreasureConsumeNum),a)e.prizeLab.string=game.Lang.get(7007,t.condition);else 2==t.activityType&&(i=7008),3==t.activityType&&(i=7009),e.times2.string=game.Lang.get(7011,this.MD.digTreasureUseNum),e.noticeLab.string=game.Lang.get(i,t.condition)}},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.SysTime.curTime,t=this.MD.getEndTime()-e;if(t<0)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);this.skin.timeCountLab.string=a}},createItemGrid:function(){var e=this.MD.getShowItems();!e||e.length<1||(this.headList.setData(e),this.setListTime(e.length))},setListTime:function(e){this.scrollX=0,this.headList.scrollToLeft(0,50),this.patrolTime=game.SysTime.curTime+3400*e,this.patrolTimer?(this.patrolTimer.reset(),this.patrolTimer.start()):this.patrolTimer=b8e.Timer.add(this,this.updateTimer,50)},updateTimer:function(){if(0<this.patrolTime-game.SysTime.curTime)this.scrollX+=1,this.headList.scrollToRight(this.scrollX,50);else if(this.patrolTimer){this.patrolTimer.stop();var e=this.MD.getShowItems();if(!e||e.length<1)return void this.clearTimer();this.setListTime(e.length)}},clearTimer:function(){this.patrolTimer&&(b8e.Timer.remove(this,this.updateTimer),this.patrolTimer=null),this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.DigTreasure,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(335)},init:function(){var e=this;e.MD=game.digTreasureData,e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e._list.itemRender=game.PrizeListItem,e._list.addToParent(e.skin.node_prize),e._list.layout.spacingX=52.5,e._list.layout.spacingY=30,e._costIcon=game.GridUtil.createCostIcon(40),e._costIcon.addToParent(e.skin.cost)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_RESULT:this.updateView()}},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.updateView()},updateView:function(){this.countDownTime=5,this.btnName(),this.createPrize(this.MD.prizes),this.updateDigAgain(),this.updateTime(),this.createCountDown()},createPrize:function(e){0==e.length&&this._list?this._list.clear():(this._list.setData(e),v,this.skin.huawen_3.width=b8e.stageWidth+100,this.skin.huawen_1.width=b8e.stageWidth+100)},btnName:function(){var e=game.DigTreasureOpenCfg.getData(this.MD.id);if(e){var t=game.DigTreasureResCfg.getData(e.urlId);t&&(this.skin.buyLab1.string=t.btnName1,this.skin.buyLab10.string=t.btnName2)}},updateDigAgain:function(){var e=this.skin,t=game.DigTreasureOpenCfg.getData(this.MD.id);if(t){var a=1==t.activityType;e.cost.active=a;var i=1==this.MD.againTimes;if(e.buyLab1.active=i,e.buyLab10.active=!i,a){var n=t.condition*this.MD.againTimes;game.GridUtil.setCostIcon(this._costIcon,21,0,n)}}},createCountDown:function(){if(!this.timer){this.timer=b8e.Timer.add(this,this.updateTime,1e3)}this.timer.reset(),this.timer.start()},updateTime:function(){if(this.countDownTime--,this.skin.timeLab.string=game.Lang.get(52263,this.countDownTime),this.countDownTime<1){game.module.hide(game.ME.DigResult)}},onHide:function(){b8e.Tween.kill(this.skin.light),this.clearCountDown()},clearCountDown:function(){if(this.timer)b8e.Timer.remove(this,this.updateTime),this.timer=null;else;},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height);this.setPosition(e,t),this.skin.gray.setSize(b8e.stageWidth+50,530)}});b8e.module.registerView(game.ME.DigResult,e)}(),function(){var e=game.VerifyAwardView.extends({awardType:6,space:50,ctor:function(){this._super(1079)},init:function(){this.skin;var e=game.VerifyAwardCfg.getData(this.awardType);e&&this.updatePrizeList(e.award)},updateBtn:function(){var e=this.skin,t=game.welfareData.verifyIsGetByType(this.awardType),a=game.LoginConfig.isBindMobile;e.isGetImg.active=t,e.view_getBtn.active=!t&&a,e.getBtnGray.active=!a}});b8e.module.registerView(game.ME.BindMobile,e)}(),function(){var e=game.View.extends({awardType:0,_showModel:!0,space:10,ctor:function(){this._super(1091)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_MSIC_DATA:case this.Evts.C2V_UPDATE_SUPER_VIP:this.updateState();break;case this.Evts.C2V_CLICK_SV_BTN:this.copyStr(this.skin.qqNum.string)}},init:function(){},onShow:function(){this.updateCondition(),this.updateState()},onHide:function(){},copyStr:function(e){game.CCommonUtil.setClipboardData(e)},updateCondition:function(){var e=this.skin,t=game.verifyAwardData.getHdDRecharge(),a=game.verifyAwardData.getHdTRecharge();0<t?(e.condition1.string=game.Lang.get(7001,t),e.condition2.string=game.Lang.get(7002,a)):(e.condition1.string=game.Lang.get(8529,a),e.condition2.active=!1,e.progress2.active=!1);var i=void 0,n=void 0;game.rechargeData.isHudieVip?n=i=game.Lang.get(7003):0<t?(i=game.rechargeData.rechargeMoneyDaily+"/"+t,n=game.rechargeData.rechargeMoney+"/"+a):i=game.rechargeData.rechargeMoney+"/"+a,e.progress1.string=i,e.progress2.string=n},updateState:function(){var e=this.skin,t=game.rechargeData.isHudieVip,a=+game.LoginConfig.gameChannelId,i=game.SuperVipCfg.getData(a);if(i){var n=i.showGetBtn;e.getSuperVipInfoBtn.active=n;var s=game.ResCfg.getImgUrl(i.beautyImg);e.beautyImg.loadTexture(s),s=game.ResCfg.getImgUrl(i.bgImg),e.banner.loadTexture(s),n?(e.qqNum.active=!0,e.qqNum.string=t?i.qqNum:game.Lang.get(7016)):e.qqNum.active=!1}},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height);this.setPosition(e,t)}});b8e.module.registerView(game.ME.SuperVip,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_SHOW_VIEW:-1,C2V_UPDATE_CONDITION:-1,C2V_UPDATE_RANK:-1,C2V_UPDATE_LIST:-1,C2V_UPDATE_RANK_INFO:-1,C2V_UPDATE_CONDITION_NUM:-1,C2C_JUBAO_ENTER:-1}),b8e.RC("$$game","$$CServRankEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,COST_RANK:1,RECHARGE_RANK:2,TURNPLATE_RANK:3,JUBAO_RANK:4,TREASURE_PAVILION_RANK:5}),b8e.RC("$$game","$$CServType",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,id:0,activityType:0,serverEnd:0,rankName:"",score:0,servName:"",ctor:function(){this._super()},setData:function(e,t,a){var i=this;i.cfg=e,i.id=e.id,i.awardCfg=t,i.activityType=e.activityType,i.serverEnd=a,i.conditionValue=t.condition,i.startRank=t.startRank,i.endRank=t.rank,i.award=null,i.extraAward=null},getPrizeList:function(){if(this.award)return this.award;this.award=[];for(var e,t,a=this.awardCfg.award,i=a.length,n=0;n<i;n++)e=a[n],(t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,t.iconSize=game.IconSizeEnum.GRID_SIZE_84,this.award.push(t);return this.award},getExtraPrizeList:function(){if(this.extraAward)return this.extraAward;this.extraAward=[];for(var e,t,a=this.awardCfg.extraAward,i=a.length,n=0;n<i;n++)e=a[n],(t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,t.iconSize=game.IconSizeEnum.GRID_SIZE_84,this.extraAward.push(t);return this.extraAward}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$CServRankInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.conditionMap=b8e.HashMap.get(),this.infoListMap=b8e.HashMap.get(),this.firstInfoListMap=b8e.HashMap.get(),this.rankMap=b8e.HashMap.get(),this.mineRankMap=b8e.HashMap.get(),this.lastRankMap=b8e.HashMap.get(),this.openTypeList=[]},initData:function(e){var t=e.id,a=game.CServRankAwardCfg.getData(t,!0);if(a&&!(a.length<1)){var i=this.conditionMap.get(t);isNaN(i)&&this.conditionMap.set(t,0);var n=this.infoListMap.get(t);if(!n){n=[],this.infoListMap.set(t,n);for(var s=void 0,r=void 0,o=a.length,g=0;g<o;g++)r=a[g],(s=new game.CServRankInfo).setData(e,r,e.serverEnd),1==r.rank?this.firstInfoListMap.set(t,s):n.push(s)}}},csrankResp:function(e){if(e){var t=e.list,a=e.id;if(a&&t&&!(t.length<1)){var i=this.rankMap.get(a);i||(i=[],this.rankMap.set(a,i));for(var n=t.length,s=void 0,r=0;r<n;r++)s=t[r],i[r]||(i[r]=new game.RankItemInfo),i[r].setData(s);if(i.sort(this.onSort),this.updataInfoList(a,i),e.userRank){var o=this.mineRankMap.get(a);o||(o=new game.RankItemInfo,this.mineRankMap.set(a,o)),o.setData(e.userRank)}var g=i[n-1];this.lastRankMap.set(a,g)}}},onSort:function(e,t){return e.rank-t.rank},updataInfoList:function(e,t){if(this.infoListMap&&e&&t&&!(t.length<1)){if(this.firstInfoListMap){var a=this.firstInfoListMap.get(e);a&&(a.rankName=t[0].name,a.servName=t[0].servName)}var i=this.infoListMap.get(e);if(i&&!(i.length<1))for(var n=void 0,s=void 0,r=i.length,o=0;o<r;o++)n=i[o],(s=t[o+1])&&(n.rankName=s.name,n.servName=s.servName,n.score=s.score)}},getLastRankInfo:function(){return this.lastRankMap&&this.curRankId?this.lastRankMap.get(this.curRankId):null},setCurId:function(e){this.curRankId=e},getCurRankId:function(){return this.curRankId},getRankList:function(e){return this.rankMap?this.rankMap.get(e):null},updatePayCount:function(e){var t=0<arguments.length&&void 0!==e&&e,i=this,a=game.amount.get(game.AmountType.YUAN_BAO);if(!i.lastCount||t)return i.lastCount=a,!1;var n=i.lastCount;i.lastCount=a;var s=game.CServType.COST_RANK;if(!i.openTypeList||!i.openTypeList[s])return!1;if(a<n){var r=n-a;return i.conditionMap.forEach(function(e,t){var a=game.CServRankCfg.getDataById(e);a&&a.activityType==game.CServType.COST_RANK&&(t+=r,i.conditionMap.set(e,t))},i),!0}return!1},updateRecharge:function(i){var n=this,e=game.CServType.RECHARGE_RANK;n.openTypeList&&n.openTypeList[e]&&n.conditionMap.forEach(function(e,t){var a=game.CServRankCfg.getDataById(e);a&&a.activityType==game.CServType.RECHARGE_RANK&&(t+=i,n.conditionMap.set(e,t))},n)},updateTurnplate:function(i){var n=this;i&&n.conditionMap.forEach(function(e,t){var a=game.CServRankCfg.getDataById(e);a&&a.activityType==game.CServType.TURNPLATE_RANK&&(t+=i,n.conditionMap.set(e,t))},n)},updateTPStep:function(n){var s=this;n&&s.conditionMap.forEach(function(e,t){var a=game.CServRankCfg.getDataById(e),i=n;a&&a.activityType==game.CServType.TREASURE_PAVILION_RANK&&(t=i,s.conditionMap.set(e,t))},s)},updateJuBaoScore:function(e){var t=game.CServType.JUBAO_RANK;if(this.openTypeList&&this.openTypeList[t]){var a=this.conditionMap,i=a.keys();if(i&&!(i.length<1))for(var n=i.length,s=void 0,r=void 0,o=0;o<n;o++)s=i[o],(r=game.CServRankCfg.getDataById(s))&&r.activityType==t&&a.set(s,e)}},getCondition:function(e){var t=this.conditionMap.get(e);return t||0},setOpen:function(e,t){this.openTypeList[t]=e},getOpenByType:function(e){return this.openTypeList[e]},getInfoList:function(e){return this.infoListMap?this.infoListMap.get(e):null},getMyRank:function(){return this.mineRankMap&&this.curRankId?this.mineRankMap.get(this.curRankId):null},getFirstRankTypeInfo:function(e){if(!this.rankMap)return null;var t=this.rankMap.get(e);return!t||t.length<1?null:t[0]},getCKByType:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=a?6968:6969,n=game.CServType;switch(e){case n.COST_RANK:i=a?6968:6969;break;case n.RECHARGE_RANK:i=a?6970:6971;break;case n.TURNPLATE_RANK:i=8645;break;case n.JUBAO_RANK:i=a?9475:9476;break;case n.TREASURE_PAVILION_RANK:i=a?9697:9698}return i},getConditionDesc:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=6972,n=game.CServType;switch(e){case n.COST_RANK:i=6972;break;case n.RECHARGE_RANK:i=6973;break;case n.TURNPLATE_RANK:i=a?8647:8644;break;case n.JUBAO_RANK:i=9477;break;case n.TREASURE_PAVILION_RANK:i=9699}return game.Lang.get(i)},getConditionDesc2:function(e){var t=6974,a=game.CServType;switch(e){case a.COST_RANK:t=6974;break;case a.RECHARGE_RANK:t=6975;break;case a.TURNPLATE_RANK:t=8646;break;case a.JUBAO_RANK:t=9478;break;case a.TREASURE_PAVILION_RANK:t=9700}return game.Lang.get(t)},getDesc:function(e){var t=6976,a=game.CServType;switch(e){case a.COST_RANK:t=6976;break;case a.RECHARGE_RANK:t=6977}return game.Lang.get(t)},updateCondition:function(e){if(this.conditionMap.clear(),e&&e.crossRank&&!(e.crossRank.length<1))for(var t=void 0,a=e.crossRank,i=a.length,n=0;n<i;n++)t=a[n],this.conditionMap.set(t.id,t.progress)},getFirstInfoById:function(e){return this.firstInfoListMap?this.firstInfoListMap.get(e):null}});game.cservRankData=game.cservRankData||new e}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(177),this.setSize(600,156)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.layout.paddingLeft=0,e.layout.spacingX=13,e.layout.paddingTop=5,e.addToParent(this.skin.prize);var t=this.extPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.ShowItemListItem,t.layout.paddingLeft=0,t.layout.spacingX=13,t.layout.paddingTop=5,t.addToParent(this.skin.extraPrize)},setData:function(){var e=this.skin,t=this.data,a=t.rankName,i=t.servName;if(e.second_root.node.active=2==t.startRank,e.third_root.node.active=3==t.startRank,e.other_root.node.active=3<t.startRank,3<t.startRank)for(var n=4;n<=10;n++)this.getComponent("rank"+n).node.active=t.startRank==n;e.rank11_20.node.active=11<=t.startRank&&t.startRank<=20,e.rank21_50.node.active=21<=t.startRank&&t.startRank<=50,e.rank51_100.node.active=51<=t.startRank&&t.startRank<=100,3==t.activityType?(e.rank6_100.node.active=6<=t.startRank&&t.startRank<=100,e.rank6.node.active=!1):e.rank6_100.node.active=!1;var s=t.conditionValue;if(e.extraTitle.node.active=0<s,e.extraPrize.node.active=0<s,e.name_lab.active=t.startRank<=10,e.name_lab.string=""!=a?a+i:game.Lang.get(6978),this.prizeList.setData(t.getPrizeList()),e.finish.active=!1,e.unfinish.active=!1,0<s){var r=game.CCommonUtil.replaceNum(s,0),o=game.cservRankData.getCKByType(t.activityType,!1),g=t.getExtraPrizeList();if(this.extPrizeList.setData(t.getExtraPrizeList()),this.extPrizeList.x=g.length<3?240-84*g.length>>1:0,10<t.startRank)e.turnCont.active=!1,3==t.activityType?e.extraConditionLabel.string=game.Lang.get(o,r):e.extraConditionLabel.string=game.Lang.get(o,t.startRank,t.endRank,r),this.skin.extraTitle.width=e.extraConditionLabel.width+45,this.skin.extraTitle.x=423-(this.skin.extraTitle.width-250>>1);else{o=game.cservRankData.getCKByType(t.activityType),3==t.activityType?(t.startRank<=3?(e.turnNun.string=t.score,e.turnCont.active=!0):e.turnCont.active=!1,e.extraConditionLabel.string=game.Lang.get(o,r)):(e.turnCont.active=!1,e.extraConditionLabel.string=game.Lang.get(o,t.startRank,r));var u=s<=t.score;e.finish.active=u,e.unfinish.active=!u}}}}),b8e.RC("$$game","$$CServRankItem",e)}(),function(){var e;e=game.ListItem.extends({type:0,ctor:function(){this._super(178),this.setSize(540,94)},setData:function(){var e=this.skin,t=this.data,a=game.openServerData.getCurBtnInfo();if(this.rankId=a.param,this.rankCfg=game.CServRankCfg.getDataById(this.rankId),this.rankCfg&&(this.type=this.rankCfg.activityType),e.rankIcon1.active=1==t.rank,e.rankIcon2.active=2==t.rank,e.rankIcon3.active=3==t.rank,e.rankIcon4.active=3<t.rank,3==this.type)e.conditionLab.string=t.score;else{e.conditionLab.string=game.Lang.get(6979);var i=game.cservRankData.getMyRank(),n=game.cservRankData.getLastRankInfo();i&&i.rank?i.rank!=t.rank&&i.rank+1!=t.rank&&i.rank-1!=t.rank||(e.conditionLab.string=t.score):n&&n.rank==t.rank&&(e.conditionLab.string=t.score)}e.rankLab.string=t.rank,e.nameLab.string=t.name+t.servName}}),b8e.RC("$$game","$$CServRankListItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(179)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.CServRankListItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_RANK_INFO:this.updateRankList(),this.updateMyConditionNum();break;case this.Evts.C2V_UPDATE_CONDITION_NUM:this.updateMyConditionNum()}},updateMyConditionNum:function(){this.rankCfg?this.skin.myConditionLab.string=game.cservRankData.getCondition(this.rankId):this.skin.myConditionLab.string=""},updateRankList:function(){var e=game.cservRankData.getRankList(this.rankId);this.list.setData(e);var t=game.cservRankData.getMyRank();t&&0<t.rank?this.skin.myRankLab.string=t.rank:this.skin.myRankLab.string=game.Lang.get(6980)},onShow:function(){var e=this,t=game.cservRankData;e.rankId=t.getCurRankId(),e.rankCfg=game.CServRankCfg.getDataById(e.rankId),e.rankCfg&&(3==e.rankCfg.activityType?e.skin.myConditionDesc.string=t.getConditionDesc(e.rankCfg.activityType,!1):e.skin.myConditionDesc.string=t.getConditionDesc(e.rankCfg.activityType),e.skin.desc.string=t.getConditionDesc2(e.rankCfg.activityType)),e.updateRankList(),e.updateMyConditionNum()}});b8e.module.registerView(game.ME.CServRankList,e)}(),function(){var e=game.View.extends({type:0,ctor:function(){this._super(180)},init:function(){var e=this,t=e.skin,a=e.list=new game.List;a.itemRender=game.CServRankItem,a.bindEnum=e.moduleEnum,a.layout.spacingY=5,a.addToParent(t.list);var i=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);i.itemRender=game.ShowItemListItem,i.layout.paddingLeft=6,i.layout.spacingX=13,i.layout.paddingTop=5,i.addToParent(t.baseAwardsList);var n=e.prizeList2=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);n.itemRender=game.ShowItemListItem,n.layout.paddingLeft=8,n.layout.spacingX=13,n.layout.paddingTop=5,n.addToParent(t.extraAwardsList),e.roleData=game.BaseRoleData.get(game.RoleType.Hero,1),e.model=game.sceneRoleCreate.createUIRole(e.roleData),e.roleData.setMale(game.mainRoleData.isMale);var s=game.mainRoleData.isMale?1001:1002;e.roleData.heroModel.setBody(game.RoleType.Hero,s),e.model.addToParent(t.model),e.timer=b8e.Timer.add(e,e.updateTime,500)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_CONDITION:this.updateCondition();break;case this.Evts.C2V_UPDATE_RANK:this.updateFirstData()}},onShow:function(){var e=this,t=game.openServerData.getCurBtnInfo();if(t&&t.param){var a=game.cservRankData;e.rankId=t.param,e.rankCfg=game.CServRankCfg.getDataById(e.rankId),e.rankCfg&&(e.type=e.rankCfg.activityType);game.miscData;var i=a.getFirstInfoById(e.rankId);i&&(e.endTime=b8e.TimeUtil.dateParse(i.cfg.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()-3e5,e.timer.reset(),e.timer.start(),e.setFirstAward(i),e.infoList=a.getInfoList(e.rankId),e.list.setData(e.infoList),e.skin.helpBtn.active=3==e.type,e.skin.turnCont.active=3==e.type,e.updateCondition(),e.send(e.Evts.V2C_SHOW_VIEW,e.rankId),e.skin.descLabel.string=a.getDesc(e.rankCfg.activityType))}},onHide:function(){this.stopTime()},setFirstAward:function(e){var t=this.skin,a=this.prizeInfoList=e.getPrizeList();this.prizeList.setData(this.prizeInfoList);var i=this.prizeInfoList2=e.getExtraPrizeList();this.prizeList2.setData(this.prizeInfoList2);var n=a.length,s=i.length;t.baseAwardsList.x=n<3?84*(3-n>>1):0,t.extraAwardsList.x=s<3?84*(3-s>>1):0;var r=e.awardCfg;if(r)if(r.condition){var o=game.CCommonUtil.replaceNum(r.condition,0),g=game.cservRankData.getCKByType(this.type);3==this.type?t.extraConditionLabel.string=game.Lang.get(g,o):t.extraConditionLabel.string=game.Lang.get(g,r.rank,o)}else t.extraConditionLabel.string=game.Lang.get(5302,r.rank)},updateTime:function(){if(!this.endTime)return this.skin.time.string=game.Lang.get(6981),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(6981),void this.stopTime();this.skin.time.string=game.TimeUtil.formatTimeSpace(e)},stopTime:function(){this.timer&&this.timer.stop()},updateCondition:function(){var e=game.cservRankData,t=game.HtmlUtil.getText(game.Color.GREEN,e.getCondition(this.rankId));this.skin.conditionDesc.string=e.getConditionDesc(this.type)+t},updateFirstData:function(){var e=this,t=e.roleData.heroModel;t.clear();var a=e.skin;a.finish.active=!1,a.unfinish.active=!1;var i=game.cservRankData;e.firstRankInfo=i.getFirstRankTypeInfo(e.rankId);var n=e.firstRankInfo;if(!n)return a.firstName.string=game.Lang.get(6978),void(a.unfinish.active=!0);a.firstName.string=e.firstRankInfo.name+e.firstRankInfo.servName,a.turnNum.string=e.firstRankInfo.score;var s=i.getFirstInfoById(e.rankId);if(s){var r=s.awardCfg;if(r.condition){var o=e.firstRankInfo.score>=r.condition;a.finish.active=o,a.unfinish.active=!o}else a.finish.active=!1,a.unfinish.active=!1}var g=n.info;if(g){t.setMale(n.isMale),t.setBody(game.RoleType.Hero,n.isMale?1001:1002),0<g.fashion&&t.setFashion(g.fashion);var u=game.AvatarUtil;u.updateUIModel(e.model,u.ID_2),e.model.transition(game.RoleStateType.ACTION_IDLE)}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CServRank,e)}(),function(){var e=game.Control.extends({init:function(){this.openRankMap=b8e.HashMap.get(),this.openRankTypeMap=b8e.HashMap.get()},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess},Back:{C_UPDATE_AMOUNT:this.updateAmount},MainRole:{C_RESET_DAILY:this.resetDaily},OpenServer:{C2C_INIT_OPENSERVER:this.initOpenServer},JuBaoPen:{C2C_UPDATE_JUBAO_SCORE:this.updateJuBao}},this.handels={CrossRankResp:this.onCrossRankResp,CrossRankMsg:this.onCrossRankDataNotify}},initOpenServer:function(e){if(e&&e.data&&game.moduleOpen.checkOpen(this.moduleEnum)){game.cservRankData.updateCondition(e.data);var t=e.data.crossRank||[];this.updatRanksData(t)}},resetDaily:function(){var n=[];this.openRankMap.forEach(function(e,t){var a=game.CServRankCfg.getDataById(e);if(a){var i=b8e.TimeUtil.dateParse(a.endTime,"yyyy-MM-dd  hh:mm:ss").getTime();game.SysTime.curTime<i&&n.push(t)}},this),this.updatRanksData(n)},onCrossRankDataNotify:function(e){var t=e.readProtobuf(game.pb.CrossRankNotify);0<t.code?game.notice.noticeError(t.code):(game.cservRankData.updateCondition(t),this.updatRanksData(t.crossRank))},onCrossRankResp:function(e){var t=e.readProtobuf(game.pb.CrossRankResponse);0<t.code?game.notice.noticeError(t.code):(game.cservRankData.csrankResp(t),this.send(this.Evts.C2V_UPDATE_RANK))},updateTurnRank:function(e){e.data&&(game.cservRankData.updateTurnplate(e.data),this.send(this.Evts.C2V_UPDATE_CONDITION))},updatRanksData:function(e){var t=this,a=game.CServRankCfg.getDatas();if(a&&0!=a.length){t.openRankTypeMap.clear();for(var i=0;i<a.length;i++){var n=a[i].activityType;t.openRankTypeMap.get(n)||t.openRankTypeMap.set(n,null)}t.openRankMap.clear();for(var s=0;s<e.length;s++){var r=e[s];t.openRankMap.set(r.id,r);var o=game.CServRankCfg.getDataById(r.id);if(o){var g=o.activityType;t.openRankTypeMap.set(g,{id:r.id,isOpen:!0,cfg:o})}}var u=[];game.cservRankData.openTypeList.length=0,t.openRankTypeMap.forEach(function(e,t){var a={openServerType:game.OpenServerType.CROSS_SERVICE_RANK,type:e,isActive:!1,param:0};t&&(a.isActive=!0,a.param=t.id,game.cservRankData.initData(t.cfg)),u.push(a),game.cservRankData.setOpen(a.isActive,e)},t),t.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER_LIST,u),t.dpt(t.Evts.C2C_JUBAO_ENTER)}},updateAmount:function(e){var t=!!e.data;game.moduleOpen.checkOpen(this.moduleEnum)&&game.cservRankData.updatePayCount(t)&&this.send(this.Evts.C2V_UPDATE_CONDITION)},rechargeSuccess:function(e){if(e&&e.data){var t=e.data.id;if(!(t<=0)&&game.moduleOpen.checkOpen(this.moduleEnum)){var a=game.RechargeCfg.getDataById(t);a&&(game.cservRankData.updateRecharge(a.money),this.send(this.Evts.C2V_UPDATE_CONDITION))}}},updateJuBao:function(e){if(e&&e.data){var t=e.data;game.moduleOpen.checkOpen(this.moduleEnum)&&(game.cservRankData.updateJuBaoScore(t),this.send(this.Evts.C2V_UPDATE_CONDITION))}},notify:function(e,t){switch(e){case this.Evts.V2C_SHOW_VIEW:game.cservRankData.setCurId(t),this.sender.CrossRankReq(t)}},btnLookRank:function(){game.module.show(game.ME.CServRankList)},helpBtn:function(){game.RuleView.inst().showView(game.ME.CServRank)}}),t=[game.ME.CServRankList],a=game.Sender.extends({ipc:function(){this.msg={CrossRankReq:this.crossRankReq}},crossRankReq:function(e){var t=game.pb.CrossRankRequest;t.id=e,b8e.net.getBytes().writeProtobuf(t)}});b8e.module.registerControl(game.ME.CServRank,e,game.CServRankEvts,a,t)}(),function(){var e;e=b8e.Enum({NONE:-1,ITEM_GETAWARDS:-1,C2V_UPDATA:-1,RECHARGE_SUCCESS:-1,GET_AWARDS_SUCCESS:-1}),b8e.RC("$$game","$$FestSRechargeEvts",e)}(),function(){var e=game.SingleRechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FESTIVAL_SINGLE_RECHARGE,game.ME.FestSRecharge,game.SAE.FESTIVAL_SINGLERecharge,this.redPoint),this._conData=game.festSRechargeData,this._conType=game.FestivalSubType.FESTIVAL_SINGLE_RECHARGE}});b8e.module.registerControl(game.ME.FestSRecharge,e,game.FestSRechargeEvts)}(),function(){var e=game.SingleRechargeControlModule.extends({init:function(){this._super(),this.regFestival(game.FestivalSubType.FESTIVAL_SINGLE_RECHARGE2,game.ME.FestSRecharge2,game.SAE.FESTIVAL_SINGLE_RECHARGE,this.redPoint),this._conData=game.festSRecharge2Data,this._conType=game.FestivalSubType.FESTIVAL_SINGLE_RECHARGE2}});b8e.module.registerControl(game.ME.FestSRecharge2,e,game.FestSRechargeEvts)}(),function(){var e=game.SingleRechargeDataModule.extends({ctor:function(){this._super(),this._dataType=game.FestivalSubType.FESTIVAL_SINGLE_RECHARGE}});game.festSRechargeData=game.festSRechargeData||new e}(),function(){var e=game.SingleRechargeDataModule.extends({ctor:function(){this._super(),this._dataType=game.FestivalSubType.FESTIVAL_SINGLE_RECHARGE2}});game.festSRecharge2Data=game.festSRecharge2Data||new e}(),function(){var e;e=b8e.Object.extends({id:0,isGetAward:!1,canGet:!1,needMoney:0,name:"",index:0,award:null,setData:function(e){this.id=e.id,this.needMoney=e.conditionValue,this.name=e.name,this.award=e.awards,this.canGet=e.finish},getPrizeList:function(){if(this.prizeList)return this.prizeList;if(this.award&&!(this.award.lenth<1)){for(var e=this.award.length,t=void 0,a=void 0,i=[],n=0;n<e;n++)t=this.award[n],a=game.ItemUtil.createBaseItemInfo(t.id,t.num),i.push(a);return i}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FestSRechargeInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(374),this.setSize(600,177)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.priceList),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingX=15,e.anima1=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anima1.addToParent(e.skin.anim),e.anima1.load(game.ResCfg.getUrl(5019,1061))},setData:function(){var e=this,t=e.skin,a=e.data,i=a.getPrizeList();this.prizeList.setData(i),t.lb_tips.string=game.Lang.get(7021,a.needMoney),t.rechargeBtn.node.active=!a.canGet&&!a.isGetAward,t.getBtn.node.active=a.canGet&&!a.isGetAward,a.isGetAward&&(t.rechargeBtn.node.active=!1,t.getBtn.node.active=!1),t.already_got.node.active=a.isGetAward,e.anima1.play()},getBtn:function(){this.send(game.FestSRechargeEvts.ITEM_GETAWARDS,this.data.id)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),b8e.RC("$$game","$$FestSRechargeItem",e)}(),function(){var e=game.SingleRechargeViewModule.extends({ctor:function(){this._super(375)},init:function(){this._pageData=game.festSRechargeData,this._super()}});b8e.module.registerView(game.ME.FestSRecharge,e)}(),function(){var e=game.SingleRechargeViewModule.extends({ctor:function(){this._super(375)},init:function(){this._pageData=game.festSRecharge2Data,this._super()}});b8e.module.registerView(game.ME.FestSRecharge2,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_SHOW_VIEW:-1,V2C_SELECT_DIFFICULT:-1,C2C_SELECT_DIFFICULT:-1}),b8e.RC("$$game","$$DifficultSelectEvts",e)}(),function(){var e;e=b8e.Enum({None:0,ZHAOQIN:1,BAOZANG:2,WANSHOU:3,ZHENGZHAN:4,ZHULU:5}),b8e.RC("$$game","$$DifficultSelectType",e)}(),function(){var e=b8e.Object.extends({curInstType:0,initList:function(e){var t=[],a=game.InstanceDifficultCfg.getData(e,!0);if(!a||a.length<1)return b8e.error("\u6ca1\u6709\u914d\u7f6e\u8be5\u7c7b\u578b\u7684\u5173\u5361\u96be\u5ea6\u5ba2\u6237\u7aef\u914d\u7f6e,\u5173\u5361\u7c7b\u578binstType:"+e),null;for(var i=void 0,n=void 0,s=a.length,r=0;r<s;r++)i=a[r],(n=new game.DifficultSelectInfo).setData(i),n.curDifficult=this.getCurDifficult(e),n.open?n.lock=this.getCurDiffcultLock(e,i.difficult):n.lock=!0,t.push(n);return this.infoMap.set(e,t),t},getInfoList:function(e){this.infoMap||(this.infoMap=b8e.HashMap.get(),this.initList(e));var t=this.infoMap.get(e);return t=t||this.initList(e)},updateList:function(e){var t=this.getInfoList(e);if(t&&!(t.length<1))for(var a=void 0,i=t.length,n=0;n<i;n++)(a=t[n])&&(a.curDifficult=this.getCurDifficult(e),a.open?a.lock=this.getCurDiffcultLock(e,a.difficult):a.lock=!0)},getCurDifficult:function(e){var t=game.DifficultSelectType;switch(e){case t.ZHAOQIN:return game.zhaoqinData.curDifficulty;case t.BAOZANG:return game.baoZangData.curDifficulty;case t.WANSHOU:return game.huntingData.curDifficulty;case t.ZHENGZHAN:return game.worldWarData.curMode;case t.ZHULU:return game.worldWar2Data.curMode;default:b8e.warn("difficultSelectData\u6ca1\u6709\u8be5\u7c7b\u578b\u7684\u83b7\u53d6\u5f53\u524d\u5173\u5361\u96be\u5ea6\u65b9\u6cd5")}return 0},getCurDiffcultLock:function(e,t){var a=game.DifficultSelectType;switch(e){case a.ZHAOQIN:return game.zhaoqinData.getMaxDifficulty()<t;case a.BAOZANG:return game.baoZangData.getMaxDifficulty()<t;case a.WANSHOU:return game.huntingData.getMaxDifficulty()<t;case a.ZHENGZHAN:return 1!=t&&(t--,!game.worldWarData.canShowNextMode(t));case a.ZHULU:return 1!=t&&(t--,!game.worldWar2Data.canShowNextMode(t));default:b8e.warn("difficultSelectData\u6ca1\u6709\u8be5\u7c7b\u578b\u7684\u83b7\u53d6\u5f53\u524d\u5173\u5361\u96be\u5ea6\u65b9\u6cd5")}return!1}});game.difficultSelectData=game.difficultSelectData||new e}(),function(){var e;e=b8e.Object.extends({id:0,insType:0,difficult:0,curDifficult:0,title:"",lockDesc:"",lock:!1,open:!1,diffTag:"",ctor:function(){this._super()},setData:function(e){this.cfg=e,this.id=e.id,this.open=e.open,this.title=e.diffDesc,this.insType=e.insType,this.diffImg=e.diffImg,this.diffTag=e.diffTag,this.lockDesc=e.lockDesc,this.difficult=e.difficult}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$DifficultSelectInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.obj={instType:0,difficult:0}},notify:function(e,t){var a=game.difficultSelectData;switch(e){case this.Evts.V2C_SELECT_DIFFICULT:this.obj.instType=a.curInstType,this.obj.difficult=t,this.dpt(this.Evts.C2C_SELECT_DIFFICULT,this.obj),game.module.hide(this.moduleEnum);break;case this.Evts.V2C_SHOW_VIEW:a.updateList(a.curInstType)}}});b8e.module.registerControl(game.ME.DifficultSelect,e,game.DifficultSelectEvts)}(),function(){var e;(e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(329),this.setSize(175,360)},setData:function(){var e=this.data,t=this.skin;t.title.string=e.title;var a=e.lock;t.curDifficultBtn.active=e.curDifficult==e.difficult,t.selectBtn.active=e.curDifficult!=e.difficult&&!a,t.lockBtn.active=a,t.lockDesc.active=a,t.lockDesc.string=e.lockDesc,t.lockBtnLab.string=e.open?game.Lang.get(9122):game.Lang.get(9123);var i=e.diffImg;a&&(i=e.diffImg+"_gray");var n=game.ResCfg.getImgUrl(i);t.diffImg.loadTexture(n),n=game.ResCfg.getImgUrl(e.diffTag),t.diffTag.loadTexture(n)},selectBtn:function(){this.send(game.DifficultSelectEvts.V2C_SELECT_DIFFICULT,this.data.difficult)}})).poolCall=!0,b8e.RC("$$game","$$DifficultItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(330)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.DifficultItem,t.addToParent(e.list),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingX=4,t.layout.spacingY=2,t.bindEnum=this.moduleEnum},notify:function(e){e},onShow:function(){var e=game.difficultSelectData.getInfoList(game.difficultSelectData.curInstType);this.list.setData(e),this.send(this.Evts.V2C_SHOW_VIEW)},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+45;this.setPosition(e,t)}});b8e.module.registerView(game.ME.DifficultSelect,e)}(),function(){var e=game.Mystery2ShopPage.extends({ctor:function(){this._super(game.Mystery2ShopType.SHOP_3,game.AmountType.OB)},init:function(){this.skin.view_obBuyBtn.active=!0,this.skin.view_flagBuyBtn.active=!1,this.skin.titleImg.active=!1,this.skin.ocTitle.active=!0,this.skin.flagWarTitle.active=!1,this._super()}});b8e.module.registerView(game.ME.OccupiedShop,e)}(),function(){var e=game.Mystery2ShopPage.extends({ctor:function(){this._super(game.Mystery2ShopType.SHOP_4,game.AmountType.FLAGWAR)},init:function(){this.skin.view_obBuyBtn.active=!1,this.skin.view_flagBuyBtn.active=!0,this.skin.titleImg.active=!1,this.skin.ocTitle.active=!1,this.skin.flagWarTitle.active=!0,this._super()}});b8e.module.registerView(game.ME.FlagWarShop,e)}(),function(){var e;e=b8e.Enum({None:0,C_UPDATE_DATA:-1,C_UPDATE_SCORE:-1,V_TOGGLECHANGE:-1,C_GET_RANK:-1,V_UPDATE_RANK:-1,V_GET_QUERY:-1,V_GET_OCCUPIED:-1,C_LEAVE:-1,C_CHALLENGE:-1,C_CLEAR_CD:-1,C_UPDATE_AMOUNT:-1,C_SHOW_OCCUPIED:-1,V_SHOW_OCCUPIED_SNATCH:-1,C_UPDATA_RANK:-1,C2C_SHOW_BATTLE:-1,C2C_BATTLE_END:-1,C2C_SET_FORMATION:-1}),b8e.RC("$$game","$$OccupiedEvts",e)}(),function(){var e;e=b8e.Object.extends({setData:function(e){if(this.cdTime=game.SysTime.curTime+1e3*e.cd,this.addPer=e.bonus,this.score=e.score,this.myRank=e.rank,this.cdCount=e.cleanupCount,this.lastCollectTime=e.lastCollectTime,e.data&&e.data.length)for(var t=void 0,a=0,i=e.data.length;a<i;a++){var n=e.data[a];(t=this.getOccupiedInfo(n.num,n.cityId))&&t.setData(n)}},getOccupiedName:function(){if(!this.occupiedNames){var e=this._miscCfg.getData("conquerName");e&&(this.occupiedNames=e.value.split("|"))}return this.occupiedNames.length>this.curPage?this.occupiedNames[this.curPage-1]:this.occupiedNames[this.occupiedNames.length-1]},updateOccupier:function(e){var t=this.getOccupiedInfo(e.num,e.cityId);t&&t.setData(e)},getOccupiedInfo:function(e,t){return this.levelMap.get((e-1)*this.numPage+t)},getOccupiedById:function(e){for(var t=void 0,a=0,i=this.levelList.length;a<i;a++)if((t=this.levelList[a]).id==e)return t;return null},leaveOccupied:function(){for(var e=void 0,t=game.mainRoleData.id,a=0,i=this.levelList.length;a<i;a++)if((e=this.levelList[a]).occupier&&e.occupier.roleId==t)return void(e.occupier=null)},getMeCanOccupied:function(){for(var e=void 0,t=game.mainRoleData.id,a=0,i=this.levelList.length;a<i;a++)if((e=this.levelList[a]).occupier&&e.occupier.roleId==t)return!0;return!1},setRankList:function(e,t){var a=void 0;switch(e){case game.OccupiedRankType.GUILD:a=this.guildRanks,this.guildRank=t.rank,this.guildScore=t.score;break;case game.OccupiedRankType.PLAYER:a=this.playerRanks,this.playerRank=t.rank,this.playerScore=t.score}var i=t.data;if(!a||!i)return null;this.clearList(a);for(var n=void 0,s=0,r=i.length;s<r;s++)(n=game.OccupiedRankInfo.get()).type=e,n.setData(i[s]),a.push(n)},canClearCD:function(){if(!this.cdClearMax){var e=this._miscCfg.getData("conquerCDCost");this.cdCostArr=e.value.split("|"),this.cdClearMax=this.cdCostArr.length}return this.cdClearMax>this.cdCount},getCDCost:function(){if(!this.cdCostArr){var e=this._miscCfg.getData("conquerCDCost");this.cdCostArr=e.value.split("|")}if(this.cdCostArr){var t=this.cdCount<this.cdCostArr.length?this.cdCount:this.cdCostArr.length-1;return this.cdCostArr[t]}return 0},addCDTime:function(){if(!this.cdAddTime){var e=this._miscCfg.getData("conquerCDTime");this.cdAddTime=parseInt(e.value)}this.cdTime=game.SysTime.curTime+1e3*this.cdAddTime},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},getOpenTimeArr:function(){if(!this.openTimeArr||this.openTimeArr.length<1){var e=this._miscCfg.getData("conquerOpenTime");if(!e||""==e.value)return!1;this.openTimeArr=e.value.split("-")}return this.openTimeArr},getStartTime:function(){if(0<this.startTime)return this.startTime;var e=this.getOpenTimeArr();if(!e||e.length<1)return 0;var t=e[0];return this.startTime=b8e.TimeUtil.dateParse(t,"hh:mm").getTime(),this.startTime},getEndTime:function(){if(0<this.endTime)return this.endTime;var e=this.getOpenTimeArr();if(!e||e.length<1)return 0;var t=e[e.length-1];return this.endTime=b8e.TimeUtil.dateParse(t,"hh:mm").getTime(),this.endTime},isOpen:function(){var e=this.getOpenTimeArr();if(!e||e.length<1)return!1;var t=game.SysTime.curTime,a=this.getStartTime(),i=this.getEndTime();return a<=t&&t<=i}}),b8e.RC("$$game","$$occupiedModelData",e)}(),function(){var e=game.occupiedModelData.extends({myRank:0,score:0,cdTime:0,addPer:0,cdCount:0,curPage:1,maxPage:8,numPage:10,levelList:null,levelMap:null,guildRanks:null,playerRanks:null,guildRank:0,guildScore:0,playerRank:0,playerScore:0,curInfo:null,occupiedMaxTime:0,lastCollectTime:0,isSnatch:!1,snatchName:"",ctor:function(){this._super(),this.guildRanks=[],this.playerRanks=[],this.levelList=[],this.levelMap=b8e.HashMap.get()},init:function(){if(!this.levelList.length){var e=game.ConquerCfg.getDatas(),t=void 0;if(e&&e.length){for(var a=0;a<this.maxPage;a++)for(var i=0,n=e.length;i<n;i++)(t=game.OccupiedInfo.get()).cfg=e[a],this.levelList.push(t),this.levelMap.set(a*this.numPage+i+1,t);this._miscCfg=game.ConquerMiscCfg;var s=this._miscCfg.getData("conquerTimeLimit");s&&(this.occupiedMaxTime=parseInt(s.value))}}},canEnter:function(){return game.guildData.hasGuild()?!!game.occupiedData.isOpen()||(game.notice.show(7252),!1):(game.notice.show(2621),!1)}});game.occupiedData=game.occupiedData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,cityId:0,page:0,cfg:null,occupier:null,occupiers:null,setData:function(e){this.id=e.id,this.page=e.num,this.cityId=e.cityId,this.occupier=e.occupier},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.cityId=0,this.page=0,this.cfg=null,this.occupier=null,this.occupiers=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,128),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$OccupiedInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",zone:0,score:0,rank:0,type:0,setData:function(e){this.name=e.name,this.zone=e.zone,this.score=e.score,this.rank=e.rank},getPrizeList:function(){var e=this;if(e.prizeList)return e.prizeList;if(e.prizeList=[],e.type==game.OccupiedRankType.GUILD?e.cfg=game.ConquerGuildRankCfg.getData(e.rank):e.cfg=game.ConquerPlayerRankCfg.getData(e.rank),!e.cfg)return null;var t=e.cfg.items;if(t&&0<t.length)for(var a,i,n=t.length,s=0;s<n;s++)a=t[s],(i=new game.PrizeInfo).setData(a.Id,a.Num,game.IconLayoutEnum.SHOW_NUM),e.prizeList.push(i);return e.prizeList},recycle:function(){this.reset(),this._super()},reset:function(){this.name="",this.zone=0,this.score=0,this.rank=0,this.type=0,this.prizeList&&(this.prizeList.length=0,this.prizeList=null)}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$OccupiedRankInfo",t)}(),function(){var e;e=b8e.Enum({None:0,PLAYER:1,GUILD:2}),b8e.RC("$$game","$$OccupiedRankType",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(756)},init:function(){this.hpWidth=this.skin.hp.width;var e=this._headImg=b8e.Sprite.get();e.addToParent(this.skin.head),e.setAnchor(.5,.5),this.timer=b8e.Timer.add(this,this.updateTime,500)},notify:function(e){switch(e){case this.Evts.C_UPDATE_DATA:this.updateView()}},updateView:function(){var e=game.occupiedData.curInfo;if(e&&e.occupier){var t=e.occupier.roleId==game.mainRoleData.roleId,a=this.skin;a.outBtn.active=t,a.abortBtn.active=!t,a.snatchBtn.active=!t,a.name.string=e.occupier.name+".S"+e.occupier.zone,a.level.string=e.occupier.level,a.power.string=e.occupier.power;var i=e.occupier.isMale;if(null!=i&&null!=i){var n=game.ResCfg.getHead(i);this._headImg.loadTexture(n)}else this._headImg.unloadTexture();e.occupier.maxHp?a.hp.width=this.hpWidth*e.occupier.hp/e.occupier.maxHp:a.hp.width=this.hpWidth,this.timer.reset(),this.timer.start(),this.updateTime()}},updateTime:function(){var e=game.occupiedData.curInfo;if(e&&e.occupier){var t=game.SysTime.curTime-1e3*e.occupier.startTime;this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(t)}},onShow:function(){var e=game.occupiedData.curInfo;this.send(this.Evts.V_GET_QUERY,e.id),this.updateView()},onHide:function(){this.stopTime()},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)},stopTime:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.OccupiedBattle,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(757)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.OccupiedRankItem,e.layout.spacingY=5,e.addToParent(this.skin.listNode),this.skin.guildNode.active=!0,this.skin.playerNode.active=!1},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=game.occupiedData.guildRanks;this.rankList.setData(t),e.guildRankLab.string=game.occupiedData.guildRank,e.guildScoreLab.string=game.occupiedData.guildScore},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OccupiedGuildRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(757)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.OccupiedRankItem,e.layout.spacingY=5,e.addToParent(this.skin.listNode),this.skin.guildNode.active=!1,this.skin.playerNode.active=!0},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=game.occupiedData.playerRanks;this.rankList.setData(t),e.playerRankLab.string=game.occupiedData.playerRank,e.playerScoreLab.string=game.occupiedData.playerScore},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OccupiedPlayerRank,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(758),this.setSize(600,94)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=10,e.layout.spacingX=15,e.addToParent(this.skin.prizeList)},setData:function(){var e=this.skin,t=this.data;this.prizeInfoList=this.data.getPrizeList(),this.prizeList.setData(this.prizeInfoList),e.first_root.active=1==t.rank,e.second_root.active=2==t.rank,e.third_root.active=3==t.rank,e.other_root.active=3<t.rank||0==t.rank,e.rankLab.string=t.rank;var a=game.Color.WHITE;switch(t.rank){case 1:a=game.Color.RED;break;case 2:a=game.Color.BLUE;break;case 3:a=game.Color.GREEN;break;default:a=game.Color.BLACK}e.name.string=game.HtmlUtil.getText(a,t.name+".S"+t.zone),e.score.string=game.Lang.get(9497,t.score)}}),b8e.RC("$$game","$$OccupiedRankItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(759),this.toggles={toggle_btn_1:game.ME.OccupiedGuildRank,toggle_btn_2:game.ME.OccupiedPlayerRank}},init:function(){},onShow:function(){this.toggleSelect(0)},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},onHide:function(){},toggleSelect:function(e){if(this._super(e))switch(e){case 0:this.send(this.Evts.C_GET_RANK,game.OccupiedRankType.GUILD);break;case 1:this.send(this.Evts.C_GET_RANK,game.OccupiedRankType.PLAYER)}else;}});b8e.module.registerView(game.ME.OccupiedRank,e)}(),function(){var e;e=game.Widget.extends({_showModel:!1,icon:null,_init:!1,ctor:function(){this._super(760)},init:function(){this._init=!0,this.timer=b8e.Timer.add(this,this.updateTime,500),this.info&&this.updateView()},onShow:function(){},show:function(){this.setVisible(!0),this._super()},hide:function(){this.setVisible(!1),this._super()},onHide:function(){this.stopTime()},setData:function(e){this.info=e,this.updateView()},updateTime:function(){if(this.info&&this.info.occupier){var e=game.SysTime.curTime/1e3-game.occupiedData.lastCollectTime;e=this.info.cfg.interval<=e?this.info.cfg.interval:e,e=parseInt(e);var t=this.skin;t.timeLab.string=e+"S",t.proBar.width=140*e/this.info.cfg.interval}},updateView:function(){var e=this;if(e._init&&e.info&&e.info.occupier){var t=e.info.occupier,a=e.skin;e.icon||(e.icon=b8e.Sprite.get(),e.icon.setAnchor(.5,.5),e.icon.addToParent(a.icon),e.icon.setSize(75,75)),e.icon&&e.icon.loadTexture(game.ResCfg.getHead(t.isMale)),a.nameLab.string=t.name+".S"+t.zone,a.guildLab.string=t.guildName+".S"+t.zone,t.roleId==game.mainRoleData.roleId?(a.guildLab.active=!1,a.proNode.active=!0,e.timer.reset(),e.timer.start(),e.updateTime()):(a.guildLab.active=!0,a.proNode.active=!1,e.stopTime())}},stopTime:function(){this.timer&&this.timer.stop()}}),b8e.RC("$$game","$$OccupiedRoleItem",e)}(),function(){var e=game.View.extends({itemList:null,ctor:function(){this._super(761)},init:function(){var e,t=this.skin;this.itemList=[];for(var a=0;a<game.occupiedData.numPage;a++){var i=this.getComponent("item"+(a+1));i&&((e=new game.OccupiedRoleItem).hide(),e.x=i.x,e.y=i.y,t.mapNode.addChild(e),this.itemList.push(e))}this.timer=b8e.Timer.add(this,this.updateTime,500);var n=game.amount.getCfgByType(game.AmountType.OB);if(n){var s=game.GridUtil.createViewClickIcon();s.addToParent(t.icon),s.setItemId(n.id)}},notify:function(e){switch(e){case this.Evts.C_UPDATE_DATA:this.updateView();break;case this.Evts.C_UPDATE_AMOUNT:this.updateAmount()}},updateTime:function(){var e=game.occupiedData.cdTime-game.SysTime.curTime,t=this.skin;if((e=parseInt(e/1e3))<=0)return this.stopTime(),void(t.cdLab.string=game.Lang.get(9387));t.cdLab.string=game.Lang.get(9501,e)},updateView:function(){var e,t,a=this.skin,i=game.occupiedData;a.rankLab.string=i.myRank,a.scoreLab.string=i.score,a.addLab.string=i.addPer+"%",a.pageLab.string=i.curPage+"/"+i.maxPage,a.nameLab.string=i.getOccupiedName();for(var n=0;n<i.numPage;n++)e=this.itemList[n],(t=i.getOccupiedInfo(i.curPage,n+1))&&t.occupier?(e.show(),e.setData(t)):e.hide();var s=game.SysTime.curTime;i.cdTime>s?(this.timer.reset(),this.timer.start(),this.updateTime()):(a.cdLab.string=game.Lang.get(9387),this.stopTime())},updateAmount:function(){this.skin.coinLab.string=game.amount.get(game.AmountType.OB)},onShow:function(){this.updateView(),this.updateAmount(),this.send(this.Evts.V_GET_OCCUPIED),this.send(this.Evts.V_SHOW_OCCUPIED_SNATCH)},onHide:function(){if(this.stopTime(),this.itemList&&this.itemList.length)for(var e=0,t=this.itemList.length;e<t;e++)this.itemList[e].hide()},onStageResize:function(){this.setPosition(0,0)},stopTime:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.Occupied,e)}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:7234,okcb:this.onClickGameAlert,cancelCloseCb:!1,thisArg:this},this._alertOptions2={lang:7236,okcb:this.onClickLeave,cancelCloseCb:!1,thisArg:this}},ipc:function(){this.evts={Occupied:{C_CHALLENGE:this.challengeHandler}},this.handels={QueryOccupierResp:this.queryOccupierResp,ConquerChallengeResp:this.conquerChallengeResp,ConquerLeaveResp:this.conquerLeaveResp,ConquerCleanupResp:this.conquerCleanupResp}},challengeHandler:function(e){var t=e.data;t&&this.challenge(t)},conquerCleanupResp:function(e){var t=e.readProtobuf(game.pb.ConquerCleanupResponse);0<t.code?game.notice.noticeError(t.code):(game.occupiedData.cdTime=0,this.dpt(this.Evts.C_CLEAR_CD))},conquerLeaveResp:function(e){var t=e.readProtobuf(game.pb.ConquerLeaveResponse);0<t.code?game.notice.noticeError(t.code):(game.occupiedData.leaveOccupied(),game.module.hide(game.ME.OccupiedBattle),game.notice.show(7244),this.dpt(this.Evts.C_LEAVE))},conquerChallengeResp:function(e){var t=e.readProtobuf(game.pb.ConquerChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a={type:game.InstanceType.OCCUPIED,isWin:t.battlelog.win};game.playBack.play(t.battlelog,a),t.data&&game.occupiedData.updateOccupier(t.data),game.occupiedData.addCDTime(),game.module.hide(game.ME.OccupiedBattle)}},queryOccupierResp:function(e){var t=e.readProtobuf(game.pb.QueryOccupierResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.occupiedData.getOccupiedById(t.id);a&&(a.occupier=t.occupier),this.send(this.Evts.C_UPDATE_DATA)}},challenge:function(e){if(game.occupiedData.canEnter()){var t=game.occupiedData.cdTime;if(game.occupiedData.getMeCanOccupied())game.alert.showTwo(this._alertOptions2);else if(t>game.SysTime.curTime){var a=game.occupiedData.getCDCost();this._alertOptions.langArgs=a,game.alert.showTwo(this._alertOptions)}else{if(game.playBack.isInstanceFighting()||game.sceneData.isGuildMap())return;this.dpt(this.Evts.C2C_SET_FORMATION,[game.ME.Occupied,e.id,this.sender.ConquerChallengeReq,[e.id],this]),game.module.hide(this.moduleEnum)}}},onClickLeave:function(){game.occupiedData.canEnter()&&this.sender.ConquerLeaveReq()},onClickGameAlert:function(){game.occupiedData.canEnter()&&this.sender.ConquerCleanupReq()},snatchBtn:function(){game.occupiedData.curInfo&&this.challenge(game.occupiedData.curInfo)},abortBtn:function(){game.module.hide(game.ME.OccupiedBattle)},outBtn:function(){game.occupiedData.canEnter()&&this.sender.ConquerLeaveReq()},notify:function(e,t){switch(e){case this.Evts.V_GET_QUERY:this.sender.QueryOccupierReq(t)}}}),t=game.Sender.extends({ipc:function(){this.msg={QueryOccupierReq:this.queryOccupierReq,ConquerChallengeReq:this.conquerChallengeReq,ConquerLeaveReq:null,ConquerCleanupReq:null}},queryOccupierReq:function(e){var t=game.pb.QueryOccupierRequest;t.id=e,this.write(t)},conquerChallengeReq:function(e){var t=game.pb.ConquerChallengeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.OccupiedBattle,e,game.OccupiedEvts,t)}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:7235,okcb:this.onClickGameAlert,cancelCloseCb:!1,thisArg:this},this._alertOptions2={lang:7254,okcb:this.onClickSnatch,cancelCloseCb:!1,thisArg:this}},ipc:function(){var e=this;e.evts={OccupiedBattle:{C_LEAVE:e.leaveHandler,C_CLEAR_CD:e.clearCDHandler},MainRole:{C_RESET_DAILY:e.resetDaily},Back:{C_UPDATE_AMOUNT:e.updateAmount},MainCenter:{C_SHOW_OCCUPIED_SNATCH:e.showOccupied}},e.handels={ConquerCollectMsg:e.conquerCollectMsg,ConquerMsg:e.conquerMsg,ConquerDataResp:e.conquerDataResp}},triggerOpen:function(e){e==this.moduleEnum&&(game.occupiedData.init(),this.sender.ConquerDataReq())},showOccupied:function(){this._alertOptions2.langArgs=game.occupiedData.snatchName,game.alert.show(this._alertOptions2),game.occupiedData.isSnatch=!1,this.dpt(this.Evts.C_SHOW_OCCUPIED)},onClickSnatch:function(){game.module.showToggle(game.ME.ChallengeCbp,1)},updateAmount:function(){this.send(this.Evts.C_UPDATE_AMOUNT)},resetDaily:function(){game.moduleOpen.checkOpen(game.ME.Occupied)&&this.sender.ConquerDataReq()},notify:function(e){switch(e){case this.Evts.V_GET_OCCUPIED:this.sender.ConquerDataReq();break;case this.Evts.V_SHOW_OCCUPIED_SNATCH:game.occupiedData.isSnatch&&this.showOccupied()}},clearCDHandler:function(){this.send(this.Evts.C_UPDATE_DATA)},leaveHandler:function(){this.send(this.Evts.C_UPDATE_DATA)},conquerDataResp:function(e){var t=e.readProtobuf(game.pb.ConquerDataResponse);0<t.code?game.notice.noticeError(t.code):(game.occupiedData.setData(t),this.send(this.Evts.C_UPDATE_DATA))},conquerCollectMsg:function(e){var t=e.readProtobuf(game.pb.ConquerCollectNotify);0<t.code?game.notice.noticeError(t.code):(game.occupiedData.score+=t.score,game.occupiedData.lastCollectTime=game.SysTime.curTime/1e3,this.send(this.Evts.C_UPDATE_DATA))},conquerMsg:function(e){var t=e.readProtobuf(game.pb.ConquerNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.occupiedData,i=a.getOccupiedInfo(t.data.num,t.data.cityId),n=game.mainRoleData.roleId;i&&t.data.occupier&&i.occupier&&i.occupier.roleId==n&&(a.isSnatch=!0,a.snatchName=t.data.occupier.name,b8e.module.isShowView(game.ME.Occupied)?this.showOccupied():this.dpt(this.Evts.C_SHOW_OCCUPIED)),game.occupiedData.updateOccupier(t.data),this.send(this.Evts.C_UPDATE_DATA)}},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.RESOURCE_SHOP)},rankBtn:function(){game.module.show(game.ME.OccupiedRank)},leftBtn:function(){1<game.occupiedData.curPage&&(game.occupiedData.curPage--,this.send(this.Evts.C_UPDATE_DATA))},rightBtn:function(){game.occupiedData.curPage<game.occupiedData.maxPage&&(game.occupiedData.curPage++,this.send(this.Evts.C_UPDATE_DATA))},clickItem:function(e){var t=game.occupiedData.getOccupiedInfo(game.occupiedData.curPage,e);(game.occupiedData.curInfo=t).occupier?game.module.show(game.ME.OccupiedBattle):(this._alertOptions.args=t,game.alert.show(this._alertOptions))},onClickGameAlert:function(e){this.dpt(this.Evts.C_CHALLENGE,e)},item1:function(){this.clickItem(1)},item2:function(){this.clickItem(2)},item3:function(){this.clickItem(3)},item4:function(){this.clickItem(4)},item5:function(){this.clickItem(5)},item6:function(){this.clickItem(6)},item7:function(){this.clickItem(7)},item8:function(){this.clickItem(8)},item9:function(){this.clickItem(9)},item10:function(){this.clickItem(10)}}),t=game.Sender.extends({ipc:function(){this.msg={ConquerDataReq:null,ConquerLeaveReq:null}}});b8e.module.registerControl(game.ME.Occupied,e,game.OccupiedEvts,t)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={},this.handels={ConquerRankResp:this.conquerRankResp}},conquerRankResp:function(e){var t=e.readProtobuf(game.pb.ConquerRankResponse);0<t.code?game.notice.noticeError(t.code):(game.occupiedData.setRankList(t.type,t),this.send(this.Evts.V_UPDATE_RANK))},notify:function(e,t){switch(e){case this.Evts.C_GET_RANK:this.sender.ConquerRankReq(t)}},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={ConquerRankReq:this.conquerRankReq}},conquerRankReq:function(e){var t=game.pb.ConquerRankRequest;t.type=e,this.write(t)}}),a=[game.ME.OccupiedGuildRank,game.ME.OccupiedPlayerRank];b8e.module.registerControl(game.ME.OccupiedRank,e,game.OccupiedEvts,t,a)}(),function(){var e;e=b8e.Enum({None:0,V2C_BUYGIFT:-1,C2V_CHANGEBTN:-1,C2V_UPDATE_DATA:-1,C2C_RECHARGE:-1}),b8e.RC("$$game","$$GoodGiftRMBEvts",e)}(),function(){var e=game.Control.extends({lastBuyData:0,isFirst:!0,init:function(){},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.initNetData,C_RECHARGE_SUCCESS:this.onRechargeSuccess},GoodGift:{C2C_CHANGEBTN:this.updateData}},this.handels={}},notify:function(e,t){switch(e){case game.GoodGiftRMBEvts.V2C_BUYGIFT:this.buyGift(t)}},initNetData:function(){this.isFirst&&(game.goodGiftRMBData.intData(),this.isFirst=!1),game.goodGiftRMBData.synData()},onRechargeSuccess:function(e){if(e&&e.data){var t=e.data.id;this.lastBuyData.rechargeID==t&&(game.goodGiftRMBData.setRechargedList(this.lastBuyData.id),this.send(game.GoodGiftRMBEvts.C2V_UPDATE_DATA))}},buyGift:function(e){-1<game.goodGiftRMBData.rechargedList.indexOf(e.id)?game.notice.show(game.Lang.get(9413)):(this.lastBuyData=e,this.dpt(this.Evts.C2C_RECHARGE,e.rechargeID))},updateData:function(){var e=game.goodGiftData.lastBtnId;e<6||(game.goodGiftRMBData.changeDataByBtn(e),this.send(game.GoodGiftRMBEvts.C2V_CHANGEBTN))}}),t=game.Sender.extends({ipc:function(){this.msg={TimeLimitPrizeBuyReq:this.timeLimitPrizeBuyReq}},timeLimitPrizeBuyReq:function(e){var t=game.pb.TimeLimitPrizeBuyRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.GoodGiftRMB,e,game.GoodGiftRMBEvts,t)}(),function(){var e=b8e.Object.extends({lastBtnId:0,bg:"",banner:"",btnMap:null,rechargedList:null,allrechargedMap:null,curItemList:null,activeMap:null,allBtnsList:null,endTime:0,intData:function(){this.rechargedList=[],this.curItemList=[],this.allBtnsList=[],this.activeMap=b8e.HashMap.get();var e=game.GoodGiftRMBCfg.getDatas();if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)a=(t=e[n]).activeId,this.checkOpen(t.group,a[0])&&this.activeMap.set(t.btnID,t)},synData:function(){this.rechargedList=game.rechargeData.timeLimitPrize},changeDataByBtn:function(e){this.curItemList=[];var t=this.rechargedList,a=this.activeMap.get(e);if(a){var i=a.activeId;if(i&&!(i.length<1)){for(var n=void 0,s=void 0,r=0;r<i.length;r++)!(n=game.TimeLimitPrizeCfg.getDataByIdAcid(i[r],a.group))||n.length<1||((s=new game.GoodGiftRMBInfo).setData(n),s.idx=r,s.isBuy=-1!=t.indexOf(s.id),this.curItemList.push(s));var o=game.TimeLimitPrizeCfg.getDataByIdAcid(i[0],a.group);o&&(this.endTime=o.serverEnd);var g=game.GoodGiftBtnCfg.getData(e);g&&(this.banner=g.banner)}}},getCurEndTime:function(){return game.miscData.openServerTime+(this.endTime-1)*b8e.TimeUtil.DAY_MICRO_SECONDS},isOpen:function(e){if(!game.moduleOpen.checkOpen(game.ME.GoodGiftRMB))return!1;var t=this.activeMap;if(!t)return!1;var a=t.get(e);if(!a||a.length<1)return!1;var i=a.activeId;if(!i||!i.length)return!1;var n=game.TimeLimitPrizeCfg.getDataByIdAcid(i[0],a.group);if(!n||n.length<1)return!1;var s=game.miscData.openServerDay;return n.serverStart<=s&&n.serverEnd>s},setRechargedList:function(e){-1==this.rechargedList.indexOf(e)&&this.rechargedList.push(e)},checkOpen:function(e,t){var a=game.TimeLimitPrizeCfg.getDataByIdAcid(t,e);if(!a||a.length<1)return b8e.warn(" \u68c0\u67e5\u7ec4\u548cid\u662f\u5426 \u9519\u8bef -- group:"+e+"   id:"+t),!1;var i=game.miscData.openServerDay;return a.serverStart<=i&&a.serverEnd>i}});game.goodGiftRMBData=game.goodGiftRMBData||new e}(),function(){var e;e=b8e.Object.extends({select:!1,alert:!1,id:0,idx:0,curCount:0,isBuy:!1,setData:function(e){this.id=e.id,this.name=e.titleName,this.rechargeID=e.rechargeId,this.award=e.award,this.count=e.buyCount},getPrizeList:function(){if(this.award&&!(this.award.lenth<1)){for(var e=this.award.length,t=void 0,a=void 0,i=[],n=0;n<e;n++)t=this.award[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),i.push(a);return i}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GoodGiftRMBInfo",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(495)},init:function(){var e=this.banner=b8e.Sprite.get();e.setAnchor(.5,.5),e.addToParent(this.skin.banner);var t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.GoodGiftRMBItem,t.layout.spacingY=5,t.bindEnum=this.moduleEnum,t.addToParent(this.skin.list),this.timer=b8e.Timer.add(this,this.updateTime,500)},notify:function(e){switch(e){case game.GoodGiftRMBEvts.C2V_CHANGEBTN:this.updateList(),this.changeTime(),this.changeBanner();break;case game.GoodGiftRMBEvts.C2V_UPDATE_DATA:this.updateList(),this.changeTime()}},onShow:function(){this.updateList(),this.changeTime(),this.changeBanner()},updateList:function(){game.goodGiftRMBData.changeDataByBtn(game.goodGiftData.lastBtnId);var e=game.goodGiftRMBData.curItemList;!e||e.length<1||this.list.setData(e)},changeBanner:function(){var e=game.goodGiftRMBData.banner;if(e||1<e.length){var t=game.ResCfg.getImgUrl(e,!0);this.banner.loadTexture(t)}},changeTime:function(){this.endTime=game.goodGiftRMBData.getCurEndTime(),this.timer.reset(),this.timer.start()},updateTime:function(){if(!this.endTime||this.endTime<=0)return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime();this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e)},stopTime:function(){this.timer&&this.timer.stop()},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GoodGiftRMB,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(494),this.setSize(600,176)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=6,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=15,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.priceList);var t=this.anima1=b8e.Animator.get(game.AnimType.UI_EFFECT,1);t.addToParent(this.skin.anim),t.load(game.ResCfg.getUrl(5019,1061))},setData:function(){var e=this.data,t=this.skin,a=e.rechargeID,i=game.RechargeCfg.getDataById(a),n=e.getPrizeList();this.list.setData(n),t.lab_0.string=game.Lang.get(7228,i.money),t.lb_tips.string=e.name,t.rechargeBtn.active=!e.isBuy,t.isGot.active=e.isBuy,this.anima1.play()},rechargeBtn:function(){this.send(game.GoodGiftRMBEvts.V2C_BUYGIFT,this.data)}}),b8e.RC("$$game","$$GoodGiftRMBItem",e)}(),function(){var e;e=b8e.GameConfig.extends({obj1:null,obj2:null,rechargeList:null,ctor:function(){this._super()},onInited:function(){this.obj1={rechargeId:0},this.obj2={conditionType:0}},getDataByType:function(e){return this.obj2.conditionType=e,this.getData(this.obj2,!0,!1)},getDataById:function(e){return this.obj1.rechargeId=e,this.getData(this.obj1)}}),b8e.RC("$$game","$$CultureGiftCfg",e)}(),function(){var e;e=b8e.Enum({None:0,BTN_BUYGIFTS:-1,C2V_UPDATE_DATA:-1,C2C_RECHARGE:-1,V2C_ALERT_VIEW:-1}),b8e.RC("$$game","$$CultureGiftEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,MONEY:1,SALE:2,TIMELIMITPRIZE:3,RECHARGE:4,CARDS:5,GROW_ACTRIVE:6,GROW_COUNT:7,ROLE_EQUIP:8,MAX:-1}),b8e.RC("$$game","$$CultureGiftType",e)}(),function(){var e=game.Control.extends({isFisrt:!0,count:0,msgCount:0,isSyn:!1,isReset:!1,init:function(){game.cultureGiftData.init(),this.spotAlert=game.spotAlert.set(game.SAE.CULTURE_GIFT,game.SAE.OPEN_SERVER_ALERT)},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.synInit,C_RECHARGE_SUCCESS:this.onRechargeSuccess},OpenServer:{C2C_INIT_OPENSERVER:this.initOpenServer},MainRole:{C_RESET_DAILY:this.resetDaily},RoleEquip:{V_CHANGE_EQUIP:this.updateEquip}}},notify:function(e,t){switch(e){case game.CultureGiftEvts.BTN_BUYGIFTS:this.buyGift(t)}},synInit:function(){},synData:function(){++this.msgCount,(this.isReset||this.count<=this.msgCount&&!this.isSyn)&&(this.isSyn=!0,this.isReset=!1,game.cultureGiftData.synModelData(),game.cultureGiftData.initListItem(),this.initOpenServer())},initOpenServer:function(){var e=game.cultureGiftData.isOpen()||game.cultureGiftData.isGoto();this.obj||(this.obj={openServerType:game.OpenServerType.CULTRUE_GIFT,isActive:!0,sae:game.SAE.CULTURE_GIFT}),this.obj.isActive=e,this.dpt(this.Evts.C2C_REFRESH_BTNS),this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,this.obj)},onRechargeSuccess:function(e){if(e&&e.data){var t=e.data.id,a=game.RechargeCfg.getDataById(t);!a||a.length<1||(game.cultureGiftData.setCanPayList(t),game.cultureGiftData.isGoto()&&game.module.show(game.ME.CultureGiftAlert),game.cultureGiftData.setGotList(t),this.updateView())}},buyGift:function(e){var t=game.cultureGiftData.gotPrizeList;-1<(t=t||(game.cultureGiftData.gotPrizeList=[])).indexOf(e)?game.notice.show(7255):this.dpt(this.Evts.C2C_RECHARGE,e)},resetDaily:function(){this.isReset=!0,game.cultureGiftData.initCfgData(),this.synData()},isAlert:function(){this.spotAlert.alert=this.isFisrt&&game.cultureGiftData.isAlert(),this.isFisrt=!1},gotoActiveBtn:function(){this.obj||(this.obj={openServerType:game.OpenServerType.CULTRUE_GIFT}),b8e.evt.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,this.obj),game.module.hide(game.ME.CultureGiftAlert)},pet:function(e){this.setActiveGrow(e)},setActiveGrow:function(e){if(e&&e.data){var t=e.data;if(0!=t.me&&0!=t.id){var a=t.me,i=t.id,n=game.cultureGiftData,s=n.isActiveGrow(a,i),r=n.getGrowData(a,2);n.avtiveGrow(a,i),n.growSetList(a,r),(n.countEnough(a,r)||s)&&n.isGoto()&&(game.module.show(game.ME.CultureGiftAlert),this.updateView())}}},updateEquip:function(){for(var e=game.cultureGiftData,t=e.activeList,a=void 0,i=t.length,n=void 0,s=!1,r=game.miscData.openServerDay,o=i-1;-1<o;o--)if((a=t[o]).conditionType==game.CultureGiftType.ROLE_EQUIP&&a.serverStart<=r&&r<a.serverEnd){if(!(n=a.conditionValue)||!n.length)continue;if(s=e.roleEquipIsEnough(n[0],n[1])){game.cultureGiftData.roelEquipSetList(a.rechargeId);break}}s&&e.isGoto()&&(game.module.show(game.ME.CultureGiftAlert),this.updateView())},updateView:function(){this.initOpenServer(),game.cultureGiftData.initListItem(),this.send(game.CultureGiftEvts.C2V_UPDATE_DATA)}}),t=[game.ME.CultureGiftAlert];b8e.module.registerControl(game.ME.CultureGift,e,game.CultureGiftEvts,null,t)}(),function(){var e=b8e.Object.extends({key:null,rechargeGold:0,canPayList:null,itemList:null,gotPrizeList:null,cValueMap:null,count:0,oldLen:0,oldLast:0,init:function(){this.itemList=[],this.cValueMap=b8e.HashMap.get(),this.activeList=[],this.canPayList=[],this.gotPrizeList=[]},initCfgData:function(){var e=game.CultureGiftCfg.getDatas();if(e){this.activeList=[],this.activeList.length=0;for(var t=e.length,a=void 0,i=game.miscData.openServerDay,n=0;n<t;n++)(a=e[n]).serverStart<=i&&i<a.serverEnd&&this.activeList.push(a)}else b8e.warn("\u6ca1\u6709\u914d\u7f6e\u6570\u636e -- \u57f9\u517b\u597d\u793c")},synModelData:function(){var e=this;e.gotPrizeList=game.rechargeData.assetPrize;for(var t=game.rechargeData.timeLimitPrize,a=game.rechargeData.saleRecharges,i=game.rechargeData.rechargeMoney,n=game.rechargeData.dailySalePrizeBuy,s=game.rechargeData.growthGroups,r=game.CultureGiftType,o=void 0,g=void 0,u=void 0,l=[],c=e.activeList,h=c.length,m=0,d=0,f=0,p=0,v=0,E=0,T=0,C=0,I=0;I<h;I++)if(u=(g=c[I]).conditionValue){switch(g.conditionType){case r.MONEY:if(!(E=u[0])){b8e.warn("\u57f9\u517b\u597d\u793c\u6ca1\u6709\u914d\u7f6e\u7d2f\u5145\u91d1\u989d ",r.MONEY);continue}e.cValueMap.set(g.rechargeId,g),E<=i&&e.addList(g);break;case r.GROW_ACTRIVE:case r.GROW_COUNT:m=u[E=0],d=u[1],f=e.getGrowData(m,2),T=g.rechargeId,C=p=v=0,e.cValueMap.set(T,g);break;case r.ROLE_EQUIP:p=u[0],v=u[1],T=g.rechargeId,d=m=C=f=E=0,e.cValueMap.set(T,g);break;default:E=0,o=u.length;for(var S=d=m=C=p=v=0;S<o;S++){if(T=u[S],g.conditionType==r.TIMELIMITPRIZE){var _=game.TimeLimitPrizeCfg.getDataByIdAcid(T,g.group);if(!_||_.length<1)continue;-1<t.indexOf(T)&&l.push(_.rechargeId),T=_.rechargeId}else g.conditionType==r.CARDS&&(C=T);e.cValueMap.set(T,g)}}(-1<a.indexOf(T)||-1<l.indexOf(T)||-1<n.indexOf(T)||-1<s.indexOf(T)||-1<e.gotPrizeList.indexOf(T)||e.isActiveCard(C)||e.isActiveGrow(m,d)||e.countEnough(m,f)||e.roleEquipIsEnough(p,v))&&e.addList(g)}else b8e.warn("\u57f9\u517b\u597d\u793c \u6761\u4ef6",g.rechargeId)},addList:function(e){if(e){var t=this.canPayList,a=(t=t||[]).length;this.oldLast=t[a-1];var i=game.miscData.openServerDay;e.serverStart<=i&&i<e.serverEnd&&-1==t.indexOf(e.rechargeId)&&this.canPayList.push(e.rechargeId)}},setGotList:function(e){this.gotPrizeList||(this.gotPrizeList=[]),this.gotPrizeList.push(e)},initListItem:function(){var e=this,t=e.canPayList;if(e.itemList=[],t&&!(t.length<1)){e.gotPrizeList=[],e.gotPrizeList=game.rechargeData.assetPrize,e.gotPrizeList||(e.gotPrizeList=[]);for(var a=t.length,i=void 0,n=void 0,s=void 0,r=0;r<a;r++)i=t[r],(s=game.CultureGiftCfg.getDataById(i))&&((n=new game.CultureGiftInfo).setData(s),!e.gotPrizeList||!e.gotPrizeList.length<0?n.isBuy=!1:n.isBuy=-1<e.gotPrizeList.indexOf(i),e.itemList.push(n));e.itemList.sort(e.onSort)}},onSort:function(e){return e.isBuy?1:-1},setCanPayList:function(e){var t=game.rechargeData.rechargeMoney;this.oldLen=this.canPayList.length;var a=game.CultureGiftCfg.getDataByType(game.CultureGiftType.MONEY),i=void 0,n=void 0;if(a){n=a.length;for(var s=0;s<n;s++)(i=a[s]).conditionValue[0]<t&&this.addList(i)}var r=this.cValueMap.get(e);r&&this.addList(r)},isGoto:function(){var e=this.canPayList;return!(!e||!e.length)&&this.oldLen<e.length},isActiveCard:function(e){if(!e)return!1;var t=game.CardRechargeCfg.getDataById(e);if(!t)return!1;var a=game.rechargeData.getCardInfoByType(t.cardType);return!!a&&(t.cardType!=game.CardType.MONTH||game.SysTime.curTime<a.expireTime)},getItemList:function(){return this.itemList},getGiftName:function(){var e=this.canPayList;if(e&&!(e.length<1)){var t=e[e.length-1],a=game.CultureGiftCfg.getDataById(t);return!a||a.length<1?"":a.text}},isOpen:function(){return 0<this.itemList.length},isAlert:function(){return 0<this.count},isActiveGrow:function(e,t){if(!e||!t)return!1;if(!game.moduleOpen.checkOpen(e))return!1;var a=this.getGrowData(e,1);if(!a)return!1;var i=a.get(t);return!!i&&i.active},countEnough:function(e,t){if(!e||!t)return!1;var a=game.CultureGiftCfg.getDataByType(game.CultureGiftType.GROW_COUNT);if(!a)return!1;for(var i=a.length,n=void 0,s=!1,r=0;r<i&&((n=a[r]).conditionValue[0]!=e||!(s=t>=n.conditionValue[1]));r++);return s},getGrowData:function(){},avtiveGrow:function(e,t){this.oldLen=this.canPayList.length;var a=game.CultureGiftCfg.getDataByType(game.CultureGiftType.GROW_ACTRIVE);if(a&&a.length)for(var i=a.length,n=void 0,s=0;s<i;s++)(n=a[s].conditionValue)&&n.length&&e==n[0]&&t==n[1]&&this.setCanPayList(a[s].rechargeId)},growSetList:function(e,t){if(e&&t){var a=game.CultureGiftCfg.getDataByType(game.CultureGiftType.GROW_COUNT);if(a)for(var i=a.length,n=void 0,s=0;s<i;s++){if(!(n=a[s].conditionValue)||!n.length||e!=n[0])return;e==n[0]&&t>=n[1]&&this.setCanPayList(a[s].rechargeId)}}},roleEquipIsEnough:function(e,t){if(!e||!t)return!1;this.oldLen=this.canPayList.length;var a=game.equipSlotData.getEquipSlot();if(!a)return!1;var i=a.values();if(!i||!i.length)return!1;for(var n=void 0,s=0,r=i.length,o=void 0,g=0;g<r;g++)(o=i[g])&&e<=(n=game.ItemInfoCfg.getData(o.id)).quality&&(s+=n.level);return t<=s},roelEquipSetList:function(e){-1<this.canPayList.indexOf(e)||-1!=this.gotPrizeList.indexOf(e)||this.setCanPayList(e)}});game.cultureGiftData=game.cultureGiftData||new e}(),function(){var e;e=b8e.Object.extends({id:0,isGetAward:!1,canGet:!1,needMoney:0,titleName:"",index:0,award:null,isBuy:!1,serverStart:0,serverEnd:0,setData:function(e){this.id=e.rechargeId,this.needMoney=e.money,this.titleName=e.name,this.btnName=e.btnName,this.award=e.giveItems,this.serverEnd=e.serverEnd,this.serverStart=e.serverStart},getPrizeList:function(){if(this.prizeList)return this.prizeList;if(this.award&&!(this.award.lenth<1)){for(var e=this.award.length,t=void 0,a=void 0,i=[],n=0;n<e;n++)t=this.award[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),i.push(a);return i}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$CultureGiftInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(286),this.setSize(602,177)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.priceList),e.layout.spacingY=10,e.layout.paddingTop=-5,e.layout.spacingX=15,this.timer=b8e.Timer.add(this,this.updateTime,500),this.strLab=game.Lang.get(7256)},setData:function(){var e=this.skin,t=this.data,a=t.getPrizeList();this.prizeList.setData(a),e.lab_0.string=t.btnName,e.lb_tips.string=t.titleName,e.rechargeBtn.node.active=!t.isBuy,e.lab_1.node.active=!t.isBuy,e.soldOut.active=t.isBuy,t.isBuy&&this.stopTime(),this.updateTimeLab()},updateTimeLab:function(){var e=this.data;this.timer.reset(),this.timer.start();var t=this.endTime=game.miscData.openServerTime+(e.serverEnd-1)*b8e.TimeUtil.DAY_MICRO_SECONDS;if(!t||t<=0)return this.skin.lab_1.string=game.Lang.get(6601),void this.stopTime();var a=t-game.SysTime.curTime;this.skin.lab_1.string=a<=0?game.Lang.get(6601):this.strLab+b8e.TimeUtil.formatTime(a)},updateTime:function(){if(!this.endTime)return this.skin.lab_1.string=game.Lang.get(6601),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.lab_1.string=game.Lang.get(6601),void this.stopTime();this.skin.lab_1.string=this.strLab+b8e.TimeUtil.formatTime(e)},stopTime:function(){this.timer&&this.timer.stop()},rechargeBtn:function(){this.send(game.CultureGiftEvts.BTN_BUYGIFTS,this.data.id)}}),b8e.RC("$$game","$$CultureGiftItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(287)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.CultureGiftItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list);var t=b8e.Sprite.get();t.setAnchor(0,1),t.addToParent(this.skin.banner);var a=game.ResCfg.getUrl(5040);a=a||"",t.loadTexture(a)},notify:function(e){switch(e){case game.CultureGiftEvts.C2V_UPDATE_DATA:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.cultureGiftData.itemList;this.list.setData(e)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CultureGift,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(285)},onShow:function(){var e=game.cultureGiftData.getGiftName();this.skin.msgLbl.string=e}});b8e.module.registerView(game.ME.CultureGiftAlert,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_DH_SELECT:b8e.enc(),C2V_DH_SELECT:b8e.enc(),C2V_UPDATE_DH_COST:b8e.enc(),C2V_DH_UPGRADE:b8e.enc(),C2V_UPDATE_DH_VIEW:b8e.enc(),C2C_CHANGE_EQUIP:b8e.enc(),C2V_UPDATE_FH_VIEW:b8e.enc(),C2V_UPDATE_JC_VIEW:b8e.enc(),C2V_UPDATE_FH_COST:b8e.enc(),C2V_FH_UPGRADE:b8e.enc(),C2V_FH_JINJIE:b8e.enc(),C2V_CHOICE_JC_TIMES:b8e.enc(),C2V_CLOSE_JC_TIMES:b8e.enc(),C2V_JC_UPGRADE:b8e.enc(),C2V_UPDATE_JC_COST:b8e.enc()}),b8e.RC("$$game","$$GodEquipEvts2",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.GESlotMap2=b8e.HashMap.get(),this.GEArr2=[],this.fhLvSpr=game.SpriteStat.get(),this.fhshowSpr=game.SpriteStat.get(),this.nomalTimes=1},setup:function(e){var t=e.slots;if(t||!(t.length<1)){this.GESlotMap2.clear();for(var a=void 0,i=void 0,n=0,s=t.length;n<s;n++)(i=(a=t[n])&&a.pos?new game.GEinfo2(a.pos):null)&&i.initNetData(a),this.GESlotMap2.set(a.pos,i);this.setFhLv(e.fhLv),this.updateGEArr(),this.updateFhPos()}},setFhLv:function(e){this.fhLv=e||0;var t=game.FHAdvanceCfg.getData(this.fhLv),a=this.fhLvSpr;t&&(a.clear(),a.setStatValue(game.SpriteStatType.Health,t.hp),a.setStatValue(game.SpriteStatType.Attack,t.atk),a.setStatValue(game.SpriteStatType.Defense,t.def))},getFhLv:function(){return this.fhLv},getFhLvSpr:function(){return this.fhLvSpr},updateGEArr:function(){var e=game.equipSlotData.getEquipSlots();if(e&&!(e.length<1))for(var t=this.GEArr2,a=void(t.length=0),i=void 0,n=0,s=e.length;n<s;n++)(a=e[n])&&(i=this.getGEInfo(a.pos))&&(a._cfg&&a._cfg.quality==game.Quality.Q_RED?(i.setIsGodEquip(!0),t.push(i)):i.setIsGodEquip(!1))},getGEInfo:function(e){return this.GESlotMap2.get(e)},getGEArr:function(){return this.GEArr2},setSelect:function(e){this.clearSelect(),e&&(e.setSelect(!0),this.selectInfo=e)},clearSelect:function(){this.selectInfo&&(this.selectInfo.setSelect(!1),this.selectInfo=null)},getSelectInfo:function(){return this.selectInfo},checkDhOpen:function(){if(this.dhOpen)return this.dhOpen;var e=game.equipSlotData.getEquipSlots();if(!e||e.length<1)return this.dhOpen=!1,this.dhOpen;for(var t=void 0,a=this.getDhNeedCount(),i=0,n=e.length;i<n;i++)if((t=e[i])&&t.equip&&t.equip.highSpriteStat&&t.equip.highSpriteStat.getCount()>=a)return this.dhOpen=!0,this.dhOpen;return this.dhOpen},checkFhOpen:function(){if(this.fhOpen)return this.fhOpen;var e=game.equipSlotData.getEquipSlots();if(!e||e.length<1)return this.fhOpen=!1,this.fhOpen;for(var t=void 0,a=this.getFhNeedLv(),i=this.getFhNeedCount(),n=0,s=0,r=e.length;s<r;s++)(t=e[s])&&t._cfg&&t._cfg.quality==game.Quality.Q_RED&&t._cfg.level>=a&&n++;return this.fhOpen=i<=n,this.fhOpen},isClickCurGrid:function(e){return!this.selectInfo||this.selectInfo.pos==e.pos},isDhFullLv:function(e){if(!this.dhFullLv){var t=game.HighEquipMiscCfg.getData("dhFullLv");t&&(this.dhFullLv=t.value)}return e>=this.dhFullLv},isFhFullLv:function(e){if(!this.fhFullLv){var t=game.HighEquipMiscCfg.getData("maxFhLv");t&&(this.fhFullLv=t.value)}return e>=this.fhFullLv},getDhNeedCount:function(){if(!this.dhNeedCount){var e=game.HighEquipMiscCfg.getData("refineAttrNum");e&&(this.dhNeedCount=e.value)}return this.dhNeedCount},getFhNeedCount:function(){if(!this.fhNeedCount){var e=game.HighEquipMiscCfg.getData("allHighEquipNum");e&&(this.fhNeedCount=e.value)}return this.fhNeedCount},getFhNeedLv:function(){if(!this.fhNeedLv){var e=game.HighEquipMiscCfg.getData("allHighEquipLevel");e&&(this.fhNeedLv=e.value)}return this.fhNeedLv},getFhOrderArr:function(){if(!this.fhOrderArr){var e=game.HighEquipMiscCfg.getData("fhOrder");e&&e.value&&(this.fhOrderArr=e.value.split(","))}return this.fhOrderArr},getDhAwakeSkillLv:function(){if(!this.dhAwakeSkillLv){var e=game.HighEquipMiscCfg.getData("dhAwakeSkillLv");e&&(this.dhAwakeSkillLv=e.value)}return this.dhAwakeSkillLv},updateFhPos:function(){var e=this.getFhOrderArr();if(e&&!(e.length<1)){var t=this.getFhLv();if(this.isFhFullLv(t))this.setFhSelectPos(0);else{for(var a=void 0,i=void 0,n=0,s=e.length;n<s;n++)if(i=e[n],(a=this.getGEInfo(i))&&a.fhLv<=t)return void this.setFhSelectPos(0|i);this.setFhSelectPos(11)}}},setFhSelectPos:function(e){this.fhSelectPos=e},getFhPos:function(){return this.fhSelectPos},isDhOpen:function(){if(!game.moduleOpen.checkOpen(game.ME.GEduanHun))return!1;var e=this.getGEArr();return!(!e||e.length<1)&&this.checkDhOpen()},updateDhCost:function(){for(var e=this.GESlotMap2.values(),t=void 0,a=0,i=e.length;a<i;a++)(t=e[a])&&t.updateDhCost()},checkDhAlert:function(){for(var e=this.GESlotMap2.values(),t=void 0,a=0,i=e.length;a<i;a++)if((t=e[a])&&t.dhAlert)return!0;return!1},onHighEquipDHResp:function(e){if(e.slot&&e.dhLv){var t=this.getGEInfo(e.slot);t&&(t.setDhLv(e.dhLv),t.updateDhCost())}},getGEshowSpr:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=this.fhshowSpr,n=game.equipSlotData.getSlot(e),s=this.getGEInfo(e);if(n&&n._cfg&&s){i.clear(),n._cfg.spriteStat&&i.addSpriteStat(n._cfg.spriteStat);var r=a?s.fhCurSpr:s.fhNextSpr;r&&i.addSpriteStat(r)}return i},onHighEquipFHResp:function(e){if(e.slot&&e.fhLv){var t=this.getGEInfo(e.slot);t&&t.setFhLv(e.fhLv)}this.updateFhPos()},isFhOpen:function(){if(!game.moduleOpen.checkOpen(game.ME.GEfuHun))return!1;var e=this.getGEArr();return!(!e||e.length<1)&&this.checkFhOpen()},checkFhAlert:function(){var e=this.getFhLv();if(this.isFhFullLv(e))return!1;var t=this.getFhPos(),a=void 0;if(10<t)a=game.FHAdvanceCfg.getData(e);else{var i=this.getGEInfo(t);i&&(a=i.fhCfg)}return!!a&&game.itemData.getCountById(a.itemId)>=a.itemNum},onFHAdvanceResp:function(e){this.setFhLv(e.fhLv),this.updateFhPos()},isJCfull:function(e){for(var t=this.getStatTypeArr(),a=this.getStatMaxArr(),i=void 0,n=0,s=0;s<3;s++)i=e.getStatValue(t[s]),a[s]<=i&&n++;return 3<=n},isJCEnough:function(e,t){var a=game.HighEquipJCCfg.getData(e,t);return!!a&&game.UpgradeUtil.checkItemInfo(a.itemId,a.itemNum,!1)},getStatTypeArr:function(){if(!this.statTypeArr){var e=game.HighEquipMiscCfg.getData("JCStatArr");e&&(this.statTypeArr=e.value.split(","))}return this.statTypeArr},getStatMaxArr:function(){if(!this.statMaxArr){var e=game.HighEquipJCCfg.getData(1,1);e&&(this.statMaxArr=[e.maxHp,e.maxAtk,e.maxDef])}return this.statMaxArr},onHighEquipJCResp:function(e){if(e.slot&&e.jcAttr){var t=this.getGEInfo(e.slot);t&&(t.setJCspr(e.jcAttr),t.updateJCCost())}},checkJCAlert:function(){for(var e=this.GESlotMap2.values(),t=void 0,a=0,i=e.length;a<i;a++)if((t=e[a])&&t.JCAlert)return!0;return!1},updateJCCost:function(){for(var e=this.GESlotMap2.values(),t=void 0,a=0,i=e.length;a<i;a++)(t=e[a])&&t.updateJCCost()}});game.godEquipData2=game.godEquipData2||new e}(),function(){var e;e=b8e.Object.extends({dhLv:0,fhLv:0,dhJie:0,isDhSelect:!1,dhAlert:!1,JCAlert:!1,ctor:function(e){this._super(),this.pos=e,this.dhCurSpr=game.SpriteStat.get(),this.dhNextSpr=game.SpriteStat.get(),this.fhCurSpr=game.SpriteStat.get(),this.fhNextSpr=game.SpriteStat.get(),this.jingcuiSpr=game.SpriteStat.get()},initNetData:function(e){this.setDhLv(e.dhLv),this.setFhLv(e.fhLv),this.setJCspr(e.jcAttr)},setJCspr:function(e){if(e&&!(e.length<=0)){var t=this.jingcuiSpr;t.clear();for(var a=void 0,i=0,n=e.length;i<n;i++)(a=e[i])&&t.setStatValue(a.id,a.value)}},getJCspr:function(){return this.jingcuiSpr},setDhLv:function(e){this.dhLv=e||0,this.dhJie=this.dhLv/11|0},updateDhSpr:function(){var e=this,t=game.HighEquipDHCfg.getData(e.pos,e.dhLv);e.dhCfg=t||null;var a=e.dhCurSpr;if(a.clear(),e.dhCfg&&(a.setStatValue(game.SpriteStatType.Health,t.hp),a.setStatValue(game.SpriteStatType.Attack,t.atk),a.setStatValue(game.SpriteStatType.Defense,t.def)),e.isDhFullLv=game.godEquipData2.isDhFullLv(e.dhLv),!e.isDhFullLv){var i=game.HighEquipDHCfg.getData(e.pos,e.dhLv+1);e.dhNextSpr.clear(),i&&e.dhNextSpr.setupByCfg(i)}},updateDhCost:function(){var e=this.dhCfg;e&&(this.isDhFullLv?this.dhAlert=!1:(this.myDhNum=game.itemData.getCountById(e.itemId),this.needDhNum=e.itemNum,this.dhAlert=this.myDhNum>=this.needDhNum))},setSelect:function(e){this.isDhSelect=e},setIsGodEquip:function(e){this.isGodEquip=e},setFhLv:function(e){this.fhLv=e||0},updateFhSpr:function(){var e=this,t=game.HighEquipFHCfg.getData(e.pos,e.fhLv);if(e.fhCfg=t||null,e.fhCfg&&(e.fhCurSpr.clear(),e.fhCurSpr.setupByCfg(e.fhCfg)),e.isFhFullLv=game.godEquipData2.isFhFullLv(e.fhLv),!e.isFhFullLv){var a=game.HighEquipFHCfg.getData(e.pos,e.fhLv+1);e.fhNextSpr.clear(),a&&e.fhNextSpr.setupByCfg(a)}},updateJCCost:function(){if(this.isJCFullLv=game.godEquipData2.isJCfull(this.jingcuiSpr),this.isJCFullLv)return this.isJCFullLv=!0,void(this.JCAlert=!1);var e=game.godEquipData2.nomalTimes,t=game.godEquipData2.isJCEnough(1,e),a=game.godEquipData2.isJCEnough(2,1);this.JCAlert=t||a}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GEinfo2",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.godEquipData2,this.duanhunAlert=game.spotAlert.set(game.SAE.GE_DUANHUN,game.SAE.GODEQUIP)},ipc:function(){this.evts={Back:{C_BACK_SYN_BACK_INFO:this.updateCost,C_BACK_UPDATE_ITEMINFO:this.updateCost},RoleEquip:{V_CHANGE_EQUIP:this.onChangeEquip}},this.handels={HighEquipDHResp:this.onHighEquipDHResp}},notify:function(e,t){switch(e){case this.Evts.V2C_DH_SELECT:this.onSelected(t)}},onHighEquipDHResp:function(e){var t=e.readProtobuf(game.pb.HighEquipDHResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.onHighEquipDHResp(t),this.checkAlert(),this.send(this.Evts.C2V_DH_UPGRADE))},updateCost:function(){this.moduleData.isDhOpen()?(this.moduleData.updateDhCost(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_DH_COST)):this.duanhunAlert.alert=!1},checkAlert:function(){var e=this.moduleData.checkDhAlert();this.duanhunAlert.alert=e},onChangeEquip:function(){game.godEquipData2.updateGEArr(),this.send(this.Evts.C2V_UPDATE_DH_VIEW),this.dpt(this.Evts.C2C_CHANGE_EQUIP)},onSelected:function(e){this.moduleData.setSelect(e),this.send(this.Evts.C2V_DH_SELECT)},upgradeBtn:function(){var e=game.godEquipData2.getSelectInfo();e&&e.dhCfg&&game.UpgradeUtil.checkItemInfo(e.dhCfg.itemId,e.dhCfg.itemNum)&&this.sender.HighEquipDHReq(e.pos)}}),t=game.Sender.extends({ipc:function(){this.msg={HighEquipDHReq:this.highEquipDHReq}},highEquipDHReq:function(e){var t=game.pb.HighEquipDHRequest;t.slot=e,this.write(t)}});b8e.module.registerControl(game.ME.GEduanHun,e,game.GodEquipEvts2,t)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.godEquipData2,this.fuhunAlert=game.spotAlert.set(game.SAE.GE_FUHUN,game.SAE.GODEQUIP)},ipc:function(){this.evts={Back:{C_BACK_SYN_BACK_INFO:this.updateCost,C_BACK_UPDATE_ITEMINFO:this.updateCost},GEduanHun:{C2C_CHANGE_EQUIP:this.onChangeEquip}},this.handels={HighEquipFHResp:this.onHighEquipFHResp,FHAdvanceResp:this.onFHAdvanceResp}},onChangeEquip:function(){this.send(this.Evts.C2V_UPDATE_FH_VIEW)},onHighEquipFHResp:function(e){var t=e.readProtobuf(game.pb.HighEquipFHResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.onHighEquipFHResp(t),this.checkAlert(),this.send(this.Evts.C2V_FH_UPGRADE))},onFHAdvanceResp:function(e){var t=e.readProtobuf(game.pb.FHAdvanceResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.onFHAdvanceResp(t),this.checkAlert(),this.send(this.Evts.C2V_FH_JINJIE))},updateCost:function(){this.moduleData.isFhOpen()?(this.checkAlert(),this.send(this.Evts.C2V_UPDATE_FH_COST)):this.fuhunAlert.alert=!1},checkAlert:function(){var e=this.moduleData.checkFhAlert();this.fuhunAlert.alert=e},upgradeBtn:function(){var e=this.moduleData.getFhLv(),t=this.moduleData.getFhPos(),a=10<t,i=void 0;if(a)i=game.FHAdvanceCfg.getData(e);else{var n=this.moduleData.getGEInfo(t);if(!n)return;if(!n.isGodEquip)return void game.notice.show(7583);i=n.fhCfg}i&&game.UpgradeUtil.checkItemInfo(i.itemId,i.itemNum)&&(a?this.sender.FHAdvanceReq():this.sender.HighEquipFHReq(t))},jingCuiBtn:function(){game.module.show(game.ME.GEjingCui)}}),t=game.Sender.extends({ipc:function(){this.msg={HighEquipFHReq:this.highEquipFHReq,FHAdvanceReq:null}},highEquipFHReq:function(e){var t=game.pb.HighEquipFHRequest;t.slot=e,this.write(t)}});b8e.module.registerControl(game.ME.GEfuHun,e,game.GodEquipEvts2,t)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.godEquipData2,this.jingcuiAlert=game.spotAlert.set(game.SAE.GE_JINGCUI,game.SAE.GE_FUHUN)},ipc:function(){this.evts={GEduanHun:{C2C_CHANGE_EQUIP:this.onChangeEquip},Back:{C_BACK_SYN_BACK_INFO:this.updateJCCost,C_BACK_UPDATE_ITEMINFO:this.updateJCCost}},this.handels={HighEquipJCResp:this.onHighEquipJCResp}},onHighEquipJCResp:function(e){var t=e.readProtobuf(game.pb.HighEquipJCResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.onHighEquipJCResp(t),this.checkJCAlert(),this.send(this.Evts.C2V_JC_UPGRADE))},updateJCCost:function(){this.moduleData.isFhOpen()?(this.moduleData.updateJCCost(),this.checkJCAlert(),this.send(this.Evts.C2V_UPDATE_JC_COST)):this.jingcuiAlert.alert=!1},checkJCAlert:function(){var e=this.moduleData.checkJCAlert();this.jingcuiAlert.alert=e},onChangeEquip:function(){this.send(this.Evts.C2V_UPDATE_JC_VIEW)},upBtn:function(){this.send(this.Evts.C2V_CHOICE_JC_TIMES)},downBtn:function(){},btn1:function(){this.closeChoice(1)},btn10:function(){this.closeChoice(10)},btn50:function(){this.closeChoice(50)},closeChoice:function(e){this.moduleData.nomalTimes=e,this.send(this.Evts.C2V_CLOSE_JC_TIMES)},normalBtn:function(){var e=this.moduleData.nomalTimes;this.washRequest(1,e)},highBtn:function(){this.washRequest(2,1)},washRequest:function(e,t){var a=this.moduleData.getSelectInfo();if(a){var i=a.pos,n=game.HighEquipJCCfg.getData(e,t);if(n)game.UpgradeUtil.checkItemInfo(n.itemId,n.itemNum)&&this.sender.HighEquipJCReq(i,e,t)}}}),t=game.Sender.extends({ipc:function(){this.msg={HighEquipJCReq:this.highEquipJCReq}},highEquipJCReq:function(e,t,a){var i=game.pb.HighEquipJCRequest;i.slot=e,i.washType=t,i.num=a,this.write(i)}});b8e.module.registerControl(game.ME.GEjingCui,e,game.GodEquipEvts2,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(457),this.setSize(234,122)},init:function(){this.icon=game.GridUtil.createGodEquipSlotIcon(),this.icon.addToParent(this.skin.itemNode)},setData:function(e){var t=this.skin;if(e){var a=game.equipSlotData.getSlot(e.pos);if(a){var i=a._cfg;game.GridUtil.setItemIcon(this.icon,a),this.icon.setName(""),i&&(t.name.string=i.name,t.lv.string=i.level)}}t.duanHunLv.string=e.dhJie,t.selectNode.active=e.isDhSelect,t.redPoint.active=e.dhAlert},onClick:function(){this.data&&(game.godEquipData2.isClickCurGrid(this.data)||this.send(game.GodEquipEvts2.V2C_DH_SELECT,this.data))}}),b8e.RC("$$game","$$GEduanHunItem",e)}(),function(){var e=game.CultivateBaseView.extends({ctor:function(){this._super(458)},init:function(){var e=this;e.moduleData=game.godEquipData2;var t=e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.GEduanHunItem,t.bindEnum=e.moduleEnum,t.addToParent(e.skin.listNode),t.layout.spacingY=8,e.selectIcon=game.GridUtil.createGodEquipSlotIcon(),e.selectIcon.addToParent(e.skin.itemNode),e.costIcon=game.GridUtil.createViewClickIcon(),e.costIcon.addToParent(e.skin.iconBtn)},notify:function(e){var t=this;switch(e){case t.Evts.C2V_DH_SELECT:t.updatePower(),t.updateStars(),t.updateIcon(),t.updateProperty(),t.updateSkillDesc(),t.updateCost();break;case t.Evts.C2V_UPDATE_DH_VIEW:t.updateView();break;case t.Evts.C2V_UPDATE_DH_COST:t.updateCost();break;case t.Evts.C2V_DH_UPGRADE:t.updatePower(),t.updateStars(),t.updateProperty(),t.updateSkillDesc(),t.updateCost()}},onShow:function(){this.updateView()},updateView:function(){this.setFirstSelect(),this.updateList(),this.updatePower(),this.updateStars(),this.updateIcon(),this.updateProperty(),this.updateSkillDesc(),this.updateCost()},setFirstSelect:function(){var e=this.moduleData.getGEArr();!e||e.length<1?this.moduleData.clearSelect():this.moduleData.setSelect(e[0])},updateList:function(){var e=this.moduleData.getGEArr();!e||e.length<1?this.list.clear():this.list.setData(e)},updatePower:function(){var e=this.moduleData.getSelectInfo();if(e&&e.dhCurSpr){var t=game.CCommonUtil.getPower(e.dhCurSpr);this.skin.fightAmountLbl.string=t}else this.skin.fightAmountLbl.string=0},updateStars:function(){this.skin;var e=this.moduleData.getSelectInfo(),t=void 0,a=void 0;if(e)for(var i=1;i<11;i++)(t=this.getComponent("starIcon"+i))&&(a=i<=e.dhLv%11,t.active=a)},updateIcon:function(){var e=this.moduleData.getSelectInfo();if(e){var t=game.equipSlotData.getSlot(e.pos);if(t)return game.GridUtil.setItemIcon(this.selectIcon,t),void this.selectIcon.setName("")}game.GridUtil.setItemIcon(this.selectIcon,null,!0)},updateProperty:function(){var e=this.skin,t=this.moduleData.getSelectInfo();if(!t)return e.property1.string="",e.property2.string="",void(e.fullLvLab.active=!1);e.property1.string=this.getPropertyDesc(t.dhCurSpr);var a=t.isDhFullLv;e.fullLvLab.active=a,e.property2.active=!a,a||(e.property2.string=this.getPropertyDesc(t.dhNextSpr))},getPropertyDesc:function(e){var t=e.getSpriteStats(),a="";if(!t)return a;var i=void 0;return t.forEach(function(e,t){i=game.AttrRulesCfg.getData(e),a+=game.Lang.get(50025,i.name,t)},this),a},updateSkillDesc:function(){var e=this.skin;e.label4.string=game.Lang.get(7578),e.propertyDesc.string="";var t=this.moduleData.getSelectInfo();if(t&&t.dhCfg){var a=t.dhCfg.skillId;if(a)this._updateSkill1(game.SkillCfg.getData(a));else{var i=this.moduleData.getDhAwakeSkillLv(),n=game.HighEquipDHCfg.getUData(t.pos,i);n&&n.skillId&&this._updateSkill2(game.SkillCfg.getData(n.skillId))}}},_updateSkill1:function(e){e&&this._updateSkillDesc(7578,e)},_updateSkill2:function(e){e&&this._updateSkillDesc(7579,e)},_updateSkillDesc:function(e,t){var a=this.skin;a.label4.string=game.Lang.get(e),a.propertyDesc.string=game.LangSkill.get(t.desc,t.descParam)},updateCost:function(){var e=this.moduleData.getSelectInfo();if(e){var t=this.skin,a=e.isDhFullLv;t.fullLv.active=a,t.costNode.active=!a,!a&&e.dhCfg&&(this.costIcon.setItemId(e.dhCfg.itemId),t.itemNum.color=e.dhAlert?game.Color.GREEN:game.Color.RED,t.itemNum.string=e.myDhNum+"/"+e.needDhNum,t.redPoint.active=e.dhAlert,t.upgradeLab.active=!e.dhCfg.isBreak,t.breakLab.active=e.dhCfg.isBreak)}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GEduanHun,e)}(),function(){var e=game.CultivateBaseView.extends({ctor:function(){this._super(459),this.spotAlerts={GE_JINGCUI:this.jingCuiAlert}},jingCuiAlert:function(e){this.skin.jingCuiRed.active=e.alert},init:function(){this.moduleData=game.godEquipData2,this._equipIcons=[];for(var e=this._imgs=[],t=this.skin,a=void 0,i=1;i<11;i++)(a=b8e.Sprite.get()).setAnchor(.5,.5),a.setSize(40,40),a.addToParent(this.getComponent("point"+i)),e[i]=a;this.costIcon=game.GridUtil.createViewClickIcon(),this.costIcon.addToParent(t.costIcon),this.updatePoints(),this.updateSelectImg()},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_FH_VIEW:t.updateView();break;case t.Evts.C2V_FH_UPGRADE:t.setEquipSlot(),t.updateSelectImg(),t.updateBaseProperty(),t.updateCost();break;case t.Evts.C2V_FH_JINJIE:t.updatePoints(),t.updateSelectImg(),t.updateLvProperty(),t.updateBaseProperty(),t.updateCost();break;case t.Evts.C2V_UPDATE_FH_COST:t.updateCost()}},onShow:function(){this.updateView()},updateView:function(){this.setEquipSlot(),this.updateSelectImg(),this.updateLvProperty(),this.updateBaseProperty(),this.updateCost()},updateSelectImg:function(){var e=this.skin.selectImg,t=this.moduleData.getFhPos();e.active=!1,e.parent&&e.removeFromParent();var a=this.getComponent("equip_"+t);a&&(e.active=!0,e.addToParent(a))},updatePoints:function(){var e=this._imgs,t=this.moduleData.getFhLv(),a=game.FHAdvanceCfg.getData(t);if(a)for(var i=t%11,n=void 0,s=void 0,r=void 0,o=1;o<11;o++)n=o<=i?a.curColor:a.lastColor,s=game.ResCfg.getUrl(195,n),(r=e[o])&&r.loadTexture(s)},setEquipSlot:function(){var e=game.equipSlotData.getEquipSlot();e&&0<e.count()&&e.forEach(this.setSlot,this)},setSlot:function(e,t){if(t){var a=0|e,i=this._equipIcons[a],n=this.moduleData.getGEInfo(e);n&&n.isGodEquip?(i||((i=game.GridUtil.createGodEquipSlotIcon()).setClickCb(function(){},this),i.addToParent(this.getComponent("equip_"+e)),this._equipIcons[a]=i),game.GridUtil.setGodEquipIcon(i,t),i.setFhLvLab(n.fhLv)):i&&game.GridUtil.setGodEquipIcon(i,null,!0)}},updateLvProperty:function(){var e=this.skin,t=this.moduleData.getFhLv(),a=this.moduleData.getFhLvSpr();e.lv.string=t,e.lvProperty.string=this.getPropertyDesc(a,7562)},updateBaseProperty:function(){var e=this.skin,t=this.moduleData.getFhLv(),a=this.moduleData.isFhFullLv(t);if(e.propertyNode.active=!a,!a){var i=this.moduleData.getFhPos(),n=!1;10<i&&(i=6,n=!0);var s=this.moduleData.getGEshowSpr(i,!0);e.curProperty.string=this.getPropertyDesc(s,50023);var r=this.moduleData.getGEshowSpr(i,n);e.nextProperty.string=this.getPropertyDesc(r,50024)}},getPropertyDesc:function(e,a){var t=e.getSpriteStats(),i="";if(!t)return i;var n=void 0,s=void 0;return t.forEach(function(e,t){n=game.AttrRulesCfg.getData(e),s=n?n.name:"",50023!=a&&50024!=a||s.length<3&&(s=s[0]+"       "+s[1]),i+=game.Lang.get(a,s,t)},this),i},updateCost:function(){var e=this.skin,t=this.moduleData.getFhLv(),a=this.moduleData.isFhFullLv(t);if(e.costNode.active=!a,!(e.fullLv.active=a)){var i=this.moduleData.getFhPos(),n=10<i;e.upgradeLab.active=!n;var s=void 0;if(e.BreakLab.active=n)s=game.FHAdvanceCfg.getData(t);else{var r=this.moduleData.getGEInfo(i);r&&(s=r.fhCfg)}if(s){var o=s.itemId,g=s.itemNum;this.costIcon.setItemId(o);var u=game.itemData.getCountById(o),l=g<=u;e.costNum.color=l?game.Color.GREEN:game.Color.RED,e.costNum.string=u+"/"+g,e.redPoint.active=l}}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GEfuHun,e)}(),function(){var e=game.CultivateBaseView.extends({ctor:function(){this._super(460)},init:function(){var e=this;e._equipIcons=[],e.selectIcon=game.GridUtil.createGodEquipSlotIcon(),e.selectIcon.addToParent(e.skin.itemNode),e.maxWidth=240,e.xiLianCfg=game.HighEquipJCCfg,e.moduleData=game.godEquipData2,e.statTypeArr=e.moduleData.getStatTypeArr(),e.jilianMaxArr=e.moduleData.getStatMaxArr();var t=e.xiLianCfg.getData(1,1);if(t){var a=game.GridUtil.createViewClickIcon();a.addToParent(e.skin.costIconNode1),a.setItemId(t.itemId)}var i=e.xiLianCfg.getData(2,1);if(i){var n=game.GridUtil.createViewClickIcon();n.addToParent(e.skin.costIconNode2),n.setItemId(i.itemId)}},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_JC_VIEW:t.updateView();break;case t.Evts.C2V_CHOICE_JC_TIMES:t.showChoiceBtn();break;case t.Evts.C2V_CLOSE_JC_TIMES:t.closeChoiceBtn();break;case t.Evts.C2V_JC_UPGRADE:t.updataPower(),t.updateBars(),t.updateCost();break;case t.Evts.C2V_UPDATE_JC_COST:t.updateCost()}},onShow:function(){this.updateView()},updateView:function(){this.setEquipSlot(),this.setFirstSelect(),this.updateSelectImg(),this.updateIcon(),this.updataPower(),this.updateBars(),this.updateCost()},updateSelect:function(){this.updateSelectImg(),this.updateIcon(),this.updataPower(),this.updateBars()},updataPower:function(){var e=this.moduleData.getSelectInfo();if(e){var t=e.getJCspr(),a=game.CCommonUtil.getPower(t);this.skin.fightAmountLbl.string=a}},setEquipSlot:function(){var e=game.equipSlotData.getEquipSlot();e&&0<e.count()&&e.forEach(this.setSlot,this)},setSlot:function(e,t){if(t){var a=0|e,i=this._equipIcons[a],n=this.moduleData.getGEInfo(e);n&&n.isGodEquip?(this.info2=n,i||((i=game.GridUtil.createGodEquipSlotIcon()).setClickCb(this.clickGrid,this),i.addToParent(this.getComponent("equip_"+e)),this._equipIcons[a]=i),game.GridUtil.setGodEquipIcon(i,t,!1,3,22,game.Color.WHITE,-5)):i&&game.GridUtil.setGodEquipIcon(i,null,!0,3,22,game.Color.WHITE,-5)}},clickGrid:function(){this.info2&&(game.godEquipData2.isClickCurGrid(this.info2)||(game.godEquipData2.setSelect(this.info2),this.updateSelect()))},setFirstSelect:function(){var e=this.moduleData.getGEArr();if(!e||e.length<1)this.moduleData.clearSelect();else{for(var t=void 0,a=0,i=e.length;a<i;a++)if((t=e[a])&&t.JCAlert)return void this.moduleData.setSelect(t);this.moduleData.setSelect(e[0])}},updateSelectImg:function(){var e=this.skin.selectImg;e.active=!1;var t=this.moduleData.getSelectInfo();if(t){e.parent&&e.removeFromParent();var a=this.getComponent("equip_"+t.pos);a&&(e.active=!0,e.addToParent(a))}},updateIcon:function(){var e=this.skin,t=this.moduleData.getSelectInfo();if(t){var a=game.equipSlotData.getSlot(t.pos);if(a&&a._cfg)return game.GridUtil.setGodEquipIcon(this.selectIcon,a),e.nameLab.active=!0,void(e.nameLab.string=a._cfg.name)}game.GridUtil.setGodEquipIcon(this.selectIcon,null,!0),e.nameLab.active=!1},showChoiceBtn:function(){var e=this.skin;e.upNode.active=!1,e.downNode.active=!0},closeChoiceBtn:function(){var e=this.skin,t=this.moduleData.nomalTimes;e.upNode.active=!0,e.downNode.active=!1;var a=this.getComponent("timesLab"+t).string;e.normalLab.string=a,this.updateCost()},onHide:function(){this.moduleData.nomalTimes=1,this.closeChoiceBtn()},updateBars:function(){var e=this.skin,t=this.moduleData.getSelectInfo();if(t){for(var a=this.statTypeArr,i=t.getJCspr(),n=void 0,s=void 0,r=void 0,o=void 0,g=0,u=0;u<3;u++)n=i.getStatValue(a[u]),s=a[u],r=game.AttrRulesCfg.getData(s),o=this.jilianMaxArr[u],this.getComponent("attLab"+u).string=game.Lang.get(6318,r.name,o,n),this.getComponent("barGreen"+u).width=Math.min(this.maxWidth,this.maxWidth*(n/o)),o<=n&&g++;var l=3<=g;e.upLvNode.active=!l,e.fullLv.active=l}},updateCost:function(){var e=this.moduleData.getSelectInfo();if(e&&!e.isJCFullLv){var t=this.moduleData.nomalTimes;this._updateCost(1,t),this._updateCost(2,1)}},_updateCost:function(e,t){var a=this.skin,i=this.xiLianCfg.getData(e,t);if(i){var n=game.itemData.getNumById(i.itemId),s=n>=i.itemNum,r=1==e?a.costLab1:a.costLab2,o=1==e?a.normalPoint:a.highPoint,g=s?game.Color.GREEN:game.Color.RED;r.color=g,r.string=n+"/"+i.itemNum,o.active=s}}});b8e.module.registerView(game.ME.GEjingCui,e)}(),function(){var e,t,a,i;i=b8e.Enum({TeamPlusMaster:0,TeamPlusZhangLao:1,TeamPlusMember:2}),a=b8e.Enum({ONE:1,TWO:2,THREE:3}),t=b8e.Enum({None:0,MATCH:1,SCORE:2}),e=b8e.Enum({None:0,LOW:21,MIDDLE:22,HIGH:23}),b8e.RC("$$game","$$TeamLeagueRankType",i),b8e.RC("$$game","$$TeamLeagueTeamID",a),b8e.RC("$$game","$$TeamLeagueAwardType",t),b8e.RC("$$game","$$TeamLeagueBetType",e)}(),function(){var e;e=b8e.Enum({None:0,C_UPDATE_TEAMLEAGUE:-1,V_UPDATE_TEAMLEAGUE:-1,C_UPDATE_MASTER:-1,V_UPDATE_MASTER:-1,C_UPDATE_TEAMLEAGUE_NAME:-1,V_UPDATE_TEAMLEAGUE_NAME:-1,C_UPDATE_MEMBERS:-1,C_UPDATE_TEAMLEAGUE_SETTING:-1,V_UPDATE_TEAMLEAGUE_SETTING:-1,V_UPDATE_LIST:-1,V_APPLY_JOIN:-1,V_CREATE_TEAMLEAGUE:-1,V_AGREE:-1,V_REFUSE:-1,V_APPOINT:-1,V_RELEASE:-1,V_KICK:-1,C_INIT_DATA:-1,V_CHECK_PASS:-1,C_JOIN_TEAMLEAGUE:-1,C_CREATE_TEAMLEAGUE:-1,V_TOGGLECHANGE:-1,C_LEAVE_TEAMLEAGUE:-1,V_SHOW_TEAMLEAGUE_VIEW:-1,C_UPDATE_TEAM:-1,V_UPDATE_TEAM:-1,V_SETTEAM_UPDATE_DATA:-1,C_SETTEAM_UPDATE_DATA:-1,C_SELECT_TEAM:-1,V_UPDATE_RANK:-1,C_GET_RANK:-1,V_UPDATE_LOG:-1,C_GET_LOG:-1,C_BATTLE_LOG_REQ:-1,C_CHECK_BTTALE_LOG:-1,C_BET_LOOK:-1,V_BET_COMPLETE:-1,C_BET_COMPLETE:-1,V_BET_SELECT:-1,V_UPDATE_MATCH:-1,C_START_MATCH:-1,C_SELECT_ROLE:-1,C_OPEN_SHOP:-1,C_GET_TEAMLEAGUE_DATA:-1,V_HIDE_MATCHANIM:-1,V_OPEN_SETTLEMENT:-1,C_KICK:-1,C_BATTLE_LOG_LOOK:-1,V2C_REQ_GET_AWARD:-1,V_UPDATE_ASSISTREW:-1,V_UPDATE_ASSIS:-1}),b8e.RC("$$game","$$TeamLeagueEvts",e)}(),function(){var e;e=b8e.Object.extends({prizesInfo:null,range:"",type:0,setData:function(e){this.range=e.range,this.prizesInfo=game.CfgUtil.getPrizeListInfo(e.items,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TeamLeagueAwardInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({round:0,player1:null,player2:null,result:0,battleId:"",sourceInfo:null,setData:function(e){this.round=e.round,this.result=e.result,this.battleId=e.battleId,this.sourceInfo=e},restore:function(){this._super(),this.reset()},recycle:function(){this.reset(),this._super()},release:function(){t.put(this)},reset:function(){this.round=0,this.player1=null,this.player2=null,this.result=0,this.battleId="",this.sourceInfo=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$TeamLeagueBattleLogInfo",t)}(),function(){var e;e=b8e.Object.extends({maxPos:0,teamList:null,type:null,alert:!1,getBattleCount:function(){var e=0;if(!this.teamList)return 0;for(var t=0,a=this.teamList.length;t<a;t++)0!=this.teamList[t].id&&e++;return e},getIsExist:function(e){if(!this.teamList)return!1;for(var t=0,a=this.teamList.length;t<a;t++)if(this.teamList[t].id==e)return!0;return!1},getIsAirPos:function(){return this.maxPos>this.getBattleCount()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TeamLeagueTeamInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",score:0,rank:0,lv:0,setData:function(e){this.name=e.name,this.score=e.score,this.rank=e.rank,this.lv=e.level},restore:function(){this._super(),this.reset()},recycle:function(){this.reset(),this._super()},release:function(){t.put(this)},reset:function(){this.name="",this.score=0,this.rank=0,this.lv=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$TeamLeagueRankInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,type:0,lv:!1,power:0,name:"",isMale:!1,restore:function(){this._super(),this.reset()},recycle:function(){this.reset(),this._super()},release:function(){t.put(this)},reset:function(){this.id=0,this.type=0,this.lv=!1,this.power=0,this.name="",this.isMale=!1}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,128),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$TeamLeagueRoleInfo",t)}(),function(){var e=game.GuildData.extends({rank:0,teamList:null,teamMemberMap:null,selectList:null,isCheckIn:!1,temporarySetData:null,reqCount:0,ctor:function(){this._super(),this.teamList=[],this.selectList=[],this.teamMemberMap=b8e.HashMap.get(),this.temporarySetData={}},initTeamList:function(){this.teamList&&!this.teamList.length&&(this.teamList.push(this.createTeamInfo(game.TeamLeagueTeamID.ONE,3)),this.teamList.push(this.createTeamInfo(game.TeamLeagueTeamID.TWO,3)),this.teamList.push(this.createTeamInfo(game.TeamLeagueTeamID.THREE,3)))},setGuildData:function(e){if(this._super(e.data),this.initTeamList(),this.rank=e.data.rank,this.isCheckIn=e.signed,this.reqCount=e.data.reqCount,e.data.teams)for(var t=e.data.teams,a=0,i=t.length;a<i;a++){var n=t[a];this.setTeamInfo(n)}},createTeamInfo:function(e,t){var a=new game.TeamLeagueTeamInfo;a.type=e,a.teamList=[],a.maxPos=t;for(var i=0,n=a.maxPos;i<n;i++){var s=game.TeamLeagueRoleInfo.get();a.teamList.push(s)}return a},setTeamInfo:function(e){var t,a,i=this.getTeamInfoByType(e.id);if(i){this.restTeamInfo(i);for(var n=0,s=e.members.length;n<s;n++)a=this.membersMap.get(e.members[n]),t=i.teamList[n],a&&t&&(t.id=a.id,t.type=e.id,t.power=a.power,t.name=a.name,t.lv=a.level,t.isMale=a.isMale)}},getTeamInfoByType:function(e){if(!this.teamList)return null;for(var t=0,a=this.teamList.length;t<a;t++)if(this.teamList[t].type==e)return this.teamList[t];return null},leaveMember:function(e){if(this.kickMember(e),this.teamList)for(var t=0,a=this.teamList.length;t<a;t++)this.delRoleInfo(this.teamList[t],e)},restAllMyTeamInfo:function(){if(this.teamList)for(var e=0,t=this.teamList.length;e<t;e++)this.restTeamInfo(this.teamList[e])},restTeamInfo:function(e){for(var t=0,a=e.teamList.length;t<a;t++)this.restRoleInfo(e.teamList[t])},restRoleInfo:function(e){e&&(e.id=0,e.type=0,e.lv=0,e.power=0,e.name="",e.isMale=!1)},addRoleInfo:function(e,t){t.type;for(var a,i=0,n=e.teamList.length;i<n;i++)if((a=e.teamList[i])&&!a.id)return a.id=t.id,a.type=t.type,a.lv=t.lv,a.power=t.power,a.name=t.name,a.isMale=t.isMale,!0;return!1},delRoleInfo:function(e,t){for(var a=-1,i=0,n=e.teamList.length;i<n;i++){var s=e.teamList[i];s.id==t&&(a=i),0<=a&&(i+1<n?this.replaceRoleInfo(s,e.teamList[i+1]):this.restRoleInfo(s))}},replaceRoleInfo:function(e,t){e.id=t.id,e.type=t.type,e.level=t.level,e.power=t.power,e.name=t.name,e.isMale=t.isMale},setCloneSetTeam:function(e){var t=this;if(t.cloneSetTeam){t.cloneSetTeam.type=e.type,t.cloneSetTeam.maxPos=e.maxPos;for(var a,i=t.cloneSetTeam.teamList.length,n=0,s=e.maxPos;n<s;n++)n<i?a=t.cloneSetTeam.teamList[n]:(a=game.TeamLeagueRoleInfo.get(),t.cloneSetTeam.teamList.push(a));if(e.maxPos<i){var r=t.cloneSetTeam.teamList.splice(e.maxPos,i-e.maxPos);for(n=0,s=r.length;n<s;n++)r[n].release();r=null}}else t.cloneSetTeam=t.createTeamInfo(e.type,e.maxPos);for(n=0,s=e.teamList.length;n<s;n++){var o=t.cloneSetTeam.teamList[n],g=e.teamList[n];o&&g&&(o.id=g.id,o.type=g.type,o.lv=g.lv,o.power=g.power,o.name=g.name,o.isMale=g.isMale)}},getSelectListByType:function(e){for(var t,a=this,i=a.getMemberList(),n=0,s=a.selectList.length,r=0,o=i.length;r<o;r++)if(t=i[r],!a.getIsExist(t.id,a.cloneSetTeam.teamList,e)){var g=void 0;n<s?g=a.selectList[n]:(g=game.TeamLeagueRoleInfo.get(),a.selectList.push(g)),n++,g.id=t.id,g.type=e,g.lv=t.lv,g.name=t.name,g.isMale=t.isMale}if(n<a.selectList.length){var u=a.selectList.splice(n,a.selectList.length-n);for(r=0,o=u.length;r<o;r++)u[r].release();u=null}return a.selectList},getIsExist:function(e,t,a){var i,n=2<arguments.length&&void 0!==a?a:0,s=s=t.length;for(i=0;i<s;i++){if(t[i].id==e)return!0}if(0!=n)for(i=0,s=this.teamList.length;i<s;i++){var r=this.teamList[i];if(r.type!=n&&r.getIsExist(e))return!0}return!1},getAllTeamCanBattle:function(){if(this.hasGuild()&&game.teamLeagueMatchData.getIsTeamLeader())for(var e=0,t=this.teamList.length;e<t;e++)if(this.canBattle(this.teamList[e].type))return!0;return!1},canBattle:function(e){var t,a,i=null;for(t=0,a=this.teamList.length;t<a;t++)if(e==(i=this.teamList[t]).type&&i.getIsAirPos()&&this.getIsidle())return!0;return!1},getIsidle:function(){var e,t,a,i,n,s,r=this.getMemberList();for(e=0,a=r.length;e<a;e++){for(n=r[e],s=!0,t=0,i=this.teamList.length;t<i;t++)this.teamList[t].getIsExist(n.id)&&(s=!1);if(s)return s}return s},checkMyTeamAlert:function(){for(var e=0,t=this.teamList.length;e<t;e++)this.teamList[e].alert=this.canBattle(this.teamList[e].type)},getMeZhanglaoCount:function(){var e=this.getMemberList();if(!e||!e.length)return 0;for(var t=0,a=0,i=e.length;a<i;a++)e[a].rank==game.TeamLeagueRankType.TeamPlusZhangLao&&t++;return t},checkTeamById:function(e){for(var t=void 0,a=void 0,i=0,n=this.teamList.length;i<n;i++)if(this.teamList[i])for(var s=0,r=(t=this.teamList[i].teamList).length;s<r;s++)if((a=t[s])&&a.id==e)return!0;return!1},getTeamMumberLength:function(){for(var e=void 0,t=void 0,a=0,i=!1,n=0,s=this.teamList.length;n<s;n++)if(this.teamList[n]){for(var r=a=0,o=(e=this.teamList[n].teamList).length;r<o;r++)(t=e[r])&&0!=t.id&&(t.id==game.mainRoleData.roleId&&(i=!0),a++);if(i)return a}return a}});game.teamLeagueData=game.teamLeagueData||new e}(),function(){var e=void 0;e=b8e.Object.extends({rankList:null,scoreAwardList:null,matchAwardList:null,battleLogList:null,myLogList:null,matchData:null,betData:null,betIndex:0,betMatchId:0,selectBetType:null,lookMatchInfo:null,canBet:!1,isShowView:!1,eliminationTime:null,top16Time:null,top8Time:null,top4Time:null,top2Time:null,challenges:0,stage:0,myRank:0,myScore:0,matchSettlement:null,ctor:function(){var e=this;e.rankList=[],e.matchAwardList=[],e.scoreAwardList=[],e.battleLogList=[],e.matchLogList=[],e.myLogList=[],e.eliminationTime=[],e.top16Time=new game.WorldChallengeTime,e.top8Time=new game.WorldChallengeTime,e.top4Time=new game.WorldChallengeTime,e.top2Time=new game.WorldChallengeTime,e.benBetTime=new game.WorldChallengeTime,e.vsData16=[],e.vsData8=[],e.vsData4=[],e.vsData2=[],e._super()},setData:function(e){this.challenges=e.challenges,this.matchData=e,this.stage=e.stage,this.splitVsData()},isSeasonIng:function(){return!(this.matchData&&2==this.stage&&!this.getIsTopIng())},initOpenTime:function(){var e=this;e.setTimes("leagueCupTop16Times",e.top16Time),e.setTimes("leagueCupTop8Times",e.top8Time),e.setTimes("leagueCupTop4Times",e.top4Time),e.setTimes("leagueCupTop2Times",e.top2Time);var t=e.getTimeArr("leagueCupBanBetTimes");e.benBetTime.startTime=b8e.TimeUtil.dateParse(t[0],"hh:mm").getTime(),e.benBetTime.endTime=b8e.TimeUtil.dateParse(t[1],"hh:mm").getTime(),e.setEliminationTime()},setTimes:function(e,t){var a=this.getTimeArr(e);a&&(t.timeArr=a,t.startTime=game.TimeUtil.getTimeByWeekStr(a[0]),t.endTime=game.TimeUtil.getTimeByWeekStr(a[1]))},getTimeArr:function(e){var t=game.LeagueCupMiscCfg.getData(e);return!(!t||""==t.value)&&t.value.split("-")},setEliminationTime:function(){if(this.eliminationTime){this.eliminationTime.length=0;for(var e,t,a=game.LeagueCupMiscCfg.getData("leagueCupEliminationTimes").value.split("|"),i=0,n=a.length;i<n;i++)t=a[i].split("-"),(e=new game.WorldChallengeTime).startTime=b8e.TimeUtil.dateParse(t[0],"hh:mm").getTime(),e.endTime=b8e.TimeUtil.dateParse(t[1],"hh:mm").getTime(),this.eliminationTime.push(e)}},getIsEliminationIng:function(){var e=game.SysTime.curTime;if(!this.matchData)return!1;if(0==this.matchData.top){e=game.SysTime.curTime;for(var t,a=0,i=this.eliminationTime.length;a<i;a++)if(e>=(t=this.eliminationTime[a]).startTime&&e<=t.endTime)return!0}return!1},getIsTopIng:function(){game.SysTime.curTime;return!!this.matchData&&!!(0<this.matchData.top&&this.matchData.matches&&this.matchData.matches.length)},getGroupLevel:function(e){return game.Lang.get(6051+e)},isPrediction:function(){return!!(this.matchData&&this.matchData.matches.length&&this.matchData.prediction&&this.matchData.prediction.matchId)},getBetRoleId:function(){var e=0;if(this.matchData&&this.isPrediction()){for(var t,a=this.matchData.prediction.matchId,i=this.matchData.prediction.win,n=this.matchData.matches,s=0,r=n.length;s<r;s++)(t=n[s]).id==a&&(e=1==i?t.player1.roleId:t.player2.roleId);return e}},getIsBetMatch:function(e){return!!this.isPrediction()&&this.matchData.prediction.matchId==e},checkCanChallenge:function(e){var t=0<arguments.length&&void 0!==e&&e;if(!this.challengeMax){var a=game.LeagueCupMiscCfg.getData("leagueCupChallenges");if(!a)return!1;this.challengeMax=parseInt(a.value)}return this.getIsEliminationIng()?this.challenges?this.getIsTeamLeader()?!(game.teamLeagueData.count<5)||(t&&game.notice.show(7591),!1):(t&&game.notice.show(7590),!1):(t&&game.notice.show(7567),!1):(t&&game.notice.show(7589),!1)},checkCanBet:function(){return!(!this.matchData||!this.matchData.top||this.isPrediction()||!this.matchData.matches.length)&&this.getTopCanBet(this.matchData.top)},getTopCanBet:function(){var e=this.getTopTime(this.matchData.top);if(!e)return!1;var t=game.SysTime.curTime;return e.startTime>t&&!(this.benBetTime.startTime<=t&&this.benBetTime.endTime>t)},getVsData:function(e){var t=game.MatchVsType;switch(e){case t.VS2:return this.vsData2;case t.VS4:return this.vsData4;case t.VS8:return this.vsData8;case t.VS16:return this.vsData16;default:return null}},splitVsData:function(){var e=this;e.vsData2.length=0,e.vsData4.length=0,e.vsData8.length=0,e.vsData16.length=0;for(var t=game.MatchVsType,a=e.matchData.matches,i=void 0,n=0,s=a.length;n<s;n++)switch((i=a[n]).top){case t.VS2:e.vsData2.push(i);break;case t.VS4:e.vsData4.push(i);break;case t.VS8:e.vsData8.push(i);break;case t.VS16:e.vsData16.push(i)}e.vsData4.length/2==e.vsData2.length&&e.resetResult(e.vsData2,e.vsData4),e.vsData8.length/2==e.vsData4.length&&e.resetResult(e.vsData4,e.vsData8),e.vsData16.length/2==e.vsData8.length&&e.resetResult(e.vsData8,e.vsData16)},resetResult:function(e,t){if(!(!e||e.length<1||!t||t.length<1))for(var a=void 0,i=0,n=e.length;i<n;i++)1==(a=e[i]).result?t[2*i+1].result=3:2==a.result?t[2*i].result=3:3==a.result&&(t[2*i].result=3,t[2*i+1].result=3)},getScheduleStr:function(){if(!this.matchData||!this.matchData.top)return"";var e="";switch(this.matchData.top){case game.MatchVsType.VS16:e=game.Lang.get(6098);break;case game.MatchVsType.VS8:e=game.Lang.get(6099);break;case game.MatchVsType.VS4:e=game.Lang.get(6200);break;case game.MatchVsType.VS2:e=game.Lang.get(6201)}return e},getScheduleTimeStr:function(){if(!this.matchData||!this.matchData.top)return"";var e=this.getTopTime(this.matchData.top),t=(game.SysTime.curTime,0!=b8e.TimeUtil.getDay(e.startTime)?b8e.TimeUtil.getDay(e.startTime):7),a=7==t?game.Lang.get(9386):game.CCommonUtil.replaceChineseNum(t),i=e.timeArr[0].split("|");return game.Lang.get(6096,a,i[1])},getTopTime:function(e){var t;switch(e){case game.MatchVsType.VS16:t=this.top16Time;break;case game.MatchVsType.VS8:t=this.top8Time;break;case game.MatchVsType.VS4:t=this.top4Time;break;case game.MatchVsType.VS2:t=this.top2Time}return t},getAwardListByType:function(e){var t,a,i;switch(e){case game.TeamLeagueAwardType.MATCH:a=this.matchAwardList,t=game.LeagueCupRankAwardCfg.getDatas();break;case game.TeamLeagueAwardType.SCORE:a=this.scoreAwardList,t=game.LeagueCupScoreAwardCfg.getDatas()}if(a&&a.length)return a;for(var n=0,s=t.length;n<s;n++)(i=new game.TeamLeagueAwardInfo).type=e,i.setData(t[n]),a.push(i);return a},setRankList:function(e){var t,a=this.rankList,i=e.data;if(this.myRank=e.rank,this.myScore=e.score,!a||!i)return null;this.clearList(a);for(var n=0,s=i.length;n<s;n++)(t=game.TeamLeagueRankInfo.get()).setData(i[n]),a.push(t)},setMyLogList:function(e){var t;this.clearList(this.myLogList);for(var a=0,i=e.length;a<i;a++)(t=game.TeamLeagueBattleLogInfo.get()).setData(e[a]),t.player1=e[a].player1,t.player2=e[a].player2,this.myLogList.push(t)},getBattleLogList:function(){var e,t=this;if(t.clearList(t.battleLogList),!t.lookMatchInfo||!t.lookMatchInfo.logs)return t.battleLogList;for(var a=t.lookMatchInfo.logs,i=0,n=a.length;i<n;i++)(e=game.TeamLeagueBattleLogInfo.get()).setData(a[i]),e.player1=t.lookMatchInfo.player1,e.player2=t.lookMatchInfo.player2,t.battleLogList.push(e);return t.battleLogList.sort(t.sortLogList),t.battleLogList},getMatchLogList:function(e){var t;if(this.clearList(this.matchLogList),!e||!e)return this.matchLogList;for(var a=e.logs,i=0,n=a.length;i<n;i++)(t=game.TeamLeagueBattleLogInfo.get()).setData(a[i]),t.player1=e.player1,t.player2=e.player2,this.matchLogList.push(t);return this.matchLogList.sort(this.sortLogList),this.matchLogList},sortLogList:function(e,t){return e.round-t.round},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},getIsTeamLeader:function(){var e=game.teamLeagueData.getMineRank();if(e!=game.TeamLeagueRankType.TeamPlusMaster&&e!=game.TeamLeagueRankType.TeamPlusZhangLao)return!1;return!0}}),game.teamLeagueMatchData=game.teamLeagueMatchData||new e,b8e.RC("$$game","$$TeamLeagueMatchData",e)}(),function(){var e=b8e.Object.extends({assistCount:0,actNum:0,collected:null,buyCount:0,ctor:function(){this._super(),this.actAwardDatas=[],this.assistDatas=[]},initData:function(){this.initAssiatData(),this.initActAwardData()},updateInfo:function(e){if(e){this.assistCount=e.count,this.actNum=e.score,this.collected=e.collected,this.buyCount=e.buys||0,this.updateActAwardData(),this.updateAssiatData()}},updateCollected:function(e){game.LeagueActAwardCfg.getData(e)&&(this.collected||(this.collected=[]),-1<this.collected.indexOf(e)||(this.collected.push(e),this.updateActAwardData()))},initAssiatData:function(){if(this.assistDatas&&0<this.assistDatas.length)return this.assistDatas;var e=game.LeagueAssistCfg.getDatas();if(!e||e.length<1)return null;this.assistDatas||(this.assistDatas=[]);for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.TeamLeagueAssistItemInfo).setData(a),i.canChallenge=0<this.assistCount,this.assistDatas.push(i)},updateAssiatData:function(){var e=this.assistDatas.length;if(this.assistDatas&&0<e)for(var t=0;t<e;t++)this.assistDatas[t].canChallenge=0<this.assistCount},initActAwardData:function(){if(this.actAwardDatas&&0<this.actAwardDatas.length)return this.actAwardDatas;var e=game.LeagueActAwardCfg.getDatas();if(!e||e.length<1)return null;this.actAwardDatas||(this.actAwardDatas=[]);for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.CSArenaScoreInfo).cfg=a,i.score=this.actNum,i.labelId=9684,this.actAwardDatas.push(i)},updateActAwardData:function(){var e=this.actAwardDatas.length,t=void 0;if(this.actAwardDatas&&0<e)for(var a=0;a<e;a++)(t=this.actAwardDatas[a]).score=this.actNum,this.collected&&-1<this.collected.indexOf(t.cfg.id)?(t.isGet=!0,t.isCanGet=!1):(t.isGet=!1,t.isCanGet=this.actNum>=t.cfg.score)},updateAssistCount:function(e){0<arguments.length&&void 0!==e&&e?this.assistCount++:this.assistCount--,this.updateAssiatData()},updateBuyCount:function(){this.buyCount++,this.assistCount++,this.updateAssiatData()},getAssistList:function(){return this.assistDatas&&0<this.assistDatas.length?this.assistDatas:null},getActAwardList:function(){return this.actAwardDatas&&0<this.actAwardDatas.length?(this.actAwardDatas.sort(this.sortHandler),this.actAwardDatas):null},sortHandler:function(e,t){return e.isGet==t.isGet?e.isCanGet==t.isCanGet?e.cfg.score-t.cfg.score:e.isCanGet?-1:1:e.isGet?1:t.isGet?-1:void 0},canGetAward:function(){var e=this.actAwardDatas.length;if(this.actAwardDatas&&0<e)for(var t=0;t<e;t++)if(this.actAwardDatas[t].isCanGet)return!0;return!1},canChallenge:function(){return game.moduleOpen.checkOpen(game.ME.TeamLeague)?game.teamLeagueData.hasGuild()?game.teamLeagueData.getTeamMumberLength()<2?(game.notice.show(50153),!1):!(this.assistCount<1)||(game.notice.show(9621),!1):(game.notice.show(9627),!1):(game.notice.show(9623),!1)}});game.teamLeagueAssistData=game.teamLeagueAssistData||new e}(),function(){var e;e=b8e.Object.extends({id:0,moduleId:0,toggleId:0,toggleName:"",icon:"",rewardId:0,rewardNum:0,activeNum:0,canChallenge:!1,ctor:function(){this._super()},setData:function(e){this.id=e.id,this.moduleId=e.moduleId,this.toggleId=e.toggleId,this.toggleName=e.toggleName,this.icon=e.icon,this.rewardId=e.rewardId,this.rewardNum=e.rewardNum,this.activeNum=e.activeNum}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TeamLeagueAssistItemInfo",e)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={},this.handels={LeagueCupRecordResp:this.leagueCupRecordResp}},leagueCupRecordResp:function(e){var t=e.readProtobuf(game.pb.LeagueCupRecordResponse);0<t.code?game.notice.noticeError(t.code):(game.teamLeagueMatchData.setMyLogList(t.records),this.send(this.Evts.V_UPDATE_LOG))},notify:function(e,t){switch(e){case this.Evts.C_GET_LOG:this.sender.LeagueCupRecordReq();break;case this.Evts.C_CHECK_BTTALE_LOG:if(!t)return;game.teamLeagueMatchData.matchSettlement=t.sourceInfo,game.module.show(game.ME.TeamLeagueSettlement),game.module.hide(this.moduleEnum)}}}),t=game.Sender.extends({ipc:function(){this.msg={LeagueCupRecordReq:null}}});b8e.module.registerControl(game.ME.TeamLeagueMyLog,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueData},ipc:function(){this.evts={TeamLeague:{C_UPDATE_TEAMLEAGUE:this.updateTeamLeague},TeamLeagueHall:{C_LEAVE_TEAMLEAGUE:this.checkAlert}},this.handels={TeamPlusReqListResp:this.teamPlusReqListResp,TeamPlusHandleReqResp:this.teamPlusHandleReqResp,TeamPlusSettingResp:this.teamPlusSettingResp},this.spotAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE_APPLY,game.SAE.TEAMLEAGUE_HALL)},notify:function(e,t){var a=this.Evts;switch(e){case a.V_SHOW_TEAMLEAGUE_VIEW:this.sender.TeamPlusReqListReq();break;case a.V_AGREE:this.sender.TeamPlusHandleReqReq(t,game.GuildApplyType.AGREE);break;case a.V_REFUSE:this.sender.TeamPlusHandleReqReq(t,game.GuildApplyType.REFUSE);break;case a.V_CHECK_PASS:this.sender.TeamPlusSettingReq(t,this.data.state)}},updateTeamLeague:function(){this.data.hasGuild()&&game.teamLeagueMatchData.getIsTeamLeader()&&(this.spotAlert.alert=this.data.reqCount)},teamPlusHandleReqResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusHandleReqResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.guildHandleReq(t.type,t.playerIds),this.checkAlert(),this.send(this.Evts.V_UPDATE_LIST)},teamPlusSettingResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusSettingResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setSetting(t.power,t.state),game.notice.show(1671),this.send(this.Evts.V_UPDATE_TEAMLEAGUE_SETTING)},teamPlusReqListResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusReqListResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setApplyList(t.players),this.checkAlert(),this.send(this.Evts.V_UPDATE_LIST)},autoBtn:function(){var e,t=game.GuildApplyState;if(this.data.state==t.OPEN){e=t.CHECK}else e=t.OPEN;var a=this.data.powerLimit;this.sender.TeamPlusSettingReq(a,e)},changeBtn:function(){if(this.data.state!=game.GuildApplyState.CHECK)this.send(this.Evts.V_CHECK_PASS);else;},checkAlert:function(){if(this.data.hasGuild()){var e=this.data.getApplyList();if(this.data.reqCount=e.length,!e||e.length<1){this.spotAlert.alert=!1}else this.spotAlert.alert=!0}else{this.spotAlert.alert=!1}}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusSettingReq:this.teamPlusSettingReq,TeamPlusHandleReqReq:this.teamPlusHandleReqReq,TeamPlusReqListReq:null}},teamPlusSettingReq:function(e,t){var a=game.pb.TeamPlusSettingRequest;a.power=e,a.state=t,this.write(a)},teamPlusHandleReqReq:function(e,t){var a=game.pb.TeamPlusHandleReqRequest;a.playerId=e,a.type=t,this.write(a)}});b8e.module.registerControl(game.ME.TeamLeagueApply,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueMatchData,this.alertOptions={lang:6071,langArgs:null,okcb:this.onClickGameAlert,thisArg:this,args:null}},ipc:function(){this.evts={TeamLeagueMatch:{C_BET_LOOK:this.lookBet}},this.handels={LeagueCupPredictionResp:this.leagueCupPredictionResp,LeagueCupPredictionDataResp:this.leagueCupPredictionDataResp}},lookBet:function(e){this.data.betMatchId=e,this.sender.LeagueCupPredictionDataReq(e)},notify:function(e,t){switch(e){case this.Evts.C_BET_LOOK:this.lookBet(t);break;case this.Evts.C_BATTLE_LOG_LOOK:this.data.lookMatchInfo=t,game.module.show(game.ME.TeamLeagueMatchLog)}},leagueCupPredictionResp:function(e){var t=e.readProtobuf(game.pb.LeagueCupPredictionResponse);if(0<t.code){game.notice.noticeError(t.code)}else{this.data.betData.roleId=t.roleId,this.data.betData.type=t.type;var a=this.data.betData.player1.roleId==t.roleId?1:2;this.data.matchData.prediction={matchId:this.data.betMatchId,win:a},this.dpt(this.Evts.C_BET_COMPLETE),this.send(this.Evts.V_BET_COMPLETE)}},leagueCupPredictionDataResp:function(e){var t=e.readProtobuf(game.pb.LeagueCupPredictionDataResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.betData=t,this.data.betIndex=t.win?t.win:1,game.module.show(game.ME.TeamLeagueBet)},roleNode1:function(){this.selectRole(1)},roleNode2:function(){this.selectRole(2)},selectRole:function(e){null!=this.data.betData&&(0==this.data.betData.type?(this.data.betIndex=e,this.send(this.Evts.V_BET_SELECT,e)):game.notice.show(7588))},betIcon1:function(){this.selectBet(game.TeamLeagueBetType.LOW)},betIcon2:function(){this.selectBet(game.TeamLeagueBetType.MIDDLE)},betIcon3:function(){this.selectBet(game.TeamLeagueBetType.HIGH)},selectBet:function(e){this.data.selectBetType=e,this.showTips()},showTips:function(){game.module.show(game.ME.TeamLeagueBetTips)},betBtn1:function(){this.leagueCupPredictionReq(game.TeamLeagueBetType.LOW)},betBtn2:function(){this.leagueCupPredictionReq(game.TeamLeagueBetType.MIDDLE)},betBtn3:function(){this.leagueCupPredictionReq(game.TeamLeagueBetType.HIGH)},leagueCupPredictionReq:function(e){if(null!=this.data.betData){var t=this.data.betData,a=this.data.betMatchId,i=1==this.data.betIndex?t.player1.roleId:t.player2.roleId,n=game.LeagueCupPredictionCfg.getData(e).betCost[0];if(n){var s=game.ItemInfoCfg.getData(n.Id);this.alertOptions.langArgs=[n.Num+s.name],this.alertOptions.args=[e,a,i],game.alert.showTwo(this.alertOptions)}}},onClickGameAlert:function(e,t,a){this.sender.LeagueCupPredictionReq(e,t,a)}}),t=[game.ME.TeamLeagueBetTips],a=game.Sender.extends({ipc:function(){this.msg={LeagueCupPredictionDataReq:this.leagueCupPredictionDataReq,LeagueCupPredictionReq:this.leagueCupPredictionReq}},leagueCupPredictionDataReq:function(e){var t=game.pb.LeagueCupPredictionDataRequest;t.matchId=e,this.write(t)},leagueCupPredictionReq:function(e,t,a){var i=game.pb.LeagueCupPredictionRequest;i.type=e,i.matchId=t,i.roleId=a,this.write(i)}});b8e.module.registerControl(game.ME.TeamLeagueBet,e,game.TeamLeagueEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueData,this.spotAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE,game.SAE.HOME)},ipc:function(){var e=this;e.evts={MainRole:{C_RESET_DAILY:e.resetDaily},TeamLeagueHall:{C_LEAVE_TEAMLEAGUE:e.leaveTeamLeague,C_GET_TEAMLEAGUE_DATA:e.joinTeamLeague,C_KICK:e.kickTeamLeague},TeamLeagueCreate:{C_CREATE_TEAMLEAGUE:e.openTeamLeague},TeamLeagueList:{C_JOIN_TEAMLEAGUE:e.joinTeamLeague},TeamLeagueRename:{C_UPDATE_TEAMLEAGUE_NAME:e.renameTeamLeague}},e.handels={TeamPlusDataResp:e.teamPlusDataResp,TeamPlusJoinMsg:e.teamPlusJoinMsg,TeamPlusLeaveMsg:e.teamPlusLeaveMsg,TeamPlusNewMemberMsg:e.teamPlusNewMemberMsg,TeamPlusDataMsg:e.teamLeagueDataMsg}},triggerOpen:function(e){e==this.moduleEnum&&(this.data.initTeamList(),this.sender.TeamPlusDataReq())},resetDaily:function(){if(game.moduleOpen.checkOpen(this.moduleEnum))this.sender.TeamPlusDataReq();else;},updateTeamLeague:function(){this.dpt(this.Evts.C_UPDATE_TEAMLEAGUE)},kickTeamLeague:function(){this.updateTeamLeague()},renameTeamLeague:function(){this.updateTeamLeague()},joinTeamLeague:function(){this.sender.TeamPlusDataReq()},openTeamLeague:function(){this.selectToggle(0),this.send(this.Evts.V_UPDATE_TEAMLEAGUE)},leaveTeamLeague:function(){this.selectToggle(1),this.send(this.Evts.V_UPDATE_TEAMLEAGUE)},teamLeagueDataMsg:function(e){var t=e.readProtobuf(game.pb.TeamPlusDataNotify);this.data.setFundData(t),this.dpt(this.Evts.C_UPDATE_TEAMLEAGUE)},teamPlusDataResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusDataResponse);if(0<t.code){game.notice.noticeError(t.code)}else game.teamLeagueData.setGuildData(t),game.teamLeagueAssistData.updateInfo(t.teamAssistance),this.selectToggle(0),this.dpt(this.Evts.C_UPDATE_TEAMLEAGUE),this.send(this.Evts.V_UPDATE_TEAMLEAGUE)},teamPlusLeaveMsg:function(e){var t=e.readProtobuf(game.pb.TeamPlusLeaveNotify);t.memberId==game.mainRoleData.roleId?(this.data.clearData(),this.data.restAllMyTeamInfo(),b8e.module.isShowView(this.moduleEnum)&&this.leaveTeamLeague()):this.data.leaveMember(t.memberId),this.dpt(this.Evts.C_UPDATE_TEAMLEAGUE)},teamPlusNewMemberMsg:function(e){var t=e.readProtobuf(game.pb.TeamPlusNewMemberNotify);this.data.newMember(t.members),this.dpt(this.Evts.C_UPDATE_TEAMLEAGUE)},teamPlusJoinMsg:function(e){e.readProtobuf(game.pb.TeamPlusJoinNotify);this.sender.TeamPlusDataReq(),this.dpt(this.Evts.C_JOIN_TEAMLEAGUE)},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},btn_3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusDataReq:null}}});b8e.module.registerControl(game.ME.TeamLeague,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({alterName:"",createCost:0,init:function(){var e=game.LeagueCupMiscCfg.getData("leagueCupCreateCost");if(e){this.createCost=0|e.value}this.data=game.teamLeagueData},ipc:function(){this.handels={TeamPlusCreateResp:this.teamPlusCreateResp}},notify:function(e,t){switch(e){case this.Evts.V_CHECK_PASS:this.alterName=t,this.checkPass()}},createBtn:function(){this.send(this.Evts.V_CHECK_PASS)},checkPass:function(){if(game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,this.createCost))this.sender.TeamPlusCreateReq(this.alterName),game.module.hide(this.moduleEnum);else;},teamPlusCreateResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusCreateResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setGuildData(t),this.dpt(this.Evts.C_CREATE_TEAMLEAGUE)}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusCreateReq:this.teamPlusCreateReq}},teamPlusCreateReq:function(e){var t=game.pb.TeamPlusCreateRequest;t.name=e,this.write(t)}});b8e.module.registerControl(game.ME.TeamLeagueCreate,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueData,this._alertOptions={lang:7566,okcb:this.onClickGameAlert,thisArg:this},this.spotAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE_HALL,game.SAE.TEAMLEAGUE),this.spotShopAlert=game.spotAlert.set(game.SAE.SHOP_TEAMLEAGUE,game.SAE.TEAMLEAGUE_HALL)},ipc:function(){this.evts={TeamLeague:{C_UPDATE_TEAMLEAGUE:this.updateTeamLeague}},this.handels={TeamPlusLeaveResp:this.teamPlusLeaveResp,TeamPlusChangeRankResp:this.teamPlusChangeRankResp,TeamPlusSignResp:this.teamPlusSignResp,TeamPlusKickResp:this.teamPlusKickResp}},updateTeamLeague:function(){this.send(this.Evts.V_UPDATE_TEAMLEAGUE)},teamPlusKickResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusKickMemberResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.kickMember(t.memberId),this.dpt(this.Evts.C_KICK)},teamPlusSignResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusSignResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.isCheckIn=!0,this.send(this.Evts.V_UPDATE_TEAMLEAGUE)},teamPlusChangeRankResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusChangeRankResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.changeRank(t.memberId,t.rank),this.send(this.Evts.V_UPDATE_TEAMLEAGUE)},teamPlusLeaveResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusLeaveResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.clearData(),this.data.restAllMyTeamInfo(),this.dpt(this.Evts.C_LEAVE_TEAMLEAGUE)},notify:function(e,t){var a=this.Evts;switch(e){case a.V_APPOINT:this.sender.TeamPlusChangeRankReq(t,game.TeamLeagueRankType.TeamPlusZhangLao);break;case a.V_RELEASE:this.sender.TeamPlusChangeRankReq(t,game.TeamLeagueRankType.TeamPlusMember);break;case a.V_KICK:this.sender.TeamPlusKickReq(t);break;case a.V_SHOW_TEAMLEAGUE_VIEW:this.dpt(this.Evts.C_GET_TEAMLEAGUE_DATA)}},changeNameBtn:function(){this.data.getMineRank()==game.TeamLeagueRankType.TeamPlusMaster?game.module.show(game.ME.TeamLeagueRename):game.notice.show(7596)},applyListBtn:function(){this.checkRank()&&game.module.show(game.ME.TeamLeagueApply)},outBtn:function(){game.alert.showTwo(this._alertOptions)},setTeamBtn:function(){game.teamLeagueMatchData.getIsTeamLeader()&&game.teamLeagueData.hasGuild()?game.module.show(game.ME.TeamLeagueTeam):game.notice.show(7590)},teamShopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.TEAMLEAGUE)},checkInBtn:function(){this.data.isCheckIn?game.notice.show(7575):this.sender.TeamPlusSignReq()},assistBtn:function(){game.module.show(game.ME.TeamLeagueAssistMain)},checkRank:function(){if(this.data.getMineRank()!=game.TeamLeagueRankType.TeamPlusMember)return!0;return game.notice.show(7574),!1},onClickGameAlert:function(){this.leaveGuildReq()},leaveGuildReq:function(){this.sender.TeamPlusLeaveReq()}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusSignReq:null,TeamPlusLeaveReq:null,TeamPlusChangeRankReq:this.teamPlusChangeRankReq,TeamPlusKickReq:this.teamPlusKickReq}},teamPlusChangeRankReq:function(e,t){var a=game.pb.TeamPlusChangeRankRequest;a.memberId=e,a.rank=t,this.write(a)},teamPlusKickReq:function(e){var t=game.pb.TeamPlusKickMemberRequest;t.memberId=e,this.write(t)}});b8e.module.registerControl(game.ME.TeamLeagueHall,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueData},ipc:function(){this.handels={TeamPlusRecommendResp:this.teamPlusRecommendResp,TeamPlusJoinResp:this.teamPlusJoinResp}},notify:function(e,t){var a=this.Evts;switch(e){case a.V_SHOW_TEAMLEAGUE_VIEW:this.sender.TeamPlusRecommendReq();break;case a.V_APPLY_JOIN:if(this.data.hasGuild())return void game.notice.show(7576);this.sender.TeamPlusJoinReq(t)}},teamPlusJoinResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusJoinResponse);if(0<t.code){game.notice.noticeError(t.code)}else if(t.state==game.GuildApplyState.OPEN){game.notice.show(7564),this.dpt(this.Evts.C_JOIN_TEAMLEAGUE)}else game.notice.show(7565),this.data.setRecommendGuildState(t.id,!0),this.send(this.Evts.V_UPDATE_LIST)},teamPlusRecommendResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusRecommendResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setRecommendGuild(t),this.send(this.Evts.V_UPDATE_LIST)},createBtn:function(){this.data.hasGuild()?game.notice.show(7576):game.module.show(game.ME.TeamLeagueCreate)}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusRecommendReq:this.teamPlusRecommendReq,TeamPlusJoinReq:this.teamPlusJoinReq}},teamPlusJoinReq:function(e){var t=game.pb.TeamPlusJoinRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.TeamLeagueList,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({intervalTime:0,init:function(){this.data=game.teamLeagueMatchData,this.spotAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE_MATCH,game.SAE.TEAMLEAGUE),this.spotBetAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE_MATCH_BET,game.SAE.TEAMLEAGUE_MATCH),this.spotChallengeAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE_MATCH_CHALLENGE,game.SAE.TEAMLEAGUE_MATCH)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},TeamLeagueBet:{C_BET_COMPLETE:this.betComplete}},this.handels={LeagueCupDataResp:this.leagueCupDataResp,LeagueCupChallengeResp:this.leagueCupChallengeResp}},triggerOpen:function(e){e==this.moduleEnum&&(this.data.initOpenTime(),this.sender.LeagueCupDataReq(),this.checkStartTime())},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.data.initOpenTime(),this.sender.LeagueCupDataReq())},betComplete:function(){this.changeBetState(),this.send(this.Evts.V_UPDATE_MATCH)},notify:function(e,t){var a=this;switch(e){case a.Evts.C_GET_DATA:a.sender.LeagueCupDataReq();break;case a.Evts.C_START_MATCH:if(!a.data.checkCanChallenge(!0))return;a.send(a.Evts.V_SHOW_MATCHANIM),a.sender.LeagueCupChallengeReq();break;case a.Evts.C_CHECK_BTTALE_LOG:if(!t)return;a.dpt(a.Evts.C_BATTLE_LOG_REQ,t),game.module.hide(game.ME.TeamLeagueSettlement);break;case a.Evts.C_OPEN_SHOP:a.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.TEAMLEAGUE_MATCH)}},leagueCupChallengeResp:function(e){var t=e.readProtobuf(game.pb.LeagueCupChallengeResponse);if(0<t.code){return game.notice.noticeError(t.code),void this.send(this.Evts.V_HIDE_MATCHANIM)}this.data.challenges-=1,this.data.matchSettlement=t.match,t.match&&this.send(this.Evts.V_OPEN_SETTLEMENT),this.send(this.Evts.V_UPDATE_MATCH)},leagueCupDataResp:function(e){var t=e.readProtobuf(game.pb.LeagueCupDataResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setData(t),this.send(this.Evts.V_UPDATE_MATCH)},checkStartTime:function(){this.taskTimer||(this.taskTimer=b8e.Timer.add(this,this.updateTime,1e3),this.taskTimer.start())},updateTime:function(){this.spotChallengeAlert.alert=this.data.checkCanChallenge();this.data.matchData;var e=this.data.checkCanBet();e!=this.data.canBet&&(this.changeBetState(e),this.send(this.Evts.V_UPDATE_MATCH))},changeBetState:function(e){this.spotBetAlert.alert=e,this.data.canBet=e}}),t=[game.ME.TeamLeagueSettlement],a=game.Sender.extends({ipc:function(){this.msg={LeagueCupDataReq:null,LeagueCupChallengeReq:null}}});b8e.module.registerControl(game.ME.TeamLeagueMatch,e,game.TeamLeagueEvts,a,t)}(),function(){var e=game.Control.extends({type:0,init:function(){},ipc:function(){this.evts={WorldChallengeLog:{C_BATTLE_LOG_RESP:this.battleLogResp}}},battleLogResp:function(e){var t=e.data;if(t.type==game.MatchType.TEAMLEAGUE){var a=t.log,i={type:game.InstanceType.TEAMLEAGUE_MATCH,exp:0};game.playBack.play(a.battlelog,i),game.module.hide(this.moduleEnum)}},notify:function(e,t){switch(e){case this.Evts.C_CHECK_BTTALE_LOG:if(!t)return;this.dpt(this.Evts.C_BATTLE_LOG_REQ,t)}}});b8e.module.registerControl(game.ME.TeamLeagueMatchLog,e,game.TeamLeagueEvts)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={},this.handels={LeagueCupRankResp:this.leagueCupRankResp}},leagueCupRankResp:function(e){var t=e.readProtobuf(game.pb.LeagueCupRankResponse);0<t.code?game.notice.noticeError(t.code):(game.teamLeagueMatchData.setRankList(t),this.send(this.Evts.V_UPDATE_RANK))},notify:function(e){switch(e){case this.Evts.C_GET_RANK:this.sender.LeagueCupRankReq()}},btn1:function(){this.selectToggle(0)},btn2:function(){this.selectToggle(1)},btn3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={LeagueCupRankReq:null}}}),a=[game.ME.TeamLeagueScoreRank,game.ME.TeamLeagueMatchAward,game.ME.TeamLeagueScoreAward];b8e.module.registerControl(game.ME.TeamLeagueRank,e,game.TeamLeagueEvts,t,a)}(),function(){var e=game.Control.extends({alterName:"",renameCost:0,init:function(){var e=game.LeagueCupMiscCfg.getData("leagueCupRenameCost");if(e){this.renameCost=0|e.value}this.data=game.teamLeagueData},ipc:function(){this.handels={TeamPlusRenameResp:this.teamPlusRenameResp}},notify:function(e,t){switch(e){case this.Evts.V_CHECK_PASS:this.alterName=t,this.checkPass()}},renameBtn:function(){this.send(this.Evts.V_CHECK_PASS)},checkPass:function(){if(game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,this.renameCost))this.sender.TeamPlusRenameReq(this.alterName),game.module.hide(this.moduleEnum);else;},teamPlusRenameResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusRenameResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setName(this.alterName),this.dpt(this.Evts.C_UPDATE_TEAMLEAGUE_NAME)}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusRenameReq:this.teamPlusRenameReq}},teamPlusRenameReq:function(e){var t=game.pb.TeamPlusRenameRequest;t.name=e,this.write(t)}});b8e.module.registerControl(game.ME.TeamLeagueRename,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueData},ipc:function(){this.evts={},this.handels={TeamPlusSetTeamResp:this.teamPlusSetTeamResp}},teamPlusSetTeamResp:function(e){var t=e.readProtobuf(game.pb.TeamPlusSetTeamResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setTeamInfo(this.data.temporarySetData),this.dpt(this.Evts.C_SETTEAM_UPDATE_DATA)},notify:function(e,t){switch(e){case this.Evts.C_SELECT_ROLE:this.selectRoleInfo(t)}},selectRoleInfo:function(e){var t=this.data.cloneSetTeam;0<e.id?this.data.getIsExist(e.id,t.teamList)?(this.data.delRoleInfo(t,e.id),this.send(this.Evts.V_SETTEAM_UPDATE_DATA)):t.getBattleCount()<t.maxPos?(this.data.addRoleInfo(t,e),this.send(this.Evts.V_SETTEAM_UPDATE_DATA)):game.notice.show(5920):game.notice.show(7568)},saveBtn:function(){for(var e=[],t=this.data.cloneSetTeam,a=0,i=t.teamList.length;a<i;a++)t.teamList[a].id&&e.push(t.teamList[a].id);this.data.temporarySetData.id=t.type,this.data.temporarySetData.members=e,this.sender.TeamPlusSetTeamReq(t.type,e),game.module.hide(this.moduleEnum)}}),t=game.Sender.extends({ipc:function(){this.msg={TeamPlusSetTeamReq:this.teamPlusSetTeamReq}},teamPlusSetTeamReq:function(e,t){var a=game.pb.TeamPlusSetTeamRequest;a.id=e,a.members=t,this.write(a)}});b8e.module.registerControl(game.ME.TeamLeagueSetTeam,e,game.TeamLeagueEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.teamLeagueData,this.spotTeamAlert=game.spotAlert.set(game.SAE.TEAMLEAGUE_SET_TEAM,game.SAE.TEAMLEAGUE_MATCH)},ipc:function(){this.evts={TeamLeague:{C_UPDATE_TEAMLEAGUE:this.teamUpdate},TeamLeagueSetTeam:{C_SETTEAM_UPDATE_DATA:this.teamUpdate}}},teamUpdate:function(){this.checkTeamAlert(),this.send(this.Evts.V_UPDATE_TEAM)},checkTeamAlert:function(){this.data.checkMyTeamAlert(),this.spotTeamAlert.alert=!game.teamLeagueMatchData.getIsTopIng()&&this.data.getAllTeamCanBattle()},notify:function(e,t){switch(e){case this.Evts.C_SELECT_TEAM:this.data.setCloneSetTeam(t),game.module.show(game.ME.TeamLeagueSetTeam)}}});b8e.module.registerControl(game.ME.TeamLeagueTeam,e,game.TeamLeagueEvts)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1009),this.setSize(548,112)},init:function(){this.head=b8e.Sprite.get(),this.head.addToParent(this.skin.head),this.head.setAnchor(.5,.5)},setData:function(){var e=this.skin,t=this.data,a=game.Lang;e.name.string=a.get(1619,t.name,t.level),e.power.string=a.get(1620,t.power);var i=game.ResCfg.getHead(t.isMale);this.head.loadTexture(i)},agreeBtn:function(){this.send(game.TeamLeagueEvts.V_AGREE,this.data.id)},refuseBtn:function(){this.send(game.TeamLeagueEvts.V_REFUSE,this.data.id)}}),b8e.RC("$$game","$$TeamLeagueApplyListItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1010)},init:function(){this.data=game.teamLeagueData;var e=this.guildList=new game.List;e.itemRender=game.TeamLeagueApplyListItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.TeamLeagueApply,this.patt=/^[0-9]*[1-9][0-9]*$/;var t=game.LeagueCupMiscCfg.getData("leagueCupPowerLimit");if(t){this.limitPower=0|t.value}},notify:function(e){switch(e){case this.Evts.V_UPDATE_LIST:this.updataList();break;case this.Evts.V_UPDATE_TEAMLEAGUE_SETTING:this.updataSetting();break;case this.Evts.V_CHECK_PASS:this.checkPass()}},onShow:function(){this.send(this.Evts.V_SHOW_TEAMLEAGUE_VIEW),this.updataSetting()},onHide:function(){},updataList:function(){this.list=this.data.getApplyList(),this.guildList.setData(this.list)},updataSetting:function(){this.skin.autoImg.node.active=this.data.state==game.GuildApplyState.OPEN,this.skin.power.string=this.data.powerLimit},checkPass:function(){var e=this.skin.power.string;if(""!==e){if(this.patt.test(e)){var t=0|e;if(this.limitPower>t){game.notice.show(1672,this.limitPower)}else this.send(this.Evts.V_CHECK_PASS,e)}else{game.notice.show(1607)}}else{game.notice.show(1606)}}});b8e.module.registerView(game.ME.TeamLeagueApply,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1014)},init:function(){if(!this.skin.editBox);},notify:function(e){switch(e){case this.Evts.V_CHECK_PASS:this.checkPass()}},onShow:function(){var e=game.LeagueCupMiscCfg.getData("leagueCupCreateCost");e&&(this.skin.costNum.string=e.value),this.skin.editBox.string="",this.send(this.Evts.V_SHOW_TEAMLEAGUE_VIEW)},onHide:function(){},checkPass:function(){var t=this,a=t.skin.editBox.string;if(-1<a.indexOf(" ")){game.notice.show(7585)}else if(""!==a)game.sdk.msgSecCheck(a,function(e){e&&t.send(t.Evts.V_CHECK_PASS,a)},t);else{game.notice.show(7586)}}});b8e.module.registerView(game.ME.TeamLeagueCreate,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1015),this.spotAlerts={TEAMLEAGUE_APPLY:this.applyAlert,SHOP_TEAMLEAGUE:this.shopAlert,TEAMLEAGUE_SET_TEAM:this.teamAlert,TEAMLEAGUE_ASSIST_MAIN:this.assistAlert}},init:function(){this.data=game.teamLeagueData;var e=this.memberList=new game.List;e.itemRender=game.TeamLeagueMemberItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.TeamLeagueHall,e.layout.spacingY=5},applyAlert:function(e){this.skin.red_spot_1.node.active=e.alert},shopAlert:function(e){this.skin.red_spot_2.node.active=e.alert},teamAlert:function(e){this.skin.redPoint2.node.active=e.alert},assistAlert:function(e){this.skin.red_spot_3.node.active=e.alert},notify:function(e){switch(e){case this.Evts.V_UPDATE_TEAMLEAGUE:this.updataView()}},updataView:function(){var e=this;if(e.data.hasGuild()){var t=e.data.getMemberList();e.memberList.setData(t);var a=game.LeagueCupTeamLvCfg.getData(e.data.level),i=e.skin;i.rankLab.string=e.data.rank,i.teamLvLab.string="L"+e.data.level,i.teamNameLab.string=e.data.name,i.teamNumLab.string=e.data.count+"/"+a.maxMembers,i.proLab.string=e.data.fund+"/"+a.exp,i.pro.width=318*e.data.fund/a.exp,i.toCheckin.active=e.data.isCheckIn}},onShow:function(){this.send(this.Evts.V_SHOW_TEAMLEAGUE_VIEW),this.updataView()},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TeamLeagueHall,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1016),this.setSize(548,93)},setData:function(){var e=this.skin,t=this.data,a=game.Lang,i=t.level,n=game.LeagueCupTeamLvCfg.getData(i);if(n){var s=t.rank,r=game.Color.BLACK;switch(s){case 1:r=game.Color.YELLOW;break;case 2:r=game.Color.PURPLE;break;case 3:r=game.Color.GREEN}e.guildName.string=game.HtmlUtil.getText(r,a.get(1675,t.name,t.level)),e.master.string=a.get(7577,t.masterName),e.count.string=a.get(1623,t.count,n.maxMembers);var o=game.CCommonUtil.replaceNum(t.powerLimit,2),g=game.GuildApplyState;switch(t.state){case g.OPEN:e.applyStr.string=a.get(1624,o);break;case g.CLOSED:e.applyStr.string=a.get(1625);break;case g.CHECK:e.applyStr.string=a.get(1626)}e.rank.string=3<s?s:"",this.setRankBg(s)}else;},setRankBg:function(e){var t=this.skin;t.flagIcon1.active=1==e,t.flagIcon2.active=2==e,t.flagIcon3.active=3==e,t.flagIcon4.active=3<e},applyBtn:function(){this.send(game.TeamLeagueEvts.V_APPLY_JOIN,this.data.id)}}),b8e.RC("$$game","$$TeamLeagueListItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1017)},init:function(){var e=this.teamLeagueList=new game.List;e.itemRender=game.TeamLeagueListItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.TeamLeagueList,e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.V_UPDATE_LIST:this.updataList()}},updataList:function(){var e=game.teamLeagueData.getRecommendGuildList();this.teamLeagueList.setData(e)},onShow:function(){this.send(this.Evts.V_SHOW_TEAMLEAGUE_VIEW)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TeamLeagueList,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1018),this.setSize(600,144)},init:function(){var e=this;e.head=b8e.Sprite.get(),e.head.addToParent(e.skin.head),e.head.setAnchor(.5,.5)},setData:function(){var e=this,t=e.skin,a=e.data,i=game.Lang,n="";switch(a.rank){case game.TeamLeagueRankType.TeamPlusMaster:n=game.Lang.get(7569);break;case game.TeamLeagueRankType.TeamPlusZhangLao:n=game.Lang.get(7570);break;case game.TeamLeagueRankType.TeamPlusMember:n=game.Lang.get(7571)}t.name.string=i.get(1633,n,a.name,a.level),t.power.string=a.power;var s=game.ResCfg.getHead(a.isMale);e.head.loadTexture(s),t.score.string=i.get(7572,a.score),t.power.string=i.get(1637,a.power),e.setBtnActive()},setBtnActive:function(){var e=this.skin,t=this.data,a=game.teamLeagueData.getMineRank(),i=game.TeamLeagueRankType;switch(e.operatingBtn.node.active=!1,e.kickBtn.node.active=!1,a){case i.TeamPlusMaster:t.rank==i.TeamPlusMember&&game.teamLeagueData.getMeZhanglaoCount()<2&&(e.operatingBtn.node.active=!0,e.operatingLab.string=game.Lang.get(8354)),t.rank==i.TeamPlusZhangLao&&(e.operatingBtn.node.active=!0,e.operatingLab.string=game.Lang.get(8355)),t.rank!=i.TeamPlusMaster&&(e.kickBtn.node.active=!0);case i.TeamPlusZhangLao:t.rank==i.TeamPlusMember&&(e.kickBtn.node.active=!0)}},operatingBtn:function(){var e=this,t=game.TeamLeagueRankType;e.data.rank==t.TeamPlusZhangLao?(e.str=game.Lang.get(8356,e.data.name),e.clickBtn(e.str,game.TeamLeagueEvts.V_RELEASE)):e.data.rank==t.TeamPlusMember&&(e.str=game.Lang.get(7573,e.data.name),e.clickBtn(e.str,game.TeamLeagueEvts.V_APPOINT))},kickBtn:function(){this.str=game.Lang.get(7594,this.data.name),this.clickBtn(this.str,game.TeamLeagueEvts.V_KICK)},clickBtn:function(e,t){game.GuildMemberTipsView.inst().showView(this.click,e,this,t)},click:function(e,t){e.send(t,e.data.id,e.data.rank)}}),b8e.RC("$$game","$$TeamLeagueMemberItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1019)},init:function(){if(!this.skin.editBox);},notify:function(e){switch(e){case this.Evts.V_CHECK_PASS:this.checkPass()}},onShow:function(){var e=game.LeagueCupMiscCfg.getData("leagueCupRenameCost");e&&(this.skin.costNum.string=e.value),this.skin.editBox.string="",this.send(this.Evts.V_SHOW_TEAMLEAGUE_VIEW)},onHide:function(){},checkPass:function(){var t=this,a=t.skin.editBox.string;if(-1<a.indexOf(" ")){game.notice.show(7585)}else if(""!==a)game.sdk.msgSecCheck(a,function(e){e&&t.send(t.Evts.V_CHECK_PASS,a)},t);else{game.notice.show(7586)}}});b8e.module.registerView(game.ME.TeamLeagueRename,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1020),this.toggles={toggle_btn_1:game.ME.TeamLeagueHall,toggle_btn_2:game.ME.TeamLeagueList,toggle_btn_3:game.ME.TeamLeagueMatch},this.spotAlerts={TEAMLEAGUE_HALL:this.hallAlert,TEAMLEAGUE_MATCH:this.matchAlert}},hallAlert:function(e){this.skin.red_spot_1.node.active=e.alert},matchAlert:function(e){this.skin.red_spot_3.node.active=e.alert},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t);break;case this.Evts.V_UPDATE_TEAMLEAGUE:this.layoutBtns()}},layoutBtns:function(){var e,t=0,a=this.skin;game.teamLeagueData.hasGuild()?(t++,a.btn_1.active=!0):a.btn_1.active=!1;for(var i=2;i<4;i++)e=133*t+84,this.getComponent("btn_"+i).x=e,t++},onShow:function(){game.teamLeagueData.hasGuild()?this.toggleSelect(0):this.toggleSelect(1),this.layoutBtns()},toggleSelect:function(e){if(game.moduleOpen.checkOpenWithTips(this.getToggleIndex(e))){if(0!=e||game.teamLeagueData.hasGuild()||(e=1),!this._super(e));}else;}});b8e.module.registerView(game.ME.TeamLeague,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1005),this.setSize(539,207)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.TeamLeagueRoleListitem,e.bindEnum=game.ME.TeamLeagueTeam,e.layout.spacingX=-23,e.layout.paddingLeft=-10,e.layout.paddingTop=-5,e.addToParent(this.skin.headList)},setData:function(){var e=this.skin,t=0,a=this.data,i=!game.teamLeagueMatchData.getIsTopIng();a.type==game.TeamLeagueTeamID.ONE?t=7555:a.type==game.TeamLeagueTeamID.TWO?t=7556:a.type==game.TeamLeagueTeamID.THREE&&(t=7557),e.teamNameLab.string=game.Lang.get(t,a.getBattleCount(),a.maxPos),e.setBtn.node.active=i,e.setGrayBtn.node.active=!i,e.redPoint1.node.active=a.alert,this.list.setData(a.teamList)},setBtn:function(){this.send(game.TeamLeagueEvts.C_SELECT_TEAM,this.data)}}),b8e.RC("$$game","$$TeamLeagueTeamItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1006)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueTeamItem,e.bindEnum=game.ME.TeamLeagueTeam,e.addToParent(this.skin.listNode),e.layout.spacingY=10},notify:function(e){switch(e){case this.Evts.V_SETTEAM_UPDATE_DATA:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){this.list.setData(game.teamLeagueData.teamList)},onHide:function(){}});b8e.module.registerView(game.ME.TeamLeagueTeam,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(997),this.setSize(540,94)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=5,e.layout.spacingX=17},setData:function(){var e=this.skin,t=this.data;this.prizeInfoList=this.data.prizesInfo,this.prizeList.setData(this.prizeInfoList.items),e.rank1.active="1"==t.range,e.rank2.active="2"==t.range,e.rank3.active="3"==t.range,e.rankLab.active=1<t.range.length,e.rankLab.string=t.range}}),b8e.RC("$$game","$$TeamLeagueAwardItem",e)}(),function(){var e=game.MatchBetTips.extends({ctor:function(){this._super(248)},init:function(){this.betCfg=game.LeagueCupPredictionCfg,this.data=game.teamLeagueMatchData,this._super()}});b8e.module.registerView(game.ME.TeamLeagueBetTips,e)}(),function(){var e=game.MatchBetView.extends({ctor:function(){this._super(249)},init:function(){this.data=game.teamLeagueMatchData,this.betType=game.TeamLeagueBetType,this.betCfg=game.LeagueCupPredictionCfg,this._super()}});b8e.module.registerView(game.ME.TeamLeagueBet,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(250)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.teamLeagueMatchData.getAwardListByType(game.TeamLeagueAwardType.MATCH);this.rankList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TeamLeagueMatchAward,e)}(),function(){var e;e=game.MatchLogItem.extends({ctor:function(){this._super(252)},lookBtn:function(){this.send(game.TeamLeagueEvts.C_CHECK_BTTALE_LOG,this.data.battleId)}}),b8e.RC("$$game","$$TeamLeagueMatchLogItem",e)}(),function(){var e;e=game.MatchLogView.extends({_showModel:!0,ctor:function(){this._super(253)},init:function(){this.skin;var e=this.battleList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueMatchLogItem,e.bindEnum=game.ME.TeamLeagueMatchLog,e.addToParent(this.skin.list),e.layout.spacingY=-1,this.data=game.teamLeagueMatchData}}),b8e.module.registerView(game.ME.TeamLeagueMatchLog,e),b8e.RC("$$game","$$TeamLeagueMatchLogView",e)}(),function(){var e=game.View.extends({matchView:null,topView:null,curView:null,ctor:function(){this._super(998)},init:function(){this.data=game.teamLeagueMatchData},notify:function(e){var t=this;switch(e){case t.Evts.V_UPDATE_MATCH:t.updateView();break;case t.Evts.V_OPEN_SETTLEMENT:b8e.setTimeout(t.openSettlement,t,1e3);break;case t.Evts.V_HIDE_MATCHANIM:t.matchView&&t.matchView.stopMatchAnima();break;case t.Evts.V_SHOW_MATCHANIM:t.matchView&&t.matchView.playMatchAnima()}},openSettlement:function(){game.module.show(game.ME.TeamLeagueSettlement),this.matchView&&this.matchView.stopMatchAnima()},onShow:function(){this.send(this.Evts.C_GET_DATA),this.updateView()},updateView:function(){this.showView(),this.curView&&this.curView.updateView()},showView:function(){var e=game.SysTime.curTime,t=(b8e.TimeUtil.formatTimestamp(e),this),a=t.skin;a.contianer.removeAllChildren(),t.curView=null;var i=!1;t.data.getIsTopIng()?(t.topView||(t.topView=new game.TeamLeagueVsView,t.topView.bindEnum=game.ME.TeamLeagueMatch),t.curView!=t.topView&&(i=!0,t.curView=t.topView)):(t.matchView||(t.matchView=new game.TeamLeagueMatchView,t.matchView.bindEnum=game.ME.TeamLeagueMatch),t.curView!=t.matchView&&(i=!0,t.curView=t.matchView)),i&&t.curView&&a.contianer.addChild(t.curView)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TeamLeagueMatch,e)}(),function(){var e;e=game.Widget.extends({isInit:!1,ctor:function(){this._super(999)},init:function(){var e=this,t=e.skin;e.data=game.teamLeagueMatchData,t.descLab.string=game.Lang.get(7558),game.spotAlert.setCb(game.SAE.TEAMLEAGUE_SET_TEAM,e.setTeamAlert,e),game.spotAlert.setCb(game.SAE.TEAMLEAGUE_MATCH_CHALLENGE,e.setChallengeAlert,e),e.matchAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.matchAnim.addToParent(e.skin.anim),e.matchAnim.load(game.ResCfg.getUrl(5001,2123)),e.matchAnim.addFinishCallback(e.animaCB,e),e.matchAnim.active=!1,e.bg=b8e.Sprite.get(),e.bg.setAnchor(.5,.5),e.bg.loadTexture(game.ResCfg.getImgUrl("worldChallenge/vs_bg",!0)),e.skin.bg.addChild(e.bg),e.isInit=!0},playMatchAnima:function(){this.matchAnim&&(this.matchAnim.active=!0,this.matchAnim.play())},stopMatchAnima:function(){this.matchAnim&&(this.matchAnim.active=!1,this.matchAnim.stop())},animaCB:function(){},onShow:function(){this.updateView()},onHide:function(){this.stopMatchAnima()},updateView:function(){if(this.isInit){var e=this.skin,t=this.data.getIsEliminationIng();e.noOpenBtn.active=!t,e.startMatchBtn.active=t,e.matchNumLab.string=game.Lang.get(7559,this.data.challenges)}},setTeamAlert:function(e){this.skin.redPoint2.active=e.alert},setChallengeAlert:function(e){this.skin.redPoint3.active=e.alert},shopBtn:function(){this.send(game.TeamLeagueEvts.C_OPEN_SHOP)},battleLogBtn:function(){game.module.show(game.ME.TeamLeagueMyLog)},rankBtn:function(){game.module.show(game.ME.TeamLeagueRank)},setTeamBtn:function(){this.data.getIsTeamLeader()&&game.teamLeagueData.hasGuild()?game.module.show(game.ME.TeamLeagueTeam):game.notice.show(7590)},startMatchBtn:function(){this.data.getIsTeamLeader()&&game.teamLeagueData.hasGuild()?this.send(game.TeamLeagueEvts.C_START_MATCH):game.notice.show(7590)},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$TeamLeagueMatchView",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(255),this.setSize(540,98)},setData:function(){var e=this.skin,t=this.data;e.nameLab1.string=t.player1.name,e.nameLab2.string=t.player2.name,e.lose1.node.active=2==t.result,e.win1.node.active=1==t.result,e.lose2.node.active=1==t.result,e.win2.node.active=2==t.result},lookBtn:function(){this.send(game.TeamLeagueEvts.C_CHECK_BTTALE_LOG,this.data)}}),b8e.RC("$$game","$$TeamLeagueMyLogItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(256)},init:function(){var e=this.logList=new game.List;e.itemRender=game.TeamLeagueMyLogItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.TeamLeagueMyLog,e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.V_UPDATE_LOG:this.updataList()}},updataList:function(){this.logList.setData(game.teamLeagueMatchData.myLogList)},onShow:function(){this.send(this.Evts.C_GET_LOG),this.updataList()}});b8e.module.registerView(game.ME.TeamLeagueMyLog,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1e3),this.setSize(540,64)},setData:function(){var e=this.skin,t=this.data;e.rankIcon1.active=1==t.rank,e.rankIcon2.active=2==t.rank,e.rankIcon3.active=3==t.rank,e.rankIcon4.active=3<t.rank,e.rankLab.string=3<t.rank?t.rank:"",e.hitLab.string=t.score,e.nameLab.string=t.name}}),b8e.RC("$$game","$$TeamLeagueRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(257),this.toggles={tab1_select:game.ME.TeamLeagueScoreRank,tab2_select:game.ME.TeamLeagueMatchAward,tab3_select:game.ME.TeamLeagueScoreAward}},init:function(){},onShow:function(){this.toggleSelect(0),this.updateView()},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t);break;case this.Evts.V_UPDATE_RANK:this.updateView()}},updateView:function(){this.skin.myRankLab.string=0<game.teamLeagueMatchData.myRank?game.teamLeagueMatchData.myRank:game.Lang.get(9424),this.skin.mySorceLab.string=game.teamLeagueMatchData.myScore},toggleSelect:function(e){var t=this;if(t._super(e))switch(e){case 0:t.send(t.Evts.C_GET_RANK),t.skin.mySorceTitle.active=t.skin.myRankTitle.active=t.skin.mySorceLab.active=t.skin.myRankLab.active=!0;break;default:t.skin.mySorceTitle.active=t.skin.myRankTitle.active=t.skin.mySorceLab.active=t.skin.myRankLab.active=!1}else;}});b8e.module.registerView(game.ME.TeamLeagueRank,e)}(),function(){var e;e=game.ListItem.extends({icon:null,progressMaxW:56,ctor:function(){this._super(1001),this.setSize(146,140)},init:function(){this.head=b8e.Sprite.get(),this.head.addToParent(this.skin.icon),this.head.setAnchor(.5,.5)},setData:function(){var e=this.skin,t=0<this.data.id;if(t){var a=game.ResCfg.getHead(this.data.isMale);this.head.loadTexture(a),e.nameLab.string=this.data.name}e.icon.active=t,e.nameLab.active=t},touchIcon:function(){this.send(game.TeamLeagueEvts.C_SELECT_ROLE,this.data)}}),b8e.RC("$$game","$$TeamLeagueRoleListitem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(250)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.teamLeagueMatchData.getAwardListByType(game.TeamLeagueAwardType.SCORE);this.rankList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TeamLeagueScoreAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(258)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueRankItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){this.rankList.setData(game.teamLeagueMatchData.rankList)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TeamLeagueScoreRank,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1002)},init:function(){var e=this.curTeamList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.TeamLeagueRoleListitem,e.bindEnum=game.ME.TeamLeagueSetTeam,e.addToParent(this.skin.curTeamList),e.layout.spacingX=5,e.layout.paddingTop=-15,e.layout.paddingLeft=43;var t=this.waitTeamList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.TeamLeagueRoleListitem,t.bindEnum=game.ME.TeamLeagueSetTeam,t.addToParent(this.skin.waitTeamList),t.layout.paddingLeft=-9,t.layout.spacingY=10,t.layout.spacingX=-16},notify:function(e){switch(e){case this.Evts.V_SETTEAM_UPDATE_DATA:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){this.curTeamList.clear(),this.curTeamList.setData(game.teamLeagueData.cloneSetTeam.teamList);var e=game.teamLeagueData.getSelectListByType(game.teamLeagueData.cloneSetTeam.type);this.waitTeamList.clear(),this.waitTeamList.setData(e)}});b8e.module.registerView(game.ME.TeamLeagueSetTeam,e)}(),function(){var e;e=game.MatchVsView.extends({ctor:function(){this._super(260)},init:function(){this.data=game.teamLeagueMatchData,this.evtsClass=game.TeamLeagueEvts,this.itemBindEnum=game.ME.TeamLeagueBet,this.rankEnum=game.ME.TeamLeagueRank,this.itemSkin="match/MatchVsItem",this._super()}}),b8e.RC("$$game","$$TeamLeagueVsView",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1004)},init:function(){this.skin;var e=this.battleList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueSettlementItem,e.bindEnum=game.ME.TeamLeagueMatch,e.addToParent(this.skin.list),e.layout.spacingY=-1,this.data=game.teamLeagueMatchData},onShow:function(){var e=this.data.matchSettlement;if(e){var t=this.data.getMatchLogList(this.data.matchSettlement),a=this.skin;a.nameLab1.string=e.player1.name+".S"+e.player1.zone,a.nameLab2.string=e.player2.name+".S"+e.player2.zone,a.scoreLab1.string=e.player1.score,a.scoreLab2.string=e.player2.score,this.battleList.setData(t)}},onHide:function(){}});b8e.module.registerView(game.ME.TeamLeagueSettlement,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1003),this.setSize(540,98)},setData:function(){var e=this.skin,t=this.data,a=t.player1,i=t.player2;e.roundLab.string=game.Lang.get(7592,game.CCommonUtil.replaceChineseNum(t.round)),e.nameLab1.string=a.name+".S"+a.zone,e.nameLab2.string=i.name+".S"+i.zone,e.lose1.node.active=2==t.result,e.win1.node.active=1==t.result,e.lose2.node.active=1==t.result,e.win2.node.active=2==t.result},lookBtn:function(){this.send(game.TeamLeagueEvts.C_CHECK_BTTALE_LOG,this.data.battleId)}}),b8e.RC("$$game","$$TeamLeagueSettlementItem",e)}(),function(){var e;e=b8e.Enum({None:0,RARE_TYPEREWARDS:-1,EPIC_TYPEREWARDS:-1,LEGEND_TYPEREWARDS:-1,SRTQUALITY_TYPE_END:-1}),b8e.RC("$$game","$$SRTQualityType",e)}(),function(){var e;e=b8e.Enum({None:0,V2C_HIDE:-1,C2V_UPDATE:-1,C2C_LUCKY_SUCCEED:-1,C2C_UPDATE_VIEW:-1,C2C_SELECTREWARD_CONFIRM:-1,C2C_UPDATE_SELECT:-1}),b8e.RC("$$game","$$SRTurnplateEvts",e)}(),function(){var e=void 0;e=b8e.Object.extends({ctor:function(){this.rewardId=0,this.prob=0,this.num=1,this.id=0},setData:function(e,t){this.rewardId=e,this.prob=t/10,this.id=e}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$SRTRewardInfo",e)}(),function(){var e;e=b8e.Object.extends({aid:0,quality:0,srtType:0,isSelect:!1,isTmpSelect:!1,serverStart:0,config:null,idx:0,ctor:function(){},setData:function(e,t,a){this.quality=e,(this.config=t)&&(this.serverStart=t.serverStart,this.aid=t.id,this.srtType=t.srtType,this.idx=a)},updateTmpSelect:function(e){this.isTmpSelect=e},updateSelect:function(e){this.isSelect=e,this.updateTmpSelect(e)},getRewardInfo:function(){var e=[],t=[],a=[],i=game.SRTQualityType,n=game.SRTurnplateClientCfg.getData(this.aid,this.srtType,!1,!1);if(n)switch(this.quality){case i.RARE_TYPEREWARDS:t=n.rareTypes,a=n.rareTypesProbs;break;case i.EPIC_TYPEREWARDS:t=n.epicTypes,a=n.epicTypesProbs;break;case i.LEGEND_TYPEREWARDS:t=n.legendTypes,a=n.legendTypesProbs}if(t.length!=a.length)return b8e.log("[\u81ea\u9009\u5bfb\u5b9d] \u914d\u7f6e\u8868 \u54c1\u8d28\u7c7b\u578b \u4e0e \u54c1\u8d28\u6982\u7387 \u4e2a\u6570\u4e0d\u5339\u914d"),e;for(var s=0;s<t.length;s++){var r=t[s],o=a[s],g=new game.SRTRewardInfo;g.setData(r,o),e.push(g)}return e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$SRTSelectTargetInfo",e)}(),function(){var e;e=b8e.Object.extends({aid:0,quality:0,targetMap:null,showTargetArr:null,selectRewardArr:null,$$tmpSelectRewardArr1:null,$$tmpSelectRewardArr2:null,$$tmpSelectRewardArr3:null,selectTargetIdx:0,rewardsMap:null,selectTarget:0,ctor:function(){this.targetMap=b8e.HashMap.get(),this.showTargetMap=b8e.HashMap.get(),this.showTargetArr=[],this.rewardsMap=b8e.HashMap.get(),this.selectRewardArr=[],this.tmpSelectRewardArr1=[],this.tmpSelectRewardArr2=[],this.tmpSelectRewardArr3=[]},setData:function(e){this.quality=e},pushTargetInfo:function(e,t){var a=this;a.aid=e;var i=new game.SRTSelectTargetInfo,n=a.showTargetArr.length+1;i.setData(a.quality,t,n),game.miscData.openServerDay>=t.serverStart&&(a.showTargetArr.push(i),a.showTargetMap.set(i.srtType,i)),a.targetMap.set(i.srtType,i);var s=a.getRewrds(i.srtType)||[];switch(i.idx){case 1:a.tmpSelectRewardArr1=s;break;case 2:a.tmpSelectRewardArr2=s;break;case 3:a.tmpSelectRewardArr3=s}},onResetDaily:function(){var n=this,s=game.miscData.openServerDay;n.targetMap.forEach(function(e,t){if(!n.showTargetMap.get(e)&&s>=t.serverStart){var a=new game.SRTSelectTargetInfo;a.setData(t.quality,t.config),n.showTargetArr.push(a);var i=n.showTargetArr.length+1;n.showTargetMap.set(e,a,i)}},n)},checkhasSRTType:function(e){return this.showTargetMap.get(e)},getDefaultSRTType:function(){var e=0;return this.showTargetArr&&0<this.showTargetArr.length&&(e=this.showTargetArr[0].srtType),e},getDefaultTargetInfo:function(){return 0==this.showTargetArr.length?null:this.showTargetArr[0]},getSelectTargetInfo:function(){for(var e=null,t=0;t<this.showTargetArr.length;t++){var a=this.showTargetArr[t];if(a.isSelect){e=a;break}}return e},getRewrds:function(e){var t=this.rewardsMap.get(e);if(t)return t;for(var a=0;a<this.showTargetArr.length;a++){var i=this.showTargetArr[a];if(i.srtType==e){t=i.getRewardInfo(),this.rewardsMap.set(e,t);break}}return t},updateRewardsArr:function(e,t){for(var a=void 0,i=0;i<this.showTargetArr.length;i++){var n=this.showTargetArr[i],s=n.srtType==e;t?n.updateTmpSelect(s):n.updateSelect(s),s&&(a=n)}var r=this.getRewrds(e)||[];if(t||(this.selectTarget=e,this.selectRewardArr=r),a){var o=a.idx;if(0!=o){switch(o){case 1:this.tmpSelectRewardArr1=r;break;case 2:this.tmpSelectRewardArr2=r;break;case 3:this.tmpSelectRewardArr3=r}this.selectTargetIdx=o}}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$SRTSelectListInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){var e=this;e.xunbaoType=3,e.oneXunbaoCount=1,e.moreXunbaoCount=10,e.countArr=[e.oneXunbaoCount,e.moreXunbaoCount],e.openActivityId=0,e.rareSRTtype=0,e.epicSRTtype=0,e.legendSRTtype=0,e.SRTSelectMap=b8e.HashMap.get(),e.SRTSelectListInfos=[],e.previewRewards=[],e.settings={aid:0,arr:[]},e.maxEndType=0,e.legendRewardMap=b8e.HashMap.get(),e.nextLegentRewrdId=0,e.lastFourLog=[],e.gridNumMap=b8e.HashMap.get(),e.showArr2=[]},getSelectTargetInfoByQuality:function(e){var t=this.getSelectListInfoByQuality(e);if(t)return t.getSelectTargetInfo()},updateLuckData:function(e,t){var a=this.getLuckData();if(a){for(var i=!1,n=a.awards,s=0;s<n.length;s++){var r=n[s];r.legendType==e&&(r.idx.push(t),i=!0)}if(!i){var o=[];o.push(t),n.push({legendType:e,idx:o})}}},updateNextLegendRewardId:function(){var e=this,t=e.getLuckData();if(t){var a=e.getSelectListInfoByQuality(game.SRTQualityType.LEGEND_TYPEREWARDS);if(a){var i=a.getSelectTargetInfo();if(i){var n=i.srtType,s=a.getRewrds(n);e.legendRewardMap.clear();for(var r=t.awards,o=0;o<r.length;o++){var g=r[o];g.legendType==n&&(g.idx.length==s.length&&(g.idx=[]),e.legendRewardMap.set(g.legendType,g.idx))}var u=e.legendRewardMap.get(n)||[];e.tempServRewardMap||(e.tempServRewardMap=b8e.HashMap.get()),e.tempServRewardMap.clear();for(var l=0;l<u.length;l++){var c=u[l];if(c){var h=game.TreasureLuckStore.getData(c);if(h){var m=h.itemId;e.tempServRewardMap.set(m,h)}}}var d=0;if(s)for(var f=0;f<s.length;f++){var p=s[f];if(p){var v=p.rewardId;if(!e.tempServRewardMap.get(v)){d=v;break}}}e.nextLegentRewrdId=d}}}},getSRTType:function(e,t){var a=game.xunBaoData.getCfgById(e);if(!a||a.xunbaoClientType!=game.LuckyTurnplateType.SRT_XUNBAO)return 0;var i=game.SRTQualityType,n=0;switch(t){case i.RARE_TYPEREWARDS:n=this.rareSRTtype;break;case i.EPIC_TYPEREWARDS:n=this.epicSRTtype;break;case i.LEGEND_TYPEREWARDS:n=this.legendSRTtype}return n},getDefaultTargetInfo:function(e){var t=this.getSelectListInfoByQuality(e);return t?t.getDefaultTargetInfo():null},getSelectListInfoByQuality:function(e){for(var t=this.getSelectListInfos(),a=null,i=0;i<t.length;i++){var n=t[i];if(n.quality==e){a=n;break}}return a},isFree:{get:function(){return 0!=this.openActivityId&&game.treasureData.isFree(this.openActivityId)}},getCountDownTime:function(){var e=this.openActivityId;return 0==e?0:game.xunBaoData.getCfgById(e)?game.luckyTurnplateData.getTimeById(this.openActivityId):0},getLuckData:function(){return 0==this.openActivityId?null:game.treasureData.getLuckData(this.openActivityId)},getLuckCfg:function(){return 0==this.openActivityId?null:game.treasureData.getLuckCfg(this.openActivityId)},setup:function(){if(game.moduleOpen.checkOpen(game.ME.SRTurnplate)){this.settings=game.settingData.getSRTurnplate(),this.initCfg()}},initCfg:function(){var e=game.TreasureMiscCfg.getData("maxSRTType");this.maxEndType=e?parseInt(e.value):0},onResetDaily:function(){for(var e=this.getSelectListInfos(),t=0;t<e.length;t++)e[t].onResetDaily()},updateActivityId:function(){var e=this,t=game.luckyTurnplateData.getActivityIdByType(game.LuckyTurnplateType.SRT_XUNBAO)||0;if(e.openActivityId!=(e.openActivityId=t)){e.rareSRTtype=0,e.epicSRTtype=0,e.legendSRTtype=0,e.SRTSelectMap.clear(),e.SRTSelectListInfos.length=0,e.previewRewards.length=0,e.settings.aid!=t&&(e.settings={aid:0,arr:[]});for(var a=e.settings.arr,i=0;i<a.length;i++)e.confirmSelectReward(i+1,a[i])}},getBaseCfg:function(e){var t=this.openActivityId;return 0==t?null:game.TreasureCostCfg.getBaseData(e,t,this.xunbaoType)},getOpenActivityCfg:function(){var e=this.openActivityId;return 0==e?null:game.xunBaoData.getCfgById(e)},getSelectListInfos:function(){var e=this.openActivityId;if(0==e)return[];var t=this.SRTSelectMap.get(e);if(t)return t;this.SRTSelectListInfos.length=0;for(var a=1;a<game.SRTQualityType.SRTQUALITY_TYPE_END;a++){var i=new game.SRTSelectListInfo;i.setData(a),this.SRTSelectListInfos.push(i)}t=this.SRTSelectListInfos;for(var n=game.SRTQualityType,s=1;s<this.maxEndType;s++){var r=game.SRTurnplateClientCfg.getData(e,s,!1,!1);r&&(0<r.legendTypes.length&&t[n.LEGEND_TYPEREWARDS-1].pushTargetInfo(e,r),0<r.epicTypes.length&&t[n.EPIC_TYPEREWARDS-1].pushTargetInfo(e,r),0<r.rareTypes.length&&t[n.RARE_TYPEREWARDS-1].pushTargetInfo(e,r))}return t.sort(function(e,t){return t.quality-e.quality}),this.SRTSelectMap.set(e,t),t},updateTmpSelectRewards:function(e,t){if(0!=this.openActivityId)for(var a=this.getSelectListInfos(),i=0;i<a.length;i++){var n=a[i];n.quality==e&&n.updateRewardsArr(t,!0)}},confirmSelectRewardsByMap:function(e){var a=this,t=a.openActivityId;if(0!=t){a.previewRewards.length=0,e.forEach(function(e,t){a.confirmSelectReward(t.quality,t.srtType)},a),a.settings.aid=t;var i=[];i.push(a.rareSRTtype),i.push(a.epicSRTtype),i.push(a.legendSRTtype),a.settings.arr=i}},confirmSelectReward:function(e,t){var a=this.getSelectListInfos();if(0!=a.length){for(var i=t,n=null,s=0;s<a.length;s++){var r=a[s];if(r.quality==e){n=r;break}}if(n){n.checkhasSRTType(i)||(i=n.getDefaultSRTType()),n.updateRewardsArr(i,!1);for(var o=0;o<n.selectRewardArr.length;o++)this.previewRewards.push(n.selectRewardArr[o]);var g=game.SRTQualityType;switch(+e){case g.RARE_TYPEREWARDS:this.rareSRTtype=i;break;case g.EPIC_TYPEREWARDS:this.epicSRTtype=i;break;case g.LEGEND_TYPEREWARDS:this.legendSRTtype=i}}}},getClientSRTCfg:function(e){var t=this.openActivityId;if(0!=t)return game.SRTurnplateClientCfg.getData(t,e,!1,!1)},getLastFourLog:function(){var e=this.lastFourLog;e.length=0;for(var t=game.luckyTurnplateData.getLuckLogsMap(game.luckyTurnplateData.activityId),a=t.length,i=void 0,n=a-4;n<a;n++)(i=t[n])&&e.push(i);return e},getGridNumByQuality:function(e){var t=this.gridNumMap,a=t.get(e);if(!a){var i=game.TreasureMiscCfg.getData("zx2GridNum");if(!i)return;var n=i.value.split("|"),s=game.SRTQualityType;t.set(s.LEGEND_TYPEREWARDS,n[0]),t.set(s.EPIC_TYPEREWARDS,n[1]),t.set(s.RARE_TYPEREWARDS,n[2]),a=t.get(e)}return a},getAwardsByQuality:function(e){var t=this.getSelectListInfoByQuality(e);if(t){var a=this.showArr2;a.length=0;var i=t.selectRewardArr,n=this.getGridNumByQuality(e),s=0;a.length=n;for(var r=0;r<n;r++)i[r]?a[r]=i[r]:(a[r]=i[s],s++);return a}}});game.srTurnplateData=game.srTurnplateData||new e}(),function(){var e=void 0;(e=game.ListItem.extends({quality:0,ctor:function(){this._super(945),this.setSize(110,40)},setData:function(){var e=this.data;this.quality=e.quality,this.skin.targetName.string=game.Lang.get(7600+e.srtType),this.skin.autpBg_2.setVisible(e.isTmpSelect)},selectBtn:function(){var e=this.quality,t=this.data.aid,a=this.data.srtType;0!=e&&0!=t&&0!=a&&this.send(game.SRTurnplateEvts.C2C_UPDATE_SELECT,{id:t,srtType:a,quality:e})}})).poolCall=!0,b8e.RC("$$game","$$SRTSelectTargetItem",e)}(),function(){var e=void 0;(e=game.ListItem.extends({quality:0,ctor:function(){this._super(946),this.setSize(100,40)},setData:function(){var e=this.data;this.quality=e.quality,this.skin.targetName.string=game.Lang.get(7600+e.srtType),this.skin.autpBg_2.setVisible(e.isTmpSelect)},selectBtn:function(){var e=this.quality,t=this.data.aid,a=this.data.srtType;0!=e&&0!=t&&0!=a&&this.send(game.SRTurnplateEvts.C2C_UPDATE_SELECT,{id:t,srtType:a,quality:e})}})).poolCall=!0,b8e.RC("$$game","$$SRTSelectTargetItem2",e)}(),function(){var e=void 0;(e=game.ListItem.extends({icon:null,ctor:function(){this._super(942),this.setSize(90,118)},init:function(){this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.icon)},setData:function(){var e=this;e.icon&&(e._prizeInfo=game.ItemUtil.createBaseItemInfo(e.data.rewardId,e.data.num,e._prizeInfo),game.GridUtil.setItemIcon(e.icon,e._prizeInfo,!1,e.data.iconLayoutEnum),e.icon.setName("")),e.skin.lb_probability.string=e.data.prob+"%"}})).poolCall=!0,b8e.RC("$$game","$$SRTSelectPreviewItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(940),this.setSize(555,215)},init:function(){var e=this.targetlist=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.SRTSelectTargetItem,e.bindEnum=game.ME.SRTurnplateSelect,e.addToParent(this.skin.targetList);var t=this.rewardList1=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.SRTSelectPreviewItem,t.bindEnum=game.ME.SRTurnplateSelect,t.addToParent(this.skin.previewList1)},setData:function(){var e=this.data,t=e.quality;this.skin.lb_quality.string=game.Lang.get(7504+t);for(var a=1;a<=3;a++)this.getComponent("rank_bg"+a).setVisible(t==a);this.targetlist.setData(e.showTargetArr);var i=void 0;switch(e.selectTargetIdx){case 1:i=e.tmpSelectRewardArr1;break;case 2:i=e.tmpSelectRewardArr2;break;case 3:i=e.tmpSelectRewardArr3}this.rewardList1.setData(i)}}),b8e.RC("$$game","$$SRTSelectListItem",e)}(),function(){var e,n="rewardList";e=game.ListItem.extends({ctor:function(){this._super(941),this.setSize(332,578)},init:function(){var e=this.skin,t=this.targetlist=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.SRTSelectTargetItem2,t.bindEnum=game.ME.SRTurnplateSelect2,t.addToParent(e.targetList),t.layout.spacingX=0;for(var a=1;a<=3;a++){var i=this[n+a]=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);i.itemRender=game.SRTSelectPreviewItem,i.bindEnum=game.ME.SRTurnplateSelect2,i.addToParent(this.getComponent("previewList"+a))}},setData:function(){var e=this.skin,t=this.data,a=t.quality;e.lb_quality.string=game.Lang.get(7504+a);for(var i=1;i<=3;i++)this.getComponent("rank_bg"+i).setVisible(a==i),this[n+i].setData(b8e.getDPV(t,"tmpSelectRewardArr"+i));this.targetlist.setData(t.showTargetArr)}}),b8e.RC("$$game","$$SRTSelectListItem2",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(943)},init:function(){this.srtData=game.srTurnplateData;var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.SRTSelectListItem,e.bindEnum=game.ME.SRTurnplateSelect,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE:this.updateData()}},onHide:function(){this.send(this.Evts.V2C_HIDE)},onShow:function(){this.send(this.Evts.V2C_ONSHOW),this.updateData()},updateData:function(){var e=this.srtData.getSelectListInfos();this.list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.SRTurnplateSelect,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(944)},init:function(){this.srtData=game.srTurnplateData;var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.SRTSelectListItem2,e.bindEnum=game.ME.SRTurnplateSelect,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE:this.updateData()}},onHide:function(){this.send(this.Evts.V2C_HIDE)},onShow:function(){this.send(this.Evts.V2C_ONSHOW),this.updateData()},updateData:function(){var e=this.srtData.getSelectListInfos();this.list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.SRTurnplateSelect2,e)}(),function(){var e=void 0;(e=game.ListItem.extends({icon:null,ctor:function(){this._super(947),this.setSize(95,102)},init:function(){this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.icon)},setData:function(){this.icon&&(this._prizeInfo=game.ItemUtil.createBaseItemInfo(this.data.rewardId,this.data.num,this._prizeInfo),game.GridUtil.setItemIcon(this.icon,this._prizeInfo,!1,this.data.iconLayoutEnum),this.icon.setName(""))},touchIcon:function(){var e=this.icon.itemInfo;if(e){game.tipsData.setInfo(e);var t=game.ItemInfoCfg.getCfgTypeById(e.id);game.module.show(t==game.ItemCfgType.Equip?game.ME.EquipTips:game.ME.ItemTips)}}})).poolCall=!0,b8e.RC("$$game","$$SRTurnplatePreviewItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(948)},init:function(){var e=this;e.srtData=game.srTurnplateData,e.progressMaxW=515,e.timer=b8e.Timer.add(e,e.updateEndTime,500);var t=e.headList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.SRTurnplatePreviewItem,t.bindEnum=game.ME.SRTurnplate,t.addToParent(e.skin.headList),t.touchMovable=!1,e.costIcons=[];for(var a=0;a<2;a++){var i=game.GridUtil.createCostIcon(40);i.addToParent(e.getComponent("cost_costIcon_"+a)),e.costIcons.push(i)}},notify:function(e){switch(e){case this.Evts.C2V_PLAY_ANI:this.send(this.Evts.V2C_STOP_ANI);break;case this.Evts.C2V_UPDATE_LUCK_LOGS:case this.Evts.UPDATE_ITEM:this.updateData()}},onShow:function(){this.timer&&this.timer.start(),this.updateData()},onHide:function(){this.stopEndTime(),this.stopHeaderTimer()},updateData:function(){var e=this.srtData.getOpenActivityCfg();e&&(this.updateShow(),this.updateImgShow(e),this.updateBtnShow(e),this.updateEndTime(),this.updateItemGrid(),this.updageExpProgress(),this.updateTips())},updateTips:function(){var e=this.srtData.nextLegentRewrdId,t="";if(e){var a=game.ItemInfoCfg.getData(e),i=a.name;t=a?game.HtmlUtil.getColorStrByQuality(a.quality,i):""}this.skin.luckyTips_1.string=e?game.Lang.get(7502,t):"",this.skin.luckyTips_2.string=e?game.Lang.get(7503,t):""},updageExpProgress:function(){var e=this.srtData.getLuckCfg(),t=this.srtData.getLuckData();e&&t&&(this.skin.progress.width=this.progressMaxW*t.score/e.totalScore,this.skin.expLab.string=t.score+"/"+e.totalScore)},updateBtnShow:function(){for(var e=0;e<this.srtData.countArr.length;e++){var t=this.srtData.countArr[e],a=this.srtData.getBaseCfg(t);if(a){for(var i=0,n=0;n<a.giveItems.length;n++){var s=a.giveItems[n];if(23==s.Id){i=s.Num;break}}var r=game.CCommonUtil.replaceNum(i,2);this.getComponent("lab1_Turnplate_"+e).string=game.Lang.get(7500,r),this.getComponent("lab2_Turnplate_"+e).string=game.Lang.get(7501,t);var o=this.costIcons[e];if(o&&0!==a.costItems.length){var g=a.costItems[0];game.GridUtil.setCostIcon(o,g.Id,null,g.Num)}}}},updateItemGrid:function(){var e=this.srtData.previewRewards;e&&0!=e.length&&(this.headList.setData(e),this.setListTime(e.length))},setListTime:function(e){this.scrollX=0,this.headList.scrollToLeft(0),this.patrolTime=game.SysTime.curTime+6700*e,this.patrolTimer?(this.patrolTimer.reset(),this.patrolTimer.start()):this.patrolTimer=b8e.Timer.add(this,this.updateHeadTimer,50)},updateHeadTimer:function(){if(0<this.patrolTime-game.SysTime.curTime)this.scrollX+=1,this.headList.scrollToRight(this.scrollX);else if(this.patrolTimer){this.patrolTimer.stop();var e=this.srtData.previewRewards;if(!e||e.length<1)return void this.stopHeaderTimer();this.setListTime(e.length)}},stopHeaderTimer:function(){this.patrolTimer&&this.patrolTimer.stop()},updateEndTime:function(){if(this.cdTime=this.srtData.getCountDownTime(),this.cdTime<=0)return this.skin.timeLab.string="",this.stopEndTime(),void game.module.hide(this.moduleEnum);this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(this.cdTime,3)},stopEndTime:function(){this.timer&&this.timer.stop()},updateImgShow:function(e){var t=game.ResCfg.getUrl(193,e.bg);t&&this.skin.sp_bg.loadTexture(t);var a=game.ResCfg.getUrl(194,e.title);a&&this.skin.sp_banner.loadTexture(a)},updateShow:function(){var e=this.srtData.isFree;this.skin.isFree.setVisible(e),this.skin.isNoFree.setVisible(!e),this.skin.one_costNode.setVisible(!e);var t=game.luckyTurnplateData.activityId,a=game.treasureData.getIsFindnum(t);e&&(this.skin.labfree_oneTurnplate.string=game.Lang.get(8319,a))},srtviewLog:function(){game.module.show(game.ME.LuckyLogTip)}});b8e.module.registerView(game.ME.SRTurnplate,e)}(),function(){var s="legendIcon",r="epicIcon",o="rareIcon",e=game.View.extends({ctor:function(){this._super(949)},init:function(){var e=this;e.skin;e.srtData=game.srTurnplateData,e.progressMaxW=515,e.timer=b8e.Timer.add(e,e.updateEndTime,500),e.costIcons=[];var t=void 0;for(t=0;t<2;t++){var a=game.GridUtil.createCostIcon(40);a.addToParent(e.getComponent("cost_costIcon_"+t)),e.costIcons.push(a)}for(t=0;t<3;t++)e[s+t]=game.GridUtil.createPrizeIcon(game.IconSizeEnum.SIZE_104),e[s+t].addToParent(e.getComponent("legend_node_"+t));for(t=0;t<3;t++)e[r+t]=game.GridUtil.createPrizeIcon(game.IconSizeEnum.SIZE_104),e[r+t].addToParent(e.getComponent("epic_node_"+t));for(t=0;t<10;t++)e[o+t]=game.GridUtil.createPrizeIcon(game.IconSizeEnum.SIZE_84),e[o+t].addToParent(e.getComponent("rare_icon_"+t));for(t=0;t<16;t++)game.GridUtil.createZX2PlusIcon().addToParent(e.getComponent("bg_"+t))},notify:function(e){switch(e){case this.Evts.C2V_PLAY_ANI:this.send(this.Evts.V2C_STOP_ANI);break;case this.Evts.C2V_UPDATE_LUCK_LOGS:case this.Evts.UPDATE_ITEM:this.updateData()}},onShow:function(){this.timer&&this.timer.start(),this.updateData()},onHide:function(){this.stopEndTime()},updateData:function(){var e=this,t=e.srtData.getOpenActivityCfg();t&&(e.updateShow(),e.updateImgShow(),e.updateBtnShow(t),e.updateEndTime(),e.updageExpProgress(),e.updateTips(),e.reqLog(),e.updateLogs(),e.updateGrid())},updateTips:function(){var e=this.srtData.nextLegentRewrdId,t="";if(e){var a=game.ItemInfoCfg.getData(e),i=a.name;t=a?game.HtmlUtil.getColorStrByQuality(a.quality,i):""}this.skin.luckyTips_1.string=e?game.Lang.get(7502,t):"",this.skin.luckyTips_2.string=e?game.Lang.get(7503,t):""},updageExpProgress:function(){var e=this.srtData.getLuckCfg(),t=this.srtData.getLuckData();e&&t&&(this.skin.progress.width=this.progressMaxW*t.score/e.totalScore,this.skin.expLab.string=t.score+"/"+e.totalScore)},updateBtnShow:function(){for(var e=0;e<this.srtData.countArr.length;e++){var t=this.srtData.countArr[e],a=this.srtData.getBaseCfg(t);if(a){for(var i=0,n=0;n<a.giveItems.length;n++){var s=a.giveItems[n];if(23==s.Id){i=s.Num;break}}var r=game.CCommonUtil.replaceNum(i,2);this.getComponent("lab1_Turnplate_"+e).string=game.Lang.get(7500,r),this.getComponent("lab2_Turnplate_"+e).string=game.Lang.get(7501,t);var o=this.costIcons[e];if(o&&0!==a.costItems.length){var g=a.costItems[0];game.GridUtil.setCostIcon(o,g.Id,null,g.Num)}}}},updateEndTime:function(){if(this.cdTime=this.srtData.getCountDownTime(),this.cdTime<=0)return this.skin.timeLab.string="",this.stopEndTime(),void game.module.hide(this.moduleEnum);this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(this.cdTime,3)},stopEndTime:function(){this.timer&&this.timer.stop()},updateImgShow:function(){var e=game.ResCfg.getUrl(5076);e&&this.skin.sp_bg.loadTexture(e);var t=game.ResCfg.getUrl(5077);t&&this.skin.sp_banner.loadTexture(t)},updateShow:function(){var e=this.srtData.isFree;this.skin.isFree.setVisible(e),this.skin.isNoFree.setVisible(!e),this.skin.one_costNode.setVisible(!e);var t=game.luckyTurnplateData.activityId,a=game.treasureData.getIsFindnum(t);e&&(this.skin.labfree_oneTurnplate.string=game.Lang.get(8319,a))},srtviewLog:function(){game.module.show(game.ME.LuckyLogTip)},reqLog:function(){var e=game.luckyTurnplateData,t=e.activityId;if(!e.getLuckLogsMap(t))return e.setLuckLogsMap(t,[]),void this.send(this.Evts.V2C_UPDATE_LOGS)},updateLogs:function(){this.skin;for(var e=this.srtData.getLastFourLog(),t=void 0,a=void 0,i=void 0,n=void 0,s=0;s<4;s++)t=e[s],n=this.getComponent("log"+s),t&&(a=game.ItemInfoCfg.getData(t.itemId))?(i=game.HtmlUtil.getColorStrByQuality(a.quality,a.name+"*"+t.itemNum),n.string=game.Lang.get(9858,t.name,i)):n.string=""},updateGrid:function(){var e=this,t=(e.skin,game.SRTQualityType),a=0,i=void 0,n=e.srtData.getAwardsByQuality(t.LEGEND_TYPEREWARDS);if(n&&n.length)for(a=0;a<3;a++)i=n[a],e[s+a].setItemInfo(i),e.getComponent("legend_icon_"+a).active=!!i;if((n=e.srtData.getAwardsByQuality(t.EPIC_TYPEREWARDS))&&n.length)for(a=0;a<3;a++)i=n[a],e[r+a].setItemInfo(i),e.getComponent("epic_icon_"+a).active=!!i;if((n=e.srtData.getAwardsByQuality(t.RARE_TYPEREWARDS))&&n.length)for(a=0;a<10;a++)i=n[a],e[o+a].setItemInfo(i),e.getComponent("rare_icon_"+a).active=!!i}});b8e.module.registerView(game.ME.SRTurnplate2,e)}(),function(){var e;e=game.Control.extends({init:function(){this.tempSaveSettings=b8e.HashMap.get(),this.srtData=game.srTurnplateData},ipc:function(){},notify:function(e,t){switch(e){case this.Evts.C2C_UPDATE_SELECT:this.onClickSelect(t);break;case this.Evts.V2C_HIDE:this.onHideSelectView();break;case this.Evts.V2C_ONSHOW:this.onShowSelectView()}},onShowSelectView:function(){this.tempSaveSettings.clear();var e=this.srtData.settings;if(0!=e.aid)for(var t=e.arr,a=0;a<t.length;a++){var i=t[a];if(0!=i){var n=a+1;this.tempSaveSettings.set(n,{quality:n,srtType:i}),this.srtData.updateTmpSelectRewards(n,i)}}else for(var s=1;s<game.SRTQualityType.SRTQUALITY_TYPE_END;s++){var r=this.srtData.getDefaultTargetInfo(s);if(r){var o=r.quality,g=r.srtType;this.tempSaveSettings.set(o,{quality:o,srtType:g}),this.srtData.updateTmpSelectRewards(o,g)}}},onClickSelect:function(e){var t=e.quality,a=e.srtType;this.tempSaveSettings.set(t,{quality:t,srtType:a}),this.srtData.updateTmpSelectRewards(t,a)},onHideSelectView:function(){this.tempSaveSettings.clear()},okBtn:function(){this.srtData.confirmSelectRewardsByMap(this.tempSaveSettings);var e=this.srtData.settings;this.dpt(this.Evts.C2C_SELECTREWARD_CONFIRM,e),this.srtData.updateNextLegendRewardId(),this.dpt(this.Evts.C2C_UPDATE_VIEW),game.module.hide(game.ME.SRTurnplateSelect)}}),b8e.module.registerControl(game.ME.SRTurnplateSelect,e,game.SRTurnplateEvts),b8e.RC("$$game","$$SRTSelectRewardCtrl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.tempSaveSettings=b8e.HashMap.get(),this.srtData=game.srTurnplateData},notify:function(e,t){switch(e){case this.Evts.C2C_UPDATE_SELECT:this.onClickSelect(t);break;case this.Evts.V2C_HIDE:this.onHideSelectView();break;case this.Evts.V2C_ONSHOW:this.onShowSelectView()}},onShowSelectView:function(){this.tempSaveSettings.clear();var e=this.srtData.settings;if(0!=e.aid)for(var t=e.arr,a=0;a<t.length;a++){var i=t[a];if(0!=i){var n=a+1;this.tempSaveSettings.set(n,{quality:n,srtType:i}),this.srtData.updateTmpSelectRewards(n,i)}}else for(var s=1;s<game.SRTQualityType.SRTQUALITY_TYPE_END;s++){var r=this.srtData.getDefaultTargetInfo(s);if(r){var o=r.quality,g=r.srtType;this.tempSaveSettings.set(o,{quality:o,srtType:g}),this.srtData.updateTmpSelectRewards(o,g)}}},onClickSelect:function(e){var t=e.quality,a=e.srtType;this.tempSaveSettings.set(t,{quality:t,srtType:a}),this.srtData.updateTmpSelectRewards(t,a)},onHideSelectView:function(){this.tempSaveSettings.clear()},okBtn:function(){this.srtData.confirmSelectRewardsByMap(this.tempSaveSettings);var e=this.srtData.settings;this.dpt(this.Evts.C2C_SELECTREWARD_CONFIRM,e),this.srtData.updateNextLegendRewardId(),this.dpt(this.Evts.C2C_UPDATE_VIEW),game.module.hide(game.ME.SRTurnplateSelect2)}}),b8e.module.registerControl(game.ME.SRTurnplateSelect2,e,game.SRTurnplateEvts),b8e.RC("$$game","$$SRTSelectRewardCtrl2",e)}(),function(){var e;e=b8e.Enum({C_INIT_WORLDWAR:b8e.enc(),C_SELECT_WORLDWAR:b8e.enc(),C_SELECT_WORLDWARDETAIL:b8e.enc(),V_UPDATE_DATA:b8e.enc(),V_UPDATE_RECORD:b8e.enc(),C_SHOW_RECORD:b8e.enc(),C2C_UPDATE_FINISH_COUNT:b8e.enc(),C2C_JOIN_TEAM:b8e.enc(),C2V_UPDATEVIEW:b8e.enc(),V2C_UPDATE_SECELT:b8e.enc()}),b8e.RC("$$game","$$WorldWar2Evts",e)}(),function(){var e,t=e=game.WorldWarDetailInfo.extends({id:0,idx:0,worldWarId:0,alert:!1,openBox:!1,isPass:!1,canSweep:!1,isSelect:!1,canChall:!1,quickCount:!1,ctor:function(){this.modeType=0,this.infoArr=[]},setData:function(e){this.openBox=e.box,this.quickCount=e.quickCount,this.firstRec=e.record1,this.fastRec=e.record2,this.quickCount?(this.canSweep=!1,this.canChall=!1):this.canSweep=!0,this.isPass=!0},addQuickCount:function(){this.quickCount=!0,this.quickCount&&(this.canSweep=!1),this.updateAlert()},updateAlert:function(){this.alert=this.canSweep&&!this.isPass}});b8e.BindingUtil.bind(e),t.poolCall=!0,b8e.RC("$$game","$$WorldWar2DetailInfo",e)}(),function(){var e=game.teamData.extends({curMode:1,chaMode:1,selectWorldWarId:0,helpNum:0,firstTimes:0,showRecord:!1,isBtnOpen:!1,isWin:!1,curInstBossId:0,showAllBox:!1,ctor:function(){var e=this;e._super(),e.recordType=0,e.instId=0,e._allHelpNum=0,e.worldDetailInfoMap=b8e.HashMap.get(),e.worldDetailInfoArr=[],e.worldWarTypeInfoArr=[],e.worldWarInfoMap=b8e.HashMap.get(),e.openBoxArray=[],e.curTeamInstType=game.TeamInstType.WORLDWAR2_TEAM},allHelpNum:{get:function(){if(this._allHelpNum)return this._allHelpNum;var e=game.InstanceMiscCfg.getData("zhuLuHelpNum");return e&&(this._allHelpNum=+e.value),this._allHelpNum}},createInfos:function(){var e=this;e.worldDetailInfoMap&&e.worldDetailInfoMap.clear(),e.worldDetailInfoArr&&(e.worldDetailInfoArr.length=0),e.worldWarTypeInfoArr&&(e.worldWarTypeInfoArr.length=0),e.worldWarInfoMap&&e.worldWarInfoMap.clear();for(var t=game.WorldWarType,a=void 0,i=void 0,n=void 0,s=void 0,r=void 0,o=t.EASY;o<t.MAX;o++)if(i=game.WorldWar2Cfg.getData(o,!0)){a=[];for(var g=0,u=i.length;g<u;g++)if(i[g]){(s=new game.WorldWarInfo).setCfgData(i[g]);for(var l=0,c=(n=i[g].group).length;l<c;l++)(r=new game.WorldWarDetailInfo).setCfgData(n[l]),s.pushData(r),e.worldDetailInfoArr.push(r),r.modeType=s.modeType,r.idx=l+1,r.worldWarId=s.id,e.worldDetailInfoMap.set(r.id,r);a.push(s),e.worldWarInfoMap.set(s.id,s)}a&&e.worldWarTypeInfoArr.push(a)}},getTypeDetailInfoArr:function(e){var t=game.WorldWarType;return(!e||e<t.EASY||e>t.GOD)&&b8e.error("\u96be\u5ea6\u6a21\u5f0f\u4e0d\u5b58\u5728type\uff1a",e),this.worldWarTypeInfoArr[e-1]},getCurTypeDetailInfoArr:function(){return this.getTypeDetailInfoArr(this.curMode)},synDatas:function(e){this.instId=e.insId,this.chaMode=e.level,this.helpNum=e.helpNum,this.worldWarInsDatas=e.data,this.setCount(e.firstTimes)},firstShow:function(){this.createInfos(),this.synLevelModeData(),this.synInsDatas(this.worldWarInsDatas)},synInsDatas:function(e){if(e)for(var t=void 0,a=0,i=e.length;a<i;a++)t=e[a],this.synInsData(t)},synInsData:function(e){var t=this.worldDetailInfoMap.get(e.id);t&&(t.setData(e),this.updateMaxInsId(e.id),t.updateAlert())},synLevelModeData:function(){for(var e=this.instId,t=null,a=null,i=!1,n=game.WorldWarType.EASY;n<game.WorldWarType.MAX;n++)if(t=this.getTypeDetailInfoArr(n))for(var s=0,r=t.length;s<r;s++){for(var o=0,g=(a=t[s]).infoArr.length;o<g;o++){var u=a.infoArr[o];u&&(e>=u.id&&(u.isPass=!0,u.canSweep=!0,this.updateMaxInsId(u.id)),!i&&e<u.id&&(i=u.canChall=!0),u.updateAlert())}a.updateAlert(),a.updateAllPass()}},resetChallMode:function(){this.curMode=game.WorldWarType.EASY},changeNextChallMode:function(){var e=this.curMode;this.canShowNextMode(e)?this.curMode++:this.curMode=game.WorldWarType.EASY},canShowNextMode:function(e){var t=this.getTypeDetailInfoArr(e);return 7<t.length&&t[7].infoArr[0].isPass},showSwitchType:function(e){var t=this.canShowNextMode(e),a=game.WorldWarType.NONE;return t?a=e+1:e>game.WorldWarType.EASY&&(a=game.WorldWarType.EASY),a},openBox:function(e){var t=void 0;if(0==e)for(var a=(t=this.getWorldWarInfoById(this.selectWorldWarId)).infoArr,i=void 0,n=0,s=a.length;n<s;n++)(i=a[n]).isPass&&!i.openBox&&(i.openBox=!0);else{if(!(t=this.getDetailInfoById(e)))return;t.openBox=!0}},quickSweepAllInst:function(){for(var e=null,t=0,a=this.worldDetailInfoArr.length;t<a;t++)if(e=this.worldDetailInfoArr[t]){if(!e.isPass)break;if(e.canSweep){e.addQuickCount(),e.updateAlert();var i=this.getWorldWarInfoById(e.worldWarId);i&&i.updateData()}}},updateInstPass:function(e){var t=this.getDetailInfoById(e);t&&(t.isPass||this.addCount(),t.isPass=!0,t.canChall=!1,t.quickCount||(t.quickCount=0),t.addQuickCount());var a=this.worldDetailInfoArr.indexOf(t);if(!(a<0||a>=this.worldDetailInfoArr.length)){a++;var i=this.worldDetailInfoArr[a];if(i)this.unlockWorldDetailInfo(i),this.getWorldWarInfoById(i.worldWarId).change();this.getWorldWarInfoById(t.worldWarId).updateAllPass()}},unlockWorldDetailInfo:function(e){e&&(e.isPass||(e.canChall=!0,e.openBox=!1,e.canSweep=!1,e.isPass=!1))},quickSweep:function(e){var t=this.getDetailInfoById(e);if(t){t.addQuickCount();var a=this.getWorldWarInfoById(t.worldWarId);a&&a.updateData()}},quickSweepAll:function(){for(var e=null,t=0,a=this.worldDetailInfoArr.length;t<a;t++)if(e=this.worldDetailInfoArr[t]){if(!e.isPass)break;e.canSweep&&this.quickSweep(e.id)}},getDetailInfoById:function(e){return this.worldDetailInfoMap.get(e)},getCurDetailInfo:function(){return this.getDetailInfoById(this.curInsId)},getWorldWarInfoById:function(e){return this.worldWarInfoMap.get(e)},getDetailInfoArrById:function(e){var t=this.worldWarInfoMap.get(e);return t?t.infoArr:null},initBossList:function(){var e=this.getDetailInfoArrById(this.selectWorldWarId);this.bossInfoList=e},checkWorldWarInfoAlert:function(){for(var e=null,t=game.WorldWarType.EASY;t<game.WorldWarType.MAX;t++)if(e=this.getTypeDetailInfoArr(t))for(var a=0,i=e.length;a<i;a++)if(e[a].alert)return!0;return!1},setCount:function(e){this.firstTimes=e},getCount:function(){return this.firstTimes},addCount:function(e){var t=0<arguments.length&&void 0!==e?e:1;this.firstTimes+=t},completeId:function(e){this.firstTimes<e&&(this.firstTimes=e)},getWorldWarMaxLay:function(){var e=game.InstanceMiscCfg.getData("zhuLuMaxLayer");return e?+e.value:0},getWorldWarMaxInst:function(){var e=game.InstanceMiscCfg.getData("zhuLuMaxInst");return e?+e.value:0},updateMaxInsId:function(e){if(e&&!(this.maxInsId>=e)){var t=this.getDetailInfoById(e);t&&(this.maxInsId=e,this.maxWorldWarId=t.worldWarId)}},checkCurInstByBattle:function(e){var t=this;if(e){var a=t.getWorldWarMaxInst(),i=t.instId;i=t.instId>=a?a:t.instId+1;var n=t.getDetailInfoById(i);n&&(t.selectWorldWarId=n.worldWarId,t.curInstBossId=i,t.initBossList())}else t.curInstBossId=t.instId},checkCurInstByShow:function(e){var t=this.getWorldWarMaxInst(),a=t<=e?t:e+1,i=this.getDetailInfoById(a),n=this.getDetailInfoById(e);return!(!i||!n)&&i.worldWarId==n.worldWarId},getOpenAllBoxCost:function(){var e=game.InstanceMiscCfg.getData("zhuLuOpenBoxCost"),t=this.getWorldWarInfoById(this.selectWorldWarId).infoArr,a=void 0,i=0;this.openBoxArray=[];for(var n=0,s=t.length;n<s;n++)(a=t[n]).isPass&&!a.openBox&&(i+=+e.value,this.openBoxArray.push(a.id));return i}});game.worldWar2Data=game.worldWar2Data||new e}(),function(){var e=game.Control.extends({init:function(){this.gameData=game.worldWar2Data},ipc:function(){this.evts={Instance:{SYNC_INSTANCE_DATA:this.onSyncInstanceData},WorldWar2Team:{C_CHECK_ALERT:this.checkAlert},MainUIChat:{C_REQ_ENTER_TEAM:this.inviteJoin},DifficultSelect:{C2C_SELECT_DIFFICULT:this.selectDifficult}}},checkAlert:function(){},onSyncInstanceData:function(e){var t=e.data;t&&(this.gameData.synDatas(t.zhuLu),this.dpt(this.Evts.C2C_UPDATE_FINISH_COUNT),this.checkAlert())},notify:function(e,t){switch(e){case this.Evts.C_SELECT_WORLDWAR:this.selectWorldWar(t.id),this.gameData.isBtnOpen=t.isBtn;break;case this.Evts.C_SHOW_RECORD:this.showSelectWorldWarRecord(t.id)}},inviteJoin:function(e){var t=e.data;if(t){var a=t.instId,i=this.gameData.getDetailInfoById(a);if(i){var n=i.worldWarId,s=this.gameData.getWorldWarInfoById(n);if(s)if(s.isUnlock())i.isPass||i.canChall?(this.gameData.selectWorldWarId=i.worldWarId,this.gameData.initBossList(),this.dpt(this.Evts.C2C_JOIN_TEAM,t)):game.notice.show(8054);else game.notice.show(8053)}}},selectWorldWar:function(e){if(e)this.gameData.selectWorldWarId=e,this.gameData.initBossList(),game.module.show(game.ME.WorldWar2Team);else;},showSelectWorldWarRecord:function(e){this.gameData.showRecord=!0,this.selectWorldWar(e),this.dpt(this.Evts.C_SHOW_RECORD)},shop_btn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.ZHULU_SHOP)},modeBtn:function(){game.difficultSelectData.curInstType=game.DifficultSelectType.ZHULU,game.module.show(game.ME.DifficultSelect)},selectDifficult:function(e){if(e&&e.data){var t=e.data;t.instType==game.DifficultSelectType.ZHULU&&(this.gameData.curMode=t.difficult,this.send(this.Evts.V_UPDATE_DATA))}}});b8e.module.registerControl(game.ME.WorldWar2,e,game.WorldWar2Evts)}(),function(){var e=game.TeamControl.extends({memberIds:null,showRecord:!1,init:function(){this.curTeamInstType=game.TeamInstType.WORLDWAR2_TEAM,this.memberIds=[],this.teamData=game.worldWar2Data},ipc:function(){var e=this;e.gevts={InstanceEvts:{C2C_WORLD_WAR2_TEAM_STOP_PLAY:e.battleStop}},e.evts={MainRole:{C_LEVEL_UP:e.levelUP},TeamHandel:{C_SET_TEAM:e._setTeamData,C_TEAM_CREATE:e._createTeam,C_TEAM_JOIN:e._joinTeam,C_TEAM_LEAVE:e._leaveTeam,C_KICK_MEMBER:e._kickMember,C_TEAM_QUICK_JOIN:e._quickJoinTeam,C_TEAM_JOIN_NOTIFY:e._joinTeamNotify,C_TEAM_LEAVE_NOTIFY:e._leaveTeamNotify,C_ENTER_BATTLE:e._enterBattle,C_BATTLE_END:e._battleEnd,C_TEAM_RATE:e._teamRate,C2C_TEAM_EMBATTLE:e._teamEmbattle,C2C_TEAM_PARTNER_TEAM_EMBATTLE:e._partnerTeamEmbattle,C2C_TEAM_INVITE_COOL_TIME:e._teamInviteCoolTime},WorldWar2:{C_SHOW_RECORD:e.setShowRecord,C2C_JOIN_TEAM:e.inviteJoin},ZhanJiang:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},ZhaoQin:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},BaoZang:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},Hunting:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},Scene:{ENTER_CS_SCENE:e.stopAutoBattle,C2C_RECONNECT_ENTER_SCENE:e.reconnect}},e.handels={ZhuLuBattleMsg:e.zhuLuBattleEnd,ZhuLuQuickResp:e.zhuLuQuickResp,ZhuLuRecordResp:e.zhuLuRecordResp}},notify:function(e,t,a){var i=this;switch(e){case i.Evts.V_SHOW_VIEW:i.showView();break;case i.Evts.V_KICK_MEMBER:i.kickMember(t);break;case i.Evts.V_JOIN_TEAM:i.joinTeam(t,a);break;case i.Evts.V_SELECT_BOSS:i.selectBoss(t);break;case i.Evts.V_HIDE_VIEW:i.hideView();break;case i.Evts.V2C_TEAM_OPEN_SELECT_PARTNER_PANEL:i.openTeamSelectPartnerPanel(t);break;case i.Evts.V2C_TEAM_CHANGE_BATTLE_PARTNER_REQ:i.partnerTeamEmbattleReq(t);break;case i.Evts.V2C_TEAM_PARTNER_UPDATE_POS_REQ:i.teamPartnerUpdatePosReq();break;case i.Evts.V2C_TEAM_CHECK_TIME:i.checkTime()}},reconnect:function(){this.teamData.clearTeamData(),b8e.module.isShowView(game.ME.WorldWar2TeamDetailsView)&&game.module.hide(game.ME.WorldWar2TeamDetailsView)},setShowRecord:function(){this.teamData.showRecord=!0,this.recordReq()},zhuLuBattleEnd:function(e){var t=this,a=e.readProtobuf(game.pb.ZhuLuBattleNotify);if(0<a.code)game.notice.noticeError(a.code);else{var i=a.insId,n=a.battleLog;t.teamData.helpNum=a.helpNum;var s={type:game.InstanceType.WORLD_WAR_TEAM2,rewards:a.userItem,exp:a.exp,group:1,isEnd:!0};game.playBack.stop(),game.playBack.play(n,s),game.GameViewMgr.inst().hideUnStrongViews(),t.teamData.instId=i,n&&n.win&&(0<i?(t.teamData.updateInstPass(i),t.teamData.updateMaxInsId(i),t.dpt(t.Evts.C2C_UPDATE_FINISH_COUNT)):t.teamData.quickSweepAllInst()),t.send(t.Evts.V_UPDATE_DATA),t.dpt(t.Evts.C_CHECK_ALERT),t.dpt(t.Evts.C2C_CHANGE_TEAM_STATE)}},zhuLuQuickResp:function(e){var t=e.readProtobuf(game.pb.ZhuLuQuickResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id;0!=a?this.teamData.quickSweep(a):this.teamData.quickSweepAll(),this.dpt(this.Evts.C_CHECK_ALERT)}},zhuLuRecordResp:function(e){var t=e.readProtobuf(game.pb.ZhuLuRecordResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.record1,i=t.record2;this.send(game.WorldWar2Evts.V_UPDATE_RECORD,{firstRec:a,fastRec:i})}},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.ZHULU_SHOP)},assistChallengeBtn:function(){this.checkInstCanEnter(this.teamData.curInsId)&&(this.teamData.isInTeam||game.worldWarData.isInTeam?game.notice.show(9622):game.teamLeagueAssistData.canChallenge()&&this.dpt(this.Evts.C2C_TEAMLEAGUE_ASSIST,this.teamData.curInsId))},openTeamSelectPartnerPanel:function(e){this.teamData&&this.teamData.isInTeam&&(this.setCurSelectPartnerId(e),b8e.module.isShowView(game.ME.WorldWar2TeamSelectPartnerView)||game.module.show(game.ME.WorldWar2TeamSelectPartnerView))},checkInstCanEnter:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t;if(this.invInstId=0,!game.TeamInstanceCfg.getData(e))return b8e.error("\u5bf9\u5e94\u7ec4\u961f\u526f\u672c\u914d\u7f6e\u4e0d\u5b58\u5728"),!1;var i=this.teamData.getDetailInfoById(e);return!!i&&(i.isPass||i.canChall?(this.invInstId=e,!0):(a&&game.notice.show(8052),!1))},showTeamInstView:function(){b8e.module.isShowView(game.ME.WorldWar2Team)||game.module.show(game.ME.WorldWar2Team)},hideView:function(){this._super(),this.teamData.showRecord=!1},selectBoss:function(e){this._super(e),this.teamData.showRecord&&this.recordReq(),this.send(this.Evts.V_UPDATE_DATA)},levelUP:function(){this.teamData.refreshBossList(),this.send(this.Evts.V_REFRESH_BOSS_LIST)},_setTeamData:function(e){this._super(e)},_battleEnd:function(e){var t=e.data,a=t.type,i=t.rp;if(a==this.curTeamInstType){var n={type:game.InstanceType.WORLD_WAR_TEAM2,rewards:i.userItem,exp:i.exp};game.playBack.play(i.battlelog,n),game.GameViewMgr.inst().hideUnStrongViews(),this.teamData.teamBattle()}},_partnerTeamEmbattle:function(e){e.data.type==this.curTeamInstType&&(b8e.module.isShowView(game.ME.WorldWar2TeamSelectPartnerView)&&game.module.hide(game.ME.WorldWar2TeamSelectPartnerView),this._super(e))},createTeam:function(e){b8e.module.isShowView(game.ME.WorldWar2TeamDetailsView)||game.module.show(game.ME.WorldWar2TeamDetailsView),this._super(e)},_leaveTeam:function(e,t){t?this._super(e):this.__leaveTeam(e,1)},_leaveTeamNotify:function(e,t){t?this._super(e):this.__leaveTeam(e,2)},__leaveTeam:function(e,t){e.data.type==game.TeamInstType.WORLDWAR2_TEAM&&(1==t?this._leaveTeam(e,!0):2==t&&this._leaveTeamNotify(e,!0),this._openViewState(e))},_openViewState:function(e){var t=e.data.rp;game.mainRoleData.roleId==t.roleid&&(b8e.module.isShowView(game.ME.WorldWar2TeamDetailsView)&&game.module.hide(game.ME.WorldWar2TeamDetailsView),b8e.module.isShowView(game.ME.WorldWar2Team)||game.module.show(game.ME.WorldWar2Team))},showView:function(){var e=this;e._super();var t=0;if(0<e.invInstId)t=e.invInstId;else if(e.teamData.isInTeam){var a=e.teamData.bossInfoList,i=!1;if(a&&0<a.length)for(var n=0;n<a.length;n++)if(a[n].id==e.teamData.curInsId){i=!0;break}i?t=e.teamData.curInsId:a&&0<a.length&&(t=a[0].id)}else{var s=e.teamData.bossInfoList,r=void 0,o=e.teamData.getWorldWarMaxInst();if(!s||s&&s.length<=0)return;for(var g=0;g<s.length;g++)if((r=s[g]).id==e.teamData.maxInsId&&o>r.id){if(e.teamData.checkCurInstByShow(r.id)){t=r.id+1;break}}else t=s[0].id}e.teamData.curInsId=t,e.selectBoss(t)},autoTime:function(){var e=this;0<e.teamData.autoStartTime&&e.teamData.autoStartTime--,0<e.teamData.autoFullStartTime&&e.teamData.autoFullStartTime--,e.teamData.isInTeam?(e.teamData.isFull&&e.teamData.isAutoFullStart&&e.teamData.autoFullStartTime<=0&&(e.startFight(),e.stopAutoTime()),e.teamData.isAutoStart&&e.teamData.autoStartTime<=0&&(e.startFight(),e.stopAutoTime())):(e.autoReqTime++,e.autoReq()),b8e.module.isShowView(e.moduleEnum)||!e.teamData.isAutoStart&&!e.teamData.isAutoFullStart||e.dpt(e.Evts.C_UPDATE_TIME),e.send(e.Evts.V_UPDATE_TIME)},sweepBtn:function(){var e=this.teamData.curInsId;this.sender.ZhuLuQuickReq(e)},quickSweepBtn:function(){this.sender.ZhuLuQuickReq(0)},createrTeamBtn:function(){this.checkInstCanEnter(this.teamData.curInsId)&&this._super()},quickJoinTeamBtn:function(){this.checkInstCanEnter(this.teamData.curInsId)&&this._super()},showRecordBtn:function(){this.teamData.showRecord?(this.teamData.showRecord=!1,this.send(game.WorldWar2Evts.V_UPDATE_RECORD)):(this.teamData.showRecord=!0,this.recordReq()),this.send(this.Evts.V_UPDATE_DATA)},recordReq:function(){var e=this.teamData.curInsId;this.sender.ZhuLuRecordReq(e)},battleStop:function(e){var t=this;if(e){var a=t.data=e.data;a&&a.type==game.InstanceType.WORLD_WAR_TEAM2&&(t.teamData.isWin=a.win,a.isEnd&&(t._worldSelect=t.teamData.selectWorldWarId,t.teamData.checkCurInstByBattle(a.win),t._worldSelect!=t.teamData.selectWorldWarId&&t.send(t.Evts.V_SCROLL_TO_TOP)),t.teamData.curInstBossId&&(t.selectBoss2(t.teamData.curInstBossId),t.checkTime(),t.send(t.Evts.V_SET_TEAM),t.send(t.Evts.C2V_UPDATE_WORLDWAR2_TITLE)))}},quickBuy:function(){this.teamData.showAllBox=!0,game.module.show(game.ME.WorldWar2BoxAward)},assistBtn:function(){},openBoxBtn:function(){this.teamData.showAllBox=!1,game.module.show(game.ME.WorldWar2BoxAward)}}),t=game.Sender.extends({ipc:function(){this.msg={ZhuLuQuickReq:this.zhuLuQuickReq,ZhuLuRecordReq:this.zhuLuRecordReq}},zhuLuQuickReq:function(e){var t=game.pb.ZhuLuQuickRequest;t.id=e,this.write(t)},zhuLuRecordReq:function(e){var t=game.pb.ZhuLuRecordRequest;t.id=e,this.write(t)}}),a=[game.ME.WorldWar2TeamDetailsView,game.ME.WorldWar2TeamSelectPartnerView];b8e.module.registerControl(game.ME.WorldWar2Team,e,game.TeamEvts,t,a)}(),function(){var e=game.Control.extends({init:function(){this.gameData=game.worldWar2Data},ipc:function(){this.handels={ZhuLuOpenBoxResp:this.zhuLuOpenBoxResp}},zhuLuOpenBoxResp:function(e){var t=e.readProtobuf(game.pb.ZhuLuOpenBoxResponse);if(0<t.code)game.notice.noticeError(t.code);else{for(var a=t.id,i=0,n=a.length;i<n;i++)game.worldWar2Data.openBox(a[i]);game.module.hide(game.ME.WorldWar2BoxAward)}},notify:function(){},openAllBox:function(){var e=game.worldWar2Data.getOpenAllBoxCost();if(game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,e)&&!game.UpgradeUtil.checkEquipTooMuch()){var t=game.worldWar2Data.openBoxArray;t.length<1?game.notice.show(9681):this.sender.ZhuLuOpenBoxReq(t)}},openBoxBtn:function(){if(game.worldWar2Data.showAllBox)this.openAllBox();else{var e=game.InstanceMiscCfg.getData("zhuLuOpenBoxCost");if(game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,e.value))if(!game.UpgradeUtil.checkEquipTooMuch())game.worldWar2Data.getCurDetailInfo().openBox||this.sender.ZhuLuOpenBoxReq([game.worldWar2Data.curInsId])}}}),t=game.Sender.extends({ipc:function(){this.msg={ZhuLuOpenBoxReq:this.zhuLuOpenBoxReq}},zhuLuOpenBoxReq:function(e){var t=game.pb.ZhuLuOpenBoxRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.WorldWar2BoxAward,e,game.WorldWar2Evts,t)}(),function(){var e=game.Control.extends({sureBtn:function(){game.module.hide(game.ME.WorldWar2HelpTip)}});b8e.module.registerControl(game.ME.WorldWar2HelpTip,e,game.WorldWar2Evts)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1126),this.setSize(120,120)},setData:function(e){this.data=e,this.skin.scelect.active=e.isSelect,this.skin.finish.active=e.isPass,this.skin.point.string=e.idx},choose:function(){this.send(game.TeamEvts.V_SELECT_BOSS,this.data.id)}}),b8e.RC("$$game","$$WorldWar2DetailItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1122),this.setSize(599,168)},init:function(){var e=this,t=e.itemBg=b8e.Sprite.get();t.setAnchor(0,1),t.addToParent(e.skin.bgNode),(e.model=b8e.SceneEntity.get()).addToParent(e.skin.modelNode)},setData:function(){var e=this.data,t=this,a=t.skin,i=e.cfg,n=game.TeamInstanceCfg.getData(i.group[0]);a.levelLab.string=i.name;var s=game.ResCfg.getUrl(100,i.bgImg);t.itemBg.loadTexture(s),a.pass.node.active=e.isAllPass,a.enterBtn.node.active=e.isUnlock(),this.updateModel(n.monGroup)},updateModel:function(e){var n=this;if(e&&!(e.length<1)){var t=void 0;t=e.length<3?e[0]:e[2],game.CfgUtil.getMonsterCfgByMonGroup(t,1,function(e){var t=game.AvatarUtil.getUIModel(e,0,!1),a=game.ResCfg.getUrl(5e3,t),i=n.model.getAnimator(game.AnimType.BOSS,1);(i=i||n.model.addAnimator(game.AnimType.BOSS,1))&&(i.load(a),i.play()),n.setElementBtn(e)},n)}},showRecordBtn:function(){this.send(game.WorldWar2Evts.C_SHOW_RECORD,{id:this.data.id})},enterBtn:function(){game.worldWar2Data.isInTeam?b8e.module.isShowView(game.ME.WorldWar2TeamDetailsView)||game.module.show(game.ME.WorldWar2TeamDetailsView):this.send(game.WorldWar2Evts.C_SELECT_WORLDWAR,{id:this.data.id,isBtn:!0})},setElementBtn:function(e){if(e){var t=this.skin;e.element?(this.elementAttr=e.element,t.view_elementBtn.active=!0,t.view_elementBtn.loadTexture(game.ResCfg.getUrl(10050,e.element))):t.view_elementBtn.active=!1}},view_elementBtn:function(){this.elementAttr&&(game.elementData.setElementInfo(this.elementAttr,50369,this.skin.view_elementBtn.localToGlobal(),!1),game.module.show(game.ME.ElementAttr))}}),b8e.RC("$$game","$$WorldWar2Item",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1127),this.spotAlerts={SHOP_WORLDWAR2:this.shopAlert}},shopAlert:function(e){this.skin.shop_spot.active=e.alert},init:function(){var e=this.levelList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.WorldWar2Item,e.bindEnum=this.moduleEnum,e.layout.paddingLeft=0,e.addToParent(this.skin.levelList),game.worldWar2Data.firstShow()},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateData()}},onShow:function(){this.updateData()},updateData:function(){var e=this.skin,t=game.worldWar2Data.getCurTypeDetailInfoArr();this.levelList.setData(t);var a=game.worldWar2Data.curMode,i=game.ResCfg.getUrl(101,a);e.modeBtn.loadTexture(i)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.WorldWar2,e)}(),function(){var e=game.TeamView.extends({allHelpNum:0,ctor:function(){this._super(1128),this.spotAlerts={SHOP_WORLDWAR2:this.shopAlert}},shopAlert:function(e){this.skin.redPoint.node.active=e.alert},init:function(){var e=this;e.teamData=game.worldWar2Data,e.curTeamInstType=game.TeamInstType.WORLDWAR2_TEAM,e._super(),e.prizeList1=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.prizeList1.itemRender=[game.ShowItemListItem,game.ShowEquipListItem,game.ShowFosterEquipListItem],e.prizeList1.bindEnum=e.moduleEnum,e.prizeList1.layout.paddingLeft=-10,e.prizeList1.layout.spacingX=17,e.prizeList1.layout.paddingTop=9,e.prizeList1.addToParent(e.skin.prizeNode),e.bossList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e.bossList.itemRender=game.WorldWar2DetailItem,e.bossList.bindEnum=e.moduleEnum,e.bossList.layout.spacingX=30,e.bossList.layout.spacingY=-12,e.bossList.layout.paddingLeft=18,e.bossList.addToParent(e.skin.bossList);var t=game.InstanceMiscCfg.getData("zhuLuHelpNum");t&&(e.allHelpNum=+t.value),e.skin.contentBg.loadTexture(game.ResCfg.getUrl(5047)),e.bossPointList=[],e.pointInfoList=[]},onShow:function(){this._super(),this.updateData(!0),this.skin.recordNode.active=!1,this.skin.teamView.active=!0},setTeamBossList:function(){this.bossInfoList=this.teamData.getBossInfoList(),this.bossList.setData(this.bossInfoList)},setAutoBtns:function(){this.skin.quickBuy.active=!1,this.teamData.isInTeam||this.updateData()},notify:function(e,t){var a=this;switch(a._super(e,t),e){case a.Evts.V_UPDATE_DATA:a.updateData(a.teamData.curInstBossId==a.teamData.curInsId);break;case game.WorldWar2Evts.V_UPDATE_RECORD:a.updateRecord(t);break;case a.Evts.V_SCROLL_TO_TOP:a.scrollReflash(0);break;case a.Evts.C2V_UPDATE_WORLDWAR2_TITLE:a.updateTitle()}},setCount:function(){},updateData:function(e){var t=0<arguments.length&&void 0!==e&&e,a=this,i=a.skin,n=a.teamData.selectWorldWarId;if(a.teamData.getWorldWarInfoById(n)){var s=a.teamData.curInsId,r=a.teamData.getDetailInfoById(s);if(r){var o=a.teamData.firstTimes>=r.id-7e3,g=r.canSweep&&r.isPass,u=r.isPass?r.canSweep||r.canChall:!r.isPass,l=r.isPass?!r.canSweep&&!r.canChall&&!r.openBox:r.isPass,c=a.teamData.showRecord;i.noTeamLab.active=a.teamInfoList.length<1,i.teamNode.active=!g&&!c&&o,i.passLab.active=!o&&!a.teamData.showRecord,i.teamList.active=!c&&o,i.sweepNode.active=g&&!c,i.openBoxBtn.active=l,i.quickBuy.active=l&&a.teamInfoList.length<1,i.already_got.active=r.openBox&&r.isPass,i.prizeNode.active=u;r.cfg;var h=a.allHelpNum-a.teamData.helpNum;h=0<h?h:0,i.awardCountLab.string=game.Lang.get(3004,h,a.allHelpNum);var m="";m=r.canSweep||r.canChall||!r.isPass?g?game.Lang.get(10010):game.Lang.get(10011):game.Lang.get(8222),i.hintLab_1.string=m,g?a.setPointAward():a.setBoxAward(),t&&a.scrollReflash(r.idx)}}},updateTitle:function(){},updateRecord:function(e){var t=this.skin;if(t.passLab.active=!1,!e)return t.showRecordBtn.string=game.Lang.get(8058),t.recordNode.active=!1,void(t.teamView.active=!0);t.firstRecord.active=!0,t.fastRecord.active=!0,t.noFirstRecord.active=!1,t.noFastRecord.active=!1,this.updateRecordByType(1,e.firstRec),this.updateRecordByType(2,e.fastRec),t.recordNode.active=!0,t.teamView.active=!1,t.showRecordBtn.string=game.Lang.get(8059)},updateRecordByType:function(e,t){var a=this.skin;t?(this.getComponent("teamInfo"+e).string=t.team,this.getComponent("roundLab"+e).string=t.rounds,this.getComponent("timeLab"+e).string=b8e.TimeUtil.formatTimestamp(t.time)):1==e?(a.firstRecord.active=!1,a.noFirstRecord.active=!0):2==e&&(a.fastRecord.active=!1,a.noFastRecord.active=!0)},setBoxAward:function(){var e=this.teamData.getPrizeFirstList();this.prizeList1.setData(e)},setPointAward:function(){var r=this,e=r.teamData.getCurDetailInfo();if(e){var o=0,g=e.cfg,t=g.dropId;game.MonDropCfg.getItems(t,function(e){if(e){for(var t=void 0,a=void 0,i=0,n=e.length;i<n;i++)t=game.ItemInfoCfg.getData(e[i]),(a=r.pointInfoList[o])?a.setData(t.id,0):((a=new game.PrizeInfo).setData(t.id,0),r.pointInfoList[o]=a),o++;if(o<r.pointInfoList.length){var s=r.pointInfoList.length-o;r.pointInfoList.splice(o,s)}r.prizeList1.setData(r.pointInfoList)}else b8e.error("\u9010\u9e7f\u4e2d\u539fid: ",g.id,"\u6389\u843d\u5305\u4e0d\u5b58\u5728")},r)}},closeBtn:function(){game.module.hide(this.moduleEnum)},returnBtn:function(){game.module.hide(this.moduleEnum)},scrollReflash:function(e){var t=120*Math.floor((e-1)/4);this.bossList.scrollToPos({x:0,y:t})}});b8e.module.registerView(game.ME.WorldWar2Team,e)}(),function(){var e=game.TeamDetailsView.extends({ctor:function(){this._super(),this.bindModuleEnum=game.ME.WorldWar2Team},init:function(){this._super(),this.teamData=game.worldWar2Data,this.curTeamInstType=game.TeamInstType.WORLDWAR2_TEAM},onHide:function(){this._super(),b8e.module.isShowView(game.ME.WorldWar2Team)&&game.module.hide(game.ME.WorldWar2Team)}});b8e.module.registerView(game.ME.WorldWar2TeamDetailsView,e)}(),function(){var e=game.TeamSelectPartnerView.extends({ctor:function(){this._super(),this.bindModuleEnum=game.ME.WorldWar2Team}});b8e.module.registerView(game.ME.WorldWar2TeamSelectPartnerView,e)}(),function(){var e=game.View.extends({prizeInfoList:null,_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1125),this.prizeInfoList=[]},notify:function(e){},init:function(){this.gridList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.gridList.itemRender=game.WorldWarBoxItem,this.gridList.addToParent(this.skin.scrollGrid),this.gridList.layout.spacingX=40,this.gridList.layout.spacingY=21},onShow:function(){this.setPrizeList()},setPrizeList:function(){var r=this,e=game.worldWar2Data.getCurDetailInfo();if(e){var o=0,g=e.cfg,t=g.boxDropId;game.MonDropCfg.getItems(t,function(e){if(e){for(var t=void 0,a=void 0,i=0,n=e.length;i<n;i++)t=game.ItemInfoCfg.getData(e[i]),(a=r.prizeInfoList[o])?a.setData(t.id,0):((a=new game.PrizeInfo).setData(t.id,0),r.prizeInfoList[o]=a),o++;if(o<r.prizeInfoList.length){var s=r.prizeInfoList.length-o;r.prizeInfoList.splice(o,s)}r.gridList.setData(r.prizeInfoList)}else b8e.error("\u9010\u9e7f\u4e2d\u539fid: ",g.id,"\u6389\u843d\u5305\u4e0d\u5b58\u5728")},r);var a=game.InstanceMiscCfg.getData("zhuLuOpenBoxCost");if(game.worldWar2Data.showAllBox){var i=game.worldWar2Data.getOpenAllBoxCost(),n=i/a.value;r.skin.tipLab_1.string=i,r.skin.tipsLab_3.string=game.Lang.get(8060,n)}else r.skin.tipLab_1.string=a.value,r.skin.tipsLab_3.string=""}}});b8e.module.registerView(game.ME.WorldWar2BoxAward,e)}(),function(){var e=game.View.extends({_itemGrid:null,_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1129)},init:function(){this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.prizeList.itemRender=[game.ShowItemListItem,game.ShowEquipListItem,game.ShowFosterEquipListItem],this.prizeList.bindEnum=this.moduleEnum,this.prizeList.addToParent(this.skin.prizeList),this.pointInfoList=[]},onShow:function(){this.updataPage()},updataPage:function(){for(var e=game.worldWar2Data.curInsId,t=game.TeamInstanceCfg.getData(e).helpAward,a=void 0,i=void 0,n=void 0,s=0,r=0,o=t.length;r<o;r++)(n=t[r])&&(a=game.ItemInfoCfg.getData(n.Id),this.pointInfoList[s]?this.pointInfoList[s].setData(a.id,0):((i=new game.PrizeInfo).setData(a.id,0),this.pointInfoList[s]=i),s++);if(s<this.pointInfoList.length){var g=this.pointInfoList.length-s;this.pointInfoList.splice(s,g)}this.prizeList.setData(this.pointInfoList)}});b8e.module.registerView(game.ME.WorldWar2HelpTip,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_LEFT_BTN:-1,C2V_RIHGT_BTN:-1,C2V_RECHARGE_SUCCESS:-1,C2C_RECHARGE:-1,C2V_OPEN_LIST:-1,C2C_REFRESH_BTNS:-1,C2V_SELECT_GROUP:-1,V2C_SELECT_BTN:-1,V2C_SHOW_VIEW:-1,V2C_REFRESH_VIEW:-1}),b8e.RC("$$game","$$ChainGiftEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,select:!1,setData:function(e,t){this.group=e,this.btnImg=t}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ChainGiftBtnInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super()},curIndex:{get:function(){return this._curIndex},set:function(e){this._curIndex=e}},curGroup:{get:function(){return this._curGroup},set:function(e){this._curGroup=e}},_curIndex:0,_curGroup:0,initList:function(){var e=this,t=game.KeepPrizeCfg.getDatas();if(t&&!(t.length<1)){e.groupMap=b8e.HashMap.get(),e.infoMap=b8e.HashMap.get(),e.dayMap=b8e.HashMap.get(),e.rechargeMap=b8e.HashMap.get();for(var a=void 0,i=void 0,n=void 0,s=void 0,r=t.length,o=0;o<r;o++){if(a=t[o])(s=new game.ChainGiftInfo).setData(a),e.infoMap.set(s.id,s),(i=e.dayMap.get(s.openDay))||(i=[],e.dayMap.set(s.openDay,i)),i.push(s),s.getIsOpen()&&((n=e.groupMap.get(s.group))||(n=[],e.groupMap.set(s.group,n)),n.push(s),e.rechargeMap.set(s.rechargeId,s))}e.setOpenList(),e.checkBuyState(),e.sortList()}},resetDaily:function(){var n=this;if(n.dayMap){n.groupMap||(n.groupMap=b8e.HashMap.get()),n.rechargeMap||(n.rechargeMap=b8e.HashMap.get()),n.groupMap.clear(),n.rechargeMap.clear();var s=game.miscData.openServerDay,r=void 0,o=void 0;n.dayMap.forEach(function(e,t){if(!(s<e)&&t&&!(t.length<1))for(var a=t.length,i=0;i<a;i++)(o=t[i])&&o.getIsOpen()&&(n.rechargeMap.set(o.rechargeId,o),(r=n.groupMap.get(o.group))||(r=[],n.groupMap.set(o.group,r)),r.push(o))},n),n.setOpenList(),n.sortList();var e=n.groupMap.get(n._curGroup);if(!e||e.length<1){var t=n.getOpenList();if(!t||t.length<1)return!1;n._curGroup=t[0].group,n.selectGroup(n._curGroup)}return!0}},sortList:function(){var a=this;a.groupMap&&a.groupMap.forEach(function(e,t){t.sort(a.onSort)},a)},onSort:function(e,t){return e.sort-t.sort},setAwards:function(e){e&&(this.awards=e,this.checkBuyState())},checkBuyState:function(){var a=this;if(a.groupMap&&a.awards&&!(a.awards.length<1)){var i=void 0,n=void 0,s=void 0;a.groupMap.forEach(function(e,t){if(t&&!(t.length<1))for(n=t.length,i=0;i<n;i++)(s=t[i]).isBuy=-1<a.awards.indexOf(s.id)},a)}},setRechargeId:function(e){if(!this.rechargeMap)return!1;var t=this.rechargeMap.get(e);return!!t&&(t.isBuy=!0)},getInfoByIndex:function(e,t){if(!this.groupMap)return null;var a=this.groupMap.get(e);return!a||a.length<1?null:a[t]},getCurInfo:function(){return this.getInfoByIndex(this._curGroup,this._curIndex)},getNextIsOpen:function(){var e=this.getCurInfo();return!!e&&(!!this.hasNext()&&e.isBuy)},hasNext:function(){if(!this.groupMap)return!1;var e=this.groupMap.get(this._curGroup);return!(!e||e.length<1)&&this._curIndex+1<e.length},selectPage:function(e){this._curIndex=e},selectGroup:function(e){var t=this,a=void 0;if(t.openGroupMap&&(t._curGroup&&(a=t.openGroupMap.get(t._curGroup))&&(a.select=!1),t._curGroup=e,(a=t.openGroupMap.get(e))&&(a.select=!0,t.groupMap))){var i=t.groupMap.get(e);if(i&&!(i.length<1)){for(var n=i.length,s=0;s<n;s++)if(0==i[s].isBuy)return void(t._curIndex=s);t._curIndex=0}}},checkOpenByGroup:function(e,t){if(!this.groupMap)return!1;var a=this.groupMap.get(e);if(!a||a.length<1)return!1;for(var i=void 0,n=a.length,s=0;s<n;s++)if(!(i=a[s]).isBuy)return i.rechargeId==t;return!1},setOpenList:function(){var e=this;if(e.groupMap){e.openGroupMap||(e.openGroupMap=b8e.HashMap.get()),e.openGroupMap.clear(),e.openList||(e.openList=[]),e.openList.length=0;var t=e.groupMap.values();if(t&&!(t.length<1)){var a,i=void 0,n=void 0;e.openPool||(e.openPool=[]);var s=void 0,r=void 0;for(a=t.length,i=0;i<a;i++)r=t[i],e.openPool[i]||(e.openPool[i]=new game.ChainGiftBtnInfo),n=e.openPool[i],!r||r.length<1||(s=r[0].group,n.setData(s,r[0].btnImg),e.openList.push(n),e.openGroupMap.set(s,n))}}},getOpenList:function(){return this.openList?this.openList:null}});game.chainGiftData=game.chainGiftData||new e}(),function(){var e;e=b8e.Object.extends({isBuy:!1,ctor:function(){this._super()},setData:function(e){var t=this;if(e){t.cfg=e,t.id=e.id,t.name=e.name,t.buyDesc=e.buyDesc,t.group=e.group,t.rechargeId=e.rechargeId,t.sort=e.sort,t.serverStart=e.serverStart,t.serverEnd=e.serverEnd,t.boxImg=e.boxImg,t.bannerLab=e.bannerLab,t.btnImg=e.btnImg,t.gameChannelIdOpen=t.getGameChannelIdOpen(e.gameChannelIdState);var a=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd hh:mm:ss").getTime();a=a/1e3>>0,t.startTime=1e3*a;var i=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime();i=i/1e3>>0,t.endTime=1e3*i,t.isInitPrize=!1,t.openDay=game.TimeUtil.getOpenDayByStr(e.startTime)}},getPrizeList:function(){var e=this;if(e.award&&e.isInitPrize)return e.award;if(e.isInitPrize=!0,e.award||(e.award=[]),!e.cfg)return e.award;var t=e.cfg.giveItems;if(!t||t.length<1)return e.award;for(var a,i=t.length,n=0;n<i;n++)a=t[n],e.award[n]=game.ItemUtil.createBaseItemInfo(a.Id,a.Num,e.award[n]),e.award[n].iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM;return e.award},getIsOpen:function(){var e=game.SysTime.curTime;return!!this.gameChannelIdOpen&&(!(this.startTime>e||this.endTime<=e)&&(!(0<this.serverStart&&this.openDay<this.serverStart)&&!(0<this.serverEnd&&this.openDay>=this.serverEnd)))},getGameChannelIdOpen:function(e){if(!e)return!0;var t=e.split("|");if(!t||t.length<2)return b8e.error("\u8fde\u73af\u793c\u5305\u914d\u7f6e\u683c\u5f0f\u9519\u8bef:"+e),!1;var a=1==+t[0],i=t[1].split(",");if(!i||i.length<1)return b8e.error("\u8fde\u73af\u793c\u5305\u914d\u7f6e\u683c\u5f0f\u9519\u8bef:"+e),!1;var n=game.LoginConfig.getGameChannelId()+"";return a==-1<i.indexOf(n)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ChainGiftInfo",e)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.initRecharge,C_RECHARGE_SUCCESS:this.rechargeSuccess},MainRole:{C_INIT_SERVER_DATA:this.initServerData,C_RESET_DAILY:this.resetDaily}}},notify:function(e,t){switch(e){case this.Evts.V2C_SELECT_BTN:game.chainGiftData.selectGroup(t),this.send(this.Evts.C2V_SELECT_GROUP);break;case this.Evts.V2C_SHOW_VIEW:game.module.showTab(game.ME.ChainGift,game.ME.ChainGiftMain),b8e.module.isShowView(game.ME.ChainGift)&&this.send(this.Evts.V2C_REFRESH_VIEW)}},triggerOpen:function(e){e==this.moduleEnum&&this.initOpenDay&&!this.initData&&(this.initData=!0,game.chainGiftData.initList(),this.dpt(this.Evts.C2C_REFRESH_BTNS))},initServerData:function(){this.initOpenDay=!0,game.moduleOpen.checkOpen(this.moduleEnum)&&(this.initData=!0,game.chainGiftData.initList(),this.dpt(this.Evts.C2C_REFRESH_BTNS))},resetDaily:function(){game.chainGiftData.resetDaily()||b8e.module.isShowView(game.ME.ChainGiftMain)&&game.module.hide(game.ME.ChainGiftMain),this.send(this.Evts.C2V_OPEN_LIST),this.dpt(this.Evts.C2C_REFRESH_BTNS)},initRecharge:function(){game.chainGiftData.setAwards(game.rechargeData.keepPrize)},rechargeSuccess:function(e){if(e&&e.data){var t=e.data;if(t.id)game.chainGiftData.setRechargeId(t.id)&&this.send(this.Evts.C2V_RECHARGE_SUCCESS)}},leftBtn:function(){0<game.chainGiftData.curIndex&&(game.chainGiftData.curIndex--,this.send(this.Evts.C2V_LEFT_BTN))},rightBtn:function(){game.chainGiftData.getNextIsOpen()?(game.chainGiftData.curIndex++,this.send(this.Evts.C2V_RIHGT_BTN)):game.notice.show(8055)},buyBtn:function(){var e=game.chainGiftData.getCurInfo();if(e&&!e.isBuy){var t=game.RechargeCfg.getDataById(e.rechargeId);t&&t.rechargeType==game.RechargeType.KEEP_PRIZE?this.dpt(this.Evts.C2C_RECHARGE,e.rechargeId):game.notice.show(8056)}}}),t=[game.ME.ChainGiftMain];b8e.module.registerControl(game.ME.ChainGift,e,game.ChainGiftEvts,null,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(137)},notify:function(e){var t=this;if(t.curInfo=game.chainGiftData.getCurInfo(),t.curInfo)switch(e){case t.Evts.C2V_LEFT_BTN:case t.Evts.C2V_RIHGT_BTN:case t.Evts.C2V_SELECT_GROUP:case t.Evts.V2C_REFRESH_VIEW:case t.Evts.C2V_OPEN_LIST:t.updatePage();break;case t.Evts.C2V_RECHARGE_SUCCESS:return t.updateBuyBtn(),void t.updateRightBtn()}},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=37.5,e.addToParent(this.skin.prizeList),this.timer=b8e.Timer.add(this,this.updateTime,500)},onShow:function(){this.updatePage(),this.timer.reset(),this.timer.start()},onHide:function(){this.stopTime()},updatePage:function(){var e=this;e.curInfo=game.chainGiftData.getCurInfo(),e.curInfo&&(e.updateBannerLab(),e.updateBoxImg(),e.updateBuyBtn(),e.updateLeftBtn(),e.updateRightBtn(),e.updatePrizeList(),e.endTime=e.curInfo.endTime)},updateLeftBtn:function(){this.skin.leftBtn.active=0<game.chainGiftData.curIndex},updateRightBtn:function(){if(game.chainGiftData.hasNext()){this.skin.rightNode.active=!0;var e=game.chainGiftData.getNextIsOpen();this.skin.rightBtnLab.active=!e}else this.skin.rightNode.active=!1},updateBuyBtn:function(){if(!this.curInfo)return this.skin.buyBtn.active=!1,void(this.skin.getInfo.active=!1);this.skin.buyBtnLab.string=this.curInfo.buyDesc;var e=this.curInfo.isBuy;this.skin.buyBtn.active=!e,this.skin.getImg.active=e},updatePrizeList:function(){var e=this.curInfo.getPrizeList();this.prizeList.setData(e)},updateBoxImg:function(){var e=game.ResCfg.getImgUrl(this.curInfo.boxImg);this.skin.boxImg.loadTexture(e)},updateBannerLab:function(){var e=game.ResCfg.getImgUrl(this.curInfo.bannerLab);this.skin.bannerLab.loadTexture(e)},updateTime:function(){if(!this.endTime){return this.skin.time.string=game.Lang.get(9053),void this.stopTime()}var e=this.endTime-game.SysTime.curTime;if(e<=0){return this.skin.time.string=game.Lang.get(9053),void this.stopTime()}this.skin.time.string=game.TimeUtil.formatTimeSpace(e)},stopTime:function(){if(this.timer){this.timer.stop()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ChainGift,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(136)},init:function(){var e=this.btns=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ChainServerBtnItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.ChainGift,e.layout.spacingX=15},notify:function(e){switch(e){case this.Evts.C2V_OPEN_LIST:this.updatePage()}},onShow:function(){this.updatePage(),this.send(this.Evts.V2C_SHOW_VIEW)},updatePage:function(){this.btnInfos=game.chainGiftData.getOpenList();var e=this.btnInfos&&5<this.btnInfos.length;this.skin.viewLeftBtn.active=e,this.skin.viewRightBtn.active=e,this.btns.setData(this.btnInfos)},viewLeftBtn:function(){this.btns.scrollContainerLeft()},viewRightBtn:function(){this.btns.scrollContainerRight()}});b8e.module.registerView(game.ME.ChainGiftMain,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1),this.setSize(86,96)},init:function(){var e=this.btn=b8e.Sprite.get();e.addToParent(this.skin.titleImg),e.setAnchor(.5,.5),this.skin.alert.node.active=!1},setData:function(){var e=this.data;this.skin.titleImgSelect.node.active=e.select;var t=game.ResCfg.getImgUrl(e.btnImg);this.btn.loadTexture(t)},onClickBtn:function(){this.send(game.ChainGiftEvts.V2C_SELECT_BTN,this.data.group)}}),b8e.RC("$$game","$$ChainServerBtnItem",e)}(),function(){var e;e=b8e.Enum({C2V_SELECT_PRIZE:b8e.enc(),C2V_UPDATA_VIEW:b8e.enc(),V2C_GET_AWARD:b8e.enc(),C2C_GET_AWARD:b8e.enc()}),b8e.RC("$$game","$$DailyFuLiEvts",e)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.dailyDataReq}},this.handels={DailyDataResp:this.dailyModel,DailyTaskMsg:this.onExperienceNotify}},init:function(){this.sender.DailyDataReq()},dailyDataReq:function(){this.sender.DailyDataReq()},dailyModel:function(e){var t=e.readProtobuf(game.pb.DailyModel);this.dpt(this.Evts.C_INIT_MODULE,t)},onExperienceNotify:function(e){var t=e.readProtobuf(game.pb.DailyTaskNotify);0<t.code?game.notice.noticeError(t.code):this.dpt(this.Evts.C2C_TASK_PROGRESS,t)},btn_1:function(){this.send(this.Evts.V_SELECT_CHANGE,0)},btn_6:function(){this.send(this.Evts.V_SELECT_CHANGE,1)},btn_2:function(){this.send(this.Evts.V_SELECT_CHANGE,2)},btn_3:function(){this.send(this.Evts.V_SELECT_CHANGE,3)},btn_4:function(){this.send(this.Evts.V_SELECT_CHANGE,4)},btn_5:function(){this.send(this.Evts.V_SELECT_CHANGE,5)},selectToggle:function(e){this.send(this.Evts.V_SELECT_CHANGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={DailyDataReq:null}}});b8e.module.registerControl(game.ME.DailyFuLi,e,game.DailyEvts,t)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={DailyFuLi:{C_INIT_MODULE:this.initModule}},this.handels={ExperienceAwardResp:this.experienceAwardResp}},initModule:function(e){e&&e.data&&(game.dailyFuLiData.setup(e.data),game.dailyFuLiData.updataShowAward(),this.dpt(this.Evts.C2C_GET_AWARD))},notify:function(e,t){switch(e){case this.Evts.V2C_GET_AWARD:this.getAward(t)}},experienceAwardResp:function(e){var t=e.readProtobuf(game.pb.ExperienceAwardResponse);0<t.code?game.notice.noticeError(t.code):(game.dailyFuLiData.setAwardGet(t),this.send(this.Evts.C2V_UPDATA_VIEW),this.dpt(this.Evts.C2C_GET_AWARD),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))},getAward:function(e){this.sender.ExperienceAwardReq(e.lv,0==e.tag)},btn1:function(){this.send(this.Evts.C2V_SELECT_PRIZE,0)},btn2:function(){this.send(this.Evts.C2V_SELECT_PRIZE,1)}}),t=game.Sender.extends({ipc:function(){this.msg={ExperienceAwardReq:this.experienceAwardReq}},experienceAwardReq:function(e,t){var a=game.pb.ExperienceAwardRequest;a.id=e,a.isStage=t,this.write(a)}});b8e.module.registerControl(game.ME.DailyOfficial,e,game.DailyFuLiEvts,t)}(),function(){var e;e=b8e.Object.extends({tag:0,lv:0,name:0,award:null,isCanGet:!1,isGet:!1,setData:function(e){this.lv=e.lv,this.name=e.name},setGet:function(e){this.isGet=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$DailyOfficialInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.officialAward=b8e.HashMap.get(),this.dailyAward=b8e.HashMap.get()},setup:function(e){this.stageAwards=e.experienceStageAwards,this.dailyAwards=e.experienceDailyAwards},setAwardGet:function(e){(e.isStage?this.officialAward.get(e.id):this.dailyAward.get(e.id)).setGet(!0)},updataShowAward:function(){for(var e=game.DailyExploitCfg.getDatas(),t=void 0,a=void 0,i=void 0,n=0,s=e.length;n<s;n++)(t=e[n])&&(t.stageAward&&0<t.stageAward.length&&((a=new game.DailyOfficialInfo).setData(t),a.tag=0,a.award=t.stageAward,a.isCanGet=game.dailyExploitData.experienceLv>=t.lv,a.setGet(-1!=this.stageAwards.indexOf(t.lv)),this.officialAward.set(t.lv,a)),t.dailyAward&&0<t.dailyAward.length&&((i=new game.DailyOfficialInfo).setData(t),i.tag=1,i.award=t.dailyAward,i.isCanGet=game.dailyExploitData.experienceLv>=t.lv,i.setGet(-1!=this.dailyAwards.indexOf(t.lv)),this.dailyAward.set(t.lv,i)))},getOfficicalAwards:function(){var e=this.officialAward.values();return e.sort(this.sortAward),e},getDailyAwards:function(){var e=this.dailyAward.values();return e.sort(this.sortAward),e},sortAward:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.lv-t.lv},getAwardsByLv:function(e,t){for(var a=game.DailyExploitCfg.getData(e),i=[],n=0==t?a.stageAward:a.dailyAward,s=void 0,r=void 0,o=0,g=n.length;o<g;o++)s=game.ItemInfoCfg.getData(n[o]),(r=new game.PrizeInfo).setData(s.id,0),i.push(r);return i},checkAlert:function(){var e=this.getOfficicalAwards();return!!this.checkAlertList(e)||(e=this.getDailyAwards(),!!this.checkAlertList(e))},checkAlertList:function(e){if(e){for(var t=e.length,a=void 0,i=!1,n=0;n<t;n++)(a=e[n])&&(a.isCanGet=game.dailyExploitData.experienceLv>=a.lv,!a.isCanGet||a.isGet||i||(i=!0));return i}}});game.dailyFuLiData=game.dailyFuLiData||new e}(),function(){var e=game.View.extends({ctor:function(){this._super(295),this.toggles={toggle_btn_1:game.ME.DailyExploit,toggle_btn_6:game.ME.WeeklyExp,toggle_btn_2:game.ME.Achieve,toggle_btn_3:game.ME.TaoFaPage,toggle_btn_4:game.ME.Military},this.spotAlerts={DAILY_EXPLOIT:this.dailyExploitAlert,WEEKLY_TASK:this.weeklyAlert,ACHIEVE_ALERT:this.achieveAlert,TAO_FA_ALERT:this.taofaAlert,MILITARY_ALERT:this.militaryAlert}},onShow:function(){game.achievementData.firstShow(),this.toggleSelect(0)},dailyExploitAlert:function(e){this.skin.red_spot_1.active=e.alert},weeklyAlert:function(e){this.skin.red_spot_6.active=e.alert},achieveAlert:function(e){this.skin.red_spot_2.active=e.alert},taofaAlert:function(e){this.skin.red_spot_3.active=e.alert},militaryAlert:function(e){this.skin.red_spot_4.active=e.alert},recRecoveryAlert:function(e){this.skin.red_spot_5.active=e.alert},notify:function(e,t){switch(e){case this.Evts.V_SELECT_CHANGE:this.toggleSelect(t)}},toggleSelect:function(e){this._super(e)&&(this.skin.title_achieve.active=2==e,this.skin.title_taofa.active=3==e,this.skin.title_military.active=4==e,this.skin.title_resrec.active=5==e)},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.DailyFuLi,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(297)},init:function(){var e=this;e._officialList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._officialList.itemRender=game.DailyOfficialItem,e._officialList.bindEnum=game.ME.DailyOfficial,e._officialList.addToParent(e.skin.scrollView1),e._daliyList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._daliyList.itemRender=game.DailyOfficialItem,e._daliyList.bindEnum=game.ME.DailyOfficial,e._daliyList.addToParent(e.skin.scrollView2)},notify:function(e,t){switch(e){case this.Evts.C2V_SELECT_PRIZE:this.selectPage(t);break;case this.Evts.C2V_UPDATA_VIEW:this.updataOfficial(),this.updataDaily()}},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)},onShow:function(){this.selectPage(0),this.updataOfficial(),this.updataDaily()},selectPage:function(e){var t=this.skin;t.node_official.active=0==e,t.node_daily.active=1==e,t.btn_choose1.node.active=0==e,t.btn_choose2.node.active=1==e},updataOfficial:function(){var e=game.dailyFuLiData.getOfficicalAwards();this.skin.redPoint1.node.active=game.dailyFuLiData.checkAlertList(e),this._officialList.setData(e)},updataDaily:function(){var e=game.dailyFuLiData.getDailyAwards();this.skin.redPoint2.node.active=game.dailyFuLiData.checkAlertList(e),this._daliyList.setData(e)}});b8e.module.registerView(game.ME.DailyOfficial,e)}(),function(){var e;(e=game.ListItem.extends({_icon:null,ctor:function(){this._super(296),this.setSize(540,94)},init:function(){var e=this;e.prizeList1=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.prizeList1.itemRender=game.ShowItemListItem,e.prizeList1.bindEnum=game.ME.DailyOfficial,e.prizeList1.addToParent(e.skin.node_prize1),e.prizeList2=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.prizeList2.itemRender=game.ShowItemListItem,e.prizeList2.bindEnum=game.ME.DailyOfficial,e.prizeList2.addToParent(e.skin.node_prize2)},setData:function(e){var t=this.skin;if(e=this.data,this.data){var a=game.DailyExploitCfg.getData(e.lv);t.lab_name.string=e.name,t.node_prize1.active=0==e.tag,t.node_prize2.active=1==e.tag;var i=!1,n=game.Lang.get(8264);e.isCanGet?e.isGet&&(i=!1,n=game.Lang.get(1353)):i=!0,t.gray_btn2.active=i,t.already_got.active=e.isGet,t.btn_get.active=!e.isGet,t.lab_gary.string=n,t.lab_lv.string="Lv."+e.lv,0==e.tag?this.setOfficialAward(a):this.setDailyAward(a)}},setOfficialAward:function(e){var t=game.CfgUtil.getPrizeListInfo(e.stageAward,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_69);this.prizeList1.setData(t.items)},setDailyAward:function(e){var t=game.CfgUtil.getPrizeListInfo(e.dailyAward,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_69);this.prizeList2.setData(t.items)},btn_get:function(){this.send(game.DailyFuLiEvts.V2C_GET_AWARD,this.data)}})).poolCall=!0,b8e.RC("$$game","$$DailyOfficialItem",e)}(),function(){var e;e=b8e.Enum({None:0,C_GET_DATA:-1,V_TOGGLECHANGE:-1,V_UPDATE_RANK:-1,C_GET_RANK:-1,C_BATTLE_LOG_REQ:-1,C_CHECK_BTTALE_LOG:-1,C_BET_LOOK:-1,V_BET_COMPLETE:-1,C_BET_COMPLETE:-1,V_BET_SELECT:-1,V_UPDATE_MATCH:-1,C_OPEN_SHOP:-1,V_SHOW_MATCHANIM:-1,C_ENTER_BATTLE:-1,C_APLLY:-1,C_BATTLE_LOG_LOOK:-1,C_SHOW_CSOVERLORD:-1,C_GET_LOG:-1,V_UPDATE_LOG:-1}),b8e.RC("$$game","$$CsOverlordEvts",e)}(),function(){var e,t;t=b8e.Enum({None:0,MATCH:1,SCORE:2}),e=b8e.Enum({None:0,LOW:31,MIDDLE:32,HIGH:33}),b8e.RC("$$game","$$CsOverlordTypeAwardType",t),b8e.RC("$$game","$$CsOverlordTypeBetType",e)}(),function(){var e=game.TeamLeagueMatchData.extends({applyTime:null,mobai:!1,battleLog:null,battleTarget:null,isApply:!1,ctor:function(){this._super(),this.applyTime=new game.WorldChallengeTime,this.eliminationTime=new game.WorldChallengeTime},setData:function(e){this.isApply=e.isSignUp,this.mobai=e.mobai,this._super(e)},initOpenTime:function(){var e=this;e.setTimes("overlordApplyTimes",e.applyTime),e.setTimes("overlordEliminationTimes",e.eliminationTime),e.setTimes("overlordTop16Times",e.top16Time),e.setTimes("overlordTop8Times",e.top8Time),e.setTimes("overlordTop4Times",e.top4Time),e.setTimes("overlordTop2Times",e.top2Time);var t=e.getTimeArr("overlordBanBetTimes");e.benBetTime.startTime=b8e.TimeUtil.dateParse(t[0],"hh:mm").getTime(),e.benBetTime.endTime=b8e.TimeUtil.dateParse(t[1],"hh:mm").getTime()},getTimeArr:function(e){var t=game.OverlordMiscCfg.getData(e);return!(!t||""==t.value)&&t.value.split("-")},getIsApplyIng:function(){var e=this,t=game.SysTime.curTime;if(e.matchData&&0==e.matchData.top){if(e.stage<=0||!e.isSeasonIng())return!1;if(!e.applyTime.startTime||!e.applyTime.endTime)return!1;if(e.applyTime.startTime<=t&&e.applyTime.endTime>t)return!0;if(e.applyTime.startTime<=t&&e.eliminationTime.startTime>t)return!0}return!1},getIsEliminationIng:function(){var e=game.SysTime.curTime;if(!this.matchData)return!1;if(this.stage<=0||!this.isSeasonIng())return!1;if(0==this.matchData.top&&((e=game.SysTime.curTime)>=this.eliminationTime.startTime&&e<=this.eliminationTime.endTime))return!0;return!1},checkCanApply:function(){var e=game.SysTime.curTime;if(!game.moduleOpen.checkOpen(game.ME.CsOverlord)||!this.applyTime||this.isApply)return!1;if(this.matchData&&0==this.matchData.top){if(this.stage<=0||!this.isSeasonIng())return!1;if(this.applyTime.startTime<=e&&this.applyTime.endTime>e&&!this.isApply)return!0}return!1},checkCanMoBai:function(){return!(this.mobai||!this.matchData||!this.matchData.overlord)},getPreviewAward:function(){if(this.prizesInfo)return this.prizesInfo;for(var e,t=game.OverlordMiscCfg.getData("mobaiRewards").value.split("|"),a=[],i=0;i<t.length;i++){var n=t[i].split(",");(e={}).Id=n[0],e.Num=n[1],a[i]=e}return this.prizesInfo=game.CfgUtil.getPrizeListInfo(a),this.prizesInfo},getAwardListByType:function(e){var t,a,i;switch(e){case game.CsOverlordTypeAwardType.MATCH:a=this.matchAwardList,t=game.OverlordRankAwardCfg.getDatas();break;case game.CsOverlordTypeAwardType.SCORE:a=this.scoreAwardList,t=game.OverlordScoreAwardCfg.getDatas()}if(a&&a.length)return a;for(var n=0,s=t.length;n<s;n++)(i=new game.TeamLeagueAwardInfo).type=e,i.setData(t[n]),a.push(i);return a},checkCanChallenge:function(e){var t=0<arguments.length&&void 0!==e&&e;return this.isApply?this.getIsEliminationIng()?!!this.challenges||(t&&game.notice.show(8538),!1):(t&&game.notice.show(7589),!1):(t&&game.notice.show(8330),!1)},setMyLogList:function(e){this.clearList(this.myLogList);for(var t=void 0,a=game.mainRoleData,i=0,n=e.length;i<n;i++)(t=game.TeamLeagueBattleLogInfo.get()).player1=a.name,t.player2=e[i].targetName,t.sourceInfo=e[i].score,t.result=e[i].win,this.myLogList.push(t)}});game.csOverlordData=game.csOverlordData||new e}(),function(){var e=game.Control.extends({init:function(){this.data=game.csOverlordData,this.alertOptions={lang:6071,langArgs:null,okcb:this.onClickGameAlert,thisArg:this,args:null}},ipc:function(){this.evts={CsOverlord:{C_BET_LOOK:this.lookBet}},this.handels={OverlordPredictionResp:this.overlordPredictionResp,OverlordPredictionDataResp:this.overlordPredictionDataResp}},lookBet:function(e){this.data.betMatchId=e,this.sender.OverlordPredictionDataReq(e)},notify:function(e,t){switch(e){case this.Evts.C_BET_LOOK:this.lookBet(t);break;case this.Evts.C_BATTLE_LOG_LOOK:this.data.lookMatchInfo=t,game.module.show(game.ME.CsOverlordMatchLog)}},overlordPredictionResp:function(e){var t=e.readProtobuf(game.pb.OverlordPredictionResponse);if(0<t.code){game.notice.noticeError(t.code)}else{this.data.betData.roleId=t.roleId,this.data.betData.type=t.type;var a=this.data.betData.player1.roleId==t.roleId?1:2;this.data.matchData.prediction={matchId:this.data.betMatchId,win:a},this.dpt(this.Evts.C_BET_COMPLETE),this.send(this.Evts.V_BET_COMPLETE)}},overlordPredictionDataResp:function(e){var t=e.readProtobuf(game.pb.OverlordPredictionDataResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.betData=t,this.data.betIndex=t.win?t.win:1,game.module.show(game.ME.CsOverlordBet)},roleNode1:function(){this.selectRole(1)},roleNode2:function(){this.selectRole(2)},selectRole:function(e){null!=this.data.betData&&(0==this.data.betData.type?(this.data.betIndex=e,this.send(this.Evts.V_BET_SELECT,e)):game.notice.show(7588))},betIcon1:function(){this.selectBet(game.CsOverlordTypeBetType.LOW)},betIcon2:function(){this.selectBet(game.CsOverlordTypeBetType.MIDDLE)},betIcon3:function(){this.selectBet(game.CsOverlordTypeBetType.HIGH)},selectBet:function(e){this.data.selectBetType=e,this.showTips()},showTips:function(){game.module.show(game.ME.CsOverlordBetTips)},betBtn1:function(){this.csOverlordPredictionReq(game.CsOverlordTypeBetType.LOW)},betBtn2:function(){this.csOverlordPredictionReq(game.CsOverlordTypeBetType.MIDDLE)},betBtn3:function(){this.csOverlordPredictionReq(game.CsOverlordTypeBetType.HIGH)},csOverlordPredictionReq:function(e){if(null!=this.data.betData){var t=this.data.betData,a=this.data.betMatchId,i=1==this.data.betIndex?t.player1.roleId:t.player2.roleId,n=game.OverlordPredictionCfg.getData(e).betCost[0];if(n){var s=game.ItemInfoCfg.getData(n.Id);this.alertOptions.langArgs=[n.Num+s.name],this.alertOptions.args=[e,a,i],game.alert.showTwo(this.alertOptions)}}},onClickGameAlert:function(e,t,a){this.sender.OverlordPredictionReq(e,t,a)}}),t=[game.ME.CsOverlordBetTips],a=game.Sender.extends({ipc:function(){this.msg={OverlordPredictionDataReq:this.overlordPredictionDataReq,OverlordPredictionReq:this.overlordPredictionReq}},overlordPredictionDataReq:function(e){var t=game.pb.OverlordPredictionDataRequest;t.matchId=e,this.write(t)},overlordPredictionReq:function(e,t,a){var i=game.pb.OverlordPredictionRequest;i.type=e,i.matchId=t,i.roleId=a,this.write(i)}});b8e.module.registerControl(game.ME.CsOverlordBet,e,game.CsOverlordEvts,a,t)}(),function(){var e=game.Control.extends({ipc:function(){this.handels={OverlordLogResp:this.overlordLogResp}},overlordLogResp:function(e){var t=e.readProtobuf(game.pb.OverlordLogResponse);0<t.code?game.notice.noticeError(t.code):(game.csOverlordData.setMyLogList(t.logs),this.send(this.Evts.V_UPDATE_LOG))},notify:function(e){switch(e){case this.Evts.C_GET_LOG:this.sender.OverlordLogReq()}}}),t=game.Sender.extends({ipc:function(){this.msg={OverlordLogReq:null}}});b8e.module.registerControl(game.ME.CsOverlordMyLog,e,game.CsOverlordEvts,t)}(),function(){var e=game.Control.extends({intervalTime:0,init:function(){this.data=game.csOverlordData,this.spotAlert=game.spotAlert.set(game.SAE.CSOVERLORD_MATCH,game.SAE.ARENA),this.spotBetAlert=game.spotAlert.set(game.SAE.CSOVERLORD_MATCH_BET,game.SAE.CSOVERLORD_MATCH),this.spotChallengeAlert=game.spotAlert.set(game.SAE.CSOVERLORD_MATCH_CHALLENGE,game.SAE.CSOVERLORD_MATCH),this.spotApplyAlert=game.spotAlert.set(game.SAE.CSOVERLORD_MATCH_APPLY,game.SAE.CSOVERLORD_MATCH)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},CsOverlordBet:{C_BET_COMPLETE:this.betComplete}},this.handels={OverlordDataResp:this.overlordDataResp,OverlordChallengeResp:this.overlordChallengeResp,OverlordSignUpResp:this.overlordSignUpResp}},triggerOpen:function(e){e==this.moduleEnum&&(this.data.initOpenTime(),this.sender.OverlordDataReq(),this.checkStartTime())},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.data.initOpenTime(),this.sender.OverlordDataReq())},betComplete:function(){this.changeBetState(),this.send(this.Evts.V_UPDATE_MATCH)},notify:function(e){var t=this;switch(e){case t.Evts.C_GET_DATA:t.sender.OverlordDataReq();break;case t.Evts.C_START_MATCH:if(!t.data.checkCanChallenge(!0))return;t.sender.OverlordChallengeReq();break;case t.Evts.C_OPEN_SHOP:t.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.CS_OVERLORD);break;case t.Evts.C_ENTER_BATTLE:if(game.module.hide(game.ME.CsOverlordMatchIng),!t.data.battleLog)return;var a={type:game.InstanceType.CS_OVERLORD,exp:0};game.playBack.play(t.data.battleLog,a);break;case t.Evts.C_APLLY:t.sender.OverlordSignUpReq()}},overlordSignUpResp:function(e){var t=e.readProtobuf(game.pb.OverlordSignUpResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.isApply=!0,this.send(this.Evts.V_UPDATE_MATCH)},overlordChallengeResp:function(e){var t=e.readProtobuf(game.pb.OverlordChallengeResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.challenges-=1,this.data.battleLog=t.battlelog,this.data.battleTarget=t.target,game.module.show(game.ME.CsOverlordMatchIng),this.send(this.Evts.V_UPDATE_MATCH)},overlordDataResp:function(e){var t=e.readProtobuf(game.pb.OverlordDataResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.setData(t),this.updateTime(),this.send(this.Evts.V_UPDATE_MATCH),this.dpt(this.Evts.V_UPDATE_MATCH)},checkStartTime:function(){this.taskTimer||(this.taskTimer=b8e.Timer.add(this,this.updateTime,1e3),this.taskTimer.start())},refreshBtn:function(){this.dpt(this.Evts.C_SHOW_CSOVERLORD)},updateTime:function(){var e=this,t=e.data.checkCanApply();e.spotChallengeAlert.alert=e.data.checkCanChallenge();var a=e.spotApplyAlert.alert=t;(a&&!game.mainCenterData.csOverlord||!a&&game.mainCenterData.csOverlord)&&e.refreshBtn();e.data.matchData;var i=e.data.checkCanBet();i!=e.data.canBet&&(e.changeBetState(i),e.send(e.Evts.V_UPDATE_MATCH))},changeBetState:function(e){this.spotBetAlert.alert=e,this.data.canBet=e}}),t=[game.ME.CsOverlordMatchIng],a=game.Sender.extends({ipc:function(){this.msg={OverlordDataReq:null,OverlordChallengeReq:null,OverlordSignUpReq:null}}});b8e.module.registerControl(game.ME.CsOverlord,e,game.CsOverlordEvts,a,t)}(),function(){var e=game.Control.extends({type:0,ipc:function(){this.evts={WorldChallengeLog:{C_BATTLE_LOG_RESP:this.battleLogResp}}},battleLogResp:function(e){var t=e.data;if(t.type==game.MatchType.CS_OVERLORD){var a=t.log,i={type:game.InstanceType.CS_OVERLORD,exp:0};game.playBack.play(a.battlelog,i),game.module.hide(this.moduleEnum)}},notify:function(e,t){switch(e){case this.Evts.C_CHECK_BTTALE_LOG:if(!t)return;this.dpt(this.Evts.C_BATTLE_LOG_REQ,t)}}});b8e.module.registerControl(game.ME.CsOverlordMatchLog,e,game.CsOverlordEvts)}(),function(){var e=game.Control.extends({ipc:function(){this.handels={OverlordRankResp:this.overlordRankResp}},overlordRankResp:function(e){var t=e.readProtobuf(game.pb.OverlordRankResponse);0<t.code?game.notice.noticeError(t.code):(game.csOverlordData.setRankList(t),this.send(this.Evts.V_UPDATE_RANK))},notify:function(e){switch(e){case this.Evts.C_GET_RANK:this.sender.OverlordRankReq()}},btn1:function(){this.selectToggle(0)},btn2:function(){this.selectToggle(1)},btn3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}}),t=game.Sender.extends({ipc:function(){this.msg={OverlordRankReq:null}}}),a=[game.ME.CsOverlordScoreRank,game.ME.CsOverlordMatchAward,game.ME.CsOverlordScoreAward];b8e.module.registerControl(game.ME.CsOverlordRank,e,game.CsOverlordEvts,t,a)}(),function(){var e=game.Control.extends({type:0,init:function(){this.data=game.csOverlordData,this.spotWorshipAlert=game.spotAlert.set(game.SAE.CSOVERLORD_WORSHIP,game.SAE.ARENA)},ipc:function(){this.evts={CsOverlord:{V_UPDATE_MATCH:this.updateMatch}},this.handels={OverlordMobaiResp:this.overlordMobaiResp}},overlordMobaiResp:function(e){var t=e.readProtobuf(game.pb.OverlordMobaiResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.data.mobai=!0,this.updateMatch(),this.send(this.Evts.V_UPDATE_MATCH)},updateMatch:function(){this.spotWorshipAlert.alert=this.data.checkCanMoBai()},worshipBtn:function(){this.sender.OverlordMobaiReq()}}),t=game.Sender.extends({ipc:function(){this.msg={OverlordMobaiReq:null}}});b8e.module.registerControl(game.ME.CsOverlordWorship,e,game.CsOverlordEvts,t)}(),function(){var e=game.MatchBetTips.extends({ctor:function(){this._super(248)},init:function(){this.betCfg=game.OverlordPredictionCfg,this.data=game.csOverlordData,this._super()}});b8e.module.registerView(game.ME.CsOverlordBetTips,e)}(),function(){var e=game.MatchBetView.extends({ctor:function(){this._super(249)},init:function(){this.data=game.csOverlordData,this.betType=game.CsOverlordTypeBetType,this.betCfg=game.OverlordPredictionCfg,this._super()}});b8e.module.registerView(game.ME.CsOverlordBet,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(250)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.csOverlordData.getAwardListByType(game.CsOverlordTypeAwardType.MATCH);this.rankList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsOverlordMatchAward,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(251)},init:function(){var e=this;e.data=game.csOverlordData,e.roleData=game.mainRoleData,e.model=game.sceneRoleCreate.createUIRole(e.roleData),e.model.addToParent(e.skin.modelNode1),e.skin.modelNode1.setScale(.7,.7),game.AvatarUtil.updateUIModel(e.model),e.model.transition(game.RoleStateType.ACTION_IDLE),e.roleData2=game.BaseRoleData.get(game.RoleType.Hero,1),e.model2=game.sceneRoleCreate.createUIRole(e.roleData2),e.model2.addToParent(e.skin.modelNode2),e.skin.modelNode2.setScale(.7,.7),e.countdown=0,e.timer=b8e.Timer.add(e,e.updateTime,1e3)},updateTime:function(){this.countdown-=1,this.skin.timeLab.string=this.countdown,this.countdown||this.send(this.Evts.C_ENTER_BATTLE)},onShow:function(){this.updateView()},updateView:function(){var e=this,t=e.skin;e.countdown=3,t.timeLab.string=e.countdown,e.timer.reset(),e.timer.start(),t.wen.active=!e.data.battleTarget,e.skin.modelNode2.active=e.data.battleTarget,t.lvLab1.string="LV."+e.roleData.lv,t.nameLab1.string=e.roleData.name,t.lab_power1.string=e.roleData.power,e.data.battleTarget&&(e.updatePlayer(e.data.battleTarget,e.roleData2,e.model2),t.lvLab2.string="LV."+e.data.battleTarget.level,t.nameLab2.string=e.data.battleTarget.roleName+".S"+e.data.battleTarget.zone,t.lab_power2.string=e.data.battleTarget.power)},updatePlayer:function(e,t,a){t.setMale(e.isMale);var i=t.heroModel;i.clear(),i.setMale(e.isMale),i.setBody(game.RoleType.Hero,e.isMale?1001:1002),i.setSurface(e.surface),game.AvatarUtil.updateUIModel(a),a.transition(game.RoleStateType.ACTION_IDLE)},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){var e=b8e.stageWidth,t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(.5*(e-this.width),t)}});b8e.module.registerView(game.ME.CsOverlordMatchIng,e)}(),function(){var e;e=game.MatchLogItem.extends({ctor:function(){this._super(252)},lookBtn:function(){this.send(game.CsOverlordEvts.C_CHECK_BTTALE_LOG,this.data.battleId)}}),b8e.RC("$$game","$$CsOverlordMatchLogItem",e)}(),function(){var e=game.MatchLogView.extends({ctor:function(){this._super(253)},init:function(){this.skin;var e=this.battleList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.CsOverlordMatchLogItem,e.bindEnum=game.ME.CsOverlordMatchLog,e.addToParent(this.skin.list),e.layout.spacingY=-1,this.data=game.csOverlordData}});b8e.module.registerView(game.ME.CsOverlordMatchLog,e)}(),function(){var e;e=game.Widget.extends({isInit:!1,ctor:function(){this._super(254)},init:function(){var e=this,t=e.skin;e.data=game.csOverlordData,t.descLab.string=game.Lang.get(8323),game.spotAlert.setCb(game.SAE.CSOVERLORD_MATCH_APPLY,e.setApplyAlert,e),game.spotAlert.setCb(game.SAE.CSOVERLORD_MATCH_CHALLENGE,e.setChallengeAlert,e),e.bg=b8e.Sprite.get(),e.bg.setAnchor(.5,.5),e.bg.x=311,e.bg.y=-455,e.skin.bgNode.addChild(e.bg),e.bg.loadTexture(game.ResCfg.getUrl(215)),e.roleData=game.BaseRoleData.get(game.RoleType.Hero,1),e.model=game.sceneRoleCreate.createUIRole(e.roleData),e.model.addToParent(t.modelNode),e.isInit=!0},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){var e=this;if(e.isInit){var t=e.skin,a=e.data.getIsEliminationIng(),i=e.data.getIsApplyIng(),n=e.data.applyTime,s=game.SysTime.curTime,r=n.startTime<=s&&n.endTime>s;if(t.nameBg.active=t.modelNode.active=e.data.matchData&&e.data.matchData.overlord,e.data.matchData&&e.data.matchData.overlord&&(t.nameLab.string=e.data.matchData.overlord.roleName,e.updatePlayer(e.data.matchData.overlord,e.roleData,e.model)),e.data.stage<=0||!e.data.isSeasonIng())return t.noOpenMatchTips.active=!0,t.applyNode.active=!1,void(t.matchNode.active=!1);t.noOpenMatchTips.active=!1,i?(t.applyNode.active=!0,t.matchNode.active=!1,r?(t.applyBtn.active=!e.data.isApply,t.noApplyBtn.active=e.data.isApply,t.noApply.string=game.Lang.get(8329)):(t.applyBtn.active=!1,t.noApplyBtn.active=!0,t.noApply.string=e.data.isApply?game.Lang.get(8329):game.Lang.get(8330))):(t.applyNode.active=!1,t.matchNode.active=!0,t.openMatchTips.active=!a&&n.startTime<s,t.numLab.active=t.numTimeLab.active=e.data.isApply&&a,a?(e.maxChallengesNum||(e.maxChallengesNum=game.OverlordMiscCfg.getData("overlordChallenges").value),t.numLab.string=game.Lang.get(8332,e.data.challenges,e.maxChallengesNum),t.matchBtn.active=e.data.isApply,t.noOpenBtn.active=!e.data.isApply,t.noOpen.string=game.Lang.get(8330)):(t.matchBtn.active=!1,t.noOpenBtn.active=!0,t.noOpen.string=n.startTime<s?game.Lang.get(8331):game.Lang.get(8344)))}},updatePlayer:function(e,t,a){t.setMale(e.isMale);var i=t.heroModel;i.clear(),i.setBody(game.RoleType.Hero,e.isMale?1001:1002),i.setSurface(e.surface),game.AvatarUtil.updateUIModel(a),a.transition(game.RoleStateType.ACTION_IDLE)},setApplyAlert:function(e){this.skin.redPoint2.active=e.alert},setChallengeAlert:function(e){this.skin.redPoint1.active=e.alert},shopBtn:function(){this.send(game.CsOverlordEvts.C_OPEN_SHOP)},rankBtn:function(){game.module.show(game.ME.CsOverlordRank)},matchBtn:function(){this.send(game.CsOverlordEvts.C_START_MATCH)},applyBtn:function(){this.send(game.CsOverlordEvts.C_APLLY)},battleLogBtn:function(){game.module.show(game.ME.CsOverlordMyLog)},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$CsOverlordMatchView",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(257),this.toggles={tab1_select:game.ME.CsOverlordScoreRank,tab2_select:game.ME.CsOverlordMatchAward,tab3_select:game.ME.CsOverlordScoreAward}},init:function(){this.skin.mat_lab_2.string=game.Lang.get(8333)},onShow:function(){this.toggleSelect(0),this.updateView()},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t);break;case this.Evts.V_UPDATE_RANK:this.updateView()}},updateView:function(){this.skin.myRankLab.string=0<game.csOverlordData.myRank?game.csOverlordData.myRank:game.Lang.get(6980),this.skin.mySorceLab.string=game.csOverlordData.myScore},toggleSelect:function(e){if(this._super(e))switch(this.skin.myRankTitle.active=this.skin.mySorceTitle.active=this.skin.myRankLab.active=this.skin.mySorceLab.active=0==e,e){case 0:this.send(this.Evts.C_GET_RANK)}else;},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.CsOverlordRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(250)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueAwardItem,e.layout.spacingY=5,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.csOverlordData.getAwardListByType(game.CsOverlordTypeAwardType.SCORE);this.rankList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsOverlordScoreAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(258)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TeamLeagueRankItem,e.layout.spacingY=5,e.addToParent(this.skin.list),this.skin.guild.string=game.Lang.get(8539)},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){this.rankList.setData(game.csOverlordData.rankList)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsOverlordScoreRank,e)}(),function(){var e=game.View.extends({matchView:null,topView:null,curView:null,ctor:function(){this._super(259)},init:function(){this.data=game.csOverlordData},notify:function(e){switch(e){case this.Evts.V_UPDATE_MATCH:this.updateView()}},onShow:function(){this.send(this.Evts.C_GET_DATA),this.updateView()},updateView:function(){this.showView(),this.curView&&this.curView.updateView()},showView:function(){var e=this,t=e.skin;t.contianer.removeAllChildren(),e.curView=null;var a=!1;e.data.getIsTopIng()?(e.topView||(e.topView=new game.CsOverlordVsView,e.topView.bindEnum=game.ME.CsOverlord),e.curView!=e.topView&&(a=!0,e.curView=e.topView)):(e.matchView||(e.matchView=new game.CsOverlordMatchView,e.matchView.bindEnum=game.ME.CsOverlord),e.curView!=e.matchView&&(a=!0,e.curView=e.matchView)),a&&e.curView&&t.contianer.addChild(e.curView)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsOverlord,e)}(),function(){var e;e=game.MatchVsView.extends({ctor:function(){this._super(260)},init:function(){this.data=game.csOverlordData,this.evtsClass=game.CsOverlordEvts,this.itemBindEnum=game.ME.CsOverlordBet,this.rankEnum=game.ME.CsOverlordRank,this.itemSkin="match/MatchVsItem",this._super()}}),b8e.RC("$$game","$$CsOverlordVsView",e)}(),function(){var e=game.View.extends({matchView:null,topView:null,curView:null,ctor:function(){this._super(261),this.spotAlerts={CSOVERLORD_WORSHIP:this.worshipAlert}},worshipAlert:function(e){this.skin.redPoint1.active=e.alert},init:function(){var e=this;e.data=game.csOverlordData,e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.prizeList.itemRender=game.ShowItemListItem,e.prizeList.layout.spacingX=70,e.prizeList.addToParent(e.skin.awardList),e.roleData=game.BaseRoleData.get(game.RoleType.Hero,1),e.model=game.sceneRoleCreate.createUIRole(e.roleData),e.model.addToParent(e.skin.modelNode),e.bg=b8e.Sprite.get(),e.bg.setAnchor(.5,.5),e.skin.bgNode.addChild(e.bg),e.bg.loadTexture(game.ResCfg.getUrl(215))},notify:function(e){switch(e){case this.Evts.V_UPDATE_MATCH:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=this,t=e.data.getPreviewAward();e.prizeList.setData(t.items),e.skin.nameBg.active=e.skin.modelNode.active=e.data.matchData&&e.data.matchData.overlord,e.skin.toWorshipBtn.active=e.data.mobai,e.skin.worshipBtn.active=!e.data.mobai&&e.data.matchData&&e.data.matchData.overlord,e.data.matchData&&e.data.matchData.overlord&&(e.skin.nameLab.string=e.data.matchData.overlord.roleName,e.updatePlayer(e.data.matchData.overlord,e.roleData,e.model))},updatePlayer:function(e,t,a){t.setMale(e.isMale);var i=t.heroModel;i.clear(),i.setMale(e.isMale),i.setBody(game.RoleType.Hero,e.isMale?1001:1002),i.setSurface(e.surface),game.AvatarUtil.updateUIModel(a),a.transition(game.RoleStateType.ACTION_IDLE)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsOverlordWorship,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(255),this.setSize(540,98)},init:function(){this.skin.scoreNumLab.active=!0,this.skin.lookBtn.active=!1},setData:function(){var e=this.skin,t=this.data;e.nameLab1.string=t.player1,e.nameLab2.string=t.player2,e.lose1.node.active=!t.result,e.win1.node.active=t.result,e.lose2.node.active=t.result,e.win2.node.active=!t.result,e.scoreNumLab.string=game.Lang.get(3807,t.sourceInfo)},lookBtn:function(){}}),b8e.RC("$$game","$$CsOverlordMyLogItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(256)},init:function(){var e=this.logList=new game.List;e.itemRender=game.CsOverlordMyLogItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.CsOverlordMyLog,e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.V_UPDATE_LOG:this.updataList()}},updataList:function(){this.logList.setData(game.csOverlordData.myLogList)},onShow:function(){this.send(this.Evts.C_GET_LOG),this.updataList()},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.CsOverlordMyLog,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_UPDATE_LIST:-1,C2V_UPDATE_VIEW:-1,C2V_UPDATE_RECHARGE:-1,V2C_GET_PRIZE:-1,C2C_REFRESH_BTNS:-1,V2C_SHOW_VIEW:-1}),b8e.RC("$$game","$$TVDailyRechargeEvts",e)}(),function(){var e=b8e.Object.extends({isGetAll:!1,ctor:function(){this._super(),this.infoMap=b8e.HashMap.get(),this.qqDailyRecharges=[]},setInfoList:function(){var e=this,t=game.QQDailyRechargeCfg.getDatas();if(t&&!(t.length<1)){var a=void 0,i=void 0,n=t.length;e.infoList?e.infoList.length=0:e.infoList=[];for(var s=0;s<n;s++)a=t[s],(i=e.infoMap.get(a.id))||(i=game.TVDailyRechargeInfo.get(),e.infoMap.set(a.id,i)),i.setData(a),e.qqDailyRecharges&&0<e.qqDailyRecharges.length?i.isGet=-1<e.qqDailyRecharges.indexOf(i.id):i.isGet=!1,i.getIsOpen()&&e.infoList.push(i);e.infoList.sort(e.onSort)}},checkAlert:function(){if(!this.infoList)return!(this.isGetAll=!0);var e=void 0,t=!1,a=game.rechargeData.rechargeMoneyDaily,i=this.infoList,n=i.length;this.isGetAll=!0;for(var s=0;s<n;s++)(e=i[s]).setGet(a),e.canGet&&!e.isGet&&(t=!0),e.isGet||(this.isGetAll=!1);return t},setGetPrize:function(e){if(this.qqDailyRecharges||(this.qqDailyRecharges=[]),this.qqDailyRecharges.indexOf(e)<0&&this.qqDailyRecharges.push(e),this.infoMap){var t=this.infoMap.get(e);t&&(t.isGet=!0)}},setQQDailyRecharges:function(e){if(!(!(this.qqDailyRecharges=e)||e.length<1||!this.infoList||this.infoList.length<1))for(var t=void 0,a=this.infoList,i=a.length,n=0;n<i;n++)(t=a[n]).isGet=-1<this.qqDailyRecharges.indexOf(t.id)},getIsOpen:function(){return this.infoList&&0<this.infoList.length},getBanner:function(){return!this.infoList||this.infoList.length<1?null:this.infoList[0].banner},getTitle:function(){return!this.infoList||this.infoList.length<1?null:this.infoList[0].title},getInfoList:function(){return this.infoList?(this.infoList.sort(this.onSort),this.infoList):null},onSort:function(e,t){return e.isGet==t.isGet?e.canGet==t.canGet?e.id-t.id:e.canGet?-1:1:e.isGet?1:-1}});game.tVDailyRechargeData=game.tVDailyRechargeData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({canGet:!1,isGet:!1,ctor:function(){this._super()},setData:function(e){var t=this;if(e){t.cfg=e,t.id=e.id,t.serverStart=e.serverStart,t.serverEnd=e.serverEnd,t.isQQView=e.isQQView,t.gameChannelId=e.gameChannelId,t.banner=e.banner,t.title=e.title,t.money=e.money;var a=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime();a=a/1e3>>0,t.startTime=1e3*a;var i=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime();i=i/1e3>>0,t.endTime=1e3*i,t.isInitPrize=!1,t.openDay=game.TimeUtil.getOpenDayByStr(e.startTime,"yyyy-MM-dd  hh:mm:ss",!0)}},getPrizeList:function(){var e=this;if(e.award&&e.isInitPrize)return e.award;if(e.isInitPrize=!0,e.award||(e.award=[]),e.award.length=0,e.awardPool||(e.awardPool=[]),!e.cfg)return e.award;var t=e.cfg.award;if(!t||t.length<1)return e.award;for(var a,i=t.length,n=0;n<i;n++)a=t[n],e.awardPool[n]=game.ItemUtil.createBaseItemInfo(a.Id,a.Num,e.award[n]),e.awardPool[n].iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,e.award.push(e.awardPool[n]);return e.award},getIsOpen:function(){var e=this,t=game.SysTime.curTime;if(e.isQQView){if(!game.IS_WANBA||"QQLive"!=game.JunHaiSdk.getApp())return!1}else if(e.gameChannelId!=+game.LoginConfig.gameChannelId)return!1;return!(e.startTime>t||e.endTime<=t)&&(!(0<e.serverStart&&e.openDay<e.serverStart)&&!(0<e.serverEnd&&e.openDay>=e.serverEnd))},setGet:function(e){this.canGet=e>=this.money}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){return e=t.pool.put(e)},b8e.RC("$$game","$$TVDailyRechargeInfo",t)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.QQ_VIEW_DAILY_RECHARGE,game.SAE.HOME)},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.initRecharge,C_RECHARGE_SUCCESS:this.rechargeSuccess},OpenServer:{C2C_INIT_OPENSERVER:this.initOpenServer},MainRole:{C_RESET_DAILY:this.resetDaily},Home:{C2C_SHOW_VIEW:this.showHomeView}},this.handels={QQDailyRechargeResp:this.qqDailyRechargeResp}},initRecharge:function(){game.tVDailyRechargeData.setQQDailyRecharges(game.rechargeData.qqDailyRecharges),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_RECHARGE)},rechargeSuccess:function(){this.checkAlert(),this.send(this.Evts.C2V_UPDATE_RECHARGE)},initOpenServer:function(){this.setInfoList(),this.send(this.Evts.C2V_UPDATE_LIST)},resetDaily:function(){this.setInfoList(),this.send(this.Evts.C2V_UPDATE_VIEW)},showHomeView:function(){this.first||(this.first=!0,game.moduleOpen.checkOpen(game.ME.TVDailyRechargeAlert)&&game.tVDailyRechargeData.getIsOpen()&&(game.tVDailyRechargeData.isGetAll||game.module.show(game.ME.TVDailyRechargeAlert)))},setInfoList:function(){game.moduleOpen.checkOpen(game.ME.TVDailyRechargeAlert)&&(game.tVDailyRechargeData.setInfoList(),this.checkAlert(),this.dpt(this.Evts.C2C_REFRESH_BTNS))},qqDailyRechargeResp:function(e){var t=e.readProtobuf(game.pb.QQDailyRechargeResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.tVDailyRechargeData.setGetPrize(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_LIST)}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_PRIZE:this.sender.QQDailyRechargeReq(t);break;case this.Evts.V2C_SHOW_VIEW:this.firstShowView=!0,this.checkAlert()}},checkAlert:function(){var e=game.tVDailyRechargeData.checkAlert();this.spotAlert.alert=!game.tVDailyRechargeData.isGetAll&&(!this.firstShowView||e)},gotoBtn:function(){game.module.show(game.ME.TVDailyRecharge),game.module.hide(game.ME.TVDailyRechargeAlert)}}),t=[game.ME.TVDailyRechargeAlert],a=game.Sender.extends({ipc:function(){this.msg={QQDailyRechargeReq:this.qqDailyRechargeReq}},qqDailyRechargeReq:function(e){var t=game.pb.QQDailyRechargeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.TVDailyRecharge,e,game.TVDailyRechargeEvts,a,t)}(),function(){var e;(e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1058),this.setSize(550,145)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=0,e.addToParent(this.skin.prizeList)},setData:function(){var e=this.skin,t=this.data;e.title.string=game.Lang.get(8524,t.money),this.prizeInfoList=this.data.getPrizeList(),this.prizeList.setData(this.prizeInfoList),e.rechargeBtn.active=!t.canGet&&!t.isGet,e.getBtn.active=t.canGet&&!t.isGet,e.isGetImg.active=t.isGet},getBtn:function(){this.send(game.TVDailyRechargeEvts.V2C_GET_PRIZE,this.data.id)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}})).poolCall=!0,b8e.RC("$$game","$$TVDailyRechargeItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1059)},init:function(){var e=this.list=new game.List;e.itemRender=game.TVDailyRechargeItem,e.bindEnum=game.ME.TVDailyRecharge,e.addToParent(this.skin.list),this.timer=b8e.Timer.add(this,this.updateTime,500)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updatePage();break;case this.Evts.C2V_UPDATE_RECHARGE:this.updateRecharge();break;case this.Evts.C2V_UPDATE_LIST:this.updateList()}},onShow:function(){var e=void 0,t=game.tVDailyRechargeData.getBanner();t&&(e=game.ResCfg.getUrl(219,t),this.skin.banner.loadTexture(e));var a=game.tVDailyRechargeData.getTitle();a&&(e=game.ResCfg.getUrl(219,a),this.skin.title.loadTexture(e)),this.updatePage(),this.send(this.Evts.V2C_SHOW_VIEW)},onHide:function(){this.stopTime()},updatePage:function(){if(this.updateList(),this.updateRecharge(),this.infoList&&0<this.infoList.length){var e=this.infoList[0];this.endTime=e.endTime,this.timer.reset(),this.timer.start()}},updateList:function(){this.infoList=game.tVDailyRechargeData.getInfoList(),this.list.setData(this.infoList)},updateRecharge:function(){var e=game.rechargeData.rechargeMoneyDaily;this.skin.rechargeMoneyDaily.string=game.Lang.get(8525,e)},updateTime:function(){if(!this.endTime)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.TimeUtil.formatTimeSpace(e)},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.TVDailyRecharge,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1057)},onShow:function(){var e=void 0,t=game.tVDailyRechargeData.getBanner();t&&(e=game.ResCfg.getUrl(220,t),this.skin.banner.loadTexture(e));var a=game.tVDailyRechargeData.getTitle();a&&(e=game.ResCfg.getUrl(220,a),this.skin.title.loadTexture(e))},onHide:function(){},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+100)}});b8e.module.registerView(game.ME.TVDailyRechargeAlert,e)}(),function(){var e;e=b8e.Enum({None:0,V_UPDATE_DATA:-1,C_SELECT_TOWER:-1,C2C_UPDATE_FINISH_COUNT:-1,C2C_JOIN_TEAM:-1}),b8e.RC("$$game","$$ThousandTowerEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.thousandTowerData,this.spotSweepAlert=game.spotAlert.set(game.SAE.THOUSANDTOWER_SWEEP,game.SAE.BOSS_THOUSANDTOWER),game.spotAlert.set(game.SAE.SHOP_THOUSANDTOWER,game.SAE.BOSS_THOUSANDTOWER)},ipc:function(){this.evts={Instance:{SYNC_INSTANCE_DATA:this.onSyncInstanceData},ThousandTowerTeam:{C_CHECK_ALERT:this.checkAlert},MainUIChat:{C_REQ_ENTER_TEAM:this.inviteJoin}}},checkAlert:function(){var e=this.data.checkTowerInfoAlert();this.spotSweepAlert.alert=e,this.dpt(this.Evts.C2C_UPDATE_FINISH_COUNT)},onSyncInstanceData:function(e){var t=e.data;if(t)this.data.synDatas(t.tower),this.send(this.Evts.V_UPDATE_DATA),this.checkAlert();else;},inviteJoin:function(e){var t=e.data;if(t){var a=t.instId,i=this.data.getBossInfoById(a);if(i){var n=i.towerId,s=this.data.getTowerInfoById(n);if(s)if(s.isUnlock()){i.isPass||i.canChall?(this.data.selectTowerId=i.towerId,this.data.curInsId=0,this.data.initBossList(),this.dpt(this.Evts.C2C_JOIN_TEAM,t)):game.notice.show(8547)}else{game.notice.show(8546)}}}},notify:function(e,t){switch(e){case this.Evts.C_SELECT_TOWER:this.selectTower(t)}},selectTower:function(e){if(e)this.data.selectTowerId=e,this.data.initBossList(),game.module.show(game.ME.ThousandTowerTeam);else;},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.THOUSANDTOWER)}});b8e.module.registerControl(game.ME.ThousandTower,e,game.ThousandTowerEvts)}(),function(){var e=game.TeamControl.extends({memberIds:null,init:function(){this.curTeamInstType=game.TeamInstType.THOUSANDTOWER_TEAM,this.memberIds=[],this.teamData=game.thousandTowerData},ipc:function(){var e=this;e.evts={MainRole:{C_LEVEL_UP:e.levelUP},TeamHandel:{C_SET_TEAM:e._setTeamData,C_TEAM_CREATE:e._createTeam,C_TEAM_JOIN:e._joinTeam,C_TEAM_LEAVE:e._leaveTeam,C_KICK_MEMBER:e._kickMember,C_TEAM_QUICK_JOIN:e._quickJoinTeam,C_TEAM_JOIN_NOTIFY:e._joinTeamNotify,C_TEAM_LEAVE_NOTIFY:e._leaveTeamNotify,C_ENTER_BATTLE:e._enterBattle,C_BATTLE_END:e._battleEnd,C_TEAM_RATE:e._teamRate},ThousandTower:{C2C_JOIN_TEAM:e.inviteJoin},ZhanJiang:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},ZhaoQin:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},BaoZang:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},Hunting:{C2C_UPDATE_AUTOFIGHT:e.stopAutoBattle},Scene:{ENTER_CS_SCENE:e.stopAutoBattle}},e.handels={TowerBattleMsg:e.towerBattleMsg,TowerSweepResp:e.towerSweepResp},e.gevts={InstanceEvts:{G_STOP_PLAY:e.battleStop}}},towerBattleMsg:function(e){var t=e.readProtobuf(game.pb.TowerBattleNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.insid,i=t.battlelog;this.teamData.helpNum=t.helpNum;var n={type:game.InstanceType.THOUSANDTOWER,rewards:t.useritem,exp:t.exp};game.playBack.stop(),game.playBack.play(i,n),game.GameViewMgr.inst().hideUnStrongViews(),i&&i.win&&0<a&&(this.teamData.instId=a,this.teamData.updateInstPass(a),this.dpt(this.Evts.C2C_UPDATE_FINISH_COUNT)),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.C_CHECK_ALERT)}},towerSweepResp:function(e){var t=e.readProtobuf(game.pb.TowerSweepResponse);if(0<t.code){game.notice.noticeError(t.code)}else this.teamData.quickSweepAllInst(),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.C_CHECK_ALERT)},shopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.THOUSANDTOWER)},notify:function(e,t,a){var i=this;switch(e){case i.Evts.V_SHOW_VIEW:i.showView();break;case i.Evts.V_KICK_MEMBER:i.kickMember(t);break;case i.Evts.V_JOIN_TEAM:i.joinTeam(t,a);break;case i.Evts.V_SELECT_BOSS:i.selectBoss(t);break;case i.Evts.V_HIDE_VIEW:i.hideView()}},checkInstCanEnter:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t;if(this.invInstId=0,!game.TeamInstanceCfg.getData(e))return b8e.error("\u5bf9\u5e94\u7ec4\u961f\u526f\u672c\u914d\u7f6e\u4e0d\u5b58\u5728"),!1;var i=this.teamData.getBossInfoById(e);return!!i&&(i.isPass||i.canChall?(this.invInstId=e,!0):(a&&game.notice.show(8548),!1))},showTeamInstView:function(){b8e.module.isShowView(this.moduleEnum)||game.module.show(this.moduleEnum)},hideView:function(){this._super()},selectBoss:function(e){this._super(e),this.send(this.Evts.V_UPDATE_DATA)},levelUP:function(){this.teamData.refreshBossList(),this.send(this.Evts.V_REFRESH_BOSS_LIST)},_setTeamData:function(e){this._super(e)},_battleEnd:function(e){var t=e.data,a=t.type,i=t.rp;if(a==this.curTeamInstType){var n={type:game.InstanceType.THOUSANDTOWER,rewards:i.useritem,exp:i.exp};game.playBack.play(i.battlelog,n),game.GameViewMgr.inst().hideUnStrongViews(),this.teamData.teamBattle()}},showView:function(){var e=this;e._super();var t=0;if(e.teamData.initThousandTowerData(),0<e.invInstId){t=this.invInstId}else t=e.teamData.isInTeam?e.teamData.curInsId:e.teamData.selectTowerId?e.teamData.getCanChallengeBossID(e.teamData.selectTowerId):e.teamData.getEnterBossID();e.teamData.curInsId=t,e.teamData.initBossList(),e.selectBoss(t)},startFight:function(){var e=this.teamData.getBossInfoById(this.teamData.curInsId);if(e)return e.canChall?void this._super():(game.notice.show(8548),void this.dptG(this.Evts.C_TEAM_LEAVE,{instId:this.teamData.curInsId}))},autoTime:function(){var e=this;0<e.teamData.autoStartTime&&e.teamData.autoStartTime--,0<e.teamData.autoFullStartTime&&e.teamData.autoFullStartTime--,e.teamData.isInTeam?(e.teamData.isFull&&e.teamData.isAutoFullStart&&e.teamData.autoFullStartTime<=0&&(e.startFight(),e.stopAutoTime()),e.teamData.isAutoStart&&e.teamData.autoStartTime<=0&&(e.startFight(),e.stopAutoTime())):(e.autoReqTime++,e.autoReq()),b8e.module.isShowView(e.moduleEnum)||!e.teamData.isAutoStart&&!e.teamData.isAutoFullStart||e.dpt(e.Evts.C_UPDATE_TIME),e.send(e.Evts.V_UPDATE_TIME)},sweepBtn:function(){},quickSweepBtn:function(){this.sender.TowerSweepReq()},createrTeamBtn:function(){this.checkInstCanEnter(this.teamData.curInsId)&&this._super()},quickJoinTeamBtn:function(){this.checkInstCanEnter(this.teamData.curInsId)&&this._super()},battleStop:function(e){if(e){var t=this.data=e.data;t&&t.type==game.InstanceType.THOUSANDTOWER&&(this.teamData.checkCurInstByBattle(t.win),this.teamData.curInstBossId&&(this.selectBoss2(this.teamData.curInstBossId),this.checkTime(),this.send(this.Evts.V_SET_TEAM)))}}}),t=game.Sender.extends({ipc:function(){this.msg={TowerSweepReq:null}}});b8e.module.registerControl(game.ME.ThousandTowerTeam,e,game.TeamEvts,t)}(),function(){var e,t=e=b8e.Object.extends({id:0,index:0,towerId:0,alert:!1,isPass:!1,canSweep:!1,isSelect:!1,canChall:!1,isChange:!1,_cfg:null,ctor:function(){},isUnlock:function(){return this.isPass||this.canChall},change:function(){this.isChange=!this.isChange},setCfgData:function(e){this.id=e},cfg:{get:function(){return this._cfg||(this._cfg=game.TeamInstanceCfg.getData(this.id)),this._cfg}},updateAlert:function(){this.alert=this.canSweep}});b8e.BindingUtil.bind(e),t.poolCall=!0,b8e.RC("$$game","$$ThousandTowerBossInfo",e)}(),function(){var e=game.teamData.extends({selectTowerId:0,helpNum:0,sweepInsid:0,sweep:!1,isWin:!1,curInstBossId:0,insid:0,resetTime:0,maxInsid:0,_isInit:0,ctor:function(){this._super(),this.towerBossInfoMap=b8e.HashMap.get(),this.towerBossInfoList=[],this.towerInfoMap=b8e.HashMap.get(),this.towerInfoList=[],this.showTowerInfoList=[]},initCfg:function(){if(this.resetTimeCfg(),!this._isInit){this._isInit=!0;for(var e=game.TowerCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)(t=new game.ThousandTowerInfo).setCfgData(e[a],e[a].group),t.index=a+1,this.towerInfoMap.set(t.id,t),this.towerInfoList.push(t)}},resetTimeCfg:function(){var e=game.InstanceMiscCfg.getData("thousandTowerResetTime");if(e){var t=game.SysTime.curTime;this.resetTime=game.TimeUtil.getTimeByWeekStr(e.value),t>=this.resetTime&&(this.resetTime+=6048e5)}},initThousandTowerData:function(){this._isInit||(this.initCfg(),this.synInsDatas())},synDatas:function(e){this.resetTimeCfg(),e&&(this.insid=e.insid,this.helpNum=e.helpNum,this.sweep=e.sweep,this.sweepInsid=e.sweepInsid,this.maxInsid=e.maxInsid,this._isInit&&this.synInsDatas())},synInsDatas:function(){for(var e=void 0,t=void 0,a=void 0,i=void 0,n=0,s=this.towerInfoList.length;n<s;n++)for(e=0,t=(i=this.towerInfoList[n].levelList).length;e<t;e++)a=i[e],this.setTowerBossInfo(a);this.updateAllTowerInfo()},setTowerBossInfo:function(e){e.isPass=e.id<=this.insid,e.canSweep=this.sweepInsid>=e.id&&!this.sweep,e.canChall=this.getCanChallege(e),e.updateAlert()},getCanChallege:function(e){if(e.isPass)return!0;var t=this.towerInfoMap.get(e.towerId);if(!t)return!1;if(1==e.index){if(1==t.index)return!0;if(1<t.index){var a=t.index-2;if(0<=a&&a<this.towerInfoList.length)return this.towerInfoList[t.index-2].isAllInstPass()}}if(1<e.index&&t.levelList&&t.levelList.length>e.index-2)return t.levelList[e.index-2].isPass;return!1},updateAllTowerInfo:function(){for(var e=void 0,t=void 0,a=void 0,i=void 0,n=0,s=this.towerInfoList.length;n<s;n++){for(!1,a=0,i=(e=this.towerInfoList[n]).levelList.length;a<i&&(t=e.levelList[a],e.isEnter=!t.isPass&&t.canChall,!e.isEnter);a++);e.updateData()}},quickSweepAllInst:function(){this.sweep=!0,this.insid=this.sweepInsid,this.synInsDatas()},initBossList:function(){var e=this.towerInfoMap.get(this.selectTowerId);this.bossInfoList=e?e.levelList:[]},updateInstPass:function(e){this.maxInsid=this.maxInsid<e?e:this.maxInsid;var t=this.towerBossInfoMap.get(e);if(!t||!t.isPass){this.insid=e;var a=void 0;t&&(t.isPass=!0,a=this.getNextBossInfo(this.insid)),a&&(a.canChall=!0,a.isPass=!1,a.canSweep=!1,a.updateAlert()),this.updateAllTowerInfo()}},getNextBossInfo:function(e){var t,a=void 0,i=this.towerBossInfoMap.get(e);t=this.towerInfoMap.get(i.towerId),i.index<t.levelList.length&&(a=t.levelList[i.index]),i.index>=t.levelList.length&&(t.index<this.towerInfoList.length&&(a=this.towerInfoList[t.index].levelList[0]));return a},checkCurInstByBattle:function(e){if(e){var t=this.getNextBossInfo(this.curInsId);t&&(this.selectTowerId=t.towerId,this.curInstBossId=t.id,this.initBossList())}},checkTowerInfoAlert:function(){return this.sweepInsid&&!this.sweep},getBossInfoById:function(e){return this.towerBossInfoMap.get(e)},getTowerInfoById:function(e){return this.towerInfoMap.get(e)},getCurBossInfo:function(){return this.getBossInfoById(this.curInsId)},getEnterBossID:function(){var e=this.getBossInfoById(this.insid),t=0;if(e)if(e.isPass){var a=this.getNextBossInfo(this.insid);t=a?a.id:e.id}else t=e.id;else if(this.towerInfoList&&this.towerInfoList.length){var i=this.towerInfoList[0];if(!i||!i.levelList||!i.levelList.length)return 0;t=i.levelList[0].id}return t},getEnterTowerInfo:function(){var e=this.getEnterBossID(),t=this.getBossInfoById(e);return t?this.getTowerInfoById(t.towerId):this.towerInfoList[0]},getPassMaxLayer:function(){return this.getTowerIndexByBossID($.maxInsid)},getTowerIndexByBossID:function(e){var t=this.getBossInfoById(e),a=0;if(t)a=t.towerId;else{var i=game.TeamInstanceCfg.getData(e);if(!i)return 0;a=i.playId}return a},getShowTowerInfoList:function(){if(this.showTowerInfoList&&this.showTowerInfoList.length)return this.showTowerInfoList;for(var e=this.towerInfoList.length-1;0<=e;e--)this.showTowerInfoList.push(this.towerInfoList[e]);return this.showTowerInfoList},getCanChallengeBossID:function(e){var t=this.getTowerInfoById(e),a=void 0;if(t){for(var i=0,n=t.levelList.length;i<n;i++)if(!(a=t.levelList[i]).isPass&&a.canChall)return a.id;if(t.levelList.length){if(this.getTowerIndexByBossID(this.curInsId)==t.id){if(this.curInsId<t.levelList[t.levelList.length-1].id)return this.curInsId+1;var s=this.getNextBossInfo(this.curInsId);if(s)return this.selectTowerId=s.towerId,this.initBossList(),s.id}return t.levelList[0].id}}return 0},getCurShowTowerList:function(){var e=this.getEnterTowerInfo().index-1,t=16*parseInt(e/16),a=16+t;a>this.towerInfoList.length&&(a=this.towerInfoList.length),this.showTowerInfoList.length=0;for(var i=a-1;t<=i;i--)this.showTowerInfoList.push(this.towerInfoList[i]);return this.showTowerInfoList}});game.thousandTowerData=game.thousandTowerData||new e}(),function(){var e;e=b8e.Object.extends({id:0,alert:!1,isAllPass:!1,isChange:!1,_levelList:null,isEnter:!1,index:0,_group:null,ctor:function(){},levelList:{get:function(){if(!this._levelList&&this._group){var e=void 0;this._levelList=[];for(var t=0,a=this._group.length;t<a;t++)(e=new game.ThousandTowerBossInfo).towerId=this.id,e.index=t+1,e.setCfgData(this._group[t]),this._levelList.push(e),game.thousandTowerData.towerBossInfoMap.set(e.id,e)}return this._levelList}},setCfgData:function(e,t){this.cfg=e,this.name=e.name,this.id=e.id,this._group=t},updateAlert:function(){for(var e=null,t=!1,a=0,i=this.levelList.length;a<i;a++)if((e=this.levelList[a])&&e.alert&&this.isEnter){t=!0;break}this.alert=t},change:function(){this.isChange=!this.isChange},updateAllPass:function(){this.isAllPass=this.levelList[this.levelList.length-1].isPass},updateData:function(){this.updateAlert(),this.isAllPass=this.isAllInstPass()},isAllInstPass:function(){for(var e=null,t=0,a=this.levelList.length;t<a;t++){if(!(e=this.levelList[t])){return!1}if(!e.isPass){return!1}}return!0},isUnlock:function(){var e=this.levelList[0];if(e)return e.isPass||e.canChall;return!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ThousandTowerInfo",e)}(),function(){var e;e=game.TeamBossItem.extends({ctor:function(){this._super(1026)},setDesc:function(){var e=this.skin,t=this.data;e.pass.active=t.isPass,e.pass_last.active=!t.isPass,!t.isPass&&t.canChall?e.descLab.string=game.Lang.get(8549):e.descLab.string=game.Lang.get(8550)},setBossModel:function(){this._super(1)},setPrize:function(){}}),b8e.RC("$$game","$$ThousandTowerBossItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1027),this.setSize(584,227)},init:function(){this.headIcon=b8e.Sprite.get(),this.headIcon.setAnchor(.5,.5),this.headIcon.setScale(.8,.8),this.skin.headBg.addChild(this.headIcon)},setData:function(){var e=this.data,t=this.skin;if(e.isEnter){t.toPass.active=t.tips1.active=!1,t.enterBtn.active=t.headBg.active=!0;var a=game.ResCfg.getHead(game.mainRoleData.isMale);this.headIcon.loadTexture(a)}else e.isAllPass?(t.enterBtn.active=t.toPass.active=!0,t.tips1.active=t.headBg.active=!1):(t.tips1.active=!0,t.toPass.active=t.enterBtn.active=t.headBg.active=!1);t.titleLab.string=game.Lang.get(8551,e.index),t.redPoint3.active=e.alert},enterBtn:function(){this.send(game.ThousandTowerEvts.C_SELECT_TOWER,this.data.id)}}),b8e.RC("$$game","$$ThousandTowerItem",e)}(),function(){var e=game.TeamView.extends({allHelpNum:0,ctor:function(){this._super(1028),this.spotAlerts={SHOP_THOUSANDTOWER:this.shopAlert}},shopAlert:function(e){this.skin.redPoint.node.active=e.alert},init:function(){var e=this;e.teamData=game.thousandTowerData,e._super(),e.bossList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.bossList.itemRender=game.ThousandTowerBossItem,e.bossList.bindEnum=e.moduleEnum,e.bossList.addToParent(e.skin.bossList),e.bossList.layout.spacingX=10;var t=game.InstanceMiscCfg.getData("thousandTowerHelps");t&&(e.allHelpNum=+t.value)},onShow:function(){this._super(),this.updateData(),this.scrollToSelectPos()},scrollToSelectPos:function(){var e=this.teamData.getCurBossInfo().index-1;e&&0!=e?(3<e&&(e=3),this.bossList.scrollToRight(196*e)):this.bossList.scrollToLeft(0)},view_left:function(){this.bossList.scrollContainerLeft()},view_right:function(){this.bossList.scrollContainerRight()},setAutoBtns:function(){this._super(),this.skin.autoJoin.active=!1},notify:function(e,t){switch(this._super(e,t),e){case this.Evts.V_UPDATE_DATA:this.updateData()}},setCount:function(){},updateData:function(){var e=this.skin,t=this.teamData.selectTowerId;if(this.teamData.getTowerInfoById(t)){var a=this.teamData.curInsId,i=this.teamData.getBossInfoById(a);if(i){var n=i.canSweep;e.sweepNode.active=n,e.teamNode.active=!n;var s=i.cfg;this.teamData.isInTeam||(e.instanceTitleLab.string=s.name);var r=this.allHelpNum-this.teamData.helpNum;r=0<r?r:0,e.awardCountLab.string=game.Lang.get(3004,r,this.allHelpNum)}}},setTeamBossList:function(){this.bossInfoList=this.teamData.getBossInfoList(),this.bossList.setData(this.bossInfoList);for(var e=0,t=this.bossInfoList.length;e<t;e++)this.bossInfoList[e].change()},closeBtn:function(){game.module.hide(this.moduleEnum)},returnBtn:function(){game.module.hide(this.moduleEnum)}});b8e.module.registerView(game.ME.ThousandTowerTeam,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1029)},init:function(){var e=this,t=e.towerList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.ThousandTowerItem,t.bindEnum=e.moduleEnum,t.layout.spacingY=-2,t.addToParent(e.skin.towerList),e.timer=b8e.Timer.add(e,e.updateTime,500),e.bg=b8e.Sprite.get(),e.bg.setAnchor(.5,.5),e.bg.loadTexture(game.ResCfg.getUrl(221)),e.skin.bg.addChild(e.bg)},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateData()}},onShow:function(){game.thousandTowerData.initThousandTowerData(),this.updateData()},updateTime:function(){if(!this.endTime)return this.skin.timeLab.string=game.Lang.get(6601),void this.resetTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.timeLab.string=game.Lang.get(6601),void this.resetTime();this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},resetTime:function(){game.thousandTowerData.resetTimeCfg(),this.endTime=game.thousandTowerData.resetTime},updateData:function(){var e=this.skin,t=game.thousandTowerData;this.endTime=t.resetTime,this.timer.reset(),this.timer.start(),this.updateTime();var a=t.getShowTowerInfoList();this.towerList.setData(a);var i=t.getBossInfoById(t.insid);if(i){var n=t.getTowerInfoById(i.towerId);e.curTowerLab.string=game.Lang.get(8552,n.index,i.index)}else e.curTowerLab.string=game.Lang.get(8552,1,1);var s=227*-(t.getEnterTowerInfo().index-1),r=-(227*t.towerInfoList.length-706),o=s<r?r:s;this.towerList.scrollToBottom(o)},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ThousandTower,e)}(),function(){var e;e=b8e.Enum({None:b8e.enc(),C2V_UPDATA_RANK:b8e.enc()}),b8e.RC("$$game","$$FlagWarEvts",e)}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:8831,okcb:this.onClickGameAlert,cancelCloseCb:!1,thisArg:this},this._alertOptions2={lang:8833,okcb:this.onClickSnatch,cancelCloseCb:!1,thisArg:this}},ipc:function(){var e=this;e.evts={FlagWarBattle:{C_LEAVE:e.updataPage,C2C_BATTLE_END:e.updataPage,C_CLEAR_CD:e.clearCDHandler},MainRole:{C_RESET_DAILY:e.resetDaily},Back:{C_UPDATE_AMOUNT:e.updateAmount}},e.handels={CaptureFlagCollectMsg:e.captureFlagCollectMsg,CaptureFlagMsg:e.captureFlagMsg,CaptureFlagDataResp:e.captureFlagDataResp}},triggerOpen:function(e){e==this.moduleEnum&&(game.flagWarData.init(),this.sender.CaptureFlagDataReq(),this.dpt(this.Evts.C_UPDATA_RANK))},showOccupied:function(){this._alertOptions2.langArgs=game.flagWarData.snatchName,game.alert.show(this._alertOptions2),game.flagWarData.isSnatch=!1},onClickSnatch:function(){game.module.showToggle(game.ME.ChallengeCbp,2)},updateAmount:function(){this.send(this.Evts.C_UPDATE_AMOUNT)},resetDaily:function(){game.moduleOpen.checkOpen(game.ME.Occupied)&&this.sender.CaptureFlagDataReq()},notify:function(e){switch(e){case this.Evts.V_GET_OCCUPIED:this.sender.CaptureFlagDataReq(),this.dpt(this.Evts.C_UPDATA_RANK);break;case this.Evts.V_SHOW_OCCUPIED_SNATCH:game.flagWarData.isSnatch&&this.showOccupied()}},clearCDHandler:function(){this.send(this.Evts.C_UPDATE_DATA)},updataPage:function(){this.send(this.Evts.C_UPDATE_DATA)},captureFlagDataResp:function(e){var t=e.readProtobuf(game.pb.CaptureFlagDataResponse);0<t.code?game.notice.noticeError(t.code):(game.flagWarData.setData(t),this.send(this.Evts.C_UPDATE_DATA))},captureFlagCollectMsg:function(e){var t=e.readProtobuf(game.pb.CaptureFlagCollectNotify);0<t.code?game.notice.noticeError(t.code):(game.flagWarData.score+=t.score,game.flagWarData.lastCollectTime=game.SysTime.curTime/1e3,this.send(this.Evts.C_UPDATE_DATA))},captureFlagMsg:function(e){var t=e.readProtobuf(game.pb.CaptureFlagNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.flagWarData,i=a.getOccupiedInfo(t.data.num,t.data.cityId),n=game.mainRoleData.roleId;i&&t.data.occupier&&i.occupier&&i.occupier.roleId==n&&(a.isSnatch=!0,a.snatchName=t.data.occupier.name,b8e.module.isShowView(game.ME.FlagWar)&&this.showOccupied()),game.flagWarData.updateOccupier(t.data),this.send(this.Evts.C_UPDATE_DATA)}},shopBtn:function(){game.module.showToggle(game.ME.Mystery2Shop,4)},rankBtn:function(){game.module.show(game.ME.FlagWarRank)},leftBtn:function(){1<game.flagWarData.curPage&&(game.flagWarData.curPage--,this.send(this.Evts.C_UPDATE_DATA))},rightBtn:function(){game.flagWarData.curPage<game.flagWarData.maxPage&&(game.flagWarData.curPage++,this.send(this.Evts.C_UPDATE_DATA))},clickItem:function(e){if(game.teamLeagueData.checkTeamById(game.mainRoleData.id))if(game.flagWarData.isOpen()){var t=game.flagWarData.getOccupiedInfo(game.flagWarData.curPage,e);(game.flagWarData.curInfo=t).occupier?this.dpt(this.Evts.C2C_SHOW_BATTLE):(this._alertOptions.args=t,game.alert.show(this._alertOptions))}else game.notice.show(7252);else game.notice.show(8830)},onClickGameAlert:function(e){this.dpt(this.Evts.C_CHALLENGE,e)},team:function(){game.module.show(game.ME.TeamLeague)},item1:function(){this.clickItem(1)},item2:function(){this.clickItem(2)},item3:function(){this.clickItem(3)},item4:function(){this.clickItem(4)},item5:function(){this.clickItem(5)},item6:function(){this.clickItem(6)},item7:function(){this.clickItem(7)},item8:function(){this.clickItem(8)},item9:function(){this.clickItem(9)}}),t=game.Sender.extends({ipc:function(){this.msg={CaptureFlagDataReq:null}}});b8e.module.registerControl(game.ME.FlagWar,e,game.OccupiedEvts,t)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={FlagWar:{C_UPDATA_RANK:this.updataRank}},this.handels={CaptureFlagRankResp:this.captureFlagRankResp}},captureFlagRankResp:function(e){var t=e.readProtobuf(game.pb.CaptureFlagRankResponse);0<t.code?game.notice.noticeError(t.code):(game.flagWarData.setRankList(t.type,t),this.send(this.Evts.C2V_UPDATA_RANK))},notify:function(e,t){switch(e){case this.Evts.C_GET_RANK:this.sender.CaptureFlagRankReq(t)}},updataRank:function(){this.sender.CaptureFlagRankReq(game.OccupiedRankType.GUILD)},setSelect:function(e){return game.flagWarData.rankSelect==e||(game.flagWarData.rankSelect=e,!1)},teamRank:function(){this.setSelect(0)||this.sender.CaptureFlagRankReq(game.OccupiedRankType.GUILD)},selfRank:function(){this.setSelect(1)||this.sender.CaptureFlagRankReq(game.OccupiedRankType.PLAYER)},teamAward:function(){this.setSelect(2)||this.send(this.Evts.C2V_UPDATA_RANK)},selfAward:function(){this.setSelect(3)||this.send(this.Evts.C2V_UPDATA_RANK)}}),t=game.Sender.extends({ipc:function(){this.msg={CaptureFlagRankReq:this.conquerRankReq}},conquerRankReq:function(e){var t=game.pb.CaptureFlagRankRequest;t.type=e,this.write(t)}});b8e.module.registerControl(game.ME.FlagWarRank,e,game.FlagWarEvts,t)}(),function(){var e=game.Control.extends({init:function(){this._alertOptions={lang:7234,okcb:this.onClickGameAlert,cancelCloseCb:!1,thisArg:this},this._alertOptions2={lang:8832,okcb:this.onClickLeave,cancelCloseCb:!1,thisArg:this}},ipc:function(){this.evts={FlagWar:{C_CHALLENGE:this.challengeHandler,C2C_SHOW_BATTLE:this.showTeam}},this.handels={CaptureFlagTeamInfoResp:this.captureFlagTeamInfoResp,CaptureFlagChallengeResp:this.captureFlagChallengeResp,CaptureFlagLeaveResp:this.captureFlagLeaveResp,CaptureFlagCleanupResp:this.captureFlagCleanupResp}},notify:function(e){switch(e){case this.Evts.V_GET_QUERY:}},challengeHandler:function(e){var t=e.data;t&&this.challenge(t)},captureFlagCleanupResp:function(e){var t=e.readProtobuf(game.pb.CaptureFlagCleanupResponse);0<t.code?game.notice.noticeError(t.code):(game.flagWarData.cdTime=0,this.dpt(this.Evts.C_CLEAR_CD))},captureFlagLeaveResp:function(e){var t=e.readProtobuf(game.pb.CaptureFlagLeaveResponse);0<t.code?game.notice.noticeError(t.code):(game.flagWarData.leaveOccupied(),game.module.hide(game.ME.FlagWarBattle),game.notice.show(7244),this.dpt(this.Evts.C_LEAVE))},captureFlagChallengeResp:function(e){var t=e.readProtobuf(game.pb.CaptureFlagChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a={type:game.InstanceType.FLAGWAR,isWin:t.battlelog.win};game.playBack.play(t.battlelog,a),game.flagWarData.addCDTime(),game.module.hide(game.ME.FlagWarBattle),this.dpt(this.Evts.C2C_BATTLE_END)}},captureFlagTeamInfoResp:function(e){var t=e.readProtobuf(game.pb.CaptureFlagTeamInfoResponse);0<t.code?game.notice.noticeError(t.code):(game.flagWarData.setOccupiers(t),game.module.show(game.ME.FlagWarBattle))},showTeam:function(){var e=game.flagWarData.curInfo;this.sender.CaptureFlagTeamInfoReq(e.id,e.occupier.roleId)},challenge:function(e){var t=game.flagWarData.cdTime;if(game.flagWarData.getMeCanOccupied())game.alert.showTwo(this._alertOptions2);else if(t>game.SysTime.curTime){var a=game.flagWarData.getCDCost();this._alertOptions.langArgs=a,game.alert.showTwo(this._alertOptions)}else this.sender.CaptureFlagChallengeReq(e.id)},onClickLeave:function(){this.sender.CaptureFlagLeaveReq()},onClickGameAlert:function(){this.sender.CaptureFlagCleanupReq()},snatchBtn:function(){game.flagWarData.curInfo&&this.challenge(game.flagWarData.curInfo)},abortBtn:function(){game.module.hide(game.ME.FlagWarBattle)},outBtn:function(){this.sender.CaptureFlagLeaveReq()}}),t=game.Sender.extends({ipc:function(){this.msg={CaptureFlagTeamInfoReq:this.queryOccupierReq,CaptureFlagChallengeReq:this.conquerChallengeReq,CaptureFlagLeaveReq:null,CaptureFlagCleanupReq:null}},queryOccupierReq:function(e,t){var a=game.pb.CaptureFlagTeamInfoRequest;a.id=e,a.roleId=t,this.write(a)},conquerChallengeReq:function(e){var t=game.pb.CaptureFlagChallengeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.FlagWarBattle,e,game.OccupiedEvts,t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",score:0,rank:"",type:0,setData:function(e){this.name=e.name,this.score=e.score,this.rank=e.rank},recycle:function(){this.reset(),this._super()},reset:function(){this.name="",this.score=0,this.rank="",this.type=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$FlagWarRankInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({rank:0,setPrizeList:function(e){if(this.prizeList)return this.prizeList;if(this.prizeList=[],e&&0<e.length)for(var t=void 0,a=void 0,i=0,n=e.length;i<n;i++)t=e[i],(a=new game.PrizeInfo).setData(t.Id,t.Num,game.IconLayoutEnum.SHOW_NUM),this.prizeList.push(a)},recycle:function(){this.reset(),this._super()},reset:function(){this.prizeList&&(this.prizeList.length=0,this.prizeList=null),this.rank=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$FlagWarAwardRankInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",guildId:0,guildName:"",hp:0,isMale:!1,level:0,maxHp:0,power:0,roleId:0,startTime:0,zone:0,setData:function(e){var t=this;t.name=e.name,t.guildId=e.guildId,t.guildName=e.guildName,t.hp=e.hp,t.isMale=e.isMale,t.level=e.level,t.maxHp=e.maxHp,t.power=e.power,t.roleId=e.roleId,t.startTime=e.startTime,t.zone=e.zone},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.name="",e.guildId=0,e.guildName="",e.hp=0,e.isMale=0,e.level=0,e.maxHp=0,e.power=0,e.roleId=0,e.startTime=0,e.zone=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$FlagWarOccupierInfo",t)}(),function(){var e=game.occupiedModelData.extends({myRank:0,score:0,cdTime:0,addPer:0,cdCount:0,curPage:1,maxPage:8,numPage:9,levelList:null,levelMap:null,guildRanks:null,playerRanks:null,guildRank:0,guildScore:0,playerRank:0,playerScore:0,curInfo:null,occupiedMaxTime:0,lastCollectTime:0,isSnatch:!1,snatchName:"",rankSelect:0,ctor:function(){this._super(),this.guildRanks=[],this.playerRanks=[],this.guildAwardRanks=[],this.playerAwardRanks=[],this.levelList=[],this.levelMap=b8e.HashMap.get()},init:function(){var e=this,t=game.CaptureFlagCfg.getDatas(),a=void 0;if(t&&!(t.length<1)){for(var i=0;i<e.maxPage;i++)for(var n=0,s=t.length;n<s;n++)(a=game.OccupiedInfo.get()).cfg=t[i],e.levelList.push(a),e.levelMap.set(i*e.numPage+n+1,a);e._miscCfg=game.CaptureFlagMiscCfg;var r=e._miscCfg.getData("ctfTimeLimit");r&&(e.occupiedMaxTime=+r.value),e.setAwardList(game.CaptureFlagPlayerRankCfg,e.playerAwardRanks),e.setAwardList(game.CaptureFlagTeamRankCfg,e.guildAwardRanks)}},setAwardList:function(e,t){for(var a=e.getDatas(),i=void 0,n=void 0,s=0;s<a.length;s++)i=a[s],(n=game.FlagWarAwardRankInfo.get()).rank=i.title,n.setPrizeList(i.items),t.push(n)},setRankList:function(e,t){var a=void 0;switch(e){case game.OccupiedRankType.GUILD:a=this.guildRanks,this.guildRank=t.rank,this.guildScore=t.score;break;case game.OccupiedRankType.PLAYER:a=this.playerRanks,this.playerRank=t.rank,this.playerScore=t.score}var i=t.data;if(!a||!i)return null;this.clearList(a);for(var n=void 0,s=0,r=i.length;s<r;s++)(n=game.FlagWarRankInfo.get()).type=e,n.setData(i[s]),a.push(n)},setOccupiers:function(e){for(var t=e.occupiers,a=void 0,i=void 0,n=[],s=0,r=t.length;s<r;s++)a=t[s],(i=game.FlagWarOccupierInfo.get()).setData(a),n.push(i);this.getOccupiedById(e.id).occupiers=n},getDefendAward:function(e){return this.defendAward[e-1]},getOpenTimeArr:function(){if(!this.openTimeArr||this.openTimeArr.length<1){var e=this._miscCfg.getData("ctfOpenTime");if(!e||""==e.value)return!1;this.openTimeArr=e.value.split("-")}return this.openTimeArr},canClearCD:function(){if(!this.cdClearMax){var e=this._miscCfg.getData("ctfCDCost");this.cdCostArr=e.value.split("|"),this.cdClearMax=this.cdCostArr.length}return this.cdClearMax>this.cdCount},getCDCost:function(){if(!this.cdCostArr){var e=this._miscCfg.getData("ctfCDCost");this.cdCostArr=e.value.split("|")}if(this.cdCostArr){var t=this.cdCount<this.cdCostArr.length?this.cdCount:this.cdCostArr.length-1;return this.cdCostArr[t]}return 0},addCDTime:function(){if(!this.cdAddTime){var e=this._miscCfg.getData("ctfCDTime");this.cdAddTime=parseInt(e.value)}this.cdTime=game.SysTime.curTime+1e3*this.cdAddTime},getMeTeamCanOccupied:function(){var e=this.curInfo,t=game.mainRoleData.id,a=e.occupiers;if(!a||a.length<0)return!1;for(var i=void 0,n=0,s=a.length;n<s;n++)if((i=a[n])&&i.roleId==t)return!0;return!1},updataLineLight:function(){for(var e=void 0,t=void 0,a=void 0,i=void 0,n=void 0,s=[],r=0;r<this.numPage-1;r++)if((i=this.getOccupiedInfo(this.curPage,r+1))&&i.occupier&&(e=game.CaptureFlagCfg.getData(i.cityId))&&e.link&&e.linkLine){t=e.link.split("|"),a=e.linkLine.split("|");for(var o=0,g=t.length;o<g;o++)(n=this.getOccupiedInfo(this.curPage,+t[o]))&&n.occupier&&i.occupier.guildId==n.occupier.guildId&&s.push(+a[o])}return s}});game.flagWarData=game.flagWarData||new e}(),function(){var e=game.View.extends({itemList:null,ctor:function(){this._super(415)},init:function(){var e=this,t=e.skin;e.itemList=[];for(var a=void 0,i=void 0,n=0;n<game.flagWarData.numPage;n++){var s=e.getComponent("item"+(n+1));s&&((a=new game.FlagWarRoleItem).hide(),a.x=s.x,a.y=s.y,t.mapNode.addChild(a),e.itemList.push(a),(i=game.CaptureFlagCfg.getData(n+1))&&s.loadTexture(game.ResCfg.getUrl(5060,i.type)))}e.costIcon=b8e.Sprite.get(),e.costIcon.setAnchor(.5,.5),e.costIcon.addToParent(e.skin.icon),e.costIcon.setSize(40,40),e.timer=b8e.Timer.add(e,e.updateTime,500),e.skin.bg.loadTexture(game.ResCfg.getUrl(5059))},notify:function(e){switch(e){case this.Evts.C_UPDATE_DATA:this.updateView();break;case this.Evts.C_UPDATE_AMOUNT:this.updateAmount()}},onShow:function(){this.updateView(),this.updateAmount(),this.send(this.Evts.V_GET_OCCUPIED),this.send(this.Evts.V_SHOW_OCCUPIED_SNATCH)},onHide:function(){if(this.stopTime(),this.itemList&&this.itemList.length)for(var e=0,t=this.itemList.length;e<t;e++)this.itemList[e].hide()},onStageResize:function(){this.setPosition(0,0)},updateTime:function(){var e=game.flagWarData.cdTime-game.SysTime.curTime,t=this.skin;if((e=parseInt(e/1e3))<=0)return this.stopTime(),void(t.cdLab.string=game.Lang.get(9387));t.cdLab.string=game.Lang.get(9501,e)},updateView:function(){var e=this.skin,t=game.flagWarData;e.scoreLab.string=t.score,e.teamLab.string=t.guildScore,e.addLab.string=t.addPer+"%",e.pageLab.string=t.curPage+"/"+t.maxPage;for(var a=void 0,i=void 0,n=0;n<t.numPage;n++)a=this.itemList[n],(i=t.getOccupiedInfo(t.curPage,n+1))&&i.occupier?(a.show(),a.setData(i)):a.hide();var s=game.SysTime.curTime;t.cdTime>s?(this.timer.reset(),this.timer.start(),this.updateTime()):(e.cdLab.string=game.Lang.get(9387),this.stopTime());for(var r=t.updataLineLight(),o=1;o<=13;o++)this.getComponent("line"+o).active=-1<r.indexOf(o)},updateAmount:function(){var e=game.amount.getCfgByType(game.AmountType.FLAGWAR),t=game.ResCfg.getUrl(137,e.icon);this.costIcon.loadTexture(t),this.skin.coinLab.string=game.amount.get(game.AmountType.FLAGWAR)},stopTime:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.FlagWar,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(413),this.setSize(540,94)},setData:function(){var e=this.skin,t=this.data;e.rank_title1.active=1==t.rank,e.rank_title2.active=2==t.rank,e.rank_title3.active=3==t.rank,e.rank_title4.active=3<t.rank&&t.rank%2==0,e.rank.string=t.rank;var a=game.Color.WHITE;switch(t.rank){case 1:a=game.Color.RED;break;case 2:a=game.Color.BLUE;break;case 3:a=game.Color.GREEN}e.name.string=game.HtmlUtil.getText(a,t.name),e.score.string=t.score}}),b8e.RC("$$game","$$FlagWarRankItem",e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(410),this.setSize(540,94)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.layout.spacingX=15,e.layout.paddingTop=5,e.addToParent(this.skin.prizeList)},setData:function(){var e=this.skin,t=this.data;this.prizeList.setData(this.data.prizeList),e.rank_bg1.active=1==t.rank,e.rank_bg2.active=2==t.rank,e.rank_bg3.active=3==t.rank,e.lbl_rank.string=t.rank}}),b8e.RC("$$game","$$FlagWarAwardRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(414)},init:function(){var e=this.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.FlagWarRankItem,e.bindEnum=game.ME.FlagWarRank,e.layout.spacingY=0,e.addToParent(this.skin.scrollView1);var t=this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.FlagWarAwardRankItem,t.bindEnum=game.ME.FlagWarRank,t.addToParent(this.skin.scrollView2)},onShow:function(){this.send(this.Evts.C_GET_RANK,game.OccupiedRankType.GUILD)},notify:function(e){switch(e){case this.Evts.C2V_UPDATA_RANK:this.updataList()}},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)},updataList:function(){var e=game.flagWarData,t=e.rankSelect,a=void 0,i=void 0,n=void 0,s=void 0,r=void 0;switch(t){case 0:a=e.guildRanks,s=e.guildRank,r=e.guildScore,i=8836,n=8837;break;case 1:a=e.playerRanks,s=e.playerRank,r=e.playerScore,i=8642,n=8643;break;case 2:a=e.guildAwardRanks;break;case 3:a=e.playerAwardRanks}i&&n&&(this.skin.lbl_rank.string=game.Lang.get(i,s),this.skin.lbl_point.string=game.Lang.get(n,r)),this.skin.alpha.active=0==t||1==t,this.rankList.active=0==t||1==t,this.awardList.active=2==t||3==t,0==t||1==t?this.rankList.setData(a):this.awardList.setData(a);for(var o=0;o<4;o++)this.getComponent("btn_choose"+(o+1)).active=t==o}});b8e.module.registerView(game.ME.FlagWarRank,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(411),this.setSize(176,253)},init:function(){var e=this._headImg=b8e.Sprite.get();e.setAnchor(.5,.5),e.addToParent(this.skin.head),this.hpWidth=this.skin.hp.width},setData:function(){var e=this.skin,t=this.data;e.name.string=t.name+".S"+t.zone,e.level.string=t.level,e.power.string=t.power;var a=t.isMale;if(null!=a&&null!=a){var i=game.ResCfg.getHead(a);this._headImg.loadTexture(i)}else this._headImg.unloadTexture();t.maxHp?e.hp.width=this.hpWidth*t.hp/t.maxHp:e.hp.width=this.hpWidth}}),b8e.RC("$$game","$$FlagWarBattleItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(412)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.FlagWarBattleItem,t.bindEnum=this.moduleEnum,t.addToParent(e.headList),this.timer=b8e.Timer.add(this,this.updateTime,500)},onShow:function(){this.updateView()},onHide:function(){this.stopTime()},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)},updateView:function(){var e=game.flagWarData.curInfo;if(e&&e.occupier){var t=e.occupier.roleId==game.mainRoleData.roleId,a=game.flagWarData.getMeTeamCanOccupied(),i=game.teamLeagueData.checkTeamById(e.occupier.roleId),n=this.skin;n.timeNode.active=t||a||i,n.outBtn.active=t,n.notBtn.active=!t&&(a||i),n.snatchBtn.active=!t&&!a&&!i,n.desc.active=!t&&!a&&!i,this.timer.reset(),this.timer.start(),this.updateTime(),this.list.setData(e.occupiers)}},updateTime:function(){var e=game.flagWarData.curInfo;if(e&&e.occupier){var t=game.SysTime.curTime-1e3*e.occupier.startTime;this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(t)}},stopTime:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.FlagWarBattle,e)}(),function(){var e;e=game.OccupiedRoleItem.extends({_showModel:!1,icon:null,_init:!1,updateTime:function(){if(this.info&&this.info.occupier){var e=game.SysTime.curTime/1e3-game.flagWarData.lastCollectTime;e=this.info.cfg.interval<=e?this.info.cfg.interval:e,e=parseInt(e);var t=this.skin;t.timeLab.string=e+"S",t.proBar.width=140*e/this.info.cfg.interval}}}),b8e.RC("$$game","$$FlagWarRoleItem",e)}(),function(){var e;e=b8e.Enum({None:0,V_REFRESH_BTN:-1,V_SELECT_BTN:-1,V_SHOW_VIEW:-1,V_HIDE_VIEW:-1,C2C_REFRESH_BTNS:-1,V_AUTO_POP:-1,C_AUTO_POP:-1,C2C_CHANGEBTN:-1,V_UPDATE_VIEW:-1,V_RECEIVE_ITEM:-1}),b8e.RC("$$game","$$FestivalRechargeEvts",e)}(),function(){var e=game.Control.extends({init:function(){var e=game.spotAlert;this.spotAlert=e.set(game.SAE.FESTIVAL_ACCURECHARGE_ALERT,game.SAE.FESTIVAL_RECHARGE_ALERT),this.spotAccuAlert=e.set(game.SAE.FESTIVAL_ACCURECHARGE,game.SAE.FESTIVAL_ACCURECHARGE_ALERT),this.spotDayAlert=e.set(game.SAE.FESTIVAL_DAYRECHARGE,game.SAE.FESTIVAL_ACCURECHARGE_ALERT)},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.initRechargeData,C_RECHARGE_SUCCESS:this.rechargeSuccess},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={LimitDailyRechargeResp:this.limitDailyRechargeResp,LimitAccuRechargeResp:this.limitAccuRechargeResp}},triggerOpen:function(e){e==this.moduleEnum&&(game.festivalAccuRechargeData.initAccuCfg(),game.festivalDayRechargeData.initAccuCfg())},limitAccuRechargeResp:function(e){var t=e.readProtobuf(game.pb.LimitAccuRechargeResponse);0<t.code?game.notice.noticeError(t.code):(game.festivalAccuRechargeData.setAward(t.id),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW))},limitDailyRechargeResp:function(e){var t=e.readProtobuf(game.pb.LimitDailyRechargeResponse);0<t.code?game.notice.noticeError(t.code):(game.festivalDayRechargeData.setAward(t.id),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW))},notify:function(e,t){switch(e){case this.Evts.V_RECEIVE_ITEM:this.sender.LimitAccuRechargeReq(t)}},initRechargeData:function(){var e=game.rechargeData;game.festivalAccuRechargeData.setupAccData(e.limitAccRechargeAwards,e.limitAccRechargeGroup,e.limitAccRechargeMoney),game.festivalDayRechargeData.setupDayData(e.limitDailyRecharges,e.rechargeMoneyDaily),this.checkSpotAlert()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data,a=0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;game.festivalAccuRechargeData.updataAccRechargeMoney(a),game.festivalDayRechargeData.updataAccRechargeMoney(a),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW)}},resetDaily:function(){game.festivalAccuRechargeData.resetDaily(),game.festivalDayRechargeData.resetDaily(),this.checkSpotAlert(),this.dpt(this.Evts.C2C_REFRESH_BTNS),this.send(this.Evts.V_UPDATE_VIEW)},checkSpotAlert:function(){this.spotAccuAlert.alert=game.festivalAccuRechargeData.checkAlert(),this.spotDayAlert.alert=game.festivalDayRechargeData.checkAlert()},box_1:function(){this.receiveBox(1)},box_2:function(){this.receiveBox(2)},box_3:function(){this.receiveBox(3)},box_4:function(){this.receiveBox(4)},box_5:function(){this.receiveBox(5)},box_6:function(){this.receiveBox(6)},box_7:function(){this.receiveBox(7)},receiveBox:function(e){var t=game.festivalDayRechargeData.getActivityList();if(t&&t.length>=e){var a=t[e-1];a.isGet?game.notice.show(1353):a.isCanGet?this.sender.LimitDailyRechargeReq(a.id):(game.prizeTipsData.setup(a.cfg.award),game.module.show(game.ME.PrizeTips))}}}),t=game.Sender.extends({ipc:function(){this.msg={LimitAccuRechargeReq:this.limitAccuRechargeReq,LimitDailyRechargeReq:this.limitDailyRechargeReq}},limitDailyRechargeReq:function(e){var t=game.pb.LimitDailyRechargeRequest;t.id=e,this.write(t)},limitAccuRechargeReq:function(e){var t=game.pb.LimitAccuRechargeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.FestivalAccuRecharge,e,game.FestivalRechargeEvts,t)}(),function(){var e=game.Control.extends({lastId:0,lastModuleEnum:-1,mainEntrance:!0,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.FESTIVAL_RECHARGE_ALERT,game.SAE.HOME)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},FestivalAccuRecharge:{C2C_REFRESH_BTNS:this.refreshBtns}}},triggerOpen:function(e){e==this.moduleEnum&&game.festivalRechargeData.init()},resetDaily:function(){this.send(this.Evts.V_REFRESH_BTN),this.dpt(this.Evts.C2C_REFRESH_BTNS),this.selectFirstBtn()},notify:function(e,t){switch(e){case this.Evts.V_SELECT_BTN:this.selectBtn(t);break;case this.Evts.V_SHOW_VIEW:this.showView();break;case this.Evts.V_HIDE_VIEW:this.hideView()}},showView:function(){if(this.mainEntrance)this.selectFirstBtn();else{this.mainEntrance=!0}},hideView:function(){0<this.lastModuleEnum&&game.module.hide(this.moduleEnum),game.festivalRechargeData.selectPage(0,this.lastId),this.lastId=-1,this.lastModuleEnum=-1},refreshBtns:function(){this.send(this.Evts.V_REFRESH_BTN),this.dpt(this.Evts.C2C_REFRESH_BTNS);var e=game.festivalRechargeData.getBtns();if(!e||e.length<1){game.module.hide(this.moduleEnum)}else;},selectFirstBtn:function(){var e=game.festivalRechargeData.getBtns();if(!e||e.length<1){game.module.hide(this.moduleEnum)}else this.selectBtn(e[0].id)},selectBtn:function(e){var t=this;if(t.lastId!=e){var a=game.FestivalRechargeBtnCfg.getData(e);if(a){if(game.festivalRechargeData.checkIsOpen(e)){if(t.lastModuleEnum!=a.moduleEnum){-1<t.lastModuleEnum&&game.module.hide(t.lastModuleEnum),game.module.showTab(a.moduleEnum,t.moduleEnum);var i=a.id;game.festivalRechargeData.selectPage(i,t.lastId),t.lastId=i,t.lastModuleEnum=a.moduleEnum,game.festivalRechargeData.lastBtnId=t.lastId,t.dpt(t.Evts.C2C_CHANGEBTN)}}else{if(0<this.lastId){this.selectBtn(this.lastId)}else this.selectFirstBtn()}}}},selectToggle:function(e){if(game.FestivalRechargeBtnCfg.getData(e)){var t=game.festivalRechargeData.getBtns();if(!t||t.length<1){game.module.hide(this.moduleEnum)}else this.mainEntrance=!1,this.selectBtn(e)}else;}});b8e.module.registerControl(game.ME.FestivalRecharge,e,game.FestivalRechargeEvts)}(),function(){var e=void 0;e=b8e.Object.extends({selectId:0,accRechargeMoney:0,awardList:null,curGroup:0,endTime:0,isGetAllAward:!0,ctor:function(){this._super(),this.activityList=[],this.awardList=[],this.moneyMap=b8e.HashMap.get(),this.activityMap=b8e.HashMap.get()},initAccuCfg:function(){if(!this.infoMap){this.infoMap=b8e.HashMap.get();var e=game.LimitAccuRechargeCfg.getDatas();if(e&&!(e.length<1))for(var t=void 0,a=e.length,i=0;i<a;i++)(t=new game.FestivalAccuRechargeInfo).setData(e[i]),this.infoMap.set(t.id,t)}},setupAccData:function(e,t,a){e&&(this.awardList=e),t&&this.moneyMap.set(t,a),this.initList()},initList:function(){var e=this;e.initAccuCfg(),e.activityList.length=0;var t=e.infoMap.values();if(t&&!(t.length<1)){var a,i=t.length;e.isGetAllAward=!0;for(var n=void 0,s=0;s<i;s++)(n=t[s]).getIsOpen()&&(e.curGroup=n.cfg.group,a=e.getAccRechargeMoney(n.cfg.group),n.isGet=e.getIsGetAward(n.id),e.isGetAllAward&&(e.isGetAllAward=n.isGet),n.isCanGet=n.cfg.money<=a,e.activityMap.set(n.id,n),e.activityList.push(n),e.endTime<n.endTime&&(e.endTime=n.endTime))}},getIsGetAward:function(e){return-1<this.awardList.indexOf(e)},setAward:function(e){if(this.activityMap.get(e).isGet=!0,this.awardList.push(e),this.isGetAllAward=!0,this.activityList&&!(this.activityList.length<1))for(var t=this.activityList.length,a=0;a<t;a++){if(!this.activityList[a].isGet)return void(this.isGetAllAward=!1)}},updataAccRechargeMoney:function(e){var t=this.moneyMap.get(this.curGroup);if(t?t+=e:t=e,this.moneyMap.set(this.curGroup,t),this.activityList&&!(this.activityList.length<1))for(var a=this.activityList.length,i=0;i<a;i++){var n=this.activityList[i];n.isCanGet=n.needMoney<=t,n.change=!n.change}},resetDaily:function(){this.curGroup=0,this.initList()},isOpen:function(){return!!game.moduleOpen.checkOpen(game.ME.FestivalAccuRecharge)&&!!this.curGroup},getAllAward:function(){return this.isGetAllAward},getAccRechargeMoney:function(e){var t=this.moneyMap.get(e);return t||0},listSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.id-t.id},getActivityList:function(){return this.activityList.sort(this.listSort)},getActivityInfo:function(e){return this.activityMap.get(e)},getEndTime:function(){return this.endTime-game.SysTime.curTime},getMaxId:function(){return!this.activityList||this.activityList.length<1?0:this.activityList[this.activityList.length-1].id},checkAlert:function(){if(this.curGroup&&this.activityList&&!(this.activityList.length<1)){if(this.isGetAllAward)return!1;for(var e=this.activityList.length,t=0;t<e;t++){var a=this.activityList[t];if(a.isCanGet&&!a.isGet)return!0}return!1}}}),game.festivalAccuRechargeData=game.festivalAccuRechargeData||new e,b8e.RC("$$game","$$FestivalAccuRechargeData",e)}(),function(){var e=void 0;e=b8e.Object.extends({id:0,cfg:null,alert:!1,isGet:!1,isCanGet:!1,change:!1,setData:function(e){if(e){this.cfg=e,this.id=e.id,this.needMoney=e.money,this.serverStart=e.serverStart,this.serverEnd=e.serverEnd;var t=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime();t=t/1e3>>0,this.startTime=1e3*t;var a=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime();a=a/1e3>>0,this.endTime=1e3*a,this.openDay=game.TimeUtil.getOpenDayByStr(e.startTime,"yyyy-MM-dd  hh:mm:ss")}},getPrizeList:function(){var e=this;if(e.award){return e.award}e.award=[];for(var t,a,i=e.cfg.award,n=i.length,s=0;s<n;s++){t=i[s],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),e.award.push(a)}return e.award},getIsOpen:function(){var e=game.SysTime.curTime;return!(this.startTime>e||this.endTime<=e)&&(!(this.openDay<this.serverStart)&&!(0<this.serverEnd&&this.openDay>=this.serverEnd))}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$FestivalAccuRechargeInfo",e)}(),function(){var e=game.FestivalAccuRechargeData.extends({rechargeMoney:0,ctor:function(){this._super()},initAccuCfg:function(){if(!this.infoMap){this.infoMap=b8e.HashMap.get();var e=game.LimitDailyRechargeCfg.getDatas();if(e&&!(e.length<1))for(var t=void 0,a=e.length,i=0;i<a;i++)(t=new game.FestivalAccuRechargeInfo).setData(e[i]),this.infoMap.set(t.id,t)}},setupDayData:function(e,t){e&&(this.awardList=e),this.rechargeMoney=t,this.initList()},updataAccRechargeMoney:function(e){this.rechargeMoney+=e;for(var t=this.activityList.length,a=0;a<t;a++){var i=this.activityList[a];i.isCanGet=i.needMoney<=this.rechargeMoney}},resetDaily:function(){this.awardList=[],this.rechargeMoney=0,this.curGroup=0,this.initList()},getAccRechargeMoney:function(){return this.rechargeMoney},isOpen:function(){return!!game.moduleOpen.checkOpen(game.ME.FestivalAccuRecharge)},listSort:function(e,t){return e.id-t.id},checkAlert:function(){if(!this.activityList||this.activityList.length<1)return!1;if(this.isGetAllAward)return!1;for(var e=this.activityList.length,t=0;t<e;t++){var a=this.activityList[t];if(a.change=!a.change,a.isCanGet&&!a.isGet)return!0}return!1}});game.festivalDayRechargeData=game.festivalDayRechargeData||new e}(),function(){var e;e=b8e.Object.extends({select:!1,alert:!1,id:0,sortId:0,redPoint:!1,setData:function(e){this.id=e.id,this.sortId=e.sortId,this.redPoint=e.redPoint,this.cfg=e,this.bindAlert(e.id)},bindAlert:function(e){if(e){var t;switch(e){case game.FestivalRechargeType.ACCURECHARGE:t=game.SAE.FESTIVAL_ACCURECHARGE_ALERT}if(t){game.spotAlert.setCb(t,this.updateAlert,this)}}},updateAlert:function(e){this.alert=e.alert}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FestivalRechargeBtnInfo",e)}(),function(){var e=b8e.Object.extends({lastBtnId:0,alertList:null,ctor:function(){this._super(),this.festivalRechargeBtns=[],this.festivalRechargeBtnsMap=b8e.HashMap.get()},init:function(){this.initBtns()},initBtns:function(){this.festivalRechargeBtnsMap.clear();var e,t,a=game.FestivalRechargeBtnCfg.getDatas();if(!a||a.length<1)return null;for(var i=a.length,n=0;n<i;n++)e=a[n],(t=new game.FestivalRechargeBtnInfo).setData(e),this.festivalRechargeBtnsMap.set(t.id,t)},getBtns:function(){if(this.festivalRechargeBtns.length=0,!this.festivalRechargeBtnsMap)return this.festivalRechargeBtns;for(var e,t=this.festivalRechargeBtnsMap.values(),a=t.length,i=0;i<a;i++)e=t[i],this.isShowActive(e.id)&&(this.festivalRechargeBtns.push(e),e.bindAlert(e.redPoint));return this.festivalRechargeBtns.sort(this.sortBtn),this.festivalRechargeBtns},sortBtn:function(e,t){return e.sortId-t.sortId},isShowActive:function(e){return this.checkIsOpen(e)},selectPage:function(e,t){if(this.festivalRechargeBtns&&!(this.festivalRechargeBtns.length<1)){for(var a,i=this.festivalRechargeBtns.length,n=0;n<i;n++)(a=this.festivalRechargeBtns[n]).id==e&&(a.select=!0),a.id==t&&(a.select=!1);this.curIndex=e}},checkIsOpen:function(e){var t=this.getOpenEnumById(e);if(0==t)return!1;if(!game.moduleOpen.checkOpen(t))return!1;if(!game.FestivalRechargeBtnCfg.getData(e))return!1;switch(e){case game.FestivalRechargeType.ACCURECHARGE:return game.festivalAccuRechargeData.isOpen()}return!1},getOpenEnumById:function(e){var t=game.FestivalRechargeBtnCfg.getData(e);return t?t.moduleEnum:0},isOpen:function(){if(!game.moduleOpen.checkOpen(game.ME.FestivalRecharge))return!1;var e=this.getBtns();return!(!e||e.length<1)}});game.festivalRechargeData=game.festivalRechargeData||new e}(),function(){var e;e=b8e.Enum({NONE:0,ACCURECHARGE:1}),b8e.RC("$$game","$$FestivalRechargeType",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(370),this.setSize(600,177)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.ShowItemListItem,t.addToParent(e.skin.priceList),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingX=35},setData:function(){var e=this.skin,t=this.data,a=t.getPrizeList();this.prizeList.setData(a),e.title.string=t.name,e.rechargeBtn.active=!t.isCanGet&&!t.isGet,e.getBtn.active=t.isCanGet&&!t.isGet,e.isGetImg.active=t.isGet;var i=game.festivalAccuRechargeData.getAccRechargeMoney(t.cfg.group),n=i>=t.needMoney?8828:8829;i=i>t.needMoney?t.needMoney:i,e.title.string=game.Lang.get(n,t.needMoney,i,t.needMoney)},getBtn:function(){this.send(game.FestivalRechargeEvts.V_RECEIVE_ITEM,this.data.id)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),b8e.RC("$$game","$$FestivalAccuRechargeItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(371)},init:function(){var e=this,t=e.skin;e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.list.itemRender=game.FestivalAccuRechargeItem,e.list.bindEnum=game.ME.FestivalAccuRecharge,e.list.layout.paddingLeft=14,e.list.layout.paddingTop=11,e.list.addToParent(t.list),t.dayNode.active=!1,e.timer=b8e.Timer.add(e,e.updateTime,500);var a=e.bannerBg=b8e.Sprite.get();a.setAnchor(.5,.5),a.addToParent(e.skin.banner),e.updateBanner()},updateBanner:function(){var e=game.FestivalRechargeBtnCfg.getData(game.FestivalRechargeType.ACCURECHARGE);e&&this.bannerBg.loadTexture(game.ResCfg.getImgUrl(e.banner,!0))},updateTime:function(){if(!this.endTime)return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.timeLab.string=game.Lang.get(6601),void this.stopTime();this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},notify:function(e){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateData()}},onShow:function(){this.updateData()},updateData:function(){var e=this,t=e.skin,a=game.festivalAccuRechargeData,i=game.festivalDayRechargeData;if(e.endTime=a.endTime,e.timer.reset(),e.timer.start(),e.updateTime(),t.moneyLab.string=game.Lang.get(1701,a.getAccRechargeMoney(a.curGroup)),t.lab_1.x=t.moneyLab.x-t.moneyLab.width,t.dayMoneyLab.string=game.Lang.get(1701,i.rechargeMoney),e.datas=a.getActivityList(),e.list.setData(e.datas),i.isOpen()){var n=i.getActivityList(),s=void 0,r=0;t.dayNode.active=!0;for(var o=0;o<7;o++)n.length>o?(s=n[o],e.getComponent("box"+(o+1)).active=!0,e.getComponent("moneyLab"+(o+1)).string=game.Lang.get(1701,s.needMoney),e.getComponent("toReceive"+(o+1)).active=s.isGet,(s.isCanGet||s.isGet)&&r++,!s.isGet&&s.isCanGet?e.playAnima(o):e.removeAnima(o)):e.getComponent("box"+(o+1)).active=!1;e.setProgress(r)}else t.dayNode.active=!1},setProgress:function(e){this.skin.pb1.width=70*e},playAnima:function(e){this.skin;this.anims||(this.anims=[]);var t=this.anims[e];if(t||(t=this.createAnim(),this.anims[e]=t),!t.parent){var a=e+1,i=this.getComponent("eff"+a);t.addToParent(i)}t.setVisible(!0),t.play()},createAnim:function(){var e=b8e.Animator.get(game.AnimType.UI_EFFECT,1);return e.load(game.ResCfg.getUrl(5019,2006)),e.setScale(1,1),e},removeAnima:function(e){if(this.anims){var t=this.anims[e];t&&(t.setVisible(!1),t.removeFromParent())}},onHide:function(){this.stopTime()},stopTime:function(){this.timer&&this.timer.stop()},onStageResize:function(){}});b8e.module.registerView(game.ME.FestivalAccuRecharge,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(372),this.setSize(86,96)},init:function(){var e=this.btn=b8e.Sprite.get();e.addToParent(this.skin.btn),e.setAnchor(.5,.5)},setData:function(){var e,t=this.data,a=this.skin,i=t.cfg;if(a.btnSelect.active=t.select,i)if(i.titleBg)e=game.ResCfg.getImgUrl(i.titleBg),this.btn.loadTexture(e),this.skin.alert.node.active=t.alert;else;},clickBtn:function(){this.send(game.FestivalRechargeEvts.V_SELECT_BTN,this.data.id)}}),b8e.RC("$$game","$$FestivalRechargeBtnItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(373)},init:function(){var e=this,t=e.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.FestivalRechargeBtnItem,t.addToParent(e.skin.scrollView),t.bindEnum=game.ME.FestivalRecharge,t.layout.spacingX=15},notify:function(e){switch(e){case this.Evts.V_REFRESH_BTN:this.btns=game.festivalRechargeData.getBtns(),this.list.setData(this.btns)}},onShow:function(){this.btns=game.festivalRechargeData.getBtns(),this.list.setData(this.btns),this.send(this.Evts.V_SHOW_VIEW)},onHide:function(){this.send(this.Evts.V_HIDE_VIEW),this.list.scrollToLeft(0)},viewLeftBtn:function(){this.list.scrollContainerLeft()},viewRightBtn:function(){this.list.scrollContainerRight()}});b8e.module.registerView(game.ME.FestivalRecharge,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_GET_DAILY_PRIZE:b8e.enc(),V2C_GET_TOTAL_PRIZE:b8e.enc(),C2V_UPDATE_CHOUJIANG:b8e.enc(),C2V_USE_QUAN:b8e.enc(),C2V_UPDATE_RESULT:b8e.enc(),V2C_LOG_REQ:b8e.enc(),C2V_UPDATE_LOG:b8e.enc(),C2V_SWITCH_LOG:b8e.enc(),C2V_UPDATE_ITEM:b8e.enc(),C2V_UPDATE_VIEW:b8e.enc(),C2V_UPDATE_AWARDS:b8e.enc()}),b8e.RC("$$game","$$FuDaiEvts",e)}(),function(){var e=b8e.Object.extends({id:0,$$isUseQuan1:!1,$$isUseQuan10:!1,progressLen:448,needLoad:!0,ctor:function(){this.wholeLogs=[],this.ownLogs=[],this.showItems=[],this.quanInfos=[],this.awardsInfos=[]},sysData:function(e){this.fudaiDailyNum=e.fudaiDailyNum,this.fudaiTotalNum=e.fudaiTotalNum,this.fudaiDailyAwards=e.fudaiDailyAwards,this.fudaiTotalAwards=e.fudaiTotalAwards},clearDailyNum:function(){this.fudaiDailyNum=0,this.fudaiDailyAwards=[],this.updateQuanArr()},resetData:function(){var e=this;e.fudaiDailyNum=0,e.fudaiTotalNum=0,e.fudaiDailyAwards=[],e.fudaiTotalAwards=[],e.showItems.length=0,e.quanInfos.length=0,e.awardsInfos.length=0,e.wholeLogs.length=0,e.ownLogs.length=0,e.needLoad=!0},setFuDaiId:function(e){this.id=e},onFudaiResp:function(e){this.fudaiDailyNum+=e,this.fudaiTotalNum+=e,this.updatePrizeArr(),this.updateQuanArr()},onFudaiAwardResp:function(e){e.isDaily?(this.fudaiDailyAwards.push(e.num),this.updateQuanArr()):(this.fudaiTotalAwards.push(e.num),this.updatePrizeArr())},updateLog:function(e){this._updateLog(this.wholeLogs,e.wholeLogs),this._updateLog(this.ownLogs,e.ownLogs)},onDigTreasureNotifyResp:function(e){this.digTreasureUseNum=e.num},_updateLog:function(e,t){if(e&&t){var a=e.length,i=t.length-a,n=void 0;if(0<i)for(var s=0;s<i;s++)n=new game.XunBaoLogInfo,e.push(n);i=t.length;for(var r=0;r<i;r++)e[r].setData(t[r])}},isFuDaiOpen:function(){var e=game.FuDaiOpenCfg.getDatas();if(!e||e.length<1)return!1;for(var t=e.length,a=0;a<t;a++)if(this.checkOpenById(e[a].id))return!0;return!1},getCurOpenId:function(){var e=game.FuDaiOpenCfg.getDatas();if(!e||e.length<1)return 0;for(var t=void 0,a=e.length,i=0;i<a;i++)if(t=e[i].id,this.checkOpenById(t))return t;return 0},checkOpenById:function(e){var t=game.FuDaiOpenCfg.getData(e);if(!t)return!1;var a=!0,i=!0;if(t.serverStart&&t.serverEnd){var n=game.TimeUtil.getOpenDayByStr(t.startTime,"yyyy-MM-dd  hh:mm:ss");a=t.serverStart<=n&&n<t.serverEnd}if(t.startTime&&t.endTime){var s=b8e.TimeUtil.dateParse(t.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),r=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),o=game.SysTime.curTime;i=s<=o&&o<r}return a&&i},getEndTime:function(){var e=0,t=game.FuDaiOpenCfg.getData(this.id);return t&&t.endTime&&(e=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()),e},getShowItems:function(){return 0==this.showItems.length&&this.setShowItms(),this.showItems},setShowItms:function(){var e=this.showItems,t=game.FuDaiOpenCfg.getData(this.id);if(t&&t.show)for(var a=t.show,i=a.length,n=void 0,s=void 0,r=0;r<i;r++)(n=game.TreasureItemCfg.getData(a[r]))&&((s=new game.XunBaoGridInfo).setCfg(n),e.push(s))},getAwardsArr:function(){return 0==this.awardsInfos.length&&this.initAwardsArr(),this.awardsInfos.sort(this.digSort)},digSort:function(e,t){return!e.isHadGet&&t.isHadGet?-1:e.isHadGet&&!t.isHadGet?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.num-t.num},initAwardsArr:function(){var e=this.awardsInfos,t=game.FuDaiTotalAwardsCfg.getDataById(this.id);if(t&&!(t.length<1))for(var a=void 0,i=t.length,n=0;n<i;n++)(a=new game.FuDaiAwardInfo).setData(t[n]),e.push(a)},updatePrizeArr:function(){for(var e=this.getAwardsArr(),t=e.length,a=0;a<t;a++)e[a].updateInfo()},updateQuanArr:function(){for(var e=this.getQuanInfos(),t=e.length,a=0;a<t;a++)e[a].updateInfo()},getQuanInfos:function(){return 0==this.quanInfos.length&&this.initQuanArr(),this.quanInfos},initQuanArr:function(){var e=this.quanInfos,t=game.FuDaiDailyAwardsCfg.getDataById(this.id);if(t&&!(t.length<1))for(var a=void 0,i=t.length,n=0;n<i;n++)(a=new game.FuDaiQuanInfo).setData(t[n]),e.push(a)},checkFuDaiBtnAlert:function(e){var t=game.FuDaiCostCfg.getData(e);if(!t||!t.itemCost||t.itemCost.length<1)return!1;var a=t.itemCost[0];return game.itemData.getNumById(a.Id)>=a.Num},checkQuanAlert:function(){for(var e=this.getQuanInfos(),t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},checkPrizeAlert:function(){for(var e=this.getAwardsArr(),t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},setPrizes:function(e){if(e){this.prizes?this.prizes.length=0:this.prizes=[];for(var t=this.prizes,a=void 0,i=0;i<e.length;i++){var n=e[i],s=n.id;0!=s&&((a=game.ItemUtil.createBaseItemInfo(s,n.num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_ALL,t.push(a))}}},getIsQuanByTimes:function(e){return 1==e?this.isUseQuan1:this.isUseQuan10},checkFuDaiCost:function(e,t){var a=game.FuDaiCostCfg.getData(e);if(!a)return!1;var i=t?a.itemCost[0]:a.amountCost[0];return(t?game.itemData.getNumById(i.Id):game.amount.get(game.AmountType.YUAN_BAO))>=i.Num},getBarLen:function(){var e=0;if(!this.id)return e;var t=game.FuDaiDailyAwardsCfg.getDataById(this.id);if(!t||t.length<1)return e;for(var a=this.fudaiDailyNum,i=t.length,n=void 0,s=0;s<i;s++)a>=(n=t[s]).num&&(e=n.barLen);return e=e/100*this.progressLen}});game.fuDaiData=game.fuDaiData||new e}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.itemInfos=[],this.conditionLab=""},setup:function(e,t){var a=1<arguments.length&&void 0!==t?t:game.Lang.get(53006);this.conditionLab=a;for(var i=this.itemInfos,n=void(i.length=0),s=void 0,r=e.length,o=0;o<r;o++)n=e[o],(s=game.ItemUtil.createBaseItemInfo(n.Id||n.id,n.Num||n.num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_ALL,i.push(s)}});game.prizeTipsData=game.prizeTipsData||new e}(),function(){var e;e=b8e.Object.extends({isHadGet:!1,canGet:!1,setData:function(e){this.cfg=e,this.num=e.num,this.setAwardList(),this.updateInfo()},setAwardList:function(){var e=this.cfg;this.prizeList=[];var t=e.awards;if(t&&!(t.length<1))for(var a=void 0,i=void 0,n=t.length,s=0;s<n;s++)a=t[s],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,i.iconSize=game.IconSizeEnum.GRID_SIZE_84,this.prizeList.push(i)},getAwardList:function(){return this.prizeList},updateInfo:function(){var e=game.fuDaiData.fudaiTotalAwards;if(e)if(this.isHadGet=-1<e.indexOf(this.num),this.isHadGet)this.canGet=!1;else{var t=game.fuDaiData.fudaiTotalNum;this.canGet=t>=this.num}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FuDaiAwardInfo",e)}(),function(){var e;e=b8e.Object.extends({isHadGet:!1,canGet:!1,setData:function(e){this.cfg=e,this.num=e.num,this.updateInfo()},updateInfo:function(){var e=game.fuDaiData.fudaiDailyAwards;if(e)if(this.isHadGet=-1<e.indexOf(this.num),this.isHadGet)this.canGet=!1;else{var t=game.fuDaiData.fudaiDailyNum;this.canGet=t>=this.num}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FuDaiQuanInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.fuDaiData,this.fudaiAlert=game.spotAlert.set(game.SAE.FUDAI_ALERT),this.fudaiBtnAlert_1=game.spotAlert.set(game.SAE.FUDAI_BTN_ALERT_1,game.SAE.FUDAI_ALERT),this.fudaiBtnAlert_10=game.spotAlert.set(game.SAE.FUDAI_BTN_ALERT_10,game.SAE.FUDAI_ALERT),this.fudaiQuanAlert=game.spotAlert.set(game.SAE.FUDAI_QUAN_ALERT,game.SAE.FUDAI_ALERT),this.fudaiPrizeAlert=game.spotAlert.set(game.SAE.FUDAI_PRIZE_ALERT,game.SAE.FUDAI_ALERT)},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.onSysData},MainRole:{C_RESET_DAILY:this.resetDaily},Back:{C_BACK_UPDATE_ITEMINFO:this.updateItem}},this.handels={FudaiResp:this.onFudaiResp,FudaiAwardResp:this.onFudaiAwardResp,FudaiLogResp:this.onFudaiLogResp}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_DAILY_PRIZE:this.sender.FudaiAwardReq(t,!0);break;case this.Evts.V2C_GET_TOTAL_PRIZE:this.sender.FudaiAwardReq(t,!1);break;case this.Evts.V2C_LOG_REQ:this.sender.FudaiLogReq()}},onSysData:function(e){var t=e?e.data:null;if(t){var a=this.moduleData;if(a.isFuDaiOpen()){a.sysData(t);var i=a.getCurOpenId();a.setFuDaiId(i),t.fudaiId!=i&&a.resetData(),this.checkAlert()}}},resetDaily:function(){var e=this.moduleData;if(e.isFuDaiOpen()){var t=e.getCurOpenId();e.id==t?e.clearDailyNum():(e.resetData(),e.setFuDaiId(t)),this.send(this.Evts.C2V_UPDATE_VIEW)}else game.module.hide(game.ME.FuDai)},onFudaiResp:function(e){var t=this,a=e.readProtobuf(game.pb.FudaiResponse);if(0<a.code)return game.notice.noticeError(a.code),void(t.isSending=!1);t.moduleData.onFudaiResp(t.times),t.checkAlert(),t.send(t.Evts.C2V_UPDATE_CHOUJIANG),t.moduleData.setPrizes(a.award),game.module.show(game.ME.FuDaiResult),t.send(t.Evts.C2V_UPDATE_RESULT,t.times),t.isSending=!1},onFudaiAwardResp:function(e){var t=e.readProtobuf(game.pb.FudaiAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.onFudaiAwardResp(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_AWARDS))},onFudaiLogResp:function(e){var t=e.readProtobuf(game.pb.FudaiLogResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateLog(t),this.send(this.Evts.C2V_UPDATE_LOG))},logBtn:function(){game.module.show(game.ME.FuDaiLog)},btn_1:function(){this.openTimes(1)},btn_10:function(){this.openTimes(10)},openTimes:function(e){this.times=e,this.fudaiReq()},buyBtn:function(){this.fudaiReq()},costQuanBtn1:function(){this.moduleData.isUseQuan1=!this.moduleData.isUseQuan1,this.send(this.Evts.C2V_USE_QUAN,1)},costQuanBtn10:function(){this.moduleData.isUseQuan10=!this.moduleData.isUseQuan10,this.send(this.Evts.C2V_USE_QUAN,10)},fudaiReq:function(){if(!this.isSending){var e=this.times,t=this.moduleData.getIsQuanByTimes(e);if(this.moduleData.checkFuDaiCost(e,t)){var a=game.FuDaiCostCfg.getData(e);a&&(this.isSending=!0,this.sender.FudaiReq(a.id,!t))}else{var i=t?8632:8633;game.notice.show(i)}}},awardBtn:function(){game.module.show(game.ME.FuDaiAward)},logAllBtn:function(){this.send(this.Evts.C2V_SWITCH_LOG,1)},logSelfBtn:function(){this.send(this.Evts.C2V_SWITCH_LOG,2)},gaiLvBtn:function(){game.RuleView.inst().showView(game.ME.FuDaiHelpBtn)},okBtn:function(){game.module.hide(game.ME.FuDaiResult)},updateItem:function(){this.fudaiBtnAlert_1.alert=this.moduleData.checkFuDaiBtnAlert(1),this.fudaiBtnAlert_10.alert=this.moduleData.checkFuDaiBtnAlert(10),this.send(this.Evts.C2V_UPDATE_ITEM)},checkAlert:function(){this.fudaiBtnAlert_1.alert=this.moduleData.checkFuDaiBtnAlert(1),this.fudaiBtnAlert_10.alert=this.moduleData.checkFuDaiBtnAlert(10),this.fudaiQuanAlert.alert=this.moduleData.checkQuanAlert(),this.fudaiPrizeAlert.alert=this.moduleData.checkPrizeAlert()}}),t=[game.ME.FuDaiAward,game.ME.FuDaiLog,game.ME.FuDaiResult],a=game.Sender.extends({ipc:function(){this.msg={FudaiReq:this.fudaiReq,FudaiAwardReq:this.fudaiAwardReq,FudaiLogReq:null}},fudaiReq:function(e,t){var a=game.pb.FudaiRequest;a.id=e,a.isAmount=t,this.write(a)},fudaiAwardReq:function(e,t){var a=game.pb.FudaiAwardRequest;a.num=e,a.isDaily=t,this.write(a)}});b8e.module.registerControl(game.ME.FuDai,e,game.FuDaiEvts,a,t)}(),function(){var e=game.Control.extends({});b8e.module.registerControl(game.ME.PrizeTips,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(434),this.setSize(540,165)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=-10,e.layout.paddingTop=10},setData:function(){var e=this.skin,t=this.data,a=t.getAwardList();this.prizeList.setData(a),e.lab.string=game.Lang.get(8639,t.num),e.isGet.active=t.isHadGet,e.notGet.active=!t.isHadGet,e.getPrizeBtn.active=t.canGet,e.gray.active=!t.canGet},getPrizeBtn:function(){this.send(game.FuDaiEvts.V2C_GET_TOTAL_PRIZE,this.data.num)}}),b8e.RC("$$game","$$FuDaiAwardItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(437),this.setSize(64,96)},init:function(){var e=this.icon=b8e.Sprite.get();e.setAnchor(.5,.5),e.addToParent(this.skin.icon)},setData:function(){var e=this.skin,t=this.data,a=game.ResCfg.getImgUrl(t.cfg.quanIcon);this.icon.loadTexture(a),e.alreadyGet.active=t.isHadGet,e.redPoint.active=t.canGet,e.lab.string=game.Lang.get(8637,t.num)},onClick:function(){var e=this.data;e.isHadGet||(e.canGet?this.send(game.FuDaiEvts.V2C_GET_DAILY_PRIZE,e.num):(game.prizeTipsData.setup(e.cfg.awards),game.module.show(game.ME.PrizeTips)))}}),b8e.RC("$$game","$$FuDaiQuanItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(435)},init:function(){var e=this.skin,t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.FuDaiAwardItem,t.bindEnum=game.ME.FuDai,t.layout.spacingY=5,t.addToParent(e.listNode)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_AWARDS:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.fuDaiData.getAwardsArr();!e||e.length<1||this._list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width)-6,.5*(t+this.height)+20)}});b8e.module.registerView(game.ME.FuDaiAward,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(436)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.XunBaoLogItem,this._list.layout.paddingLeft=3,this._list.layout.paddingTop=10,this._list.layout.spacingY=5,this._list.addToParent(this.skin.listNode)},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_LOG:this.switchLog(t);break;case this.Evts.C2V_UPDATE_LOG:this.switchLog(this.logId)}},onShow:function(){this.logId=1,this.send(game.FuDaiEvts.V2C_LOG_REQ)},switchLog:function(e){var t=this.skin,a=1==(this.logId=e);t.logAllBtnLight.active=a,t.logSelfBtnLight.active=!a;var i=a?game.fuDaiData.wholeLogs:game.fuDaiData.ownLogs;this._list.setData(i)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height))}});b8e.module.registerView(game.ME.FuDaiLog,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(438)},init:function(){var e=this;e.moduleData=game.fuDaiData,e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e._list.itemRender=game.PrizeListItem,e._list.addToParent(e.skin.node_prize),e._list.layout.spacingX=52.5,e._list.layout.spacingY=30,e._costIcon=game.GridUtil.createViewClickIcon(40),e._costIcon.addToParent(e.skin.cost)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_RESULT:this.updateView(),this.updateCost(t)}},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.updateView()},updateView:function(){this.countDownTime=5,this.createPrize(),this.updateTime(),this.createCountDown()},createPrize:function(){var e=this.moduleData.prizes;0==e.length&&this._list?this._list.clear():this._list.setData(e)},updateCost:function(e){var t=this.skin,a=game.FuDaiCostCfg.getData(e);if(a){var i=1==e;t.buyLab1.active=i,t.buyLab10.active=!i;var n=this.moduleData.getIsQuanByTimes(e)?a.itemCost[0]:a.amountCost[0];this._costIcon.setItemId(n.Id),t.num.string=n.Num}},createCountDown:function(){if(!this.timer){this.timer=b8e.Timer.add(this,this.updateTime,1e3)}this.timer.reset(),this.timer.start()},updateTime:function(){if(this.countDownTime--,this.skin.timeLab.string=game.Lang.get(598,this.countDownTime),this.countDownTime<1){game.module.hide(game.ME.FuDaiResult)}},onHide:function(){b8e.Tween.kill(this.skin.light),this.clearCountDown()},clearCountDown:function(){if(this.timer)b8e.Timer.remove(this,this.updateTime),this.timer=null;else;},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height);this.setPosition(e,t)}});b8e.module.registerView(game.ME.FuDaiResult,e)}(),function(){var a="amountIcon",i="costIcon",e=game.View.extends({ctor:function(){this._super(439),this.spotAlerts={FUDAI_BTN_ALERT_1:this.digAlert_1,FUDAI_BTN_ALERT_10:this.digAlert_10,FUDAI_PRIZE_ALERT:this.prizeAlert}},digAlert_1:function(e){this.skin.red_1.active=e.alert},digAlert_10:function(e){this.skin.red_10.active=e.alert},prizeAlert:function(e){this.skin.prizeRed.active=e.alert},init:function(){var e=this,t=e.skin;e.moduleData=game.fuDaiData;var a=e.title=b8e.Sprite.get();a.setAnchor(.5,.5),a.addToParent(t.title);var i=e.banner=b8e.Sprite.get();i.setAnchor(.5,.5),i.addToParent(t.banner);var n=e.words=b8e.Sprite.get();n.setAnchor(.5,.5),n.addToParent(t.desc);var s=e.enter=b8e.Sprite.get();s.setAnchor(.5,.5),s.addToParent(t.prizeEnter);var r=e.headList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);r.itemRender=game.JsTurnplateListItem,r.layout.paddingTop=5,r.bindEnum=game.ME.FuDai,r.addToParent(t.headList),r.touchMovable=!1;var o=e.quanList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);o.itemRender=game.FuDaiQuanItem,o.bindEnum=game.ME.FuDai,o.layout.paddingLeft=20,o.layout.spacingX=60,o.addToParent(t.quanList),e.initCostIcon(1),e.initCostIcon(10)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_CHOUJIANG:this.updateChouJiang();break;case this.Evts.C2V_UPDATE_VIEW:this.updateView();break;case this.Evts.C2V_USE_QUAN:this._updateUseQuan(t);break;case this.Evts.C2V_UPDATE_ITEM:this.updateCost()}},onShow:function(){this.updateView()},updateView:function(){this.updateShow(),this.updateChouJiang(),this.createItemGrid(),this.createTimer(),this.updateCost(),this.updateUseQuan()},updateShow:function(){var e=this;if(e.moduleData.needLoad){var t=game.FuDaiOpenCfg.getData(e.moduleData.id);if(t){var a=game.ResCfg.getImgUrl(t.title);e.title.loadTexture(a);var i=game.ResCfg.getImgUrl(t.banner,!!t.isJPG);e.banner.loadTexture(i);var n=game.ResCfg.getImgUrl(t.words);e.words.loadTexture(n);var s=game.ResCfg.getImgUrl(t.enterBtn);e.enter.loadTexture(s)}e.skin.warnDesc.string=game.Lang.get(8636),e._setCostIcon(1),e._setCostIcon(10),e.moduleData.needLoad=!1}},updateChouJiang:function(){var e=this.skin,t=this.moduleData.getQuanInfos();!t||t.length<1||(this.quanList.setData(t),e.progress.width=this.moduleData.getBarLen(),e.timesTodaty.string=game.Lang.get(8634,this.moduleData.fudaiDailyNum),e.timesAll.string=game.Lang.get(8635,this.moduleData.fudaiTotalNum))},initCostIcon:function(e){this.skin;this[a+e]=game.GridUtil.createViewClickIcon(40),this[a+e].addToParent(this.getComponent("money"+e)),this[i+e]=game.GridUtil.createViewClickIcon(40),this[i+e].addToParent(this.getComponent(i+e))},_setCostIcon:function(e){this.skin;var t=game.FuDaiCostCfg.getData(e);t&&(this[a+e].setItemId(t.amountCost[0].Id),this[i+e].setItemId(t.itemCost[0].Id),this.getComponent("moneyLab"+e).string=game.Lang.get(8638,t.amountCost[0].Num))},updateCost:function(){this._updateCost(1),this._updateCost(10)},_updateCost:function(e){var t=game.FuDaiCostCfg.getData(e);if(t&&t.itemCost&&!(t.itemCost.length<1)){var a=t.itemCost[0],i=game.itemData.getNumById(a.Id),n=i>=a.Num;this.getComponent("costLab"+e).color=n?game.Color.GREEN:game.Color.RED,this.getComponent("costLab"+e).string=i+"/"+a.Num}},updateUseQuan:function(){this._updateUseQuan(1),this._updateUseQuan(10)},_updateUseQuan:function(e){this.getComponent("costQuanCheck"+e).active=b8e.getDPV(this.moduleData,"isUseQuan"+e)},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.SysTime.curTime,t=this.moduleData.getEndTime()-e;if(t<0)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);this.skin.timeCountLab.string=a}},createItemGrid:function(){var e=this.moduleData.getShowItems();!e||e.length<1||(this.headList.setData(e),this.setListTime(e.length))},setListTime:function(e){this.scrollX=0,this.headList.scrollToLeft(0,50),this.patrolTime=game.SysTime.curTime+3e3*e,this.patrolTimer?(this.patrolTimer.reset(),this.patrolTimer.start()):this.patrolTimer=b8e.Timer.add(this,this.updateTimer,50)},updateTimer:function(){if(0<this.patrolTime-game.SysTime.curTime)this.scrollX+=1,this.headList.scrollToRight(this.scrollX,50);else if(this.patrolTimer){this.patrolTimer.stop();var e=this.moduleData.getShowItems();if(!e||e.length<1)return void this.clearTimer();this.setListTime(e.length)}},clearTimer:function(){this.patrolTimer&&(b8e.Timer.remove(this,this.updateTimer),this.patrolTimer=null),this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.FuDai,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(291)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.list.itemRender=game.PrizeListItem,this.list.layout.paddingLeft=20,this.list.layout.paddingTop=0,this.list.layout.spacingX=57,this.list.addToParent(this.skin.prizeNode)},onShow:function(){var e=this.skin,t=game.prizeTipsData,a=t.itemInfos;this.resetPrizeList(a.length),this.list.setData(a),game.TweenUtil.rotationEffect(this.skin.light);var i=t.conditionLab;e.title.node.active=null!=i,i&&(e.title.string=i),e.titleBg.x=e.title.x-103,e.titleBg1.x=e.title.x+103,this.skin.huawen_3.width=b8e.stageWidth+100,this.skin.huawen_1.width=b8e.stageWidth+100},resetPrizeList:function(e){var t=this.skin,a=void 0;switch(e){case 1:a=295;break;case 2:a=215;break;case 3:a=145;break;default:a=80}this._isMore=4<e,this.list.setSize(560,this._isMore?250:140),t.prizeNode.setPosition(a,-320),t.pathNode.setPosition(360,this._isMore?-635:-525),t.gray.setSize(b8e.stageWidth+50,this._isMore?442:330),this.onStageResize()},onHide:function(){b8e.Tween.kill(this.skin.light)},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth,a=this._isMore?190:100;this.setPosition(.5*(t-this.width),.5*(e+this.height)+a),game.viewModule.updateLayout(this)}});b8e.module.registerView(game.ME.PrizeTips,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_GET_AWARDS:-1,C2V_UPDATE_CHOUJIANG:-1,C2V_USE_QUAN:-1,C2V_UPDATE_RESULT:-1,V2C_LOG_REQ:-1,C2V_UPDATE_LOG:-1,C2V_SWITCH_LOG:-1,C2V_UPDATE_ITEM:-1,C2V_UPDATE_VIEW:-1,C2V_UPDATE_AWARDS:-1,V2C_SWITCH_SHOW:-1,C2V_SWITCH_SHOW:-1,C2C_UPDATE_JUBAO_SCORE:-1,C2V_JUBAO_ENTER:-1}),b8e.RC("$$game","$$JuBaoPenEvts",e)}(),function(){var e=b8e.Object.extends({id:0,$$isUseQuan1:!1,$$isUseQuan10:!1,needLoad:!0,selectLv:0,ctor:function(){this.wholeLogs=[],this.ownLogs=[],this.showItems1=[],this.showItems2=[],this.awardsInfos=[],this.lastFourLog=[],this.obj={},this.obj.id=0,this.lvArr=[]},sysData:function(e){this.initLvArr(),this.setScore(e.jubaoScore),this.jubaoScoreAwards=e.jubaoScoreAwards},resetData:function(){this.initLvArr(),this.setScore(0),this.jubaoScoreAwards=[],this.showItems1.length=0,this.showItems2.length=0,this.awardsInfos.length=0,this.wholeLogs.length=0,this.ownLogs.length=0,this.needLoad=!0},setJuBaoId:function(e){this.id=e},setScore:function(e){this.jubaoScore=e,this.updateLv()},updateLv:function(){for(var e=this.lvArr,t=e.length,a=this.jubaoScore,i=void 0,n=0;n<t;n++)a>=(i=e[n]).score&&(this.curLv=i.lv);var s=this.curLv>=t?this.curLv:this.curLv+1;this.fullLen=e[s-1].score},onJuBaoPenLotteryResp:function(e){this.setScore(e.score),this.setPrizes(e.award);var t=e.logs;t&&0<t.length&&(this.addWholeLogs(t),this.addOwnLogs(t)),this.updatePrizeArr()},onJuBaoPenScoreAwardResp:function(e){this.jubaoScoreAwards.push(e.score),this.updatePrizeArr()},getLastFourLog:function(){var e=this.lastFourLog;e.length=0;for(var t=this.wholeLogs,a=t.length,i=void 0,n=a-4;n<a;n++)(i=t[n])&&e.push(i);return e},updateLog:function(e){this.setWholeLogs(e.wholeLogs),this.setOwnLogs(e.ownLogs)},setWholeLogs:function(e){for(var t=0,a=this.wholeLogs,i=e.length-1;0<=i;i--)a[t]||(a[t]=new game.XunBaoLogInfo),a[t].setData(e[i]),t++},setOwnLogs:function(e){for(var t=0,a=this.ownLogs,i=e.length-1;0<=i;i--)a[t]||(a[t]=new game.XunBaoLogInfo),a[t].setData(e[i]),t++},addWholeLogs:function(e){for(var t=e.length-1;0<=t;t--)this._addLog(e[t])},_addLog:function(e){var t=this.wholeLogs,a=void 0;10<=t.length?(a=t[0],t.splice(0,1),a.setData(e)):(a=new game.XunBaoLogInfo).setData(e),t.push(a)},addOwnLogs:function(e){for(var t=e.length-1;0<=t;t--)this._addSelfLog(e[t])},_addSelfLog:function(e){var t=this.ownLogs,a=void 0;50<=t.length?(a=t[0],t.splice(0,1),a.setData(e)):(a=new game.XunBaoLogInfo).setData(e),t.push(a)},isJuBaoOpen:function(){var e=game.JuBaoPenOpenCfg.getDatas();if(!e||e.length<1)return!1;for(var t=e.length,a=0;a<t;a++)if(this.checkOpenById(e[a].id))return!0;return!1},getCurOpenId:function(){var e=game.JuBaoPenOpenCfg.getDatas();if(!e||e.length<1)return 0;for(var t=void 0,a=e.length,i=0;i<a;i++)if(t=e[i].id,this.checkOpenById(t))return t;return 0},checkOpenById:function(e){var t=game.JuBaoPenOpenCfg.getData(e);if(!t)return!1;var a=!0,i=!0;if(t.serverStart&&t.serverEnd){var n=game.TimeUtil.getOpenDayByStr(t.startTime,"yyyy-MM-dd  hh:mm:ss");a=t.serverStart<=n&&n<t.serverEnd}if(t.startTime&&t.endTime){var s=b8e.TimeUtil.dateParse(t.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),r=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),o=game.SysTime.curTime;i=s<=o&&o<r}return a&&i},getEndTime:function(){var e=0,t=game.JuBaoPenOpenCfg.getData(this.id);return t&&t.endTime&&(e=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()),e},getShowItems1:function(){var e=this.showItems1;return 0==e.length&&this.setShowItms(e,1),e},getShowItems2:function(){var e=this.showItems2;return 0==e.length&&this.setShowItms(e,2),e},setShowItms:function(e,t){var a=game.JuBaoPenOpenCfg.getData(this.id);if(a){var i=b8e.getDPV(a,"show"+t);if(i&&!(i.length<1))for(var n=i.length,s=void 0,r=void 0,o=0;o<n;o++)(s=game.TreasureItemCfg.getData(i[o]))&&((r=new game.XunBaoGridInfo).setCfg(s),e.push(r))}},getAwardsArr:function(){return 0==this.awardsInfos.length&&this.initAwardsArr(),this.awardsInfos.sort(this.digSort)},digSort:function(e,t){return!e.isHadGet&&t.isHadGet?-1:e.isHadGet&&!t.isHadGet?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.num-t.num},initAwardsArr:function(){var e=this.awardsInfos;this.obj.id=this.id;var t=game.JuBaoPenScoreAwardsCfg.getData(this.obj,!0);if(t&&!(t.length<1))for(var a=void 0,i=t.length,n=0;n<i;n++)(a=new game.JuBaoPenInfo).setData(t[n]),e.push(a)},updatePrizeArr:function(){for(var e=this.getAwardsArr(),t=e.length,a=0;a<t;a++)e[a].updateInfo()},checkJuBaoBtnAlert:function(e){var t=game.JuBaoPenCostCfg.getData(e);if(!t||!t.itemCost||t.itemCost.length<1)return!1;var a=t.itemCost[0];return game.itemData.getNumById(a.Id)>=a.Num},checkPrizeAlert:function(){for(var e=this.getAwardsArr(),t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},setPrizes:function(e){if(e){this.prizes?this.prizes.length=0:this.prizes=[];for(var t=this.prizes,a=void 0,i=0;i<e.length;i++){var n=e[i],s=n.id;0!=s&&((a=game.ItemUtil.createBaseItemInfo(s,n.num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_ALL,t.push(a))}}},getIsQuanByTimes:function(e){return 1==e?this.isUseQuan1:this.isUseQuan10},checkCost:function(e,t){var a=game.JuBaoPenCostCfg.getData(e);if(!a)return!1;var i=t?a.itemCost[0]:a.amountCost[0];return(t?game.itemData.getNumById(i.Id):game.amount.get(game.AmountType.YUAN_BAO))>=i.Num},getPerCount:function(){if(!this.perCount){var e=game.JubaoPenMiscCfg.getData("incrScore");e&&(this.perCount=0|e.value)}return this.perCount},initLvArr:function(){var e=this.lvArr;e.length=0;var t=game.JuBaoPenLevelCfg.getDatas();if(t&&!(t.length<1))for(var a=t.length,i=void 0,n=void 0,s=void 0,r=0;r<a;r++)i=t[r],(n=game.JubaoPenShowCfg.getData(this.id,i.lv))&&((s=new game.JuBaoPenLvInfo).setData(i,n),e.push(s))},setSelectLv:function(e){var t=this.lvArr,a=t[this.selectLv-1];a&&(a.isSelect=!1),this.selectLv=e;var i=t[this.selectLv-1];i&&(i.isSelect=!0)},checkRankEnter:function(){this.isShowRank=!1;var e=game.CServRankCfg.getListByType(game.CServType.JUBAO_RANK);if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)if(this._checkRankEnter(e[a]))return void(this.isShowRank=!0)},_checkRankEnter:function(e){var t=!0,a=!0;if(e.serverStart&&e.serverEnd){var i=game.TimeUtil.getOpenDayByStr(e.startTime,"yyyy-MM-dd  hh:mm:ss");t=e.serverStart<=i&&i<e.serverEnd}if(e.startTime&&e.endTime){var n=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),s=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),r=game.SysTime.curTime;a=n<=r&&r<s}return t&&a}});game.juBaoPenData=game.juBaoPenData||new e}(),function(){var e;e=b8e.Object.extends({isHadGet:!1,canGet:!1,setData:function(e){this.cfg=e,this.num=e.num,this.setAwardList(),this.updateInfo()},setAwardList:function(){var e=this.cfg;this.prizeList=[];var t=e.awards;if(t&&!(t.length<1))for(var a=void 0,i=void 0,n=t.length,s=0;s<n;s++)a=t[s],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,i.iconSize=game.IconSizeEnum.GRID_SIZE_84,this.prizeList.push(i)},updateInfo:function(){var e=game.juBaoPenData.jubaoScoreAwards;if(e)if(this.isHadGet=-1<e.indexOf(this.num),this.isHadGet)this.canGet=!1;else{var t=game.juBaoPenData.jubaoScore;this.canGet=t>=this.num}},getAwardList:function(){return this.prizeList}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$JuBaoPenInfo",e)}(),function(){var e;e=b8e.Object.extends({isSelect:!1,setData:function(e,t){this.lvCfg=e,this.showCfg=t,this.lv=e.lv,this.score=e.score,this.str1=game.Lang.get(e.name1),this.str2=game.Lang.get(e.name2),this.setAwardList()},setAwardList:function(){var e=this.showCfg;this.prizeList=[];var t=e.items;if(t&&!(t.length<1))for(var a=void 0,i=t.length,n=0;n<i;n++)(a=game.ItemUtil.createBaseItemInfo(t[n])).iconLayoutEnum=game.IconLayoutEnum.SHOW_NONE,this.prizeList.push(a)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$JuBaoPenLvInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.juBaoPenData,this.jubaoAlert=game.spotAlert.set(game.SAE.JUBAO_ALERT),this.jubaoBtnAlert_1=game.spotAlert.set(game.SAE.JUBAO_BTN_ALERT_1,game.SAE.JUBAO_ALERT),this.jubaoBtnAlert_10=game.spotAlert.set(game.SAE.JUBAO_BTN_ALERT_10,game.SAE.JUBAO_ALERT),this.jubaoPrizeAlert=game.spotAlert.set(game.SAE.JUBAO_PRIZE_ALERT,game.SAE.JUBAO_ALERT),this.obj={openServerType:game.OpenServerType.CROSS_SERVICE_RANK,type:game.CServType.JUBAO_RANK}},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.onSysData},MainRole:{C_RESET_DAILY:this.resetDaily},Back:{C_BACK_UPDATE_ITEMINFO:this.updateItem},CServRank:{C2C_JUBAO_ENTER:this.updateRankEnter}},this.handels={JuBaoPenLotteryResp:this.onJuBaoPenLotteryResp,JuBaoPenScoreAwardResp:this.onJuBaoPenScoreAwardResp,JuBaoPenLogResp:this.onJuBaoPenLogResp}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_AWARDS:this.sender.JuBaoPenScoreAwardReq(t);break;case this.Evts.V2C_LOG_REQ:this.sender.JuBaoPenLogReq();break;case this.Evts.V2C_SWITCH_SHOW:this.send(this.Evts.C2V_SWITCH_SHOW)}},onSysData:function(e){var t=e?e.data:null;if(t){var a=this.moduleData;if(a.isJuBaoOpen()){var i=a.getCurOpenId();a.setJuBaoId(i),a.sysData(t),t.jubaoId!=i&&a.resetData(),this.checkAlert()}}},resetDaily:function(){var e=this.moduleData;if(e.isJuBaoOpen()){var t=e.getCurOpenId();e.id!=t&&(e.setJuBaoId(t),e.resetData(),this.send(this.Evts.C2V_UPDATE_VIEW))}else game.module.hide(game.ME.JuBaoPen)},onJuBaoPenLotteryResp:function(e){var t=this,a=e.readProtobuf(game.pb.JuBaoPenLotteryResponse);if(0<a.code)return game.notice.noticeError(a.code),void(t.isSending=!1);t.moduleData.onJuBaoPenLotteryResp(a),t.checkAlert(),t.send(t.Evts.C2V_UPDATE_CHOUJIANG),game.module.show(game.ME.JuBaoPenResult),t.send(t.Evts.C2V_UPDATE_RESULT,t.times),t.dpt(t.Evts.C2C_UPDATE_JUBAO_SCORE,a.score),t.isSending=!1},onJuBaoPenScoreAwardResp:function(e){var t=e.readProtobuf(game.pb.JuBaoPenScoreAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.onJuBaoPenScoreAwardResp(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_AWARDS))},onJuBaoPenLogResp:function(e){var t=e.readProtobuf(game.pb.JuBaoPenLogResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateLog(t),this.send(this.Evts.C2V_UPDATE_LOG))},logBtn:function(){game.module.show(game.ME.JuBaoPenLog)},btn_1:function(){this.openTimes(1)},btn_10:function(){this.openTimes(10)},openTimes:function(e){this.times=e,this.jubaoReq()},buyBtn:function(){this.jubaoReq()},costQuanBtn1:function(){this.moduleData.isUseQuan1=!this.moduleData.isUseQuan1,this.send(this.Evts.C2V_USE_QUAN,1)},costQuanBtn10:function(){this.moduleData.isUseQuan10=!this.moduleData.isUseQuan10,this.send(this.Evts.C2V_USE_QUAN,10)},jubaoReq:function(){if(!this.isSending){var e=this.times,t=this.moduleData.getIsQuanByTimes(e);if(this.moduleData.checkCost(e,t)){var a=game.JuBaoPenCostCfg.getData(e);a&&(this.isSending=!0,this.sender.JuBaoPenLotteryReq(a.id,!t))}else{var i=t?8632:8633;game.notice.show(i)}}},awardBtn:function(){game.module.show(game.ME.JuBaoPenAward)},logAllBtn:function(){this.send(this.Evts.C2V_SWITCH_LOG,1)},logSelfBtn:function(){this.send(this.Evts.C2V_SWITCH_LOG,2)},showBtn:function(){game.module.show(game.ME.JuBaoPenShow)},rankBtn:function(){this.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,this.obj)},gaiLvBtn:function(){game.RuleView.inst().showView(game.ME.JuBaoPenHelpBtn)},okBtn:function(){game.module.hide(game.ME.JuBaoPenResult)},updateItem:function(){this.jubaoBtnAlert_1.alert=this.moduleData.checkJuBaoBtnAlert(1),this.jubaoBtnAlert_10.alert=this.moduleData.checkJuBaoBtnAlert(10),this.send(this.Evts.C2V_UPDATE_ITEM)},checkAlert:function(){this.jubaoBtnAlert_1.alert=this.moduleData.checkJuBaoBtnAlert(1),this.jubaoBtnAlert_10.alert=this.moduleData.checkJuBaoBtnAlert(10),this.jubaoPrizeAlert.alert=this.moduleData.checkPrizeAlert()},updateRankEnter:function(){this.moduleData.checkRankEnter(),this.send(this.Evts.C2V_JUBAO_ENTER)}}),t=[game.ME.JuBaoPenAward,game.ME.JuBaoPenLog,game.ME.JuBaoPenResult,game.ME.JuBaoPenShow],a=game.Sender.extends({ipc:function(){this.msg={JuBaoPenLotteryReq:this.juBaoPenLotteryReq,JuBaoPenScoreAwardReq:this.juBaoPenScoreAwardReq,JuBaoPenLogReq:null}},juBaoPenLotteryReq:function(e,t){var a=game.pb.JuBaoPenLotteryRequest;a.id=e,a.isAmount=t,this.write(a)},juBaoPenScoreAwardReq:function(e){var t=game.pb.JuBaoPenScoreAwardRequest;t.score=e,this.write(t)}});b8e.module.registerControl(game.ME.JuBaoPen,e,game.JuBaoPenEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(624),this.setSize(540,165)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=-10,e.layout.paddingTop=10},setData:function(){var e=this.skin,t=this.data,a=t.getAwardList();this.prizeList.setData(a),e.lab.string=game.Lang.get(9465,t.num),e.isGet.active=t.isHadGet,e.notGet.active=!t.isHadGet,e.getPrizeBtn.active=t.canGet,e.gray.active=!t.canGet},getPrizeBtn:function(){this.send(game.JuBaoPenEvts.V2C_GET_AWARDS,this.data.num)}}),b8e.RC("$$game","$$JuBaoPenAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(625)},init:function(){var e=this.skin,t=this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.JuBaoPenAwardItem,t.bindEnum=game.ME.JuBaoPen,t.layout.spacingY=5,t.addToParent(e.listNode)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_AWARDS:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.juBaoPenData.getAwardsArr();!e||e.length<1||this._list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width)-6,.5*(t+this.height)+20)}});b8e.module.registerView(game.ME.JuBaoPenAward,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(626)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.XunBaoLogItem,this._list.layout.paddingLeft=3,this._list.layout.paddingTop=10,this._list.layout.spacingY=5,this._list.addToParent(this.skin.listNode)},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_LOG:this.switchLog(t)}},onShow:function(){this.logId=1,this.switchLog(this.logId)},switchLog:function(e){var t=this.skin,a=1==(this.logId=e);t.logAllBtnLight.active=a,t.logSelfBtnLight.active=!a;var i=a?game.juBaoPenData.wholeLogs:game.juBaoPenData.ownLogs;this._list.setData(i)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height))}});b8e.module.registerView(game.ME.JuBaoPenLog,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(628),this.setLocalZOrder(20)},init:function(){var e=this;e.moduleData=game.juBaoPenData,e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e._list.itemRender=game.PrizeListItem,e._list.addToParent(e.skin.node_prize),e._list.layout.spacingX=52.5,e._list.layout.spacingY=30,e._costIcon=game.GridUtil.createViewClickIcon(40),e._costIcon.addToParent(e.skin.cost)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_RESULT:this.updateView(),this.updateCost(t)}},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.updateView()},updateView:function(){this.countDownTime=5,this.createPrize(),this.createCountDown()},createPrize:function(){var e=this.moduleData.prizes;0==e.length&&this._list?this._list.clear():this._list.setData(e)},updateCost:function(e){var t=this.skin,a=game.JuBaoPenCostCfg.getData(e);if(a){var i=1==e;t.buyLab1.active=i,t.buyLab10.active=!i;var n=this.moduleData.getIsQuanByTimes(e)?a.itemCost[0]:a.amountCost[0];this._costIcon.setItemId(n.Id),t.num.string=n.Num}},createCountDown:function(){if(!this.timer){this.timer=b8e.Timer.add(this,this.updateTime,1e3)}this.timer.reset(),this.timer.start()},updateTime:function(){this.countDownTime--,this.skin.timeLab.string=game.Lang.get(598,this.countDownTime),this.countDownTime<1&&game.module.hide(game.ME.JuBaoPenResult)},onHide:function(){b8e.Tween.kill(this.skin.light),this.clearCountDown()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height);this.setPosition(e,t)}});b8e.module.registerView(game.ME.JuBaoPenResult,e)}(),function(){var a="amountIcon",i="costIcon",e=game.View.extends({barLen:352,$$iconList1:null,$$iconList2:null,ctor:function(){this._super(630),this.spotAlerts={JUBAO_BTN_ALERT_1:this.btnAlert_1,JUBAO_BTN_ALERT_10:this.btnAlert_10,JUBAO_PRIZE_ALERT:this.prizeAlert}},btnAlert_1:function(e){this.skin.red_1.active=e.alert},btnAlert_10:function(e){this.skin.red_10.active=e.alert},prizeAlert:function(e){this.skin.prizeRed.active=e.alert},init:function(){var e=this,t=e.skin;e.moduleData=game.juBaoPenData;var a=e.title=b8e.Sprite.get();a.setAnchor(.5,.5),a.addToParent(t.title);var i=e.banner=b8e.Sprite.get();i.setAnchor(.5,.5),i.addToParent(t.banner);var n=e.bigIcon=b8e.Sprite.get();n.setAnchor(.5,.5),n.addToParent(t.big_icon),e.initCostIcon(1),e.initCostIcon(10),e.iconList1=[],e.iconList2=[],e.zeroPos=t.zero_node.y,e.speed=45,e.space=90,e.iconIndex=0,e.lastPos=e.zeroPos,e.endPos=e.zeroPos+e.speed,e.initList(1),e.initList(2)},initCostIcon:function(e){this[a+e]=game.GridUtil.createViewClickIcon(40),this[a+e].addToParent(this.getComponent("money"+e)),this[i+e]=game.GridUtil.createViewClickIcon(40),this[i+e].addToParent(this.getComponent(i+e))},initList:function(e){var t=void 0;if(1==e?t=this.moduleData.getShowItems1():2==e&&(t=this.moduleData.getShowItems2()),t&&!(t.length<1))for(var a=this.datasLen=t.length,i=b8e.getDPV(this,"iconList"+e),n=this.getComponent("arr_node"+e),s=-1*this.space,r=void 0,o=void 0,g=0;g<a;g++)r=i[g],o=t[g],r||((r=game.GridUtil.createTurnplateIcon(game.IconSizeEnum.GRID_SIZE_84)).addToParent(n),r.setPosition(0,s*g),i.push(r)),game.GridUtil.setTurnplateIcon(r,o,o.isTag)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_UPDATE_CHOUJIANG:a.updateChouJiang(),a.updateLogs();break;case a.Evts.C2V_UPDATE_VIEW:a.updateView();break;case a.Evts.C2V_USE_QUAN:a._updateUseQuan(t);break;case a.Evts.C2V_UPDATE_ITEM:a.updateCost();break;case a.Evts.C2V_UPDATE_LOG:a.updateLogs();break;case a.Evts.C2V_JUBAO_ENTER:a.skin.rankBtn.active=a.moduleData.isShowRank}},onShow:function(){this.updateView(),this.send(this.Evts.V2C_LOG_REQ),this.skin.rankBtn.active=this.moduleData.isShowRank},updateView:function(){this.updateShow(),this.updateChouJiang(),this.createTimer(),this.updateCost(),this.updateUseQuan(),this.startScroll()},updateShow:function(){var e=this;if(e.moduleData.needLoad){var t=game.JuBaoPenOpenCfg.getData(e.moduleData.id);if(t){var a=game.ResCfg.getImgUrl(t.title);e.title.loadTexture(a);var i=game.ResCfg.getImgUrl(t.banner,!!t.isJPG);e.banner.loadTexture(i)}e.skin.warnDesc.string=game.Lang.get(9467);var n=e.moduleData.getPerCount();e.skin.desc.string=game.Lang.get(9468,n),e._setCostIcon(1),e._setCostIcon(10),e.moduleData.needLoad=!1}},_setCostIcon:function(e){var t=game.JuBaoPenCostCfg.getData(e);t&&(this[a+e].setItemId(t.amountCost[0].Id),this[i+e].setItemId(t.itemCost[0].Id),this.getComponent("moneyLab"+e).string=game.Lang.get(9466,t.amountCost[0].Num))},updateChouJiang:function(){var e=this.skin,t=this.moduleData;e.timesAll.string=game.Lang.get(9464,t.jubaoScore);var a=t.lvArr;if(a&&!(a.length<1)){var i=a[t.curLv-1],n=game.ResCfg.getUrl(5065,i.lv);this.bigIcon.loadTexture(n),e.bottom_title_lab.string=i.str1,e.bar_desc.string=t.jubaoScore+"/"+t.fullLen,e.progress.width=Math.min(this.barLen,this.barLen*(t.jubaoScore/t.fullLen))}},updateLogs:function(){for(var e=this.moduleData.getLastFourLog(),t=void 0,a=void 0,i=void 0,n=void 0,s=0;s<4;s++)t=e[s],n=this.getComponent("log"+s),t&&(a=game.ItemInfoCfg.getData(t.itemId))?(i=game.HtmlUtil.getColorStrByQuality(a.quality,a.name),n.string=game.Lang.get(9474,t.name,i)):n.string=""},updateCost:function(){this._updateCost(1),this._updateCost(10)},_updateCost:function(e){var t=game.JuBaoPenCostCfg.getData(e);if(t&&t.itemCost&&!(t.itemCost.length<1)){var a=t.itemCost[0],i=game.itemData.getNumById(a.Id),n=i>=a.Num;this.getComponent("costLab"+e).color=n?game.Color.GREEN:game.Color.RED,this.getComponent("costLab"+e).string=i+"/"+a.Num}},updateUseQuan:function(){this._updateUseQuan(1),this._updateUseQuan(10)},_updateUseQuan:function(e){this.getComponent("costQuanCheck"+e).active=b8e.getDPV(this.moduleData,"isUseQuan"+e)},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.SysTime.curTime,t=this.moduleData.getEndTime()-e;if(t<0)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);this.skin.timeCountLab.string=a}},startScroll:function(){b8e.Tween.get(this.skin.zero_node).to({y:this.endPos},5e3).call(this._scroll,this)},_scroll:function(){var e=this,t=e.space;if(e.endPos-e.lastPos>=t){var a=e.datasLen,i=e.iconList1[e.iconIndex],n=e.iconList2[e.iconIndex];if(!i||!n)return;i.setPosition(0,i.y-a*t),n.setPosition(0,n.y-a*t),e.lastPos=e.endPos,e.iconIndex++,e.iconIndex=e.iconIndex>a-1?0:e.iconIndex}e.endPos+=e.speed,b8e.Tween.get(e.skin.zero_node).to({y:e.endPos},5e3).call(e._scroll,e)},onHide:function(){this.clearTimer(),this.resetPos()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},resetPos:function(){var e=this,t=e.skin,a=e.datasLen,i=e.iconList1,n=e.iconList2,s=-1*e.space;e.iconIndex=0,e.lastPos=e.zeroPos,e.endPos=e.zeroPos+e.speed,t.zero_node.y=e.zeroPos,b8e.Tween.kill(t.zero_node);for(var r=0;r<a;r++)i[r].setPosition(0,s*r);for(var o=0;o<a;o++)n[o].setPosition(0,s*o)},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.JuBaoPen,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(629)},init:function(){var e=this.skin,t=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.PrizeListItem,t.bindEnum=game.ME.JuBaoPen,t.layout.paddingLeft=2,t.layout.spacingX=20,t.layout.paddingTop=0,t.layout.spacingY=5,t.addToParent(e.listNode);var a=this.btnList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.JuBaoPenLvItem,a.bindEnum=game.ME.JuBaoPen,a.addToParent(e.btn_list)},notify:function(e){switch(e){case this.Evts.C2V_SWITCH_SHOW:this.updateList()}},onShow:function(){this.setFirstLv(),this.updateList()},setFirstLv:function(){var e=game.juBaoPenData.lvArr;!e||e.length<1||(game.juBaoPenData.setSelectLv(e[0].lv),this.btnList.setData(e))},updateList:function(){var e=game.juBaoPenData,t=e.lvArr;if(t&&!(t.length<1)){var a=t[e.selectLv-1];a&&this.itemList.setData(a.prizeList)}},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width)-6,.5*(t+this.height)+20)}});b8e.module.registerView(game.ME.JuBaoPenShow,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(627),this.setSize(108,150)},init:function(){var e=this.icon=b8e.Sprite.get();e.setAnchor(.5,.5),e.addToParent(this.skin.icon)},setData:function(){var e=this.skin,t=this.data,a=game.ResCfg.getUrl(5064,t.lv);this.icon.loadTexture(a),e.lab.string=t.str2,e.select.active=t.isSelect},on_click:function(){var e=this.data;game.juBaoPenData.setSelectLv(e.lv),this.send(game.JuBaoPenEvts.V2C_SWITCH_SHOW)}}),b8e.RC("$$game","$$JuBaoPenLvItem",e)}(),function(){var e;e=b8e.Enum({CENTER:0,TOP:1,BOTTOM:2,LEFT:3,RIGHT:4,LEFT_TOP:5,RIGHT_TOP:6,LEFT_BOTTOM:7,RIGHT_BOTTOM:8}),b8e.RC("$$game","$$LayoutType",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._moduleArray=[2051,7400,1027],this._waitShow=b8e.HashMap.get()},setDelayCall:function(e,t,a){var i=this._waitShow.get(e);i&&(i.callBack=t,i.thisArg=a)},checkDelayModule:function(e,t){if(this._moduleArray.indexOf(e)<0)return!0;var a=this._waitShow.get(e);if(a||(a={moduleId:e,toggle:t,isShow:!1,isHide:!1},this._waitShow.set(e,a)),a.isShow&&a.isHide)return!0;if(e==game.ME.ModuleOpen){var i=this.checkOtherAllOpen();if(1<this._waitShow.count()-i)return!1}for(var n=void 0,s=void 0,r=0,o=this._moduleArray.length;r<o;r++)if((n=this._moduleArray[r])!=e&&(s=this._waitShow.get(n))&&!s.isHide)return!1;return a.isShow=!0},checkOtherAllOpen:function(){var a=0;return this._waitShow.forEach(function(e,t){t.isShow&&t.isHide&&a++}),a},delayShowModule:function(e){var a=this,t=a._waitShow.get(e);if(t&&t.isShow&&!t.isHide&&(t.isHide=!0,e!=game.ME.ModuleOpen)){var i=a.checkOtherAllOpen(),n=void 0;a._waitShow.forEach(function(e,t){t.moduleId==game.ME.ModuleOpen?a._waitShow.count()-i==1&&(n=t):t.isShow||t.isHide||(n=t)}),n&&(n&&n.callBack?n.callBack.call(n.thisArg):n.toggle?game.module.showToggle(n.moduleId,n.toggle):(n.isShow=!0,game.module.show(n.moduleId)))}}});game.moduleDelay=game.moduleDelay||new e}(),function(){var e=game.View.extends({ctor:function(){this._super(1081)},onShow:function(){var e="",t=Math.floor(game.miscData.fcmOnlineTime/60),a=game.miscData.fcmOnlineTime-60*t;0<a&&(e=a+game.Lang.get(9361)),0<t&&(e=t+game.Lang.get(9360)+e),this.skin.msgLbl.string=game.Lang.get(9682,e)}});b8e.module.registerView(game.ME.FcmOnlineTips,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1082)},init:function(){var e=this.skin,t=+game.LoginConfig.gameChannelId,a=game.FollowGiftCfg.getData(t);if(a){var i=game.ResCfg.getImgUrl(a.codeImg,!0);e.codeImg.loadTexture(i),i=game.ResCfg.getImgUrl(a.bannerLab),e.bannerLab.loadTexture(i)}},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.FollowGift,e)}(),function(){var e;e=b8e.Enum({None:0,V_TOGGLECHANGE:-1,V2C_REQ_GET_AWARD:-1,C2V_UPDATEVIEW:-1,C2V_UPDATE_AWARDVIEW:-1,C_UPDATE_CSFESTIVAL_VIEW:-1,V2C_REQDATA:-1,C2C_REQ_RANKLIST:-1,V2C_HIDE_VIEW:-1,C2V_UPDATE_RANK_VIEW:-1}),b8e.RC("$$game","$$CsFestivalBossEvts",e)}(),function(){var e=b8e.Object.extends({bossId:0,hp:0,maxHp:0,isOpen:!1,cd:0,ranks:null,myRank:0,score:0,collected:null,rankList:null,rankInfos:null,ctor:function(){this.ranks=[],this.collected=[],this.targetAwardDatas=[],this.rankList=[],this.rankInfos=[]},initData:function(){this.initTargetAwardData()},setData:function(e){this.bossId=e.bossId,this.hp=e.hp,this.maxHp=e.maxHp,this.isOpen=e.isOpen,this.cd=e.cd,this.ranks=e.ranks,this.myRank=e.myRank,this.score=e.score,this.collected=e.collected},setRankList:function(e){this.rankList||(this.rankList=[]),this.rankList=e.ranks,this.updateRankInfos()},initTargetAwardData:function(){if(this.targetAwardDatas&&0<this.targetAwardDatas.length)return this.targetAwardDatas;var e=game.CfbTargetAwardCfg.getDatas();if(e&&!(e.length<1)){this.targetAwardDatas||(this.targetAwardDatas=[]);for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.CSArenaScoreInfo).cfg=a,i.score=this.score,i.labelId=9662,this.targetAwardDatas.push(i)}},updateTargetAwardData:function(){var e=this.targetAwardDatas.length,t=void 0;if(this.targetAwardDatas&&0<e)for(var a=0;a<e;a++)(t=this.targetAwardDatas[a]).score=this.score,this.collected&&-1<this.collected.indexOf(t.cfg.id)?(t.isGet=!0,t.isCanGet=!1):(t.isGet=!1,t.isCanGet=this.score>=t.cfg.score)},updateCollected:function(e){game.CfbTargetAwardCfg.getData(e)&&(this.collected||(this.collected=[]),-1<this.collected.indexOf(e)||(this.collected.push(e),this.updateTargetAwardData()))},getTargetAwardList:function(){return this.targetAwardDatas&&0<this.targetAwardDatas.length?(this.targetAwardDatas.sort(this.sortHandler),this.targetAwardDatas):null},updateRankInfos:function(){this.rankInfos=[];for(var e=void 0,t=this.rankList.length,a=0;a<t;a++){var i=this.rankList[a];(e=new game.CsfBossRankInfo).rank=a+1,e.name=i.name,e.zone=i.zone,e.score=i.score,e.cfg=this.getRankCfg(a+1),this.rankInfos.push(e)}},getRankInfos:function(){return this.rankInfos&&0<this.rankInfos.length?this.rankInfos:null},getRankCfg:function(e){var t=game.CfbRankAwardCfg.getDatas(),a=t.length;if(!t||a<1)return null;for(var i=0;i<a;i++){var n=t[i];if(e>=n.minRank&&e<=n.maxRank)return n}return t[a-1]},sortHandler:function(e,t){return e.isGet==t.isGet?e.isCanGet==t.isCanGet?e.cfg.score-t.cfg.score:e.isCanGet?-1:1:e.isGet?1:t.isGet?-1:void 0},getCurrCfg:function(){var e=game.CsFestivalBossCfg.getDatas();if(!e||e.length<1)return null;for(var t=game.SysTime.curTime,a=0;a<e.length;a++){var i=e[a];if(0!=i.startTime&&0!=i.endTime){var n=b8e.TimeUtil.dateParse(i.startTime,"yyyy-MM-dd hh:mm:ss").getTime(),s=b8e.TimeUtil.dateParse(i.endTime,"yyyy-MM-dd hh:mm:ss").getTime();if(t<n||s<=t)continue}return i}return null},getCurrTimeSlot:function(){var e=game.CsFestivalBossMiscCfg.getData("FestivalBossOpenTime");if(!e)return null;for(var t=e.value.split("|"),a=t.length,i=0;i<a;i++){var n=t[i].split("-"),s=this.getTimeStamp(n[0]),r=this.getTimeStamp(n[1]),o=game.SysTime.curTime;if(s<o&&o<r)return[s,r]}return null},getNextTimeSlot:function(){var e=game.CsFestivalBossMiscCfg.getData("FestivalBossOpenTime");if(!e)return null;for(var t=e.value.split("|"),a=t.length,i=0;i<a;i++){var n=t[i].split("-"),s=this.getTimeStamp(n[0]);if(game.SysTime.curTime<s)return t[i]}return null},getCountDown:function(){var e=this.getCurrTimeSlot();if(!e)return 0;var t=game.SysTime.curTime;return e[1]-t},getTimeStamp:function(e){var t=e.split(":");if(!t||t.length<1)return 0;var a=game.SysTime.curTime,i=b8e.TimeUtil.getTodayTime(a);return this._endTime=i+b8e.TimeUtil.HOUR_MICRO_SECONDS*t[0]+b8e.TimeUtil.MINUTE_MICRO_SECONDS*t[1],this._endTime},isActOpen:function(){return!!this.getCurrCfg()},canGetAward:function(){if(!this.targetAwardDatas)return!1;for(var e=this.targetAwardDatas.length,t=0;t<e;t++)if(this.targetAwardDatas[t].isCanGet)return!0;return!1}});game.csFestivalBossData=game.csFestivalBossData||new e}(),function(){var e;e=b8e.Object.extends({rank:0,name:"",score:0,zone:0,cfg:null,ctor:function(){this._super()},getPrizeList:function(){if(this.award)return this.award;this.award=[];for(var e,t,a=this.cfg.award,i=a.length,n=0;n<i;n++){e=a[n],(t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.award.push(t)}return this.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$CsfBossRankInfo",e)}(),function(){var e=game.Control.extends({canOpenUI:!1,init:function(){game.csFestivalBossData.initData(),this.data=game.csFestivalBossData,this.noticeAlert={lang:50407,btn:game.Lang.get(9059),key:game.AlertKey.CS_FESTIVAL_BOSS,okcb:this.clearCd,thisArg:this,args:[],langArgs:[],showtips:!0,defaultSelect:!0,align:b8e.HorizontalAlign.CENTER}},ipc:function(){this.handels={FestivalBossDataResp:this.festivalBossDataResp,FestivalBossChallengeResp:this.festivalBossChallengeResp,FestivalBossClearCDResp:this.festivalBossClearCDResp},this.gevts={InstanceEvts:{G_STOP_PLAY:this.battleStop},MainUIEvts:{NOT_OPEN_UI:this.onOpenUI}}},battleStop:function(e){e.data.type==game.InstanceType.CS_FESTIVAL_BOSS&&this.sender.FestivalBossDataReq()},triggerOpen:function(e){e==this.moduleEnum&&this.data.getCurrCfg()&&this.sender.FestivalBossDataReq()},notify:function(e){switch(e){case this.Evts.V2C_REQDATA:this.sender.FestivalBossDataReq();break;case this.Evts.V2C_HIDE_VIEW:this.canOpenUI=!1}},festivalBossDataResp:function(e){var t=e.readProtobuf(game.pb.FestivalBossDataResponse);0<t.code?game.notice.noticeError(t.code):(this.canOpenUI&&!b8e.module.isShowView(this.moduleEnum)&&game.module.show(game.ME.CsFestivalBoss),this.data.setData(t.data),this.data.updateTargetAwardData(),this.setCDTime(t.data.cd),this.send(this.Evts.C2V_UPDATEVIEW),this.dpt(this.Evts.C_UPDATE_CSFESTIVAL_VIEW))},festivalBossChallengeResp:function(e){var t=e.readProtobuf(game.pb.FestivalBossChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a={type:game.InstanceType.CS_FESTIVAL_BOSS,rewards:t.useritem};game.playBack.play(t.battlelog,a)}},festivalBossClearCDResp:function(e){var t=e.readProtobuf(game.pb.FestivalBossClearCDResponse);0<t.code?game.notice.noticeError(t.code):(game.csFestivalBossData.cd=0,this.send(this.Evts.C2V_UPDATEVIEW))},rankBtn:function(){this.dpt(this.Evts.C2C_REQ_RANKLIST),game.module.showToggle(game.ME.CsFestivalBossRankMain,0)},awardBtn:function(){game.module.showToggle(game.ME.CsFestivalBossRankMain,1)},clearCdBtn:function(){var e=game.CsFestivalBossMiscCfg.getData("FestivalBossClearCDCost");if(e){var t=+e.value;this.noticeAlert.args[0]=t,this.noticeAlert.langArgs[0]=t,game.alert.show(this.noticeAlert)}},clearCd:function(e){game.amount.get(game.AmountType.YUAN_BAO)<e?game.notice.show(116):this.sender.FestivalBossClearCDReq()},challengeBtn:function(){this.data.getCountDown()<=0?game.notice.show(9171):0<this.data.cd?game.notice.show(9663):this.sender.FestivalBossChallengeReq()},notChallengeBtn:function(){},descBtn:function(){game.RuleView.inst().showView(game.ME.CsFestivalBoss)},setCDTime:function(e){var t=1e3*e;game.csFestivalBossData.cd=t,1<game.csFestivalBossData.cd?this.createCDTimer():this.clearCDTimer()},createCDTimer:function(){this.cdTimer||(this._lastTime=b8e.timeStamp,this.cdTimer=b8e.Timer.add(this,this.updateCDTime,1e3),this.cdTimer.start())},updateCDTime:function(){var e=b8e.timeStamp,t=e-this._lastTime;this._lastTime=e,game.csFestivalBossData.cd-=t,game.csFestivalBossData.cd<1&&this.clearCDTimer()},clearCDTimer:function(){this.cdTimer&&(b8e.Timer.remove(this,this.updateCDTime),this.cdTimer=null)},refreshBoss:function(){this.sender.FestivalBossDataReq()},onOpenUI:function(e){this.moduleEnum==e.data&&(this.canOpenUI=!0,this.refreshBoss())}}),t=game.Sender.extends({ipc:function(){this.msg={FestivalBossDataReq:null,FestivalBossChallengeReq:null,FestivalBossClearCDReq:null}}});b8e.module.registerControl(game.ME.CsFestivalBoss,e,game.CsFestivalBossEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.FESTIVAL_BOSS_CS_AWARD,game.SAE.FESTIVAL_BOSS_CS)},ipc:function(){this.evts={CsFestivalBoss:{C_UPDATE_CSFESTIVAL_VIEW:this.checkSpotAlert}},this.handels={FestivalBossCollectResp:this.festivalBossCollectResp}},festivalBossCollectResp:function(e){var t=e.readProtobuf(game.pb.FestivalBossCollectResponse);0<t.code?game.notice.noticeError(t.code):(game.csFestivalBossData.updateCollected(t.id),this.checkSpotAlert(),this.send(this.Evts.C2V_UPDATE_AWARDVIEW))},notify:function(e,t){switch(e){case this.Evts.V2C_REQ_GET_AWARD:this.sender.FestivalBossCollectReq(t)}},checkSpotAlert:function(){this.spotAlert.alert=game.csFestivalBossData.canGetAward()}}),t=game.Sender.extends({ipc:function(){this.msg={FestivalBossCollectReq:this.festivalBossCollectReq}},festivalBossCollectReq:function(e){var t=game.pb.FestivalBossCollectRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.CsFestivalBossAward,e,game.CsFestivalBossEvts,t)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={CsFestivalBoss:{C2C_REQ_RANKLIST:this.reqRankList}},this.handels={FestivalBossRankResp:this.festivalBossRankResp}},reqRankList:function(){this.sender.FestivalBossRankReq()},festivalBossRankResp:function(e){var t=e.readProtobuf(game.pb.FestivalBossRankResponse);0<t.code?game.notice.noticeError(t.code):(game.csFestivalBossData.setRankList(t),this.send(this.Evts.C2V_UPDATE_RANK_VIEW))}}),t=game.Sender.extends({ipc:function(){this.msg={FestivalBossRankReq:null}}});b8e.module.registerControl(game.ME.CsFestivalBossRank,e,game.CsFestivalBossEvts,t)}(),function(){var e=game.Control.extends({rankBtn:function(){this.selectToggle(0)},awardBtn:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}});b8e.module.registerControl(game.ME.CsFestivalBossRankMain,e,game.TeamLeagueEvts)}(),function(){var e=game.View.extends({ctor:function(){this._super(232),this.spotAlerts={FESTIVAL_BOSS_CS_AWARD:this.assistAlert}},init:function(){var e=this.skin;this.csFestivalBossData=game.csFestivalBossData,this.Progress=new game.Progress(400,37),this.Progress.addToParent(e.progressNode),this._monModel=b8e.SceneEntity.get(),this._monModel.addToParent(this.skin.bossNode),this.updataModel()},notify:function(e){switch(e){case this.Evts.C2V_UPDATEVIEW:this.updateView(),this.updateRank()}},assistAlert:function(e){this.skin.red_spot_1.node.active=e.alert},onHide:function(){this.send(this.Evts.V2C_HIDE_VIEW)},updateView:function(){this.updateProgress(),this.updateShowState(),this.hpTimer||(this.hpTimer=b8e.Timer.add(this,this.updateBossHp,1e4)),this.hpTimer.reset(),this.hpTimer.start()},updateShowState:function(){var e=this,t=e.skin,a=game.csFestivalBossData.getCountDown();if(0==e.csFestivalBossData.hp||a<=0){t.cdNode.node.active=!1;var i=game.csFestivalBossData.getNextTimeSlot();return e.skin.noticeLab.string=i?game.Lang.get(9658,i):game.Lang.get(9667),t.challengeBtn.node.active=!1,t.notChallengeBtn.node.active=!0,e.remTimer&&(b8e.Timer.remove(e,e.updateFestivalTime),e.remTimer=null),void(e.cdTimer&&(b8e.Timer.remove(e,e.updateCdTime),e.cdTimer=null))}e.remTimer||(e.remTimer=b8e.Timer.add(e,e.updateFestivalTime,1e3)),e.remTimer.reset(),e.remTimer.start(),game.csFestivalBossData.cd<=0?(t.cdNode.node.active=!1,t.challengeBtn.node.active=!0,t.notChallengeBtn.node.active=!1,e.cdTimer&&(b8e.Timer.remove(e,e.updateCdTime),e.cdTimer=null)):(e.cdTimer||(e.cdTimer=b8e.Timer.add(e,e.updateCdTime,1e3)),e.remTimer.reset(),e.remTimer.start(),t.cdNode.node.active=!0,t.challengeBtn.node.active=!1,t.notChallengeBtn.node.active=!0)},updateFestivalTime:function(){var e=this.skin,t=game.csFestivalBossData.getCountDown();if(0<t){var a=b8e.TimeUtil.formatTime(t);e.noticeLab.string=game.Lang.get(9657,a)}else this.send(this.Evts.V2C_REQDATA)},updateCdTime:function(){var e=this.skin,t=game.csFestivalBossData.cd;if(!t||t<=0)this.send(this.Evts.V2C_REQDATA);else{var a=b8e.TimeUtil.formatTime(t);e.cdLab.string=game.Lang.get(9656,a)}},updateBossHp:function(){0<this.csFestivalBossData.hp&&this.send(this.Evts.V2C_REQDATA)},updateRank:function(){var e=this.skin;e.myRankLab.string=game.Lang.get(9659,this.csFestivalBossData.myRank),e.myHurtLab.string=game.Lang.get(9660,game.CCommonUtil.replaceNum(this.csFestivalBossData.score,2));var t=this.csFestivalBossData.ranks,a=t.length;if(!(a<1)){3<a&&(a=3);for(var i=0;i<a;i++){var n=t[i];this.getComponent("rank_"+(i+1)).string=i+1,this.getComponent("name_"+(i+1)).string=game.Lang.get(9669,n.zone,n.name),this.getComponent("hurt_"+(i+1)).string=game.CCommonUtil.replaceNum(n.score,2)}}},updateProgress:function(){var e=.01*this.csFestivalBossData.maxHp,t=this.csFestivalBossData.hp;0<t&&t<=e?this.Progress.updatePro(1,100,!0):this.Progress.updatePro(this.csFestivalBossData.hp,this.csFestivalBossData.maxHp,!0)},updataModel:function(){var e=game.csFestivalBossData.getCurrCfg();if(e){var t=e.showModel;t=game.ResCfg.getUrl(5e3,t),this.setAnim(t)}},setAnim:function(e){var t;e?((t=(t=this._monModel.getAnimator(game.AnimType.BOSS,1))||this._monModel.addAnimator(game.AnimType.BOSS,1)).load(e),t.play()):t&&t.clear()}});b8e.module.registerView(game.ME.CsFestivalBoss,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(229)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.CSFBossTargetAwardItem,this._list.bindEnum=game.ME.CsFestivalBossAward,this._list.layout.paddingLeft=0,this._list.layout.spacingY=10,this._list.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_AWARDVIEW:this.updateRankList()}},onShow:function(){this.updateRankList()},updateRankList:function(){var e=game.csFestivalBossData.getTargetAwardList();0<e.length&&this._list&&this._list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsFestivalBossAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(231)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.CSFBossRankItem,this._list.bindEnum=game.ME.CsFestivalBossRank,this._list.layout.paddingLeft=0,this._list.layout.spacingY=10,this._list.addToParent(e.list)},onShow:function(){this.updateView()},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_RANK_VIEW:this.updateView()}},updateView:function(){var e=this.skin;this.updateRankList();var t=game.csFestivalBossData;e.myRankLab.string=game.Lang.get(9664,t.myRank),e.myHurtLab.string=game.Lang.get(9661,game.CCommonUtil.replaceNum(t.score,2))},updateRankList:function(){var e=game.csFestivalBossData.getRankInfos();e&&0<e.length&&this._list&&this._list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.CsFestivalBossRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(230),this.spotAlerts={FESTIVAL_BOSS_CS_AWARD:this.assistAlert},this.toggles={toggle_btn_1:game.ME.CsFestivalBossRank,toggle_btn_2:game.ME.CsFestivalBossAward}},assistAlert:function(e){this.skin.red_spot_2.node.active=e.alert},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleTrigger(t)}},onShow:function(){this.toggleTrigger(0)},toggleTrigger:function(e){var t=this.skin;t.title_rank.node.active=0==e,t.title_award.node.active=1==e,this.toggleSelect(e)}});b8e.module.registerView(game.ME.CsFestivalBossRankMain,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(228),this.setSize(550,155)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=15,e.layout.spacingY=5},setData:function(e){var t=this.skin,a=(e=e,this.data.cfg),i=e.getPrizeList();this.prizeList.setData(i),t.btn_no_get.node.active=!1,t.btn_isGet.node.active=!1,t.btn_get.node.active=!1,e.isGet?t.btn_isGet.node.active=!0:e.isCanGet?t.btn_get.node.active=!0:t.btn_no_get.node.active=!0;var n="",s=e.score,r=game.CCommonUtil.replaceNum(s,2);n=s>=(a.score||a.num)?game.HtmlUtil.getText(game.Color.GREEN,r):game.HtmlUtil.getText(game.Color.RED,r),t.lab_content.string=game.Lang.get(e.labelId,n,game.CCommonUtil.replaceNum(a.score||a.num,2))},btn_get:function(){this.data&&this.data.cfg&&this.send(game.CsFestivalBossEvts.V2C_REQ_GET_AWARD,this.data.cfg.id)}}),b8e.RC("$$game","$$CSFBossTargetAwardItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(227),this.setSize(550,90)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.addToParent(this.skin.prizeList)},setData:function(){var e=this.skin,t=this.data,a=t.rank;this.prizeList.setData(this.data.getPrizeList()),e.rank_bg1.active=1==a,e.rank_bg2.active=2==a,e.rank_bg3.active=3==a,e.lbl_rank.string=a;var i=game.Lang.get(9666);switch(a){case 1:e.nameLab.node.color=game.Color.RED,i=game.HtmlUtil.getText(game.Color.RED,i);break;case 2:e.nameLab.node.color=game.Color.BLUE,i=game.HtmlUtil.getText(game.Color.BLUE,i);break;case 3:e.nameLab.node.color=game.Color.GREEN,i=game.HtmlUtil.getText(game.Color.GREEN,i)}e.nameLab.string=game.Lang.get(9670,t.zone,t.name),e.hurtLab.string=i+game.CCommonUtil.replaceNum(t.score,2)}}),b8e.RC("$$game","$$CSFBossRankItem",e)}(),function(){var e;e=b8e.Enum({None:0,V_START_THROW:-1,V_SKIP_TWEEN:-1,V_COST_PROP:-1,V_ScrollLeft:-1,V_ScrollRight:-1,V_UPDATE_NUM:-1,V_UPDATE_PLIES_AWARD:-1,V_AUTO_THROW:-1,V_UPDATE_STEP_AWARD:-1,C_UPDATE_STEP_AWARD:-1,V2C_REQ_GET_AWARD:-1,V2C_GET_AWARD:-1,V2C_AUTO_THROW:-1,C2V_TP_ENTER:-1,C2V_AUTO_STATE:-1,C2V_UPDATE_VIEW:-1}),b8e.RC("$$game","$$TreasurePavilionEvts",e)}(),function(){var e=b8e.Object.extends({cbgId:0,cbgNum:0,cbgPlies:1,cbgPos:0,cbgDayNum:0,cbgAllNum:0,cbgPliesNum:0,cbgDayAwards:null,cbgPliesAwards:null,gridAwards:null,isSkipTween:!1,isCostProp:!1,isAutoThrow:!1,isNotThrow:!1,costItemId:0,currCfg:null,ctor:function(){this.layerInfos=[],this.stepAwardInfos=[],this.cbgDayAwards=[],this.cbgPliesAwards=[],this.gridAwards=[],this.ownLogs=[]},initData:function(){this.layerAwardMap=b8e.HashMap.get(),this.cellAwardMap=b8e.HashMap.get(),this.stepAwardMap=b8e.HashMap.get(),this.initCellAward(),this.initStepAward();var e=game.TreasurePavilionMiscCfg.getData("cbgCostItems");e&&(this.costItemId=+e.value)},setData:function(e){var t=this;t.cbgId=e.cbgId,t.cbgNum=e.cbgNum,t.cbgPlies=e.cbgPlies||1,t.cbgPos=e.cbgPos,t.cbgDayNum=e.cbgDayNum,t.cbgAllNum=e.cbgAllNum,t.cbgPliesNum=e.cbgPliesNum,t.cbgDayAwards=e.cbgDayAwards,t.cbgPliesAwards=e.cbgPliesAwards,t.currCfg=t.getCurCfg(),t.initStepAwardInfos(),t.updateStepAwardInfos(),t.updateLayerAwardInfos(),t.setWholeLogs(e.cbgAwardsLogs)},resetData:function(){var e=this;e.cbgDayNum=0,e.cbgDayAwards=[],e.initStepAwardInfos(),e.updateStepAwardInfos(),e.currCfg=e.getCurCfg(),e.currCfg&&e.cbgId!=e.currCfg.id&&(e.cbgNum=0,e.cbgPlies=1,e.cbgPos=1,e.cbgPliesNum=0,e.cbgAllNum=0,e.layerInfos=[],e.stepAwardInfos=[],e.cbgPliesAwards=[],e.ownLogs=[],game.cservRankData.updateTPStep(0)),e.layerInfos.length<1&&e.updateLayerAwardInfos()},updateDiceData:function(e){var t=this;t.cbgPlies=e.plies,t.cbgPos=e.pos,t.cbgDayNum=e.stepNum,t.cbgAllNum=e.allNum,t.cbgPliesNum=e.pliesNum,t.gridAwards=e.awards,(!t.isCostProp||t.isCostProp&&t.getCostItemNum()<1)&&(t.cbgNum-=1),t.updateStepAwardInfos(),t.updateLayerAwardInfos(),t.gridAwards&&0<t.gridAwards.length&&t.addWholeLog(t.gridAwards[0])},updatePliesAward:function(e){this.cbgPliesAwards||(this.cbgPliesAwards=[]),-1<this.cbgPliesAwards.indexOf(e)||(this.cbgPliesAwards.push(e),this.updateLayerAwardInfos())},updateDayAward:function(e){this.cbgDayAwards||(this.cbgDayAwards=[]),-1<this.cbgDayAwards.indexOf(e)||(this.cbgDayAwards.push(e),this.updateStepAwardInfos())},checkIsOpenBuyId:function(e){var t=game.CangBaoGeOpenCfg.getData(e);return this.checkIsOpen(t)},checkIsOpen:function(e){var t=e.serverStart,a=e.serverEnd,i=game.TimeUtil.getOpenDayByStr(e.startTime,"yyyy-MM-dd  hh:mm:ss"),n=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),s=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),r=game.SysTime.curTime;return t<=i&&i<=a&&n<=r&&r<=s},getCurCfg:function(){var e=game.CangBaoGeOpenCfg.getDatas();if(!e||e.length<1)return null;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.checkIsOpenBuyId(i.id))return i}return null},initCellAward:function(){var e=game.CangBaoGePliesAwardsCfg.getDatas();if(e)for(var t=e.length,a=0;a<t;a++){var i=e[a],n=this.layerAwardMap.get(i.storeId);n||(n=[],this.layerAwardMap.set(i.storeId,n)),n.push(i)}},initStepAward:function(){var e=game.CangBaoGeDaysAwardsCfg.getDatas();if(e)for(var t=e.length,a=0;a<t;a++){var i=e[a],n=this.stepAwardMap.get(i.storeId);n||(n=[],this.stepAwardMap.set(i.storeId,n)),n.push(i)}},getLayerAwards:function(){return this.currCfg?this.layerAwardMap.get(this.currCfg.storeId):null},updateLayerAwardInfos:function(){this.layerInfos=[];var e=this.getLayerAwards();if(e)for(var t=e.length,a=void 0,i=0;i<t;i++){var n=e[i];(a=new game.TPLayerItemInfo).cfg=n,this.cbgPliesAwards&&-1<this.cbgPliesAwards.indexOf(a.cfg.pliesNum)?(a.isGet=!0,a.isCanGet=!1):(a.isGet=!1,a.isCanGet=this.cbgPliesNum>=a.cfg.pliesNum),this.layerInfos.push(a)}},getStepAwards:function(){return this.currCfg?this.stepAwardMap.get(this.currCfg.storeId):null},initStepAwardInfos:function(){if(!(this.stepAwardInfos&&0<this.stepAwardInfos.length)){this.stepAwardInfos||(this.stepAwardInfos=[]);var e=this.getStepAwards();if(e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.CSArenaScoreInfo).cfg=a,i.score=this.cbgDayNum,i.labelId=9701,this.stepAwardInfos.push(i)}},updateStepAwardInfos:function(){var e=this.stepAwardInfos.length,t=void 0;if(this.stepAwardInfos&&0<e)for(var a=0;a<e;a++)(t=this.stepAwardInfos[a]).score=this.cbgDayNum,this.cbgDayAwards&&-1<this.cbgDayAwards.indexOf(t.cfg.num)?(t.isGet=!0,t.isCanGet=!1):(t.isGet=!1,t.isCanGet=this.cbgDayNum>=t.cfg.num)},getStepAwardInfos:function(){return this.stepAwardInfos&&0<this.stepAwardInfos.length?(this.stepAwardInfos.sort(this.sortHandler),this.stepAwardInfos):null},sortHandler:function(e,t){return e.isGet==t.isGet?e.isCanGet==t.isCanGet?e.cfg.score-t.cfg.score:e.isCanGet?-1:1:e.isGet?1:t.isGet?-1:void 0},getCurrCellAward:function(e,t,a,i){if(!this.currCfg)return null;game.AsyncData.getEAsyncData(game.CangBaoGeAwardsCfg,[this.currCfg.storeId,this.cbgPlies,e],this._getCangBaoCfg,this,[t,i,a])},_getCangBaoCfg:function(e,t,a,i){e&&t.call(i,e,a)},getCountDown:function(){if(!this.currCfg)return 0;var e=game.SysTime.curTime;return b8e.TimeUtil.dateParse(this.currCfg.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()-e},getCostItemNum:function(){return game.itemData.getCountById(this.costItemId)},checkRankEnter:function(){this.isShowRank=!1;var e=game.CServRankCfg.getListByType(game.CServType.TREASURE_PAVILION_RANK);if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)if(this.checkIsOpen(e[a]))return void(this.isShowRank=!0)},setWholeLogs:function(e){if(e)for(var t=0,a=this.ownLogs,i=e.length-1;0<=i;i--)a[t]||(a[t]=new game.XunBaoLogInfo),a[t].setData(e[i]),t++},addWholeLog:function(e){var t=this.ownLogs,a=void 0;50<=t.length?(a=t[0],t.splice(0,1),a.name=game.mainRoleData.name):(a=new game.XunBaoLogInfo).name=game.mainRoleData.name,a.itemId=e.id,a.itemNum=e.num,t.push(a)},isActOpen:function(){return!!this.getCurCfg()},canGetStepAward:function(){if(!this.stepAwardInfos)return!1;for(var e=this.stepAwardInfos.length,t=0;t<e;t++)if(this.stepAwardInfos[t].isCanGet)return!0;return!1},canGetPliesAward:function(){if(!this.layerInfos)return!1;for(var e=this.layerInfos.length,t=0;t<e;t++)if(this.layerInfos[t].isCanGet)return!0;return!1},checkThrowCondition:function(){if(!this.currCfg)return!1;return 1==this.currCfg.activityType?game.amount.get(game.AmountType.YUAN_BAO)>=this.currCfg.condition||0<this.getCostItemNum():0<this.cbgNum||0<this.getCostItemNum()}});game.treasurePavilionData=game.treasurePavilionData||new e}(),function(){var e;e=b8e.Object.extends({cfg:null,isGet:!1,isCanGet:!1,ctor:function(){this._super()},setData:function(e){this.cfg=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TPLayerItemInfo",e)}(),function(){var e=game.Control.extends({isAutoThrow:!1,isCostGold:!1,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.TREASURE_PAVILION_PLIES_AWARD,game.SAE.TREASURE_PAVILION),this.throwAlert=game.spotAlert.set(game.SAE.TREASURE_PAVILION_THROW,game.SAE.TREASURE_PAVILION),game.treasurePavilionData.initData(),this.tpData=game.treasurePavilionData,this.obj={openServerType:game.OpenServerType.CROSS_SERVICE_RANK,type:game.CServType.TREASURE_PAVILION_RANK}},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.initOpenServer},CServRank:{C2C_JUBAO_ENTER:this.updateRankEnter},MainRole:{C_RESET_DAILY:this.resetDaily},Back:{C_BACK_UPDATE_ITEMINFO:this.chackThrowAlert}},this.handels={CangBaoGeGridResp:this.cangBaoGeGridResp,CangBaoGePliesAwardsResp:this.cangBaoGePliesAwardsResp,CangBaoGeMsg:this.cangBaoGeNotify}},notify:function(e,t,a){switch(e){case this.Evts.V2C_GET_AWARD:this.getAward(t,a);break;case this.Evts.V2C_AUTO_THROW:this.cangBaoGeGridReq();break;case this.Evts.C2V_AUTO_STATE:this.isAutoThrow=!1,this.isCostGold=!1}},resetDaily:function(){this.tpData.isActOpen()?(this.tpData.resetData(),this.checkSpotAlert(),this.chackThrowAlert(),this.send(this.Evts.C2V_UPDATE_VIEW)):game.module.hide(game.ME.TreasurePavilion)},checkSpotAlert:function(){this.spotAlert.alert=game.treasurePavilionData.canGetPliesAward()},chackThrowAlert:function(){var e=this.tpData.currCfg;e?1==e.activityType?this.throwAlert.alert=0<this.tpData.getCostItemNum():this.throwAlert.alert=0<this.tpData.cbgNum||0<this.tpData.getCostItemNum():this.throwAlert.alert=!1},cangBaoGeGridResp:function(e){var t=e.readProtobuf(game.pb.CangBaoGeGridResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.tpData.cbgPos;this.tpData.updateDiceData(t),game.cservRankData.updateTPStep(t.allNum),this.chackThrowAlert(),this.checkSpotAlert(),this.send(this.Evts.V_START_THROW,a),this.dpt(this.Evts.C_UPDATE_STEP_AWARD)}},cangBaoGePliesAwardsResp:function(e){var t=e.readProtobuf(game.pb.CangBaoGePliesAwardsResponse);0<t.code?game.notice.noticeError(t.code):(this.tpData.updatePliesAward(t.pliesNum),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_PLIES_AWARD))},cangBaoGeNotify:function(e){var t=e.readProtobuf(game.pb.CangBaoGeNotify);0<t.code?game.notice.noticeError(t.code):(this.tpData.cbgNum=t.num,this.chackThrowAlert(),this.send(this.Evts.V_UPDATE_NUM))},getAward:function(e,t){if(1==t)this.sender.CangBaoGePliesAwardsReq(e.pliesNum);else{var a=game.Lang.get(9711,e.pliesNum);game.prizeTipsData.setup(e.awards,a),game.module.show(game.ME.PrizeTips)}},initOpenServer:function(e){var t=e.data;this.tpData.setData(t),game.cservRankData.updateTPStep(t.cbgAllNum),this.checkSpotAlert(),this.chackThrowAlert()},shopBtn:function(){var e=this.tpData.currCfg;e&&this.dptG(game.ShopGEvts.SHOW_SHOP,e.shopId)},skipBtn:function(){this.tpData.isSkipTween=!this.tpData.isSkipTween,this.send(this.Evts.V_SKIP_TWEEN)},costBtn:function(){this.tpData.isCostProp=!this.tpData.isCostProp,this.send(this.Evts.V_COST_PROP)},leftBtn:function(){this.send(this.Evts.V_ScrollLeft)},rightBtn:function(){this.send(this.Evts.V_ScrollRight)},descBtn:function(){game.module.show(game.ME.TPAwardLogs)},stepRankBtn:function(){this.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,this.obj)},stepBtn:function(){game.module.show(game.ME.TPStepAward)},oneThrowBtn:function(){this.tpData.isNotThrow||this.tpData.isAutoThrow||this.cangBaoGeGridReq()},autoThrowBtn:function(){this.tpData.isNotThrow||(this.tpData.isAutoThrow?(this.tpData.isAutoThrow=!1,this.isAutoThrow=!1):(this.isAutoThrow=!0,this.cangBaoGeGridReq()),this.send(this.Evts.V_AUTO_THROW,this.tpData.isAutoThrow))},cangBaoGeGridReq:function(){var e=this;if(e.tpData.isCostProp&&0<e.tpData.getCostItemNum())return e.sender.CangBaoGeGridReq(1),void(e.isAutoThrow&&(e.tpData.isAutoThrow=!0));var t=e.tpData.currCfg;if(t){if(1==t.activityType){if(game.amount.get(game.AmountType.YUAN_BAO)<t.condition)return void game.notice.show(116);if(!e.isCostGold)return void game.alert.show({lang:9719,btn:game.Lang.get(9173),okcb:e.canCostGold,thisArg:e})}else if(e.tpData.cbgNum<1)return void game.notice.show(9710);e.isAutoThrow&&(e.tpData.isAutoThrow=!0),e.sender.CangBaoGeGridReq(0)}},canCostGold:function(){this.isCostGold=!0,this.isAutoThrow&&(this.tpData.isAutoThrow=!0,this.send(this.Evts.V_AUTO_THROW,this.tpData.isAutoThrow)),this.sender.CangBaoGeGridReq(0)},updateRankEnter:function(){this.tpData.checkRankEnter(),this.send(this.Evts.C2V_TP_ENTER)}}),t=[game.ME.TPAwardLogs],a=game.Sender.extends({ipc:function(){this.msg={CangBaoGeGridReq:this.cangBaoGeGridReq,CangBaoGePliesAwardsReq:this.cangBaoGePliesAwardsReq}},cangBaoGePliesAwardsReq:function(e){var t=game.pb.CangBaoGePliesAwardsRequest;t.pliesNum=e,this.write(t)},cangBaoGeGridReq:function(e){var t=game.pb.CangBaoGeGridRequest;t.types=e,this.write(t)}});b8e.module.registerControl(game.ME.TreasurePavilion,e,game.TreasurePavilionEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.TREASURE_PAVILION_AWARD,game.SAE.TREASURE_PAVILION)},ipc:function(){this.evts={TreasurePavilion:{C_UPDATE_STEP_AWARD:this.checkSpotAlert},OpenServer:{C2C_INIT_OPENSERVER:this.checkSpotAlert},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={CangBaoGeDayAwardsResp:this.cangBaoGeDayAwardsResp}},notify:function(e,t){switch(e){case this.Evts.V2C_REQ_GET_AWARD:this.sender.CangBaoGeDayAwardsReq(t)}},resetDaily:function(){game.treasurePavilionData.isActOpen()&&this.checkSpotAlert()},cangBaoGeDayAwardsResp:function(e){var t=e.readProtobuf(game.pb.CangBaoGeDayAwardsResponse);0<t.code?game.notice.noticeError(t.code):(game.treasurePavilionData.updateDayAward(t.stepNum),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_STEP_AWARD))},checkSpotAlert:function(){this.spotAlert.alert=game.treasurePavilionData.canGetStepAward()}}),t=game.Sender.extends({ipc:function(){this.msg={CangBaoGeDayAwardsReq:this.cangBaoGeDayAwardsReq}},cangBaoGeDayAwardsReq:function(e){var t=game.pb.CangBaoGeDayAwardsRequest;t.stepNum=e,this.write(t)}});b8e.module.registerControl(game.ME.TPStepAward,e,game.TreasurePavilionEvts,t)}(),function(){var e=game.View.extends({maxPos:15,ctor:function(){this._super(1049),this.spotAlerts={TREASURE_PAVILION_AWARD:this.stepAwardAlert}},init:function(){var e=this,t=e.skin;e.tpData=game.treasurePavilionData;var a,i,n=e.layerAwardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);n.itemRender=game.TPLayerItem,n.layout.spacingX=2,n.addToParent(t.layerList),n.bindEnum=game.ME.TreasurePavilion,n.setScrollViewCb(e.listCb,e),e.shaiziEffect=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.shaiziEffect.setSize(112,136),e.shaiziEffect.addToParent(e.skin.shaiziEffectNode),e.shaiziEffect.load(game.ResCfg.getUrl(5019,1065)),e.shaiziEffect.addFinishCallback(e.animaCB,e),e.shaiziEffect.active=!1,e.shaiziImgs=[];for(var s=0;s<6;s++)(a=b8e.Sprite.get()).setAnchor(.5,.5),a.setSize(112,136),i=game.ResCfg.getUrl(163,s+1),a.loadTexture(i),e.shaiziImgs.push(a);e.skin.shaiziNode.addChild(e.shaiziImgs[0]),e.awardItems=[],e.initAwardItems(),t.leftBtn.node.active=!1,t.rightBtn.node.active=!1,e.headIcon=b8e.Sprite.get(),e.headIcon.setAnchor(.5,.5),e.headIcon.setScale(.55,.55),e.headIcon.loadTexture(game.ResCfg.getHead(game.mainRoleData.isMale)),t.avatarNode.addChild(e.headIcon),e.setIcon()},stepAwardAlert:function(e){this.skin.red_spot_1.node.active=e.alert},animaCB:function(){this.shaiziEffect.active=!1},listCb:function(e,t,a){var i=this.skin,n=!1;n=0<e.length,i.leftBtn.node.active=n,n=0<a.length,i.rightBtn.node.active=n},scrollLeft:function(){this.layerAwardList.scrollContainerLeft()},scrollRight:function(){this.layerAwardList.scrollContainerRight()},starThrow:function(e){var t=this.awardItems[e-1];t&&(this.skin.avatarBg.x=t.x,this.skin.avatarBg.y=t.y),this.curPos=e,this.lastPos=e,1==this.tpData.cbgPos&&(this.tpData.isNotThrow=!0),this.playEffect()},playEffect:function(){var e=this;e.skin.shaiziNode.removeAllChildren(),e.skin.shaiziNode.node.active=!1,e.tpData.isSkipTween?e.timer1||(e.timer1=b8e.setTimeout(e.delayTime,e,500)):(e.shaiziEffect.active=!0,e.shaiziEffect.play(null,0),e.timer2||(e.timer2=b8e.setTimeout(e.showShaizi,e,1500)))},delayTime:function(){this.showShaizi(),this.timer1&&(b8e.clearTimeout(this.timer1),this.timer1=null)},showShaizi:function(){var e=this,t=1==e.tpData.cbgPos?e.maxPos-e.lastPos:e.tpData.cbgPos-e.lastPos-1;t<0&&(t=0);var a=e.shaiziImgs[t];if(e.skin.shaiziNode.node.active=!0,e.skin.shaiziNode.addChild(a),e.tpData.isSkipTween)return e.nextStep(),e.refreshView(),void(1==e.tpData.cbgPos&&e.updateNextLayer());e.refreshView(),e.tweenPos(),e.timer2&&(b8e.clearTimeout(e.timer2),e.timer2=null)},tweenPos:function(){var e=this;if(b8e.Tween.kill(e.skin.avatarBg),e.curPos!=e.tpData.cbgPos){var t,a=e.curPos+1;a>e.maxPos?(t=e.skin.endPoint,e.curPos=1):(e.curPos=a,t=e.awardItems[e.curPos-1]),t&&(b8e.Tween.get(e.skin.avatarBg).wait(100).to({x:t.x,y:t.y},150).call(e.tweenPos,e),b8e.Tween.get(e.skin.avatarBg).wait(100).to({y:t.y+10},75).to({y:t.y-10},75))}else{if(1==e.curPos)return void b8e.Tween.get(e.skin.avatarBg).wait(1e3).to({x:0,y:0},150).wait(500).call(e.updateNextLayer,e);e.nextStep()}},nextStep:function(){this.tpData.isAutoThrow&&this.tpData.checkThrowCondition()?this.send(this.Evts.V2C_AUTO_THROW):(this.tpData.isAutoThrow=!1,this.setAutoThrowBtnState(!1)),this.createPrize(),this.updateView()},updateNextLayer:function(){this.nextStep(),this.updateAwardItems(),this.tpData.isNotThrow=!1},createPrize:function(){var e=this.tpData.gridAwards;if(e){var t={};t.useritem={items:e},game.ServerItemUtil.analyzeItems(t,1)}},notify:function(e,t){var a=this;switch(e){case a.Evts.V_START_THROW:a.starThrow(t),a.updataLayerList();break;case a.Evts.V_SKIP_TWEEN:a.setSkipBtnState();break;case a.Evts.V_COST_PROP:a.setCostBtnState();break;case a.Evts.V_ScrollLeft:a.scrollLeft();break;case a.Evts.V_ScrollRight:a.scrollRight();break;case a.Evts.V_UPDATE_NUM:a.updateThrowNum();break;case a.Evts.V_UPDATE_PLIES_AWARD:a.updataLayerList();break;case a.Evts.V_AUTO_THROW:a.setAutoThrowBtnState(a.tpData.isAutoThrow,t);break;case a.Evts.C2V_TP_ENTER:a.skin.stepRankBtn.active=a.tpData.isShowRank;break;case a.Evts.C2V_UPDATE_VIEW:a.updataLayerList(),a.updateAwardItems(),a.updateView()}},onShow:function(){this.setSkipBtnState(),this.setCostBtnState(),this.updateView(),this.updataLayerList(),this.updateAwardItems(),this.setAutoThrowBtnState(!1),this.tpData.isAutoThrow=!1},onHide:function(){this.setAutoThrowBtnState(!1),this.tpData.isAutoThrow=!1,this.send(this.Evts.C2V_AUTO_STATE)},updateView:function(){var e=this,t=e.skin,a=e.tpData.cbgPlies||1,i=e.tpData.cbgPos;t.startNode.node.active=1==a,e.awardItems[0].node.active=1!=a,e.timer||(e.timer=b8e.Timer.add(e,e.updateActTime,1e3));var n=e.tpData.currCfg;if(n){1==n.activityType?t.descLab.string=game.Lang.get(9703):t.descLab.string=game.Lang.get(9702,n.condition),e.updateThrowNum(),e.refreshView();var s=e.awardItems[i-1];s&&(e.skin.avatarBg.x=s.x,e.skin.avatarBg.y=s.y),t.currencyNumLab1.string=game.itemData.getCountById(e.keyId),t.currencyNumLab2.string=game.itemData.getCountById(e.scoreId),t.layerLab.string=e.tpData.cbgPlies}},updateActTime:function(){var e=this.tpData.getCountDown();if(0<e){var t=b8e.TimeUtil.formatDayTime(e);this.skin.countDownLab.string=game.Lang.get(9704,t)}else b8e.Timer.remove(this,this.updateActTime),this.timer=null},updataLayerList:function(){var e=this.tpData.layerInfos;this.layerAwardList.setData(e)},initAwardItems:function(){for(var e=this.skin,t=void 0,a=0;a<15;a++)t=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_69),this.awardItems.push(t),a<1?t.setPosition(0,0):a<7?t.setPosition(72*(a-1),72):a<10?t.setPosition(360,72*(a-5)):t.setPosition(360-72*(a-9),288),t.addToParent(e.awardNode)},updateAwardItems:function(){for(var e=0;e<15;e++)this.tpData.getCurrCellAward(e+1,this._updateCfgCallback,this,e)},_updateCfgCallback:function(e,t){if(e.awards&&!(e.awards.length<1)){var a=e.awards[0],i=game.ItemInfoCfg.getData(a.Id),n=this.awardItems[t];n&&i&&(n.setItemInfo(i),n.setNum(a.Num))}},setSkipBtnState:function(){this.skin.check1.node.active=this.tpData.isSkipTween},setCostBtnState:function(){this.skin.check2.node.active=this.tpData.isCostProp},setAutoThrowBtnState:function(e){var t=this.skin;t.btnLab1.string=e?game.Lang.get(9706):game.Lang.get(9705)},updateThrowNum:function(){var e=this.skin,t=this.tpData.currCfg;t&&(1==t.activityType?(e.goldImg.node.active=!0,e.haveCountLab.string=t.condition,e.red_spot_2.node.active=e.red_spot_3.node.active=0<this.tpData.getCostItemNum()):(e.goldImg.node.active=!1,e.haveCountLab.string=game.Lang.get(9707,this.tpData.cbgNum),e.red_spot_2.node.active=e.red_spot_3.node.active=0<this.tpData.cbgNum||0<this.tpData.getCostItemNum()))},refreshView:function(){var e=this.skin;this.updateThrowNum();var t=this.tpData.getCostItemNum();e.costNumLab.string=t+"/1",e.costNumLab.node.color=0<t?game.Color.WHITE:game.Color.RED,e.todayStepLab.string=game.Lang.get(9708,this.tpData.cbgAllNum)},setIcon:function(){var e=this.skin,t="",a=b8e.Sprite.get(),i="";a.addToParent(e.currency1),a.setSize(40,40),a.setAnchor(.5,.5),(i=game.TreasurePavilionMiscCfg.getData("TPKeyId"))&&(this.keyId=+i.value,t=game.ResCfg.getUrl(137,this.keyId),a.loadTexture(t));var n=b8e.Sprite.get();if(n.addToParent(e.currency2),n.setSize(40,40),n.setAnchor(.5,.5),(i=game.TreasurePavilionMiscCfg.getData("TPScoreId"))&&(this.scoreId=+i.value,t=game.ResCfg.getUrl(137,this.scoreId),n.loadTexture(t)),i=game.TreasurePavilionMiscCfg.getData("cbgCostItems")){var s=game.GridUtil.createViewClickIcon(40);s.addToParent(e.costitemNode),s.setItemId(+i.value)}}});b8e.module.registerView(game.ME.TreasurePavilion,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1048)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.TPStepAwardItem,this._list.bindEnum=game.ME.TPStepAward,this._list.layout.paddingLeft=0,this._list.layout.spacingY=10,this._list.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.V_UPDATE_STEP_AWARD:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=game.treasurePavilionData,t=e.getStepAwardInfos();t&&(0<t.length&&this._list&&this._list.setData(t),this.skin.tips.string=game.Lang.get(9709,e.cbgDayNum))},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height)+50;this.setPosition(e,t)}});b8e.module.registerView(game.ME.TPStepAward,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1046)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.XunBaoLogItem,this._list.layout.paddingLeft=3,this._list.layout.paddingTop=10,this._list.layout.spacingY=5,this._list.addToParent(this.skin.listNode)},onShow:function(){this.updateView()},updateView:function(){var e=game.treasurePavilionData.ownLogs;this._list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height))}});b8e.module.registerView(game.ME.TPAwardLogs,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1047),this.setSize(68,92)},init:function(){var e=this.skin;this.awardItem=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_69),this.awardItem.addToParent(e.itemNode)},setData:function(e){var t=this.skin,a=(e=e).cfg;t.getNode.node.active=e.isGet,t.red_spot.node.active=e.isCanGet,t.layerLab.string=game.Lang.get(9524,a.pliesNum);var i=a.awards[0],n=i.Id,s=i.Num,r=game.ItemInfoCfg.getData(n);r&&(this.awardItem.setItemInfo(r),this.awardItem.setNum(s))},touchIcon:function(){this.data.isCanGet?this.send(game.TreasurePavilionEvts.V2C_GET_AWARD,this.data.cfg,1):this.send(game.TreasurePavilionEvts.V2C_GET_AWARD,this.data.cfg,2)}}),b8e.RC("$$game","$$TPLayerItem",e)}(),function(){var e;e=game.CSFBossTargetAwardItem.extends({btn_get:function(){this.data&&this.data.cfg&&this.send(game.TreasurePavilionEvts.V2C_REQ_GET_AWARD,this.data.cfg.num)}}),b8e.RC("$$game","$$TPStepAwardItem",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_COPY_CODE:-1,C2V_UPDATE_BACK:-1,C2V_RESET_DAILY:-1,C2V_UPDATE_INVITE_REWARD:-1,C2V_UPDATE_ACT_REWARD:-1,C2V_UPDATE_LOGIN_VIEW:-1,C2V_UPDATE_RECALL_VIEW:-1,C2V_GET_REGRESS_GIFT:-1,C2V_INVITE:-1,C2V_GET_INVITE_REWARD:-1,C2V_UPDATE_VIEW:-1,C2V_UPDATE_BACK_VIEW:-1,V_TOGGLECHANGE:-1,C_GET_GIFT_PACKAGE:-1,V2C_GET_SEVENLOGIN_REWARD:-1,C2C_RECHARGE:-1,C2C_UPDATE_COMRADEBACK:-1}),b8e.RC("$$game","$$RegressRewardEvts",e)}(),function(){var e=b8e.Object.extends({comradeBackCfg:null,recallId:0,isRecall:!1,inviteRoleId:0,loginDays:0,loginAwards:null,prizes:null,totalExp:0,surplusExp:0,isGetExp:!1,inviteNum:0,inviteAwardNum:0,inviteActiveTotalNum:0,inviteActiveDailyNum:0,maxInviteNum:0,isGetInviteReward:!1,isLoginOpen:!1,ctor:function(){this._super()},initData:function(){var e=game.RecallMiscCfg.getData("maxInviteNum");e&&(this.maxInviteNum=+e.value)},setup:function(e){var t=this;t.recallId=e.recallId,t.isRecall=e.isRecall,t.inviteRoleId=e.inviteRoleId,t.loginDays=e.recallLoginDays,t.loginAwards=e.recallLoginAwards,t.prizes=e.recallPrizes,t.totalExp=e.recallTotalExp,t.surplusExp=e.recallSurplusExp,t.isGetExp=e.recallGetExp,t.inviteNum=e.inviteNum,t.inviteAwardNum=e.inviteAwardNum,t.inviteActiveTotalNum=e.inviteActiveTotalNum,t.inviteActiveDailyNum=e.inviteActiveDailyNum,t.comradeBackCfg=t.getComradeBackCfg()},resetData:function(){this.inviteActiveDailyNum=0,this.isGetExp=!1},updateLoginAwards:function(e){this.loginAwards||(this.loginAwards=[]),-1<this.loginAwards.indexOf(e)||this.loginAwards.push(e)},updatePrizes:function(e){this.prizes||(this.prizes=[]);var t=game.RecallSaleCfg.getData(e);t&&(-1<this.prizes.indexOf(t.id)||this.prizes.push(t.id))},updateInviteData:function(e){this.inviteNum=e.inviteNum,this.inviteActiveTotalNum=e.inviteActiveTotalNum},checkIsOpen:function(e){var t=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),a=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),i=game.SysTime.curTime;return t<=i&&i<=a},getComradeBackCfg:function(){var e=game.RecallOpenCfg.getDatas();if(!e||e.length<1)return null;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.checkIsOpen(i))return i}return null},isComradeBackOpen:function(){return!!this.getComradeBackCfg()},isRegressActOpen:function(){return this.isComradeBackOpen()&&this.isRecall},checkOutLine:function(){return this.isRecall&&(!this.inviteRoleId||this.inviteRoleId<=0)},getCountDown:function(){if(!this.comradeBackCfg)return 0;var e=game.SysTime.curTime;return b8e.TimeUtil.dateParse(this.comradeBackCfg.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()-e},canGetSevenLoginReward:function(){var e=game.RecallLoginCfg.getDatas();if(!e||e.length<1)return!1;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.loginDays>=i.day&&(!this.loginAwards||this.loginAwards.indexOf(i.day)<=-1))return!0}return!1},canGetInviteReward:function(){return!(this.inviteAwardNum>=this.maxInviteNum)&&this.inviteNum>this.inviteAwardNum},canGetScoreReward:function(){return!(this.inviteActiveDailyNum>=this.maxInviteNum)&&0<this.inviteActiveTotalNum},canGetRecallReward:function(){var e=game.RecallMiscCfg.getData("activePoint");return!!e&&(!this.isGetExp&&game.dailyExploitData.experienceExpDaily>=+e.value)},getSevenLoginList:function(){var e=game.RecallLoginCfg.getDatas();if(!e||e.length<1)return null;this.slList=[];for(var t=void 0,a=e.length,i=void 0,n=0;n<a;n++)i=e[n],(t=new game.MillionsLoginItemInfo).setConfig(i),this.loginAwards&&-1<this.loginAwards.indexOf(i.day)?(t.isGetPrize=!0,t.canGetPrize=!1):(t.isGetPrize=!1,t.canGetPrize=this.loginDays>=i.day),this.slList.push(t);return this.slList.sort(this.sortHandler),this.slList},sortHandler:function(e,t){return e.isGetPrize==t.isGetPrize?e.canGetPrize==t.canGetPrize?e.config.day-t.config.day:e.canGetPrize?-1:1:e.isGetPrize?1:t.isGetPrize?-1:void 0},getRegressGiftList:function(){var e=game.RecallSaleCfg.getDatas();if(!e||e.length<1)return null;this.rgList=[];for(var t=0,a=e.length,i=void 0,n=void 0;t<a;t++)(i=e[t])&&((n=new game.CSArenaScoreInfo).cfg=i,n.score=this.loginDays,n.labelId=9823,this.prizes&&-1<this.prizes.indexOf(n.cfg.id)?n.isGet=!0:n.isGet=!1,this.rgList.push(n));return this.rgList}});game.regressRewardData=game.regressRewardData||new e}(),function(){var e=game.Control.extends({init:function(){game.regressRewardData.initData(),this.moduleData=game.regressRewardData,this.spotAlert=game.spotAlert.set(game.SAE.COMRADE_BACK)},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily,C_INIT_MSIC_DATA:this.checkSpotAlert}},this.handels={InviteAwardResp:this.inviteAwardResp,InviteActiveResp:this.inviteActiveResp,InviteUpdateMsg:this.inviteUpdateNotify}},checkSpotAlert:function(){this.spotAlert.alert=this.moduleData.canGetInviteReward()||this.moduleData.canGetScoreReward()},inviteAwardResp:function(e){var t=e.readProtobuf(game.pb.InviteAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.inviteAwardNum++,this.checkSpotAlert(),this.send(this.Evts.C2V_UPDATE_INVITE_REWARD))},inviteActiveResp:function(e){var t=e.readProtobuf(game.pb.InviteActiveResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.inviteActiveDailyNum++,this.moduleData.inviteActiveTotalNum--,this.checkSpotAlert(),this.send(this.Evts.C2V_UPDATE_ACT_REWARD))},inviteUpdateNotify:function(e){var t=e.readProtobuf(game.pb.InviteUpdateNotify);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateInviteData(t),this.checkSpotAlert(),this.send(this.Evts.V2C_GET_SEVENLOGIN_REWARD))},resetDaily:function(){this.moduleData.isComradeBackOpen()?(this.moduleData.resetData(),this.checkSpotAlert(),this.send(this.Evts.C2V_RESET_DAILY)):game.module.hide(game.ME.ComradeBack)},copyBtn:function(){this.send(this.Evts.C2V_COPY_CODE)},ruleBtn:function(){game.RuleView.inst().showView(game.ME.ComradeBack)},btn_get1:function(){this.sender.InviteAwardReq()},btn_get2:function(){this.sender.InviteActiveReq()}}),t=game.Sender.extends({ipc:function(){this.msg={InviteAwardReq:null,InviteActiveReq:null}}});b8e.module.registerControl(game.ME.ComradeBack,e,game.RegressRewardEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.regressRewardData,this.sevenLoginSpot=game.spotAlert.set(game.SAE.SEVEN_LOGIN,game.SAE.REGRESS_ACTIVITY),this.recallSpot=game.spotAlert.set(game.SAE.RECALL,game.SAE.REGRESS_ACTIVITY)},ipc:function(){var e=this;e.evts={Recharge:{C_RECALL_PRIZE:e.rechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily,C_INIT_MSIC_DATA:e.checkAllAlert},DailyExploit:{C_DAILYEXPLOIT_EXP:e.checkAllAlert},DailyFuLi:{C_INIT_MODULE:e.checkAllAlert}},e.handels={RecallLoginResp:e.recallLoginResp,RecallAwardResp:e.recallAwardResp,RecallExpResp:e.recallExpResp}},resetDaily:function(){this.moduleData.isRegressActOpen()?(this.moduleData.loginDays++,this.moduleData.resetData(),this.checkRecallSpot(),this.send(this.Evts.C2V_UPDATE_VIEW)):game.module.hide(game.ME.RegressActivity)},checkAllAlert:function(){this.checkSevenLoginSpot(),this.checkRecallSpot(),this.moduleData.checkOutLine()&&this.moduleData.isRegressActOpen&&!this.moduleData.isLoginOpen&&(this.moduleData.isLoginOpen=!0,game.module.showToggle(game.ME.RegressActivity,3))},recallLoginResp:function(e){var t=e.readProtobuf(game.pb.RecallLoginResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateLoginAwards(t.day),this.checkSevenLoginSpot(),this.send(this.Evts.C2V_UPDATE_LOGIN_VIEW))},rechargeSuccess:function(){this.send(this.Evts.C2V_GET_REGRESS_GIFT)},recallAwardResp:function(e){var t=e.readProtobuf(game.pb.RecallAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.isGetInviteReward=!0,this.moduleData.inviteRoleId=t.roleId,this.send(this.Evts.C2V_GET_INVITE_REWARD),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))},recallExpResp:function(e){var t=e.readProtobuf(game.pb.RecallExpResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.isGetExp||(this.moduleData.isGetExp=!0,this.moduleData.surplusExp=t.exp),this.checkRecallSpot(),this.send(this.Evts.C2V_UPDATE_RECALL_VIEW))},notify:function(e,t){switch(e){case this.Evts.C_GET_GIFT_PACKAGE:this.buyGiftPackage(t);break;case this.Evts.C2V_INVITE:var a=parseInt(t);this.sender.RecallAwardReq(a);break;case this.Evts.V2C_GET_SEVENLOGIN_REWARD:this.sender.RecallLoginReq(t)}},sevenLoginBtn:function(){this.selectToggle(0)},regressGiftBtn:function(){this.selectToggle(1)},recallBtn:function(){this.selectToggle(2)},inviteGiftBtn:function(){this.selectToggle(3)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)},buyGiftPackage:function(e){-1<this.moduleData.prizes.indexOf(e)||this.dpt(this.Evts.C2C_RECHARGE,e)},getInviteRewBtn:function(){this.send(this.Evts.C2V_INVITE)},recallRewBtn:function(){this.moduleData.canGetRecallReward()?this.sender.RecallExpReq():game.notice.show(9840)},checkSevenLoginSpot:function(){this.sevenLoginSpot.alert=this.moduleData.canGetSevenLoginReward()},checkRecallSpot:function(){this.recallSpot.alert=this.moduleData.canGetRecallReward()}}),t=[game.ME.SevenLogin,game.ME.RegressGift,game.ME.Recall,game.ME.InviteGift],a=game.Sender.extends({ipc:function(){this.msg={RecallLoginReq:this.recallLoginReq,RecallAwardReq:this.recallAwardReq,RecallExpReq:null}},recallLoginReq:function(e){var t=game.pb.RecallLoginRequest;t.day=e,this.write(t)},recallAwardReq:function(e){var t=game.pb.RecallAwardRequest;t.roleId=e,this.write(t)}});b8e.module.registerControl(game.ME.RegressActivity,e,game.RegressRewardEvts,a,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(913)},init:function(){var e=this.skin;this.moduleData=game.regressRewardData,e.banner1.loadTexture(game.ResCfg.getImgUrl("regressReward/banner1_1",!0)),e.banner2.loadTexture(game.ResCfg.getImgUrl("regressReward/banner1_2",!0));var t=this.list1=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.ShowItemListItem,t.addToParent(e.list1),t.layout.spacingX=15;var a=this.list2=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.ShowItemListItem,a.addToParent(e.list2),a.layout.spacingX=15},notify:function(e){var t=this;switch(e){case t.Evts.C2V_COPY_CODE:t.copyStr();break;case t.Evts.C2V_RESET_DAILY:t.updateActReward();break;case t.Evts.C2V_UPDATE_INVITE_REWARD:t.updateInviteReward();break;case t.Evts.C2V_UPDATE_ACT_REWARD:t.updateActReward();break;case t.Evts.V2C_GET_SEVENLOGIN_REWARD:case t.Evts.C2V_UPDATE_ACT_REWARD:t.updateView()}},onShow:function(){this.skin.codeLab.string=game.mainRoleData.roleId,this.updateView()},updateView:function(){this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3)),this.updateInviteReward(),this.updateActReward(),this.updateReward()},updateReward:function(){var e=this.moduleData.comradeBackCfg;if(e){var t=game.CfgUtil.getPrizeListInfo(e.inviteAward);t&&this.list1.setData(t.items);var a=game.CfgUtil.getPrizeListInfo(e.activeAward);a&&this.list2.setData(a.items)}},updateInviteReward:function(){var e=this.skin,t=this.moduleData.inviteNum;t>this.moduleData.maxInviteNum&&(t=this.moduleData.maxInviteNum),e.inviteNumLab.string=game.Lang.get("9830",t,this.moduleData.maxInviteNum),this.moduleData.canGetInviteReward()?(e.btn_get1.node.active=!0,e.btn_no_get1.node.active=!1):(e.btn_get1.node.active=!1,e.btn_no_get1.node.active=!0)},updateActReward:function(){var e=this.skin;this.moduleData.canGetScoreReward()?(e.btn_get2.node.active=!0,e.btn_no_get2.node.active=!1):(e.btn_get2.node.active=!1,e.btn_no_get2.node.active=!0)},copyStr:function(){game.CCommonUtil.setClipboardData(this.skin.codeLab.string)},updateActTime:function(){var e=this.moduleData.getCountDown();if(0<e){var t=b8e.TimeUtil.formatDayTime(e);this.skin.countDownLab.string=game.Lang.get(9704,t)}else b8e.Timer.remove(this,this.updateActTime),this.timer=null},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.ComradeBack,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(917),this.toggles={toggle_btn_1:game.ME.SevenLogin,toggle_btn_2:game.ME.RegressGift,toggle_btn_3:game.ME.Recall,toggle_btn_4:game.ME.InviteGift},this.spotAlerts={SEVEN_LOGIN:this.checkSlAlert,RECALL:this.checkRecallAlert}},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleTrigger(t)}},checkSlAlert:function(e){this.skin.red_spot_1.node.active=e.alert},checkRecallAlert:function(e){this.skin.red_spot_3.node.active=e.alert},onShow:function(){this.toggleTrigger(0)},toggleTrigger:function(e){this.toggleSelect(e)}});b8e.module.registerView(game.ME.RegressActivity,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(918)},init:function(){var e=this.skin;e.banner.loadTexture(game.ResCfg.getImgUrl("regressReward/banner_2",!1)),this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.RSSevenLoginItem,this._list.bindEnum=game.ME.RegressActivity,this._list.layout.paddingLeft=0,this._list.layout.spacingY=10,this._list.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:case this.Evts.C2V_UPDATE_LOGIN_VIEW:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.regressRewardData.getSevenLoginList();0<t.length&&this._list&&this._list.setData(t),e.descLab.string=game.Lang.get(9824),this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3))},updateActTime:function(){var e=game.regressRewardData.getCountDown();if(0<e){var t=b8e.TimeUtil.formatDayTime(e);this.skin.countDownLab.string=game.Lang.get(9704,t)}else b8e.Timer.remove(this,this.updateActTime),this.timer=null},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.SevenLogin,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(918)},init:function(){var e=this.skin;e.banner.loadTexture(game.ResCfg.getImgUrl("regressReward/banner_3",!0)),this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.RAGiftPackageItem,this._list.bindEnum=game.ME.RegressActivity,this._list.layout.paddingLeft=0,this._list.layout.spacingY=10,this._list.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_GET_REGRESS_GIFT:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=game.regressRewardData.getRegressGiftList();0<e.length&&this._list&&this._list.setData(e),this.skin.descLab.string=game.Lang.get(9825),this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3))},updateActTime:function(){var e=game.regressRewardData.getCountDown();if(0<e){var t=b8e.TimeUtil.formatDayTime(e);this.skin.countDownLab.string=game.Lang.get(9704,t)}else b8e.Timer.remove(this,this.updateActTime),this.timer=null},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.RegressGift,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(916)},init:function(){var e=this.skin;e.bg.loadTexture(game.ResCfg.getImgUrl("regressReward/bg_1",!1)),this._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._prizeList.itemRender=game.ShowItemListItem,this._prizeList.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:case this.Evts.C2V_UPDATE_RECALL_VIEW:this.updateView()}},onShow:function(){this.updateView(),this.updateRewards()},updateView:function(){var e=this.skin,t=game.regressRewardData;this.getExp=t.totalExp-t.surplusExp;var a=0;0<t.totalExp&&(a=t.surplusExp/t.totalExp),e.exp_ball_1.node.height=305*a,e.expLab.string=game.Lang.get("9826",t.surplusExp),e.percentageLab.string=Math.floor(100*a)+"%",e.actLab.string=game.Lang.get("9827",game.dailyExploitData.experienceExpDaily);var i=game.RecallMiscCfg.getData("activePoint");i&&(e.actLimitLab.string=game.Lang.get("9828",i.value)),e.recallRewBtn.node.active=!t.isGetExp,e.getLab.node.active=t.isGetExp,this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3)),this.updateActTime()},updateRewards:function(){var e=game.regressRewardData,t=[],a=e.comradeBackCfg;if(a){for(var i=a.recallActiveAward,n=0;n<i.length;n++)t.push(i[n]);if(0<e.surplusExp){var s={Id:"220001",Num:Math.floor(.2*e.totalExp)};t.push(s)}var r=game.CfgUtil.getPrizeListInfo(t);this._prizeList.setData(r.items)}},updateActTime:function(){var e=game.regressRewardData.getCountDown();if(0<e){var t=b8e.TimeUtil.formatDayTime(e);this.skin.countDownLab.string=game.Lang.get(9704,t)}else b8e.Timer.remove(this,this.updateActTime),this.timer=null},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.Recall,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(914)},init:function(){var e=this.skin;e.bg.loadTexture(game.ResCfg.getImgUrl("regressReward/bg_2",!0)),this._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._prizeList.itemRender=game.ShowItemListItem,this._prizeList.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_INVITE:this.getInviteReward();break;case this.Evts.C2V_GET_INVITE_REWARD:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.regressRewardData,a=t.comradeBackCfg;if(a){var i=a.recallAward,n=game.CfgUtil.getPrizeListInfo(i);this._prizeList.setData(n.items),t.inviteRoleId&&0<t.inviteRoleId?(e.getNode.node.active=!1,e.getLab.node.active=!0):(e.getNode.node.active=!0,e.getLab.node.active=!1)}},getInviteReward:function(){var e=this.skin;e.codeInput.string!=game.mainRoleData.roleId?""!=e.codeInput.string?this.send(this.Evts.C2V_INVITE,e.codeInput.string):game.notice.show(9841):game.notice.show(9837)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.InviteGift,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(915),this.setSize(550,220)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=15,e.layout.spacingY=5},setData:function(e){var t=this.skin,a=(e=e,this.data.cfg),i=e.getPrizeList();this.prizeList.setData(i),t.btn_isGet.node.active=e.isGet,t.btn_get.node.active=!e.isGet,t.lab_content.string=a.name,t.oldMoney.string=game.Lang.get("9829",a.originalPrice),t.nowMoney.string=game.Lang.get("9829",a.currentPrice)},btn_get:function(){this.data&&this.data.cfg&&this.send(game.RegressRewardEvts.C_GET_GIFT_PACKAGE,this.data.cfg.rechargeId)}}),b8e.RC("$$game","$$RAGiftPackageItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(719),this.setSize(550,145)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prize),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=-10},setData:function(e){var t=this.skin,a=(e=e,this.data.config),i=a.day;if(a){var n=game.regressRewardData.loginDays;t.level.string=game.Lang.get(6631,i);var s=e.getPrizeItems();this.prizeList.setData(s),i<=n?(e.isGetPrize?(t.getBtn.active=!1,t.isGetImg.active=!0):(t.getBtn.active=!0,t.isGetImg.active=!1),t.cantGetLbl.active=!1):(t.cantGetLbl.active=!0,t.cantGetLbl.string=game.Lang.get(6637,n,i),t.getBtn.active=!1,t.isGetImg.active=!1)}},getBtn:function(){this.data&&this.data.config&&this.send(game.RegressRewardEvts.V2C_GET_SEVENLOGIN_REWARD,this.data.config.day)}}),b8e.RC("$$game","$$RSSevenLoginItem",e)}(),function(){var e;e=b8e.Enum({None:0,C_GET_AWARD:b8e.enc(),C_CHANGEITEM_SELECT:b8e.enc(),V_CHANGEITEM_SELECT:b8e.enc(),RECHARGE_SUCCESS:b8e.enc(),STICK_COMPLETE:b8e.enc(),C2V_UPDATA_VIEW:b8e.enc()}),b8e.RC("$$game","$$IncenseEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,money:0,cfg:null,type:0,sortId:0,select:!1,isTemple:!1,isRecharge:!1,setCfgData:function(e){this.id=e.templeId,this.money=e.money,this.sortId=e.sortId,this.cfg=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$IncenseInfo",e)}(),function(){var e;e=b8e.Object.extends({condition:0,award:null,canGet:!1,isGet:!1,setCfgData:function(e){this.condition=e.condition,this.award=e.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$IncenseAwardInfo",e)}(),function(){var e=b8e.Object.extends({openActiveId:0,selectId:0,ctor:function(){this.stickMap=b8e.HashMap.get(),this.awardMap=b8e.HashMap.get(),this.top=[],this.bottom=[],this.award=[]},initData:function(){this.top=[],this.bottom=[];for(var e=game.TempleCfg.getDatas(),t=void 0,a=void 0,i=0,n=e.length;i<n;i++)(t=e[i])&&t.pfType==game.rechargeData.pfType&&((a=this.stickMap.get(t.money))||(a=new game.IncenseInfo).setCfgData(t),this.stickMap.set(t.money,a),t.type?this.top.push(a):this.bottom.push(a),this.selectId||(a.select=!0,this.selectId=a.money))},initAwardData:function(){this.award=[];for(var e=game.TempleAwardCfg.getDatas(),t=void 0,a=void 0,i=0,n=e.length;i<n;i++)(t=e[i])&&((a=this.awardMap.get(t.condition))||(a=new game.IncenseAwardInfo).setCfgData(t),this.awardMap.set(t.condition,a),this.award.push(a))},setData:function(e){for(var t=e.temple,a=void 0,i=void 0,n=0,s=t.length;n<s;n++)if(a=t[n]){if(!(i=this.getInfoById(a.money)))return;i.isRecharge=!0,i.isTemple=0<a.count}for(var r=e.templeAwards,o=void 0,g=0,u=r.length;g<u;g++)(o=r[g])&&(i=this.getAwardById(o))&&(i.isGet=!0)},setRecharge:function(e){var t=this.getInfoById(e);t&&(t.isTemple=!0,t.isRecharge=!0)},setTemple:function(e){for(var t=this.stickMap.values(),a=void 0,i=0,n=t.length;i<n;i++)(a=t[i])&&e.templeId==a.id&&(a.type=e.templeType,a.isTemple=!1,this.selectId=a.money)},setAward:function(e){var t=this.getAwardById(e.id);t&&(t.isGet=!0,t.canGet=!1)},selectInfoById:function(e){var t=this.getInfoById(this.selectId),a=this.getInfoById(e);t&&(t.select=!1),a.select=!0,this.selectId=e},getTopList:function(){return this.top.sort(this.onSort),this.top},getBottomList:function(){return this.bottom.sort(this.onSort),this.bottom},getAwardList:function(){return this.award.sort(this.sortAward),this.award},getInfoById:function(e){return this.stickMap.get(e)},getCurInfo:function(){return this.getInfoById(this.selectId)},getAwardById:function(e){return this.awardMap.get(e)},onSort:function(e,t){return e.sortId-t.sortId},sortAward:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.condition-t.condition},checkAward:function(){var e=this.stickMap.values(),t=0;e.forEach(function(e){e.isRecharge&&t++},this),0!=t&&this.getAwardList().forEach(function(e){e.isGet||(e.canGet=t>=e.condition)},this)},checkOpenTime:function(){for(var e=game.TempleOpenCfg.getDatas(),t=game.miscData.openServerDay,a=void 0,i=this.openActiveId=0,n=e.length;i<n;i++){if(!(a=e[i]))return;if(!(a.serverStart>t||a.serverEnd<t)&&!(b8e.TimeUtil.dateParse(a.startTime,"yyyy-MM-dd  hh:mm:ss").getTime()>game.SysTime.curTime||b8e.TimeUtil.dateParse(a.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()<game.SysTime.curTime)){this.openActiveId=a.id;break}}return 0!=this.openActiveId},checkTemple:function(){var e=this.stickMap.values(),t=0;return e.forEach(function(e){e.isTemple&&t++},this),0<t},checkCanGetAward:function(){var t=0;return this.getAwardList().forEach(function(e){e.canGet&&t++},this),0<t}});game.incenseData=game.incenseData||new e}(),function(){var e=game.FestivalItemCtrl.extends({init:function(){this._super(),this.spotAlert=game.spotAlert.set(game.SAE.INCENSE_ALERT),this.data=game.incenseData},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess},OpenServer:{C2C_INIT_OPENSERVER:this.syncData}},this.handels={TempleResp:this.onTempleResp,TempleAwardResp:this.onTempleAwardResp}},syncData:function(e){if(e&&e.data){var t=e.data;this.initServerData(),this.data.setData(t),this.checkAlert()}},initServerData:function(){this.data.checkOpenTime()&&(this._initData||(this._initData=!0,this.data.initData(),this.data.initAwardData()))},notify:function(e,t){switch(e){case this.Evts.V_CHANGEITEM_SELECT:if(t==game.incenseData.selectId)return;game.incenseData.selectInfoById(t),this.send(this.Evts.C2V_UPDATA_VIEW);break;case this.Evts.C_GET_AWARD:this.sender.TempleAwardReq(t.condition)}},onTempleResp:function(e){var t=e.readProtobuf(game.pb.TempleResponse);0<t.code?game.notice.noticeError(t.code):(game.incenseData.setTemple(t),game.module.show(game.ME.IncensePrize),this.checkAlert(),this.send(this.Evts.C2V_UPDATA_VIEW))},onTempleAwardResp:function(e){var t=e.readProtobuf(game.pb.TempleAwardResponse);0<t.code?game.notice.noticeError(t.code):(game.incenseData.setAward(t),this.checkAlert(),this.send(this.Evts.C2V_UPDATA_VIEW))},resetDaily:function(){if(game.moduleOpen.checkOpen(this.moduleEnum)){var e=this.data.checkOpenTime();if(e){this.initServerData();var t={openServerType:game.OpenServerType.TEMPLE,isActive:e,sae:game.SAE.INCENSE_ALERT};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,t)}}},rechargeSuccess:function(e){if(e&&e.data){var t=game.RechargeCfg.getDataById(e.data.id);game.incenseData.setRecharge(t.money),this.checkAlert(),this.send(this.Evts.C2V_UPDATA_VIEW)}},checkAlert:function(){if(game.incenseData.checkAward(),this.data.checkOpenTime()){var e=this.data.checkTemple(),t=this.data.checkCanGetAward();this.spotAlert.alert=e||t}},LotsBtn:function(){var e=game.incenseData.getCurInfo();e.isTemple&&this.sender.TempleReq(e.id)},awardBtn:function(){game.module.show(game.ME.IncenseAward)}}),t=[game.ME.IncensePrize,game.ME.IncenseAward],a=game.Sender.extends({ipc:function(){this.msg={TempleReq:this.templeReq,TempleAwardReq:this.templeAwardReq}},templeReq:function(e){var t=game.pb.TempleRequest;t.templeId=e,this.write(t)},templeAwardReq:function(e){var t=game.pb.TempleAwardRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.Incense,e,game.IncenseEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(603),this.setSize(136,194)},init:function(){var e=this.icon=b8e.Sprite.get();e.addToParent(this.skin.icon),e.setAnchor(.5,.5)},setData:function(e){var t=this.skin;t.check_select.active=e.select;var a=game.RechargeCfg.getDataById(e.cfg.rechargeId),i=game.ResCfg.getUrl(98,a.icon);this.icon.loadTexture(i);var n=e.isTemple?9818:9819;t.title.string=game.Lang.get(n,e.cfg.money),t.cantGetBtn.active=!e.isTemple,t.shangxiang.node.active=e.isTemple,t.redPoint.node.active=e.isTemple},cantGetBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)},clickBtn:function(){this.send(game.IncenseEvts.V_CHANGEITEM_SELECT,this.data.money)}}),b8e.RC("$$game","$$IncenseItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(604)},init:function(){var e=this.skin,t=this.topList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.IncenseItem,t.bindEnum=this.moduleEnum,t.layout.paddingTop=-3,t.layout.spacingX=3,t.addToParent(e.topScroll);var a=this.bottomList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.IncenseItem,a.bindEnum=this.moduleEnum,a.layout.paddingTop=-3,a.layout.spacingX=3,a.addToParent(e.bottomScroll)},notify:function(e){game.IncenseEvts;switch(e){case this.Evts.C2V_UPDATA_VIEW:this.updataList(),this.updataPage()}},onShow:function(){this.updataList(),this.updataPage()},updataList:function(){var e=game.incenseData.getTopList();this.topList.setData(e);var t=game.incenseData.getBottomList();this.bottomList.setData(t)},updataPage:function(){var e=this.skin,t=game.incenseData.getCurInfo(),a=game.TempleCfg.getData(t.id),i=t.isTemple?9821:9822;e.basicMoney.string=game.Lang.get(9820,a.moneyBase),e.countLab.string=game.Lang.get(i),e.noLotsBtn.active=!t.isTemple,e.LotsBtn.active=t.isTemple,e.redPoint.active=game.incenseData.checkCanGetAward(),e.desc.string=game.Lang.get(9838)}});b8e.module.registerView(game.ME.Incense,e)}(),function(){var e=game.LotPrize.extends({onShow:function(){this._super(),this.skin.model.setPosition(345,-644)},initView:function(){var e=this.skin,t=game.incenseData.getCurInfo(),a=game.TempleRateCfg.getData(t.id,t.type);if(a){var i=a.multiple.toFixed(1);e.multiple.string=i,this.model.loadTexture(game.ResCfg.getUrl(247,a.templeType));var n=game.TempleCfg.getData(t.id),s=game.ItemInfoCfg.getData(21);this.itemIcon.setItemInfo(s),this.itemIcon.setNum(n.moneyBase*i,null,null,!1)}}});b8e.module.registerView(game.ME.IncensePrize,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(601),this.setSize(550,135)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.ShowItemListItem,this.awardList.layout.paddingLeft=0,this.awardList.layout.paddingRight=0,this.awardList.layout.paddingTop=0,this.awardList.layout.spacingX=5,this.awardList.addToParent(this.skin.prizeList)},clearData:function(){this.awardList&&this.awardList.clear()},setData:function(e){var t=this.skin;this.data=e,t.getBtn.active=e.canGet&&!e.isGet,t.already_got.active=e.isGet,t.noGetBtn.active=!e.canGet&&!e.isGet,t.lbl_title.string=game.Lang.get(9835,e.condition);var a=game.CfgUtil.getPrizeListInfo(e.award);this.awardList.setData(a.items)},getBtn:function(){this.data.canGet&&this.send(game.IncenseEvts.C_GET_AWARD,this.data)}}),b8e.RC("$$game","$$IncenseAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(602)},init:function(){this.skin;this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.IncenseAwardItem,this.list.addToParent(this.skin.scrollView),this.list.bindEnum=game.ME.Incense,this.list.layout.spacingY=10},notify:function(e){switch(e){case this.Evts.C2V_UPDATA_VIEW:this.updataList()}},onShow:function(){this.skin.path.string=game.Lang.get(9836),this.updataList()},updataList:function(){var e=game.incenseData.getAwardList();this.list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),.5*(t+this.height)+50)}});b8e.module.registerView(game.ME.IncenseAward,e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super()},getElementInfo:function(){return this.elementInfo},setElementInfo:function(e,t,a,i){this.elementInfo||(this.elementInfo={});var n=this.elementInfo;n.element=e,n.langId=t,n.pos=a,n.isBottom=i}});game.elementData=game.elementData||new e}(),function(){var e=game.Control.extends({});b8e.module.registerControl(game.ME.ElementAttr,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1231)},init:function(){var e=game.ResCfg.getUrl(10047);this.skin.element_bg.loadTexture(e);this._moduleNode=b8e.Graphics.get(),this._moduleNode.setAnchor(0,0),this._moduleNode.setLocalZOrder(-11e3),this._moduleNode.addToParent(this),b8e.evt.onC(this._moduleNode,this.onTouchNode,this)},onTouchNode:function(){game.module.hide(this.moduleEnum)},onShow:function(){var e=this.skin,t=this.elementInfo=game.elementData.getElementInfo();if(t){var a=void 0;switch(t.element){case 1:a=50346;break;case 2:a=50347;break;case 3:a=50348;break;case 4:a=52222}var i=game.Lang.get(t.langId);e.title.string=game.Lang.get(a,i)}},onStageResize:function(){var e=this,t=b8e.stageWidth,a=game.elementData.getElementInfo();if(a){var i=a.pos,n=i.x,s=i.y;a.isBottom&&(s+=e.height),e.setPosition(n,s);var r=b8e.stageHeight,o=e.width,g=e.height;if(e._moduleNode){var u=t-o>>1,l=r-g>>1,c=a.isBottom?e.y-e.height:e.y;e._moduleNode.setPosition(-e.x,-c),e._moduleNode.fillColor(0),e._moduleNode.setSize(t,r),e._moduleNode.fillRect(-u,-l,t+u,r+l)}}}});b8e.module.registerView(game.ME.ElementAttr,e)}(),function(){var e;e=b8e.Enum({NOME:0,PET:1}),b8e.RC("$$game","$$RewarderType",e)}(),function(){var e;e=b8e.Enum({C2V_UPDATE_VIEW:b8e.enc(),C2V_UPDATE_TIME:b8e.enc(),C2V_UPDATE_LIST_DATA:b8e.enc(),V2C_SELECT_UPDATE:b8e.enc(),C2V_UPDATE_CHOOSE:b8e.enc(),C_ITEM_BATTLE:b8e.enc(),C_SELECT_SLOT_CHANGE:b8e.enc(),C2V_SELECT_SLOT_CHANGE:b8e.enc(),C_SELECT_OK:b8e.enc(),C_UPDATE_VIEW:b8e.enc(),V2C_UPDATE_VIEWDATA:b8e.enc(),DPT_UPDATE_CHOOSE:b8e.enc(),V2C_UPDATE_ALERT:b8e.enc()}),b8e.RC("$$game","$$RewarderEvts",e)}(),function(){var e=b8e.Object.extends({selectList:null,level:0,progress:0,remainingTime:0,refreshCount:0,id:0,selectId:0,totalTimes:0,ctor:function(){this.selectList={water:[],fire:[],wind:[],soil:[]},this.battleArr=[],this.allRewarderMp=b8e.HashMap.get(),this.rewarderMp=b8e.HashMap.get(),this.elementMp=b8e.HashMap.get(),this.battleMp=b8e.HashMap.get(),this.lvQualityMp=b8e.HashMap.get()},initData:function(){this.setLvinfo()},initial:function(e){if(e){this.level=e.level,this.progress=e.progress,this.refreshCount=e.refreshCount;var t=game.SysTime.unixTime;this.endTime=e.remainingTime+t,this.totalTimes=e.totalTimes}},setUp:function(e){if(e){var t=void 0,a=void 0,i=e.quests.length;if(this.level=e.level,this.progress=e.progress,i)for(var n=0;n<i;n++)a=e.quests[n],(t=this.rewarderMp.get(a.id))||((t=new game.RewarderItemInfo).units=a.units,t.setData(a),this.rewarderMp.set(a.id,t))}},updateRewarderData:function(e){this.rewarderMp.clear();var t=e.length;if(t)for(var a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=this.rewarderMp.get(a.id))||((i=new game.RewarderItemInfo).units=a.units,i.setData(a),this.rewarderMp.set(a.id,i))},setUpRewarder:function(e){var t=this.rewarderMp.get(e);if(t)for(var a=void 0,i=t.units.length,n=0;n<i;n++)a=t.units[n],this.updatetElementMp(!1,a.id)},setInitUnits:function(){var e=this.getRewarderItemlist();if(e)for(var t=e.length,a=void 0,i=0;i<t;i++)0<(a=e[i]).units.length&&this.setActive(a.units)},setLvinfo:function(){for(var e=void 0,t=0;t<game.Quality.Q_COLORFUL;t++)(e=this.lvQualityMp.get(t))||((e=new game.RewarderLvInfo).quality=t,this.lvQualityMp.set(t,e))},stringType:function(e,t){var a=void 0,i=void 0;switch(e){case 1:a=game.Lang.get(50398),i=51917;break;case 2:a=game.Lang.get(50399),i=51918;break;case 3:a=game.Lang.get(50400),i=51919;break;case 4:a=game.Lang.get(50401),i=51920;break;case 5:a=game.Lang.get(50402),i=51921;break;case 6:a=game.Lang.get(50403),i=51922}return t?i:a},isUpdate:function(){var e=game.rewarderData.getRewarderItemlist();if(!e)return!1;for(var t=0;t<e.length;t++)if(!e[t].active)return!1;return!0},getLvinfo:function(e){return this.lvQualityMp.get(e)},getIsExist:function(e){var t=this.getbattleInfo();if(t){for(var a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n])&&i.id==e.id)return!0;return!1}},addBattleInfo:function(e){var t=this.getbattleInfo();if(t)for(var a=t.length,i=void 0,n=0;n<a;n++)if(!t[n])return i=this.allRewarderMp.get(e.id),this.battleMp.set(n,i),void this.updatetElementMp(!0,e.id)},delBattleInfo:function(e){var t=this.getbattleInfo();if(t)for(var a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n])&&i.id==e.id)return this.battleMp.set(n,null),void this.updatetElementMp(!1,e.id)},delAllBattle:function(e){for(var t=0<arguments.length&&void 0!==e&&e,a=this.getbattleInfo(),i=void 0,n=0;n<a.length;n++)(i=a[n])&&this.delBattleInfo(i),t||this.battleMp.del(n)},initSolt:function(e){for(var t=e.dispatchElement.length,a=0;a<t;a++)this.battleMp.set(a,null)},getbattleInfo:function(){return this.battleMp.values()},setActive:function(e){for(var t=void 0,a=0;a<e.length;a++)(t=this.allRewarderMp.get(e[a].id))&&(this.getElementItme(t.element,t),this.allRewarderMp.del(e[a].id))},updatetElementMp:function(e,t){var a=void 0,i=this.allRewarderMp.get(t);e?(this.allRewarderMp.del(t),this.getElementItme(i.element,i)):i||(a=game.PartnerCfg.getData(t),(i=new game.RewarderInfo).url=72,this.allRewarderMp.set(t,i),i.setData(a),this.getElementItme(i.element,i))},setPartnerList:function(e){if(e)for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++)1!=(i=e[s]).id&&((a=this.allRewarderMp.get(i.id))||(n=game.PartnerCfg.getData(i.id),(a=new game.RewarderInfo).url=72,this.allRewarderMp.set(i.id,a),a.setData(n),this.getElementItme(a.element,a)))},getElementItme:function(e,t){var a=void 0;switch(e){case 1:a=this.getItemWater();break;case 2:a=this.getItemFire();break;case 3:a=this.getItemWind();break;case 4:a=this.getItemSoil()}for(var i=0;i<a.length;i++)if(a[i].id==t.id)return void a.splice(i,1);a.push(t)},getRewarderItemlist:function(){return this.rewarderMp.values()},getRewarderItemInfo:function(e){return this.rewarderMp.get(e)},delRewarderItemInfo:function(e){this.rewarderMp.del(e)},getitemlist:function(){return this.allRewarderMp.values()},getItemInfo:function(e){return this.allRewarderMp.get(e)},fastBattleData:function(e,t,a){var i=1<arguments.length&&void 0!==t&&t,n=2<arguments.length&&void 0!==a&&a,s=this,r=void 0;if(n&&s.delAllBattle(!0),!(r=i?s.getbattleInfo():s.getitemlist()))return!1;var o=game.BountyQuestCfg.getData(e);if(!o)return!1;var g=void 0,u=0;i||r.sort(s._sort);var l=o.dispatchQuality,c=o.dispatchElement;l.length!=c.length&&game.notice.show(51294);s.checkMap||(s.checkMap=b8e.HashMap.get()),s.checkMap.clear(),n&&(s.eMap||(s.eMap=b8e.HashMap.get()),s.eMap.clear());for(var h=0;h<r.length;h++){if(g=r[h],n){var m=s.eMap.get(g.element);m||(m=[],s.eMap.set(g.element,m)),m.push(g)}if(s.getElement(l,c,g,s.checkMap)&&u++,u>=l.length)return!0}return n&&s.setNotice(s.eMap,l,c),!1},setNotice:function(e,t,a){this.eCheckMap||(this.eCheckMap=b8e.HashMap.get()),this.eCheckMap.clear();for(var i=1,n=0;n<a.length;n++){var s=a[n],r=t[n],o=e.get(s);if(this.eCheckMap.get(s)&&i++,this.eCheckMap.set(s,!0),!o){var g=game.CCommonUtil.getElementText(s);return void game.notice.show(53289,g)}if(o.length<i){var u=game.CCommonUtil.getElementText(s);return void game.notice.show(53289,u)}for(var l=0;l<o.length;l++){if(o[l].quality>=r)break;var c=game.CCommonUtil.getQualityStr(r),h=game.HtmlUtil.getColorStrByQuality(r,c);return void game.notice.show(53290,h)}}},setBattleData:function(e){var t=this,a=t.getitemlist();if(a){var i=game.BountyQuestCfg.getData(e);if(!i)return!1;t.delAllBattle();var n=void 0;a.sort(t._sort);var s=0,r=i.dispatchQuality,o=i.dispatchElement,g=r.length;t.checkMap||(t.checkMap=b8e.HashMap.get()),t.checkMap.clear();for(var u=0,l=a.length;u<l;u++)if(n=a[u],t.getElement(r,o,n,t.checkMap)&&(t.battleMp.set(s,n),t.updatetElementMp(!0,n.id),g<=++s))return}},getElement:function(e,t,a,i){for(var n=e.length,s=!1,r=!1,o=void 0,g=void 0,u=0;u<n;u++){if(!a)return!1;if(s||a.quality>=e[u]&&!i.has("q"+u)&&(s=!0,o=u),r||a.element!=t[u]||i.has("e"+u)||(r=!0,g=u),s&&r)return i.set("q"+o,!0),i.set("e"+g,!0),!0}return!1},getbattlekey:function(){var e=this.getbattleInfo();if(e){for(var t=[],a=0;a<e.length;a++){var i={};i.id=e[a].id,t.push(i)}return t}},getItemWater:function(){var e=this.selectList;return e?(e.water.sort(this.battlesort),e.water):null},getItemFire:function(){var e=this.selectList;return e?(e.fire.sort(this.battlesort),e.fire):null},getItemWind:function(){var e=this.selectList;return e?(e.wind.sort(this.battlesort),e.wind):null},getItemSoil:function(){var e=this.selectList;return e?(e.soil.sort(this.battlesort),e.soil):null},battlesort:function(e,t){return e.quality>t.quality?1:e.quality<t.quality?-1:0},_sort:function(e,t){return e.quality>t.quality?-1:e.quality<t.quality?1:0},rewarderSort:function(e,t){return e.active?-1:t.active?1:0}});game.rewarderData=game.rewarderData||new e}(),function(){var e;e=b8e.Object.extends({id:0,startTime:0,type:0,petid:0,url:0,name:null,cfgQuality:0,element:0,icon:0,active:!1,rewards:null,ctor:function(){},setData:function(e){e&&(this.id=e.id,this.name=e.name,this.cfgQuality=e.quality,this.element=e.element,this.icon=e.icon)},quality:{get:function(){var e=game.partnerData.getInfoById(this.id);return e.newQuality?e.newQuality:this.cfgQuality}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RewarderInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,startTime:0,endTime:0,type:0,petid:0,quality:0,name:null,dispatchElement:null,dispatchQuality:null,duration:0,units:null,active:!1,rewards:null,alert:!1,ctor:function(){},setData:function(e){if(e){this.id=e.id;var t=game.BountyQuestCfg.getData(this.id);t&&(this.name=t.name,this.quality=t.quality,this.duration=t.duration,this.startTime=e.startTime,0<e.startTime&&(this.active=!0),this.endTime=e.startTime?e.startTime+t.duration:0,this.rewards=t.rewards)}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RewarderItemInfo",e)}(),function(){var e;e=b8e.Object.extends({quality:0,ctor:function(){},setData:function(){}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RewarderLvInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.rewarderAlert=game.spotAlert.set(game.SAE.REWARDER),this.rewarderData=game.rewarderData,this.noticeAlert={lang:50407,btn:game.Lang.get(9059),okcb:this.clearData,thisArg:this,args:[],langArgs:[],align:b8e.HorizontalAlign.CENTER},this.toinit=!1,this.partnerInit=!1},ipc:function(){this.evts={Partner:{C_INIT_DATA:this.updateListData,C_UPDATE_ACTIVE:this.updateActive},RewarderChoose:{C_UPDATE_VIEW:this.updateView},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={BountyQuestResp:this.bountyQuestResp,BountyQuestRefreshResp:this.bountyQuestRefreshResp,BountyQuestCollectResp:this.bountyQuestCollectResp}},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.sender.BountyQuestReq(),game.module.hide(game.ME.RewarderChoose))},updateView:function(){this.checkAlert()},updateListData:function(e){var t=e.data;this.rewarderData.setPartnerList(t.partners),this.partnerInit=!0,this.checkAlert()},updateActive:function(e){this.rewarderData.updatetElementMp(!1,e.data),this.checkAlert()},triggerOpen:function(e){e==this.moduleEnum&&(game.rewarderData.setLvinfo(),this.sender.BountyQuestReq())},notify:function(e,t){switch(e){case this.Evts.V2C_SELECT_UPDATE:this.gotoChoose(t);break;case this.Evts.V2C_UPDATE_VIEWDATA:this.updateInitData();break;case this.Evts.C_SELECT_OK:this.btn_receive(t);break;case this.Evts.V2C_UPDATE_ALERT:this.updateView()}},btn_up:function(){var e=game.BountyQuestMiscCfg.getData("refreshCost");if(e)if(game.rewarderData.isUpdate())game.notice.show(51206);else if(0==game.rewarderData.refreshCount)this.sender.BountyQuestRefreshReq(),game.rewarderData.refreshCount++;else{var t=+e.value;this.noticeAlert.args[0]=t,this.noticeAlert.langArgs[0]=t,game.alert.show(this.noticeAlert)}},clearData:function(){var e=game.BountyQuestMiscCfg.getData("refreshCost");e&&game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,e.value,!0)&&this.sender.BountyQuestRefreshReq()},btn_lv:function(){game.module.show(game.ME.RewarderLv)},btn_receive:function(e){game.rewarderData.selectId=e.id,this.sender.BountyQuestCollectReq(e.id)},gotoChoose:function(e){e&&(game.rewarderData.selectId=e.id,this.dpt(this.Evts.DPT_UPDATE_CHOOSE,e.id),game.module.show(game.ME.RewarderChoose))},checkAlert:function(){var e=game.rewarderData.getRewarderItemlist();if(e){var t=void 0,a=!1,i=!1;this.toinit&&this.partnerInit&&(game.rewarderData.setInitUnits(),this.toinit=!1,this.partnerInit=!1);for(var n=0;n<e.length;n++){if((t=e[n]).active){var s=game.SysTime.unixTime;if(t.startTime+t.duration<=s){a=!0;break}t.alert=!1}else{var r=game.rewarderData.fastBattleData(t.id);t.alert=r}t.alert&&(i=!0)}var o=game.rewarderData.isUpdate();this.rewarderAlert.alert=!(o&&!a)&&(a||i),this.send(this.Evts.C2V_UPDATE_VIEW)}},bountyQuestResp:function(e){var t=e.readProtobuf(game.pb.BountyQuestResponse);0<t.code?game.notice.noticeError(t.code):(game.rewarderData.initial(t),game.rewarderData.updateRewarderData(t.quests),this.toinit=!0,this.checkAlert())},bountyQuestRefreshResp:function(e){var t=e.readProtobuf(game.pb.BountyQuestRefreshResponse);0<t.code?game.notice.noticeError(t.code):(game.rewarderData.updateRewarderData(t.quests),this.checkAlert())},bountyQuestCollectResp:function(e){var t=e.readProtobuf(game.pb.BountyQuestCollectResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.rewarderData.selectId;game.rewarderData.setUpRewarder(a),game.rewarderData.setUp(t),game.rewarderData.delRewarderItemInfo(a),this.checkAlert(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}}}),t=[game.ME.RewarderLv],a=game.Sender.extends({ipc:function(){this.msg={BountyQuestReq:null,BountyQuestRefreshReq:null,BountyQuestCollectReq:this.bountyQuestCollectReq}},bountyQuestCollectReq:function(e){var t=game.pb.BountyQuestCollectRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.Rewarder,e,game.RewarderEvts,a,t)}(),function(){var e=game.Control.extends({selectId:0,id:0,init:function(){this.rewarderData=game.rewarderData},ipc:function(){this.evts={Rewarder:{DPT_UPDATE_CHOOSE:this.updateView}},this.handels={BountyQuestDispatchResp:this.bountyQuestDispatchResp}},updateView:function(e){this.selectId=e.data,this.send(this.Evts.C2V_UPDATE_CHOOSE)},notify:function(e,t){switch(e){case this.Evts.C_ITEM_BATTLE:this.battle(t)}},btn_all:function(){this.updateBtn(0)},btn_water:function(){this.updateBtn(1)},btn_fire:function(){this.updateBtn(2)},btn_wind:function(){this.updateBtn(3)},btn_soil:function(){this.updateBtn(4)},updateBtn:function(e){this.send(this.Evts.C2V_UPDATE_LIST_DATA,e),game.rewarderData.id=e},btn_battle:function(){var e=game.BountyQuestMiscCfg.getData("vipLv");if(e)if(game.mainRoleData.vipLevel<e.value)game.notice.show(50481,e.value);else if(game.rewarderData.fastBattleData(this.selectId,!1,!0)){var t=game.rewarderData.id;game.rewarderData.setBattleData(this.selectId),this.send(this.Evts.C2V_UPDATE_LIST_DATA,t)}},btn_dispatch:function(){var e=game.rewarderData.getbattlekey();this.sender.BountyQuestDispatchReq(this.selectId,e)},battle:function(e){this.rewarderData.getIsExist(e)?this.rewarderData.delBattleInfo(e):this.rewarderData.addBattleInfo(e);var t=game.rewarderData.id;this.send(this.Evts.C2V_UPDATE_LIST_DATA,t)},bountyQuestDispatchResp:function(e){if(0<e.readProtobuf(game.pb.BountyQuestDispatchResponse).code)game.notice.show(51293);else{var t=game.rewarderData.getbattlekey(),a=game.rewarderData.getRewarderItemInfo(this.selectId);a.units=t,a.active=!0,a.startTime=game.SysTime.unixTime,a.endTime=a.startTime+a.duration,game.module.hide(game.ME.RewarderChoose),game.rewarderData.totalTimes++,this.dpt(this.Evts.C_UPDATE_VIEW),game.rewarderData.setInitUnits()}}}),t=game.Sender.extends({ipc:function(){this.msg={BountyQuestDispatchReq:this.bountyQuestDispatchReq}},bountyQuestDispatchReq:function(e,t){var a=game.pb.BountyQuestDispatchRequest;a.id=e,a.units=t,this.write(a)}});b8e.module.registerControl(game.ME.RewarderChoose,e,game.RewarderEvts,t)}(),function(){var e=game.View.extends({progressMaxW:318,ctor:function(){this._super(game.UIUrl.get(1272))},init:function(){this._gridList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._gridList.itemRender=game.RewarderItem,this._gridList.bindEnum=game.ME.Rewarder,this._gridList.addToParent(this.skin.list),this.rewarderData=game.rewarderData},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updataPage()}},onShow:function(){this.updataPage()},updataPage:function(){var e=this.skin;e.lv.string=game.Lang.get(9587,game.rewarderData.level);var t=game.rewarderData.getRewarderItemlist();t.sort(game.rewarderData.rewarderSort),this._gridList.setData(t),e.noList.setVisible(t.length<=0),this.createTimer()},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,500)},setCountDown:function(){var e=game.SysTime.unixTime,t=this.rewarderData.endTime-e;t<0?this.clearTimer():this.skin.time.string=game.Lang.get(50404,b8e.TimeUtil.formatTime(1e3*t))},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer()}});b8e.module.registerView(game.ME.Rewarder,e)}(),function(){var e;(e=game.ListItem.extends({icon:null,ctor:function(){this._super(game.UIUrl.get(1275)),this.setSize(200,20)},init:function(){},setData:function(e){this.skin.name.string=game.rewarderData.stringType(e.quality,!1);for(var t=1;t<=e.quality;t++)this.getComponent("xing_"+t).active=!0}})).poolCall=!0,b8e.RC("$$game","$$RewarderLvLsitItme",e)}(),function(){var e=game.View.extends({_icon:null,_cfg:null,index:0,ctor:function(){this._super(game.UIUrl.get(1271))},init:function(){var e=this;e._gridList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e._gridList.itemRender=game.RewarderListItem,e._gridList.layout.spacingX=24,e._gridList.layout.spacingY=20,e._gridList.bindEnum=game.ME.RewarderChoose,e._gridList.addToParent(e.skin.list),e.qualityArr=[],e._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),e._icon.addToParent(e.skin.itemIcon),e.slotArr=[];for(var t=0;t<3;t++){var a=new game.RewarderItmeSlotWidget(e.moduleEnum);a.addToParent(e.getComponent("equip_"+t)),e.slotArr.push(a)}},onShow:function(){this._cfg=game.BountyQuestCfg.getData(game.rewarderData.selectId),this._cfg&&(game.rewarderData.initSolt(this._cfg),this.slotItme(),this.updateView(),this.updataList(0),this.updateSlots())},slotItme:function(){var e=game.rewarderData.getbattleInfo();if(e){for(var t=0,a=0;a<this.slotArr.length;a++){var i=a+1;this.getComponent("petIcon_"+a).active=!0,this.getComponent("ok_"+a).active=!0,i>e.length&&(t++,this.getComponent("petIcon_"+a).active=!1,this.getComponent("ok_"+a).active=!1)}0<t?1<t?this.skin.wupin.setPosition(152,0):this.skin.wupin.setPosition(84,0):this.skin.wupin.setPosition(0,0)}},updateView:function(){var e=this,t=e.skin,a=e._cfg.dispatchQuality,i=e._cfg.dispatchElement;e.qualityArr=[];for(var n=void 0,s=0;s<a.length;s++){(n={}).quality=a[s],n.value=1,n.index=s;var r=game.ResCfg.getUrl(10064,"icon_"+i[s]);e.getComponent("icon_"+s).loadTexture(r),e.isElementNum(a[s],e.qualityArr)||e.qualityArr.push(n)}t.item_node1.node.active=1!=e.qualityArr.length;for(s=0;s<e.qualityArr.length;s++){var o=e.qualityArr[s].quality,g=game.ResCfg.getUrl(10064,o);e.getComponent("item_"+s).loadTexture(g),e.getComponent("itemLable_"+s).string="0/"+e.qualityArr[s].value}t.tile.string=e._cfg.name;var u=e._cfg.rewards[0],l=game.ItemUtil.createBaseItemInfo(u.Id,u.Num);game.GridUtil.setItemIcon(e._icon,l,!1,0)},isElementNum:function(e,t){for(var a=t.length,i=0;i<a;i++)if(e==t[i].quality)return this.qualityArr[i].value++,!0;return!1},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_LIST_DATA:this.updataList(t),this.updateSlots();break;case this.Evts.C2V_SELECT_SLOT_CHANGE:}},updateSlots:function(){var e=this,t=e.skin,a=game.rewarderData,i=a.getbattleInfo();if(!(i.length<1)){var n=void 0,s=void 0,r=b8e.HashMap.get(),o=b8e.HashMap.get(),g=e._cfg.dispatchElement;e.getComponent("duigou_0").active=!1,e.getComponent("duigou_1").active=!1,e.getComponent("duigou_2").active=!1;for(var u=void 0,l=0;l<g.length;l++){u=!1;for(var c=0;c<i.length;c++)if((n=i[c])&&g[l]==n.element&&!r.has(n.id)){r.set(n.id,g),u=!0;break}if(e.getComponent("duigou_"+l).node.active=u,n=i[l],s=e.slotArr[l],n){var h=o.get(n.quality);h=null==h?1:h+1,o.set(n.quality,h),s.node.active=!0,s.show(n)}else s.node.active=!1}var m=o.keys(),d=0,f=e.qualityArr.length;for(l=0;l<f;l++){for(c=d=0;c<m.length;c++)if(m[c]>=e.qualityArr[l].quality){var p=o.get(m[c]);if(p){var v=e.qualityArr[l].value-d;d+=v<p?v:p,p-=p<v?p:v,o.set(m[c],p)}}var E=d>=e.qualityArr[l].value?4507:4508;e.getComponent("itemLable_"+l).string=game.Lang.get(E,d,e.qualityArr[l].value)}i.length>=g.length&&a.fastBattleData(a.selectId,!0)?(t.btn_not.node.active=!1,t.btn_dispatch.active=!0):(t.btn_not.node.active=!0,t.btn_dispatch.active=!1)}},getIsbattle:function(e,t,a){if(!e)return!1;for(var i=void 0,n=0;n<a.length;n++)if(i=a[n],e.quality>=t&&e.element==i)return this.index=n,!0;return!1},updataList:function(e){switch(e){case 0:this._gridList.setData(game.rewarderData.getitemlist().sort(game.rewarderData._sort));break;case 1:this._gridList.setData(game.rewarderData.getItemWater());break;case 2:this._gridList.setData(game.rewarderData.getItemFire());break;case 3:this._gridList.setData(game.rewarderData.getItemWind());break;case 4:this._gridList.setData(game.rewarderData.getItemSoil())}this.updateSelected(e)},updateSelected:function(e){for(var t=0;t<5;t++)this.getComponent("to_"+t).node.active=t==e},onHide:function(){game.rewarderData.delAllBattle(),game.rewarderData.id=0}});b8e.module.registerView(game.ME.RewarderChoose,e)}(),function(){var e;(e=game.ListItem.extends({_icon:null,progressMaxW:266,ctor:function(){this._super(game.UIUrl.get(1273)),this.setSize(602,162)},init:function(){this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin;this.data=e;var a=game.rewarderData.stringType(e.quality,!0);t.name.string=game.Lang.get(a,e.name),t.pro.active=e.active,t.redPoint_1.active=e.alert;for(var i=e.rewards[0],n=1;n<game.Quality.Q_COLORFUL;n++)this.getComponent("xing_"+n).node.active=e.quality>=n;var s=game.ItemUtil.createBaseItemInfo(i.Id,i.Num);(game.GridUtil.setItemIcon(this._icon,s,!1,2),this.clearTimer(),e.active)?game.SysTime.unixTime<=e.endTime?(this.createTimer(),t.btn_receive.active=!1,t.pro.active=!0):(t.btn_receive.active=!0,t.pro.active=!1):t.btn_receive.active=!1;var r=b8e.TimeUtil.formatDayTime(1e3*e.duration);t.taskTime.string=game.Lang.get(50405,r),t.taskTime.active=!this.data.active,t.btn_Goto.active=!this.data.active},createTimer:function(){this.updateCdTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateCdTime,1e3)},updateCdTime:function(){var e=this;if(e.data){var t=e.data.endTime-game.SysTime.unixTime;if(e.skin.time.string=b8e.TimeUtil.formatTime(1e3*t),!(e.data.startTime<=0&&e.timer))return t<=0?(e.clearTimer(),void e.send(game.RewarderEvts.V2C_UPDATE_ALERT)):void e.setProgressVal(t,e.data.duration);b8e.Timer.remove(e,e.updateCdTime)}else e.clearTimer()},clearTimer:function(){var e=this;e.data&&(e.skin.btn_receive.active=e.data.active&&e.data.endTime<=game.SysTime.unixTime,e.skin.pro.active=!1),e.timer&&(b8e.Timer.remove(e,e.updateCdTime),e.skin.btn_receive.active=!0,e.timer=null)},setProgressVal:function(e,t){this.skin.jindu_1.width=(1-e/t)*this.progressMaxW},btn_Goto:function(){this.send(game.RewarderEvts.V2C_SELECT_UPDATE,{id:this.data.id})},btn_receive:function(){this.send(game.RewarderEvts.C_SELECT_OK,{id:this.data.id})}})).poolCall=!0,b8e.RC("$$game","$$RewarderItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(game.UIUrl.get(1274))},init:function(){var e=this;e.Progress=new game.Progress(441,30),e.Progress.addToParent(e.skin.pro),e._gridList0=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._gridList0.itemRender=game.RewarderLvLsitItme,e._gridList0.bindEnum=game.ME.RewarderLv,e._gridList0.addToParent(e.skin.list_0),e._gridList1=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._gridList1.itemRender=game.RewarderLvLsitItme,e._gridList1.bindEnum=game.ME.RewarderLv,e._gridList1.addToParent(e.skin.list_1)},onShow:function(){var e=this.skin,t=game.rewarderData.level,a=game.rewarderData.progress;e.lv.string=game.Lang.get(9587,t);var i=game.BountyQuestMiscCfg.getData("maxLv").value;if(i){var n=game.BountyQuestLevelCfg.getData(game.rewarderData.level),s=n.condition[0].Type,r=n.condition[0].Param1,o=void 0;t<i?o=game.BountyQuestLevelCfg.getData(game.rewarderData.level+1):(o=game.BountyQuestLevelCfg.getData(game.rewarderData.level),e.shuxing_1.x=154),e.shuxing_2.active=t<i,e.lv_2.string=game.Lang.get(9587,o.level),e.lv_1.string=game.Lang.get(9587,t);var g=game.rewarderData.stringType(s,!1);e.complete.string=game.Lang.get(50406,g,r),this.Progress.updatePro(a,r),this.updateLv(n,this._gridList0),this.updateLv(o,this._gridList1)}},updateLv:function(e,t){if(e){for(var a=e.preview,i=void 0,n=[],s=0;s<a.length;s++)i=game.rewarderData.getLvinfo(a[s]),n.push(i);t.setData(n)}}});b8e.module.registerView(game.ME.RewarderLv,e)}(),function(){var e;(e=game.ListItem.extends({icon:null,ctor:function(){this._super(game.UIUrl.get(1276)),this.setSize(100,128)},init:function(){this.iconBg=b8e.Sprite.get(),this.iconBg.setAnchor(0,1),this.skin.iconBG.addChild(this.iconBg)},setData:function(e){this.skin.name.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name);var t=game.ResCfg.getUrl(e.url,e.icon);this.skin.icon.loadTexture(t);var a=game.ResCfg.getUrl(240,game.ResCfg.getQualityBg(e.quality));this.iconBg.setStyle(b8e.SpriteStyle.SLICED),this.iconBg.scale9Inset={top:19,bottom:23,left:20,right:20},this.iconBg.loadTexture(a),this.iconBg.setSize(100,105);var i=game.ResCfg.getUrl(10048,e.element);this.skin.element.loadTexture(i),this.skin.element.node.active=!e.active},touchIcon:function(){this.send(game.RewarderEvts.C_ITEM_BATTLE,this.data)}})).poolCall=!0,b8e.RC("$$game","$$RewarderListItem",e)}(),function(){var e;e=game.Widget.extends({ctor:function(e){this._super(game.UIUrl.get(1276)),this.setSize(100,104),this.bindEnum=e},show:function(e){this.info=e,this.updateShow(),this._super()},onShow:function(){this.updateShow()},updateHide:function(){this.skin&&this.info},updateShow:function(){var e=this;if(e.skin&&e.info){e.iconBg||(e.iconBg=b8e.Sprite.get(),e.iconBg.setAnchor(0,1),e.skin.iconBG.addChild(e.iconBg)),e.skin.name.string=game.HtmlUtil.getColorStrByQuality(e.info.quality,e.info.name);var t=game.ResCfg.getUrl(e.info.url,e.info.icon);e.skin.icon.loadTexture(t);var a=game.ResCfg.getUrl(240,game.ResCfg.getQualityBg(e.info.quality));e.iconBg.setStyle(b8e.SpriteStyle.SLICED),e.iconBg.scale9Inset={top:19,bottom:23,left:20,right:20},e.iconBg.loadTexture(a),e.iconBg.setSize(100,105);var i=game.ResCfg.getUrl(10048,e.info.element);e.skin.element.loadTexture(i)}},updateIcon:function(){this.skin&&this.info.item},touchIcon:function(){this.send(game.RewarderEvts.C_ITEM_BATTLE,this.info)}}),b8e.RC("$$game","$$RewarderItmeSlotWidget",e)}(),function(){var e;e=b8e.Enum({NONE:0,V2C_CHALLAGE:-1,V2C_SHOWBUBBLE:-1,V2C_CHANGE_GROUP:-1,V2C_SHOWCHALLENGEVIEW:-1,C2V_CHANGE_GROUP:-1,V2C_SYSNINFO:-1,C2V_UPDATE_VIEW:-1,C2C_BATTLE_RESULT:-1,C2V_DAMAGE_INFO:-1,C2V_UPDATELIST:-1,C2C_UPDATELIST:-1,C2V_SKILL_HIT:-1,V_SCORLLLEFT:-1,V_SCORLLRIGHT:-1,V2C_BOSSWARN:-1,C2C_SHOWBUBBLE:-1,C2V_UPDATE_ITEM:-1}),b8e.RC("$$game","$$VipBossEvts",e)}(),function(){var e=b8e.Object.extends({bossLevelList:null,bossLevelMap:null,bossMap:null,bossList:null,curSelect:1,_bossInfos:null,isInit:!1,ctor:function(){this.bossLevelList=[],this.bossLevelMap=b8e.HashMap.get(),this.bossMap=b8e.HashMap.get(),this.isCountdown=!1,this.battleResult=null},synData:function(e){e?(this.bossDatas=e.infos,this.bossStage=e.stages,this.ignoreList=e.ignoreList,this.challenges=e.challenges,this.updateBossData(),this.initLevelData(),this.updateBossPrize(),this.updateBossIgnore(),this.updateChallengeCount()):b8e.error("server Data is null")},initLevelData:function(){var e=game.VipBossLevelCfg.getDatas();if(e){var t=e.length,a=void 0,i=void 0;this.bossLevelList=[];for(var n=0;n<t;n++){if(!(a=e[n]))return void b8e.error("\u6ca1\u6709\u914d\u7f6e\u6570\u636e vipBossLevel  id --\x3e"+n);(i=new game.VipBossInfo).setData(a),this.bossLevelList.push(i),this.bossLevelMap.set(a.id,i)}}else b8e.error("\u6ca1\u6709\u914d\u7f6e\u6570\u636e  VipBossLevelCfg")},bossInfos:{get:function(){return this._bossInfos||(this._bossInfos=b8e.HashMap.get(),this._initBossInfos(this._bossInfos)),this._bossInfos}},_initBossInfos:function(t){if(t){var e=game.VipBossCfg.getDatas();if(e){var a=void 0;e.forEach(function(e){(a=t.get(e.id))||((a=new game.VipBossChallengeInfo_2(e.id)).lvLimit=e.lvLimit,t.set(e.id,a)),a.setData()},this)}}},updateBossData:function(){var t=this;!t.bossDatas||t.bossDatas.length<1||(t.isCountdown=!1,t.bossDatas.forEach(function(e){t.updateBossInfo(e.bossId,e)},t))},updateBossInfo:function(t,e){var a=this;if(a.bossInfos){var i=a.bossInfos.get(t);i||(i=new game.VipBossChallengeInfo_2(t),a.bossInfos.set(t,i)),i.setData(e),0<i.reliveTime&&(a.isCountdown=!0),e.emulator&&0<e.emulator.length?e.emulator.forEach(function(e){a.updateDamageInfo(t,e)},a):a.clearDamageInfo(t)}},updateBossPrize:function(){var e=this.bossStage;if(e&&!(e.length<1)&&this.bossInfos)for(var t=e.length,a=void 0,i=0;i<t;i++)a=e[i],this.bossInfos.get(a.id).setPrizeData(a)},getBossData:function(e){var t=this.bossLevelMap.get(e);if(t){var a=this.bossMap.get(e);if(a||1<a)return this.updateAlert(a,t);for(var i=t.group,n=i.length,s=void 0,r=void 0,o=[],g=0;g<n;g++)s=i[g],(r=this.bossInfos.get(s)).alert=t.alert,o.push(r);return this.bossMap.set(e,o),o}b8e.error("\u5f53\u524d\u7ec4 \u6ca1\u6709\u6570\u636e"+e)},getIsBoss:function(e){var t=this.bossLevelMap.get(e);if(t){for(var a=t.group,i=a.length,n=void 0,s=void 0,r=game.mainRoleData.vipLevel,o=game.mainRoleData.lv,g=0;g<i;g++)if(n=a[g],(s=this._bossInfos.get(n)).vipLimit<=r&&s.reliveTime<=0&&o>=s.lvLimit&&t.count<t.challenges)return!0;return!1}},updateAlert:function(e,t){for(var a=e.length,i=0;i<a;i++)e[i].alert=t.alert;return e},setBossHp:function(e){var t=this.bossInfos?this.bossInfos.get(e.bossId):null;t&&(t.hp=-1,t.hp=0<=e.hp?e.hp:0)},setBattleResult:function(t){var a=this;if(t){a.battleResult=t,a.hp0=t.hp0,a.challengeBossHp=t.hp,a.recoverTime=t.recoverTime;var e=t.bossId,i=t.emulator;if(i&&0<i.length){i.forEach(function(e){a.updateDamageInfo(t.id,e)},a);for(var n=game.mainRoleData.id,s=-1,r=0,o=i.length;r<o;r++)if(i[r].roleId==n){s=r;break}s<0?i.push(t.ownDamage):i[s]=t.ownDamage,a.selfDamage=t.ownDamage,a.doRank(i)}else a.clearDamageInfo(t.id);var g=a.bossInfos.get(e);if(g){var u=a.bossLevelMap.get(g.group),l=u.count;u.setCount(l++)}}},doRank:function(e){if(e){e.sort(function(e,t){return t.damage-e.damage});for(var t=0,a=e.length;t<a;t++)e[t].rank=t+1}},updateChallengeCount:function(){for(var e=this.challenges,t=e.length,a=0;a<t;a++)this.setChallengeCount(a+1,e[a])},setChallengeCount:function(e,t){var a=this.bossLevelMap.get(e);a&&a.setCount(t)},rebirthBoss:function(e){if(e){var t=e.bossId,a=e.timestamp,i=e.state,n=this.getBossDataById(t);n&&(n.reliveTime=a);var s=this.bossInfos?this.bossInfos.get(t):null;this.isCountdown=!1,s&&(1==i?s.setData():(s.hp=-1,s.hp=0,s.reliveTime=a-game.SysTime.curTime,0<s.reliveTime&&(this.isCountdown=!0)))}},getBossDataById:function(e){if(!this.bossDatas)return null;for(var t=this.bossDatas,a=void 0,i=t.length-1;0<i;i--)if((a=t[i]).bossId==e)return a;return null},updateDamageInfo:function(e,t){if(this.damageInfos){var a=this.damageInfos.get(e);a||(a=[],this.damageInfos.set(e,a));for(var i=void 0,n=0,s=a.length;n<s&&(i=a[n]).roleId!=t.roleId;n++)i=null;i||(i=new game.PublicBossDamageInfo,a.push(i)),i.setData(t)}},clearDamageInfo:function(e){this.damageInfos&&this.damageInfos.del(e)},changeSelect:function(){for(var e=this.bossLevelList.length,t=void 0,a=0;a<e;a++)(t=this.bossLevelList[a]).select=t.id==game.vipBossData.curSelect},getChallengeMaxCount:function(){if(!this.maxCount){var e=game.InstanceMiscCfg.getData("VipBossChallengeCount");if(!e)return b8e.error("VipBOss\u6700\u5927\u6311\u6218\u6b21\u6570\u672a\u586b"),0;this.maxCount=+e.value}return this.maxCount},isIgnore:function(e){var t=this.bossInfos.get(e);return!!t&&t.isWarn},setBossIgnore:function(e,t){var a=this.bossInfos.get(e);a||((a=new game.VipBossChallengeInfo_2(e)).set(e,a),a.setData()),a.isWarn=t},updateBossIgnore:function(){var e=this.ignoreList;if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)this.setBossIgnore(e[a],!0)},resetDaliy:function(){for(var e=this.challenges.length,t=0;t<e;t++)this.setChallengeCount(t+1,0)}});game.vipBossData=game.vipBossData||new e}(),function(){var e,t=e=b8e.Object.extends({name:"",vipLV:0,desc:"",data:null,bgId:"",id:0,count:0,select:!1,alert:!1,challenges:0,setData:function(e){this.data=e,this.awards=e.prizeItem,this.name=e.name,this.vipLV=e.vipLv,this.desc=e.desc,this.bgId=e.bg,this.id=e.id,this.group=e.group,this.challenges=e.challenges},getPrizeItems:function(){if(!this.data)return b8e.error("\u6ca1\u6709\u914d\u7f6e\u6570\u636e"),null;var e=this.awards,t=void 0,a=void 0,i=e.length;if(!this.award){this.award=[];for(var n=0;n<i;n++)t=e[n],(a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num)).iconSize=game.IconSizeEnum.GRID_SIZE_84,this.award.push(a)}return this.award},setCount:function(e){this.count=e}});b8e.BindingUtil.bind(t),b8e.RC("$$game","$$VipBossInfo",e)}(),function(){var e,t=e=b8e.Object.extends({bossId:0,hp:0,isWarn:!1,reliveTime:0,id:0,firstCollected:!1,dailyCollected:!1,alert:!1,lvLimit:0,ctor:function(e){this._super(),this.bossId=e},setData:function(e){var t=this.getCfg();this.vipLimit=t.vipLimit,this.group=t.level,e?(this.reliveTime=e.reliveTime-game.SysTime.curTime,e.reliveTime<=0?this.hp=e.hp:this.hp=this.reliveTime<0?t.hp:e.hp):(this.hp=t.hp,this.reliveTime=0)},setPrizeData:function(e){this.firstCollected=e.firstCollected,this.dailyCollected=e.dailyCollected},getCfg:function(){return game.VipBossCfg.getData(this.bossId)}});b8e.BindingUtil.bind(t),b8e.RC("$$game","$$VipBossChallengeInfo_2",e)}(),function(){var e=game.Control.extends({init:function(){this.bossData=game.vipBossData},ipc:function(){var e=this;e.evts={VipBossMain:{C2C_UPDATELIST:e.updateList},MainRole:{C_RESET_DAILY:e.resetDaily,C_VIP_LEVEL_CHANGE:e.updateView,C_LEVEL_UP:e.checkLevelUp}},e.handels={VipBossChallengeResp:e.onVipBossChallengeResp,VipBossInfoResp:e.onVipBossInfoResp,VipBossMsg:e.onVipBossMsgMsg,VipBossSetNoticeResp:e.onVipBossSetNoticeResp}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.VipBossInfoReq()},notify:function(e,t){var a=this;switch(e){case a.Evts.V2C_CHALLAGE:game.playBack.isInstanceFighting()||game.sceneData.isGuildMap()||a.sender.VipBossChallengeReq(t);break;case a.Evts.V2C_SYSNINFO:a.sender.VipBossInfoReq();break;case a.Evts.V2C_CHANGE_GROUP:a.bossData.curSelect=t,a.send(a.Evts.C2V_UPDATELIST);break;case a.Evts.V2C_BOSSWARN:a.sender.VipBossSetNoticeReq(t.id,t.ignore)}},checkLevelUp:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkAlert()},updateView:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&this.sender.VipBossInfoReq()},updateList:function(){this.send(game.VipBossEvts.C2V_UPDATELIST)},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.bossData.resetDaliy(),this.checkAlert())},showBubble:function(e){this.dpt(this.Evts.C2C_SHOWBUBBLE,e)},onVipBossChallengeResp:function(e){var t=e.readProtobuf(game.pb.VipBossChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.bossData.setBattleResult(t);var a=this.bossData.battleResult;a.battlelog.win=!0;var i={type:game.InstanceType.VIPBOSS,rewards:a.useritem,exp:a.exp};this.checkAlert(),game.playBack.play(a.battlelog,i),this.dpt(this.Evts.C2C_BATTLE_RESULT,a)}},onVipBossInfoResp:function(e){var t=e.readProtobuf(game.pb.VipBossInfoResponse);0<t.code?game.notice.noticeError(t.code):(this.bossData.synData(t),this.runBossTimer(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))},createBossTimer:function(){this.bossTimer||(this.bossTimer=b8e.Timer.add(this,this.updateBossTime,1e3),this.bossTimer.start())},clearBossTimer:function(){this.bossTimer&&(b8e.Timer.remove(this,this.updateBossTime),this.bossTimer=null)},runBossTimer:function(){this.bossData.isCountdown&&this.createBossTimer()},updateBossTime:function(){if(this.bossData.bossInfos){var a,i=0;this.bossData.bossInfos.forEach(function(e,t){0<t.reliveTime&&(a=t.reliveTime-b8e.TimeUtil.SECOND_MICRO_SECONDS,t.reliveTime=0<=a?a:0,i++)},this),i<1&&(this.clearBossTimer(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))}},onVipBossMsgMsg:function(e){var t=e.readProtobuf(game.pb.VipBossNotify);if(0<t.code)game.notice.noticeError(t.code);else{if(1==t.state){var a=this.bossData.bossInfos.get(t.bossId);a&&!a.isWarn&&this.showBubble(a.getCfg())}game.vipBossData.rebirthBoss(t),this.runBossTimer(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_ITEM)}},onVipBossSetNoticeResp:function(e){var t=e.readProtobuf(game.pb.VipBossSetNoticeResponse);0<t.code?game.notice.noticeError(t.code):game.vipBossData.setBossIgnore(t.bossId,t.ignore)},zuoanui:function(){this.send(game.VipBossEvts.V_SCORLLLEFT)},youanui:function(){this.send(game.VipBossEvts.V_SCORLLRIGHT)},checkAlert:function(){}}),t=game.Sender.extends({ipc:function(){this.msg={VipBossInfoReq:null,VipBossChallengeReq:this.VipBossChallengeReq,VipBossSetNoticeReq:this.VipBossSetNoticeReq}},VipBossChallengeReq:function(e){var t=game.pb.VipBossChallengeRequest;t.bossId=e,this.write(t)},VipBossSetNoticeReq:function(e,t){var a=game.pb.VipBossSetNoticeRequest;a.bossId=e,a.ignore=t,this.write(a)}});b8e.module.registerControl(game.ME.VipBossChallenge,e,game.VipBossEvts,t)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={MainUIBottom:{C2C_SELECT_VIPBOSS:this._showChallenge}}},notify:function(e,t){switch(e){case game.VipBossEvts.V2C_SHOWCHALLENGEVIEW:this.showChallenge(t)}},showChallenge:function(e){game.vipBossData.curSelect=e,game.module.show(game.ME.VipBossChallenge),this.dpt(game.VipBossEvts.C2C_UPDATETOPLIST)},_showChallenge:function(e){e&&e.data&&this.showChallenge(e.data)}});b8e.module.registerControl(game.ME.VipBossMain,e,game.VipBossEvts)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={VipBossChallenge:{C2C_BATTLE_RESULT:this.battleResult}},this.gevts={InstanceEvts:{G_STOP_PLAY:this.onBattleOver,G_SKILL_HIT:this.onSkillBoss}}},battleResult:function(e){var t=e?e.data:null;t&&this.send(game.VipBossEvts.C2V_DAMAGE_INFO,t)},onBattleOver:function(e){if(e&&e.data&&e.data.type==game.InstanceType.VIPBOSS){var t=game.vipBossData;t.setBossHp(t.battleResult)}},onSkillBoss:function(e){var a=this;if(b8e.module.isShowView(game.ME.VipBossBattle)){var i=e.data;i&&i.roleData.type==game.RoleType.Monster&&game.MonsterCfg.getDataAsync(i.roleId,function(e){if(e&&1==e.type){var t=game.vipBossData.battleResult.emulator;game.vipBossData.selfDamage.damage+=i.value,a.doRank(t),a.send(game.VipBossEvts.C2V_SKILL_HIT,i)}},a)}},doRank:function(e){if(e){e.sort(function(e,t){return t.damage-e.damage});for(var t=0,a=e.length;t<a;t++)e[t].rank=t+1}}});b8e.module.registerControl(game.ME.VipBossBattle,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1238),this.setSize(204,326)},init:function(){this.bg=b8e.Sprite.get(),this.bg.setAnchor(.5,.5),this.bg.addToParent(this.skin.bg)},setData:function(e){var t=this.skin;this.data=e,this.skin.xuanzhongkuang.active=e.select,t.wenzi_3.string=e.name,this.bg.loadTexture(game.ResCfg.getUrl(10046,e.bgId)),t.redPoint.active=e.alert},annui_1:function(){this.send(game.VipBossEvts.V2C_CHANGE_GROUP,this.data.id)},clickBtn:function(){this.send(game.VipBossEvts.V2C_CHANGE_GROUP,this.data.id)}}),b8e.RC("$$game","$$VipBossChallengeItem_1",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1239),this.setSize(600,176),this.bossId=0},init:function(){var e=this;e.items=!0,e._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._prizeList.itemRender=game.ShowItemListItem,e._prizeList.layout.paddingTop=10,e._prizeList.layout.spacingX=10,e._prizeList.layout.paddingLeft=-10,e._prizeList.addToParent(e.skin.wupingkuangzu_1),e._model=b8e.SceneEntity.get(),e._model.addToParent(e.skin.model),e.progressWidth=245},setData:function(e){var t=this;t.createPrize(e),0<e.rebirthTime&&(t.isup=!1),t.bossData=e,t.bossData&&(t.bossCfg=t.bossData.getCfg(),t.bossCfg&&(t.setBossName(),t.setModel(),t.setHistoryAwrad(),t.setProgress(),t.setWarn(),t.isWarn=e.isWarn,t.setBossStates()))},btn_enter:function(){var e=this.bossData;if(e)if(game.mainRoleData.vipLevel<e.vipLimit)game.notice.show(50352);else{var t=game.vipBossData.bossLevelMap;if(t){var a=t.get(e.group);if(game.vipBossData.getChallengeMaxCount()<=a.count)return void game.notice.show(50353)}game.UpgradeUtil.checkEquipTooMuch()||e.reliveTime<=0&&this.send(game.VipBossEvts.V2C_CHALLAGE,e.bossId)}},setBossName:function(){this.bossCfg&&(this.skin.name.string=game.HtmlUtil.getColorStrByQuality(this.bossCfg.quality,this.bossCfg.name))},setProgress:function(){if(this.bossData&&this.bossCfg){var e=this.bossCfg.hp,t=this.bossData.hp/e;this.skin.jingdutiao_1.node.width=this.progressWidth*t,this.skin.progressLab.string=(1<=t?100:(100*t).toFixed(1))+"%"}},setBossStates:function(){var e=this,t=e.skin;if(e.bossData&&e.bossData.bossId){var a=game.mainRoleData.lv>=e.bossCfg.lvLimit,i=game.mainRoleData.vipLevel>=e.bossCfg.vipLimit,n=0<e.bossData.reliveTime;if(!i)return t.btn_enter.node.active=!1,t.rebirthLab.node.active=!1,t.openLab.node.active=!0,void(t.openLab.string=game.Lang.get(50354,e.bossCfg.vipLimit));a?(t.btn_enter.node.active=!n,t.rebirthLab.node.active=n,t.openLab.node.active=!1,t.redPoint.active=e.bossData.alert):(t.btn_enter.node.active=!1,t.rebirthLab.node.active=!1,t.openLab.node.active=!0,t.openLab.string=game.Lang.get(50351,e.bossCfg.lvLimit)),n&&(t.rebirthLab.string=game.Lang.get(513,b8e.TimeUtil.formatTime(e.bossData.reliveTime)),e.setRebirthTime())}},setRebirthTime:function(){this.rebirthTimer||(this.rebirthTimer=b8e.Timer.add(this,this.updateTime,1e3)),this.rebirthTimer.reset(),this.rebirthTimer.start()},updateTime:function(){this.bossData&&null!=this.bossData.reliveTime&&(this.skin.rebirthLab.string=game.Lang.get(513,b8e.TimeUtil.formatTime(this.bossData.reliveTime)),this.bossData.reliveTime<=0&&(this.rebirthTimer.stop(),this.setBossStates()))},setModel:function(){var e=this;if(e.bossData&&e.bossId!==e.bossData.bossId){if(e.bossId=e.bossData.bossId,!e.bossId)return void b8e.warn("bossId: ",e.bossId);var t=game.AvatarUtil.getUIModel(e.bossCfg),a=e.bossCfg?game.ResCfg.getUrl(5e3,t):null,i=e._model.getAnimator(game.AnimType.BODY,1);(i=i||e._model.addAnimator(game.AnimType.BODY,1))&&(a?(i.load(a),i.play()):i.clear())}},createPrize:function(e){var t=e.getCfg();if(t){var a=void 0;if(a=this.data.firstCollected?t.showItems:t.firstSkilPrize,this.items!=a){this.items=a;var i=game.CfgUtil.getPrizeListInfo(a,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84);this._prizeList.setData(i.items)}}},setHistoryAwrad:function(){this.skin.firstAward.active=!this.data.firstCollected},setWarn:function(){this.skin.gou_1.active=!this.isWarn},btn_warn:function(){this.isWarn=!this.isWarn;var e={id:this.bossId,ignore:this.isWarn};this.send(game.VipBossEvts.V2C_BOSSWARN,e)}}),b8e.RC("$$game","$$VipBossChallengeItem_2",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1240)},init:function(){var e=this.skin,t=this.topList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.VipBossChallengeItem_1,t.bindEnum=game.ME.VipBossChallenge,t.addToParent(e.list_top);var a=this.bottomList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.VipBossChallengeItem_2,a.bindEnum=game.ME.VipBossChallenge,a.addToParent(e.list_bottom),this.data=game.vipBossData},notify:function(e){var t=game.VipBossEvts;switch(e){case t.C2V_UPDATE_VIEW:case t.C2V_UPDATELIST:this.updateTopList(),this.updateBottomList(),this.challengeCount();break;case t.V_SCORLLRIGHT:this.scrollRight();break;case t.V_SCORLLLEFT:this.scrollLeft();break;case t.C2V_UPDATE_ITEM:this.updateBottomList()}},onShow:function(){this.send(this.Evts.V2C_SYSNINFO)},updateBottomList:function(){var e=this.data.getBossData(this.data.curSelect);this.bottomList.setData(e)},updateTopList:function(){this.data.changeSelect();var e=this.data.bossLevelList;this.topList.setData(e)},challengeCount:function(){for(var e=this.skin,t=this.data.bossLevelList,a=t.length,i=void 0,n=this.data.getChallengeMaxCount(),s=void 0,r=0;r<a;r++)(i=t[r]).id!=this.data.curSelect||(s=(s=n-i.count)<1?game.HtmlUtil.getText(game.Color.RED,s):game.HtmlUtil.getText(game.Color.GREEN,s),e.wenzi_2.string=game.Lang.get(50350,s),e.wenzi_1.string=i.name)},scrollRight:function(){this.topList.scrollContainerRight()},scrollLeft:function(){this.topList.scrollContainerLeft()}});b8e.module.registerView(game.ME.VipBossChallenge,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1241),this.setSize(600,254)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=0,e.layout.paddingTop=5,e.layout.spacingX=-5,e.addToParent(this.skin.list),this.bg=b8e.Sprite.get(),this.bg.setAnchor(0,1),this.bg.addToParent(this.skin.bg)},setData:function(e){var t=this.skin;this.data=e,t.lv.string=e.vipLV,t.desc.string=e.desc,t.wenzi_7.string=e.name,this.bg.loadTexture(game.ResCfg.getUrl(10045,e.bgId));var a=e.getPrizeItems();this.list.setData(a),t.redPoint.active=e.alert},btn_kill:function(){this.send(game.VipBossEvts.V2C_SHOWCHALLENGEVIEW,this.data.id)}}),b8e.RC("$$game","$$VipBossMainItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1242)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.VipBossMainItem,t.bindEnum=game.ME.VipBossMain,t.addToParent(e.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.vipBossData.bossLevelList;this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.VipBossMain,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1237)},notify:function(e,t){switch(e){case game.VipBossEvts.C2V_DAMAGE_INFO:break;case game.VipBossEvts.C2V_SKILL_HIT:this.onSkillHit(t)}},onShow:function(){this.updateDamageInfo(game.vipBossData.battleResult)},onSkillHit:function(){var e=game.vipBossData.battleResult.emulator,t=game.vipBossData.selfDamage;this.skin.lab_rank.string=this.getDamageInfoStr(e),this.skin.lab_mine.string=this.getSelfDamageInfoStr(t)},updateDamageInfo:function(e){if(!e)return this.skin.lab_rank.node.active=!1,void(this.skin.lab_mine.node.active=!1);this.skin.lab_rank.node.active=!0,this.skin.lab_mine.node.active=!0,this.setBossHp(e.bossId),this.skin.lab_rank.string=this.getDamageInfoStr(e.emulator),this.skin.lab_mine.string=this.getSelfDamageInfoStr(e.ownDamage)},setBossHp:function(e){var t=game.PublicBossCfg.getData(e);t&&(this.MaxHp=t.hp)},getSelfDamageInfoStr:function(e){if(!e||e.damage<1)return"";var t=game.CCommonUtil.replaceNum(Math.min(this.MaxHp,e.damage),0);return game.Lang.get(517,e.rank,e.roleName,t)},getDamageInfoStr:function(e){if(!e||e.length<1)return"";for(var t,a="",i=0,n=void 0,s=0,r=e.length;s<r&&(t=e[s],n=game.CCommonUtil.replaceNum(Math.min(this.MaxHp,t.damage),0),0<t.damage&&(a+=game.Lang.get(517,t.rank,t.roleName,n),i++),!(3<i));s++);return a},onStageResize:function(){var e=b8e.stageHeight;this.setPosition(0,200+(e>>1))}});b8e.module.registerView(game.ME.VipBossBattle,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_REFRRESH_VIEW_POS:-1,C2V_UPDATE_VIEW:-1,C2V_IN_HIDE_VIEW:-1}),b8e.RC("$$game","$$LimitGiftEvts",e)}(),function(){var e=b8e.Object.extends({currOpenCfg:null,isFirstOpen:!1,canOpen:!0,endTime:0,viewOpenTime:0,ctor:function(){this.gearCfgs=[]},resetData:function(){var e=this.getCurCfg();(!this.currOpenCfg||e&&e.id!=this.currOpenCfg.id)&&(this.gearCfgs.length=0,this.currOpenCfg=e,this.endTime=0)},getGearCfgs:function(){var e=void 0;if(0<this.gearCfgs.length)e=this.gearCfgs;else{var t=this.getCurrOpenCfg();if(!t)return null;if(!(e=game.LimitGiftGearCfg.getData(t.id,!0)))return null;this.gearCfgs=e}return e},getCurrOpenCfg:function(){return this.currOpenCfg||(this.currOpenCfg=this.getCurCfg()),this.currOpenCfg},getCurCfg:function(){var e=game.LimitGiftOpenCfg.getDatas();if(!e||e.length<1)return null;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.checkIsOpen(i))return 0==this.endTime&&(this.endTime=b8e.TimeUtil.dateParse(i.endTime,"yyyy-MM-dd  hh:mm:ss").getTime()),i}return null},checkIsOpen:function(e){var t=e.serverStart,a=e.serverEnd,i=game.miscData.openServerDay,n=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),s=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),r=game.SysTime.curTime;return t<=i&&i<a&&n<=r&&r<=s},checkOpen:function(){return!!this.getCurCfg()},getCountDown:function(){if(!this.currOpenCfg)return 0;var e=game.SysTime.curTime;return this.endTime-e},checkCanOpenView:function(){var e=b8e.module.isShowView(game.ME.LimitGift),t=b8e.module.isShowView(game.ME.Home);return this.checkOpen()&&this.canOpen&&!e&&t},getOpenTime:function(){if(this.viewOpenTime<1){var e=game.LimitGiftMiscCfg.getData("openTime");if(!e)return 0;this.viewOpenTime=+e.value}return this.viewOpenTime}});game.limitGiftData=game.limitGiftData||new e}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.limitGiftData},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily},ActiveBar:{C2C_INIT_ACTIVE_BAR:this.openView,C2C_REFRESH_ACTIVE_BAR:this.updateViewState},MainUIBottom:{C_GO_HOME:this.hideView}},this.gevts={MainUIEvts:{NOT_OPEN_UI:this.onItemClick}}},notify:function(e){switch(e){case this.Evts.C2V_IN_HIDE_VIEW:this.createTimer()}},createTimer:function(){this.moduleData.checkOpen()&&(this.openViewTimer||(this.openViewTimer=b8e.Timer.add(this,this.checkOpenView,this.moduleData.getOpenTime())))},checkOpenView:function(){this.moduleData.checkCanOpenView()?(game.module.showTab(game.ME.LimitGift,game.ME.ActiveBar),b8e.Timer.remove(this,this.checkOpenView),this.openViewTimer=null):this.moduleData.checkOpen()||(b8e.Timer.remove(this,this.checkOpenView),this.openViewTimer=null)},resetDaily:function(){this.moduleData.checkOpen()?(this.moduleData.resetData(),this.send(this.Evts.C2V_UPDATE_VIEW)):game.module.hide(game.ME.LimitGift)},openView:function(){this.moduleData.checkCanOpenView()&&game.module.showTab(game.ME.LimitGift,game.ME.ActiveBar)},hideView:function(){var e=b8e.module.isShowView(game.ME.LimitGift),t=b8e.module.isShowView(game.ME.Home);e&&!t&&game.module.hide(game.ME.LimitGift)},onItemClick:function(e){this.moduleEnum==e.data&&this.gotoView()},gotoBtn:function(){this.gotoView()},gotoView:function(){var e=this.moduleData.getCurCfg();if(e){var t=e.moduleEmul;game.moduleOpen.checkOpen(t)&&(t==game.ME.Festival?(game.festivalData.setOriginMenu(game.ActiveBarItemType.FESTIVAL),game.module.show(t)):game.module.showToggle(t,e.tiggleId))}},updateViewState:function(){var e=game.activeBarData.getLimitGiftPos(),t=this.moduleData.checkOpen();e&&e.active&&t?(this.moduleData.canOpen=!0,this.moduleData.checkCanOpenView()&&game.module.showTab(game.ME.LimitGift,game.ME.ActiveBar),this.send(this.Evts.C2V_REFRRESH_VIEW_POS)):(game.module.hide(game.ME.LimitGift),this.moduleData.canOpen=!1)}});b8e.module.registerControl(game.ME.LimitGift,e,game.LimitGiftEvts)}(),function(){var e=game.View.extends({index:0,timeInterval:10,currTime:0,openTime:0,timeIndex:0,ctor:function(){this._super(1269)},init:function(){this.moduleData=game.limitGiftData;var e=this.skin;this.surfaceModel=new game.SurfaceModel,this.surfaceModel.addToParent(e.modelNode),this.surfaceModel.initModel(),e.bg.loadTexture(game.ResCfg.getUrl(10061));var t=game.LimitGiftMiscCfg.getData("switchTime");t&&(this.timeInterval=+t.value,e.arrow.loadTexture(game.ResCfg.getUrl(10062)))},onShow:function(){this.index=this.currTime=0,this.updateView(),this.updateCountDown(),this.countDownTimer||(this.countDownTimer=b8e.Timer.add(this,this.updateCountDown,1e3))},onHide:function(){this.currTime=0,this.clearTimer(),this.send(this.Evts.C2V_IN_HIDE_VIEW)},notify:function(e){switch(e){case this.Evts.C2V_REFRRESH_VIEW_POS:this.onStageResize();break;case this.Evts.C2V_UPDATE_VIEW:this.updateView()}},updateView:function(){var e=this.skin,t=this.moduleData.getGearCfgs();if(t){var a=t[this.index];if(a){var i=t.length;if(e.gearLab.string=game.Lang.get(10044,a.gear),this.index++,this.index==i&&(this.index=0),a.model){var n=this.surfaceModel.roleData.heroModel;n.body=a.model,n.type=a.roleType,this.surfaceModel.setScale(a.scale,a.scale),game.AvatarUtil.updateBody(this.surfaceModel.role),e.modelNode.active=!0,e.modelImg.active=!1}else e.modelImg.loadTexture(game.ResCfg.getUrl(10060,a.texture)),e.modelNode.active=!1,e.modelImg.active=!0;e.name.loadTexture(game.ResCfg.getUrl(10060,a.name))}}},updateCountDown:function(){var e=this.moduleData.getCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.timeLab.string=game.Lang.get(50396,t)):this.clearTimer(),this.timeIndex++,this.timeIndex==this.timeInterval&&(this.updateView(),this.timeIndex=0)},onStageResize:function(){var e=game.activeBarData.getLimitGiftPos();if(e){var t=e.localToGlobal(),a=t.x+this.width,i=a>b8e.stageWidth?a-b8e.stageWidth+38:38,n=0;t.x+this.width>b8e.stageWidth&&(n=b8e.stageWidth-this.width-t.x),this.skin.arrow.x=i,this.setPosition(e.x+n,e.y)}},clearTimer:function(){this.countDownTimer&&(b8e.Timer.remove(this,this.updateCountDown),this.countDownTimer=null)}});b8e.module.registerView(game.ME.LimitGift,e)}(),function(){var e=game.VerifyAwardView.extends({awardType:7,ctor:function(){this._super(1278)},init:function(){var e=game.VerifyAwardCfg.getData(this.awardType);e&&this.updatePrizeList(e.award)},onShow:function(){this._super(),game.verifyAwardGuideMgr.showAnima(120,60)},onHide:function(){game.verifyAwardGuideMgr.hideAnima()},updateBtn:function(){var e=this.skin,t=game.welfareData.verifyIsGetByType(this.awardType),a=game.LoginConfig.isColorTicketIn;e.isGetImg.active=t,e.view_getBtn.active=!t&&a,e.view_toGetBtn.active=!t&&!a},onStageResize:function(){this._super(),game.verifyAwardGuideMgr.updateAnimaLayout()}});b8e.module.registerView(game.ME.VerifyAwardColorTicket,e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super()},showAnima:function(){var e=void 0;this.anima?e=this.anima:(e=this.anima=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).load(game.ResCfg.getUrl(5019,1001));var t=this.getStagePos();if(t&&(this.updateAnimaLayout(t),e&&!e.parent)){var a=b8e.layer.getGuiTopLayer();e.addToParent(a),e.play()}},getStagePos:function(){var e=b8e.getFPV(window,"qq");if(!e)return null;var t=e.getMenuButtonBoundingClientRect(),a=e.getSystemInfoSync();if(!t||!a)return null;var i=t.top;i=.5*t.height+i;var n=t.left;n=.25*t.width+n;var s=a.screenWidth,r=a.screenHeight,o=b8e.stage.height+b8e.topSpace,g=o-i/r*o,u=n/s*b8e.stage.width;return this.posTemp||(this.posTemp=b8e.createMap()),this.posTemp.x=u,this.posTemp.y=g,this.posTemp},updateAnimaLayout:function(e){var t=this.anima;t&&e&&t.setPosition(e.x,e.y)},hideAnima:function(){var e=this.anima;e&&e.parent&&(e.removeFromParent(),e.stop())}});game.verifyAwardGuideMgr=game.verifyAwardGuideMgr||new e}(),function(){var e=game.GameMenuBarData.extends({ctor:function(){this._super(),this.menuMap=b8e.HashMap.get(),this.activeBarInfoMap=b8e.HashMap.get()},setActiveBtn:function(e,t,a){this.menuId=e,this.activeId=t,this.menuBtn=a},setActiveMap:function(e,t,a){var i=this.menuMap.get(e);i||(i=b8e.HashMap.get(),this.menuMap.set(e,i));var n=i.get(t);n||(n=[],i.set(t,n)),a&&(n.push(a),this.activeBarInfoMap.set(a.id,a))},clearActiveMap:function(e){var t=this.menuMap.get(e);t&&t.clear()},getActiveBtn:function(){return this.menuBtn},getActiveBtns:function(){var e=this.menuMap.get(this.menuId);return e?e.get(this.activeId):null},getCurMiscData:function(){if(!this.menuBtn)return null;var e=this.menuBtn.btnInfo;return e?e.miscData:null},getData:function(e){if(!this.activeBarInfoMap)return null;var t=this.activeBarInfoMap.get(e);return t?t.cfg:null}});game.activeChildrenData=game.activeChildrenData||new e}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_LAYOUT:b8e.enc()}),b8e.RC("$$game","$$ActiveChildrenEvts",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1280)},init:function(){this._moduleNode=b8e.Graphics.get(),this._moduleNode.setAnchor(0,0),this._moduleNode.setLocalZOrder(-11e3),this._moduleNode.addToParent(this),b8e.evt.onC(this._moduleNode,this.onTouchNode,this),this.btnPool=[]},onTouchNode:function(){game.module.hide(this.moduleEnum)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_LAYOUT:this.updateLayout(),this.onStageResize()}},onShow:function(){this.updateLayout(),this.onStageResize()},updateLayout:function(){var e=this,t=game.activeChildrenData,a=t.getCurMiscData();if(a){e.btns=t.getActiveBtns(),e.btnPool.forEach(function(e){e.clearData(),e.setVisible(!1)});for(var i=e.btns.length,n=void 0,s=void 0,r=a.childrenLineCount,o=a.spacingX,g=a.spacingY,u=20,l=-a.iconHeight-g+10,c=0,h=0,m=void 0,d=void 0,f=0;f<i;f++){if(!(s=e.btns[f]))return;e.btnPool[f]?n=e.btnPool[f]:(n=game.MenuBarItem.get(),e.addChild(n),e.btnPool[f]=n),t.isShowActive(s.id)&&(s.countDown=t.getCountDown(s.id),s.actStartTime=t.getActStartTime(s.id),n.setVisible(!0),n.setData(s),n.x=u-s.offsetX,n.y=l-s.offsetY,(f+1)%r==0?(u=20,l-=s.height+g):u+=s.width+o,c<(m=n.x+s.width+o)&&(c=m),h<(d=-n.y+s.height+g)&&(h=d))}h=h-a.iconHeight-o,e.skin.tipsBg_1.setSize(c,h),e.setSize(c,h)}},onStageResize:function(){var e=this,t=b8e.stageWidth,a=b8e.stageHeight,i=game.activeChildrenData.getActiveBtn();if(i){var n=i.localToGlobal();if(n){var s=game.activeChildrenData.getCurMiscData();if(s){var r=void 0,o=void 0,g=void 0,u=.5*t-30,l=.5*e.width,c=void 0,h=void 0,m=s.layoutType,d=e.skin.target,f=s.spacingX;switch(m){case game.LayoutType.TOP:case game.LayoutType.BOTTOM:var p=.5*s.iconWidth;r=n.x>u?l<(g=t-n.x-p)?n.x-l:n.x-e.width+g-f:l<(g=n.x+p)?n.x-l:n.x-g+f,r+=p,m==game.LayoutType.TOP?(o=n.y-15,h=5,d.rotation=180):(o=n.y+s.iconHeight+e.height+15,h=-e.height-5,d.rotation=0),c=n.x-r+p,e.setPosition(r,o),d.setPosition(c,h);break;case game.LayoutType.LEFT:case game.LayoutType.RIGHT:var v=.5*s.iconHeight;r=m==game.LayoutType.LEFT?n.x+s.iconWidth+f+15:n.x-s.iconWidth-15,g=a-n.y>e.height?-15+e.height:.5*e.height+15,o=n.y+g,e.setPosition(r,o),m==game.LayoutType.LEFT?(c=-5,d.rotation=90):(c=e.width+5,d.rotation=270),h=n.y-o+v,e.setPosition(r,o),d.setPosition(c,h)}var E=e.width,T=e.height;if(e._moduleNode){var C=t-E>>1,I=a-T>>1;e._moduleNode.setPosition(-e.x,-e.y),e._moduleNode.fillColor(0),e._moduleNode.setSize(t,a),e._moduleNode.fillRect(-C,-I,t+C,a+I)}}}}}});b8e.module.registerView(game.ME.ActiveChildren,e)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={MainUIBottom:{C_GO_HOME:this.hideView},MainRole:{C_RESET_DAILY:this.resetDaily}}},resetDaily:function(){this.hideView()},hideView:function(){b8e.module.isShowView(this.moduleEnum)&&game.module.hide(this.moduleEnum)}});b8e.module.registerControl(game.ME.ActiveChildren,e,game.ActiveChildrenEvts)}(),function(){var e;e=b8e.Enum({ROLE_LV:1,MAIN_INSTANCE:2,ZHANJIANG:3,ZHAOQIAN:4,BAOZANG:5,HUNTING:6,VIP_LV:7,ACTIVE_PARTNER:8,DAY_UPDATA:9,PARTNER_STAR:10,PARTNER_ACTIVE:11,PARTNER_BIOGRAPHY:12,PARTNER_LVUP:13}),b8e.RC("$$game","$$PushPrizeType",e)}(),function(){var e;e=b8e.Enum({ZHANJIANG:1,ZHAOQIAN:2,BAOZANG:3,HUNTING:4,PARTNER_BIOGRAPHY:5}),b8e.RC("$$game","$$PuhsPrizeConditionSubType",e)}(),function(){var e;e=b8e.Enum({ROLE_LV:1,MAIN_INSTANCE:2,INSTANCE_FUNC:3,VIP_LV:4,ACTIVE_PARTNER:5,DAY_UPDATA:9,PARTNER_STAR:10,PARTNER_ACTIVE:11,PARTNER_LVUP:12}),b8e.RC("$$game","$$PushPrizeConditionType",e)}(),function(){var e=game.GameMenuBarData.extends({selectInfo:null,pushPrizeList:null,isFirstOpenDay:!0,isFirstOpenDay2:!0,ctor:function(){this._super(),this.obj1=b8e.createMap(),this.obj2=b8e.createMap(),this.activeBarInfoMap=b8e.HashMap.get()},setPrize:function(e,t){if(e&&!(e.length<1)){this.pushPrizeList=t;for(var a=void 0,i=void 0,n=void 0,s=void 0,r=0,o=e.length,g=game.mainRoleData.vipLevel,u=0;u<o;u++)n=e[u],(a=this.getCfgByRechargeId(n.id))&&g>=a.vip&&g<=a.vipMax&&(-1<t.indexOf(n.id)||(s=n.expireTime,(i=this.activeBarInfoMap.get(n.id))||(i=game.PushPrizeInfo.get(),this.activeBarInfoMap.set(n.id,i)),i.setData(a,s),r=r&&r<s?r:s));this.expireTime=r}},getTitleBtns:function(){var e=this.activeBarInfoMap.values();return!e||e.length<1?null:(e.sort(this.onSort),e)},onSort:function(e,t){return e.expireTime-t.expireTime},getSelectBtn:function(){return this.selectInfo},getOpenDayRechargeId:function(){var e=game.miscData.openServerDay,t=game.mainRoleData.vipLevel,a=game.PushPrizeConditionType.DAY_UPDATA;return this.getCfgByArgs(a,0,e,t)},getLvRechargeId:function(){var e=game.mainRoleData.lv,t=game.mainRoleData.vipLevel,a=game.PushPrizeConditionType.ROLE_LV;return this.getCfgByArgs(a,0,e,t)},getVipRechargeId:function(){var e=game.mainRoleData.vipLevel,t=game.PushPrizeConditionType.VIP_LV;return this.getCfgByArgs(t,0,e,e)},getMainInsRechargeId:function(){var e=game.mainInstanceData.id-1,t=game.mainRoleData.vipLevel,a=game.PushPrizeConditionType.MAIN_INSTANCE;return this.getCfgByArgs(a,0,e,t)},getPartnerActRechargeId:function(e){if(e){var t=game.mainRoleData.vipLevel,a=game.PushPrizeConditionType.ACTIVE_PARTNER;return this.getCfgByArgs(a,0,e,t)}},getZhanjiangRechargeId:function(){var e=game.mainRoleData.vipLevel,t=game.PushPrizeConditionType.INSTANCE_FUNC,a=game.PuhsPrizeConditionSubType.ZHANJIANG,i=game.zhanjiangData.getLayer();return this.getCfgByArgs(t,a,i,e)},getZhaoqinRechargeId:function(){var e=game.mainRoleData.vipLevel,t=game.PushPrizeConditionType.INSTANCE_FUNC,a=game.PuhsPrizeConditionSubType.ZHAOQIAN,i=game.zhaoqinData.currentLayer;return this.getCfgByArgs(t,a,i,e)},getBaozangRechargeId:function(){var e=game.mainRoleData.vipLevel,t=game.PushPrizeConditionType.INSTANCE_FUNC,a=game.PuhsPrizeConditionSubType.BAOZANG,i=game.baoZangData.curId;return this.getCfgByArgs(t,a,i,e)},getHuntingRechargeId:function(){var e=game.mainRoleData.vipLevel,t=game.PushPrizeConditionType.INSTANCE_FUNC,a=game.PuhsPrizeConditionSubType.HUNTING,i=game.huntingData.currentLayer;return this.getCfgByArgs(t,a,i,e)},getPartnerBiogRechargeId:function(){var e=game.mainRoleData.vipLevel,t=game.PushPrizeConditionType.INSTANCE_FUNC,a=game.PuhsPrizeConditionSubType.PARTNER_BIOGRAPHY,i=game.zhuanJiData.maxSuccessId;return this.getCfgByArgs(t,a,i,e)},getPartnerLvUpRechargeId:function(e){var t=game.mainRoleData.vipLevel,a=game.PushPrizeConditionType.PARTNER_LVUP,i=e.id,n=e.lv;return this.getCfgByArgs(a,i,n,t)},getPartnerActNumRechargeId:function(e){if(e){var t=game.partnerData.getInfoById(e);if(t){var a=game.mainRoleData.vipLevel,i=game.PushPrizeConditionType.PARTNER_ACTIVE,n=t.cfg.quality,s=game.partnerData.getPartnerNumByQuality(n);return this.getCfgByArgs(i,n,s,a)}}},getPartnerStarRechargeId:function(e){if(e){var t=game.partnerData.getInfoById(e);if(t){var a=game.mainRoleData.vipLevel,i=game.PushPrizeConditionType.PARTNER_STAR,n=t.star;return this.getCfgByArgs(i,n,e,a)}}},getCfgByArgs:function(e,t,a,i){this.obj1.conditionType=e,this.obj1.param1=t,this.obj1.param2=a;var n=game.PushPrizeCfg.getData(this.obj1,!0,!1,!1);if(!n||n.length<1)return null;this.tempCfgs||(this.tempCfgs=[]);for(var s=this.tempCfgs,r=void(s.length=0),o=n.length,g=game.CCommonUtil.getGameChannelIdOpen,u=0;u<o;u++)i>=(r=n[u]).vip&&i<=r.vipMax&&g(r)&&(s[s.length]=r);return s},setActivePrize:function(e){var t=e.ids;if(t&&!(t.length<1))for(var a=void 0,i=void 0,n=void 0,s=t.length,r=e.expireTime,o=0;o<s;o++){if(a=t[o],n=game.PushPrizeInfo.get(),!(i=this.getCfgByRechargeId(a)))return;n.setData(i,r),this.compareExpireTime(r),this.activeBarInfoMap.set(a,n)}},compareExpireTime:function(e){this.expireTime=0<this.expireTime&&this.expireTime<e?this.expireTime:e},getExpireTime:function(){return this.expireTime},setReset:function(e){this.isReset=e;var t=this.activeBarInfoMap.values();if(!t||t.length<1)this.expireTime=0;else{for(var a=void 0,i=void 0,n=0,s=t.length,r=game.SysTime.curTime,o=0;o<s;o++)(i=(a=t[o]).expireTime)<=r||a.isGet?e||(this.activeBarInfoMap.del(a.rechargeId),game.PushPrizeInfo.put(a)):n=n&&n<i?n:i;this.expireTime=n}},hideView:function(){this.isReset&&this.setReset(!1)},showView:function(){var e=this;if(!e.selectInfo||!e.activeBarInfoMap.get(e.selectInfo.rechargeId)){e.selectInfo=null;var t=e.activeBarInfoMap.values();if(t&&!(t.length<1)){t.sort(e.onSort);for(var a=void 0,i=t.length,n=0;n<i;n++)if(!(a=t[n]).isGet)return e.selectInfo=a,void e.selectInfo.setSelect(!0);e.selectInfo=t[0],e.selectInfo.setSelect(!0)}}},selectBtn:function(e){var t=this.activeBarInfoMap.get(e);t&&(t.setSelect(!0),this.selectInfo&&this.selectInfo.rechargeId!=t.rechargeId&&this.selectInfo.setSelect(!1),this.selectInfo=t)},setRechargeId:function(e){var t=this.activeBarInfoMap.get(e);return!!t&&(this.pushPrizeList||(this.pushPrizeList=[]),this.pushPrizeList.push(e),t.isGet=!0)},checkAlert:function(){var e=this.activeBarInfoMap.values();if(!e||e.length<1)return!1;for(var t=e.length,a=0;a<t;a++)if(e[a].alert)return!0;return!1},getIsShow:function(){return 0<this.activeBarInfoMap.count()},canSendRechargeId:function(e){if(!e)return!1;if(!this.pushPrizeList||this.pushPrizeList.length<1)return!0;var t=this.pushPrizeList.indexOf(e)<0,a=this.activeBarInfoMap.get(e);return t&&!a},getCountdown:function(){return this.expireTime?this.expireTime-game.SysTime.curTime:0},getCfgByRechargeId:function(e){return this.obj2.rechargeId=e,game.PushPrizeCfg.getData(this.obj2)},isGetRechargeId:function(e){if(!e)return!1;return!this.pushPrizeList||this.pushPrizeList.length<1||this.pushPrizeList.indexOf(e)<0}});game.pushPrizeData=game.pushPrizeData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({rechargeId:0,select:!1,alert:!1,expireTime:0,isGet:!1,setData:function(e,t){this.cfg=e,this.alert=!0,this.initPrizeList=!1,this.rechargeId=e.rechargeId,this.expireTime=t},setAlert:function(e){this.alert=e},setSelect:function(e){this.select=e},setGet:function(e){this.isGet=e},getCfg:function(){return this.cfg},getPrizeList:function(){if(this.initPrizeList&&this.prizeList)return this.prizeList;if(!this.cfg)return null;this.prizeList=[];var e=this.cfg.giveItems;if(!e||e.length<1)return null;for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num),this.prizeList.push(i);return this.prizeList},recycle:function(){this.reset(),this._super()},reset:function(){this.rechargeId=0,this.select=!1,this.alert=!1,this.expireTime=0,this.initPrizeList=!1,this.isGet=!1}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,256),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$PushPrizeInfo",t)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_LIST:b8e.enc(),V2C_SELECT_BTN:b8e.enc(),C2V_UPDATE_PAGE:b8e.enc(),V2C_HIDE_VIEW:b8e.enc(),C2C_RECHARGE:b8e.enc(),C2C_REFRESH_BTNS:b8e.enc(),V2C_SHOW_VIEW:b8e.enc(),C2C_DELAY_SHOW_VIEW:b8e.enc()}),b8e.RC("$$game","$$PushPrizeEvts",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1284),this.setSize(150,51)},init:function(){},setData:function(){var e=this.skin,t=this.data;if(t){var a=t.getCfg();a&&(e.title.string=(t.select,game.HtmlUtil.getText(game.Color.WHITE,a.name)),e.selectImg.active=t.select,e.alert.active=t.alert)}},clickBtn:function(){this.send(game.PushPrizeEvts.V2C_SELECT_BTN,this.data.rechargeId)}}),b8e.RC("$$game","$$PushPrizeTitleItem",e)}(),function(){var e;e=game.ListItem.extends({_icon:null,_data:null,ctor:function(){this._super("pushPrize/push_prize_award_item"),this.setSize(106,117)},setData:function(){if(this.data){var e=this.data;this._icon||(this._icon=game.GridUtil.createItemIcon(),this._icon.addToParent(this.skin.iconImg)),this._icon.setItemInfo(e,!1,game.IconLayoutEnum.SHOW_NUM),this._icon.setBgImage("")}}});b8e.RC("$$game","$$PushPrizeAwardItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1283)},init:function(){var e=this.skin,t=this.titleList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.PushPrizeTitleItem,t.addToParent(e.scrollView),t.bindEnum=game.ME.PushPrize,t.layout.spacingX=3,t.layout.paddingLeft=0,t.layout.paddingRight=0;var a=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.PushPrizeAwardItem,a.addToParent(e.prizeList),a.layout.paddingLeft=6,a.layout.paddingTop=-5,a.layout.spacingX=2,this.timer=b8e.Timer.add(this,this.updateTime,500)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_LIST:this.btns=game.pushPrizeData.getTitleBtns(),this.titleList.setData(this.btns),this.updatePage();break;case this.Evts.C2V_UPDATE_PAGE:this.updatePage()}},onShow:function(){this.btns=game.pushPrizeData.getTitleBtns(),this.titleList.setData(this.btns),this.send(this.Evts.V2C_SHOW_VIEW),this.updatePage()},onHide:function(){this.stopTime(),this.send(this.Evts.V2C_HIDE_VIEW)},updatePage:function(){var e=this.skin,t=game.pushPrizeData.getSelectBtn();if(t){t.setAlert(!1),this.updatePrizeList(t);var a=t.getCfg();if(a){var i="";0<a.langId&&(i=game.Lang.get(a.langId,a.replaceValue));var n=i.split("|"),s=n&&n[0]?n[0]:"",r=n&&n[1]?n[1]:"";e.desc.string=s+r,this.endTime=t.expireTime,this.timer.reset(),this.timer.start();var o=game.RechargeCfg.getDataById(a.rechargeId);o&&(e.titleImg.loadTexture(game.ResCfg.getUrl(10075,a.bgUrl)),e.desc_img.loadTexture(game.ResCfg.getUrl(10184,a.discountImg)),e.moneyLab.string="B"+o.money+"Y",e.oldMoneyLab.string="A"+a.oldMoney+"Y",e.lineImg.width=e.oldMoneyLab.width+50,e.rechargeBtn.active=!t.isGet,e.isGetBtn.active=t.isGet)}}},updateTime:function(){var e=this.skin.time,t=this.endTime;if(!t)return e.string=game.Lang.get(9053),void this.stopTime();var a=t-game.SysTime.curTime;if(a<=0)return e.string=game.Lang.get(9053),void this.stopTime();var i=game.TimeUtil.formatTimeSpace(a);e.string=game.Lang.get(51304,i)},stopTime:function(){this.timer&&this.timer.stop(),b8e.module.isShowView(game.ME.PushPrize)&&game.module.hide(game.ME.PushPrize)},updatePrizeList:function(e){var t=e.getPrizeList();!t||t.length<1||this.prizeList.setData(t)},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.PushPrize,e)}(),function(){var e=game.Control.extends({isOpen:!1,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.PUSH_PRIZE,game.SAE.HOME),this.tempPartners=[]},ipc:function(){var e=this;e.evts={MainRole:{C_LEVEL_UP:e.updateLv,C_VIP_LEVEL_CHANGE:e.updateVip},MainInstance:{C2C_CHALLENGE_WIN_2:e.updateMainInstance},ZhanJiang:{C2C_CHALLENGE_WIN:e.updateZhanjiang},ZhaoQin:{C2C_CHALLENGE_WIN:e.updateZhaoqin},BaoZang:{C2C_CHALLENGE_WIN:e.updateBaozang},Hunting:{C2C_CHALLENGE_WIN:e.updateHunting},Recharge:{C_INIT_MODEL:e.syncRechargeModel,C_RECHARGE_SUCCESS:e.rechargeSuccess},Partner:{C_UPDATE_ACTIVE:e.updatePartnerActive,C2C_CHECK_PUSH_PRIZE:e.checkPushPrize},PartnerStar:{V_UPDATE_STAR:e.updateStar},ZhuanJiBattle:{C2C_CHALLENGE_SUCCEED:e.updateZhuanJi},PartnerUpgrade:{V_UPDATE_LV:e.updatePartnerLv}},e.handels={PushPrizeResp:e.pushPrizeResp}},notify:function(e,t){var a=this;switch(e){case a.Evts.V2C_SELECT_BTN:game.pushPrizeData.selectBtn(t),a.send(a.Evts.C2V_UPDATE_PAGE);break;case a.Evts.V2C_HIDE_VIEW:game.pushPrizeData.hideView(),a.dpt(a.Evts.C2C_REFRESH_BTNS),a.checkAlert();break;case a.Evts.V2C_SHOW_VIEW:game.pushPrizeData.showView(),a.send(a.Evts.C2V_UPDATE_PAGE)}},triggerOpen:function(e){e==this.moduleEnum&&(this.isOpen=!0,this.checkAlert())},pushPrizeResp:function(e){var t=this,a=e.readProtobuf(game.pb.PushPrizeResponse);if(0<a.code)game.notice.noticeError(a.code);else{var i=game.pushPrizeData;if(i.getIsShow()&&t.dpt(t.Evts.C2C_REFRESH_BTNS),i.setActivePrize(a),t.setExpireTime(),b8e.module.isShowView(t.moduleEnum))t.send(t.Evts.C2V_UPDATE_LIST);else if(a.ids&&0<a.ids.length){var n=a.ids[0];i.selectBtn(n);var s=i.getCfgByRechargeId(n);s&&s.conditionType!=game.PushPrizeConditionType.ACTIVE_PARTNER?game.gamePopupMgr.show(t.moduleEnum):t.dpt(t.Evts.C2C_DELAY_SHOW_VIEW)}t.checkAlert(!0)}},syncRechargeModel:function(){var e=game.rechargeData.pushPrize,t=game.rechargeData.pushExpire;game.pushPrizeData.setPrize(t,e),game.pushPrizeData.getIsShow()&&this.dpt(this.Evts.C2C_REFRESH_BTNS),game.pushPrizeData.isFirstOpenDay&&(game.pushPrizeData.isFirstOpenDay=!1,this.updataOPenDay()),this.checkAlert(),this.setExpireTime()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data;if(t.id)game.pushPrizeData.setRechargeId(t.id)&&(game.pushPrizeData.setReset(!0),this.send(this.Evts.C2V_UPDATE_PAGE))}},setExpireTime:function(){var e=game.SysTime.curTime;if(this.expireTime=game.pushPrizeData.getExpireTime(),this.expireTime&&!(this.expireTime<e)){var t=this.expireTime-e;if(this.timer){var a=this.timer;a.stop(),a.delay=t,a.reset(),a.start()}else this.timer=b8e.Timer.add(this,this.endTime,t,1)}},endTime:function(){var e=b8e.module.isShowView(this.moduleEnum);game.pushPrizeData.setReset(e),this.setExpireTime(),e||this.dpt(this.Evts.C2C_REFRESH_BTNS)},checkAlert:function(e){this.spotAlert.alert=!!e||game.pushPrizeData.checkAlert()},updateLv:function(){this.sendRechargeIdByType(game.PushPrizeType.ROLE_LV)},updateVip:function(){this.sendRechargeIdByType(game.PushPrizeType.VIP_LV)},updateMainInstance:function(){this.sendRechargeIdByType(game.PushPrizeType.MAIN_INSTANCE)},updataOPenDay:function(){this.sendRechargeIdByType(game.PushPrizeType.DAY_UPDATA)},updatePartnerActive:function(e){if(e&&e.data){var t=e.data;this.tempPartners.push(t),this.sendRechargeIdByType(game.PushPrizeType.ACTIVE_PARTNER,t),this.sendRechargeIdByType(game.PushPrizeType.PARTNER_ACTIVE,t)}},updateStar:function(e){if(e&&e.data){var t=e.data;this.sendRechargeIdByType(game.PushPrizeType.PARTNER_STAR,t.id)}},updateZhanjiang:function(){this.sendRechargeIdByType(game.PushPrizeType.ZHANJIANG)},updateZhaoqin:function(){this.sendRechargeIdByType(game.PushPrizeType.ZHAOQIAN)},updateBaozang:function(){this.sendRechargeIdByType(game.PushPrizeType.BAOZANG)},updateHunting:function(){this.sendRechargeIdByType(game.PushPrizeType.HUNTING)},updateZhuanJi:function(){this.sendRechargeIdByType(game.PushPrizeType.PARTNER_BIOGRAPHY)},updatePartnerLv:function(e){if(e&&e.data){var t=e.data;this.sendRechargeIdByType(game.PushPrizeType.PARTNER_LVUP,t)}},sendRechargeIdByType:function(e,t){if(this.isOpen){var a=void 0,i=game.PushPrizeType;switch(e){case i.ROLE_LV:a=game.pushPrizeData.getLvRechargeId();break;case i.MAIN_INSTANCE:a=game.pushPrizeData.getMainInsRechargeId();break;case i.ZHANJIANG:a=game.pushPrizeData.getZhanjiangRechargeId();break;case i.ZHAOQIAN:a=game.pushPrizeData.getZhaoqinRechargeId();break;case i.BAOZANG:a=game.pushPrizeData.getBaozangRechargeId();break;case i.HUNTING:a=game.pushPrizeData.getHuntingRechargeId();break;case i.VIP_LV:a=game.pushPrizeData.getVipRechargeId();break;case i.ACTIVE_PARTNER:a=game.pushPrizeData.getPartnerActRechargeId(t);break;case i.DAY_UPDATA:a=game.pushPrizeData.getOpenDayRechargeId();break;case i.PARTNER_BIOGRAPHY:a=game.pushPrizeData.getPartnerBiogRechargeId();break;case i.PARTNER_ACTIVE:a=game.pushPrizeData.getPartnerActNumRechargeId(t);break;case i.PARTNER_STAR:a=game.pushPrizeData.getPartnerStarRechargeId(t);break;case i.PARTNER_LVUP:a=game.pushPrizeData.getPartnerLvUpRechargeId(t)}if(a&&!(a.length<1)){this.tempIds||(this.tempIds=[]);for(var n=void(this.tempIds.length=0),s=a.length,r=game.pushPrizeData.activeBarInfoMap,o=0;o<s;o++)n=a[o].rechargeId,game.pushPrizeData.canSendRechargeId(n)&&(e==i.DAY_UPDATA&&r.get(n)?game.pushPrizeData.isFirstOpenDay2&&(game.pushPrizeData.isFirstOpenDay2=!1,game.gamePopupMgr.show(this.moduleEnum)):this.tempIds.push(n));this.tempIds.length<1||this.sender.PushPrizeReq(this.tempIds)}}},checkPushPrize:function(){var e=this.tempPartners;if(e&&!(e.length<1)){for(var t=void 0,a=void 0,i=e.length,n=game.pushPrizeData,s=void 0,r=0;r<i;r++)if(a=e[r],(s=n.getPartnerActRechargeId(a))&&!(s.length<1))for(var o=0;o<s.length;o++)if((t=s[o])&&n.isGetRechargeId(t.rechargeId)){b8e.module.isShowView(this.moduleEnum)||game.gamePopupMgr.show(this.moduleEnum);break}e.length=0}},rechargeBtn:function(){var e=game.pushPrizeData.getSelectBtn();if(e)if(e.expireTime<game.SysTime.curTime)game.notice.show("\u5df2\u8d85\u8fc7\u8d2d\u4e70\u65f6\u95f4,\u8bf7\u91cd\u65b0\u6253\u5f00\u754c\u9762\u5237\u65b0");else{this.dpt(this.Evts.C2C_RECHARGE,e.rechargeId)}}}),t=game.Sender.extends({ipc:function(){this.msg={PushPrizeReq:this.pushPrizeReq}},pushPrizeReq:function(e){var t=game.pb.PushPrizeRequest;t.ids=e,this.write(t)}});b8e.module.registerControl(game.ME.PushPrize,e,game.PushPrizeEvts,t)}(),function(){var e;e=b8e.Enum({None:0,C2V_OPEN_CHAT:-1,C2V_SHOW_TWEEN:-1,C2V_UPDATE_VIEW:-1,C2V_INIT_MISC_DATA:-1}),b8e.RC("$$game","$$MysteriousEggEvts",e)}(),function(){var e=b8e.Object.extends({isShowTween:!1,eggLv:0,eggTime:0,eggFlag:!1,_minLv:0,_maxLv:0,ctor:function(){this.cfgs=[]},setData:function(e){this.eggLv=e.mysteryEggLv,this.eggTime=e.mysteryEggTime,this.eggFlag=e.mysteryEggFlag},minLv:{get:function(){return 0==this._minLv&&(this._minLv=this.getMiscData("minLv")),this._minLv}},maxLv:{get:function(){return 0==this._maxLv&&(this._maxLv=this.getMiscData("maxLv")),this._maxLv}},getMiscData:function(e){var t=game.MysteryEggMiscCfg.getData(e);return t?+t.value:0},updateData:function(e){this.eggLv=e,this.eggFlag=!1},getCfgs:function(){if(0<this.cfgs.length)return this.cfgs;var e=game.MysteryEggCfg.getDatas();return e?(e.sort(this.cfgSort),this.cfgs=e):null},cfgSort:function(e,t){return e.lv-t.lv},checkCanShowEgg:function(){return this.eggLv>=this.minLv&&this.eggLv<this.maxLv||this.eggLv==this.maxLv&&0==this.eggFlag},getCurrCfg:function(){var e=game.MysteryEggCfg.getData(this.eggLv);return e||null},getHatchTime:function(){var e=this.getCurrCfg();if(!e)return 0;var t=e.duration;return this.eggTime+t-game.SysTime.unixTime},checkIsHatchState:function(){return 0<this.getHatchTime()}});game.mysteriousEggData=game.mysteriousEggData||new e}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.mysteriousEggData},ipc:function(){this.handels={MysteryEggAwardResp:this.mysteryEggAwardResp},this.evts={MainRole:{C_LEVEL_UP:this.onLevelUp,C_INIT_MSIC_DATA:this.initMsicData}}},initMsicData:function(){this.moduleData.checkCanShowEgg()?(this.moduleData.isShowTween=!1,game.module.show(game.ME.MysteriousEgg),this.send(this.Evts.C2V_INIT_MISC_DATA)):b8e.module.isShowView(game.ME.MysteriousEgg)&&game.module.hide(game.ME.MysteriousEgg)},mysteryEggAwardResp:function(e){var t=e.readProtobuf(game.pb.MysteryEggAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.MysteryEggCfg.getData(t.lv);if(!a.nextLv)return game.module.hide(game.ME.MysteriousEgg),void(this.moduleData.eggFlag=!0);game.mainRoleData.lv>=a.nextLv?(this.moduleData.eggLv=a.nextLv,this.moduleData.eggFlag=!1,this.moduleData.eggTime=game.SysTime.unixTime,game.module.hide(game.ME.MysteriousEgg),game.module.show(game.ME.MysteriousEggHatch)):this.moduleData.eggFlag=!0,this.send(this.Evts.C2V_UPDATE_VIEW)}},onLevelUp:function(){var e=this,t=game.mainRoleData.lv;if(e.moduleData.minLv==t)e.moduleData.eggTime=game.SysTime.unixTime,e.moduleData.eggLv=e.moduleData.minLv,game.module.show(game.ME.MysteriousEggHatch);else{var a=e.moduleData.getCurrCfg();if(!a)return;a.nextLv==t&&e.moduleData.eggFlag&&(e.moduleData.eggTime=game.SysTime.unixTime,e.moduleData.eggLv=t,e.moduleData.eggFlag=!1,game.module.hide(game.ME.MysteriousEgg),game.module.show(game.ME.MysteriousEggHatch),e.send(e.Evts.C2V_UPDATE_VIEW))}},hatchBtn:function(){this.moduleData.isShowTween=!0,game.module.hide(game.ME.MysteriousEggHatch),game.module.show(game.ME.MysteriousEgg)},getBtn:function(){if(this.moduleData.eggFlag){var e=this.moduleData.getCurrCfg();if(!e)return;var t=e.nextLv;game.notice.show(51301,t)}else if(this.moduleData.checkIsHatchState()){var a=this.moduleData.getHatchTime(),i=game.TimeUtil.formatTimeSpace(1e3*a,3);game.notice.show(51300,i)}else this.sender.MysteryEggAwardReq()}}),t=[game.ME.MysteriousEggHatch],a=game.Sender.extends({ipc:function(){this.msg={MysteryEggAwardReq:null}}});b8e.module.registerControl(game.ME.MysteriousEgg,e,game.MysteriousEggEvts,a,t)}(),function(){var e=game.View.extends({shakeTime:0,loopNum:0,isTween:!1,ctor:function(){this._super(1287),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},init:function(){this.moduleData=game.mysteriousEggData},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:case this.Evts.C2V_INIT_MISC_DATA:this.updateView()}},onShow:function(){var e=this,t=e.skin;e.updateView(),e.moduleData.isShowTween?(e.moduleData.isShowTween=!1,e.setPosition(b8e.stageWidth/2,b8e.stageHeight/2+300),e.setScale(1.6,1.6),e.isTween=!0,t.timebg.active=t.timeLab.active=!1,b8e.Tween.get(e).wait(500).to({scaleX:1,scaleY:1},500).call(e.tweenPos,e)):(e.onEnd(),e.setScale(1,1))},onHide:function(){this.clearEffect(),b8e.Tween.kill(this),this.clearTimer()},updateView:function(){var e=this,t=e.skin,a=e.moduleData.getCurrCfg();if(a)if(e.moduleData.eggFlag){t.timeLab.string=game.Lang.get(51298,a.nextLv),t.redPoint.active=!1,t.eggNode.active=!0;var i=game.MysteryEggCfg.getData(a.nextLv);if(!i)return;t.eggIcon.loadTexture(game.ResCfg.getUrl(10074,i.eggIcon)),e.clearEffect()}else e.moduleData.checkIsHatchState()?(e.timer||(e.updateActTime(),e.timer=b8e.Timer.add(e,e.updateActTime,1e3)),t.eggIcon.loadTexture(game.ResCfg.getUrl(10074,a.eggIcon)),t.redPoint.active=!1,t.eggNode.active=!0,e.clearEffect()):(t.redPoint.active=!0,t.timeLab.string=game.Lang.get(51297),t.eggNode.active=!1,e.showEffect())},showEffect:function(){var e=this.moduleData.getCurrCfg();if(e){var t=game.ResCfg.getUrl(5019,e.effect);this.effectAnim||(this.effectAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this.effectAnim.setAnchor(.5,.5),this.effectAnim.addToParent(this.skin.effectNode)),this.effectAnim.load(t),this.effectAnim.play()}},clearEffect:function(){this.effectAnim&&(this.effectAnim.clear(),this.effectAnim=null)},tweenPos:function(){var e=b8e.stageWidth/2;this.endPosY=420,b8e.Tween.get(this).wait(500).to({x:e,y:this.endPosY},1e3).call(this.tweenEnd,this)},tweenEnd:function(){var e=b8e.stageWidth/2;this.y!=this.endPosY?b8e.Tween.get(this).to({x:e,y:this.endPosY},260).call(this.onEnd,this):this.onEnd()},onEnd:function(){var e=this.skin;e.timebg.active=e.timeLab.active=!0,this.isTween=!1,this.startShakeTween()},updateActTime:function(){var e=this.skin,t=game.mysteriousEggData.getHatchTime();if(0<t){var a=game.TimeUtil.formatTimeSpace(1e3*t,3);e.timeLab.string=game.Lang.get(51296,a),this.shakeTime++,10==this.shakeTime&&this.startShakeTween()}else this.clearTimer(),this.updateView()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},startShakeTween:function(){b8e.Tween.get(this.skin.eggNode,{loop:!0}).to({rotation:15},100).to({rotation:-15},100).call(this.onComplete,this)},onComplete:function(){this.loopNum++,5<this.loopNum&&(this.loopNum=0,this.shakeTime=0,this.skin.eggNode.rotation=0,b8e.Tween.kill(this.skin.eggNode))},onStageResize:function(){var e=b8e.stageWidth/2;this.setPosition(e,320)}});b8e.module.registerView(game.ME.MysteriousEgg,e)}(),function(){var e=game.View.extends({_showModel:!0,hideTime:10,timeIndex:0,ctor:function(){this._super(1288)},init:function(){this.moduleData=game.mysteriousEggData,this.setEggIcon()},setEggIcon:function(){var e=game.mysteriousEggData.getCfgs();if(e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],i=n+1,this.getComponent("eggIcon"+i).loadTexture(game.ResCfg.getUrl(10074,a.eggIcon)),this.getComponent("element"+i).loadTexture(game.ResCfg.getUrl(10048,a.element))},onShow:function(){this.hideTimer||(this.hideTimer=b8e.Timer.add(this,this.updateCountDown,1e3))},onHide:function(){this.hideTimer&&(b8e.Timer.remove(this,this.updateCountDown),this.hideTimer=null),this.timeIndex=0},updateCountDown:function(){this.timeIndex++;var e=this.hideTime-this.timeIndex;this.skin.timeLab.string=game.Lang.get(51299,e),e<1&&(game.module.hide(game.ME.MysteriousEggHatch),this.moduleData.isShowTween=!0,game.module.show(game.ME.MysteriousEgg))}});b8e.module.registerView(game.ME.MysteriousEggHatch,e)}(),function(){var e=game.View.extends({gotoME:null,gotoIndex:null,ctor:function(){this._super(1282)},init:function(){var e=game.WelfareMiscCfg.getData("vipBossBg");if(e&&e.value){var t=game.ResCfg.getImgUrl(e.value,!0);this.skin.bg.loadTexture(t)}},onShow:function(){},onHide:function(){},view_gotoBtn:function(){if(!this.gotoME){var e=game.WelfareMiscCfg.getData("vipBossGoto");if(!e||!e.value)return;var t=e.value.split("|");if(!t||t.length<1)return;this.gotoME=+t[0],this.gotoIndex=t[1]?+t[1]:null}null!==this.gotoIndex?game.module.showToggle(this.gotoME,this.gotoIndex):game.module.show(this.gotoME)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.VipBossWelfare,e)}(),function(){var e;e=b8e.Object.extends({x:0,y:0,width:0,hight:0}),b8e.RC("$$game","$$Boundary",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({_dragArrivals:null,_dragTarget:null,_collisionCallBack:null,_collisionThisArgs:null,_placeCallBack:null,_placeThisArgs:null,_clickCallBack:null,_clickThisArgs:null,_options:null,_isAddTouch:!1,_boundary:null,_dragStartPoint:null,_stagePoint:null,_isButton:!1,_autoGoto:!0,_autoBack:!0,isDisable:!1,_isMove:!1,ctor:function(){this._dragArrivals=b8e.HashMap.get(),this._dragStartPoint={x:0,y:0},this._stagePoint={x:0,y:0}},setDragData:function(e,t,a,i,n,s,r,o,g,u){var l=this;l._dragTarget=e,l.updateDragArrivals(t),l._collisionCallBack=r,l._collisionThisArgs=o,l._clickCallBack=n,l._clickThisArgs=s,l._placeCallBack=a,l._placeThisArgs=i,l._boundary=g,l._options=u,l._options&&null!=l._options.autoGoto&&(l._autoGoto=l._options.autoGoto),l._options&&null!=l._options.autoBack&&(l._autoBack=l._options.autoBack),l._addTouch()},_addTouch:function(){b8e.evt.onTouchStart(this._dragTarget,this._onTouchBegin,this),b8e.evt.onTouchEnd(this._dragTarget,this._onTouchEndCapture,this)},_removeTouch:function(){var e=this;if(e._dragTarget&&(b8e.evt.offTouchStart(e._dragTarget,e._onTouchBegin,e),b8e.evt.offTouchEnd(e._dragTarget,e._onTouchEndCapture,e)),e._isAddTouch){e._isAddTouch=!1;var t=b8e.root;b8e.evt.offTouchMove(t,e._onTouchMove,e),b8e.evt.offTouchEnd(t,e._onTouchEnd,e),b8e.evt.offTouchCancel(t,e._onTouchEnd,e)}},_onTouchBegin:function(e){this.isDisable||(this.beginX=e.stageX,this.beginY=e.stageY,this.beginDrag())},beginDrag:function(){var e=this;if(!e._isAddTouch){e._isMove=!1,e._isAddTouch=!0;var t=b8e.root;b8e.evt.onTouchMove(t,e._onTouchMove,e),b8e.evt.onTouchEnd(t,e._onTouchEnd,e),b8e.evt.onTouchCancel(t,e._onTouchEnd,e),e._dragStartPoint.x=e._dragTarget.x,e._dragStartPoint.y=e._dragTarget.y,e._isButton=e._dragTarget.isButton,e._dragTarget.isButton=!1}},_onTouchEndCapture:function(e){this._onTouchEnd(e)},_onTouchMove:function(e){var t=this;if(t._dragTarget.parent){if(null==t.beginX||null==t.beginY||2<Math.abs(e.stageX-t.beginX)||2<Math.abs(e.stageY-t.beginY)){t._isMove=!0;var a=t._dragTarget.parent;t._stagePoint.x=e.stageX,t._stagePoint.y=e.stageY,t._localPoint=a.globalToLocal(t._stagePoint),t._boundary&&(t._boundary.x>t._localPoint.x&&(t._localPoint.x=t._boundary.x),t._boundary.y>t._localPoint.y&&(t._localPoint.y=t._boundary.y),t._localPoint.x>t._boundary.x+t._boundary.width&&(t._localPoint.x=t._boundary.x+t._boundary.width),t._localPoint.y>t._boundary.y+t._boundary.height&&(t._localPoint.y=t._boundary.y+t._boundary.height)),t._dragTarget.setPosition(t._localPoint.x,t._localPoint.y);var i=t._dragArrivals.keys(),n=void 0,s=void 0;if(i&&i.length)for(var r=0,o=i.length;r<o;r++)n=i[r],t._localPoint=n.globalToLocal(t._stagePoint),s=t.hitTest(n,t._localPoint),n.setScale(s?1.2:1,s?1.2:1),n.alpha=s?.4:1,t._collisionCallBack&&s&&t._collisionCallBack.call(t._collisionThisArgs,t._dragTarget,n,s)}}else b8e.warn("\u62d6\u62fd\u76ee\u6807\u6ca1\u6709\u7236\u8282\u70b9\u65e0\u6cd5\u62d6\u62fd")},hitTest:function(e,t){var a=e.width,i=e.height,n=e.anchorX*a,s=e.anchorY*i;return t.x>=-n&&t.x<=a-n&&t.y<=i-s&&t.y>=-s},_onTouchEnd:function(e){var t=this;if(!t._isMove&&t._clickCallBack&&t._clickCallBack.call(t._clickThisArgs,t._dragTarget),!t.isDisable){if(t._isAddTouch){t._isAddTouch=!1;var a=b8e.root;b8e.evt.offTouchMove(a,t._onTouchMove,t),b8e.evt.offTouchEnd(a,t._onTouchEnd,t),b8e.evt.offTouchCancel(a,t._onTouchEnd,t)}var i=t._dragArrivals.keys(),n=void 0,s=void 0,r=!1;if(t._stagePoint.x=e.stageX,t._stagePoint.y=e.stageY,i&&i.length)for(var o=0,g=i.length;o<g;o++)n=i[o],t._localPoint=n.globalToLocal(t._stagePoint),n.setScale(1,1),n.alpha=1,!r&&t.hitTest(n,t._localPoint)&&(r=!0,s=n,t._placeCallBack&&t._placeCallBack.call(t._placeThisArgs,t._dragTarget,n));var u=0,l=0;l=r&&t._autoGoto?(t._localPoint=t._dragTarget.parent.globalToLocal(s.localToGlobal()),u=t._localPoint.x,t._localPoint.y):t._autoBack?(u=t._dragStartPoint.x,t._dragStartPoint.y):(u=t._dragTarget.x,t._dragTarget.y),r||t._placeCallBack.call(t._placeThisArgs,t._dragTarget,null),b8e.Tween.get(t._dragTarget,null,null).to({x:u,y:l},50),t._dragTarget.isButton=t._isButton,e.stopPropagation()}},updateDragArrivals:function(e){if(this._dragArrivals.clear(),e)for(var t=0,a=e.length;t<a;t++)this._dragTarget!=e[t]?this._dragArrivals.set(e[t],!0):b8e.warn("\u4e0d\u80fd\u4ee5\u81ea\u8eab\u4e3a\u76ee\u7684\u5730")},addDragArrivals:function(e){this._dragArrivals.has(e)||this._dragArrivals.set(e,!0)},removeDragArrivals:function(e){this._dragArrivals.has(e)&&this._dragArrivals.del(e)},restore:function(){this._super(),this.reset()},recycle:function(){this.reset(),this._super()},release:function(){t.put(this)},reset:function(){var e=this;e._removeTouch(),e._dragArrivals.clear(),e._dragTarget=null,e._collisionCallBack=null,e._collisionThisArgs=null,e._placeCallBack=null,e._placeThisArgs=null,e._options=null,e._isAddTouch=null,e._boundary=null,e._dragStartPoint.y=e._dragStartPoint.x=0,e._stagePoint.y=e._stagePoint.x=0,e._isButton=!1,e._autoGoto=!0,e._autoBack=!0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$DragEffectItem",t)}(),function(){var e=void 0;(e=b8e.Object.extends({_dragMap:null,ctor:function(){this._dragMap=b8e.HashMap.get()},addDrag:function(e,t,a,i,n,s,r,o,g,u){var l=void 0;return e&&e.__BaseDisplay?(this._dragMap.has(e)?(b8e.warn("\u62d6\u62fd\u5bf9\u8c61\u5df2\u5b58\u5728,\u8bf7\u52ff\u91cd\u590d\u6dfb\u52a0"),l=this._dragMap.get(e)):((l=game.DragEffectItem.get()).setDragData(e,t,a,i,n,s,r,o,g,u),this._dragMap.set(e,l)),l):(b8e.error("\u62d6\u62fd\u5fc5\u987b\u662f\u4e2a\u6709\u6548\u7684\u663e\u793a\u5bf9\u8c61"),null)},delDrag:function(e){var t=this._dragMap.get(e);t&&t.release(),this._dragMap.del(e)},updateArrivals:function(e,t){this._dragMap.has(e)?this._dragMap.get(e).updateDragArrivals(t):b8e.error("\u62d6\u62fd\u5bf9\u8c61\u4e0d\u5b58\u5728,\u8bf7\u5148\u521b\u5efa")},addArrivals:function(e,t){this._dragMap.has(e)?this._dragMap.get(e).addDragArrivals(t):b8e.error("\u62d6\u62fd\u5bf9\u8c61\u4e0d\u5b58\u5728,\u8bf7\u5148\u521b\u5efa")},delArrivals:function(e,t){this._dragMap.has(e)?this._dragMap.get(e).removeDragArrivals(t):b8e.error("\u62d6\u62fd\u5bf9\u8c61\u4e0d\u5b58\u5728,\u8bf7\u5148\u521b\u5efa")}}))._inst=null,e.inst=function(){return null==e._inst&&(e._inst=new e),e._inst},game.dragEffectMgr=e.inst(),b8e.RC("$$game","$$DragEffectMgr",e)}(),function(){var a=game.ShaderUtil=function(){};a.setGray=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e?(t?(a.shaderGrayColorTransfrom||(a.shaderGrayColorTransfrom=new b8e.ColorTransfrom([.2126,.7152,.0722,1,0,0,0,0]),a.shaderGrayColorTransfrom.isGray=!0),e.setColorTransfrom&&e.setColorTransfrom(a.shaderGrayColorTransfrom)):e.setColorTransfrom&&e.setColorTransfrom(null),e.numChildren&&e.children&&e.children.forEach(a.setGray,a,t)):b8e.error("\u7f6e\u7070\u5bf9\u8c61\u4e3a\u7a7a")}}(),function(){var e;e=b8e.Enum({None:0,SWITCH_PAGE:-1,C2V_UPDATE_VIEW:-1,C_SELECT_BTN:-1,C_BTN_ITEM_SELECT:-1,V2C_UPDATE_VIEW:-1,V2C_HUNLU_MODEL_REQ:-1,C2C_HUNLU_MODEL_REQ:-1}),b8e.RC("$$game","$$MyMapEvts",e)}(),function(){var e=void 0;e=b8e.Object.extends({element:0,active:!1,name:null,quality:0,id:0,icon:0,exp:0,starLv:0,lv:0,top:0,num:0,itemId:0,speed:0,alert:!1,ctor:function(){},initData:function(e){this.element=e.element,this.name=e.name,this.quality=e.quality,this.id=e.id,this.icon=e.icon,this.num=e.chipItems[0].Num,this.itemId=e.chipItems[0].Id},setData:function(e){this.lv=e.lv,this.starLv=e.star;var t=game.PartnerStarCfg.getData(this.id,this.starLv);this.itemId=t.itemId,this.num=t.num,this.speed=t.clientSpeed},setUpStar:function(e){var t=game.PartnerStarCfg.getData(this.id,e);t&&(this.itemId=t.itemId,this.num=t.num,this.speed=t.clientSpeed)},setActive:function(){var e=game.PartnerStarCfg.getData(this.id,0);e&&(this.itemId=e.itemId,this.num=e.num)}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$PartnerMapItmeInfo",e)}(),function(){var e;e=b8e.Object.extends({element:0,alert:!1,quality:0,ctor:function(){this.partnerMap=b8e.HashMap.get()},initData:function(){this.cfg=game.partnerMapData.getQualityCfg(this.element,this.quality),this.cfg&&this.setinfoData()},setinfoData:function(){for(var e=this.cfg.length,t=void 0,a=void 0,i=0;i<e;i++)a=this.cfg[i],t=new game.PartnerMapItmeInfo,this.partnerMap.set(a.id,t),t.initData(a)},getInfo:function(e){return this.partnerMap.get(e)},getList:function(){return this.partnerMap.values()},checkAlert:function(){var e=this.getList();if(e){for(var t=e.length,a=void 0,i=void 0,n=!1,s=0;s<t;s++)(a=e[s]).active?(i=game.partnerData.getInfoById(a.id),a.alert=game.partnerData.canStar(i),a.alert&&!n&&(n=a.alert)):a.alert=!1;return n}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerMapQualityInfo",e)}(),function(){var e;e=b8e.Object.extends({element:0,alert:!1,cfg:null,isGetstar:0,allStar:0,select:!1,allSpeed:0,boxAlert:!1,ctor:function(){this.qualityMap=b8e.HashMap.get()},initData:function(){this.cfg=game.partnerMapData.getElementCfg(this.element),this.cfg&&this.setinfoData()},setinfoData:function(){for(var e=this.cfg.length,t=void 0,a=void 0,i=0;i<e;i++)a=this.cfg[i],(t=this.qualityMap.get(a.quality))||((t=new game.PartnerMapQualityInfo).element=this.element,t.quality=a.quality,this.qualityMap.set(a.quality,t),t.initData())},_sort:function(e,t){return t.quality-e.quality},getInfo:function(e){return this.qualityMap.get(e)},getList:function(){return this.qualityMap.values().sort(this._sort)},checkBoxAlert:function(){var e=game.PartnerBoxCfg.getData(this.element,!0);if(!e)return!1;for(var t=e.length,a=void 0,i=0;i<t;i++)if(this.isGetstar<e[i].star){a=e[i];break}return this.boxAlert=!!a&&this.allStar>=a.star,this.boxAlert},checkAlert:function(){var e=this.getList();if(e){for(var t=e.length,a=!1,i=0;i<t;i++)e[i].checkAlert()?a=e[i].alert=!0:e[i].alert=!1;this.alert=a}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerMapInfo",e)}(),function(){var e=b8e.Object.extends({selectId:0,partners:null,starBox:null,ctor:function(){this.elementMap=b8e.HashMap.get()},initData:function(){var e=game.PartnerMiscCfg.getData("elementMax");if(e)for(var t=void 0,a=void 0,i=0;i<e.value;i++)a=i+1,0==i&&(this.selectId=a),(t=new game.PartnerMapInfo).element=a,this.elementMap.set(a,t),t.initData()},setData:function(e){if(e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)1!=(i=e[n]).id&&((a=this.getItmeInfo(i.id)).active=!0,a.setData(i),this.setAllSpeed(i.id,a))},setAllSpeed:function(e,t){this.getElemenInfo(e).allSpeed+=t.speed},getBox:function(){var e=this.getSelectInfo(),t=game.PartnerBoxCfg.getData(e.element,!0);if(!t)return null;for(var a=t.length,i=0;i<a;i++)if(e.isGetstar<t[i].star)return t[i];return null},setisGetstar:function(e){if(e)for(var t=e.length,a=void 0,i=0;i<t;i++)(a=this.getInfo(e[i].element)).isGetstar=e[i].star,a.allStar=e[i].progress},setUpLv:function(e,t){var a=this.getItmeInfo(e);a&&(a.lv=t.lv,a.exp=t.exp)},setUpStarLv:function(e){var t=this.getItmeInfo(e);if(t){t.starLv+=1,t.setUpStar(t.starLv);var a=game.PartnerStarCfg.getData(e,t.starLv-1),i=0<t.starLv?t.speed-a.clientSpeed:t.speed;this.setInfoStar(e,i)}},setInfoStar:function(e,t){var a=this.getElemenInfo(e);a&&(a.allStar+=1,a.allSpeed+=t)},setActive:function(e){var t=this.getItmeInfo(e);t&&(t.active=!0,t.lv=1,t.setActive())},setStar:function(e,t,a){var i=this.getInfo(e);i.isGetstar=t,i.allStar=a},getElemenInfo:function(e){var t=game.PartnerCfg.getData(e);return t?this.getInfo(t.element):null},getList:function(){return this.elementMap.values()},getInfo:function(e){return this.elementMap.get(e)},getSelectInfo:function(){return this.elementMap.get(this.selectId)},getQualityList:function(){return this.getSelectInfo().getList()},getItmeList:function(e){return this.getSelectInfo().getInfo(e).getList()},getItmeInfo:function(e){var t=game.PartnerCfg.getData(e);return t?this.getInfo(t.element).getInfo(t.quality).getInfo(t.id):null},getElementCfg:function(e){this.obj||(this.obj={});var t=this.obj;return t.element=e,game.PartnerCfg.getData(t,!0)},getQualityCfg:function(e,t){this.gObj||(this.gObj={});var a=this.gObj;return a.element=e,a.quality=t,game.PartnerCfg.getData(a,!0)}});game.partnerMapData=game.partnerMapData||new e}(),function(){var e=game.Control.extends({notify:function(e){switch(e){case this.Evts.V2C_HUNLU_MODEL_REQ:this.dpt(this.Evts.C2C_HUNLU_MODEL_REQ)}},btn1:function(){this.selectToggle(0)},btn2:function(){game.moduleOpen.checkOpenWithTips(game.ME.MapAchieve,!0)&&this.selectToggle(1)},hunkaBtn:function(){this.selectToggle(2)},hunluBtn:function(){this.selectToggle(3)},selectToggle:function(e){this.send(this.Evts.SWITCH_PAGE,e)}});b8e.module.registerControl(game.ME.MyMap,e,game.MyMapEvts)}(),function(){var e=game.Control.extends({init:function(){game.spotAlert.set(game.SAE.MY_MAP,game.SAE.PARTNER_CUR_MAIN_TAB),this.recruitMapAlert=game.spotAlert.set(game.SAE.RECRUIT_MAP,game.SAE.RECRUIT),this.partnerMapAlert=game.spotAlert.set(game.SAE.PARTNER_MAP,game.SAE.MY_MAP),this.moduleData=game.partnerMapData,this.isInit=!1},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo,C_BACK_SYN_BACK_INFO:this.updateItemInfo},Partner:{C_INIT_DATA:this.updateListData,C_UPDATE_ACTIVE:this.updateActive},PartnerUpgrade:{V_UPDATE_LV:this.updateLv},PartnerStar:{V_UPDATE_STAR:this.updateStar}},this.handels={PartnerStarBoxResp:this.partnerStarBoxResp}},updateItemInfo:function(){this.isInit&&this.checkAlert()},triggerOpen:function(e){e==this.moduleEnum&&(this.isInit||(this.moduleData.initData(),this.isInit=!0))},updateActive:function(e){this.moduleData.setActive(e.data)},updateListData:function(e){var t=e.data;this.isInit||this.moduleData.initData(),this.moduleData.setData(t.partners),this.moduleData.setisGetstar(t.starBox),this.checkAlert(),this.isInit=!0},updateLv:function(e){var t=e.data;this.moduleData.setUpLv(t.id,t),this.send(this.Evts.C2V_UPDATE_VIEW)},checkAlert:function(){if(game.moduleOpen.checkOpen(game.ME.MyMap)){var e=this.moduleData.getList();if(e){for(var t=e.length,a=void 0,i=!1,n=0;n<t;n++)(a=e[n]).checkAlert(),a.checkBoxAlert(),a.alert&&!i&&(i=!0);this.recruitMapAlert.alert=this.partnerMapAlert.alert=i}}},updateStar:function(e){var t=e.data;t.id&&(this.moduleData.setUpStarLv(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))},notify:function(e,t){switch(e){case this.Evts.V2C_UPDATE_VIEW:case this.Evts.C_SELECT_BTN:this.updateView(t)}},updateView:function(e){this.moduleData.selectId=e||1,this.send(this.Evts.C2V_UPDATE_VIEW,!0)},partnerStarBoxResp:function(e){var t=e.readProtobuf(game.pb.PartnerStarBoxResponse);0<t.code?game.notice.noticeError(t.code):(this.openRewardsShow(),game.module.hide(game.ME.PartnerMapBox),this.moduleData.setStar(t.element,t.num,t.progress),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))},openRewardsShow:function(){var e=this.moduleData.getBox();game.awardsData.setItemsByArray(e.giveItems),game.module.show(game.ME.AwardShowTip)},btn_box:function(){game.module.show(game.ME.PartnerMapBox)},btn_receive:function(){var e=this.moduleData.getSelectInfo(),t=this.moduleData.getBox();t&&(e.allStar<t.star||this.sender.PartnerStarBoxReq(t.element,t.star))}}),t=[game.ME.PartnerMapBox],a=game.Sender.extends({ipc:function(){this.msg={PartnerStarBoxReq:this.partnerStarBoxReq}},partnerStarBoxReq:function(e,t){var a=game.pb.PartnerStarBoxRequest;a.element=e,a.num=t,this.write(a)}});b8e.module.registerControl(game.ME.PartnerMap,e,game.MyMapEvts,a,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1304),this.setSize(600,227)},init:function(){this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.itemList.itemRender=game.PartnerMapItem,this.itemList.addToParent(this.skin.list),this.itemList.touchMovable=!1},setData:function(){var e=this.skin,t=this.data.getList(),a=t.length,i=game.ResCfg.getUrl(10087,"title"+this.data.quality);e.name.loadTexture(i);var n=227*Math.ceil(a/3);this.setSize(600,40+n),this.itemList.setSize(600,n),this.layout(),this.itemList.setData(t)}}),b8e.RC("$$game","$$PartnerMapListItem",e)}(),function(){var e;e=game.ListItem.extends({max:6,ctor:function(){this._super(1303),this.setSize(186,227)},setData:function(){var e=this,t=e.skin,a=game.ResCfg.getUrl(10087,"quality_"+e.data.quality);t.quality_bg.loadTexture(a),t.name.string=e.data.active?game.Lang.get(51497,e.data.name,e.data.lv):e.data.name,t.arr_value.string=game.Lang.get(51498,e.data.speed);var i=e.data.active?10088:10089,n=game.itemData.getNumById(e.data.itemId);t.con.string=n+"/"+e.data.num;var s=game.ResCfg.getUrl(i,e.data.icon);t.bg.loadTexture(s);for(var r=0;r<e.max;r++){var o=r+1;e.getComponent("xing_"+r).active=o<=e.data.starLv}t.redPoint.active=e.data.alert},getBtn:function(){this.openFastUpStar(this.data.id)},openFastUpStar:function(e){var t=game.partnerData.getInfoById(e);t.active?game.partnerData.showInfo=t:game.partnerData.setShowInfo(e),game.module.show(game.ME.PartnerDetails)}}),b8e.RC("$$game","$$PartnerMapItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1308),this.setSize(129,78)},setData:function(e){this.data=e;var t=game.ResCfg.getUrl(10087,e.element);this.skin.icon.loadTexture(t),this.skin.redPoint.active=e.alert;var a=game.ResCfg.getUrl(10087,"btn_"+e.element);this.skin.btn_bg.loadTexture(a),this.skin.btn_bg.active=e.select},touchIcon:function(){this.send(game.MyMapEvts.C_SELECT_BTN,this.data.element)}}),b8e.RC("$$game","$$PartnerMapHead",e)}(),function(){var e=game.View.extends({_showModel:!0,cfg:null,ctor:function(){this._super(1306)},init:function(){this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Grid),this.prizeList.itemRender=game.PrizeListItem,this.prizeList.layout.spacingX=25,this.prizeList.addToParent(this.skin.list),this.moduleData=game.partnerMapData},onShow:function(){var e=this,t=e.moduleData.selectId,a=e.moduleData.getInfo(t);e.cfg=game.PartnerBoxCfg.getData(a.element,!0);for(var i=e.cfg.length,n=void 0,s=0;s<i;s++)if(a.isGetstar<e.cfg[s].star){n=e.cfg[s];break}n?(e.skin.btn_receive.active=a.allStar>=n.star,e.skin.btn_gray.active=a.allStar<n.star):(n=e.cfg[i-1],e.skin.label_name1.string=game.Lang.get(1353),e.skin.btn_gray.active=!0,e.skin.btn_receive.active=!1);var r=game.CfgUtil.getPrizeListInfo(n.giveItems,3,game.IconSizeEnum.GRID_SIZE_105);e.prizeList.setData(r.items)}});b8e.module.registerView(game.ME.PartnerMapBox,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1307)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PartnerMapHead,t.bindEnum=game.ME.PartnerMap,t.layout.spacingX=10,t.layout.paddingLeft=30,t.layout.paddingTop=-5,t.addToParent(e.list);var a=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.PartnerMapListItem,a.bindEnum=game.ME.PartnerMap,a.layout.spacingY=10,a.addToParent(e.tiem_list),this.moduleData=game.partnerMapData},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateList(),this.updateItmeList(t),this.updateView()}},onShow:function(){this.itemList.container.getNode().on(cc.Node.EventType.SIZE_CHANGED,this.onSize,this),this.send(this.Evts.V2C_UPDATE_VIEW),this.itemList.scrollToTop(),this.jumpToHeadItem()},onHide:function(){this.itemList.container.getNode().off(cc.Node.EventType.SIZE_CHANGED,this.onSize,this)},updateView:function(){var e=this.moduleData.selectId,t=this.moduleData.getSelectInfo();this.skin.redPoint.active=t.boxAlert,this.updatePro(t),this.updateAllSpeed(e);var a=game.ResCfg.getUrl(10087,"baoxiang_"+e);this.skin.btn_box.loadTexture(a)},updateAllSpeed:function(e){var t=this.moduleData.getList();if(t){for(var a=t.length,i=0,n=void 0,s=0;s<a;s++)i+=(n=t[s]).allSpeed,n.select=n.element==e;this.skin.value.string=game.Lang.get(51489,i)}},updatePro:function(e){for(var t=game.PartnerBoxCfg.getData(e.element,!0),a=t.length,i=void 0,n=0;n<a;n++)if(e.isGetstar<t[n].star){i=t[n];break}this.skin.pro.width=Math.min(354,e.allStar/i.star*354),this.skin.arrLable.string=e.allStar+"/"+i.star},updateList:function(){var e=this.moduleData.getList();this.list.setData(e)},updateItmeList:function(e){var t=this.moduleData.getQualityList();this.itemList.setData(t),e&&this.onSize()},onStageResize:function(){this.setPosition(0,0)},jumpToHeadItem:function(){var e=this.moduleData.getList(),t=e.length;if(e)for(var a=0;a<t;a++){var i=a+1;if(this.moduleData.getInfo(i).alert)return void this.send(game.MyMapEvts.C_SELECT_BTN,i)}},jumpToItem:function(e){this.itemList.scrollToTop();var t=0,a=this.moduleData.getQualityList(),i=this.itemList.getItemRender(a[e]);e==a.length-1?this.itemList.scrollToBottom(0,500):(t=Math.abs(i.y),this.itemList.scrollToPos({x:0,y:t},500))},onSize:function(){for(var e=this.moduleData.getQualityList(),t=0,a=e.length;t<a;t++)if(e[t].alert)return void this.jumpToItem(t);this.itemList.scrollToTop()}});b8e.module.registerView(game.ME.PartnerMap,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1305),this.toggles={tab1_select:game.ME.PartnerMap,tab2_select:game.ME.MapAchieve,hunkaBtnSelect:game.ME.HunluHunka,hunluBtnSelect:game.ME.HunluAchievement},this.spotAlerts={PARTNER_MAP:this.partnerMapAlert,MAP_ACHIEVE:this.MapAchAlert,HUNLU_HUNKA:this.hunkaAlert,HUNLU_ACHIEVEMENT:this.achievementAlert}},hunkaAlert:function(e){this.skin.red_spot3.active=e.alert},achievementAlert:function(e){this.skin.red_spot4.active=e.alert},partnerMapAlert:function(e){this.skin.red_spot1.active=e.alert},MapAchAlert:function(e){this.skin.red_spot2.active=e.alert},notify:function(e,t){switch(e){case game.MyMapEvts.SWITCH_PAGE:this.toggleSelect(t)}},toggleSelect:function(e){if(!this._super(e));},onShow:function(){this.toggleSelect(0),game.hunluData.isInitHunluModelReq?game.hunluData.isInitAchievementData||game.hunluData.initAchievementModel():this.send(this.Evts.V2C_HUNLU_MODEL_REQ)}});b8e.module.registerView(game.ME.MyMap,e)}(),function(){var e;e=b8e.Object.extends({id:0,slot:0,select:!1,info:null,power:0,isAlert:!1,change:!1,active:!0,isGray:!1,isForgeAlert:!1,__isSlot:!0,isHelpPartner:!1,_forgeInfo:null,forgeInfo:{get:function(){return this._forgeInfo||(this._forgeInfo=new game.EquipForgeRoleInfo),this._forgeInfo}},ctor:function(){this._super(),this.equipSpriteStat=game.SpriteStat.get(),this.allSpriteStat=game.SpriteStat.get(),this.equipIdxMap=b8e.HashMap.get()},setData:function(e){var t=this;t.data=e,t.info&&t.info.battlePos==t.slot&&(t.info.battlePos=0),t.updatePartner(e,!1),t.initEquipIdxMap(),t.forgeInfo.setData(t),t.updateAllStat()},updatePartner:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=this;i.info&&i.info.battlePos==i.slot&&(i.info.battlePos=0),i.id=e.id,i.info=game.partnerData.getInfoById(e.id),i.info.battlePos=i.slot,i.forgeInfo||(i.forgeInfo=new game.EquipForgeRoleInfo),a&&(i.changeAllEquipTarget(),i.forgeInfo.setData(i),i.updateAllStat())},updateAllStat:function(){var i=this;if(i.allSpriteStat.clear(),i.power=0,i.info){i.info.updateAllStat(),i.allSpriteStat.addSpriteStat(i.info.allSpriteStat,1,!1),i.equipSpriteStat.clear(),i.equipIdxMap.forEach(function(e,t){if(t){var a=game.partnerEquipData.getWearEquipInfo(e,t);a&&a.updateAllSpriteStat(),a&&i.equipSpriteStat.addSpriteStat(a.allSpriteStat,1,!1)}}),i.allSpriteStat.addSpriteStat(i.equipSpriteStat,1,!1);var e=game.partnerEquipData.getSlotSuitSpriteStat(i);i.allSpriteStat.addSpriteStat(e,1,!1),i.forgeInfo&&(i.allSpriteStat.addSpriteStat(i.forgeInfo.intensifySlSpriteStat,1,!1),i.allSpriteStat.addSpriteStat(i.forgeInfo.refineSlSpriteStat,1,!1),i.allSpriteStat.addSpriteStat(i.forgeInfo.purifySlSpriteStat,1,!1),i.allSpriteStat.addSpriteStat(i.forgeInfo.gemSlSpriteStat,1,!1),i.allSpriteStat.addSpriteStat(i.forgeInfo.zhulingSlSpriteStat,1,!1),i.allSpriteStat.addSpriteStat(i.forgeInfo.fuseSlSpriteStat,1,!1),i.allSpriteStat.addSpriteStat(i.forgeInfo.fuseStarSkillSpriteStat,1,!1)),i.power=i.allSpriteStat.getPower()}},getUnIsLock:function(){return this.cfg&&(this.cfg.level<=game.mainRoleData.lv||this.cfg.vip<=game.mainRoleData.vipLevel)},getUpgradeCfgByType:function(e){if(!this.info)return null;var t=game.PartnerUpgradeTypes,a=void 0;switch(e){case t.BREAK:a=game.PartnerTopCfg.getData(this.info.breakLv);break;case t.STAR:a=game.PartnerStarCfg.getData(this.info.id,this.info.star)}return a},initEquipIdxMap:function(){var e=this.data.equips;if(e){var t=game.partnerEquipData;t.initWearInfoMap(e);for(var a=e.length,i=void 0,n=void 0,s=0;s<a;s++){var r=e[s].item;i=r.idx,n=t.getPosById(r.id),t.getWearEquipInfo(n,i).wearTarget=this.id,this.equipIdxMap.set(n,i)}var o=this.data.proper;if(o){t.initExcWearInfoMap(o);var g=o.idx;n=t.getPosById(o.id),t.getWearEquipInfo(n,g).wearTarget=this.id,this.equipIdxMap.set(game.EquipPosType.POS_7,g),this.info.updateExcFateSpriteStat(o)}}},getEquipMap:function(){return this.equipIdxMap},getEquipIdxByPos:function(e){return this.equipIdxMap.get(e)},changeAllEquip:function(e){if(e){for(var t=e.length,a=void 0,i=0;i<t;i++){a=e[i];var n=game.ItemInfoCfg.getData(a.id).pos;this.changeEquip(n,a.idx)}this.forgeInfo.setData(this),this.updateAllStat()}},changeEquip:function(e,t){var a=game.partnerEquipData,i=this.equipIdxMap.get(e);i?(game.partnerEquipData.getWearEquipInfo(e,i).wearTarget=0,game.equipData.getPetEquipInfoByIdx(t).wearTarget=this.id,a.changeEquipState(i,t,e,!0)):(game.equipData.getPetEquipInfoByIdx(t).wearTarget=this.id,a.changeEquipState(null,t,e));this.equipIdxMap.set(e,t),this.forgeInfo.setData(this),this.updateAllStat()},removeEquip:function(e){if(this.equipIdxMap.has(e)){var t=this.equipIdxMap.get(e);game.partnerEquipData.getWearEquipInfo(e,t).wearTarget=0,this.equipIdxMap.del(e),game.partnerEquipData.changeEquipState(t,null,e)}this.forgeInfo.setData(this),this.updateAllStat()},changeAllEquipTarget:function(){for(var e=game.EquipPosType.POS_MAX,t=void 0,a=1;a<=e;a++)(t=this.equipIdxMap.get(a))&&(game.partnerEquipData.getWearEquipInfo(a,t).wearTarget=this.id);this.updateAllStat()},getEquipIntensifyTotalLv:function(e){var a=!(0<arguments.length&&void 0!==e)||e,i=void 0,n=0;return this.equipIdxMap.forEach(function(e,t){(i=game.partnerEquipData.getWearEquipInfo(e,t)).type==game.PartnerEquipType.Exclusive||!a&&i.type==game.PartnerEquipType.Treasure||(n+=i.intensifylv)}),n},getEquipGemTotalLv:function(e){var a=!(0<arguments.length&&void 0!==e)||e,i=void 0,n=0;return this.equipIdxMap.forEach(function(e,t){(i=game.partnerEquipData.getWearEquipInfo(e,t)).type==game.PartnerEquipType.Exclusive||!a&&i.type==game.PartnerEquipType.Treasure||(n+=i.gemTotalLv)}),n},getEquipRefinelvTotalLv:function(e){var a=!(0<arguments.length&&void 0!==e)||e,i=void 0,n=0;return this.equipIdxMap.forEach(function(e,t){(i=game.partnerEquipData.getWearEquipInfo(e,t)).type==game.PartnerEquipType.Exclusive||!a&&i.type==game.PartnerEquipType.Treasure||(n+=i.refinelv)}),n},getEquipPurifyTotalLv:function(e){var a=!(0<arguments.length&&void 0!==e)||e,i=void 0,n=0;return this.equipIdxMap.forEach(function(e,t){(i=game.partnerEquipData.getWearEquipInfo(e,t)).type==game.PartnerEquipType.Exclusive||!a&&i.type==game.PartnerEquipType.Treasure||(n+=i.purifylv)}),n},checkIsWrarSuit:function(){var e=void 0,t=void 0;if(!(t=this.equipIdxMap.get(1)))return!1;var a=(e=game.partnerEquipData.getWearEquipInfo(1,t)).cfg;if(0==a.suit)return!1;var i=game.PartnerSuitCfg.getData(a.suit,2);if(!i)return!1;for(var n=i.suits,s=2;s<=4;s++){if(!(t=this.equipIdxMap.get(s)))return!1;if(e=game.partnerEquipData.getWearEquipInfo(s,t),n.indexOf(e.cfg.id)<0)return!1}return!0}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerSlotInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,lv:0,_active:!1,select:!1,isAlert:!1,isBackAlert:!1,fightAmount:0,cfg:null,battleSlot:0,isShowName:!1,isShowBattle:!1,isShowEffect:!0,star:0,exp:0,redPoints:null,breakLv:0,awakenLv:0,jpLv:0,battlePos:0,helpPos:0,helpArmyPos:0,isShowLv:!0,isShowStar:!0,normalUrl:72,grayUrl:72,isMainRole:!1,quality:0,name:null,puSkill:0,heSkill:0,nuSkill:0,zhanjiSkill:0,fuSkill:0,_skills:null,_fates:null,_details:null,_breakTalents:null,_awakenSkills:null,_skinInfos:null,skinInfoMap:null,useSkin:0,selectSkin:null,exploreHp:0,exploreMaxhp:0,helpPower:0,helpArmyPower:0,showCombine:!1,backSelect:!1,qualityNum:0,talentTasked:null,newQuality:0,ctor:function(){var e=this;e._super(),e.levelSpriteStat=game.SpriteStat.get(),e.starSpriteStat=game.SpriteStat.get(),e.breakSpriteStat=game.SpriteStat.get(),e.breakTalentSpriteStat=game.SpriteStat.get(),e.fateSpriteStat=game.SpriteStat.get(),e.awakenSpriteStat=game.SpriteStat.get(),e.jingpoSpiteStat=game.SpriteStat.get(),e.skinSpriteStat=game.SpriteStat.get(),e.helpSpriteStat=game.SpriteStat.get(),e.helpArmySpriteStat=game.SpriteStat.get(),e.excFateSpriteStat=game.SpriteStat.get(),e.allSpriteStat=game.SpriteStat.get(),e.qualityFetterStat=game.SpriteStat.get(),e.battleFetterStat=game.SpriteStat.get(),e.alertMap=b8e.HashMap.get(),e.talentCurTaskMap=b8e.HashMap.get(),e.talentTasked=[],e.talentSpiteStat=game.SpriteStat.get()},active:{get:function(){return this._active}},skinInfos:{get:function(){return this._skinInfos||this.initSkinInfos(),this._skinInfos}},initSkinInfos:function(){if(this._skinInfos=[],this.skinInfoMap=b8e.HashMap.get(),this.cfg.isSkin)for(var e=game.PartnerSkinCfg.getSkinByPartnerId(this.id),t=void 0,a=0,i=e.length;a<i;a++)(t=new game.PartnerSkinInfo).cfg=e[a],t.id=t.cfg.id,t.spriteStat=game.SpriteStat.get(),t.spriteStat.setupByCfg(t.cfg),t.power=t.spriteStat.getPower(),this._skinInfos.push(t),this.skinInfoMap.set(t.id,t)},_sortSkins:function(e,t){return e.useIng&&!t.useIng?-1:!e.useIng&&t.useIng?1:e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:e.active&&!t.active?-1:!e.active&&t.active?1:e.id-t.id},breakTalents:{get:function(){return this._breakTalents||this.initBreakTalents(),this._breakTalents}},initBreakTalents:function(){this._breakTalents=[];for(var e=game.PartnerTopCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)e[a].attrId&&((t=new game.PartnerBreakTalentInfo).cfg=e[a],(t.info=this)._breakTalents.push(t),this._breakTalents.sort(this._sortBreakTalents))},_sortBreakTalents:function(e,t){return e.cfg.level-t.cfg.level},details:{get:function(){return this._details||this.initDetails(),this._details}},initDetails:function(){var e=game.PartnerDetailsEnum;this._details=[],this._details[0]=this.getDetailsInfo(e.STAT),this._details[1]=this.getDetailsInfo(e.SKILL),this._details[2]=this.getDetailsInfo(e.FATE),this._details[3]=this.getDetailsInfo(e.BREAK)},getDetailsInfo:function(e){var t=new game.PartnerDetailsInfo;return t.type=e,t.info=this,t},fates:{get:function(){return this._fates||this.initFates(),this._fates}},initFates:function(){this._fates=[];for(var e=this.cfg.fates,t=void 0,a=0,i=e.length;a<i;a++)(t=new game.PartnerFateInfo).cfg=game.PartnerFateCfg.getData(e[a]),(t.info=this)._fates.push(t)},skills:{get:function(){var a=this;return a._skills&&0!=a._skills.length||a.initSkills(),a._skills.sort(function(e,t){return e.star==a.star?-1:t.star==a.star?1:0==e.star?-1:0==t.star?1:(t.star,void e.star)}),a._skills}},initSkills:function(){this._skills=[];for(var e=this.cfg.angerSkills,t=this.cfg.unionSkills,a=this.cfg.assistSkills,i=void 0,n=0,s=e.length;n<s;n++)(i=new game.PartnerSkillGroupInfo).nuSkill=e[n],i.heSkill=t.length>n?t[n]:0,i.fuSkill=a.length>n?a[n]:0,i.star=n,(i.info=this)._skills.push(i)},awakenSkills:{get:function(){return this._awakenSkills||this.initAwakenSkills(),this._awakenSkills}},initAwakenSkills:function(){this._awakenSkills=[];var e=void 0,t=game.PartnerAwakenSkillCfg.getData(this.id,!0);if(t)for(var a=void 0,i=0,n=t.length;i<n;i++)a=t[i],(e=new game.PartnerSkillGroupInfo).skill=a.skill,e.star=a.star,(e.info=this)._awakenSkills.push(e)},talentTasks:{get:function(){return this.talentCurTaskMap.values().sort(this.talentSort)}},talentAllShow:{get:function(){if(!this.showTalentList){this.showTalentList=[];var e=game.PartnerTalentCfg.getData(this.id,this.qualityNum);if(e){var t=e.clientShowTask;if(t)for(var a=t.length,i=0;i<a;i++){var n=game.PartnerTalentTaskCfg.getData(t[i]);if(n){var s=game.PartnerTalentTaskInfo.get();s.setData(n),s.isFinish=!0,s.sort=i,this.showTalentList.push(s)}}}}return this.showTalentList.sort(this.talentSort)}},talentSort:function(e,t){return e.sort-t.sort},initTalentTasks:function(){this.talentCurTaskMap.clear();var e=game.PartnerTalentCfg.getData(this.id,this.qualityNum);if(e)for(var t=e.talentTask,a=t.length,i=0;i<a;i++){var n=t[i],s=game.PartnerTalentTaskCfg.getData(n);if(s){var r=game.PartnerTalentTaskInfo.get();r.setData(s),r.isFinish=0<=this.talentTasked.indexOf(n),r.sort=i,this.talentCurTaskMap.set(n,r)}}},setData:function(e){var t=this;t.id=e.id,t.exploreHp=e.exploreHp,t.exploreMaxhp=e.exploreMaxHp,t.puSkill=t.cfg.skill,t.redPoints=e.redPoint,t.useSkin=null==e.useSkin?0:e.useSkin,t.isMainRole=1==t.id,t.name=t.isMainRole?game.mainRoleData.name:t.cfg.name,t._active=!0,t.isShowEffect=!0,e.talentTask&&(t.talentTasked=e.talentTask),t.updateLv(e.lv,e.exp),t.updateBreakLv(e.top),t.updateStar(e.star),t.updateAwakenLv(e.awakenStar),t.updateAlertInfo(e.redPoint),t.updateJingpoLv(e.jpLv),t.updateSkins(e.skins||[]),t.updateQualityNum(e.qualityNum||0,!0)},setCfgData:function(e){this.cfg=e,this.quality=this.newQuality?this.newQuality:e.quality},updateActive:function(e){var t=this;t.id=e,t.quality=t.newQuality?t.newQuality:t.cfg.quality,t.puSkill=t.cfg.skill,t.redPoints=0,t.isMainRole=!1,t.name=t.cfg.name,t._active=!0,t.exploreHp=t.exploreMaxhp=1,t.updateLv(1,0),t.updateBreakLv(0),t.updateStar(0),t.updateAlertInfo(0),t.updateAwakenLv(0),t.updateJingpoLv(0),t.updateQualityNum(0)},setShowActive:function(){this._active=!0,this.updateLv(0,0),this.updateBreakLv(0),this.updateStar(0)},updateLv:function(e,t){var a=this;a.lv=e,a.exp=t,a.levelSpriteStat.clear();var i=game.StarAddAttrCfg.getData(a.quality,a.star),n=i?1+(a.isMainRole?i.masterPer:i.percent)/1e3:1,s=a.cfg.hp+a.cfg.perHp*e*n>>0,r=a.cfg.atk+a.cfg.perAtk*e*n>>0,o=a.cfg.def+a.cfg.perDef*e*n>>0,g=a.cfg.crit+a.cfg.perCrit*e*n>>0,u=a.cfg.critRes+a.cfg.perCritRes*e*n>>0,l=a.cfg.hit+a.cfg.perHit*e*n>>0,c=a.cfg.dodge+a.cfg.perDodge*e*n>>0;if(a.levelSpriteStat.setStatValue(game.SpriteStatType.Health,s),a.levelSpriteStat.setStatValue(game.SpriteStatType.Attack,r),a.levelSpriteStat.setStatValue(game.SpriteStatType.Defense,o),a.levelSpriteStat.setStatValue(game.SpriteStatType.Crit,g),a.levelSpriteStat.setStatValue(game.SpriteStatType.CritRes,u),a.levelSpriteStat.setStatValue(game.SpriteStatType.Hit,l),a.levelSpriteStat.setStatValue(game.SpriteStatType.Dodge,c),a.isMainRole){var h=game.StarMapQualityAttrCfg.getData(a.quality);h&&a.levelSpriteStat.addByCfg(h,!1)}a.updateAllStat(),a.updateHelpArmylStat()},updateBreakLv:function(e){this.breakLv=e,this.breakSpriteStat.clear();var t=game.PartnerTopCfg.getData(e);t&&this.breakSpriteStat.setupByCfg(t,!1),this.updateAllStat(),this.updateHelpArmylStat()},updateStar:function(e){var t=this;t.star=e,game.partnerData.maxStarNum=Math.max(game.partnerData.maxStarNum,e),t.starSpriteStat.clear();var a=void 0;if(a=t.isMainRole?game.MasterStarCfg.getData(t.star):game.PartnerStarCfg.getData(t.id,t.star)){t.isMainRole?t.nuSkill=t.cfg.angerSkills[0]:(t.heSkill=a.unionSkill,t.nuSkill=a.angerSkill,t.fuSkill=a.assistSkill),t.starSpriteStat.setupByCfg(a,!1);var i=a.helpPer/10;t.helpSpriteStat.setStatValue(game.SpriteStatType.TeamAtk,a.teamAtk*i),t.helpSpriteStat.setStatValue(game.SpriteStatType.TeamDef,a.teamDef*i),t.helpSpriteStat.setStatValue(game.SpriteStatType.TeamHp,a.teamHp*i),t.helpPower=t.helpSpriteStat.getPower(),t.updateLv(t.lv,t.exp),t.updateAllStat(),t.updateHelpArmylStat()}},updateAwakenLv:function(e){var t=this;t.awakenLv=e,t.awakenSpriteStat.clear();var a=game.PartnerAwakenCfg.getData(t.id);if(a&&(t.awakenSpriteStat.addByCfg(a,!0,t.awakenLv),a.awakenSkill)){for(var i=void 0,n=0,s=t.awakenSkills.length;n<s;n++)t.awakenSkills[n].star<=t.awakenLv&&(i=t.awakenSkills[n]);t.awakenSkill=i||t.awakenSkills[0]}},updateJingpoLv:function(e){if(null!=e){this.jpLv=e,this.jingpoSpiteStat.clear();var t=game.PartnerJingpoCfg.getData(e);t&&this.jingpoSpiteStat.setupByCfg(t,!1),this.updateAllStat()}},updateQualityNum:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=this;i.qualityNum=e,i.newQuality=0,a||(i.talentTasked.length=0),i.initTalentTasks(),i.talentSpiteStat.clear();var n=game.PartnerTalentCfg.getData(i.id,i.qualityNum);n&&(i.talentSpiteStat.setupByCfg(n,!1),i.newQuality=n.quality),i.quality=i.newQuality?i.newQuality:i.cfg.quality,i.updateAllStat(),i.updateHelpArmylStat()},updateTalentTask:function(e){this.talentTasked.push(e);var t=this.talentCurTaskMap.get(e);t&&(t.isFinish=0<=this.talentTasked.indexOf(e),t.showEff=!0)},updateSkins:function(e){this.skinInfos;if(this.skinSpriteStat.clear(),this.cfg.isSkin){if(e&&e.length)for(var t=0,a=e.length;t<a;t++){var i=this.skinInfoMap.get(e[t]);i&&(i.active=!0,i.useIng=i.id==this.useSkin,this.skinSpriteStat.addByCfg(i.cfg,!1))}this.updateAllStat()}},getSkinsList:function(){return this.skinInfos.sort(this._sortSkins),this.selectSkin||this.selectFirstSkinInfo(),this.skinInfos},getAllSpriteStat:function(){var e=this;e.allSpriteStat.clear(),e.allSpriteStat.addSpriteStat(e.levelSpriteStat,1,!1),e.allSpriteStat.addSpriteStat(e.breakSpriteStat,1,!1),e.allSpriteStat.addSpriteStat(e.starSpriteStat,1,!1),e.allSpriteStat.addSpriteStat(e.jingpoSpiteStat,1,!1),e.allSpriteStat.addSpriteStat(e.skinSpriteStat,1,!1),e.allSpriteStat.addSpriteStat(e.excFateSpriteStat,1,!1),e.allSpriteStat.addSpriteStat(e.talentSpiteStat,1,!1),e.allSpriteStat.addSpriteStat(e.qualityFetterStat,1,!1),e.allSpriteStat.addSpriteStat(e.battleFetterStat,1,!1),e.battlePos&&(e.updateFateStat(),e.updateBreakTalentStat(),e.allSpriteStat.addSpriteStat(e.fateSpriteStat,1,!1),e.allSpriteStat.addSpriteStat(e.breakTalentSpriteStat,1,!1))},updateFateStat:function(){var e=void 0;this.fateSpriteStat.clear();for(var t=0,a=this.fates.length;t<a;t++)(e=this.fates[t]).getIsComplete()&&this.fateSpriteStat.addByCfg(e.cfg,!1)},updateBreakTalentStat:function(){var e=void 0;this.breakTalentSpriteStat.clear();for(var t=0,a=this.breakTalents.length;t<a;t++)(e=this.breakTalents[t]).getIsComplete()&&this.breakTalentSpriteStat.addSpriteStateByType(e.cfg.attrId,e.cfg.attrValue,!1)},updateExcFateSpriteStat:function(e){if(this.excFateSpriteStat.clear(),e){var t=e.id,a=game.ItemInfoCfg.getData(t);a&&a.partnerId==this.id&&this.excFateSpriteStat.addSpriteStateByType(a.attrId,a.attrValue,!1)}},updateAllStat:function(){this.getAllSpriteStat(),this.allSpriteStat.addSpriteStatTeam(game.mainRoleData.spriteStat,this.cfg.element),this.fightAmount=this.allSpriteStat.getPower()},getUpgradeCfgByType:function(e){var t=game.PartnerUpgradeTypes,a=void 0;switch(e){case t.BREAK:a=game.PartnerTopCfg.getData(this.breakLv);break;case t.STAR:a=this.isMainRole?game.MasterStarCfg.getData(this.star):game.PartnerStarCfg.getData(this.id,this.star);break;case t.JINGPO:a=game.PartnerJingpoCfg.getData(this.jpLv)}return a},clearInfo:function(){this._fates&&(0==this._fates.length||this._fates),!this._skills||0==this._skills.length&&null!=this._skills||(this._skills.length=0)},getBattleOrWaitBattle:function(){return this.battlePos?2:0},getShowStepOrLv:function(){return 1},updateAlertInfo:function(e){for(var t=game.EquipForgeType.MAX,a=game.EquipForgeType.NONE+1;a<t;a++){var i=e>>a-1&1,n=this.alertMap.get(a);(n=n||new game.EquipForgeAlertSetInfo).setData(this.name,this.id,a,1==i),this.alertMap.set(a,n)}},selectFirstSkinInfo:function(){var e=this.skinInfos;e&&0<e.length&&this.selectSkinInfoById(e[0].id)},selectSkinInfoById:function(e){var t=this.selectSkin,a=this.skinInfoMap.get(e);t&&(t.select=!1),a.select=!0,this.selectSkin=a},updateHelpArmylStat:function(){var e=this,t=0,a=0,i=0,n=game.StarAddAttrCfg.getData(e.quality,e.star),s=n?1+n.percent/1e3:1;t=e.cfg.aidTeamAtk*e.lv*s,a=e.cfg.aidTeamDef*e.lv*s,i=e.cfg.aidTeamHp*e.lv*s;var r=game.PartnerStarCfg.getData(e.id,e.star);r&&(t+=r.aidTeamAtk,a+=r.aidTeamDef,i+=r.aidTeamHp);var o=game.PartnerTopCfg.getData(e.breakLv);if(o&&(t+=o.aidTeamAtk,a+=o.aidTeamDef,i+=o.aidTeamHp),e.helpArmyPos){var g=game.PartnerAidCfg.getData(e.helpArmyPos);if(g){var u=game.partnerData.getHelpArmyChainCfg(g.page,e.quality);u&&(t+=u.teamAtk,a+=u.teamDef,i+=u.teamHp)}}var l=e.helpArmySpriteStat,c=game.SpriteStatType;l.clear(),l.setStatValue(c.TeamAtk,0|t),l.setStatValue(c.TeamDef,0|a),l.setStatValue(c.TeamHp,0|i),e.helpArmyPower=l.getPower()},getCurrTalentTask:function(){for(var e=this.talentTasks,t=void 0,a=0,i=e.length;a<i;a++)if(!(t=e[a]).isFinish)return t;return null},getProValueByType:function(e){var t=game.TalentTaskType,a=0,i=this;switch(e){case t.TYPE_1:a=i.lv;break;case t.TYPE_2:a=i.awakenLv;break;case t.TYPE_3:a=i.fightAmount;break;case t.TYPE_4:if(!i.battlePos)break;a=game.partnerData.getSlotInfoBySlot(i.battlePos).getEquipIntensifyTotalLv(!1);break;case t.TYPE_5:a=i.breakLv;break;case t.TYPE_6:a=i.jpLv;break;case t.TYPE_7:if(!i.battlePos)break;a=game.partnerData.getSlotInfoBySlot(i.battlePos).getEquipRefinelvTotalLv(!1);break;case t.TYPE_8:if(!i.battlePos)break;a=game.partnerData.getSlotInfoBySlot(i.battlePos).getEquipGemTotalLv(!1);break;case t.TYPE_9:a=game.mainRoleData.power;break;default:b8e.warn("\u672a\u914d\u7f6e\u7684\u5929\u8d4b\u7c7b\u578b\uff01")}return a}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,info:null,_desc:null,desc:{get:function(){var e=game.AttrRulesCfg.getData(this.cfg.attrId);return this._desc=game.HtmlUtil.getText(this.cfg.level<=this.info.breakLv?game.Color.RED:game.Color.BLACK,game.Lang.get(51430,this.cfg.level,e.name,this.cfg.attrDesc)),this._desc}},getIsComplete:function(){return this._isComplete=this.cfg.level<=this.info.breakLv,this._isComplete}});b8e.RC("$$game","$$PartnerBreakTalentInfo",e)}(),function(){var e;e=b8e.Object.extends({type:0,info:null});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerDetailsInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,info:null,_desc:null,_isComplete:!1,getIsComplete:function(){var e=this,t=game.PartnerFateEnum;if(e.cfg.fateType==t.Partner){var a=game.partnerData.getInfoById(e.cfg.fateParam);e._isComplete=a&&a.active}return e.cfg.fateType==t.Equip&&(e._isComplete=game.partnerData.getSlotHaveEquip(e.info.battlePos,e.cfg.fateParam)),e.cfg.fateType==t.Exclusive&&(e._isComplete=game.partnerData.getSlotHaveExclusive(e.info.battlePos,e.cfg.fateParam)),e._isComplete}});b8e.RC("$$game","$$PartnerFateInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,slot:0,info:null,cfg:null,isAlert:!1,setData:function(e){var t=this;t.info&&t.slot==t.info.helpPos&&(t.info.helpPos=0)&&(t.info=null),t.id=e.id,t.id&&(t.info=game.partnerData.getInfoById(e.id),t.info.helpPos=t.slot)},getUnIsLock:function(){return this.cfg&&this.cfg.level<=game.mainRoleData.lv}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerHelpInfo",e)}(),function(){var e;e=b8e.Object.extends({nuSkill:0,heSkill:0,fuSkill:0,skill:0,star:0,info:null});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerSkillGroupInfo",e)}(),function(){var e=game.CultivateBaseData.extends({partnerInfoMap:null,partnerInfoArr:null,partnerFormations:null,partnerSlots:null,partnerSlotMap:null,selectSlot:0,selectHelpSlot:0,selectHelpArmySlot:0,selectBackId:0,autoUse:!1,autoUse2:!1,maxSlot:6,showSkillInfo:null,showInfo:null,showSlotInfo:null,quickStarInfo:null,awakenInfo:null,changeSlot:null,isInit:!1,partnerActiveTips:null,awakenSkillInfo:null,currCombineInfo:null,recruitActiveId:null,activeSkinInfo:null,selectBackInfo:null,backInfoIndex:0,elementFettersType:0,skillTipsInfo:null,selectPartnerInfo:null,helpArmyPage:1,maxStarNum:0,newDefaultSel:null,combinesArr:null,rebirthTimes:0,masterFetterId:0,masterSkillTipsInfo:0,ctor:function(){var e=this;e._super(game.PartnerInfo),e.partnerInfoArr=[],e.partnerSlots=[],e.partnerHelps=[],e.partnerHelpArmys=[],e.helpArmySlotPage1=[],e.helpArmySlotPage2=[],e.partnerFormations=[1,2,3,4,5,6],e.partnerInfoMap=b8e.HashMap.get(),e.partnerSlotMap=b8e.HashMap.get(),e.partnerActiveTips=[],e.teamEmbattles=[],e.combinesArr=[],e.helpArmyStatAll=game.SpriteStat.get()},synDatas:function(e){var t=this;t.initMap(),t.initSlot(),t.setInfoList(e.partners),t.setSlotList(e.slots,1),t.setSlotList(e.helps,2),t.setHelpArmySlotList(e.aids),t.setFormations(e.embattle),t.setTeamEmbattle(e.teamEmbattle),t.rebirthTimes=e.rebirthTimes,t.getPartnerBackList(),t.getPartnerBackActiveList(),t.masterFetterId=e.masterFetterId,t.updateQualityFetterStat(),t.updateBattleFetterStat(),t.updateAllSlotStat(),t.isInit=!0},initExpCfg:function(){this._costList=[];for(var e=game.PartnerBookCfg.getDatas(),t=0,a=e.length;t<a;t++)this._costList.push(e[t]);this._costList.sort(this.sortCost)},sortCost:function(e,t){return t.exp-e.exp},initSlot:function(){var e=void 0;if(!this.partnerSlots.length){for(var t=game.PartnerBattleCfg.getDatas(),a=0,i=t.length;a<i;a++)(e=new game.PartnerSlotInfo).slot=a+1,e.cfg=t[a],this.partnerSlots.push(e);var n=game.PartnerHelpCfg.getDatas(),s=void 0;if(n&&n.length)for(var r=0,o=n.length;r<o;r++)(s=new game.PartnerHelpInfo).slot=r+1,s.cfg=n[r],this.partnerHelps.push(s);var g=game.PartnerAidCfg.getDatas(),u=this.partnerHelpArmys,l=void 0;if(g&&g.length)for(var c=0,h=g.length;c<h;c++)(l=new game.PartnerHelpArmyInfo).setCfg(g[c]),(1==l.page?this.helpArmySlotPage1:this.helpArmySlotPage2).push(l),u.push(l)}},setTeamEmbattle:function(e){if(e&&!(e.length<1))for(var t=0,a=e.length;t<a;t++)this.teamEmbattles[t+1]=e[t]},setFormations:function(e){for(var t=0,a=e.length;t<a;t++)this.partnerFormations[t]=e[t]},setSlotList:function(e,t){for(var a=void 0,i=0,n=1==t?this.getSlotInfoBySlot:this.getSlotInfoByHelp,s=e.length;i<s;i++)e[i].id&&(a=n.call(this,e[i].slot))&&a.setData(e[i])},setMainRoleSlotGray:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this.getSlotInfoBySlot(1);a&&(a.isGray=t)},updateAllInfoAlert:function(e){for(var t=!(0<arguments.length&&void 0!==e)||e,a=null,i=0,n=this.partnerInfoArr.length;i<n;i++)a=this.partnerInfoArr[i],this.updateInfoAlert(a,t)},updateInfoAlert:function(e,t){t?this.checkInfoAlert(e):e.isBackAlert=!1},checkInfoAlert:function(e){e.isBackAlert=this.canUpgrade(e),e.isBackAlert||(e.isBackAlert=this.canStar(e),e.isBackAlert||(e.isBackAlert=this.canInfoUpgrade(e,game.PartnerUpgradeTypes.BREAK),e.isBackAlert||(e.isBackAlert=this.canAwaken(e),e.isBackAlert||(e.isBackAlert=this.canSpirit(e),e.isBackAlert||(e.isBackAlert=this.canTalent(e),e.isBackAlert||(e.isBackAlert=this.canActive(e),e.isBackAlert))))))},updateAllSlotAlert:function(e){for(var t=!(0<arguments.length&&void 0!==e)||e,a=null,i=0,n=this.partnerSlots.length;i<n;i++)a=this.partnerSlots[i],this.updateSlotAlert(a,t)},updateSlotAlert:function(e,t){t?this.checkSlotAlert(e):e.isAlert=!1},checkSlotAlert:function(e){var t=this;e.isAlert=t.canSkin(e),e.isAlert||(e.isAlert=t.canUpgrade(e.info),e.isAlert||(e.isAlert=t.canStar(e.info),e.isAlert||(e.isAlert=t.canInfoUpgrade(e.info,game.PartnerUpgradeTypes.BREAK),e.isAlert||(e.isAlert=t.canSlotBattle(e),e.isAlert||(e.isAlert=e.id&&t.canAutoEquip(e),e.isAlert||(e.isAlert=t.canAwaken(e.info),e.isAlert||(e.isAlert=t.canSpirit(e.info),e.isAlert||(e.isAlert=t.canTalent(e),e.isAlert||e.info&&e.info.isMainRole&&(e.isAlert=t.canUpQualityFetter(),e.isAlert)))))))))},canActive:function(e){return!(!e||e.active)&&game.UpgradeUtil.checkItemList(e.cfg.chipItems,1,!1)},canSkin:function(e){var t=e.info;if(!t||t.isMainRole)return!1;t.skinInfoMap||t.skinInfos;for(var a=t.skinInfoMap.get(t.useSkin),i=!1,n=0,s=t.skinInfos.length;n<s;n++){var r=t.skinInfos[n];r.isAlert=game.UpgradeUtil.checkItemInfo(r.cfg.itemId,r.cfg.itemNum,!1),a&&r.active&&a.power<r.power&&(r.isAlert=!0),r.isAlert&&(i=!0)}return i},canAwaken:function(e){if(!game.moduleOpen.checkOpen(game.ME.PartnerAwaken))return!1;if(e&&e.__isSlot&&(e=e.info),!e)return!1;var t=game.PartnerAwakenCfg.getData(e.id);return!(!t||e.star<t.activateStar)&&game.UpgradeUtil.checkItemInfo(t.itemId,t.num,!1)},canInfoUpgrade:function(e,t,a){if(t==game.PartnerUpgradeTypes.BREAK&&!game.moduleOpen.checkOpen(game.ME.PartnerBreak))return!1;if(e&&e.__isSlot&&(e=e.info),e){if(e.id){if(!this._super(e,t,a))return!1;if(t==game.PartnerUpgradeTypes.BREAK)if(e.getUpgradeCfgByType(t,a).needLv>e.lv)return!1;return!0}}},canUpgrade:function(e){if(e&&e.__isSlot&&(e=e.info),!e||!e.active||e.lv>=2*game.mainRoleData.lv||e.lv>=game.mainRoleData.maxLv)return!1;var t=game.PartnerBookCfg.getDatas();if(!t||!t.length)return!1;for(var a=void 0,i=0,n=game.PartnerUpgradeCfg.getData(e.lv).exp-e.exp,s=0,r=0,o=0,g=t.length;o<g;o++){a=t[o],s=game.itemData.getNumById(a.id);for(var u=0;u<s;u++)if(i+=a.exp,r+=a.silver,n<=i)return game.UpgradeUtil.checkAmountByType(game.AmountType.SILVER,r,!1)}return!1},canStar:function(e){if(e&&e.__isSlot&&(e=e.info),!game.moduleOpen.checkOpen(game.ME.PartnerStar))return!1;if(!e)return!1;var t=this.canInfoUpgrade(e,game.PartnerUpgradeTypes.STAR);if(!t)return!1;if(e.isMainRole)t=this.masterCanUpStar();else{var a=e.getUpgradeCfgByType(game.PartnerUpgradeTypes.STAR);t=game.UpgradeUtil.checkItemInfo(a.itemId,a.num,!1)}return t},masterCanUpStar:function(){var e=this.getMainRoleInfo().getUpgradeCfgByType(game.PartnerUpgradeTypes.STAR),t=(game.PartnerStarconditionType,this.getProgressByType(e.conditionType));return e.param<=t},canSpirit:function(e){if(e&&e.__isSlot&&(e=e.info),!e)return!1;if(!game.PartnerJingpoCfg.getData(e.jpLv+1))return!1;var t=e.getUpgradeCfgByType(game.PartnerUpgradeTypes.JINGPO),a=game.UpgradeUtil.checkItemList(t.costItems,1,!1),i=t.needLv<=e.lv;return a&&i},canTalent:function(e){if(e&&e.__isSlot&&(e=e.info),!e)return!1;if(e.isMainRole)return!1;if(!game.moduleOpen.checkOpen(game.ME.PartnerTalent))return!1;if(!game.PartnerTalentCfg.getData(e.id,e.qualityNum+1))return!1;var t=game.PartnerTalentCfg.getData(e.id,e.qualityNum),a=e.getCurrTalentTask();if(a){if(a.progress<=e.getProValueByType(a.taskType))return!0}else if(game.UpgradeUtil.checkItemInfo(t.itemId,t.itemNum,!1))return!0;return!1},canSlotBattle:function(e){if(!e.getUnIsLock()||e.info)return!1;for(var t=void 0,a=0,i=this.partnerInfoArr.length;a<i;a++)if((t=this.partnerInfoArr[a]).active&&!t.battlePos&&!t.helpPos&&!t.helpArmyPos)return!0;return!1},canHelpBattle:function(e){if(!e.getUnIsLock()||e.info)return!1;for(var t=void 0,a=0,i=this.partnerInfoArr.length;a<i;a++)if((t=this.partnerInfoArr[a]).active&&!t.helpPos&&!t.battlePos&&!t.helpArmyPos)return!0;return!1},getIdleHelpSlots:function(){this._idleHelps||(this._idleHelps=[]);for(var e=void(this._idleHelps.length=0),t=0,a=this.partnerHelps.length;t<a;t++)(e=this.partnerHelps[t]).getUnIsLock()&&!e.id&&(this._idleHelps[this._idleHelps.length]=e.slot);return this._idleHelps},getHelpPartners:function(){var e=this;e._helpPartners||(e._helpPartners=[]);for(var t=void(e._helpPartners.length=0),a=0,i=e.partnerInfoArr.length;a<i;a++)!(t=e.partnerInfoArr[a]).active||t.battlePos||t.helpArmyPos||(e._helpPartners[e._helpPartners.length]=t);return e._helpPartners.sort(e.helpSort),e._helpPartners},getRebornPartners:function(){var e=this;e._rebornPartners||(e._rebornPartners=[]);for(var t=void(e._rebornPartners.length=0),a=0,i=e.partnerInfoArr.length;a<i;a++)!(1<(t=e.partnerInfoArr[a]).lv||t.breakLv||t.jpLv)||!t.active||t.helpPos||t.battlePos||t.helpArmyPos||(e._rebornPartners[e._rebornPartners.length]=t);return e._rebornPartners.sort(e.helpSort),e._rebornPartners},getHelpsAllStat:function(){this._helpAllStatInfo||(this._helpAllStatInfo={});for(var e=void 0,t=void 0,a=0,i=0,n=0,s=0,r=0,o=this.partnerHelps.length;r<o;r++)(e=this.partnerHelps[r]).id&&(a+=(t=game.PartnerStarCfg.getData(e.id,e.info.star)).teamHp,i+=t.teamAtk,n+=t.teamDef,s+=t.helpPer);return this._helpAllStatInfo.teamAtk=i,this._helpAllStatInfo.teamDef=n,this._helpAllStatInfo.teamHp=a,this._helpAllStatInfo.teamPer=s,this._helpAllStatInfo},getUnLockHelpCount:function(){return this.getUnLockCount(this.partnerHelps)},getUnLockBattleCount:function(){return this.getUnLockCount(this.partnerSlots)},getToBattleCount:function(){for(var e=0,t=void 0,a=0,i=this.partnerSlots.length;a<i;a++)(t=this.partnerSlots[a])&&1!=t.id&&t.id&&e++;return e},getUnLockCount:function(e){for(var t=0,a=0,i=e.length;a<i;a++)e[a].getUnIsLock()&&t++;return t},getIdelBattlePos:function(){for(var e=void 0,t=0,a=this.partnerSlots.length;t<a;t++)if((e=this.partnerSlots[t]).getUnIsLock()&&!e.id)return e.slot;return null},getFormationPartners:function(){var e=this;e._formationPartners||(e._formationPartners=[]);for(var t=void(e._formationPartners.length=0),a=0,i=e.partnerInfoArr.length;a<i;a++)(t=e.partnerInfoArr[a]).isMainRole||!t.active||t.helpPos||t.helpArmyPos||(e._formationPartners[e._formationPartners.length]=t);return e._formationPartners.sort(e.infoSortFunc),e._formationPartners},canAutoEquip:function(e){return game.partnerEquipData.checkAllCanWearList(e)},canBreakEquip:function(e){return game.partnerEquipData.canBreakExcEquip(e)},canChangeOrBreakEquip:function(e,t){var a=game.partnerEquipData,i=a.checkCanWearByPos(e,t),n=game.partnerData.getSlotInfoBySlot(e),s=t==game.EquipPosType.POS_7&&a.canBreakExcEquip(n);return i||s},updateSlotInfo:function(e){this.getSlotInfoBySlot(e.slot).updatePartner(e),this.selectSlotInfoBySlot(e.slot),this.setTeamEmbattle(e.teamEmbattle)},updateHelpInfo:function(e){this.getSlotInfoByHelp(e.slot).setData(e)},selectFirstSlotInfo:function(){if(this.newDefaultSel)return this.selectSlotInfoBySlot(this.newDefaultSel),void(this.newDefaultSel=null);var e=this.partnerSlots;e&&0<e.length&&this.selectSlotInfoBySlot(e[0].slot)},selectSlotInfoBySlot:function(e){var t=this.getSlotInfoBySlot(this.selectSlot),a=this.getSlotInfoBySlot(e);t&&(t.select=!1),a.select=!0,this.selectSlot=e,a&&a.info&&(this.selectPartnerInfo=a.info)},getSlotInfoBySlot:function(e){return e>this.partnerSlots.length?null:this.partnerSlots[e-1]},getSlotInfoByHelp:function(e){return e>this.partnerHelps.length?null:this.partnerHelps[e-1]},getNotBattlePartnerList:function(){this.notBattleList||(this.notBattleList=[]);for(var e=void 0,t=this.notBattleList.length=0,a=this.partnerInfoArr.length;t<a;t++)!(e=this.partnerInfoArr[t]).active||e.battlePos||e.helpPos||e.helpArmyPos||this.notBattleList.push(e);return this.notBattleList.sort(this.changeSort),this.notBattleList},getSlotHaveEquip:function(e,t){if(!e||!t)return!1;var a=this.getSlotInfoBySlot(e);if(!a)return!1;for(var i=a.getEquipMap(),n=game.EquipPosType.POS_MAX,s=void 0,r=1;r<=n;r++)if((s=i.get(r))&&game.partnerEquipData.getWearEquipInfo(r,s).id==t)return!0;return!1},getSlotHaveExclusive:function(e,t){if(!e||!t)return!1;var a=this.getSlotInfoBySlot(e);if(!a)return!1;var i=a.getEquipMap(),n=game.EquipPosType.POS_7,s=i.get(n);return!!s&&game.partnerEquipData.getWearEquipInfo(n,s).id==t},updateLv:function(e,t,a){var i=this.getInfoById(e);i&&i.updateLv(t,a)},updateBreakLv:function(e,t){var a=this.getInfoById(e);a&&a.updateBreakLv(t)},updateStar:function(e){var t=this.getInfoById(e);t&&t.updateStar(t.star+1)},updateActive:function(e){var t=this.getInfoById(e);t&&t.updateActive(e),this.activeCount++},updateAwakenLv:function(e,t){var a=this.getInfoById(e);a&&a.updateAwakenLv(t)},updateJpLv:function(e,t){var a=this.getInfoById(e);a&&a.updateJingpoLv(t)},updateTalentTask:function(e,t){var a=this.getInfoById(e);a&&a.updateTalentTask(t)},updateQualityNum:function(e,t){var a=this.getInfoById(e);a&&a.updateQualityNum(t)},setShowInfo:function(e){var t=this;t._showPartnerInfo||(t._showPartnerInfo=new game.PartnerInfo),t._showPartnerInfo.clearInfo();var a=game.PartnerCfg.getData(e);t._showPartnerInfo.setCfgData(a),t._showPartnerInfo.id=e,t._showPartnerInfo.name=a.name,t._showPartnerInfo.puSkill=a.skill,t._showPartnerInfo.updateLv(1,0),t._showPartnerInfo.updateBreakLv(0),t._showPartnerInfo.updateStar(0),t.showInfo=t._showPartnerInfo},getIsActive:function(e){var t=this.getInfoById(e);return t&&t.active},getCurSlotInfo:function(){return this.getSlotInfoBySlot(this.selectSlot)},getInfoList:function(){return this.partnerInfoArr},getInfoMap:function(){return this.partnerInfoMap},getDataCfgs:function(){return game.PartnerCfg.getDatas()},getRebirthCosts:function(e){var t=this,a=t.getInfoById(e);if(t.rebirthCosts||(t.rebirthCosts=[]),t.clearList(t.rebirthCosts),a){var i=void 0;if(a.breakLv)for(var n=game.PartnerTopCfg.getData(a.breakLv),s=0,r=n.rebirthItems.length;s<r;s++)i=game.ItemUtil.createBaseItemInfo(n.rebirthItems[s].Id,n.rebirthItems[s].Num),t.rebirthCosts[t.rebirthCosts.length]=i;var o=game.PartnerUpgradeCfg.getData(a.lv);if(o.totalExp){t._costList||t.initExpCfg();for(var g=o.totalExp+a.exp,u=void 0,l=0,c=t._costList.length;l<c;l++)u=t._costList[l],Math.floor(g/u.exp)&&(i=game.ItemUtil.createBaseItemInfo(u.id,Math.floor(g/u.exp)),g%=u.exp,t.rebirthCosts[t.rebirthCosts.length]=i)}if(a.jpLv)for(var h=game.PartnerJingpoCfg.getData(a.jpLv).rebirthItems,m=0;m<h.length;m++)i=game.ItemUtil.createBaseItemInfo(h[m].Id,h[m].Num),t.rebirthCosts[t.rebirthCosts.length]=i}return t.rebirthCosts},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},changeSort:function(e,t){return t.fightAmount-e.fightAmount},infoSortFunc:function(e,t){if(0<e.battlePos&&t.battlePos<=0)return-1;if(e.battlePos<=0&&0<t.battlePos)return 1;if(0<e.battlePos&&0<t.battlePos)return e.battlePos-t.battlePos;var a=e.sortId-t.sortId;return e.active&&!t.active?-1:!e.active&&t.active?1:(e.active||t.active,e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:a)},helpSort:function(e,t){return 0<e.helpPos&&t.helpPos<=0?-1:e.helpPos<=0&&0<t.helpPos?1:0<e.helpPos&&0<t.helpPos?e.helpPos-t.helpPos:e.helpPower>t.helpPower?-1:e.helpPower<t.helpPower?1:e.id-t.id},updateAllStat:function(){this.updateAllPartnerStat(),this.updateAllSlotStat()},updateAllPartnerStat:function(){for(var e=0,t=this.partnerInfoArr.length;e<t;e++)this.partnerInfoArr[e].active&&this.partnerInfoArr[e].updateAllStat()},updateAllSlotStat:function(){for(var e=0,t=this.partnerSlots.length;e<t;e++)this.partnerSlots[e].getUnIsLock()&&this.partnerSlots[e].updateAllStat()},setHelpAllAlert:function(e){for(var t=0,a=this.partnerHelps.length;t<a;t++)this.partnerHelps[t].isAlert=e},openAwakenSkillTips:function(e){this.awakenSkillInfo=e.skillParam,game.module.show(game.ME.PartnerAwakenSkill)},getPartnerMaxLv:function(){for(var e=void 0,t=0,a=0,i=this.partnerInfoArr.length;a<i;a++)!(e=this.partnerInfoArr[a])||!e.active||e.lv<t||1==e.cfg.id||(t=e.lv);return t},getPartnerMaxStar:function(){for(var e=void 0,t=0,a=0,i=this.partnerInfoArr.length;a<i;a++)!(e=this.partnerInfoArr[a])||!e.active||e.star<t||1==e.cfg.id||(t=e.star);return t},getPantmerNumByBreak:function(e){for(var t=this.partnerInfoArr.length,a=0,i=0;i<t;i++)this.partnerInfoArr[i].breakLv>=e&&a++;return a},getPantmerNumByStar:function(e){for(var t=this.partnerInfoArr.length,a=0,i=0;i<t;i++)this.partnerInfoArr[i].star>=e&&a++;return a},getPartnerNumByJpLv:function(e){for(var t=this.partnerInfoArr.length,a=void 0,i=0,n=0;n<t;n++)(a=this.partnerInfoArr[n]).jpLv>=e&&a.active&&i++;return i},getPartnerNumByQuality:function(e){for(var t=this.partnerInfoArr.length,a=void 0,i=0,n=0;n<t;n++)(a=this.partnerInfoArr[n]).cfg.quality==e&&a.active&&i++;return i},getPartnerNumByQuaAndCondition:function(e,t,a){for(var i=1<arguments.length&&void 0!==t?t:null,n=2<arguments.length&&void 0!==a?a:0,s=this.partnerInfoArr.length,r=void 0,o=0,g=0;g<s;g++)if((r=this.partnerInfoArr[g]).active&&1!=r.id){var u=!0,l=!0;if(e&&(l=r.cfg.quality==e),i)switch(i){case 1:u=r.star>=n;break;case 2:u=r.lv>=n;break;case 3:u=r.breakLv>=n;break;case 4:u=r.jpLv>=n}l&&u&&o++}return o},getAllPantnerGemTotalLv:function(){for(var e=this.partnerSlots.length,t=0,a=0;a<e;a++)t+=this.partnerSlots[a].getEquipGemTotalLv();return t},getPartnerNumByIntensify:function(e){for(var t=this.partnerSlots.length,a=0,i=0;i<t;i++)this.partnerSlots[i].getEquipIntensifyTotalLv()>=e&&a++;return a},getAllPartnerIntensifylv:function(){for(var e=this.partnerSlots.length,t=0,a=0;a<e;a++)t+=this.partnerSlots[a].getEquipIntensifyTotalLv();return t},getAllPartnerRefinelv:function(){for(var e=this.partnerSlots.length,t=0,a=0;a<e;a++)t+=this.partnerSlots[a].getEquipRefinelvTotalLv();return t},getAllPartnerPurifylv:function(){for(var e=this.partnerSlots.length,t=0,a=0;a<e;a++)t+=this.partnerSlots[a].getEquipPurifyTotalLv();return t},getSlotNumBySuitQuality:function(e){for(var t=this.partnerSlots.length,a=void 0,i=0,n=0;n<t;n++)(a=this.partnerSlots[n]).checkIsWrarSuit()&&game.partnerEquipData.getWearEquipInfo(1,a.getEquipIdxByPos(1)).quality>=e&&i++;return i},getRacePartners:function(){this._racePartners||(this._racePartners=[]);for(var e=void(this._racePartners.length=0),t=0,a=this.partnerInfoArr.length;t<a;t++)!(e=this.partnerInfoArr[t]).isMainRole&&e.active&&(this._racePartners[this._racePartners.length]=e);return this._racePartners},getMainRoleInfo:function(){return this.getInfoById(1)},getMainRoleSlotInfo:function(){return this.getSlotInfoBySlot(1)},getCombinePartnerInfo:function(e){var t=e.cfg;if(t.combines.length<1)return!1;var a=this.partnerSlots.length,i=void 0;this.clearCombines();for(var n=0;n<a;n++)i=this.partnerSlots[n],-1!=t.combines.indexOf(i.id)&&this.combinesArr.push(i.id);return 0<this.combinesArr.length?t.combines:null},showPartnerCombine:function(){if(this.combinesArr)for(var e=this.combinesArr.length,t=0;t<e;t++)game.gamePopupMgr.show(game.ME.PartnerCombine,!0)},clearCombines:function(){this.combinesArr.length=0},getEquipResonanceFate:function(e,t){if(!t||!t.info)return null;this.obj||(this.obj=b8e.createMap()),this.obj.fateParam=e;var a=game.PartnerFateCfg.getData(this.obj,!0);if(!a)return null;for(var i=void 0,n=void 0,s=a.length,r=0;r<s;r++)if(i=a[r],!((n=t.info.cfg.fates).length<1)&&-1<n.indexOf(i.id))return i.id;return null},getAllEquipResonanceFate:function(e){if(!e)return null;this.equipFates||(this.equipFates=[]),this.equipFates.length=0;for(var t=e.length,a=void 0,i=void 0,n=game.partnerData.getCurSlotInfo(),s=0;s<t;s++)a=e[s].id,(i=this.getEquipResonanceFate(a,n))&&this.equipFates.push(i);return this.equipFates},getPartnerActiveFate:function(e){var t=this.partnerSlots.length;this.partnerFates||(this.partnerFates=[]);for(var a=void(this.partnerFates.length=0),i=0;i<t;i++)if(a=this.partnerSlots[i]){var n=this.getEquipResonanceFate(e,a);n&&this.partnerFates.push(n)}return this.partnerFates},activeSkin:function(e,t){var a=this.getInfoById(e);if(a){var i=a.skinInfoMap.get(t);i&&(i.active=!0),a.skinSpriteStat.addByCfg(i.cfg,!1),this.activeSkinInfo=a}},huanhuaSkin:function(e,t){var a=this.getInfoById(e);if(a){var i=a.skinInfoMap.get(a.useSkin);i&&(i.useIng=!1);var n=a.skinInfoMap.get(t);n&&(n.useIng=!0),a.useSkin=t}},getPartnerBackList:function(){var a=this;a.partnerBacks||(a.partnerBacks=[]),a.partnerBacks.length=0,a.partnerBacks=[];for(var e=0,t=a.partnerInfoArr.length;e<t;e++){var i=a.partnerInfoArr[e];!i.isMainRole&&i.active&&a.partnerBacks.push(i)}return a.partnerBacks.sort(function(e,t){return a._sortBack(e,t)}),a.partnerBacks},getPartnerBackActiveList:function(){var a=this;a.partnerBackActiveList||(a.partnerBackActiveList=[]);for(var e=a.partnerBackActiveList.length=0,t=a.partnerInfoArr.length;e<t;e++){var i=a.partnerInfoArr[e];i.isMainRole||i.active||a.partnerBackActiveList.push(i)}return a.partnerBackActiveList.sort(function(e,t){return a._sortBack(e,t)}),a.partnerBackActiveList},selectBackInfoById:function(e){var t=this.getInfoById(this.selectBackId),a=this.getInfoById(e);t&&(t.backSelect=!1),a&&(a.backSelect=!0),this.selectBackId=e,this.selectBackInfo=a,this.selectPartnerInfo=this.selectBackInfo;var i=this.getPartnerBackList();if(i)for(var n=i.length,s=0;s<n;s++)e==i[s].id&&(this.backInfoIndex=s)},updateSelectInfo:function(e){this.selectPartnerInfo=e,this.selectBackInfo=e},_sortBack:function(e,t){e.id,t.id;return!e.active&&this.canActive(e)?-1:!t.active&&this.canActive(t)?1:e.battlePos&&!t.battlePos?-1:!e.battlePos&&t.battlePos?1:e.battlePos&&t.battlePos?this._sortBack2(e,t):e.helpPos&&!t.helpPos?-1:!e.helpPos&&t.helpPos?1:(e.helpPos&&t.helpPos,this._sortBack2(e,t))},_sortBack2:function(e,t){var a=e.id-t.id,i=this.getChipNum(e),n=this.getChipNum(t);return e.isBackAlert&&!t.isBackAlert?-1:!e.isBackAlert&&t.isBackAlert?1:!e.active&&0<i&&0==n?-1:!t.active&&0<n&&0==i?1:e.cfg.quality>t.cfg.quality?-1:t.cfg.quality>e.cfg.quality?1:e.star>t.star?-1:t.star>e.star?1:a},getChipNum:function(e){var t=e.cfg;if(!t||e.cfg.chipItems.length<1)return 0;var a=t.chipItems[0];return a?game.itemData.getNumById(a.Id):0},getElementFetterInfos:function(){var e=this;e.elementFetterInfos||(e.elementFetterInfos=[]);var t=void 0,a=void 0;if(e.elementFetterInfos.length<1){var i=game.ElementFetterCfg.getDatas();if(!i)return null;var n=void 0;t=i.length;for(var s=0;s<t;s++)n=i[s],(a=new game.PartnerElementFetterInfo).setData(n),e.elementFetterInfos.push(a)}t=e.elementFetterInfos.length;var r=void 0,o=game.PartnerElemFettersTypes;r=e.elementFettersType==o.OWN||e.elementFettersType==o.ARRAYING||e.elementFettersType==o.ARR_DEFENSE?e.getElemeltFettersNum():e.elementFettersType==o.ATTACK?game.playBack.getElementMaxNum(!0):game.playBack.getElementMaxNum(!1);for(var g=0;g<t;g++)(a=e.elementFetterInfos[g]).isActive=r&&r.id==a.id;return e.elementFetterInfos.sort(e.onSort),e.elementFetterInfos},onSort:function(e,t){return e.num!=t.num?e.num-t.num:e.num2-t.num2},getElemeltFettersNum:function(){var e=this;e.elementMap||(e.elementMap=b8e.HashMap.get()),e.elementMap.clear();var t=void 0,a=0,i=game.PartnerElemFettersTypes,n=void 0;if(!(n=e.elementFettersType==i.ARRAYING?game.playBackFormationData.partnerSlots:e.elementFettersType==i.ARR_DEFENSE?game.playBackFormationData.enemyDatas:e.partnerSlots)||n.length<1)return null;for(var s=0,r=n.length;s<r;s++)if((t=n[s])&&t.info&&(!t.id||0!=t.id&&1!=t.id)){var o=t.info.cfg.element;e.elementMap.get(o)||e.elementMap.set(o,0);var g=e.elementMap.get(o);g++,e.elementMap.set(o,g),a<g&&(a=g)}var u=e.elementMap.values();return u.sort(function(e,t){return t-e}),e.getElemeltFettersCfg(u)},getElemeltFettersCfg:function(e){if(!e||e.length<1)return null;var t=e[0];if(t<2)return null;t=5<t?5:t;var a=game.ElementFetterCfg.getData(t,!0);if(!a||a.length<1)return null;if(a.length<2)return a[0];for(var i=void 0,n=void 0,s=a.length,r=e[1],o=0;o<s;o++)(i=a[o]).num2<=r&&(n=i);return n||a[0]},setHelpArmySlotList:function(e){var t=void 0,a=void 0;this.helpArmyPage2Open=!1;for(var i=0,n=e.length;i<n;i++)(a=e[i]).id&&(t=this.getSlotInfoByHelpArmy(a.slot))&&(t.setData(a),this.helpArmyPage2Open=this.helpArmyPage2Open||2==t.page)},checkHelpArmySlotOpen:function(e,t){if(!e||!t)return!1;for(var a=this.partnerSlots,i=a.length,n=void 0,s=0,r=0;r<i;r++)(n=a[r].info)&&n.quality>=t.quality&&s++;return s>=t.num},getHelpArmyByPage:function(){return 1==this.helpArmyPage?this.helpArmySlotPage1:this.helpArmySlotPage2},setHelpArmyPage:function(e){this.helpArmyPage=e},setHelpArmySelectSlot:function(e){this.selectHelpArmySlot=e},getHelpArmyPartners:function(){var e=this._helpArmyPartners;(e=e||(this._helpArmyPartners=[])).length=0;for(var t=this.partnerInfoArr,a=void 0,i=0,n=t.length;i<n;i++)!(a=t[i]).active||a.battlePos||a.helpPos||a.helpArmyPos||e.push(a);if(e.sort(this.helpArmySort),this.selectHelpArmySlot){var s=this.getSlotInfoByHelpArmy(this.selectHelpArmySlot);s&&s.info&&s.info.helpArmyPos&&e.unshift(s.info)}return e},getHelpArmysWithoutBattle:function(){var e=this._helpArmys;(e=e||(this._helpArmys=[])).length=0;for(var t=this.partnerInfoArr,a=void 0,i=0,n=t.length;i<n;i++)!(a=t[i]).active||a.battlePos||a.helpPos||a.helpArmyPos||e.push(a);return e},helpArmySort:function(e,t){return t.helpArmyPower-e.helpArmyPower},getSlotInfoByHelpArmy:function(e){return e>this.partnerHelpArmys.length?null:this.partnerHelpArmys[e-1]},checkHelpArmyChange:function(e){for(var t=void 0,a=0,i=this.partnerInfoArr.length;a<i;a++)if((t=this.partnerInfoArr[a]).active&&!t.battlePos&&!t.helpPos&&!t.helpArmyPos&&t.helpArmyPower>e.helpArmyPower)return!0;return!1},getHelpArmyChainPageCfgs:function(e){return game.PartnerAidChainCfg.getData(e,!0)},getHelpArmyChainCfg:function(e,t){var a=this.getHelpArmyChainPageCfgs(e);if(a||!(a.length<1))for(var i=0,n=a.length;i<n;i++)if(a[i].quality==t)return a[i]},updateHelpArmyInfo:function(e){this.getSlotInfoByHelpArmy(e.slot).setData(e)},updateHelpArmyOpen:function(){for(var e=this.partnerHelpArmys,t=e.length,a=0;a<t;a++)e[a].updateIsOpen()},getHelpArmyStat:function(){var e=this.partnerHelpArmys,t=this.helpArmyStatAll;t.clear();for(var a=e.length,i=void 0,n=0;n<a;n++)(i=e[n]).info&&t.addSpriteStat(i.info.helpArmySpriteStat);return t},getHelpArmyPage2Open:function(){return this.helpArmyPage2Open=this.helpArmyPage2Open||this.checkHelpArmyPage2Open(),this.helpArmyPage2Open},checkHelpArmyPage2Open:function(){for(var e=this.partnerSlots,t=e.length,a=void 0,i=0;i<t;i++)if((a=e[i].info)&&a.quality>=game.Quality.Q_COLORFUL)return!0;return!1},checkHelpArmyChangeAlert:function(){for(var e=this.partnerHelpArmys,t=e.length,a=void 0,i=0;i<t;i++)if((a=e[i].info)&&this.checkHelpArmyChange(a))return!0;return!1},checkCanAddAlertByPage:function(e){var t=this.getHelpArmysWithoutBattle();if(!t||t.length<1)return!1;for(var a=1==e?this.helpArmySlotPage1:this.helpArmySlotPage2,i=a.length,n=void 0,s=0;s<i;s++)if((n=a[s]).getIsOpen()&&!n.info)return!0;return!1},getLangKeyByType:function(e){var t=53301+e;return t<=53316?t:null},updateQualityFetterStat:function(){if(this.masterFetterId){var e=this.getMainRoleInfo();e.qualityFetterStat.clear();var t=game.MasterQualityFetterCfg.getData(this.masterFetterId);t&&e.qualityFetterStat.setupByCfg(t)}},updateBattleFetterStat:function(){var e=this.getMainRoleInfo(),t=void 0,a=void 0;e.battleFetterStat.clear();for(var i=0,n=this.partnerSlots.length;i<n;i++)(t=this.partnerSlots[i]).info&&!t.info.isMainRole&&(a=game.MasterBattleFetterCfg.getData(t.info.quality,t.info.star))&&e.battleFetterStat.addByCfg(a,!1)},canUpQualityFetter:function(){var e=+game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"masterQualityFetterMax");if(this.masterFetterId>=e)return!1;var t=game.MasterQualityFetterCfg.getData(this.masterFetterId+1),a=void 0;if(!t)return!1;for(var i=0,n=this.partnerSlots.length;i<n;i++)if((!(a=this.partnerSlots[i]).info||!a.info.isMainRole)&&(!a.info||a.info.quality<t.quality||a.info.star<t.star))return!1;return!0},getBattleQualityCount:function(e){for(var t=void 0,a=0,i=0,n=this.partnerSlots.length;i<n;i++)(t=this.partnerSlots[i]).info&&!t.info.isMainRole&&t.info.quality>=e&&a++;return a},getProgressByType:function(e){var t=game.PartnerStarconditionType,a=0;switch(e){case t.MAIN_INSTANCE:a=game.mainInstanceData.id;break;case t.BARBARIAN:a=game.barbarianData.histStar;break;case t.STARMAP:a=game.wushengData.id;break;case t.ENDLESS:a=game.zhanjiangData.getLayer()}return a}});game.partnerData=game.partnerData||new e}(),function(){var e=b8e.Object.extends({info:null,roleType:0,ctor:function(){this._super()},setInfo:function(e,t){this.info=e,this.roleType=t},getInfo:function(){return this.info}});game.partnerStarData=game.partnerStarData||new e}(),function(){var e=b8e.Object.extends({info:null,roleType:0,ctor:function(){this._super()},setInfo:function(e,t){this.info=e,this.roleType=t},getInfo:function(){return this.info}});game.partnerBreakData=game.partnerBreakData||new e}(),function(){var e;e=b8e.Object.extends({num:0,skillId:0,isActive:0,id:0,num2:0,setData:function(e){this.num=e.num,this.skillId=e.skillId,this.id=e.id,this.num2=e.num2}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerElementFetterInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({taskId:0,taskType:0,progress:0,skillId:0,sort:0,isFinish:!1,moduleId:0,toggle:0,setData:function(e){this.taskId=e.talentTask,this.taskType=e.taskType,this.progress=e.progress,this.skillId=e.skillId,this.moduleId=e.moduleId,this.toggle=e.toggle},recycle:function(){this.reset(),this._super()},reset:function(){this.taskId=0,this.taskType=0,this.progress=0,this.skillId=0,this.sort=0,this.isFinish=!1,this.moduleId=0,this.toggle=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$PartnerTalentTaskInfo",t)}(),function(){var e,t,a,i,n,s;s=b8e.Enum({C_SELECTCHANGE:b8e.enc(),V_SELECTCHANGE:b8e.enc(),V_UPDATEHEADLIST:b8e.enc(),V_TOGGLECHANGE:b8e.enc(),V_UPDATE_DATA:b8e.enc(),C_INIT_DATA:b8e.enc(),C_ONSHOW:b8e.enc(),V_UPDATE_COST:b8e.enc(),V_UPDATE_AUTO_USE:b8e.enc(),V_UPDATE_LV:b8e.enc(),V_UPDATE_BREAK:b8e.enc(),V_UPDATE_STAR:b8e.enc(),C_UPDATE_POWER:b8e.enc(),V_SELECT_BATTLE:b8e.enc(),C_UPDATE_BATTLE:b8e.enc(),V_SELECT_HELP:b8e.enc(),C_UPDATE_HELP:b8e.enc(),C_UPDATE_FORMATION:b8e.enc(),C_SAVE_FORMATION:b8e.enc(),C_CHANGE_PARTNER:b8e.enc(),V_SCROLLLEFT:b8e.enc(),V_SCROLLRIGHT:b8e.enc(),C_CLOSE_ACTIVE_TIPS:b8e.enc(),C2C_AUOT_WEAR:b8e.enc(),C_UPDATE_ALL_STATE:b8e.enc(),C_INIT_ROLE_DATA:b8e.enc(),C_UPDATE_ACTIVE:b8e.enc(),C_UPDATE_ROLE_DATA:b8e.enc(),C2C_ROLE_QUALITY_CHANGE:b8e.enc(),C2V_UPDATE_ZX:b8e.enc(),C2C_UPDATE_SURFACE:b8e.enc(),C2C_SHOW_ACTIVETIPS_COMPLETE:b8e.enc(),V_UPDATE_SPIRIT:b8e.enc(),V_UPDATE_TALENT:b8e.enc(),V_UPDATE_TALENT_ACT:b8e.enc(),V_PLAY_PRO_EFFECT:b8e.enc(),V_PLAY_UP_EFFECT:b8e.enc(),C_PLAY_UP_EFFECT:b8e.enc(),C2C_CHECK_PUSH_PRIZE:b8e.enc(),C_UPDATE_SKIN:b8e.enc(),C2C_UPDATE_ROLE_LV:b8e.enc(),C_ACTIVE_REQ:b8e.enc(),C_SWITCH_PARTNER:b8e.enc(),C_BACK_TOGGLE_CHANGE:b8e.enc(),C2C_UPDATE_STAR_TASK:b8e.enc(),V2C_LOOK_TALENT_SKILL:b8e.enc(),C2C_REBORN_COMPLETE:b8e.enc(),C_UPDATE_FETTER:b8e.enc(),C_SHOW_FIGHT:b8e.enc(),V_SHOW_DETAILS:b8e.enc()}),n=b8e.Enum({Partner:1,Equip:2,Exclusive:3}),i=b8e.Enum({None:0,UPGRADE:1,BREAK:2,STAR:3,JINGPO:4}),a=b8e.Enum({None:0,STAT:1,SKILL:2,FATE:3,BREAK:4}),t=b8e.Enum({None:0,OWN:1,ATTACK:2,DEFENSE:3,ARRAYING:4,ARR_DEFENSE:5}),e=b8e.Enum({None:0,TYPE_1:1,TYPE_2:2,TYPE_3:3,TYPE_4:4,TYPE_5:5,TYPE_6:6,TYPE_7:7,TYPE_8:8,TYPE_9:9}),b8e.RC("$$game","$$PartnerEvts",s),b8e.RC("$$game","$$PartnerFateEnum",n),b8e.RC("$$game","$$PartnerUpgradeTypes",i),b8e.RC("$$game","$$PartnerDetailsEnum",a),b8e.RC("$$game","$$PartnerElemFettersTypes",t),b8e.RC("$$game","$$TalentTaskType",e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},Partner:{C_SELECTCHANGE:this.updateData},PartnerBackOp:{C_SELECTCHANGE:this.updateData}},this.handels={PartnerTopResp:this.partnerTopResp}},updateData:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_COST)},partnerTopResp:function(e){var t=this,a=e.readProtobuf(game.pb.PartnerTopResponse);if(0<a.code)game.notice.noticeError(a.code);else{var i=t.data.getInfoById(a.id);game.FightAmount.inst().setNomalStat(i.allSpriteStat),t.data.updateBreakLv(a.id,a.top),game.FightAmount.inst().setUpdatedStat(i.allSpriteStat),t.data.updateAllSlotStat(),t.send(t.Evts.V_UPDATE_DATA),t.dpt(t.Evts.V_UPDATE_BREAK),t.dpt(t.Evts.C_PLAY_UP_EFFECT),t.openBackBreakTips(i),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeTupo)}},openBackBreakTips:function(e){game.partnerBreakData.setInfo(e,game.RoleType.Partner),game.module.show(game.ME.PartnerBackBreakTips)},upgradeBtn:function(){var e=this.data.selectPartnerInfo;e&&this._upgrade(e)},_upgrade:function(e){var t=game.PartnerTopCfg.getData(e.breakLv);t.needLv>e.lv?game.notice.show(51519):game.UpgradeUtil.checkUpgradeCost(t.costItems,!0,!0)&&this.sender.PartnerTopReq(e.id)},comon_power:function(){var e=this.data.selectPartnerInfo;e&&(game.partnerData.showInfo=e,game.module.show(game.ME.PartnerDetails))},costNode1:function(){this.showCostTips(1)},costNode2:function(){this.showCostTips(3)},showCostTips:function(e){var t=this.data.selectPartnerInfo;if(t){var a=game.PartnerTopCfg.getData(t.breakLv).costItems;if(!(e>=a.length)){var i=game.ItemInfoCfg.getData(a[e-1].Id);i&&(game.tipsData.setInfo(i),game.module.show(game.ME.ItemTips))}}}});var t=game.Sender.extends({ipc:function(){this.msg={PartnerTopReq:this.partnerTopReq}},partnerTopReq:function(e){var t=game.pb.PartnerTopRequest;t.id=e,this.write(t)}}),a=[game.ME.PartnerBackBreak,game.ME.PartnerBackBreakTips];b8e.module.registerControl(game.ME.PartnerBreak,e,game.PartnerEvts,t,a),b8e.RC("$$game","$$PartnerBreakControl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={PartnerFormation:{C_CHANGE_PARTNER:this.changePartner}},this.handels={PartnerBattleResp:this.partnerBattleResp}},changePartner:function(e){var t=e.data;t&&this.sender.PartnerBattleReq(t.slot,t.id)},notify:function(e,t){switch(e){case this.Evts.V_SELECT_BATTLE:if(!this.data.changeSlot)return;var a=this.data.changeSlot;this.sender.PartnerBattleReq(a.slot,t.id),game.module.hide(this.moduleEnum)}},partnerBattleResp:function(e){var t=this,a=e.readProtobuf(game.pb.PartnerBattleResponse);if(0<a.code)game.notice.noticeError(a.code);else{var i=t.data.getSlotInfoBySlot(a.slot);if(i){game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeGoBattle),game.FightAmount.inst().setNomalStat(i.allSpriteStat),t.data.updateSlotInfo(a),game.FightAmount.inst().setUpdatedStat(i.allSpriteStat),t.data.updateBattleFetterStat(),t.dpt(t.Evts.C_UPDATE_BATTLE),t.createScenePartners();var n=t.data.getInfoById(a.id);t.data.getCombinePartnerInfo(n)&&(t.data.currCombineInfo=n,t.data.showPartnerCombine())}}},createScenePartners:function(){this.data&&game.scene.createPartners(game.mainRole,this.data.partnerSlots)}});var t=game.Sender.extends({ipc:function(){this.msg={PartnerBattleReq:this.partnerBattleReq}},partnerBattleReq:function(e,t){var a=game.pb.PartnerBattleRequest;a.slot=e,a.id=t,this.write(a)}});b8e.module.registerControl(game.ME.PartnerChange,e,game.PartnerEvts,t),b8e.RC("$$game","$$PartnerChangeControl",e)}();(function(){var e;e=game.Control.extends({init:function(){var e=this,t=game.spotAlert;e.partnerAlert=t.set(game.SAE.PARTNER),e.partnerMainAlert=t.set(game.SAE.PARTNER_MAIN,game.SAE.PARTNER),e.partnerUpgradeAlert=t.set(game.SAE.PARTNER_UPGRADE,game.SAE.PARTNER),e.partnerStarAlert=t.set(game.SAE.PARTNER_STAR,game.SAE.PARTNER),e.partnerBreakAlert=t.set(game.SAE.PARTNER_BREAK,game.SAE.PARTNER),e.partnerTalentAlert=t.set(game.SAE.PARTNER_TALENT,game.SAE.PARTNER),e.partnerFetterAlert=t.set(game.SAE.PARTNER_QUALITY_FETTER,game.SAE.PARTNER),e.partnerAutoEquipAlert=t.set(game.SAE.PARTNER_AUTOEQUIP,game.SAE.PARTNER_MAIN),e.partnerEquipBreak=t.set(game.SAE.PARTNER_EQUIP_BREAK,game.SAE.PARTNER_MAIN),e.partnerAwakenAlert=t.set(game.SAE.PARTNER_AWAKEN,game.SAE.PARTNER_MAIN),e.partnerBattleAlert=t.set(game.SAE.PARTNER_BATTLE,game.SAE.PARTNER_MAIN),e.partnerHelpBaseAlert=t.set(game.SAE.PARTNER_HELP_BASE,game.SAE.PARTNER_MAIN),e.partnerHelpAlert=t.set(game.SAE.PARTNER_HELP,game.SAE.PARTNER_HELP_BASE),e.partnerSkinAlert=t.set(game.SAE.PARTNER_SKIN,game.SAE.PARTNER_MAIN),e.partnerCurBattleAlert=t.set(game.SAE.PARTNER_CUR_BATTLE,game.SAE.PARTNER_CUR_MAIN_TAB),e.partnerCurHelpAlert=t.set(game.SAE.PARTNER_CUR_HELP,game.SAE.PARTNER_CUR_MAIN_TAB),e.partnerCurSkinAlert=t.set(game.SAE.PARTNER_CUR_SKIN,game.SAE.PARTNER_CUR_MAIN_TAB),e.partnerCurSurfaceAlert=t.set(game.SAE.PARTNER_CUR_SURFACE,game.SAE.PARTNER_CUR_MAIN_TAB),t.set(game.SAE.PARTNER_CUR_MAIN_TAB,game.SAE.PARTNER),t.set(game.SAE.PARTNER_CUR_UPGRADE_TAB,game.SAE.PARTNER),t.set(game.SAE.PARTNER_CUR_STAR_TAB,game.SAE.PARTNER),t.set(game.SAE.PARTNER_CUR_BREAK_TAB,game.SAE.PARTNER),t.set(game.SAE.PARTNER_CUR_SPIRIT_TAB,game.SAE.PARTNER),t.set(game.SAE.PARTNER_CUR_TALENT_TAB,game.SAE.PARTNER),e.partnerCurUpgradeAlert=t.set(game.SAE.PARTNER_CUR_UPGRADE,game.SAE.PARTNER_CUR_UPGRADE_TAB),e.partnerCurStarAlert=t.set(game.SAE.PARTNER_CUR_STAR,game.SAE.PARTNER_CUR_STAR_TAB),e.partnerCurBreakAlert=t.set(game.SAE.PARTNER_CUR_BREAK,game.SAE.PARTNER_CUR_BREAK_TAB),e.partnerCurAutoEquipAlert=t.set(game.SAE.PARTNER_CUR_AUTOEQUIP,game.SAE.PARTNER_CUR_MAIN_TAB),e.partnerCurAwakenAlert=t.set(game.SAE.PARTNER_CUR_AWAKEN,game.SAE.PARTNER_CUR_MAIN_TAB),e.partnerCurSpiritAlert=t.set(game.SAE.PARTNER_CUR_SPIRIT,game.SAE.PARTNER_CUR_SPIRIT_TAB),e.partnerCurTalentAlert=t.set(game.SAE.PARTNER_CUR_TALENT,game.SAE.PARTNER_CUR_TALENT_TAB),e.data=game.partnerData},triggerOpen:function(e){e==this.moduleEnum&&this.sender.PartnerModelReq()},ipc:function(){var e=this;e.evts={Back:{C_BACK_UPDATE_ITEMINFO:e.updateItemInfo,C_BACK_SYN_BACK_INFO:e.updateItemInfo,C_UPDATE_PARTNER_ACTIVE:e.showActiveTips},EffectItemTips:{C2C_ACTIVE_PARTNER:e.activePartner},Sell:{PARTNER_REBORN_COMPLETE:e.rebornComplete},Setting:{C_CHANGE_NAME_COMPLETE:e.updateMainRoleName},MainRole:{C_VIP_LEVEL_CHANGE:e.updateVip,C_LEVEL_UP:e.updateLv,C_SPRITE_STATE_CHANGE:e.updateAllStat},PartnerUpgrade:{V_UPDATE_LV:e.updateHeadList,C_PLAY_UP_EFFECT:e.playUpEffect},PartnerBreak:{V_UPDATE_BREAK:e.updateHeadList,C_PLAY_UP_EFFECT:e.playUpEffect},PartnerStar:{V_UPDATE_STAR:e.updateHeadList,C_PLAY_UP_EFFECT:e.playUpEffect},PartnerSpirit:{V_UPDATE_SPIRIT:e.updateHeadList},PartnerTalent:{V_UPDATE_TALENT:e.updateHeadList,V_UPDATE_TALENT_ACT:e.updateTalent},PartnerChange:{C_UPDATE_BATTLE:e.updateBattle},PartnerHelp:{C_UPDATE_HELP:e.updateHelp},PartnerHelpArmy:{C2C_UPDATE_HELP_ARMY:e.updateHelp},PartnerFetter:{C_UPDATE_FETTER:e.updateFetter},EquipForge:{C2C_FORGE_SUCCEED:e.updateAllStat,C2C_INIT_DATA:e.updateAllStat},WuShengMain:{C2C_CREATE_DATA:e.updateStarMap,C2C_TASK_FINISH:e.updateStarMap,C2C_GET_PARTNER:e.newStarMapPartner},Surface:{C2C_UPDATE_SURFACE:e.updateSurface},Recruit:{C2C_SHOW_PARTNER:e.showPartner,C2C_ACTIVE_PARTNER:e.recruitActivePartner},HuntingMain:{C2C_SHOW_PARTNER:e.showPartner,C2C_ACTIVE_PARTNER:e.recruitActivePartner},PartnerSkin:{C_UPDATE_SKIN:e.updateSkin},PartnerBack:{C_ACTIVE_REQ:e.activeReq}},e.gevts={InstanceEvts:{G_STOP_PLAY:e.stopPlay}},e.handels={PartnerModelResp:e.partnerModelResp,PartnerActiveMsg:e.partnerActiveMsg,PartnerActiveResp:e.partnerActiveResp}},activeReq:function(e){this.sender.PartnerActiveReq(e.data)},updateSkin:function(){this.send(this.Evts.V_SELECTCHANGE),this.updateAllStat(),this.createScenePartners()},playUpEffect:function(){this.send(this.Evts.V_PLAY_UP_EFFECT)},updateSurface:function(){this.send(this.Evts.C2C_UPDATE_SURFACE)},updateStarMap:function(){if(this.data.isInit&&game.wushengData.isSyscData){var e=this.data.getSlotInfoBySlot(1),t=game.wushengData.getCurStarPosActivate();e&&e.info&&t&&(e.info.quality=t.changeQuality,e.info.updateLv(e.info.lv,e.info.exp),e.updateAllStat(),this.dpt(this.Evts.C2C_ROLE_QUALITY_CHANGE))}},newStarMapPartner:function(){this.recruit=!0},updateMainRoleName:function(){var e=this.data.getInfoById(1);e.name=game.mainRoleData.name,e.updateAlertInfo(e.redPoint),this.dpt(this.Evts.C_UPDATE_ROLE_DATA,e)},rebornComplete:function(e){var t=e.data;if(t){var a=this.data.getInfoById(t);a&&(a.updateLv(1,0),a.updateBreakLv(0),a.updateJingpoLv(0)),this.dpt(this.Evts.C2C_REBORN_COMPLETE)}},activePartner:function(e){var t=e.data;t&&this.sender.PartnerActiveReq(t)},updateAllStat:function(){this.data.isInit&&(this.data.updateAllStat(),this.send(this.Evts.C_UPDATE_ALL_STATE),this.dpt(this.Evts.C_UPDATE_ALL_STATE))},updateVip:function(){this.data.isInit&&(this.updateHeadList(),this.checkAllAlert())},updateTalent:function(){this.checkAllAlert(),this.updateAllStat()},updateLv:function(){if(this.data.isInit){var e=this.data.getInfoById(1);if(e){e.updateLv(game.mainRoleData.lv,0);this.data.getSlotInfoBySlot(1);this.updateHeadList(),this.checkAllAlert(),this.updateAllStat()}}},updateFetter:function(){this.checkAllAlert()},updateHelp:function(){this.partnerHelpAlert.alert=this.data.checkAnyInfosCanAnyAlert(this.data.canHelpBattle,this.data.partnerHelps),this.checkAllAlert(),this.data.setHelpAllAlert(this.partnerHelpAlert.alert),this.dpt(this.Evts.C_SELECTCHANGE)},updateItemInfo:function(){this.data.isInit&&this.checkAllAlert()},updateBattle:function(){this.checkAllAlert(),this.updateHeadList(),this.updateAllStat(),this.send(this.Evts.V_SELECTCHANGE),this.dpt(this.Evts.C_SELECTCHANGE)},partnerActiveMsg:function(e){var t=e.readProtobuf(game.pb.PartnerActiveNotify);this.data.updateActive(t.id),this.checkAllAlert(),this.updateAllStat(),this.dpt(this.Evts.C_UPDATE_ACTIVE,t.id);var a={};a.id=t.id,a.repeat=!1,this.data.partnerActiveTips.push(a),this.showActiveTips(),this.fateNotice(t.id)},showActiveTips:function(){this.data.partnerActiveTips&&this.data.partnerActiveTips.length&&!b8e.module.isShowView(game.ME.PartnerActive)&&game.module.show(game.ME.PartnerActive)},showPartner:function(){this.recruit=!0,this.showActiveTips();var e=game.partnerData.recruitActiveId;e&&0<e&&(this.fateNotice(e),game.partnerData.recruitActiveId=0)},recruitActivePartner:function(e){if(e&&e.data&&!(e.data.length<1))for(var t=void 0,a=e.data,i=a.length,n=0;n<i;n++)t=a[n],this.data.updateActive(t),this.checkAllAlert(),this.updateAllStat(),this.dpt(this.Evts.C_UPDATE_ACTIVE,t)},partnerActiveResp:function(e){var t=e.readProtobuf(game.pb.PartnerActiveResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.data.updateActive(t.id),this.checkAllAlert(),this.updateAllStat(),this.dpt(this.Evts.C_UPDATE_ACTIVE,t.id);var a={};a.id=t.id,a.repeat=!1,this.data.partnerActiveTips.push(a),this.showActiveTips(t.id),this.fateNotice(t.id)}},partnerAttrsMsg:function(e){var t=e.readProtobuf(game.pb.PartnerAttrsNotify);if(t.datas&&this.data.isInit){for(var a=0,i=t.datas.length;a<i;a++)this.data.getSlotInfoBySlot(t.datas[a].slot).updateStat(t.datas[a].stat);this.send(this.Evts.C_UPDATE_POWER),this.dpt(this.Evts.C_UPDATE_POWER,t)}},partnerModelResp:function(e){var t=e.readProtobuf(game.pb.PartnerModel);0<t.code?game.notice.noticeError(t.code):(this.data.synDatas(t),this.data.selectFirstSlotInfo(),this.updateStarMap(),game.partnerEquipData.updateShareTime(t.nextShareTime),this.checkAllAlert(),this.dpt(this.Evts.C_INIT_DATA,t),this.onPartnerRoleInfoResp(),this.createScenePartners())},onPartnerRoleInfoResp:function(){var e=this.data.getInfoById(1);this.dpt(this.Evts.C_INIT_ROLE_DATA,e)},createScenePartners:function(){this.data&&game.scene.createPartners(game.mainRole,this.data.partnerSlots)},checkAllAlert:function(){var e=this;e.partnerUpgradeAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canUpgrade,e.data.partnerSlots),e.partnerStarAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canStar,e.data.partnerSlots),e.partnerBattleAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canSlotBattle,e.data.partnerSlots),game.moduleOpen.checkOpen(game.ME.PartnerHelp)&&(e.partnerHelpAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canHelpBattle,e.data.partnerHelps)),game.moduleOpen.checkOpen(game.ME.PartnerSkin)&&(e.partnerSkinAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canSkin,e.data.partnerSlots)),game.moduleOpen.checkOpen(game.ME.PartnerTalent)&&(e.partnerTalentAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canTalent,e.data.partnerSlots)),game.moduleOpen.checkOpen(game.ME.PartnerBreak)&&(e.partnerBreakAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canInfoUpgrade,e.data.partnerSlots,game.PartnerUpgradeTypes.BREAK)),e.partnerAutoEquipAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canAutoEquip,e.data.partnerSlots),e.partnerEquipBreak.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canBreakEquip,e.data.partnerSlots),game.moduleOpen.checkOpen(game.ME.PartnerAwaken)&&(e.partnerAwakenAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canAwaken,e.data.partnerSlots)),game.moduleOpen.checkOpen(game.ME.PartnerFetter)&&(e.partnerFetterAlert.alert=e.data.canUpQualityFetter()),e.data.updateAllSlotAlert(),e.data.updateAllInfoAlert(),e.data.setHelpAllAlert(e.partnerHelpAlert.alert),e.checkCurAlert()},checkCurAlert:function(){var e=this,t=e.data.getCurSlotInfo();if(t)if(e.partnerCurAutoEquipAlert.alert=e.data.canAutoEquip(t),e.partnerCurUpgradeAlert.alert=e.data.canUpgrade(t),e.partnerCurStarAlert.alert=e.data.canStar(t)||t.info&&t.info.isMainRole&&e.data.canUpQualityFetter(),e.partnerCurSpiritAlert.alert=e.data.canSpirit(t),e.partnerCurTalentAlert.alert=e.data.canTalent(t),e.partnerCurBreakAlert.alert=e.data.canInfoUpgrade(t,game.PartnerUpgradeTypes.BREAK),game.moduleOpen.checkOpen(game.ME.PartnerAwaken)&&(e.partnerCurAwakenAlert.alert=e.data.canAwaken(t)),1==t.slot){if(game.moduleOpen.checkOpen(game.ME.PartnerHelp)&&(e.partnerCurHelpAlert.alert=e.partnerHelpAlert.alert),game.moduleOpen.checkOpen(game.ME.Surface)){var a=game.spotAlert.get(game.SAE.SURFACE);e.partnerCurSurfaceAlert.alert=a&&a.alert}e.partnerCurSkinAlert.alert=!1,e.partnerCurBattleAlert.alert=e.partnerBattleAlert.alert}else e.partnerCurHelpAlert.alert=!1,e.partnerCurBattleAlert.alert=!1,e.partnerCurSurfaceAlert.alert=!1,game.moduleOpen.checkOpen(game.ME.PartnerSkin)&&(e.partnerCurSkinAlert.alert=e.data.canSkin(t))},notify:function(e,t){var a=this;switch(e){case a.Evts.C_SELECTCHANGE:if(!t.id)return a.data.changeSlot=t,void game.module.show(game.ME.PartnerChange);if(t.slot==a.data.selectSlot)return;if(t.info.isMainRole&&b8e.module.isShowView(game.ME.PartnerUpgrade))return void game.notice.show(51444);a.data.selectSlotInfoBySlot(t.slot),a.checkCurAlert(),a.dpt(a.Evts.C_SELECTCHANGE),a.send(a.Evts.V_SELECTCHANGE);break;case a.Evts.C_ONSHOW:a.data.selectFirstSlotInfo(),a.checkCurAlert(),a.dpt(a.Evts.C_SELECTCHANGE);break;case a.Evts.C_CLOSE_ACTIVE_TIPS:a.data.partnerActiveTips&&a.data.partnerActiveTips.length&&b8e.setTimeout(a.showActiveTips,a,100),a.data.partnerActiveTips&&a.data.partnerActiveTips.length<1&&(a.recruit&&(a.recruit=!1,a.dpt(a.Evts.C2C_SHOW_ACTIVETIPS_COMPLETE)),a.dpt(a.Evts.C2C_CHECK_PUSH_PRIZE))}},btn1:function(){this.selectToggle(0)},btn2:function(){if(this.data.getCurSlotInfo().info.isMainRole){var e=this.data.partnerSlots[1];if(!e.info)return void game.notice.show(51444);this.data.selectSlotInfoBySlot(e.slot),this.send(this.Evts.V_SELECTCHANGE),this.checkCurAlert()}this.selectToggle(1)},btn3:function(){this.selectToggle(2)},btn4:function(){this.selectToggle(3)},btn5:function(){this.selectToggle(4)},btn6:function(){this.selectToggle(5)},updateHeadList:function(){this.send(this.Evts.V_UPDATEHEADLIST)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)},upgradeBtn:function(){var e=game.partnerData.showInfo;game.PartnerAwakenCfg.getData(e.id).activateStar>e.star?(game.partnerData.quickStarInfo=e,game.module.show(game.ME.PartnerQuickStar)):(game.partnerData.awakenInfo=e,game.module.show(game.ME.PartnerAwaken)),game.module.hide(game.ME.PartnerDetails)},closeCombineBtn:function(){game.module.hide(game.ME.PartnerCombine)},modelBtn:function(){var e=this.data.getCurSlotInfo();e.info&&(game.partnerData.showInfo=e.info,game.module.show(game.ME.PartnerDetails))},fateNotice:function(e){var t=game.partnerData.getPartnerActiveFate(e);if(t)for(var a=t.length,i=void 0,n=void 0,s=0;s<a;s++)i=t[s],(n=game.PartnerFateCfg.getData(i))&&game.notice.showNotice(603,n.desc)},stopPlay:function(){b8e.module.isShowView(game.ME.PartnerElementFettersTips)&&game.module.hide(game.ME.PartnerElementFettersTips)}});var t=[game.ME.PartnerSkillTips,game.ME.PartnerDetails,game.ME.PartnerSpriteStat,game.ME.PartnerActive,game.ME.PartnerCombine,game.ME.PartnerElementFettersTips,game.ME.PartnerSkillInfoTips],a=game.Sender.extends({ipc:function(){this.msg={PartnerModelReq:null,PartnerActiveReq:this.partnerActiveReq}},partnerActiveReq:function(e){var t=game.pb.PartnerActiveRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.Partner,e,game.PartnerEvts,a,t),b8e.RC("$$game","$$PartnerControl",e)})(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.handels={PartnerHelpResp:this.partnerHelpResp}},notify:function(e,t){var a=this;switch(e){case a.Evts.V_SELECT_HELP:if(!t||!t.info)return;if(1==t.type)if(a.data.getSlotInfoByHelp(a.data.selectHelpSlot).info){var i=a.data.getIdleHelpSlots();i.length?a.sender.PartnerHelpReq(i[0],t.info.id):a.sender.PartnerHelpReq(a.data.selectHelpSlot,t.info.id)}else a.sender.PartnerHelpReq(a.data.selectHelpSlot,t.info.id);2==t.type&&a.sender.PartnerHelpReq(t.info.helpPos,0),3==t.type&&(a.data.quickStarInfo=t.info,game.module.show(game.ME.PartnerQuickStar)),4==t.type&&(game.partnerData.awakenInfo=t.info,game.module.show(game.ME.PartnerAwaken))}},partnerHelpResp:function(e){var t=e.readProtobuf(game.pb.PartnerHelpResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.updateHelpInfo(t),this.dpt(this.Evts.C_UPDATE_HELP),this.send(this.Evts.V_UPDATE_DATA))}});var t=[game.ME.PartnerHelpSelect],a=game.Sender.extends({ipc:function(){this.msg={PartnerHelpReq:this.partnerHelpReq}},partnerHelpReq:function(e,t){var a=game.pb.PartnerHelpRequest;a.slot=e,a.id=t,this.write(a)}});b8e.module.registerControl(game.ME.PartnerHelp,e,game.PartnerEvts,a,t),b8e.RC("$$game","$$PartnerHelpControl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},Partner:{C_SELECTCHANGE:this.updateItemInfo,C_UPDATE_POWER:this.updateItemInfo},ShenQiActive:{C2C_UPDATE_BATTLE:this.updateBattle},Foster:{C2C_UPDATE_BATTLE:this.updateBattle}},this.handels={}},updateBattle:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_DATA)},equipPos1:function(){},equipPos2:function(){},equipPos3:function(){},equipPos4:function(){},equipPos5:function(){},equipPos6:function(){},equipPos7:function(){},autoWear:function(){this.dpt(this.Evts.C2C_AUOT_WEAR)},buzhenBtn:function(){game.module.show(game.ME.PartnerFormation)},changeBtn:function(){this.data.changeSlot=this.data.getCurSlotInfo(),game.module.show(game.ME.PartnerChange)},fasionBtn:function(){game.module.showToggle(game.ME.Surface,0)},taozhuangBtn:function(){game.module.show(game.ME.SuitMain)},helpBtn:function(){game.module.show(game.ME.PartnerHelpBase)},awakenBtn:function(){var e=this.data.getCurSlotInfo(),t=game.PartnerAwakenCfg.getData(e.info.id);t.activateStar>e.info.star?game.notice.show(51524,t.activateStar):(game.partnerData.awakenInfo=e.info,game.module.show(game.ME.PartnerAwaken))},comon_power:function(){this.fateProBtn()},baseProBtn:function(){this.data.showSlotInfo=this.data.getCurSlotInfo(),game.module.show(game.ME.PartnerSpriteStat)},fateProBtn:function(){var e=this.data.getCurSlotInfo();e.info&&(game.partnerData.showInfo=e.info,game.module.show(game.ME.PartnerDetails))},elementIIcon:function(){var e=this.data.getCurSlotInfo();if(e&&e.info&&e.info.cfg&&e.info.cfg.element){var t=b8e.module.getView(game.ME.PartnerMain);t&&(game.elementData.setElementInfo(e.info.cfg.element,50342,t.skin.elementIIcon.localToGlobal(),!1),game.module.show(game.ME.ElementAttr))}},mapBtn:function(){game.module.show(game.ME.MyMap)},skinBtn:function(){game.module.show(game.ME.PartnerSkin)},rebornBtn:function(){game.module.showToggle(game.ME.Sell,1)}});var t=game.Sender.extends({ipc:function(){this.msg={}}});b8e.module.registerControl(game.ME.PartnerMain,e,game.PartnerEvts,t),b8e.RC("$$game","$$PartnerMainControl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},Partner:{C_SELECTCHANGE:this.updateData},PartnerBackOp:{C_SELECTCHANGE:this.updateData}},this.handels={PartnerStarResp:this.partnerStarResp,MasterStarResp:this.masterStarResp}},updateData:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_COST)},masterStarResp:function(e){var t=this,a=e.readProtobuf(game.pb.MasterStarResponse);if(0<a.code)game.notice.noticeError(a.code);else{var i=t.data.getMainRoleInfo();game.FightAmount.inst().setNomalStat(i.starSpriteStat),t.data.updateStar(i.id),game.FightAmount.inst().setUpdatedStat(i.starSpriteStat),t.data.updateAllSlotStat(),t.send(t.Evts.V_UPDATE_DATA),t.dpt(t.Evts.V_UPDATE_STAR,a),t.dpt(t.Evts.C_PLAY_UP_EFFECT),t.dpt(t.Evts.C2C_UPDATE_STAR_TASK),game.module.show(game.ME.PartnerUpStar),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeStar)}},partnerStarResp:function(e){var t=this,a=e.readProtobuf(game.pb.PartnerStarResponse);if(0<a.code)game.notice.noticeError(a.code);else{var i=t.data.getInfoById(a.id);game.FightAmount.inst().setNomalStat(i.starSpriteStat),t.data.updateStar(a.id),game.FightAmount.inst().setUpdatedStat(i.starSpriteStat),t.openStarTips(a.id),t.data.updateAllSlotStat(),t.send(t.Evts.V_UPDATE_DATA),t.dpt(t.Evts.V_UPDATE_STAR,a),t.dpt(t.Evts.C_PLAY_UP_EFFECT),t.dpt(t.Evts.C2C_UPDATE_STAR_TASK),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeStar)}},openStarTips:function(e){var t=this.data.getInfoById(e);game.partnerStarData.setInfo(t,game.RoleType.Partner),game.module.show(game.ME.StarUpTips)},upgradeBtn:function(){var e=this.data.selectPartnerInfo;e&&this.upgradeReq(e)},upgradeBtn2:function(){this.upgradeReq(this.data.quickStarInfo)},upgradeReq:function(e){if(e){var t=e.isMainRole?game.MasterStarCfg.getData(e.star):game.PartnerStarCfg.getData(e.id,e.star),a=0,i=0;if(e.isMainRole){if(!this.data.masterCanUpStar())return}else{var n=game.itemData.getNumById(t.itemId),s=game.ItemInfoCfg.getData(t.itemId);if(n<t.num){if(!this.data.autoUse)return void game.UpgradeUtil.showAccessTips(s);if(!(game.itemData.getNumById(t.chipId)+n>=t.num))return void game.UpgradeUtil.showAccessTips(s);a=n,i=t.num-n}else a=t.num}game.UpgradeUtil.checkUpgradeCost(t.costItems,!0,!0)&&(e.isMainRole?this.sender.MasterStarReq():this.sender.PartnerStarReq(e.id,a,i))}},comon_power:function(){var e=this.data.selectPartnerInfo;e&&(game.partnerData.showInfo=e,game.module.show(game.ME.PartnerDetails))},costNode1:function(){var e=this.data.selectPartnerInfo;e&&this.showCostTips(1,e)},costNode2:function(){var e=this.data.selectPartnerInfo;e&&this.showCostTips(2,e)},costNode3:function(){this.showCostTips(1,this.data.quickStarInfo)},costNode4:function(){this.showCostTips(2,this.data.quickStarInfo)},showCostTips:function(e,t){if(t){var a=game.PartnerStarCfg.getData(t.id,t.star),i=game.ItemInfoCfg.getData(1==e?a.itemId:a.chipId);i&&(game.tipsData.setInfo(i),game.module.show(game.ME.ItemTips))}},autoBuyBtn:function(){this.data.autoUse=!this.data.autoUse,this.send(this.Evts.V_UPDATE_AUTO_USE)},btn_lookSkill:function(){var e=this.data.selectPartnerInfo;e&&(this.data.showSkillInfo=e,game.module.show(game.ME.PartnerSkillTips))},resonanceBtn:function(){game.module.show(game.ME.PartnerFetter)},gotoBtn:function(){var e=this.data.getMainRoleInfo(),t=game.MasterStarCfg.getData(e.star);t.moduleEnum&&(t.toggleIndex?game.module.showToggle(t.moduleEnum,t.toggleIndex):game.module.show(t.moduleEnum)),game.module.hide(game.ME.Partner)},masterUpgradeBtn:function(){var e=this.data.getMainRoleInfo(),t=game.MasterStarCfg.getData(e.star);this.data.getProgressByType(t.conditionType)<t.param?game.notice.show(53672):this.upgradeReq(e)},coin1:function(){var e=this.data.selectPartnerInfo,t=game.PartnerStarCfg.getData(e.id,e.star);this.showCostTips2(t)},coin2:function(){var e=this.data.getMainRoleInfo(),t=game.MasterStarCfg.getData(e.star);this.showCostTips2(t)},showCostTips2:function(e){if(e&&e.costItems&&e.costItems.length){var t=game.ItemInfoCfg.getData(e.costItems[0].Id);t&&(game.tipsData.setInfo(t),game.module.show(game.ME.ItemTips))}}});var t=[game.ME.PartnerQuickStar,game.ME.PartnerBackStar,game.ME.PartnerUpStar],a=game.Sender.extends({ipc:function(){this.msg={PartnerStarReq:this.partnerStarReq,MasterStarReq:null}},partnerStarReq:function(e,t,a){var i=game.pb.PartnerStarRequest;i.id=e,i.num=t,i.chipNum=a,this.write(i)}});b8e.module.registerControl(game.ME.PartnerStar,e,game.PartnerEvts,a,t),b8e.RC("$$game","$$PartnerStarControl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData,this._costList=[];for(var e=game.PartnerBookCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)(t={}).cfg=e[a],t.num=game.itemData.getNumById(t.cfg.id),this._costList.push(t)},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},Partner:{C_SELECTCHANGE:this.updateData},PartnerBackOp:{C_SELECTCHANGE:this.updateData}},this.handels={PartnerUpgradeResp:this.partnerUpgradeResp}},updateData:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_COST)},partnerUpgradeResp:function(e){var t=this,a=e.readProtobuf(game.pb.PartnerUpgradeResponse);if(0<a.code)game.notice.noticeError(a.code);else{var i=t.data.getInfoById(a.id);a.lv>i.lv&&(game.FightAmount.inst().setNomalStat(i.levelSpriteStat),t.dpt(t.Evts.C_PLAY_UP_EFFECT)),t.data.updateLv(a.id,a.lv,a.exp),game.FightAmount.inst().setUpdatedStat(i.levelSpriteStat),t.data.updateAllSlotStat(),t.send(t.Evts.V_UPDATE_DATA),t.send(t.Evts.V_PLAY_PRO_EFFECT),t.dpt(t.Evts.V_UPDATE_LV,a),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeUpgrade)}},autoUpgradeBtn:function(){this.upgradeReq(2)},upgradeBtn:function(){this.upgradeReq(1)},upgradeReq:function(e){var t=this.data.selectPartnerInfo;if(t)if(t.lv>=2*game.mainRoleData.lv||t.lv>=game.mainRoleData.maxLv)game.notice.show(51518);else{var a=this.getCostItems(e);a&&(a.length?this.sender.PartnerUpgradeReq(t.id,a):game.AccessShopView.inst().showView(this._costList[2].cfg.id))}},_upgrade:function(e){if(e.lv>=2*game.mainRoleData.lv||e.lv>=game.mainRoleData.maxLv)game.notice.show(51518);else{var t=this.getCostItems(type);t&&(t.length?this.sender.PartnerUpgradeReq(e.id,t):game.AccessShopView.inst().showView(this._costList[2].cfg.id))}},updateCost:function(){for(var e=void 0,t=0,a=this._costList.length;t<a;t++)(e=this._costList[t]).num=game.itemData.getNumById(e.cfg.id)},getCostItems:function(e){var t=this;t.updateCost();var a,i=t._costList,n=t.data.selectPartnerInfo,s=n.lv;a=1==e?s+1:2*game.mainRoleData.lv>game.mainRoleData.maxLv?game.mainRoleData.maxLv:2*game.mainRoleData.lv;var r=void 0,o=0;t.costs||(t.costs=[]);for(var g=void(t.costs.length=0),u=game.amount.get(game.AmountType.SILVER),l=s;l<a;l++)o+=game.PartnerUpgradeCfg.getData(l).exp;o-=n.exp;for(var c=0,h=i.length;c<h;c++){r=i[c],(g={}).id=r.cfg.id;for(var m=g.num=0,d=r.num;m<d;m++)if(r.cfg.silver<=u){if(o-=r.cfg.exp,g.num+=1,r.num-=1,u-=r.cfg.silver,o<=0)return g.num&&t.costs.push(g),t.costs}else if(t.costs.length<1&&r.num&&!g.num)return game.UpgradeUtil.checkAmountByType(game.AmountType.SILVER,r.cfg.silver),null;g.num&&t.costs.push(g)}return t.costs},comon_power:function(){var e=this.data.selectPartnerInfo;e&&(game.partnerData.showInfo=e,game.module.show(game.ME.PartnerDetails))},costNode1:function(){this.showCostTips(1)},costNode2:function(){this.showCostTips(2)},costNode3:function(){this.showCostTips(3)},costNode4:function(){this.showCostTips(4)},showCostTips:function(e){var t=game.PartnerBookCfg.getDatas();if(!(e>=t.length)){var a=game.ItemInfoCfg.getData(t[e-1].id);a&&(game.tipsData.setInfo(a),game.module.show(game.ME.ItemTips))}}});var t=game.Sender.extends({ipc:function(){this.msg={PartnerUpgradeReq:this.partnerUpgradeReq}},partnerUpgradeReq:function(e,t){var a=game.pb.PartnerUpgradeRequest;a.id=e,a.books=t,this.write(a)}}),a=[game.ME.PartnerBackUpgrade];b8e.module.registerControl(game.ME.PartnerUpgrade,e,game.PartnerEvts,t,a),b8e.RC("$$game","$$PartnerUpgradeControl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.handels={PartnerEmbattleResp:this.partnerEmbattleResp},this.evts={PartnerChange:{C_UPDATE_BATTLE:this.battleUpdate},PlayBackFormation:{C_SAVE_FORMATION:this._saveFormation},ZhenXingActive:{C2C_UPDATE_BATTLE:this.updateZX}}},updateZX:function(){this.send(this.Evts.C2V_UPDATE_ZX)},battleUpdate:function(){this.send(this.Evts.V_UPDATE_DATA)},notify:function(e,t){switch(e){case this.Evts.C_SELECTCHANGE:this.send(this.Evts.V_SELECTCHANGE,t);break;case this.Evts.C_SAVE_FORMATION:this._saveFormation();break;case this.Evts.C_CHANGE_PARTNER:this.dpt(this.Evts.C_CHANGE_PARTNER,t)}},_saveFormation:function(){this.sender.PartnerEmbattleReq(this.data.partnerFormations)},partnerEmbattleResp:function(e){var t=e.readProtobuf(game.pb.PartnerEmbattleResponse);0<t.code?game.notice.noticeError(t.code):(this.data.setFormations(t.slots),this.dpt(this.Evts.C_UPDATE_FORMATION),this.send(this.Evts.V_UPDATE_DATA))},btn_left:function(){this.send(this.Evts.V_SCROLLLEFT)},btn_right:function(){this.send(this.Evts.V_SCROLLRIGHT)},elemFettersBtn:function(){game.partnerData.elementFettersType=game.PartnerElemFettersTypes.OWN,game.module.show(game.ME.PartnerElementFettersTips)}});var t=game.Sender.extends({ipc:function(){this.msg={PartnerEmbattleReq:this.partnerEmbattleReq}},partnerEmbattleReq:function(e){var t=game.pb.PartnerEmbattleRequest;t.slots=e,this.write(t)}});b8e.module.registerControl(game.ME.PartnerFormation,e,game.PartnerEvts,t),b8e.RC("$$game","$$PartnerFormationControl",e)}(),function(){var e=game.Control.extends({btn:function(){game.module.hide(game.ME.StarUpTips)}});b8e.module.registerControl(game.ME.StarUpTips,e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo}},this.handels={PartnerAwakenStarResp:this.partnerAwakenStarResp}},updateData:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_COST)},partnerAwakenStarResp:function(e){var t=e.readProtobuf(game.pb.PartnerAwakenStarResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.updateAwakenLv(t.id,t.awakenStar),this.send(this.Evts.V_UPDATE_DATA))},smeltBtn:function(){this.data.awakenInfo&&this.upgradeReq(this.data.awakenInfo)},upgradeReq:function(e){if(e){var t=game.PartnerAwakenCfg.getData(e.id),a=game.itemData.getNumById(t.itemId),i=0,n=0;if(a<t.num){if(!this.data.autoUse2)return void game.notice.show(51380);if(!(game.itemData.getNumById(t.chipId)+a>=t.num))return void game.notice.show(51380);i=a,n=t.num-a}else i=t.num;this.sender.PartnerAwakenStarReq(e.id,i,n)}},costNode1:function(){this.showCostTips(1,this.data.awakenInfo)},costNode2:function(){this.showCostTips(2,this.data.awakenInfo)},showCostTips:function(e,t){if(t){var a=game.PartnerAwakenCfg.getData(t.id),i=game.ItemInfoCfg.getData(1==e?a.itemId:a.chipId);i&&(game.tipsData.setInfo(i),game.module.show(game.ME.ItemTips))}},autoBuyBtn:function(){this.data.autoUse2=!this.data.autoUse2,this.send(this.Evts.V_UPDATE_AUTO_USE)},btn_lookSkill:function(){}});var t=game.Sender.extends({ipc:function(){this.msg={PartnerAwakenStarReq:this.partnerAwakenStarReq}},partnerAwakenStarReq:function(e,t,a){var i=game.pb.PartnerAwakenStarRequest;i.id=e,i.num=t,i.chipNum=a,this.write(i)}}),a=[game.ME.PartnerAwakenSkill];b8e.module.registerControl(game.ME.PartnerAwaken,e,game.PartnerEvts,t,a),b8e.RC("$$game","$$PartnerAwakenControl",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},Partner:{C_SELECTCHANGE:this.updateData},PartnerBackOp:{C_SELECTCHANGE:this.updateData}},this.handels={PartnerJingpoResp:this.PartnerJingpoResp}},PartnerJingpoResp:function(e){var t=e.readProtobuf(game.pb.PartnerJingpoResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.data.getInfoById(t.id);game.FightAmount.inst().setNomalStat(a.allSpriteStat),this.data.updateJpLv(t.id,t.jpLv),this.data.updateAllSlotStat(),game.FightAmount.inst().setUpdatedStat(a.allSpriteStat),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.V_UPDATE_SPIRIT)}},updateData:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_COST)},costNode1:function(){var e=this.data.selectPartnerInfo;e&&this.showCostTips(1,e)},costNode2:function(){var e=this.data.selectPartnerInfo;e&&this.showCostTips(2,e)},showCostTips:function(e,t){if(t){var a=game.PartnerJingpoCfg.getData(t.jpLv).costItems[e-1],i=game.ItemInfoCfg.getData(a.Id);i&&(game.tipsData.setInfo(i),game.module.show(game.ME.ItemTips))}},comon_power:function(){var e=this.data.selectPartnerInfo;e&&(game.partnerData.showInfo=e,game.module.show(game.ME.PartnerDetails))},lookBtn:function(){game.module.show(game.ME.PartnerSpiritAttr)},upgradeBtn:function(){var e=this.data.selectPartnerInfo;if(e){var t=game.PartnerJingpoCfg.getData(e.jpLv);game.UpgradeUtil.checkItemList(t.costItems,1,!0)&&(t.needLv>e.lv?game.notice.show(9129):this.sender.PartnerJingpoReq(e.id))}}}),t=[game.ME.PartnerSpiritAttr,game.ME.PartnerBackSpirit],a=game.Sender.extends({ipc:function(){this.msg={PartnerJingpoReq:this.PartnerJingpoReq}},PartnerJingpoReq:function(e){var t=game.pb.PartnerJingpoRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.PartnerSpirit,e,game.PartnerEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},Partner:{C_SELECTCHANGE:this.updateData},PartnerBackOp:{C_SELECTCHANGE:this.updateData}},this.handels={ActivateTalentResp:this.activateTalentResp,PartnerQualityTopResp:this.partnerQualityTopResp}},activateTalentResp:function(e){var t=e.readProtobuf(game.pb.ActivateTalentResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.data.getInfoById(t.id);game.FightAmount.inst().setNomalStat(a.allSpriteStat),this.data.updateTalentTask(t.id,t.talentTask),this.data.updateAllSlotStat(),game.FightAmount.inst().setUpdatedStat(a.allSpriteStat),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.V_UPDATE_TALENT_ACT),this.dpt(this.Evts.V_UPDATE_TALENT)}},partnerQualityTopResp:function(e){var t=e.readProtobuf(game.pb.PartnerQualityTopResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.data.getInfoById(t.id);game.FightAmount.inst().setNomalStat(a.allSpriteStat),this.data.updateQualityNum(t.id,t.qualityNum),this.data.updateAllSlotStat(),game.FightAmount.inst().setUpdatedStat(a.allSpriteStat),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.V_UPDATE_TALENT),game.module.show(game.ME.PartnerTalentQulity)}},notify:function(e,t){switch(e){case this.Evts.V2C_LOOK_TALENT_SKILL:this.showSkillTips(t.skillId,!t.isFinish,t)}},updateData:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_COST)},activeBtn:function(){var e=this.data.selectPartnerInfo;if(e){var t=e.getCurrTalentTask();if(t){var a=t.progress;if(e.getProValueByType(t.taskType)<a){var i=t.moduleId;if(!i||i<1||!e.battlePos)return void game.notice.show(53321);if(i==game.ME.PartnerAwaken){var n=game.PartnerAwakenCfg.getData(e.id);if(n.activateStar>e.star)return void game.notice.show(51524,n.activateStar);game.partnerData.awakenInfo=e}return i!=game.ME.EquipForge&&i!=game.ME.Partner||(this.data.newDefaultSel=e.battlePos),void(0<t.toggle?game.module.showToggle(i,t.toggle):game.module.show(i))}}this.sender.ActivateTalentReq(e.id)}},upBtn:function(){var e=this.data.selectPartnerInfo;if(e&&game.PartnerTalentCfg.getData(e.id,e.qualityNum+1)){var t=game.PartnerTalentCfg.getData(e.id,e.qualityNum);game.UpgradeUtil.checkItemInfo(t.itemId,t.itemNum)&&this.sender.PartnerQualityTopReq(e.id)}},touchIcon:function(){var e=this.data.selectPartnerInfo,t=game.PartnerTalentCfg.getData(e.id,e.qualityNum);if(t){var a=!!game.PartnerTalentCfg.getData(e.id,e.qualityNum+1);this.showSkillTips(t.showSkillId,a,null)}},goBtn:function(){game.module.show(game.ME.ShareMain),game.module.hide(game.ME.Partner)},showSkillTips:function(e,t,a){if(e){this.data.skillTipsInfo||(this.data.skillTipsInfo={}),this.data.skillTipsInfo.index=4,this.data.skillTipsInfo.info=this.data.selectPartnerInfo,this.data.skillTipsInfo.talentSkillId=e,this.data.skillTipsInfo.isCond=t,this.data.skillTipsInfo.taskInfo=a,game.module.show(game.ME.PartnerSkillInfoTips)}},comon_power:function(){var e=this.data.selectPartnerInfo;e&&(game.partnerData.showInfo=e,game.module.show(game.ME.PartnerDetails))}}),t=[game.ME.PartnerBackTalent,game.ME.PartnerTalentQulity],a=game.Sender.extends({ipc:function(){this.msg={ActivateTalentReq:this.activateTalentReq,PartnerQualityTopReq:this.partnerQualityTopReq}},activateTalentReq:function(e){var t=game.pb.ActivateTalentRequest;t.id=e,this.write(t)},partnerQualityTopReq:function(e){var t=game.pb.PartnerQualityTopRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.PartnerTalent,e,game.PartnerEvts,a,t)}(),function(){var e;e=game.CultivateBaseView.extends({progressMaxW:430,_costList:null,upgradeAlert:function(e){this.skin.redPoint1.active=e.alert},init:function(){this.data=game.partnerData,this._costList=[];for(var e=game.PartnerBookCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)this.getComponent("costNode"+(a+1))&&((t={}).cfg=e[a],t.icon=this.createCostIcon(t.cfg.id,this.getComponent("costNode"+(a+1))),t.num=game.itemData.getNumById(t.cfg.id),this._costList.push(t),game.ItemInfoCfg.getData(t.cfg.id),this.getComponent("costLab"+(a+1)).string=game.Lang.get(51429,t.cfg.exp))},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon();a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){var t=this;switch(e){case t.Evts.V_UPDATE_DATA:t.partnerInfo=t.getPartnerInfo(),t.updateView(),t.updateCost();break;case t.Evts.V_UPDATE_COST:t.updateCost();break;case t.Evts.V_PLAY_PRO_EFFECT:t.showProgEffect(t.skin.pb_bg)}},updateView:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a){for(var i=0;i<6;i++)e.getComponent("starIcon"+(i+1)).active=i<a.star;var n=game.ResCfg.getUrl(10050,a.cfg.element);t.elementIIcon.loadTexture(n),t.fightAmountLbl.string=a.fightAmount,t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+a.breakLv),game.AutoLayoutUtil.layoutPower(t.power,t.fightAmountLbl,t.powerImg,t.search);var s=game.SpriteStatType,r=a.levelSpriteStat,o=a.lv+1,g=a.exp,u=game.PartnerUpgradeCfg.getData(a.lv).exp;t.lvLab.string="Lv."+a.lv,e.skin.expLab.string=g+"/"+u,e.setProgressVal(g/u),e.setStatStr(t.addProLab1,s.Attack,r.getStatValue(s.Attack)),e.setStatStr(t.addProLab2,s.Defense,r.getStatValue(s.Defense)),e.setStatStr(t.addProLab3,s.Health,r.getStatValue(s.Health));var l=game.StarAddAttrCfg.getData(a.quality,a.star),c=l?1+l.percent/1e3:1;e.setStatStr(t.nextProLab1,s.Attack,(a.cfg.atk+a.cfg.perAtk*o)*c>>0,t.arrow1),e.setStatStr(t.nextProLab2,s.Defense,(a.cfg.def+a.cfg.perDef*o)*c>>0,t.arrow2),e.setStatStr(t.nextProLab3,s.Health,(a.cfg.hp+a.cfg.perHp*o)*c>>0,t.arrow3)}},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51448,n.name,a),i&&i.setPosition(e.width+8,e.y+3)},updateCost:function(){for(var e=void 0,t=void 0,a=0,i=this._costList.length;a<i;a++)t=(e=this._costList[a]).icon,e.num=game.itemData.getNumById(e.cfg.id),t.setNum(e.num,0<e.num?game.Color.GREEN:game.Color.RED,20,!0,0,!0);this.skin.coinLab1.string=this.getCostCoin(1),this.skin.coinLab2.string=this.getCostCoin(2)},getCostCoin:function(e){var t=this._costList,a=this.partnerInfo;if(a){var i,n=a.lv;if(a.lv>=2*game.mainRoleData.lv||a.lv>=game.mainRoleData.maxLv)return 0;i=1==e?n+1:2*game.mainRoleData.lv>game.mainRoleData.maxLv?game.mainRoleData.maxLv:2*game.mainRoleData.lv;for(var s=void 0,r=0,o=0,g=game.amount.get(game.AmountType.SILVER),u=n;u<i;u++)r+=game.PartnerUpgradeCfg.getData(u).exp;r-=a.exp;for(var l=0,c=t.length;l<c;l++){s=t[l];for(var h=0;h<s.num;h++)if(s.cfg.silver<=g&&(r-=s.cfg.exp,o+=s.cfg.silver,g-=s.cfg.silver,r<=0))return o}return o}},setProgressVal:function(e){b8e.Tween.kill(this.skin.progress),b8e.Tween.get(this.skin.progress).to({width:e*this.progressMaxW},150)},onShow:function(){this.partnerInfo=this.getPartnerInfo(),this.data&&this.data.setMainRoleSlotGray(!0),this.updateView(),this.updateCost()},onStageResize:function(){this.setPosition(0,0)},getPartnerInfo:function(){}}),b8e.RC("$$game","$$PartnerUpgradeBaseView",e)}(),function(){var e;e=game.View.extends({_costList:null,upgradeAlert:function(e){this.skin.redPoint1.active=e.alert},init:function(){this.data=game.partnerData},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon();a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.partnerInfo=this.getPartnerInfo(),this.updateView(),this.updateCost();break;case this.Evts.V_SELECTCHANGE:this.updateModel();break;case this.Evts.V_UPDATE_COST:this.updateCost()}},updateView:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a){for(var i=0;i<6;i++)e.getComponent("starIcon"+(i+1)).active=i<a.star;if(e.skin.elementIIcon.active=!a.isMainRole,!a.isMainRole){var n=game.ResCfg.getUrl(10050,a.cfg.element);e.skin.elementIIcon.loadTexture(n)}t.fightAmountLbl.string=a.fightAmount,t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+a.breakLv),game.AutoLayoutUtil.layoutPower(t.power,t.fightAmountLbl,t.powerImg,t.search);var s=game.SpriteStatType,r=a.breakSpriteStat,o=a.breakLv+1,g=game.PartnerTopCfg.getData(a.breakLv);e.setStatStr(t.addProLab1,s.Attack,r.getStatValue(s.Attack)),e.setStatStr(t.addProLab2,s.Defense,r.getStatValue(s.Defense)),e.setStatStr(t.addProLab3,s.Health,r.getStatValue(s.Health));var u=g.isMax?g:game.PartnerTopCfg.getData(o);e.setStatStr(t.nextProLab1,s.Attack,u.atk,t.arrow1),e.setStatStr(t.nextProLab2,s.Defense,u.def,t.arrow2),e.setStatStr(t.nextProLab3,s.Health,u.hp,t.arrow3);var l=game.AttrRulesCfg.getData(u.attrId),c=1==game.AttrPowerCoefCfg.getData(u.attrId).type?u.attrValue/10+"%":u.attrValue+"";t.breakAddLab.string=game.Lang.get(51430,a.breakLv+1,l.name,c),t.breakNeedLvLab.string=game.Lang.get(a.lv<g.needLv?51432:51431,a.lv,g.needLv),t.isMax.active=g.isMax,t.costNode.active=!g.isMax}},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51448,n.name,a),i&&i.setPosition(e.width+2,3)},updateCost:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a){var i=game.PartnerTopCfg.getData(a.breakLv),n=void 0,s=void 0,r=void 0;if(!i.isMax){if(i.costItems.length){if(n=i.costItems[0],e.costIcon1){var o=game.ItemUtil.createBaseItemInfo(n.Id,1,e.costIcon1.itemInfo);e.costIcon1.setItemInfo(o,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon1=e.createCostIcon(n.Id,t.costNode1);s=game.ItemInfoCfg.getData(n.Id),r=game.itemData.getNumById(n.Id),t.costNameLab1.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name,!1),t.costLab1.string=game.HtmlUtil.getText(r>=n.Num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+n.Num),t.costNode1.active=!0}else t.costNode1.active=!1;if(1<i.costItems.length){var g=i.costItems[1].Num,u=game.amount.get(game.AmountType.SILVER);t.coinLab1.string=game.HtmlUtil.getText(g<=u?game.Color.GREEN:game.Color.RED,g)}if(2<i.costItems.length){if(n=i.costItems[2],e.costIcon2){o=game.ItemUtil.createBaseItemInfo(n.Id,1,e.costIcon2.itemInfo);e.costIcon2.setItemInfo(o,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon2=e.createCostIcon(n.Id,t.costNode2);s=game.ItemInfoCfg.getData(n.Id),r=game.itemData.getNumById(n.Id),t.costNameLab2.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name,!1),t.costLab2.string=game.HtmlUtil.getText(r>=n.Num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+n.Num),t.costNode2.active=!0}else t.costNode2.active=!1}}},onShow:function(){this.partnerInfo=this.getPartnerInfo(),this.data.setMainRoleSlotGray(!1),this.updateView(),this.updateCost()},onStageResize:function(){this.setPosition(0,0)},getPartnerInfo:function(){}}),b8e.RC("$$game","$$PartnerBreakBaseView",e)}(),function(){var e;e=game.View.extends({upgradeAlert:function(e){this.skin.redPoint1.active=e.alert,this.skin.redPoint2&&(this.skin.redPoint2.active=this.data.canStar(this.partnerInfo))},fetterAlert:function(e){this.skin.resonanceRedPoint.active=e.alert},init:function(){var e=this;if(e.data=game.partnerData,e.matCostIcon=b8e.Sprite.get(),e.matCostIcon.setAnchor(.5,.5),e.matCostIcon.addToParent(e.skin.coin1),e.matCostIcon.setSize(40,40),e.skin.coin2&&(e.matCostIcon2=b8e.Sprite.get(),e.matCostIcon2.setAnchor(.5,.5),e.matCostIcon2.addToParent(e.skin.coin2),e.matCostIcon2.setSize(40,40)),e.skin.skillIcon1){e._skillList=[];for(var t=void 0,a=0;a<6;a++)(t=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_84,!1,!1)).setClickCallBack(e.clickSkillIcon,e),e.getComponent("skillIcon"+(a+1)).addChild(t),e._skillList.push(t)}},clickSkillIcon:function(e){e&&(this.data.masterSkillTipsInfo=e,game.module.show(game.ME.PartnerSkillInfoTips2))},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon();a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){var t=this;switch(e){case t.Evts.V_UPDATE_DATA:t.partnerInfo=t.getPartnerInfo(),t.updateView(),t.updateCost(),t.updateCost2();break;case t.Evts.V_UPDATE_COST:t.updateCost(),t.updateCost2();break;case t.Evts.V_UPDATE_AUTO_USE:t.updateAutoUse()}},setBaseInfoView:function(){for(var e=this,t=e.skin,a=e.partnerInfo,i=0;i<6;i++)e.getComponent("starIcon"+(i+1)).active=i<a.star;if(t.elementIIcon.active=!a.isMainRole,!a.isMainRole){var n=game.ResCfg.getUrl(10050,a.cfg.element);t.elementIIcon.loadTexture(n)}t.fightAmountLbl.string=a.fightAmount,t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+a.breakLv),game.AutoLayoutUtil.layoutPower(t.power,t.fightAmountLbl,t.powerImg,t.search);var s=game.SpriteStatType,r=a.star+1,o=a.isMainRole?game.MasterStarCfg.getData(a.star):game.PartnerStarCfg.getData(a.id,a.star);e.setStatStr(t.addProLab1,s.Attack,o.clientAtk+"%"),e.setStatStr(t.addProLab2,s.Defense,o.clientDef+"%"),e.setStatStr(t.addProLab3,s.Health,o.clientHp+"%"),a.isMainRole||e.setStatStr(t.addProLab4,s.Speed,o.clientSpeed),t.addProLab4.active=!a.isMainRole;var g=o.isMax?o:a.isMainRole?game.MasterStarCfg.getData(r):game.PartnerStarCfg.getData(a.id,r);o.isMax?(t.nextAttr.active=!1,t.maxDesc.active=!0):(t.nextAttr.active=!0,t.maxDesc.active=!1),e.setStatStr(t.nextProLab1,s.Attack,g.clientAtk+"%",t.arrow1),e.setStatStr(t.nextProLab2,s.Defense,g.clientDef+"%",t.arrow2),e.setStatStr(t.nextProLab3,s.Health,g.clientHp+"%",t.arrow3),a.isMainRole||e.setStatStr(t.nextProLab4,s.Speed,g.clientSpeed,t.arrow4),t.nextProLab4.active=!a.isMainRole},updateView:function(){var e=this.partnerInfo;e&&(this.skin.mainRoleCostNode&&(this.skin.mainRoleCostNode.active=e.isMainRole),this.skin.partnerCostNode&&(this.skin.partnerCostNode.active=!e.isMainRole),this.setBaseInfoView(),e.isMainRole?this.updateMasterView():this.updatePartnerView())},updatePartnerView:function(){var e=this.skin,t=this.partnerInfo,a=t.star+1,i=game.PartnerStarCfg.getData(t.id,t.star),n=i.isMax?i:game.PartnerStarCfg.getData(t.id,a);e.curSBg1.active=e.nextSBg1.active=i.angerSkill,e.curSBg2.active=e.nextSBg2.active=i.assistSkill||i.unionSkill,e.curSBg3&&(e.curSBg3.active=e.nextSBg3.active=i.assistSkill&&i.unionSkill);var s=0;s=this.setSkill(i.angerSkill,t.star,"curSkillLab",s),s=this.setSkill(i.unionSkill,t.star,"curSkillLab",s),s=this.setSkill(i.assistSkill,t.star,"curSkillLab",s),s=0,s=this.setSkill(n.angerSkill,a,"nextSkillLab",s),s=this.setSkill(n.unionSkill,a,"nextSkillLab",s),s=this.setSkill(n.assistSkill,a,"nextSkillLab",s),e.mask1.height=e.mask2.height=155+40*s,e.mask1.y=e.mask2.y=-523-(285-e.mask1.height),e.maxDesc.y=-e.mask1.height/2-15,e.upgradeBtn.active=!i.isMax,e.autoBuyBtn.active=!i.isMax,e.isMax.active=i.isMax},updateMasterView:function(){var e=this.skin,t=this.partnerInfo,a=game.MasterStarCfg.getData(t.star);if(e.title_bg15.y=-741,e.mask3.y=-776,e.mask3.height=223,e.infoBg_3.height=218,e.curSBg1.active=e.curSBg2.active=e.curSBg3.active=!1,e.nextSBg1.active=e.nextSBg2.active=e.nextSBg3.active=!1,e.mask1.y=e.mask2.y=-608,e.mask1.height=e.mask2.height=160,e.maxDesc.y=-e.mask1.height/2-15,e.conditionLab.string=a.conditionDesc,e.gotoBtn.x=e.conditionLab.x+e.conditionLab.width+3,a.isMax)e.expLab.string="1/1",e.progress.width=482;else{var i=this.data.getProgressByType(a.conditionType);i=i>a.param?a.param:i,e.expLab.string=i+"/"+a.param,e.progress.width=i/a.param*482}e.isMax2.active=a.isMax,e.masterUpgradeBtn.active=!a.isMax,e.progressNode.active=!a.isMax;var n=game.MasterStarCfg.getDatas(),s=void 0,r=void 0,o=void 0;n.sort(this.sortCfgs);for(var g=0,u=n.length;g<u;g++)(r=n[g]).star&&(o=r.star<=t.star,(s=this._skillList[r.star-1]).setData(r.showSkill),s.setIconGray(!o),s.skillParam={isActive:o,star:r.star},o&&1<r.star?this.getComponent("line"+(r.star-1)).active=!0:!o&&1<r.star&&(this.getComponent("line"+(r.star-1)).active=!1))},sortCfgs:function(e,t){return e.star-t.star},setSkill:function(e,t,a,i){return e&&(this.setSkillStr(this.getComponent(a+(i+1)),e,t),i+=1),i},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51448,n.name,a),i&&i.setPosition(e.width+2,3)},setSkillStr:function(e,t,a){var i=game.SkillCfg.getData(t);i&&(e.string=game.Lang.get(51459,i.name,a))},updateCost2:function(){var e=this.skin,t=this.partnerInfo;if(t&&t.isMainRole){var a,i,n,s=game.MasterStarCfg.getData(t.star);if(s.isMax)e.coin2.active=!1;else{e.coin2.active=!0,a=s.costItems[0],i=game.ItemInfoCfg.getData(a.Id),n=game.itemData.getNumById(a.Id);var r=game.ResCfg.getUrl(137,i.icon);this.matCostIcon2.loadTexture(r),e.coinLab2.string=game.HtmlUtil.getText(n>=a.Num?game.Color.GREEN:game.Color.RED,n)+game.HtmlUtil.getText(game.Color.BLACK,"/"+a.Num)}}},updateCost:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a&&1!=a.id){var i=game.PartnerStarCfg.getData(a.id,a.star),n=void 0,s=void 0,r=void 0;if(e.costIcon1){var o=game.ItemUtil.createBaseItemInfo(i.itemId,1,e.costIcon1.itemInfo);e.costIcon1.setItemInfo(o,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon1=e.createCostIcon(i.itemId,t.costNode1);if(s=game.ItemInfoCfg.getData(i.itemId),r=game.itemData.getNumById(i.itemId),t.costNameLab1.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name,!1),t.costLab1.string=game.HtmlUtil.getText(r>=i.num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+i.num),e.costIcon2){o=game.ItemUtil.createBaseItemInfo(i.chipId,1,e.costIcon2.itemInfo);e.costIcon2.setItemInfo(o,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon2=e.createCostIcon(i.chipId,t.costNode2);if(s=game.ItemInfoCfg.getData(i.chipId),r=game.itemData.getNumById(i.chipId),t.costNameLab2.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name,!1),t.costLab2.string=game.Lang.get(51434,game.HtmlUtil.getText(game.Color.BLACK,r)),i.costItems.length){n=i.costItems[0],s=game.ItemInfoCfg.getData(n.Id),r=game.itemData.getNumById(n.Id);var g=game.ResCfg.getUrl(137,s.icon);e.matCostIcon.loadTexture(g),t.coinLab1.string=game.HtmlUtil.getText(r>=n.Num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+n.Num),e.setCoinPos()}}},setCoinPos:function(){var e=this.skin;e.coin1.x=670-e.coinLab1.width},updateAutoUse:function(){this.skin.check.active=this.data.autoUse},onShow:function(){this.partnerInfo=this.getPartnerInfo(),this.data.setMainRoleSlotGray(!1),this.updateView(),this.updateCost(),this.updateCost2(),this.updateAutoUse()},onHide:function(){this.data.autoUse=!1,this.data.setMainRoleSlotGray(!1)},onStageResize:function(){this.setPosition(0,0)},getPartnerInfo:function(){}}),b8e.RC("$$game","$$PartnerStarBaseView",e)}(),function(){var e=game.PartnerBreakBaseView.extends({ctor:function(){this._super(1360),this.spotAlerts={PARTNER_CUR_BREAK:this.upgradeAlert}},getPartnerInfo:function(){var e=game.partnerData.getCurSlotInfo();return e?e.info:null}});b8e.module.registerView(game.ME.PartnerBreak,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1361),this.setSize(540,126)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+e.breakLv),this.icon.setData(e);var a=b8e.module.isShowView(game.ME.PlayBackFormation)?game.playBackFormationData.getCombinePartnerInfo(e):game.partnerData.getCombinePartnerInfo(e);if(a){var i=a.length;t.combineNode.active=!0,t.powerLab.active=!1;for(var n="",s=0;s<i;s++){var r=s+1,o=a[s],g=game.PartnerCfg.getData(o);if(!g)return;n+=r==i?game.HtmlUtil.getColorStrByQuality(g.quality,g.name):game.HtmlUtil.getColorStrByQuality(g.quality,g.name)+","}t.combineLab.string=game.Lang.get(52261,n)}else t.combineNode.active=!1,t.powerLab.active=!0,t.powerLab.string=game.Lang.get(51433,e.fightAmount);var u=e.helperId&&0<e.helperId;t.helper_tag.active=u},battleBtn:function(){if(b8e.module.isShowView(game.ME.PlayBackFormation)){var e=game.partnerData.changeSlot;e&&e.slot&&game.playBackFormationData.upFormation(this.data,e.slot)&&(b8e.module.getControl(game.ME.PlayBackFormation).updateFormation(),game.module.hide(game.ME.PartnerChange),b8e.module.getControl(game.ME.PlayBackFormation).checkShowCombine(this.data))}else this.send(game.PartnerEvts.V_SELECT_BATTLE,this.data)}}),b8e.RC("$$game","$$PartnerChangeItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1362)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerChangeItem,e.bindEnum=game.ME.PartnerChange,e.addToParent(this.skin.listNode),e.layout.spacingY=5,this.data=game.partnerData},updateList:function(){b8e.module.isShowView(game.ME.PlayBackFormation)?this.infoDatas=game.playBackFormationData.getNotBattlePartnerList():this.infoDatas=this.data.getNotBattlePartnerList(),this.list.setData(this.infoDatas),this.skin.emptyNode.active=!this.infoDatas||!this.infoDatas.length},$$getChangeItem:function(){if(!this.infoDatas||!this.list||!this.infoDatas.length)return null;var e=this.list.getItemRender(this.infoDatas[0]);return e.skin?e.skin.battleBtn:null},onShow:function(){this.updateList()}});b8e.module.registerView(game.ME.PartnerChange,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1363),this.setSize(535,100)},setData:function(e){var t=this.skin,a=game.PartnerDetailsEnum;t.lookBtn.active=!e.info.isMainRole,t.proNode.active=e.type==a.STAT&&this.updateStat(),t.skillNode.active=e.type==a.SKILL&&this.updateSkill(),t.fateNode.active=e.type==a.FATE&&this.updateFate(),t.breakNode.active=e.type==a.BREAK&&this.updateBreakTalent()},updateStat:function(){var e=this,t=e.skin,a=e.data.info,i=game.SpriteStatType;if(a.battlePos||a.active){var n=game.partnerData.getSlotInfoBySlot(a.battlePos),s=a.battlePos?n.allSpriteStat:a.allSpriteStat;e.setStatStr(t.addProLab1,i.Attack,s.getStatValue(i.Attack)),e.setStatStr(t.addProLab2,i.Defense,s.getStatValue(i.Defense)),e.setStatStr(t.addProLab3,i.Health,s.getStatValue(i.Health)),e.setStatStr(t.addProLab4,i.Speed,s.getStatValue(i.Speed)),t.addProLab4.active=!0}else e.setStatStr(t.addProLab1,i.Attack,a.cfg.atk),e.setStatStr(t.addProLab2,i.Defense,a.cfg.def),e.setStatStr(t.addProLab3,i.Health,a.cfg.hp),t.addProLab4.active=!1;return t.tips_line.y=-92,e.setSize(535,-1*t.tips_line.y+2),e.layout(),!0},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51428,i.name,a)},updateSkill:function(){var e=this.skin,t=49,a=this.data.info,i=a.cfg.assistObj[0];if(e.pu.active=e.puSkillLab.active=a.puSkill,e.nu.active=e.nuSkillLab.active=a.nuSkill,e.he.active=e.heSkillLab.active=a.heSkill,e.fu.active=e.fuSkillLab.active=!a.heSkill&&i,a.puSkill){var n=a.puSkill;if(1==a.isMainRole){var s=game.shenQiData.getShenQiSkill();n=s||n}this.setSkillDesc(e.puSkillLab,n),t=-1*e.puSkillLab.y+e.puSkillLab.height}if(a.nuSkill){var r=a.nuSkill;if(1==a.isMainRole){var o=game.fosterData.getBattleSkillId(game.NewFosterType.ZHANJI);r=o||r}this.setSkillDesc(e.nuSkillLab,r),e.nu.y=-(43+t),e.nuSkillLab.y=-(22+t),t=-1*e.nuSkillLab.y+e.nuSkillLab.height}if(a.heSkill&&(this.setSkillDesc(e.heSkillLab,a.heSkill),e.he.y=-(43+t),e.heSkillLab.y=-(22+t),t=-1*e.heSkillLab.y+e.heSkillLab.height),!a.heSkill&&i){for(var g=a.cfg.assistObj.length,u="",l=game.HtmlUtil.getColorStrByQuality(a.quality,a.name),c=0;c<g;c++){var h=c+1,m=a.cfg.assistObj[c],d=game.PartnerCfg.getData(m);if(!d)return;u+=h==g?game.HtmlUtil.getColorStrByQuality(d.quality,d.name):game.HtmlUtil.getColorStrByQuality(d.quality,d.name)+","}a.cfg.assistDes?e.fuSkillLab.string=game.Lang.get(53463,l,a.cfg.assistDes):e.fuSkillLab.string=game.Lang.get(53463,l,u),e.fu.y=-(43+t),e.fuSkillLab.y=-(22+t),t=-1*e.fuSkillLab.y+e.fuSkillLab.height}return e.tips_line.y=-(18+t),this.setSize(535,-1*e.tips_line.y+2),this.layout(),!0},setSkillDesc:function(e,t){var a=game.SkillCfg.getData(t);e.string=game.HtmlUtil.getText(game.Color.BLACK,"\u3010"+a.name+"\u3011"+game.LangSkill.get(a.desc,a.descParam))},updateFate:function(){for(var e=this.skin,t=this.data.info.fates,a=void 0,i="",n=0,s=t.length;n<s;n++)a=t[n],i+=game.HtmlUtil.getText(a.getIsComplete()?game.Color.RED:game.Color.BLACK,a.cfg.name+a.cfg.desc),i+="<br/>";return e.fateLab.string=i,e.tips_line.y=e.fateLab.y-e.fateLab.height,this.setSize(535,-1*e.tips_line.y+2),this.layout(),!0},updateBreakTalent:function(){for(var e=this.skin,t=this.data.info.breakTalents,a=game.Lang.get(51435),i=0,n=t.length;i<n;i++)a+=t[i].desc,a+="<br/>";return e.breakLab.string=a,e.tips_line.y=e.breakLab.y-e.breakLab.height,e.tips_line.active=!1,this.setSize(535,-1*e.tips_line.y+2),this.layout(),!0},lookBtn:function(){game.partnerData.showSkillInfo=game.partnerData.showInfo,game.module.show(game.ME.PartnerSkillTips)}}),b8e.RC("$$game","$$PartnerDetailsItem",e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1364)},init:function(){this.initModel({type:game.RoleType.Partner,node:this.skin.modelNode},{type:game.RoleType.Hero,node:this.skin.modelNode});var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerDetailsItem,e.bindEnum=game.ME.PartnerDetails,e.addToParent(this.skin.listNode),this.skin.modelNode.setScale(.7,.7)},updateList:function(){for(var e=game.partnerData.showInfo,t=this.skin,a=0;a<6;a++)this.getComponent("starIcon"+(a+1)).active=a<e.star;if(this.skin.elementIIcon.active=!e.isMainRole,!e.isMainRole){var i=game.ResCfg.getUrl(10050,e.cfg.element);this.skin.elementIIcon.loadTexture(i)}t.starNode.active=!e.isMainRole,t.nameLab.string=game.Lang.get(51436,e.cfg.name,e.lv);var n=0<e.cfg.jobIcon;if(t.job_bg.active=n,(t.jobDescLab.active=n)&&(t.jobDescLab.string=e.cfg.jobDesc),1==e.isMainRole)this.updateRoleModel();else{var s=e.cfg.UIModel;if(e.useSkin&&e.skinInfoMap){var r=e.skinInfoMap.get(e.useSkin);r&&(s=r.cfg.UIModel)}this.updateModel2(game.RoleType.Partner,s)}t.upgradeBtn.active=!e.isMainRole&&e.active,this.list.setData(e.details),e.active?t.redPoint.active=game.partnerData.canStar(e):t.redPoint.active=!1;var o=e.isMainRole?null:game.PartnerAwakenCfg.getData(e.id);o&&(t.upgradeBtnLab.string=game.Lang.get(o.activateStar<=e.star?51522:51523))},onShow:function(){this.updateList(),this.list.scrollToTop()}});b8e.module.registerView(game.ME.PartnerDetails,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super("partner/PartnerHelpItem"),this.setSize(192,229)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){var t=e.getUnIsLock(),a=this.skin;if(a.helpNode.active=t&&e.id,a.lockBg.active=!t||t&&!e.id,a.lockLab.string=!e.id&&t?game.Lang.get(51438):game.Lang.get(51437,e.cfg.level),a.gridbg2.active=t&&!e.id,a.lock.active=!t,a.redPoint.active=e.isAlert&&t&&!e.id,e.info){var i=game.SpriteStatType,n=game.PartnerStarCfg.getData(e.info.id,e.info.star);a.addPerLab.string=game.Lang.get(51439,e.info.star,n.helpPer),this.setStatStr(a.addProLab1,i.TeamAtk,n.teamAtk),this.setStatStr(a.addProLab2,i.TeamDef,n.teamDef),this.setStatStr(a.addProLab3,i.TeamHp,n.teamHp),this.icon.setData(e.info)}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51428,i.name,game.CCommonUtil.replaceNum(a))},touchIcon:function(){this.data.getUnIsLock()&&(game.partnerData.selectHelpSlot=this.data.slot,game.module.show(game.ME.PartnerHelpSelect))}}),b8e.RC("$$game","$$PartnerHelpItem",e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super("partner/PartnerHelpSelectItem"),this.setSize(540,126)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin,a=game.SpriteStatType,i=game.PartnerStarCfg.getData(e.id,e.star);t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name)+game.Lang.get(51457,i.helpPer),this.setStatStr(t.addProLab1,a.TeamAtk,i.teamAtk),this.setStatStr(t.addProLab2,a.TeamDef,i.teamDef),this.setStatStr(t.addProLab3,a.TeamHp,i.teamHp),t.starBtn.active=t.restBtn.active=e.helpPos,t.battleBtn.active=!e.helpPos,this.icon.setData(e),game.PartnerAwakenCfg.getData(e.id).activateStar>e.star?t.starLab.string=game.Lang.get(53233):t.starLab.string=game.Lang.get(53234)},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51428,i.name,a)},battleBtn:function(){this.sendEvts(1)},starBtn:function(){var e=this.data;e&&(game.PartnerAwakenCfg.getData(e.id).activateStar>e.star?this.sendEvts(3):this.sendEvts(4))},restBtn:function(){this.sendEvts(2)},sendEvts:function(e){this.send(game.PartnerEvts.V_SELECT_HELP,{type:e,info:this.data})}}),b8e.RC("$$game","$$PartnerHelpSelectItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerHelpSelectView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerHelpSelectItem,e.bindEnum=game.ME.PartnerHelp,e.addToParent(this.skin.listNode),e.layout.spacingY=5,this.data=game.partnerData},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView()}},updateView:function(){var e=this.skin,t=this.data.getIdleHelpSlots(),a=this.data.getUnLockHelpCount();e.countLab.string=game.Lang.get(51440,a-t.length,a);var i=this.data.getHelpPartners();this.list.setData(i),e.emptyNode.active=!i||!i.length},onShow:function(){this.updateView()}});b8e.module.registerView(game.ME.PartnerHelpSelect,e)}(),function(){var e=game.View.extends({ctor:function(){this._super("partner/PartnerHelpView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.PartnerHelpItem,e.bindEnum=game.ME.PartnerHelp,e.addToParent(this.skin.listNode),e.layout.paddingLeft=11,e.layout.paddingTop=11,e.layout.spacingY=7,e.layout.spacingX=10,this.data=game.partnerData},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView()}},updateView:function(){var e=this.skin,t=this.data.getHelpsAllStat();this.list.setData(this.data.partnerHelps);var a=game.SpriteStatType;this.setStatStr(e.addProLab1,a.TeamAtk,t.teamAtk,t.teamPer),this.setStatStr(e.addProLab2,a.TeamDef,t.teamDef,t.teamPer),this.setStatStr(e.addProLab3,a.TeamHp,t.teamHp,t.teamPer)},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51441,n.name,a,i)},onShow:function(){this.updateView()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerHelp,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super("partner/PartnerListItem"),this.setSize(114,167)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){var t=this,a=e.getUnIsLock();t.skin.lockBg.active=!a||!e.id,t.skin.lockLab.active=t.skin.mask1.active=t.skin.lock.active=!a&&!e.id,t.skin.gridbg2.active=a&&!e.id,t.skin.headSelect.active=e.select;var i=!1,n=t.bindList?t.bindList.bindEnum:0;if(0!=n){var s=!1;switch(n){case game.ME.Partner:i=e.isAlert,s=e.isGray;break;case game.ME.EquipForge:i=e.isForgeAlert}t.skin.redPoint.active=i&&!s,t.skin.lockLab.string=game.Lang.get(51461,e.cfg.level,t.data.cfg.vip),e.info&&(t.icon.setData(e.info),t.icon.setName()),game.ShaderUtil.setGray(t,s)}},touchIcon:function(){this.data.getUnIsLock()?this.send(game.PartnerEvts.C_SELECTCHANGE,this.data):game.notice.show("\u89d2\u8272\u7b49\u7ea7\u8fbe\u5230"+this.data.cfg.level+"\u7ea7\u6216\u8005\u8fbe\u5230VIP"+this.data.cfg.vip)}}),b8e.RC("$$game","$$PartnerListItem",e)}(),function(){var e=game.View.extends({_equipList:null,ctor:function(){this._super("partner/PartnerMainView"),this.spotAlerts={PARTNER_HELP_BASE:this.helpAlert,PARTNER_CUR_AUTOEQUIP:this.autoEquipAlert,SURFACE:this.surfaceAlert,PARTNER_CUR_AWAKEN:this.awakenAlert,PARTNER_CUR_SKIN:this.skinAlert}},helpAlert:function(e){this.skin.red_help.active=e.alert},autoEquipAlert:function(e){this.skin.autoWear.active=e.alert},surfaceAlert:function(e){this.skin.red_fasion.active=e.alert},awakenAlert:function(e){this.skin.red_awaken.active=e.alert},skinAlert:function(e){this.skin.red_skin.active=e.alert},init:function(){var e=this;e.data=game.partnerData,e._equipList=[];for(var t=void 0,a=e.skin,i=0;i<7;i++)(t=new game.PartnerEquipIcon).setClickCallBack(e.onClickIcon,e),e.getComponent("equipPos"+(i+1)).addChild(t),e._equipList.push(t);e.puSkillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_70,!1,!1),e.puSkillIcon.setClickCallBack(e.clickSkillIcon1,e),a.skillIcon1.addChild(e.puSkillIcon),e.nuSkillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_70,!1,!1),e.nuSkillIcon.setClickCallBack(e.clickSkillIcon2,e),a.skillIcon2.addChild(e.nuSkillIcon),e.heSkillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_70,!1,!1),e.heSkillIcon.setClickCallBack(e.clickSkillIcon3,e),a.skillIcon3.addChild(e.heSkillIcon),e.exclusiveOpenLv=+game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"exclusiveOpenLv"),game.spotAlert.setCb(game.SAE.MY_MAP,e.updateMapAlert,e)},clickSkillIcon1:function(){this.showSkillTips(1)},clickSkillIcon2:function(){this.showSkillTips(2)},clickSkillIcon3:function(){this.showSkillTips(3)},showSkillTips:function(e){this.data.skillTipsInfo||(this.data.skillTipsInfo={}),this.data.skillTipsInfo.index=e;var t=this.data.getCurSlotInfo();t&&t.info&&(this.data.skillTipsInfo.info=t.info,game.module.show(game.ME.PartnerSkillInfoTips))},updateMapAlert:function(e){this.skin.red_map.active=e.alert},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView();break;case this.Evts.V_SELECTCHANGE:this.updateModel()}},updateView:function(){var e=this,t=e.data.getCurSlotInfo();if(t){for(var a=e.skin,i=t.getEquipMap(),n=t.info,s=void 0,r=void 0,o=void 0,g=0,u=e._equipList.length;g<u;g++){var l=g+1;if(o=null,(r=i.get(l))&&(o=game.partnerEquipData.getWearEquipInfo(l,r)),s=e._equipList[g],g==u-1){var c=game.mainRoleData.lv>=e.exclusiveOpenLv;s.setData(o,g+1,!0,c)}else s.setData(o,g+1);e.getComponent("red_equip"+(g+1)).active=e.data.canChangeOrBreakEquip(t.slot,g+1),g<6&&(e.getComponent("starIcon"+(g+1)).active=g<t.info.star)}if(a.elementIIcon.active=!n.isMainRole,a.taozhuangBtn.active=a.fasionBtn.active=n.isMainRole,a.rebornBtn.active=!1,!n.isMainRole){var h=game.ResCfg.getUrl(10050,n.cfg.element);a.elementIIcon.loadTexture(h)}a.fightAmountLbl.string=t.power,a.nameLab.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+n.breakLv),game.AutoLayoutUtil.layoutPower(a.power,a.fightAmountLbl,a.powerImg,a.search);var m=game.SpriteStatType,d=t.allSpriteStat,f=game.AttrRulesCfg.getData(m.Attack);a.addProLab1.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Attack))),f=game.AttrRulesCfg.getData(m.Defense),a.addProLab2.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Defense))),f=game.AttrRulesCfg.getData(m.Health),a.addProLab3.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Health))),f=game.AttrRulesCfg.getData(m.Speed),a.addProLab4.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Speed))),a.skinBtn.active=n.cfg.isSkin;for(var p=void 0,v=void 0,E=0;E<6;E++)(v=e.getComponent("fateLab"+(E+1))).string="",n.fates.length>E&&v?(p=n.fates[E],v.setColor(p.getIsComplete()?game.Color.RED:game.Color.BLACK),v.string=p.cfg.name):v&&(v.active=!1);a.awakenBtn.y=n.isMainRole?-498:-296,a.changeBtn.active=!n.isMainRole,a.helpBtn.active=n.isMainRole;var T=0<n.cfg.jobIcon;a.jobDescLab.active=T,(a.title_bg18.active=T)&&(a.jobDescLab.string=n.cfg.jobDesc);var C=n.puSkill;if(n.isMainRole){var I=game.shenQiData.getShenQiSkill();C=I||C}e.puSkillIcon.setData(C);var S=n.nuSkill;if(n.isMainRole){var _=game.fosterData.getBattleSkillId(game.NewFosterType.ZHANJI);S=_||S}e.nuSkillIcon.setData(S),a.skillIcon3.active=n.heSkill||n.cfg.assistObj[0],a.he.active=n.heSkill,a.fu.active=!n.heSkill&&n.cfg.assistObj[0],a.skillNode1.x=a.skillIcon3.active?87:150,a.skillNode2.x=a.skillIcon3.active?196:259;var A=game.PartnerMiscCfg.getData("assistSkill");A&&e.heSkillIcon.setData(n.heSkill||A.value)}},onShow:function(){this.data.setMainRoleSlotGray(!1),this.updateView()},onClickIcon:function(e){game.partnerEquipData.selPos=e;var t=this.data.getCurSlotInfo().getEquipMap().get(e);if(t){var a=game.partnerEquipData.getWearEquipInfo(e,t);(game.partnerEquipData.selInfo=a).type==game.PartnerEquipType.Exclusive?game.module.show(game.ME.PartnerExcEquipDetails):game.module.show(game.ME.PartnerEquipDetails)}else{if(e==game.EquipPosType.POS_7)if(!(game.mainRoleData.lv>=this.exclusiveOpenLv))return void game.notice.show(51535);game.module.show(game.ME.PartnerEquipChange)}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerMain,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerQuickStarView")},init:function(){this.data=game.partnerData,this.matCostIcon=b8e.Sprite.get(),this.matCostIcon.setAnchor(.5,.5),this.matCostIcon.addToParent(this.skin.coin1),this.matCostIcon.setSize(40,40)},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon();a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView();break;case this.Evts.V_SELECTCHANGE:this.updateModel();break;case this.Evts.V_UPDATE_COST:this.updateCost();break;case this.Evts.V_UPDATE_AUTO_USE:this.updateAutoUse()}},updateView:function(){for(var e=this,t=e.skin,a=game.partnerData.quickStarInfo,i=0;i<6;i++)e.getComponent("curStarIcon"+(i+1)).active=i<a.star;var n=game.SpriteStatType,s=a.star+1,r=a.isMainRole?game.MasterStarCfg.getData(a.star):game.PartnerStarCfg.getData(a.id,a.star);e.setStatStr(t.addProLab1,n.Attack,r.clientAtk+"%"),e.setStatStr(t.addProLab2,n.Defense,r.clientDef+"%"),e.setStatStr(t.addProLab3,n.Health,r.clientHp+"%"),a.isMainRole||e.setStatStr(t.addProLab4,n.Speed,r.clientSpeed),t.addProLab4.active=!a.isMainRole;var o=r.isMax?r:game.PartnerStarCfg.getData(a.id,s);e.setStatStr(t.nextProLab1,n.Attack,o.clientAtk+"%",t.arrow1),e.setStatStr(t.nextProLab2,n.Defense,o.clientDef+"%",t.arrow2),e.setStatStr(t.nextProLab3,n.Health,o.clientHp+"%",t.arrow3),a.isMainRole||e.setStatStr(t.nextProLab4,n.Speed,o.clientSpeed,t.arrow4),t.nextProLab4.active=!a.isMainRole;for(var g=0;g<6;g++)e.getComponent("nextStarIcon"+(g+1)).active=g<o.star;t.upgradeBtn2.active=!r.isMax,t.autoBuyBtn.active=!r.isMax,t.isMax.active=r.isMax},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51428,n.name,a),i&&i.setPosition(e.width+2,3)},updateCost:function(){var e=this,t=game.partnerData.quickStarInfo,a=e.skin,i=game.PartnerStarCfg.getData(t.id,t.star),n=void 0,s=void 0,r=void 0;if(e.costIcon1){var o=game.ItemUtil.createBaseItemInfo(i.itemId,1,e.costIcon1.itemInfo);e.costIcon1.setItemInfo(o,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon1=e.createCostIcon(i.itemId,a.costNode3);if(s=game.ItemInfoCfg.getData(i.itemId),r=game.itemData.getNumById(i.itemId),a.costNameLab1.string=s.name,a.costLab1.string=game.HtmlUtil.getText(r>=i.num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+i.num),e.costIcon2){o=game.ItemUtil.createBaseItemInfo(i.chipId,1,e.costIcon2.itemInfo);e.costIcon2.setItemInfo(o,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon2=e.createCostIcon(i.chipId,a.costNode4);if(s=game.ItemInfoCfg.getData(i.chipId),r=game.itemData.getNumById(i.chipId),a.costNameLab2.string=s.name,a.costLab2.string=game.Lang.get(51434,game.HtmlUtil.getText(game.Color.BLACK,r)),i.costItems.length){n=i.costItems[0],s=game.ItemInfoCfg.getData(n.Id),r=game.itemData.getNumById(n.Id);var g=game.ResCfg.getUrl(137,s.icon);e.matCostIcon.loadTexture(g),a.coinLab1.string=game.HtmlUtil.getText(r>=n.Num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+n.Num)}a.redPoint1.active=game.partnerData.canStar(t)},updateAutoUse:function(){this.skin.check.active=this.data.autoUse},onHide:function(){this.data.autoUse=!1},onShow:function(){this.updateView(),this.updateCost(),this.updateAutoUse()}});b8e.module.registerView(game.ME.PartnerQuickStar,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super("partner/PartnerSkillInfoItem"),this.setSize(535,250)},setData:function(e){for(var t=this.skin,a=0;a<6;a++)this.getComponent("starIcon"+(a+1)).active=a<e.star;var i=65,n=e.info,s=n.cfg.assistObj[0];if(t.nu.active=t.nuSkillLab.active=e.nuSkill,t.he.active=t.heSkillLab.active=e.heSkill,t.fu.active=t.fuSkillLab.active=!e.heSkill&&s,e.nuSkill&&(this.setSkillDesc(t.nuSkillLab,e.nuSkill),i+=t.nuSkillLab.height),e.heSkill&&(this.setSkillDesc(t.heSkillLab,e.heSkill),t.he.y=-(36+i),t.heSkillLab.y=-(21+i),i=-1*t.heSkillLab.y+t.heSkillLab.height),!e.heSkill&&s){for(var r=n.cfg.assistObj.length,o="",g=game.HtmlUtil.getColorStrByQuality(n.quality,n.name),u=0;u<r;u++){var l=u+1,c=n.cfg.assistObj[u],h=game.PartnerCfg.getData(c);if(!h)return;o+=l==r?game.HtmlUtil.getColorStrByQuality(h.quality,h.name):game.HtmlUtil.getColorStrByQuality(h.quality,h.name)+","}n.cfg.assistDes?t.fuSkillLab.string=game.Lang.get(53463,g,n.cfg.assistDes):t.fuSkillLab.string=game.Lang.get(53463,g,o),t.fu.y=-(36+i),t.fuSkillLab.y=-(21+i),i=-1*t.fuSkillLab.y+t.fuSkillLab.height}t.tips_line.y=-(18+i),this.setSize(535,-1*t.tips_line.y+2),this.layout()},setSkillDesc:function(e,t){var a=this.data,i=game.SkillCfg.getData(t);e.string=game.HtmlUtil.getText(a.info.star>=a.star?game.Color.RED:game.Color.BLACK,"["+i.name+"]"+game.LangSkill.get(i.desc,i.descParam))}}),b8e.RC("$$game","$$PartnerSkillInfoItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerSkillInfoView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerSkillInfoItem,e.bindEnum=game.ME.PartnerSkillTips,e.addToParent(this.skin.listNode)},updateList:function(){this.list.setData(game.partnerData.showSkillInfo.skills)},onShow:function(){this.updateList()}});b8e.module.registerView(game.ME.PartnerSkillTips,e)}(),function(){var e=game.PartnerStarBaseView.extends({ctor:function(){this._super("partner/PartnerStarView"),this.spotAlerts={PARTNER_CUR_STAR:this.upgradeAlert,PARTNER_QUALITY_FETTER:this.fetterAlert}},getPartnerInfo:function(){var e=game.partnerData.getCurSlotInfo();return e?e.info:null},updatePartnerView:function(){var e=this.skin;this._super(),e.title_bg15.y=-776,e.mask3.y=-818,e.mask3.height=183,e.infoBg_3.height=176}});b8e.module.registerView(game.ME.PartnerStar,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerStatView")},init:function(){this._statTypes=game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"partnerInfoAttrIds",!0,",",!0),this.data=game.partnerData},updateView:function(){var e=this.skin;this.data.showSlotInfo.updateAllStat();for(var t=this.data.showSlotInfo.allSpriteStat,a="",i="",n="",s="",r=1,o=1,g=void 0,u=void 0,l=void 0,c=void 0,h=void 0,m=0,d=this._statTypes.length;m<d;m++)l=this._statTypes[m],g=game.AttrRulesCfg.getData(l),u=game.AttrPowerCoefCfg.getData(l),c=t.getStatValue(l),h=game.Lang.get(51428,g.name,1==u.type?game.CCommonUtil.accMul(c,100)+"%":c+"")+"<br/>",1==g.attrType?(r%2!=0?a+=h:i+=h,r++):(o%2!=0?n+=h:s+=h,o++);e.statLab1.string=a,e.statLab2.string=i,e.statLab3.string=n,e.statLab4.string=s;var f=e.statLab1.height>e.statLab2.height?e.statLab1.height+-1*e.statLab1.y:e.statLab2.height+-1*e.statLab2.y;e.tips_line.y=-(f+23),e.statTitle2.y=e.tips_line.y-30,e.statLab3.y=e.statLab4.y=e.statTitle2.y-23,e.bg2.height=-1*e.statLab3.y+e.statLab3.height-49,e.tipsBg.height=e.bg2.height+186,e.returnBtn.y=-(e.tipsBg.height-51),this.setSize(600,e.tipsBg.height)},onShow:function(){this.updateView()}});b8e.module.registerView(game.ME.PartnerSpriteStat,e)}(),function(){var e;e=game.View.extends({upgradeAlert:function(e){this.skin.redPoint1.active=e.alert},init:function(){this.data=game.partnerData},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon();a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.partnerInfo=this.getPartnerInfo(),this.updateView(),this.updateCost();break;case this.Evts.V_UPDATE_COST:this.updateCost()}},updateView:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a){for(var i=0;i<6;i++)e.getComponent("starIcon"+(i+1)).active=i<a.star;if(e.skin.elementIIcon.active=!a.isMainRole,!a.isMainRole){var n=game.ResCfg.getUrl(10050,a.cfg.element);e.skin.elementIIcon.loadTexture(n)}t.fightAmountLbl.string=a.fightAmount,t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+a.breakLv),game.AutoLayoutUtil.layoutPower(t.power,t.fightAmountLbl,t.powerImg,t.search);var s=game.SpriteStatType,r=a.jpLv,o=game.PartnerJingpoCfg.getData(r);e.setStatStr(t.addProLab1,s.Attack,o.atk),e.setStatStr(t.addProLab2,s.Defense,o.def),e.setStatStr(t.addProLab3,s.Health,o.hp);var g=game.PartnerJingpoCfg.getData(r+1);g?(t.isMax.active=!1,t.upgradeBtn.active=!0,t.descLab.string=game.HtmlUtil.getText(game.Color.BLACK,game.Lang.get(52125,r+1,e.getStrByCfg(g))),t.needLevelLab.string=game.Lang.get(52102,game.HtmlUtil.getText(a.lv>=o.needLv?game.Color.GREEN:game.Color.RED,a.lv),o.needLv)):(g=o,t.isMax.active=!0,t.upgradeBtn.active=!1,t.needLevelLab.string=""),e.setStatStr(t.nextProLab1,s.Attack,g.atk,t.arrow1),e.setStatStr(t.nextProLab2,s.Defense,g.def,t.arrow2),e.setStatStr(t.nextProLab3,s.Health,g.hp,t.arrow3),t.descLab.string=r<=0?game.HtmlUtil.getText(game.Color.BLACK,game.Lang.get(52135)):game.HtmlUtil.getText(game.Color.BLACK,game.Lang.get(52125,r,e.getStrByCfg(o)))}},updateCost:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a){var i=game.PartnerJingpoCfg.getData(a.jpLv).costItems,n=void 0,s=void 0,r=void 0,o=void 0;if(i[0]){if(t.costNode1.active=!0,o=(n=i[0]).Id,e.costIcon1){var g=game.ItemUtil.createBaseItemInfo(o,1,e.costIcon1.itemInfo);e.costIcon1.setItemInfo(g,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon1=e.createCostIcon(o,t.costNode1);s=game.ItemInfoCfg.getData(o),r=game.itemData.getNumById(o),t.costNameLab1.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name,!1),t.costLab1.string=game.HtmlUtil.getText(r>=n.Num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+n.Num)}else t.costNode1.active=!1;if(i[1]){if(t.costNode2.active=!0,o=(n=i[1]).Id,e.costIcon2){var u=game.ItemUtil.createBaseItemInfo(o,1,e.costIcon2.itemInfo);e.costIcon2.setItemInfo(u,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon2=e.createCostIcon(o,t.costNode2);s=game.ItemInfoCfg.getData(o),r=game.itemData.getNumById(o),t.costNameLab2.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name,!1),t.costLab2.string=game.HtmlUtil.getText(r>=n.Num?game.Color.GREEN:game.Color.RED,r)+game.HtmlUtil.getText(game.Color.BLACK,"/"+n.Num)}else t.costNode2.active=!1}},getStrByCfg:function(e){var t="",a=0,i=!1;return e.clientTeamAtk?(t="_$TeamAtk",a=e.clientTeamAtk):e.clientTeamHp?(t="_$TeamHp",a=e.clientTeamHp):e.clientTeamDef?(t="_$TeamDef",a=e.clientTeamDef):e.clientTeamAtkPer?(t="_$TeamAtk",a=.1*e.clientTeamAtkPer,i=!0):e.clientTeamHpPer?(t="_$TeamHp",a=.1*e.clientTeamHpPer,i=!0):e.clientTeamDefPer&&(t="_$TeamDef",a=.1*e.clientTeamDefPer,i=!0),t=b8e.getNormP(t),game.AttrRulesCfg.getData(game.SpriteStatType[t]).name+":+"+a+(i?"%":"")},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51448,n.name,a),i&&i.setPosition(e.width+2,3)},onShow:function(){this.partnerInfo=this.getPartnerInfo(),this.data.setMainRoleSlotGray(!1),this.updateView(),this.updateCost()},onHide:function(){},onStageResize:function(){this.setPosition(0,0)},getPartnerInfo:function(){}}),b8e.RC("$$game","$$PartnerSpiritBaseView",e)}(),function(){var e=game.PartnerUpgradeBaseView.extends({ctor:function(){this._super("partner/PartnerUpgradeView"),this.spotAlerts={PARTNER_CUR_UPGRADE:this.upgradeAlert}},getPartnerInfo:function(){var e=game.partnerData.getCurSlotInfo();return e?e.info:null}});b8e.module.registerView(game.ME.PartnerUpgrade,e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerView"),this.toggles={tab1_select:game.ME.PartnerMain,tab2_select:game.ME.PartnerUpgrade,tab3_select:game.ME.PartnerBreak,tab4_select:game.ME.PartnerStar,tab5_select:game.ME.PartnerSpirit,tab6_select:game.ME.PartnerTalent},this.spotAlerts={PARTNER_CUR_MAIN_TAB:this.tabMainAlert,PARTNER_CUR_UPGRADE_TAB:this.tabUpgradeAlert,PARTNER_CUR_STAR_TAB:this.tabStarAlert,PARTNER_CUR_BREAK_TAB:this.tabBreakAlert,PARTNER_CUR_SPIRIT_TAB:this.tabSpiritAlert,PARTNER_CUR_TALENT_TAB:this.tabTalentAlert}},tabMainAlert:function(e){this.skin.red_spot1.active=e.alert},tabUpgradeAlert:function(e){this.skin.red_spot2.active=e.alert},tabStarAlert:function(e){this.skin.red_spot4.active=e.alert},tabBreakAlert:function(e){this.skin.red_spot3.active=e.alert},tabSpiritAlert:function(e){this.skin.red_spot5.active=e.alert},tabTalentAlert:function(e){this.skin.red_spot6.active=e.alert},init:function(){this.initModel({type:game.RoleType.Partner,node:this.skin.modelNode},{type:game.RoleType.Hero,node:this.skin.modelNode});var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PartnerListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=0,e.bindEnum=game.ME.Partner,e.addToParent(this.skin.listNode),this.data=game.partnerData},notify:function(e,t){var a=this;switch(e){case a.Evts.V_TOGGLECHANGE:a.toggleSelect(t);break;case a.Evts.V_UPDATEHEADLIST:a.updateHeadList();break;case a.Evts.V_SELECTCHANGE:case a.Evts.C2C_UPDATE_SURFACE:a._updateModel();break;case a.Evts.V_PLAY_UP_EFFECT:a.showModelEffect(a.skin.modelNode)}},_updateModel:function(){var e=this.data.getCurSlotInfo();if(e)if(e.info&&e.info.isMainRole)this.updateRoleModel();else{var t=e.info,a=t.cfg.UIModel;if(t.useSkin){var i=t.skinInfoMap.get(t.useSkin);i&&(a=i.cfg.UIModel)}this.updateModel2(game.RoleType.Partner,a)}},updateHeadList:function(){this.list.setData(this.data.partnerSlots)},onShow:function(){this.toggleSelect(0),this.send(this.Evts.C_ONSHOW),this.updateHeadList(),this._updateModel(),b8e.module.isShowView(game.ME.EquipForge)&&game.module.hide(game.ME.EquipForge)},toggleSelect:function(e){var t=this;if(1==e&&1==t.data.selectSlot){for(var a=!0,i=0,n=t.data.partnerSlots.length;i<n;i++){var s=t.data.partnerSlots[i];if(s.info&&!s.info.isMainRole){a=!1,t.send(t.Evts.C_SELECTCHANGE,s);break}}if(a&&1==e)return game.notice.show(51444),void t.toggleSelect(0)}var r=t.getToggleIndex(e);if(game.moduleOpen.checkOpenWithTips(r,!0)){var o=r==game.ME.PartnerTalent;t.skin.bg1.active=!o,t.skin.bg7.active=o,t.skin.modelNode.y=o?-569:-669,t._super(e)}},$$getPartnerItem:function(e){if(!this.list||!this.data)return null;var t=this.data.getSlotInfoBySlot(e);if(!t)return null;var a=this.list.getItemRender(t);return a&&a.skin?a.skin.touchIcon:null}});b8e.module.registerView(game.ME.Partner,e)}(),function(){var e;e=game.Widget.extends({_showModel:!1,isInit:!1,roleModel:null,surfaceModel:null,ctor:function(e){this._super(e||"partner/PartnerFormationItem")},init:function(){this.roleModel=game.sceneRoleCreate.createUIRole(game.mainRoleData),this.roleModel.addToParent(this.skin.modelNode),this.surfaceModel=new b8e.SceneEntity.get,this.surfaceModel.addToParent(this.skin.modelNode),this.data=game.partnerData,this.isInit=!0},onShow:function(){this.slotInfo&&this.updateData()},setData:function(e){this.slotInfo=e,this.isInit&&this.updateData()},updateData:function(){var a=this,e=a.skin;if(a.slotInfo){var i=a.slotInfo.info,t=a.data.getToBattleCount(),n=a.data.getUnLockBattleCount();e.battleIcon.active=!1,a.roleModel.setVisible(!1),a.surfaceModel.setVisible(!1),!i&&t<n-1?e.battleIcon.active=!0:i&&(i.isMainRole||i.type==game.RoleType.Hero?(a.setSurface(i.surface),game.AvatarUtil.updateUIModel(a.roleModel,1,!1),a.roleModel.transition(game.RoleStateType.ACTION_IDLE),a.roleModel.setDirection(game.Direction.getAnimatDirection(i.isEnemy?game.Direction.DownRight:game.Direction.UpLeft)),a.roleModel.setVisible(!0)):(a.getUrl(i,function(e){var t=a.surfaceModel.getAnimator(game.AnimType.BODY,1);e?((t=t||a.surfaceModel.addAnimator(game.AnimType.BODY,1)).load(e),t.setDirection(game.Direction.getAnimatDirection(i.isEnemy?game.Direction.DownRight:game.Direction.UpLeft)),t.play()):t&&t.clear(),i&&i.type&&i.type==game.RoleType.Monster&&a.setBattleSolt()},a),a.surfaceModel.setVisible(!0))),i&&i.type&&i.type==game.RoleType.Monster||a.setBattleSolt()}},getUrl:function(t,a,i){if(t){var n=void 0;if(!t.cfg)if(t.type==game.RoleType.Hero)t.cfg=game.PartnerCfg.getData(1);else if(t.type==game.RoleType.Partner)t.cfg=game.PartnerCfg.getData(t.id);else if(t.type==game.RoleType.Monster)return void game.MonsterCfg.getDataAsync(t.id,function(e){e?(t.cfg=e,n=game.ResCfg.getUrl(5e3,t.cfg.model),a.call(i,n)):b8e.warn("\u627e\u4e0d\u5230\u602a\u7269\u914d\u7f6e\uff1a",t.id)},this);if(t.cfg){var e=void 0;if(t.type==game.RoleType.Partner){if(e=t.cfg.model,t.isEnemy){if(t.surface&&t.surface.skins&&t.surface.skins.length){var s=game.PartnerSkinCfg.getData(t.surface.skins[0]);s&&(e=s.model)}}else if(t.useSkin){var r=t.skinInfoMap.get(t.useSkin);r&&(e=r.cfg.model)}}else e=t.cfg.model;n=game.ResCfg.getUrl(5e3,e)}a.call(i,n)}},setSurface:function(){},battleIcon:function(){this.data.changeSlot=this.slotInfo,game.module.show(game.ME.PartnerChange)},setBattleSolt:function(){}}),b8e.RC("$$game","$$PartnerFormationItem",e)}(),function(){var e=game.View.extends({showModel:!0,_changeInfo:null,ctor:function(){this._super("partner/PartnerFormationView")},init:function(){var e=this;e.skin.btn_left.active=!1,e.skin.btn_right.active=!1;var t=e.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PartnerBattleItem,t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=7,t.layout.spacingX=0,t.bindEnum=e.moduleEnum,t.addToParent(e.skin.headList),t.setScrollViewCb(e.listCb,e),e.data=game.partnerData,e.skin.descLab.string=game.Lang.get(51443),e._formationPoint=[{x:141,y:-639},{x:250,y:-585},{x:355,y:-535},{x:248,y:-698},{x:355,y:-646},{x:461,y:-592}],e._formationItems=[],e._fzIndex=[3,2,1,6,5,4,7],e._drags=[],e._formationItemMap=b8e.HashMap.get();for(var a=void 0,i=void 0,n=0,s=e.data.partnerFormations.length;n<s;n++)(a=new game.PartnerFormationItem).x=e._formationPoint[n].x,a.y=e._formationPoint[n].y,a.setData(e.data.getSlotInfoBySlot(e.data.partnerFormations[n])),e._formationItemMap.set(a.slotInfo.slot,a),e._formationItems.push(a),e.addChild(a);for(var r=void 0,o=0,g=e._formationItems.length;o<g;o++){a=e._formationItems[o],i=[];for(var u=0;u<g;u++)a!=e._formationItems[u]&&i.push(e._formationItems[u]);r=game.dragEffectMgr.addDrag(a,i,e.dragPlace,e,e.clickHanlder,e),a.dragItem=r,e._drags.push(r)}e.showModel=b8e.Sprite.get(),e.showModel.setAnchor(.5,.5),e.showModel.setSize(120,100),e.showModel.setVisible(!1),e.showModel.addToParent(e),e.surfaceModel=new b8e.SceneEntity.get,e.surfaceModel.addToParent(e.showModel),e.showModel.dragItem=game.dragEffectMgr.addDrag(e.showModel,e._formationItems,e.dragPlace,e)},$$getFormationItem:function(e){return e<this._formationItems.length?this._formationItems[e]:null},clickHanlder:function(e){if(e&&e.slotInfo){if(!e.slotInfo.info){var t=this.data.getToBattleCount();if(this.data.getUnLockBattleCount()-1<=t)return}e.slotInfo.info&&e.slotInfo.info.isMainRole?game.notice.show(51446):(this.data.changeSlot=e.slotInfo,game.module.show(game.ME.PartnerChange))}},dragPlace:function(e,t){if(e==this.showModel)return this.list.touchMovable=!0,void this.change(e,t);if(t&&e){var a=e.dragItem._dragStartPoint.x,i=e.dragItem._dragStartPoint.y;b8e.Tween.kill(t),b8e.Tween.get(t,null,null).to({x:a,y:i},50);this.exchangePosSave(e,t),this.send(this.Evts.C_SAVE_FORMATION)}},change:function(e,t){var a=this;a.showModel.setVisible(!1);var i=0,n=0,s=void 0,r=void 0,o=a.data.getToBattleCount(),g=a.data.getUnLockBattleCount(),u=void 0,l=void 0;if(t&&(s=t.slotInfo,r=e.slotInfo,s.slot!=r.battlePos)){if(i=s.slot,n=r.id,s.info&&!r.battlePos){if(s.info.isMainRole)return void game.notice.show(51446)}else if(!s.id&&!r.battlePos&&g<=o)return void game.notice.show(51447);if(r.battlePos){if(u=a._formationItemMap.get(r.battlePos),l=a._formationItemMap.get(s.slot),!u||!l)return;return a.exchangePosSave(u,l),void a.send(a.Evts.C_SAVE_FORMATION)}if(!s.id&&!r.battlePos){var c=a.data.getIdelBattlePos();if(!c)return;c!=i&&(u=a._formationItemMap.get(c),l=a._formationItemMap.get(s.slot),a.exchangePosSave(u,l),a.send(a.Evts.C_SAVE_FORMATION),i=c)}a.send(a.Evts.C_CHANGE_PARTNER,{slot:i,id:n})}},exchangePosSave:function(e,t){for(var a=void 0,i=0,n=this._formationItems.length;i<n;i++)(a=this._formationItems[i])==e?this._formationItems[i]=t:a==t&&(this._formationItems[i]=e),this.data.partnerFormations[i]=this._formationItems[i].slotInfo.slot,this._formationItemMap.set(this._formationItems[i].slotInfo.slot,this._formationItems[i])},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.btn_left.active=n,this.leftAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.leftAlert=!0;break}if(n=0<(i=a.length),this.skin.btn_right.active=n,this.rightAlert=!1,n)for(s=0;s<i;s++)if(a[s].isAlert){this.rightAlert=!0;break}this.updateLRBtnAlert(this.leftAlert,this.rightAlert)},updateLRBtnAlert:function(e,t){this.skin.l_red_spot.active=e,this.skin.r_red_spot.active=t},notify:function(e,t){var a=this;switch(e){case a.Evts.V_UPDATE_DATA:a.updateHeadList(),a.updateView();break;case a.Evts.V_SELECTCHANGE:a.showDragModel(t);break;case a.Evts.V_SCROLLLEFT:a.scrollLeft();break;case a.Evts.V_SCROLLRIGHT:a.scrollRight();break;case a.Evts.C2V_UPDATE_ZX:a.updateFormationDes()}},scrollLeft:function(){this.list.scrollContainerLeft()},scrollRight:function(){this.list.scrollContainerRight()},showDragModel:function(e){this.showModel.slotInfo=e.info;var t=this.surfaceModel.getAnimator(game.AnimType.UI_EFFECT,1),a=e.info.cfg.model;if(e.info.useSkin){var i=e.info.skinInfoMap.get(e.info.useSkin);i&&(a=i.cfg.model)}var n=game.ResCfg.getUrl(5e3,a);n?((t=t||this.surfaceModel.addAnimator(game.AnimType.UI_EFFECT,1)).load(n),t.setDirection(game.Direction.getAnimatDirection(game.Direction.UpLeft)),t.play()):t&&t.clear(),this.list.touchMovable=!1,e.point=this.globalToLocal(e.point),this.showModel.setPosition(e.point.x+50,e.point.y-50),this.showModel.setVisible(!0),this.showModel.dragItem.beginDrag()},updateView:function(){var e=this,t=e.skin,a=e.data.getToBattleCount(),i=e.data.getUnLockBattleCount();t.battleNumLab.string=game.Lang.get(51442,a,i);var n=void 0,s=void 0;if(e.data.partnerFormations){for(var r=0,o=e.data.partnerFormations.length;r<o;r++)n=e._formationItems[r],s=e._formationPoint[r],n.setData(e.data.getSlotInfoBySlot(e.data.partnerFormations[r])),n.dragItem.isDisable=!n.slotInfo.id,n.x=s.x,n.y=s.y,n.setLocalZOrder(e._fzIndex[r]),e._formationItemMap.set(n.slotInfo.slot,n);e.updateElemFettersBtn()}},updateElemFettersBtn:function(){game.partnerData.elementFettersType=game.PartnerElemFettersTypes.OWN;var e=game.partnerData.getElemeltFettersNum(),t=this.skin.elemFettersBtn;e?t.loadTexture(game.ResCfg.getUrl(10196,e.id)):t.loadTexture(game.ResCfg.getUrl(10196,1))},updateHeadList:function(){var e=this.data.getFormationPartners();this.list.setData(e)},onShow:function(){this.list.scrollToLeft(0),this.updateHeadList(),this.updateView(),this.updateFormationDes(),this.list.touchMovable=!0},updateFormationDes:function(){var e=this.skin,t=game.zhenXingData.getCurBattleInfo();if(e.haveZx.active=t,e.noHaveZx.active=!t,e.curZXLab.string=t?t.name:game.Lang.get(51846),t){var a=t.cfg;e.haveKeZhi.string=game.Lang.get(a.desc),e.haveBeiKeZhi.string=game.Lang.get(a.beiDesc)}}});b8e.module.registerView(game.ME.PartnerFormation,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(159),this.setSize(114,155)},init:function(){var e=this;e.icon=new game.CultivateBaseIcon,e.icon.addToParent(e.skin.icon),e.skin.headSelect.active=!1,e.skin.redPoint.active=!1,b8e.evt.onTouchStart(e.skin.touchIcon,e._onTouchBegin,e);var t=b8e.root;b8e.evt.onTouchEnd(t,e._onTouchEnd,e),b8e.evt.onTouchCancel(t,e._onTouchEnd,e)},setData:function(e){this.icon.setData(e),this.icon.setName(),this.icon.showBattle()},_onTouchBegin:function(e){var t=this;if(t.data){t._itemPoint=t.localToGlobal(),t.beginX=e.stageX,t.beginY=e.stageY;var a=b8e.root;b8e.evt.onTouchMove(a,t._onTouchMove,t),t.key=b8e.setTimeout(t._showModel,t,1200),e.stopPropagation()}},_onTouchMove:function(e){(5<Math.abs(e.stageX-this.beginX)||5<Math.abs(e.stageY-this.beginY))&&this._onTouchEnd(e)},_onTouchEnd:function(){this.key&&(b8e.clearTimeout(this.key),this.key=0);var e=b8e.root;b8e.evt.offTouchMove(e,this._onTouchEnd,this)},_showModel:function(){this._onTouchEnd(),this.send(game.PartnerEvts.C_SELECTCHANGE,{point:this._itemPoint,info:this.data})},touchIcon:function(){}}),b8e.RC("$$game","$$PartnerBattleItem",e)}(),function(){var e=game.CultivateBaseModelView.extends({_itemInfo:null,_cfg:null,_showModel:!0,_modelTouchClose:!0,ctor:function(){this._super(1359)},init:function(){this.initModel({type:game.RoleType.Partner,node:this.skin.model}),this.timer=b8e.Timer.add(this,this.updateTime,500),this._lightEffect=new game.LightEffect},onShow:function(){var e=this;e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.anima),e._lightEffect.setVisible(!0)),e._tipsInfo=game.partnerData.partnerActiveTips.shift(),e._tipsInfo&&e.setData(),e.endTime=game.SysTime.curTime+1e4,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(1e4)),e.timer.reset(),e.timer.start(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeGet)},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.timer&&this.timer.stop(),this.send(this.Evts.C_CLOSE_ACTIVE_TIPS)},updateTime:function(){var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},setData:function(){var e=this.skin,t=game.PartnerCfg.getData(this._tipsInfo.id);if(t){this.updateModel(game.RoleType.Partner,t),e.getCard_3.active=t.quality==game.Quality.Q_PURPLE,e.getCard_4.active=t.quality==game.Quality.Q_YELLOW,e.getCard_5.active=t.quality==game.Quality.Q_RED,e.getCard_6.active=t.quality==game.Quality.Q_UNPARALLELED,e.getCard_7.active=t.quality==game.Quality.Q_COLORFUL,e.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name,!1);var a=game.ResCfg.getUrl(10048,t.element);if(e.eleIcon.loadTexture(a),e.moduleopen_bar2.active=this._tipsInfo.repeat,this._tipsInfo.repeat){var i=game.PartnerCfg.getData(this._tipsInfo.id),n=game.ItemInfoCfg.getData(i.item);if(!n.recycleItems||!n.recycleItems.length)return;var s=game.ItemInfoCfg.getData(n.recycleItems[0].Id);e.transformLab.string=game.Lang.get(51460,s.name,n.recycleItems[0].Num*this._tipsInfo.num),e.moduleopen_bar2.width=e.transformLab.width+19}}}});b8e.module.registerView(game.ME.PartnerActive,e)}(),function(){var e=game.CultivateBaseModelView.extends({data:null,_cfg:null,_itemGrid:null,_showModel:!0,_modelTouchClose:!0,max:6,ctor:function(){this._super(1345)},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500),this.initModel({type:game.RoleType.Partner,node:this.skin.model}),this._lightEffect=new game.LightEffect},onShow:function(){var e=this;e.data=game.partnerStarData,e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.anima),e._lightEffect.setVisible(!0)),e.endTime=game.SysTime.curTime+5e3,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(3e3)),e.timer.reset(),e.timer.start(),e.data&&(e.setElement(),e.setStar(),e.setArrtext())},setArrtext:function(){var e=this.skin,t=game.SpriteStatType,a=this.data.info,i=game.PartnerStarCfg.getData(a.id,a.star);this.setStatStr(e.addProLab1,t.Attack,i.clientAtk+"%",e.arrow1),this.setStatStr(e.addProLab2,t.Defense,i.clientDef+"%",e.arrow2),this.setStatStr(e.addProLab3,t.Health,i.clientHp+"%",e.arrow3),this.setStatStr(e.addProLab4,t.Speed,i.clientSpeed,e.arrow4),e.curSBg1.active=i.angerSkill,e.curSBg2.active=i.assistSkill||i.unionSkill,e.curSBg3.active=i.assistSkill&&i.unionSkill;var n=0;n=this.setSkill(i.angerSkill,a.star,"curSkillLab",n),n=this.setSkill(i.unionSkill,a.star,"curSkillLab",n),n=this.setSkill(i.assistSkill,a.star,"curSkillLab",n),e.mask1.height=155+40*n,e.mask1.y=-523-(285-e.mask1.height)},setSkill:function(e,t,a,i){return e&&(this.setSkillStr(this.getComponent(a+(i+1)),e,t),i+=1),i},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51448,n.name,a),i&&i.setPosition(e.width+2,3)},setSkillStr:function(e,t,a){var i=game.SkillCfg.getData(t);i&&(e.string=game.Lang.get(51459,i.name,a))},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.timer&&this.timer.stop()},updateTime:function(){if(!this.endTime)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},setStar:function(){var e=void 0,t=this.data.info;this.updateModel(this.data.roleType,t.cfg);for(var a=0;a<this.max;a++)e=a+1,this.getComponent("starIcon"+e).active=t.star>=e;this.skin.name.string=t.name},setElement:function(){var e=this.data.info,t=this.skin,a=e.cfg.element;if(t.eleNode.active=0<a,0<a){var i=game.ResCfg.getUrl(10048,a);t.eleIcon.loadTexture(i)}t.eleLab.string=game.CCommonUtil.getElementText(a)}});b8e.module.registerView(game.ME.StarUpTips,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("starSoul/StarSoulView"),this.spotAlerts={PARTNER_CUR_AWAKEN:this.upgradeAlert}},upgradeAlert:function(e){this.skin.redPoint.active=e.alert},init:function(){this.data=game.partnerData,this.skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_84),this.skillIcon.setClickCallBack(game.partnerData.openAwakenSkillTips,game.partnerData),this.skin.skillNode.addChild(this.skillIcon)},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon();a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView();break;case this.Evts.V_UPDATE_COST:this.updateCost();break;case this.Evts.V_UPDATE_AUTO_USE:this.updateAutoUse()}},updateView:function(){var e=this,t=e.skin,a=game.partnerData.awakenInfo,i=a.awakenLv%11,n=a.awakenLv/11|0,s=game.ResCfg.getUrl(259);5<=n&&n<10?s=game.ResCfg.getUrl(272):10<=n&&(s=game.ResCfg.getUrl(273));for(var r=0;r<10;r++)e.getComponent("curStarIcon"+(r+1)).active=r<i,e.getComponent("curStarIcon"+(r+1)).loadTexture(s);var o=game.SpriteStatType,g=a.awakenLv+1,u=a.awakenSpriteStat,l=game.PartnerAwakenCfg.getData(a.id),c=a.awakenLv%11;if(t.awakeLab1.string=game.Lang.get(51520,a.awakenLv/11>>0,c),e.setStatStr(t.addProLab1,o.TeamAtk,u.getStatValue(o.TeamAtk)),e.setStatStr(t.addProLab2,o.TeamDef,u.getStatValue(o.TeamDef)),e.setStatStr(t.addProLab3,o.TeamHp,u.getStatValue(o.TeamHp)),t.addProLab4.string=game.Lang.get(51428,game.Lang.get(51521),game.CCommonUtil.accMul(l.addPer/100,a.awakenLv)+"%"),e.nextSpriteStat||(e.nextSpriteStat=game.SpriteStat.get()),e.nextSpriteStat.clear(),e.nextSpriteStat.addByCfg(l,!0,g),t.awakeLab2.string=game.Lang.get(51520,g/11>>0,g%11),e.setStatStr(t.addProLab5,o.TeamAtk,e.nextSpriteStat.getStatValue(o.TeamAtk)),e.setStatStr(t.addProLab6,o.TeamDef,e.nextSpriteStat.getStatValue(o.TeamDef)),e.setStatStr(t.addProLab7,o.TeamHp,e.nextSpriteStat.getStatValue(o.TeamHp)),t.addProLab8.string=game.Lang.get(51428,game.Lang.get(51521),game.CCommonUtil.accMul(l.addPer/100,g)+"%"),t.skillNode.active=l.awakenSkill,t.lab.string=game.Lang.get(10==c?51525:51526),l.awakenSkill&&a.awakenSkill){e.skillIcon.setData(a.awakenSkill.skill);var h=game.SkillCfg.getData(a.awakenSkill.skill);e.skillIcon.setName(h.name,game.HtmlUtil.getColorByQuality(h.quality)),e.skillIcon.skillParam=a,e.skillIcon.setIconGray(a.awakenLv<a.awakenSkill.star)}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51428,i.name,a)},updateCost:function(){var e=this,t=game.partnerData.awakenInfo,a=e.skin,i=game.PartnerAwakenCfg.getData(t.id),n=void 0,s=void 0;if(e.costIcon1){var r=game.ItemUtil.createBaseItemInfo(i.itemId,1,e.costIcon1.itemInfo);e.costIcon1.setItemInfo(r,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon1=e.createCostIcon(i.itemId,a.costNode1);if(n=game.ItemInfoCfg.getData(i.itemId),s=game.itemData.getNumById(i.itemId),a.costLab1.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name,!1),a.numLab1.string=game.HtmlUtil.getText(s>=i.num?game.Color.GREEN:game.Color.RED,s)+game.HtmlUtil.getText(game.Color.BLACK,"/"+i.num),i.chipId){if(e.costIcon2){r=game.ItemUtil.createBaseItemInfo(i.chipId,1,e.costIcon2.itemInfo);e.costIcon2.setItemInfo(r,!1,game.IconLayoutEnum.SHOW_NONE)}else e.costIcon2=e.createCostIcon(i.chipId,a.costNode2);n=game.ItemInfoCfg.getData(i.chipId),s=game.itemData.getNumById(i.chipId),a.costLab2.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name,!1),a.numLab2.string=game.Lang.get(51434,game.HtmlUtil.getText(game.Color.BLACK,s)),a.costNode2.active=!0,a.costNode1.x=99,a.autoBuyBtn.active=!0}else a.costNode2.active=!1,a.autoBuyBtn.active=!1,a.costNode1.x=247},updateAutoUse:function(){this.skin.check.active=this.data.autoUse2},onHide:function(){this.data.autoUse2=!1,this.send(this.Evts.V_UPDATE_AUTO_USE)},onShow:function(){this.updateView(),this.updateCost(),this.updateAutoUse()}});b8e.module.registerView(game.ME.PartnerAwaken,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super("partner/PartnerAwakenSkillItem"),this.setSize(540,126)},init:function(){this.skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_84),this.skin.skillNode.addChild(this.skillIcon)},setData:function(e){var t=this.skin;e.info;this.skillIcon.setData(e.skill);var a=game.SkillCfg.getData(e.skill);t.descLab.string=game.LangSkill.get(a.desc,a.descParam),t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name,!1),t.starLab.string=game.Lang.get(51527,e.star/11>>0,e.star%11)}}),b8e.RC("$$game","$$PartnerAwakenSkillItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerAwakenSkillView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerAwakenSkillItem,e.bindEnum=game.ME.PartnerAwaken,e.layout.spacingY=5,e.addToParent(this.skin.list)},updateList:function(){var e=game.partnerData.awakenSkillInfo;this.list.setData(e.awakenSkills)},onShow:function(){this.updateList()}});b8e.module.registerView(game.ME.PartnerAwakenSkill,e)}(),function(){var e=game.PartnerSpiritBaseView.extends({ctor:function(){this._super("partner/PartnerSpiritView"),this.spotAlerts={PARTNER_CUR_SPIRIT:this.upgradeAlert}},getPartnerInfo:function(){var e=game.partnerData.getCurSlotInfo();return e?e.info:null}});b8e.module.registerView(game.ME.PartnerSpirit,e)}(),function(){var e=game.View.extends({showData:null,_showModel:!0,ctor:function(){this._super("partner/PartnerSpiritAttrView")},init:function(){this.data=game.partnerData},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){var e=this,t=e.data.getCurSlotInfo();if(t){var a=e.skin,i=t.info.jpLv,n=game.PartnerJingpoCfg.getDatas();n.sort(e.sortList);for(var s=n.length,r=void 0,o={},g={},u=void 0,l="",c=void 0,h=void 0,m=1;m<s;m++)r=n[m],c=(u=e.getObjByCfg(r)).key,h=u.val,m<=i&&(u.isPer?m<=i&&(g[c]?g[c]+=h:g[c]=h):o[c]?o[c]+=h:o[c]=h),l+=game.HtmlUtil.getText(m<=i?game.Color.RED:game.Color.BLACK,game.Lang.get(52125,m,e.getStrByData(u.key,u.val,u.isPer)))+"\n";a.descLab.string=l,a.content.height=a.descLab.height,a.addLeftLab.string=game.HtmlUtil.getText(game.Color.GREEN,e.getStrByData("_$TeamHp",o._$TeamHp)+"\n"+e.getStrByData("_$TeamDef",o._$TeamDef)+"\n"+e.getStrByData("_$TeamAtk",o._$TeamAtk)),a.addRightLab.string=game.HtmlUtil.getText(game.Color.GREEN,e.getStrByData("_$TeamHp",g._$TeamHp,!0)+"\n"+e.getStrByData("_$TeamDef",g._$TeamDef,!0)+"\n"+e.getStrByData("_$TeamAtk",g._$TeamAtk,!0))}},sortList:function(e,t){return e.level<t.level?-1:1},getStrByData:function(e,t,a){var i=2<arguments.length&&void 0!==a&&a,n="",s=b8e.getNormP(e),r=game.AttrRulesCfg.getData(game.SpriteStatType[s]);return t=t||0,r&&(n=r.name+"+"+(i?.1*t+"%":t)),n},getObjByCfg:function(e){this.showData||(this.showData={});var t="",a=0,i=!1;return e.clientTeamAtk?(t="_$TeamAtk",a=e.clientTeamAtk):e.clientTeamHp?(t="_$TeamHp",a=e.clientTeamHp):e.clientTeamDef?(t="_$TeamDef",a=e.clientTeamDef):e.clientTeamAtkPer?(t="_$TeamAtk",a=e.clientTeamAtkPer,i=!0):e.clientTeamHpPer?(t="_$TeamHp",a=e.clientTeamHpPer,i=!0):e.clientTeamDefPer&&(t="_$TeamDef",a=e.clientTeamDefPer,i=!0),this.showData.key=t,this.showData.val=a||0,this.showData.isPer=i,this.showData}});b8e.module.registerView(game.ME.PartnerSpiritAttr,e)}(),function(){var e,t=e=game.View.extends({_showModel:!0,time:10,ctor:function(){this._super(1438)},init:function(){this.moduleData=game.partnerData,this.initItem(),game.TweenUtil.rotationEffect(this.skin.light)},initItem:function(){var e=this.skin;this.mainIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this.mainIcon.addToParent(e.itemNode_1),this.assistIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this.assistIcon.addToParent(e.itemNode_2)},onShow:function(){var e=this,t=e.skin,a=e.moduleData.currCombineInfo;if(a){var i=a.cfg;if(e.moduleData.combinesArr&&!(e.moduleData.combinesArr.length<1)){var n=e.moduleData.combinesArr[0],s=e.moduleData.getInfoById(n);if(s){var r=s.cfg,o=void 0,g=a.quality,u=s.quality;if((o=-1==i.assistObj.indexOf(n)?(e.setIconData(e.mainIcon,i.item,i.name,g),e.setIconData(e.assistIcon,r.item,r.name,u),i.unionSkills[0]):(e.setIconData(e.assistIcon,i.item,i.name,g),e.setIconData(e.mainIcon,r.item,r.name,u),r.unionSkills[0]))&&0<o){var l=game.SkillCfg.getData(o);if(!l)return;var c=game.HtmlUtil.getText(game.Color.GREEN,game.Lang.get(52262,l.name)),h=game.HtmlUtil.getText(game.Color.YELLOW,game.LangSkill.get(l.desc,l.descParam));t.skillDesc.string=c+h}e.time=10,e.timer||(e.timer=b8e.Timer.add(e,e.updateCountDown,1e3))}}}},setIconData:function(e,t,a,i){var n=game.ItemUtil.createBaseItemInfo(t,1);e.setItemInfo(n,!1,game.IconLayoutEnum.SHOW_NAME),e.setRichName(a,i),e.setBgImage(game.ResCfg.getQualityBg(i)),e.setEffect(game.CCommonUtil.getqualityEffect(i))},onHide:function(){this.timer&&(b8e.Timer.remove(this,this.updateCountDown),this.timer=null),this.moduleData.combinesArr.shift()},updateCountDown:function(){this.time--,this.skin.timeLab.string=game.Lang.get(52263,this.time),this.time<1&&game.module.hide(this.moduleEnum)},onStageResize:function(){this._super(),this.skin.bg.width=b8e.stageWidth,this.skin.line2.width=b8e.stageWidth}});b8e.module.registerView(game.ME.PartnerCombine,t),b8e.RC("$$game","$$PartnerCombineView",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1514),this.setSize(484,112)},setData:function(e){var t=this.skin;t.icon.loadTexture(game.ResCfg.getUrl(10166,e.id));var a=game.SkillCfg.getData(e.skillId);if(a){var i=game.Color,n=e.isActive?i.WHITE:i.GREEN,s="";s=0<e.num2?game.HtmlUtil.getText(n,game.Lang.get(53278,e.num,e.num2)):game.HtmlUtil.getText(n,game.Lang.get(53024,e.num)),t.descLab.string=s,t.skillDescLab.y=t.descLab.y-t.descLab.height-4;var r=game.HtmlUtil.getText(game.Color.GREEN,game.LangSkill.get(a.desc,a.descParam));t.skillDescLab.string=r,game.ShaderUtil.setGray(this,!e.isActive)}}}),b8e.RC("$$game","$$PartnerElementFettersItem",e)}(),function(){var e=game.View.extends({_showModel:!0,time:10,ctor:function(){this._super(1513)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.PartnerElementFettersItem,this.list.layout.paddingLeft=0,this.list.layout.paddingTop=6,this.list.layout.spacingY=0,this.list.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.partnerData.getElementFetterInfos();!e||e.length<1||this.list.setData(e)}});b8e.module.registerView(game.ME.PartnerElementFettersTips,e)}(),function(){var e;e=game.View.extends({init:function(){this.data=game.partnerData,this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),this.skillIcon.isShowIconBg=!1,this.skillIcon.addToParent(this.skin.icon);var e=game.ResCfg.getHead(game.mainRoleData.isMale);this.skin.head1.loadTexture(e),this.skin.head2.loadTexture(e),this._effect=[],this.otherInit()},otherInit:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PartnerTalentSkillItem,e.bindEnum=game.ME.PartnerTalent,e.layout.spacingX=20,e.addToParent(this.skin.skillList),this.progress=new game.Progress(490,30,0),this.progress.addToParent(this.skin.proNode)},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.partnerInfo=this.getPartnerInfo(),this.updateView(),this.updateCost();break;case this.Evts.V_UPDATE_COST:this.updateCost()}},updateView:function(){var e=this.skin,t=this.partnerInfo;if(t){for(var a=0;a<6;a++)this.getComponent("starIcon"+(a+1)).active=a<t.star;if(e.elementIIcon.active=!t.isMainRole,e.starNode.active=!t.isMainRole,!t.isMainRole){var i=game.ResCfg.getUrl(10050,t.cfg.element);e.elementIIcon.loadTexture(i)}e.fightAmountLbl.string=t.fightAmount,e.nameLab.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+t.breakLv),game.AutoLayoutUtil.layoutPower(e.power,e.fightAmountLbl,e.powerImg,e.search);var n=0<t.cfg.jobIcon;(e.title_bg18.active=n)&&(e.jobDescLab.string=t.cfg.jobDesc),this.updateTask()}},updateCost:function(){this.skin,this.partnerInfo},updateTask:function(){var e=this,t=e.skin,a=e.partnerInfo;if(a)if(a.isMainRole){t.actNode.active=!1,t.skillList.active=!1,t.upNode.active=!1,t.talentSkill.active=!1,t.infoBg_3.height=188,t.mask3.height=196,t.mainRoleNode.active=!0,t.isMax.active=!1;var i=game.wushengData,n=i.curId,s=game.WuShengPosActivateCfg.getDataById(i.curId);if(!s)return;var r=s.changeQuality;if(e.setAttrLab(n,e.skin.icon1,e.skin.sprite1,1),r<game.Quality.Q_COLORFUL){t.maxRoleNode.active=!0,t.icon1.x=88,t.sprite1.x=160,t.maxRoleLab.active=!1;var o=i.getNextActiveNum(),g=game.HtmlUtil.getColorStrByQuality(r+1,game.HtmlUtil.getStrByQuality(r+1));e.setAttrLab(n+o,e.skin.icon2,e.skin.sprite2,2),t.roleLab.string=game.Lang.get(53326,o,g)}else t.maxRoleNode.active=!1,t.icon1.x=275,t.sprite1.x=347,t.maxRoleLab.active=!0}else{t.talentSkill.active=!0,t.skillList.active=!0,t.infoBg_3.height=300,t.mask3.height=308,t.mainRoleNode.active=!1;var u=game.PartnerTalentCfg.getData(a.id,a.qualityNum);if(u){var l=u.showSkillId;if(!game.PartnerTalentCfg.getData(a.id,a.qualityNum+1))return t.isMax.active=!0,t.upNode.active=!1,t.actNode.active=!1,e.setSkill(l,!0),void e.updataSkillList(!0);t.isMax.active=!1,e.setSkill(l,!1),e.updataSkillList(!1);var c=a.getCurrTalentTask(),h=a.quality+1,m=game.HtmlUtil.getColorStrByQuality(h,game.HtmlUtil.getStrByQuality(h));if(c){t.actNode.active=!0,t.upNode.active=!1;var d=c.taskType,f=c.progress,p=e.data.getLangKeyByType(d);t.taskLab.string=p?game.HtmlUtil.getText(game.Color.BLACK,game.Lang.get(p,f)):"";var v=a.getProValueByType(d);e.progress.updatePro(v,f),t.descLab.string=game.Lang.get(53318,m),t.redPoint1.active=f<=v,t.upgradeBtnLab.string=game.Lang.get(v<f&&c.moduleId&&a.battlePos?51861:6626)}else{t.actNode.active=!1,t.upNode.active=!0,e.amountIcon||(e.amountIcon=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42),e.amountIcon.addToParent(e.skin.amountIcon));var E=u.itemId,T=u.itemNum,C=game.itemData.getCountById(E),I=game.HtmlUtil.getText(T<=C?game.Color.GREEN:game.Color.RED,C)+"/"+T;e.amountIcon.setItemInfo(E,I,game.Color.BLACK,24,!1,!1),t.upDescLab.string=game.Lang.get(53320,m),t.redPoint2.active=T<=C}}}},updataSkillList:function(e){var t=e?this.partnerInfo.talentAllShow:this.partnerInfo.talentTasks;this.list.setData(t)},setSkill:function(e,t){if(e){if(this.skillIcon.setData(e),this.skin.maskImg.active=!t,this.skin.tipsLab.active=!t,this.skin.skillLab.active=t){var a=game.SkillCfg.getData(e);this.skin.skillLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name)}}},setAttrLab:function(e,t,a,i){var n=this;n.spriteStat||(n.spriteStat=game.SpriteStat.get()),n.spriteStat.clear();var s=game.WuShengPosActivateCfg.getDataById(e);if(s){var r=s.qualityLv?s.quality-1:s.quality,o=game.StarMapQualityAttrCfg.getData(r);if(o){n.spriteStat.setupByCfg(o,!1,!0);var g=n.spriteStat.getSpriteStats(),u=void 0,l="";g.forEach(function(e,t){u=game.AttrRulesCfg.getData(+e),l+=game.Lang.get(50308,u.name,t)},n),a.string=l;var c=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(r));t.loadTexture(c),n._effect[i]||(n._effect[i]=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1),t.addChild(n._effect[i]),n._effect[i].setPosition(0,0));var h=game.CCommonUtil.getqualityEffect(r);h&&(c=game.ResCfg.getUrl(5022,h))&&(n._effect[i].load(c),n._effect[i].play())}}},onShow:function(){this.partnerInfo=this.getPartnerInfo(),this.data.setMainRoleSlotGray(!1),this.updateView()},onHide:function(){this.data.autoUse=!1},onStageResize:function(){this.setPosition(0,0)},getPartnerInfo:function(){}}),b8e.RC("$$game","$$PartnerTalentBaseView",e)}(),function(){var e=game.PartnerTalentBaseView.extends({ctor:function(){this._super(1597)},getPartnerInfo:function(){var e=game.partnerData.getCurSlotInfo();return e?e.info:null}});b8e.module.registerView(game.ME.PartnerTalent,e)}(),function(){var e;e=game.ListItem.extends({skillId:0,ctor:function(){this._super(1598),this.setSize(104,130)},init:function(){this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),this.skillIcon.addToParent(this.skin.icon)},setData:function(e){var t=this;t.info=e;var a=t.skin,i=t.skillId=e.skillId;t.skillIcon.setData(i);var n=e.isFinish;e.showEff&&(t.actEff||(t.actEff=b8e.Animator.get(game.AnimType.UI_EFFECT,1),t.actEff.addToParent(t.skin.icon),t.actEff.load(game.ResCfg.getUrl(5019,1088)),t.actEff.addFinishCallback(t.actEffCB,t)),t.actEff.play(null,0),e.showEff=!1),a.maskImg.active=!n;var s=game.SkillCfg.getData(i);a.nameLab.string=n?game.HtmlUtil.getColorStrByQuality(s.quality,s.name):game.Lang.get(53301)},actEffCB:function(){this.actEff&&(this.actEff.unload(),this.actEff.parent&&this.actEff.removeFromParent(),this.actEff=null)},touchIcon:function(){this.send(game.PartnerEvts.V2C_LOOK_TALENT_SKILL,this.info)}}),b8e.RC("$$game","$$PartnerTalentSkillItem",e)}(),function(){var e=game.PartnerTalentBaseView.extends({ctor:function(){this._super(1600)},otherInit:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PartnerTalentSkillItem,e.bindEnum=game.ME.PartnerTalent,e.layout.spacingX=10,e.addToParent(this.skin.skillList),this.progress=new game.Progress(410,30,0),this.progress.addToParent(this.skin.proNode)},getPartnerInfo:function(){return game.partnerData.selectBackInfo}});b8e.module.registerView(game.ME.PartnerBackTalent,e)}(),function(){var e=game.View.extends({countDownTime:3,_showModel:!0,ctor:function(){this._super(1599)},init:function(){this._lightEffect=new game.LightEffect,this.spriteStat=game.SpriteStat.get(),this._effect=[]},onShow:function(){var e=this;e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.effect),e._lightEffect.setVisible(!0)),e.countDownTime=3,e.createCountDown(),e.info=game.partnerData.selectPartnerInfo,e.info&&!e.info.isMainRole&&(e.updataPage(),e.updateHead())},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.clearCountDown()},updataPage:function(){var e=this;e.setAttrLab(e.info.qualityNum-1,e.skin.icon1,e.skin.sprite1,e.skin.nameLab1,1),e.setAttrLab(e.info.qualityNum,e.skin.icon2,e.skin.sprite2,e.skin.nameLab2,2)},updateHead:function(){var e=game.ResCfg.getUrl(this.info.normalUrl,null==this.info.cfg.icon?this.info.cfg.photo:this.info.cfg.icon);this.skin.head1.loadTexture(e),this.skin.head2.loadTexture(e)},setAttrLab:function(e,t,a,i,n){var s=this;s.spriteStat.clear();var r=game.PartnerTalentCfg.getData(s.info.id,e);if(r){var o=r.quality;i.string=game.HtmlUtil.getColorStrByQuality(o,s.info.name),s.spriteStat.setupByCfg(r,!1,!0);var g=s.spriteStat.getSpriteStats(),u=void 0,l="";g.forEach(function(e,t){u=game.AttrRulesCfg.getData(+e),l+=game.Lang.get(51579,u.name,t)},s),a.string=l;var c=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(o));t.loadTexture(c),s._effect[n]||(s._effect[n]=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1),t.addChild(s._effect[n]),s._effect[n].setPosition(0,0));var h=game.CCommonUtil.getqualityEffect(o);h&&(c=game.ResCfg.getUrl(5022,h))&&(s._effect[n].load(c),s._effect[n].play())}},createCountDown:function(){this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(game.ME.PartnerTalentQulity)},onStageResize:function(){this._super(),this.skin.gray.setSize(b8e.stageWidth+50,339),this.skin.huawen_3.width=this.skin.huawen_1.width=b8e.stageWidth+50}});b8e.module.registerView(game.ME.PartnerTalentQulity,e)}(),function(){var e;e=game.EquipInfo.extends({type:0,wearTarget:0,baseSpriteStat:null,cfg:null,ctor:function(){this.baseSpriteStat=game.SpriteStat.get(),this.allSpriteStat=game.SpriteStat.get()},setData:function(e){this._super(e),this.__renderType=0,this.cfg=game.ItemInfoCfg.getData(e.id);var t=this.cfg;this.type==game.PartnerEquipType.Exclusive&&(t=game.PartnerProperTopCfg.getData(this.id,0)),this.baseSpriteStat.setupByCfg(t),this.updateAllSpriteStat()},isWear:{get:function(){return 0<this.wearTarget}},totalFight:{get:function(){return this.allSpriteStat.getPower()}},updateAllSpriteStat:function(){this.allSpriteStat.clear(),this.allSpriteStat.addSpriteStat(this.baseSpriteStat)}}),b8e.RC("$$game","$$PartnerEquipInfoBase",e)}(),function(){var e;e=b8e.Enum({$$None:0,$$General:1,$$Treasure:2,$$Exclusive:3}),b8e.RC("$$game","$$PartnerEquipType",e)}(),function(){var e;e=b8e.Enum({$$POS_NONE:0,$$POS_1:1,$$POS_2:2,$$POS_3:3,$$POS_4:4,$$POS_5:5,$$POS_6:6,$$POS_7:7,$$POS_MAX:7}),b8e.RC("$$game","$$EquipPosType",e)}(),function(){var e=b8e.Object.extends({selPartner:null,selPos:0,selInfo:null,nextShareTime:0,_exclusiveOpenLv:0,_excBreakMaxLv:0,equipShowInfo:null,ctor:function(){this.wearInfoMap=b8e.HashMap.get(),this.notWearInfoMap=b8e.HashMap.get(),this.allSuitSpriteStat=game.SpriteStat.get(),this.currSuitSpriteStat=game.SpriteStat.get()},exclusiveOpenLv:{get:function(){return 0==this._exclusiveOpenLv&&(this._exclusiveOpenLv=+game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"exclusiveOpenLv")),this._exclusiveOpenLv}},excBreakMaxLv:{get:function(){return 0==this._excBreakMaxLv&&(this._excBreakMaxLv=+game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"excBreakMaxLv")),this._excBreakMaxLv}},initWearInfoMap:function(e){if(e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++){i=e[n].item,(a=this.createInfoById(i.id)).setData(i);var s=a.cfg.pos,r=this.wearInfoMap.get(s);r||(r=b8e.HashMap.get(),this.wearInfoMap.set(s,r)),r.set(i.idx,a)}},initExcWearInfoMap:function(e){if(e){var t=e.id,a=game.EquipPosType.POS_7,i=this.createInfoById(t);i.setData(e);var n=this.wearInfoMap.get(a);n||(n=b8e.HashMap.get(),this.wearInfoMap.set(a,n)),n.set(e.idx,i)}},createInfoById:function(e){var t=this.getEquipType(e),a=void 0,i=game.PartnerEquipType;switch(t){case i.General:case i.Treasure:a=new game.PartnerEquipInfo;break;case i.Exclusive:a=new game.PartnerEquipExcInfo}return a.type=t,a},getEquipType:function(e){var t=game.ItemInfoCfg.getData(e);if(t){var a=t.pos;return this.getTypeByPos(a)}},getTypeByPos:function(e){var t=game.PartnerEquipType,a=game.EquipPosType;return e==a.POS_7?t.Exclusive:e==a.POS_5||e==a.POS_6?t.Treasure:t.General},getAllInfosByPos:function(e,t){var a=void 0;return t?a=this.wearInfoMap.get(e):(a=this.notWearInfoMap.get(e))||(this.setNorWearInfoMap(e),a=this.notWearInfoMap.get(e)),a&&a.values()},setNorWearInfoMap:function(e){for(var t=game.equipData.getPetEquipList(),a=t.length,i=void 0,n=b8e.HashMap.get(),s=0;s<a;s++)(i=t[s]).cfg.pos==e&&n.set(i.idx,i);this.notWearInfoMap.set(e,n)},getPosById:function(e){var t=game.ItemInfoCfg.getData(e);return t?t.pos:0},changeEquipState:function(e,t,a,i){var n=3<arguments.length&&void 0!==i&&i,s=this.wearInfoMap.get(a);s||(s=b8e.HashMap.get(),this.wearInfoMap.set(a,s));var r=this.notWearInfoMap.get(a);if(r||(r=b8e.HashMap.get(),this.wearInfoMap.set(a,r)),n){var o=s.get(e),g=r.get(t);r.del(t),s.del(e),r.set(e,o),s.set(t,g)}else if(t){var u=r.get(t);r.del(t),s.set(t,u)}else{var l=s.get(e);s.del(e),r.set(e,l)}},updateWearEquip:function(e){game.partnerData.getCurSlotInfo().changeAllEquip(e.equips)},updateRemoveEquip:function(e){game.partnerData.getCurSlotInfo().removeEquip(e.pos)},updateExclusiveEquip:function(e){var t=game.partnerData.getCurSlotInfo(),a=e.equip;if(this.updateFateSpriteStat(e),a){if(0<a.idx){var i=[];i.push(a),t.changeAllEquip(i)}}else t.removeEquip(game.EquipPosType.POS_7)},updateFateSpriteStat:function(e){var t=e.equip,a=game.partnerData.getCurSlotInfo().info;a&&a.updateExcFateSpriteStat(t)},updateExcEquipBreakLv:function(e){var t=game.partnerData.getCurSlotInfo();equipMap=t.getEquipMap();var a=e.equip,i=a.equip;game.equipData.petEquipMap.get(a.idx).updateBreakLv(i.properTop)},checkAllCanWearList:function(e){return!!e&&0<this.getAllCanWearEquipList(e).length},checkCanWearByPos:function(e,t){if(t==game.EquipPosType.POS_7&&!this.isOpenExcEquip())return!1;var a=game.partnerData.getSlotInfoBySlot(e).getEquipIdxByPos(t),i=this.wearInfoMap.get(t),n=void 0;a&&(n=i.get(a));var s=this.getMaxFightInfo(t);return this.getIsMax(n,s)},getCanWearEquipByType:function(e){for(var t=game.partnerData.getCurSlotInfo(),a=this.getAllCanWearEquipList(t),i=a.length,n=[],s=void 0,r=void 0,o=void 0,g=game.PartnerEquipType.Exclusive,u=0;u<i;u++){if(o=(r=a[u]).idx,r.type==g){s=o;break}n.push(o)}return e==g?s:n},getAllCanWearEquipList:function(e){var t=e;if(0==t.id)return!1;for(var a=game.EquipPosType.POS_MAX,i=[],n=void 0,s=void 0,r=void 0,o=0;o<a;o++)if(s=null,(r=o+1)!=game.EquipPosType.POS_7||this.isOpenExcEquip()){(n=t.getEquipIdxByPos(r))&&(s=this.wearInfoMap.get(r).get(n));var g=this.getMaxFightInfo(r);this.getIsMax(s,g)&&i.push(g)}return i},getIsMax:function(e,t){if(!e&&t)return!0;var a=0,i=0,n=0;return!!t&&(t&&(a=t.cfg.level),e&&(i=e.cfg.level,n=e.totalFight),i<a||a==i&&t.totalFight>n)},getMaxFightInfo:function(e){var t=this.getAllInfosByPos(e,!1);if(!t||t.length<1)return null;for(var a=t.length,i=void 0,n=void 0,s=t[0],r=0;r<a;r++)(n=(i=t[r]).cfg).level>s.cfg.level?s=i:n.level==s.cfg.level&&(s=i.totalFight>s.totalFight?i:s);return s},getWearSuitNum:function(i){var n=this,s=0,e=game.partnerData.getCurSlotInfo();return e?(e.getEquipMap().forEach(function(e,t){var a=n.getWearEquipInfo(e,t);-1<i.indexOf(a.id)&&s++},n),s):0},isInitWearOrNotWearMap:function(){return 0<this.wearInfoMap.values().length||0<this.notWearInfoMap.values().length},getWearEquipInfo:function(e,t){var a=this.wearInfoMap.get(e);return a?a.get(t):null},canBreakExcEquip:function(e){if(!e)return!1;if(!this.isOpenExcEquip())return!1;var t=game.EquipPosType.POS_7,a=e.getEquipIdxByPos(t);return!!a&&this.getWearEquipInfo(t,a).canBreak()},delNotWearEquipByIdx:function(e){var t=game.equipData.petEquipMap.get(e);if(t){var a=t.cfg.pos,i=this.notWearInfoMap.get(a);i&&i.has(e)&&i.del(e)}},isOpenExcEquip:function(){return game.mainRoleData.lv>=this.exclusiveOpenLv},getSlotSuitSpriteStat:function(e){var s=this,t=e.getEquipMap(),r=b8e.HashMap.get();s.allSuitSpriteStat.clear(),t.forEach(function(e,t){var a=s.getWearEquipInfo(e,t),i=a.cfg.suit;if(0<i){var n=r.get(i);n||(n=[],r.set(i,n)),n.push(a)}},s);for(var a=r.values(),i=a.length,n=void 0,o=void 0,g=void 0,u=void 0,l=0;l<i;l++)1<(o=(n=a[l]).length)&&(s.currSuitSpriteStat.clear(),u=n[0].cfg,g=game.PartnerSuitCfg.getData(u.suit,o),s.currSuitSpriteStat.setupByCfg(g),s.allSuitSpriteStat.addSpriteStat(s.currSuitSpriteStat));return s.allSuitSpriteStat},getShowInfo:function(){return this.equipShowInfo||(this.equipShowInfo=new game.PartnerEquipShowInfo),this.equipShowInfo.nextShareTime=this.nextShareTime,this.equipShowInfo},updateShareTime:function(e){this.nextShareTime=e},equipSortHandler:function(e,t){return t.cfg.quality-e.cfg.quality},getPartnerEquipExcCost:function(e){if(!e)return null;var t=game.PartnerProperTopCfg.getData(e.id,e.breakLv);return t?t.totalItems:null},getCostExcEquipNum:function(e){var t=0,a=this.getAllInfosByPos(game.EquipPosType.POS_7,!1);if(!a)return 0;for(var i=a.length,n=void 0,s=0;s<i;s++)(n=a[s]).id!=e||n.breakLv&&0!=n.breakLv||t++;return t},getNotBreakExcEquip:function(e,t){this.idxArr||(this.idxArr=[]),this.idxArr.length=0;var a=this.getAllInfosByPos(game.EquipPosType.POS_7,!1);if(!a)return 0;for(var i=a.length,n=void 0,s=0,r=0;r<i&&((n=a[r]).id==t&&0==n.breakLv&&(this.idxArr.push(n.idx),s++),!(e<=s));r++);return this.idxArr},getBreakCostEquipNum:function(e){var t=game.PartnerProperTopCfg.getData(e.cfg.id,e.breakLv);if(t)return this.getNotBreakExcEquip(t.costNum,e.id)},getExcEquipNumByLv:function(e){var t=game.EquipPosType.POS_7,a=this.getAllInfosByPos(t,!0);if(a){for(var i=a.length,n=0,s=0;s<i;s++)a[s].breakLv>=e&&n++;return n}},getWearEquipNumByQuality:function(e){if(!this.wearInfoMap||this.wearInfoMap.count()<1)return 0;for(var t=0,a=void 0,i=void 0,n=game.EquipPosType.POS_MAX+1,s=game.EquipPosType.POS_1;s<n;s++)if((a=this.getAllInfosByPos(s,!0))&&!(a.length<1)){i=a.length;for(var r=0;r<i;r++)a[r].quality>=e&&t++}return t}});game.partnerEquipData=game.partnerEquipData||new e}(),function(){var e;e=game.PartnerEquipInfoBase.extends({breakLv:0,breakSpriteStat:null,fettersSpriteStat:null,isBreakMax:!1,ctor:function(){this._super(),this.breakSpriteStat=game.SpriteStat.get()},setData:function(e){this._super(e);var t=e.equip;t&&this.updateBreakLv(t.properTop)},updateBreakLv:function(e){this.breakLv=e,this.updateBreakAttr(),this.updateAllSpriteStat(),this.isBreakMax=e>=game.partnerEquipData.excBreakMaxLv},updateBreakAttr:function(){var e=game.PartnerProperTopCfg.getData(this.id,this.breakLv);e&&this.breakSpriteStat.setupByCfg(e,!1)},updateAllSpriteStat:function(){this.allSpriteStat.clear(),this.allSpriteStat.addSpriteStat(this.breakSpriteStat)},canBreak:function(){if(this.isBreakMax)return!1;var e=game.PartnerProperTopCfg.getData(this.id,this.breakLv);if(e){var t=e.costItems[0],a=game.itemData.getCountById(t.Id),i=t.Num,n=i<=a,s=!0;return 0<e.costNum&&(a=game.partnerEquipData.getCostExcEquipNum(this.id),s=(i=e.costNum)<=a),n&&s}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerEquipExcInfo",e)}(),function(){var e;e=game.PartnerEquipInfoBase.extends({intensifylv:0,refinelv:0,purifylv:0,gemlv:0,gemTotalLv:0,zhulingLv:0,zhulingExp:0,fuseLv:0,intensifySpriteStat:null,refineSpriteStat:null,purifySpriteStat:null,gemSpriteStat:null,zhulingSpriteStat:null,fuseSpriteStat:null,intensifyFightAmount:0,refineFightAmount:0,purifyFightAmount:0,gemFightAmount:0,zhulingFightAmount:0,fuseFightAmount:0,intensifyCfg:null,refineCfg:null,purifyCfg:null,zhulingCfg:null,fuseCfg:null,costIntensifyCfg:null,costRefineCfg:null,costPurifyCfg:null,costZhulingCfg:null,costFuseCfg:null,ctor:function(){var e=this;e._super(),e.gems=[],e.intensifySpriteStat=game.SpriteStat.get(),e.refineSpriteStat=game.SpriteStat.get(),e.purifySpriteStat=game.SpriteStat.get(),e.gemSpriteStat=game.SpriteStat.get(),e.zhulingSpriteStat=game.SpriteStat.get(),e.fuseSpriteStat=game.SpriteStat.get(),e.suitInfos=[],e.gemMap=b8e.HashMap.get()},setData:function(e){this._super(e),this.updateEquipForgeInfo(e)},onSlotGemsUp:function(e){for(var t=e.length,a=0;a<t;a++){var i=e[a];if(i){var n=this.gemMap.get(i.slot);n&&n.onSlotGemUp(i.lv)}}if(!this.gemMaxLv){var s=game.ForgeMiscCfg.getData("gemStoneMaxLv");s&&s.value&&(this.gemMaxLv=+s.value)}var r=this.gemMaxLv;this.gemTotalLv=0;for(var o=1;o<=3;o++){var g=this.gemMap.get(o);if(g){var u=g.gemlv;u<r&&(r=u),this.gemTotalLv+=u}}this.gemlv=r,this.updateGemFightAmout()},onSlotForgeUp:function(e,t,a){var i=this;switch(t){case game.EquipForgeType.INTENSIFY:i.intensifylv=a,i.intensifyCfg=0<i.intensifylv?game.ForgeUpgradeCfg.getAttrDataByForgeType(game.EquipForgeType.INTENSIFY,i.id,i.intensifylv):null,i.costIntensifyCfg=game.ForgeUpgradeCfg.getData(e,i.intensifylv),i.updateIntensifyFightAmout();break;case game.EquipForgeType.REFINE:i.refinelv=a,i.refineCfg=0<i.refinelv?game.ForgeRefineCfg.getAttrDataByForgeType(game.EquipForgeType.REFINE,i.id,i.refinelv):null,i.costRefineCfg=game.ForgeRefineCfg.getData(e,i.refinelv),i.updateRefineFightAmout();break;case game.EquipForgeType.PURIFY:i.purifylv=a,i.purifyCfg=0<i.purifylv?game.ForgePurifyCfg.getAttrDataByForgeType(game.EquipForgeType.PURIFY,i.id,i.purifylv):null,i.costPurifyCfg=game.ForgePurifyCfg.getData(e,i.purifylv),i.updatePurifyFightAmout()}},onSlotZhulingUp:function(e,t){var a=this;a.zhulingLv=e||0,a.zhulingExp=t||0,a.zhulingCfg=0<a.zhulingLv||0<a.zhulingExp?game.ForgeZhulingCfg.getAttrDataByLvAndExp(a.id,a.zhulingLv,a.zhulingExp):null,a.costZhulingCfg=a.quality>=game.Quality.Q_UNPARALLELED?game.ForgeZhulingCfg.getData(a.id,a.zhulingLv):null,a.updateZhulingFightAmout()},onSlotFuseUp:function(e){var t=this;t.fuseLv=e||0,t.fuseCfg=0<t.fuseLv?game.ForgeFuseCfg.getAttrDataByLvAndId(t.id,t.fuseLv):null,t.costFuseCfg=t.quality>=game.Quality.Q_UNPARALLELED?game.ForgeFuseCfg.getData(t.id,t.fuseLv):null,t.updateFuseFightAmout()},updateEquipForgeInfo:function(e){var t=this;if(e&&e.equip){var a=e.equip;t.intensifylv=a.qianghua,t.refinelv=a.chuilian,t.purifylv=a.fuhun,t.zhulingLv=a.zhulingLv||0,t.zhulingExp=a.zhulingExp||0,t.fuseLv=a.fuseLv||0,t.gems=e.gems,t.gemMap.clear();for(var i=a.gems||[],n=b8e.HashMap.get(),s=i.length,r=0;r<s;r++){var o=i[r];n.set(o.slot,o)}if(!t.gemMaxLv){var g=game.ForgeMiscCfg.getData("gemStoneMaxLv");g&&g.value&&(t.gemMaxLv=+g.value)}var u=t.gemMaxLv;t.gemTotalLv=0;for(var l=1;l<=3;l++){var c=n.get(l),h=t.gemMap.get(l);h||(h=new game.EquipForgeSlotGemInfo).setData(0,t.pos);var m=c?c.level:0;h.updateGemInfo(l,m),t.gemMap.set(l,h),m<u&&(u=m),t.gemTotalLv+=m}if(t.gemlv=u,t.intensifyCfg=0<t.intensifylv?game.ForgeUpgradeCfg.getAttrDataByForgeType(game.EquipForgeType.INTENSIFY,t.id,t.intensifylv):null,t.refineCfg=0<t.refinelv?game.ForgeRefineCfg.getAttrDataByForgeType(game.EquipForgeType.REFINE,t.id,t.refinelv):null,t.purifyCfg=0<t.purifylv?game.ForgePurifyCfg.getAttrDataByForgeType(game.EquipForgeType.PURIFY,t.id,t.purifylv):null,t.zhulingCfg=0<t.zhulingLv||0<t.zhulingExp?game.ForgeZhulingCfg.getAttrDataByLvAndExp(t.id,t.zhulingLv,t.zhulingExp):null,t.fuseCfg=0<t.fuseLv?game.ForgeFuseCfg.getAttrDataByLvAndId(t.id,t.fuseLv):null,t.cfg){var d=game.equipForgeData.getConfigEquipType2(t.cfg.pos);t.costIntensifyCfg=game.ForgeUpgradeCfg.getData(d,t.intensifylv),t.costRefineCfg=game.ForgeRefineCfg.getData(d,t.refinelv),t.costPurifyCfg=game.ForgePurifyCfg.getData(d,t.purifylv)}t.id&&t.quality>=game.Quality.Q_UNPARALLELED&&(t.costZhulingCfg=game.ForgeZhulingCfg.getData(t.id,t.zhulingLv),t.costFuseCfg=game.ForgeFuseCfg.getData(t.id,t.fuseLv)),t.updateAllForgeFightAmount()}},updateAllForgeFightAmount:function(){this.updateIntensifyFightAmout(),this.updateRefineFightAmout(),this.updatePurifyFightAmout(),this.updateGemFightAmout(),this.updateZhulingFightAmout(),this.updateFuseFightAmout(),this.updateAllSpriteStat()},updateIntensifyFightAmout:function(){var e=this;e.tmpAmount=e.intensifyFightAmount||0,e.intensifyFightAmount=0,e.intensifySpriteStat.clear(),e.id<=0||!e.intensifyCfg||(e.intensifySpriteStat.setupByCfg(e.intensifyCfg),e.intensifyFightAmount+=game.CCommonUtil.getPower(e.intensifySpriteStat),e.intensifyFightAmount=e.intensifyFightAmount||0)},updateRefineFightAmout:function(){var e=this;e.tmpAmount=e.refineFightAmount||0,e.refineFightAmount=0,e.refineSpriteStat.clear(),e.id<=0||!e.refineCfg||(e.refineSpriteStat.setupByCfg(e.refineCfg),e.refineFightAmount+=game.CCommonUtil.getPower(e.refineSpriteStat),e.refineFightAmount=e.refineFightAmount||0)},updatePurifyFightAmout:function(){var e=this;e.tmpAmount=e.purifyFightAmount||0,e.purifyFightAmount=0,e.purifySpriteStat.clear(),e.id<=0||!e.purifyCfg||(e.purifySpriteStat.setupByCfg(e.purifyCfg),e.purifyFightAmount+=game.CCommonUtil.getPower(e.purifySpriteStat),e.purifyFightAmount=e.purifyFightAmount||0)},updateZhulingFightAmout:function(){var e=this;e.tmpAmount=e.zhulingFightAmount||0,e.zhulingFightAmount=0,e.zhulingSpriteStat.clear(),e.id<=0||!e.zhulingCfg||(e.zhulingSpriteStat.setupByCfg(e.zhulingCfg),e.zhulingFightAmount+=game.CCommonUtil.getPower(e.zhulingSpriteStat),e.zhulingFightAmount=e.zhulingFightAmount||0)},updateFuseFightAmout:function(){var e=this;e.tmpAmount=e.fuseFightAmount||0,e.fuseFightAmount=0,e.fuseSpriteStat.clear(),e.id<=0||!e.fuseCfg||(e.fuseSpriteStat.setupByCfg(e.fuseCfg),e.fuseFightAmount+=game.CCommonUtil.getPower(e.fuseSpriteStat),e.fuseFightAmount=e.fuseFightAmount||0)},updateGemFightAmout:function(){var e=this;if(e.tmpAmount=e.gemFightAmount||0,e.gemFightAmount=0,e.gemSpriteStat.clear(),!(e.id<=0)){for(var t=e.gemMap.values(),a=0;a<t.length;a++){var i=t[a];i&&i.gemCfg&&e.gemSpriteStat.addByCfg(i.gemCfg)}e.gemFightAmount+=game.CCommonUtil.getPower(e.gemSpriteStat),e.gemFightAmount=e.gemFightAmount||0}},updateAllSpriteStat:function(){var e=this;e.allSpriteStat.clear(),e._super(),e.allSpriteStat.addSpriteStat(e.intensifySpriteStat),e.allSpriteStat.addSpriteStat(e.refineSpriteStat),e.allSpriteStat.addSpriteStat(e.purifySpriteStat),e.allSpriteStat.addSpriteStat(e.gemSpriteStat),e.allSpriteStat.addSpriteStat(e.zhulingSpriteStat),e.allSpriteStat.addSpriteStat(e.fuseSpriteStat)},getSuitInfos:function(){if(this.suitInfos&&0<this.suitInfos.length)return this.suitInfos;if(this.cfg.suit){var e=game.PartnerSuitCfg.getData(this.cfg.suit,2);if(!e)return null;for(var t=e.suits,a=t.length,i=0;i<a;i++){var n=game.ItemUtil.createBaseItemInfo(t[i]);this.suitInfos.push(n)}}return this.suitInfos}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerEquipInfo",e)}(),function(){var e;e=b8e.Object.extends({info:null,nextShareTime:0,showViewME:0,updateInfos:function(e){this.info=e},setShowME:function(e){this.showViewME=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerEquipShowInfo",e)}(),function(){var e;e=b8e.Enum({None:0,V_TOGGLECHANGE:-1,C2V_WEAR_EQUIP:-1,C2V_REMOVE_EQUIP:-1,C2V_UPDATE_BREAK:-1,V_DETAILS_INIT:-1,V_CHANGE_EQUIP:-1,V_EXC_REMOVE_EQUIP:-1,V_SHOW_EQUIP:-1,V_SHOW_PARTNER_INFO:-1,V_GOTO_BREAK:-1,V_SHOW_TALENT:-1,V_UPDATE_SHARE_TIME:-1,C2C_EQUIP_CHANGE:-1,C2C_EXC_EQUIP_CHANGE:-1,C2C_UPDATE_EQUIP_POWER:-1}),b8e.RC("$$game","$$PartnerEquipEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.partnerEquipData,this.excEquipBreakAlert=game.spotAlert.set(game.SAE.PARTNER_CUR_EQUIP_BREAK)},ipc:function(){var e=this;e.evts={Back:{C_BACK_UPDATE_ITEMINFO:e.updateItemInfo,C_BACK_SYN_BACK_INFO:e.updateItemInfo},Partner:{C_SELECTCHANGE:e.updateItemInfo},PartnerMain:{C2C_AUOT_WEAR:e.onAutoWear}},e.handels={PartnerEquipResp:e.partnerEquipResp,PartnerCastEquipResp:e.partnerCastEquipResp,PartnerProperResp:e.partnerProperResp,PartnerProperTopResp:e.partnerProperTopResp,PartnerEquipShareResp:e.partnerEquipShareResp}},notify:function(e,t,a){var i=this;switch(e){case i.Evts.C2V_WEAR_EQUIP:i.wearEquipReq(t,a);break;case i.Evts.V_CHANGE_EQUIP:i.changeBtn();break;case i.Evts.V_EXC_REMOVE_EQUIP:i.excRemoveBtn();break;case i.Evts.V_SHOW_EQUIP:i.showBtn();break;case i.Evts.V_SHOW_PARTNER_INFO:i.parInfoBtn();break;case i.Evts.V_GOTO_BREAK:i.gotoBreakBtn();break;case i.Evts.V_SHOW_TALENT:i.talentInfoBtn()}},partnerEquipResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.partnerData.getCurSlotInfo();a&&(game.FightAmount.inst().setNomalStat(a.allSpriteStat),this.moduleData.updateWearEquip(t),game.FightAmount.inst().setUpdatedStat(a.allSpriteStat),game.module.hide(game.ME.PartnerEquipChange),this.dpt(this.Evts.C2C_EQUIP_CHANGE),this.dpt(this.Evts.C2C_UPDATE_EQUIP_POWER),this.fateNotice(1,t.equips))}},partnerCastEquipResp:function(e){var t=e.readProtobuf(game.pb.PartnerCastEquipResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateRemoveEquip(t),this.dpt(this.Evts.C2C_EQUIP_CHANGE))},partnerProperResp:function(e){var t=e.readProtobuf(game.pb.PartnerProperResponse);if(0<t.code)game.notice.noticeError(t.code);else{t.equip&&game.module.hide(game.ME.PartnerEquipChange),game.module.hide(game.ME.PartnerExcEquipDetails);var a=game.partnerData.getCurSlotInfo();a&&(game.FightAmount.inst().setNomalStat(a.allSpriteStat),this.moduleData.updateExclusiveEquip(t),game.FightAmount.inst().setUpdatedStat(a.allSpriteStat),this.dpt(this.Evts.C2C_EXC_EQUIP_CHANGE),t.equip&&this.fateNotice(2,t.equip.idx))}},partnerProperTopResp:function(e){var t=e.readProtobuf(game.pb.PartnerProperTopResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.equip,i=game.ItemInfoCfg.getData(a.id),n=game.partnerEquipData.getWearEquipInfo(i.pos,a.idx);n&&(game.FightAmount.inst().setNomalStat(n.allSpriteStat),n.updateBreakLv(a.equip.properTop),game.FightAmount.inst().setUpdatedStat(n.allSpriteStat),this.send(this.Evts.C2V_UPDATE_BREAK),this.dpt(this.Evts.C2C_EXC_EQUIP_CHANGE))}},partnerEquipShareResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipShareResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.nextShareTime=t.nextShareTime,this.send(this.Evts.V_UPDATE_SHARE_TIME))},onAutoWear:function(){var e=game.partnerData.selectSlot,t=game.PartnerEquipType,a=this.moduleData.getCanWearEquipByType(t.Exclusive);a&&this.sender.PartnerProperReq(e,a);var i=this.moduleData.getCanWearEquipByType(t.General);i&&0<i.length&&this.sender.PartnerEquipReq(e,i),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeEquip)},wearEquipReq:function(e,t){var a=game.PartnerEquipType,i=game.partnerData.selectSlot;e==a.Exclusive?this.sender.PartnerProperReq(i,t):this.sender.PartnerEquipReq(i,t)},notWearBtn:function(){this.selectToggle(0)},wearBtn:function(){this.selectToggle(1)},infoBtn:function(){this.selectToggle(0)},breakBtn:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)},gotoBreakBtn:function(){this.selectToggle(1)},excRemoveBtn:function(){this.wearEquipReq(game.PartnerEquipType.Exclusive,0)},talentInfoBtn:function(){game.module.show(game.ME.PartnerTalentInfo)},parInfoBtn:function(){var e=game.partnerEquipData.getShowInfo();if(e&&e.info){var t=e.info.cfg;if(t){var a=t.partnerId;game.partnerData.setShowInfo(a),game.module.show(game.ME.PartnerDetails)}}},showBtn:function(){var e=game.partnerData.getCurSlotInfo(),t=this.moduleData.selInfo;if(t)if(t.cfg.quality<game.Quality.Q_YELLOW)game.notice.show(51813);else{var a=t.type==game.PartnerEquipType.Exclusive;this.moduleData.nextShareTime-game.SysTime.curTime<=0&&this.sender.PartnerEquipShareReq(a,e.slot,a?0:t.cfg.pos)}},changeBtn:function(){game.module.show(game.ME.PartnerEquipChange),game.module.hide(game.ME.PartnerEquipDetails)},removeBtn:function(){var e=game.partnerData.selectSlot,t=game.partnerEquipData.selPos;this.sender.PartnerCastEquipReq(e,t),game.module.hide(game.ME.PartnerEquipDetails)},strengBtn:function(){this.send(game.MainUIEvts.BOTTOM_SELECT_INDEX_CHANGE,2),game.module.toggleShow(game.ME.EquipForge),game.module.hide(game.ME.PartnerEquipDetails)},breakLvBtn:function(){var e=this.moduleData.selInfo;if(e)if(e.canBreak()){var t=game.PartnerProperTopCfg.getData(e.cfg.id,e.breakLv);if(t){var a=[];0<t.costNum&&(a=this.moduleData.getBreakCostEquipNum(e)),this.sender.PartnerProperTopReq(game.partnerData.selectSlot,a)}}else game.notice.show(113)},updateItemInfo:function(){this.checkBreakAlert(),this.send(this.Evts.C2V_UPDATE_BREAK)},checkBreakAlert:function(){var e=game.partnerData.getCurSlotInfo();this.excEquipBreakAlert.alert=this.moduleData.canBreakExcEquip(e)},fateNotice:function(e,t){var a=game.partnerData,i=a.getCurSlotInfo();if(2==e){var n=game.EquipPosType.POS_7,s=this.moduleData.getWearEquipInfo(n,t);if(!s)return;var r=a.getEquipResonanceFate(s.cfg.id,i);if(!r)return;this.showFateNotice(r)}else{var o=a.getAllEquipResonanceFate(t);if(!o)return;for(var g=o.length,u=0;u<g;u++)this.showFateNotice(o[u])}},showFateNotice:function(e){var t=game.PartnerFateCfg.getData(e);t&&game.notice.showNotice(603,t.desc)}}),t=[game.ME.PartnerEquipNotWear,game.ME.PartnerEquipToWear,game.ME.PartnerEquipDetails,game.ME.EquipDetails,game.ME.PartnerExcEquipDetails,game.ME.PartnerExcEquipInfo,game.ME.PartnerExcEquipBreak,game.ME.ExcEquipDetails,game.ME.PartnerTalentInfo],a=game.Sender.extends({ipc:function(){this.msg={PartnerEquipReq:this.partnerEquipReq,PartnerCastEquipReq:this.partnerCastEquipReq,PartnerProperReq:this.partnerProperReq,PartnerProperTopReq:this.partnerProperTopReq,PartnerEquipShareReq:this.partnerEquipShareReq}},partnerEquipReq:function(e,t){var a=game.pb.PartnerEquipRequest;a.slot=e,a.idx=t,this.write(a)},partnerCastEquipReq:function(e,t){var a=game.pb.PartnerCastEquipRequest;a.slot=e,a.pos=t,this.write(a)},partnerProperReq:function(e,t){var a=game.pb.PartnerProperRequest;a.slot=e,a.idx=t,this.write(a)},partnerProperTopReq:function(e,t){var a=game.pb.PartnerProperTopRequest;a.slot=e,a.idx=t,this.write(a)},partnerEquipShareReq:function(e,t,a){var i=game.pb.PartnerEquipShareRequest;i.isProper=e,i.slot=t,i.equipSlot=a,this.write(i)}});b8e.module.registerControl(game.ME.PartnerEquipChange,e,game.PartnerEquipEvts,a,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1334),this.toggles={toggle_btn_1:game.ME.PartnerEquipNotWear,toggle_btn_2:game.ME.PartnerEquipToWear}},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},onShow:function(){this.toggleSelect(0)}});b8e.module.registerView(game.ME.PartnerEquipChange,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1336)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.PartnerEquipWearItem,this._list.bindEnum=game.ME.PartnerEquipChange,this._list.layout.paddingLeft=6,this._list.layout.paddingTop=6,this._list.layout.spacingY=10,this._list.addToParent(e.list)},onShow:function(){this.updateView()},updateView:function(){var e=game.partnerEquipData,t=e.selPos,a=e.getAllInfosByPos(t,!1);this.skin.noInfoNode.active=!a||a.length<1,a&&a.sort(e.equipSortHandler),this._list.setData(a||[])},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerEquipNotWear,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1337)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.PartnerEquipWearItem,this._list.bindEnum=game.ME.PartnerEquipChange,this._list.layout.paddingLeft=6,this._list.layout.paddingTop=6,this._list.layout.spacingY=10,this._list.addToParent(e.list)},onShow:function(){this.updateView()},updateView:function(){var e=game.partnerEquipData,t=e.selPos,a=e.getAllInfosByPos(t,!0);a&&a.sort(e.equipSortHandler),this._list.setData(a||[])},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerEquipToWear,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1335)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.EquipDetailsView,this._list.bindEnum=game.ME.PartnerEquipChange,this._list.layout.paddingTop=-10,this._list.addToParent(e.detailsList)},notify:function(e){switch(e){case this.Evts.V_UPDATE_SHARE_TIME:this.addDetailsView()}},onShow:function(){this._list.scrollToTop(),this.addDetailsView()},addDetailsView:function(){var e=[],t=game.partnerEquipData,a=t.getShowInfo();a.updateInfos(t.selInfo),a.setShowME(this.moduleEnum),game.tipsData.setBack(!1),e.push(a),this._list.setData(e)}});b8e.module.registerView(game.ME.PartnerEquipDetails,e)}(),function(){var e;e=game.ListItem.extends({minHeight:120,totalMinHeight:720,nextShareTime:0,ctor:function(){this._super(1331)},setData:function(e){var t=this;t.data=e,t.equipInfo=e.info,t.isBack=game.tipsData.isBack,t.updateView(),t.skin.time.active=!t.isBack;var a=e.nextShareTime-game.SysTime.curTime;t.nextShareTime=e.nextShareTime,0<a?(t.countDownTimer||(t.countDownTimer=b8e.Timer.add(t,t.updateCountDown,1e3),t.skin.time.string=game.Lang.get(9501,Math.floor(a/1e3))),game.ShaderUtil.setGray(this.skin.showBtn,!0)):t.skin.time.string=""},updateCountDown:function(){var e=this.nextShareTime-game.SysTime.curTime;this.skin.time.string=game.Lang.get(9501,Math.floor(e/1e3)),game.ShaderUtil.setGray(this.skin.showBtn,0<=e),e<0&&(b8e.Timer.remove(this,this.updateCountDown),this.countDownTimer=null,this.skin.time.string="")},updateView:function(){var e=this,t=e.skin;if(e.equipInfo){e.showEquip(),e.showStreng(),e.showTemper(),e.showMosaic(),e.showSoul(),e.showZhuling(),e.showFuse(),e.showSuit(),e.showAccessLab();var a=void 0;a=e.isBack&&t.node_7.active?-t.node_7.y+t.node_7.height:t.node_6.active?-t.node_6.y+t.node_6.height:t.node_9.active?-t.node_9.y+t.node_9.height:-t.node_5.y+t.node_5.height,e.height=a,e.layout()}},showEquip:function(){var e=this,t=e.skin;e.equipIcon||(e.equipIcon=game.GridUtil.createPetEquipIcon(),e.equipIcon.canClick=!1,e.equipIcon.showTag=!1,e.equipIcon.addToParent(t.itemNode_1)),e.equipIcon.setData(e.equipInfo,null,!1);var a=e.equipInfo.cfg;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name,!0),t.fightLab.string=game.Lang.get(51475,e.equipInfo.totalFight),t.qualityLab.string=game.Lang.get(51476,game.CCommonUtil.getQualityStr(a.quality)),t.lvLab.string=game.Lang.get(51482,a.level),t.attrLab.string=game.SpriteStatUtil.getSpriteStatDesc(e.equipInfo.baseSpriteStat,game.Color.BLACK,game.Color.BLACK,"<br/>",":","      ",2),t.showBtn.active=!e.isBack},showStreng:function(){var e=this.skin;e.node_2.y=-e.node_1.height;var t=game.ResCfg.getUrl(10092);e.attrbg_2.loadTexture(t),t=game.ResCfg.getUrl(10093,2),e.title_2.loadTexture(t);var a=this.getForeMaxLv(game.EquipForgeType.INTENSIFY),i=game.Lang.get(51483,this.equipInfo.intensifylv,a)+"\n",n=this.getShowAttrDesc(game.EquipForgeType.INTENSIFY,game.ForgeUpgradeCfg,this.equipInfo.id,this.equipInfo.intensifylv);e.attrLab_2.string=i+n},showTemper:function(){var e=this.skin;e.node_3.y=e.node_2.y-e.node_2.height;var t=game.ResCfg.getUrl(10092);e.attrbg_3.loadTexture(t),t=game.ResCfg.getUrl(10093,3),e.title_3.loadTexture(t);var a=this.getForeMaxLv(game.EquipForgeType.REFINE),i=game.Lang.get(51484,this.equipInfo.refinelv,a)+"\n",n=this.getShowAttrDesc(game.EquipForgeType.REFINE,game.ForgeRefineCfg,this.equipInfo.id,this.equipInfo.refinelv);e.attrLab_3.string=i+n},showMosaic:function(){var e=this.skin;e.node_4.y=e.node_3.y-e.node_3.height;var t=game.ResCfg.getUrl(10092);e.attrbg_4.loadTexture(t),t=game.ResCfg.getUrl(10093,4),e.title_4.loadTexture(t);for(var a=game.equipForgeData.getConfigEquipType3(this.equipInfo.cfg.pos),i=void 0,n=void 0,s=0,r="",o=this.equipInfo.gemMap,g=this.getForeMaxLv(game.EquipForgeType.GEM),u=1;u<=3;u++)o&&(n=o.get(u))&&(s=n.gemlv||0),i=game.ForgeGemCfg.getData(a,u,s),r+=game.ItemInfoCfg.getData(i.itemId).name+":"+s+"/"+g,this.getMosaicShowAttrDesc(a,u,s),u<3&&(r+="\n","\n");e.gemLvLab.string=r,e.attrLab_4.string=this.getAllMosicAttrDesc(a,3,o)},showSoul:function(){var e=this.skin;e.node_5.y=e.node_4.y-e.node_4.height;var t=game.ResCfg.getUrl(10092);e.attrbg_5.loadTexture(t),t=game.ResCfg.getUrl(10093,5),e.title_5.loadTexture(t);var a=this.getForeMaxLv(game.EquipForgeType.PURIFY),i=game.Lang.get(51486,this.equipInfo.purifylv,a)+"\n",n=this.getShowAttrDesc(game.EquipForgeType.PURIFY,game.ForgePurifyCfg,this.equipInfo.id,this.equipInfo.purifylv);e.attrLab_5.string=i+n},showZhuling:function(){var e=this.skin;if(e.node_8.y=e.node_5.y-e.node_5.height,this.equipInfo.quality<game.Quality.Q_UNPARALLELED)e.node_8.active=!1;else{e.node_8.active=!0;var t=game.ResCfg.getUrl(10092);e.attrbg_8.loadTexture(t),t=game.ResCfg.getUrl(10093,11),e.title_8.loadTexture(t);var a=this.getForeMaxLv(game.EquipForgeType.ZHULING),i=game.Lang.get(52250,this.equipInfo.zhulingLv,a)+"\n",n=this.getShowZhulingAttrDesc(this.equipInfo.id,this.equipInfo.zhulingLv,this.equipInfo.zhulingExp);e.attrLab_8.string=i+n}},showFuse:function(){var e=this.skin;if(this.equipInfo.quality<game.Quality.Q_UNPARALLELED)e.node_9.active=!1;else{e.node_9.active=!0,e.node_9.y=e.node_8.y-(e.node_8.active?e.node_8.height:0);var t=game.ResCfg.getUrl(10092);e.attrbg_9.loadTexture(t),t=game.ResCfg.getUrl(10093,12),e.title_9.loadTexture(t);var a=this.getForeMaxLv(game.EquipForgeType.FUSE),i=game.Lang.get(52341,this.equipInfo.fuseLv,a)+"\n",n=this.getFuseAttrDesc(this.equipInfo.id,this.equipInfo.fuseLv);e.attrLab_9.string=i+n}},showSuit:function(){var e=this,t=e.skin,a=game.ResCfg.getUrl(10092);t.attrbg_6.loadTexture(a),a=game.ResCfg.getUrl(10093,6),t.title_6.loadTexture(a);var i=e.equipInfo.cfg;if(0==i.suit||e.isBack)return t.node_6.active=!1,void(t.node_9.active?t.line_9.active=!1:t.line_5.active=!1);e.suitList||(e.suitList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.suitList.itemRender=game.EquipSuitItem,e.suitList.bindEnum=game.ME.EquipDetails,e.suitList.layout.paddingLeft=-5,e.suitList.addToParent(t.itemList)),e.suitList.setData(e.equipInfo.getSuitInfos()),t.node_6.active=!0,t.node_9.active?(t.node_6.y=t.node_9.y-t.node_9.height,t.line_9.active=!0):t.node_6.y=t.node_5.y-t.node_5.height,t.line_5.active=!0;for(var n="",s=game.PartnerSuitCfg.getData(i.suit,2),r=game.partnerEquipData.getWearSuitNum(s.suits),o=game.PartnerEquipType,g=2;g<=4;g++){var u=game.PartnerSuitCfg.getData(i.suit,g);if(u){var l=g<=r?game.Color.RED:game.Color.BLACK;if(e.equipInfo.type==o.Treasure){n+=game.Lang.get(53427,game.HtmlUtil.getText(l,u.attrDesc));var c=game.SkillCfg.getData(s.skillId);if(!c)continue;t.skillLab_6.string=game.Lang.get(53428,game.HtmlUtil.getText(l,game.LangSkill.get(c.desc,c.descParam)))}else n+=game.Lang.get(51487,g,game.HtmlUtil.getText(l,u.attrDesc))+"\n",t.skillLab_6.string="";t.attrLab_6.string=n}}e.equipInfo.type==o.Treasure?(t.skillLab_6.y=t.attrLab_6.y+-t.attrLab_6.height,t.node_6.height=-t.skillLab_6.y+t.skillLab_6.height):t.node_6.height=-t.attrLab_6.y+t.attrLab_6.height},showAccessLab:function(){var e=this,t=e.equipInfo.cfg,a=e.skin;if(a.node_7.active=e.isBack,e.isBack){if(e.clearAccessLab(),!t||!t.skipName||t.skipName.length<1)return e.isShowAccess=!1,a.node_7.active=!1,a.node_7.height=0,void(a.node_9.active?a.line_9.active=!1:a.node_8.active?a.line_8.active=!1:a.line_5.active=!1);var i=t.skipName;a.node_7.height=100,a.node_7.active=!0,a.node_9.active?(a.node_7.y=a.node_9.y-a.node_9.height,a.line_9.active=!0,a.line_8.active=!0):a.node_8.active?(a.node_7.y=a.node_8.y-a.node_8.height,a.line_8.active=!0):a.node_7.y=a.node_5.y-a.node_5.height,a.line_5.active=!0,e.isShowAccess=!0,e.labPool||(e.labPool=[]),e.showLabList||(e.showLabList=[]);for(var n=void 0,s=void 0,r=i.length,o=a.skipList.width/(r+1),g=0;g<r;g++)s=game.HtmlUtil.getulText(i[g]),(n=e.labPool[g])||((n=e.labPool[g]=b8e.RichText.get()).setAnchor(.5,.5),n.setColor(game.Color.GREEN),b8e.evt.onC(n,e.onTouchAccess,e)),n.parent||n.addToParent(a.skipList),e.showLabList.push(n),n.x=o*(g+1),n.setText(s)}},onTouchAccess:function(e){if(e&&e.target){if(this.equipInfo&&this.data){var t=this.equipInfo.cfg,a=this.data.showViewME;if(!(!this.labPool||this.labPool.length<1||!t||!t.skipName||t.skipName.length<1)){var i=this.labPool.indexOf(e.target);if(!(i<0)){var n=t.skipId;if(n&&!(n.length<i)){var s=n[i];if(!s){var r=t.skipShopId;if(!r&&r.length<0)return void b8e.error("\u6ca1\u6709\u914d\u7f6e\u5546\u5e97id");var o=r[i];return this.dptG(game.ShopGEvts.SHOW_SHOP,o),void game.module.hide(a)}var g=t.toggle;if(!g||g.length<1)game.module.show(s);else{var u=g[i];u&&-1!=u?game.module.showToggle(s,u):game.module.show(s)}game.module.hide(a)}}}}}},clearAccessLab:function(){if(this.showLabList&&!(this.showLabList.length<1)){for(var e=this.showLabList.length,t=0;t<e;t++)this.showLabList[t].removeFromParent();this.showLabList.length=0}},getShowAttrDesc:function(e,t,a,i){for(var n=0==i?1:i,s=t.getShowAttr(e,a,n),r=t.getShowAttrPercent(e,a,n),o=r.length,g=0;g<o;g++)s.push(r[g]);return this.getAttrDesc(s,i)},getShowZhulingAttrDesc:function(e,t,a){var i=void 0,n=0==t&&0==a,s="";if(!(i=n?game.ForgeZhulingCfg.getShowAttr(e,t+1,0):game.ForgeZhulingCfg.getShowAttr(e,t,a))||i.length<=0)return s;for(var r=void 0,o=0;o<i.length;o++)if((r=i[o]).type){var g=game.AttrRulesCfg.getData(r.type);if(!g)continue;s+=game.Lang.get(51580,g.name,n?0:r.value)+(o==i.length-1?"":"\n")}return s},getFuseAttrDesc:function(e,t){var a=0==t?1:t,i=game.ForgeFuseCfg.getShowAttr(e,a);return this.getAttrDesc(i,t)},getAllMosicAttrDesc:function(e,t,a){for(var i=b8e.HashMap.get(),n=b8e.HashMap.get(),s=void 0,r=void 0,o=0,g=[],u=1;u<=t;u++)a&&(r=a.get(u))&&(o=r.gemlv||0),s=this.getMosaicShowAttrDesc(e,u,o),g.push.apply(g,s);for(var l=g.length,c=void 0,h=void 0,m=void 0,d=0;d<l;d++)(h=(m=(c=g[d]).isPer?n:i).get(c.type))?h.value+=c.value:m.set(c.type,c);var f=this.getAttrDesc(i.values()),p=this.getAttrDesc(n.values());return""!=f&&""!=p&&(f+="\n"),f+=p},getMosaicShowAttrDesc:function(e,t,a){var i=0==a?1:a,n=game.ForgeGemCfg,s=n.getShowAttr(e,t,i),r=n.getShowAttrPercent(e,t,i);if(0==a){for(var o=s.length,g=0;g<o;g++)s[g].value=0;for(var u=r.length,l=0;l<u;l++)r[l].value=0}return s.push.apply(s,r),s},getAttrDesc:function(e,t){for(var a="",i=e.length,n=game.AttrRulesCfg,s=void 0,r=void 0,o=void 0,g=0;g<i;g++)s=e[g],r=0==t?0:s.value,o=n.getData(s.type),a+=game.Lang.get(51580,o.name,r+(s.isPer?"%":"")),g<i-1&&(a+="\n");return a},getForeMaxLv:function(e){var t=this.equipInfo.type==game.Treasure,a=game.EquipForgeType,i=void 0;switch(e){case a.INTENSIFY:i=game.equipIntensifyData;break;case a.REFINE:i=game.equipRefineData;break;case a.PURIFY:i=game.equipPurifyData;break;case a.GEM:i=game.equipGemData;break;case a.ZHULING:i=game.equipZhulingData;break;case a.FUSE:i=game.equipFuseData}return t?i.maxLv:i.treasureMaxLv},showBtn:function(){this.send(game.PartnerEquipEvts.V_SHOW_EQUIP)}}),b8e.RC("$$game","$$EquipDetailsView",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1338),this.setSize(542,128)},init:function(){this.icon=game.GridUtil.createPetEquipIcon(),this.icon.showTag=!1,this.icon.canClick=!1,this.icon.addToParent(this.getComponent("iconNode"))},setData:function(e){var t=this.skin;this.icon.setData(e,null,!1);var a=e.cfg;this.data=e;var i=a.quality,n=game.HtmlUtil;if(t.nameLab.string=n.getColorStrByQuality(i,a.name,!0),e.type==game.PartnerEquipType.Exclusive?(t.strengLab.string=n.getText(game.Color.BLACK,game.Lang.get(51476,game.CCommonUtil.getQualityStr(a.quality))),t.temperLab.string=n.getText(game.Color.BLACK,game.Lang.get(51488,e.breakLv))):(t.strengLab.string=game.Lang.get(51463,e.intensifylv),t.temperLab.string=game.Lang.get(51464,e.refinelv)),t.targetLab.active=e.isWear,t.wearBtn.active=!e.isWear,e.isWear){var s=game.PartnerCfg.getData(e.wearTarget);if(!s)return;t.targetLab.string=game.Lang.get(51465,s.name)}},wearBtn:function(){var e=game.PartnerEquipType;if(this.data.type==e.Exclusive)this.send(game.PartnerEquipEvts.C2V_WEAR_EQUIP,e.Exclusive,this.data.idx);else{var t=[];t.push(this.data.idx),this.send(game.PartnerEquipEvts.C2V_WEAR_EQUIP,e.General,t)}}}),b8e.RC("$$game","$$PartnerEquipWearItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1332),this.setSize(100,120)},init:function(){this.icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this.icon.addToParent(this.skin.icon)},setData:function(e){var t=game.ItemInfoCfg.getData(e.id);this.icon.setItemInfo(e,!1,game.IconLayoutEnum.SHOW_NAME),this.icon.setRichName(t.name,t.quality)},clickBtn:function(){}}),b8e.RC("$$game","$$EquipSuitItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1340),this.spotAlerts={PARTNER_CUR_EQUIP_BREAK:this.breakAlert},this.toggles={toggle_btn_1:game.ME.PartnerExcEquipInfo,toggle_btn_2:game.ME.PartnerExcEquipBreak}},breakAlert:function(e){this.skin.red_spot_2.active=e.alert},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},onShow:function(){this.toggleSelect(0)}});b8e.module.registerView(game.ME.PartnerExcEquipDetails,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1339)},init:function(){this.skin.banner.loadTexture(game.ResCfg.getUrl(10094)),this.icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this.icon.setClickCb(this.clickCb),this.icon.addToParent(this.skin.iconNode),this.nextBreakSpriteStat=game.SpriteStat.get(),this.initCost()},clickCb:function(){},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_BREAK:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){this.updateItemInfo(),this.updateAttr()},updateItemInfo:function(){var e=this.skin,t=game.partnerEquipData.selInfo;if(t){this.icon.setItemInfo(t,!1,game.IconLayoutEnum.SHOW_NONE),e.itemNameLab.string=game.Lang.get(51466,t.cfg.name,t.breakLv);var a=game.PartnerCfg.getData(t.wearTarget);a&&(e.targrtLab.string=game.Lang.get(51465,a.name),t.canBreak&&this.updateCostNum())}},updateAttr:function(){var e=this.skin,t=game.partnerEquipData.selInfo;if(t){var a=game.PartnerProperTopCfg.getData(t.id,t.breakLv),i=game.SpriteStatType,n=game.AttrRulesCfg;this.attrStr(e.now_attr1,n.getData(i.Health),a.hp),this.attrStr(e.now_attr2,n.getData(i.Attack),a.atk),this.attrStr(e.now_attr3,n.getData(i.Defense),a.def);var s=void 0;if(t.isBreakMax)s=game.AttrRulesCfg.getData(a.clientAttrId),e.descLab.string=game.Lang.get(51468,s.name,a.attrValue),e.arrow.active=e.infoBg2.active=e.costNode.active=e.breakLvBtn.active=!1,e.maxLv.active=!0,e.infoBg1.x=0;else{var r=game.PartnerProperTopCfg.getData(t.id,t.breakLv+1);this.attrStr(e.next_attr1,n.getData(i.Health),r.hp),this.attrStr(e.next_attr2,n.getData(i.Attack),r.atk),this.attrStr(e.next_attr3,n.getData(i.Defense),r.def),s=game.AttrRulesCfg.getData(r.clientAttrId),e.descLab.string=game.Lang.get(51467,t.breakLv+1,s.name,r.attrValue),e.arrow.active=e.infoBg2.active=e.costNode.active=e.breakLvBtn.active=!0,e.maxLv.active=!1,e.infoBg1.x=-145}}},attrStr:function(e,t,a){e.string=game.Lang.get(7215,t.name,a)},initCost:function(){var e=this.skin;this.costItem1=game.GridUtil.createCostItemIcon(),this.costItem1.addToParent(e.itemNode_1),this.costItem2=game.GridUtil.createCostItemIcon(),this.costItem2.addToParent(e.itemNode_2),this.updateCostNum()},updateCostNum:function(){var e=this.skin,t=game.partnerEquipData.selInfo;if(t&&!t.isBreakMax){var a=game.PartnerProperTopCfg.getData(t.id,t.breakLv);if(a){var i=a.costItems,n=(i.length,i[0]);this.costItem1.setItemInfo(n.Id);var s=game.itemData.getCountById(n.Id),r=n.Num,o=r<=s;e.itemNum_1.color=o?game.Color.GREEN:game.Color.RED,e.itemNum_1.string=game.Lang.get(1621,s,r),e.itemNode_2.active=e.itemNum_2.active=!1,0<a.costNum&&(e.itemNode_2.active=e.itemNum_2.active=!0,this.costItem2.setItemInfo(a.id),s=game.partnerEquipData.getCostExcEquipNum(t.id),o=(r=a.costNum)<=s,e.itemNum_2.color=o?game.Color.GREEN:game.Color.RED,e.itemNum_2.string=game.Lang.get(1621,s,r)),e.red_spot_1.active=t.canBreak()}}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerExcEquipBreak,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1341)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.ExcEquipDetailsView,this._list.bindEnum=game.ME.PartnerEquipChange,this._list.layout.paddingTop=-10,this._list.addToParent(this.skin.detailsList)},notify:function(e){switch(e){case this.Evts.V_UPDATE_SHARE_TIME:this.addDetailsView()}},onShow:function(){this._list.scrollToTop(),this.addDetailsView()},addDetailsView:function(){var e=[],t=game.partnerEquipData,a=t.getShowInfo();a.updateInfos(t.selInfo),a.setShowME(this.moduleEnum),game.tipsData.setBack(!1),e.push(a),this._list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerExcEquipInfo,e)}(),function(){var e;e=game.ListItem.extends({totalMinHeight:635,nextShareTime:0,ctor:function(){this._super(1333)},setData:function(e){var t=this;t.equipInfo=e.info,t.updateView();var a=e.nextShareTime-game.SysTime.curTime;t.nextShareTime=e.nextShareTime,0<a?(t.countDownTimer||(t.countDownTimer=b8e.Timer.add(t,t.updateCountDown,1e3)),game.ShaderUtil.setGray(t.skin.showBtn,!0),t.skin.btn_lbl_3.string=game.Lang.get(9501,Math.floor(a/1e3))):t.skin.btn_lbl_3.string=game.Lang.get(51620)},updateCountDown:function(){var e=this.nextShareTime-game.SysTime.curTime;game.ShaderUtil.setGray(this.skin.showBtn,0<=e),this.skin.btn_lbl_3.string=game.Lang.get(9501,Math.floor(e/1e3)),e<0&&(b8e.Timer.remove(this,this.updateCountDown),this.countDownTimer=null,this.skin.btn_lbl_3.string=game.Lang.get(51620))},updateView:function(){var e=this.skin;if(this.equipInfo){this.showEquip(),this.showBase(),this.showFate(),this.showTalent(),this.showBreakTalent();var t=-e.node_5.y+e.node_5.height;this.height=t,this.layout()}},showEquip:function(){var e=this,t=e.skin;e.equipIcon||(e.equipIcon=game.GridUtil.createPetEquipIcon(),e.equipIcon.canClick=!1,e.equipIcon.showTag=!1,e.equipIcon.addToParent(t.itemNode_1)),e.equipIcon.setData(e.equipInfo,null,!1);var a=e.equipInfo.cfg;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name,!0),t.fightLab.string=game.Lang.get(51475,e.equipInfo.totalFight),t.qualityLab.string=game.Lang.get(51476,game.CCommonUtil.getQualityStr(a.quality)),t.btn_node.active=!game.tipsData.isBack,t.gotoBreakBtn.active=!game.tipsData.isBack},showBase:function(){var e=this.skin;e.node_2.y=-e.node_1.height;var t=game.ResCfg.getUrl(10092);e.attrbg_2.loadTexture(t),t=game.ResCfg.getUrl(10093,1),e.title_2.loadTexture(t);var a=game.Lang.get(51477,this.equipInfo.breakLv)+"\n",i=game.SpriteStatUtil.getSpriteStatDesc(this.equipInfo.baseSpriteStat,game.Color.BLACK,game.Color.BLACK,"<br/>",":","       ",2);e.attrLab_2.string=a+i},showFate:function(){var e=this.skin;e.node_3.y=e.node_2.y-e.node_2.height;var t=game.ResCfg.getUrl(10092);e.attrbg_3.loadTexture(t),t=game.ResCfg.getUrl(10093,7),e.title_3.loadTexture(t);var a=this.equipInfo.cfg,i=a.partnerId;if(0==i)return e.node_3.active=!1,void(e.node_3.height=0);e.node_3.active=!0,e.node_3.height=120;var n=game.PartnerCfg.getData(i),s=this.getShowPartnerInfo(i);if(n){this.fateIcon||(this.fateIcon=new game.CultivateBaseIcon,this.fateIcon.addToParent(e.itemNode_3)),this.fateIcon.setData(s),this.fateIcon.removeElement();var r="",o=game.HtmlUtil;r+=o.getText(game.Color.BLACK,n.name)+"\n",r+=o.getText(game.Color.GREEN,game.Lang.get(51478,a.name))+"\n";var g=game.AttrRulesCfg.getData(a.attrId);r+=o.getText(game.Color.BLACK,game.Lang.get(51479,g.name,a.clientAttrPre/1e3)),e.attrLab_3.string=r}},showTalent:function(){var e=this,t=e.skin;t.node_4.y=t.node_3.y-t.node_3.height;var a=game.ResCfg.getUrl(10092);t.attrbg_4.loadTexture(a),a=game.ResCfg.getUrl(10093,8),t.title_4.loadTexture(a);var i=e.equipInfo.cfg.partnerId,n=game.PartnerProperTopCfg.getData(e.equipInfo.id,e.equipInfo.breakLv);if(n){if(0==i||n.skillLvs.length<1)return t.node_4.active=!1,void(t.node_4.height=0);t.node_4.active=!0,t.node_4.height=148,e.talentIcon||(e.talentIcon=new game.CultivateBaseIcon,e.talentIcon.addToParent(t.itemNode_4));var s=e.getShowPartnerInfo(i);e.talentIcon.setData(s),e.talentIcon.removeElement();var r="",o=game.HtmlUtil,g=game.PartnerCfg.getData(i);if(g){r+=o.getText(game.Color.BLACK,g.name)+"\n";var u=n.skillLvs,l=e.equipInfo.breakLv,c=e.equipInfo.wearTarget==i&&l>=u[0],h=game.Color,m=c?h.GREEN:h.RED,d=c?game.Lang.get(51473):game.Lang.get(51474);r+=o.getText(m,d),t.attrLab_4.string=r,t.descLab.string=e.getTalentDesc(l,u)}}},getShowPartnerInfo:function(e){this._showPartnerInfo||(this._showPartnerInfo=new game.PartnerInfo),this._showPartnerInfo.clearInfo();var t=game.PartnerCfg.getData(e);return this._showPartnerInfo.setCfgData(t),this._showPartnerInfo.id=e,this._showPartnerInfo.setShowActive(),this._showPartnerInfo},getTalentDesc:function(e,t){for(var a=t.length,i=0,n=void 0,s=0;s<a;s++)if(e<t[s]){i=t[s],n=s;break}if(0==i)return"";var r=game.Lang.get(51469+n);return game.Lang.get(51472,i,r)},showBreakTalent:function(){var e=this.skin;e.node_5.y=e.node_4.y-e.node_4.height;var t=game.ResCfg.getUrl(10092);e.attrbg_5.loadTexture(t),t=game.ResCfg.getUrl(10093,9),e.title_5.loadTexture(t);for(var a=game.partnerEquipData.excBreakMaxLv,i=void 0,n=void 0,s="",r=1;r<=a;r++){i=game.PartnerProperTopCfg.getData(this.equipInfo.id,r),n=game.AttrRulesCfg.getData(i.clientAttrId);var o=game.Lang.get(51480,r,n.name,i.attrValue),g=i.skillLvs.indexOf(i.level);-1<g&&(o+=game.Lang.get(51481,game.Lang.get(51469+g)));var u=game.Color,l=this.equipInfo.breakLv>=i.level?u.RED:u.BLACK;s+=game.HtmlUtil.getText(l,o)+"\n"}e.attrLab_5.string=s,e.node_5.height=e.attrLab_5.height},changeBtn:function(){this.send(game.PartnerEquipEvts.V_CHANGE_EQUIP)},excRemoveBtn:function(){this.send(game.PartnerEquipEvts.V_EXC_REMOVE_EQUIP)},showBtn:function(){this.send(game.PartnerEquipEvts.V_SHOW_EQUIP)},parInfoBtn:function(){this.send(game.PartnerEquipEvts.V_SHOW_PARTNER_INFO)},gotoBreakBtn:function(){this.send(game.PartnerEquipEvts.V_GOTO_BREAK)},talentInfoBtn:function(){this.send(game.PartnerEquipEvts.V_SHOW_TALENT)}}),b8e.RC("$$game","$$ExcEquipDetailsView",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1342)},onShow:function(){this.updateView()},updateView:function(){var e=game.partnerEquipData.getShowInfo();if(e&&e.info){var t=e.info,a=game.PartnerProperTopCfg.getData(t.id,t.breakLv);if(a){for(var i=a.skillLvs,n=i.length,s=void 0,r=void 0,o=void 0,g=void 0,u=0;u<3;u++)if(g=u+1,r=this.getComponent("talentNode_"+g),u<n){r.active=!0;var l=i[u],c=t.breakLv>=l,h=game.Lang.get(53560+u);h+=c?game.Lang.get(53558):game.Lang.get(53559,l),this.getComponent("name_"+g).string=h,s=game.PartnerProperTopCfg.getData(t.id,l),(o=game.SkillCfg.getData(s.skills[u]))&&(this.getComponent("talent_"+g).string=game.LangSkill.get(o.desc,o.descParam))}else r.active=!1;var m=game.PartnerCfg.getData(t.cfg.partnerId);if(m){var d=m.angerSkills,f=d.length;if(!(f<1)){var p=d[f-1];(o=game.SkillCfg.getData(p))&&(this.skin.skillDescLab.string=game.LangSkill.get(o.desc,o.descParam))}}}}}});b8e.module.registerView(game.ME.PartnerTalentInfo,e)}(),function(){var e;e=game.ItemIcon.extends({equipBg:null,openLvLab:null,nameBg:null,nameLab:null,strengLvBg:null,strengLvLab:null,temperLvLab:null,tagImg:null,isShowStreng:!0,canClick:!0,showTag:!0,ctor:function(e){var t=0<arguments.length&&void 0!==e?e:game.IconSizeEnum.GRID_SIZE_105;this._super(t)},setData:function(e,t,a,i){var n=1<arguments.length&&void 0!==t?t:0,s=!(2<arguments.length&&void 0!==a)||a,r=!(3<arguments.length&&void 0!==i)||i,o=this,g=void 0,u=game.PartnerEquipType;o.clearData(),e?(g=e.type,o.removeIconBg(),o.setItemActive(!0),o.setNameBg(s),o.setItemInfo(e),g!=u.Exclusive?(o.setStreng(e.intensifylv),o.setTemper(e.refinelv)):o.setTemper(e.breakLv),o.setNameActive(s),s&&o.setLabNamePos(0,0)):(o.setEquipBg(n),o.setItemActive(!1),o.setNameActive(!1),r||o.setOpenLvLab(),g=game.partnerEquipData.getTypeByPos(n)),g!=u.General&&o.showTag&&o.setTagImg(g),o.pos=e?e.cfg.pos:n},setEquipIcon:function(e){var t=e.quality,a=game.ResCfg.getQualityBg(t);this.setBgImage(a);var i=e.icon,n=game.ResCfg.getUrl(137,i);this.setIcon(n)},setEquipBg:function(e){var t=game.ResCfg.getUrl(10001,e);this.equipBg||(this.equipBg=b8e.Sprite.get(),this.equipBg.setAnchor(.5,.5),this.equipBg.setSize(100,105),this.equipBg.setPosition(0,0),this.addChild(this.equipBg)),this.equipBg.loadTexture(t)},removeIconBg:function(){this.equipBg&&this.equipBg.parent&&this.equipBg.unloadTexture()},setItemActive:function(e){this.strengLvBg&&(this.strengLvBg.setVisible(e),this.strengLvLab.setVisible(e)),this.temperLvLab&&this.temperLvLab.setVisible(e)},setNameActive:function(e){e||this.setName(""),this.nameBg&&this.nameBg.setVisible(e),this.nameLab&&this.nameLab.setVisible(e)},setNameBg:function(e){var t=this;!t.nameBg&&e&&(t.nameBg=b8e.Sprite.get(),t.nameBg.setStyle(b8e.SpriteStyle.SLICED),t.nameBg.scale9Inset={top:18,bottom:18,left:18,right:18},t.nameBg.setAnchor(.5,.5),t.nameBg.setSize(98,25),t.nameBg.loadTexture(game.ResCfg.getUrl(71,"skillNameBg")),t.addChild(t.nameBg),t.nameBg.setPosition(0,-68))},setStreng:function(e){var t=this;t.strengLvBg||(t.strengLvBg=b8e.Sprite.get(),t.strengLvBg.setStyle(b8e.SpriteStyle.SLICED),t.strengLvBg.scale9Inset={top:18,bottom:18,left:18,right:18},t.strengLvBg.setAnchor(.5,.5),t.strengLvBg.setSize(50,18),t.strengLvBg.loadTexture(game.ResCfg.getUrl(71,"skillNameBg")),t.addChild(t.strengLvBg),t.strengLvBg.setPosition(-15,-27)),t.strengLvLab||(t.strengLvLab=b8e.Label.get(),t.strengLvLab.setAnchor(.5,.5),t.strengLvLab.setFontSize(18),t.addChild(t.strengLvLab),t.strengLvLab.setPosition(-16,-28));var a="Lv."+e;t.strengLvLab.setText(a)},setOpenLvLab:function(){this.openLvLab||(this.openLvLab=b8e.Label.get(),this.openLvLab.setAnchor(.5,.5),this.openLvLab.setFontSize(20),this.openLvLab.setColor(game.Color.BLACK),this.addChild(this.openLvLab),this.openLvLab.setPosition(0,-25)),this.openLvLab.setText(game.Lang.get(51534,game.partnerEquipData.exclusiveOpenLv))},setTemper:function(e){this.temperLvLab||(this.temperLvLab=b8e.Label.get(),this.temperLvLab.setAnchor(1,.5),this.temperLvLab.setFontSize(18),this.addChild(this.temperLvLab),this.temperLvLab.setPosition(35,35));var t="+"+e;this.temperLvLab.setText(t)},setTagImg:function(e){this.tagImg||(this.tagImg=b8e.Sprite.get(),this.tagImg.setAnchor(.5,.5),this.tagImg.setSize(33,54),this.tagImg.setPosition(-39,27),this.addChild(this.tagImg));var t=game.ResCfg.getUrl(10081,e);this.tagImg.loadTexture(t)},clearData:function(){this._super(),this.tagImg&&(this.tagImg.unloadTexture(),this.tagImg=null),this.openLvLab&&this.openLvLab.setText("")},setClickCallBack:function(e,t){this.clickCallBack={callBack:e,thisArg:t}},fnOnClickGrid:function(){this.canClick&&this.clickCallBack.callBack.call(this.clickCallBack.thisArg,this.pos)}}),b8e.RC("$$game","$$PartnerEquipIcon",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this.skillInfos=[]},setSkillInfos:function(e,t,a){if(e&&!(e.length<1)){e.sort(this.sortFunc);var i=this.skillInfos,n=e.length;i.length=n;for(var s=0;s<n;s++)i[s]||(i[s]=new game.CommonSkillTipsInfo),i[s].setData(e[s],t,a)}},sortFunc:function(e,t){return e.lv-t.lv},getSkillInfos:function(){return this.skillInfos}});game.commonSkillTipsData=game.commonSkillTipsData||new e}(),function(){var e;e=b8e.Object.extends({setData:function(e,t,a){this.lv=e.lv,this.isCurLv=a&&e.lv==t,this.skillCfg=game.SkillCfg.getData(e.skill)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$CommonSkillTipsInfo",e)}(),function(){var e=b8e.Object.extends({curChallengeId:0,selectId:0,payCount:0,lastCount:0,ctor:function(){this.shenQiBattleArr=[],this.shenQiBattleMap=b8e.HashMap.get(),this.taskMap=b8e.HashMap.get()},synDatas:function(e){this.initCfgData(),this.curChallengeId=e.sLId,this.selectInfoById(this.curChallengeId),this.awardArr=e.sLTaskAward;var t=e.sLask;this.initTaskParam(t);for(var a=this.shenQiBattleArr,i=a.length,n=0;n<i;n++)a[n].setNetData()},initCfgData:function(){var e=game.ShenQiSLCfg.getDatas();if(e&&!(e.length<1))for(var t=e.length,a=this.shenQiBattleArr,i=this.shenQiBattleMap,n=void 0,s=t-1;0<=s;s--)(n=new game.ShenQiBattleInfo).setCfg(e[s]),a.push(n),i.set(n.id,n)},initTaskParam:function(e){var t=e.length,a=this.taskMap;a.set(game.ShenQiTaskType.LEVEL,game.mainRoleData.lv);for(var i=void 0,n=0;n<t;n++)i=e[n],a.set(i.taskType,i.param);this.updatePayCount()},addTaskParamByType:function(e,t){var a=this.taskMap,i=a.get(e),n=void 0;switch(e){case game.ShenQiTaskType.LEVEL:n=game.mainRoleData.lv;break;default:n=i?i+t:t}a.set(e,n)},getTaskParamByType:function(e){return this.taskMap.get(e)},clearCurTask:function(){for(var e=this.getChallengeInfo().cfg.task,t=e.length,a=game.ShenQiTaskType.LEVEL,i=this.taskMap,n=void 0,s=0;s<t;s++)(n=e[s])!=a&&i.set(n,0);this.resetPayCount()},updateParam:function(e){this.getChallengeInfo().updateTaskInfo(e)},getPayCount:function(){return this.payCount},resetPayCount:function(){this.payCount=0},updatePayCount:function(e){var t=0<arguments.length&&void 0!==e&&e,a=game.amount.get(game.AmountType.YUAN_BAO);if(0==this.lastCount||t)this.lastCount=a;else{if(this.lastCount>a){var i=this.lastCount-a;this.payCount+=i}this.lastCount=a}},isGetAward:function(e){return-1<this.awardArr.indexOf(e)},getChallengeInfo:function(){return this.shenQiBattleMap.get(this.curChallengeId)},getCurInfo:function(){return this.shenQiBattleMap.get(this.selectId)},getInfoById:function(e){return this.shenQiBattleMap.get(e)},selectInfoById:function(e){var t=this.getInfoById(this.selectId),a=this.getInfoById(e);t&&(t.select=!1),a.select=!0,this.selectId=e},getInfos:function(){return this.shenQiBattleArr}});game.shenQiBattleData=game.shenQiBattleData||new e}(),function(){var e;e=b8e.Object.extends({isAlert:!1,select:!1,ctor:function(){this._super(),this.taskMap=b8e.HashMap.get(),this.activeSpriteStat=game.SpriteStat.get(),this.jinJieCurSpr=game.SpriteStat.get(),this.jinJieNextSpr=game.SpriteStat.get(),this.jingLianSpr=game.SpriteStat.get(),this.prizeList=[]},setCfg:function(e){this.id=e.id,this.cfg=e,this.setAwardList()},setAwardList:function(){for(var e=this.cfg.awards,t=void 0,a=void 0,i=e.length,n=this.prizeList,s=0;s<i;s++)t=e[s],(a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,n.push(a)},getAwardList:function(){return this.prizeList},setNetData:function(){var e=this.id,t=game.shenQiBattleData.curChallengeId;t<=e&&(this.initTaskInfos(),e==t&&this.updateTaskInfos())},initTaskInfos:function(){for(var e=this.cfg.task,t=e.length,a=void 0,i=void 0,n=void 0,s=this.taskMap,r=0;r<t;r++)a=e[r],(i=game.ShenQiSLTaskCfg.getData(a))&&((n=new game.ShenQiTaskInfo).setCfg(i),s.set(n.type,n))},updateTaskInfos:function(){for(var e=this.getTaskInfos(),t=e.length,a=void 0,i=0;i<t;i++)(a=e[i]).updateParam(),a.updateParam();this.updateAlert()},updateTaskInfo:function(e){this.taskMap.get(e).updateParam(),this.updateAlert()},updateAlert:function(){for(var e=this.getTaskInfos(),t=e.length,a=void 0,i=!1,n=!0,s=0;s<t;s++)(a=e[s]).canGet&&(i=!0),a.isGet||(n=!1);this.canBattle=n,this.isAlert=i||n},getTaskInfos:function(){return this.taskMap.values()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShenQiBattleInfo",e)}(),function(){var e;e=game.CultivateBaseInfo.extends({lv:0,jinJieExp:0,lvUpPower:0,jinJiePower:0,jingLianPower:0,starPower:0,blessPower:0,power:0,isJJFullLv:!1,active:!1,select:!1,isAlert:!1,activeAlert:!1,jinJieAlert:!1,jingLianAlert:!1,battleAlert:!1,costAlert:!1,isBattle:!1,isShowName:!0,isShowLv:!0,isShowBattle:!0,normalUrl:164,grayUrl:165,battleSlot:0,quality:0,star:0,slotLevel:null,nextJie:0,isMaxStar:!1,starAlert:!1,ctor:function(){var e=this;e._super(),e.activeSpriteStat=game.SpriteStat.get(),e.jinJieCurSpr=game.SpriteStat.get(),e.jinJieNextSpr=game.SpriteStat.get(),e.jingLianSpr=game.SpriteStat.get(),e.allSpr=game.SpriteStat.get(),e.tempJLAddSpr=game.SpriteStat.get(),e.slotLevel=b8e.HashMap.get(),e.blessSpr1=game.SpriteStat.get(),e.blessSpr2=game.SpriteStat.get(),e.blessSpr3=game.SpriteStat.get(),e.blessSpr4=game.SpriteStat.get(),e.blessSpr=game.SpriteStat.get(),e.blessStarSpr=game.SpriteStat.get(),e.blessStarSpr2=game.SpriteStat.get()},getBattleOrWaitBattle:function(){return this.battleSlot},setCfgData:function(e){this.cfg=e,this.id=e.id,this.name=e.name,this.quality=e.quality,this.activeSpriteStat.setupByCfg(e),this.activePower=game.CCommonUtil.getPower(this.activeSpriteStat),this.setJinJieLv(0,0)},setData:function(e){this.bless=e.bless,this.onActive();var t=e.upgrade;this.setJinJieLv(t.lv,t.exp),this.setStarLv(e.star),this.updateJingLianSpr(e.jLAttr,!0)},setAttrBuyIndex:function(e,t){var a=void 0;switch(t){case 1:a=this.blessSpr1;break;case 2:a=this.blessSpr2;break;case 3:a=this.blessSpr3;break;case 4:a=this.blessSpr4}a&&(a.clear(),a.addByCfg(e))},setAllAttr:function(){var e=this;e.blessSpr.clear(),e.blessSpr.addSpriteStat(e.blessSpr1),e.blessSpr.addSpriteStat(e.blessSpr2),e.blessSpr.addSpriteStat(e.blessSpr3),e.blessSpr.addSpriteStat(e.blessSpr4),e.updateAllSpr(),e.updateBlessPower()},sort:function(e,t){return e.slot-t.slot},setBlessLevel:function(){this.bless||(this.bless=[]);var e=this.bless;e.sort(this.sort);for(var t=this.slotLevel,a=void 0,i=void 0,n=void 0,s=e.length,r=0;r<4;r++){i=null;for(var o=0;o<s;o++)e[o]&&e[o].slot==r+1&&(i=e[o]);a=new game.BlessSlotInfo,i||((i={}).slot=r+1,i.level=0),a.setData(i),t.set(a.slot,a),n=game.shenQiData.getCfgBySlot(a.slot,a.level),this.setAttrBuyIndex(n,a.slot)}this.setAllAttr()},setStarLv:function(e){this.star=e,this.isMaxStar=game.shenQiData.getMaxStarBol(e),this.updateStarSpr(),this.updateStarPower()},updateStarSpr:function(){var e=game.shenQiData.getCfgStar(this.id,this.star);this.blessStarSpr.clear(),this.blessStarSpr2.clear(),this.blessStarSpr.addByCfg(e),this.blessStarSpr2.addSpriteStat(this.blessStarSpr),this.updateAllSpr()},updateStarPower:function(){var e=this.starPower;this.starPower=game.CCommonUtil.getPower(this.blessStarSpr),this.updateAllPower(this.starPower-e)},updateBlessPower:function(){var e=this.blessPower;this.blessPower=game.CCommonUtil.getPower(this.blessSpr),this.updateAllPower(this.blessPower-e)},updataSlot:function(e){for(var t=e.length,a=void 0,i=this.slotLevel,n=0;n<t;n++)a=e[n],i.get(a.slot).setData(a)},getLevelBySlot:function(e){var t=this.slotLevel.get(e);if(t)return t.level||0},getBlessAllLevel:function(){var e=this.slotLevel.values();if(!e)return 0;for(var t=e.length,a=0,i=0;i<t;i++)a+=e[i].level;return a},getBlessJie:function(){var e=this.getBlessAllLevel(),t=game.shenQiData.getMasterCfg(this.id,!1);if(t){for(var a=t.length,i=void 0,n=0,s=0,r=this.nextJie=0;r<a;r++)e>=(i=t[r]).maxLv&&(n=i.masterLv),i.masterLv>s&&(s=i.masterLv);return this.nextJie=n+1,this.nextJie>s&&(this.nextJie=s),n}},onActive:function(){this.active=!0,this.setBlessLevel(),this.updateAllSpr(),this.updateAllPower(this.activePower),this.updateBattle()},setJinJieLv:function(e,t){this.lv=e,this.jinJieExp=t,this.isJJFullLv=game.shenQiData.isJinJieFullLv(e),this.updateJinJieSpr(),this.updateJinJiePower()},updateJinJieSpr:function(){var e=game.shenQiData.getObj(this.id,this.lv);if(this.jinjieCfg=game.ShenQiUpgradeCfg.getData(e),this._updateJinJieSpr(),!this.isJJFullLv){e=game.shenQiData.getObj(this.id,this.lv+1);var t=game.ShenQiUpgradeCfg.getData(e);t&&(this.jinJieNextSpr.setupByCfg(t),this.updateAllSpr())}},_updateJinJieSpr:function(){var e=this.jinjieCfg,t=this.jinJieExp,a=this.jinJieCurSpr,i=game.SpriteStatType,n=this.getTypeSpriteStatCount(e,t,i.TeamHp),s=this.getTypeSpriteStatCount(e,t,i.TeamAtk),r=this.getTypeSpriteStatCount(e,t,i.TeamDef);a.setStatValue(i.TeamHp,n),a.setStatValue(i.TeamAtk,s),a.setStatValue(i.TeamDef,r)},updateJingLianSpr:function(e,t){var a=1<arguments.length&&void 0!==t&&t;if(e&&!(e.length<1)){var i=this.jingLianSpr,n=this.tempJLAddSpr,s=0,r=e.length,o=void 0;if(!a){for(s=0;s<r;s++)o=e[s],n.setStatValue(o.id,o.value);n.addSpriteStat(i,-1)}for(s=0;s<r;s++)o=e[s],i.setStatValue(o.id,o.value);this.isJLFullLv=game.shenQiData.isJLFullLv(i,this.id),this.updateJingLianPower(),this.updateAllSpr()}},updateJinJiePower:function(){var e=this.jinJiePower;this.jinJiePower=game.CCommonUtil.getPower(this.jinJieCurSpr),this.updateAllPower(this.jinJiePower-e)},updateJingLianPower:function(){var e=this.jingLianPower;this.jingLianPower=game.CCommonUtil.getPower(this.jingLianSpr),this.updateAllPower(this.jingLianPower-e)},updateAllPower:function(e){this.power+=e},updateAllSpr:function(){var e=this;e.active&&(e.allSpr.clear(),e.allSpr.addSpriteStat(e.activeSpriteStat),e.allSpr.addSpriteStat(e.jinJieCurSpr),e.allSpr.addSpriteStat(e.jingLianSpr),e.allSpr.addSpriteStat(e.blessSpr),e.allSpr.addSpriteStat(e.blessStarSpr2))},getTeamPower:function(){return this.active?this.allSpr.getTeamPower():this.activeSpriteStat.getTeamPower()},updateCost:function(){var e=this.cfg;if(this.active)this.activeAlert=!1,this.updateJinJieCost(),this.updateJingLianCost(),this.updateStarCost(),this.updateBlessCost();else{var t=game.itemData.getNumById(e.itemId);this.activeAlert=t>=e.itemNum}this.updateAlert()},updateBlessCost:function(){var e=game.ShenQiBlessOpenCfg.getData(this.quality);if(this.lv<e.lv||this.star<e.star)this.blessAlert=!1;else{var t=this.slotLevel.values();if(t){for(var a=t.length,i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=0;g<a;g++)if((i=t[g])&&(n=game.shenQiData.getCfgBySlot(i.slot,i.level))&&(s=game.shenQiData.getMaxBlessBol(i.level,!1),r=n.itemId,o=game.itemData.getCountById(r)>=n.itemNum,!s&&o))return void(this.blessAlert=!0);this.blessAlert=!1}else this.blessAlert=!1}},updateStarCost:function(){var e=game.shenQiData.getCfgStar(this.id,this.star);if(this.isMaxStar)return this.starAlert=!1;var t=e.itemId,a=game.itemData.getNumById(t),i=e.itemNum;this.starAlert=i<=a},updateJinJieCost:function(){if(this.isJJFullLv)this.jinJieAlert=!1;else{var e=this.jinjieCfg.costItem[0],t=game.itemData.getNumById(e.Id);this.jinJieAlert=t>=e.Num}},updateJingLianCost:function(){if(this.isJLFullLv)this.jingLianAlert=!1;else{var e=game.shenQiData.getJLCostId(),t=game.itemData.getNumById(e),a=game.ShenQiJLCfg.getData(this.id,1,1);if(!a||!a.costItem||!a.costItem.length)return;this.jingLianAlert=t>=a.costItem[0].Num}},updateBattle:function(){var e=game.shenQiData.battleId;this.isBattle=this.id==e,this.battleSlot=this.isBattle?2:0,this.battleAlert=this.active&&!e,this.updateAlert()},updateAlert:function(){this.costAlert=this.activeAlert||this.jinJieAlert||this.jingLianAlert||this.starAlert||this.blessAlert,this.isAlert=this.costAlert||this.battleAlert},getShowStepOrLv:function(){return 2}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShenQiInfo",e)}(),function(){var e=game.CultivateBaseData.extends({battleId:0,jingLianType:1,toggleId:0,openType:0,countNum:0,isMaxLavel:!1,slotIndex:1,clickBol:!1,ctor:function(){this._super(game.ShenQiInfo),this.shenQiArr=[],this.masterAry=[],this.lockAry=[],this.jieAry=[],this.sendAry=[],this.shenQiMap=b8e.HashMap.get(),this.fiveObj=b8e.HashMap.get()},getInfoList:function(){return this.shenQiArr},getInfoMap:function(){return this.shenQiMap},getDataCfgs:function(){return game.ShenQiCfg.getDatas()},synDatas:function(e){var t=e.shenQi;t&&t.length&&(this.hasActive=!0),this.initMap(),this.setInfoList(t),this.setBattleId(e.battle),this.setLockList();var a=this.getInfoList();a&&0<a.length&&this.selectInfoById(a[0].id)},onActive:function(e){var t=this.getInfoById(e);t&&(t.onActive(),this.hasActive=!0)},setBattleId:function(e){this.battleId=e;for(var t=this.shenQiArr,a=t.length,i=0;i<a;i++)t[i].updateBattle()},onJinJie:function(e,t,a){var i=this.getInfoById(e);i&&i.setJinJieLv(t,a)},updateJingLian:function(e){var t=this.getInfoById(e.id);t&&t.updateJingLianSpr(e.jLAttr)},isJinJieFullLv:function(e){if(!this.jinJieMaxLv){var t=game.ShenQiMiscCfg.getData("jinJieMaxLv");t&&(this.jinJieMaxLv=0|t.value)}return e>=this.jinJieMaxLv},getMaxStarBol:function(e){if(!this.starMaxLv){var t=+game.CfgUtil.getMiscValue(game.ShenQiExpandMiscCfg,"starMaxLv");t&&(this.starMaxLv=0|t)}return e>=this.starMaxLv},getMaxBlessBol:function(e,t){if(!this.levelMaxLv){var a=+game.CfgUtil.getMiscValue(game.ShenQiExpandMiscCfg,"blessMaxLv");a&&(this.levelMaxLv=0|a)}return 2*game.mainRoleData.lv<=e&&!t||e>=this.levelMaxLv},getBlessItemId:function(){if(!this.blessItemId){var e=+game.CfgUtil.getMiscValue(game.ShenQiExpandMiscCfg,"blessItemId");e&&(this.blessItemId=0|e)}return this.blessItemId},getMaxBlessLevel:function(){return this.levelMaxLv},openSkillTips:function(){var e=this.getCurInfo();if(e){var t=game.ShenQiUpgradeCfg.getData(e.id,!0);!t||t.length<1||(game.commonSkillTipsData.setSkillInfos(t,e.lv,e.active),game.module.show(game.ME.CommonSkillTips))}},openStarSkillTips:function(){var e=this.getCurInfo();if(e){var t=game.ShenQiStarCfg.getData(e.id,!0);!t||t.length<1||(game.shenQiStarSkillTipsData.setSkillInfos(t,e.star,e.active),game.module.show(game.ME.ShenQiStarSkillTips))}},updateCost:function(){var e=this.shenQiArr;if(e&&!(e.length<1)){for(var t=e.length,a=!1,i=!1,n=!1,s=void 0,r=0;r<t;r++)(s=e[r]).updateCost(),!a&&s.costAlert&&(a=!0),s.starAlert&&(i=!0),s.blessAlert&&(n=!0);this.costAlert=a,this.starAlert=i,this.blessAlert=n}},isJLFullLv:function(e,t){var a=game.ShenQiJLCfg.getData(t,1,1);if(a){for(var i=a.keys,n=void 0,s=i.length,r=0;r<s;r++)if(n=i[r],e.getStatValue(n)<a[b8e.getNormP(game.MaxKeyByStatType[n])])return!1;return!0}},getJLCostId:function(){if(!this.jingLianId){var e=game.ShenQiMiscCfg.getData("jingLianId");e&&(this.jingLianId=0|e.value)}return this.jingLianId},getObj:function(e,t){this.obj||(this.obj={});var a=this.obj;return a.id=e,a.lv=t,a},getShenQiSkill:function(){if(!this.battleId)return 0;var e=this.shenQiMap.get(this.battleId);return e&&e.jinjieCfg?e.jinjieCfg.skill:0},getBattleInfo:function(){return this.battleId?this.shenQiMap.get(this.battleId):null},getConditionLv:function(e){var t=0,a=this.getInfoList();if(!a||a.length<1)return t;for(var i=void 0,n=a.length,s=0;s<n;s++)(i=a[s]).active&&i.lv>=e&&t++;return t},getActiveNum:function(){var e=0,t=this.getInfoList();if(!t||t.length<1)return e;for(var a=t.length,i=0;i<a;i++)t[i].active&&e++;return e},updataBlessSlot:function(e){var t=this.getInfoById(e.id);t&&t.updataSlot(e.bless)},updataShenQiStar:function(e){var t=this.getInfoById(e.id);t&&t.setStarLv(e.star)},isOpenBless:function(e){if(!e.active)return!1;var t=game.ShenQiBlessOpenCfg.getData(e.quality);return!!t&&(e.lv>=t.lv&&e.star>=t.star)},getMasterAllLv:function(){var e=this.getCurInfo();if(e)return e.getBlessAllLevel()},getMasterList:function(){var e=this.getCurInfo();if(e){var t=this.getMasterCfg(e.id,!1);if(t){var a=this.masterAry,i=t.length;a.length=i;for(var n=0;n<i;n++)a[n]||(a[n]=new game.ShenQiMasterInfo),a[n].setData(t[n]);return a}}},getMasterCfg:function(e,t){return t?game.ShenQiBlessMasterCfg.getData(e):(this.idObj||(this.idObj={}),this.idObj.id=e,game.ShenQiBlessMasterCfg.getData(this.idObj,!0))},getNextJieLevel:function(e,t){this.objNext||(this.objNext={}),this.objNext.id=t,this.objNext.masterLv=e;var a=game.shenQiData.getMasterCfg(this.objNext,!0);if(a)return a.maxLv},setLockList:function(){var e=game.ShenQiBlessChainCfg.getDatas();if(e){this.lockAry.length=0;for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.ShenQiLockInfo).setData(a),this.lockAry.push(i)}},getLockList:function(){return this.lockAry},getCfgBySlot:function(e,t){return this.cfgObj||(this.cfgObj={}),this.cfgObj.pos=e,this.cfgObj.lv=t,game.ShenQiBlessCfg.getData(this.cfgObj)},getSelectBless:function(){var e=this.getCurInfo();if(e)return e.getBlessJie()},getLockMaxNumStar:function(){var e=this.shenQiArr;if(e){for(var t=e.length,a=void 0,i=this.jieAry.length=0;i<t;i++)a=e[i].getBlessJie(),this.jieAry.push(a);return this.jieAry}},getMaxLockStar:function(){for(var e=this.lockAry,t=e.length,a=0,i=void 0,n=0;n<t;n++)(i=e[n]).getActive()&&(a=i.cfg.star);return a},sort:function(e,t){return e.level==t.level?e.slot-t.slot:e.level-t.level},getFiveSend:function(){var e=this;e.sendAry.length=0;var t=e.getCurInfo();if(t){var a=t.slotLevel.values();a.sort(e.sort);var i=a.length,n=void 0,s=void 0,r=e.fiveObj,o=void 0,g=0;e.countNum=0,e.isMaxLavel=!1;for(var u=2*game.mainRoleData.lv,l=0;l<i;l++)n=a[l],e.getMaxBlessBol(n.level,!0)||(n.level>=u?g++:0!=(o=e.getSendNum(n,5))&&((s=(s=r.get(n.slot))||{}).level=o,s.slot=n.slot,r.set(n.slot,s),e.sendAry.push(s)));return 4==g&&(e.isMaxLavel=!0),e.sendAry}},getSendNum:function(e,t){var a=e.level,i=e.slot,n=this.getMaxBlessLevel(),s=2*game.mainRoleData.lv,r=Math.min(n,s),o=Math.min(r,a+t),g=this.getBlessItemId(),u=game.itemData.getCountById(g);u-=this.countNum;for(var l=0,c=0,h=a,m=a;m<o&&!(u<(l+=this.getCfgBySlot(i,m).itemNum));m++)c+=l,h=m+1;return this.countNum+=c,h-a},getOneSend:function(){var e=this;e.sendAry.length=0;var t=e.getCurInfo();if(t){var a=t.slotLevel.get(e.slotIndex);return e.oneObj||(e.oneObj={}),e.oneObj.slot=a.slot,e.oneObj.level=1,e.sendAry.push(e.oneObj),e.sendAry}},getCfgStar:function(e,t){return this.obj2||(this.obj2={}),this.obj2.id=e,this.obj2.star=t,game.ShenQiStarCfg.getData(this.obj2)},getRedBol:function(e,t){if(this.getMaxBlessBol(t,!1))return!1;var a=e.itemId;return game.itemData.getCountById(a)>=e.itemNum},getShowAttr:function(e,t){if(this.result||(this.result=[]),this.result.length=0,!e)return this.result;for(var a=game.SpriteDefine,i=a.length,n=void 0,s=void 0,r=void 0,o=0;o<i;o++)if(r=a[o]){if(s=r.type,1==t){if(!(n=e[b8e.getNormP(r.clientKey)])||n<=0)continue}else if(2==t){if(!(n=e[b8e.getNormP(r.key)])||n<=0)continue}else if(3==t&&null==(n=e[b8e.getNormP(r.key)]))continue;game.AttrRulesCfg.getData(s)&&this.result.push({type:s,value:n})}return this.result},getQuaActNum:function(e){var t=0,a=this.getInfoList();if(!a||a.length<1)return t;for(var i=void 0,n=a.length,s=0;s<n;s++)(i=a[s]).active&&i.cfg.quality==e&&t++;return t}});game.shenQiData=game.shenQiData||new e}(),function(){var e;e=b8e.Object.extends({curParam:0,needParam:0,isFinish:!1,isGet:!1,canGet:!1,ctor:function(){this._super(),this.prizeList=[]},setCfg:function(e){var t=this;t.cfg=e,t.type=e.taskType,t.id=e.id,t.needParam=e.param,t.type==game.ShenQiTaskType.LEVEL&&(t.curParam=game.mainRoleData.lv,t.isFinish=t.curParam>=t.needParam),t.setAwardList()},setAwardList:function(){for(var e=this.cfg.awards,t=void 0,a=void 0,i=e.length,n=this.prizeList,s=0;s<i;s++)t=e[s],(a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,n.push(a)},getAwardList:function(){return this.prizeList},updateParam:function(){this.curParam=game.shenQiBattleData.getTaskParamByType(this.type),this.isFinish=this.curParam>=this.needParam,this.canGet=this.isFinish&&!this.isGet},updateGet:function(){this.isGet=game.shenQiBattleData.getTaskInfos(this.id),this.canGet=this.isFinish&&!this.isGet},onGet:function(){this.isGet=!0,this.canGet=this.isFinish&&!this.isGet}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShenQiTaskInfo",e)}(),function(){var e;e=b8e.Enum({NONE:0,LEVEL:1,PERSON_BOSS:2,WILD_BOSS:3,COST:4}),b8e.RC("$$game","$$ShenQiTaskType",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,ctor:function(){},setData:function(e){this.cfg=e},getActive:function(){var e=this.cfg.num,t=this.cfg.masterLv,a=game.shenQiData.getLockMaxNumStar();if(!a)return!1;for(var i=a.length,n=0,s=0;s<i;s++)a[s]>=t&&n++;return e<=n}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShenQiLockInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,ctor:function(){},setData:function(e){this.cfg=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShenQiMasterInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this.skillInfos=[]},setSkillInfos:function(e,t,a){if(e&&!(e.length<1)){var i=this.skillInfos,n=e.length;i.length=n;for(var s=0;s<n;s++)i[s]||(i[s]=new game.ShenQiStarSkillTipsInfo),i[s].setData(e[s],t,a);i.sort(this.sortFunc)}},sortFunc:function(e,t){return e.isCurLv&&!t.isCurLv?-1:!e.isCurLv&&t.isCurLv?1:e.star-t.star},getSkillInfos:function(){return this.skillInfos}});game.shenQiStarSkillTipsData=game.shenQiStarSkillTipsData||new e}(),function(){var e;e=b8e.Object.extends({setData:function(e,t,a){this.star=e.star,this.isCurLv=a&&e.star==t,this.skillCfg=game.SkillCfg.getData(e.skillId)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShenQiStarSkillTipsInfo",e)}(),function(){var e;e=b8e.Object.extends({ctor:function(){},setData:function(e){this.slot=e.slot,this.level=e.level}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BlessSlotInfo",e)}(),function(){var e;e=b8e.Enum({None:0,V2C_SELECT_BATTLE:-1,C2V_SELECT_BATTLE:-1}),b8e.RC("$$game","$$ShenQiBattleEvts",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SELECT_TOGGLE:-1,C2V_SCROLL_LEFT:-1,C2V_SCROLL_RIGHT:-1,C2C_SYS_DATA:-1,C2C_UPDATE_ACTIVE:-1,C2V_UPDATE_ACTIVE:-1,C2V_UPDATE_BATTLE:-1,C2V_UPDATE_JINJIE:-1,C2V_UPDTAE_JINGLIAN_CHOICE:-1,C2C_UPDTAE_COST:-1,C2V_UPDATE_ACTIVE_COST:-1,C2V_UPDATE_JJ_COST:-1,C2V_UPDATE_JL_COST:-1,C2C_SELECT_CHANGE:-1,C2V_SELECT_CHANGE:-1,C2C_JINJIE_SUCCESS:-1,C2V_UPDATE_JILIAN_VIEW:-1,C2V_UPDATE_AUTO:-1,C2V_UPDATE_AUTO_BUY:-1,C2C_JL_SUCCESS:-1,C2V_UPDATE_LIST:-1,C2C_UPDATE_BATTLE:-1,V2C_CLOSE_VIEW:-1,C2C_UPDATA_STAR:-1,C2V_UPDATA_STAR:-1,C2V_UPDATE_STAR_MAIN:-1,C2V_UPDATA_SLOT_LEVEL:-1,V_CHANGE_SLOT:-1,V_CHANGE_CLICK:-1}),b8e.RC("$$game","$$ShenQiEvts",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SCROLL_TOP:-1,C2V_SCROLL_BOTTOM:-1}),b8e.RC("$$game","$$CommonSkillTipsEvts",e)}(),function(){var e=game.Control.extends({topBtn:function(){this.send(this.Evts.C2V_SCROLL_TOP)},bottomBtn:function(){this.send(this.Evts.C2V_SCROLL_BOTTOM)}}),t=[game.ME.ShenQiStarSkillTips];b8e.module.registerControl(game.ME.CommonSkillTips,e,game.CommonSkillTipsEvts,null,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.shenQiData;var e=game.spotAlert,t=game.SAE;this.shenqiAlert=e.set(t.SHENQI,t.YANGCHENG_ALERT),this.costAlert=e.set(t.SHENQI_COST,t.SHENQI),this.battleAlert=e.set(t.SHENQI_BATTLE,t.SHENQI),this.starAlert=e.set(t.SHENQI_STAR,t.SHENQI),this.blessAlert=e.set(t.SHENQI_BLESS,t.SHENQI)},ipc:function(){var e=this;e.evts={Back:{C_BACK_SYN_BACK_INFO:e.updateCost,C_BACK_UPDATE_ITEMINFO:e.updateCost},ShenQi:{C2C_SELECT_CHANGE:e.updateSelect,C2C_SYS_DATA:e.onSys}},e.handels={ActivateShenQiResp:e.onActiveResp,BattleShenQiResp:e.onBattleResp,ShenQiBlessResp:e.onBlessResp,ShenQiStarResp:e.onStarResp}},notify:function(e,t){switch(e){case game.CultivateBaseEvts.C_SELECTCHANGE:if(t.id==game.shenQiData.selectId)return;var a=game.shenQiData.getInfoById(t.id);if(!game.shenQiData.isOpenBless(a))return void game.notice.show(53719);game.shenQiData.selectInfoById(t.id),this.send(this.Evts.C2V_SELECT_CHANGE),this.dpt(this.Evts.C2C_SELECT_CHANGE)}},updateSelect:function(){this.send(this.Evts.C2V_SELECT_CHANGE)},onSys:function(){this.updateBattleAlert(),this.updateShenQiAvata()},updateBattleAlert:function(){var e=this.data;this.battleAlert.alert=e.hasActive&&!e.battleId},updateShenQiAvata:function(){var e=this.data.getBattleInfo(),t=e&&e.cfg?e.cfg.model:1001;game.mainRoleData.heroModel.setAnim(game.AnimType.WEAPON,t),game.AvatarUtil.update(game.mainRole)},updateCost:function(){if(game.moduleOpen.checkOpen(game.ME.ShenQi)){var e=this.data;e.updateCost(),this.costAlert.alert=e.costAlert,this.starAlert.alert=e.starAlert,this.blessAlert.alert=e.blessAlert,this.dpt(this.Evts.C2C_UPDTAE_COST),this.send(this.Evts.C2V_UPDATE_ACTIVE_COST)}},onActiveResp:function(e){var t=e.readProtobuf(game.pb.ActivateShenQiResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.onActive(t.id),this.updateBattleAlert(),this.dpt(this.Evts.C2C_UPDATE_ACTIVE),this.send(this.Evts.C2V_UPDATE_ACTIVE))},onBattleResp:function(e){var t=e.readProtobuf(game.pb.BattleShenQiResponse);0<t.code?game.notice.noticeError(t.code):(this.data.setBattleId(t.id),this.updateBattleAlert(),this.updateShenQiAvata(),this.dpt(this.Evts.C2C_UPDATE_BATTLE),this.send(this.Evts.C2V_UPDATE_BATTLE))},onBlessResp:function(e){var t=e.readProtobuf(game.pb.ShenQiBlessResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.updataBlessSlot(t),this.send(this.Evts.C2V_UPDATA_SLOT_LEVEL))},onStarResp:function(e){var t=e.readProtobuf(game.pb.ShenQiStarResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updataShenQiStar(t),game.FightAmount.inst().showTeamStatPower(),game.module.show(game.ME.ShenQiStarSuccess),this.dpt(this.Evts.C2C_UPDATA_STAR),this.send(this.Evts.C2V_UPDATA_STAR))},activeBtn:function(){var e=this.data.getCurInfo();if(e&&e.cfg){var t=e.cfg;game.UpgradeUtil.checkItemInfo(t.itemId,t.itemNum,!0)&&this.sender.ActivateShenQiReq(e.id)}},pifuBtn:function(){game.module.showToggle(game.ME.Surface,3)},battleBtn:function(){var e=this.data,t=e.selectId==e.battleId?0:e.selectId;this.sender.BattleShenQiReq(t)},turnplate:function(){var e=game.ShenQiMiscCfg.getData("turnplateId");if(e){var t=game.xunBaoData.getOpenIdByType(+e.value);t&&b8e.evt.dptG(game.XunBaoEvts.C2C_SHOW_XUNBAO,t)}},blessBtn:function(){if(!game.moduleOpen.checkOpen(game.ME.ShenQiBless))return game.notice.show("\u529f\u80fd\u6682\u672a\u5f00\u542f");game.module.show(game.ME.ShenQiBless)},attrNode1_bg01:function(){this.selectSlot(1)},attrNode2_bg01:function(){this.selectSlot(2)},attrNode3_bg01:function(){this.selectSlot(3)},attrNode4_bg01:function(){this.selectSlot(4)},selectSlot:function(e){e!=this.data.slotIndex&&(this.data.slotIndex=e,this.send(this.Evts.V_CHANGE_SLOT,e))},clickFiveBtn:function(){this.data.clickBol=!this.data.clickBol,this.send(this.Evts.V_CHANGE_CLICK)},blessOneBtn:function(){var e=this,t=e.data.getCurInfo();if(t){var a=t.id,i=void 0;if(i=e.data.clickBol?e.data.getFiveSend():e.data.getOneSend(),e.blessObj||(e.blessObj={}),0==i.length&&!e.data.isMaxLavel)return game.notice.show(113);if(0==i.length&&e.data.isMaxLavel)return game.notice.show(53727);e.blessObj.id=a,e.blessObj.bless=i,e.sender.ShenQiBlessReq(e.blessObj)}},upStarBtn:function(){var e=this.data.getCurInfo();if(e){var t=e.id;this.sender.ShenQiStarReq(t)}},masterBtn:function(){game.module.show(game.ME.ShenQiBlessMaster)},LockBtn:function(){game.module.show(game.ME.ShenQiBlessLock)},btn_left:function(){this.send(this.Evts.C2V_SCROLL_LEFT)},btn_right:function(){this.send(this.Evts.C2V_SCROLL_RIGHT)}}),t=[game.ME.ShenQiBless,game.ME.ShenQiStar,game.ME.ShenQiBlessMaster,game.ME.ShenQiBlessLock,game.ME.ShenQiStarSuccess],a=game.Sender.extends({ipc:function(){this.msg={ActivateShenQiReq:this.activateShenQiReq,BattleShenQiReq:this.battleShenQiReq,ShenQiBlessReq:this.shenQiBlessReq,ShenQiStarReq:this.shenQiStarReq}},shenQiStarReq:function(e){var t=game.pb.ShenQiStarRequest;t.id=e,this.write(t)},shenQiBlessReq:function(e){var t=game.pb.ShenQiBlessRequest;t.id=e.id,t.bless=e.bless,this.write(t)},activateShenQiReq:function(e){var t=game.pb.ActivateShenQiRequest;t.id=e,this.write(t)},battleShenQiReq:function(e){var t=game.pb.BattleShenQiRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.ShenQiActive,e,game.ShenQiEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.shenQiBattleData,this.shiLianAlert=game.spotAlert.set(game.SAE.SHENQI_SHILIAN,game.SAE.SHENQI)},ipc:function(){this.evts={},this.handels={}},notify:function(e,t){switch(e){case this.Evts.V2C_SELECT_BATTLE:this.data.selectInfoById(t),this.send(this.Evts.C2V_SELECT_BATTLE)}},setBattleData:function(e){var t=e?e.data:null;t&&game.shenQiBattleData.synDatas(t)},updateLv:function(){var e=game.ShenQiTaskType.LEVEL;this.data.addTaskParamByType(e,1),this.data.updateParam(e)},updatePerson:function(e){var t=e?e.data:null;if(t){var a=game.ShenQiTaskType.PERSON_BOSS;this.data.addTaskParamByType(a,t),this.data.updateParam(a)}},updateWild:function(){var e=game.ShenQiTaskType.WILD_BOSS;this.data.addTaskParamByType(e,1),this.data.updateParam(e)},updateAmount:function(e){var t=!!e.data,a=this.data;if(game.moduleOpen.checkOpen(game.ME.ShenQi)){var i=game.ShenQiTaskType.COST;a.updatePayCount(t);var n=a.getPayCount();this.data.addTaskParamByType(i,n),this.data.updateParam(i)}}}),t=game.Sender.extends({});b8e.module.registerControl(game.ME.ShenQiBattle,e,game.ShenQiBattleEvts,t)}(),function(){var e=game.Control.extends({notify:function(e,t){switch(e){case game.CultivateBaseEvts.C_SELECTCHANGE:if(t.id==game.shenQiData.selectId)return;var a=game.shenQiData.getInfoById(t.id);if(0<game.shenQiData.toggleId&&!a.active)return void game.notice.show(51499);game.shenQiData.selectInfoById(t.id),this.send(this.Evts.C2V_SELECT_CHANGE),this.dpt(this.Evts.C2C_SELECT_CHANGE)}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.ShenQiModelReq()},ipc:function(){this.evts={ShenQiActive:{C2C_UPDATE_ACTIVE:this.updateAcitve,C2C_UPDTAE_COST:this.updateAcitve,C2C_UPDATE_BATTLE:this.updateAcitve,C2C_UPDATA_STAR:this.updateStar},ShenQiJinJie:{C2C_JINJIE_SUCCESS:this.updateName},ShenQiJingLian:{C2C_JL_SUCCESS:this.updateName}},this.handels={ShenQiModelResp:this.setModuleData}},setModuleData:function(e){var t=e.readProtobuf(game.pb.ShenQiModel);0<t.code?game.notice.noticeError(t.code):(game.shenQiData.synDatas(t),this.dpt(this.Evts.C2C_SYS_DATA,t))},btn_1:function(){this.selectTog(0)},btn_2:function(){this.selectTog(1)},btn_3:function(){this.selectTog(3)},btn_5:function(){this.selectTog(2)},btn_4:function(){},selectTog:function(e){var t=game.shenQiData.getCurInfo();0<e&&!t.active?game.notice.show(51499):this.send(this.Evts.C2V_SELECT_TOGGLE,e)},btn_left:function(){this.send(this.Evts.C2V_SCROLL_LEFT)},btn_right:function(){this.send(this.Evts.C2V_SCROLL_RIGHT)},updateAcitve:function(){this.send(this.Evts.C2V_UPDATE_ACTIVE),this.send(this.Evts.C2V_UPDATE_LIST)},updateName:function(){this.send(this.Evts.C2V_UPDATE_ACTIVE)},updateStar:function(){this.send(this.Evts.C2V_UPDATE_STAR_MAIN)}}),t=game.Sender.extends({ipc:function(){this.msg={ShenQiModelReq:null}}});b8e.module.registerControl(game.ME.ShenQi,e,game.ShenQiEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.shenQiData},ipc:function(){this.evts={ShenQiActive:{C2C_UPDTAE_COST:this.updateJingLianAlert},ShenQi:{C2C_SELECT_CHANGE:this.updateSelect}},this.handels={ShenQiJLResp:this.onWashResponse}},updateSelect:function(){this.send(this.Evts.C2V_SELECT_CHANGE)},updateJingLianAlert:function(){this.send(this.Evts.C2V_UPDATE_JL_COST)},onWashResponse:function(e){var t=e.readProtobuf(game.pb.ShenQiJLResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(!0),this.data.updateJingLian(t),this.send(this.Evts.C2V_UPDATE_JILIAN_VIEW),this.dpt(this.Evts.C2C_JL_SUCCESS))},typeBtn1:function(){this.typeBtn(1)},typeBtn2:function(){this.typeBtn(2)},typeBtn3:function(){this.typeBtn(3)},typeBtn:function(e){this.data.jingLianType=e,this.send(this.Evts.C2V_UPDTAE_JINGLIAN_CHOICE)},oneBtn:function(){this.washRequest(1)},tenBtn:function(){this.washRequest(10)},washRequest:function(e){var t=this.data.selectId,a=this.data.jingLianType,i=game.ShenQiJLCfg.getData(t,a,e);i&&game.UpgradeUtil.checkItemList(i.costItem,1,!0)&&this.sender.ShenQiJLReq(t,a,e)},myItem:function(){},itemNode1:function(){},itemNode2:function(){},itemNode3:function(){},otherItem1:function(){},otherItem2:function(){},otherItem3:function(){}}),t=game.Sender.extends({ipc:function(){this.msg={ShenQiJLReq:this.shenQiJLReq}},shenQiJLReq:function(e,t,a){var i=game.pb.ShenQiJLRequest;i.id=e,i.washType=t,i.num=a,this.write(i)}});b8e.module.registerControl(game.ME.ShenQiJingLian,e,game.ShenQiEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.shenQiData},ipc:function(){this.evts={ShenQiActive:{C2C_UPDTAE_COST:this.updateJinJieAlert},ShenQi:{C2C_SELECT_CHANGE:this.updateSelect}},this.handels={ShenQiUpgradeResp:this.onShenQiUpgradeResp}},notify:function(e){switch(e){case game.ShenQiEvts.V2C_CLOSE_VIEW:this.setAuto(!1),this.send(this.Evts.C2V_UPDATE_AUTO,this.isAuto)}},updateSelect:function(){this.send(this.Evts.C2V_SELECT_CHANGE)},updateJinJieAlert:function(){this.send(this.Evts.C2V_UPDATE_JJ_COST)},onShenQiUpgradeResp:function(e){var t=this,a=e.readProtobuf(game.pb.ShenQiUpgradeResponse);0<a.code?game.notice.noticeError(a.code):(game.FightAmount.inst().showTeamStatPower(),t.data.onJinJie(a.id,a.lv,a.exp),t.send(t.Evts.C2V_UPDATE_JINJIE),t.dpt(t.Evts.C2C_JINJIE_SUCCESS),b8e.Tween.kill(t),t.isAuto&&b8e.Tween.get(t).wait(200).call(t.upgradeReq,t))},autoBuyBtn:function(){this.data.autoBuy=!this.data.autoBuy,this.send(this.Evts.C2V_UPDATE_AUTO_BUY)},upgradeBtn:function(){this.isAuto||this.upgradeReq()},autoUpgradeBtn:function(){this.setAuto(!this.isAuto),this.isAuto&&(this.isPass=!1,this.upgradeReq())},setAuto:function(e){this.isAuto=e,this.send(this.Evts.C2V_UPDATE_AUTO,this.isAuto)},autoUpgradeReq:function(){var e=this.data.selectId;e&&this.sender.ShenQiUpgradeReq(e)},cancelCb:function(){this.isPass=!1,this.setAuto(!1)},sureCb:function(){if(b8e.module.isShowView(this.moduleEnum)&&this.data.autoBuy){var e=this.data.getCurInfo();e&&(this.isPass=!0,this.sender.ShenQiUpgradeReq(e.id,this.autoType))}},upgradeReq:function(){var e=this,t=e.data.getCurInfo();if(t&&t.jinjieCfg){var a=t.jinjieCfg;if(t.isJJFullLv)e.setAuto(!1);else{var i=a.costItem[0];game.autoBuyMgr.autoBuyBegin(i.Id,i.Num,0,e.data.autoBuy,e.isAuto,e,e.cancelCb,e.sureCb,e.setAuto)&&e.sender.ShenQiUpgradeReq(t.id,e.autoType)}}}}),t=game.Sender.extends({ipc:function(){this.msg={ShenQiUpgradeReq:this.shenQiUpgradeReq}},shenQiUpgradeReq:function(e,t){var a=game.pb.ShenQiUpgradeRequest;a.id=e,a.autoType=t,this.write(a)}});b8e.module.registerControl(game.ME.ShenQiJinJie,e,game.ShenQiEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1294),this.setSize(540,142)},init:function(){this.skillIcon=new game.CultivateBaseSkillIcon,this.skillIcon.addToParent(this.skin.skillNode)},setData:function(e){var t=this.skin;t.curUse.active=e.isCurLv;var a=e.skillCfg;if(a){this.skillIcon.setData(a.id),t.nameLab.string=game.Lang.get(51536,a.name,e.lv);var i=game.LangSkill.get(a.desc,a.descParam),n=e.isCurLv?51617:51616;t.descLab.string=game.Lang.get(n,i)}}}),b8e.RC("$$game","$$CommonSkillTipsItem",e)}(),function(){var e,t=e=game.View.extends({_showModel:!0,ctor:function(){this._super(1295)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.CommonSkillTipsItem,e.layout.spacingY=5,e.layout.paddingLeft=5,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list),e.setScrollViewCb(this.listCb,this)},notify:function(e){switch(e){case this.Evts.C2V_SCROLL_TOP:this.list.scrollToTop(0,200);break;case this.Evts.C2V_SCROLL_BOTTOM:this.list.scrollToBottom(0,200)}},listCb:function(e,t,a){var i=this.skin;i.topBtn.active=0<e.length,i.bottomBtn.active=0<a.length},onShow:function(){this.updateList()},updateList:function(){var e;e=game.commonSkillTipsData.getSkillInfos(),this.list.setData(e)}});b8e.module.registerView(game.ME.CommonSkillTips,t),b8e.RC("$$game","$$CommonSkillTipsView",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1296),this.spotAlerts={SHENQI_BATTLE:this.activeBattleAlert,SHENQI_BLESS:this.blessAlert}},activeBattleAlert:function(e){this.skin.battleRed.active=e.alert},blessAlert:function(e){this.skin.blessRed.active=e.alert},init:function(){var e=this;e.data=game.shenQiData;var t=e.skin;e.skillIcon=new game.CultivateBaseSkillIcon,e.skillIcon.setClickCallBack(e.data.openSkillTips,e.data),e.skillIcon.addToParent(t.skillNode),e.itemIcon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105),e.itemIcon.addToParent(t.itemNode),e.data.selectFirstInfo()},notify:function(e){var t=this;switch(e){case t.Evts.C2V_SELECT_CHANGE:t.updateView(),t.updateBattle(),t.updateCost();break;case t.Evts.C2V_UPDATE_ACTIVE:t.updateView(),t.updateCost();break;case t.Evts.C2V_UPDATE_BATTLE:t.updateBattle();break;case t.Evts.C2V_UPDATE_ACTIVE_COST:t.updateCost()}},onShow:function(){this.updateView(),this.updateBattle(),this.updateCost(),this.updataTurnplate()},updateView:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&t.cfg&&t.jinjieCfg){var a=t.cfg,i=t.jinjieCfg.skill;game.SkillCfg.getData(i)&&this.skillIcon.setData(i);var n=t.active;e.activeNode.active=n,e.notActiveNode.active=!n;var s=this.data.isOpenBless(t);if(this.skin.blessBtn.active=s,n)for(var r=game.SpriteStatUtil.getSpriteStatArr(t.allSpr),o=void 0,g=void 0,u=void 0,l=0;l<6;l++)o=r[l],((g=this.getComponent("att"+l)).active=o)&&(u=game.CCommonUtil.replaceNum(o.value,1),g.string=game.Lang.get(7250,o.name,u));else{var c=a.itemId,h=game.ItemInfoCfg.getData(c);if(!h)return;this.itemIcon.setItemInfo(h),this.itemIcon.setNum(0),e.itemName.string=game.HtmlUtil.getColorStrByQuality(a.quality,h.name)}}},updateBattle:function(){var e=this.skin,t=this.data.getCurInfo();if(t){var a=t.isBattle?51504:51503;e.battleDesc.string=game.Lang.get(a)}var i=this.data.battleId;if(i){var n=this.data.getInfoById(i);n&&(e.battleLab.string=game.Lang.get(51500,n.name))}else e.battleLab.string=game.Lang.get(51501)},updateCost:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&t.cfg){var a=t.cfg,i=game.itemData.getNumById(a.itemId),n=a.itemNum,s=n<=i?game.Color.GREEN:game.Color.RED;e.itemNum.string=game.HtmlUtil.getText(s,i+"/"+n),e.activeRed.active=n<=i}},updataTurnplate:function(){var e=this.skin;e.turnplate.active=!1;var t=game.ShenQiMiscCfg.getData("turnplateId");if(t){var a=game.xunBaoData.getOpenIdByType(+t.value);e.turnplate.active=!!a}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ShenQiActive,e)}(),function(){var e;e=game.ListItem.extends({leftPos:145,rightPos:453,ctor:function(){this._super(1301),this.setSize(600,250)},init:function(){this.model=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this.model.addToParent(this.skin.modelNode)},setData:function(e){var t=this.skin;this.model.load(game.ResCfg.getUrl(5044,1001)),t.nameLab=e.cfg.name,t.posNodeBtn.x=e.id/2==1?this.rightPos:this.leftPos},posNodeBtn:function(){var e=this.data;e.id!=game.shenQiBattleData.selectId&&this.send(game.ShenQiBattleEvts.V2C_SELECT_BATTLE,e.id)}}),b8e.RC("$$game","$$ShenQiBattleItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1302),this.setSize(304,121)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=0,e.layout.paddingTop=0,e.layout.spacingX=5},setData:function(e){var t=this.skin,a=e.getAwardList();this.prizeList.setData(a);var i=e.isGet,n=e.canGet;t.hasGet.active=i,t.gotoBtn.active=!n&&!i,t.getBtn.active=n&&!i;var s=game.Lang.get(e.cfg.taskDesc),r=void 0;r=n||i?game.Lang.get(51506,s):game.Lang.get(51505,s,e.curParam,e.needParam),t.descLab.string=r},gotoBtn:function(){},getBtn:function(){}}),b8e.RC("$$game","$$ShenQiBattleTaskItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1297)},init:function(){var e=this.skin;this.data=game.shenQiBattleData;var t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.ShenQiBattleItem,t.bindEnum=this.moduleEnum,t.layout.spacingY=-2,t.addToParent(e.list);var a=this.taskList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);a.itemRender=game.ShenQiBattleTaskItem,a.bindEnum=this.moduleEnum,a.addToParent(e.taskList),a.layout.paddingLeft=0,a.layout.paddingTop=0,a.layout.spacingX=5,a.layout.spacingY=5;var i=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);i.itemRender=game.PrizeListItem,i.addToParent(e.prizeList),i.layout.paddingLeft=0,i.layout.paddingTop=0,i.layout.spacingX=5,this.module=new game.SurfaceModel,this.module.addToParent(e.modelNode)},notify:function(e){switch(e){case this.Evts.C2V_SELECT_BATTLE:this.updateView()}},onShow:function(){this.updateList(),this.updateView()},updateList:function(){var e=this.data.getInfos();this.list.setData(e)},updateView:function(){var e=this.data.getCurInfo();if(e){var t=e.id,a=this.data.curChallengeId;t<a&&this.setModel(!0),t==a&&(info.canBattle?this.setModel(!1):this.setTask()),a<t&&this.setTask()}},setModel:function(e){var t=this.skin,a=this.data.getCurInfo();if(a){var i=game.ShenQiCfg.getData(a.id);if(i){this.module.showSurface(i),t.battleBtn.active=!e,t.maxLv.active=e,t.nameLab.string=i.name,t.powerLab.string=game.mainRoleData.power;var n=a.getAwardList();this.prizeList.setData(n)}}},setTask:function(){var e=this.data.getCurInfo();if(e){var t=e.getTaskInfos();this.taskList.setData(t)}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ShenQiBattle,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1298)},init:function(){this.data=game.shenQiData,this.maxWidth=476;var e=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),t=this.data.getJLCostId();e.setItemId(t),e.addToParent(this.skin.myItem),this.initIcon()},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_JILIAN_VIEW:case t.Evts.C2V_SELECT_CHANGE:t.updateBars(),t.updateType(),t.setCostItem(),t.updateCost();break;case t.Evts.C2V_UPDTAE_JINGLIAN_CHOICE:t.updateType(),t.updateCost();break;case t.Evts.C2V_UPDATE_JL_COST:t.updateCost()}},initIcon:function(){for(var e=this.itemIconArr=[],t=this.otherIconArr=[],a=void 0,i=void 0,n=1;n<4;n++)a=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),i=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),a.addToParent(this.getComponent("itemNode"+n)),i.addToParent(this.getComponent("otherItem"+n)),e[n]=a,t[n]=i},onShow:function(){this.updateBars(),this.updateType(),this.setCostItem(),this.updateCost()},updateBars:function(){var e=this.skin,t=this.data.getCurInfo();if(t){var a=t.isJLFullLv;e.maxNode.active=a,e.notMaxNode.active=!a;var i=game.ShenQiJLCfg.getData(t.id,1,1);if(i)for(var n=t.jingLianSpr,s=t.tempJLAddSpr,r=i.keys,o=void 0,g=void 0,u=void 0,l=void 0,c=void 0,h=0;h<3;h++)(o=r[h])&&(c=game.AttrRulesCfg.getData(o),g=n.getStatValue(o),u=s.getStatValue(o),l=i[b8e.getNormP(game.MaxKeyByStatType[o])],this.getComponent("attLab"+h).string=c?c.name:"",this.getComponent("expLab"+h).string=g+"/"+l,this.getComponent("barGreen"+h).width=Math.min(this.maxWidth,this.maxWidth*(g/l)),this.getComponent("addLab"+h).string=u?"+"+u:"")}},updateType:function(){var e=this.data.jingLianType,t=this.skin;t.check1.active=1==e,t.check2.active=2==e,t.check3.active=3==e},setCostItem:function(){for(var e=this.data,t=this.itemIconArr,a=this.otherIconArr,i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=1;g<4;g++)(i=game.ShenQiJLCfg.getData(e.selectId,g,1))&&(s=(n=i.costItem)[0],t[g].setItemId(s.Id),this.getComponent("needNum"+g).string=s.Num,o=1<n.length,(this.getComponent("other"+g).active=o)&&(r=n[1],a[g].setItemId(r.Id),this.getComponent("otherNum"+g).string=r.Num))},updateCost:function(){var e=this.skin,t=this.data;if(t.getCurInfo().isJLFullLv)return e.oneRed.active=!1,void(e.tenRed.active=!1);var a=t.getJLCostId(),i=game.itemData.getNumById(a);e.haveNum.string=i;var n=game.ShenQiJLCfg.getData(t.selectId,t.jingLianType,1),s=game.ShenQiJLCfg.getData(t.selectId,t.jingLianType,10);if(n&&s){var r=game.UpgradeUtil.checkItemList(n.costItem,1,!1),o=game.UpgradeUtil.checkItemList(s.costItem,1,!1);e.oneRed.active=r,e.tenRed.active=o}},onHide:function(){this.data.jingLianType=1},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ShenQiJingLian,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1299)},init:function(){var e=this;e.data=game.shenQiData;var t=e.skin;e.progress=new game.Progress(500,30),e.progress.addToParent(t.progerssNode),e.skillIcon=new game.CultivateBaseSkillIcon,e.skillIcon.setClickCallBack(e.data.openSkillTips,e.data),e.skillIcon.addToParent(t.skillNode),e.itemIcon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_84),e.itemIcon.addToParent(t.itemNode)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_SELECT_CHANGE:a.updateView(),a.updateAttr(),a.updateCost();break;case a.Evts.C2V_UPDATE_AUTO_BUY:a.updateAutoBuy();break;case a.Evts.C2V_UPDATE_JINJIE:a.updateView(),a.updateAttr(),a.updateCost();break;case a.Evts.C2V_UPDATE_JJ_COST:a.updateCost();break;case a.Evts.C2V_UPDATE_AUTO:a.updateUpgradeLab(t)}},onShow:function(){this.updateView(),this.updateAttr(),this.updateAutoBuy(),this.updateCost(),this.updateUpgradeLab(!1)},onHide:function(){this.send(this.Evts.V2C_CLOSE_VIEW)},updateView:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&t.jinjieCfg){var a=t.jinjieCfg,i=a.skill;game.SkillCfg.getData(i)&&this.skillIcon.setData(i);var n=t.isJJFullLv;if(e.maxNode.active=n,e.notMaxNode.active=!n,e.lvLab.string=t.lv,!n){var s=a.costItem[0],r=game.ItemInfoCfg.getData(s.Id);if(!r)return;this.itemIcon.setItemInfo(r),this.itemIcon.setNum(0),e.itemName.string=game.HtmlUtil.getColorStrByQuality(r.quality,r.name),this.progress.updatePro(t.jinJieExp,a.exp)}}},updateAttr:function(){var e=this.skin,t=this.data.getCurInfo();t&&(e.attrNow.string=this.getAttrDesc(t.jinJieCurSpr),t.isJJFullLv||(e.attrNext.string=this.getAttrDesc(t.jinJieNextSpr)))},getAttrDesc:function(e){return this.attrStr="",e&&(this._getAttrDesc(game.SpriteStatType.TeamHp,e.getStatValue(game.SpriteStatType.TeamHp)),this._getAttrDesc(game.SpriteStatType.TeamAtk,e.getStatValue(game.SpriteStatType.TeamAtk)),this._getAttrDesc(game.SpriteStatType.TeamDef,e.getStatValue(game.SpriteStatType.TeamDef))),this.attrStr},_getAttrDesc:function(e,t){var a=game.AttrRulesCfg.getData(e);if(a){var i=game.CCommonUtil.replaceNum(t,1);this.attrStr+=game.Lang.get(51537,a.name,i)}},updateAutoBuy:function(){this.skin.check.active=this.data.autoBuy},updateCost:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&t.jinjieCfg&&!t.isJJFullLv){var a=t.jinjieCfg.costItem[0],i=game.itemData.getNumById(a.Id),n=a.Num,s=n<=i,r=s?game.Color.GREEN:game.Color.RED;e.itemNum.string=game.HtmlUtil.getText(r,i+"/"+n),e.upgradeBtnRed.active=s,e.autoUpgradeBtnRed.active=s}},onStageResize:function(){this.setPosition(0,0)},updateUpgradeLab:function(e){var t=e?51540:51539;this.skin.autoUpgradeBtnLab.string=game.Lang.get(t)}});b8e.module.registerView(game.ME.ShenQiJinJie,e)}(),function(){var e=game.CultivateBaseModelView.extends({ctor:function(){this._super(1300),this.toggles={toggle_btn_1:game.ME.ShenQiActive,toggle_btn_2:game.ME.ShenQiJinJie,toggle_btn_5:game.ME.ShenQiStar,toggle_btn_3:game.ME.ShenQiJingLian}},init:function(){var e=this.skin;this.data=game.shenQiData;var t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.CultivateBaseListItem,t.layout.spacingX=5,t.bindEnum=this.moduleEnum,t.addToParent(e.headList),t.setScrollViewCb(this.listCb,this),this.initModel({type:game.RoleType.ShenQi,node:e.modelNode})},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_SELECT_TOGGLE:a.toggleSelect(t);break;case a.Evts.C2V_SCROLL_LEFT:a.scrollLeft();break;case a.Evts.C2V_SCROLL_RIGHT:a.scrollRight();break;case a.Evts.C2V_SELECT_CHANGE:a.setModel(),a.updateName(),a.updatePower(),a.updateRed(),a.updateStar();break;case a.Evts.C2V_UPDATE_ACTIVE:a.updateName(),a.updatePower();break;case a.Evts.C2V_UPDATE_LIST:a.updateList(),a.updateRed();break;case a.Evts.C2V_UPDATE_STAR_MAIN:a.updateStar()}},scrollLeft:function(){this.list.scrollContainerLeft()},scrollRight:function(){this.list.scrollContainerRight()},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.btn_left.node.active=n,this.leftAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.leftAlert=!0;break}if(n=0<(i=a.length),this.skin.btn_right.node.active=n,this.rightAlert=!1,n)for(var r=0;r<i;r++)if(a[r].isAlert){this.rightAlert=!0;break}this.updateLRBtnAlert(this.leftAlert,this.rightAlert)},updateLRBtnAlert:function(e,t){this.skin.l_red_spot.active=e,this.skin.r_red_spot.active=t},onShow:function(){this.toggleSelect(0),this.updateRed()},toggleSelect:function(e){this._super(e);var t=e<4;this.skin.upgradeNode.active=t,this.data.toggleId=e,t&&(this.updateList(),this.setModel(),this.updateName(),this.updatePower(),this.updateStar())},updateList:function(){var e=this.data.getInfoSortList();this.list.setData(e)},setModel:function(){var e=this.data.getCurInfo();e&&this.updateModel(game.RoleType.ShenQi,e.cfg)},updateName:function(){var e=this.data.getCurInfo();if(e){var t=e.active?game.Lang.get(51502,e.name,e.lv):e.name,a=game.HtmlUtil.getColorStrByQuality(e.cfg.quality,t);this.skin.nameLab.string=a}},updatePower:function(){var e=this.data.getCurInfo();e&&(this.skin.fightAmountLbl.string=e.getTeamPower(),this.skin.powerImg.x=-this.skin.fightAmountLbl.width/2-42)},updateStar:function(){var e=this.data.getCurInfo();if(e)for(var t=e.star,a=0;a<6;a++)this.getComponent("starIcon_"+a).active=a<t,this.getComponent("stargray_"+a).active=t<=a},updateRed:function(){var e=this.data,t=e.getCurInfo();if(t&&t.cfg){var a=this.skin,i=e.hasActive&&!this.data.battleId;a.red_spot_1.active=t.activeAlert||i||t.blessAlert,a.red_spot_2.active=t.jinJieAlert,a.red_spot_3.active=t.jingLianAlert,a.red_spot_5.active=t.starAlert}},onHide:function(){this.data.selectFirstInfo()}});b8e.module.registerView(game.ME.ShenQi,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1780),this.setSize(540,150)},setData:function(){var e=this.skin,t=this.data.cfg,a=t.star,i=this.data.getActive(),n=i?game.Color.GREEN:game.Color.BLACK,s=game.CCommonUtil.replaceChineseNum(t.masterLv),r=i?game.Lang.get(53698,t.num,s)+game.Lang.get(53699):game.Lang.get(53698,t.num,s);e.oneAttr1.string=game.HtmlUtil.getText(n,r);var o=game.shenQiData.getShowAttr(t,1);o&&0<o.length&&(this.setStatStr(e.oneAttr3,o[0].type,o[0].value,n),this.setStatStr(e.oneAttr2,o[1].type,o[1].value,n));for(var g=0;g<6;g++)this.getComponent("starIcon_"+g).active=g<a,this.getComponent("stargray_"+g).active=a<=g},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);a=a/10+"%",e.string=game.HtmlUtil.getText(i,game.Lang.get(53194,n.name,a))}}),b8e.RC("$$game","$$ShenQiBlessLockItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1779)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ShenQiBlessLockItem,e.layout.spacingY=5,e.layout.paddingLeft=5,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list)},onShow:function(){this.skin.tit_name_2.active=!1,this.skin.blessLvNode.active=!1,this.updateList()},updateList:function(){var e=game.shenQiData.getLockList();this.list.setData(e)}});b8e.module.registerView(game.ME.ShenQiBlessLock,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1778),this.setSize(540,105)},setData:function(e){var t=this.skin,a=e.cfg,i=game.shenQiData.getMasterAllLv()>=a.maxLv?game.Color.GREEN:game.Color.BLACK,n=game.CCommonUtil.replaceChineseNum(a.masterLv);t.oneAttr1.string=game.HtmlUtil.getText(i,game.Lang.get(53696,n,a.maxLv));var s=game.shenQiData.getShowAttr(a,1);s&&0<s.length&&(this.setStatStr(t.oneAttr3,s[0].type,s[0].value,i),this.setStatStr(t.oneAttr2,s[1].type,s[1].value,i))},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);a=a/10+"%",e.string=game.HtmlUtil.getText(i,game.Lang.get(53194,n.name,a))}}),b8e.RC("$$game","$$ShenQiBlessMasterItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1777)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ShenQiBlessMasterItem,e.layout.spacingY=5,e.layout.paddingLeft=5,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list)},onShow:function(){this.skin.tit_name_1.active=!1,this.skin.blessClockLab.active=!1,this.updateList()},updateList:function(){var e=game.shenQiData.getMasterList();this.list.setData(e);var t=game.shenQiData.getMasterAllLv();this.skin.blessLvLab.string=game.Lang.get(53697,t)}});b8e.module.registerView(game.ME.ShenQiBlessMaster,e)}(),function(){var e=game.CultivateBaseModelView.extends({cfgs:null,ctor:function(){this._super(1776)},init:function(){var e=this.skin;this.data=game.shenQiData;var t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.CultivateBaseListItem,t.layout.spacingX=5,t.bindEnum=game.ME.ShenQiActive,t.addToParent(e.headList),t.setScrollViewCb(this.listCb,this),this.initModel({type:game.RoleType.ShenQi,node:e.modelNode})},notify:function(e){var t=this;switch(e){case t.Evts.C2V_SCROLL_LEFT:t.scrollLeft();break;case t.Evts.C2V_SCROLL_RIGHT:t.scrollRight();break;case t.Evts.C2V_SELECT_CHANGE:t.setModel(),t.updateName(),t.updatePower(),t.updateSlot(),t.updateBless();break;case t.Evts.C2V_UPDATE_ACTIVE:t.updateName(),t.updatePower();break;case t.Evts.C2V_UPDATE_LIST:t.updateList();break;case t.Evts.V_CHANGE_SLOT:case t.Evts.C2V_UPDATA_SLOT_LEVEL:case t.Evts.C2V_UPDATE_ACTIVE_COST:t.updateSlot(),t.updateBless(),t.updatePower();break;case t.Evts.V_CHANGE_CLICK:t.updateClickBtn()}},scrollLeft:function(){this.list.scrollContainerLeft()},scrollRight:function(){this.list.scrollContainerRight()},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.btn_left.node.active=n,this.leftAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.leftAlert=!0;break}if(n=0<(i=a.length),this.skin.btn_right.node.active=n,this.rightAlert=!1,n)for(var r=0;r<i;r++)if(a[r].isAlert){this.rightAlert=!0;break}this.updateLRBtnAlert(this.leftAlert,this.rightAlert)},updateLRBtnAlert:function(e,t){this.skin.l_red_spot.active=e,this.skin.r_red_spot.active=t},onShow:function(){this.updateList(),this.setModel(),this.updateName(),this.updatePower(),this.updateClickBtn(),this.updateBless(),this.updateSlot()},updateClickBtn:function(){this.skin.check.active=this.data.clickBol},updateBless:function(){var e=this.skin,t=this.data.getCurInfo(),a=this.data.getMasterAllLv(),i=this.data.getSelectBless(),n=this.data.getNextJieLevel(t.nextJie,t.id);e.masterJieLab.string=game.Lang.get(50022,i),e.masterLab.string=game.Lang.get(50020,a,n);for(var s=this.data.getMaxLockStar(),r=0;r<6;r++)this.getComponent("starIcon_"+r).active=r<s,this.getComponent("stargray_"+r).active=s<=r},updateSlot:function(){for(var e=this,t=e.skin,a=e.data.getCurInfo(),i=e.data.slotIndex,n=!1,s=!1,r=1;r<=4;r++){e.getComponent("attrNode"+r+"_select_1").setVisible(r==i);var o=e.getComponent("attrNode"+r+"_Lab1"),g=a.getLevelBySlot(r);o.string=game.Lang.get(5902,g);var u=e.getComponent("attrNode"+r+"_Lab2"),l=e.data.getCfgBySlot(r,g),c=e.data.getShowAttr(l,2);u.active=0<g,e.getComponent("attrNode"+r+"_red").active=e.data.getRedBol(l,g),c&&0<c.length&&0<g&&e.setStatStr(u,c[0].type,c[0].value),r==i&&(n=e.data.getMaxBlessBol(g,!0),s=e.data.getMaxBlessBol(g,!1),e.cfgs=l),a.setAttrBuyIndex(l,r)}a.setAllAttr();for(var h=game.SpriteStatUtil.getSpriteStatArr(a.blessSpr),m=void 0,d=void 0,f=void 0,p=0;p<3;p++)m=h[p],((d=e.getComponent("attrLab_"+p)).active=m)&&(f=game.CCommonUtil.replaceNum(m.value,1),d.string=game.Lang.get(51537,m.name,f));if(t.noMaxNode.active=!n,!(t.maxImg.active=n)){e.costIcon||(e.costIcon=game.GridUtil.createCostItemIcon(),e.costIcon.addToParent(t.itemIcon));var v=e.cfgs.itemId;e.costIcon.setItemInfo(v);var E=game.itemData.getCountById(v),T=e.cfgs.itemNum>E?503:504;t.itemNum.string=game.Lang.get(T,E,e.cfgs.itemNum);var C=game.ItemInfoCfg.getData(v);C&&(t.itemName.string=game.HtmlUtil.getColorStrByQuality(C.quality,C.name)),t.blessOneAlert.active=!s&&E>=e.cfgs.itemNum}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t),n=game.CCommonUtil.replaceNum(a,1);e.string=game.Lang.get(51537,i.name,n)},updateList:function(){var e=this.data.getInfoSortList();this.list.setData(e)},setModel:function(){var e=this.data.getCurInfo();e&&this.updateModel(game.RoleType.ShenQi,e.cfg)},updateName:function(){var e=this.data.getCurInfo();if(e){var t=e.active?game.Lang.get(51502,e.name,e.lv):e.name,a=game.HtmlUtil.getColorStrByQuality(e.cfg.quality,t);this.skin.nameLab.string=a}},updatePower:function(){var e=this.data.getCurInfo();e&&(this.skin.fightAmountLbl.string=e.getTeamPower(),this.skin.powerImg.x=-this.skin.fightAmountLbl.width/2-42)}});b8e.module.registerView(game.ME.ShenQiBless,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1775)},init:function(){this.data=game.shenQiData;var e=this.skin;this.skillIcon=new game.CultivateBaseSkillIcon,this.skillIcon.setClickCallBack(this.data.openStarSkillTips,this.data),this.skillIcon.addToParent(e.skillNode),this.itemIcon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105),this.itemIcon.addToParent(e.itemNode)},notify:function(e){switch(e){case this.Evts.C2V_SELECT_CHANGE:case this.Evts.C2V_UPDATA_STAR:this.updateView(),this.updateAttr(),this.updateCost();break;case this.Evts.C2V_UPDATE_ACTIVE_COST:this.updateCost()}},onShow:function(){this.updateView(),this.updateAttr(),this.updateCost()},onHide:function(){this.send(this.Evts.V2C_CLOSE_VIEW)},updateView:function(){var e=this.skin,t=this.data.getCurInfo();if(t){var a=t.star,i=t.id,n=this.data.getCfgStar(i,a),s=n.skillId;game.SkillCfg.getData(s)&&this.skillIcon.setData(s);var r=t.isMaxStar;if(e.maxNode.active=r,e.notMaxNode.active=!r,r)this.clearRightLab();else{var o=n.itemId,g=game.ItemInfoCfg.getData(o);if(!g)return;this.itemIcon.setItemInfo(g),this.itemIcon.setNum(0),e.itemName.string=game.HtmlUtil.getColorStrByQuality(g.quality,g.name)}}},clearRightLab:function(){var e=this.skin;e.rightAttrLab_0.string="",e.rightAttrLab_1.string="",e.rightAttrLab_2.string="",e.rightAttrLab_3.string=""},updateAttr:function(){var e=this,t=e.skin,a=e.data.getCurInfo();if(a){var i=a.id,n=a.star,s=e.data.getCfgStar(i,n),r=e.data.getShowAttr(s,3);e.setStatStr(t.leftAttrLab_0,r[0].type,r[0].value),e.setStatStr(t.leftAttrLab_1,r[1].type,r[1].value),e.setStatStr(t.leftAttrLab_2,r[2].type,r[2].value);var o=game.SkillCfg.getData(s.skillId);if(t.leftAttrLab_3.string=game.Lang.get(51588,o.name,n),!a.isMaxStar){var g=n+1,u=e.data.getCfgStar(i,g),l=e.data.getShowAttr(u,3);e.setStatStr(t.rightAttrLab_0,l[0].type,l[0].value),e.setStatStr(t.rightAttrLab_1,l[1].type,l[1].value),e.setStatStr(t.rightAttrLab_2,l[2].type,l[2].value);var c=game.SkillCfg.getData(s.skillId);t.rightAttrLab_3.string=game.Lang.get(51588,c.name,g)}}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51537,i.name,game.CCommonUtil.replaceNum(a,0))},updateCost:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&!t.isMaxStar){var a=t.id,i=t.star,n=this.data.getCfgStar(a,i),s=n.itemId,r=game.itemData.getNumById(s),o=n.itemNum,g=o<=r,u=g?game.Color.GREEN:game.Color.RED;e.itemNum.string=game.HtmlUtil.getText(u,r+"/"+o),e.upStarAlert.active=g}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ShenQiStar,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1371),this.setSize(540,154)},init:function(){this.skillIcon=new game.CultivateBaseSkillIcon,this.skillIcon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin;t.selectBg.active=e.isCurLv;var a=e.skillCfg;if(a){this.skillIcon.setData(a.id),t.name.string=a.name;var i=game.LangSkill.get(a.desc,a.descParam),n=e.isCurLv?51617:51616;t.skillDesc.string=game.Lang.get(n,i)}for(var s=e.star,r=0;r<6;r++)this.getComponent("starIcon"+r).active=r<s,this.getComponent("stargray"+r).active=s<=r}}),b8e.RC("$$game","$$ShenQiStarSkillTipsItem",e)}(),function(){var e=game.CommonSkillTipsView.extends({init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ShenQiStarSkillTipsItem,e.layout.spacingY=5,e.layout.paddingLeft=5,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list),e.setScrollViewCb(this.listCb,this)},onShow:function(){this.updateList()},updateList:function(){var e;e=game.shenQiStarSkillTipsData.getSkillInfos(),this.list.setData(e)}});b8e.module.registerView(game.ME.ShenQiStarSkillTips,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1367)},init:function(){var e=this.surfaceModel=new game.SurfaceModel;e.addToParent(this.skin.model),e.initModel(game.RoleType.ShenQi),e.roleData.heroModel.type=game.RoleType.ShenQi},onShow:function(){var e=this;e.timer=b8e.Timer.add(e,e.updateTime,500),e.dataInfo=game.shenQiData.getCurInfo(),e.updateBaseInfo(),e.updateStar(),e.updateDesc(),e.endTime=game.SysTime.curTime+3e3,e.timer&&(e.timer.reset(),e.timer.start())},onHide:function(){this.timer&&this.timer.stop(),this.surfaceModel&&this.surfaceModel.role&&game.AvatarUtil.clearFosterMode(this.surfaceModel.role)},updateTime:function(){var e=this.endTime-game.SysTime.curTime;e<=0?game.module.hide(this.moduleEnum):this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},updateBaseInfo:function(){var e=this.dataInfo;this.skin.name.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.cfg.name),this.updateModel(e.cfg)},updateStar:function(){for(var e=this.dataInfo.star,t=0;t<6;t++)this.getComponent("starIcon"+t).active=t<e,this.getComponent("stargray"+t).active=e<=t},updateModel:function(e){var t=this.surfaceModel;if(t&&e){t.y=e.uiOffsetY?e.uiOffsetY:0;var a=e.uiScale?e.uiScale:1,i=t.role;i&&((i.getAnimator(game.AnimType.BODY,1)||i.addAnimator(game.AnimType.BODY,1)).setScale(a,a),game.AvatarUtil.updateModel(e,t,game.RoleType.ShenQi))}},updateDesc:function(){var e=this.skin,t=this.dataInfo.id,a=this.dataInfo.star,i=game.shenQiData.getCfgStar(t,a),n=game.shenQiData.getShowAttr(i,3),s="";s=this.setStatStr(s,n[0].type,n[0].value),s=this.setStatStr(s,n[1].type,n[1].value),s=this.setStatStr(s,n[2].type,n[2].value);var r=game.SkillCfg.getData(i.skillId);s+=game.Lang.get(51588,r.name,a),e.spriteStatDesc.string=s,this.updateLayout()},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);return e+game.Lang.get(51537,i.name,game.CCommonUtil.replaceNum(a,0))},updateLayout:function(){var e=this.skin,t=e.spriteStatDesc.height;e.mask.height=t+60}});b8e.module.registerView(game.ME.ShenQiStarSuccess,e)}(),function(){var e;e=b8e.Enum({NONE:0,INTENSIFY:1,REFINE:2,PURIFY:3,GEM:4,ZHULING:5,FUSE:6,MAX:7}),b8e.RC("$$game","$$EquipForgeMasterType",e)}(),function(){var e;e=b8e.Object.extends({roleId:0,forgeType:0,name:"",isSelect:!1,setData:function(e,t,a,i){this.roleId=t,this.name=e,this.forgeType=a,this.isSelect=i},updateSelect:function(e){this.isSelect=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$EquipForgeAlertSetInfo",e)}(),function(){var e=b8e.Object.extends({setInfo:function(e){this.info=e},getInfo:function(){return this.info}});game.equipForgeAttrTipsData=game.equipForgeAttrTipsData||new e}(),function(){var e=b8e.Object.extends({setInfo:function(e){this.info=e},getInfo:function(){return this.info}});game.equipForgeLvUpTipsData=game.equipForgeLvUpTipsData||new e}(),function(){var e;e=b8e.Object.extends({id:0,slot:0,intensifySlLv:0,intensifySlStageLv:0,refineSlLv:0,refineSlStageLv:0,purifySllv:0,purifySlStageLv:0,gemSlLv:0,gemSlStageLv:0,zhulingSlLv:0,zhulingSlStageLv:0,fuseSlLv:0,fuseSlStageLv:0,fuseStarSkillCfg:0,fuseStarSkillAmout:0,intensifySlCfg:null,refineSlCfg:null,purifySlCfg:null,gemSlCfg:null,zhulingCfg:null,fuseCfg:null,intensifySlFightAmount:0,refineSlFightAmount:0,purifySlFightAmount:0,gemSlFightAmount:0,zhulingSlFightAmount:0,fuseSlFightAmount:0,allSLFightAmount:0,isAlert:!1,ctor:function(){this.intensifySlSpriteStat=game.SpriteStat.get(),this.refineSlSpriteStat=game.SpriteStat.get(),this.purifySlSpriteStat=game.SpriteStat.get(),this.gemSlSpriteStat=game.SpriteStat.get(),this.zhulingSlSpriteStat=game.SpriteStat.get(),this.fuseSlSpriteStat=game.SpriteStat.get(),this.fuseStarSkillSpriteStat=game.SpriteStat.get(),this.slotMap=b8e.HashMap.get()},onRoleForgeUp:function(e,t){for(var a=t.length,i=0;i<a;i++){var n=t[i];if(n){var s=n.slot,r=this.slotMap.get(s);if(r&&r.equipInfo){var o=game.equipForgeData.getConfigEquipType2(s);if(!o)return void b8e.error("[\u953b\u9020]\u69fd\u4f4d\u7c7b\u578b\u9519\u8bef"+s);var g=r.equipInfo.intensifyFightAmount,u=r.equipInfo.refineFightAmount,l=r.equipInfo.purifyFightAmount;r.equipInfo.onSlotForgeUp(o,e,n.lv),game.equipIntensifyData.updateAllFightAmount(g,r.equipInfo.intensifyFightAmount),game.equipRefineData.updateAllFightAmount(u,r.equipInfo.refineFightAmount),game.equipPurifyData.updateAllFightAmount(l,r.equipInfo.purifyFightAmount)}}}this.updateSuolianInfoByType(e)},onRoleGemUp:function(e,t){var a=this.slotMap.get(e);if(a&&a.equipInfo){var i=a.equipInfo.gemFightAmount;a.equipInfo.onSlotGemsUp(t),game.equipGemData.updateAllFightAmount(i,a.equipInfo.gemFightAmount),this.updateSuolianInfoByType(game.EquipForgeType.GEM)}},onRoleZhulingUp:function(e,t,a){var i=this.slotMap.get(e);if(i&&i.equipInfo){var n=i.equipInfo.zhulingFightAmount;i.equipInfo.onSlotZhulingUp(t,a),game.equipZhulingData.updateAllFightAmount(n,i.equipInfo.zhulingFightAmount),this.updateSuolianInfoByType(game.EquipForgeType.ZHULING)}},onRoleFuseUp:function(e,t){var a=this.slotMap.get(e);if(a&&a.equipInfo){var i=a.equipInfo.fuseFightAmount;a.equipInfo.onSlotFuseUp(t),game.equipFuseData.updateAllFightAmount(i,a.equipInfo.fuseFightAmount),this.updateSuolianInfoByType(game.EquipForgeType.FUSE),this.updateStarSkill()}},updateStarSkill:function(){var e=game.equipFuseData.getEquipList(),t=0,a=void 0;if(e&&3<e.length){var i=void 0;t=6;for(var n=0;n<e.length&&(i=e[n],t=Math.min(i.fuseLv,t),i.itemCfg);n++)if(a){if(a!=i.itemCfg.suit){a=null;break}}else a=i.itemCfg.suit}var s=null;a&&0<t&&(s=game.ForgeFuseSuitCfg.getData(a,t)),this.fuseStarSkillCfg=s;var r=this.fuseStarSkillAmout;this.fuseStarSkillAmout=0,this.fuseStarSkillSpriteStat.clear(),this.fuseStarSkillSpriteStat.setupByCfg(this.fuseStarSkillCfg,!1),this.fuseStarSkillAmout+=game.CCommonUtil.getPower(this.fuseStarSkillSpriteStat),game.equipForgeData.updateAllFightAmount(r,this.fuseStarSkillAmout)},updateAllAlertByTyp:function(e){var t=game.partnerData.getSlotInfoBySlot(this.slot);if(t){var a=!1;this.checkAlert(t,e)&&(a=!0),t.isForgeAlert=a}},checkAlert:function(e,t){if(!e||!e.id)return!1;var a=game.EquipForgeType,i=!1;switch(t){case a.INTENSIFY:i=game.equipIntensifyData.checkAlert(this);break;case a.REFINE:i=game.equipRefineData.checkAlert(this);break;case a.PURIFY:i=game.equipPurifyData.checkAlert(this);break;case a.GEM:i=game.equipGemData.checkAlert(this);break;case a.ZHULING:i=game.equipZhulingData.checkAlert(this);break;case a.FUSE:i=game.equipFuseData.checkAlert(this)}return i},setData:function(e){if(e){this.updateSlotsInfo(e);for(var t=game.EquipForgeType.MAX,a=game.EquipForgeType.NONE+1;a<t;a++)this.updateSuolianInfoByType(a)}},getSuolianInfo:function(e){var t=this,a=game.EquipForgeType,i=0,n=0,s=null,r=null;switch(e){case a.INTENSIFY:i=t.intensifySlLv,n=t.intensifySlStageLv,s=t.intensifySlCfg,r=t.intensifySlSpriteStat;break;case a.REFINE:i=t.refineSlLv,n=t.refineSlStageLv,s=t.refineSlCfg,r=t.refineSlSpriteStat;break;case a.PURIFY:i=t.purifySllv,n=t.purifySlStageLv,s=t.purifySlCfg,r=t.purifySlSpriteStat;break;case a.GEM:i=t.gemSlLv,n=t.gemSlStageLv,s=t.gemSlCfg,r=t.gemSlSpriteStat;break;case a.ZHULING:i=t.zhulingSlLv,n=t.zhulingSlStageLv,s=t.zhulingCfg,r=t.zhulingSlSpriteStat;break;case a.FUSE:i=t.fuseSlLv,n=t.fuseSlStageLv,s=t.fuseCfg,r=t.fuseSlSpriteStat;break;default:return void b8e.error("[\u953b\u9020]\u9501\u94fe\u7c7b\u578b\u9519\u8bef")}return{suolianlv:i,suolianStageLv:n,suoliancfg:s,suolianSpriteStat:r}},updateSuolianInfoByType:function(e){var t=void 0,a=void 0,i=void 0,n=game.EquipForgeType,s=void 0,r=void 0,o=void 0,g=void 0;switch(e){case n.INTENSIFY:g=game.equipIntensifyData,t="_$intensifySlLv",a="_$intensifySlStageLv",i="_$intensifySlCfg",s="_$intensifylv",r="_$intensifySlSpriteStat",o="_$intensifySlFightAmount";break;case n.REFINE:g=game.equipRefineData,t="_$refineSlLv",a="_$refineSlStageLv",i="_$refineSlCfg",s="_$refinelv",r="_$refineSlSpriteStat",o="_$refineSlFightAmount";break;case n.PURIFY:g=game.equipPurifyData,t="_$purifySllv",a="_$purifySlStageLv",i="_$purifySlCfg",s="_$purifylv",r="_$purifySlSpriteStat",o="_$purifySlFightAmount";break;case n.GEM:g=game.equipGemData,t="_$gemSlLv",a="_$gemSlStageLv",i="_$gemSlCfg",s="_$gemlv",r="_$gemSlSpriteStat",o="_$gemSlFightAmount";break;case n.ZHULING:g=game.equipZhulingData,t="_$zhulingSlLv",a="_$zhulingSlStageLv",i="_$zhulingCfg",s="_$zhulinglv",r="_$zhulingSlSpriteStat",o="_$zhulingSlFightAmount";break;case n.FUSE:g=game.equipFuseData,t="_$fuseSlLv",a="_$fuseSlStageLv",i="_$fuseCfg",s="_$fuseLv",r="_$fuseSlSpriteStat",o="_$fuseSlFightAmount"}this.updateSLInfo(g,s,t,a,i,r,o)},updateSLInfo:function(e,t,a,i,n,s,r){var o=this;if(e){var g=e.maxLv,u=e.suoLianMaxLv,l=e.masterType,c=b8e.getNormP(a),h=b8e.getNormP(t),m=b8e.getNormP(i),d=b8e.getNormP(n),f=b8e.getNormP(s);o[f].clear();for(var p=o.slotMap.values(),v=p.length,E=0;E<v;E++){var T=p[E];if(T&&!T.isTreasure){var C=T[h];C<g&&(g=C)}}o[c]=g;var I=game.ForgeMasterCfg.getAllDataByMasterType(l)||[],S=I.length,_=u;I.sort(o.onSort);for(var A=null,y=0;y<S;y++){var D=I[y];if(D.upgradeLv<=g){_=D.lv,A=D;break}}if(null==A||_<=0)return o[m]=0,void(o[d]=null);if(o[m]=_,o[d]=A){var L=b8e.getNormP(r),b=o[L];o[f].setupByCfg(A),o[L]=game.CCommonUtil.getPower(o[f]),o.allSLFightAmount-=b,o.allSLFightAmount+=o[L],game.equipForgeData.updateAllFightAmount(b,o[L])}}},onSort:function(e,t){return t.upgradeLv-e.upgradeLv},updateSlotsInfo:function(e){this.id=e.id,this.slot=e.slot,this.equipIdxMap=e.equipIdxMap;for(var t=game.equipForgeData.maxSlotNum,a=0;a<t;a++){var i=a+1,n=this.slotMap.get(i),s=(n=n||new game.EquipForgeSlotInfo).equipInfo?n.equipInfo.intensifyFightAmount:0,r=n.equipInfo?n.equipInfo.refineFightAmount:0,o=n.equipInfo?n.equipInfo.purifyFightAmount:0,g=n.equipInfo?n.equipInfo.gemFightAmount:0,u=n.equipInfo?n.equipInfo.zhulingFightAmount:0,l=this.equipIdxMap.get(i);n.setData(this.id,i,l),this.slotMap.set(i,n),game.equipIntensifyData.updateAllFightAmount(s,n.equipInfo?n.equipInfo.intensifyFightAmount:0),game.equipRefineData.updateAllFightAmount(r,n.equipInfo?n.equipInfo.refineFightAmount:0),game.equipPurifyData.updateAllFightAmount(o,n.equipInfo?n.equipInfo.purifyFightAmount:0),game.equipGemData.updateAllFightAmount(g,n.equipInfo?n.equipInfo.gemFightAmount:0),game.equipZhulingData.updateAllFightAmount(u,n.equipInfo?n.equipInfo.zhulingFightAmount:0)}},getGemUpSlotsByOne:function(e,t,a,i){var n=this.slotMap.get(e);if(n){var s=n.gemMap.get(t);if(s){for(var r=0,o=0;o<a;o++){for(var g=s.gemlv+o,u=s.canGem(g,i.tmpCheckCostItemMap),l=!1,c=i.tmpCheckCostItemMap.values(),h=0;h<c.length;h++){var m=c[h];if(!(0<=m.leftNum)){m.leftNum=m.preLeftNum,l=!0;break}}if(l)break;if(!u)break;r+=1}if(!(r<=0))return{slot:t,lv:r}}}},getLvUpSlotsByOne:function(e,t,a,i){var n=this.slotMap.get(t);if(n){for(var s=0,r=n.getSlotLvByForgeType(e),o=0;o<a;o++){for(var g=r+o,u=n.checkForgeUpByTargetLv(e,g,i.tmpCheckCostItemMap),l=!1,c=i.tmpCheckCostItemMap.values(),h=0;h<c.length;h++){var m=c[h];if(!(0<=m.leftNum)){m.leftNum=m.preLeftNum,l=!0;break}}if(l)break;if(!u)break;s+=1}if(!(s<=0))return{slot:t,lv:s}}},getGemUpSlots:function(e,t,a,i){var n=[],s=game.equipGemData;if(s.tmpCheckCostItemMap||(s.tmpCheckCostItemMap=b8e.HashMap.get()),s.tmpCheckCostItemMap.clear(),i)for(var r=e<5?1:5,o=e<5?5:7;r<o;r++){var g=this.slotMap.get(r);if(g){for(var u=g.gemMap.values(),l=(u=this.sortByLv(game.EquipForgeType.GEM,u)).length,c=[],h=0;h<l;h++){var m=u[h].gemSlotId;if(m){var d=this.getGemUpSlotsByOne(r,m,5,s);d&&c.push(d)}}if(c&&c.length){var f={equipSlot:r,gemSlots:c};n.push(f)}}}else{var p=this.getGemUpSlotsByOne(e,t,a,s);if(p){var v={equipSlot:e,gemSlots:p};n.push(v)}}return n},getLvUpSlots:function(e,t,a,i){var n=[],s=null,r=game.EquipForgeType;switch(e){case r.INTENSIFY:s=game.equipIntensifyData;break;case r.REFINE:s=game.equipRefineData;break;case r.PURIFY:s=game.equipPurifyData;break;default:return void b8e.error("[\u953b\u9020]\u7c7b\u578b\u9519\u8bef")}if(s.tmpCheckCostItemMap||(s.tmpCheckCostItemMap=b8e.HashMap.get()),s.tmpCheckCostItemMap.clear(),i)for(var o=game.equipForgeData,g=o.getConfigEquipType2(t),u=this.slotMap.values(),l=(u=this.sortByLv(e,u)).length,c=0;c<l;c++){var h=u[c],m=h.slotId;if(o.getConfigEquipType2(m)==g&&h.equipId){var d=this.getLvUpSlotsByOne(e,m,5,s);d&&n.push(d)}}else{var f=this.getLvUpSlotsByOne(e,t,a,s);f&&n.push(f)}return n},sortByLv:function(e,t){var a=game.EquipForgeType;switch(e){case a.INTENSIFY:return t.sort(this.sortByIntensifylv);case a.REFINE:return t.sort(this.sortByRefinelv);case a.PURIFY:return t.sort(this.sortByPurifylv);case a.GEM:return t.sort(this.sortByGemlv);default:return t}},sortByIntensifylv:function(e,t){return e.intensifylv-t.intensifylv},sortByRefinelv:function(e,t){return e.refinelv-t.refinelv},sortByPurifylv:function(e,t){return e.purifylv-t.purifylv},sortByGemlv:function(e,t){return e.gemlv-t.gemlv}}),b8e.RC("$$game","$$EquipForgeRoleInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,slotId:0,gemSlotId:0,gemCfg:null,gemlv:0,setData:function(e,t){this.id=e,this.slotId=t},updateGemInfo:function(e,t){this.gemSlotId=e,this.gemlv=t,this.updateGemCfg()},updateGemCfg:function(){var e=this,t=game.equipForgeData.getConfigEquipType3(e.slotId);t?(e.gemCfg=game.ForgeGemCfg.getData(t,e.gemSlotId,e.gemlv),e.gemCfg&&(e.gemSpriteStat||(e.gemSpriteStat=game.SpriteStat.get()),e.gemSpriteStat.clear(),e.gemSpriteStat.setupByCfg(e.gemCfg))):b8e.error("[\u953b\u9020]\u69fd\u4f4d\u7c7b\u578b\u9519\u8bef")},onSlotGemUp:function(e){this.gemlv=e,this.updateGemCfg()},canGem:function(e,t){var a=0<arguments.length&&void 0!==e?e:-1,i=1<arguments.length&&void 0!==t?t:null;if(!game.moduleOpen.checkOpen(game.ME.EquipGem))return!1;var n=game.EquipForgeType.GEM,s=game.equipForgeData.getEquipForgeLimitLv(n,this.slotId),r=game.equipForgeData.getEquipForgeMaxLv(n,this.slotId);if(-1!=a){var o=game.equipForgeData.getConfigEquipType3(this.slotId),g=game.ForgeGemCfg.getData(o,this.gemSlotId,a);if(!g)return!1;return r<=a||s<=a?!(game.equipForgeData.isMaxLv=!0):game.equipForgeData.getCanForgeUp(g,n,0,i)}if(!game.equipForgeData.getIsAlertByRoleForgeType(this.id,n))return!1;var u=this.gemlv;if(r<=u||s<=u)return!1;var l=b8e.HashMap.get();return game.equipForgeData.getCanForgeUp(this.gemCfg,n,0,l)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$EquipForgeSlotGemInfo",e)}(),function(){var e;e=b8e.Object.extends({quality:{get:function(){return this.equipInfo&&this.equipInfo.cfg?this.equipInfo.cfg.quality:0}},equipId:{get:function(){return this.equipInfo?this.equipInfo.id:0}},equipName:{get:function(){return this.equipInfo&&this.equipInfo.cfg?this.equipInfo.cfg.name:""}},itemCfg:{get:function(){if(this.equipInfo)return this.equipInfo.cfg}},intensifyCfg:{get:function(){if(this.equipInfo)return this.equipInfo.intensifyCfg}},refineCfg:{get:function(){if(this.equipInfo)return this.equipInfo.refineCfg}},purifyCfg:{get:function(){if(this.equipInfo)return this.equipInfo.purifyCfg}},costIntensifyCfg:{get:function(){if(this.equipInfo)return this.equipInfo.costIntensifyCfg}},costRefineCfg:{get:function(){if(this.equipInfo)return this.equipInfo.costRefineCfg}},costPurifyCfg:{get:function(){if(this.equipInfo)return this.equipInfo.costPurifyCfg}},costZhulingCfg:{get:function(){if(this.equipInfo)return this.equipInfo.costZhulingCfg}},costFuseCfg:{get:function(){if(this.equipInfo)return this.equipInfo.costFuseCfg}},_gemMap:null,gemMap:{get:function(){return this.equipInfo?this.equipInfo.gemMap:(this._gemMap||(this._gemMap=b8e.HashMap.get()),this._gemMap)}},intensifylv:{get:function(){return this.equipInfo?this.equipInfo.intensifylv:0}},refinelv:{get:function(){return this.equipInfo?this.equipInfo.refinelv:0}},purifylv:{get:function(){return this.equipInfo?this.equipInfo.purifylv:0}},gemlv:{get:function(){return this.equipInfo?this.equipInfo.gemlv:0}},zhulinglv:{get:function(){return this.equipInfo?this.equipInfo.zhulingLv:0}},zhulingExp:{get:function(){return this.equipInfo?this.equipInfo.zhulingExp:0}},fuseLv:{get:function(){return this.equipInfo?this.equipInfo.fuseLv:0}},id:0,slotId:0,equipInfo:null,intensifyAlert:!1,refineAlert:!1,purifyAlert:!1,gemAlert:!1,zhulingAlert:!1,fuseAlert:!1,isTreasure:!1,idx:0,setData:function(e,t,a){if(this.id=e,this.slotId=t,this.idx=a,this.isTreasure=5==t||6==t,a){this.equipInfo=game.partnerEquipData.getWearEquipInfo(t,a);for(var i=1;i<=3;i++){var n=this.equipInfo.gemMap.get(i);(n=n||new game.EquipForgeSlotGemInfo).setData(this.id,this.slotId)}}else this.equipInfo=null},getSlotLvByForgeType:function(e){var t=game.EquipForgeType,a=0;switch(e){case t.INTENSIFY:a=this.intensifylv;break;case t.REFINE:a=this.refinelv;break;case t.PURIFY:a=this.purifylv;break;case t.GEM:a=this.gemlv;break;case t.ZHULING:a=this.zhulinglv;break;case t.FUSE:a=this.fuseLv}return a},checkAlertByForgeType:function(e){var t=game.EquipForgeType,a=!1;switch(e){case t.INTENSIFY:a=this.intensifyAlert;break;case t.REFINE:a=this.refineAlert;break;case t.PURIFY:a=this.purifyAlert;break;case t.GEM:a=this.gemAlert;break;case t.ZHULING:a=this.zhulingAlert;break;case t.FUSE:a=this.fuseAlert}return a},checkForgeAlert:function(e){var t=this,a=game.EquipForgeType,i=!1;switch(e){case a.INTENSIFY:t.intensifyAlert=t.canIntensify(),i=t.intensifyAlert;break;case a.REFINE:t.refineAlert=t.canRefine(),i=t.refineAlert;break;case a.PURIFY:t.purifyAlert=t.canPurity(),i=t.purifyAlert;break;case a.GEM:t.gemAlert=t.canGem(),i=t.gemAlert;break;case a.ZHULING:t.zhulingAlert=t.canZhuling(),i=t.zhulingAlert;break;case a.FUSE:t.fuseAlert=t.canFuse(),i=t.fuseAlert}return i},checkForgeUpByTargetLv:function(e,t,a){var i=game.EquipForgeType,n=!1;switch(e){case i.INTENSIFY:n=this.canIntensify(t,a);break;case i.REFINE:n=this.canRefine(t,a);break;case i.PURIFY:n=this.canPurity(t,a)}return n},canGem:function(){if(!game.moduleOpen.checkOpen(game.ME.EquipGem))return!1;if(!this.equipId)return!1;for(var e=this.gemMap.values(),t=e.length,a=0;a<t;a++){var i=e[a];if(i)if(this.canGemByGemSlot(i.gemSlotId))return!0}return!1},canGemByGemSlot:function(e){var t=this.gemMap.get(e);return!!t&&t.canGem()},canPurity:function(e,t){var a=0<arguments.length&&void 0!==e?e:-1,i=1<arguments.length&&void 0!==t?t:null;if(!game.moduleOpen.checkOpen(game.ME.EquipPurify))return!1;var n=game.EquipForgeType.PURIFY,s=game.equipForgeData.getEquipForgeLimitLv(n,this.slotId),r=game.equipForgeData.getEquipForgeMaxLv(n,this.slotId),o=this.itemCfg,g=o?o.level:0;if(-1!=a){var u=game.equipForgeData.getConfigEquipType2(this.slotId),l=game.ForgePurifyCfg.getData(u,a);if(!l)return!1;return r<=a||s<=a?!(game.equipForgeData.isMaxLv=!0):game.equipForgeData.getCanForgeUp(l,n,g,i)}if(!game.equipForgeData.getIsAlertByRoleForgeType(this.id,n))return!1;var c=this.purifylv;if(r<=c||s<=c)return!1;var h=b8e.HashMap.get();return game.equipForgeData.getCanForgeUp(this.costPurifyCfg,n,g,h)},canRefine:function(e,t){var a=0<arguments.length&&void 0!==e?e:-1,i=1<arguments.length&&void 0!==t?t:null;if(!game.moduleOpen.checkOpen(game.ME.EquipRefine))return!1;var n=game.EquipForgeType.REFINE,s=game.equipForgeData.getEquipForgeLimitLv(n,this.slotId),r=game.equipForgeData.getEquipForgeMaxLv(n,this.slotId),o=this.itemCfg,g=o?o.level:0;if(-1!=a){var u=game.equipForgeData.getConfigEquipType2(this.slotId),l=game.ForgeRefineCfg.getData(u,a);if(!l)return!1;return r<=a||s<=a?!(game.equipForgeData.isMaxLv=!0):game.equipForgeData.getCanForgeUp(l,n,g,i)}if(!game.equipForgeData.getIsAlertByRoleForgeType(this.id,n))return!1;var c=this.refinelv;if(r<=c||s<=c)return!1;var h=b8e.HashMap.get();return game.equipForgeData.getCanForgeUp(this.costRefineCfg,n,g,h)},canIntensify:function(e,t){var a=0<arguments.length&&void 0!==e?e:-1,i=1<arguments.length&&void 0!==t?t:null,n=game.EquipForgeType.INTENSIFY;if(!game.moduleOpen.checkOpen(game.ME.EquipIntensify))return!1;var s=game.equipForgeData.getEquipForgeLimitLv(n,this.slotId),r=game.equipForgeData.getEquipForgeMaxLv(n,this.slotId),o=this.itemCfg,g=o?o.level:0;if(-1!=a){var u=game.equipForgeData.getConfigEquipType2(this.slotId),l=game.ForgeUpgradeCfg.getData(u,a);if(!l)return!1;return r<=a||s<=a?!(game.equipForgeData.isMaxLv=!0):game.equipForgeData.getCanForgeUp(l,n,g,i)}if(!game.equipForgeData.getIsAlertByRoleForgeType(this.id,n))return!1;var c=this.intensifylv;if(r<=c||s<=c)return!1;var h=b8e.HashMap.get();return game.equipForgeData.getCanForgeUp(this.costIntensifyCfg,n,g,h)},canZhuling:function(){var e=game.EquipForgeType.ZHULING;if(!game.moduleOpen.checkOpen(game.ME.EquipZhuling))return!1;if(!game.equipForgeData.getIsAlertByRoleForgeType(this.id,e))return!1;if(this.quality<game.Quality.Q_UNPARALLELED)return!1;var t=this.zhulinglv;if(game.equipForgeData.getEquipForgeMaxLv(e,this.slotId)<=t)return!1;var a=b8e.HashMap.get();return game.equipForgeData.getCanForgeUp(this.costZhulingCfg,e,t,a)},canFuse:function(){var e=game.EquipForgeType.FUSE;if(!game.moduleOpen.checkOpen(game.ME.EquipFuse))return!1;if(!game.equipForgeData.getIsAlertByRoleForgeType(this.id,e))return!1;if(this.quality<game.Quality.Q_UNPARALLELED)return!1;var t=this.fuseLv;if(game.equipForgeData.getEquipForgeMaxLv(e,this.slotId)<=t)return!1;var a=this.costFuseCfg;if(a){var i=game.equipData.getItemNumById(a.equipId);return a.num<=i}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$EquipForgeSlotInfo",e)}(),function(){var e;e=b8e.Object.extends({forgeNameLangKey:0,forgeName:null,forgeType:0,maxLv:0,treasureMaxLv:0,suoLianMaxLv:0,stepUpLv:0,isUpAll:!0,suolianBtn:null,masterType:null,allFightAmount:0,updateAllFightAmount:function(e,t){this.allFightAmount-=e,this.allFightAmount+=t,game.equipForgeData.updateAllFightAmount(e,t)},setup:function(){this.forgeName=game.Lang.get(this.forgeNameLangKey);var e=0,t=0,a=0,i=0,n=game.EquipForgeType;switch(this.forgeType){case n.INTENSIFY:t="upgradeMaxLv",e="upgradeTreasureMaxLv",a="upgradeMasterMaxLv",i="upgradeStepUpLv";break;case n.REFINE:t="refineMaxLv",e="refineTreasureMaxLv",a="refineMasterMaxLv",i="refineStepUpLv";break;case n.PURIFY:t="purifyMaxLv",e="purifyTreasureMaxLv",a="purifyMasterMaxLv",i="purifyStepUpLv";break;case n.GEM:t="gemStoneMaxLv",e="gemStoneTreasureMaxLv",a="gemStoneMasterMaxLv",i="gemStepUpLv";break;case n.ZHULING:t="zhulingMaxLv",e="zhulingTreasureMaxLv",a="zhulingMasterMaxLv";break;case n.FUSE:t="fuseMaxLv",e="fuseTreasureMaxLv",a="fuseMasterMaxLv"}var s=game.ForgeMiscCfg,r=s.getData(t);r&&r.value&&(this.maxLv=+r.value);var o=s.getData(a);o&&o.value&&(this.suoLianMaxLv=+o.value);var g=s.getData(i);g&&g.value&&(this.stepUpLv=+g.value);var u=s.getData(e);u&&u.value&&(this.treasureMaxLv=+u.value)},checkAlert:function(e){if(!game.moduleOpen.checkOpen(game.ME.EquipForge))return!1;if(!e||!e.slotMap)return!1;for(var t=e.slotMap.values(),a=t.length,i=!1,n=0;n<a;n++){var s=t[n];s&&s.checkForgeAlert(this.forgeType)&&(i=!0)}return i},checkAllAlert:function(){if(!game.moduleOpen.checkOpen(game.ME.EquipForge))return!1;for(var e=game.equipForgeData.getPartnerList()||[],t=e.length,a=0;a<t;a++){var i=e[a];if(i){if(!i.id)return!1;var n=i.forgeInfo;if(n)if(this.checkAlert(n))return!0}}return!1}}),b8e.RC("$$game","$$ForgeData",e)}(),function(){var e;e=game.Control.extends({forgeType:0,forgeInfo:null,forgeAlert:null,ipc:function(){var e=this;e.evts={MainRole:{C_LEVEL_UP:e.updateAllAlertView},Back:{C_UPDATE_AMOUNT:e.updateItemInfo,C_BACK_UPDATE_ITEMINFO:e.updateItemInfo},EquipForge:{C2C_INIT_DATA:e.onInit,DPT_SELECT_CHANGE:e.onSelectChange,DPT_SELECT_TOGGLE:e.onSelectToggle,C2C_FORGE_SUCCEED:e.upgradeSuccessful,DPT_SELECT_GEM:e.onSelectGem},EquipForgeAlertSet:{C2V_UPDATE:e.updateAllAlertView}}},updateAllAlertView:function(){this.checkAlert(),this.updateHeadListAlert(),this.send(this.Evts.C2V_UPDATE),this.dpt(this.Evts.DPT_UPDATE_SLOTS)},notify:function(e){switch(e){case this.Evts.V_ONSHOW:this.onViewShow()}},onViewShow:function(){this.updateHeadListAlert()},updateItemInfo:function(){this.updateAllAlertView()},upgradeSuccessful:function(){this.updateAllAlertView()},updateHeadListAlert:function(){this.forgeType==game.equipForgeData.forgeType&&game.moduleOpen.checkOpen(this.moduleEnum)&&(game.equipForgeData.updateAllAlertByTyp(this.forgeType),this.dpt(this.Evts.C2C_UPDATE_HEADLIST))},onSelectToggle:function(){this.forgeType==game.equipForgeData.forgeType&&this.updateAllAlertView()},onSelectChange:function(){this.forgeType==game.equipForgeData.forgeType&&(this.updateHeadListAlert(),this.send(this.Evts.C2V_UPDATE))},onSelectGem:function(){this.forgeType==game.equipForgeData.forgeType&&this.send(this.Evts.C2V_UPDATE)},onInit:function(){this.checkAlert()},checkAlert:function(){this.forgeAlert.alert=this.forgeInfo.checkAllAlert()},btn_suolian:function(){game.equipForgeAttrTipsData.setInfo({forgeInfo:this.forgeInfo,selectRole:game.equipForgeData.selectRole}),game.module.show(game.ME.EquipForgeAttrTips)},tips:function(){game.module.show(game.ME.Sell)},autoUpBtn:function(){this.forgeInfo.isUpAll=!this.forgeInfo.isUpAll,this.send(this.Evts.C2V_UPDATE_CHECK)},getForgeSlotInfo:function(){return game.equipForgeData.getCurEquipInfo()},checkCostEnough:function(e){for(var t=game.equipForgeData.getCostInfoArrByForgeType(e,this.forgeType),a=0;a<t.length;a++){var i=t[a],n=i.costItem,s=i.costNum,r=game.amount.getAmountTypeById(n);if((0<r?game.amount.get(r):game.itemData.getNumById(n))<s)return game.notice.show(51380),!1}return!0},resetCostCheckCond:function(){game.equipForgeData.isCostNoEnoughInfo=null,game.equipForgeData.isCostNoEnough=!1,game.equipForgeData.isMaxLv=!1},checkCostCond:function(e){if(e.length<=0){if(game.equipForgeData.isCostNoEnough){var t=game.equipForgeData.isCostNoEnoughInfo;return t?game.UpgradeUtil.checkUpgradeCost([{Id:t.Id,Num:t.Num}],!0,!0):game.notice.show(51366),!1}return game.equipForgeData.isMaxLv?game.notice.show(51367):game.notice.show(51379),!1}return!0},sendUp:function(e){var t,a=this.getForgeSlotInfo(),i=game.equipForgeData.getCurForgeRoleInfo();if(i){var n=a.slotId,s=this.forgeInfo.isUpAll;if(this.resetCostCheckCond(),t=i.getLvUpSlots(this.forgeType,n,e,s)||[],this.checkCostCond(t)){var r=a.id,o=game.equipForgeData.getHuobanInfoByHuobanId(r);if(o&&o.battlePos){var g=o.battlePos,u={forgeType:this.forgeType,slot:g,equips:t};this.sendForge(u)}}}},sendForge:function(e){e&&this.dpt(this.Evts.C_REQ_FORGE,e)},upBtn:function(){this.sendUp(1)},upBtnMore:function(){this.sendUp(game.equipForgeData.forgeStepUpLv)}}),b8e.RC("$$game","$$ForgeControl",e)}(),function(){var e;e=game.CultivateBaseView.extends({ctor:function(e){this._super(e)},init:function(){this.itemArr=[]},notify:function(e){switch(e){case this.Evts.C2V_UPDATE:this.updateData();break;case this.Evts.C2V_UPDATE_CHECK:this.updateCheck()}},setData:function(e,t,a){this.moduleData=game.equipForgeData,this.forgeData=e,this.forCfg=t,this.forgeType=a},onShow:function(){this.updateData(),this.send(this.Evts.V_ONSHOW)},updateData:function(){var e=this;e.updateSuolian();var t=e.moduleData.getCurEquipInfo();e.updateLv(t);var a=e.getAttr(t),i=e.getNextAttr(t);e.updateAttr(t,a,i);var n=game.equipForgeData.getCostInfoArrByForgeType(t,e.forgeType);e.updateCost(t,n),e.forgeData.suolianBtn||(e.forgeData.suolianBtn=e.skin.btn_suolian);var s=game.equipForgeData.forgeStepUpLv;if(e.skin.lbl_upMore.string=game.Lang.get(e.attrLangKey,s),t){var r=t.getSlotLvByForgeType(e.forgeType),o=t.isTreasure?e.forgeData.treasureMaxLv:e.forgeData.maxLv,g=e.forgeData.forgeName;e.skin.autoLabel.string=o-r<=0?game.Lang.get(51382,g):game.Lang.get(51381,g,s)}},updateSuolian:function(){var e=this.skin,t=this.moduleData.getCurRoleSuolianInfo(this.forgeType);if(t){e.lbl_stage.string=game.Lang.get(51394,t.suolianStageLv);var a=game.ResCfg.getUrl(10085,this.forgeType);e.icon_suolian.loadTexture(a);var i=t.suoliancfg,n=i?i.upgradeLv:0,s=i?i.lv+1:1,r=this.forgeData.suoLianMaxLv;r<s&&(s=r);var o=game.ForgeMasterCfg.getMasterConfig(this.forgeData.masterType,s);o&&(n=o.upgradeLv),e.lbl_suolianlv.string=t.suolianlv+"/"+n}},updateLv:function(e){if(e){var t=this.skin,a=this.forgeType==game.EquipForgeType.GEM;if(!a)if(a)t.lv.setVisible(!1);else{var i=e&&0!=e.equipId;if(t.lv.setVisible(i),i){var n=this.lvLangKey,s=this.getEquipInfoLv(e);t.lbl_prog.string=game.Lang.get(n,s)}}}},updateLvUpBtn:function(e){var t=this.skin,a=game.mainRoleData.lv>=this.forgeData.stepUpLv;t.upBtn.setVisible(!a),t.upBtnMore.setVisible(a);var i=this.checkAlert(e);t.redPoint_up.setVisible(i),t.redPoint_upMore.setVisible(i)},checkAlert:function(e){return!!e&&e.checkAlertByForgeType(this.forgeType)},updateCost:function(e,t){if(e){var a=this.skin,i=0!=e.equipId;if(a.cost_noEquip.setVisible(!i),a.cost_hasEquip.setVisible(i),i){var n=this.getEquipInfoLv(e),s=(e.isTreasure?this.forgeData.treasureMaxLv:this.forgeData.maxLv)<=n;a.isMax_cost.setVisible(s),a.isNoMax_cost.setVisible(!s),s||(this.updateCostItems(t),this.updateLvUpBtn(e),this.updateCheck())}}},updateCheck:function(){this.skin.check.setVisible(this.forgeData.isUpAll)},updateCostItems:function(e){this.skin;if(e)for(var t=0;t<2;t++){var a=e[t],i=t+1,n=this.getComponent("cost_"+i);if(n.setVisible(a),a){var s="",r=0,o=a.costItem,g=a.costNum,u=game.amount.getAmountTypeById(o);r=0<u?game.amount.get(u):game.itemData.getNumById(o);var l=game.ItemInfoCfg.getData(o);if(l){var c=this.itemArr[t];c||((c=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105)).addToParent(n),this.itemArr[t]=c),c.setItemInfo(l,!1,!1),s=game.HtmlUtil.getColorStrByQuality(l.quality,l.name)}this.getComponent("costName_"+i).string=s;var h=g<=r?51389:51388;this.getComponent("costNum_"+i).string=game.Lang.get(h,game.CCommonUtil.replaceNum(r,2),g)}}},updateAttr:function(e,t,a){var i=this,n=i.skin,s=e&&0<e.equipId;if(n.attr_hasEquip.setVisible(s),s&&t){var r=i.getEquipInfoLv(e),o=(e.isTreasure?i.forgeData.treasureMaxLv:i.forgeData.maxLv)<=r;i.skin.isMax_attr.setVisible(o),i.skin.isNoMax_attr.setVisible(!o),n.arrow.setVisible(!o),n.cur_lv.string=game.Lang.get(i.attrLangKey,r),n.max_lv.string=o?game.Lang.get(i.attrLangKey,r):"";for(var g=1;g<=2;g++){var u=o?"max_attr_"+g:"cur_attr_"+g,l=t[g-1];if(!l){var c=a[g-1];(l={type:0,value:0}).type=c?c.type:0}var h="";if(l.type){var m=game.AttrRulesCfg.getData(l.type);if(!m)continue;h=game.Lang.get(51390,m.name,l.value+(l.isPer?"%":""))}i.getComponent(u).string=h}if(!o&&(n.next_lv.string=game.Lang.get(i.attrLangKey,r+1),a&&0<a.length))for(var d=1;d<=2;d++){var f="",p=a[d-1];if(p){var v=game.AttrRulesCfg.getData(p.type);p.type&&v&&(f=v.name?game.Lang.get(51390,v.name,p.value+(p.isPer?"%":"")):"")}i.getComponent("next_attr_"+d).string=f}}else n.arrow.setVisible(!0)},getEquipInfoLv:function(){},getAttr:function(e){if(e){var t=this.getEquipInfoLv(e),a=e.equipId;if(a){var i=e.isTreasure?this.forgeData.treasureMaxLv:this.forgeData.maxLv;i<=t&&(t=i);for(var n=this.forCfg.getShowAttr(this.forgeType,a,t),s=this.forCfg.getShowAttrPercent(this.forgeType,a,t),r=s.length,o=0;o<r;o++)n.push(s[o]);return n}}},getNextAttr:function(e){if(e){var t=this.getEquipInfoLv(e),a=e.equipId;if(a){var i=t+1,n=e.isTreasure?this.forgeData.treasureMaxLv:this.forgeData.maxLv;n<=i&&(i=n);for(var s=this.forCfg.getShowAttr(this.forgeType,a,i),r=this.forCfg.getShowAttrPercent(this.forgeType,a,i),o=r.length,g=0;g<o;g++)s.push(r[g]);return s}}},getCostId:function(){},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$ForgeView",e)}(),function(){var e;e=b8e.Enum({NONE:0,C_SELECTCHANGE:-1,C2V_UPDATE_DATA:-1,C2C_INIT_DATA:-1,V_UPDATE_MID_MODEL:-1,V_ONSHOW:-1,DPT_SELECT_CHANGE:-1,V_CHANGE_FORGETYPE:-1,C2V_UPDATE_ITEM:-1,C2C_SELECT_ALERT:-1,V2C_CONFIRM_SELECT_ALERT:-1,C2V_UPDATE_LIST:-1,ON_HIDE:-1,C2V_UPDATE_TIME:-1,ON_SHOW:-1,V_CHANGE_GEM:-1,C2C_CHANGE_EQUIP:-1,C2V_UPDATE:-1,C2V_PLAY_SLOT_EFF:-1,C_REQ_FORGE:-1,C2V_PLAY_GEM_SLOT_EFF:-1,C2C_FORGE_SUCCEED:-1,C2V_UPDATE_COST:-1,C2V_UPDATE_CHECK:-1,C2C_UPDATE_HEADLIST:-1,C2V_UPDATE_HEADLIST:-1,DPT_SELECT_TOGGLE:-1,DPT_UPDATE_SLOTS:-1,C2V_UPDATE_SLOTS:-1,DPT_SELECT_GEM:-1,C2C_PLAY_GEM_SELECT_EFF:-1,C2V_PLAY_GEM_SELECT_EFF:-1,C2C_UPDATE_EQUIP_POWER:-1}),b8e.RC("$$game","$$EquipForgeEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.equipForgeData},ipc:function(){var e=this;e.evts={Partner:{C_INIT_DATA:e.initData},EquipIntensify:{C_REQ_FORGE:e.onForgeUpReq,C2C_UPDATE_HEADLIST:e.updateHeadList,DPT_UPDATE_SLOTS:e.updateSlots},EquipRefine:{C_REQ_FORGE:e.onForgeUpReq,C2C_UPDATE_HEADLIST:e.updateHeadList,DPT_UPDATE_SLOTS:e.updateSlots},EquipPurify:{C_REQ_FORGE:e.onForgeUpReq,C2C_UPDATE_HEADLIST:e.updateHeadList,DPT_UPDATE_SLOTS:e.updateSlots},EquipGem:{C_REQ_FORGE:e.onForgeGemUpReq,C2C_UPDATE_HEADLIST:e.updateHeadList,DPT_UPDATE_SLOTS:e.updateSlots,C2C_PLAY_GEM_SELECT_EFF:e.onShowGem},EquipZhuling:{C_REQ_FORGE:e.onForgeZhulingUpReq,C2C_UPDATE_HEADLIST:e.updateHeadList,DPT_UPDATE_SLOTS:e.updateSlots},EquipFuse:{C_REQ_FORGE:e.onForgeFuseReq,C2C_UPDATE_HEADLIST:e.updateHeadList,DPT_UPDATE_SLOTS:e.updateSlots}},e.handels={PartnerEquipForgeResp:e.onForgeUpResp,PartnerEquipGemResp:e.onForgeGemUpResp,PartnerEquipZhulingResp:e.onForgeZhulingResp,PartnerEquipFuseResp:e.fuseResp}},updateHeadList:function(){this.send(this.Evts.C2V_UPDATE_HEADLIST)},onShowGem:function(){this.send(this.Evts.C2V_PLAY_GEM_SELECT_EFF)},updateSlots:function(){this.send(this.Evts.C2V_UPDATE_SLOTS)},onForgeGemUpReq:function(e){var t=e.data;if(t){var a=t.slot,i=t.equips;i&&0!=i.length&&this.sender.PartnerEquipGemReq(a,i)}},onForgeZhulingUpReq:function(e){var t=e.data;if(t){var a=t.slot,i=t.equipSlot,n=t.slots?1:0;this.sender.PartnerEquipZhulingReq(a,i,n)}},onForgeFuseReq:function(e){var t=e.data;if(t){var a=t.slot,i=t.equipSlot,n=t.idx;this.sender.PartnerEquipFuseReq(a,i,n)}},onForgeUpReq:function(e){var t=e.data;if(t){var a=t.slot,i=t.forgeType,n=t.equips;if(n&&0!=n.length){var s=game.EquipForgeRpType.NONE;switch(i){case game.EquipForgeType.INTENSIFY:s=game.EquipForgeRpType.INTENSIFY;break;case game.EquipForgeType.REFINE:s=game.EquipForgeRpType.REFINE;break;case game.EquipForgeType.PURIFY:s=game.EquipForgeRpType.PURIFY}this.sender.PartnerEquipForgeReq(a,s,n)}}},onForgeGemUpResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipGemResponse);if(0<t.code){game.notice.noticeError(t.code)}else{var a=t.slot,i=t.equips,n=game.equipForgeData.getForgeRoleInfo(a);if(n){var s=n.getSuolianInfo(game.EquipForgeType.GEM).suolianStageLv;game.equipForgeData.onGemUp(a,i);var r=game.partnerData.getSlotInfoBySlot(a);r&&(game.FightAmount.inst().setNomalStat(r.allSpriteStat),r.updateAllStat(),game.FightAmount.inst().setUpdatedStat(r.allSpriteStat)),this.send(this.Evts.C2V_PLAY_GEM_SLOT_EFF,i),this.dpt(this.Evts.C2C_FORGE_SUCCEED),s!=n.getSuolianInfo(game.EquipForgeType.GEM).suolianStageLv&&(game.equipForgeLvUpTipsData.setInfo({role:n,forgeType:game.EquipForgeType.GEM,masterType:game.EquipForgeMasterType.GEM}),game.module.show(game.ME.EquipForgeLvUpTips)),a&&a<5&&this.dpt(this.Evts.C2C_UPDATE_EQUIP_POWER),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeMosaic)}}},onForgeUpResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipForgeResponse);if(0<t.code){game.notice.noticeError(t.code)}else{var a=t.slot,i=t.types,n=t.equips,s=game.equipForgeData.getForgeRoleInfo(a);if(s){var r=game.EquipForgeType.NONE,o=game.EquipForgeMasterType.NONE;switch(i){case game.EquipForgeRpType.INTENSIFY:r=game.EquipForgeType.INTENSIFY,o=game.EquipForgeMasterType.INTENSIFY,game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeStrengthen);break;case game.EquipForgeRpType.REFINE:r=game.EquipForgeType.REFINE,o=game.EquipForgeMasterType.REFINE,game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeTemper);break;case game.EquipForgeRpType.PURIFY:r=game.EquipForgeType.PURIFY,o=game.EquipForgeMasterType.PURIFY,game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeAttach)}if(r!=game.EquipForgeType.NONE){var g=s.getSuolianInfo(r).suolianStageLv;game.equipForgeData.onForgeUp(a,r,n);var u=game.partnerData.getSlotInfoBySlot(a);u&&(game.FightAmount.inst().setNomalStat(u.allSpriteStat),u.updateAllStat(),game.FightAmount.inst().setUpdatedStat(u.allSpriteStat)),s&&this.send(this.Evts.C2V_PLAY_SLOT_EFF,n),g!=s.getSuolianInfo(r).suolianStageLv&&(game.equipForgeLvUpTipsData.setInfo({role:s,forgeType:r,masterType:o}),game.module.show(game.ME.EquipForgeLvUpTips)),this.send(this.Evts.C2V_UPDATE_DATA),this.dpt(this.Evts.C2C_FORGE_SUCCEED),a&&a<5&&this.dpt(this.Evts.C2C_UPDATE_EQUIP_POWER)}}}},onForgeZhulingResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipZhulingResponse);if(0<t.code){game.notice.noticeError(t.code)}else{var a=t.partnerSlot,i=t.equipSlot,n=t.lv,s=t.exp,r=game.equipForgeData.getForgeRoleInfo(a);if(r){var o=r.getSuolianInfo(game.EquipForgeType.ZHULING).suolianStageLv,g=game.partnerData.getSlotInfoBySlot(a);game.equipForgeData.onZhulingUp(a,i,n,s),g&&(game.FightAmount.inst().setNomalStat(g.allSpriteStat),g.updateAllStat(),game.FightAmount.inst().setUpdatedStat(g.allSpriteStat)),this.dpt(this.Evts.C2C_FORGE_SUCCEED),o!=r.getSuolianInfo(game.EquipForgeType.ZHULING).suolianStageLv&&(game.equipForgeLvUpTipsData.setInfo({role:r,forgeType:game.EquipForgeType.ZHULING,masterType:game.EquipForgeMasterType.ZHULING}),game.module.show(game.ME.EquipForgeLvUpTips))}}},fuseResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipFuseResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.slot,i=t.equipSlot,n=t.fuseLv,s=game.equipForgeData.getForgeRoleInfo(a);if(s){var r=game.partnerData.getSlotInfoBySlot(a);game.equipForgeData.onFuseUp(a,i,n),r&&(game.FightAmount.inst().setNomalStat(r.allSpriteStat),r.updateAllStat(),game.FightAmount.inst().setUpdatedStat(r.allSpriteStat)),this.dpt(this.Evts.C2C_FORGE_SUCCEED),s.getSuolianInfo(game.EquipForgeType.FUSE).suolianStageLv!=s.getSuolianInfo(game.EquipForgeType.FUSE).suolianStageLv&&(game.equipForgeLvUpTipsData.setInfo({role:s,forgeType:game.EquipForgeType.FUSE,masterType:game.EquipForgeMasterType.FUSE}),game.module.show(game.ME.EquipForgeLvUpTips))}}},notify:function(e,t){var a=this;switch(e){case game.PartnerEvts.C_SELECTCHANGE:if(!a.moduleData.selectSlotInfoBySlot(t))return;a.checkEquipSelect(),a.send(a.Evts.C2V_UPDATE_DATA),a.dpt(a.Evts.DPT_SELECT_CHANGE);break;case a.Evts.V_ONSHOW:a.moduleData.selectFirstSlotInfo(),a.checkEquipSelect(),a.send(a.Evts.C2V_UPDATE_DATA),a.dpt(a.Evts.DPT_SELECT_CHANGE);break;case game.EquipForgeEvts.C2C_CHANGE_EQUIP:if(t==a.moduleData.selectEquip)return;a.checkEquipSelect(t),a.send(a.Evts.C2V_UPDATE_DATA),a.dpt(a.Evts.DPT_SELECT_CHANGE)}},checkEquipSelect:function(e){e=e||this.moduleData.checkEquipDefaultSelect(),this.moduleData.selectEquip=e},initData:function(){this.moduleData.syncModelDatas(),this.dpt(this.Evts.C2C_INIT_DATA)},selectToggle:function(e){var t=game.EquipForgeType.NONE;switch(e){case 0:t=game.EquipForgeType.INTENSIFY;break;case 1:t=game.EquipForgeType.REFINE;break;case 2:t=game.EquipForgeType.GEM;break;case 3:t=game.EquipForgeType.PURIFY;break;case 4:t=game.EquipForgeType.ZHULING;break;case 5:t=game.EquipForgeType.FUSE}this.send(this.Evts.V_CHANGE_FORGETYPE,e,t),this.dpt(this.Evts.DPT_SELECT_TOGGLE)},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},btn_3:function(){this.selectToggle(2)},btn_4:function(){this.selectToggle(3)},btn_5:function(){this.selectToggle(4)},btn_6:function(){this.selectToggle(5)},selectGem:function(e){this.send(this.Evts.V_CHANGE_GEM,e),this.dpt(this.Evts.DPT_SELECT_GEM)},btn_gem_1:function(){this.selectGem(1)},btn_gem_2:function(){this.selectGem(2)},btn_gem_3:function(){this.selectGem(3)},btn_shezhi:function(){game.module.show(game.ME.EquipForgeAlertSet)}}),t=game.Sender.extends({ipc:function(){this.msg={PartnerEquipForgeReq:this.forgeReq,PartnerEquipGemReq:this.gemReq,PartnerEquipZhulingReq:this.zhulingReq,PartnerEquipFuseReq:this.fuseReq}},gemReq:function(e,t){var a=game.pb.PartnerEquipGemRequest;a.slot=e,a.equips=t,this.write(a)},forgeReq:function(e,t,a){var i=game.pb.PartnerEquipForgeRequest;i.slot=e,i.types=t,i.equips=a,this.write(i)},zhulingReq:function(e,t,a){var i=game.pb.PartnerEquipZhulingRequest;i.partnerSlot=e,i.equipSlot=t,i.autoType=a,this.write(i)},fuseReq:function(e,t,a){var i=game.pb.PartnerEquipFuseRequest;i.slot=e,i.equipSlot=t,i.idx=a,this.write(i)}});b8e.module.registerControl(game.ME.EquipForge,e,game.EquipForgeEvts,t)}(),function(){var e=b8e.Object.extends({ctor:function(){var e=this;e.forgeType=game.EquipForgeType.INTENSIFY,e.selectEquip=1,e.selectGem=1,e.maxSlotNum=6,e.upgradeStepUpLv=-1,e.refineStepUpLv=-1,e.purifyStepUpLv=-1,e.gemStepUpLv=-1,e.forgeStepUpLv=0,e.equipGemIcons=[],e.treasureGemIcons_1=[],e.treasureGemIcons_2=[],e.partnerData=game.partnerData,e.allFightAmount=0,e.isCostNoEnough=!1,e.isCostNoEnoughInfo=null,e.isMaxLv=!1},selectRole:{get:function(){return this.partnerData.selectSlot||0}},getPartnerList:function(){return this.partnerData.partnerSlots||[]},selectFirstSlotInfo:function(){this.partnerData.selectFirstSlotInfo()},selectSlotInfoBySlot:function(e){return e.id?e.slot!==this.selectRole&&(e.info.isMainRole&&b8e.module.isShowView(game.ME.PartnerUpgrade)?(game.notice.show(51444),!1):e.info.isMainRole&&b8e.module.isShowView(game.ME.PartnerStar)?(game.notice.show(51445),!1):(this.partnerData.selectSlotInfoBySlot(e.slot),!0)):(this.partnerData.changeSlot=e,game.module.show(game.ME.PartnerChange),!1)},getForgeRoleInfo:function(e){var t=this.partnerData.getSlotInfoBySlot(e);if(t)return t.forgeInfo},getCurForgeRoleInfo:function(){return this.getForgeRoleInfo(this.selectRole)},getConfigEquipType3:function(e){return e<=4?1:5==e?2:6==e?3:0},getConfigEquipType2:function(e){return e<=4?1:5==e||6==e?2:0},initMisc:function(){var e=game.ForgeMiscCfg,t=e.getData("upgradeStepUpLv");t&&t.value&&(this.upgradeStepUpLv=+t.value);var a=e.getData("refineStepUpLv");a&&a.value&&(this.refineStepUpLv=+a.value);var i=e.getData("purifyStepUpLv");i&&i.value&&(this.purifyStepUpLv=+i.value);var n=e.getData("gemStepUpLv");n&&n.value&&(this.gemStepUpLv=+n.value);var s=e.getData("forgeStepUpLv");s&&s.value&&(this.forgeStepUpLv=+s.value);var r=e.getData("equipGemIcons");r&&r.value&&(this.equipGemIcons=r.value.split(","));var o=e.getData("treasureGemIconOne");o&&o.value&&(this.treasureGemIcons_1=o.value.split(","));var g=e.getData("treasureGemIconTwo");g&&g.value&&(this.treasureGemIcons_2=g.value.split(","))},syncModelDatas:function(){this.initMisc(),game.equipIntensifyData.setup(),game.equipRefineData.setup(),game.equipPurifyData.setup(),game.equipGemData.setup(),game.equipZhulingData.setup(),game.equipFuseData.setup(),this.initForgeInfo()},initForgeInfo:function(){for(var e=game.partnerData.partnerSlots||[],t=e.length,a=0;a<t;a++){var i=e[a];i&&i.forgeInfo&&i.forgeInfo.setData(i)}},getEquipInfo:function(e,t){var a=this.getForgeRoleInfo(e);if(a)return a.slotMap.get(t)},getCurEquipInfo:function(){return this.getEquipInfo(this.selectRole,this.selectEquip)},getEquipInfoByCurRole:function(e){return this.getEquipInfo(this.selectRole,e)},getCurSelectGem:function(){var e=this.getCurEquipInfo();if(e)return e.gemMap.get(this.selectGem)},getGemInfo:function(e,t,a){var i=this.getEquipInfo(e,t);if(i)return i.gemMap.get(a)},getCurRoleSuolianInfo:function(e){var t=this.getCurForgeRoleInfo();if(t)return t.getSuolianInfo(e)},getEquipForgeMaxLv:function(e,t){var a=game.EquipForgeType,i=0,n=this.checkIsTreasure(t);switch(e){case a.INTENSIFY:i=n?game.equipIntensifyData.treasureMaxLv:game.equipIntensifyData.maxLv;break;case a.GEM:i=n?game.equipGemData.treasureMaxLv:game.equipGemData.maxLv;break;case a.REFINE:i=n?game.equipRefineData.treasureMaxLv:game.equipRefineData.maxLv;break;case a.PURIFY:i=n?game.equipPurifyData.treasureMaxLv:game.equipPurifyData.maxLv;break;case a.ZHULING:i=n?game.equipZhulingData.treasureMaxLv:game.equipZhulingData.maxLv;break;case a.FUSE:i=n?game.equipFuseData.treasureMaxLv:game.equipFuseData.maxLv}return i},checkIsTreasure:function(e){return 5==e||6==e},getEquipForgeLimitLv:function(e,t){var a=game.EquipForgeType,i=0,n=game.equipForgeData.checkIsTreasure(t);switch(e){case a.INTENSIFY:i=n?game.mainRoleData.lv:2*game.mainRoleData.lv;break;case a.GEM:case a.REFINE:i=game.mainRoleData.lv;break;case a.PURIFY:i=Math.floor(game.mainRoleData.lv/3)}return i},getTreasureForgeLimitLv:function(e){var t=game.EquipForgeType,a=0;switch(e){case t.INTENSIFY:case t.GEM:case t.PURIFY:a=game.mainRoleData.lv;break;case t.REFINE:a=Math.floor(game.mainRoleData.lv/3)}return a},updateAllAlertByTyp:function(e){for(var t=this.getPartnerList()||[],a=t.length,i=0;i<a;i++){var n=t[i];n&&n.forgeInfo&&n.forgeInfo.updateAllAlertByTyp(e)}},getHuobanInfoByHuobanId:function(e){return this.partnerData.partnerInfoMap.get(e)},onForgeUp:function(e,t,a){var i=this.getForgeRoleInfo(e);i&&i.onRoleForgeUp(t,a)},onGemUp:function(e,t){var a=this.getForgeRoleInfo(e);if(a&&t&&t.length)for(var i=0,n=t.length;i<n;i++){var s=t[i];a.onRoleGemUp(s.equipSlot,s.gemSlots)}},onZhulingUp:function(e,t,a,i){var n=this.getForgeRoleInfo(e);n&&n.onRoleZhulingUp(t,a,i)},onFuseUp:function(e,t,a){var i=this.getForgeRoleInfo(e);i&&i.onRoleFuseUp(t,a)},getIsAlertByRoleForgeType:function(e,t){var a=this.getHuobanInfoByHuobanId(e);if(!a)return!0;var i=a.alertMap.get(t);return!!i&&!i.isSelect},getSelectAlertInfoArr:function(e){var t=[],a=this.getForgeRoleInfo(e);if(!a)return t;var i=this.getHuobanInfoByHuobanId(a.id);if(!i||!i.alertMap)return t;for(var n=game.EquipForgeType.MAX,s=game.EquipForgeType.NONE+1;s<n;s++){var r=i.alertMap.get(s);r&&t.push(r)}return t},selectAlertSetting:function(e,t,a){var i=this.getHuobanInfoByHuobanId(e);if(i){var n=i.alertMap.get(t);n&&n.updateSelect(a)}},getAlertInfo:function(e){var t=this.getHuobanInfoByHuobanId(e);if(!t)return 0;for(var a=0,i=game.EquipForgeType.MAX,n=game.EquipForgeType.NONE+1;n<i;n++){var s=t.alertMap.get(n);s&&(a|=s.isSelect<<n-1)}return a},getCostInfoArrByForgeType:function(e,t){var a=null;if(!e)return[];var i=e.itemCfg,n=i?i.level:0;switch(t){case game.EquipForgeType.INTENSIFY:a=this.getIntensityCost(e.costIntensifyCfg,n);break;case game.EquipForgeType.PURIFY:a=this.getPurityCost(e.costPurifyCfg,n);break;case game.EquipForgeType.REFINE:a=this.getRefineCost(e.costRefineCfg,n);break;case game.EquipForgeType.ZHULING:a=this.getZhulingCost(e.costZhulingCfg);break;case game.EquipForgeType.FUSE:a=this.getFuseCost(e.costFuseCfg);break;case game.EquipForgeType.GEM:var s=game.equipForgeData.getCurSelectGem();if(!s)return[];a=this.getGemCost(s.gemCfg)}return a||[]},getCostInfoArrByForgeConfig:function(e,t,a){var i=null;if(!e)return[];switch(a){case game.EquipForgeType.INTENSIFY:i=this.getIntensityCost(e,t);break;case game.EquipForgeType.PURIFY:i=this.getPurityCost(e,t);break;case game.EquipForgeType.REFINE:i=this.getRefineCost(e,t);break;case game.EquipForgeType.GEM:i=this.getGemCost(e);break;case game.EquipForgeType.ZHULING:i=this.getZhulingCost(e);break;case game.EquipForgeType.FUSE:i=this.getFuseCost(e)}return i||[]},getGemCost:function(e){var t=e;if(t){var a=[];return a.push({costItem:t.itemId,costNum:t.itemNum}),a}},getZhulingCost:function(e){var t=e;if(t){var a=[];return a.push({costItem:t.itemId,costNum:t.itemNum}),a}},getRefineCost:function(e,t){var a=e;if(a){var i=a.itemNum;i=game.ForgeRefineCfg.getCostNum(t,i);var n=[];return n.push({costItem:a.itemId,costNum:i}),0<a.itemId2&&n.push({costItem:a.itemId2,costNum:a.itemNum2}),n}},getFuseCost:function(e){var t=e;if(t){var a=[];return a.push({costItem:t.equipId,costNum:t.num}),a}},getPurityCost:function(e,t){var a=[],i=e;if(i){var n=i.itemNum;n=game.ForgePurifyCfg.getCostNum(t,n);var s={costItem:i.itemId,costNum:n};return a.push(s),a}},getIntensityCost:function(e,t){var a=e;if(a){var i=[],n=a.itemId,s=a.itemNum;if(s=game.ForgeUpgradeCfg.getCostNum(t,s),n){var r={costItem:n,costNum:s};return i.push(r),i}}},getCanForgeUp:function(e,t,a,i){if(!e)return!1;for(var n=game.equipForgeData.getCostInfoArrByForgeConfig(e,a,t),s=0,r=n.length,o=0;o<r;o++){var g=n[o],u=g.costItem,l=g.costNum,c=i.get(u),h=0;if(c)h=c.leftNum;else{var m=game.amount.getAmountTypeById(u);h=0<m?game.amount.get(m):game.itemData.getNumById(u),i.set(u,{leftNum:h,preLeftNum:h})}var d=h-l;if(i.set(u,{leftNum:d,preLeftNum:h}),d<0){var f=game.equipForgeData.isCostNoEnoughInfo;f||((f={}).Id=u,f.Num=l,game.equipForgeData.isCostNoEnoughInfo=f),game.equipForgeData.isCostNoEnough=!0;break}s+=1}return r<=s},getTotalCostByType:function(e,t,a){var i=0,n=0,s=e.cfg?e.cfg.level:0,r=this.getConfigEquipType2(e.pos);switch(t){case game.EquipForgeType.INTENSIFY:i=e.intensifylv;var o=game.ForgeUpgradeCfg.getData(r,i);if(!o)return;0<o.itemId&&0<(n=game.ForgeUpgradeCfg.getCostNum(s,o.totalNum))&&a.push(game.ItemUtil.createBaseItemInfo(o.itemId,n));break;case game.EquipForgeType.REFINE:i=e.refinelv;var g=game.ForgeRefineCfg.getData(r,i);if(!g)return;0<g.itemId&&0<(n=game.ForgeRefineCfg.getCostNum(s,g.totalNum))&&a.push(game.ItemUtil.createBaseItemInfo(g.itemId,n)),0<g.itemId2&&0<g.totalNum2&&a.push(game.ItemUtil.createBaseItemInfo(g.itemId2,g.totalNum2));break;case game.EquipForgeType.PURIFY:i=e.purifylv;var u=game.ForgePurifyCfg.getData(r,i);if(!u)return;n=game.ForgePurifyCfg.getCostNum(s,u.totalNum),0<u.itemId&&0<n&&a.push(game.ItemUtil.createBaseItemInfo(u.itemId,n));break;case game.EquipForgeType.GEM:if(!e)return;var l=e.gemMap;if(l)for(var c=l.values(),h=c.length,m=0;m<h;m++){var d=c[m];if(d){var f=d.gemCfg;f&&0<f.itemId&&0<f.totalNum&&a.push(game.ItemUtil.createBaseItemInfo(f.itemId,f.totalNum))}}break;case game.EquipForgeType.ZHULING:i=e.zhulingLv;var p=e.zhulingExp,v=game.ForgeZhulingCfg.getData(e.id,i);if(!v)return;n=game.ForgeZhulingCfg.getCostNum(e.id,i,p),0<v.itemId&&0<n&&a.push(game.ItemUtil.createBaseItemInfo(v.itemId,n));break;case game.EquipForgeType.FUSE:i=e.fuseLv;var E=game.ForgeFuseCfg.getData(e.id,i);if(!E)return;var T=E.recycleItems;T&&0<T.length&&(n=T[0].Num,0<T[0].Id&&0<n&&a.push(game.ItemUtil.createBaseItemInfo(T[0].Id,n)))}},getTotalCostByEquipInfo:function(e){var t=this;return t.totalCostArr||(t.totalCostArr=[]),t.clearList(t.totalCostArr),e&&(t.getTotalCostByType(e,game.EquipForgeType.INTENSIFY,t.totalCostArr),t.getTotalCostByType(e,game.EquipForgeType.REFINE,t.totalCostArr),t.getTotalCostByType(e,game.EquipForgeType.GEM,t.totalCostArr),t.getTotalCostByType(e,game.EquipForgeType.PURIFY,t.totalCostArr),t.getTotalCostByType(e,game.EquipForgeType.ZHULING,t.totalCostArr),t.getTotalCostByType(e,game.EquipForgeType.FUSE,t.totalCostArr)),t.totalCostArr},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},updateAllFightAmount:function(e,t){this.allFightAmount-=e,this.allFightAmount+=t},getSLFightAmountBySlot:function(e){var t=this.getForgeRoleInfo(e);return t?t.allSLFightAmount:0},getAllLvNumByForgeType:function(e){for(var a=0,t=game.partnerData.partnerSlots||[],i=t.length,n=0;n<i;n++){var s=t[n];if(s)for(var r=s.forgeInfo.slotMap.values(),o=r.length,g=0;g<o;g++){var u=r[g];u&&(e!=game.EquipForgeType.GEM?a+=u.getSlotLvByForgeType(e):u.gemMap.forEach(function(e,t){a+=t.gemlv},this))}}return a},checkEquipDefaultSelect:function(){var e=1;if(!this.getCurForgeRoleInfo())return e;for(var t=1;t<=6;t++){var a=this.getEquipInfo(this.selectRole,t);if(a&&a.equipId){e=t;var i=a.slotId;if(1==i||3==i||5==i)return e=i}}return e}});game.equipForgeData=game.equipForgeData||new e}(),function(){var e=game.CultivateBaseView.extends({_showModel:!0,ctor:function(){this._super(342),this.toggles={toggle_btn_1:game.ME.EquipIntensify,toggle_btn_2:game.ME.EquipRefine,toggle_btn_3:game.ME.EquipGem,toggle_btn_4:game.ME.EquipPurify,toggle_btn_5:game.ME.EquipZhuling,toggle_btn_6:game.ME.EquipFuse},this.spotAlerts={EQUIP_INTENSIFY:this.intensifyAlert,EQUIP_REFINE:this.refineAlert,EQUIP_GEM:this.gemAlert,EQUIP_PURIFY:this.purifyAlert,EQUIP_ZHULING:this.zhulingAlert,EQUIP_FUSE:this.fuseAlert}},init:function(){var e=this;e.moduleData=game.equipForgeData,e.equipSprite=b8e.Sprite.get(),e.equipSprite.setAnchor(.5,.5),e.equipSprite.setScale(.8,.8),e.equipSprite.addToParent(e.skin.modelNode),e.equipUpEff=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.equipUpEff.addToParent(e.skin.modelNode),e.equipUpEff.load(game.ResCfg.getUrl(5019,1088)),e.equipUpEff.addFinishCallback(e.equipUpEffCB,e);var t=e.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PartnerListItem,t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=0,t.bindEnum=e.moduleEnum,t.addToParent(e.skin.listNode),e.gemUpAnim=[],e.gemSelectAnim=[];for(var a=0;a<3;a++){var i=e.getComponent("gem_"+(a+1));e.gemUpAnim[a]=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.gemUpAnim[a].addToParent(i),e.gemUpAnim[a].load(game.ResCfg.getUrl(5019,1009)),e.gemUpAnim[a].addFinishCallback(e.animaGemCB,e,[a]),e.gemSelectAnim[a]=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.gemSelectAnim[a].addToParent(i),e.gemSelectAnim[a].load(game.ResCfg.getUrl(5019,1087)),e.gemSelectAnim[a].addFinishCallback(e.animaGemSelectCB,e,[a])}},playEquipEff:function(e){this.upAnim[e].active=!0,this.upAnim[e].play(null,0)},animaCB:function(e,t){this.upAnim[t].active=!1},playEquipUpEff:function(){this.equipUpEff.active=!0,this.equipUpEff.play(null,0)},equipUpEffCB:function(){this.equipUpEff.active=!1},playGemEff:function(e){this.gemUpAnim[e].active=!0,this.gemUpAnim[e].play(null,0)},animaGemCB:function(e,t){this.gemUpAnim[t].active=!1,this.playEndCall&&(this.playEndCall=!1)},playGemSelectEff:function(e){for(var t=0;t<3;t++)this.gemSelectAnim[t].active=e==t,e==t&&this.gemSelectAnim[t].play(null,0)},animaGemSelectCB:function(e,t){this.gemSelectAnim[t].active=!1},onPlayGemSlotsEff:function(e){for(var t=e.length,a=0;a<t;a++){var i=e[a];this.playEquipEff(i.equipSlot-1)}},onPlaySlotsEff:function(e){for(var t=e.length,a=0;a<t;a++){var i=e[a];this.playEquipEff(i.slot-1)}},notify:function(e,t,a){var i=this;switch(e){case i.Evts.C2V_UPDATE_HEADLIST:i.updateHeadList();break;case i.Evts.C2V_UPDATE_DATA:i.updateData();break;case i.Evts.V_CHANGE_FORGETYPE:if(a==i.moduleData.forgeType)return;i.toggleTrigger(t,a),i.updateData();break;case i.Evts.C2V_PLAY_GEM_SLOT_EFF:i.onPlayGemSlotsEff(t);break;case i.Evts.C2V_PLAY_SLOT_EFF:i.onPlaySlotsEff(t),i.playEquipUpEff();break;case i.Evts.V_CHANGE_GEM:if(t==i.moduleData.selectGem)return;i.moduleData.selectGem=t,i.playGemSelectEff(t-1),i.updateData();break;case i.Evts.C2V_UPDATE_SLOTS:i.updateMidShow();break;case i.Evts.C2V_PLAY_GEM_SELECT_EFF:i.playGemSelectEff(i.moduleData.selectGem-1)}},onShow:function(){this.updateData(),this.send(this.Evts.V_ONSHOW),b8e.module.isShowView(game.ME.Partner)&&game.module.hide(game.ME.Partner)},onHide:function(){this.moduleData.forgeType=game.EquipForgeType.INTENSIFY},toggleTrigger:function(e,t){this.toggleSelect(e)&&(this.moduleData.forgeType=t,this.updateData())},updateData:function(){this.updateHeadList(),this.updateMidShow()},updateHeadList:function(){this.list.setData(this.moduleData.getPartnerList())},intensifyAlert:function(e){this.skin.red_spot_1.node.active=e.alert},refineAlert:function(e){this.skin.red_spot_2.node.active=e.alert},purifyAlert:function(e){this.skin.red_spot_4.node.active=e.alert},zhulingAlert:function(e){this.skin.red_spot_5.node.active=e.alert},fuseAlert:function(e){this.skin.red_spot_6.node.active=e.alert},gemAlert:function(e){this.skin.red_spot_3.node.active=e.alert},updateName:function(e){if(this.skin.equipName.setVisible(e&&e.equipInfo),e){var t=e.itemCfg;t&&(this.skin.nameLbl.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name))}},updateModel:function(e){var t=e.equipId;this.skin.modelNode.setVisible(0!=t),e&&t&&this.equipSprite.loadTexture(game.ResCfg.getUrl(10080,t))},updateGems:function(e){for(var t=e.gemMap,a=(t.count(),1);a<=3;a++){var i=t.get(a),n=i?i.gemlv:0,s=this.getComponent("gem_"+a);s.setVisible(i),this.getComponent("gem_select_"+a).setVisible(a==this.moduleData.selectGem),this.getComponent("gem_redPoint_"+a).setVisible(i&&i.canGem());var r=this.getComponent("gem_lv_"+a);if(r.setVisible(i&&0<n),i){r.string=game.Lang.get(51395,n);var o="",g=i.gemSlotId-1;if(e.slotId<=4?o=game.equipForgeData.equipGemIcons[g]:5==e.slotId?o=game.equipForgeData.treasureGemIcons_1[g]:6==e.slotId&&(o=game.equipForgeData.treasureGemIcons_2[g]),!o)return;s.loadTexture(game.ResCfg.getUrl(0==n?10083:10084,o))}}},updateEquipSlots:function(){var e=this;if(!e.nodeArr){e.nodeArr=[],e.upAnim=[];for(var t=0;t<e.moduleData.maxSlotNum;t++){var a=new game.EquipForgeSlotWidget;a.bindEnum=e.moduleEnum;var i=e.getComponent("equip_"+(t+1));a.addToParent(i),e.nodeArr.push(a),e.upAnim[t]=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.upAnim[t].addToParent(i),e.upAnim[t].load(game.ResCfg.getUrl(5019,1009)),e.upAnim[t].addFinishCallback(e.animaCB,e,[t])}}for(var n=0;n<e.nodeArr.length;n++){var s=n+1,r=e.nodeArr[n],o=e.moduleData.getEquipInfoByCurRole(s);o&&r.show(o)}},updateMidShow:function(){var e=this.moduleData.getCurEquipInfo();if(e){this.updateName(e),this.updateModel(e);var t=this.moduleData.forgeType==game.EquipForgeType.GEM;this.skin.midbg_yuan.setVisible(t),t&&this.updateGems(e),this.updateEquipSlots(e)}}});b8e.module.registerView(game.ME.EquipForge,e)}(),function(){var e=game.ForgeControl.extends({init:function(){this.forgeInfo=game.equipGemData,this.forgeType=game.EquipForgeType.GEM,this.forgeAlert=game.spotAlert.set(game.SAE.EQUIP_GEM,game.SAE.EQUIP_FORGE)},onViewShow:function(){this._super(),this.dpt(this.Evts.C2C_PLAY_GEM_SELECT_EFF)},getForgeSlotInfo:function(){return game.equipForgeData.getCurSelectGem()},sendUp:function(e){var t,a=this.getForgeSlotInfo(),i=game.equipForgeData.getCurForgeRoleInfo();if(i){var n=a.slotId,s=a.gemSlotId,r=this.forgeInfo.isUpAll;this.resetCostCheckCond();var o=i.slot;if(t=i.getGemUpSlots(n,s,e,r)||[],this.checkCostCond(t)){var g={slot:o,equips:t};this.sendForge(g)}}}});b8e.module.registerControl(game.ME.EquipGem,e,game.EquipForgeEvts)}(),function(){var e=game.ForgeData.extends({setup:function(){this.forgeNameLangKey=51386,this.forgeType=game.EquipForgeType.GEM,this.masterType=game.EquipForgeMasterType.GEM,this._super()}});game.equipGemData=game.equipGemData||new e}(),function(){var e=game.ForgeView.extends({attrLangKey:51398,ctor:function(){this._super(343)},init:function(){this._super(),this.setData(game.equipGemData,game.ForgeGemCfg,game.EquipForgeType.GEM)},getEquipInfoLv:function(e){if(e){var t=0,a=game.equipForgeData.getCurSelectGem();return a&&(t=a.gemlv),t}},getNextAttr:function(e){var t=[];if(!e)return t;var a=game.equipForgeData.getCurSelectGem();if(!a)return t;var i=a.gemlv+1,n=e.isTreasure?this.forgeData.treasureMaxLv:this.forgeData.maxLv;n<=i&&(i=n);var s=a.gemSlotId,r=game.equipForgeData.getConfigEquipType3(e.slotId);t=this.forCfg.getShowAttr(r,s,i);for(var o=this.forCfg.getShowAttrPercent(r,s,i),g=o.length,u=0;u<g;u++)t.push(o[u]);return t},getAttr:function(e){var t=[];if(!e)return t;var a=game.equipForgeData.getCurSelectGem();if(!a)return t;var i=a.gemlv,n=e.isTreasure?this.forgeData.treasureMaxLv:this.forgeData.maxLv;n<=i&&(i=n);var s=a.gemSlotId,r=game.equipForgeData.getConfigEquipType3(e.slotId);t=this.forCfg.getShowAttr(r,s,i);for(var o=this.forCfg.getShowAttrPercent(r,s,i),g=o.length,u=0;u<g;u++)t.push(o[u]);return t},checkAlert:function(e){if(!e)return!1;var t=game.equipForgeData.getCurSelectGem();return!!t&&e.canGemByGemSlot(t.gemSlotId)}});b8e.module.registerView(game.ME.EquipGem,e)}(),function(){var e=game.ForgeControl.extends({init:function(){this.forgeInfo=game.equipIntensifyData,this.forgeType=game.EquipForgeType.INTENSIFY,this.forgeAlert=game.spotAlert.set(game.SAE.EQUIP_INTENSIFY,game.SAE.EQUIP_FORGE)}});b8e.module.registerControl(game.ME.EquipIntensify,e,game.EquipForgeEvts)}(),function(){var e=game.ForgeData.extends({setup:function(){this.forgeNameLangKey=51384,this.forgeType=game.EquipForgeType.INTENSIFY,this.masterType=game.EquipForgeMasterType.INTENSIFY,this._super()},checkAlert:function(e){if(!game.moduleOpen.checkOpen(game.ME.EquipForge))return!1;if(!e||!e.slotMap)return!1;var t=this.tmpCheckCostItemMap;t=t||(this.tmpCheckCostItemMap=b8e.HashMap.get());for(var a=e.slotMap.values(),i=a.length,n=this.maxLv,s=void 0,r=void 0,o=!1,g=!1,u=0;u<i;u++){var l=a[u];if(l)if(l.isTreasure)l.checkForgeAlert(this.forgeType)&&(o=!0);else{if(!l.equipInfo)continue;for(t.clear(),g=!0,s=l.intensifylv+10>n?n:l.intensifylv+10,r=l.intensifylv;r<=s&&(g=l.checkForgeUpByTargetLv(this.forgeType,r,t));r++);g&&(o=!0),l.intensifyAlert=g}}return o}});game.equipIntensifyData=game.equipIntensifyData||new e}(),function(){var e=game.ForgeView.extends({lvLangKey:51391,attrLangKey:51396,ctor:function(){this._super(344)},init:function(){this._super(),this.setData(game.equipIntensifyData,game.ForgeUpgradeCfg,game.EquipForgeType.INTENSIFY)},getEquipInfoLv:function(e){if(e)return e.intensifylv}});b8e.module.registerView(game.ME.EquipIntensify,e)}(),function(){var e=game.ForgeControl.extends({init:function(){this.forgeInfo=game.equipPurifyData,this.forgeType=game.EquipForgeType.PURIFY,this.forgeAlert=game.spotAlert.set(game.SAE.EQUIP_PURIFY,game.SAE.EQUIP_FORGE)}});b8e.module.registerControl(game.ME.EquipPurify,e,game.EquipForgeEvts)}(),function(){var e=game.ForgeData.extends({setup:function(){this.forgeNameLangKey=51387,this.forgeType=game.EquipForgeType.PURIFY,this.masterType=game.EquipForgeMasterType.PURIFY,this._super()}});game.equipPurifyData=game.equipPurifyData||new e}(),function(){var e=game.ForgeView.extends({lvLangKey:51393,attrLangKey:51399,ctor:function(){this._super(345)},init:function(){this._super(),this.setData(game.equipPurifyData,game.ForgePurifyCfg,game.EquipForgeType.PURIFY)},getEquipInfoLv:function(e){if(e)return e.purifylv}});b8e.module.registerView(game.ME.EquipPurify,e)}(),function(){var e=game.ForgeControl.extends({init:function(){this.forgeInfo=game.equipRefineData,this.forgeType=game.EquipForgeType.REFINE,this.forgeAlert=game.spotAlert.set(game.SAE.EQUIP_REFINE,game.SAE.EQUIP_FORGE)}});b8e.module.registerControl(game.ME.EquipRefine,e,game.EquipForgeEvts)}(),function(){var e=game.ForgeData.extends({setup:function(){this.forgeNameLangKey=51385,this.forgeType=game.EquipForgeType.REFINE,this.masterType=game.EquipForgeMasterType.REFINE,this._super()}});game.equipRefineData=game.equipRefineData||new e}(),function(){var e=game.ForgeView.extends({lvLangKey:51392,attrLangKey:51397,ctor:function(){this._super(346)},init:function(){this._super(),this.setData(game.equipRefineData,game.ForgeRefineCfg,game.EquipForgeType.REFINE)},getEquipInfoLv:function(e){if(e)return e.refinelv}});b8e.module.registerView(game.ME.EquipRefine,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1353),this.setSize(300,40)},setData:function(){var e=this.data;e&&(this.skin.lbl.string=game.Lang.get(51400+e.forgeType-1,e.name),this.skin.check.setVisible(e.isSelect))},touch:function(){var e=this.data;if(e){var t=!e.isSelect,a=e.forgeType,i=e.roleId;this.send(game.EquipForgeEvts.C2C_SELECT_ALERT,{roleId:i,forgeType:a,isSelect:t})}}}),b8e.RC("$$game","$$EquipForgeAlertSetListItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1354),this.list=null},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.EquipForgeAlertSetListItem,e.layout.spacingY=20,e.layout.paddingTop=40,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list),this.moduleData=game.equipForgeData},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_LIST:this.updateList()}},onHide:function(){this.send(this.Evts.V2C_CONFIRM_SELECT_ALERT)},onShow:function(){this.updateList()},updateList:function(){var e=this.moduleData.selectRole,t=this.moduleData.getSelectAlertInfoArr(e);this.list.setData(t)}});b8e.module.registerView(game.ME.EquipForgeAlertSet,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1355)},onShow:function(){var e=this,t=e.skin,a=game.equipForgeAttrTipsData.getInfo();if(a){var i=a.forgeInfo;if(i){var n=i.forgeName,s=i.suoLianMaxLv,r=i.forgeType,o=(i.suolianBtn,i.masterType),g=a.selectRole,u=game.equipForgeData.getForgeRoleInfo(g);if(u){var l=u.getSuolianInfo(r);if(l){var c=l.suolianStageLv,h=l.suolianlv;t.name.string=game.Lang.get(51408,n),t.isNoActive.setVisible(c<=0),t.isActive.setVisible(0<c);var m=s<=c;t.isMax.setVisible(m),t.isNoMax.setVisible(!m),e.height=m?220:420,e.onStageResize();var d=l.suolianSpriteStat;if(0<c&&(t.cur_desc_active.string=game.Lang.get(51409,n,h),d))for(var f=game.ForgeMasterCfg.getShowAttr(o,c),p=1;p<=3;p++){var v=f[p-1],E=game.AttrRulesCfg.getData(v.type);E&&(e.getComponent("cur_attr_"+p).string=game.Lang.get(51412,E.name,v.value+(v.isPer?"%":"")))}if(!m){var T=c+1,C=game.ForgeMasterCfg.getMasterConfig(o,T);if(C){for(var I=C.upgradeLv,S=0;S<4;S++){var _=S+1,A=u.slotMap.get(_);if(A){var y=(I<=A.getSlotLvByForgeType(r)?51422:51418)+S;e.getComponent("pos_"+_).string=game.Lang.get(y)}}t.next_desc.string=game.Lang.get(51413,n,I),e.nextSpriteStat||(e.nextSpriteStat=game.SpriteStat.get()),e.nextSpriteStat.setupByCfg(C);for(var D=game.ForgeMasterCfg.getShowAttr(o,T),L=1;L<=3;L++){var b=D[L-1];if(b){var R=game.AttrRulesCfg.getData(b.type);R&&(e.getComponent("next_attr_"+L).string=game.Lang.get(51411,R.name,b.value+(b.isPer?"%":"")))}}var w=game.CCommonUtil.getPower(d),k=game.CCommonUtil.getPower(e.nextSpriteStat);t.up_fightAmount.string=game.Lang.get(51426,k-w)}}}}}}}});b8e.module.registerView(game.ME.EquipForgeAttrTips,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1356)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_TIME:this.updateTimer(t)}},onHide:function(){b8e.Tween.kill(this.skin.light),this.send(this.Evts.ON_HIDE)},onShow:function(){this.updateData(),this.send(this.Evts.ON_SHOW)},updateData:function(){var e=this.skin;game.TweenUtil.rotationEffect(e.light);var t=game.equipForgeLvUpTipsData.getInfo();if(t){var a=t.role,i=t.forgeType,n=t.masterType,s=b8e.stageWidth;e.bg_4.width=s,e.huawen_1.width=s,e.tips_line.width=s-70;var r=game.ResCfg.getUrl(10085,i);e.icon.loadTexture(r);var o=a.getSuolianInfo(i);if(o)if(o.suoliancfg){var g=game.Lang.get(i-1+51368);e.name.string=game.Lang.get(51383,g,o.suolianlv);for(var u=o.suolianStageLv,l=game.ForgeMasterCfg.getShowAttr(n,u),c=1;c<=3;c++){var h=l[c-1],m=game.AttrRulesCfg.getData(h.type);m&&(this.getComponent("attr_"+c).string=m.name?game.Lang.get(51412,m.name,h.value+(h.isPer?"%":"")):"")}}}},updateTimer:function(e){this.skin.tips.string=game.Lang.get(51407,e)}});b8e.module.registerView(game.ME.EquipForgeLvUpTips,e)}(),function(){var e;e=game.Widget.extends({ctor:function(){this._super(1357),this.setSize(84,84)},show:function(e){this.info=e,this.updateShow(),this._super()},onShow:function(){this.updateShow()},updateHide:function(){var e=this.skin,t=this.info;if(e&&t){var a=t.equipId,i=game.equipForgeData.forgeType;if(e.noEquip.setVisible(0==a),e.hasEquip.setVisible(0<a),e.redPoint.setVisible(t.checkAlertByForgeType(i)),e.headSelect.setVisible(t.slotId==game.equipForgeData.selectEquip),e.isTreasure.setVisible(t.isTreasure),e.gem_node.setVisible(i==game.EquipForgeType.GEM),i==game.EquipForgeType.ZHULING){var n=t.quality>=game.Quality.Q_UNPARALLELED;e.zhuling_node.setVisible(!n),e.normal_node.setVisible(n),e.fuse_node.setVisible(!1)}else if(i==game.EquipForgeType.FUSE){e.fuse_node.setVisible(!0),e.normal_node.setVisible(!1),e.zhuling_node.setVisible(!1);var s=t.quality>=game.Quality.Q_UNPARALLELED;e.lvNode.setVisible(!s),e.starNode.setVisible(s);for(var r=0;r<6;r++)this.getComponent("starIcon"+(r+1)).active=r<t.fuseLv}else e.fuse_node.setVisible(!1),e.zhuling_node.setVisible(!1),e.normal_node.setVisible(i!=game.EquipForgeType.GEM)}},updateShow:function(){var e=this.skin;if(e&&this.info){var t=game.ResCfg.getUrl(10001,this.info.slotId);e.empty_equipIcon.loadTexture(t),this.updateHide(),this.updateIcon(),this.updateLv(),this.updateGems()}},updateGems:function(){var e=this.info;if(game.equipForgeData.forgeType==game.EquipForgeType.GEM)for(var t=0;t<3;t++){var a=t+1,i=e.gemMap.get(a),n=i?i.gemSlotId:0,s=i&&0<i.gemlv,r=this.getComponent("gem_"+a+"_icon");if(r.setVisible(s),s){var o="",g=n-1;if(e.slotId<=4?o=game.equipForgeData.equipGemIcons[g]:5==e.slotId?o=game.equipForgeData.treasureGemIcons_1[g]:6==e.slotId&&(o=game.equipForgeData.treasureGemIcons_2[g]),!o)return;r.loadTexture(game.ResCfg.getUrl(10082,o))}}},updateLv:function(){var e=game.equipForgeData.forgeType;if(!(e<=0)){var t=this.info,a=0,i=0;switch(e){case game.EquipForgeType.INTENSIFY:a=t.intensifylv,i=51396;break;case game.EquipForgeType.REFINE:a=t.refinelv,i=51397;break;case game.EquipForgeType.GEM:i=51398;break;case game.EquipForgeType.PURIFY:a=t.purifylv,i=51399;break;case game.EquipForgeType.ZHULING:a=t.zhulinglv,i=52139;break;case game.EquipForgeType.FUSE:a=t.fuseLv,i=52325}this.skin.lv.string=game.Lang.get(i,a)}},updateIcon:function(){var e=this.skin,t=this.info;e&&t&&0!=t.equipId&&(this.equipIcon||(this.equipIcon=game.GridUtil.createPetEquipIcon(),this.equipIcon.addToParent(e.icon)),this.equipIcon.setData(t.equipInfo,null,!1))},touchIcon:function(){this.info&&this.send(game.EquipForgeEvts.C2C_CHANGE_EQUIP,this.info.slotId)}}),b8e.RC("$$game","$$EquipForgeSlotWidget",e)}(),function(){var e=game.Control.extends({ipc:function(){this.handels={PartnerEquipRedPointResp:this.onSetAlertResp}},notify:function(e,t){switch(e){case this.Evts.C2C_SELECT_ALERT:if(!t)return;game.equipForgeData.selectAlertSetting(t.roleId,t.forgeType,t.isSelect),this.send(this.Evts.C2V_UPDATE_LIST),this.dpt(this.Evts.C2V_UPDATE);break;case this.Evts.V2C_CONFIRM_SELECT_ALERT:this.onConfirmSelect()}},onConfirmSelect:function(){var e=game.equipForgeData.selectRole,t=game.equipForgeData.getForgeRoleInfo(e);if(t&&t.id){var a=t.id,i=game.equipForgeData.getAlertInfo(a);this.sender.PartnerEquipRedPointReq(a,i)}},onSetAlertResp:function(e){var t=e.readProtobuf(game.pb.PartnerEquipRedPointResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=game.equipForgeData.getHuobanInfoByHuobanId(a);i&&(i.redPoint=t.redPoint,this.dpt(this.Evts.C2V_UPDATE))}}}),t=game.Sender.extends({ipc:function(){this.msg={PartnerEquipRedPointReq:this.changeEquipAlertSet}},changeEquipAlertSet:function(e,t){var a=game.pb.PartnerEquipRedPointRequest;a.id=e,a.redPoint=t,this.write(a)}});b8e.module.registerControl(game.ME.EquipForgeAlertSet,e,game.EquipForgeEvts,t)}(),function(){var e=game.Control.extends({});b8e.module.registerControl(game.ME.EquipForgeAttrTips,e)}(),function(){var e=game.Control.extends({init:function(){this.cdTime=30},notify:function(e){switch(e){case this.Evts.ON_HIDE:this.onHideView();break;case this.Evts.ON_SHOW:this.onShowView()}},onShowView:function(){this.timer||(this.cdTime=30,this.send(this.Evts.C2V_UPDATE_TIME,this.cdTime),this.timer=b8e.Timer.add(this,this.updateTime,1e3))},onHideView:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.cdTime-=1,this.cdTime<=0?game.module.hide(game.ME.EquipForgeLvUpTips):this.send(this.Evts.C2V_UPDATE_TIME,this.cdTime)}});b8e.module.registerControl(game.ME.EquipForgeLvUpTips,e,game.EquipForgeEvts)}(),function(){var e=game.ForgeControl.extends({init:function(){this.forgeInfo=game.equipZhulingData,this.forgeType=game.EquipForgeType.ZHULING,this.forgeAlert=game.spotAlert.set(game.SAE.EQUIP_ZHULING,game.SAE.EQUIP_FORGE)},upBtn:function(){this.efData=game.equipForgeData;var e=this.efData.getCurEquipInfo();if(e){var t=e.costZhulingCfg;if(t){var a=this.forgeInfo.isUpAll,i=t.itemId,n=t.itemNum,s=0;if(!(game.amount.getAmountTypeById(i)==game.ItemCfgType.Amount?game.UpgradeUtil.checkAmountById(i,n,!0):game.UpgradeUtil.checkItemInfo(i,n,!0))){if(!a)return;if(game.UpgradeUtil.autoBuy(i,n,!0,null,null,null)<=0)return;s=1}var r=e.id,o=e.slotId,g=game.equipForgeData.getHuobanInfoByHuobanId(r);if(g&&g.battlePos){var u={slot:g.battlePos,equipSlot:o,isAuto:s};this.dpt(this.Evts.C_REQ_FORGE,u)}}}}});b8e.module.registerControl(game.ME.EquipZhuling,e,game.EquipForgeEvts)}(),function(){var e=game.ForgeData.extends({isUpAll:!1,setup:function(){this.forgeNameLangKey=52137,this.forgeType=game.EquipForgeType.ZHULING,this.masterType=game.EquipForgeMasterType.ZHULING,this._super()}});game.equipZhulingData=game.equipZhulingData||new e}(),function(){var e=game.CultivateBaseView.extends({lvLangKey:52138,attrLangKey:52139,curLv:0,progressMaxW:370,ctor:function(){this._super(1432)},init:function(){this._super(),this.moduleData=game.equipForgeData,this.forgeData=game.equipZhulingData,this.forgeType=game.EquipForgeType.ZHULING},notify:function(e){switch(e){case this.Evts.C2V_UPDATE:this.updateData();break;case this.Evts.C2V_UPDATE_CHECK:this.updateCheck()}},onShow:function(){this.updateData(),this.updateCheck(),this.send(this.Evts.V_ONSHOW)},onStageResize:function(){this.setPosition(0,0)},updateCheck:function(){this.skin.check.setVisible(this.forgeData.isUpAll)},updateData:function(){var e=this,t=e.skin;e.updateSuolian();var a=e.moduleData.getCurEquipInfo();if(a){var i=0!=a.equipId;if(t.noEquip.setVisible(!i),!i)return t.showNode.setVisible(!1),void t.lbl_noqua.setVisible(!1);var n=a.quality>=game.Quality.Q_UNPARALLELED;if(t.lbl_noqua.setVisible(!n),t.showNode.setVisible(n),n){e.curLv=a.zhulinglv||0;var s=a.isTreasure?e.forgeData.treasureMaxLv:e.forgeData.maxLv,r=e.curLv>=s;t.isMax_cost.setVisible(r),t.isNoMax_cost.setVisible(!r),t.lbl_prog.string=game.Lang.get(e.lvLangKey,e.curLv),e.updateAttr(a,r);var o=a.costZhulingCfg;if(o){var g=o.maxValue,u=a.zhulingExp||0;t.expLab.string=u+"/"+g,e.setProgressVal(u/g)}var l=game.equipForgeData.getCostInfoArrByForgeType(a,e.forgeType);e.updateCost(l),e.updateRedPoint(a),e.forgeData.suolianBtn||(e.forgeData.suolianBtn=e.skin.btn_suolian)}}},updateSuolian:function(){var e=this.skin,t=this.moduleData.getCurRoleSuolianInfo(this.forgeType);if(t){e.lbl_stage.string=game.Lang.get(51394,t.suolianStageLv);var a=game.ResCfg.getUrl(10085,this.forgeType);e.icon_suolian.loadTexture(a);var i=t.suoliancfg,n=i?i.upgradeLv:0,s=i?i.lv+1:1,r=this.forgeData.suoLianMaxLv;r<s&&(s=r);var o=game.ForgeMasterCfg.getMasterConfig(this.forgeData.masterType,s);o&&(n=o.upgradeLv),e.lbl_suolianlv.string=t.suolianlv+"/"+n}},updateCost:function(e){var t=this.skin;if(e){var a=e[0];if(a){var i="",n=0,s=a.costItem,r=a.costNum,o=game.amount.getAmountTypeById(s);n=0<o?game.amount.get(o):game.itemData.getNumById(s);var g=game.ItemInfoCfg.getData(s);if(g){var u=this.cost;u||((u=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105)).addToParent(t.costIcon),this.cost=u),u.setItemInfo(g,!1,!1),i=game.HtmlUtil.getColorStrByQuality(g.quality,g.name)}t.costName.string=i;var l=r<=n?51389:51388;t.costNum.string=game.Lang.get(l,n,r)}}},updateRedPoint:function(e){var t=e.checkAlertByForgeType(this.forgeType);this.skin.redPoint_up.setVisible(t)},updateAttr:function(e,t){var a=this,i=a.skin;i.arrow.setVisible(!t),i.curNode.x=t?358:245;var n,s=a.curLv,r=e.zhulingExp,o=void 0;o=a.getAttr(e,s,r),n=a.getAttr2(e,0==s?s+1:s),0==s&&0==r&&(o=a.getAttr(e,s+1,0)),i.cur_attr.string=a.getAttrStrByArr(o,0==s&&0==r),i.cur_lv.string=game.Lang.get(a.attrLangKey,s);var g=a.getAttrStrByArr(n,0==s);if(g=(g=g.replace(/\n/g," ")).replace(/:/g,""),a.skin.descLab.string=game.Lang.get(52210,g),a.skin.nextNode.setVisible(!t),!t){var u=a.getAttr(e,s+1,0);i.next_attr.string=a.getAttrStrByArr(u),i.next_lv.string=game.Lang.get(a.attrLangKey,s+1)}},getAttr:function(e,t,a){if(e){var i=e.equipId;if(i)return game.ForgeZhulingCfg.getShowAttr(i,t,a)}},getAttr2:function(e,t){if(e){var a=e.equipId;if(a)return game.ForgeZhulingCfg.getShowAttr2(a,t)}},getAttrStrByArr:function(e,t){var a="";if(!e||e.length<=0)return a;for(var i=void 0,n=0;n<e.length;n++)if((i=e[n]).type){var s=game.AttrRulesCfg.getData(i.type);if(!s)continue;a+=game.Lang.get(51390,s.name,t?0:i.value)+(n==e.length-1?"":"\n")}return a},setProgressVal:function(e){b8e.Tween.kill(this.skin.progress),b8e.Tween.get(this.skin.progress).to({width:e*this.progressMaxW},150)},updateDescLab:function(e,t){if(e)game.ForgeZhulingCfg.getShowAttr2(e,t,!1)}});b8e.module.registerView(game.ME.EquipZhuling,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C2V_UPDATE_STAR:-1,C2V_SELECT_ID:-1,C2V_UPDATE_LIST:-1,C2V_UPDATE_BATTLE:-1,C2V_UPDATE_ACTIVE:-1,C2V_UPDATE_LV:-1,C2V_UPDATE_EXP:-1,C2V_SWITCH_PAGE:-1,C2V_UPDATE_FETTERS:-1,V2C_UPGRADE_FETTERS:-1,V2C_ACTIVE_FETTERS:-1,C2V_ACTIVE_FETTERS_SUCCESS:-1,C2V_UPDATE_ATTR:-1,V2C_USE_ATTR_ITEM:-1,V2C_UPDATE_POWER:-1,C2C_FOSTER_DATA_INIT:-1,C2C_FOSTER_ACTIVE:-1,C2C_FOSTER_UPGRADE:-1,C2C_FOSTER_UPSTAR:-1,C2C_UPDATE_FETTERS:-1,C2C_UPDATE_ATTRITEM:-1,C2C_UPDATE_BATTLE:-1,C2V_UPDATE_ALERT:-1,C2V_UPDATE_ID:-1,V2C_SHOW_VIEW:-1,V2C_SWITCH_PAGE_COMPLETE:-1,C2C_UPDATE_POWER:-1,C2V_PLAY_PRO_EFFECT:-1,C2V_PLAY_UP_EFFECT:-1}),b8e.RC("$$game","$$FosterEvts",e)}(),function(){var e,t=game.Control.extends({fosterTypeEnum:null,init:function(){this.sendList=[],this.spotAlertMap=b8e.HashMap.get(),this.fetterSpotAlertMap=b8e.HashMap.get(),this.attrItemSpotAlertMap=b8e.HashMap.get(),this.tempList=[],game.FosterEquipMgr.inst().addEvent(game.FosterEquipEvts.FOSTER_UPDATE_EQUIP_ALERT,this.updateEquipAlert,this)},triggerOpen:function(e){if(game.fosterData.getIsFosterME(e)){var t=game.fosterData.getFosterClientCfgByME(e);if(!t)return;var a=t.id;game.fosterData.isInitData(a)||(this.sendList.length=0,this.initFoster(a),this.sendList.push(a),this.sender.FosterModelReq(this.sendList))}else e==this.moduleEnum&&this.fosterModuleOpen()},fosterModuleOpen:function(){this.sendList.length=0;var e=game.FosterClientCfg.getDatas();if(e&&!(e.length<1)){for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++){a=(t=e[n]).moduleEnum;var s=game.moduleOpen.checkOpen(a);game.fosterData.setFosterModuleEnum(a);var r=t.id;if(this.initSpotAlert(r),s)game.fosterData.isInitData(r)||(this.initFoster(r),this.sendList.push(r))}0<this.sendList.length&&this.sender.FosterModelReq(this.sendList)}},initSpotAlert:function(e){var t=game.fosterData,a=t.getFosterSaeByType(e,"sae"),i=t.getFosterSaeByType(e,"parentSae"),n=t.getFosterSaeByType(e,"fetterSae"),s=t.getFosterSaeByType(e,"attrItemSae"),r=t.getFosterSaeByType(e,"infoSae");if(a){var o=void 0;o=i?game.spotAlert.set(a,i):game.spotAlert.set(a),n&&(o=game.spotAlert.set(n,a),this.fetterSpotAlertMap.set(e,o)),s&&(o=game.spotAlert.set(s,a),this.attrItemSpotAlertMap.set(e,o)),r&&(o=game.spotAlert.set(r,a),this.spotAlertMap.set(e,o))}},initFoster:function(e){var t=game.fosterData;t.initFosterInfo(e),t.initFetterInfo(e)},ipc:function(){var e=this;e.evts={Back:{C_BACK_SYN_BACK_INFO:e.updateItem,C_BACK_UPDATE_ITEMINFO:e.updateItem},StarSoul:{C2C_UPDATE_AWAKE:e.updateAwake},KeYin:{C2C_UPDATE_KEYIN:e.updateAwake},JuLing:{C2C_UPDATE_JULING:e.updateAwake}},e.handels={FosterModelResp:e.synFosterModelData,FosterActiveResp:e.fosterActiveResp,FosterUpgradeResp:e.fosterUpgradeResp,FosterStarResp:e.fosterStarResp,FosterFetterResp:e.fosterFetterResp,FosterAttrItemResp:e.fosterAttrItemResp,FosterBattleResp:e.fosterBattleResp}},notify:function(e,t,a){var i=this,n=game.fosterData.curFosterType;switch(e){case i.Evts.V2C_USE_ATTR_ITEM:i.sender.FosterAttrItemReq(n,t,a);break;case i.Evts.C2V_SELECT_ID:game.fosterData.selectId(n,t);var s=game.fosterData.getCurFosterInfo();s&&s.active||i.send(i.Evts.C2V_SWITCH_PAGE,0),i.send(i.Evts.C2V_UPDATE_ID);break;case i.Evts.V2C_UPGRADE_FETTERS:game.fosterData.setFosterFetterSelect(t,a),i.checkHideView(game.ME.FosterFettersUpgrade),game.module.show(game.ME.FosterFettersUpgrade);break;case i.Evts.V2C_ACTIVE_FETTERS:i.sender.FosterFetterReq(t,a);break;case i.Evts.V2C_SHOW_VIEW:i.send(i.Evts.C2V_UPDATE_ID);break;case i.Evts.V2C_SWITCH_PAGE_COMPLETE:i.send(i.Evts.C2V_UPDATE_LIST)}},synFosterModelData:function(e){var t=e.readProtobuf(game.pb.FosterModelResponse);game.fosterData.setupFosterData(t.datas),this.initFosterAlert(t.datas),game.AvatarUtil.update(game.mainRole),this.dpt(this.Evts.C2C_FOSTER_DATA_INIT)},fosterActiveResp:function(e){var t=this,a=e.readProtobuf(game.pb.FosterActiveResponse);0<a.code?game.notice.noticeError(a.code):game.fosterData.getFosterInfo(a.fosterType,a.id)&&(game.FightAmount.inst().showTeamStatPower(),game.fosterData.activeFoster(a.fosterType,a.id),t.checkFosterFetterAlert(a.fosterType),t.send(t.Evts.C2V_UPDATE_ACTIVE),t.send(t.Evts.V2C_UPDATE_POWER),t.dpt(t.Evts.C2C_UPDATE_POWER,a.fosterType),t.send(t.Evts.C2V_UPDATE_ALERT),t.dpt(t.Evts.C2C_FOSTER_ACTIVE,a.fosterType))},fosterUpgradeResp:function(e){var t=this,a=e.readProtobuf(game.pb.FosterUpgradeResponse);0<a.code?game.notice.noticeError(a.code):(game.fosterData.getCurFosterInfo().lv<a.lv&&(game.FightAmount.inst().showTeamStatPower(),t.send(t.Evts.C2V_PLAY_UP_EFFECT)),game.fosterData.upgradeFoster(a.fosterType,a.id,a.lv,a.exp),t.send(t.Evts.C2V_PLAY_PRO_EFFECT),t.send(t.Evts.C2V_UPDATE_LV),t.send(t.Evts.V2C_UPDATE_POWER),t.dpt(t.Evts.C2C_UPDATE_POWER,a.fosterType),t.send(t.Evts.C2V_UPDATE_ALERT),t.dpt(t.Evts.C2C_FOSTER_UPGRADE,a.fosterType),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeUpgrade))},fosterStarResp:function(e){var t=this,a=e.readProtobuf(game.pb.FosterStarResponse);0<a.code?game.notice.noticeError(a.code):game.fosterData.getFosterInfo(a.fosterType,a.id)&&(game.FightAmount.inst().showTeamStatPower(),game.fosterData.upStarFoster(a.fosterType,a.id,a.star),t.send(t.Evts.C2V_PLAY_UP_EFFECT),game.module.show(game.ME.FosterUpStarSuccess),t.checkFosterFetterAlert(a.fosterType),t.send(t.Evts.C2V_UPDATE_STAR),t.send(t.Evts.V2C_UPDATE_POWER),t.dpt(t.Evts.C2C_UPDATE_POWER,a.fosterType),t.send(t.Evts.C2V_UPDATE_ALERT),t.dpt(t.Evts.C2C_FOSTER_UPSTAR,a.fosterType),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeStar))},fosterFetterResp:function(e){var t=e.readProtobuf(game.pb.FosterFetterResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),game.fosterData.updateFosterFetter(t.fosterType,t.id,t.lv),this.checkFosterFetterAlert(t.fosterType),this.send(this.Evts.C2V_UPDATE_FETTERS),this.send(this.Evts.V2C_UPDATE_POWER),this.dpt(this.Evts.C2C_UPDATE_POWER,t.fosterType),this.dpt(this.Evts.C2C_UPDATE_FETTERS,t.fosterType))},fosterAttrItemResp:function(e){var t=e.readProtobuf(game.pb.FosterAttrItemResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.fosterData.getAttrItemStat(t.fosterType);game.FightAmount.inst().showTeamStatPower(),game.fosterData.useFosterAttrItem(t.fosterType,t.id,t.num),game.fosterData.getAttrItemStat(t.fosterType),this.send(this.Evts.C2V_UPDATE_ATTR),this.dpt(this.Evts.C2C_UPDATE_POWER,t.fosterType),this.dpt(this.Evts.C2C_UPDATE_ATTRITEM,t.fosterType)}},fosterBattleResp:function(e){var t=e.readProtobuf(game.pb.FosterBattleResponse);0<t.code?game.notice.noticeError(t.code):(game.fosterData.setFosterBattle(t.fosterType,t.id),game.fosterData.checkFosterInfo(t.fosterType),game.AvatarUtil.update(game.mainRole),this.send(this.Evts.C2V_UPDATE_BATTLE),this.dpt(this.Evts.C2C_UPDATE_BATTLE,t.fosterType))},updateItem:function(){b8e.module.isShowView(this.moduleEnum)&&(game.fosterData.checkFosterInfo(game.fosterData.curFosterType),this.send(this.Evts.C2V_UPDATE_ITEM)),this.updateOpenFosterAlert(!0)},updateEquipAlert:function(){this.updateOpenFosterAlert(!1)},updateOpenFosterAlert:function(e){var t=game.fosterData.getOpenFosterType();if(t&&!(t.length<1))for(var a=void 0,i=t.length,n=0;n<i;n++)a=t[n],this.checkFosterAlert(a),e&&this.checkFosterAttrItemAlert(a)},updateAwake:function(){this.send(this.Evts.C2V_UPDATE_ATTR),this.dpt(this.Evts.C2C_UPDATE_POWER,game.fosterData.curFosterType)},initFosterAlert:function(e){if(e&&!(e.length<1))for(var t=void 0,a=e.length,i=0;i<a;i++)t=e[i].fosterType,this.checkFosterAlert(t),this.checkFosterFetterAlert(t),this.checkFosterAttrItemAlert(t)},checkAllAlert:function(e){this.checkFosterAlert(e),this.checkFosterFetterAlert(e),this.checkFosterAttrItemAlert(e)},checkFosterAlert:function(e){var t=this.spotAlertMap.get(e);if(t){var a=!1;if(game.fosterData.getFosterClientCfgByType(e).showSkin){var i=game.spotAlert.get(game.SAE.SURFACE);a=i&&i.alert}t.alert=game.fosterData.checkFosterAlert(e)||a}},checkFosterFetterAlert:function(e){var t=this.fetterSpotAlertMap.get(e);t&&(t.alert=game.fosterData.checkFosterFetterAlert(e,!1))},checkFosterAttrItemAlert:function(e){var t=this.attrItemSpotAlertMap.get(e);t&&(t.alert=game.fosterData.checkFosterAttrItemAlert(e))},btn_1:function(){this.send(this.Evts.C2V_SWITCH_PAGE,0)},btn_2:function(){this.send(this.Evts.C2V_SWITCH_PAGE,1)},btn_3:function(){this.send(this.Evts.C2V_SWITCH_PAGE,2)},btn_4:function(){this.send(this.Evts.C2V_SWITCH_PAGE,3)},upgradeBtn:function(){var e=this.getUpgradeList(!1);e&&this.sendUpgrade(e)},autoUpgradeBtn:function(){var e=this.getUpgradeList(!0);e&&this.sendUpgrade(e)},sendUpgrade:function(e){var t=game.fosterData.curFosterType,a=game.fosterData.getCurId(t);this.sender.FosterUpgradeReq(t,a,e)},getUpgradeList:function(e){var t=game.fosterData.curFosterType,a=game.fosterData.getCurFosterInfo();if(!a)return null;var i=game.mainRoleData.lv;if(a.lv>=2*i||a.lv>=game.mainRoleData.maxLv)return game.notice.show(51622),null;var n=a.getUpgradeCfg();if(!n)return null;var s=game.fosterData.getFosterBookCfgs(t);if(!s||s.length<1)return null;var r=void 0,o=void 0,g=void 0,u=s.length;if(e){var l=game.fosterData.getCurId(t),c=game.fosterData.getFosterUpgradeCfg(t,l,2*i>game.mainRoleData.maxLv?game.mainRoleData.maxLv:2*i);if(!c)return b8e.error("\u6ca1\u6709\u627e\u5230\u5f53\u524d\u53ef\u5347\u7ea7\u6700\u5927\u7b49\u7ea7\u914d\u7f6e\uff0c\u7b49\u7ea7:",i),null;g=c.totalExp-n.totalExp-a.exp}else g=n.exp-a.exp;for(var h=void(this.tempList.length=0),m=0;m<u;m++)if(o=s[m],!((r=game.itemData.getCountById(o.id))<1)){if(o.exp*r>g){r=Math.ceil(g/o.exp),(h=this.getItemViewObj(m)).id=o.id,h.num=r,this.tempList.push(h);break}(h=this.getItemViewObj(m)).id=o.id,h.num=r,g-=o.exp*r,this.tempList.push(h)}if(0<this.tempList.length)return this.tempList;var d=game.fosterData.getMiscValue(t,"expItemId");d&&game.AccessShopView.inst().showView(+d)},getItemViewObj:function(e){return this.itemObjPool||(this.itemObjPool=[]),this.itemObjPool[e]||(this.itemObjPool[e]=new game.pb.ItemView.ctor),this.itemObjPool[e]},upStarBtn:function(){var e=game.fosterData.getCurFosterInfo();if(e){var t=e.getUpStarCfg();if(t)if(game.UpgradeUtil.checkItemInfo(t.itemId,t.itemNum)){var a=game.fosterData.curFosterType,i=game.fosterData.getCurId(a);this.sender.FosterStarReq(a,i)}}},battleBtn:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getCurId(e);this.sender.FosterBattleReq(e,t)},downBattleBtn:function(){var e=game.fosterData.curFosterType;this.sender.FosterBattleReq(e,0)},fetterUpgraeBtn:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getCurSelectFettersInfo(e);t&&t.checkAlert(!0)&&this.sender.FosterFetterReq(e,t.id)},activeBtn:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getCurFosterInfo();if(t&&!t.active&&t.cfg){var a=t.cfg;game.UpgradeUtil.checkItemInfo(a.itemId,a.itemNum)&&this.sender.FosterActiveReq(e,t.id)}},attrItemBtn:function(){this.checkHideView(game.ME.FosterAttrItem),game.module.show(game.ME.FosterAttrItem)},checkHideView:function(e){b8e.module.isShowView(e)&&game.module.hide(e)},chaseBtn:function(){game.module.show(game.ME.FosterChase)},skinBtn:function(){var e=this.getClientCfg();e&&e.surfaceIndex&&game.module.showToggle(game.ME.Surface,e.surfaceIndex-1)},helpBtn:function(){var e=this.getClientCfg();e&&game.RuleView.inst().showView(e.moduleEnum)},equipBtn:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getCurId(e),a=game.fosterData.getCurFosterInfo();if(a){var i=game.fosterEquipData.getOpenCfg(e,t);i&&(i.star>a.star||i.lv>a.lv?game.notice.show(53514,i.star,i.lv):game.FosterEquipMgr.inst().showEquipView(e,t))}},quickWearBtn:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getCurId(e);game.FosterEquipMgr.inst().quickWear(e,t)},awaken:function(){var e=game.fosterData.getCurFosterInfo();if(e){var t=game.starSoulData.getAwakeCfgCls(e.fosterType).getData(e.id);t&&(e.star<t.activateStar?game.notice.show(game.Lang.get(51867,t.activateStar)):(this.checkHideView(game.ME.StarSoul),game.module.show(game.ME.StarSoul)))}},getClientCfg:function(){return game.fosterData.getFosterClientCfgByType(game.fosterData.curFosterType)},selectToggle:function(e){this.send(this.Evts.C2V_SWITCH_PAGE,e)},turnplate:function(){var e=game.fosterData.getMiscValue(game.fosterData.curFosterType,"turnplateId");if(e){var t=game.xunBaoData.getOpenIdByType(e,!1);t&&b8e.evt.dptG(game.XunBaoEvts.C2C_SHOW_XUNBAO,t)}},btnJuling:function(){game.module.show(game.ME.JuLing)},btnKeyin:function(){game.module.show(game.ME.KeYin)},btnYuHua:function(){game.module.show(game.ME.YuHua)}});e=game.Sender.extends({ipc:function(){this.msg={FosterModelReq:this.fosterModelReq,FosterActiveReq:this.fosterActiveReq,FosterUpgradeReq:this.fosterUpgradeReq,FosterStarReq:this.fosterStarReq,FosterFetterReq:this.fosterFetterReq,FosterAttrItemReq:this.fosterAttrItemReq,FosterBattleReq:this.fosterBattleReq}},fosterModelReq:function(e){var t=game.pb.FosterModelRequest;t.fosterType=e,b8e.net.getBytes().writeProtobuf(t)},fosterActiveReq:function(e,t){var a=game.pb.FosterActiveRequest;a.fosterType=e,a.id=t,b8e.net.getBytes().writeProtobuf(a)},fosterUpgradeReq:function(e,t,a){var i=game.pb.FosterUpgradeRequest;i.fosterType=e,i.id=t,i.items=a,b8e.net.getBytes().writeProtobuf(i)},fosterStarReq:function(e,t){var a=game.pb.FosterStarRequest;a.fosterType=e,a.id=t,b8e.net.getBytes().writeProtobuf(a)},fosterFetterReq:function(e,t){var a=game.pb.FosterFetterRequest;a.fosterType=e,a.id=t,b8e.net.getBytes().writeProtobuf(a)},fosterAttrItemReq:function(e,t,a){var i=game.pb.FosterAttrItemRequest;i.fosterType=e,i.id=t,i.num=a,b8e.net.getBytes().writeProtobuf(i)},fosterBattleReq:function(e,t){var a=game.pb.FosterAttrItemRequest;a.fosterType=e,a.id=t,b8e.net.getBytes().writeProtobuf(a)}});var a=[game.ME.FosterAttrItem,game.ME.FosterChase,game.ME.FosterFetters,game.ME.FosterFettersUpgrade,game.ME.FosterInfo,game.ME.FosterUpgrade,game.ME.FosterUpStar,game.ME.FosterSkill,game.ME.FosterUpStarSuccess,game.ME.Mount,game.ME.Wing,game.ME.Shenhun,game.ME.Zhanji,game.ME.Halo];b8e.module.registerControl(game.ME.Foster,t,game.FosterEvts,e,a),b8e.RC("$$game","$$FosterSender",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super()},showFosterView:function(e,t,a){var i=e,n=game.fosterData,s=n.getFosterClientCfgByType(i);if(s){var r=s.moduleEnum;t=!!t,game.moduleOpen.checkOpenWithTips(r,t)&&(n.curFosterType=e,b8e.module.isShowView(game.ME.Foster)&&(game.module.hide(game.ME.Foster),n.curFosterME=0),n.getIsActiveByType(e)?game.module.showToggle(game.ME.Foster,a):game.module.showToggle(game.ME.Foster,0))}},hideView:function(){game.fosterData.curFosterME&&(game.module.hide(game.fosterData.curFosterME),game.fosterData.curFosterME=0)}});game.fosterMgr=game.fosterMgr||new e}(),function(){var e=b8e.Object.extends({cfgObj1:null,cfgObj2:null,cfgObj3:null,cfgObj4:null,cfgObj5:null,cfgObj6:null,cfgObj7:null,fosterDataMap:null,curFosterType:0,curShowIndex:-1,curFosterME:0,ctor:function(){this._super(),this.fosterDataMap=b8e.HashMap.get(),this.fosterFetterMap=b8e.HashMap.get(),this.attrItemMap=b8e.HashMap.get(),this.battleIdMap=b8e.HashMap.get(),this.selectFettersInfoMap=b8e.HashMap.get(),this.selectIdMap=b8e.HashMap.get(),this.tempList=[]},setFosterModuleEnum:function(e){this.fosterMEList||(this.fosterMEList=[]),this.fosterMEList.push(e)},getIsFosterME:function(e){if(this.fosterMEList)return-1<this.fosterMEList.indexOf(e)},isInitData:function(e){return!!this.fosterDataMap.get(e)},setupFosterData:function(e){if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)a=(t=e[n]).fosterType,this.setFosterData(a,t.fosters),this.setFetterData(a,t.fetters),this.setAttrItemData(a,t.attrItems),this.setBattle(a,t.battle)},setFosterData:function(e,t){var a=this.fosterDataMap.get(e);if(a&&t&&!(t.length<1))for(var i=void 0,n=void 0,s=t.length,r=0;r<s;r++)i=t[r],(n=a.get(i.id))&&(n.setActive(),n.setFosterData(i),this.setActiveId(e))},setFetterData:function(e,t){var a=this.fosterFetterMap.get(e);if(a&&t&&!(t.length<1))for(var i=void 0,n=void 0,s=t.length,r=0;r<s;r++)i=t[r],(n=a.get(i.id))&&n.setFetterLv(i.lv)},setAttrItemData:function(e,t){if(t&&!(t.length<1)){var a=this.attrItemMap.get(e);a||(a=b8e.HashMap.get(),this.attrItemMap.set(e,a));for(var i=void 0,n=t.length,s=0;s<n;s++)i=t[s],a.set(i.id,i.num)}},setBattle:function(e,t){var a=this.fosterDataMap.get(e);if(a){var i=0,n=0,s=0,r=this.getFosterClientCfgByType(e);r&&(i=r.animType,s=r.defaultModel);var o=a.get(t);if(!o)return this.battleIdMap.set(e,0),this.setAnim(i,s),void(e==game.NewFosterType.SHENHUN&&game.mainRoleData.heroModel&&game.mainRoleData.heroModel.setModel(game.RoleType.Shenhun,""));var g=o.cfg;g&&(s=g.model,null!=g.mountHead&&(n=game.AnimType.MOUNT_HEAD),game.mainRoleData.heroModel.setFosterAnim(e,t,i,n),e==game.NewFosterType.SHENHUN&&game.mainRoleData.heroModel&&game.mainRoleData.heroModel.setModel(game.RoleType.Shenhun,g.model)),this.battleIdMap.set(e,t),o.setBattle(!0)}},setAnim:function(e,t){e&&game.mainRoleData.heroModel&&game.mainRoleData.heroModel.setAnim(e,t)},activeFoster:function(e,t){var a=this.fosterDataMap.get(e);if(a){var i=a.get(t);i&&(i.setActive(),this.setActiveId(e))}},upgradeFoster:function(e,t,a,i){var n=this.fosterDataMap.get(e);if(n){var s=n.get(t);s&&(s.setLvInfo(a,i),s.checkAlert())}},upStarFoster:function(e,t,a){var i=this.fosterDataMap.get(e);if(i){var n=i.get(t);n&&n.setStar(a)}},updateFosterFetter:function(e,t,a){var i=this.fosterFetterMap.get(e);if(i){var n=i.get(t);n&&(n.setFetterLv(a),n.checkAlert())}},useFosterAttrItem:function(e,t,a){var i=this.attrItemMap.get(e);i||(i=b8e.HashMap.get(),this.attrItemMap.set(e,i));var n=i.get(t)||0;n+=a,i.set(t,n)},setFosterBattle:function(e,t){var a=this.fosterDataMap.get(e);if(a){var i=void 0,n=this.battleIdMap.get(e);n&&(i=a.get(n))&&i.setBattle(!1),this.setBattle(e,t)}},setActiveId:function(e){this.activeList||(this.activeList=[]),this.activeList.indexOf(e)<0&&this.activeList.push(e)},selectId:function(e,t){var a=this.selectIdMap.get(e);a&&this.setFosterSelect(e,a,!1),this.setFosterSelect(e,t,!0),this.selectIdMap.set(e,t)},initSelectId:function(e){var t=this.selectIdMap.get(e);t&&this.setFosterSelect(e,t,!1),this.selectIdMap.set(e,0)},setFosterSelect:function(e,t,a){var i=this.getFosterInfo(e,t);i&&(i.select=a)},setFosterFetterSelect:function(e,t){this.selectFettersInfoMap.set(e,t)},setCurShowIndex:function(e){this.curShowIndex=e},getFosterInfo:function(e,t){var a=this.fosterDataMap.get(e);return a?a.get(t):null},getStar:function(e,t){var a=this.getFosterInfo(e,t);return a?a.star:0},getFosterAllScoreByType:function(e){var t=this,a=t.getFosterActiveIds(e);if(!a||a.length<1)return 0;t.allSpriteStat||(t.allSpriteStat=game.SpriteStat.get()),t.allSpriteStat.clear();for(var i=void 0,n=void 0,s=a.length,r=void 0,o=0;o<s;o++)if(n=(i=a[o]).getAllSpriteStat()){var g=i.getFosterEquipMap();g&&g.forEach(t.getEquipSpriteStat,t),t.allSpriteStat.addSpriteStat(n),i.enchLv&&(r=game.aoyiExpandData.getEnchSpriteStat(i),t.allSpriteStat.addSpriteStat(r)),i.runes&&0<i.runes.length&&(r=game.aoyiExpandData.getRuneSpriteStat(i),t.allSpriteStat.addSpriteStat(r))}return this.getPowerAddExeSp(e,t.allSpriteStat)},getEquipSpriteStat:function(e,t){var a=t.getFosterEquipInfo();if(a){var i=a.getAllSpriteStat();this.allSpriteStat.addSpriteStat(i)}},getShowPower:function(e,t){var a=this.getFosterInfo(e,t);if(!a)return 0;if(!a.active)return a.getPower();var i=a.getAllSpriteStat();return i?i.getTeamPower():0},getPower:function(e,t){var a=this.getFosterInfo(e,t);if(!a)return 0;if(!a.active)return a.getPower();var i=a.getAllSpriteStat();return i?this.getPowerAddExeSp(e,i):0},getPowerAddExeSp:function(e,t){var a=this;a.powerSpriteStat||(a.powerSpriteStat=game.SpriteStat.get()),a.powerSpriteStat.clear(),a.powerSpriteStat.addSpriteStat(t);var i=a.fosterFetterMap.get(e);if(i&&0<i.count()){var n=void 0;i.forEach(function(e,t){t&&t.active&&(n=t.getCurSpriteStat())&&a.powerSpriteStat.addSpriteStat(n)},a)}var s=a.getFosterAttrItemCfg(e);if(s){var r=a.getAttrItemNum(e,s.itemId)||0;a.powerSpriteStat.addByCfg(s,!0,r)}return a.powerSpriteStat.getTeamPower()},getAttrItemStat:function(e){this.tempAttrItemStat||(this.tempAttrItemStat=game.SpriteStat.get()),this.tempAttrItemStat.clear();var t=this.getFosterAttrItemCfg(e);if(t){var a=this.getAttrItemNum(e,t.itemId)||0;this.tempAttrItemStat.addByCfg(t,!0,a)}},getSkillId:function(e,t){var a=this.getFosterInfo(e,t);if(!a)return 0;var i=a.getUpStarCfg();return i?i.skill:0},getAllSpriteStat:function(e,t){var a=this.getFosterInfo(e,t);if(!a)return null;var i=a.getAllSpriteStat();return i||null},getIsInBattle:function(e,t){return this.battleIdMap.get(e)==t},getBattleInfo:function(e){var t=this.battleIdMap.get(e);return t?this.getFosterInfo(e,t):null},getHeadList:function(e){var t=this.fosterDataMap.get(e);if(!t)return null;var a=t.values();return a.sort(this.onSort),a},onSort:function(e,t){return e.isBattle==t.isBattle?e.active&&!t.active?-1:!e.active&&t.active?1:e.active&&t.active?e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:t.sortId-e.sortId:e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:e.isAlert&&t.isAlert?t.sortId-e.sortId:e.sortId-t.sortId:e.isBattle?-1:1},getCurExp:function(e,t){var a=this.getFosterInfo(e,t);return a?a.exp:0},getCurStarCfg:function(e,t){var a=this.getFosterInfo(e,t);return a?a.getUpStarCfg():null},getCurSelectFettersInfo:function(e){var t=this.selectFettersInfoMap.get(e);return t||null},getCurId:function(e){var t=this.selectIdMap.get(e);if(!t){var a=this.getHeadList(e);if(!a||a.length<1)return 0;t=a[0].id,this.setFosterSelect(e,t,!0),this.selectIdMap.set(e,t)}return t},getFettersList:function(e){var t=this.fosterFetterMap.get(e);if(!t)return null;var a=t.values();return a.sort(this.onFetterSort),a},onFetterSort:function(e,t){return e.active&&!t.active?-1:!e.active&&t.active?1:e.active&&t.active?e.isMax&&t.isMax?t.id-e.id:!e.isMax&&t.isMax?-1:e.isMax&&!t.isMax?1:e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:t.id-e.id:e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:e.id-t.id},getActiveFetterSpriteStat:function(e){this.tempList.length=0;var t=this.fosterFetterMap.get(e);if(!t)return null;var a=t.values();if(!a||a.length<1)return null;this.tempSpriteStat2||(this.tempSpriteStat2=game.SpriteStat.get());var i=this.tempSpriteStat2;i.clear();for(var n=void 0,s=void 0,r=a.length,o=0;o<r;o++)(n=a[o]).active&&(s=n.getClientCurSpriteStat())&&i.addSpriteStat(s);return i},getClientSpriteStat:function(e){if(!e)return null;this.tempSpriteStat||(this.tempSpriteStat=game.SpriteStat.get());var t=this.tempSpriteStat;t.clear();var a=b8e.getDPV(e,"teamAtkClient");return t.setStatValue(game.SpriteStatType.TeamAtk,a),a=b8e.getDPV(e,"teamDefClient"),t.setStatValue(game.SpriteStatType.TeamDef,a),a=b8e.getDPV(e,"teamHpClient"),t.setStatValue(game.SpriteStatType.TeamHp,a),t},getFosterAllStar:function(e){var t=this.fosterDataMap.get(e);if(!t)return null;var a=t.values();if(!a||a.length<1)return 0;for(var i=void 0,n=0,s=a.length,r=0;r<s;r++)(i=a[r]).active&&(n+=i.star);return n},getFosterConditionStar:function(e,t){var a=0,i=this.fosterDataMap.get(e);if(!i)return a;var n=i.values();if(!n||n.length<1)return a;for(var s=void 0,r=n.length,o=0;o<r;o++)(s=n[o]).active&&s.star>=t&&a++;return a},getActiveNumByType:function(e){var t=this.fosterDataMap.get(e),a=0;if(!t)return a;var i=t.values();if(!i||i.length<1)return a;for(var n=i.length,s=0;s<n;s++)i[s].active&&a++;return a},getFosterQuaAndCondition:function(e,t,a,i){var n=2<arguments.length&&void 0!==a?a:null,s=3<arguments.length&&void 0!==i?i:0,r=0,o=this.fosterDataMap.get(e);if(!o)return r;var g=o.values();if(!g||g.length<1)return r;for(var u=void 0,l=g.length,c=0;c<l;c++)if((u=g[c]).active){var h=!0;if(n)switch(n){case 1:h=u.star>=s;break;case 2:h=u.lv>=s}u.quality==t&&h&&r++}return r},getChaseSkillActive:function(e,t){var a=this.getMiscValue(e,"chaseMinStar");return(a?+a:0)<t},getCurFosterInfo:function(){var e=this.curFosterType,t=this.getCurId(e);return this.getFosterInfo(e,t)},getSkillList:function(e,t,a){var i=!(2<arguments.length&&void 0!==a)||a,n=this,s=n.getFosterUpStarCfgsById(e,t),r=game.fosterData.getStar(e,t);if(!s)return null;var o=n.getFosterActive(e,t);n.skillList||(n.skillList=[]);for(var g=void(n.skillList.length=0),u=void 0,l=s.length,c=0;c<l;c++)g=s[c],(u=n.getSkillInfo(c)).setData(g.skill,g.star,r,o),n.skillList.push(u);return i&&n.skillList.sort(n.onSortId),n.skillList},onSortId:function(e,t){return!e.isSelect&&t.isSelect?1:e.isSelect&&!t.isSelect?-1:e.star-t.star},getSkillInfo:function(e){return this.skillInfoPool||(this.skillInfoPool=[]),this.skillInfoPool[e]||(this.skillInfoPool[e]=new game.FosterSkillInfo),this.skillInfoPool[e]},getAttrItemNum:function(e,t){var a=this.attrItemMap.get(e);if(!a)return 0;var i=a.get(t);return i||0},getIsActiveByType:function(e){return this.activeList&&-1<this.activeList.indexOf(e)},getFetterDefaultSpriteStat:function(){if(this.defaultSpriteStat)return this.defaultSpriteStat;this.defaultSpriteStat||(this.defaultSpriteStat=game.SpriteStat.get());var e=this.defaultSpriteStat;return e.setStatValue(game.SpriteStatType.TeamAtk,0),e.setStatValue(game.SpriteStatType.TeamDef,0),e.setStatValue(game.SpriteStatType.TeamHp,0),e},getFosterActive:function(e,t){var a=this.getFosterInfo(e,t);return a&&a.active},getBattleSkillId:function(e){var t=this.getBattleInfo(e);if(!t)return 0;var a=t.getUpStarCfg();return a&&a.skill?a.skill:0},getFosterActiveIds:function(e){var a=this;if(!a.getIsActiveByType(e))return null;var t=a.fosterDataMap.get(e);return t?(a._activeIds||(a._activeIds=[]),a._activeIds.length=0,t.forEach(function(e,t){t.active&&(a._activeIds[a._activeIds.length]=t)},a),a._activeIds):null},initFosterInfo:function(e){var t=this.fosterDataMap.get(e);if(!t){t=b8e.HashMap.get(),this.fosterDataMap.set(e,t);var a=this.getFosterClientCfgByType(e);if(a){var i=this.getFosterBaseCfgCls(e);if(i){var n=i.getDatas();if(n&&!(n.length<1))for(var s=void 0,r=void 0,o=n.length,g=0;g<o;g++)s=n[g],(r=new game.FosterInfo).setBaseData(s,e),r.setClientData(a),t.set(r.id,r)}}}},initFetterInfo:function(e){var t=this.fosterFetterMap.get(e);if(!t){t=b8e.HashMap.get(),this.fosterFetterMap.set(e,t);var a=this.getFetterCfgsByStar(e,1);if(a&&!(a.length<1))for(var i=void 0,n=void 0,s=a.length,r=0;r<s;r++)i=a[r],(n=new game.FosterFettersInfo).setBaseData(i,e),t.set(n.id,n)}},getOpenFosterType:function(){var e=this.fosterDataMap.keys();return!e||e.length<1?null:e},checkFosterAlert:function(e,t){var a=1<arguments.length&&void 0!==t?t:0,i=!1,n=this.fosterDataMap.get(e);if(!n)return i;var s=n.values();if(!s||s.length<1)return i;for(var r=void 0,o=s.length,g=0;g<o;g++){switch(r=s[g],a){case 0:i=r.checkAlert();break;case 1:i=r.checkInfoAlert()||r.checkAwakeAlert()||r.checkEquipAlert();break;case 2:i=r.checkUpgradeAlert();break;case 3:i=r.checkStarAlert()}if(i)return i}return i},checkFosterFetterAlert:function(e,t){var a=!1,i=this.fosterFetterMap.get(e);if(!i)return a;var n=i.values();if(!n||n.length<1)return a;for(var s=n.length,r=0;r<s;r++)if((a=n[r].checkAlert())&&!t)return a;return a},checkFosterInfo:function(e){var t=this.fosterDataMap.get(e);if(t){var a=t.values();if(a&&!(a.length<1))for(var i=a.length,n=0;n<i;n++)a[n].checkAlert()}},checkFosterAttrItemAlert:function(e){var t=this.getAttrItemId(e);return!!t&&0<game.itemData.getNumById(t)},getAttrItemId:function(e){if(this.attrItemList||(this.attrItemList=[]),this.attrItemList[e])return this.attrItemList[e];var t=this.getFosterAttrItemCfg(e);return t?(this.attrItemList[e]=t.itemId,this.attrItemList[e]):0},getFosterClientCfgByType:function(e){return this.cfgObj1||(this.cfgObj1=b8e.createMap()),this.cfgObj1.id=e,game.FosterClientCfg.getData(this.cfgObj1)},getFosterClientCfgByME:function(e){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.moduleEnum=e,game.FosterClientCfg.getData(this.cfgObj2)},getFetterCfgById:function(e,t,a){var i=this.getFettersCfgCls(e);return i?(this.cfgObj3||(this.cfgObj3=b8e.createMap()),this.cfgObj3.id=t,this.cfgObj3.star=a,i.getData(this.cfgObj3)):null},getFettersCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountFetterCfg;case game.NewFosterType.WING:return game.WingFetterCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiFetterCfg;case game.NewFosterType.HALO:return game.HaloFetterCfg;case game.NewFosterType.SHENHUN:return game.ShenhunFetterCfg}return null},getFetterCfgsByStar:function(e,t){var a=this.getFettersCfgCls(e);return a?(this.cfgObj4||(this.cfgObj4=b8e.createMap()),this.cfgObj4.star=t,a.getData(this.cfgObj4,!0)):null},getFosterAttrItemCfg:function(e){var t=this.getAttrItemCfgCls(e);if(!t)return null;var a=t.getDatas();return!a||a.length<1?null:a[0]},getAttrItemCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountAttrItemCfg;case game.NewFosterType.WING:return game.WingAttrItemCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiAttrItemCfg;case game.NewFosterType.HALO:return game.HaloAttrItemCfg;case game.NewFosterType.SHENHUN:return game.ShenhunAttrItemCfg}return null},getFosterSaeByType:function(e,t){var a=this.getFosterClientCfgByType(e);if(!a)return 0;var i=b8e.getDPV(a,t);if(!i)return 0;var n=b8e.getDPV(game.SAE,i);return n||0},getFosterUpgradeCfg:function(e,t,a){var i=this.getUpgradeCfgCls(e);return i?i.getData(a):null},getUpgradeCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountUpgradeCfg;case game.NewFosterType.WING:return game.WingUpgradeCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiUpgradeCfg;case game.NewFosterType.HALO:return game.HaloUpgradeCfg;case game.NewFosterType.SHENHUN:return game.ShenhunUpgradeCfg}return null},getFosterBookCfgs:function(e){var t=this.getFosterBookCfgCls(e);return t?t.getDatas():null},getFosterBookCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountBookCfg;case game.NewFosterType.WING:return game.WingBookCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiBookCfg;case game.NewFosterType.HALO:return game.HaloBookCfg;case game.NewFosterType.SHENHUN:return game.ShenhunBookCfg}return null},getFosterUpStarCfg:function(e,t,a){var i=this.getFosterUpStarCfgCls(e);return i?(this.cfgObj6||(this.cfgObj6=b8e.createMap()),this.cfgObj6.id=t,this.cfgObj6.star=a,i.getData(this.cfgObj6)):null},getFosterUpStarCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountStarCfg;case game.NewFosterType.WING:return game.WingStarCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiStarCfg;case game.NewFosterType.HALO:return game.HaloStarCfg;case game.NewFosterType.SHENHUN:return game.ShenhunStarCfg}return null},getFosterUpStarCfgsById:function(e,t){var a=this.getFosterUpStarCfgCls(e);return a?(this.cfgObj5||(this.cfgObj5=b8e.createMap()),this.cfgObj5.id=t,a.getData(this.cfgObj5,!0)):null},getFosterBaseCfg:function(e,t){var a=this.getFosterBaseCfgCls(e);return a?a.getData(t):null},getFosterBaseCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountBaseCfg;case game.NewFosterType.WING:return game.WingBaseCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiBaseCfg;case game.NewFosterType.HALO:return game.HaloBaseCfg;case game.NewFosterType.SHENHUN:return game.ShenhunBaseCfg}return null},getMiscValue:function(e,t){var a=this.getFosterMiscCfgCls(e);if(!a)return null;var i=a.getData(t);return i?i.value:null},getFosterMiscCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountMiscCfg;case game.NewFosterType.WING:return game.WingMiscCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiMiscCfg;case game.NewFosterType.HALO:return game.HaloMiscCfg;case game.NewFosterType.SHENHUN:return game.ShenhunMiscCfg}return null},getMaxStar:function(e){var t=this.getMiscValue(e,"maxStar");return t?+t:0},getChaseSkillCfg:function(e,t,a){var i=this.getFosterChaseSkllCfgCls(e);if(!i)return null;var n=this.getCurChaseStar(e,t,a);return n?i.getData(n):null},getFosterChaseSkllCfgCls:function(e){switch(e){case game.NewFosterType.WING:return game.WingSkillCfg}return null},getCurChaseStar:function(e,t,a){this.chaseStarMap||(this.chaseStarMap=b8e.HashMap.get());var i=this.chaseStarMap.get(e);if(!i){var n=this.getMiscValue(e,"chaseStars");if(!n)return this.chaseStarMap.set(e,[]),0;i=n.split(","),this.chaseStarMap.set(e,i)}if(i.length<1)return 0;for(var s=void 0,r=i.length;-1<r;r--)if((s=+i[r])<=t)return a?+i[r+1]:s;return a?+i[1]:+i[0]},getChaseSkillLv:function(e){var t=this.getChaseSkillCfg(e,this.getFosterAllStar(e),!1);return t&&t.lv||0},getChaseMaxSkillLv:function(e){var t=this.getMiscValue(e,"maxChaseLv");return t?+t:0}});game.fosterData=game.fosterData||new e}(),function(){var e;e=game.CultivateBaseInfo.extends({id:0,star:0,active:!1,isAlert:!1,isMax:!1,levelSpriteStat:{get:function(){return this._levelSpriteStat||(this._levelSpriteStat=game.SpriteStat.get()),this._levelSpriteStat}},nextLevelSpriteStat:{get:function(){return this._nextLevelSpriteStat||(this._nextLevelSpriteStat=game.SpriteStat.get()),this._nextLevelSpriteStat}},ctor:function(){this._super()},setData:function(){},setFetterLv:function(e){this.star=e,this.active=!0;var t=this.getCfg();this.isMax=!!t&&t.isMax},setBaseData:function(e,t){this.id=e.id,this.star=0,this.cfg=e,this.fosterType=t},getCfg:function(){var e=game.fosterData.getFetterCfgById(this.fosterType,this.id,this.star);return e||null},getNextCfg:function(){var e=game.fosterData.getFetterCfgById(this.fosterType,this.id,this.star+1);return e||null},getClientCurSpriteStat:function(){var e=this.getCfg();return e?game.fosterData.getClientSpriteStat(e):null},checkAlert:function(e){var t=0<arguments.length&&void 0!==e&&e,a=this.getCfg();if(!a||a.isMax)return t&&game.notice.show(51837),this.isAlert=!1;var i=this.getNextCfg();if(!i)return this.isAlert=!1;var n=a.units;if(!n||n.length<1)return this.isAlert=!1;for(var s=this.active?i.star:a.star,r=void 0,o=void 0,g=n.length,u=0;u<g;u++){if(r=n[u],!(o=game.fosterData.getFosterInfo(this.fosterType,r))||!o.active)return void(t&&game.notice.show(51838));if(o.star<s)return t&&game.notice.show(51839,s),this.isAlert=!1}return this.isAlert=!0},getCurSpriteStat:function(){var e=this.levelSpriteStat;if(!e)return null;var t=this.getCfg();return t?(e.setupByCfg(t),e):null}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FosterFettersInfo",e)}(),function(){var e;e=game.CultivateBaseInfo.extends({isShowBattle:!0,isShowName:!0,isShowLv:!0,exp:0,star:0,awakeStar:0,infoAlert:!1,upgradeAlert:!1,upStarAlert:!1,awakeAlert:!1,spiritAlert:!1,sealAlert:!1,normalUrl:0,grayUrl:0,isBattle:!1,isShowAlert:!1,spiritLv:0,seal:0,selectEquipSlot:0,runes:null,enchLv:0,quality:0,featherStar:0,featherAttr:null,activeSpriteStat:{get:function(){return this._activeSpriteStat||(this._activeSpriteStat=game.SpriteStat.get()),this._activeSpriteStat}},starSpriteStat:{get:function(){return this._starSpriteStat||(this._starSpriteStat=game.SpriteStat.get()),this._starSpriteStat}},awakeSpriteStat:{get:function(){return this._awakeSpriteStat||(this._awakeSpriteStat=game.SpriteStat.get()),this._awakeSpriteStat}},levelSpriteStat:{get:function(){return this._levelSpriteStat||(this._levelSpriteStat=game.SpriteStat.get()),this._levelSpriteStat}},nextLevelSpriteStat:{get:function(){return this._nextLevelSpriteStat||(this._nextLevelSpriteStat=game.SpriteStat.get()),this._nextLevelSpriteStat}},nextStarSpriteStat:{get:function(){return this._nextStarSpriteStat||(this._nextStarSpriteStat=game.SpriteStat.get()),this._nextStarSpriteStat}},tempSpriteStat:{get:function(){return this._tempSpriteStat||(this._tempSpriteStat=game.SpriteStat.get()),this._tempSpriteStat}},awakenSkills:{get:function(){return this._awakenSkills||this.initAwakenSkills(),this._awakenSkills}},initAwakenSkills:function(){this._awakenSkills=[];var e=void 0,t=game.starSoulData.getSkillCfgCls(this.fosterType).getData(this.id,!0);if(t)for(var a=void 0,i=0,n=t.length;i<n;i++)a=t[i],(e=new game.PartnerSkillGroupInfo).skill=a.skill,e.star=a.star,(e.info=this)._awakenSkills.push(e)},ctor:function(){this._super(),this.featherAttr=[]},setFosterData:function(e){var t=this;e&&(t.setLvInfo(e.lv,e.exp),t.setStar(e.star),t.setAwake(e.awakenStar),t.setSpirit(e.spirit),t.setSeal(e.seal),t.setEquip(e.fosterEquip,e.id),t.setRunes(e.runes),t.setEnchLv(e.enchLv),t.setFeatherStar(e.featherStar),t.setFeatherAttr(e.featherAttr))},setFeatherStar:function(e){this.featherStar=e},setFeatherAttr:function(e){this.featherAttr=e},setSpirit:function(e){this.spiritLv=e},setSeal:function(e){this.seal=e},setLvInfo:function(e,t){this.lv=e,this.exp=t},setStar:function(e){this.star=e},setRunes:function(e){this.runes=e},setEnchLv:function(e){this.enchLv=e},setAwake:function(e){this.awakeStar=e;var t=game.starSoulData.getFosterAwakeCfg(this.fosterType,this.id);if(!t)return!1;if(t&&t.awakenSkill){for(var a=void 0,i=0,n=this.awakenSkills.length;i<n;i++)this.awakenSkills[i].star<=this.awakeStar&&(a=this.awakenSkills[i]);this.awakenSkill=a||this.awakenSkills[0]}},setEquip:function(e){var t=this.id,a=this.fosterType,i=e.length;if(!(i<1))for(var n=void 0,s=void 0,r=this.getFosterEquipMap(),o=0;o<i;o++)n=e[o],(s=r.get(n.slot))||(s=new game.FosterEquipSlotInfo,r.set(n.slot,s)),s.setFosterData(n,t,a)},wearEquip:function(e,t,a){if(t&&!(t.length<1))for(var i=void 0,n=void 0,s=void 0,r=t.length,o=this.getFosterEquipMap(),g=0;g<r;g++)i=t[g],(n=game.ItemInfoCfg.getData(i.id))&&((s=o.get(n.pos))||(s=new game.FosterEquipSlotInfo,o.set(n.pos,s)),s.wearEquip(i,e,a,n.pos))},castEquip:function(e){var t=this.getFosterEquipMap().get(e);t&&t.castEquip()},foterEquipQh:function(e){for(var t=this.getFosterEquipMap(),a=void 0,i=void 0,n=e.length,s=0;s<n;s++){a=e[s];var r=t.get(a.slot);r&&(i=r.getFosterEquipInfo())&&i.setLv(a.lv)}},foterEquipUpstar:function(e,t){var a=this.getFosterEquipMap().get(e);if(a){var i=a.getFosterEquipInfo();i&&i.setData(t)}},foterEquipWashLock:function(e,t){var a=this.getFosterEquipMap().get(e);if(a){var i=a.getFosterEquipInfo();i&&i.updateLock(t)}},foterEquipWash:function(e,t){var a=this.getFosterEquipMap().get(e);if(a){var i=a.getFosterEquipInfo();i&&i.updateWashAttrs(t)}},getFosterEquipMap:function(){var e=this.fosterEquipMap;if(!e){e=this.fosterEquipMap=b8e.HashMap.get();for(var t=void 0,a=void 0,i=this.id,n=this.fosterType,s=game.fosterEquipData.maxSlotNum,r=0;r<s;r++)t=r+1,e.get(t)||(a=new game.FosterEquipSlotInfo,e.set(t,a),a.setEmptyData(t,i,n))}return e},getFosterSlotInfoBySlot:function(e){var t=this.getFosterEquipMap();return t?t.get(e):null},getFosterEquipInfoBySlot:function(e){var t=this.getFosterSlotInfoBySlot(e);return t?t.getFosterEquipInfo():null},getNotEmptyCount:function(){for(var e=void 0,t=void 0,a=0,i=this.getFosterEquipMap(),n=game.fosterEquipData.maxSlotNum,s=0;s<n;s++)t=s+1,(e=i.get(t))&&e.getFosterEquipInfo()&&a++;return a},setSelectEquip:function(e){var t=void 0,a=this.getFosterEquipMap();if(this.selectEquipSlot==e)return!1;this.selectEquipSlot&&(t=a.get(this.selectEquipSlot))&&(t.select=!1),(t=a.get(e))&&(this.selectEquipSlot=e,t.select=!0)},getSelectInfo:function(){var e=this.getFosterEquipMap();return e?e.get(this.selectEquipSlot):null},defaultSelect:function(){var e=this.getFosterEquipMap();if(e){for(var t=void 0,a=void 0,i=0,n=game.fosterEquipData.maxSlotNum,s=0;s<n;s++)if(t=s+1,a=e.get(t)){if(a.getFosterEquipInfo()){a.select=!0,i=t;break}a.select=!1}i=i||1,this.setSelectEquip(i)}},setBattle:function(e){this.isBattle=e},setActive:function(){this.active=!0},setBaseData:function(e,t){this.fosterType=t,(this.cfg=e)&&(this.id=e.id,this.name=e.name,this.sortId=e.sortId,this.quality=e.quality)},setClientData:function(e){e&&(this.normalUrl=e.iconUrl,this.grayUrl=e.grayIconUrl)},checkAlert:function(){var e=this;return e.infoAlert=e.checkInfoAlert(),e.active?(e.upgradeAlert=e.checkUpgradeAlert(),e.upStarAlert=e.checkStarAlert(),e.awakeAlert=e.checkAwakeAlert(),e.spiritAlert=e.checkSpiritAlert(),e.sealAlert=e.checkSealAlert(),e.equipAlert=e.checkEquipAlert(),e.aoyiExpandAlert=e.checkAoyiExpandAlert(),e.featherAlert=e.checkFeatherAlert(),e.isAlert=e.infoAlert||e.upgradeAlert||e.upStarAlert||e.awakeAlert||e.spiritAlert||e.sealAlert||e.equipAlert||e.aoyiExpandAlert||e.featherAlert):e.isAlert=e.infoAlert},checkInfoAlert:function(){return!this.cfg||this.active?!game.fosterData.getBattleInfo(this.fosterType):game.itemData.getCountById(this.cfg.itemId)>=this.cfg.itemNum},checkUpgradeAlert:function(){if(2*game.mainRoleData.lv<=this.lv||this.lv>=game.mainRoleData.maxLv)return!1;var e=this.getUpgradeCfg();if(!e||e.isMax)return!1;var t=e.exp-this.exp,a=game.fosterData.getFosterBookCfgs(this.fosterType);if(!a||a.length<1)return!1;for(var i=void 0,n=void 0,s=0,r=a.length,o=0;o<r;o++)if(i=a[o],!((n=game.itemData.getCountById(i.id))<1)&&t<=(s+=i.exp*n))return!0;return!1},checkStarAlert:function(){var e=this.getUpStarCfg();return!(!e||e.isMax)&&game.UpgradeUtil.checkItemInfo(e.itemId,e.itemNum,!1)},checkAwakeAlert:function(){var e=game.starSoulData.getFosterAwakeCfg(this.fosterType,this.id);return!!e&&(!(this.star<e.activateStar)&&game.UpgradeUtil.checkItemInfo(e.itemId,e.num,!1))},checkSpiritAlert:function(){if(!game.moduleOpen.checkOpen(game.ME.JuLing)||this.fosterType!=game.NewFosterType.HALO)return!1;var e=game.juLingData.getJuLingCurLvCfg(this.id,this.spiritLv);if(!e)return!1;var t=e.cost[0];return!!t&&game.UpgradeUtil.checkItemInfo(t.Id,t.Num,!1)},checkSealAlert:function(){if(!game.moduleOpen.checkOpen(game.ME.KeYin)||this.fosterType!=game.NewFosterType.HALO)return!1;var e=game.keYinData.getKeYinCurLvCfg(this.id,this.seal+1);if(!e)return!1;var t=e.cost[0];return!!t&&(!(this.star<e.limit)&&game.UpgradeUtil.checkItemInfo(t.Id,t.Num,!1))},checkFeatherAlert:function(){if(!game.moduleOpen.checkOpen(game.ME.YuHua)||this.fosterType!=game.NewFosterType.WING)return!1;var e=void 0;if(game.yuHuaData.getIsActive(this.id))e=game.yuHuaData.getFeatherCfg(this.id,this.featherStar+1);else{if(0!=this.featherStar)if(game.yuHuaData.getFeatherCfg(this.id,this.featherStar).max)return!1;e=game.yuHuaData.getFeatherRefineCfg(this.id,this.featherStar,1)}if(!e)return!1;var t=e.costItem[0];return!!t&&game.UpgradeUtil.checkItemInfo(t.Id,t.Num,!1)},checkEquipAlert:function(){var e=this.fosterType==game.NewFosterType.SHENHUN?game.ME.ShenhunEquip:game.ME.MountEquip;return!!game.moduleOpen.checkOpen(e)&&game.fosterEquipData.checkAlert(this)},checkAoyiExpandAlert:function(){if(this.fosterType!=game.NewFosterType.ZHANJI)return!1;var e=game.AoyiExpandOpenCfg.getData(this.id);return!(!e||this.lv<e.lv||this.star<e.star)&&(game.aoyiExpandData.checkCanEnchantment(this)||game.aoyiExpandData.checkRuneAlert(this))},getPower:function(){var e=this.getAllSpriteStat();return e?e.getTeamPower():0},getAllSpriteStat:function(){var e=this.tempSpriteStat;if(!e)return null;e.clear();var t=this.getUpgradeSpriteStat();e.addSpriteStat(t);var a=this.getUpStarCfg();if(a&&e.addByCfg(a),this.awakeStar){var i=this.getAwakeCfg();e.addByCfg(i,!0,this.awakeStar)}return e},getUpgradeSpriteStat:function(){var a=this,i=a.levelSpriteStat;if(!i||!a.cfg)return null;var n=void 0,s=void 0,r=a.cfg;i.setupByCfg(r);var e=a.getUpStarCfg(),o=e?1+e.addRate/1e3:1;return i.getSpriteStats().forEach(function(e,t){n=game.KeyPerStatType[e],n=b8e.getNormP(n),s=t,null!=r[n]&&(s=r[n]*a.lv*o+t),i.setStatValue(e,s)},a),i},geNextLvSpriteStat:function(){var a=this.nextLevelSpriteStat;if(!a||!this.cfg)return null;var i=void 0,n=void 0,s=this.lv+1,r=this.cfg,e=this.getUpStarCfg(),o=e?1+e.addRate/1e3:1;return a.setupByCfg(r),a.getSpriteStats().forEach(function(e,t){i=game.KeyPerStatType[e],i=b8e.getNormP(i),n=t,null!=r[i]&&(n=r[i]*s*o+t),a.setStatValue(e,n)},this),a},getCurStarSpriteStat:function(){var e=this.starSpriteStat;if(!e)return null;var t=this.getUpStarCfg();return t&&e.setupByCfg(t,!0,!0),e},geNextStarSpriteStat:function(){var e=this.starSpriteStat;if(!e)return null;var t=this.getNextUpStarCfg();return t&&e.setupByCfg(t,!0,!0),e},getCurAwakeSpriteStat:function(){var e=this.awakeSpriteStat;if(!e)return null;var t=this.getAwakeCfg();return t&&e.addByCfg(t,!0,this.awakeStar),e},getUpStarCfg:function(){return this.getStarCfgByStar(this.star)},getNextUpStarCfg:function(){return this.getStarCfgByStar(this.star+1)},getStarCfgByStar:function(e){return game.fosterData.getFosterUpStarCfg(this.fosterType,this.id,e)},getUpgradeCfg:function(){return game.fosterData.getFosterUpgradeCfg(this.fosterType,this.id,this.lv)},getAwakeCfg:function(){return game.starSoulData.getFosterAwakeCfg(this.fosterType,this.id)},getUpStarIsMax:function(){var e=this.getUpStarCfg();return e&&e.isMax},getBattleOrWaitBattle:function(){return 1==this.isBattle?2:0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FosterInfo",e)}(),function(){var e;e=b8e.Enum({NONE:0,MOUNT:1,WING:2,ZHANJI:3,HALO:4,SHENHUN:5,ZHENXING:100,SHENQI:101}),b8e.RC("$$game","$$NewFosterType",e)}(),function(){var e;e=b8e.Object.extends({id:0,star:0,isSelect:!1,active:!1,ctor:function(){this._super()},setData:function(e,t,a,i){this.id=e,this.star=t,this.isSelect=a==t,this.active=i}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FosterSkillInfo",e)}(),function(){var e=game.View.extends({_attrItemGrid:null,_attrItemInfo:null,attrItemData:null,fosterData:null,_modelTouchClose:!1,_showModel:!0,ctor:function(){this._super(1377)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_ATTR:this.changeAttrItem(),this.setUsedNum();var t=this.getAttrItem(),a=game.itemData.getNumById(t)-this.useNum;this.useNum=0<a?a:0,this.setUseNum();break;case this.Evts.C2V_UPDATE_ITEM:this.setBackNum()}},init:function(){if(!this._attrItemGrid){this._attrItemGrid=game.GridUtil.createItemIcon(),this._attrItemGrid.addToParent(this.skin.icon)}},onShow:function(){var e=this;e.fosterType=game.fosterData.curFosterType,e.setAttrItemIcon(),e.setUsedNum(),e.setBackNum();var t=e.getAttrItem();e.useNum=game.itemData.getNumById(t),e.setToGet(),e.changeAttrItem();var a=game.fosterData.getFosterClientCfgByType(e.fosterType);a&&(e.skin.labTitle.string=game.Lang.get(6203,a.name)),e.setUseNum(),e.send(e.Evts.V_SHOW_VIEW)},onHide:function(){},getAttrItem:function(){return game.fosterData.getAttrItemId(this.fosterType)},changeAttrItem:function(){var e=this.getAttrItem(),t=game.fosterData.getFosterAttrItemCfg(this.fosterType);if(t){var a=game.fosterData.getAttrItemNum(this.fosterType,e)||0;this.setSpriteStat(t,a)}},setAttrItemIcon:function(){var e=this.getAttrItem();this._attrItemInfo=game.ItemUtil.createBaseItemInfo(e,1,this._attrItemInfo),game.GridUtil.setItemIcon(this._attrItemGrid,this._attrItemInfo,!1,0)},setUsedNum:function(){var e=this.getAttrItem(),t=game.fosterData.getAttrItemNum(this.fosterType,e)||0;this.skin.usedNum.string=game.Lang.get(9504,t)},setBackNum:function(){var e=this.getAttrItem();this.skin.backNum.string=game.itemData.getNumById(e)},setToGet:function(){var e=this.getAttrItem(),t=game.ItemInfoCfg.getData(e);t?(""==t.des2&&(this.skin.toGet.node.active=!1),this.skin.itemName.string=t.name,this.skin.toGet.string=game.Lang.get(50152,t.des2)):b8e.error("cfg \u4e0d\u5b58\u5728!!!",e)},setUseNum:function(){this.skin.useNum.string=this.useNum},setSpriteStat:function(e,a){var i=this;i.spriteStat||(i.spriteStat=game.SpriteStat.get()),i.spriteStat.setupByCfg(e);var t=i.spriteStat.getSpriteStats();if(t){var n=1,s=void 0;t.forEach(function(e,t){e=+e,(s=game.AttrRulesCfg.getData(e))&&(t=game.CCommonUtil.replaceNum(t*a,2),i.getComponent("sptireLab_"+n).string=game.Lang.get(509,s.name,t)),n++},i)}},view_addOneBtn:function(){var e=this.getAttrItem(),t=game.itemData.getNumById(e),a=this.useNum+1;this.useNum=a<=t?a:t,this.setUseNum()},view_addTenBtn:function(){var e=this.getAttrItem(),t=game.itemData.getNumById(e),a=this.useNum+10;this.useNum=a<=t?a:t,this.setUseNum()},view_lessenOneBtn:function(){var e=this.useNum-1;this.useNum=-1<e?e:0,this.setUseNum()},view_lessenTenBtn:function(){var e=this.useNum-10;this.useNum=-1<e?e:0,this.setUseNum()},view_useBtn:function(){if(this.useNum<1)game.notice.show(9141);else{var e=this.getAttrItem();this.send(this.Evts.V2C_USE_ATTR_ITEM,e,this.useNum)}}});b8e.module.registerView(game.ME.FosterAttrItem,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1376)},init:function(){},onShow:function(){var e=this.skin,t=this.fosterType=game.fosterData.curFosterType,a=game.fosterData.getFosterAllStar(t),i=game.fosterData.getChaseSkillCfg(t,a,!1);if(i){var n,s,r=void 0,o=void 0,g=game.fosterData.getChaseSkillActive(t,a);if(n=g?51613:51612,e.topTitle.string=game.Lang.get(n),s=g?51592:51614,r=game.Lang.get(i.chaseDes,i.chaseDesParam),o=game.Lang.get(i.chaseDes2,i.chaseDes2Param),e.topDes.string=game.Lang.get(s,i.star,a,i.star,r,o),e.maxImg.active=i.isMax,e.bottomDes.active=!i.isMax,e.topPage.height=e.topBg.height=e.topDes.height+80,e.bottomPage.y=e.topPage.y-e.topPage.height-85,i.isMax)return e.bottomBg.height=200,e.bottomPage.height=200,void this.updateLayout();var u=game.fosterData.getChaseSkillCfg(t,a,!0);u&&(r=game.Lang.get(u.chaseDes,u.chaseDesParam),o=game.Lang.get(u.chaseDes2,u.chaseDes2Param),e.bottomDes.string=game.Lang.get(51614,u.star,a,u.star,r,o),e.bottomPage.height=e.bottomBg.height=e.bottomDes.height+80),this.updateLayout()}},updateLayout:function(){var e=this.skin;e.infoBg.height=e.topPage.height+e.bottomPage.height+105,e.bg.height=e.infoBg.height+180,e.returnBtn.y=45-e.bg.height,this.onStageResize()}});b8e.module.registerView(game.ME.FosterChase,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1375),this.setSize(600,230)},init:function(){var e=this.skin,t=this.leftImg=b8e.Sprite.get();t.setAnchor(.5,.5),t.addToParent(e.modelNode1);var a=this.rightImg=b8e.Sprite.get();a.setAnchor(.5,.5),a.addToParent(e.modelNode2)},setData:function(){var e=this,t=e.data,a=e.skin,i=t.fosterType;e.setSpriteStat(),e.maxStar=game.fosterData.getMaxStar(i),e.updateStar(t.star);var n=t.getCfg();if(n){a.fettersName.string=n.name;var s=n.units,r=n.unitsPos;if(!s||s.length<2||!r||r.length<2)b8e.warn("\u7f81\u7eca\u7684\u5355\u4f4d\u5c11\u4e8e2\u4e2a");else{var o=void 0,g=game.fosterData.getFosterClientCfgByType(i);if(g){var u=e.leftFosterCfg=game.fosterData.getFosterBaseCfg(i,s[0]),l=e.rightFosterCfg=game.fosterData.getFosterBaseCfg(i,s[1]),c=void 0;u?(c=game.fosterData.getFosterInfo(i,s[0]),o=game.ResCfg.getUrl(g.fetterUrl,u.img),e.leftImg.loadTexture(o),a.modelNode1.setPosition(r[0].X,r[0].Y),game.ShaderUtil.setGray(e.leftImg,!c||!c.active)):e.leftImg.unloadTexture();var h=void 0;l?(h=game.fosterData.getFosterInfo(i,s[1]),o=game.ResCfg.getUrl(g.fetterUrl,l.img),e.rightImg.loadTexture(o),a.modelNode2.setPosition(r[1].X,r[1].Y),game.ShaderUtil.setGray(e.rightImg,!h||!h.active)):e.rightImg.unloadTexture();var m=c&&h&&c.active&&h.active,d=t.active?51628:51629;a.upgradeLab.string=game.Lang.get(d),game.ShaderUtil.setGray(e.skin.grayNode,!m),a.red_spot.active=t.isAlert}else b8e.warn("\u6ca1\u6709\u8be5\u7c7b\u578b\u7684\u517b\u6210\u7ebf\u914d\u7f6e")}}},setSpriteStat:function(){var a=this;if(a.data){var i=void 0,e=a.data.getClientCurSpriteStat().getSpriteStats(),n=0;e.forEach(function(e,t){e=+e,(i=game.AttrRulesCfg.getData(e))&&(t+="%",a.getComponent("attrLab_"+n).string=game.Lang.get(509,i.name,t)),n++},a)}},upgradeBtn:function(){var e=this.data.fosterType;if(this.data.active)this.send(game.FosterEvts.V2C_UPGRADE_FETTERS,e,this.data);else{var t=this.leftFosterCfg,a=this.rightFosterCfg;if(!t||!a)return;var i=game.fosterData;if(!(i.getFosterActive(e,t.id)&&i.getFosterActive(e,a.id)))return void game.notice.show(51621,t.name,a.name);this.send(game.FosterEvts.V2C_ACTIVE_FETTERS,e,this.data.id)}},updateStar:function(e){for(var t=0;t<this.maxStar;t++)this.getComponent("starIcon_"+t).active=t<e,this.getComponent("stargray_"+t).active=e<=t}}),b8e.RC("$$game","$$FosterFettersItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1374)},init:function(){var e=this.list=new game.List;e.itemRender=game.FosterFettersItem,e.bindEnum=game.ME.Foster,e.layout.spacingY=5,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_FETTERS:this.updateFetters(),this.updateAttr()}},onShow:function(){this.fosterType=game.fosterData.curFosterType,game.fosterData.checkFosterFetterAlert(this.fosterType,!0),this.updateFetters(),this.updateAttr()},updateFetters:function(){var e=game.fosterData.getFettersList(this.fosterType);this.list.setData(e)},updateAttr:function(){var e=game.fosterData.getActiveFetterSpriteStat(this.fosterType);if(e&&0<e.getCount()){var t=e.getSpriteStats();this.setAttrLab(t)}else{if(!(e=game.fosterData.getFetterDefaultSpriteStat()))return void this.setAttrLab(null);var a=e.getSpriteStats();this.setAttrLab(a)}},setAttrLab:function(e){if(!e)return skin.attr_lab0.string="",skin.attr_lab1.string="",void(skin.attr_lab2.string="");var a=void 0,i=this,n=0;e.forEach(function(e,t){e=+e,(a=game.AttrRulesCfg.getData(e))&&(t+="%",i.getComponent("attr_lab"+n).string=game.Lang.get(509,a.name,t)),n++},i)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.FosterFetters,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1373)},init:function(){var e=this.skin,t=this.leftModel=new game.SurfaceModel;t.addToParent(e.model_1),t.initModel(game.RoleType.Foster),t.roleData.heroModel.type=game.RoleType.Foster,(t=this.rightModel=new game.SurfaceModel).addToParent(e.model_2),t.initModel(game.RoleType.Foster),t.roleData.heroModel.type=game.RoleType.Foster},updateModel:function(e,t,a){if(e&&a){e.y=a.uiOffsetY?a.uiOffsetY:0;var i=a.uiScale?a.uiScale:1,n=e.role;n&&(this.fosterType==game.NewFosterType.MOUNT?(a.UIModelHead&&(n.getAnimator(game.AnimType.MOUNT_HEAD,1)||n.addAnimator(game.AnimType.MOUNT_HEAD,1)).setScale(i,i),(n.getAnimator(game.AnimType.MOUNT,1)||n.addAnimator(game.AnimType.MOUNT,1)).setScale(i,i),game.AvatarUtil.updateMountModel(n,n.data,a)):((n.getAnimator(game.AnimType.BODY,1)||n.addAnimator(game.AnimType.BODY,1)).setScale(i,i),game.AvatarUtil.updateModel(a,e,t)))}},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_FETTERS:this.updateNeedStar(),this.updateAttrInfo()}},onShow:function(){this.fosterType=game.fosterData.curFosterType,this.updateUintsInfo(),this.updateNeedStar(),this.updateAttrInfo()},onHide:function(){game.AvatarUtil.clearFosterMode(this.leftModel.role),game.AvatarUtil.clearFosterMode(this.rightModel.role)},updateUintsInfo:function(){var e=this,t=e.skin,a=game.fosterData.getCurSelectFettersInfo(e.fosterType);if(a){var i=game.fosterData.getFosterClientCfgByType(e.fosterType);if(i){var n=a.getCfg();if(n&&n.units){var s=n.units;if(!(s.length<2)){var r=e.leftFosterCfg=game.fosterData.getFosterBaseCfg(e.fosterType,s[0]),o=e.rightFosterCfg=game.fosterData.getFosterBaseCfg(e.fosterType,s[1]);r&&(t.leftName.string=game.HtmlUtil.getColorStrByQuality(r.quality,r.name),e.updateModel(e.leftModel,i.roleType,r)),o&&(t.rightName.string=game.HtmlUtil.getColorStrByQuality(o.quality,o.name),e.updateModel(e.rightModel,i.roleType,o))}}}}},updateAttrInfo:function(){var e=this.skin,t=game.fosterData.getCurSelectFettersInfo(this.fosterType);if(t){var a=void 0,i=t.getCfg();if(i){var n=i.isMax;if(a=this.getStr(i,!1),this.skin.leftAttrLab.string=a,n)e.rightAttrLab.string="",e.rightBottomName.string=i.name;else{var s=t.getNextCfg();s&&(a=this.getStr(s,!0),this.skin.rightAttrLab.string=a),e.rightBottomName.string=game.Lang.get(51607,i.name,s.star)}e.leftBottomName.string=game.Lang.get(51607,i.name,t.star),e.maxNode.active=n,e.rightAttrLab.active=!n,e.fetterUpgraeBtn.active=!n}}},getStr:function(a,i){var n="";if(!a)return n;var e=game.fosterData.getClientSpriteStat(a);if(!e)return n;var s=void 0;return e.getSpriteStats().forEach(function(e,t){e=+e,(a=game.AttrRulesCfg.getData(e))&&(t+="%",s=i?51589:51633,n+=game.Lang.get(s,a.name,t)+"<br/>")},this),n},updateNeedStar:function(){var e=this.skin,t=game.fosterData.getCurSelectFettersInfo(this.fosterType);if(t){var a=t.getNextCfg();if(!a||!a.units)return e.leftNeedStar.string="",e.rightNeedStar.string="",void(e.topDesc.string="");var i=a.units;if(!(i.length<2)){var n=void 0,s=void 0,r=a.star,o=game.fosterData.getFosterClientCfgByType(this.fosterType);o&&(e.topDesc.string=game.Lang.get(51608,o.name,r)),(s=game.fosterData.getFosterInfo(this.fosterType,i[0]))&&(n=s.star>=r?51609:51610,e.leftNeedStar.string=game.Lang.get(n,s.star,r)),(s=game.fosterData.getFosterInfo(this.fosterType,i[1]))&&(n=s.star>=r?51609:51610,e.rightNeedStar.string=game.Lang.get(n,s.star,r))}}}});b8e.module.registerView(game.ME.FosterFettersUpgrade,e)}(),function(){var e;e=game.CultivateBaseIcon.extends({battleIcon:null,nameLbl:null,lvLbl:null,info:null,ctor:function(){this._super(game.IconSizeEnum.GRID_SIZE_105)},setData:function(e){e&&this._super(e)}}),b8e.RC("$$game","$$FosterHeadIcon",e)}(),function(){var e;e=game.CultivateBaseListItem.extends({icon:null,ctor:function(){this._super(159),this.setSize(114,155)},setData:function(){if(this.data){var e=this.data;this.icon.setData(e),this.setSelect(),this.skin.redPoint.node.active=e.isAlert,this.setStar(e,e.active)}},setStar:function(e,t){t?(this.addStar(),this.starLab.setText(e.star)):this.removeStar()},addStar:function(){var e=this;e.starBg||(e.starBg=b8e.Sprite.get(),e.starBg.setAnchor(.5,.5),e.starBg.setScale(.7,.7),e.starBg.setPosition(45,-30),e.starBg.loadTexture(game.ResCfg.getUrl(10078))),e.starLab||(e.starLab=b8e.Label.get(),e.starLab.setAnchor(.5,.5),e.starLab.setPosition(45,-32),e.starLab.setColor(game.Color.BLACK),e.starLab.setFontSize(18)),e.starBg.parent||e.starBg.addToParent(e.skin.starNode),e.starLab.parent||e.starLab.addToParent(e.skin.starNode)},removeStar:function(){this.starBg&&this.starBg.removeFromParent(),this.starLab&&this.starLab.removeFromParent()},touchIcon:function(){this.data&&this.send(game.FosterEvts.C2V_SELECT_ID,this.data.id)}}),b8e.RC("$$game","$$FosterHeadItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1372),this.spotAlerts={SURFACE:this.surfaceAlert}},init:function(){this.btnNode1=[{x:594,y:-328},{x:65,y:-328},{x:594,y:-428},{x:65,y:-428},{x:594,y:-528}],this.btnNode2=[{x:489,y:-409},{x:171,y:-409},{x:489,y:-509},{x:171,y:-509},{x:489,y:-609}],this.btnNode3=[{x:594,y:-328},{x:65,y:-328},{x:594,y:-428},{x:65,y:-428},{x:594,y:-528}],this.btnNode4=[{x:489,y:-409},{x:171,y:-409},{x:489,y:-509},{x:171,y:-509},{x:594,y:-609}]},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_BATTLE:t.updateBattle();break;case t.Evts.C2V_UPDATE_ID:case t.Evts.C2V_UPDATE_ACTIVE:t.showSkill(),t.updatePage(),t.updateBattle(),t.updateAwakeAlert(),t.updateJuLingAlert(),t.updateKeYinAlert(),t.updateYuHuaAlert(),t.updateChaseSkill(),t.updateEquip();break;case t.Evts.C2V_UPDATE_STAR:t.updateChaseSkill(),t.updateEquip();break;case t.Evts.C2V_UPDATE_ITEM:t.updateAwakeAlert(),t.updateJuLingAlert(),t.updateKeYinAlert(),t.updateYuHuaAlert()}},onShow:function(){var e=this,t=e.skin;e.fosterType=game.fosterData.curFosterType,game.fosterData.setCurShowIndex(0),e.send(e.Evts.V2C_SWITCH_PAGE_COMPLETE);var a=e.fosterClientCfg=game.fosterData.getFosterClientCfgByType(e.fosterType);a&&(t.skinBtn.active=a.showSkin,t.skillIcon.active=a.showSkill,e.showChase=a.showChase,e.skin.chaseBtn.active=e.showChase,e.skin.btnJuling.active=game.moduleOpen.checkOpen(game.ME.JuLing)&&e.fosterType==game.NewFosterType.HALO,e.skin.btnKeyin.active=game.moduleOpen.checkOpen(game.ME.KeYin)&&e.fosterType==game.NewFosterType.HALO,e.skin.btnYuHua.active=game.moduleOpen.checkOpen(game.ME.YuHua)&&e.fosterType==game.NewFosterType.WING,e.showSkill(),e.updatePage(),e.updateAttrItemAlertCb(),e.updateAwakeAlert(),e.updateJuLingAlert(),e.updateKeYinAlert(),e.updateChaseSkill(),e.updataTurnplate(),e.updateEquip())},updateEquip:function(){var e=this,t=e.fosterType==game.NewFosterType.SHENHUN?e.btnNode3:e.btnNode1;if(e.fosterClientCfg){if(e.fosterClientCfg.showEquip){var a=game.NewFosterType.SHENHUN,i=e.fosterType==a?game.ME.ShenhunEquip:game.ME.MountEquip;if(game.moduleOpen.checkOpen(i)){var n=game.fosterData.getCurFosterInfo();if(n){var s=game.fosterEquipData.getOpenCfg(e.fosterType,n.id);s&&s.star<=n.star&&s.lv<=n.lv&&(t=e.fosterType==game.NewFosterType.SHENHUN?e.btnNode4:e.btnNode2)}}}var r=e.skin;e.setNodePosition(r.attrItemBtn,t[0]),e.setNodePosition(r.awaken,t[1]),e.setNodePosition(r.skinBtn,t[2]),e.setNodePosition(r.turnplate,t[3]),e.setNodePosition(r.chaseBtn,t[4])}},setNodePosition:function(e,t){t=t||{x:0,y:0},e.setPosition(t)},updateChaseSkill:function(){if(this.showChase){var e=this.fosterType,t=game.fosterData,a=t.getFosterAllStar(e),i=t.getChaseSkillLv(e),n=t.getChaseSkillActive(e,a),s=t.getChaseMaxSkillLv(e),r=n?i:0;this.skin.skillLv.string=game.Lang.get(51869,r,s)}},showSkill:function(){var e=this,t=e.fosterClientCfg=game.fosterData.getFosterClientCfgByType(e.fosterType);if(t&&t.showSkill){var a=e.getCurId();e.skillIcon||(e.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.setClickCallBack(e.clickSkillIcon,e)),e.skillIcon.parent||e.skillIcon.addToParent(e.skin.skillIcon);var i=game.fosterData.getSkillId(e.fosterType,a);e.skillIcon.setData(i)}else e.skillIcon&&(e.skillIcon.removeFromParent(),e.skillIcon.clearData())},clickSkillIcon:function(){var e=game.ME.FosterSkill;b8e.module.isShowView(e)&&game.module.hide(e),game.module.show(e)},updatePage:function(){var e=this.skin,t=this.getCurId(),a=game.fosterData.getFosterInfo(this.fosterType,t);a&&(e.activePage.active=!a.active,e.attrPage.active=a.active,a.active?this.updateAttrPage():this.updateActivePage(),this.updateBattle())},updateActivePage:function(){var e=this.skin,t=this.getCurId();this.activeIcon||(this.activeIcon=game.GridUtil.createCostItemIcon(),this.activeIcon.addToParent(e.activeIcon));var a=game.fosterData.getFosterBaseCfg(this.fosterType,t);if(a){var i=a.itemId;this.activeIcon.setItemInfo(i);var n=game.ItemInfoCfg.getData(i);if(n){e.activeIconName.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name,!0);var s=game.itemData.getCountById(i),r=a.itemNum<=s,o=void 0;o=r?504:503,e.red_spot.active=r,e.activeIconNum.string=game.Lang.get(o,s,a.itemNum)}}},updateAttrPage:function(){var a=this,e=a.skin,t=a.getCurId(),i=game.fosterData.getAllSpriteStat(a.fosterType,t);if(!i)return e.attr_lab0.string="",e.attr_lab1.string="",void(e.attr_lab2.string="");var n=void 0,s=0;i.getSpriteStats().forEach(function(e,t){e=+e,(n=game.AttrRulesCfg.getData(e))&&(a.getComponent("attr_lab"+s).string=game.Lang.get(509,n.name,game.CCommonUtil.replaceNum(t))),s++},a)},updateBattle:function(){var e=this,t=e.skin,a=e.getCurId(),i=game.fosterData.getIsInBattle(e.fosterType,a),n=game.fosterData.getIsActiveByType(e.fosterType),s=e.fosterClientCfg&&e.fosterClientCfg.canDownBattle;if(t.battleBtn.active=n&&!i,t.inBattleBtn.active=!s&&n&&i,t.downBattleBtn.active=s&&n&&i,n){t.curFoster.active=!0;var r=game.fosterData.getBattleInfo(e.fosterType);t.curFoster.string=r?game.Lang.get(51605,e.fosterClientCfg.name,r.name):game.Lang.get(51606,e.fosterClientCfg.name),t.battle_spot.active=!game.fosterData.getBattleInfo(e.fosterType)}else t.curFoster.active=!1},updateAttrItemAlertCb:function(){var e=this;e._spotAlertEnum&&(game.spotAlert.delCb(e._spotAlertEnum,e.updateAttrItemAlert,e),e.skin.red_spot_2.active=!1);var t=game.fosterData.getFosterSaeByType(e.fosterType,"attrItemSae");if(t){var a=game.spotAlert.get(t);a?e.updateAttrItemAlert(a):e.updateAttrItemAlert(!1),e._spotAlertEnum=t,game.spotAlert.setCb(e._spotAlertEnum,e.updateAttrItemAlert,e)}},updataTurnplate:function(){var e=this.skin;e.turnplate.active=!1;var t=game.fosterData.getMiscValue(this.fosterType,"turnplateId");if(t){var a=game.fosterData.getMiscValue(this.fosterType,"activeId");if(a){var i=game.activeBarData.getData(a);if(i){var n=game.xunBaoData.getOpenIdByType(t,!1);e.turnplate.active=!!n,e.turnplate.loadTexture(game.ResCfg.getUrl(70,i.titleBg))}}}},updateAwakeAlert:function(){var e=this.getCurId(),t=game.fosterData.getFosterInfo(this.fosterType,e);t&&(this.skin.red_spot_3.active=t.awakeAlert)},updateJuLingAlert:function(){var e=this.getCurId(),t=game.fosterData.getFosterInfo(this.fosterType,e);t&&(this.skin.red_spot_6.active=t.spiritAlert)},updateKeYinAlert:function(){var e=this.getCurId(),t=game.fosterData.getFosterInfo(this.fosterType,e);t&&(this.skin.red_spot_7.active=t.sealAlert)},updateYuHuaAlert:function(){var e=this.getCurId(),t=game.fosterData.getFosterInfo(this.fosterType,e);t&&(this.skin.red_spot_8.active=t.featherAlert)},updateAttrItemAlert:function(e){this.skin.red_spot_2.active=e&&e.alert},getCurId:function(){return game.fosterData.getCurId(this.fosterType)},surfaceAlert:function(e){this.skin.red_spot_4.active=e.alert},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.FosterInfo,e)}(),function(){var e=game.CultivateBaseView.extends({ctor:function(){this._super(1369)},init:function(){this.progressWidth=this.skin.progressBar.width,this.expItemIconList=[],this.expItemInfoList=[]},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_LV:t.updateAttr(),t.updateExp();break;case t.Evts.C2V_UPDATE_EXP:t.updateExp();break;case t.Evts.C2V_UPDATE_ITEM:t.updateExpItem(),t.updateUpgraeAlert();break;case t.Evts.C2V_UPDATE_ID:t.updateExp(),t.updateAttr(),t.updateUpgraeAlert();break;case t.Evts.C2V_PLAY_PRO_EFFECT:t.showProgEffect(t.skin.barBg0)}},onShow:function(){this.fosterType=game.fosterData.curFosterType,game.fosterData.setCurShowIndex(1),this.send(this.Evts.V2C_SWITCH_PAGE_COMPLETE),this.updateExp(),this.updateAttr(),this.updateIcon(),this.updateExpItem(),this.updateUpgraeAlert()},updateUpgraeAlert:function(){var e=this.skin,t=game.fosterData.getCurFosterInfo();e.upgradeAlert.active=!!t&&t.upgradeAlert},updateExp:function(){var e=this.skin,t=this.getCurId(),a=game.fosterData.getCurExp(this.fosterType,t),i=game.fosterData.getFosterInfo(this.fosterType,t);if(i){var n=i.getUpgradeCfg();if(n){e.lvLab.string=game.Lang.get(51590,i.lv),e.exp.string=game.Lang.get(51591,a,n.exp);var s=a/n.exp;e.progressBar.width=this.progressWidth*s}}},updateAttr:function(){var a=this,e=a.skin,t=a.getCurId(),i=game.fosterData.getFosterInfo(a.fosterType,t);if(i){var n=void 0,s=0,r=i.getUpgradeSpriteStat();r?r.getSpriteStats().forEach(function(e,t){e=+e,t=game.CCommonUtil.replaceNum(0|t,0),(n=game.AttrRulesCfg.getData(e))&&(a.getComponent("leftAttrLab_"+s).string=game.Lang.get(507,n.name,t)),s++},a):(e.leftAttrLab_0.string="",e.leftAttrLab_1.string="",e.leftAttrLab_2.string="");var o=i.geNextLvSpriteStat();o?(s=0,o.getSpriteStats().forEach(function(e,t){e=+e,t=game.CCommonUtil.replaceNum(0|t,0),(n=game.AttrRulesCfg.getData(e))&&(a.getComponent("rightAttrLab_"+s).string=game.Lang.get(507,n.name,t)),s++},a)):(e.rightAttrLab_0.string="",e.rightAttrLab_1.string="",e.rightAttrLab_2.string="")}},updateIcon:function(){var e=this,t=e.getCurId(),a=game.fosterData.getFosterBookCfgs(e.fosterType,t);if(a&&!(a.length.length<1))for(var i=void 0,n=void 0,s=void 0,r=void 0,o=a.length,g=0;g<o;g++)i=a[g],e.expItemIconList[g]||(e.expItemIconList[g]=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),e.expItemIconList[g].addToParent(e.getComponent("expIcon_"+g))),n=game.itemData.getCountById(i.id),e.expItemInfoList[g]||(e.expItemInfoList[g]=game.ItemUtil.createBaseItemInfo(i.id,n)),r=e.expItemInfoList[g],s=e.expItemIconList[g],r.id=i.id,r.itemNum=1,s.setItemInfo(r,!1,game.IconLayoutEnum.SHOW_NONE),s.setNum(n,0<n?game.Color.GREEN:game.Color.RED,20,!0,0,!0)},updateExpItem:function(){var e=this.getCurId(),t=game.fosterData.getFosterBookCfgs(this.fosterType,e);if(t&&!(t.length.length<1))for(var a=void 0,i=void 0,n=void 0,s=void 0,r=t.length,o=0;o<r;o++)a=t[o],(n=this.expItemIconList[o])&&(i=game.itemData.getCountById(a.id),n.setNum(i,0<i?game.Color.GREEN:game.Color.RED,20,!0,0,!0),s=game.ItemInfoCfg.getData(a.id),this.getComponent("expLab_"+o).string=s?game.HtmlUtil.getColorStrByQuality(s.quality,game.Lang.get(51604,a.exp)):"")},getCurId:function(){return game.fosterData.getCurId(this.fosterType)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.FosterUpgrade,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1368)},init:function(){this.expItemIconList=[],this.expItemInfoList=[]},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_STAR:t.updateStar(),t.updateAttr(),t.updateChaseSkill();break;case t.Evts.C2V_UPDATE_ITEM:t.updateStar(),t.updateUpStarAlert();break;case t.Evts.C2V_UPDATE_ID:t.updateStar(),t.updateAttr(),t.updateUpStarAlert(),t.showSkill(),t.updateChaseSkill()}},onShow:function(){var e=this;e.fosterType=game.fosterData.curFosterType,game.fosterData.setCurShowIndex(2);var t=game.fosterData.getFosterClientCfgByType(e.fosterType);e.showChase=t&&t.showChase,e.skin.chaseBtn.active=e.showChase,e.send(e.Evts.V2C_SWITCH_PAGE_COMPLETE),e.updateStar(),e.updateAttr(),e.updateUpStarAlert(),e.showSkill(),e.updateChaseSkill()},updateChaseSkill:function(){if(this.showChase){var e=this.fosterType,t=game.fosterData,a=t.getFosterAllStar(e),i=t.getChaseSkillLv(e),n=t.getChaseSkillActive(e,a),s=t.getChaseMaxSkillLv(e),r=n?i:0;this.skin.skillLv.string=game.Lang.get(51869,r,s)}},updateUpStarAlert:function(){var e=this.skin,t=game.fosterData.getCurFosterInfo();e.upStarAlert.active=!!t&&t.upStarAlert},updateStar:function(){var e=this.skin,t=this.getCurId(),a=game.fosterData.getCurStarCfg(this.fosterType,t);if(a){if(a.isMax)return e.maxImg.active=!0,e.rightAttrNode.active=!1,void(e.upStarPage.active=!1);e.maxImg.active=!1,e.rightAttrNode.active=!0,e.upStarPage.active=!0,this.costIcon||(this.costIcon=game.GridUtil.createCostItemIcon(),this.costIcon.addToParent(e.itemIcon));var i=a.itemId;this.costIcon.setItemInfo(i);var n=game.itemData.getCountById(i),s=a.itemNum>n?503:504;e.itemNum.string=game.Lang.get(s,n,a.itemNum);var r=game.ItemInfoCfg.getData(i);r&&(e.itemName.string=game.HtmlUtil.getColorStrByQuality(r.quality,r.name))}},updateAttr:function(){var a=this,e=a.skin,t=a.getCurId(),i=game.fosterData.getFosterInfo(a.fosterType,t);if(i){var n=i.getUpStarCfg();if(n){var s=n.skill,r=void 0,o=void 0,g=0,u=void 0,l=i.getCurStarSpriteStat(),c=s?44:34,h=s?30:36;if(l?(l.getSpriteStats().forEach(function(e,t){e=+e,(r=game.AttrRulesCfg.getData(e))&&((o=a.getComponent("leftAttrLab_"+g)).y=c-h*g,o.string=game.Lang.get(507,r.name,game.CCommonUtil.replaceNum(t,0))),g++},a),s?(u=game.SkillCfg.getData(s))&&((o=a.getComponent("leftAttrLab_"+g)).y=c-h*g,o.string=game.Lang.get(51588,u.name,n.star)):a.getComponent("leftAttrLab_"+g).string=""):(e.leftAttrLab_0.string="",e.leftAttrLab_1.string="",e.leftAttrLab_2.string="",e.leftAttrLab_3.string=""),i.getUpStarIsMax())a.clearRightLab();else if(n=i.getNextUpStarCfg()){s=n.skill;var m=i.geNextStarSpriteStat();m?(g=0,m.getSpriteStats().forEach(function(e,t){e=+e,(r=game.AttrRulesCfg.getData(e))&&((o=a.getComponent("rightAttrLab_"+g)).y=c-h*g,o.string=game.Lang.get(507,r.name,game.CCommonUtil.replaceNum(t,0))),g++},a),s?(u=game.SkillCfg.getData(s))&&((o=a.getComponent("rightAttrLab_"+g)).y=c-h*g,o.string=game.Lang.get(51588,u.name,n.star)):a.getComponent("rightAttrLab_"+g).string=""):a.clearRightLab()}}}},showSkill:function(){var e=this,t=e.fosterClientCfg=game.fosterData.getFosterClientCfgByType(e.fosterType);if(t&&t.showSkill){var a=e.getCurId();e.skillIcon||(e.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.setClickCallBack(e.clickSkillIcon,e)),e.skillIcon.parent||e.skillIcon.addToParent(e.skin.skillIcon);var i=game.fosterData.getSkillId(e.fosterType,a);e.skillIcon.setData(i)}else e.skillIcon&&(e.skillIcon.removeFromParent(),e.skillIcon.clearData())},clickSkillIcon:function(){var e=game.ME.FosterSkill;b8e.module.isShowView(e)&&game.module.hide(e),game.module.show(e)},clearRightLab:function(){var e=this.skin;e.rightAttrLab_0.string="",e.rightAttrLab_1.string="",e.rightAttrLab_2.string="",e.rightAttrLab_3.string=""},getCurId:function(){return game.fosterData.getCurId(this.fosterType)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.FosterUpStar,e)}(),function(){var e,t=e=game.CultivateBaseModelView.extends({ctor:function(){this._super(1366),this.toggles={toggle_btn_1:game.ME.FosterInfo,toggle_btn_2:game.ME.FosterUpgrade,toggle_btn_3:game.ME.FosterUpStar,toggle_btn_4:game.ME.FosterFetters}},init:function(){var e=game.FosterClientCfg.getDatas(),t=[];if(e&&0<e.length)for(var a=void 0,i=e.length,n=0;n<i;n++)(a=e[n]).roleType&&t.push({type:a.roleType,node:this.skin.model});this.initModel.apply(this,t),this.list=new game.HeadScroll(game.FosterHeadItem,this.moduleEnum,146,594),this.list.addToParent(this.skin.headBg)},updateModel:function(e,t){var a=this._modelMap.get(e);if(a){if(this._hideModel(e),t){a.y=t.uiOffsetY?t.uiOffsetY:0;var i=t.uiScale?t.uiScale:1,n=a.role;n&&(this.fosterType==game.NewFosterType.MOUNT?(t.UIModelHead&&(n.getAnimator(game.AnimType.MOUNT_HEAD,1)||n.addAnimator(game.AnimType.MOUNT_HEAD,1)).setScale(i,i),(n.getAnimator(game.AnimType.MOUNT,1)||n.addAnimator(game.AnimType.MOUNT,1)).setScale(i,i),game.AvatarUtil.updateMountModel(n,n.data,t)):((n.getAnimator(game.AnimType.BODY,1)||n.addAnimator(game.AnimType.BODY,1)).setScale(i,i),game.AvatarUtil.updateModel(t,a,e)))}}else b8e.error("\u4e0d\u5b58\u5728\u7c7b\u578b",e,"\u7684\u6a21\u578b")},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_UPDATE_STAR:a.updateStar(),a.updatePower(),a.updateEquipOpen(),a.updateAoyiExpandBtn(),a.updateAoyiExpandAlert(),a.isUpStar=!0;break;case a.Evts.C2V_UPDATE_LV:case a.Evts.C2V_UPDATE_ATTR:a.updatePower(),a.updateEquipOpen(),a.updateAoyiExpandBtn(),a.updateAoyiExpandAlert(),a.isUpgrade=!0;break;case a.Evts.C2V_UPDATE_ID:a.updateBaseInfo(),a.updateStar(),a.updatePower(),a.updatePageAlert(),a.updateHeadList(),a.updateEquipOpen(),a.updateAoyiExpandBtn(),a.updateAoyiExpandAlert();break;case a.Evts.C2V_UPDATE_ACTIVE:a.updatePower(),a.updateEquipOpen(),a.updateAoyiExpandBtn(),a.updateAoyiExpandAlert(),a.isActive=!0;break;case a.Evts.C2V_UPDATE_LIST:a.updateHeadList();break;case a.Evts.C2V_UPDATE_BATTLE:a.updateHeadList(),a.updateInfoAlert(),a.updatePower();break;case a.Evts.C2V_SWITCH_PAGE:var i=game.fosterData.getCurFosterInfo();if(!i||!a.fosterClientCfg)return;if(!i.active&&3!=t&&0!=t)return void game.notice.show(51623,a.fosterClientCfg.name);a.toggleSelect(t),a.updateAoyiExpandBtn();break;case a.Evts.V2C_UPDATE_POWER:a.updatePower();break;case a.Evts.C2V_UPDATE_ALERT:a.updatePageAlert(),a.updateAoyiExpandAlert();break;case a.Evts.C2V_UPDATE_ITEM:(a.isUpStar||a.isUpgrade||a.isActive)&&(a.isUpStar=a.isUpgrade=a.isActive=!1,a.updateHeadList()),a.updatePageAlert(),a.updateAoyiExpandAlert();break;case a.Evts.C2V_PLAY_UP_EFFECT:a.showModelEffect(a.skin.model)}},toggleSelect:function(e){this.toggleIndex=e,this.skin.baseNode.active=3!=e,this.skin.equipNode.active=this.showEquip&&0==e,this._super(e)},onShow:function(){var e=this,t=e.skin,a=e.fosterType=game.fosterData.curFosterType;game.fosterData.checkFosterInfo(a),e.maxStar=game.fosterData.getMaxStar(a),e.fosterClientCfg=game.fosterData.getFosterClientCfgByType(a),e.fosterClientCfg?(t.title.loadTexture(game.ResCfg.getImgUrl(e.fosterClientCfg.titleImg)),game.fosterData.initSelectId(a),e.send(e.Evts.V2C_SHOW_VIEW),t.baseNode.active=!0,e.updateFetterAlertCb(),e.updateBaseInfo(),e.updateStar(),e.updatePower(),e.updateHeadList(),e.list&&e.list.scrollLeft(),e.updatePageAlert(),e.updateEquipOpen(),e.updateAoyiExpandBtn(),e.updateAoyiExpandAlert(),e.registerEvents()):b8e.error("\u4e0d\u5b58\u5728\u7c7b\u578b",a,"\u7684\u517b\u6210\u7ebf\u914d\u7f6e")},onHide:function(){game.fosterMgr.hideView(),this.unRegisterEvents()},registerEvents:function(){if(this.fosterClientCfg&&this.fosterClientCfg.showEquip){var e=game.FosterEquipMgr.inst();e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON,this.updateEquipOpen,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,this.playUpAnim,this)}},unRegisterEvents:function(){if(this.fosterClientCfg&&this.fosterClientCfg.showEquip){var e=game.FosterEquipMgr.inst();e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON,this.updateEquipOpen,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,this.playUpAnim,this)}},updateEquipOpen:function(){var e=this,t=e.skin,a=e.fosterType,i=game.NewFosterType.SHENHUN;if(e.showEquip=t.equipNode.active=!1,t.red_spot_5.active=!1,t.slotNode.active=!1,t.quickWearBtn.active=!1,e.fosterClientCfg&&e.fosterClientCfg.showEquip){var n=game.fosterData.getCurFosterInfo();if(n){var s=a==i?game.ME.ShenhunEquip:game.ME.MountEquip;if(game.moduleOpen.checkOpen(s)){var r=game.fosterEquipData.getOpenCfg(a,n.id);r&&(e.showEquip=!0,e.skin.equipNode.active=e.showEquip&&0==e.toggleIndex,t.equipBtn.x=594,t.equipBtn.y=a==i?-428:-693,t.equipBtn.loadTexture(game.ResCfg.getUrl(10208,e.fosterClientCfg.equipImg)),r.star>n.star||r.lv>n.lv||(t.equipBtn.x=a==i?489:594,t.equipBtn.y=a==i?-509:-693,e.updateFosterEquip(),t.slotNode.active=!0,t.quickWearBtn.active=game.fosterEquipData.checkAlert(n,1)))}}}},updateStar:function(){for(var e=this.getCurId(),t=game.fosterData.getStar(this.fosterType,e),a=0;a<this.maxStar;a++)this.getComponent("starIcon_"+a).active=a<t,this.getComponent("stargray_"+a).active=t<=a},updatePower:function(){var e=this.skin,t=this.getCurId(),a=game.fosterData.getIsInBattle(this.fosterType,t);if(e.common_power.active=a){var i=game.fosterData.getFosterAllScoreByType(this.fosterType,t);e.fightAmountLbl.string=i,game.AutoLayoutUtil.layoutPower(e.power,e.fightAmountLbl,e.powerImg)}},updateBaseInfo:function(){var e=this.getCurId(),t=game.fosterData.getFosterBaseCfg(this.fosterType,e);t&&(this.skin.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name),this.fosterClientCfg&&this.updateModel(this.fosterClientCfg.roleType,t))},updateHeadList:function(){var e=game.fosterData.getHeadList(this.fosterType);this.list.setData(e)},updateFetterAlertCb:function(){var e=this;e._spotAlertEnum&&(game.spotAlert.delCb(e._spotAlertEnum,e.updateFetterAlert,e),e.skin.red_spot_4.active=!1);var t=game.fosterData.getFosterSaeByType(e.fosterType,"fetterSae");if(t){var a=game.spotAlert.get(t);a?e.updateFetterAlert(a):e.updateFetterAlert(!1),e._spotAlertEnum=t,game.spotAlert.setCb(e._spotAlertEnum,e.updateFetterAlert,e)}},updateFetterAlert:function(e){this.skin.red_spot_4.active=e&&e.alert},updatePageAlert:function(){this.updateUpgradeAlert(),this.updateUpStarAlert(),this.updateInfoAlert()},updateUpgradeAlert:function(){var e=game.fosterData.getCurFosterInfo();this.skin.red_spot_2.active=!!e&&e.upgradeAlert},updateUpStarAlert:function(){var e=game.fosterData.getCurFosterInfo();this.skin.red_spot_3.active=!!e&&e.upStarAlert},updateInfoAlert:function(){var e=game.fosterData.getCurFosterInfo(),t=game.fosterData.checkFosterAttrItemAlert(this.fosterType),a=!1;if(this.fosterClientCfg&&this.fosterClientCfg.showSkin){var i=game.spotAlert.get(game.SAE.SURFACE);a=i&&i.alert}this.skin.red_spot_1.active=!!(e||t||a)&&(e.infoAlert||e.awakeAlert||t||a||e.spiritAlert||e.sealAlert||e.featherAlert)},getCurId:function(){return game.fosterData.getCurId(this.fosterType)},updateFosterEquip:function(){var e=this,t=game.fosterData.getCurFosterInfo();if(t){if(!e.equipIconArr){e.equipIconArr=[],e.upAnimArr=[];for(var a=void 0,i=0;i<game.fosterEquipData.maxSlotNum;i++){(a=game.GridUtil.createFosterEquipTipsIcon()).setClickCb(e.clickEquipIcon,e);var n=e.getComponent("equipIcon_"+i);a.addToParent(n),e.equipIconArr.push(a);var s=e.upAnimArr[i]=b8e.Animator.get(game.AnimType.UI_EFFECT,1);s.addToParent(n),s.load(game.ResCfg.getUrl(5019,1009)),s.addFinishCallback(e.animaCB,e,[i]),s.active=!1}}for(var r=t.getFosterEquipMap(),o=0;o<e.equipIconArr.length;o++){var g=o+1,u=e.equipIconArr[o],l=r.get(g);u.setSlotData(l)}e.skin.red_spot_5.active=game.fosterEquipData.checkAlert(t)}else b8e.warn("\u6ca1\u6709\u9009\u4e2d\u7684\u517b\u6210\u7ebfid")},clickEquipIcon:function(e){var t=e.info;if(t){var a=t.getFosterEquipInfo();if(!a||!a.idx){var i=game.fosterEquipData;return i.changeFosterId=t.fosterId,i.changeFosterType=t.fosterType,i.changeSlot=t.slot,void game.module.show(game.ME.FosterEquipWear)}game.FosterEquipMgr.inst().showEquip(t.fosterId,t.fosterType,a)}},animaCB:function(e,t){this.upAnimArr[t].active=!1},playUpAnim:function(e){if(e&&e.data&&this.fosterClientCfg&&this.fosterClientCfg.showEquip){var t=e.data;if(this.upAnimArr&&!(t.length<1))for(var a=this.upAnimArr.length,i=0;i<a;i++)-1<t.indexOf(i)&&(this.upAnimArr[i].play(null,0),this.upAnimArr[i].active=!0)}},updateAoyiExpandBtn:function(){var e=this.skin;if(this.fosterType!=game.NewFosterType.ZHANJI)return e.view_runeBtn.active=!1,void(e.view_enchBtn.active=!1);var t=game.fosterData.getCurFosterInfo(),a=game.aoyiExpandData.checkOpen(t);e.view_runeBtn.active=a&&0==this.toggleIndex,e.view_enchBtn.active=a&&0==this.toggleIndex},updateAoyiExpandAlert:function(){var e=this.skin,t=game.fosterData.getCurFosterInfo();e.red_spot_8.active=game.aoyiExpandData.checkRuneAlert(t),e.red_spot_9.active=game.aoyiExpandData.checkCanEnchantment(t)},view_runeBtn:function(){this.openAoyiExpandView(game.ME.AoyiRune)},view_enchBtn:function(){this.openAoyiExpandView(game.ME.AoyiEnch)},openAoyiExpandView:function(e){var t=game.fosterData.getCurFosterInfo();t&&(game.aoyiExpandData.curAoyiId=t.id,game.module.show(e))}});b8e.module.registerView(game.ME.Foster,t),b8e.RC("$$game","$$FosterView",e)}(),function(){var e;e=game.View.extends({toggleIndex:0,ctor:function(){this._super("")},onShow:function(){var e=game.fosterData.getFosterClientCfgByME(this.moduleEnum);e&&(game.fosterData.curFosterME=this.moduleEnum,game.fosterMgr.showFosterView(e.id,!0,this.toggleIndex),this.toggleIndex=0)},onHide:function(){game.fosterData.curFosterME=0},getToggleIndex:function(e){return this.toggleIndex=e,this.moduleEnum}}),b8e.module.registerView(game.ME.Mount,e),b8e.module.registerView(game.ME.Wing,e),b8e.module.registerView(game.ME.Shenhun,e),b8e.module.registerView(game.ME.Zhanji,e),b8e.module.registerView(game.ME.Halo,e),b8e.RC("$$game","$$FosterSubView",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1370)},init:function(){var e=this.gridList=new game.List;e.itemRender=game.FosterSkillItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5},onShow:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getCurId(e),a=game.fosterData.getSkillList(e,t);this.gridList.setData(a)},onHide:function(){},view_btnUp:function(){this.gridList.scrollToTop()},view_btnDown:function(){this.gridList.scrollToBottom()}});b8e.module.registerView(game.ME.FosterSkill,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1371),this.setSize(540,154)},init:function(){var e=this.skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_105);e.setShowPassiveSkillIcon(!1),e.setShowMainSkillIcon(!1),e.addToParent(this.skin.icon)},setData:function(){var e=this;if(e.data){var t=e.skin,a=e.data,i=a.star;e.fosterType=game.fosterData.curFosterType,e.maxStar=game.fosterData.getMaxStar(e.fosterType);for(var n=0;n<e.maxStar;n++)e.getComponent("starIcon"+n).active=n<i,e.getComponent("stargray"+n).active=i<=n;t.selectBg.active=a.active&&a.isSelect;var s=a.id,r=game.SkillCfg.getData(s);if(!r)return t.name.string="",t.skillDesc.string="",void e.skillIcon.setEmpty();t.name.string=r.name,e.skillIcon.setData(s);var o=a.active&&a.isSelect?game.Color.RED:game.Color.BLACK;t.skillDesc.string=game.HtmlUtil.getText(o,game.LangSkill.get(r.desc,r.descParam))}}}),b8e.RC("$$game","$$FosterSkillItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1367)},init:function(){var e=this.surfaceModel=new game.SurfaceModel;e.addToParent(this.skin.model),e.initModel(game.RoleType.Foster),e.roleData.heroModel.type=game.RoleType.Foster,this.timer=b8e.Timer.add(this,this.updateTime,500)},onShow:function(){this.fosterType=game.fosterData.curFosterType,this.updateBaseInfo(),this.updateStar(),this.updateDesc(),this.endTime=game.SysTime.curTime+3e3,this.timer&&(this.timer.reset(),this.timer.start())},onHide:function(){this.timer&&this.timer.stop(),this.surfaceModel&&this.surfaceModel.role&&game.AvatarUtil.clearFosterMode(this.surfaceModel.role)},updateTime:function(){var e=this.endTime-game.SysTime.curTime;e<=0?game.module.hide(this.moduleEnum):this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},updateBaseInfo:function(){var e=this.getCurId(),t=game.fosterData.getFosterBaseCfg(this.fosterType,e);t&&(this.skin.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name),this.updateModel(t))},updateStar:function(){var e=this.getCurId(),t=game.fosterData.getStar(this.fosterType,e);this.maxStar=game.fosterData.getMaxStar(this.fosterType);for(var a=0;a<this.maxStar;a++)this.getComponent("starIcon"+a).active=a<t,this.getComponent("stargray"+a).active=t<=a},getCurId:function(){return game.fosterData.getCurId(this.fosterType)},updateModel:function(e){var t=this.surfaceModel;if(t&&e){t.y=e.uiOffsetY?e.uiOffsetY:0;var a=e.uiScale?e.uiScale:1,i=t.role;if(i){var n=game.fosterData.getFosterClientCfgByType(this.fosterType);this.fosterType==game.NewFosterType.MOUNT?(e.UIModelHead&&(i.getAnimator(game.AnimType.MOUNT_HEAD,1)||i.addAnimator(game.AnimType.MOUNT_HEAD,1)).setScale(a,a),(i.getAnimator(game.AnimType.MOUNT,1)||i.addAnimator(game.AnimType.MOUNT,1)).setScale(a,a),game.AvatarUtil.updateMountModel(i,i.data,e)):((i.getAnimator(game.AnimType.BODY,1)||i.addAnimator(game.AnimType.BODY,1)).setScale(a,a),game.AvatarUtil.updateModel(e,t,n.roleType))}}},updateDesc:function(){var e=this.skin,t=this.getCurId(),a=game.fosterData.getFosterInfo(this.fosterType,t);if(a){var i=a.getCurStarSpriteStat(),n=a.getUpStarCfg();if(!n||!i||i.getCount()<1)return e.spriteStatDesc.string="",void this.updateLayout();var s="",r=game.fosterData.getStar(this.fosterType,t),o=i.getSpriteStats();if(!o)return e.spriteStatDesc.string="",void this.updateLayout();var g=void 0,u=0,l=i.getCount();if(o.forEach(function(e,t){e=+e,(g=game.AttrRulesCfg.getData(e))&&(u++,s+=game.Lang.get(507,g.name,game.CCommonUtil.replaceNum(t,0)),u<l&&(s+="<br/>"))},this),n.skill){var c=game.SkillCfg.getData(n.skill);c&&(s+="<br/>"+game.Lang.get(51588,c.name,r))}e.spriteStatDesc.string=s,this.updateLayout()}},updateLayout:function(){var e=this.skin,t=e.spriteStatDesc.height;e.mask.height=t+60}});b8e.module.registerView(game.ME.FosterUpStarSuccess,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C_GET_REWARD:-1}),b8e.RC("$$game","$$TitleRewardEvts",e)}(),function(){var e=b8e.Object.extends({getItemInfos:function(e){var t=e.length;if(!(e<2))for(var a=void 0,i=1;i<t;i++)a=game.ItemUtil.createBaseItemInfo(itemObj.Id,itemObj.Num),this.award.push(a)}});game.titleRewardData=game.titleRewardData||new e}(),function(){var e=game.Control.extends({getBtn:function(){this.dpt(this.Evts.C_GET_REWARD),game.module.hide(game.ME.TitleReward)}});b8e.module.registerControl(game.ME.TitleReward,e,game.TitleRewardEvts)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("titleReward/TitleRewardView")},init:function(){this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this._list.itemRender=game.PrizeListItem,this._list.layout.spacingY=10,this._list.layout.spacingX=22,this._list.layout.paddingLeft=3,this._list.addToParent(this.skin.rewList)},onShow:function(){this.updateView()},updateView:function(){var e=game.taskData.task;if(e){var t=e.giveItem;if(t&&!(t.length<1)){var a=t.length;if(1<a){this.prizeInfos=[];for(var i=void 0,n=void 0,s=0;s<a;s++)n=t[s],(i=game.ItemUtil.createBaseItemInfo(n.id,n.num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_ALL,this.prizeInfos.push(i)}this._list.setData(this.prizeInfos);var r=t[0],o=game.ItemInfoCfg.getData(r.id);if(o){var g=game.NicknameCfg.getData(o.nickname);if(g){var u=game.AvatarUtil.getUIModel(g),l=game.ResCfg.getUrl(5004,u);this.skin.titleLab.string=e.desc,this.updateTitle(l)}}}}},updateTitle:function(e){this.titleAnim||(this.titleAnim=b8e.Animator.get(game.AnimType.FOSTER,1),this.titleAnim.setAnchor(.5,.5),this.titleAnim.addToParent(this.skin.titleNode)),this.titleAnim.load(e),this.titleAnim.play()}});b8e.module.registerView(game.ME.TitleReward,e)}(),function(){var e=game.View.extends({_str:"",_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1543)},init:function(){var e=this.skin;this.matCostIcon=b8e.Sprite.get(),this.matCostIcon.setAnchor(.5,.5),this.matCostIcon.addToParent(e.matCost),this.matCostIcon.setSize(40,40);var t=this.prizeList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.PrizeListItem,t.layout.paddingLeft=10,t.layout.paddingTop=10,t.layout.spacingX=40,t.bindEnum=this.moduleEnum,t.addToParent(e.listNode)},notify:function(e){switch(e){case this.Evts.V_UPDATE_QUICK:game.mainInstanceData.getInstanceCfg(this.updateView,this)}},onShow:function(){game.mainInstanceData.getInstanceCfg(this.updateView,this)},updateView:function(e){if(e){var t=this.skin,a=game.mainInstanceData,i=game.mainInstanceData.getShowItemsByConfig(e,!1);this.prizeList.setData(i);var n=game.rechargeData.getCardInfoByType(game.CardType.MONTH),s=game.rechargeData.getCardInfoByType(game.CardType.FOREVER),r=n&&n.expireTime>game.SysTime.curTime,o=s;t.yue.active=r,t.forever.active=o;var g=a.privilegeQuickCount<a.privilegeCount,u=a.maxQuickFreeCount>a.quickCount||g,l=game.privilegeShopData.isActByType(game.PrivilegeType.QUICK_BATTLE);if(t.activeNode.active=l,t.notActiveNode.active=!l,t.freeNode.active=u,t.notFreeNode.active=!u,u){var c=l?53123:53122,h=a.maxQuickFreeCount>a.quickCount?a.quickCount:a.privilegeQuickCount+1;t.freeLab.string=game.Lang.get(c,h,a.maxQuickFreeCount)}else{var m=void 0,d=void 0,f=+game.CfgUtil.getMiscValue(game.HangUpMiscCfg,"quickBattleItemID"),p=game.itemData.getNumById(f),v=game.Color;if(p)d=game.ItemInfoCfg.getData(f),t.matCostLab.string=game.HtmlUtil.getText(v.GREEN,p+"/1");else{d=game.amount.getCfgByType(game.AmountType.YUAN_BAO);var E=this.getCostCount();t.matCostLab.string=game.HtmlUtil.getText(v.GREEN,E)}d&&(m=game.ResCfg.getUrl(137,d.icon),this.matCostIcon.loadTexture(m)),a.quickCount<a.maxQuickCount?t.lab2.string=game.Lang.get(53099):t.lab2.string=game.Lang.get(l?53101:53100),t.freeLab.string=game.Lang.get(53129,a.maxQuickCount-a.quickCount)}}},getCostCount:function(){var e=game.QuickBattleCostCfg.getDatas();if(!e||e.length<1)return 0;for(var t=game.mainInstanceData,a=t.quickCount-t.privilegeQuickCount,i=0,n=0,s=e.length;n<s;n++)a>=e[n].num&&(i=e[n].gold);return i}});b8e.module.registerView(game.ME.QuickBattle,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("guaji/QuickBattleAwardView")},init:function(){this._prizeInfo=new game.ZhaoqinPrizeInfo,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.list.itemRender=game.PrizeListItem,this.list.layout.paddingLeft=20,this.list.layout.spacingX=57,this.list.addToParent(this.skin.prizeNode)},onShow:function(){this.updateView(),game.TweenUtil.rotationEffect(this.skin.light)},updateView:function(){this.skin.huawen_3.width=b8e.stageWidth+100,this.skin.huawen_1.width=b8e.stageWidth+100;var e=game.mainInstanceData;this.updatePrizeList(e.exp,e.userItem);var t=void 0;e.isQuickBattle||(t=b8e.TimeUtil.formatTime(b8e.TimeUtil.HOUR_MICRO_SECONDS*e.quickItmeNum)),this.skin.descLab.string=e.isQuickBattle?game.Lang.get(53446):game.Lang.get(53447,t)},updatePrizeList:function(e,t){var a=this;if(a._prizeInfoList||(a._prizeInfoList=[]),a._prizeInfoList.length=0,e||t){if(a.tempList1||(a.tempList1=[]),a.tempList1.length=0,a.tempList2||(a.tempList2=[]),(a.tempList2.length=0)<e){var i=game.ItemInfo.get();i.id=220001,i.num=e,i.iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,a.tempList1.push(i)}if(t){var n=void 0,s=t.amounts,r=void 0;if(s){r=s.length;for(var o=0;o<r;o++)n=s[o],(i=game.ItemInfo.get()).id=game.AmountCfg.getItemId(n.type),i.num=n.updateNum,i.iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,a.tempList1.push(i)}if(s=t.items){r=s.length;for(var g=0;g<r;g++)n=s[g],(i=game.ItemInfo.get()).setData(n),i.iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,23==i.id||21==n.id?a.tempList1.push(i):a.tempList2.push(i)}a.tempList1.sort(a.onSort),a.tempList2.sort(a.onSort),a._prizeInfoList=a.tempList1.concat(a.tempList2),a.tempList1.length=0,a.tempList2.length=0}a.list.setData(a._prizeInfoList),a.list.scrollToTop()}else a.list.setData(a._prizeInfoList)},onSort:function(e,t){return e.quality!=t.quality?t.quality-e.quality:e.id-t.id},onHide:function(){b8e.Tween.kill(this.skin.light),this.send(this.Evts.V2C_OPEN_ROLE_UP)},onStageResize:function(){this.setPosition(b8e.stageWidth/2,b8e.stageHeight/2),this.skin.gray.setSize(b8e.stageWidth+50,416)}});b8e.module.registerView(game.ME.QuickBattleAward,e)}(),function(){var e;e=b8e.Enum({NONE:0,C_SAVE_FORMATION:-1,V_UPDATE_FORMATION:-1,V_UPDATE_ENEMY_FORMATION:-1,V_UPDATE_SHENHUN:-1,V_UPDATE_ZHENXING:-1,C2V_UPDATE_ENEMY_FETTER:-1}),b8e.RC("$$game","$$PlayBackFormationEvts",e)}(),function(){var e;e=game.CultivateBaseInfo.extends({id:0,lv:0,star:0,name:"",ctor:function(e,t){this._super(),this.isSelf=t,this.index=e,this.isShowLv=!0,this.isShowName=!0,this.isShowStar=!0,this.active=!0},setData:function(e){if(!e)return this.id=0,void(this.cfg=null);this.id=e.id,this.name=e.name,this.cfg=e.cfg,this.lv=e.lv,this.star=e.star,this.normalUrl=e.normalUrl},clearData:function(){this.id=0,this.cfg=null,this.star=0,this.name=""}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BelongingsInfo",e)}(),function(){var e;e=game.CultivateBaseInfo.extends({id:0,lv:0,star:0,name:"",battle:!1,combine:!1,ctor:function(e,t){this._super(),this.isSelf=t,this.index=e,this.isShowLv=!0,this.isShowName=!0,this.isShowStar=!0,this.active=!0},setData:function(e){if(!e)return this.id=0,void(this.cfg=null);this.id=e.id,this.name=e.name,this.cfg=e.cfg,this.lv=e.lv,this.star=e.star,this.normalUrl=e.normalUrl,this.battle=e.battle},clearData:function(){this.id=0,this.cfg=null,this.star=0,this.name="",this.battle=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerSelectInfo",e)}(),function(){var e=b8e.Object.extends({moduleId:0,toggle:0,setModule:function(e,t){this.moduleId=e||0,this.toggle=t||0},setEnemyData:function(e,t,a){var i=this.enemyDatas;(i=i||(this.enemyDatas=[])).length=0,this.shenHun=null;var n=void 0,s=void 0,r=void 0,o=!1,g=e.length;a.monsterCount=0,a.monsterLen=g,this.eFCallbackSuccess=!1;for(var u=0;u<g;u++)(n=e[u]).type==game.RoleType.Shenhun?(this.shenHun=b8e.createMap(),this.shenHun.id=n.roleId):((r=(s=b8e.createMap()).info=b8e.createMap()).id=n.roleId,r.isMainRole=!1,r.type=n.type,r.name=n.name,r.surface=n.surface,r.isMale=n.ismale,r.quality=n.surface?n.surface.roleQuality:0,r.pos=n.pos,n.type!=game.RoleType.Monster?(o=!0,r.cfg=game.PartnerCfg.getData(r.id)):game.AsyncData.getEAsyncData(game.MonsterCfg,[r.id],this.getMonsterCfg,this,[t,a,r]),r.isEnemy=!0,i[n.pos]=s);return o},getMonsterCfg:function(e,t,a,i){i&&(a.monsterCount++,i.cfg=e,a.monsterCount<a.monsterLen||(this.eFCallbackSuccess=!0,t.call(a)))},getEnemyDataByPos:function(e){var t=this.enemyDatas;return t?t[e]:null},setEnemyBelongings:function(e){var t=void 0,a=this.enemyBelongings;a=a||(this.enemyBelongings=[]);for(var i=0;i<3;i++)(t=a[i])?t.clearData():(t=new game.BelongingsInfo(i,!1),a[i]=t);for(var n=void 0,s=void 0,r=void 0,o=void 0,g=0,u=0;u<3;u++)(n=e[u])&&(n.type==game.NewFosterType.SHENHUN||n.type==game.NewFosterType.HALO?(g=n.type==game.NewFosterType.SHENHUN?0:1,s=game.fosterData.getFosterBaseCfg(n.type,n.id),r=game.fosterData.getFosterClientCfgByType(n.type).iconUrl):n.type==game.NewFosterType.ZHENXING&&(s=game.FormationBaseCfg.getData(n.id),r=10090,g=2),o={id:n.id,lv:n.lv,star:n.star,cfg:s,normalUrl:r},a[g].setData(o))},getEnemyBelongingsByPos:function(e){var t=this.enemyBelongings;return t?t[e]:null},getToBattleCount:function(){for(var e=this.partnerSlots,t=0,a=0,i=e.length;a<i;a++)0<e[a].id&&t++;return t-1},getUnLockBattleCount:function(){for(var e=this.partnerSlots,t=0,a=0,i=e.length;a<i;a++)e[a].isUnLock&&t++;return t},copyParnterFormation:function(){var e=game.partnerData,t=e.partnerFormations,a=this.partnerSlots;a=a||(this.partnerSlots=[]);var i=this.partnerFormations;i=i||(this.partnerFormations=[]);for(var n=void 0,s=void 0,r=0,o=t.length;r<o;r++)i[r]=t[r],n=e.getSlotInfoBySlot(r+1),(s=(s=a[r])||(a[r]={})).slot=n.slot,this.moduleId==game.ME.Explore&&n.info&&0==n.info.exploreHp?(s.id=0,s.info=null):(s.id=n.id,s.info=n.info),s.isHelpPartner=n.isHelpPartner,s.isUnLock=n.getUnIsLock(),s.cfg=n.cfg},getSlotInfoBySlot:function(e){return this.partnerSlots[e-1]},getNotBattlePartnerList:function(){var e=this.notBattleList;if(!e)return null;for(var t=[],a=0,i=e.length;a<i;a++)e[a].select||t.push(e[a]);return t},getBattlePartnerList:function(e){var t=this,a=game.partnerData,i=t.notBattleList;(i=i||(t.notBattleList=[])).length=0,t._inbattleMap&&t._inbattleMap.clear(),t._inbattleHelperMap&&t._inbattleHelperMap.clear();for(var n=void 0,s=void 0,r=0,o=(s=t.moduleId==game.ME.Explore?game.exploreData.getCanBattlePartners():a.partnerInfoArr).length;r<o;r++)if((n=s[r]).active&&!n.helpPos&&!n.helpArmyPos&&(t.moduleId!=game.ME.Explore||0!=n.exploreHp))if(n.showCombine=!1,0<e){if(n.cfg.element==e){if(t.isInBattle(n))continue;n.select=!1,i.push(n)}}else{if(t.isInBattle(n))continue;n.select=!1,i.push(n)}i.sort(t.changeSort);for(var g=t.partnerSlots,u=void 0,l=[],c=g.length-1;-1<c;c--)if(1!=(u=g[c]).slot&&(n=u.info)){if(t.moduleId==game.ME.Explore&&0==n.exploreHp)continue;n.showCombine=!1,n.select=!0,0<e?n.cfg.element==e&&l.push(n):l.push(n)}l.sort(t.changeSort);for(var h=l.length-1;-1<h;h--)n=l[h],i.unshift(n);return i},isInBattle:function(e){var t=this._inbattleMap,a=this._inbattleHelperMap,i=e.helperId&&0<e.helperId;if(t){if(i){if(0<a.count())return null!=a.get(e.helperId)}else if(0<t.count())return null!=t.get(e.id)}else t=this._inbattleMap=b8e.HashMap.get(),a=this._inbattleHelperMap=b8e.HashMap.get();for(var n=this.partnerSlots,s=void 0,r=n.length-1;-1<r;r--)0<(s=n[r]).id&&(s.isHelpPartner?a.set(s.info.helperId,1):t.set(s.id,1));return i?null!=a.get(e.helperId):null!=t.get(e.id)},changeSort:function(e,t){return e.fightAmount>t.fightAmount?-1:e.fightAmount<t.fightAmount?1:t.cfg.id-e.cfg.id},downFormation:function(e){for(var t=this.partnerSlots,a=null,i=e.helperId&&0<e.helperId,n=0,s=t.length;n<s;n++)if(1!=(a=t[n]).slot){var r=!i&&!a.isHelpPartner&&a.id==e.id,o=i&&a.id==e.id&&e.helperId==a.info.helperId;if(r||o)return a.info.select=!1,a.id=0,!(a.info=null)}return!1},downAllFormation:function(){for(var e=this.partnerSlots,t=null,a=0,i=0,n=e.length;i<n;i++)1!=(t=e[i]).slot&&(t.id<1||(t.info.select=!1,t.id=0,t.isHelpPartner=!1,t.info=null,a++));return 0<a},getInfoById:function(e){return game.partnerData.getInfoById(e)},upFormation:function(e,t){var a=this.partnerFormations,i=void 0;if(!this.getInfoById(e.id))return!1;for(var n=0,s=a.length;n<s;n++)if(1!=(i=this.getSlotInfoBySlot(t||a[n])).slot&&(t&&i.slot==t||i.id<1&&i.isUnLock))return 0<i.id&&this.downFormation(i.info),i.id=e.id,i.isHelpPartner=e.helperId&&0<e.helperId,i.info=e,i.info.select=!0;return!1},getSlotFormation:function(e){for(var t=this.partnerFormations,a=void 0,i=0,n=t.length;i<n;i++){if(1!=(a=this.getSlotInfoBySlot(t[i])).slot)if(a.slot==e)return{formation:t[i],slotInfo:a}}return null},getNoBattleSlot:function(){for(var e=this.partnerFormations,t=void 0,a=0,i=e.length;a<i;a++){if(1!=(t=this.getSlotInfoBySlot(e[a])).slot)if(t.id<1&&t.isUnLock)return{formation:e[a],slotInfo:t}}return null},isFormationFull:function(){for(var e=this.partnerSlots,t=0,a=0,i=void 0,n=0,s=e.length;n<s;n++)(i=e[n]).isUnLock&&a++,0<i.id&&t++;return t==a||t<a&&game.partnerData.activeCount<a&&t==game.partnerData.activeCount},exchangePos:function(e){if(e){var t=this.getSlotFormation(e.slot),a=this.getNoBattleSlot();if(!t||!a)return null;for(var i=this.partnerFormations,n=0,s=i.length;n<s;n++)i[n]==t.formation?i[n]=a.formation:i[n]==a.formation&&(i[n]=t.formation);return a.slotInfo}},getSenderSlots:function(){for(var e=[],t=this.partnerSlots,a=0,i=t.length;a<i;a++)0<t[a].id&&e.push({id:t[a].id,slot:t[a].slot});return e},getCombinePartnerInfo:function(e){var t=e.cfg;if(t.combines.length<1)return null;for(var a=this.partnerSlots.length,i=void 0,n=0;n<a;n++)if(i=this.partnerSlots[n],-1!=t.combines.indexOf(i.id))return t.combines;return null},showPartnerCombine:function(e){this.combinesArr||(this.combinesArr=[]);var t=e.cfg;this.combinesArr.length=0;for(var a=this.partnerSlots.length,i=void 0,n=0;n<a;n++)i=this.partnerSlots[n],-1!=t.combines.indexOf(i.id)&&this.combinesArr.push(i.id);for(var s=this.combinesArr.length,r=0;r<s;r++)game.gamePopupMgr.show(game.ME.PlayBackFormationCombine,!0)},checkListCombine:function(){var e=this.notBattleList;if(e)for(var t=void 0,a=0,i=e.length;a<i;a++)(t=e[a]).select||!t.active?t.showCombine=!1:t.showCombine=null!=this.getCombinePartnerInfo(t)},isCombineShow:function(e,t){if(!e||!e.cfg||!t)return!0;var a=this.showCombines;a=a||(this.showCombines=b8e.HashMap.get());var i=e.cfg.id,n=t[0];return!(!a.has(i)&&!a.has(n))||(a.set(i,!0),a.set(n,!0),!1)},clearCombineShow:function(){var e=this.showCombines;e&&e.clear()},getLockSlot:function(){for(var e=this.partnerSlots,t=0,a=e.length;t<a;t++)if(!e[t].isUnLock)return e[t];return null}});game.playBackFormationData=game.playBackFormationData||new e}(),function(){var e=game.Control.extends({ipc:function(){var e=this;e.evts={PartnerFormation:{C_UPDATE_FORMATION:e.updateFormation},PartnerChange:{C_UPDATE_BATTLE:e.updateFormation},Foster:{C2C_UPDATE_BATTLE:e.updateShenhun,C2C_FOSTER_UPSTAR:e.updateShenhun,C2C_FOSTER_UPGRADE:e.updateShenhun},ZhenXingActive:{C2C_UPDATE_BATTLE:e.updateZhenxing},ZhenXingLv:{C2C_UPDATE_LV:e.updateZhenxing},ZhenXingStar:{C2C_STAR_SUCCESS:e.updateZhenxing},Arena:{C2C_SET_FORMATION:e.setFormation},CSArenaChallenge:{C2C_SET_FORMATION:e.setFormation},BaoZang:{C2C_SET_FORMATION:e.setFormation},OccupiedBattle:{C2C_SET_FORMATION:e.setFormation},ZhuanJiBattle:{C2C_SET_FORMATION:e.setFormation},MainInstance:{C2C_SET_FORMATION:e.setFormation},Explore:{C2C_SET_FORMATION:e.setFormation},Barbarian:{C2C_SET_FORMATION:e.setFormation},GuildConflictMain:{C2C_SET_FORMATION:e.setFormation},GuildInstance:{C2C_SET_FORMATION:e.setFormation}},e.handels={BattleTeamInfoResp:e.onBattleTeamInfoResp,PartnerBatchBattleResp:e.onPartnerBatchBattleResp}},notify:function(e){switch(e){case this.Evts.C_SAVE_FORMATION:this.dpt(e)}},setFormation:function(e){var t=e.data;if(Array.isArray(t)&&!(t.length<5)){this.moduleId=t[0];var a=t[1];this.callback=t[2],this.args=t[3],this.thisArg=t[4],this.sender.BattleTeamInfoReq(this.moduleId,a)}},onBattleTeamInfoResp:function(e){var t=e.readProtobuf(game.pb.BattleTeamInfoResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.playBackFormationData.setEnemyData(t.units,this.updateElementFetters,this);game.playBackFormationData.setEnemyBelongings(t.fosters),game.module.show(this.moduleEnum),this.send(this.Evts.V_UPDATE_ENEMY_FORMATION),(a||game.playBackFormationData.eFCallbackSuccess)&&this.updateElementFetters()}},updateElementFetters:function(){this.send(this.Evts.C2V_UPDATE_ENEMY_FETTER)},onPartnerBatchBattleResp:function(e){var t=e.readProtobuf(game.pb.PartnerBatchBattleResponse);0<t.code?game.notice.noticeError(t.code):(game.partnerData.setSlotList(t.datas,1),game.partnerData.setFormations(t.slots),game.partnerData.updateBattleFetterStat(),this.challenge())},updateFormation:function(){this.send(this.Evts.V_UPDATE_FORMATION)},updateShenhun:function(e){if(e.data==game.NewFosterType.SHENHUN||e.data==game.NewFosterType.HALO){this.send(this.Evts.V_UPDATE_SHENHUN,e.data)}},updateZhenxing:function(){this.send(this.Evts.V_UPDATE_ZHENXING)},challengeBtn:function(){game.sdk.traceLog(8);var e=game.playBackFormationData;this.moduleId==game.ME.Explore||e.isFormationFull()?this.moduleId==game.ME.Explore?this.challenge():this.sender.PartnerBatchBattleReq(e.getSenderSlots(),e.partnerFormations):game.notice.show(53017)},challenge:function(){this.callback&&this.callback.apply(this.thisArg,this.args)},tipsBtn:function(){game.module.show(game.ME.ElementTips)},checkShowCombine:function(e){if(e){var t=game.playBackFormationData,a=t.getCombinePartnerInfo(e);a&&(t.isCombineShow(e,a)||(t.currCombineInfo=e,t.showPartnerCombine(e)))}},closeCombineBtn:function(){game.module.hide(game.ME.PlayBackFormationCombine)},ownElemFettersBtn:function(){game.partnerData.elementFettersType=game.PartnerElemFettersTypes.ARRAYING,game.module.show(game.ME.PartnerElementFettersTips)},otherElemFettersBtn:function(){game.partnerData.elementFettersType=game.PartnerElemFettersTypes.ARR_DEFENSE,game.module.show(game.ME.PartnerElementFettersTips)}}),t=game.Sender.extends({ipc:function(){this.msg={BattleTeamInfoReq:this.battleTeamInfoReq,PartnerBatchBattleReq:this.partnerBatchBattleReq}},battleTeamInfoReq:function(e,t){var a=game.pb.BattleTeamInfoRequest;a.moduleId=e,a.id=t,this.write(a)},partnerBatchBattleReq:function(e,t){var a=game.pb.PartnerBatchBattleRequest;a.datas=e,a.slots=t,this.write(a)}}),a=[game.ME.PlayBackFormationCombine];b8e.module.registerControl(game.ME.PlayBackFormation,e,game.PlayBackFormationEvts,t,a)}(),function(){var e;e=game.CultivateBaseListItem.extends({ctor:function(){this._super(1411)},setData:function(){var e=this.skin,t=this.data,a=t.isSelf,i=t.index;if(e.nameLab.string=a?game.Lang.get(5986+i):game.Lang.get(5985),e.nameLab.active=!0,t.cfg)this._super(t),e.nameLab.active=!1;else{if(e.nameLab.setColor(game.Color.WHITE),e.typeNameLab.active=!a,e.typeNameLab.string=game.Lang.get(5986+i),a){var n=!1;0==i?n=game.moduleOpen.checkOpen(game.ME.Shenhun):1==i?n=game.moduleOpen.checkOpen(game.ME.Halo):2==i&&(n=game.moduleOpen.checkOpen(game.ME.ZhenXing)),e.lock.active=!n,e.add.active=n}this.icon.clearData()}},setSelect:function(){},setAlert:function(){},touchIcon:function(){var e=this.data;if(e&&e.isSelf){var t=e.index;0==t?game.module.show(game.ME.Shenhun):1==t?game.module.show(game.ME.Halo):2==t&&game.module.show(game.ME.ZhenXing)}}}),b8e.RC("$$game","$$PlayBackFormationBelongings",e)}(),function(){var e;e=game.PartnerFormationItem.extends({ctor:function(){this._super("playBack/PlayBackFormationGrid")},init:function(){var e=game.RoleData.get(game.RoleType.Hero);this.roleModel=game.sceneRoleCreate.createUIRole(e),this.roleModel.addToParent(this.skin.modelNode),this.surfaceModel=new b8e.SceneEntity.get,this.surfaceModel.addToParent(this.skin.modelNode),this.data=game.playBackFormationData,this.isInit=!0},setBattleSoltType:function(e){this._slotType=e},updateData:function(){var a=this,e=a.skin;if(a.slotInfo){var i=a.slotInfo.info,t=1==a._slotType?7:a.data.getToBattleCount(),n=1==a._slotType?7:a.data.getUnLockBattleCount();e.battleIcon.active=!1,a.roleModel.setVisible(!1),a.surfaceModel.setVisible(!1),!i&&t<n-1?e.battleIcon.active=!0:i&&(i.isMainRole||i.type==game.RoleType.Hero?(a.setSurface(i.surface),game.AvatarUtil.updateUIModel(a.roleModel,1,!1),a.roleModel.transition(game.RoleStateType.ACTION_IDLE),a.roleModel.setDirection(game.Direction.getAnimatDirection(i.isEnemy?game.Direction.DownRight:game.Direction.UpLeft)),a.roleModel.setVisible(!0)):(a.getUrl(i,function(e){var t=a.surfaceModel.getAnimator(game.AnimType.BODY,1);e?((t=t||a.surfaceModel.addAnimator(game.AnimType.BODY,1)).load(e),t.setDirection(game.Direction.getAnimatDirection(i.isEnemy?game.Direction.DownRight:game.Direction.UpLeft)),t.play()):t&&t.clear(),i&&i.type&&i.type==game.RoleType.Monster&&a.setBattleSolt()},a),a.surfaceModel.setVisible(!0))),i&&i.type&&i.type==game.RoleType.Monster||a.setBattleSolt()}},setBattleSolt:function(){var e=this.skin;if(this.slotInfo){var t=this.slotInfo.info;if(t){var a=t.cfg,i=5;0<t.quality?i=t.quality:a&&(i=a.quality),e.nameLab.active=!0;var n=t.name?t.name:a.name;if(t.type!=game.RoleType.Monster)n+=t.isEnemy?t.surface&&t.surface.topLv?"+"+t.surface.topLv:"+0":"+"+t.breakLv;var s=game.HtmlUtil.getColorStrByQuality(i,n);e.nameLab.setText(s),e.nameBg.active=!0,e.nameBg.width=e.nameLab.width+20,e.star.string=t.isEnemy?t.surface&&t.surface.starLv?t.surface.starLv:0:t.star,e.starNode.setPosition(-e.nameBg.width/2+12,-37),e.starNode.setVisible(t.isEnemy?t.type==game.RoleType.Partner:1!=t.id),1==this._slotType&&(e.battleIcon.active=!1)}else this.hideModel()}},setSurface:function(e){if(this.slotInfo&&this.slotInfo.info&&this.roleModel&&this.roleModel.data&&this.roleModel.data.heroModel){var t=this.slotInfo.info,a=this.roleModel.data.heroModel;a.type=game.RoleType.Hero,t.isMainRole?(this.roleModel.data.setMale(game.mainRoleData.isMale),a.setAnims(game.mainRoleData.heroModel.copyAnim()),game.mainRoleData.heroModel.surfaces&&a.setSurfaces(game.mainRoleData.heroModel.surfaces,!1)):(this.roleModel.data.setMale(t.isMale),a.setSurface(e))}},hideModel:function(){var e=this.skin;this.roleModel&&this.roleModel.setVisible(!1),this.surfaceModel&&this.surfaceModel.setVisible(!1),e.nameBg.active=!1,e.nameLab.active=!1,e.starNode.active=!1},battleIcon:function(){var e=game.playBackFormationData;if(!this.slotInfo.info){var t=e.getToBattleCount();if(e.getUnLockBattleCount()-1<=t)return}this.slotInfo.info&&this.slotInfo.info.isMainRole?game.notice.show(51446):(this.slotInfo.isUnLock?game.partnerData.changeSlot=this.slotInfo:game.partnerData.changeSlot=e.exchangePos(this.slotInfo),game.partnerData.changeSlot?game.module.show(game.ME.PartnerChange):b8e.warn("\u627e\u4e0d\u5230\u53ef\u4e0a\u9635\u7684\u69fd\u4f4d"))}}),b8e.RC("$$game","$$PlayBackFormationGrid",e)}(),function(){var e;e=game.CultivateBaseListItem.extends({ctor:function(){this._super(1500),this.setSize(110,120)},setData:function(e){this.icon.setData(e),this.resetSelectSkin(),this.setSelect(),this.setStar(e),this.setHp()},setHp:function(){var e=this.skin,t=game.playBackFormationData.moduleId==game.ME.Explore;e.hpNode.active=t;var a=this.data.exploreHp,i=this.data.exploreMaxhp;if(0!=i){if(t){var n=e.hp_back.width-3;e.hp_front.width=a/i*n;var s=this.data.helperId;e.helper_tag.active=s&&0<s}this.setCombine()}},setCombine:function(){var e=this.data;this.skin.combine.active=e.showCombine},resetSelectSkin:function(){if(!this.isReset){var e=this.skin.headSelect;e.setAnchor(.5,.5),e.setPosition(0,0),e.removeFromParent(),e.addToParent(this.icon.iconImg),this.isReset=!0}},touchIcon:function(){var e=this.data;if(e&&e.cfg){var t=e.select,a=game.playBackFormationData,i=!1;if(e.select?i=a.downFormation(e):(i=a.upFormation(e))&&b8e.module.getControl(game.ME.PlayBackFormation).checkShowCombine(e),i)b8e.module.getControl(game.ME.PlayBackFormation).updateFormation();else if(!t){var n=a.getLockSlot();n&&n.cfg?game.notice.show(53059,n.cfg.level,n.cfg.vip):game.notice.show(53016)}}}}),b8e.RC("$$game","$$PartnerSelectItem",e)}(),function(){var e=game.View.extends({SELF:0,ENEMY:1,ctor:function(){this._super("playBack/PlayBackFormationView")},notify:function(e,t){var a=this;switch(e){case a.Evts.V_UPDATE_FORMATION:a.updateFormation();break;case a.Evts.V_UPDATE_ENEMY_FORMATION:a.createEnemyBattleUnit(),a.createEnemyShenhun(),a.createEnemyBelongings();break;case a.Evts.V_UPDATE_SHENHUN:t==game.NewFosterType.SHENHUN?(a.createSelfShenhun(),a.updateSelfShenhunIcon()):a.updateSelfHaloIcon();break;case a.Evts.V_UPDATE_ZHENXING:a.updateSelfZhenxingIcon();break;case a.Evts.C2V_UPDATE_ENEMY_FETTER:a.updateOtherElemFettersBtn()}},init:function(){var e=this,t=e.SELF,a=e.ENEMY;e._formationPoint=[],e._formationPoint[t]=[{x:-10,y:-100},{x:85,y:-12},{x:173,y:68},{x:96,y:-178},{x:191,y:-90},{x:280,y:-8},{x:290,y:-163}],e._formationPoint[a]=[{x:-175,y:26},{x:-82,y:114},{x:10,y:195},{x:-284,y:106},{x:-190,y:192},{x:-100,y:274},{x:-295,y:272}],e._fzIndex=[],e._fzIndex[t]=[13,12,11,16,15,14,17],e._fzIndex[a]=[7,6,5,4,3,2,1],e.shenhunModel=[],e._belongings=[],e._curSelectElement=-1,e._formationItems=[],e._enemyFormationItems=[],e._drags=[],e._formationItemMap=b8e.HashMap.get(),e._bg=b8e.Sprite.get(),e._bg.setAnchor(.5,.5);var i=game.ResCfg.getImgUrl("playBack/formation_bg",!0);e._bg.loadTexture(i),e.skin.bg.addChild(e._bg),e.createSelfBattleUnit();var n=e.enemyList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);n.itemRender=game.PlayBackFormationBelongings,n.bindEnum=game.ME.Foster,n.layout.paddingLeft=5,n.layout.paddingRight=0,n.layout.paddingTop=0,n.layout.spacingX=0,n.layout.spacingY=0,e.skin.enemyList.setSize(370,130),n.addToParent(e.skin.enemyList),n.touchMovable=!1,n.setScale(.8,.8);var s=e.selfList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);s.itemRender=game.PlayBackFormationBelongings,s.bindEnum=game.ME.Foster,s.layout.paddingLeft=5,s.layout.paddingRight=0,s.layout.paddingTop=0,s.layout.spacingX=0,s.layout.spacingY=0,e.skin.selfList.setSize(370,130),s.addToParent(e.skin.selfList),s.touchMovable=!1,s.setScale(.8,.8);var r=e._selectList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);r.itemRender=game.PartnerSelectItem,r.bindEnum=game.ME.PartnerFormation,r.layout.paddingLeft=0,r.layout.paddingRight=0,r.layout.paddingTop=0,r.layout.spacingX=10,r.layout.spacingY=5,r.safetyTraversal=!1,r.addToParent(e.skin.selectList),e._belongingsInfos=[];for(var o=void 0,g=0;g<3;g++)o=new game.BelongingsInfo(g,!0),e._belongingsInfos[g]=o},updateBelongings:function(){this.updateSelfShenhunIcon(),this.updateSelfHaloIcon(),this.updateSelfZhenxingIcon(),this.selfList.setData(this._belongingsInfos)},createEnemyBelongings:function(){this.enemyList.setData(game.playBackFormationData.enemyBelongings)},onShow:function(){var e=game.playBackFormationData;0<e.moduleId&&game.module.hide(e.moduleId),game.module.hide(game.ME.MainUIBottom),this.skin.descLab.string=game.Lang.get(5989),e.copyParnterFormation(),this.setSelect(0),this.createSelfShenhun(),this.updateFormation(),this.updateBelongings()},onHide:function(){this._curSelectElement=-1;var e=game.playBackFormationData;e.downAllFormation(),e.clearCombineShow();var t=game.sceneData.isGuildConflict();game.exploreScene.isInExploreScene()||t||game.module.show(game.ME.MainUIBottom),game.gamePopupMgr.showNext()},updateSelectList:function(e){this.partnerDatas=this.getSelectInfos(e),this._selectList.setData(this.partnerDatas),this._selectList.scrollToTop(),this._curSelectElement=e,this.skin.no_info.active=!this.partnerDatas||this.partnerDatas.length<1},getSelectInfos:function(e){return game.playBackFormationData.getBattlePartnerList(e)},updateSelfShenhunIcon:function(){this._belongingsInfos[0].setData(game.fosterData.getBattleInfo(game.NewFosterType.SHENHUN))},updateSelfHaloIcon:function(){this._belongingsInfos[1].setData(game.fosterData.getBattleInfo(game.NewFosterType.HALO))},updateSelfZhenxingIcon:function(){this._belongingsInfos[2].setData(game.zhenXingData.getCurBattleInfo()),this.updateZhenxingDesc()},updateZhenxingDesc:function(){var e=this.skin,t=game.zhenXingData,a=e.labMask,i=t.battleId,n=game.playBackFormationData.getEnemyBelongingsByPos(2),s=n?n.id:0;if(i&&s){var r=t.getKeZhiState(i,s);r?(a.active=!0,e.formationLab.string=t.getKeZhiDesc(r,i,s,52223,52224)):a.active=!1}else a.active=!1},createSelfBattleUnit:function(){var e=this,t=e.SELF,a=game.playBackFormationData;a.copyParnterFormation();for(var i=void 0,n=void 0,s=e.skin.battlePanel,r=0,o=a.partnerFormations.length;r<o;r++)(n=new game.PlayBackFormationGrid).x=e._formationPoint[t][r].x,n.y=e._formationPoint[t][r].y,n.setBattleSoltType(t),n.setLocalZOrder(e._fzIndex[t][r]),n.setData(a.getSlotInfoBySlot(a.partnerFormations[r])),e._formationItemMap.set(n.slotInfo.slot,n),e._formationItems.push(n),s.addChild(n);for(var g=void 0,u=0,l=e._formationItems.length;u<l;u++){n=e._formationItems[u],i=[];for(var c=0;c<l;c++)n!=e._formationItems[c]&&i.push(e._formationItems[c]);g=game.dragEffectMgr.addDrag(n,i,e.dragPlace,e,e.clickHanlder,e),n.dragItem=g,e._drags.push(g)}},clickHanlder:function(e){if(e&&e.slotInfo&&e.slotInfo.info){var t=game.playBackFormationData;if(!e.slotInfo.info){var a=t.getToBattleCount();if(t.getUnLockBattleCount()-1<=a)return}e.slotInfo.info&&e.slotInfo.info.isMainRole?game.notice.show(51446):(game.partnerData.changeSlot=e.slotInfo,e.slotInfo.isUnLock||(game.partnerData.changeSlot=t.exchangePos(e.slotInfo)),game.partnerData.changeSlot?game.module.show(game.ME.PartnerChange):b8e.warn("\u627e\u4e0d\u5230\u53ef\u4e0a\u9635\u7684\u69fd\u4f4d"))}},createShenhun:function(e,t){var a=this.shenhunModel[t];a||((a=this.shenhunModel[t]=new b8e.SceneEntity.get).addToParent(this.skin.battlePanel),a.setLocalZOrder(this._fzIndex[t][6]),a.setPosition(this._formationPoint[t][6].x,this._formationPoint[t][6].y));var i=a.getAnimator(game.AnimType.BODY,1),n=void 0;e&&(n=game.ResCfg.getUrl(5088,e.model)),n?((i=i||a.addAnimator(game.AnimType.BODY,1)).load(n),i.setDirection(game.Direction.getAnimatDirection(0==t?game.Direction.UpLeft:game.Direction.DownRight)),i.play()):i&&i.clear(),a.setVisible(!0)},createSelfShenhun:function(){var e=game.fosterData.getBattleInfo(game.NewFosterType.SHENHUN),t=void 0;e&&(t=e.cfg),this.createShenhun(t,this.SELF)},createEnemyShenhun:function(){var e=game.playBackFormationData.shenHun;if(e){var t=game.ShenhunBaseCfg.getData(e.id);this.createShenhun(t,this.ENEMY)}else{var a=this.shenhunModel[this.ENEMY];a&&a.setVisible(!1)}},createEnemyBattleUnit:function(){for(var e=this.ENEMY,t=game.playBackFormationData,a=void 0,i=this.skin.battlePanel,n=void 0,s=0;s<6;s++)a=this._enemyFormationItems[s],(n=t.getEnemyDataByPos(s+1))?(a||((a=new game.PlayBackFormationGrid).x=this._formationPoint[e][s].x,a.y=this._formationPoint[e][s].y,a.setBattleSoltType(),a.setLocalZOrder(this._fzIndex[e][s]),i.addChild(a),this._enemyFormationItems[s]=a),a.setData(n)):a&&a.hideModel()},updateOtherElemFettersBtn:function(){var e=this.skin.otherElemFettersBtn;game.partnerData.elementFettersType=game.PartnerElemFettersTypes.ARR_DEFENSE;var t=game.partnerData.getElemeltFettersNum();t?e.loadTexture(game.ResCfg.getUrl(10194,t.id)):e.loadTexture(game.ResCfg.getUrl(10194,1))},dragPlace:function(e,t){if(t&&e){var a=e.dragItem._dragStartPoint.x,i=e.dragItem._dragStartPoint.y;b8e.Tween.kill(t),b8e.Tween.get(t,null,null).to({x:a,y:i},50),this.exchangePosSave(e,t)}},exchangePosSave:function(e,t){for(var a=void 0,i=game.playBackFormationData,n=0,s=this._formationItems.length;n<s;n++)(a=this._formationItems[n])==e?this._formationItems[n]=t:a==t&&(this._formationItems[n]=e),i.partnerFormations[n]=this._formationItems[n].slotInfo.slot,this._formationItemMap.set(this._formationItems[n].slotInfo.slot,this._formationItems[n]);this.updateZorder()},updateZorder:function(){var e=game.playBackFormationData,t=void 0;if(e.partnerFormations)for(var a=0,i=e.partnerFormations.length;a<i;a++)(t=this._formationItems[a]).dragItem.isDisable=!t.slotInfo.id,t.setLocalZOrder(this._fzIndex[this.SELF][a]),this._formationItemMap.set(t.slotInfo.slot,t)},updateFormation:function(){var e=game.playBackFormationData,t=void 0,a=void 0;if(e.partnerFormations){for(var i=0,n=e.partnerFormations.length;i<n;i++)t=this._formationItems[i],a=this._formationPoint[this.SELF][i],t.setData(e.getSlotInfoBySlot(e.partnerFormations[i])),t.dragItem.isDisable=!t.slotInfo.id,t.x=a.x,t.y=a.y,t.setLocalZOrder(this._fzIndex[this.SELF][i]),this._formationItemMap.set(t.slotInfo.slot,t);e.checkListCombine(),this.updateOwnElemFettersBtn()}},updateOwnElemFettersBtn:function(){var e=this.skin.ownElemFettersBtn;game.partnerData.elementFettersType=game.PartnerElemFettersTypes.ARRAYING;var t=game.partnerData.getElemeltFettersNum();t?e.loadTexture(game.ResCfg.getUrl(10195,t.id)):e.loadTexture(game.ResCfg.getUrl(10195,1))},viewNatureBtn0:function(){this.setSelectElement(0)},viewNatureBtn1:function(){this.setSelectElement(1)},viewNatureBtn2:function(){this.setSelectElement(2)},viewNatureBtn3:function(){this.setSelectElement(3)},viewNatureBtn4:function(){this.setSelectElement(4)},setSelectElement:function(e){this.setSelect(e),game.playBackFormationData.checkListCombine()},setSelect:function(e){if(this._curSelectElement!=e)for(var t=this.skin.select,a=void 0,i=0;i<5;i++)(a=this.getComponent("viewNatureBtn"+i))&&i==e&&(t.setPosition(a.getPosition()),this.updateSelectList(e))},viewFormationDownBtn:function(){game.playBackFormationData.downAllFormation()&&(this.updateFormation(),this._selectList.scrollToTop())},returnBtn:function(){var e=game.playBackFormationData;game.module.hide(game.ME.PlayBackFormation),0<e.moduleId&&(0<e.toggle?game.module.showToggle(e.moduleId,e.toggle):game.module.show(e.moduleId),e.moduleId=0,e.toggle=0)},onStageResize:function(){var e=this.skin,t=b8e.stageWidth,a=b8e.stageHeight;this.x=0,this.y=a,this.width=t,this.height=a,e.bg.width=t,e.bg.heigth=a,e.bg.setPosition(t>>1,-a>>1),e.selfBg.setPosition(t-10,-59),e.infoBg.setPosition(t-10,-214),e.ownElemFettersBtn.setPosition(t-10,-322),e.battlePanel.setPosition(t>>1,80+(-a>>1)),e.labMask.setPosition(10,555-a),e.otherElemFettersBtn.setPosition(10,640-a),e.infoBg_3.setSize(t,470),e.infoBg_3.setPosition(t>>1,10-a),e.selectbg.setSize(t-180,76),e.returnBtn.setPosition((t>>1)-46,45),e.viewFormationDownBtn.setPosition((t>>1)-56,138),e.tipsBtn.setPosition(56-(t>>1),135),e.no_info.setPosition(t>>1,330-a),e.selectList.setPosition(20-(t>>1),450),this.resizeSelectView()},calViewSpacingX:function(){var e=b8e.stageWidth-40,t=e/110|0,a=(e-110*t)/(t-1);this._selectList.layout.spacingX=a},resizeSelectView:function(){var e=b8e.stageWidth-30;this.calViewSpacingX(),this._selectList.onStageResize(e,this._selectList.height)},$$getPartnerItem:function(e){if(!this._selectList||!this.partnerDatas||this.partnerDatas.length<=e)return null;var t=this.partnerDatas[e];if(!t)return null;var a=this._selectList.getItemRender(t);return a&&a.skin?a.skin.touchIcon:null}});b8e.module.registerView(game.ME.PlayBackFormation,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("playBack/element_tips")},init:function(){var e=game.ResCfg.getUrl(10047);this.skin.element_bg.loadTexture(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(e>>1,t>>1)}});b8e.module.registerControl(game.ME.ElementTips,game.Control),b8e.module.registerView(game.ME.ElementTips,e)}(),function(){var e=game.PartnerCombineView.extends({init:function(){this.moduleData=game.playBackFormationData,this.initItem(),game.TweenUtil.rotationEffect(this.skin.light)}});b8e.module.registerView(game.ME.PlayBackFormationCombine,e)}(),function(){var e;e=b8e.Enum({None:0,C_TOGGLE_CHANGE:-1,V_GET_LEVEL_REWARD:-1,V_GET_BOX_REWARD:-1,V_GET_TASK_REWARD:-1,C_BUY_LEVEL_ADD:-1,C_UPDATE_UNLOCK_BTN_STATE:-1,C_UPDATE_LEVEL_VIEW:-1,C_RECHARGE:-1,C_TASK_PROGRESS_FRESH:-1,C_REFRESH_SCORE_BOX:-1,C_ON_OPEN_VIEW:-1,C_ON_DAILY_RESET:-1}),b8e.RC("$$game","$$WarOrderEvts",e)}(),function(){var e=b8e.Object.extends({id:0,lv:0,exp:0,supreme:!1,score:0,lvAwards:null,scoreBoxs:null,dailyTasks:null,weekTasks:null,seasonTask:null,loginDays:0,_warOrderMaxLevel:0,endDay:0,openDay:0,duration:0,selectAddNum:0,isExtraSupreme:!1,isFirstOpenUI:!0,ctor:function(){var e=this;e.lvAwards=[],e.scoreBoxs=[],e.dailyTasks=[],e.weekTasks=[],e.seasonTasks=[],e.levelInfoMap=b8e.HashMap.get(),e.dailyTaskInfoMap=b8e.HashMap.get(),e.weekTaskInfoMap=b8e.HashMap.get(),e.seasonTaskInfoMap=b8e.HashMap.get(),e.scoreBoxInfos=[]},setData:function(e){var t=this;t.id=e.id,t.lv=e.lv,t.exp=e.exp,t.supreme=e.supreme,t.score=e.score,t.lvAwards=e.lvAward,t.scoreBoxs=e.scoreBox,t.dailyTasks=e.dailyTask,t.weekTasks=e.weekTask,t.seasonTasks=e.seasonTask,t.loginDays=e.loginDays-1,t.duration=t.getDurationById(t.id)},resetData:function(){var e=this;e.loginDays++,e.checkIsEnd()&&(e.lv=0,e.exp=0,e.supreme=!1,e.lvAwards.length=0,e.weekTasks.length=0,e.seasonTasks.length=0,e.weekTaskInfoMap.clear(),e.seasonTaskInfoMap.clear(),e.levelInfoMap.clear()),e.loginDays%7==0&&(e.weekTasks.length=0,e.weekTaskInfoMap.clear()),e.score=0,e.dailyTasks.length=0,e.scoreBoxs.length=0,e.scoreBoxInfos.length=0,e.dailyTaskInfoMap.clear()},updateScoreBox:function(e){-1<this.scoreBoxs.indexOf(e)||(this.scoreBoxs.push(e),this.updateScoreBoxInfo())},updateCompleteTask:function(e){var t=e.taskType,a=e.taskId;this.lv=e.lv,this.exp=e.exp;var i=void 0;switch(t){case 1:this.score=e.score,i=this.dailyTaskInfoMap.get(a),this.updateScoreBoxInfo();break;case 2:i=this.weekTaskInfoMap.get(a);break;case 3:i=this.seasonTaskInfoMap.get(a)}i.onGetReward()},updateLevel:function(e){var t=this.getMiscData("warTokenMaxLevel");t<e&&(e=t),this.lv=e;for(var a=1;a<=e;a++)this.levelInfoMap.get(a).updateLv()},updateSupreme:function(){this.supreme=!0;for(var e=this.levelInfoMap.values(),t=e.length,a=0;a<t;a++)e[a].updateLv()},updateLevelInfo:function(e){var t=e.level,a=this.levelInfoMap.get(t);a&&a.updateRewState()},updateTaskProgress:function(e){var t=this.getTaskMapByType(e.taskType).get(e.taskId);t&&t.updateProgress(e.process)},warOrderMaxLevel:{get:function(){return 0==this._warOrderMaxLevel&&(this._warOrderMaxLevel=+game.CfgUtil.getMiscValue(game.WarTokenMiscCfg,"warTokenMaxLevel")),this._warOrderMaxLevel}},getLevelInfos:function(){return this.levelInfoMap.values().length<1&&this.initLevelInfos(),this.levelInfoMap.values()},getNextComplete:function(){for(var e=1,t=this.getLevelInfos(),a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n]).canGetElite||i.canGetsupreme){e=i.cfg.lv;break}return e},initLevelInfos:function(){for(var e=this.getMiscData("warTokenMaxLevel"),t=void 0,a=void 0,i=1;i<=e;i++)t=game.WarTokenLevelCfg.getData(this.id,i),(a=new game.WarOrderLevelInfo).cfg=t,a.updateLv(),this.levelInfoMap.set(t.lv,a);for(var n=this.lvAwards.length,s=void 0,r=void 0,o=0;o<n;o++){r=(s=this.lvAwards[o]).lv;var g=this.levelInfoMap.get(r);g&&g.setData(s)}},getTaskInfosByType:function(e){var t=this.getTaskMapByType(e);if(!t)return null;var a=t.values();return a.sort(this.taskSortHandler),a},getTaskMapByType:function(e){return this.getTaskInfoMap(e).values().length<1&&this.initTaskInfosByType(e),this.getTaskInfoMap(e)},getTaskInfoMap:function(e){var t=game.WarOrderTaskType,a=void 0;switch(e){case t.DAILY:a=this.dailyTaskInfoMap;break;case t.WEEKLY:a=this.weekTaskInfoMap;break;case t.QUARTER:a=this.seasonTaskInfoMap}return a},initTaskInfosByType:function(e){var t=game.WarOrderTaskType,a=void 0,i=void 0,n=void 0;switch(e){case t.DAILY:a=this.dailyTaskInfoMap,i=game.WarTokenDailyTaskCfg.getDatas(),n=this.dailyTasks;break;case t.WEEKLY:a=this.weekTaskInfoMap,i=game.WarTokenWeekTaskCfg.getDatas(),n=this.weekTasks;break;case t.QUARTER:a=this.seasonTaskInfoMap,i=game.WarTokenSeasonTaskCfg.getDatas(),n=this.seasonTasks}this.initTaskInfo(e,a,i,n)},initTaskInfo:function(e,t,a,i){if(a){for(var n=a.length,s=void 0,r=void 0,o=0;o<n;o++)s=a[o],(r=new game.WarOrderTaskInfo).type=e,r.cfg=s,r.id=s.id,t.set(s.id,r);n=i.length;for(var g=void 0,u=0;u<n;u++)g=i[u],(r=t.get(g.id))&&r.setData(g)}},getScoreBoxInfos:function(){if(0<this.scoreBoxInfos.length)return this.scoreBoxInfos;var e=game.WarTokenDialyScoreCfg.getDatas();if(e){for(var t=e.length,a=void 0,i=0;i<t;i++)(a=new game.WarOrderScoreBoxInfo).cfg=e[i],this.scoreBoxInfos.push(a);return this.updateScoreBoxInfo(),this.scoreBoxInfos}},updateScoreBoxInfo:function(){for(var e=this.scoreBoxInfos.length,t=void 0,a=0;a<e;a++){var i=(t=this.scoreBoxInfos[a]).cfg.score;-1<this.scoreBoxs.indexOf(i)?(t.isGet=!0,t.canGet=!1):(t.isGet=!1,t.canGet=this.score>=i)}},getIsOpen:function(){return 0<this.id},checkIsEnd:function(){return this.loginDays>=this.duration},getDurationById:function(){if(!this.id||0==this.id)return 0;var e=game.WarTokenOpenCfg.getData(this.id);return e?e.lastDay:0},getCountDown:function(){return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,this.duration-this.loginDays)-game.SysTime.curTime},getWeekCountDown:function(){var e=this.loginDays%7,t=this.duration-this.loginDays,a=7<=t?7-e:t;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,a)-game.SysTime.curTime},checkLevelRedPoint:function(){for(var e=this.getLevelInfos(),t=e.length,a=void 0,i=0;i<t;i++)if((a=e[i]).canGetElite||a.canGetsupreme)return!0;return!1},checkDailyTaskAllRedPoint:function(){return this.checkTaskRedPoint(game.WarOrderTaskType.DAILY)||this.chekScoreBoxRedPoint()},chekScoreBoxRedPoint:function(){for(var e=this.getScoreBoxInfos(),t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},checkTaskRedPoint:function(e){var t=this.getTaskInfosByType(e);if(t){for(var a=t.length,i=0;i<a;i++)if(t[i].canGetRew)return!0;return!1}},getMiscData:function(e){var t=this;switch(e){case"warTokenBuyLvCost":return t.warTokenBuyLvCost||(t.warTokenBuyLvCost=+game.CfgUtil.getMiscValue(game.WarTokenMiscCfg,e)),t.warTokenBuyLvCost;case"warTokenMaxLevel":return t.warTokenMaxLevel||(t.warTokenMaxLevel=+game.CfgUtil.getMiscValue(game.WarTokenMiscCfg,e)),t.warTokenMaxLevel;case"boxMaxScore":return t.boxMaxScore||(t.boxMaxScore=+game.CfgUtil.getMiscValue(game.WarTokenMiscCfg,e)),t.boxMaxScore;case"supremeAddLv":return t.supremeAddLv||(t.supremeAddLv=+game.CfgUtil.getMiscValue(game.WarTokenMiscCfg,e)),t.supremeAddLv;default:return 0}},getUpLvCanGetReward:function(e){for(var t=this.lv+e,a=void 0,i=[],n=this.lv;n<t;n++)a=game.WarTokenLevelCfg.getData(this.id,n+1),i.push.apply(i,a.eliteAward),this.supreme&&i.push.apply(i,a.supremeAward);return this.mergeSameReward(i)},mergeSameReward:function(e){this.totalRewMap||(this.totalRewMap=b8e.HashMap.get()),this.totalRewMap.clear();for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=this.totalRewMap.get(a.Id))?i+=a.Num:i=a.Num,this.totalRewMap.set(a.Id,i);return this.totalRewMap},getUpLvRewardInfos:function(e){var a=this;a.upLvRewInfos||(a.upLvRewInfos=[]),a.clearList(a.upLvRewInfos);var t=a.getUpLvCanGetReward(e),i=void 0;return t.forEach(function(e,t){i=game.ItemUtil.createBaseItemInfo(e,t),a.upLvRewInfos.push(i)},a),a.upLvRewInfos},getCanBuyLvMax:function(){var e=Math.floor(game.amount.get(game.AmountType.YUAN_BAO)/this.getMiscData("warTokenBuyLvCost")),t=this.getMiscData("warTokenMaxLevel");return this.lv+e>t?t-this.lv:e},getSupremeReward:function(e,t){this.supremeRewards||(this.supremeRewards=[]);for(var a=void(this.supremeRewards.length=0),i=e+1;i<=t;i++)a=game.WarTokenLevelCfg.getData(this.id,i),this.supremeRewards.push.apply(this.supremeRewards,a.supremeAward);return this.mergeSameReward(this.supremeRewards)},getSupremeRewInfos:function(e,t,a){var i=this.getSupremeReward(e,t),n=void 0;return i.forEach(function(e,t){n=game.ItemUtil.createBaseItemInfo(e,t),a.push(n)},this),a},getAllSupremeRewInfos:function(e,t){return this.allSupremeRewInfos||(this.allSupremeRewInfos=[]),this.clearList(this.allSupremeRewInfos),this.allSupremeRewInfos=this.getSupremeRewInfos(e,t,this.allSupremeRewInfos),this.allSupremeRewInfos},getCurrSupremeRewInfos:function(e,t){return this.currSupremeRewInfos||(this.currSupremeRewInfos=[]),this.clearList(this.currSupremeRewInfos),this.currSupremeRewInfos=this.getSupremeRewInfos(e,t,this.currSupremeRewInfos),this.currSupremeRewInfos},getWeekTaskNotCompNum:function(){for(var e=this.getTaskInfosByType(game.WarOrderTaskType.WEEKLY),t=e.length,a=0,i=0;i<t;i++)e[i].flag||a++;return a},taskSortHandler:function(e,t){return e.flag==t.flag?e.canGetRew==t.canGetRew?e.cfg.id-t.cfg.id:e.canGetRew?-1:1:e.flag?1:t.flag?-1:void 0},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0}});game.warOrderData=game.warOrderData||new e}(),function(){var e;e=b8e.Object.extends({eliteFlag:!1,supremeFlag:!1,canGetElite:!1,canGetsupreme:!1,cfg:null,setData:function(e){this.eliteFlag=e.eliteFlag,this.supremeFlag=e.supremeFlag,this.updateLv()},updateLv:function(){game.warOrderData.lv>=this.cfg.lv&&(this.canGetElite=!this.eliteFlag,this.canGetsupreme=game.warOrderData.supreme&&!this.supremeFlag)},updateRewState:function(){this.canGetElite=!1,this.eliteFlag=!0,game.warOrderData.supreme&&(this.canGetsupreme=!1,this.supremeFlag=!0)},getElitePrizeList:function(){if(this.elitePrizeList)return this.elitePrizeList;this.elitePrizeList=[];for(var e=this.cfg.eliteAward,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.elitePrizeList.push(i);return this.elitePrizeList},getSupremePrizeList:function(){if(this.supremePrizeList)return this.supremePrizeList;this.supremePrizeList=[];for(var e=this.cfg.supremeAward,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.supremePrizeList.push(i);return this.supremePrizeList}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$WarOrderLevelInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,isGet:!1,canGet:!1,ctor:function(){this._super()}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$WarOrderScoreBoxInfo",e)}(),function(){var e;e=b8e.Object.extends({type:0,id:0,process:0,flag:!1,cfg:null,canGetRew:!1,ctor:function(){this._super()},setData:function(e){this.id=e.taskId,this.flag=2==e.flag,this.updateProgress(e.process)},onGetReward:function(){this.canGetRew=!1,this.flag=!0},updateProgress:function(e){this.process=e,this.process>this.cfg.condition&&(this.process=this.cfg.condition),this.canGetRew=this.process==this.cfg.condition&&!this.flag},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.cfg.showAward,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(i);return this.prizeList}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$WarOrderTaskInfo",e)}(),function(){var e;e=b8e.Enum({$$NONE:0,$$DAILY:1,$$WEEKLY:2,$$QUARTER:3}),b8e.RC("$$game","$$WarOrderTaskType",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.warOrderData;var e=game.spotAlert;this.allSpotAlert=e.set(game.SAE.WAR_ORDER),this.levelSpotAlert=e.set(game.SAE.WAR_ORDER_LEVEL,game.SAE.WAR_ORDER),this.dailySpotAlert=e.set(game.SAE.WAR_ORDER_DAILY,game.SAE.WAR_ORDER),this.weekSpotAlert=e.set(game.SAE.WAR_ORDER_WEEK,game.SAE.WAR_ORDER),this.quarterSpotAlert=e.set(game.SAE.WAR_ORDER_QUARTER,game.SAE.WAR_ORDER)},ipc:function(){var e=this;e.evts={Recharge:{C_SUPREME_WAR_ORDER:e.onRechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily},WarOrdeBuyLevel:{C_UPDATE_LEVEL_VIEW:e.updateLevelView}},e.handels={WarTokenModelResp:e.warTokenModelResp,WarTokenOpenScoreBoxResp:e.warTokenOpenScoreBoxResp,WarTokenFinishTaskResp:e.warTokenFinishTaskResp,WarTokenLevelAwardResp:e.warTokenLevelAwardResp,WarTokenTaskPushMsg:e.warTokenTaskNotify}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.WarTokenModelReq()},notify:function(e,t,a){switch(e){case this.Evts.V_GET_LEVEL_REWARD:this.getLevelReward(t);break;case this.Evts.V_GET_BOX_REWARD:this.getScoreBoxReward(t);break;case this.Evts.V_GET_TASK_REWARD:this.getTaskReward(t,a);break;case this.Evts.C_ON_OPEN_VIEW:this.checkAllRedPoint()}},resetDaily:function(){this.moduleData.getIsOpen()?(this.moduleData.resetData(),this.moduleData.checkIsEnd()&&(game.module.hide(game.ME.WarOrderMain),this.sender.WarTokenModelReq()),this.checkAllRedPoint(),this.send(this.Evts.C_ON_DAILY_RESET)):game.module.hide(game.ME.WarOrderMain)},warTokenModelResp:function(e){var t=e.readProtobuf(game.pb.WarTokenModelData);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setData(t),this.checkAllRedPointOnInit(t.redPoint))},warTokenOpenScoreBoxResp:function(e){var t=e.readProtobuf(game.pb.WarTokenOpenScoreBoxResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateScoreBox(t.score),this.checkDailySpotAlert(),this.send(this.Evts.C_REFRESH_SCORE_BOX),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))},warTokenFinishTaskResp:function(e){var t=e.readProtobuf(game.pb.WarTokenFinishTaskResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.updateCompleteTask(t);var a=t.taskType;this.send(this.Evts.C_TASK_PROGRESS_FRESH,a),this.checkTaskRedPoint(a),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}},warTokenLevelAwardResp:function(e){var t=e.readProtobuf(game.pb.WarTokenLevelAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateLevelInfo(t),this.checkLevelSpotAlert(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))},warTokenTaskNotify:function(e){var t=e.readProtobuf(game.pb.WarTokenTaskNotify);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.updateTaskProgress(t);var a=t.taskType;this.send(this.Evts.C_TASK_PROGRESS_FRESH,a),this.checkTaskRedPoint(a)}},onRechargeSuccess:function(){if(this.moduleData.isExtraSupreme){var e=this.moduleData.lv,t=this.moduleData.getMiscData("supremeAddLv");this.moduleData.updateLevel(e+t)}this.updateLevelView(),game.module.hide(game.ME.WarOrderSupreme)},getLevelReward:function(e){this.sender.WarTokenLevelAwardReq(e)},getScoreBoxReward:function(e){this.sender.WarTokenOpenScoreBoxReq(e)},getTaskReward:function(e,t){this.sender.WarTokenFinishTaskReq(e,t)},checkAllRedPointOnInit:function(e){this.weekSpotAlert.alert=e||this.moduleData.chekScoreBoxRedPoint()},checkAllRedPoint:function(){this.weekSpotAlert.alert=!1;var e=game.WarOrderTaskType;this.checkLevelSpotAlert(),this.checkTaskRedPoint(e.DAILY),this.checkTaskRedPoint(e.WEEKLY),this.checkTaskRedPoint(e.QUARTER)},checkLevelSpotAlert:function(){this.levelSpotAlert.alert=this.moduleData.checkLevelRedPoint()},checkTaskRedPoint:function(e){var t=game.WarOrderTaskType;switch(e){case t.DAILY:this.checkDailySpotAlert();break;case t.WEEKLY:this.checkWeekSpotAlert();break;case t.QUARTER:this.checkQuarterSpotAlert()}},checkDailySpotAlert:function(){this.dailySpotAlert.alert=this.moduleData.checkDailyTaskAllRedPoint()},checkWeekSpotAlert:function(){this.weekSpotAlert.alert=this.moduleData.checkTaskRedPoint(game.WarOrderTaskType.WEEKLY)},checkQuarterSpotAlert:function(){this.quarterSpotAlert.alert=this.moduleData.checkTaskRedPoint(game.WarOrderTaskType.QUARTER)},warOrderBtn:function(){this.selectToggle(0)},dailyTaskBtn:function(){this.selectToggle(1)},weeklyTaskBtn:function(){this.selectToggle(2)},quarterTaskBtn:function(){this.selectToggle(3)},selectToggle:function(e){this.send(this.Evts.C_TOGGLE_CHANGE,e)},closeSupremeBtn:function(){game.module.hide(game.ME.WarOrderSupreme)},updateLevelView:function(){this.send(this.Evts.C_UPDATE_LEVEL_VIEW),this.checkLevelSpotAlert()},buyLevelBtn:function(){this.moduleData.lv>=this.moduleData.getMiscData("warTokenMaxLevel")?game.notice.show(51857):game.module.show(game.ME.WarOrdeBuyLevel)},advancedBtn:function(){this.moduleData.supreme?game.notice.show(51858):game.module.show(game.ME.WarOrderSupreme)},ordinaryBtn:function(){this.send(this.Evts.C_UPDATE_UNLOCK_BTN_STATE,1)},superBtn:function(){this.send(this.Evts.C_UPDATE_UNLOCK_BTN_STATE,2)},unLockBtn:function(){var e=this.moduleData.isExtraSupreme?9002:9001;this.dpt(this.Evts.C_RECHARGE,e)}}),t=[game.ME.WarOrder,game.ME.WarOrderDailyTask,game.ME.WarOrderWeeklyTask,game.ME.WarOrderQuarterTask,game.ME.WarOrderSupreme],a=game.Sender.extends({ipc:function(){this.msg={WarTokenModelReq:null,WarTokenOpenScoreBoxReq:this.warTokenOpenScoreBoxReq,WarTokenFinishTaskReq:this.warTokenFinishTaskReq,WarTokenLevelAwardReq:this.warTokenLevelAwardReq}},warTokenOpenScoreBoxReq:function(e){var t=game.pb.WarTokenOpenScoreBoxRequest;t.score=e,this.write(t)},warTokenFinishTaskReq:function(e,t){var a=game.pb.WarTokenFinishTaskRequest;a.taskType=e,a.taskId=t,this.write(a)},warTokenLevelAwardReq:function(e){var t=game.pb.WarTokenLevelAwardRequest;t.level=e,this.write(t)}});b8e.module.registerControl(game.ME.WarOrderMain,e,game.WarOrderEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.warOrderData},ipc:function(){this.handels={WarTokenBuyLevelResp:this.warTokenBuyLevelResp}},warTokenBuyLevelResp:function(e){var t=e.readProtobuf(game.pb.WarTokenBuyLevelResponse);0<t.code?game.notice.noticeError(t.code):(game.notice.show(51868,t.level-this.moduleData.lv),this.moduleData.updateLevel(t.level),this.dpt(this.Evts.C_UPDATE_LEVEL_VIEW),game.module.hide(game.ME.WarOrdeBuyLevel))},lessTenBtn:function(){this.send(this.Evts.C_BUY_LEVEL_ADD,-10)},lessBtn:function(){this.send(this.Evts.C_BUY_LEVEL_ADD,-1)},addBtn:function(){this.send(this.Evts.C_BUY_LEVEL_ADD,1)},addTenBtn:function(){this.send(this.Evts.C_BUY_LEVEL_ADD,10)},buyBtn:function(){this.moduleData.getCanBuyLvMax()<1?game.notice.show(9434):this.sender.WarTokenBuyLevelReq(this.moduleData.selectAddNum)}}),t=game.Sender.extends({ipc:function(){this.msg={WarTokenBuyLevelReq:this.warTokenBuyLevelReq}},warTokenBuyLevelReq:function(e){var t=game.pb.WarTokenBuyLevelRequest;t.level=e,this.write(t)}});b8e.module.registerControl(game.ME.WarOrdeBuyLevel,e,game.WarOrderEvts,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(1388)},init:function(){var e=this,t=e.skin;e.moduleData=game.warOrderData,e.progress=new game.Progress(470,28,-30,game.proGressType.Foster,!1),e.progress.addToParent(t.proNode),e._boxList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._boxList.itemRender=game.WarOrderRewBoxItem,e._boxList.bindEnum=game.ME.WarOrderMain,e._boxList.layout.spacingX=30,e._boxList.addToParent(t.list),e._taskList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._taskList.itemRender=game.WarOrderDailyTaskItem,e._taskList.bindEnum=game.ME.WarOrderMain,e._taskList.layout.paddingLeft=10,e._taskList.layout.paddingTop=6,e._taskList.layout.spacingY=6,e._taskList.addToParent(t.rewList)},notify:function(e,t){switch(e){case this.Evts.C_TASK_PROGRESS_FRESH:t==game.WarOrderTaskType.DAILY&&(this.updateTaskList(),this.updateView());break;case this.Evts.C_REFRESH_SCORE_BOX:this.updateBoxList();break;case this.Evts.C_ON_DAILY_RESET:this.updateTaskList(),this.updateView()}},onShow:function(){this._taskList.scrollToTop(),this.updateView(),this.updateBoxList(),this.updateTaskList()},updateView:function(){var e=this.skin,t=this.moduleData.getMiscData("boxMaxScore"),a=this.moduleData.score>t?t:this.moduleData.score;e.scoreLab.string=this.moduleData.score,this.progress.updatePro(a,t)},updateBoxList:function(){var e=this.moduleData.getScoreBoxInfos();e&&this._boxList.setData(e)},updateTaskList:function(){var e=this.moduleData.getTaskInfosByType(game.WarOrderTaskType.DAILY);e&&this._taskList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.WarOrderDailyTask,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1390),this.spotAlerts={WAR_ORDER_LEVEL:this.levelAlert,WAR_ORDER_DAILY:this.dailyAlert,WAR_ORDER_WEEK:this.weeklyAlert,WAR_ORDER_QUARTER:this.quarterAlert},this.toggles={toggle_btn_1:game.ME.WarOrder,toggle_btn_2:game.ME.WarOrderDailyTask,toggle_btn_3:game.ME.WarOrderWeeklyTask,toggle_btn_4:game.ME.WarOrderQuarterTask}},levelAlert:function(e){this.skin.red_spot_1.active=e.alert},dailyAlert:function(e){this.skin.red_spot_2.active=e.alert},weeklyAlert:function(e){this.skin.red_spot_3.active=e.alert},quarterAlert:function(e){this.skin.red_spot_4.active=e.alert},notify:function(e,t){switch(e){case this.Evts.C_TOGGLE_CHANGE:this.toggleTrigger(t)}},onShow:function(){this.toggleTrigger(0),this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3)),game.warOrderData.isFirstOpenUI&&(this.send(this.Evts.C_ON_OPEN_VIEW),game.warOrderData.isFirstOpenUI=!1)},onHide:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},toggleTrigger:function(e){if(this.toggleSelect(e)){var t=game.ResCfg.getUrl(10104,e+1);this.skin.banner.loadTexture(t)}},updateActTime:function(){var e=game.warOrderData.getCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.timeLab.string=game.Lang.get(3303,t)):(b8e.Timer.remove(this,this.updateActTime),this.timer=null)}});b8e.module.registerView(game.ME.WarOrderMain,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1391)},init:function(){var e=this.skin;this._taskList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._taskList.itemRender=game.WarOrderDailyTaskItem,this._taskList.bindEnum=game.ME.WarOrderMain,this._taskList.layout.paddingLeft=10,this._taskList.layout.paddingTop=6,this._taskList.layout.spacingY=6,this._taskList.addToParent(e.rewList)},notify:function(e,t){switch(e){case this.Evts.C_TASK_PROGRESS_FRESH:t==game.WarOrderTaskType.QUARTER&&this.updateTaskList()}},onShow:function(){this._taskList.scrollToTop(),this.updateTaskList()},updateTaskList:function(){var e=game.warOrderData.getTaskInfosByType(game.WarOrderTaskType.QUARTER);e&&this._taskList.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.WarOrderQuarterTask,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1393)},init:function(){var e=this,t=e.skin;t.bg.loadTexture(game.ResCfg.getUrl(10105)),e.moduleData=game.warOrderData,e._list1=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._list1.itemRender=game.PrizeListItem,e._list1.addToParent(t.list_1),e._list1.layout.spacingX=22,e._list2=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._list2.itemRender=game.PrizeListItem,e._list2.addToParent(t.list_2),e._list2.layout.spacingX=22},notify:function(e,t){switch(e){case this.Evts.C_UPDATE_UNLOCK_BTN_STATE:this.updateCheckBtnState(t)}},onShow:function(){this.updateCheckBtnState(2)},updateView:function(){var e=this.skin;this.moduleData.isExtraSupreme?(e.rewNode_2.y=-500,e.rewNode_1.active=!0,this.updateRewList()):0==this.moduleData.lv?(e.rewNode_2.y=-310,e.rewNode_1.active=!1):(e.rewNode_2.y=-500,e.rewNode_1.active=!0,this.updateRewList()),this.updateExtraRewList()},updateRewList:function(){var e=this.moduleData.lv;if(this.moduleData.isExtraSupreme){var t=this.moduleData.getMiscData("supremeAddLv"),a=this.moduleData.getMiscData("warTokenMaxLevel");e=this.moduleData.lv+t>a?a:t}else e=this.moduleData.lv;var i=this.moduleData.getCurrSupremeRewInfos(0,e);this._list1.setData(i)},updateExtraRewList:function(){var e=this.moduleData.getMiscData("warTokenMaxLevel"),t=this.moduleData.getAllSupremeRewInfos(0,e);this._list2.setData(t)},updateCheckBtnState:function(e){var t=this.skin;this.moduleData.isExtraSupreme=2==e,t.select_1.active=1==e,t.select_2.active=2==e;var a=1==e?198:328;t.costImg.loadTexture(game.ResCfg.getUrl(10107,a)),this.updateView()}});b8e.module.registerView(game.ME.WarOrderSupreme,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1394)},init:function(){var e=this,t=e.skin;e.moduleData=game.warOrderData,e.progress=new game.Progress(530,28),e.progress.setLight(),e.progress.addToParent(t.proNode),e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._list.itemRender=game.WarOrderItem,e._list.bindEnum=game.ME.WarOrderMain,e._list.layout.paddingLeft=10,e._list.layout.paddingTop=6,e._list.layout.spacingY=6,e._list.addToParent(t.rewList)},notify:function(e){switch(e){case this.Evts.C_UPDATE_LEVEL_VIEW:this.updateView()}},onShow:function(){this.updateView(),this.moveToCanGetRewItem()},updateView:function(){var e=this.skin,t=this.moduleData.lv,a=void 0;if(this.moduleData.getMiscData("warTokenMaxLevel")<=t){var i=game.WarTokenUpgradeCfg.getData(t-1);this.progress.updatePro(i.exp,i.exp)}else a=game.WarTokenUpgradeCfg.getData(t),this.progress.updatePro(this.moduleData.exp,a.exp);e.lvLab.string=game.Lang.get(51864,this.moduleData.lv);var n=this.moduleData.supreme;e.lock.active=!n;var s=game.ResCfg.getUrl(10114,n?2:1);e.orderIcon.loadTexture(s),this.updateList()},updateList:function(){var e=this.moduleData.getLevelInfos();e&&this._list.setData(e)},moveToCanGetRewItem:function(){var e=124*(this.moduleData.getNextComplete()-1);this._list.scrollToPos({x:0,y:e})},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.WarOrder,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1395)},init:function(){var e=this.skin;this.moduleData=game.warOrderData,this._taskList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._taskList.itemRender=game.WarOrderDailyTaskItem,this._taskList.bindEnum=game.ME.WarOrderMain,this._taskList.layout.paddingLeft=10,this._taskList.layout.paddingTop=6,this._taskList.layout.spacingY=6,this._taskList.addToParent(e.rewList)},notify:function(e,t){switch(e){case this.Evts.C_TASK_PROGRESS_FRESH:t==game.WarOrderTaskType.WEEKLY&&this.updateView();break;case this.Evts.C_ON_DAILY_RESET:this.updateView()}},onShow:function(){this._taskList.scrollToTop(),this.updateView(),this.updateActTime(),this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3))},onHide:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateView:function(){var e=this.moduleData.getWeekTaskNotCompNum();this.skin.descLab.string=game.Lang.get(51865,e),this.updateTaskList()},updateTaskList:function(){var e=this.moduleData.getTaskInfosByType(game.WarOrderTaskType.WEEKLY);e&&this._taskList.setData(e)},updateActTime:function(){var e=game.warOrderData.getWeekCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.timeLab.string=game.Lang.get(3303,t)):(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.WarOrderWeeklyTask,e)}(),function(){var e=game.View.extends({_showModel:!0,num:0,currNum:0,ctor:function(){this._super(1386)},init:function(){var e=this,t=e.skin;e.moduleData=game.warOrderData,e.amountIcon=game.GridUtil.createAmountIcon(39),e.amountIcon.addToParent(e.skin.amountNode),game.GridUtil.setAmountIcon(e.amountIcon,game.AmountType.YUAN_BAO),e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e._list.itemRender=game.PrizeListItem,e._list.addToParent(t.list),e._list.layout.spacingX=30},notify:function(e,t){switch(e){case this.Evts.C_BUY_LEVEL_ADD:this.onAddCount(t)}},onShow:function(){this.num=0,this.currNum=0,this.onAddCount(1)},onHide:function(){this.moduleData.selectAddNum=0},updateView:function(){var e=this.skin,t=this.moduleData.getUpLvRewardInfos(this.num);t&&(this._list.setData(t),e.count.string=this.num,e.descLab.string=game.Lang.get(51859,this.num,t.length),e.amountNum.string="X"+this.num*this.moduleData.getMiscData("warTokenBuyLvCost"))},onAddCount:function(e){var t=this;t.currNum=t.num,t.num+=e,t.num<1&&(t.num=1);var a=t.moduleData.getCanBuyLvMax();t.num>a&&(1<t.num&&1==e&&game.notice.show(9434),t.num=0==a?1:a),t.addNum=t.num-t.currNum,t.moduleData.selectAddNum=t.num,0<=Math.abs(t.addNum)&&t.updateView()}});b8e.module.registerView(game.ME.WarOrdeBuyLevel,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1387),this.setSize(602,178)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=40},setData:function(e){var t=this.skin,a=e.cfg;t.titleLab.string=a.desc;var i=game.Color,n=e.canGetRew||e.flag?i.GREEN:i.RED;t.progressLab.color=n,t.progressLab.string=game.Lang.get(1621,e.process,a.condition),t.getRewBtn.active=t.progressLab.active=!e.flag,t.isGet.active=e.flag,t.redPoint.active=e.canGetRew,t.btn_lbl.string=e.canGetRew?game.Lang.get(51860):game.Lang.get(51861),this.updateRewList()},updateRewList:function(){var e=this.data.getPrizeList();e&&this._list.setData(e)},getRewBtn:function(){var e=this.data.cfg;if(this.data.canGetRew)this.send(game.WarOrderEvts.V_GET_TASK_REWARD,this.data.type,e.id);else{var t=e.moduleId;if(0==t&&game.module.hide(game.ME.WarOrderMain),t==game.ME.Guild&&!game.guildData.hasGuild())return void game.notice.show(9037);game.module.showToggle(t,e.toggleId)}}}),b8e.RC("$$game","$$WarOrderDailyTaskItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1392),this.setSize(80,100)},setData:function(e){var t=this.skin,a=e.cfg;t.scoreLab.string=a.score,t.redPoint.active=e.canGet,t.isGet.active=e.isGet;var i=game.ResCfg.getUrl(10109,a.score);t.rewBox.loadTexture(i)},clickBtn:function(){var e=this.data.cfg;this.data.canGet?this.send(game.WarOrderEvts.V_GET_BOX_REWARD,e.score):(game.prizeTipsData.setup(e.award),game.module.show(game.ME.PrizeTips))}}),b8e.RC("$$game","$$WarOrderRewBoxItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1389),this.setSize(602,118)},init:function(){this.eliteIcons=[],this.supremeIcons=[]},setData:function(e){var t=this.skin;t.lvLab.string=e.cfg.lv,game.warOrderData.lv<e.cfg.lv?(game.ShaderUtil.setGray(t.getLvRewBtn,!0),t.btn_lbl.string=game.Lang.get(51862)):(game.ShaderUtil.setGray(t.getLvRewBtn,!1),e.eliteFlag&&e.supremeFlag?(t.isGet.active=!0,t.getLvRewBtn.active=!1,t.redPoint.active=!1):!e.eliteFlag||e.supremeFlag||game.warOrderData.supreme?(t.btn_lbl.string=game.Lang.get(51860),t.redPoint.active=!0):(t.btn_lbl.string=game.Lang.get(51863),t.redPoint.active=!1)),this.updateReward()},updateReward:function(){for(var e=this,t=e.data.getElitePrizeList(),a=t.length,i=void 0,n=void 0,s=0;s<a;s++)e.eliteIcons[s]?n=e.eliteIcons[s]:((n=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_84)).addToParent(e.getComponent("eliteRewNode_"+(s+1))),e.eliteIcons.push(n)),i=t[s],game.GridUtil.setPrizeIcon(n,i),game.ShaderUtil.setGray(n,e.data.eliteFlag);var r=e.data.getSupremePrizeList();a=r.length;for(var o=0;o<a;o++)e.supremeIcons[o]?n=e.supremeIcons[o]:((n=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_84)).addToParent(e.getComponent("superRewNode_"+(o+1))),e.supremeIcons.push(n)),i=r[o],game.GridUtil.setPrizeIcon(n,i),e.getComponent("lock_"+(o+1)).active=!game.warOrderData.supreme,game.ShaderUtil.setGray(n,e.data.supremeFlag)},getLvRewBtn:function(){var e=this.data.cfg;game.warOrderData.lv<e.lv?game.notice.show(51862):this.data.eliteFlag?this.data.supremeFlag||(game.warOrderData.supreme?this.send(game.WarOrderEvts.V_GET_LEVEL_REWARD,e.lv):game.module.show(game.ME.WarOrderSupreme)):this.send(game.WarOrderEvts.V_GET_LEVEL_REWARD,e.lv)}}),b8e.RC("$$game","$$WarOrderItem",e)}(),function(){var e;e=b8e.Enum({None:0,C_SELECT_CHANGE:-1,C2V_UPDATE_SELECT:-1,C2V_UPDATE_VIEW:-1}),b8e.RC("$$game","$$ContinuousConsumeEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.CONTINUOUS_CONSUME,game.SAE.OPEN_SERVER_ALERT),this.moduleData=game.continuousConsumeData,this.noticeAlert={lang:51818,btn:game.Lang.get(9059),okcb:this.signIn,thisArg:this,args:[],langArgs:[],showtips:!1,defaultSelect:!0,align:b8e.HorizontalAlign.CENTER}},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.setConsumeData},MainRole:{C_RESET_DAILY:this.resetDaily},Back:{C2C_REMOVE_AMOUNT:this.removeAmount}},this.handels={KeepCostReceiveResp:this.keepCostReceiveResp,KeepCostReplenishResp:this.keepCostReplenishResp}},setConsumeData:function(e){var t=e.data;this.moduleData.setData(t),this.checkOpen(),this.checkAlert()},checkOpen:function(){var e=this.moduleData.checkActIsOpen(),t={openServerType:game.OpenServerType.CONTINUOUS_CONSUME,isActive:e,sae:game.SAE.CONTINUOUS_CONSUME};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,t)},resetDaily:function(){game.moduleOpen.checkOpen(game.ME.ContinuousConsume)&&(this.checkOpen(),this.moduleData.resetData(),this.checkAlert(),game.module.hide(game.ME.OpenServer))},signIn:function(e){if(game.amount.get(game.AmountType.YUAN_BAO)<e)game.notice.show(116);else{var t=this.moduleData.getCurInfo();this.sender.KeepCostReplenishReq(t.id)}},updateAmount:function(e){var t=!!e.data;this.moduleData.checkActIsOpen()&&this.moduleData.updatePayCount(t)&&(this.checkAlert(),this.send(this.Evts.C2V_UPDATE_SELECT))},removeAmount:function(e){if(e&&e.data){this.moduleData.checkActIsOpen()&&(this.moduleData.setCurCont(e.data),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_SELECT))}},notify:function(e,t){switch(e){case this.Evts.C_SELECT_CHANGE:this.updateSelect(t)}},checkAlert:function(){var e=this.moduleData.getList();if(e){for(var t=void 0,a=e.length,i=!1,n=!1,s=0;s<a;s++)(t=e[s]).canGetPrize&&(i=!0),t.canGetFinal&&(n=!0);this.spotAlert.alert=i||n}},updateSelect:function(e){this.moduleData.setSelect(e),this.send(this.Evts.C2V_UPDATE_SELECT)},signInBtn:function(){var e=this.moduleData.getCurInfo().cost;this.noticeAlert.args[0]=e,this.noticeAlert.langArgs[0]=e,game.alert.show(this.noticeAlert)},getPrizeBtn:function(){var e=this.moduleData.getCurInfo();this.sender.KeepCostReceiveReq(e.id,!1)},finalBtn:function(){var e=this.moduleData.finalAwardId,t=this.moduleData.getInfoById(e);this.sender.KeepCostReceiveReq(t.id,!0)},keepCostReceiveResp:function(e){var t=e.readProtobuf(game.pb.KeepCostReceiveResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setIsGetPrize(t.id,t.isFinal),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))},keepCostReplenishResp:function(e){var t=e.readProtobuf(game.pb.KeepCostReplenishResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setkeepCostReplenish(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_SELECT))}}),t=game.Sender.extends({ipc:function(){this.msg={KeepCostReceiveReq:this.keepCostReceiveReq,KeepCostReplenishReq:this.keepCostReplenishReq}},keepCostReceiveReq:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=game.pb.KeepCostReceiveRequest;i.id=e,i.isFinal=a,this.write(i)},keepCostReplenishReq:function(e){var t=game.pb.KeepCostReplenishRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.ContinuousConsume,e,game.ContinuousConsumeEvts,t)}(),function(){var e;e=b8e.Object.extends({day:0,finalDay:0,cost:0,award:null,finalAward:null,id:0,canGetFinal:!1,isGetFinal:!1,canGetPrize:!1,isGetPrize:!1,payCount:0,alert:!1,select:!1,isSignin:!1,openServerDay:0,ctor:function(){},initData:function(e){this.finalDay=e.finalDay,this.cost=e.cost,this.award=e.award,this.id=e.id,this.day=e.day,this.openServerDay=e.openServerDay,e.finalAward&&(this.finalAward=e.finalAward)},setData:function(e){this.payCount=e.cost,this.payCount>=this.cost&&!this.isGetPrize?(this.canGetPrize=!0,this.isSignin=!1):this.canGetPrize=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ContinuousConsumeInfo",e)}(),function(){var e=void 0;e=b8e.Object.extends({endTime:0,selectId:0,payCount:0,lastCount:0,group:0,finalAwardId:0,endDay:0,ctor:function(){this.groupMp=b8e.HashMap.get(),this.finalAwardsArr=[]},setData:function(e){var t=this;t.payCount=0,t.lastCount=0,t.finalAwardsArr=[],t.group=t.getCurCfg(),t.group&&(t.initData(t.group),t.setFinalAwards(e.keepCostFinal),t.setAwards(e.keepCostAwards),t.setKeepCost(e.keepCostRecords))},getCurCfg:function(){var e=game.KeepCostCfg.getDatas();if(!e||e.length<1)return null;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.checkIsOpen(i))return i.group}return null},resetData:function(){var e=this.getCurCfg();e&&(this.clearData(),e!=this.group?(this.group=e,this.initData(e),this.finalAwardsArr=[],this.setFinalAwards(this.finalAwardsArr)):this.setSignin())},setSignin:function(){var e=game.miscData.openServerDay,t=game.KeepCostCfg.getDataByDay(e-1);if(t){var a=this.getInfoById(t.id);a.isGetPrize||a.canGetPrize||(a.isSignin=!0)}},initData:function(e){var t=game.KeepCostCfg.getGroupList(e);if(t){var a=game.miscData.openServerDay;this.groupMp.clear();for(var i=t.length,n=void 0,s=void 0,r=0;r<i;r++)s=t[r],(n=new game.ContinuousConsumeInfo).initData(s),s.openServerDay<a&&(n.isSignin=!0),this.groupMp.set(s.id,n),s.id==t[0].id&&(this.selectId=s.id,n.select=!0)}},setAwards:function(e){if(e){for(var t=e.length,a=void 0,i=void 0,n=0,s=0;s<t;s++)i=e[s],(a=this.getInfoById(i)).isGetPrize=!0,a.canGetPrize=!1,a.isSignin=!1,n++;var r=this.getInfoById(this.finalAwardId);r.canGetFinal=n>=r.day&&!r.isGetFinal}},getFinalAwardsAlert:function(){var e=this.getList();if(e){for(var t=e.length,a=0,i=0;i<t;i++)e[i].isGetPrize&&a++;return a}},setFinalAwards:function(e){var t=game.miscData.openServerDay,a=game.KeepCostCfg.getDataByDay(t);if(a)if(e.length<1)this.finalAwardId=a.finalDay[0];else{for(var i=a.finalDay.length,n=0,s=0;s<i;s++){var r=a.finalDay[s];if(e[s]==r){var o=this.getInfoById(r);o.isGetFinal=!0,o.canGetFinal=!1,n++}}this.finalAwardId=a.finalDay[n]?a.finalDay[n]:a.finalDay[n-1]}},setSelect:function(e){var t=this.getList();if(t){var a=t.length,i=void 0;this.selectId=e;for(var n=0;n<a;n++)(i=t[n]).select=i.id==e}},setKeepCost:function(e){if(e)for(var t=e.length,a=void 0,i=0;i<t;i++)a=e[i],this.getInfoById(a.id).setData(a)},setIsGetPrize:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=this.getInfoById(e);a||(i.isGetPrize=!0),i.canGetPrize=!1,i.isGetFinal=a,i.isGetFinal&&(this.finalAwardsArr.push(e),this.setFinalAwards(this.finalAwardsArr));var n=this.getInfoById(this.finalAwardId);n.canGetFinal=this.getFinalAwardsAlert()>=n.day&&!n.isGetFinal},setkeepCostReplenish:function(e){var t=this.getInfoById(e);t.payCount=t.cost,t.canGetPrize=!0,t.isGetPrize=!1,t.isSignin=!1},updatePayCount:function(e){var t=0<arguments.length&&void 0!==e&&e,a=game.amount.get(game.AmountType.YUAN_BAO),i=!1;if(0!=this.lastCount&&!t){if(this.lastCount>a){var n=this.lastCount-a;i=!0,this.setCurCont(n)}return this.lastCount=a,i}this.lastCount=a},setCurCont:function(e){var t=game.miscData.openServerDay,a=game.KeepCostCfg.getDataByDay(t);if(a){var i=this.getInfoById(a.id);i.payCount+=e,i.canGetPrize=i.payCount>=a.cost&&!i.isGetPrize}},clearData:function(){this.payCount=0,this.lastCount=0,this.endDay=0},checkIsOpen:function(e){var t=game.miscData.openServerDay;return t>=e.serverStart&&t<e.serverEnd&&(0==this.endDay&&(this.endDay=e.serverEnd),!0)},getCountDown:function(){var e=this.endDay,t=game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,e-t)-game.SysTime.curTime},getInfoById:function(e){return this.groupMp.get(e)},getCurInfo:function(){return this.groupMp.get(this.selectId)},getList:function(){return this.groupMp.values()},checkActIsOpen:function(){return!!this.getCurCfg()}}),game.continuousConsumeData=game.continuousConsumeData||new e,b8e.RC("$$game","$$ContinuousConsumeData",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1384)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.layout.spacingX=2,t.itemRender=game.ContinuousConsumeItme,t.bindEnum=game.ME.ContinuousConsume,t.addToParent(e.list);var a=this.itmeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.PrizeListItem,a.layout.spacingX=20,a.layout.spacingY=20,a.addToParent(e.itmeList);var i=this.finalAwardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);i.itemRender=game.PrizeListItem,i.layout.spacingX=25,i.layout.spacingY=25,i.addToParent(e.finalAward_list),this.costIcon=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),this.costIcon.addToParent(this.skin.costIcon),this.moduleData=game.continuousConsumeData},onShow:function(){this.updateList(),this.updateItmeList(),this.updateFinalAwardList();var e=game.amount.getCfgByType(game.AmountType.YUAN_BAO);this.costIcon.setItemId(e.id),this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3))},updateFinalAwardList:function(){var e=this.skin,t=this.moduleData.finalAwardId,a=this.moduleData.getInfoById(t),i=game.CfgUtil.getPrizeListInfo(a.finalAward,game.IconLayoutEnum.SHOW_ALL,game.IconSizeEnum.GRID_SIZE_105);this.finalAwardList.setData(i.items),e.des.string=game.Lang.get(51817,a.cost,a.day);var n=this.moduleData.getFinalAwardsAlert();e.pro_label.string=n+"/"+a.day,e.pro.width=Math.min(316,n/a.day*316),e.finalBtn.active=a.canGetFinal,e.isFinalBtn.active=!a.canGetFinal,e.isFinalBtnLable.string=a.isGetFinal?game.Lang.get(1353):game.Lang.get(9198)},updateItmeList:function(){var e=this.skin,t=this.moduleData.getCurInfo(),a=game.CfgUtil.getPrizeListInfo(t.award,game.IconLayoutEnum.SHOW_ALL,game.IconSizeEnum.GRID_SIZE_105);this.itmeList.setData(a.items),e.consume.string=t.payCount+"/"+t.cost,e.getPrizeBtn.active=t.canGetPrize,e.isGetBtn.active=!t.canGetPrize&&!t.isSignin,e.btnGetPrizeLable.string=t.isGetPrize?game.Lang.get(1353):game.Lang.get(9198),e.signInBtn.active=t.isSignin},updateList:function(){var e=this.moduleData.getList();this.list.setData(e)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_SELECT:this.updateList(),this.updateItmeList();break;case this.Evts.C2V_UPDATE_VIEW:this.updateFinalAwardList(),this.updateList(),this.updateItmeList()}},updateActTime:function(){var e=this.moduleData.getCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.time.string=game.Lang.get(51819,t)):(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ContinuousConsume,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1383),this.setSize(80,40)},setData:function(){var e=this.skin;e.day.string=game.Lang.get(9556,this.data.day),e.signIn.active=this.data.isSignin,e.bg2.active=this.data.select,e.redPoint.active=this.data.canGetPrize},btn:function(){this.send(game.ContinuousConsumeEvts.C_SELECT_CHANGE,this.data.id)}}),b8e.RC("$$game","$$ContinuousConsumeItme",e)}(),function(){var e;e=b8e.Enum({None:0,V_ONSHOW:-1,UPDATE_LOGS:-1,UPDATE_DATA:-1,C2V_SET_IGNORE_ANI:-1,UPDATE_ITEM:-1,PLAY_ANIM:-1,UPDATE_DATA_NO_GOLD:-1,V2C_ON_ANI_END:-1}),b8e.RC("$$game","$$MoneyCatEvts",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:0,itemId:0,itemNum:0,setData:function(e,t,a){this.name=e,this.itemId=t,this.itemNum=a}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$moneyCatLogInfo",t)}(),function(){var e=b8e.Object.extends({isIgnoreAni:!1,preGetDiamond:0,leftNum:0,activityId:0,vipTarget:0,needCostMoneyTarget:0,targetAddNum:0,rechargeIdx:0,usedNum:0,logMaxNum:4,rewardResult:null,cacheLog:null,ctor:function(){this.logArr=[],this.obj1={id:0,num:0},this.rewardResult=[]},resetDaily:function(){if(game.moduleOpen.checkOpen(game.ME.MoneyCat)){for(var e=game.MoneyCatCfg.getDatas(),t=e.length,a=game.miscData.openServerDay,i=null,n=0;n<t;n++){var s=e[n];if(!(s.serverStart>a||a>=s.serverEnd)){i=s;break}}if(i){if(i.id!=this.activityId){var r={};r.fortuneCatId=i.id,r.fCRechargeIdx=0,r.fCAlreadyNum=0,1==i.activityType?(r.fortuneCatNum=i.num,r.fortuneCatMoney=0):i.activityType,this.syncModelDatas(r)}}else this.activityId=0}},initMisc:function(){var e=game.MoneyCatMiscCfg.getData("logMaxNum");e&&(this.logMaxNum=+e.value)},getTitleImgUrl:function(){if(!this.activityId)return"";var e=game.MoneyCatCfg.getData(this.activityId);if(!e)return"";var t=e.activityType;return game.ResCfg.getUrl(10103,t)},getCurMoneyCatConfig:function(){if(this.activityId)return game.MoneyCatCfg.getData(this.activityId)},checkOpen:function(){if(!game.moduleOpen.checkOpen(game.ME.MoneyCat))return!1;var e=this.getCurMoneyCatConfig();if(!e)return!1;var t=game.SysTime.curTime;if(e.startTime){var a=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd hh:mm:ss").getTime();a=1e3*(a/1e3>>0);var i=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime();if(i=1e3*(i/1e3>>0),t<a||i<=t)return!1;var n=game.TimeUtil.getOpenDayByStr(e.startTime);return n>=e.serverStart&&n<e.serverEnd}var s=game.miscData.openServerDay;return!(e.serverStart>s||s>=e.serverEnd)},getCountDown:function(){if(!game.moduleOpen.checkOpen(game.ME.MoneyCat))return 0;var e=this.getCurMoneyCatConfig();if(!e)return 0;var t=game.SysTime.curTime;return(e.endTime?b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime():b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(e.serverEnd-game.miscData.openServerDay)*b8e.TimeUtil.DAY_MICRO_SECONDS)-t},onVIPChange:function(){if(this.checkOpen()){var e=game.MoneyCatCfg.getData(this.activityId);if(e&&2==e.activityType){var t=game.mainRoleData.vipLevel,a=game.VipCfg.getData(t);if(a){var i=a.fCatNum-this.usedNum;this.updateNum(this.usedNum,i),this.updateMoneyCatVipInfo()}}}},syncModelDatas:function(e){if(game.moduleOpen.checkOpen(game.ME.MoneyCat)){this.initMisc(),this.activityId=e.fortuneCatId,this.rechargeIdx=e.fCRechargeIdx;var t=0,a=game.MoneyCatCfg.getData(this.activityId);if(a){var i=!1;if(1==a.activityType){t=e.fortuneCatNum;var n=e.fortuneCatMoney;this.updateNeedRechargeInfo(n)}else{var s=game.mainRoleData.vipLevel,r=game.VipCfg.getData(s);if(!r)return;t=r.fCatNum-e.fCAlreadyNum,i=!0}this.updateNum(e.fCAlreadyNum,t),i&&this.updateMoneyCatVipInfo()}}},updateNeedRechargeInfo:function(e){var t=game.MoneyCatRechargeCfg.getData(this.activityId,this.rechargeIdx);t&&(this.needCostMoneyTarget=t.money-e,this.targetAddNum=t.num)},updateMoneyCatVipInfo:function(){var e=game.mainRoleData.vipLevel,t=game.VipCfg.getData(e);if(t){for(var a=game.VipCfg.maxVipLv,i=null,n=e+1;n<=a;n++){var s=game.VipCfg.getData(n);if(s&&0!=s.fCatNum){i=s;break}}if(!i)return this.vipTarget=0,void(this.targetAddNum=0);this.vipTarget=i.vipLv,this.targetAddNum=i.fCatNum-t.fCatNum}},getIsFinalVip:function(){return game.VipCfg.maxVipLv<=game.mainRoleData.vipLevel},updateNum:function(e,t){this.usedNum=e,this.leftNum=t},insertLog:function(e){if(e){var t=e.name,a=e.itemId,i=e.itemNum,n=null;this.logArr.length<this.logMaxNum?(n=game.moneyCatLogInfo.get()).setData(t,a,i):(n=this.logArr[this.logArr.length-1],this.logArr.length=this.logArr.length-1,n.setData(t,a,i)),this.logArr.splice(0,0,n)}},getLog:function(){return this.logArr},clearLogInfos:function(){this.logArr.forEach(function(e){e.release()}),this.logArr.length=0},overrideLogs:function(e){this.clearLogInfos();for(var t=0;t<e.length;t++){var a=e[t],i=a.name,n=a.itemId,s=a.itemNum,r=game.moneyCatLogInfo.get();r.setData(i,n,s),this.logArr.push(r)}},updateMoneyCatRechargeInfo:function(e){this.rechargeIdx=e.rechargeIdx,this.updateNum(this.usedNum,e.num);var t=e.money;this.updateNeedRechargeInfo(t)},onMoneyCatSuccess:function(e){this.activityId=e.id;var t=this.usedNum+1,a=this.leftNum-1;this.updateNum(t,a)},getCostGoldNum:function(){var e=this.getCurMoneyCatConfig();if(!e)return 0;var t=e.maxNum,a=this.usedNum<t?this.usedNum:t;this.obj1.id=this.activityId,this.obj1.num=a;var i=game.MoneyCatInputCfg.getData(this.obj1);return i?i.gold:0},checkAllAlert:function(){if(!this.checkOpen())return!1;if(this.leftNum<=0)return!1;var e=this.getCostGoldNum();return game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,e,!1)},getGetGoldRange:function(){var e=this.getCurMoneyCatConfig();if(!e)return 0;var t=e.maxNum,a=this.usedNum<t?this.usedNum:t;this.obj1.id=this.activityId,this.obj1.num=a;var i=game.MoneyCatInputCfg.getData(this.obj1);return i?i.clientGold:[]},onSortMaxNum:function(e,t){return t.num-e.num}});game.moneyCatData=game.moneyCatData||new e}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super("moneyCat/MoneyCatLogItem"),this.setSize(450,22)},setData:function(e){if(e){var t=e.itemId;if(t){var a=game.ItemInfoCfg.getData(t);a&&(this.skin.lbl.string=game.Lang.get(51700,e.name,a.name,e.itemNum))}}}})).poolCall=!0,b8e.RC("$$game","$$MoneyCatLogItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super("moneyCat/MoneyCatView"),this.spotAlerts={MONEY_CAT_ALERT:this.moneyCatAlert}},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.MoneyCatLogItem,e.layout.paddingLeft=0,e.layout.spacingY=5,e.addToParent(this.skin.logList),this.costIcon=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),this.costIcon.addToParent(this.skin.costIcon),this.moduleData=game.moneyCatData,this.leftTimer=null},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_SET_IGNORE_ANI:a.updateIgnoreAni();break;case a.Evts.UPDATE_LOGS:a.updateLog();break;case a.Evts.UPDATE_ITEM:a.updateCost();break;case a.Evts.PLAY_ANIM:a.playAni(t);break;case a.Evts.UPDATE_DATA:a.updateData();break;case a.Evts.UPDATE_DATA_NO_GOLD:a.updateData(!1),a.list.scrollToTop()}},moneyCatAlert:function(e){this.skin.red_spot_1.active=e.alert},onHide:function(){this.moduleData.preGetDiamond=0,this.leftTimer&&(b8e.Timer.remove(this,this.updateTime),this.leftTimer=null);for(var e=1;e<=6;e++){var t=this.getComponent("number_"+e);b8e.Tween.kill(t)}},onShow:function(){this.updateData(),0<this.moduleData.getCountDown()?this.leftTimer=b8e.Timer.add(this,this.updateTime,1e3):(this.skin.leftTimelbl.string="",this.leftTimer=null),this.send(this.Evts.V_ONSHOW)},updateData:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this,i=a.moduleData.getTitleImgUrl();a.skin.bg_title.setVisible(""!==i),""!==i&&(a.titleSprite||(a.titleSprite=b8e.Sprite.get(),a.titleSprite.addToParent(a.skin.bg_title),a.titleSprite.setAnchor(.5,0)),a.titleSprite.loadTexture(i)),t&&a.udpateGetNum(),a.updateGetTips(),a.updateLog(),a.updateLeftNum(),a.updateIgnoreAni(),a.updateCost()},updateCost:function(){var e=this.skin,t=this.moduleData.getCostGoldNum();this.costIcon.setItemId(21);var a=t<game.amount.get(game.AmountType.YUAN_BAO)?51696:51695;e.costNum.string=game.Lang.get(a,t)},updateIgnoreAni:function(){this.skin.check.setVisible(this.moduleData.isIgnoreAni)},updateLeftNum:function(){var e=this.moduleData.getCurMoneyCatConfig();if(e){var t=this.moduleData.leftNum;if(2==e.activityType)if(this.moduleData.getIsFinalVip())return void(this.skin.leftNum.string=game.Lang.get(51697,t));var a=1==e.activityType,i=a?51702:51703,n=a?this.moduleData.needCostMoneyTarget:this.moduleData.vipTarget,s=this.moduleData.targetAddNum;this.skin.leftNum.string=game.Lang.get(i,t,n,s)}else this.skin.leftNum.string=""},updateTime:function(){var e=this.moduleData.getCountDown();if(e<=0)return this.skin.leftTimelbl.string="",void game.module.hide(game.ME.MoneyCat);var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.leftTimelbl.string=0<e?game.Lang.get(51701,t):""},updateLog:function(){var e=this.moduleData.getLog();this.list.setData(e)},updateGetTips:function(){var e=this.moduleData.getGetGoldRange();if(this.skin.canGetTips.setVisible(2==e.length),2==e.length){var t=e[0],a=e[1];this.skin.canGetTips.string=game.Lang.get(51699,t,a)}},udpateGetNum:function(){this.skin;for(var e=this.moduleData.preGetDiamond.toString(),t=e.length,a=1;a<=6;a++){var i=+e[t-a]||0;this.getComponent("number_"+a).y=0,this.getComponent("number_"+a+"_2").string=i,this.getComponent("number_"+a+"_1").string=i-1<0?9:i-1}},playAni:function(e){var s=this,r=e.toString(),o=r.length;s.aniCounter=0;for(var t=function(e){var t=+r[o-e]||0,a=s.getComponent("number_"+e),i=s.getComponent("number_"+e+"_1"),n=s.getComponent("number_"+e+"_2");b8e.Tween.get(a).to({y:-110},100).call(function(){n.string=i.string,a.y=0;var e=n.string;e=e-1<0?9:e-1,i.string=e},s).call(s.realPlayAni,s,[a,i,n,t])},a=1;a<=6;a++)t(a)},realPlayAni:function(t,a,i,n){var s=this;b8e.Tween.kill(t),b8e.Tween.get(t,{loop:!0}).to({y:-110},100).call(function(){i.string=a.string,t.y=0;var e=i.string;e=e-1<0?9:e-1,a.string=e,i.string==n&&(b8e.Tween.kill(t),s.aniCounter+=1,6==s.aniCounter&&s.send(s.Evts.V2C_ON_ANI_END))},s)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.MoneyCat,e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.moneyCatData,this.moneyCatAlert=game.spotAlert.set(game.SAE.MONEY_CAT_ALERT,game.SAE.OPEN_SERVER_ALERT),this.isLockClick=!1},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo},OpenServer:{C2C_INIT_OPENSERVER:this.onOpenServerInit},MainRole:{C_VIP_LEVEL_CHANGE:this.changeVipLevel,C_RESET_DAILY:this.resetDaily}},this.handels={FortuneCatLogResp:this.onMoneyCatLogResp,FortuneCatResp:this.onMoneyCatResp,FortuneCatMsg:this.onMoneyCatMsgNotify}},resetDaily:function(){this.moduleData.resetDaily(),this.changeOpenServer(),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA),this.dptG(game.ActiveBarGEvts.REFRESH_BTNS)},notify:function(e){switch(e){case this.Evts.V_ONSHOW:this.onShowView();break;case this.Evts.V2C_ON_ANI_END:this.delayTimer||(this.delayTimer=b8e.setTimeout(this.onAniEnd,this,500))}},changeVipLevel:function(){this.moduleData.onVIPChange(),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA),this.changeOpenServer()},updateItemInfo:function(){this.checkAllAlert(),this.send(this.Evts.UPDATE_ITEM)},onOpenServerInit:function(){this.checkAllAlert(),this.changeOpenServer()},changeOpenServer:function(){var e=game.moneyCatData.checkOpen(),t={openServerType:game.OpenServerType.MONEYCAT,isActive:e,sae:game.SAE.MONEY_CAT_ALERT};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,t)},onShowView:function(){this.sender.FortuneCatLogReq(),this.checkAllAlert(),this.isLockClick=!1},btn_getMoney:function(){if(this.moduleData.activityId)if(this.moduleData.leftNum<=0)game.notice.show(51698);else{var e=this.moduleData.getCostGoldNum();game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,e,!0)&&(this.isLockClick||(this.isLockClick=!this.moduleData.isIgnoreAni,this.sender.FortuneCatReq()))}else b8e.error("[\u62db\u8d22\u732b]\u6d3b\u52a8id\u9519\u8bef")},btn_ignoreAni:function(){this.moduleData.isIgnoreAni=!this.moduleData.isIgnoreAni,this.send(this.Evts.C2V_SET_IGNORE_ANI)},checkAllAlert:function(){this.moneyCatAlert.alert=this.moduleData.checkAllAlert()},onAniEnd:function(){game.awardsData.setInfo(this.moduleData.rewardResult),game.module.show(game.ME.AwardShowTip),this.moduleData.insertLog(this.moduleData.cacheLog),this.send(this.Evts.UPDATE_DATA),this.delayTimer&&(b8e.clearTimeout(this.delayTimer),this.delayTimer=null),this.isLockClick=!1},onMoneyCatResp:function(e){var t=this,a=e.readProtobuf(game.pb.FortuneCatResponse);if(0<a.code)return t.isLockClick=!1,void game.notice.noticeError(a.code);t.moduleData.onMoneyCatSuccess(a);for(var i=[],n=a.item.amounts,s=n.length,r=0;r<s;r++){var o=n[r],g=game.amount.getCfgByType(o.type);g&&i.push({Id:g.id,Num:o.updateNum})}t.moduleData.rewardResult=i,t.moduleData.preGetDiamond=0<i.length?i[0].Num:0,t.moduleData.isIgnoreAni?(t.send(t.Evts.UPDATE_DATA),t.moduleData.insertLog(a.log),t.send(t.Evts.UPDATE_DATA),game.awardsData.setInfo(t.moduleData.rewardResult),game.module.show(game.ME.AwardShowTip)):(t.isLockClick=!0,t.moduleData.cacheLog=a.log,t.send(t.Evts.PLAY_ANIM,t.moduleData.preGetDiamond),t.send(t.Evts.UPDATE_DATA_NO_GOLD)),t.checkAllAlert(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeConsume)},onMoneyCatLogResp:function(e){var t=e.readProtobuf(game.pb.FortuneCatLogResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.overrideLogs(t.logs),this.send(this.Evts.UPDATE_LOGS))},onMoneyCatMsgNotify:function(e){var t=e.readProtobuf(game.pb.FortuneCatNotify);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateMoneyCatRechargeInfo(t),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA))}}),t=game.Sender.extends({ipc:function(){this.msg={FortuneCatLogReq:null,FortuneCatReq:null}}});b8e.module.registerControl(game.ME.MoneyCat,e,game.MoneyCatEvts,t)}(),function(){var e;e=game.CultivateBaseInfo.extends({lv:0,exp:0,star:0,power:0,active:!1,select:!1,isAlert:!1,activeAlert:!1,lvAlert:!1,starAlert:!1,awakeAlert:!1,costAlert:!1,battleAlert:!1,isMaxLv:!1,isMaxStar:!1,isShowName:!0,isShowLv:!0,isShowBattle:!0,isShowItemStar:!0,normalUrl:10090,grayUrl:10091,battleSlot:0,awakeStar:0,isBattle:!1,awakenSkills:{get:function(){return this._awakenSkills||this.initAwakenSkills(),this._awakenSkills}},initAwakenSkills:function(){this._awakenSkills=[];var e=void 0,t=game.FormationAwakenSkillCfg.getData(this.id,!0);if(t)for(var a=void 0,i=0,n=t.length;i<n;i++)a=t[i],(e=new game.PartnerSkillGroupInfo).skill=a.skill,e.star=a.star,(e.info=this)._awakenSkills.push(e)},getBattleOrWaitBattle:function(){return this.battleSlot},setCfgData:function(e){this.cfg=e,this.id=e.id,this.sortId=e.id,this.name=e.name},setData:function(e){this.setLv(e.formationLv,e.formationExp),this.setStarLv(e.formationStar),this.setAwake(e.awakenStar),this.onActive()},onActive:function(){this.active=!0,this.updateBattle()},setLv:function(e,t){this.lv=e,this.exp=t,this.isMaxLv=game.zhenXingData.getMaxLv()<=this.lv},setStarLv:function(e){this.star=e,this.isMaxStar=game.zhenXingData.isMaxStar(this.star)},setAwake:function(e){this.awakeStar=e;var t=game.FormationAwakenCfg.getData(this.id);if(!t)return!1;if(t.awakenSkill){for(var a=void 0,i=0,n=this.awakenSkills.length;i<n;i++)this.awakenSkills[i].star<=this.awakeStar&&(a=this.awakenSkills[i]);this.awakenSkill=a||this.awakenSkills[0]}},updateCost:function(){if(this.active)this.activeAlert=!1,this.updateLvCost(),this.updateStarCost(),this.updateAwakeCost();else{var e=this.cfg.costItem,t=game.itemData.getNumById(e.Id);this.activeAlert=t>=e.Num}this.updateAlert()},updateLvCost:function(){this.isMaxLv?this.lvAlert=!1:this.lvAlert=game.zhenXingData.isHaveLvCostItem()},updateStarCost:function(){if(this.isMaxStar)this.starAlert=!1;else{var e=game.zhenXingData.getObj(this.id,this.star),t=game.FormationStarCfg.getData(e);if(!t)return;var a=t.costItem[0],i=game.itemData.getNumById(a.Id);this.starAlert=i>=a.Num}},updateAwakeCost:function(){var e=game.starSoulData.getFosterAwakeCfg(null,this.id);if(e){var t=game.itemData.getNumById(e.itemId);this.awakeAlert=this.star>=e.activateStar&&t>=e.num}},updateBattle:function(){var e=game.zhenXingData.battleId;this.isBattle=this.id==e,this.battleSlot=this.id==e?2:0,this.battleAlert=this.active&&!e,this.updateAlert()},updateAlert:function(){this.costAlert=this.activeAlert||this.lvAlert||this.starAlert||this.awakeAlert,this.isAlert=this.costAlert||this.battleAlert}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZhenXingInfo",e)}(),function(){var e=game.CultivateBaseData.extends({battleId:0,toggleId:0,ctor:function(){this._super(game.ZhenXingInfo),this.zhenXingArr=[],this.zhenXingMap=b8e.HashMap.get(),this.attrItemMap=b8e.HashMap.get(),this.allLvCountArr=[0,0,0]},getInfoList:function(){return this.zhenXingArr},getInfoMap:function(){return this.zhenXingMap},getDataCfgs:function(){return game.FormationBaseCfg.getDatas()},synDatas:function(e){var t=e.formation;t&&t.length&&(this.hasActive=!0),e.formationAttr&&this.attrItemMap.set(e.formationAttr.id,e.formationAttr.num),this.initMap(),this.setBattleId(e.battleId),this.setInfoList(t);var a=this.getInfoList();a&&0<a.length&&this.selectInfoById(a[0].id)},onActive:function(e){var t=this.getInfoById(e);t&&(t.onActive(),this.hasActive=!0)},setBattleId:function(e){this.battleId=e;for(var t=this.zhenXingArr,a=t.length,i=0;i<a;i++)t[i].updateBattle()},updateAlert:function(){for(var e=this.zhenXingArr,t=e.length,a=0;a<t;a++)e[a].updateAlert()},onUpgrade:function(e,t,a){var i=this.getInfoById(e);i&&i.setLv(t,a)},setStarLv:function(e,t){var a=this.getInfoById(e);a&&a.setStarLv(t)},getMaxLv:function(){if(!this.maxLv){var e=game.FormationMiscCfg.getData("maxLv");e&&(this.maxLv=0|e.value)}return this.maxLv},isMaxStar:function(e){if(!this.starMaxLv){var t=game.FormationMiscCfg.getData("starMaxLv");t&&(this.starMaxLv=0|t.value)}return e>=this.starMaxLv},updateCost:function(){var e=this.zhenXingArr;if(e&&!(e.length<1)){for(var t=e.length,a=!1,i=void 0,n=0;n<t;n++)(i=e[n]).updateCost(),!a&&i.costAlert&&(a=!0);this.costAlert=a}},updateAttrAlert:function(){this.attrItemId||(this.attrItemId=this.getAttrItemId());var e=game.itemData.getNumById(this.attrItemId);this.attrAlert=0<e},getObj:function(e,t){this.obj||(this.obj={});var a=this.obj;return a.id=e,a.lv=t,a},getStarDescArr:function(e,t){var a=1<arguments.length&&void 0!==t&&t;this.starDescArr||(this.starDescArr=[]);for(var i=this.starDescArr,n=e.addition,s=void 0,r=void 0,o=void 0,g=void 0,u=0;u<6;u++)s=n[u].split(","),r=game.AttrRulesCfg.getData(+s[1]).name,g=s[2]/10,o=a?game.Lang.get(51731,r,g):game.Lang.get(51732,+s[0],r,g),i[u]=o;return i},addAllLvCountArr:function(e){var t=this.allLvCountArr,a=this.getLvCountArr(e);if(a&&3==a.length)for(var i=0;i<3;i++)t[i]+=a[i]},getAllLvCountArr:function(){this.clearAllLvCountArr();for(var e=this.zhenXingArr,t=e.length,a=void 0,i=0;i<t;i++)(a=e[i]).active&&this.addAllLvCountArr(a);return this.allLvCountArr},clearAllLvCountArr:function(){for(var e=this.allLvCountArr,t=e.length,a=0;a<t;a++)e[a]=0},setUpArr:function(e){for(var t=e.length,a=0;a<t;a++)e[a]/=10},getLvCountArr:function(e,t){var a=1<arguments.length&&void 0!==t&&t;this.lvCountArr||(this.lvCountArr=[]);var i=this.lvCountArr,n=a?e.lv+1:e.lv,s=game.FormationUpgradeCfg.getData(n);if(s){var r=this.getObj(e.id,e.star),o=game.FormationStarCfg.getData(r);if(o){for(var g=s.upgradeClient/100,u=o.upgradeClient/100,l=e.cfg.baseCount,c=0;c<3;c++)i[c]=this.getlvCount(l[c],g,u);return i}}},getlvCount:function(e,t,a){return(e+e*t*a)/100|0},getLvDesc:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i="";if(!e||3!=e.length)return i;var n=game.HtmlUtil.getText(game.Color.GREEN,"\u2191"),s=a?n:"";return i+=game.Lang.get(51733,e[0])+s+"<br/>",i+=game.Lang.get(51712,e[1])+s+"<br/>",i+=game.Lang.get(51713,e[2])+s},isHaveLvCostItem:function(){var e=game.FormationExpCfg.getDatas();if(e&&!(e.length<1)){for(var t=void 0,a=0,i=e.length;a<i;a++)if(t=e[a],0<game.itemData.getNumById(t.id))return!0;return!1}},getCurBattleInfo:function(){var e=this.battleId;return e?this.zhenXingMap.get(e):null},getKeZhiState:function(e,t){var a=0,i=game.FormationRestrainCfg.getData(e,!0);if(!i||i.length<1)return a;var n=i.length,s=void 0;for(s=0;s<n;s++)if(i[s].formationId==t)return a=1;var r=game.FormationRestrainCfg.getData(t,!0);if(!r||r.length<1)return a;for(n=r.length,s=0;s<n;s++)if(r[s].formationId==e)return a=2;return a},getKeZhiDesc:function(e,t,a,i,n){var s=1==e?3<arguments.length&&void 0!==i?i:52208:4<arguments.length&&void 0!==n?n:52209,r=game.FormationBaseCfg.getData(a),o=void 0;if(o=1==e?this.getKeZhiCfg(t,a):this.getKeZhiCfg(a,t),r&&o){var g=game.AttrRulesCfg.getData(o.attrType);if(g){var u=o.addition/10;return game.Lang.get(s,r.name,g.name,u)}}},getKeZhiCfg:function(e,t){this.kObj||(this.kObj={});var a=this.kObj;return a.id=e,a.formationId=t,game.FormationRestrainCfg.getData(a)},getAllScore:function(){var e=this;if(!e.zhenXingArr||e.zhenXingArr.length<1)return 0;e.tempSpriteStat?e.tempSpriteStat.clear():e.tempSpriteStat=game.SpriteStat.get();for(var t=void 0,a=void 0,i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=void 0,u=e.tempSpriteStat,l=e.zhenXingArr.length,c=0;c<l;c++)(g=e.zhenXingArr[c])&&g.active&&(t=g.id,(s=game.FormationBaseCfg.getData(t))&&(i=1,(n=game.FormationUpgradeCfg.getData(g.lv))&&(i*=n.upgrade),a=game.zhenXingData.getObj(t,g.star),(r=game.FormationStarCfg.getData(a))&&(i*=r.upgrade),i++,u.addByCfg(s,!0,i),g.awakeStar&&(o=game.FormationAwakenCfg.getData(t),u.addByCfg(o,!0,g.awakeStar))));var h=e.getAttrItemId(),m=e.attrItemMap.get(h);if(h&&0<m){var d=game.FormationAttrItemCfg.getData(h);u.addByCfg(d,!0,m)}return u.getTeamPower()},getAttrItemId:function(){var e=0;if(!this.attrCfg){var t=game.FormationAttrItemCfg.getDatas();if(!t||!t.length)return e;this.attrCfg=t[0]}return e=this.attrCfg.itemId||0},getZhenXingConditionStar:function(e){var t=0,a=this.getInfoList();if(!a||a.length<1)return t;for(var i=void 0,n=a.length,s=0;s<n;s++)(i=a[s]).active&&i.star>=e&&t++;return t},getActiveNum:function(){var e=0,t=this.getInfoList();if(!t||t.length<1)return e;for(var a=t.length,i=0;i<a;i++)t[i].active&&e++;return e},getQuaAndCondition:function(e,t,a){var i=1<arguments.length&&void 0!==t?t:null,n=2<arguments.length&&void 0!==a?a:0,s=0,r=this.getInfoList();if(!r||r.length<1)return s;for(var o=void 0,g=r.length,u=0;u<g;u++)if((o=r[u]).active){var l=!0;if(i)switch(i){case 1:l=o.star>=n;break;case 2:l=o.lv>=n}o.cfg.quality==e&&l&&s++}return s}});game.zhenXingData=game.zhenXingData||new e}(),function(){var e=b8e.Object.extends({ctor:function(){this.skillInfos=[]},setSkillInfos:function(){var e=game.zhenXingData.getCurInfo();if(e){this.name=e.name;var t=game.FormationStarCfg.getData(e.id,!0);if(t&&!(t.length<1)){t.sort(this.sortFunc);var a=this.skillInfos,i=t.length,n=e.active,s=e.star;a.length=i;for(var r=0;r<i;r++)a[r]||(a[r]=new game.ZhenXingDetailInfo),a[r].setData(t[r],n,s)}}},sortFunc:function(e,t){return e.lv-t.lv},getSkillInfos:function(){return this.skillInfos}});game.zhenXingDetailData=game.zhenXingDetailData||new e}(),function(){var e;e=b8e.Object.extends({setData:function(e,t,a){this.cfg=e,this.isLight=t&&e.lv<=a}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZhenXingDetailInfo",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SCROLL_BOTTOM:-1}),b8e.RC("$$game","$$ZhenXingDetailEvts",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_UPDATE_ATTR:-1,V2C_USE_ATTR_ITEM:-1,C2V_UPDATE_ITEM:-1,C2C_UPDATE_ATTR:-1}),b8e.RC("$$game","$$ZhenXingAttrEvts",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SELECT_TOGGLE:-1,C2V_SCROLL_LEFT:-1,C2V_SCROLL_RIGHT:-1,C2C_SYS_DATA:-1,C2V_UPDATE_STAR:-1,C2C_UPDTAE_COST:-1,C2V_UPDATE_LV_COST:-1,C2V_UPDATE_LV:-1,C2C_SELECT_CHANGE:-1,C2V_SELECT_CHANGE:-1,C2V_UPDATE_BATTLE:-1,C2V_UPDATE_STAR_COST:-1,C2C_STAR_SUCCESS:-1,C2V_STAR_SUCCESS:-1,C2V_UPDATE_ACTIVE_COST:-1,C2V_SCROLL_TOP:-1,C2V_SCROLL_BOTTOM:-1,C2C_UPDATE_ACTIVE:-1,C2C_UPDATE_BATTLE:-1,C2V_UPDATE_LIST:-1,C2C_UPDATE_LV:-1}),b8e.RC("$$game","$$ZhenXingEvts",e)}(),function(){var e=game.Control.extends({attrItemId:0,init:function(){this.data=game.zhenXingData;var e=game.spotAlert,t=game.SAE;this.zhenXingAlert=e.set(t.ZHENXING,t.YANGCHENG_ALERT),this.costAlert=e.set(t.ZHENXING_COST,t.ZHENXING),this.battleAlert=e.set(t.ZHENXING_BATTLE,t.ZHENXING),this.attrAlert=e.set(t.ZHENXING_ATTR,t.ZHENXING)},ipc:function(){this.evts={Back:{C_BACK_SYN_BACK_INFO:this.updateCost,C_BACK_UPDATE_ITEMINFO:this.updateCost},ZhenXing:{C2C_SELECT_CHANGE:this.updateSelect,C2C_SYS_DATA:this.updateBattleAlert}},this.handels={FormationActivateResp:this.onActiveResp,FormationBattleResp:this.onBattleResp}},updateSelect:function(){this.send(this.Evts.C2V_SELECT_CHANGE)},updateBattleAlert:function(){var e=this.data;this.battleAlert.alert=e.hasActive&&!this.data.battleId},updateCost:function(){if(game.moduleOpen.checkOpen(game.ME.ZhenXing)){var e=this.data;e.updateCost(),this.costAlert.alert=e.costAlert,this.updateAttrAlert(),this.dpt(this.Evts.C2C_UPDTAE_COST),this.send(this.Evts.C2V_UPDATE_ACTIVE_COST)}},updateAttrAlert:function(){this.data.updateAttrAlert(),this.attrAlert.alert=this.data.attrAlert},onActiveResp:function(e){var t=e.readProtobuf(game.pb.FormationActivateResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.onActive(t.id),this.updateBattleAlert(),this.send(this.Evts.C2V_UPDATE_ACTIVE),this.dpt(this.Evts.C2C_UPDATE_ACTIVE))},onBattleResp:function(e){var t=e.readProtobuf(game.pb.FormationBattleResponse);0<t.code?game.notice.noticeError(t.code):(this.data.setBattleId(t.battleId),this.updateBattleAlert(),this.send(this.Evts.C2V_UPDATE_BATTLE),this.dpt(this.Evts.C2C_UPDATE_BATTLE))},activeBtn:function(){var e=this.data.getCurInfo();if(e&&e.cfg){var t=e.cfg.costItem;game.UpgradeUtil.checkItemInfo(t.Id,t.Num,!0)&&this.sender.FormationActivateReq(e.id)}},battleBtn:function(){var e=this.data,t=e.selectId==e.battleId?0:e.selectId;this.sender.FormationBattleReq(t)},shuxingBtn:function(){game.module.show(game.ME.ZhenXingAttrItem)},awaken:function(){var e=game.zhenXingData.getCurInfo();if(e){var t=game.FormationAwakenCfg.getData(e.id);t&&(e.star<t.activateStar?game.notice.show(game.Lang.get(51867,t.activateStar)):game.module.show(game.ME.StarSoul))}}}),t=game.Sender.extends({ipc:function(){this.msg={FormationActivateReq:this.formationActivateReq,FormationBattleReq:this.formationBattleReq}},formationActivateReq:function(e){var t=game.pb.FormationActivateRequest;t.id=e,this.write(t)},formationBattleReq:function(e){var t=game.pb.FormationBattleRequest;t.battleId=e,this.write(t)}});b8e.module.registerControl(game.ME.ZhenXingActive,e,game.ZhenXingEvts,t)}(),function(){var e=game.Control.extends({fosterData:null,init:function(){this.fosterData=game.zhenXingData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateCost}},this.handels={FormationAttrItemResp:this.onFormationAttrItemResp}},onFormationAttrItemResp:function(e){var t=e.readProtobuf(game.pb.FormationAttrItemResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.FightAmount.inst().showTeamStatPower();var a=this.fosterData.attrItemMap.get(t.id)||0;a+=t.num,this.fosterData.attrItemMap.set(t.id,a),this.send(this.Evts.C2V_UPDATE_ATTR,t.num),this.dpt(this.Evts.C2C_UPDATE_ATTR)}},notify:function(e,t,a){switch(e){case this.Evts.V2C_USE_ATTR_ITEM:this.sender.FormationAttrItemReq(t,a)}},updateCost:function(){this.send(this.Evts.C2V_UPDATE_ITEM)}}),t=game.Sender.extends({ipc:function(){this.msg={FormationAttrItemReq:this.formationAttrItemReq}},formationAttrItemReq:function(e,t){var a=game.pb.FormationAttrItemRequest;a.id=e,a.num=t,this.write(a)}});b8e.module.registerControl(game.ME.ZhenXingAttrItem,e,game.ZhenXingAttrEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.zhenXingData},notify:function(e,t){switch(e){case game.CultivateBaseEvts.C_SELECTCHANGE:if(t.id==this.data.selectId)return;var a=this.data.getInfoById(t.id);if(0<this.data.toggleId&&!a.active)return void game.notice.show(51722);this.data.selectInfoById(t.id),this.send(this.Evts.C2V_SELECT_CHANGE),this.dpt(this.Evts.C2C_SELECT_CHANGE)}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.FormationReq()},ipc:function(){this.evts={ZhenXingActive:{C2C_UPDATE_ACTIVE:this.updateList,C2C_UPDTAE_COST:this.updateList,C2C_UPDATE_BATTLE:this.updateList},ZhenXingStar:{C2C_STAR_SUCCESS:this.updateStar}},this.handels={FormationResp:this.setModuleData}},setModuleData:function(e){var t=e.readProtobuf(game.pb.FormationModel);0<t.code?game.notice.noticeError(t.code):(this.data.synDatas(t),this.dpt(this.Evts.C2C_SYS_DATA,t))},btn_1:function(){this.selectTog(0)},btn_2:function(){this.selectTog(1)},btn_3:function(){this.selectTog(2)},selectTog:function(e){var t=this.data.getCurInfo();0<e&&!t.active?game.notice.show(51722):this.send(this.Evts.C2V_SELECT_TOGGLE,e)},btn_left:function(){this.send(this.Evts.C2V_SCROLL_LEFT)},btn_right:function(){this.send(this.Evts.C2V_SCROLL_RIGHT)},detailBtn:function(){game.zhenXingDetailData.setSkillInfos(),game.module.show(game.ME.ZhenXingDetail)},turnPlateBtn:function(){var e=game.FormationMiscCfg.getData("turnplateId");if(e){var t=game.xunBaoData.getOpenIdByType(+e.value);t&&b8e.evt.dptG(game.XunBaoEvts.C2C_SHOW_XUNBAO,t)}},topBtn:function(){this.send(this.Evts.C2V_SCROLL_TOP)},bottomBtn:function(){this.send(this.Evts.C2V_SCROLL_BOTTOM)},updateStar:function(){this.send(this.Evts.C2V_UPDATE_STAR)},updateList:function(){this.send(this.Evts.C2V_UPDATE_LIST)}}),t=game.Sender.extends({ipc:function(){this.msg={FormationReq:null}}}),a=[game.ME.ZhenXingDetail];b8e.module.registerControl(game.ME.ZhenXing,e,game.ZhenXingEvts,t,a)}(),function(){var e=game.Control.extends({init:function(){this.data=game.zhenXingData,this._costList=[];for(var e=game.FormationExpCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)(t={}).cfg=e[a],t.num=game.itemData.getNumById(t.cfg.id),this._costList.push(t)},ipc:function(){this.evts={ZhenXingActive:{C2C_UPDTAE_COST:this.updateLvAlert},ZhenXing:{C2C_SELECT_CHANGE:this.updateSelect}},this.handels={FormationUpgradeResp:this.onFormationUpgradeResp}},updateSelect:function(){this.send(this.Evts.C2V_SELECT_CHANGE)},updateLvAlert:function(){this.send(this.Evts.C2V_UPDATE_LV_COST)},onFormationUpgradeResp:function(e){var t=e.readProtobuf(game.pb.FormationUpgradeResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.onUpgrade(t.id,t.lv,t.exp),this.send(this.Evts.C2V_UPDATE_LV),this.dpt(this.Evts.C2C_UPDATE_LV),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeUpgrade))},autoUpgradeBtn:function(){this.upgradeReq(2)},upgradeBtn:function(){this.upgradeReq(1)},upgradeReq:function(e){var t=this.data.getCurInfo();if(t){var a=this.getCostItems(e);a&&a.length?this.sender.FormationUpgradeReq(t.id,a):game.notice.show(5519)}},updateCost:function(){for(var e=void 0,t=this._costList,a=t.length,i=0;i<a;i++)(e=t[i]).num=game.itemData.getNumById(e.cfg.id)},getCostItems:function(e){this.updateCost();var t=this._costList,a=this.data.getCurInfo();if(a){var i,n=a.lv;if(!(a.lv>=game.mainRoleData.lv)){var s=this.data.getMaxLv();i=1==e?n+1:s;var r=void 0,o=0;this.costs||(this.costs=[]),this.costs.length=0;for(var g=this.costs,u=void 0,l=n;l<i;l++)o+=game.FormationUpgradeCfg.getData(l).exp;o-=a.exp;for(var c=0,h=t.length;c<h;c++){r=t[c],(u={}).id=r.cfg.id;for(var m=u.num=0,d=r.num;m<d;m++)if(o-=r.cfg.exp,u.num+=1,o<=0)return u.num&&g.push(u),g;u.num&&g.push(u)}return g}}},costNode1:function(){this.showCostTips(1)},costNode2:function(){this.showCostTips(2)},costNode3:function(){this.showCostTips(3)},costNode4:function(){this.showCostTips(4)},showCostTips:function(e){var t=this._costList[e-1];if(t){var a=game.ItemInfoCfg.getData(t.cfg.id);a&&(game.tipsData.setInfo(a),game.module.show(game.ME.ItemTips))}}}),t=game.Sender.extends({ipc:function(){this.msg={FormationUpgradeReq:this.formationUpgradeReq}},formationUpgradeReq:function(e,t){var a=game.pb.FormationUpgradeRequest;a.id=e,a.item=t,this.write(a)}});b8e.module.registerControl(game.ME.ZhenXingLv,e,game.ZhenXingEvts,t)}(),function(){var e=game.Control.extends({init:function(){this.data=game.zhenXingData},ipc:function(){this.evts={ZhenXingActive:{C2C_UPDTAE_COST:this.updateStarAlert},ZhenXing:{C2C_SELECT_CHANGE:this.updateSelect}},this.handels={FormationStarResp:this.onFormationStarResp}},updateSelect:function(){this.send(this.Evts.C2V_SELECT_CHANGE)},updateStarAlert:function(){this.send(this.Evts.C2V_UPDATE_STAR_COST)},onFormationStarResp:function(e){var t=e.readProtobuf(game.pb.FormationStarResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.setStarLv(t.id,t.star),game.module.show(game.ME.ZhenXingStarTips),this.send(this.Evts.C2V_STAR_SUCCESS),this.dpt(this.Evts.C2C_STAR_SUCCESS),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeStar))},shengxingBtn:function(){var e=this.data.getCurInfo();if(e){var t=this.data.getObj(e.id,e.star),a=game.FormationStarCfg.getData(t);if(a)game.UpgradeUtil.checkItemList(a.costItem,1,!0)&&this.sender.FormationStarReq(e.id,this.autoType)}},btn:function(){game.module.hide(game.ME.ZhenXingStarTips)}}),t=game.Sender.extends({ipc:function(){this.msg={FormationStarReq:this.formationStarReq}},formationStarReq:function(e){var t=game.pb.FormationStarRequest;t.id=e,this.write(t)}}),a=[game.ME.ZhenXingStarTips];b8e.module.registerControl(game.ME.ZhenXingStar,e,game.ZhenXingEvts,t,a)}(),function(){var e=game.View.extends({ctor:function(){this._super(1326),this.spotAlerts={ZHENXING_BATTLE:this.battleAlert,ZHENXING_ATTR:this.attrAlert}},battleAlert:function(e){this.skin.battleRed.active=e.alert},attrAlert:function(e){this.skin.shuXingRed.active=e.alert},init:function(){this.data=game.zhenXingData,this.itemIcon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105),this.itemIcon.addToParent(this.skin.itemNode)},notify:function(e){var t=this;switch(e){case t.Evts.C2V_SELECT_CHANGE:t.updateView(),t.updateBattle(),t.updateCost();break;case t.Evts.C2V_UPDATE_ACTIVE:t.updateView();break;case t.Evts.C2V_UPDATE_BATTLE:t.updateBattle();break;case t.Evts.C2V_UPDATE_ACTIVE_COST:t.updateCost()}},onShow:function(){this.updateView(),this.updateBattle(),this.updateCost()},updateView:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&t.cfg){var a=t.cfg,i=t.active;if(e.activeNode.active=i,e.notActiveNode.active=!i,e.kezhiDesc.string=game.Lang.get(a.desc),e.beikezhiDesc.string=game.Lang.get(a.beiDesc),i){var n=this.data.getAllLvCountArr();this.data.setUpArr(n);for(var s=void 0,r=0;r<3;r++)s=51723+r,this.getComponent("att"+r).string=game.Lang.get(s,n[r])}else{var o=a.costItem,g=game.ItemInfoCfg.getData(o.Id);if(!g)return;this.itemIcon.setItemInfo(g),this.itemIcon.setNum(0),e.itemName.string=game.HtmlUtil.getColorStrByQuality(a.quality,g.name)}}},updateBattle:function(){var e=this.skin,t=this.data.getCurInfo();if(t){var a=t.battleSlot?51728:51729;e.battleDesc.string=game.Lang.get(a)}var i=this.data.battleId;if(i){var n=this.data.getInfoById(i);n&&(e.battleLab.string=game.Lang.get(51726,n.name))}else e.battleLab.string=game.Lang.get(51727)},updateCost:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&t.cfg){var a=t.cfg.costItem,i=game.itemData.getNumById(a.Id),n=a.Num,s=n<=i,r=s?51815:51816;e.itemNum.string=game.Lang.get(r,i,n),e.activeRed.active=s,e.awakeRed.active=t.awakeAlert}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ZhenXingActive,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1325),this.setSize(540,158)},setData:function(e){var t=e.cfg;this.skin.nameLab.string=game.Lang.get(51717,t.lv,game.zhenXingDetailData.name);for(var a=e.isLight?51718:51719,i=t.addition,n=void 0,s=void 0,r=void 0,o=0;o<6;o++)r=(n=i[o].split(","))[2]/10,s=game.AttrRulesCfg.getData(+n[1]).name,this.getComponent("desc"+o).string=game.Lang.get(a,+n[0],s,r)}}),b8e.RC("$$game","$$ZhenXingDetailItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1295)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ZhenXingDetailItem,e.layout.spacingY=5,e.layout.paddingLeft=5,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list),e.setScrollViewCb(this.listCb,this)},notify:function(e){switch(e){case this.Evts.C2V_SCROLL_TOP:this.list.scrollToTop(0,200);break;case this.Evts.C2V_SCROLL_BOTTOM:this.list.scrollToBottom(0,200)}},listCb:function(e,t,a){var i=this.skin;i.topBtn.active=0<e.length,i.bottomBtn.active=0<a.length},onShow:function(){this.skin.titleLab.string=game.Lang.get(51716),this.updateList()},updateList:function(){var e=game.zhenXingDetailData.getSkillInfos();this.list.setData(e)}});b8e.module.registerView(game.ME.ZhenXingDetail,e)}(),function(){var e=game.View.extends({progressMaxW:483,ctor:function(){this._super(1329)},init:function(){this.data=game.zhenXingData,this._costList=[];for(var e=game.FormationExpCfg.getDatas(),t=void 0,a=void 0,i=0,n=e.length;i<n;i++)(a=this.getComponent("costNode"+(i+1)))&&((t={}).cfg=e[i],t.icon=this.createCostIcon(t.cfg.id,a),t.num=game.itemData.getNumById(t.cfg.id),this._costList.push(t),this.getComponent("costLab"+(i+1)).string=game.Lang.get(51730,t.cfg.exp))},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84);a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},notify:function(e){switch(e){case this.Evts.C2V_SELECT_CHANGE:case this.Evts.C2V_UPDATE_LV:this.updateView(),this.updateCost();break;case this.Evts.C2V_UPDATE_LV_COST:this.updateCost()}},onShow:function(){this.updateView(),this.updateCost()},updateView:function(){var e=this,t=e.data.getCurInfo();if(t){var a=e.skin,i=game.FormationUpgradeCfg.getData(t.lv);if(i){var n=t.exp,s=i.exp;a.lvLab.string="Lv."+t.lv,a.expLab.string=n+"/"+s,a.progress.width=Math.min(e.progressMaxW,e.progressMaxW*(n/s));var r=e.data.getLvCountArr(t);e.data.setUpArr(r),a.curProLab.string=e.data.getLvDesc(r);var o=t.isMaxLv;if(a.maxNode.active=o,a.notMaxNode.active=!o,!t.isMaxLv){var g=e.data.getLvCountArr(t,!0);e.data.setUpArr(g),a.nextProLab.string=e.data.getLvDesc(g,!0)}}}},updateCost:function(){for(var e=this.skin,t=this._costList,a=t.length,i=void 0,n=void 0,s=void 0,r=0;r<a;r++)n=(i=t[r]).icon,i.num=game.itemData.getNumById(i.cfg.id),s=0<i.num?game.Color.GREEN:game.Color.RED,n.setNum(i.num,s,20,!0,0,!0);var o=this.data.getCurInfo();o&&(e.redPoint1.active=o.lvAlert)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ZhenXingLv,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1328)},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.zhenXingData.getCurInfo();if(t){e.name.string=t.name;for(var a=t.star,i=game.zhenXingData.getObj(t.id,t.star),n=game.FormationStarCfg.getData(i).addition,s=void 0,r=void 0,o=0;o<6;o++)s=n[o].split(","),r=game.AttrRulesCfg.getData(+s[1]).name,this.getComponent("starIcon"+(o+1)).active=o<a,this.getComponent("addProLab"+(o+1)).string=game.Lang.get(51720,+s[0],r,s[2]/10);var g=game.ResCfg.getUrl(10095,t.cfg.bg);e.zhenXingNode.loadTexture(g)}}});b8e.module.registerView(game.ME.ZhenXingStarTips,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1327)},init:function(){this.data=game.zhenXingData;var e=this.skin;this.itemIcon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105),this.itemIcon.addToParent(e.itemNode)},notify:function(e){switch(e){case this.Evts.C2V_SELECT_CHANGE:case this.Evts.C2V_STAR_SUCCESS:this.updateView(),this.updateCost();break;case this.Evts.C2V_UPDATE_STAR_COST:this.updateCost()}},onShow:function(){this.updateView(),this.updateCost()},updateView:function(){var e=this.skin,t=this.data.getCurInfo();if(t){var a=t.isMaxStar;e.maxNode.active=a,e.notMaxNode.active=!a;var i=this.data.getObj(t.id,t.star),n=game.FormationStarCfg.getData(i);if(n&&(this.setDesc(e.addLabNow,n),!a)){var s=n.costItem[0],r=game.ItemInfoCfg.getData(s.Id);if(!r)return;this.itemIcon.setItemInfo(r),this.itemIcon.setNum(0),e.itemName.string=game.HtmlUtil.getColorStrByQuality(r.quality,r.name);var o=this.data.getObj(t.id,t.star+1),g=game.FormationStarCfg.getData(o);if(!g)return;this.setDesc(e.addProNext,g,!0)}}},setDesc:function(e,t,a){for(var i=2<arguments.length&&void 0!==a&&a,n=this.data.getStarDescArr(t),s=n.length,r="",o=game.HtmlUtil.getText(game.Color.GREEN,"\u2191"),g=i?o:"",u=0;u<s;u++)r+=n[u]+g+"<br/>";e.string=r},updateCost:function(){var e=this.skin,t=this.data.getCurInfo();if(t&&!t.isMaxStar){var a=this.data.getObj(t.id,t.star),i=game.FormationStarCfg.getData(a);if(i){var n=i.costItem[0],s=game.itemData.getNumById(n.Id),r=n.Num,o=r<=s,g=o?51815:51816;e.itemNum.string=game.Lang.get(g,s,r),e.shengXingRed.active=o}}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ZhenXingStar,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1330),this.toggles={toggle_btn_1:game.ME.ZhenXingActive,toggle_btn_2:game.ME.ZhenXingLv,toggle_btn_3:game.ME.ZhenXingStar}},init:function(){var e=this.skin;this.data=game.zhenXingData;var t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.CultivateBaseListItem,t.layout.spacingX=5,t.bindEnum=this.moduleEnum,t.addToParent(e.headList),t.setScrollViewCb(this.listCb,this)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_SELECT_TOGGLE:a.toggleSelect(t);break;case a.Evts.C2V_SCROLL_LEFT:a.scrollLeft();break;case a.Evts.C2V_SCROLL_RIGHT:a.scrollRight();break;case a.Evts.C2V_SELECT_CHANGE:a.updateView(),a.updateStar(),a.updateRed();break;case a.Evts.C2V_UPDATE_STAR:a.updateStar();break;case a.Evts.C2V_UPDATE_LIST:a.updateList(),a.updateRed()}},scrollLeft:function(){this.list.scrollContainerLeft()},scrollRight:function(){this.list.scrollContainerRight()},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.btn_left.node.active=n,this.leftAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.leftAlert=!0;break}if(n=0<(i=a.length),this.skin.btn_right.node.active=n,this.rightAlert=!1,n)for(var r=0;r<i;r++)if(a[r].isAlert){this.rightAlert=!0;break}this.updateLRBtnAlert(this.leftAlert,this.rightAlert)},updateLRBtnAlert:function(e,t){this.skin.l_red_spot.active=e,this.skin.r_red_spot.active=t},onShow:function(){this.updateList(),this.toggleSelect(0),this.updateRed(),this.updataTurnplate()},toggleSelect:function(e){this._super(e),this.data.toggleId=e,this.updateView(),this.updateStar()},updateList:function(){var e=this.data.getInfoSortList();this.list.setData(e)},updateView:function(){var e=this.data.getCurInfo();if(e&&e.cfg){var t=this.skin,a=e.cfg,i=game.HtmlUtil.getColorStrByQuality(a.quality,a.name);t.nameLab.string=i;var n=game.ResCfg.getUrl(10095,a.bg);t.zhenXingNode.loadTexture(n)}},updateStar:function(){var e=this.data.getCurInfo();if(e){var t=this.data.getObj(e.id,e.star),a=game.FormationStarCfg.getData(t);if(a)for(var i=this.data.getStarDescArr(a,!0),n=e.star,s=0;s<6;s++)this.getComponent("starIcon"+(s+1)).active=s<n,this.getComponent("desc"+s).string=i[s]}},updateRed:function(){var e=this.data,t=e.getCurInfo();if(t&&t.cfg){var a=this.skin,i=e.hasActive&&!this.data.battleId;a.red_spot_1.active=t.activeAlert||i||e.attrAlert||t.awakeAlert,a.red_spot_2.active=t.lvAlert,a.red_spot_3.active=t.starAlert}},updataTurnplate:function(){var e=this.skin;e.turnPlateBtn.active=!1;var t=game.FormationMiscCfg.getData("turnplateId");if(t){var a=game.xunBaoData.getOpenIdByType(+t.value);e.turnPlateBtn.active=!!a}}});b8e.module.registerView(game.ME.ZhenXing,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1377)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_ATTR:this.changeAttrItem(),this.minusUseNum(t),this.setUsedNum(),this.setUseNum();break;case this.Evts.C2V_UPDATE_ITEM:this.setBackNum()}},init:function(){if(!this._attrItemGrid){this._attrItemGrid=game.GridUtil.createItemIcon(),this._attrItemGrid.addToParent(this.skin.icon)}this.fosterData=game.zhenXingData},onShow:function(){var e=this.getAttrItem();this.useNum=game.itemData.getNumById(e),this.skin.labTitle.string=game.Lang.get(51721),this.setAttrItemIcon(),this.setUsedNum(),this.setBackNum(),this.setToGet(),this.changeAttrItem(),this.setUseNum()},getAttrItem:function(){var e=0;if(!this.attrCfg){var t=game.FormationAttrItemCfg.getDatas();if(!t||!t.length)return e;this.attrCfg=t[0]}return e=this.attrCfg.itemId||0},changeAttrItem:function(){var e=this.getAttrItem(),t=this.attrCfg;if(t){var a=this.fosterData.attrItemMap.get(e)||0;this.setSpriteStat(t,a)}},setAttrItemIcon:function(){var e=this.getAttrItem();this._attrItemInfo=game.ItemUtil.createBaseItemInfo(e,1,this._attrItemInfo),game.GridUtil.setItemIcon(this._attrItemGrid,this._attrItemInfo,!1,0)},setUsedNum:function(){var e=this.getAttrItem(),t=this.fosterData.attrItemMap.get(e)||0;this.skin.usedNum.string=game.Lang.get(9504,t)},setBackNum:function(){var e=this.getAttrItem();this.skin.backNum.string=game.itemData.getNumById(e)},setToGet:function(){var e=this.getAttrItem(),t=game.ItemInfoCfg.getData(e);t?(""==t.des2&&(this.skin.toGet.node.active=!1),this.skin.itemName.string=t.name,this.skin.toGet.string=game.Lang.get(50152,t.des2)):b8e.error("cfg \u4e0d\u5b58\u5728!!!",e)},setUseNum:function(){this.skin.useNum.string=this.useNum},setSpriteStat:function(e,a){var i=this;i.spriteStat||(i.spriteStat=game.SpriteStat.get()),i.spriteStat.setupByCfg(e);var t=i.spriteStat.getSpriteStats();if(t){var n=1,s=void 0;t.forEach(function(e,t){e=+e,(s=game.AttrRulesCfg.getData(e))&&(t=game.CCommonUtil.replaceNum(t*a,2),i.getComponent("sptireLab_"+n).string=game.Lang.get(509,s.name,t)),n++},i)}},view_addOneBtn:function(){var e=this.getAttrItem(),t=game.itemData.getNumById(e),a=this.useNum+1;this.useNum=a<=t?a:t,this.setUseNum()},view_addTenBtn:function(){var e=this.getAttrItem(),t=game.itemData.getNumById(e),a=this.useNum+10;this.useNum=a<=t?a:t,this.setUseNum()},view_lessenOneBtn:function(){var e=this.useNum-1;this.useNum=-1<e?e:0,this.setUseNum()},view_lessenTenBtn:function(){var e=this.useNum-10;this.useNum=-1<e?e:0,this.setUseNum()},view_useBtn:function(){if(this.useNum<1)game.notice.show(9141);else{var e=this.getAttrItem();this.send(this.Evts.V2C_USE_ATTR_ITEM,e,this.useNum)}},minusUseNum:function(e){this.useNum-=e,this.useNum=0<this.useNum?this.useNum:0}});b8e.module.registerView(game.ME.ZhenXingAttrItem,e)}(),function(){var e=game.SurfaceSkinView.extends({init:function(){this._surfaceType=game.SurfaceTypes.NICKNMAE,this._super()},setModel:function(){var e=this.getCurInfo();if(e){var t=e.getCfg();if(t){var a=game.AvatarUtil.getUIModel(t),i=game.ResCfg.getUrl(5004,a);this.setAnim(i,t.uiScale),this._model&&(this._model.y=t.offsetY)}}}});b8e.module.registerView(game.ME.NickNameSkin,e)}(),function(){var e=game.SurfaceSkinView.extends({init:function(){this._surfaceType=game.SurfaceTypes.FASHION,this._super(),this.creatRoleModel()},setModel:function(){var e=this.getCurInfo();if(e){var t=e.getCfg();if(t){var a=game.AvatarUtil;this.roleData.heroModel.setAnims(game.mainRoleData.heroModel.copyAnim()),game.mainRoleData.heroModel.surfaces&&this.roleData.heroModel.setSurfaces(game.mainRoleData.heroModel.surfaces),this.roleData.heroModel.surfaceFashion=game.mainRoleData.isMale?t.model:t.model1,this.roleData.heroModel.getAnim(game.AnimType.MOUNT)||this.roleData.heroModel.surfaceMount||this.setDefaultMount(),a.updateUIModel(this.role,1,!0),this.role.transition(game.RoleStateType.ACTION_IDLE)}}}});b8e.module.registerView(game.ME.FashionSkin,e)}(),function(){var e=game.SurfaceSkinView.extends({init:function(){this._surfaceType=game.SurfaceTypes.MOUNT,this._super(),this.creatRoleModel()},setModel:function(){var e=this.getCurInfo();if(e){var t=e.getCfg();if(t){var a=game.AvatarUtil;this.roleData.heroModel.setAnims(game.mainRoleData.heroModel.copyAnim()),game.mainRoleData.heroModel.surfaces&&this.roleData.heroModel.setSurfaces(game.mainRoleData.heroModel.surfaces),this.roleData.heroModel.setAnim(game.AnimType.MOUNT_HEAD,0),this.roleData.heroModel.surfaceMount=t.model,this.roleData.heroModel.surfaceMountHead=t.mountHead,this.roleData.heroModel.uiMountOffsetY=t.UIMountOffsetY,a.updateUIModel(this.role,1,!0),this.role.transition(game.RoleStateType.ACTION_IDLE)}}}});b8e.module.registerView(game.ME.MountSkin,e)}(),function(){var e=game.SurfaceSkinView.extends({init:function(){this._surfaceType=game.SurfaceTypes.WEAPON,this._super(),this.creatRoleModel()},setModel:function(){var e=this.getCurInfo();if(e){var t=e.getCfg();if(t){var a=game.AvatarUtil;this.roleData.heroModel.setAnims(game.mainRoleData.heroModel.copyAnim()),game.mainRoleData.heroModel.surfaces&&this.roleData.heroModel.setSurfaces(game.mainRoleData.heroModel.surfaces),this.roleData.heroModel.getAnim(game.AnimType.MOUNT)||this.roleData.heroModel.surfaceMount||this.setDefaultMount(),this.roleData.heroModel.surfaceWeapon=t.model,a.updateUIModel(this.role,1,!0),this.role.transition(game.RoleStateType.ACTION_IDLE)}}}});b8e.module.registerView(game.ME.WeaponSkin,e)}(),function(){var e=game.SurfaceSkinView.extends({init:function(){this._surfaceType=game.SurfaceTypes.WING,this._super(),this.creatRoleModel()},setModel:function(){var e=this.getCurInfo();if(e){var t=e.getCfg();if(t){var a=game.AvatarUtil;this.roleData.heroModel.setAnims(game.mainRoleData.heroModel.copyAnim()),game.mainRoleData.heroModel.surfaces&&this.roleData.heroModel.setSurfaces(game.mainRoleData.heroModel.surfaces),this.roleData.heroModel.surfaceWing=t.model,this.roleData.heroModel.getAnim(game.AnimType.MOUNT)||this.roleData.heroModel.surfaceMount||this.setDefaultMount(),a.updateUIModel(this.role,1,!0),this.role.transition(game.RoleStateType.ACTION_IDLE)}}}});b8e.module.registerView(game.ME.WingSkin,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C2V_UPDATE_LIST:-1,V2C_SELECT_ID:-1,C2V_RECRUIT_COMPLETE:-1,C2V_UPDATE_SKIP_BTN:-1,C2V_UPDATE_ITEM:-1,C2V_REFRESH_SELECT_ID:-1,V2C_CLICK_AWARD_BOX:-1,C2V_GET_SCORE_AWARD:-1,C2V_SWITCH_PAGE:-1,V2C_PREVIEW_BOX:-1,C2C_PREVIEW_BOX:-1,C2C_SHOW_PARTNER:-1,C2C_ACTIVE_PARTNER:-1,C2C_UPDATE_FANLI_SCORE:-1,C2C_CHOUJIANG_LEN:-1,C2V_UPDATE_SELECT:-1,C2V_UPDATE_COUNT:-1,C2V_ELEMENT_RECRUIT_COMPLETE:-1,C2V_UPDATE_AUTO_BUY_BTN:-1,V2C_CLOSE_PARTNER_VIEW:-1,C2V_SHOW_CARD_CONTINUE:-1,C2V_UPDATE_RECRUIT_SHOW_PAGE:-1,C2C_FINISH_CHOUJIANG:-1,V2C_SELECT_AS_ID:-1,C2V_UPDATE_PAGE:-1}),b8e.RC("$$game","$$RecruitEvts",e)}(),function(){var e;e=b8e.Enum({NONE:0,V_SELECT_CHANGE:-1}),b8e.RC("$$game","$$RecruitPreViewEvts",e)}(),function(){var e=b8e.Object.extends({activityId:0,elementSelect:0,skipModuleId:0,ctor:function(){this._super(),this.recruitMap=b8e.HashMap.get(),this.unlockIdMap=b8e.HashMap.get(),this.lockIds=[]},initRecruitList:function(){var e=game.SummonOpenCfg.getDatas();if(e&&!(e.length<1)){var t=void 0,a=void 0,i=void 0,n=e.length;for(t=0;t<n;t++)a=e[t],(i=this.recruitMap.get(a.id))||((i=new game.RecruitInfo).setData(a),this.recruitMap.set(a.id,i),0<a.unlockId&&(this.unlockIdMap.set(a.unlockId,a.id),this.lockIds.push(a.id)))}},setOpenList:function(){var a=this;a.openList||(a.openList=[]);a.openList.length=0,a.recruitMap.forEach(function(e,t){t.checkOpen()&&!t.unlockId&&a.openList.push(t)},a),a.openList.sort(a.onSort),a.activityId=0<a.openList.length&&a.openList[0].id||0},setupData:function(e){if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)t=e[n],(a=this.recruitMap.get(t.activityId))&&a.setServerData(t)},summonResp:function(e,t,a){var i=this.getBaseCfgById(e);if(i){var n=this.recruitMap.get(i.activityId);n&&(n.awardScore=t,n.elementScore+=i.elementScore,n.luckScore=a,n.totalNum+=i.count,n.cfg&&1==i.count&&0<n.cfg.freeNum&&n.freeNum++,n.checkAlert())}},summonSelectResp:function(e,t,a){var i=2<arguments.length&&void 0!==a?a:0,n=this.recruitMap.get(e);n&&(n.selectId=t,n.selectNum=i)},summonSelectMsg:function(e){if(e&&!(e.length<1))for(var t=void 0,a=e.length,i=0;i<a;i++)t=e[i],this.summonSelectResp(t.id,t.selectId)},summonAwardResp:function(e,t,a,i){var n=this.recruitMap.get(e),s=!1;return n&&(n.setAwards(t),0!=i&&n.selectId!=i&&(n.selectId=i,s=!0),n.awardScore!=a&&(n.awardScore=a,n.clearAwards()),n.checkAlert()),s},summonElementResp:function(e,t){var a=this.recruitMap.get(e);a&&(a.elementScore=t)},getBaseCfgById:function(e){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.id=e,game.SummonBaseCfg.getData(this.cfgObj2)},getShowList:function(){return this.checkAlert(!0),this.openList},onSort:function(e,t){return e.id-t.id},getBaseCfg:function(e,t){return this.cfgObj1||(this.cfgObj1=b8e.createMap()),this.cfgObj1.activityId=e,this.cfgObj1.count=t,game.SummonBaseCfg.getData(this.cfgObj1)},getSummonLuckWeightCfg:function(e,t){return this.cfgObj3||(this.cfgObj3=b8e.createMap()),this.cfgObj3.activityId=e,this.cfgObj3.selectId=t,game.SummonLuckWeightCfg.getData(this.cfgObj3)},getBaseCfgs:function(e){return this.cfgObj5||(this.cfgObj5=b8e.createMap()),this.cfgObj5.activityId=e,game.SummonBaseCfg.getData(this.cfgObj5,!0)},getSkipById:function(e){if(!e)return!1;return!!(this.skipIds&&-1<this.skipIds.indexOf(e))},getAutoBuyById:function(e){if(!e)return!1;return!!(this.autoBuyIds&&-1<this.autoBuyIds.indexOf(e))},setSkipById:function(e){this.skipIds||(this.skipIds=[]);var t=this.skipIds.indexOf(e);-1<t?this.skipIds.splice(t,1):this.skipIds.push(e)},setAutoBuyById:function(e){this.autoBuyIds||(this.autoBuyIds=[]);var t=this.autoBuyIds.indexOf(e);-1<t?this.autoBuyIds.splice(t,1):this.autoBuyIds.push(e)},getInfoById:function(e){return this.recruitMap&&this.recruitMap.get(e)},createPreView:function(e){var t=this.getCurCfg();if(!t)return null;var a=this._preViewList;a||(this._preViewList=a=[]);for(var i=a.length,n=0;n<i;n++)game.RecruitPreviewInfo.put(a[n]);var s=e+1,r=a.length=0,o=void 0;i=t.partnerIds.length;for(n=0;n<i;n++)r=t.partnerIds[n],1==t.showType&&game.PartnerCfg.getData(r).element!=s||((o=game.RecruitPreviewInfo.get()).setData(r),a.push(o));return a},getCurCfg:function(){var e=this.getInfoById(this.activityId);if(!e)return null;return 0<e.selectId?game.SummonPreViewCfg.getDataByIdAndSId(e.id,e.selectId):game.SummonPreViewCfg.getDataById(e.id)},getCurSelectInfo:function(){return this.recruitMap&&this.recruitMap.get(this.activityId)},getCostCfg:function(e,t){this.costCfgMap||(this.costCfgMap=b8e.HashMap.get());var a=this.costCfgMap.get(e);if(a||((a=game.SummonCostCfg.getData(e,!0))&&a.sort(function(e,t){return e.num-t.num}),this.costCfgMap.set(e,a)),!a||a.length<1)return null;for(var i=void 0,n=a.length-1;-1<n;n--)if(t>=(i=a[n]).num)return i;return a[0]},getRedTotalNum:function(){var e=this.getInfoById(2);if(e)return e.totalNum},checkAlert:function(e){if(!this.openList||this.openList.length<1)return!1;for(var t=void 0,a=void 0,i=!1,n=this.openList.length,s=0;s<n;s++){if((t=this.openList[s]).unlockId&&t.cfg){if((a=this.getInfoById(t.unlockId))&&a.totalNum<t.cfg.unlockNum)continue;i=t.checkAlert()}else i=t.checkAlert();if(i&&!e)return i}return!1},checkSelectAlert:function(){var e=this.lockIds;if(!e||e.length<1)return!1;for(var t=void 0,a=!1,i=e.length,n=0;n<i;n++)if(t=e[n],a=this.checkLockAlert(t))return a;return a},checkLockAlert:function(e){var t=game.SummonOpenCfg.getData(e);if(!t||!t.unlockId)return!1;var a=this.getInfoById(t.unlockId);if(!a||a.totalNum<t.unlockNum)return!1;var i=this.getInfoById(e);return!!i&&i.checkAlert()},forceRefreshLockIds:function(){var e=this.lockIds;if(e&&!(e.length<1))for(var t=void 0,a=e.length,i=0;i<a;i++){t=e[i];var n=game.SummonOpenCfg.getData(t);if(!n||!n.unlockId)return;var s=this.getInfoById(n.unlockId);if(!s||s.totalNum<n.unlockNum)return;s.forceRefresh++}},isGetAward:function(e,t){var a=this.getInfoById(e);return a&&a.awards&&-1<a.awards.indexOf(t)},getAwardScore:function(e){var t=this.getInfoById(e);return t&&t.awardScore||0},getMaxAwardScore:function(e,t){this.cfgObj4||(this.cfgObj4=b8e.createMap()),this.cfgObj4.id=e,this.cfgObj4.selectId=t,this.cfgObj4.isMax=1;var a=game.SummonScoreCfg.getData(this.cfgObj4,!1,!1);return a&&a.score||0},getAwardCfgs:function(e,t){return this.cfgObj6||(this.cfgObj6=b8e.createMap()),this.cfgObj6.id=e,this.cfgObj6.selectId=t,game.SummonScoreCfg.getData(this.cfgObj6,!0,!1)},getLockId:function(e){return this.unlockIdMap?0|this.unlockIdMap.get(e):0},getFixSelectList:function(e){var t=game.SummonOpenCfg.getData(e);if(!t||!t.fixSelectIds||t.fixSelectIds.length<1)return null;this.fixSelectMap||(this.fixSelectMap=b8e.HashMap.get());var a=this.fixSelectMap.get(e);if(a&&0<a.length)return a;a=[];for(var i=void 0,n=void 0,s=t.fixSelectIds,r=s.length,o=0;o<r;o++)i=s[o],(n=new game.RecuritSelectInfo).setData(e,i),a.push(n);return this.fixSelectMap.set(e,a),a},getFixSelectIdsIndex:function(e){var t=this.getInfoById(e),a=game.SummonOpenCfg.getData(e);return t&&a&&t.selectId&&a.fixSelectIds&&!(a.fixSelectIds.length<1)?a.fixSelectIds.indexOf(t.selectId):-1}});game.recruitData=game.recruitData||new e}(),function(){var e;e=b8e.Object.extends({id:0,pageType:0,freeNum:0,selectId:0,selectNum:0,luckScore:0,awardScore:0,awards:null,elementScore:0,totalNum:0,isAlert:!1,forceRefresh:0,setData:function(e){this.cfg=e,this.id=e.id,this.pageType=e.pageType,this.unlockId=e.unlockId,e.fixSelectIds&&0<e.fixSelectIds.length&&(this.selectId=e.fixSelectIds[0]),this.__renderType=3==this.pageType?1:0},setServerData:function(e){this.freeNum=e.freeNum,e.selectId&&(this.selectId=e.selectId),this.selectNum=e.selectNum,this.luckScore=e.luckScore,this.awardScore=e.awardScore,this.awards=e.awards,this.elementScore=e.elementScore,this.totalNum=e.totalNum},checkOpen:function(){var e=this.cfg;if(!e)return!1;if(e.activityType&&!game.openServerData.getIsOpenByType(e.activityType))return!1;var t=game.miscData.openServerDay;if(!e.startTime)return t>=e.serverStart&&t<e.serverEnd;var a=game.SysTime.curTime,i=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),n=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),s=game.TimeUtil.getOpenDayByStr(e.startTime);return a<=i&&a<n&&s>=e.serverStart&&s<e.serverEnd},getSummonLuckWeightCfg:function(){return game.recruitData.getSummonLuckWeightCfg(this.id,this.selectId)},setAwards:function(e){this.awards||(this.awards=[]),-1<this.awards.indexOf(e)?b8e.warn("\u5df2\u9886\u53d6\u8fc7\u5956\u52b1\u79ef\u5206:",e):this.awards.push(e)},clearAwards:function(){!this.awards||this.awards.length<1||(this.awards.length=0)},checkAlert:function(){var e=this,t=e.cfg,a=!1;if(0<t.freeNum&&(a=t.freeNum>e.freeNum),a)return e.isAlert=a;var i=game.recruitData.getBaseCfgs(t.id);if(!i||i.length<1)return e.isAlert=a;for(var n=void 0,s=i.length,r=0;r<s&&(!(n=i[r].costItems)||n.length<1||!(a=game.UpgradeUtil.checkItemList(n,1,!1)));r++);var o=game.recruitData.getAwardCfgs(t.id,e.selectId);if(o&&0<o.length){e.awards||(e.awards=[]),s=o.length;for(var g=void 0,u=0;u<s&&!a;u++)g=o[u],a=e.awardScore>=g.score&&e.awards.indexOf(g.score)<0}return e.isAlert=a}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RecruitInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,setData:function(e){this.id=e,this.active=!0,this.cfg=game.PartnerCfg.getData(e),this.normalUrl=10115,this.isShowName=!0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,64),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$RecruitPreviewInfo",t)}(),function(){var e=game.Control.extends({init:function(){this.recruitAlert=game.spotAlert.set(game.SAE.RECRUIT),this.recruitSelectAlert=game.spotAlert.set(game.SAE.RECRUIT_SELECT,game.SAE.RECRUIT)},ipc:function(){var e=this;e.handels={SummonResp:e.summonResp,SummonSelectResp:e.summonSelectResp,SummonSelectMsg:e.summonSelectMsg,SummonAwardResp:e.summonAwardResp,SummonElementResp:e.summonElementResp},e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.initOpenserver,C2C_CHANGE_OPENSERVER_OPEN:e.updateOpen},Back:{C_BACK_SYN_BACK_INFO:e.updateItem,C_BACK_UPDATE_ITEMINFO:e.updateItem},Partner:{C2C_SHOW_ACTIVETIPS_COMPLETE:e.showPartnerComplete},MainRole:{C_INIT_SERVER_DATA:e.setOpenList,C_RESET_DAILY:e.setOpenList},PushPrize:{C2C_DELAY_SHOW_VIEW:e.delayShowPushPrizeView}}},summonResp:function(e){var t=e.readProtobuf(game.pb.SummonResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this;game.recruitData.isElement=!1,game.recruitData.summonResp(t.id,t.awardScore,t.luckScore);var i=t.partners;a.showItems||(a.showItems=[]),a.showItems.length=0;var n=t.items,s=void 0,r=void 0,o=(n=game.CCommonUtil.getRandomArr(n)).length;a.dpt(a.Evts.C2C_CHOUJIANG_LEN,o),b8e.module.isShowView(game.ME.RecruitSubB)&&9<o&&b8e.evt.dptG(game.PushTipEvts.C2C_FINISH_CHOUJIANG,game.ME.RecruitSubB);for(var g=game.partnerData.partnerActiveTips.length=0;g<o;g++)s=n[g],(r=game.ItemInfoCfg.getData(s.id))&&r.itemType!=game.ItemType.Hunlu&&a.showItems.push(s);game.recruitData.activePartner=i,a.showPartnerComplete(!1),i&&0<i.length&&a.dpt(a.Evts.C2C_ACTIVE_PARTNER,i),a.send(a.Evts.C2V_RECRUIT_COMPLETE);var u=a.recruitSelectAlert.alert;a.checkSelectAlert(),a.checkAlert(),u!=a.recruitSelectAlert&&game.recruitData.forceRefreshLockIds(),a.dpt(a.Evts.C2C_UPDATE_FANLI_SCORE,t.id),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeConsume)}},summonElementResp:function(e){var t=e.readProtobuf(game.pb.SummonElementResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this;game.recruitData.isElement=!0,game.recruitData.summonElementResp(t.id,t.elementScore);var i=t.partners;a.showItems||(a.showItems=[]),a.showItems.length=0;for(var n=t.items,s=void 0,r=void 0,o=n.length,g=game.partnerData.partnerActiveTips.length=0;g<o;g++)s=n[g],(r=game.ItemInfoCfg.getData(s.id))&&r.itemType!=game.ItemType.Hunlu&&a.showItems.push(s);game.recruitData.activePartner=i,a.showPartnerComplete(!1),i&&0<i.length&&a.dpt(a.Evts.C2C_ACTIVE_PARTNER,i),a.send(a.Evts.C2V_ELEMENT_RECRUIT_COMPLETE);var u=game.SummonOpenCfg.getData(t.id);!u||t.elementScore<u.openElementScore?game.module.hide(game.ME.RecruitElement):a.send(a.Evts.C2V_UPDATE_COUNT)}},showPartner:function(){this.dpt(this.Evts.C2C_SHOW_PARTNER)},summonSelectResp:function(e){var t=e.readProtobuf(game.pb.SummonSelectResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.recruitData.summonSelectResp(t.id,t.selectId,t.selectNum),this.send(this.Evts.C2V_REFRESH_SELECT_ID)}},summonSelectMsg:function(e){var t=e.readProtobuf(game.pb.SummonSelectNotify);game.recruitData.summonSelectMsg(t.infos);this.send(this.Evts.C2V_REFRESH_SELECT_ID)},summonAwardResp:function(e){var t=e.readProtobuf(game.pb.SummonAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.recruitData.summonAwardResp(t.id,t.score,t.awardScore,t.selectId)&&this.send(this.Evts.C2V_REFRESH_SELECT_ID),this.send(this.Evts.C2V_GET_SCORE_AWARD)}},initOpenserver:function(e){if(e&&e.data){var t=game.recruitData;t.initRecruitList(),t.setOpenList(),t.setupData(e.data.summonDatas),this.checkSelectAlert(),this.checkAlert()}},setOpenList:function(){game.recruitData.setOpenList(),this.checkSelectAlert(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_LIST)},updateItem:function(){this.checkSelectAlert(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_ITEM)},showPartnerComplete:function(e){this.showItems&&(game.awardsData.title="",game.awardsData.setItemsByArray(this.showItems,!1),game.awardsData.setCompleteCb(e,this),game.module.show(game.ME.RecruitShowItem),this.showItems=null)},updateOpen:function(e){if(e&&e.data&&e.data==game.OpenServerType.RECRUIT_REBATE){game.recruitData.setOpenList(),this.send(this.Evts.C2V_UPDATE_LIST)}},notify:function(e,t,a,i){var n=this;switch(e){case n.Evts.V2C_CLICK_AWARD_BOX:n.sender.SummonAwardReq(t,a,i);break;case n.Evts.V2C_SELECT_ID:n.selectId(t);break;case n.Evts.V2C_SELECT_AS_ID:game.recruitData.activityId=t;var s=game.recruitData.getInfoById(t);if(!s)return;s.selectId=a,n.selectId(t);break;case n.Evts.V2C_PREVIEW_BOX:n.preObj||(n.preObj=b8e.createMap()),n.preObj.okCall=n.okCall,(n.preObj.thisArg=n).preObj.awards=t.giveItems,n.preObj.title=51753,n.preObj.btnStr=51754,n.dpt(n.Evts.C2C_PREVIEW_BOX,n.preObj);break;case n.Evts.V2C_CLOSE_PARTNER_VIEW:n.send(n.Evts.C2V_SHOW_CARD_CONTINUE)}},okCall:function(){game.module.hide(game.ME.AwardPreviewTip)},selectId:function(e){var t=game.SummonOpenCfg.getData(e);if(t)switch(game.module.hide(game.ME.RecruitSubA),game.module.hide(game.ME.RecruitSubB),game.module.hide(game.ME.RecruitShowItem),game.recruitData.activityId=e,t.pageType){case 1:game.module.show(game.ME.RecruitSubA);break;case 2:game.module.show(game.ME.RecruitSubB);break;case 3:if(!t.activityType)return void b8e.warn("\u4f19\u4f34\u53ec\u5524\u6ca1\u6709\u914d\u7f6e\u5f00\u670d\u6d3b\u52a8\u7c7b\u578b  id\uff1a"+e);this.openObj||(this.openObj=b8e.createMap()),this.openObj.openServerType=t.activityType,this.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,this.openObj)}},one_btn:function(){this.summonReqBtn(1)},ten_btn:function(){1e3==game.taskData.getTaskId()&&game.sdk.traceLog(6);var e=game.recruitData.activityId,t=game.recruitData.getLockId(e);if(t&&!this.firstEnter){var a=game.recruitData.getInfoById(e),i=game.SummonOpenCfg.getData(t);if(i&&a&&a.totalNum>=i.unlockNum)if(this.firstEnter=!0,game.loadActiveShowData.showTodayView(game.LoadActiveShowType.FIX_SELECT_RECRUIT))return}this.summonReqBtn(10)},summonReqBtn:function(e){var t,a=this,i=game.recruitData.activityId,n=game.recruitData.getInfoById(i);if(n){t=0<n.unlockId?n.selectId:0;var s=game.recruitData.getBaseCfg(i,e);if(s)if(1==e&&n.cfg&&n.freeNum<n.cfg.freeNum)a.sender.SummonReq(s.id,0,t);else if(a.maxScore=game.recruitData.getMaxAwardScore(i,n.selectId),s.hasScoreAward&&n.awardScore>=a.maxScore)game.notice.show(51897);else{var r=s.costItems,o=s.costItems2,g=s.costAmounts&&0<s.costAmounts.length;if(r&&0<r.length){if(game.UpgradeUtil.checkItemList(r,1,!1))return void a.sender.SummonReq(s.id,1,t);if(o&&0<o.length&&game.UpgradeUtil.checkItemList(o,1,!1))return void a.sender.SummonReq(s.id,2,t);if(!g){var u=r[0],l=game.itemData.getCountById(u.Id);game.AccessShopView.inst().showView(u.Id,!0,u.Num-l)}}if(g){var c=s.costAmounts[0],h=c.Id,m=game.ItemInfoCfg.getData(h);if(!m)return void b8e.warn("\u4e0d\u5b58\u5728id\u914d\u7f6e:"+h);var d=m.cfgType==game.ItemCfgType.Amount;if(!game.UpgradeUtil.checkItemList(s.costAmounts,1,d)){if(!d){var f=game.itemData.getCountById(h),p=game.recruitData.getAutoBuyById(i),v=c.Num-f;if(p){if(!m.shopGoodsId||m.shopGoodsId.length<1)return void b8e.error("\u6ca1\u6709\u914d\u7f6e\u5546\u54c1id");var E=m.shopGoodsId[0],T=game.ShopItemCfg.getDataByGoodsId(E);if(!game.UpgradeUtil.checkItemList(T.costItems,v,!1))return void game.notice.show(113);a.buyData||(a.buyData=b8e.createMap(),a.buyData.buyComplete=b8e.createMap()),a.buyData.goodsId=E,a.buyData.count=v,a.buyData.buyComplete.callback=a.buyCompleteCb,(a.buyData.buyComplete.thisArg=a).buyData.buyComplete.params=[v,v,s.id],a.dptG(game.ShopGEvts.BUY_ITEM,a.buyData)}else game.AccessShopView.inst().showView(h,!0,v,a.buyCompleteCb,a,s.id)}return}}a.sender.SummonReq(s.id,0,t)}}},buyCompleteCb:function(e){if(e&&!(e.length<3)){var t=e[0],a=e[1],i=e[2],n=e[3];t<a||this.sender.SummonReq(i,0,n)}},refreshBtn:function(){var e=game.recruitData.getCurSelectInfo();if(e&&e.selectId){var t=game.recruitData.getCostCfg(e.id,e.selectNum);if(t){var a=this._alertOptions;(a=a||(this._alertOptions={lang:51876,okcb:this._refreshId,thisArg:this})).langArgs=[t.cost],a.args=[e.id,e.selectId,t.cost],game.alert.showTwo(a)}}},_refreshId:function(e,t,a){game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,a)&&this.sender.SummonSelectReq(e,t)},addBtn:function(){var e=game.recruitData.activityId,t=game.recruitData.getBaseCfg(e,1);if(t){var a=t.recommendItemId;a?game.AccessShopView.inst().showView(a,!0):b8e.error("\u6ca1\u6709\u914d\u7f6e\u6d88\u8017\u7269\u54c1")}},pre_btn:function(){game.module.show(game.ME.RecruitPreView)},skipBtn:function(){this.send(this.Evts.C2V_UPDATE_SKIP_BTN)},buyBtn:function(){game.recruitData.setAutoBuyById(game.recruitData.activityId),this.send(this.Evts.C2V_UPDATE_AUTO_BUY_BTN)},btn_1:function(){this.send(this.Evts.C2V_SWITCH_PAGE,0)},helpBtn:function(){var e=game.SummonOpenCfg.getData(game.recruitData.activityId);e&&game.RuleView.inst().showViewByKeys(e.ruleKey,e.title)},mapBtn:function(){game.module.show(game.ME.MyMap)},upBtn:function(){var e=game.SummonOpenCfg.getData(game.recruitData.activityId);e&&(game.mainRoleData.vipLevel<e.elementVip&&game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE),game.module.hide(game.ME.RecruitAlert))},elementNode_0:function(){this.elementSelect(0)},elementNode_1:function(){this.elementSelect(1)},elementNode_2:function(){this.elementSelect(2)},elementNode_3:function(){this.elementSelect(3)},elementSelect:function(e){game.recruitData.elementSelect=e,this.send(this.Evts.C2V_UPDATE_SELECT)},elementSummonBtn:function(){var e=game.recruitData.activityId,t=game.SummonOpenCfg.getData(e);if(t&&t.elementStore&&!(t.elementStore.length<1)){var a=t.elementStore[game.recruitData.elementSelect];a&&this.sender.SummonElementReq(e,a)}},elementClick:function(){var e=game.recruitData.activityId,t=game.SummonOpenCfg.getData(e);if(t){var a=game.recruitData.getInfoById(e);a&&(a.elementScore<t.openElementScore||game.mainRoleData.vipLevel<t.elementVip?game.module.show(game.ME.RecruitAlert):game.module.show(game.ME.RecruitElement))}},delayShowPushPrizeView:function(){b8e.module.isShowView(game.ME.RecruitShowItem)&&(game.recruitData.showPushPrize=!0)},fixSelectBtn:function(){var e=game.recruitData.activityId,t=game.recruitData.getLockId(e);if(t){var a=game.recruitData.getInfoById(e),i=game.SummonOpenCfg.getData(t);if(i){var n=i.unlockNum-a.totalNum;0<n?game.notice.show(53375,n):game.module.show(game.ME.RecruitSelectMain)}}},leftBtn:function(){this.selectIndex(!0)},rightBtn:function(){this.selectIndex(!1)},selectIndex:function(e){var t=game.recruitData.activityId,a=game.recruitData.getInfoById(t),i=game.SummonOpenCfg.getData(t);if(a&&i&&a.selectId&&i.fixSelectIds&&!(i.fixSelectIds.length<1)){var n=i.fixSelectIds.indexOf(a.selectId);if(!(n<0)){var s=0,r=i.fixSelectIds.length;s=e?n<1?r-1:n-1:r-2<n?0:n+1,a.selectId=i.fixSelectIds[s],this.send(this.Evts.C2V_UPDATE_PAGE)}}},checkAlert:function(){this.recruitAlert.alert=game.recruitData.checkAlert()},checkSelectAlert:function(){this.recruitSelectAlert.alert=game.recruitData.checkSelectAlert()}}),t=[game.ME.RecruitMain,game.ME.RecruitSubA,game.ME.RecruitSubB,game.ME.RecruitShowItem,game.ME.RecruitElement,game.ME.RecruitAlert,game.ME.RecruitPartner,game.ME.RecruitSelectMain,game.ME.RecruitSelect],a=game.Sender.extends({ipc:function(){this.msg={SummonReq:this.summonReq,SummonSelectReq:this.summonSelectReq,SummonAwardReq:this.summonAwardReq,SummonElementReq:this.summonElementReq}},summonReq:function(e,t,a){var i=game.pb.SummonRequest;i.id=e,i.useItem=t,i.selectId=a,b8e.net.getBytes().writeProtobuf(i)},summonSelectReq:function(e,t){var a=game.pb.SummonSelectRequest;a.id=e,a.selectId=t,b8e.net.getBytes().writeProtobuf(a)},summonAwardReq:function(e,t,a){var i=game.pb.SummonAwardRequest;i.id=e,i.score=t,i.selectId=a,b8e.net.getBytes().writeProtobuf(i)},summonElementReq:function(e,t){var a=game.pb.SummonElementRequest;a.id=e,a.store=t,b8e.net.getBytes().writeProtobuf(a)}});b8e.module.registerControl(game.ME.Recruit,e,game.RecruitEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={}},btn_1:function(){this.send(this.Evts.V_SELECT_CHANGE,0)},btn_2:function(){this.send(this.Evts.V_SELECT_CHANGE,1)},btn_3:function(){this.send(this.Evts.V_SELECT_CHANGE,2)},btn_4:function(){this.send(this.Evts.V_SELECT_CHANGE,3)},selectToggle:function(e){this.send(this.Evts.V_SELECT_CHANGE,e)}}),t=[game.ME.RecruitSubPreView1,game.ME.RecruitSubPreView2,game.ME.RecruitSubPreView3,game.ME.RecruitSubPreView4];b8e.module.registerControl(game.ME.RecruitPreView,e,game.RecruitPreViewEvts,null,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(159),this.setSize(114,147)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.addToParent(this.skin.icon),this.skin.headSelect.active=!1,this.skin.redPoint.active=!1},setData:function(e){e&&this.icon.setData(e)},touchIcon:function(){this.data&&this.data.cfg&&this.data.cfg.id&&(game.partnerData.setShowInfo(this.data.cfg.id),game.module.show(game.ME.PartnerDetails))}}),b8e.RC("$$game","$$RecruitPreViewItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1434),this.toggles={toggle_btn_1:game.ME.RecruitSubPreView1,toggle_btn_2:game.ME.RecruitSubPreView2,toggle_btn_3:game.ME.RecruitSubPreView3,toggle_btn_4:game.ME.RecruitSubPreView4}},init:function(){var e=this.skin;this.btns=[e.btn_1,e.btn_2,e.btn_3,e.btn_4]},notify:function(e,t){switch(e){case this.Evts.V_SELECT_CHANGE:this.toggleSelect(t)}},onShow:function(){var e=game.recruitData.getCurCfg();switch(e?e.showType:0){case 0:this.btns[1].active=!1,this.btns[2].active=!1,this.btns[3].active=!1,this.skin.btn_label_1.string=game.Lang.get(51923);break;case 1:this.btns[1].active=!0,this.btns[2].active=!0,this.btns[3].active=!0,this.skin.btn_label_1.string=game.Lang.get(51924)}},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(e-this.width>>1,t+this.height>>1)}});b8e.module.registerView(game.ME.RecruitPreView,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1433)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.RecruitPreViewItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=11,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.list)},onShow:function(){var e=this.moduleEnum-23051,t=game.recruitData.createPreView(e);t&&1<t.length&&t.sort(this._sort),this.list.setData(t)},_sort:function(e,t){return e.cfg.quality>t.cfg.quality?-1:e.cfg.quality<t.cfg.quality?1:e.id-t.id},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.RecruitSubPreView1,e),b8e.module.registerView(game.ME.RecruitSubPreView2,e),b8e.module.registerView(game.ME.RecruitSubPreView3,e),b8e.module.registerView(game.ME.RecruitSubPreView4,e)}(),function(){var e;(e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1400),this.setSize(620,330)},setData:function(){var e=this,t=e.data;if(t&&t.cfg){var a=e.skin,i=e.cfg=t.cfg,n=i.costPos;a.costNode.x=n?n.X:216,a.costNode.y=n?n.Y:-216;var s=0<i.freeNum;a.costTime.active=s,a.red_spot.active=t.isAlert,a.bg.loadTexture(game.ResCfg.getUrl(10117,i.bg));var r=game.recruitData.getLockId(t.id),o=!1,g=!1;if(0<r){var u=game.recruitData.getInfoById(t.id),l=game.SummonOpenCfg.getData(r);if(!l)return;o=l.unlockNum<=u.totalNum,g=game.recruitData.checkLockAlert(r)}if(a.fixSelectBtn.active=o,a.fixSelectSpotAlert.active=g,s){var c=i.freeNum>t.freeNum;if(a.costNum.active=!c,a.red_spot.setPosition(58,18),c)a.time.string=game.Lang.get(51875);else{a.red_spot.setPosition(90,-20);var h=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,1),m=h-game.SysTime.curTime;if(0<m){var d=b8e.TimeUtil.formatTime(m);a.time.string=game.Lang.get(51872,d),e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),e.endTime=h,e._timer.reset(),e._timer.start(),e.updateCostInfo()}else e.stopTime(),a.costNum.string=game.Lang.get(51875)}}else a.red_spot.setPosition(90,-20),e.stopTime(),a.costNum.active=!0,e.updateCostInfo()}},updateCostInfo:function(){if(this.cfg){var e=this.cfg,t=game.recruitData.getBaseCfg(e.id,1);if(t&&(t.costItems||t.costAmounts)){var a=t.costItems,i=t.costAmounts,n=!i||i.length<1;if(a&&0<a.length){var s=a[0].Id;if(game.itemData.getCountById(s)>=a[0].Num||n)return void this.setCostNum(s,a[0].Num)}n||this.setCostNum(i[0].Id,i[0].Num)}}},setCostNum:function(e,t){this.skin.num.string=t;var a=game.ItemInfoCfg.getData(e);a&&this.skin.icon.loadTexture(game.ResCfg.getUrl(137,a.icon))},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return this.stopTime(),void(e.time.string=game.Lang.get(51875));var t=this.endTime-game.SysTime.curTime;if(t<1)return this.stopTime(),void(e.time.string=game.Lang.get(51875));var a=b8e.TimeUtil.formatTime(t);e.time.string=game.Lang.get(51872,a)},stopTime:function(){this._timer&&this._timer.stop()},clickBtn:function(){this.send(game.RecruitEvts.V2C_SELECT_ID,this.data.id)},fixSelectBtn:function(){game.recruitData.activityId=this.data.id;var e=game.recruitData.getLockId(this.data.id);if(e){var t=game.recruitData.getInfoById(this.data.id),a=game.SummonOpenCfg.getData(e);if(a){var i=a.unlockNum-t.totalNum;0<i?game.notice.show(53375,i):game.module.show(game.ME.RecruitSelectMain)}}}})).poolCall=!0,b8e.RC("$$game","$$RecruitAItem",e)}(),function(){var e;e=game.Widget.extends({_itemGrid:null,ctor:function(){this._super(1402)},loadComplete:function(){if(this.hide(),this.data){this.show(this.data)}},show:function(e){this.data=e,this._super()},onShow:function(){this.setData(this.data),this.setVisible(!0)},onHide:function(){this.setVisible(!1)},setData:function(e){if(e){var t=this.skin,a=(this.cfg=e).score;t.score.string=game.Lang.get(51874,a),t.box.loadTexture(game.ResCfg.getUrl(10120,e.boxImg)),this.updateState()}},updateState:function(){if(this.cfg&&this.skin){var e=this.cfg,t=game.recruitData.isGetAward(e.id,e.score);this.skin.getImg.active=t;var a=game.recruitData.getAwardScore(e.id);this.skin.red_spot.active=!t&&a>=e.score}},box:function(){if(this.cfg){var e=this.cfg,t=e.score,a=e.id,i=game.SummonOpenCfg.getData(a),n=i&&0<i.unlockId?e.selectId:0;game.recruitData.getAwardScore(a)<t||game.recruitData.isGetAward(t)?b8e.module.sendToControl(game.ME.Recruit,[game.RecruitEvts.V2C_PREVIEW_BOX,e]):b8e.module.sendToControl(game.ME.Recruit,[game.RecruitEvts.V2C_CLICK_AWARD_BOX,a,t,n])}},clearData:function(){this.skin.box.unloadTexture()}}),b8e.RC("$$game","$$RecruitAwardBox",e)}(),function(){var e;(e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1401),this.setSize(620,330)},setData:function(){var e=this,t=e.data;if(t&&t.cfg){var a=e.skin,i=e.cfg=t.cfg;if(a.bg.loadTexture(game.ResCfg.getUrl(10119,i.bg)),e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),i.endTime)e.endTime=b8e.TimeUtil.dateParse(i.endTime).getTime();else{var n=i.serverEnd-game.miscData.openServerDay;e.endTime=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,n)}e._timer.reset(),e._timer.start()}},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return this.stopTime(),void(e.time.string="");var t=this.endTime-game.SysTime.curTime;if(t<1)return this.stopTime(),void(e.time.string="");var a=game.TimeUtil.formatTimeSpace(t);e.time.string=game.Lang.get(51873,a)},stopTime:function(){this._timer&&this._timer.stop()},clickBtn:function(){this.send(game.RecruitEvts.V2C_SELECT_ID,this.data.id)}})).poolCall=!0,b8e.RC("$$game","$$RecruitBItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1403),this.toggles={toggle_btn_1:game.ME.Recruit},this.spotAlerts={RECRUIT:this.spotAlert}},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_PAGE:this.toggleSelect(t)}},onShow:function(){this.skin.btn_label_1.string=game.Lang.get(53374)},spotAlert:function(e){this.skin.red_spot_1.active=e.alert}});b8e.module.registerView(game.ME.RecruitMain,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1404)},init:function(){var e=this.gridList=new game.List;e.itemRender=[game.RecruitAItem,game.RecruitBItem],e.addToParent(this.skin.list),e.bindEnum=this.moduleEnum,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5,e.touchMovable=!1,game.spotAlert.setCb(game.SAE.MY_MAP,this.updateMapAlert,this)},updateMapAlert:function(e){this.skin.red_map.active=e.alert},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_LIST:case this.Evts.C2V_UPDATE_ITEM:this.updateList()}},onShow:function(){this.updateList(),this.skin.mapBtn.active=!0},$$getRecruitItem:function(e){if(!this.gridList||!this.showList||!this.showList.length)return null;var t=this.gridList._container._layoutContent[e].skin;return t?t.clickBtn:null},updateList:function(){this.showList=game.recruitData.getShowList(),this.gridList.setData(this.showList)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.Recruit,e)}(),function(){var e,t=e=game.View.extends({ctor:function(e){e=e||1399,this._super(e)},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_SKIP_BTN:game.recruitData.setSkipById(game.ME.RecruitSubA),t.updateSkipBtn();break;case t.Evts.C2V_UPDATE_ITEM:t.updateOneItemToAmount(),t.updateCost(10),t.updateSpotAlert();break;case t.Evts.C2V_RECRUIT_COMPLETE:t.updateOneItemToAmount(),t.updateElementBox();break;case t.Evts.C2V_ELEMENT_RECRUIT_COMPLETE:t.updateElementBox()}},onShow:function(){var e=this,t=game.recruitData,a=e.activityId=t.activityId;if(e.activityId){var i=e.openCfg=game.SummonOpenCfg.getData(a);i&&(e.updateTopBanner(),e.skin.elementBox.loadTexture(game.ResCfg.getUrl(10198,i.id)),e.updateTitleImg(),t.skipModuleId=game.ME.RecruitSubA,e.updateSkipBtn(),e.updateOneItemToAmount(),e.updateCost(10),e.updateBtnDesc(1),e.updateBtnDesc(10),e.updateSpotAlert(),e.updateElementBox())}},onHide:function(){b8e.Tween.kill(this.skin.elementBox)},updateTopBanner:function(){var e=this.openCfg;if(e){var t=game.recruitData.getInfoById(this.activityId);if(t){var a=e.bg,i=e.fixSelectIds;if(i&&0<i.length){var n=i.indexOf(t.selectId);if(-1<n){this.topBgArr||(this.topBgArr=[]);var s=this.topBgArr[this.activityId];a=(s=s||(this.topBgArr[this.activityId]=e.bg.split("|")))[n]?s[n]:""}}a?this.skin.top_banner.loadTexture(game.ResCfg.getUrl(10118,a)):b8e.error("\u6ca1\u6709\u8bbe\u7f6e\u6807\u9898")}}},updateTitleImg:function(){var e=this.openCfg;if(e){var t=game.recruitData.getInfoById(this.activityId);if(t){var a=e.titleImg,i=e.fixSelectIds;if(i&&0<i.length){var n=i.indexOf(t.selectId);if(-1<n){this.titleArr||(this.titleArr=[]);var s=this.titleArr[this.activityId];a=(s=s||(this.titleArr[this.activityId]=e.titleImg.split("|")))[n]?s[n]:""}}if(a){var r=game.ResCfg.getUrl(10201,a);this.skin.titleLab.loadTexture(r)}else b8e.error("\u6ca1\u6709\u8bbe\u7f6e\u6807\u9898")}}},updateSkipBtn:function(){this.skin.skipSelect.active=game.recruitData.getSkipById(game.ME.RecruitSubA)},updateOneItemToAmount:function(){var e=this;if(e.openCfg){var t=e.activityId,a=game.recruitData;if(a.getBaseCfg(t,1)){var i=a.getInfoById(t);if(i){var n=e.skin,s=0<e.openCfg.freeNum&&e.openCfg.freeNum>i.freeNum;if(n.one_bottom_desc.active=s,n.one_bottom_cost.active=!s,n.red_spot.active=s,n.cost_icon_1.active=!s,n.cost_num_1.active=!s,n.one_top_time.active=!s,s)e.stopTime();else{var r=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,1),o=r-game.SysTime.curTime;if(0<o){var g=b8e.TimeUtil.formatTime(o);n.one_top_time.string=game.Lang.get(51872,g),e.endTime=r,e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),e._timer.reset(),e._timer.start()}e.updateCost(1)}}}else b8e.error("\u53ec\u5524\u6d3b\u52a8\u6ca1\u6709\u914d\u7f6e\u5355\u6b21\u53ec\u5524",t)}},updateTenItemToAmount:function(){this.updateCost(10)},updateCost:function(e){var t=this.activityId,a=game.recruitData.getBaseCfg(t,e);if(a){var i=a.costItems,n=a.costItems2,s=this.getComponent("cost_icon_"+e),r=this.getComponent("cost_num_"+e);if(s&&r){var o=void 0,g=void 0;if(i&&0<i.length&&(g=i[0].Id,(o=i[0].Num)<=game.itemData.getCountById(g)))this.setCost(s,r,g,o);else if(n&&0<n.length&&(g=n[0].Id,(o=n[0].Num)<=game.itemData.getCountById(g)))this.setCost(s,r,g,o);else{var u=a.costAmounts;u&&0<u.length&&this.setCost(s,r,u[0].Id,u[0].Num)}}else b8e.error("\u7f3a\u5c11\u53ef\u8bbe\u7f6e\u8282\u70b9 count",e)}else b8e.error("\u53ec\u5524\u6d3b\u52a8\u6ca1\u6709\u914d\u7f6e\u5341\u6b21\u53ec\u5524",t)},updateBtnDesc:function(e){var t=this.activityId,a=game.recruitData.getBaseCfg(t,e);if(a){var i=this.getComponent("btn_desc_"+e),n=this.getComponent("btn_lab_"+e);if(i&&n){var s=a.btnDesc?-11:0;i.string=a.btnDesc,n.y=s}else b8e.error("\u7f3a\u5c11\u53ef\u8bbe\u7f6e\u8282\u70b9 count",e)}else b8e.error("\u53ec\u5524\u6d3b\u52a8\u6ca1\u6709\u914d\u7f6e\u5341\u6b21\u53ec\u5524",t)},setCost:function(e,t,a,i){if(e&&a){var n=game.ItemInfoCfg.getData(a);if(n){e.loadTexture(game.ResCfg.getUrl(137,n.icon));var s=game.itemData.getCountById(a),r=s<i?503:504;t.string=game.Lang.get(r,s,i);var o=e.width+t.width;e.x=-o/2,t.x=e.width-o/2}}},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return e.one_top_time.string="",void this.stopTime();var t=this.endTime-game.SysTime.curTime;if(t<1)return e.one_top_time.string="",void this.stopTime();var a=b8e.TimeUtil.formatTime(t);e.one_top_time.string=game.Lang.get(51872,a)},stopTime:function(){this._timer&&this._timer.stop()},closeBtn:function(){this.closeView()},returnBtn:function(){this.closeView()},closeView:function(){game.module.hide(this.moduleEnum)},updateSpotAlert:function(){var e=this.skin,t=this.openCfg;if(t){var a=game.recruitData,i=this.activityId,n=a.getInfoById(i);if(n){var s=0<t.freeNum&&t.freeNum>n.freeNum,r=a.getBaseCfg(i,1);!r||r.costItems.length<1?e.red_spot.active=!1:e.red_spot.active=s||game.UpgradeUtil.checkItemList(r.costItems,1,!1),!(r=a.getBaseCfg(i,10))||r.costItems.length<1?e.red_spot_2.active=!1:e.red_spot_2.active=game.UpgradeUtil.checkItemList(r.costItems,1,!1)}}},updateElementBox:function(){this.elementWidith||(this.elementWidith=this.skin.barGreen1.width);var e=this.activityId,t=game.SummonOpenCfg.getData(e);if(t){var a=game.recruitData.getInfoById(e);if(a){var i=this.skin,n=a.elementScore/t.openElementScore;n=1<n?1:n,i.barGreen1.width=this.elementWidith*n,i.attLab1.string=a.elementScore+"/"+t.openElementScore,n<1?(b8e.Tween.kill(i.elementBox),i.elementBox.rotation=0):b8e.Tween.get(i.elementBox,{loop:!0}).to({rotation:-15},200).to({rotation:0},200).to({rotation:15},200).to({rotation:0},200)}}}});b8e.module.registerView(game.ME.RecruitSubA,t),b8e.RC("$$game","$$RecruitSubAView",e)}(),function(){var e=game.RecruitSubAView.extends({curIndex:0,maxScore:0,maxWidth:0,ctor:function(){this._super(1398)},init:function(){this.maxWidth=this.skin.progress.width,game.spotAlert.setCb(game.SAE.RECRUIT_SELECT,this.updateRSAlert,this)},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_SKIP_BTN:game.recruitData.setSkipById(game.ME.RecruitSubB),t.updateSkipBtn();break;case t.Evts.C2V_UPDATE_ITEM:t.updateCost(1),t.updateCost(10),t.updateLeftTop(),t.updateSpotAlert();break;case t.Evts.C2V_REFRESH_SELECT_ID:t.curIndex=0,t.setDesc(),t.showModel(),t.startLoopShowModel(),t.setAwardList();break;case t.Evts.C2V_GET_SCORE_AWARD:case t.Evts.C2V_RECRUIT_COMPLETE:t.updateAwardList(),t.updateProgress(),t.updateElementBox(),t.setInfoPage(!1);break;case t.Evts.C2V_ELEMENT_RECRUIT_COMPLETE:t.updateElementBox();break;case t.Evts.C2V_UPDATE_AUTO_BUY_BTN:t.updateBuyBtn();break;case t.Evts.C2V_UPDATE_PAGE:t.updatePage()}},updatePage:function(){var e=this,t=game.recruitData,a=e.activityId=t.activityId;if(e.activityId){var i=e.openCfg=game.SummonOpenCfg.getData(a);i&&(e.updateTopBanner(),e.skin.elementBox.loadTexture(game.ResCfg.getUrl(10198,i.id)),e.updateTitleImg(),e.curIndex=0,t.skipModuleId=game.ME.RecruitSubB,e.updateSkipBtn(),e.updateCost(1),e.updateCost(10),e.setAwardList(),e.updateProgress(),e.updateBtnDesc(1),e.updateBtnDesc(10),e.showModel(),e.startLoopShowModel(),e.updateLeftTop(),e.updateSpotAlert(),e.updateElementBox(),e.updateBuyBtn(),e.setInfoPage(!0),e.updateSelectBtn())}},onShow:function(){this.updatePage()},onHide:function(){this._super();var e=this.skin;b8e.Tween.kill(e.model),e.model.alpha=1,e.enterTips.active=!1,b8e.Tween.kill(e.enterTips)},updateSelectBtn:function(){if(this.activityId){var e=this.skin,t=game.recruitData.getFixSelectIdsIndex(this.activityId);e.leftBtn.active=-1!=t,e.rightBtn.active=-1!=t}},updateRSAlert:function(e){this.skin.fixSelectSpotAlert.active=e.alert},setAwardList:function(){var e=this;e.cfgObj||(e.cfgObj=b8e.createMap());var t=game.recruitData.getInfoById(e.activityId);if(t){e.maxScore=0,e.clearAwardBox(),e.awardList||(e.awardList=[]),e.awardPool||(e.awardPool=[]),e.awardList.length=0;var a=game.recruitData.getAwardCfgs(e.activityId,t.selectId);if(a&&!(a.length<1)){var i=void 0,n=void 0,s=a.length;e.maxScore=game.recruitData.getMaxAwardScore(e.activityId,t.selectId);for(var r=0;r<s;r++)i=a[r],e.awardPool[r]||(e.awardPool[r]=new game.RecruitAwardBox),(n=e.awardPool[r]).parent||n.addToParent(e.skin.list),n.show(i),n.x=e.skin.list.width*i.score/e.maxScore,e.awardList.push(n)}}},updateAwardList:function(){if(this.awardList&&!(this.awardList.length<1))for(var e=this.awardList.length,t=0;t<e;t++)this.awardList[t].updateState()},updateProgress:function(){var e=this.skin,t=game.recruitData.getInfoById(this.activityId);if(!t||!this.maxScore)return e.progress.width=0,e.score.string="",void(e.luckyCountDesc.string="");var a=t.awardScore;a=a>this.maxScore?this.maxScore:a,e.progress.width=this.maxWidth*a/this.maxScore,e.score.string=game.Lang.get(51874,a);var i=t.getSummonLuckWeightCfg();if(i&&i.storeLang){var n=i.storeSpace-t.luckScore%i.storeSpace;e.luckyCountDesc.string=game.Lang.get(i.storeLang,n)}else e.luckyCountDesc.string=""},clearAwardBox:function(){if(this.awardPool&&!(this.awardPool.length<1))for(var e=this.awardPool.length,t=0;t<e;t++)this.awardPool[t].hide()},setInfoPage:function(e){this.clearTopDesc();var t=this.skin,a=game.recruitData.getLockId(this.activityId);if(t.skipBtn.y=a?-240:-127,t.skipDesc.y=a?-240:-127,a){var i=game.recruitData.getInfoById(this.activityId),n=game.SummonOpenCfg.getData(a);if(n){t.lockRecruitNode.active=!0;var s=n.unlockNum-i.totalNum,r=0<s;if(t.lockNum.string=r?game.Lang.get(53372,s):game.Lang.get(53373),!r&&!this.firstEnter&&e){this.firstEnter=!0;var o=t.enterTips;o.active=!0,b8e.Tween.get(o).to({y:o.y+30},2e3).call(this.showEnterTipsComplete,this)}}}else t.lockRecruitNode.active=!1},showEnterTipsComplete:function(){this.skin.enterTips.active=!1},clearTopDesc:function(){this.stopTime(),this.skin.infoNode.active=!1,this.skin.skipBtn.y=-127,this.skin.skipDesc.y=-127},setDesc:function(){var e=this.getSummonLuckWeightCfg();if(e){var t=this.skin;t.top_banner.loadTexture(game.ResCfg.getUrl(10118,e.bg)),t.todayPartnerDesc.string=e.desc;var a=t.todayPartnerDesc.x+t.todayPartnerDesc.width;t.bg.width=300<a?a+60:330,t.refreshBtn.x=a+35}},startLoopShowModel:function(){b8e.Tween.kill(this.skin.model),this.skin.model.alpha=1,b8e.Tween.get(this.skin.model,{loop:!0}).wait(2e3).to({alpha:0},1500).call(this.showModel,this).to({alpha:1},1500)},showModel:function(){},getSummonLuckWeightCfg:function(){var e=game.recruitData.getInfoById(this.activityId);return e?e.getSummonLuckWeightCfg():null},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return e.time.string="",void this.stopTime();var t=this.endTime-game.SysTime.curTime;if(t<1)return e.time.string="",void this.stopTime();e.time.string=game.TimeUtil.formatTimeSpace(t)},stopTime:function(){this._timer&&this._timer.stop()},updateLeftTop:function(){var e=this.skin,t=this.activityId,a=game.recruitData.getBaseCfg(t,1);if(a&&a.recommendItemId){e.costNode.active=!0;var i=game.ItemInfoCfg.getData(a.recommendItemId);if(i){var n=game.itemData.getCountById(a.recommendItemId);e.costIcon.loadTexture(game.ResCfg.getUrl(137,i.icon)),e.costName.string=i.name+":",e.costNum.string=n,e.costNum.x=e.costName.x+e.costName.width+3}}else e.costNode.active=!1},updateBuyBtn:function(){this.skin.buySelect.active=game.recruitData.getAutoBuyById(this.activityId)},updateSkipBtn:function(){this.skin.skipSelect.active=game.recruitData.getSkipById(game.ME.RecruitSubB)}});b8e.module.registerView(game.ME.RecruitSubB,e)}(),function(){var e=game.AwardShowView.extends({countDownTime:5,_showModel:!0,ctor:function(){this._super(1498)},init:function(){var e=this;e.itemIconPool=[],e.itemIconList=[],e.playTimeMap=b8e.HashMap.get(),e.playTimeList=[];for(var t=void 0,a=0,i=e.playTimeList,n=0;n<15;n++)a+=150,(t=e.playTimeMap.get(a))||(t=[],e.playTimeMap.set(a,t)),t.push(n),i.indexOf(a)<0&&i.push(a);if(i.sort(function(e,t){return e-t}),!e.animaPartA){var s=e.animaPartA=b8e.Animator.get(game.AnimType.UI_EFFECT,1);s.setVisible(!1),s.addToParent(e.skin.anima1),s.load(game.ResCfg.getUrl(5019,1101)),s.addFinishCallback(e.onAnimaComplete,e,s)}if(!e.animaPartB){var r=e.animaPartB=b8e.Animator.get(game.AnimType.UI_EFFECT,2);r.setVisible(!1),r.addToParent(e.skin.anima2),r.load(game.ResCfg.getUrl(5019,1102)),r.addFinishCallback(e.onAnimaComplete,e,r)}},onAnimaComplete:function(e){e.setVisible(!1)},notify:function(e){switch(e){case this.Evts.C2V_SHOW_CARD_CONTINUE:this.resetCard();break;case this.Evts.C2V_UPDATE_ITEM:this.isShowCostDetail&&this.setCostDetail();break;case this.Evts.C2V_UPDATE_RECRUIT_SHOW_PAGE:this.updatePage()}},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.updatePage()},onHide:function(){var e=this;e.clearCountDown(),e.clearItems(),e.animaPartA&&e.animaPartA.setVisible(!1),e.animaPartB&&e.animaPartB.setVisible(!1),b8e.Tween.kill(e.skin.light),b8e.removeTimeout(e.showCard,e),b8e.removeTimeout(e.updateAnima,e),game.recruitData.showPushPrize&&(game.gamePopupMgr.show(game.ME.PushPrize),game.recruitData.showPushPrize=!1)},updatePage:function(){var e=this;e.skin.time.string=game.Lang.get(51538,60),e.setTitle(),e.setBg(),e.clearItems(),e.activityId=game.recruitData.activityId,e.isSkip=game.recruitData.getSkipById(game.recruitData.skipModuleId),e.skin.completeShow.active=!1,e.skin.viewNode.active=!1,e.isShowCostDetail=game.recruitData.skipModuleId!=game.ME.HuntingMain&&!game.recruitData.isElement&&4<=game.mainInstanceData.id,e.skin.againNode.active=e.isShowCostDetail,e.isSkip?e.showCard():(e.animaPartA.setVisible(!0),e.animaPartA.play(null,0),e.animaPartB.setVisible(!0),e.animaPartB.play(null,0),b8e.setTimeout(e.showCard,e,1e3)),e.startTime=game.SysTime.curTime,e.isShowCostDetail&&e.setCostDetail()},setCostDetail:function(){this.updateOneItemToAmount(),this.updateCost(10),this.updateBtnDesc(1),this.updateBtnDesc(10)},setTitle:function(){var e=this.skin,t=game.awardsData.getInfo(),a=1<(t&&t.length||0);e.ten_recruit.active=a,e.once_recruit.active=!a},showCard:function(){this.skin.viewNode.active=!0,this.setAward()},setBg:function(){var e=this.skin,t=game.awardsData.getInfo(),a=1<(t&&t.length||0);e.bg.width=e.huawen_3.width=e.huawen_1.width=e.gray.width=b8e.stage.width+100,e.gray.height=a?400:290,e.bg.height=b8e.stage.height+100,e.pathNode.y=a?-753:-643,e.viewNode.y=a?0:-55},clearItems:function(){var e,t=void 0;for(e=this.itemIconList.length,t=0;t<e;t++)this.itemIconList[t].removeFromParent();this.itemIconList.length=0},setAward:function(){var e=game.awardsData.getInfo();if(e&&!(e.length<1)){for(var t=void 0,a=void 0,i=e.length,n=1<i,s=0;s<i;s++)t=this.itemIconPool[s],a=e[s],(t=t||(this.itemIconPool[s]=new game.RecruitShowItem)).x=s%5*130,t.y=165*-Math.floor(s/5),t.setData(a,!0,n,this.turnComplete,this.trunFrontCb,this),this.itemIconList.push(t);this.startAnim()}},turnComplete:function(e){var t=e;if(t.itemIconList&&t.completeIndex<t.itemIconList.length-1)t.completeIndex++;else{t.turnIndex=0;var a=t.playTimeList[0];t.updateAnima(),b8e.setTimeout(t.turnCard,t,a)}},trunFrontCb:function(e){var t=e;t.itemIconList&&t.trunFrontIndex<t.itemIconList.length-1?t.trunFrontIndex++:(t.skin.completeShow.active=!0,t.playing=!1)},resetCard:function(){var e=this.itemIconList[this.turnIndex-1];if(e){var t=e.skin;t.cardBack.active=!1;var a=t.cardFront.x-e.x+60,i=t.cardFront.y-e.y-73;t.cardFront.addToParent(e.skin.cardNode),t.cardFront.setPosition(a,i),t.cardFront.active=!0,b8e.Tween.get(t.cardFront).to({x:0,y:0,scaleX:1,scaleY:1},200,b8e.Ease.quadIn),this.turnCard()}},turnCard:function(){var e=this;if(e.turnIndex>e.itemIconList.length-1)return e.countDownTime=60,void e.createCountDown();var t=e.playTimeList[e.turnIndex],a=e.itemIconList[e.turnIndex];if(a){e.turnIndex++,a.showCard();var i=a.getCfg(),n=a.getPartnerCfg();i&&i.isPartner&&game.recruitData.activePartner&&-1<game.recruitData.activePartner.indexOf(i.partnerId)&&n&&n.quality>game.Quality.Q_PURPLE||(t=e.playTimeList[e.turnIndex]-t,b8e.setTimeout(e.turnCard,e,t))}},startAnim:function(){var e=this;if(!e.playTimeList||e.playTimeList.length<1)for(var t=e.itemIconList.length,a=1<t?e.skin.tenStart:e.skin.oneStart,i=0;i<t;i++)e.itemIconList[i].addToParent(a);else if(e.playing=!0,e.curTimeIndex=0,e.completeIndex=0,e.trunFrontIndex=0,e.isSkip)for(var n=e.itemIconList.length,s=1<e.itemIconList.length?e.skin.tenStart:e.skin.oneStart,r=0;r<n;r++)e.itemIconList[r].addToParent(s);else e.updateAnima()},updateAnima:function(){var e=this,t=e.playTimeList[e.curTimeIndex],a=1<e.itemIconList.length?e.skin.tenStart:e.skin.oneStart,i=e.itemIconList[e.curTimeIndex];i&&(i.addToParent(a),e.curTimeIndex++,t=e.playTimeList[e.curTimeIndex]-t,b8e.setTimeout(e.updateAnima,e,t))},updateOneItemToAmount:function(){var e=this,t=game.SummonOpenCfg.getData(e.activityId);if(t){var a=e.activityId,i=game.recruitData;if(i.getBaseCfg(a,1)){var n=i.getInfoById(a);if(n){var s=e.skin;if(t.freeNum<1)return e.stopTime(),e.updateCost(1),s.one_bottom_desc.active=!1,s.one_bottom_cost.active=!0,s.red_spot.active=!1,s.cost_icon_1.active=!0,s.cost_num_1.active=!0,void(s.one_top_time.active=!1);var r=0<t.freeNum&&t.freeNum>n.freeNum;if(s.one_bottom_desc.active=r,s.one_bottom_cost.active=!r,s.red_spot.active=r,s.cost_icon_1.active=!r,s.cost_num_1.active=!r,s.one_top_time.active=!r,r)e.stopTime();else{var o=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,1),g=o-game.SysTime.curTime;if(0<g){var u=b8e.TimeUtil.formatTime(g);s.one_top_time.string=game.Lang.get(51872,u),e.endTime=o,e._timer2||(e._timer2=b8e.Timer.add(e,e.updateTime2,500)),e._timer2.reset(),e._timer2.start()}e.updateCost(1)}}}else b8e.error("\u53ec\u5524\u6d3b\u52a8\u6ca1\u6709\u914d\u7f6e\u5355\u6b21\u53ec\u5524",a)}},updateTime2:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return e.one_top_time.string="",void this.stopTime();var t=this.endTime-game.SysTime.curTime;if(t<1)return e.one_top_time.string="",void this.stopTime();var a=b8e.TimeUtil.formatTime(t);e.one_top_time.string=game.Lang.get(51872,a)},stopTime:function(){this._timer2&&this._timer2.stop()},updateCost:function(e){var t=this.activityId,a=game.recruitData.getBaseCfg(t,e);if(a){var i=a.costItems,n=a.costItems2,s=this.getComponent("cost_icon_"+e),r=this.getComponent("cost_num_"+e);if(s&&r){var o=void 0,g=void 0;if(i&&0<i.length&&(g=i[0].Id,(o=i[0].Num)<=game.itemData.getCountById(g)))this.setCost(s,r,g,o);else if(n&&0<n.length&&(g=n[0].Id,(o=n[0].Num)<=game.itemData.getCountById(g)))this.setCost(s,r,g,o);else{var u=a.costAmounts;u&&0<u.length&&this.setCost(s,r,u[0].Id,u[0].Num)}}else b8e.error("\u7f3a\u5c11\u53ef\u8bbe\u7f6e\u8282\u70b9 count",e)}else b8e.error("\u53ec\u5524\u6d3b\u52a8\u6ca1\u6709\u914d\u7f6e\u5341\u6b21\u53ec\u5524",t)},setCost:function(e,t,a,i){if(e&&a){var n=game.ItemInfoCfg.getData(a);if(n){e.loadTexture(game.ResCfg.getUrl(137,n.icon));var s=game.itemData.getCountById(a),r=s<i?503:504;t.string=game.Lang.get(r,s,i);var o=e.width+t.width;e.x=-o/2,t.x=e.width-o/2}}},updateBtnDesc:function(e){var t=this.activityId,a=game.recruitData.getBaseCfg(t,e);if(a){var i=this.getComponent("btn_desc_"+e),n=this.getComponent("btn_lab_"+e);if(i&&n){var s=a.btnDesc?-11:0;i.string=a.btnDesc,n.y=s}else b8e.error("\u7f3a\u5c11\u53ef\u8bbe\u7f6e\u8282\u70b9 count",e)}else b8e.error("\u53ec\u5524\u6d3b\u52a8\u6ca1\u6709\u914d\u7f6e\u5341\u6b21\u53ec\u5524",t)},closeBtn:function(){this.playing||game.module.hide(this.moduleEnum)},onStageResize:function(){this._super(),this.setBg()}});b8e.module.registerView(game.ME.RecruitShowItem,e)}(),function(){var e;e=game.Widget.extends({_icon:null,ctor:function(){this._super(1499),this.setSize(186,227)},_trunBackCb:function(){var e=this.skin;e.cardBack.active=!1,e.cardFront.active=!0;var t=this.anima;if(t){var a=game.ItemInfoCfg.getData(this.itemInfo.id);if(a){t.setVisible(!0);var i=a.isPartner?1103:1106;t.load(game.ResCfg.getUrl(5019,i)),t.play(null,0)}}},_trunFrontCb:function(){var e=this,t=game.ItemInfoCfg.getData(e.itemInfo.id);if(t){var a=e.thisArg;if(e.trunFrontCb.call(e,a),t.isPartner){e.showCardQualityEffect();var i=e.getPartnerCfg();if(!(!game.recruitData.activePartner||game.recruitData.activePartner.indexOf(t.partnerId)<0||!i||i.quality<game.Quality.Q_YELLOW)){var n=e.skin;n.cardBack.setScale(.2,1),n.cardBack.active=!0;var s=e.isTen?a.skin.tenStartTemp:a.skin.oneStartTemp;n.cardFront.addToParent(s),n.cardFront.setPosition(e.x+60,e.y-73);var r=e.isTen?320:60,o=e.isTen?-53:-3;n.cardFront.rotation=-30,b8e.setTimeout(e._hideCard,e,400),b8e.Tween.get(n.cardFront).to({x:r,y:o,rotation:0,scaleX:5,scaleY:5},500,b8e.Ease.quadIn).call(e._showPartnerView,e)}}}},_hideCard:function(){this.skin.cardFront.active=!1},_showPartnerView:function(){var e=game.ItemInfoCfg.getData(this.itemInfo.id);if(e&&e.isPartner){game.recruitData.showPartnerId=e.partnerId,game.module.show(game.ME.RecruitPartner)}},showCardQualityEffect:function(){var e=game.ItemInfoCfg.getData(this.itemInfo.id);if(e){var t=game.PartnerCfg.getData(e.partnerId),a=this.partnerAnim;t&&t.recruitQualityEffect&&(a||((a=this.partnerAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,3)).setVisible(!1),a.addToParent(this.skin.cardEffect)),a.load(game.ResCfg.getUrl(5022,t.recruitQualityEffect)),a.setVisible(!0),a.play())}},showIconItem:function(e){var t=this.skin;if(e){b8e.Tween.kill(t.cardFront),t.cardFront.addToParent(t.cardNode),t.cardFront.setPosition(0,0),t.cardFront.rotation=0,t.cardFront.setScale(1,1),t.cardBack.setScale(1,1);var a=game.ItemInfoCfg.getData(e.id);if(a)if(this.partnerAnim&&this.partnerAnim.setVisible(!1),a.isPartner){var i=game.PartnerCfg.getData(a.partnerId);i&&(t.cardImg.loadTexture(game.ResCfg.getUrl(10088,i.icon)),t.cardElement.loadTexture(game.ResCfg.getUrl(10048,i.element)),t.cardImg.active=!0,t.itemIcon.active=!1,t.cardElement.active=!0),t.cardBg.active=!0,t.cardBg.loadTexture(game.ResCfg.getUrl(10161,a.quality))}else{t.cardImg.active=!1,t.itemIcon.active=!0,t.cardBg.active=!1,t.cardElement.active=!1;var n=this.icon;n||((n=this.icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105)).setAnchor(.5,.5),n.addToParent(t.itemIcon)),game.GridUtil.setItemIcon(n,this.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM)}}},getIsPartner:function(e){if(!e)return!1;var t=game.ItemInfoCfg.getData(e.id);return t&&t.partnerId&&0<t.partnerId&&t.isPartner},init:function(){},loadComplete:function(){if(this.hide(),this.data){this.show(this.data)}},setData:function(e,t,a,i,n,s){this.itemInfo=e,this.isPlay=t,this.completeCb=i,this.trunFrontCb=n,this.isTen=a,this.thisArg=s},getCfg:function(){return this.itemInfo?game.ItemInfoCfg.getData(this.itemInfo.id):null},getPartnerCfg:function(){var e=this.getCfg();return e&&e.partnerId?game.PartnerCfg.getData(e.partnerId):null},onShow:function(){this.updateItem()},onHide:function(){this.partnerAnim&&(this.partnerAnim.stop(),this.partnerAnim.setVisible(!1))},updateItem:function(){var e=this,t=e.skin;t.cardNode.active=!1;var a=e.anima;a||((a=e.anima=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).addFinishCallback(e.onComplete,e),a.setVisible(!1),a.addToParent(t.cardFront)),a.setVisible(!1),e.showIconItem(e.itemInfo),e.isPlay?(e.isShowItem=!0,t.cardBack.active=!0,t.cardFront.active=!1,t.cardNode.active=!0,t.cardNode.setScale(0,0),b8e.Tween.kill(t.cardNode),b8e.Tween.get(t.cardNode).to({scaleX:1,scaleY:1},200).call(e.turnComplete,e)):(t.cardBack.active=!1,t.cardFront.active=!0,t.cardNode.setScale(1,1),t.cardNode.active=!0,e.turnComplete())},turnComplete:function(){this.completeCb.call(this,this.thisArg)},onComplete:function(){this.anima.setVisible(!1)},showCard:function(){var e=this.skin;b8e.Tween.get(e.cardNode).to({scaleX:0},275).call(this._trunBackCb,this).to({scaleX:1},275).call(this._trunFrontCb,this)},clickBtn:function(){if(this.itemInfo){var e=game.ItemInfoCfg.getData(this.itemInfo.id);if(e)this.getIsPartner(this.itemInfo)?(game.partnerData.setShowInfo(e.partnerId),game.module.show(game.ME.PartnerDetails)):(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}}});b8e.RC("$$game","$$RecruitShowItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1459)},onShow:function(){var e=game.recruitData,t=this.activityId=e.activityId;if(this.activityId){var a=this.openCfg=game.SummonOpenCfg.getData(t);if(a){this.skin.msg1.string=game.Lang.get(a.elementTips,a.elementVip,a.elementCost),this.skin.msg2.string=game.Lang.get(52331,a.openElementScore),this.skin.vipDesc.string=game.Lang.get(52332,game.mainRoleData.vipLevel);var i=game.mainRoleData.vipLevel<a.elementVip?52342:52343;this.skin.btn_lab_2.string=game.Lang.get(i)}}}});b8e.module.registerView(game.ME.RecruitAlert,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1460)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_COUNT:this.updateCount();break;case this.Evts.C2V_UPDATE_SELECT:this.updateSelect()}},onShow:function(){game.recruitData.elementSelect=0,game.TweenUtil.rotationEffect(this.skin.select),this.updatePage()},onHide:function(){b8e.Tween.kill(this.skin.select)},updatePage:function(){var e=this.skin,t=game.recruitData,a=this.activityId=t.activityId;if(this.activityId){var i=this.openCfg=game.SummonOpenCfg.getData(a);if(i){var n=i.elementStore;if(!n||n.length<1)return e.elementNode_1.active=!1,e.elementNode_2.active=!1,e.elementNode_3.active=!1,void(e.elementNode_4.active=!1);for(var s=i.elementName,r=i.elementImg,o=3;-1<o;o--)this.getComponent("elementNode_"+o).active=!!n[o],n[o]&&(s[o]?(this.getComponent("element_name_"+o).string=s[o],r[o]?this.getComponent("element_img_"+o).loadTexture(game.ResCfg.getUrl(10144,r[o])):b8e.error("\u6ca1\u6709\u914d\u7f6e\u79cd\u65cf\u56fe\u7247activityId:"+a+" i:"+o)):b8e.error("\u6ca1\u6709\u914d\u7f6e\u79cd\u65cf\u540d\u5b57activityId:"+a+" i:"+o));this.updateSelect(),this.updateCount()}}},updateSelect:function(){var e=game.recruitData.elementSelect,t=this.getComponent("elementNode_"+e);this.skin.select.setPosition(t.x,t.y)},updateCount:function(){var e=game.recruitData.getInfoById(this.activityId);if(e&&this.openCfg){var t=Math.floor(e.elementScore/this.openCfg.elementCost);this.skin.summonCount.string=game.Lang.get(52333,t)}}});b8e.module.registerView(game.ME.RecruitElement,e)}(),function(){var e=b8e.Object.extends({selectId:0,useItem:!1,passAnim:!1,isInXunbao:!1,ctor:function(){this.xunBaoMap=b8e.HashMap.get()},setCfgData:function(){var e=game.XunbaoActivityOpenCfg.getDatas();if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=this.xunBaoMap,n=0;n<t;n++)(a=new game.XunBaoInfo).setCfgData(e[n]),i.set(a.actId,a)},setNetData:function(e){if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=this.getInfoByActId(a.activityId))&&i.setNetData(a)},onXunbaoRsp:function(e){this.prize=e.items;var t=game.TreasureCostCfg.getData(e.xunbaoId);if(t){var a=this.xunBaoMap.get(t.activityId);a&&a.onXunbaoRsp(e,t)}},checkOpenById:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=this.getCfgById(e);return i?this.checkOpenByCfg(i,a):(b8e.error("\u6ca1\u6709\u8fd9\u4e2a\u7c7b\u578b\u7684\u5bfb\u5b9d\u914d\u7f6e\uff0c\u662f\u4e0d\u662f\u4f20\u7684id\u6709\u95ee\u9898"),!1)},checkOpenByCfg:function(e,t){if(!e)return!1;if(game.mainRoleData.lv<e.lv)return t&&game.notice.show(51883,e.lv),!1;var a=game.miscData.openServerDay;return!(a<e.serverStart||e.serverEnd<=a)||(t&&game.notice.show(51884),!1)},getInfoByActId:function(e){return this.xunBaoMap.get(e)},getInfoArr:function(){return this.xunBaoMap.values()},getCurInfo:function(){return this.xunBaoMap.get(this.selectId)},initShowItems:function(){for(var e=this.showInfos=[],t=void 0,a=0;a<10;a++)t=new game.XunBaoGridInfo,e.push(t)},getCurShowItems:function(){this.showInfos||this.initShowItems();var e=this.getCurInfo();if(e){var t=this.getDisplayCfg(e.actId,e.luckGroup);if(t){for(var a=this.showInfos,i=t.show1,n=void 0,s=a.length,r=0;r<s;r++){if(!(n=game.TreasureItemCfg.getData(i[r])))return void b8e.error("\u5c55\u793a\u7ec4\u914d\u7f6e\u6709\u95ee\u9898,\u5bfb\u5b9d\u9053\u5177\u683c\u5b50\u8868\u4e0d\u5b58\u5728id"+i[r]);a[r].setCfg(n)}return a}}},getTimeByActId:function(e){var t=0,a=this.getCfgById(e);if(!a)return t;var i=a.serverEnd,n=game.miscData.openServerDay;return t=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,i-n)-game.SysTime.curTime},getPrizeShowNum:function(e){var t=this.prize,a=0;if(!t||t.length<1)return a;for(var i=t.length,n=void 0,s=0;s<i;s++)(n=t[s]).id==e&&(a+=n.num);return a},getDisplayCfg:function(e,t){return this.dObj||(this.dObj={}),this.dObj.id=e,this.dObj.group=t,game.TreasureCfg.getData(this.dObj)},onHide:function(){this.prize=null},getCfgById:function(e){return this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.id=e,game.XunbaoActivityOpenCfg.getData(this.cfgObj)},getCfgsByType:function(e){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.xunbaoType=e,game.XunbaoActivityOpenCfg.getData(this.cfgObj2,!0)},getOpenIdByType:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=this.getCfgsByType(e,a);if(!i||i.length<1)return b8e.error("\u6ca1\u6709\u8fd9\u4e2a\u5bfb\u5b9d\u7c7b\u578b\u7684\u6d3b\u52a8!\u68c0\u67e5\u4e0b\u914d\u7f6e"),0;for(var n=void 0,s=0,r=i.length,o=0;o<r;o++)if(n=i[o],this.checkOpenByCfg(n,!1)){s=n.id;break}return!s&&a&&game.notice.show(53258),s}});game.xunBaoData=game.xunBaoData||new e}(),function(){var e;e=b8e.Object.extends({setCfg:function(e){this.id=e.item.Id,this.num=e.item.Num,this.isTag=1==e.tag,this.title=e.title,this.qualityEffect=e.qualityEffect,this.cfgId=e.id,this.quality=e.quality}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$XunBaoGridInfo",e)}(),function(){var e;e=b8e.Object.extends({isFirstBatch:!1,luckGroup:0,luckScore:0,setCfgData:function(e){this.cfg=e,this.name=e.name,this.actId=e.id},setNetData:function(e){this.isFirstBatch=e.firstBatch,this.luckGroup=e.luckGroup,this.luckScore=e.luckScore,this.awards=e.awards,this.shops=e.shops},onXunbaoRsp:function(e,t){this.isFirstBatch||(this.isFirstBatch=10==t.count),this.luckGroup=e.luckGroup,this.luckScore=e.luckScore}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$XunBaoInfo",e)}(),function(){var e;e=b8e.Object.extends({name:"",itemId:0,itemNum:0,setData:function(e){this.name=e.name,this.itemId=e.itemId,this.itemNum=e.itemNum}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$XunBaoLogInfo",e)}(),function(){var e;e=b8e.Enum({NONE:0,MOUNT_XUNBAO:100,SHENHUN_XUNBAO:101,ZHENXING_XUNBAO:102,WING_XUNBAO:105,ZHANJI_XUNBAO:106,HALO_XUNBAO:107,SHENQI_XUNBAO:108}),b8e.RC("$$game","$$XunBaoType",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_UPDATE_PASS_ANIM:-1,C2V_UPDATE_COST:-1,C2V_START_ANIM:-1,V2C_STOP_ANIM:-1,C2V_UPDATE_VIEW:-1,C2C_SHOW_XUNBAO:-1,C2C_XUNBAO_ID:-1}),b8e.RC("$$game","$$XunBaoEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.xunBaoData,this._alertOptions={key:1001,lang:7547,btn:game.Lang.get(9059),okcb:this.onClickGameAlert,thisArg:this,args:[],langArgs:[],showtips:!0}},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.onSysData},MainRole:{C_RESET_DAILY:this.resetDaily},Back:{C_BACK_UPDATE_ITEMINFO:this.updateCost}},this.handels={XunbaoResp:this.onXunbaoRsp},this.gevts={XunBaoEvts:{C2C_SHOW_XUNBAO:this.showXunBao}}},showXunBao:function(e){if(e&&e.data){var t=e.data;this.data.checkOpenById(t,!0)&&(this.data.selectId=t,game.module.show(game.ME.XunBao))}},notify:function(e){switch(e){case this.Evts.V2C_STOP_ANIM:this.stopAnim()}},onSysData:function(e){var t=e?e.data:null;if(t){var a=this.data;a.setCfgData(),a.setNetData(t.xunbaoDatas)}},resetDaily:function(){var e=this.data.selectId;e&&(this.data.checkOpenById(e)||game.module.hide(game.ME.XunBao))},updateCost:function(){this.send(this.Evts.C2V_UPDATE_COST)},stopAnim:function(){this.showAward()},onXunbaoRsp:function(e){var t=e.readProtobuf(game.pb.XunbaoResponse);if(0<t.code)return game.notice.noticeError(t.code),void(this.data.isInXunbao=!1);this.data.onXunbaoRsp(t),this.items=t.items,this.dpt(this.Evts.C2C_XUNBAO_ID,t.xunbaoId),this.data.passAnim?this.showAward():this.send(this.Evts.C2V_START_ANIM),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeConsume)},showAward:function(){game.awardsData.setItemsByArray(this.items,!1),game.module.show(game.ME.AwardShowTip),this.send(this.Evts.C2V_UPDATE_VIEW),this.data.isInXunbao=!1},oneBtn:function(){this.sendXunBao(1)},tenBtn:function(){this.sendXunBao(10)},passAnimBtn:function(){this.data.passAnim=!this.data.passAnim,this.send(this.Evts.C2V_UPDATE_PASS_ANIM)},helpBtn:function(){var e=this.data.getCurInfo();if(e){var t=e.cfg.moduleID;game.RuleView.inst().showView(t)}},sendXunBao:function(e){if(!this.data.isInXunbao){var t=this.data.selectId;if(t){var a=game.TreasureCostCfg.getBaseData(e,t);if(a){var i=!1,n=a.costItems;if(n&&n.length&&(i=game.UpgradeUtil.checkItemList(n,1,!1)),i)this._sendXunBao(a.id,!0);else{var s=a.giveItems[0];if(s){var r=game.ItemInfoCfg.getData(s.Id);if(r){var o=game.CCommonUtil.replaceNum(s.Num,2);this._alertOptions.key=1e3+t,this._alertOptions.args[0]=a.id,this._alertOptions.langArgs[0]=a.price+game.Lang.get(9213),this._alertOptions.langArgs[1]=o+r.name,this._alertOptions.langArgs[2]=a.count,game.alert.show(this._alertOptions)}}}}}}},onClickGameAlert:function(e){this._sendXunBao(e,!1)},_sendXunBao:function(e,t){game.TreasureCostCfg.getData(e)&&(game.UpgradeUtil.checkEquipTooMuch()||(this.sender.XunbaoReq(e,t),this.data.isInXunbao=!0))}}),t=game.Sender.extends({ipc:function(){this.msg={XunbaoReq:this.xunbaoReq}},xunbaoReq:function(e,t,a,i,n){var s=2<arguments.length&&void 0!==a?a:0,r=3<arguments.length&&void 0!==i?i:0,o=4<arguments.length&&void 0!==n?n:0,g=game.pb.XunbaoRequest;g.xunbaoId=e,g.useItem=t,g.rareType=s,g.epicType=r,g.legendType=o,this.write(g)}});b8e.module.registerControl(game.ME.XunBao,e,game.XunBaoEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1396),this.setSize(320,24)},setData:function(e){var t=this.skin,a=game.ItemInfoCfg.getData(e.itemId),i=game.HtmlUtil.getColorStrByQuality(a.quality,a.name+"*"+e.itemNum);t.labName.string=e.name,t.labItem.string=i}}),b8e.RC("$$game","$$XunBaoLogItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1397)},init:function(){var e=this,t=e.skin;e.data=game.xunBaoData;var a=e.iconArr=[],i=game.IconSizeEnum,n=void 0,s=void 0,r=0;for(r=0;r<10;r++)n=game.GridUtil.createTurnplateIcon(i.GRID_SIZE_105),s=e.getComponent("iconNode"+(r+1)),n.addToParent(s),a.push(n);e.costIcon1=game.GridUtil.createViewClickIcon(i.GRID_SIZE_42),e.costIcon1.addToParent(t.gold1),e.costIcon2=game.GridUtil.createViewClickIcon(i.GRID_SIZE_42),e.costIcon2.addToParent(t.gold2);var o=e.luckIconArr=[],g=e.luckInfoArr=[],u=void 0,l=void 0,c=void 0;for(r=0;r<3;r++)u=2==r?i.SIZE_104:i.GRID_SIZE_69,l=game.GridUtil.createItemIcon(u),c=e.getComponent("scoreIcon"+(r+1)),l.addToParent(c),o.push(l),g[r]=game.ItemInfo.get();var h=e.anima=b8e.Animator.get(game.AnimType.UI_EFFECT,10);h.addToParent(t.selectImg),h.load(game.ResCfg.getUrl(5019,1010)),e.firstGrid=game.GridUtil.createItemIcon(i.GRID_SIZE_105),e.firstGrid.addToParent(t.mustNode),e.firstInfo=game.ItemInfo.get(),e.barLen=384},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_COST:t.updateCost();break;case t.Evts.C2V_START_ANIM:t.startAnim();break;case t.Evts.C2V_UPDATE_PASS_ANIM:t.updatePassAnim();break;case t.Evts.C2V_UPDATE_VIEW:t.updateScorePro(),t.createFrist(),t.createItemGrid()}},onShow:function(){this.createItemGrid(),this.updateCost(),this.updateScorePro(),this.createFrist(),this.updatePassAnim(),this.createTimer()},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=this.data,t=e.getTimeByActId(e.selectId);if(t<1)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);this.skin.timeLab.string=game.Lang.get(51900,a)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},createItemGrid:function(){var e=this.data.getCurShowItems();if(e&&!(e.length<1)){for(var t=this.iconArr,a=t.length,i=void 0,n=void 0,s=game.IconLayoutEnum.SHOW_NUM,r=0;r<a;r++)i=e[r],n=this.data.getPrizeShowNum(i.id),this.getComponent("itemNum"+(r+1)).active=n,this.getComponent("itemNumLab"+(r+1)).string=n?"X"+n:0,t[r].setItemInfo(i,i.isTag,i.title,!1,s);var o=game.ResCfg.getUrl(10121,this.data.selectId);this.skin.title.loadTexture(o)}},startAnim:function(){var e=this.skin;this.totalRun=1,this.curIconIndex=1,e.selectImg.active=!0,game.TweenUtil.rotationEffect(e.zhen,720,1500),this.playAnim()},playAnim:function(){var e=this,t=e.getComponent("icon"+e.curIconIndex);e.skin.selectImg.x=t.x,e.skin.selectImg.y=t.y,e.anima.play(null,0),e.curIconIndex++,e.totalRun++,10<e.curIconIndex&&(e.curIconIndex=1),19<e.totalRun?e.stopAnim():(b8e.Tween.kill(e),b8e.Tween.get(e).wait(80).call(e.playAnim,e))},stopAnim:function(){var e=this.skin;e.selectImg.active=!1,b8e.Tween.kill(this),b8e.Tween.kill(e.zhen),e.zhen.rotation=0,this.send(this.Evts.V2C_STOP_ANIM)},updateCost:function(){var e=this.skin;this.setCost(1,this.costIcon1,e.costLabOne,e.buyBtnLabOne),this.setCost(10,this.costIcon2,e.costLabTen,e.buyBtnLabTen)},setCost:function(e,t,a,i){var n=this.data.selectId,s=game.TreasureCostCfg.getBaseData(e,n);if(s){var r=void 0,o=void 0,g=void 0,u=void 0,l=s.costItems;if(l&&l.length&&(o=game.UpgradeUtil.checkItemList(l,1,!1))&&(g=l[0].Id,u=l[0].Num,r=!0),!o){var c=s.costAmounts;c&&c.length&&(g=c[0].Id,u=c[0].Num)}if(g&&u){if(t.setItemId(g),r){var h=game.itemData.getNumById(g)+"/"+u;a.string=h}else a.string=u;i.string=s.btnDesc}else b8e.error("\u5bfb\u5b9d\u57fa\u7840\u8868\u7684\u6d88\u8017\u914d\u7f6e\u6709\u95ee\u9898")}},updatePassAnim:function(){this.skin.check.active=this.data.passAnim},updateScorePro:function(){var e=this,t=e.data,a=e.skin,i=t.getCurInfo();if(i){var n=t.getDisplayCfg(i.actId,i.luckGroup);if(n){var s=n.totalScore,r=i.luckScore;a.pro.width=Math.min(e.barLen,e.barLen*r/s),a.proLab.string=r+"/"+s,a.scoreDescLab.string=n.hint;var o=n.PrizeItem.split("|");if(o&&!(o.length<1))for(var g=e.luckIconArr,u=e.luckInfoArr,l=game.IconLayoutEnum.SHOW_NUM,c=void 0,h=void 0,m=void 0,d=0;d<3;d++)(c=e.getScoreInfo(o[d]))&&(m=g[d],(h=u[d]).id=c.id,h.num=c.num,m.setItemInfo(h,!1,l),e.getComponent("scoreNode"+(d+1)).x=Math.min(e.barLen,e.barLen*(c.pro/s)),e.getComponent("already_got_"+(d+1)).active=r>=c.pro)}}},getScoreInfo:function(e){this.scoreInfo||(this.scoreInfo={});var t=e.split(",");if(t&&3==t.length){var a=this.scoreInfo;return a.id=0|t[0],a.num=0|t[1],a.pro=0|t[2],a}},createFrist:function(){var e=this.data.getCurInfo();if(e){var t=e.cfg,a=t.firstBatchAwards&&t.firstBatchAwards.length&&!e.isFirstBatch;if(this.skin.mustBg.active=a){var i=t.firstBatchAwards[0],n=this.firstInfo;n.id=i.Id,n.num=i.Num,this.firstGrid.setItemInfo(n,!1,game.IconLayoutEnum.SHOW_NUM)}}},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width),this.height+t>>1)},onHide:function(){this.data.onHide(),this.clearTimer(),this.data.isInXunbao&&this.stopAnim()}});b8e.module.registerView(game.ME.XunBao,e)}(),function(){var e;e=b8e.Enum({NONE:0,C_UPDATE_VIEW:-1}),b8e.RC("$$game","$$DailyDealEvts",e)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.checkOpen},MainRole:{C_RESET_DAILY:this.checkOpen},TimeLimitPrize:{C2V_UPDATE_BUTTON:this.updateView}}},updateView:function(){this.send(this.Evts.C_UPDATE_VIEW),this.checkOpen()},checkOpen:function(){var e=this.tempList;(e=e||(this.tempList=b8e.HashMap.get())).clear();var t=game.TimeLimitPrizeCfg.getDatasByAcType(1);if(t&&!(t.length<1)){for(var a=null,i=0,n=t.length;i<n;i++){var s=t[i];(a=e.get(s.actId))?a.isActive=game.timeLimitPrizeData.checkOpenByActId(s.actId)&&!game.timeLimitPrizeData.checkAllGet(s.actId):(a={openServerType:game.OpenServerType.DAILY_DEAL,type:s.actId,isActive:game.timeLimitPrizeData.checkOpenByActId(s.actId)&&!game.timeLimitPrizeData.checkAllGet(s.actId),param:0},e.set(s.actId,a))}this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER_LIST,e.values())}}});b8e.module.registerControl(game.ME.DailyDeal,e,game.DailyDealEvts)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("dailyDeal/DailyDealItem"),this.setSize(602,180)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=5,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=25,e.layout.spacingY=0,e.addToParent(this.skin.list)},setData:function(){var e=this.data,t=e.cfg,a=this.skin;a.desc.string=t.title,a.isBuyImg.node.active=e.isBought,a.buyBtn.node.active=!e.isBought,a.buyBtnLab.string=t.titleName;var i=this.getAwardList(t.award,t.tagIds);i&&this.prizeList.setData(i)},getAwardList:function(e,t){var a=this;if(a.prizeListPool||(a.prizeListPool=[]),a.prizeInfoList||(a.prizeInfoList=[]),a.prizeInfoList.length=0,!e||e.length<1)return a.prizeInfoList;t=t||[];for(var i=void 0,n=void 0,s=e.length,r=0;r<s;r++)i=e[r],(n=a.prizeListPool[r]=game.ItemUtil.createBaseItemInfo(i.Id,i.Num,a.prizeListPool[r])).tagId=t[r]?t[r]:0,n.iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,n.iconSize=game.IconSizeEnum.GRID_SIZE_105,a.prizeInfoList.push(n);return a.prizeInfoList},buyBtn:function(){game.timeLimitPrizeData.setId(this.data.id),this.send(game.TimeLimitPrizeEvts.C2V_CLICK_BUY)}}),b8e.RC("$$game","$$DailyDealItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super("dailyDeal/DailyDealView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.DailyDealItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=0,e.bindEnum=game.ME.TimeLimitPrize,e.addToParent(this.skin.list),this.timer=b8e.Timer.add(this,this.updateTime,1e3)},notify:function(e){switch(e){case this.Evts.C_UPDATE_VIEW:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=game.openServerData.getCurBtnInfo();if(e){game.timeLimitPrizeData.setActId(e.type);var t=game.timeLimitPrizeData.getCurInfoArr();t&&1<t.length&&t.sort(this._sort),this.list.setData(t),this.calEndTime(t[0]),this.timer&&this.timer.start()}},calEndTime:function(e){if(e){var t=e.cfg;if(t){var a=game.miscData.openServerDay;a>=t.serverStart&&a<t.serverEnd?this.endTime=b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(t.serverEnd-a)*b8e.TimeUtil.DAY_MICRO_SECONDS:this.endTime=0}}},updateTime:function(){var e=this.skin,t=this.endTime-game.SysTime.curTime,a=game.TimeUtil.formatTimeSpace(t,3);e.timeLab.string=game.Lang.get(51878,a)},onHide:function(){this.timer&&this.timer.stop()},_sort:function(e,t){return e.isBought&&!t.isBought?1:!e.isBought&&t.isBought?-1:e.id-t.id},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.DailyDeal,e)}(),function(){var e;e=b8e.Enum({None:0,V_UPDATE_PAGE:-1,C2C_UPDATE_AWAKE:-1,C2C_UPDATE_FORMATION_AWAKE:-1}),b8e.RC("$$game","$$StarSoulEvts",e)}(),function(){var e=b8e.Object.extends({getCurInfo:function(){return b8e.module.isShowView(game.ME.ZhenXing)?game.zhenXingData.getCurInfo():game.fosterData.getCurFosterInfo()},upAwakeFoster:function(e,t){if(b8e.module.isShowView(game.ME.ZhenXing)){var a=game.zhenXingData.getInfoById(e);if(!a)return;a.setAwake(t)}else{var i=game.fosterData,n=i.getFosterInfo(i.curFosterType,e);if(!n)return;n.setAwake(t)}},getFosterAwakeCfg:function(e,t){if(b8e.module.isShowView(game.ME.ZhenXing))return game.FormationAwakenCfg.getData(t);var a=this.getAwakeCfgCls(e);return a?a.getData(t):null},getFosterSkillCfg:function(e,t,a){var i=void 0;if(b8e.module.isShowView(game.ME.ZhenXing)){var n=game.FormationAwakenSkillCfg.getData(t,!0);if(!n)return null;for(var s=n[0],r=0,o=n.length;r<o;r++)if(i=n[r]){if(i.star>a)break;s=i}return s}var g=this.getSkillCfgCls(e);if(!g)return null;var u=g.getData(t,!0);if(!u)return null;for(var l=u[0],c=0,h=u.length;c<h;c++)if(i=u[c]){if(i.star>a)break;l=i}return l},getAwakeCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountAwakenCfg;case game.NewFosterType.WING:return game.WingAwakenCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiAwakenCfg;case game.NewFosterType.HALO:return game.HaloAwakenCfg;case game.NewFosterType.SHENHUN:return game.ShenhunAwakenCfg;default:return null}},getSkillCfgCls:function(e){switch(e){case game.NewFosterType.MOUNT:return game.MountAwakenSkillCfg;case game.NewFosterType.WING:return game.WingAwakenSkillCfg;case game.NewFosterType.ZHANJI:return game.ZhanjiAwakenSkillCfg;case game.NewFosterType.HALO:return game.HaloAwakenSkillCfg;case game.NewFosterType.SHENHUN:return game.ShenhunAwakenSkillCfg;default:return null}},checkAlert:function(e){var t=this.getAwakeCfgCls(e);if(!t)return null;var a=game.fosterData.getCurId(e),i=t.getData(a);return i?game.itemData.getCountById(i.itemId)>=i.num:void 0}});game.starSoulData=game.starSoulData||new e}(),function(){var e=game.Control.extends({ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo}},this.handels={FosterAwakenStarResp:this.onFosterAwakenStarResp,FormationAwakenStarResp:this.onFormationAwakenStarResp}},onFosterAwakenStarResp:function(e){var t=e.readProtobuf(game.pb.FosterAwakenStarResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),game.starSoulData.upAwakeFoster(t.id,t.awakenStar),this.updateItemInfo(),this.dpt(this.Evts.C2C_UPDATE_AWAKE))},onFormationAwakenStarResp:function(e){var t=e.readProtobuf(game.pb.FormationAwakenStarResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),game.starSoulData.upAwakeFoster(t.id,t.awakenStar),this.updateItemInfo(),this.dpt(this.Evts.C2C_UPDATE_FORMATION_AWAKE))},smeltBtn:function(){if(b8e.module.isShowView(game.ME.ZhenXing)){var e=game.zhenXingData.getCurInfo();if(!e)return;var t=game.FormationAwakenCfg.getData(e.id);if(!t)return;if(game.itemData.getCountById(t.itemId)<t.num)return void game.notice.show(51856);this.sender.FormationAwakenStarReq(e.id)}else{var a=game.fosterData.curFosterType,i=game.fosterData.getCurId(a),n=game.starSoulData.getFosterAwakeCfg(a,i);if(!n)return;if(game.itemData.getCountById(n.itemId)<n.num)return void game.notice.show(51856);this.sender.FosterAwakenStarReq(a,i)}},updateItemInfo:function(){this.checkAlert(),b8e.module.isShowView(this.moduleEnum)&&this.send(this.Evts.V_UPDATE_PAGE)},checkAlert:function(){var e=game.fosterData,t=e.getCurId(e.curFosterType),a=e.getFosterInfo(e.curFosterType,t);a&&a.checkAlert()},skillNode:function(){},autoBuyBtn:function(){}}),t=game.Sender.extends({ipc:function(){this.msg={FosterAwakenStarReq:this.fosterAwakenStarReq,FormationAwakenStarReq:this.formationAwakenStarReq}},fosterAwakenStarReq:function(e,t){var a=game.pb.FosterAwakenStarRequest;a.fosterType=e,a.id=t,this.write(a)},formationAwakenStarReq:function(e){var t=game.pb.FormationAwakenStarRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.StarSoul,e,game.StarSoulEvts,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1385)},init:function(){var e=this.skin;this._icon=game.GridUtil.createItemIcon(),this._icon.addToParent(e.icon1),this.skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.GRID_SIZE_84),this.skillIcon.setClickCallBack(game.partnerData.openAwakenSkillTips,game.partnerData),this.skillIcon.addToParent(e.skillNode),e.autoBuyBtn.active=!1,this.spriteType=[901,902,903]},notify:function(e){switch(e){case this.Evts.V_UPDATE_PAGE:this.updateData()}},onShow:function(){this.updateData()},updateData:function(){var e=game.starSoulData.getCurInfo();if(e){var t=game.starSoulData.getFosterAwakeCfg(e.fosterType,e.id);t&&(this.skin.skillNode.active=t.awakenSkill,this.updataCost(t),this.updataAttr(t,e.awakeStar),this.updataStar(e.awakeStar),t.awakenSkill&&this.updataSkill(e))}},updataCost:function(e){var t=this.skin,a=e.itemId,i=game.ItemInfoCfg.getData(a),n=game.itemData.getNumById(a),s=n>=e.num,r=game.Lang.get(s?51852:51853,n);t.costLab1.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name,!1),t.numLab1.string=game.Lang.get(51851,r,e.num),t.redPoint.active=s;var o=game.ItemUtil.createPrizeInfo(e.itemId,e.num);game.GridUtil.setItemIcon(this._icon,o,!1,game.IconLayoutEnum.SHOW_NONE)},updataAttr:function(e,t){for(var a=void 0,i=void 0,n=void 0,s=t+1,r=0,o=this.spriteType.length;r<o;r++)(a=this.spriteType[r])&&(n=e[b8e.getNormP(game.KeyByStatType[a])])&&(i=game.AttrRulesCfg.getData(a))&&(this.getComponent("addProLab"+(r+1)).string=game.Lang.get(51848,i.name,n*t),this.getComponent("addProLab"+(r+5)).string=game.Lang.get(51848,i.name,n*s));this.getComponent("addProLab4").string=game.Lang.get(51850,e.addPer*t/100),this.getComponent("addProLab8").string=game.Lang.get(51850,e.addPer*s/100);var g=t/11|0,u=s/11|0;this.getComponent("awakeLab1").string=game.Lang.get(51849,g,t%11),this.getComponent("awakeLab2").string=game.Lang.get(51849,u,s%11)},updataStar:function(e){var t=e%11,a=e/11|0,i=game.ResCfg.getUrl(259);5<=a&&a<10?i=game.ResCfg.getUrl(272):10<=a&&(i=game.ResCfg.getUrl(273));for(var n=0;n<10;n++)this.getComponent("curStarIcon"+(n+1)).active=n<t,this.getComponent("curStarIcon"+(n+1)).loadTexture(i);this.skin.lab.string=game.Lang.get(10==t&&0<e?51855:51854)},updataSkill:function(e){var t=game.starSoulData.getFosterSkillCfg(e.fosterType,e.id,e.awakeStar);if(t){var a=game.SkillCfg.getData(t.skill);this.skillIcon.setData(t.skill),this.skillIcon.skillParam=e,this.skillIcon.setName(a.name),this.skillIcon.setIconGray(e.awakeStar<t.star)}}});b8e.module.registerView(game.ME.StarSoul,e)}(),function(){var e;e=b8e.Enum({None:0,V_DAY_BTN_SELECT:-1,V_PAGE_BTN_SELECT:-1,C_UPDATE_VIEW:-1,C_UPDATE_PAGE_BTN:-1,V_GET_TASK_REWARD:-1,V2C_RECHARGE:-1,C2C_RECHARGE:-1,V2C_ON_HIDE:-1,C2C_CLOSR_ACT:-1,C2V_UPDATE_SCORE_LIST:-1,V2C_GET_SCORE_AWARD:-1}),b8e.RC("$$game","$$OpenSerCarnivalEvts",e)}(),function(){var e=b8e.Object.extends({id:0,taskRecord:null,carnivalProcess:null,rechargeRecord:null,endDay:0,selectDay:1,moduleType:0,ctor:function(){this.taskRecord=[],this.carnivalProcess=[],this.rechargeRecord=[],this.dayBtnInfos=[],this.taskTypeInfoMap=b8e.HashMap.get(),this.taskIdInfoMap=b8e.HashMap.get(),this.taskProcessMap=b8e.HashMap.get(),this.carnivalScoreMap=b8e.HashMap.get(),this.carnivalScoreRecord=[]},setData:function(e){var t=this;t.taskRecord=e.carnivalTaskRecord,t.carnivalProcess=e.carnivalProcess,t.rechargeRecord=e.carnivalRechargeRecord,t.carnivalId=e.carnivalId,t.carnivalScoreRecord=e.carnivalScoreRecord,t.carnivalScoreMap.set(t.carnivalId,e.carnivalScore),t.checkScoreAlert(!0),t.id=t.getCurOpenId(),t.setProcessMap()},resetData:function(){var e=this;e.endDay=0,e.moduleType=0;var t=e.getCurOpenId();t&&e.id!=t&&(e.id=t,e.selectDay=1,e.taskRecord.length=0,e.carnivalProcess.length=0,e.dayBtnInfos.length=0,e.taskTypeInfoMap.clear(),e.taskIdInfoMap.clear(),e.taskProcessMap.clear()),e.rechargeRecord.length=0},setProcessMap:function(){for(var e=this.carnivalProcess.length,t=void 0,a=0;a<e;a++){if(!(t=this.carnivalProcess[a]))return;this.taskProcessMap.set(t.taskType,t.process)}},updateProcess:function(e){this.taskProcessMap.set(e.taskType,e.process)},updateRechargeRecord:function(e){var t=this.taskTypeInfoMap.get(game.OpenSerDayTaskType.SINGLE_RECHARGE);if(t)for(var a=t.length,i=void 0,n=0;n<a;n++){if(!(i=t[n]))return;i.cfg.condition==e&&this.rechargeRecord.indexOf(e)<0&&this.rechargeRecord.push(e)}},getCurOpenId:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this.getCurOpenCfg(t);return a?a.id:0},getCurOpenCfg:function(e){var t=game.CarnivalOpenCfg.getDatas();if(!t)return null;for(var a=t.length,i=void 0,n=0;n<a;n++){if(!(i=t[n]))return null;if(this.checkIsOpen(i))return 0==this.endDay&&e&&(this.endDay=i.serverEnd,this.moduleType=i.type),i}return 0},checkIsOpen:function(e){var t=e.serverStart,a=e.serverEnd,i=game.miscData.openServerDay;return t<=i&&i<a},getDayBtnInfos:function(){return this.dayBtnInfos.length<1&&this.initDayBtnInfos(),this.dayBtnInfos},getCurrSelDayInfo:function(){return this.dayBtnInfos[this.getCurrIndex(this.selectDay)]},initDayBtnInfos:function(){var e=game.CarnivalTaskClientCfg.getData(this.id,!0);if(e){this.selectDay=e[0].serverStart;for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++){if(!(a=e[n]))return;(i=new game.OpenSerDayBtnInfo).setData(a),this.selectDay==i.serverStart&&(i.isSelect=!0,this.selectDayInfo=i),this.dayBtnInfos.push(i)}}},updateDayBtnSelect:function(e){var t=this.dayBtnInfos[this.getCurrIndex(this.selectDay)];if(t){t.isSelect=!1,this.selectDay=e;var a=this.dayBtnInfos[this.getCurrIndex(e)];a&&(a.isSelect=!0)}},getCurrIndex:function(e){var t=this.dayBtnInfos[0];return t?e-t.serverStart:0},updateDayBtnState:function(){for(var e=this.dayBtnInfos,t=e.length,a=void 0,i=0;i<t;i++){if(!(a=e[i]))return;a.checkSerDay()}},getIsOpen:function(){return 0<this.getCurOpenId()},getIsOpenType:function(e){return this.getCurOpenId(!1)&&this.moduleType==e},updateTaskProcess:function(e){this.dayBtnInfos.length<1&&this.initDayBtnInfos();var t=this.taskTypeInfoMap.get(e);if(t)for(var a=t.length,i=void 0,n=void 0,s=0;s<a;s++){if(!(i=t[s]))return;n=this.getTaskProcess(e,i),i.updateProcess(n)}},updateTaskCompState:function(e){var t=this.taskIdInfoMap.get(e.taskId);if(t){var a=t.cfg;if(a&&0<a.score){var i=this.carnivalScoreMap.get(a.openId);i=i?i+a.score:a.score,this.carnivalScoreMap.set(a.openId,i)}t.updateTaskComplete()}},initTaskState:function(e){-1<this.taskRecord.indexOf(e.cfg.id)&&(e.isGet=!0,e.canGet=!1);var t=e.type,a=this.getTaskProcess(t,e);e.updateProcess(a||0)},getTaskProcess:function(e,t){var a=game.OpenSerDayTaskType,i=0,n=t.cfg;switch(e){case a.ARENA_RANK:i=game.arenaData.mineRank;break;case a.GEM:i=game.partnerData.getAllPantnerGemTotalLv();break;case a.MAIN_INS:i=game.mainInstanceData.group-1;break;case a.EQUIP_STRENGTH:i=game.partnerData.getPartnerNumByIntensify(n.condition);break;case a.EQUIP_QUALITY:i=game.partnerData.getSlotNumBySuitQuality(n.condition);break;case a.PARTNER_TOP:i=game.partnerData.getPantmerNumByBreak(n.condition);break;case a.MOUNT_STAR:i=game.fosterData.getFosterConditionStar(game.NewFosterType.MOUNT,n.condition);break;case a.ZHAN_JI_STAR:i=game.fosterData.getFosterConditionStar(game.NewFosterType.ZHANJI,n.condition);break;case a.HALO_STAR:i=game.fosterData.getFosterConditionStar(game.NewFosterType.HALO,n.condition);break;case a.SHENHUN_STAR:i=game.fosterData.getFosterAllStar(game.NewFosterType.SHENHUN);break;case a.CHUILIAN:i=game.partnerData.getAllPartnerRefinelv();break;case a.FUHUN:i=game.partnerData.getAllPartnerPurifylv();break;case a.TOTAL_RECHARGE:i=game.rechargeData.rechargeMoney;break;case a.ZS_EQUIP_PROPER:i=game.partnerEquipData.getExcEquipNumByLv(n.condition);break;case a.ASSIGN_PARTNER_INS:i=game.baoZangData.curId;break;case a.ASSIGN_YZSL:i=game.zhaoqinData.maxLayer;break;case a.ZHUANJI_MAX:i=game.zhuanJiData.maxSuccessId;break;case a.SINGLE_RECHARGE:var s=n.condition;-1<this.rechargeRecord.indexOf(s)&&(i=s);break;case a.PARTNER_STAR:i=game.partnerData.getPantmerNumByStar(n.condition);break;case a.ZHAN_JIANG:i=game.zhanjiangData.getLayer();break;case a.MOUNT_COLLECT:i=game.fosterData.getActiveNumByType(game.NewFosterType.MOUNT);break;case a.WING_COLLECT:i=game.fosterData.getActiveNumByType(game.NewFosterType.WING);break;case a.ZHAN_JI_COLLECT:i=game.fosterData.getActiveNumByType(game.NewFosterType.ZHANJI);break;case a.HALO_COLLECT:i=game.fosterData.getActiveNumByType(game.NewFosterType.HALO);break;case a.SHENHUN_COLLECT:i=game.fosterData.getActiveNumByType(game.NewFosterType.SHENHUN);break;case a.BARBARIAN:i=game.barbarianData.frontId;break;case a.WING_STAR:i=game.fosterData.getFosterConditionStar(game.NewFosterType.WING,n.condition);break;case a.ZX_COLLECT:i=game.zhenXingData.getActiveNum();break;case a.ZX_STAR:i=game.zhenXingData.getZhenXingConditionStar(n.condition);break;case a.SQ_COLLECT:i=game.shenQiData.getActiveNum();break;case a.SQ_LEVEL:i=game.shenQiData.getConditionLv(n.condition);break;case a.PARTNER:i=game.partnerData.getPartnerNumByQuality(n.condition);break;case a.LEVEL:i=game.mainRoleData.lv;break;case a.POWER:i=game.mainRoleData.power;break;case a.EQUIP_WEAR:i=game.partnerEquipData.getWearEquipNumByQuality(n.condition);break;case a.PARTNER_JP:i=game.partnerData.getPartnerNumByJpLv(n.condition);break;case a.PARTNER_ICON:i=game.mapAchieveData.allAchNum;break;default:i=this.taskProcessMap.get(e)}return i||0},checkDayBtnRedPoint:function(){var e=!1;this.dayBtnInfos.length<1&&this.initDayBtnInfos();for(var t=this.dayBtnInfos.length,a=void 0,i=0;i<t;i++){if(!(a=this.dayBtnInfos[i]))return!1;a.checkAlert()&&!e&&(e=!0)}return e},taskSortHandler:function(e,t){if(e.isTotalRecharge==t.isTotalRecharge){if(e.isGet==t.isGet)return e.canGet==t.canGet?e.cfg.id-t.cfg.id:e.canGet?-1:1;if(e.isGet)return 1;if(t.isGet)return-1}else{if(e.isGet)return 1;if(t.isGet)return-1}},getScoreList:function(){if(this.scoreList&&0<this.scoreList.length)return this.scoreList;var e=this.getCurOpenId(!1);if(!e)return null;var t=this.getCarnivalScoreCfgsByOpenId(e);if(!t||t.length<1)return null;var a=void 0,i=void 0,n=t.length;this.scoreList||(this.scoreList=[]);for(var s=this.scoreList,r=0;r<n;r++)a=t[r],(i=game.OpenSerCarnivalScoreInfo.get()).setData(a),s[s.length]=i;return s},checkScoreAlert:function(e){var t=this.getScoreList();if(!t)return!1;var a=this.getCurOpenId(!1);if(!a)return!1;for(var i=void 0,n=!1,s=this.getCarnivalScoreById(a),r=this.carnivalScoreRecord,o=t.length,g=0;g<o;g++)if((i=t[g]).canGet=s>=i.score,i.isGet=-1<r.indexOf(i.id),i.canGet&&!i.isGet&&(n=!0,!e))return n;return n},getCarnivalScoreCfgsByOpenId:function(e){return this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.openId=e,game.CarnivalScoreCfg.getData(this.cfgObj,!0)},getCarnivalScoreById:function(e){var t=this.carnivalScoreMap.get(e);return t||0},carnivalScoreResp:function(e){this.carnivalScoreRecord[this.carnivalScoreRecord.length]=e},getScoreItemId:function(){return this.scoreItemId||(this.scoreItemId=+game.CfgUtil.getMiscValue(game.CarnivalMiscCfg,"scoreItemId",!1)),this.scoreItemId}});game.openSerCarnivalData=game.openSerCarnivalData||new e}(),function(){var e;e=b8e.Object.extends({serverStart:0,pageNum:0,isSelect:!1,btnState:!1,alert:!1,selectPage:1,selectPageInfo:null,day:0,ctor:function(){this._super(),this.pageBtnInfos=[]},setData:function(e){this.serverStart=e.serverStart,this.pageNum=e.pageNum,this.day=e.day,this.checkSerDay()},checkSerDay:function(){var e=game.miscData.openServerDay;this.btnState=e>=this.serverStart},getPageBtnInfos:function(){return this.pageBtnInfos.length<1&&this.initPageBtnInfo(),this.pageBtnInfos},initPageBtnInfo:function(){for(var e=void 0,t=void 0,a=1;a<=this.pageNum;a++){if(!(t=game.CarnivalTaskCfg.getData(game.openSerCarnivalData.id,this.serverStart,a,!0)))return;(e=new game.OpenSerTabBtnInfo).setData(t[0]),(e.pageIndex=a)==this.selectPage&&(e.isSelect=!0),this.pageBtnInfos.push(e)}},getCurrSelTabInfo:function(){return this.pageBtnInfos[this.selectPage-1]},updatePageBtnSelect:function(e){var t=this.pageBtnInfos[this.selectPage-1];if(t){t.isSelect=!1,this.selectPage=e;var a=this.pageBtnInfos[this.selectPage-1];a&&(a.isSelect=!0)}},daybtn:function(){this.btnState&&this.send(game.OpenSerCarnivalEvts.V_DAY_BTN_SELECT,this.serverStart)},checkAlert:function(){this.alert=!1,this.pageBtnInfos.length<1&&this.initPageBtnInfo();for(var e=this.pageBtnInfos.length,t=0;t<e;t++)this.pageBtnInfos[t].checkAlert()&&!this.alert&&(this.alert=!0);return this.alert}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OpenSerDayBtnInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,isSelect:!1,taskInfos:null,pageIndex:1,alert:!1,ctor:function(){this._super(),this.taskInfos=[]},setData:function(e){this.cfg=e},getTaskInfos:function(){return this.taskInfos.length<1&&this.initTaskInfo(),this.taskInfos},initTaskInfo:function(){var e=void 0,t=void 0,a=game.openSerCarnivalData,i=game.CarnivalTaskCfg.getData(a.id,this.cfg.serverStart,this.pageIndex,!0);if(i)for(var n=i.length,s=void 0,r=0;r<n;r++){s=(t=i[r]).taskType,(e=new game.OpenSerTaskInfo).setData(t),a.initTaskState(e);var o=a.taskTypeInfoMap.get(s);o||(o=[],a.taskTypeInfoMap.set(s,o)),o.push(e),a.taskIdInfoMap.set(t.id,e),this.taskInfos.push(e)}},checkAlert:function(){var e=this;if(!(game.miscData.openServerDay<e.cfg.serverStart)){e.alert=!1,e.taskInfos.length<1&&e.initTaskInfo();for(var t=e.taskInfos.length,a=void 0,i=0;i<t;i++)if(a=e.taskInfos[i],!e.alert&&a.canGet){if(a.isGiftPack&&!a.isDirectGet)continue;if(a.isExpired)continue;return e.alert=!0,e.alert}return e.alert}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OpenSerTabBtnInfo",e)}(),function(){var e;e=b8e.Object.extends({type:0,cfg:null,isGet:!1,canGet:!1,process:0,isExpired:!1,isGiftPack:!1,isDirectGet:!1,isTotalRecharge:!1,meetConditions:!1,ctor:function(){this._super()},setData:function(e){this.cfg=e,this.type=e.taskType},updateProcess:function(e){var t=this,a=game.OpenSerDayTaskType,i=game.miscData.openServerDay,n=i>=t.cfg.serverStart&&i<t.cfg.serverEnd;if(t.type==a.BUY_GIFT){if(t.isGet)return;0<t.cfg.curPrice?(t.meetConditions=game.amount.get(game.AmountType.YUAN_BAO)>=t.cfg.curPrice,t.canGet=n&&t.meetConditions):(t.meetConditions=t.canGet=n,t.isDirectGet=!0),t.isGiftPack=!0}else if(t.type==a.VIP_GIFT){if(t.isGet)return;game.mainRoleData.vipLevel>=t.cfg.condition?0<t.cfg.curPrice?(t.meetConditions=game.amount.get(game.AmountType.YUAN_BAO)>=t.cfg.curPrice,t.canGet=n&&t.meetConditions):(t.meetConditions=t.canGet=n,t.isDirectGet=!0):t.meetConditions=t.canGet=!1,t.isGiftPack=!0}else if(t.type==a.SINGLE_RECHARGE)t.isExpired=game.miscData.openServerDay>t.cfg.serverStart,t.meetConditions=!t.isExpired&&!t.isGet&&e==t.cfg.condition,t.canGet=n&&t.meetConditions,t.process=e>=t.cfg.condition?1:0;else if(t.type==a.ARENA_RANK)t.meetConditions=!t.isGet&&e<=t.cfg.process,t.canGet=n&&t.meetConditions,t.process=e;else{var s=t.cfg.process;t.meetConditions=!t.isGet&&s<=e,t.canGet=n&&t.meetConditions,t.process=s<=e?s:e,t.isTotalRecharge=t.type==a.TOTAL_RECHARGE}},updateTaskComplete:function(){this.isGet=!0,this.meetConditions=this.canGet=!1},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.cfg.award,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(i);if(0<this.cfg.score){var s=game.openSerCarnivalData.getScoreItemId();(i=game.ItemUtil.createBaseItemInfo(s,this.cfg.score)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(i)}return this.prizeList}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OpenSerTaskInfo",e)}(),function(){var e;e=b8e.Enum({$$NONE:0,$$GEM:1,$$PARTNER_INS:2,$$ARENA_RANK:3,$$FIELD_BOSS_TIMES:4,$$MATERIAL_INS:5,$$RESET_YUANZHENG:6,$$MAIN_INS:7,$$EQUIP_STRENGTH:8,$$EQUIP_QUALITY:9,$$PARTNER_TOP:10,$$SHENHUN_STAR:11,$$CHUILIAN:12,$$QUAN_MING_BOSS:13,$$ORANGE_RECRUIT:14,$$ARENA_TIMES:15,$$TOTAL_RECHARGE:16,$$BUY_GIFT:17,$$SINGLE_RECHARGE:18,$$VIP_GIFT:19,$$ZS_EQUIP_PROPER:20,$$PARTNER_UPGRADE:21,$$ASSIGN_PERSON_BOSS:22,$$ASSIGN_PARTNER_INS:23,$$ASSIGN_YZSL:24,$$RED_ZHAOMU:25,$$GOLD_ZHAOMU:26,$$ZHUANJI_CHANLLENGE_TIMES:27,$$ZHUANJI_MAX:28,$$PARTNER_STAR:29,$$ZHAN_JIANG:30,$$SHENHUN_UPGRADE:31,$$SHENHUN_COLLECT:32,$$MOUNT_COLLECT:33,$$MOUNT_UPGRADE:34,$$MOUNT_STAR:35,$$WING_COLLECT:36,$$ZHAN_JI_COLLECT:37,$$ZHAN_JI_STAR:38,$$YUAN_BAO:39,$$FUHUN:40,$$HALO_COLLECT:41,$$HALO_STAR:42,$$EXPLORE:43,$$BARBARIAN:44,$$GUILD_INS:45,$$WING_STAR:46,$$ZX_COLLECT:47,$$ZX_STAR:48,$$SQ_COLLECT:49,$$SQ_LEVEL:50,$$PARTNER:51,$$LEVEL:52,$$POWER:53,$$EQUIP_WEAR:54,$$MYSTERY:55,$$PARTNER_JP:56,$$ACCU_RECHARGE:57,$$PARTNER_ICON:58}),b8e.RC("$$game","$$OpenSerDayTaskType",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.openSerCarnivalData,this.taskTypeEnum=game.OpenSerDayTaskType,this.spotAlert=game.spotAlert.set(game.SAE.OPEN_SER_CARNIVAL)},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.initOpenServer},MainRole:{C_RESET_DAILY:e.resetDaily,C_VIP_LEVEL_CHANGE:e.updateVIPLevel,C_LEVEL_UP:e.roleLevelUp,C_POWER_CHANGE:e.rolePowerChange},Back:{C_UPDATE_AMOUNT:e.updateAmount},Arena:{C2C_SYS_DATA_SUCCEED:e.updateAreaRank},MainInstance:{C2C_CHALLENGE_WIN:e.updateMainTask},Instance:{SYNC_INSTANCE_DATA:e.updateMainTask},PartnerBreak:{V_UPDATE_BREAK:e.updatePartnerBreak},Foster:{C2C_FOSTER_UPSTAR:e.fosterUpStar,C2C_FOSTER_ACTIVE:e.fosterActive,C2C_FOSTER_DATA_INIT:e.initFoster},Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},EquipForge:{C2C_FORGE_SUCCEED:e.forgeSucceed},PartnerEquipChange:{C2C_EQUIP_CHANGE:e.partnerEquipChange,C2C_EXC_EQUIP_CHANGE:e.updatePartnerExcEquip},Partner:{C_INIT_DATA:e.initPartnerData,C_UPDATE_ACTIVE:e.activePartner},BaoZang:{C2C_CHALLENGE_WIN:e.updatePartnerBiography},ZhaoQin:{C2C_CHALLENGE_WIN:e.updateBraveTrial},PushTip:{C2C_SHOW_OPENSER:e.showPage},ZhuanJi:{C2C_SYSYN_DATA:e.updateZhuanJi},ZhuanJiBattle:{C2C_CHALLENGE_SUCCEED:e.updateZhuanJi},PartnerStar:{C2C_UPDATE_STAR_TASK:e.updatePartnerStar},ZhanJiang:{C2C_CHALLENGE_WIN:e.updateZhanJiang},ZhenXingActive:{C2C_UPDATE_ACTIVE:e.updateZhenXing},ZhenXingStar:{C2C_STAR_SUCCESS:e.updateZhenXingStar},ShenQiActive:{C2C_UPDATE_ACTIVE:e.updateShenQi},ShenQiJinJie:{C2C_JINJIE_SUCCESS:e.updateShenQiLv},Barbarian:{C2C_CHALLENGE:e.updateBarbarian,C2C_SYS_DATA_SUCCEED:e.updateBarbarian},PartnerSpirit:{V_UPDATE_SPIRIT:e.updateJpLv},MapAchieve:{C2C_UPDATE_SCORE:e.updatePartnerMap}},e.handels={CarnivalFinishTaskResp:e.carnivalFinishTaskResp,CarnivalTaskPushMsg:e.carnivalTaskNotify,CarnivalScoreResp:e.carnivalScoreResp}},notify:function(e,t){var a=this;switch(e){case a.Evts.V_DAY_BTN_SELECT:a.onDayBtnSelect(t);break;case a.Evts.V_PAGE_BTN_SELECT:a.onPageBtnSelect(t);break;case a.Evts.V_GET_TASK_REWARD:a.carnivalFinishTaskReq(t);break;case a.Evts.V2C_RECHARGE:var i=game.rechargeData.getIdByMonerAndType(t);if(!i)return;a.dpt(a.Evts.C2C_RECHARGE,i);break;case a.Evts.V2C_ON_HIDE:a.dpt(a.Evts.C2C_CLOSR_ACT);break;case a.Evts.V2C_GET_SCORE_AWARD:a.sender.CarnivalScoreReq(t)}},resetDaily:function(){var e=this;if(e.moduleData.getIsOpen()){var t=e.moduleData.getCurOpenId();e.moduleData.id!=t&&game.module.hide(game.ME.WarOrderMain),e.moduleData.updateDayBtnState(),e.moduleData.resetData(),e.updateProcess(e.taskTypeEnum.SINGLE_RECHARGE),e.updateProcess(e.taskTypeEnum.EQUIP_QUALITY),e.checkSpotAlert()}else game.module.hide(game.ME.OpenSerCarnival)},initOpenServer:function(e){if(this.moduleData.getIsOpen()){var t=e.data;this.moduleData.setData(t),this.checkSpotAlert()}},carnivalFinishTaskResp:function(e){var t=e.readProtobuf(game.pb.CarnivalFinishTaskResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateTaskCompState(t),this.checkSpotAlert(),this.send(this.Evts.C2V_UPDATE_SCORE_LIST),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))},carnivalTaskNotify:function(e){var t=e.readProtobuf(game.pb.CarnivalTaskNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.task;this.moduleData.updateProcess(a),this.moduleData.updateTaskProcess(a.taskType),this.checkSpotAlert()}},carnivalScoreResp:function(e){var t=e.readProtobuf(game.pb.CarnivalScoreResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.carnivalScoreResp(t.id),this.checkSpotAlert(),this.send(this.Evts.C2V_UPDATE_SCORE_LIST))},carnivalFinishTaskReq:function(e){this.sender.CarnivalFinishTaskReq(e)},onDayBtnSelect:function(e){this.moduleData.updateDayBtnSelect(e),this.send(this.Evts.C_UPDATE_VIEW)},onPageBtnSelect:function(e){var t=this.moduleData.getCurrSelDayInfo();t&&(t.updatePageBtnSelect(e),this.send(this.Evts.C_UPDATE_PAGE_BTN))},showPage:function(){this.onPageBtnSelect(3)},updateVIPLevel:function(){var e=this.taskTypeEnum.VIP_GIFT;this.updateProcess(e)},updateAmount:function(){var e=game.amount.get(game.AmountType.YUAN_BAO);if(this.lastMasonry!=e){this.lastMasonry=e;var t=this.taskTypeEnum.VIP_GIFT;this.updateProcess(t),t=this.taskTypeEnum.BUY_GIFT,this.updateProcess(t)}},updateAreaRank:function(){this.updateProcess(this.taskTypeEnum.ARENA_RANK)},updateMainTask:function(){this.updateProcess(this.taskTypeEnum.MAIN_INS)},updatePartnerBreak:function(){this.updateProcess(this.taskTypeEnum.PARTNER_TOP)},initFoster:function(){var e=this,t=game.NewFosterType;e.fosterActive({data:t.MOUNT}),e.fosterActive({data:t.WING}),e.fosterActive({data:t.ZHANJI}),e.fosterActive({data:t.HALO}),e.fosterActive({data:t.SHENHUN}),e.fosterUpStar({data:t.MOUNT}),e.fosterUpStar({data:t.WING}),e.fosterUpStar({data:t.ZHANJI}),e.fosterUpStar({data:t.HALO}),e.fosterUpStar({data:t.SHENHUN})},fosterUpStar:function(e){var t=e.data,a=game.NewFosterType,i=void 0;switch(t){case a.MOUNT:i=this.taskTypeEnum.MOUNT_STAR;break;case a.ZHANJI:i=this.taskTypeEnum.ZHAN_JI_STAR;break;case a.HALO:i=this.taskTypeEnum.HALO_STAR;break;case a.SHENHUN:i=this.taskTypeEnum.SHENHUN_STAR;break;case a.WING:i=this.taskTypeEnum.WING_STAR;break;default:i=0}i&&this.updateProcess(i)},fosterActive:function(e){var t=e.data,a=game.NewFosterType,i=void 0;switch(t){case a.MOUNT:i=this.taskTypeEnum.MOUNT_COLLECT;break;case a.WING:i=this.taskTypeEnum.WING_COLLECT;break;case a.ZHANJI:i=this.taskTypeEnum.ZHAN_JI_COLLECT;break;case a.HALO:i=this.taskTypeEnum.HALO_COLLECT;break;case a.SHENHUN:i=this.taskTypeEnum.SHENHUN_COLLECT;break;default:i=0}i&&this.updateProcess(i)},updateGemLv:function(){this.updateProcess(this.taskTypeEnum.GEM)},updateIntensifyLv:function(){this.updateProcess(this.taskTypeEnum.EQUIP_STRENGTH)},updateEquipSuitQuality:function(){this.updateProcess(this.taskTypeEnum.EQUIP_QUALITY)},updateRefinelv:function(){this.updateProcess(this.taskTypeEnum.CHUILIAN)},updatePurifylv:function(){this.updateProcess(this.taskTypeEnum.FUHUN)},updatePartnerExcEquip:function(){this.updateProcess(this.taskTypeEnum.ZS_EQUIP_PROPER)},updatePartnerBiography:function(){this.updateProcess(this.taskTypeEnum.ASSIGN_PARTNER_INS)},updateZhuanJi:function(){this.updateProcess(this.taskTypeEnum.ZHUANJI_MAX)},updateBraveTrial:function(){this.updateProcess(this.taskTypeEnum.ASSIGN_YZSL)},updatePartnerStar:function(){this.updateProcess(this.taskTypeEnum.PARTNER_STAR)},updateZhanJiang:function(){this.updateProcess(this.taskTypeEnum.ZHAN_JIANG)},updateZhenXing:function(){this.updateProcess(this.taskTypeEnum.ZX_COLLECT)},updateZhenXingStar:function(){this.updateProcess(this.taskTypeEnum.ZX_STAR)},updateShenQi:function(){this.updateProcess(this.taskTypeEnum.SQ_COLLECT)},updateShenQiLv:function(){this.updateProcess(this.taskTypeEnum.SQ_LEVEL)},updateBarbarian:function(){this.updateProcess(this.taskTypeEnum.BARBARIAN)},rechargeSuccess:function(e){if(e&&e.data){this.updateProcess(this.taskTypeEnum.TOTAL_RECHARGE);var t=e.data;if(t.id){var a=game.RechargeCfg.getDataById(t.id);a&&a.rechargeType==game.RechargeType.NORMAL&&(this.moduleData.updateRechargeRecord(a.money),this.updateProcess(this.taskTypeEnum.SINGLE_RECHARGE))}}},forgeSucceed:function(){this.updateGemLv(),this.updateIntensifyLv(),this.updateRefinelv(),this.updatePurifylv(),this.updatePartnerBreak(),this.updatePartnerStar()},partnerEquipChange:function(){this.forgeSucceed(),this.updateEquipSuitQuality(),this.updateEquipWearQulity()},activePartner:function(){this.updateProcess(game.OpenSerDayTaskType.PARTNER)},roleLevelUp:function(){this.updateProcess(game.OpenSerDayTaskType.LEVEL)},rolePowerChange:function(){this.updateProcess(game.OpenSerDayTaskType.POWER)},updateEquipWearQulity:function(){this.updateProcess(game.OpenSerDayTaskType.EQUIP_WEAR)},updateJpLv:function(){this.updateProcess(game.OpenSerDayTaskType.PARTNER_JP)},initPartnerData:function(){this.forgeSucceed(),this.activePartner(),this.updateEquipWearQulity(),this.updateJpLv(),this.updatePartnerExcEquip()},updatePartnerMap:function(){this.updateProcess(game.OpenSerDayTaskType.PARTNER_ICON)},updateProcess:function(e){this.moduleData.updateTaskProcess(e),this.checkSpotAlert()},checkSpotAlert:function(){this.spotAlert.alert=this.moduleData.checkDayBtnRedPoint()||this.moduleData.checkScoreAlert(),this.send(this.Evts.C_UPDATE_VIEW)}}),t=[game.ME.WeekActivity],a=game.Sender.extends({ipc:function(){this.msg={CarnivalFinishTaskReq:this.carnivalFinishTaskReq,CarnivalScoreReq:this.carnivalScoreReq}},carnivalFinishTaskReq:function(e){var t=game.pb.CarnivalFinishTaskRequest;t.taskId=e,this.write(t)},carnivalScoreReq:function(e){var t=game.pb.CarnivalScoreRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.OpenSerCarnival,e,game.OpenSerCarnivalEvts,a,t)}(),function(){var e;e=game.View.extends({notify:function(e){switch(e){case this.Evts.C_UPDATE_VIEW:this.updateDayList();break;case this.Evts.C_UPDATE_PAGE_BTN:this.updatePageList();break;case this.Evts.C2V_UPDATE_SCORE_LIST:this.updateScoreList()}},onShow:function(){var e=this.moduleData.getCurOpenId();if(e){var t=game.ResCfg.getUrl(10126,e);this.skin.banner.loadTexture(t)}this.updateDayList(),this.updateScoreList(),this.updateEndTime()},updateDayList:function(){var e=this.moduleData.getDayBtnInfos();e&&(this.dayList.setData(e),this.updatePageList())},updatePageList:function(){var e=this.moduleData.getCurrSelDayInfo();if(e){var t=e.getPageBtnInfos();t&&(this.pageList.setData(t),this.updateView(e))}},updateView:function(e){var t=this,a=t.skin,i=e.getCurrSelTabInfo().getTaskInfos();if(i)if(i[0].type==game.OpenSerDayTaskType.VIP_GIFT){t.taskList.layout.spacingY=120,t.taskList.touchMovable=!1,a.vipPackageNode.active=!0,t.showInfo||(t.showInfo=[]),t.showInfo.length=0;var n=i.length;if(n<2)return;for(var s=void 0,r=void 0,o=0;o<n;o+=2){if(s=i[o],r=i[o+1],!s.isGet||!r.isGet){t.showInfo.push(s),t.showInfo.push(r);break}if(o+2==n){t.showInfo.push(s),t.showInfo.push(r);break}if(o+3==n){t.showInfo.push(i[o+1]),t.showInfo.push(i[o+2]);break}}t.taskList.setData(t.showInfo)}else{if(t.taskList.layout.spacingY=6,t.taskList.touchMovable=!0,a.vipPackageNode.active=!1,!i)return;i.sort(game.openSerCarnivalData.taskSortHandler),t.taskList.setData(i)}},updateScoreList:function(){var e=this.moduleData.getCurOpenCfg();if(e){var t=this.skin,a=this.moduleData.getCarnivalScoreById(e.id);t.mineScore.string=game.Lang.get(53729,a);var i=a/e.maxScore*t.progressBar.width;i=656<i?656:i,t.progress.width=i}this.moduleData.checkScoreAlert(!0);var n=this.moduleData.getScoreList();n&&this.scoreList.setData(n)},onHide:function(){this.stopTime(),this.send(this.Evts.V2C_ON_HIDE)},updateEndTime:function(){var e=this,t=e.moduleData.getCurOpenCfg(!1).serverEnd-game.miscData.openServerDay,a=e.endTime=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,t);if(a<game.SysTime.curTime)e.stopTime();else{var i=a-game.SysTime.curTime;e.skin.time.string=game.Lang.get(53597,game.TimeUtil.formatTimeSpace(i)),e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),e._timer.reset(),e._timer.start()}},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return this.stopTime(),void(e.time.string="");var t=this.endTime-game.SysTime.curTime;if(t<1)return this.stopTime(),void(e.time.string="");e.time.string=game.Lang.get(53597,game.TimeUtil.formatTimeSpace(t))},stopTime:function(){this._timer&&this._timer.stop()}}),b8e.RC("$$game","$$OpenSerCarnivalBaseView",e)}(),function(){var e;e=game.ListItem.extends({setData:function(e){var t=this.skin;t.selectImg.active=e.isSelect&&e.btnState,t.selectImg_gray.active=e.isSelect&&!e.btnState,t.btn_sprite.active=e.btnState,t.btn_gray.active=!e.btnState,1==game.openSerCarnivalData.moduleType?(t.btn_lbl.active=e.btnState,t.btn_lbl_gray.active=!e.btnState,t.btn_lbl_gray.string=game.Lang.get(52134,e.day),t.btn_lbl.string=game.Lang.get(52134,e.day)):(t.btn_lbl.active=!0,t.btn_lbl_gray.active=!1,t.btn_lbl.string=game.Lang.get(52134,e.serverStart)),t.redPoint.active=e.alert;var a=game.openSerCarnivalData.getCurOpenCfg();this.lookDay=a&&a.lookDay?a.lookDay:0,t.preLab.active=e.serverStart>game.miscData.openServerDay&&e.serverStart<=game.miscData.openServerDay+this.lookDay},daybtn:function(){this.data.serverStart>game.miscData.openServerDay+this.lookDay||this.send(game.OpenSerCarnivalEvts.V_DAY_BTN_SELECT,this.data.serverStart)}}),b8e.RC("$$game","$$OpenSerDayBtnBaseItem",e)}(),function(){var e;e=game.ListItem.extends({setData:function(e){var t=this.skin;t.btn_lbl.string=e.cfg.pageName,t.btn_select.active=e.isSelect,t.redPoint.active=e.alert},pageBtn:function(){this.send(game.OpenSerCarnivalEvts.V_PAGE_BTN_SELECT,this.data.pageIndex)}}),b8e.RC("$$game","$$OpenSerTabBtnBaseItem",e)}(),function(){var e;e=game.ListItem.extends({init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=40},setData:function(e){var t=this.skin;t.titleLab.string=e.cfg.desc;var a=e.cfg,i=game.OpenSerDayTaskType;if(e.type==i.VIP_GIFT)0<a.curPrice?(t.priceNode.active=!0,t.originalLab.string=game.Lang.get(52126,a.oriPrice),t.currentLab.string=game.Lang.get(52127,a.curPrice),t.btn_lbl.string=game.Lang.get(52128),t.redPoint.active=!1):(t.priceNode.active=!1,t.redPoint.active=e.canGet,t.btn_lbl.string=game.Lang.get(52129)),t.vipCond.active=!0,t.progressLab.active=!1,t.vipCond.string=game.Lang.get(52130,a.condition),game.ShaderUtil.setGray(t.getRewBtn,!1);else if(e.type==i.BUY_GIFT)0<a.curPrice?(t.priceNode.active=!0,t.originalLab.string=game.Lang.get(52126,a.oriPrice),t.currentLab.string=game.Lang.get(52127,a.curPrice),t.btn_lbl.string=game.Lang.get(52128),t.redPoint.active=!1):(t.priceNode.active=!1,t.redPoint.active=e.canGet,t.btn_lbl.string=game.Lang.get(52129)),t.vipCond.active=!1,t.progressLab.active=!1,game.ShaderUtil.setGray(t.getRewBtn,!1);else{t.progressLab.active=!0,t.priceNode.active=!1,t.vipCond.active=!1;var n=e.meetConditions?53733:53732;if(t.progressLab.string=game.Lang.get(n,game.CCommonUtil.replaceNum(e.process),game.CCommonUtil.replaceNum(a.process)),t.redPoint.active=e.canGet,e.type==i.SINGLE_RECHARGE){var s=game.miscData.openServerDay<=a.serverStart;t.btn_lbl.string=s?e.canGet?game.Lang.get(52129):game.Lang.get(52132):game.Lang.get(52133),game.ShaderUtil.setGray(t.getRewBtn,!s),t.redPoint.active=e.canGet}else t.btn_lbl.string=e.meetConditions?game.Lang.get(52129):game.Lang.get(52132),game.ShaderUtil.setGray(t.getRewBtn,!1)}e.isGet&&(t.priceNode.active=!1,t.vipCond.active=!1,t.progressLab.active=!1),t.getRewBtn.active=!e.isGet,t.isGet.active=e.isGet,this.updateRewList()},updateRewList:function(){var e=this.data.getPrizeList();e&&this._list.setData(e)},getRewBtn:function(){var e=this.data,t=e.cfg,a=t.moduleId,i=e.type==game.OpenSerDayTaskType.BUY_GIFT&&0==t.curPrice;if(e.canGet)this.send(game.OpenSerCarnivalEvts.V_GET_TASK_REWARD,t.id);else if(!e.canGet&&t.serverStart>game.miscData.openServerDay&&(e.meetConditions||i)){var n=t.serverStart-game.miscData.openServerDay;game.notice.show(53736,n)}else if(e.isGiftPack)game.notice.show(52207);else if(!e.isExpired&&0<a)if(e.type==game.OpenSerDayTaskType.SINGLE_RECHARGE)this.send(game.OpenSerCarnivalEvts.V2C_RECHARGE,t.condition);else{if(e.type==game.OpenSerDayTaskType.GUILD_INS&&!game.guildData.hasGuild())return void game.notice.show(2621);0<t.toggleId?game.module.showToggle(a,t.toggleId):game.module.show(a),game.module.hide(game.ME.OpenSerCarnival)}else e.isExpired?game.notice.show(53025):game.module.hide(game.ME.OpenSerCarnival)}}),b8e.RC("$$game","$$OpenSerTaskBaseItem",e)}(),function(){var e=game.OpenSerCarnivalBaseView.extends({_showModel:!0,ctor:function(){this._super(1428)},init:function(){var e=this,t=e.skin;e.moduleData=game.openSerCarnivalData;var a=e.dayList=new game.List;a.itemRender=game.OpenSerDayBtnItem,a.addToParent(t.dayBtnList),a.bindEnum=e.moduleEnum,a.layout.paddingTop=5,a.layout.paddingLeft=5,a.layout.spacingX=0,a.layout.spacingY=0;var i=e.pageList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);i.itemRender=game.OpenSerTabBtnItem,i.addToParent(t.taskBtnList),i.bindEnum=e.moduleEnum,i.layout.spacingX=3,i.layout.paddingLeft=0,i.layout.paddingRight=0,i.layout.paddingTop=-10;var n=e.taskList=new game.List;n.itemRender=game.OpenSerTaskItem,n.bindEnum=e.moduleEnum,n.layout.paddingTop=6,n.layout.spacingY=6,n.addToParent(t.taskList);var s=e.scoreList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);s.itemRender=game.OpenSerScoreItem,s.bindEnum=e.moduleEnum,s.layout.paddingLeft=0,s.layout.paddingTop=0,s.layout.spacingX=3,s.addToParent(t.scoreList);var r=game.ResCfg.getUrl(10127);t.title.loadTexture(r)},onShow:function(){this._super(),this.updateScoreList()},$$getTaskItem:function(){if(!this.taskList||!this.moduleData)return null;if(1!=this.moduleData.selectDay)return null;var e=this.moduleData.getCurrSelDayInfo();if(!e||1!=e.selectPage)return null;var t=e.getCurrSelTabInfo();if(!t)return null;var a=t.getTaskInfos();if(!a||a.length<1)return null;var i=this.taskList.getItemRender(a[0]);return i&&i.skin?i.skin.getRewBtn:null}});b8e.module.registerView(game.ME.OpenSerCarnival,e)}(),function(){var e;e=game.OpenSerDayBtnBaseItem.extends({ctor:function(){this._super(1429),this.setSize(152,98)}}),b8e.RC("$$game","$$OpenSerDayBtnItem",e)}(),function(){var e;e=game.OpenSerTabBtnBaseItem.extends({ctor:function(){this._super(1430),this.setSize(120,42)}}),b8e.RC("$$game","$$OpenSerTabBtnItem",e)}(),function(){var e;e=game.OpenSerTaskBaseItem.extends({ctor:function(){this._super(1431),this.setSize(522,153)}}),b8e.RC("$$game","$$OpenSerTaskItem",e)}(),function(){var e,t;t=b8e.Enum({None:0,V_UPDATE_COST:b8e.enc(),C_GET_PRIZE:b8e.enc(),C_BUY_GOODS:b8e.enc(),V_UPDATE_DATA:b8e.enc(),V_TOGGLECHANGE:b8e.enc()}),e=b8e.Enum({DAY:1,WEEK:2,FOREVER:3}),b8e.RC("$$game","$$VipActivityEvts",t),b8e.RC("$$game","$$VipActivityTypes",e)}(),function(){var e=game.Control.extends({isShowView:!1,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.VIP_ACTIVITY,game.SAE.WELFARE_ALERT),this.data=game.vipActivityData},ipc:function(){this.evts={Welfare:{C_INIT_MODEL:this.updateWelfare},Vip:{C_UPDATE_VIP_BUY:this.updateVipBuy},MainRole:{C_VIP_LEVEL_CHANGE:this.changeVipLevel}},this.handels={VipDailyAwardResp:this.vipDailyAwardResp}},changeVipLevel:function(){if(game.moduleOpen.checkOpen(game.ME.VipActivity)){this.data.updateList(),this.checkAlert(),this.send(this.Evts.V_UPDATE_DATA)}},updateWelfare:function(e){if(game.moduleOpen.checkOpen(game.ME.VipActivity)){var t=e.data;t&&(this.data.setData(t),this.checkAlert(),this.send(this.Evts.V_UPDATE_DATA))}},updateVipBuy:function(e){if(game.moduleOpen.checkOpen(game.ME.VipActivity)){var t=e.data;t&&(this.data.updateBuyCount(t.isWeekly,t.id),this.send(this.Evts.V_UPDATE_DATA))}},vipDailyAwardResp:function(e){var t=e.readProtobuf(game.pb.VipDailyAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updateDayAward(t.lv),this.checkAlert(),this.send(this.Evts.V_UPDATE_DATA),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))},checkAlert:function(){this.spotAlert.alert=this.data.canReceiveDayAward()},notify:function(e,t){switch(e){case this.Evts.C_BUY_GOODS:var a=game.VipActivityTypes.WEEK==t.type;this.dpt(this.Evts.C_BUY_GOODS,{isWeek:a,id:t.id})}},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},btn_3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)},getBtn:function(){var e=this.data.getCurVipCfg();this.sender.VipDailyAwardReq(e.vipLv)},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)}}),t=game.Sender.extends({ipc:function(){this.msg={VipDailyAwardReq:this.vipDailyAwardReq}},vipDailyAwardReq:function(e){var t=game.pb.VipDailyAwardRequest;t.lv=e,this.write(t)}}),a=[game.ME.VipActivityDay,game.ME.VipActivityWeek,game.ME.VipActivityForever];b8e.module.registerControl(game.ME.VipActivity,e,game.VipActivityEvts,t,a)}(),function(){var e;e=b8e.Object.extends({limtNum:0,buyNum:0,id:0,cfg:null,type:0,vipLv:0,isCanBuy:!1,setData:function(e,t){this.id=t.id,this.type=e,this.cfg=t,e==game.VipActivityTypes.FOREVER&&(this.vipLv=t.vipLv),this.setStepLimit()},getPrizeList:function(){if(this.award)return this.award;this.award=[];for(var e,t,a=this.cfg.award,i=a.length,n=0;n<i;n++)e=a[n],t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num),this.award.push(t);return this.award},setStepLimit:function(){var e=this.cfg;if(this.limtNum=e.num,this.type==game.VipActivityTypes.WEEK&&e.step&&1<e.step.length){var t=e.step[0],a=e.step[1];game.mainRoleData.vipLevel>t&&(this.limtNum+=(game.mainRoleData.vipLevel-t)*a)}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$VipActivityInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.vipActivityWeekMap=b8e.HashMap.get(),this.vipActivityForeverMap=b8e.HashMap.get(),this.vipActivityWeekBuyMap=b8e.HashMap.get(),this.vipActivityForeverBuyMap=b8e.HashMap.get(),this.vipActivityWeeks=[],this.vipActivityForevers=[],this.isInit=!1,this.dayVipLv=0},initCfgs:function(){if(!this.isInit){var e=game.VipWeeklyCfg.getDatas(),t=void 0;if(e&&e.length)for(var a=0,i=e.length;a<i;a++)(t=new game.VipActivityInfo).setData(game.VipActivityTypes.WEEK,e[a]),this.vipActivityWeeks.push(t),this.vipActivityWeekMap.set(t.id,t);if((e=game.VipForeverCfg.getDataByType(1))&&e.length)for(var n=0,s=e.length;n<s;n++)(t=new game.VipActivityInfo).setData(game.VipActivityTypes.FOREVER,e[n]),this.vipActivityForevers.push(t),this.vipActivityForeverMap.set(t.id,t);this.isInit=!0}},setData:function(e){var t=this;t.initCfgs(),t.dayVipLv=e.oldVipLv,t.vipDailyAward=e.vipDailyAward,t.vipDailyAward&&t.vipDailyAward.sort(t.sortVipWelfare),t.vipActivityWeekBuyMap.clear(),t.vipActivityForeverBuyMap.clear();if(e.vipWeekly)for(var a=0,i=e.vipWeekly.length;a<i;a++)t.vipActivityWeekBuyMap.set(e.vipWeekly[a].id,e.vipWeekly[a].count);if(e.vipForever)for(var n=0,s=e.vipForever.length;n<s;n++)t.vipActivityForeverBuyMap.set(e.vipForever[n].id,e.vipForever[n].count);t.updateList()},sortVipWelfare:function(e,t){return e-t},updateList:function(){this.checkIsCanBuy(this.vipActivityWeeks,this.vipActivityWeekBuyMap),this.checkIsCanBuy(this.vipActivityForevers,this.vipActivityForeverBuyMap)},checkIsCanBuy:function(e,t){for(var a=void 0,i=0,n=e.length;i<n;i++){a=e[i];var s=0|t.get(a.id);a.buyNum=s,a.setStepLimit(),a.isCanBuy=a.vipLv<=game.mainRoleData.vipLevel&&a.buyNum<a.limtNum,a.isSellOver=a.buyNum>=a.limtNum}e.sort(this.sortList)},updateBuyCount:function(e,t){var a=e?this.vipActivityWeeks:this.vipActivityForevers,i=e?this.vipActivityWeekMap:this.vipActivityForeverMap,n=e?this.vipActivityWeekBuyMap:this.vipActivityForeverBuyMap,s=i.get(t);s&&(s.buyNum++,n.set(t,s.buyNum),s.isCanBuy=s.buyNum<s.limtNum,s.isSellOver=s.buyNum>=s.limtNum,a.sort(this.sortList))},updateDayAward:function(e){this.vipDailyAward&&this.vipDailyAward.push(e)&&this.vipDailyAward.sort(this.sortVipWelfare)},sortList:function(e,t){return e.isCanBuy&&!t.isCanBuy?-1:!e.isCanBuy&&t.isCanBuy?1:!e.isSellOver&&t.isSellOver?-1:e.isSellOver&&!t.isSellOver?1:(e.id,void t.id)},canReceiveDayAward:function(){return!this.vipDailyAward||-1==this.vipDailyAward.indexOf(game.mainRoleData.vipLevel)},getCurVipCfg:function(){if(this.dayVipLv>=game.mainRoleData.vipLevel)return game.VipCfg.getData(game.mainRoleData.vipLevel);for(var e=this.dayVipLv?this.dayVipLv:1,t=!1,a=e;a<=game.mainRoleData.vipLevel;a++)if(-1==this.vipDailyAward.indexOf(a)){e=a,t=!0;break}return e=t?e:game.mainRoleData.vipLevel,game.VipCfg.getData(e)}});game.vipActivityData=game.vipActivityData||new e}(),function(){var e=game.View.extends({ctor:function(){this._super("vipActivity/VipActivityDayView"),this.spotAlerts={VIP_ACTIVITY:this.vipActivityAlert}},vipActivityAlert:function(e){this.skin.spotAlert.active=e.alert},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=6,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=15;var t=this.prizeList2=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(this.skin.prizeList2),t.layout.paddingLeft=6,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=15,this.data=game.vipActivityData,this.curPrizes=[],this.nextPrizes=[]},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView()}},updateView:function(){var e=this,t=e.skin,a=game.VipCfg.maxVipLv<=game.mainRoleData.vipLevel,i=e.data.getCurVipCfg();if(e.curPrizes&&game.CCommonUtil.clearList(e.curPrizes),t.vipLab.string="V"+i.vipLv,e.getPrizeList(e.curPrizes,i),e.prizeList.setData(e.curPrizes),t.getBtn.active=!e.data.vipDailyAward||-1==e.data.vipDailyAward.indexOf(i.vipLv),t.isGetImg.active=e.data.vipDailyAward&&-1!=e.data.vipDailyAward.indexOf(i.vipLv),t.nextNode.active=!a,!a){var n=game.VipCfg.getData(game.mainRoleData.vipLevel+1);t.vipLab2.string="V"+n.vipLv,e.nextPrizes&&game.CCommonUtil.clearList(e.nextPrizes),e.getPrizeList(e.nextPrizes,n),e.prizeList2.setData(e.nextPrizes);var s=game.amount.get(game.AmountType.VIP_EXP),r=n.needNum-s;e.skin.rechargeNumLab.string=game.Lang.get(51909,r)}},getPrizeList:function(e,t){for(var a,i,n=t.dailyAward,s=n.length,r=0;r<s;r++)a=n[r],i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num),e.push(i)},onShow:function(){this.updateView()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.VipActivityDay,e)}(),function(){var e=game.View.extends({ctor:function(){this._super("vipActivity/VipActivityForeverView")},init:function(){var e=this.list=new game.List;e.itemRender=game.VipActivityItem,e.bindEnum=game.ME.VipActivity,e.addToParent(this.skin.listNode),this.data=game.vipActivityData},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView()}},updateView:function(){this.list.setData(this.data.vipActivityForevers)},onShow:function(){this.updateView()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.VipActivityForever,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("vipActivity/VipActivityItem"),this.setSize(600,176)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=6,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=15},setData:function(e){if(e){var t=this.skin,a=e.getPrizeList();a&&this.prizeList.setData(a);var i=0;i=e.type==game.VipActivityTypes.FOREVER?(t.vipLab.string="V"+e.vipLv,t.vipLab.active=!0,t.rechargeBtn.active=game.mainRoleData.vipLevel<e.vipLv,t.titleLab.x=102,51911):(t.rechargeBtn.active=t.vipLab.active=!1,t.titleLab.x=20,51910);var n=e.buyNum>=e.limtNum;t.titleLab.string=e.cfg.title,t.isGetImg.active=n,t.getBtn.active=!n&&game.mainRoleData.vipLevel>=e.vipLv,t.limitLab.active=!n,t.originPriceLab.string=e.cfg.originPrice,t.nowPriceLab.string=e.cfg.price,t.limitLab.string=game.Lang.get(i,e.buyNum,e.limtNum)}},rechargeBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)},getBtn:function(){this.send(game.VipActivityEvts.C_BUY_GOODS,this.data)}}),b8e.RC("$$game","$$VipActivityItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super("vipActivity/VipActivityView"),this.toggles={toggle_btn_1:game.ME.VipActivityDay,toggle_btn_2:game.ME.VipActivityWeek,toggle_btn_3:game.ME.VipActivityForever},this.spotAlerts={VIP_ACTIVITY:this.vipActivityAlert}},vipActivityAlert:function(e){this.skin.red_spot_1.active=e.alert},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.VipActivity,e)}(),function(){var e=game.View.extends({ctor:function(){this._super("vipActivity/VipActivityWeekView")},init:function(){var e=this.list=new game.List;e.itemRender=game.VipActivityItem,e.bindEnum=game.ME.VipActivity,e.addToParent(this.skin.listNode),this.skin.descLab.string=game.Lang.get(51913),this.data=game.vipActivityData},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView()}},updateView:function(){this.list.setData(this.data.vipActivityWeeks),this.list.scrollToTop()},onShow:function(){this.updateView()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.VipActivityWeek,e)}(),function(){var e;e=b8e.Enum({None:0,ON_SHOW:-1,UPDATE_DATA:-1,C_SELECTCHANGE:-1,UPDATE_DAYLIST:-1,C_BUQIAN:-1,C2C_RECHARGE:-1}),b8e.RC("$$game","$$OpenServerCREvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,me:0,money:0,targetMoney:0,cfg:null,day:0,hasGetAward:!1,isOpen:!1,isAlert:!1,isSelect:!1,setData:function(e,t,a,i){this.me=e,this.cfg=t,this.id=t.id,this.day=t.rechargeDay,this.money=a?a.money:0,this.targetMoney=t.money,this.hasGetAward=i,this.updateOpen(),this.updateAlert()},onBuqianSuccess:function(){this.money=this.targetMoney},rechargeSuccess:function(e){if(this.cfg&&game.miscData.openServerDay==this.cfg.serverStart+(this.cfg.rechargeDay-1)){var t=this.cfg.types;1==t?this.money+=e:2==t&&(this.money=e>=this.targetMoney?e:0)}},onGetAwardSuccess:function(){this.hasGetAward=!0},updateOpen:function(){var e=this.cfg.serverStart+this.day-1;this.isOpen=0<=game.miscData.openServerDay-e},updateAlert:function(){this.isAlert=this.canGetAward()},canGetAward:function(){if(!game.moduleOpen.checkOpen(this.me))return!1;if(!this.cfg)return!1;if(this.hasGetAward)return!1;if(this.money-this.targetMoney<0)return!1;var e=game.SysTime.curTime,t=this.cfg.serverStart+this.cfg.rechargeDay;return!(b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(t-game.miscData.openServerDay)*b8e.TimeUtil.DAY_MICRO_SECONDS-e<=0)||-1===game.openServerCRData.hasGetNormalAwardIds.indexOf(this.id)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OpenServerCRDayInfo",e)}(),function(){var e;e=b8e.Object.extends({type:0,id:0,clientCfg:null,me:0,configDay:null,dayInfos:null,curSelectId:-1,crDaysCounter:0,finalAwardIdMap:null,serverStart:0,serverEnd:0,nextFinalAwardActivity:0,ctor:function(){this.dayInfos=[]},updateServDayInfo:function(e,t,a,i){var n=this,s=new game.OpenServerCRDayInfo;if(s.setData(n.me,e,t,a),n.configDay=e,n.serverStart=e.serverStart,n.serverEnd=e.serverEnd,n.dayInfos.push(s),a&&(n.crDaysCounter+=1),!n.finalAwardIdMap){n.finalAwardIdMap=b8e.HashMap.get();for(var r=e.finalAwardIds,o=r.length,g=0;g<o;g++){var u=r[g];n.finalAwardIdMap.set(u,{id:u,isGet:!1})}}if(i){var l=e.id;n.finalAwardIdMap.set(l,{id:l,isGet:!0})}n.updateFinalAwardActivity()},updateFinalAwardActivity:function(){var e=0,t=this.finalAwardIdMap.values();t.sort(this._sort);for(var a=t.length,i=0;i<a;i++){if(!t[i].isGet){e=t[i].id;break}}this.nextFinalAwardActivity=e},getLastFinalAwardActivityId:function(){var e=this.finalAwardIdMap.values();return e.sort(this._sort),0<e.length?e[e.length-1].id:null},getCurFinalAwardActivityId:function(){return this.nextFinalAwardActivity},_sort:function(e,t){return e.id-t.id},setData:function(e){this.dayInfos.length=0,this.id=e.id,this.clientCfg=e,this.me=e.moduleId,this.type=e.type},rechargeSuccess:function(e){for(var t=this.dayInfos.length,a=0;a<t;a++){var i=this.dayInfos[a];i&&i.rechargeSuccess(e)}},getDayInfo:function(e){for(var t=this.dayInfos.length,a=0;a<t;a++){var i=this.dayInfos[a];if(i.id==e)return i}},onBuqianSuccess:function(e){for(var t=this.dayInfos.length,a=0;a<t;a++){var i=this.dayInfos[a];i&&i.id==e&&i.onBuqianSuccess()}},onGetAwardSuccess:function(e,t){if(t)this.finalAwardIdMap.set(e,{id:e,isGet:!0}),this.updateFinalAwardActivity();else{var a=this.getDayInfo(e);if(!a)return;a.onGetAwardSuccess(),this.crDaysCounter+=1}},getCountDown:function(){if(!this.serverEnd)return 0;var e=game.SysTime.curTime;return b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(this.serverEnd-game.miscData.openServerDay)*b8e.TimeUtil.DAY_MICRO_SECONDS-e},getInfoList:function(){return this.dayInfos},onResetDaily:function(){for(var e=this.dayInfos,t=e.length,a=0;a<t;a++){var i=e[a];i&&(i.updateOpen(),i.updateAlert())}},updateAllAlert:function(){for(var e=this.dayInfos,t=e.length,a=0;a<t;a++){var i=e[a];i&&i.updateAlert()}},updateAllOpen:function(){for(var e=this.getInfoList(),t=e.length,a=0;a<t;a++){var i=e[a];i&&i.updateOpen()}},checkAlert:function(){for(var e=this.getInfoList(),t=e.length,a=0;a<t;a++){var i=e[a];if(i&&i.isAlert)return!0}return!1},checkFinalAlert:function(){if(!game.moduleOpen.checkOpen(this.me))return!1;if(!this.nextFinalAwardActivity)return!1;var e=game.CountinueRechargeCfg.getData(this.nextFinalAwardActivity);if(!e)return!1;var t=this.crDaysCounter;return e.rechargeDay<=t},checkAlertById:function(e){for(var t=this.getInfoList(),a=t.length,i=0;i<a;i++){var n=t[i];if(n&&n.id==e)return n.isAlert}return!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OpenServerCRInfo",e)}(),function(){var e=void 0;e=b8e.Object.extends({openCRType:0,buqianDescId:0,ctor:function(){this.openServerCRInfoMap=b8e.HashMap.get(),this.crClientMap=b8e.HashMap.get(),this.hasGetNormalAwardIds=[],this.obj={keepRechargeId:0},this.obj1={rechargeId:0}},getBuqianCfgByKeepRechargeId:function(e){return this.obj.keepRechargeId=e,game.RechargeReplenishCfg.getData(this.obj)},getBuqianCfgByRechargeId:function(e){return this.obj1.rechargeId=e,game.RechargeReplenishCfg.getData(this.obj1)},getCRInfoByCurType:function(){return this.getCRInfoByType(this.openCRType)},getCRInfoByType:function(e){return this.openServerCRInfoMap.get(e)},getInfoList:function(){var e=this.getCRInfoByCurType();return e?e.getInfoList():[]},getInfoByActivityId:function(e){for(var t=this.getInfoList(),a=t.length,i=0;i<a;i++){var n=t[i];if(n&&n.id==e)return n}return null},selectInfoById:function(e){var t=this.getCRInfoByCurType();if(t){var a=this.getInfoByActivityId(t.curSelectId),i=this.getInfoByActivityId(e);a&&(a.isSelect=!1),i.isSelect=!0,t.curSelectId=e}},getCurSelectInfo:function(){var e=this.getCRInfoByCurType();if(e)return this.getInfoByActivityId(e.curSelectId)},initMisc:function(){var e=game.OpenServiceMiscCfg,t=e.getData("continueRechargeClientType");if(t&&t.value)for(var a=t.value.split(","),i=a.length,n=0;n<i;n++){var s=+a[n],r=game.OpenServerClientCfg.getData(game.OpenServerType.OPENSERVCR,s);r&&this.crClientMap.set(r.type,r)}var o=e.getData("continueRechargeBuqianDescId");o&&o.value&&(this.buqianDescId=+o.value)},syncModelDatas:function(e){this.initMisc(),this.openServerCRInfoMap.clear();var t=b8e.HashMap.get(),a=e.keepRecharge||[],i=e.awards||[];this.hasGetNormalAwardIds=i;for(var n=e.finalAward||[],s=a.length,r=0;r<s;r++){var o=a[r],g=o.eventId;t.set(g,o)}for(var u=this.getActivityArrByServOpen(),l=u.length,c=0;c<l;c++){var h=u[c],m=h.crType,d=h.id,f=this.getCRInfoByType(m);if(!f){f=new game.OpenServerCRInfo;var p=this.crClientMap.get(h.crType);if(!p)continue;f.setData(p)}var v=t.get(d),E=-1!==i.indexOf(d),T=-1!==n.indexOf(d);f.updateServDayInfo(h,v,E,T),this.openServerCRInfoMap.set(m,f)}},selectDefaultInfo:function(){var e=this.getCRInfoByCurType();if(!e)return[];var t=e.getInfoList();if(t&&!(t.length<=0))for(var a=t.length,i=e.curSelectId=0;i<a;i++){var n=t[i];game.openServerCRData.checkDayIsFinish(n.day)||0!=e.curSelectId?n.isSelect=!1:(n.isSelect=!0,e.curSelectId=n.id)}},getActivityArrByServOpen:function(){for(var e=game.CountinueRechargeCfg.getDatas()||[],t=[],a=game.miscData.openServerDay,i=e.length,n=0;n<i;n++){var s=e[n];s.serverStart>a||a>=s.serverEnd||t.push(s)}return t},resetDaily:function(){for(var e=this.openServerCRInfoMap.values(),t=e.length,a=[],i=0;i<t;i++){var n=e[i],s=n.configDay.crType;0<n.getCountDown()?(n.onResetDaily(),a.push(s)):this.openServerCRInfoMap.del(s)}for(var r=this.getActivityArrByServOpen(),o=r.length,g=0;g<o;g++){var u=r[g],l=u.crType;if(-1===a.indexOf(l)){var c=this.openServerCRInfoMap.get(l);if(!c){c=new game.OpenServerCRInfo;var h=this.crClientMap.get(u.crType);if(!h)continue;c.setData(h)}c.updateServDayInfo(u,null,!1,!1),this.openServerCRInfoMap.set(l,c)}}},onBuqianSuccess:function(e){for(var t=this.openServerCRInfoMap.values(),a=t.length,i=0;i<a;i++){var n=t[i];n&&n.onBuqianSuccess(e)}},rechargeSuccess:function(e){for(var t=this.openServerCRInfoMap.values(),a=t.length,i=0;i<a;i++){var n=t[i];n&&n.rechargeSuccess(e)}},onGetAwardSuccess:function(e){var t=e.id,a=game.CountinueRechargeCfg.getData(t);if(a){var i=this.getCRInfoByType(a.crType);i&&(i.onGetAwardSuccess(t,e.isFinal),e.isFinal||-1==this.hasGetNormalAwardIds.indexOf(t)&&this.hasGetNormalAwardIds.push(t))}},getCountDown:function(){if(!game.moduleOpen.checkOpen(this.bindEnum))return 0;var e=this.openCRType,t=this.getCRInfoByType(e);return t?t.getCountDown():0},checkDayIsFinish:function(e){var t=this.openCRType,a=this.getCRInfoByType(t);if(a){var i=a.serverStart+e;return 0<=game.miscData.openServerDay-i}},updateAllAlert:function(){for(var e=this.openServerCRInfoMap.values(),t=e.length,a=0;a<t;a++){var i=e[a];i&&i.updateAllAlert()}},checkOpen:function(e){var t=this.getCRInfoByType(e);return!!t&&0<t.getCountDown()},checkAlertByCurDay:function(){var e=this.getCRInfoByCurType();return!!e&&e.checkAlertById(e.curSelectId)},checkFinalAlertByCurType:function(){var e=this.getCRInfoByCurType();return!!e&&e.checkFinalAlert()},checkFinalAlertByType:function(e){var t=this.getCRInfoByType(e);return!!t&&t.checkFinalAlert()},checkAlert:function(e){var t=this.getCRInfoByType(e);return!!t&&t.checkAlert()}}),game.openServerCRData=game.openServerCRData||new e,b8e.RC("$$game","$$OpenServerCRData",e)}(),function(){var e=b8e.Object.extends({info:null,setInfo:function(e){this.info=e},getInfo:function(){return this.info}});game.openServBuqianAlertData=game.openServBuqianAlertData||new e}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("openServCR/OpenServBuqianAlert")},onShow:function(){var e=this.skin,t=game.openServBuqianAlertData.getInfo();if(t){var a=game.openServerCRData.getBuqianCfgByKeepRechargeId(t.id);if(a){var i=a.rechargeId,n=game.RechargeCfg.getDataById(i);e.buqian_content.string=n?game.Lang.get(game.openServerCRData.buqianDescId,n.money):""}else e.buqian_content.string=""}else e.buqian_content.string=""}});b8e.module.registerView(game.ME.OpenServBuqianAlert,e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super("openServCR/OpenServCRDayItem"),this.setSize(78,40)},setData:function(e){e&&(this.skin.lbl.string=game.Lang.get(51690,e.day),this.skin.red_spot_day.setVisible(e.isAlert),this.skin.isSelect.setVisible(e.isSelect),this.skin.isNoOpen.setVisible(!e.isOpen))},dayBtn:function(){this.data&&this.send(game.OpenServerCREvts.C_SELECTCHANGE,this.data)}})).poolCall=!0,b8e.RC("$$game","$$OpenServCRDayItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super("openServCR/OpenServCRView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.OpenServCRDayItem,e.bindEnum=this.moduleEnum,e.layout.spacingX=2,e.layout.paddingTop=-10,e.addToParent(this.skin.dayList);var t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.ShowItemListItem,t.addToParent(this.skin.prizeList),t.layout.paddingLeft=10,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingX=40;var a=this.finalPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.ShowItemListItem,a.addToParent(this.skin.finalPrizeList),a.layout.paddingLeft=0,a.layout.paddingRight=0,a.layout.paddingTop=0,a.layout.spacingX=40,this.moduleData=game.openServerCRData,this.leftTimer=null},notify:function(e){switch(e){case this.Evts.UPDATE_DATA:this.updateData()}},onHide:function(){this.leftTimer&&(b8e.Timer.remove(this,this.updateTime),this.leftTimer=null)},onShow:function(){this.moduleData.selectDefaultInfo(),this.updateData(),this.updateTime(),0<this.moduleData.getCountDown()?this.leftTimer=b8e.Timer.add(this,this.updateTime,1e3):(this.skin.leftTimelbl.string="",this.leftTimer=null)},updateTime:function(){var e=this.moduleData.getCountDown();if(e<=0)return this.skin.leftTimelbl.string="",void game.module.hide(this.moduleEnum);var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.leftTimelbl.string=0<e?game.Lang.get(51689,t):""},updateData:function(){this.updateDayList();var e=this.moduleData.getCurSelectInfo();this.updateRechargeAwards(e),this.updateRechargeInfo(e),this.updateFinalAward(),this.updateAlert()},updateAlert:function(){var e=this.moduleData.checkAlertByCurDay();this.skin.red_spot_lingqu_normal.setVisible(e);var t=this.moduleData.checkFinalAlertByCurType();this.skin.red_spot_lingqu.setVisible(t)},updateFinalAward:function(){var e=this.skin,t=this.moduleData.getCRInfoByCurType();if(t){var a=!1,i=t.getCurFinalAwardActivityId();i||(a=!0,i=t.getLastFinalAwardActivityId()),e.isAllFinish.setVisible(a),e.isNoFinish.setVisible(!a);var n=game.CountinueRechargeCfg.getData(i);if(n){var s=t.crDaysCounter,r=n.rechargeDay;e.expLab.string=s+"/"+r;var o=r<=s?r:s;e.progress.width=o/r*400,e.title_2_1.string=game.Lang.get(51684,r);var g=n.finalAwards,u=game.CfgUtil.getPrizeListInfo(g,game.IconLayoutEnum.SHOW_ALL);this.finalPrizeList.setData(u.items),a||(e.btn_lingqu.setVisible(r<=s),e.btn_weiwancheng.setVisible(s<r))}}},updateRechargeInfo:function(e){var t=this.skin;if(e){var a=e.hasGetAward;if(t.hasGet.setVisible(a),t.hasNoGet.setVisible(!a),!a){var i=e.isOpen;if(t.dayIsNoOpen.setVisible(!i),t.dayIsOpen.setVisible(i),i){var n=!1,s=this.moduleData.checkDayIsFinish(e.day);if(s&&e.money>=e.targetMoney&&-1===this.moduleData.hasGetNormalAwardIds.indexOf(e.id)&&(n=!(s=!1)),t.dayIsFinish.setVisible(s),t.dayIsNoFinish.setVisible(!s),!s){var r=e.money>=e.targetMoney;t.btn_lingqu_normal.setVisible(r),t.btn_chongzhi.setVisible(!r),t.rechargeInfo.string=n?"":e.cfg&&1==e.cfg.types?game.Lang.get(51686,e.money,e.targetMoney):""}}}}},updateRechargeAwards:function(e){var t=this.skin;if(e){var a=1==e.cfg.types?51687:51685;t.title_1.string=game.Lang.get(a,e.targetMoney);var i=e.cfg.awards,n=game.CfgUtil.getPrizeListInfo(i,game.IconLayoutEnum.SHOW_ALL);this.prizeList.setData(n.items)}},updateDayList:function(){var e=this.moduleData.getInfoList();this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OpenServCR,e)}(),function(){var e=game.Control.extends({confirm_btn:function(){var e=game.openServBuqianAlertData.getInfo();e&&this.dpt(this.Evts.C_BUQIAN,e)}});b8e.module.registerControl(game.ME.OpenServBuqianAlert,e,game.OpenServerCREvts)}(),function(){var e;e=game.Control.extends({init:function(){this.moduleData=game.openServerCRData,this.spotAlertMap=b8e.HashMap.get()},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess,C_INIT_MODEL:this.initRecharge},OpenServer:{C2C_INIT_OPENSERVER:this.onOpenServerInit},MainRole:{C_RESET_DAILY:this.resetDaily},OpenServBuqianAlert:{C_BUQIAN:this.onBuqian}},this.handels={KeepRechargeReceiveResp:this.conRechargeAwardResp}},resetDaily:function(){this.moduleData.resetDaily(),this.changeOpenServer(),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA)},onOpenServerInit:function(){this.changeOpenServer(),this.checkAllAlert()},rechargeSuccess:function(e){if(e&&e.data){var t=e.data.id,a=game.RechargeCfg.getDataById(t);if(a){if(a.rechargeType==game.RechargeType.KEEP_RECHARGE_REPLENISH){var i=this.moduleData.getBuqianCfgByRechargeId(t);i&&(this.moduleData.onBuqianSuccess(i.keepRechargeId),game.module.hide(game.ME.OpenServBuqianAlert))}this.moduleData.rechargeSuccess(a.money),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA)}}},initRecharge:function(){this.regSpotAlert(),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA)},regSpotAlert:function(){for(var e=this.moduleData.crClientMap.values(),t=e.length,a=0;a<t;a++){var i=e[a],n=i.type,s=this.spotAlertMap.get(n);if(!s){var r=b8e.getDPV(game.SAE,i.crSAE);s=game.spotAlert.set(r,game.SAE.OPEN_SERVER_ALERT)}this.spotAlertMap.set(n,s)}},conRechargeAwardResp:function(e){var t=e.readProtobuf(game.pb.KeepRechargeReceiveResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.onGetAwardSuccess(t),this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}},notify:function(e,t){switch(e){case game.OpenServerCREvts.C_SELECTCHANGE:var a=this.moduleData.getCRInfoByCurType();if(!a||t.id==a.curSelectId)return;this.moduleData.selectInfoById(t.id),this.send(this.Evts.UPDATE_DATA)}},changeOpenServer:function(){for(var e=this.moduleData.crClientMap.values(),t=e.length,a=0;a<t;a++){var i=e[a],n=b8e.getDPV(game.SAE,i.crSAE),s=i.type,r={openServerType:i.openServerType,isActive:this.moduleData.checkOpen(s),sae:n,type:s};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,r)}this.checkAllAlert(),this.send(this.Evts.UPDATE_DATA)},btn_chongzhi:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)},checkAllAlert:function(){var a=this;a.moduleData.updateAllAlert(),a.spotAlertMap&&a.spotAlertMap.forEach(function(e,t){t&&(t.alert=a.moduleData.checkAlert(e)||a.moduleData.checkFinalAlertByType(e))},a)},btn_buqian:function(){var e=this.moduleData.getCurSelectInfo();e&&(game.openServBuqianAlertData.setInfo(e),game.module.show(game.ME.OpenServBuqianAlert))},onBuqian:function(e){var t=e.data;if(t){var a=t.id,i=game.openServerCRData.getBuqianCfgByKeepRechargeId(a);i&&this.dpt(this.Evts.C2C_RECHARGE,i.rechargeId)}},btn_lingqu_normal:function(){var e=this.moduleData.getCurSelectInfo();e&&this.getAward(e.id,!1)},btn_lingqu:function(){var e=this.moduleData.getCRInfoByCurType();if(e){var t=e.getCurFinalAwardActivityId();if(t){var a=game.CountinueRechargeCfg.getData(t);if(a)e.crDaysCounter<a.rechargeDay?game.notice.show(51683):this.getAward(t,!0)}}},getAward:function(e,t){this.sender.KeepRechargeReceiveReq(e,t)}});var t=game.Sender.extends({ipc:function(){this.msg={KeepRechargeReceiveReq:this.conRechargeAwardReq}},conRechargeAwardReq:function(e,t){var a=game.pb.KeepRechargeReceiveRequest;a.id=e,a.isFinal=t,this.write(a)}});b8e.module.registerControl(game.ME.OpenServCR,e,game.OpenServerCREvts,t),b8e.RC("$$game","$$OpenServerCRCtrl",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_HUNLU_SYNC_MODEL_DATA:b8e.enc(),C2V_HUNLU_SET_SORT:b8e.enc(),C2V_HUNLU_ACTIVATE:b8e.enc(),C2V_HUNLU_UPGRADE:b8e.enc(),C2V_HUNLU_BEG:b8e.enc(),C2V_HUNLU_ZHU_HUN:b8e.enc(),C2V_HUNLU_ACHIEVEMENT:b8e.enc(),C2V_HUNLU_POINT_REWARD:b8e.enc(),C2V_HUNLU_UPDATE_ITEMINFO:b8e.enc(),C2V_HUNLU_SWITCH_PAGE:b8e.enc(),C2V_HUNLU_SELECT_ELEMENT:b8e.enc(),C2V_HUNLU_HUNKA_UP_BTN:b8e.enc(),C2V_HUNLU_HUNKA_DOWN_BTN:b8e.enc(),C2V_HUNLU_UPDATE_SELECT_INFO:b8e.enc(),C2V_HUNLU_UPDATE_QIU_ZENG_ITEM_INFO:b8e.enc(),C2V_HUNLU_SELECT_CRAD_INFO:b8e.enc(),C2V_HUNLU_ACHIEVE_UP_BTN:b8e.enc(),C2V_HUNLU_ACHIEVE_DOWN_BTN:b8e.enc(),V2C_HUNLU_MODEL_REQ:b8e.enc(),V2C_HUNLU_HUNKA_TOP:b8e.enc(),V2C_HUNLU_HUNKA_CANCEL_TOP:b8e.enc(),V2C_HUNLU_HUNKA_ACTIVE:b8e.enc(),V2C_HUNLU_HUNKA_UPGRADE:b8e.enc(),V2C_HUNLU_QIU_ZENG_COOL_TIME:b8e.enc(),V2C_HUNLU_GET_ACHIEVEMENT:b8e.enc(),V2C_HUNLU_SELECT_QIU_ZENG_INFO:b8e.enc(),V2C_HUNLU_SELECT_CARD_INFO:b8e.enc(),V2C_SET_PREVIEW_AWARD:b8e.enc(),V2C_HUNLU_SELECT_ELEMENT:b8e.enc(),C2C_SET_SHOW_AWARD:b8e.enc(),C2C_SET_PREVIEW_AWARD:b8e.enc()}),b8e.RC("$$game","$$HunluEvts",e)}(),function(){var e;e=b8e.Enum({None:0,Water:-1,Fire:-1,Wind:-1,Earth:-1,Max:-1}),b8e.RC("$$game","$$HunluElementType",e)}(),function(){var e,t=e=b8e.Object.extends({id:0,num:0,hasCount:0,select:!1,str:"",alert:!1,ctor:function(){this._super()},setData:function(e){this.id=e.Id,this.num=e.Num},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.num=0,this.select=!1,this.alert=!1,this.str=""}});b8e.BindingUtil.bind(t),t.poolCall=!0,b8e.RC("$$game","$$HunluBaseInfo",e)}(),function(){var e,t=e=b8e.Object.extends({id:0,count:0,ctor:function(){this._super()}});b8e.BindingUtil.bind(t),b8e.RC("$$game","$$HunluHunshiInfo",e)}(),function(){var e=void 0;e=b8e.PoolObject.extends({id:0,combinationId:0,element:0,num:0,isCanZhuhun:!1,isActived:!1,select:!1,ctor:function(){this._super()},getPrizeList:function(){if(this._prizeList&&0<this._prizeList.length)return this._prizeList;var e=game.HunluBaseCfg.getData(this.id);if(!e)return null;var t=e.clientGiveItems;if(!t||t.length<1)return null;this._prizeList=[];for(var a=0,i=t.length,n=void 0;a<i;a++)(e=t[a])&&((n=game.ItemUtil.createPrizeInfo(e.Id,e.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this._prizeList.push(n));return this._prizeList},getCostList:function(){if(this._costList&&0<this._costList.length)return this._costList;var e=game.HunluBaseCfg.getData(this.id);if(!e)return null;var t=e.costItems;if(!t||t.length<1)return null;this._costList=[];for(var a=0,i=t.length,n=void 0;a<i;a++)(e=t[a])&&((n=new game.HunluBaseInfo).id=e.Id,n.num=e.Num,n.hasCount=game.itemData.getNumById(n.id),this._costList.push(n));return this._costList},updateCostList:function(){var e=this.getCostList();if(e&&!(e.length<1))for(var t=0,a=e.length,i=void 0;t<a;t++)(i=e[t])&&(i.hasCount=game.itemData.getNumById(i.id))},restore:function(){this._super(),this.reset()},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.num=0,this.isCanZhuhun=!1,this.select=!1}});b8e.BindingUtil.bind(e);var t=new b8e.Pool(e,1024);e.get=function(){return t.get()},e.put=function(e){return t.put(e)},b8e.RC("$$game","$$HunluCardInfo",e)}(),function(){var e,t=e=b8e.Object.extends({cfg:null,id:0,name:"",count:0,element:0,isGet:!1,isCanGet:!1,ctor:function(){this._super()},setData:function(e){this.cfg=e,this.id=e.id,this.name=e.name,this.element=e.element},isAlert:{get:function(){return this.isCanGet}}});b8e.BindingUtil.bind(t),b8e.RC("$$game","$$HunluAchievementInfo",e)}(),function(){var e=void 0;e=b8e.Object.extends({cfg:null,id:0,element:0,name:"",cards:null,sortIndex:-1,lv:0,count:0,alert:!1,isActived:!1,isCanActive:!1,isCanUpgrade:!1,isTop:!1,isMaxLv:!1,spriteStatInfo:null,ctor:function(){this._super()},setCfgData:function(e){var t=this;t.cfg=e,t.id=e.id,t.element=e.element,t.name=e.name,t.cards=e.costItems,t._setCfgCardInfo(t.cards);var a=t.isActived?t.lv:1;t.updateSpriteStat(a),t.updateMaxLv()},updateSpriteStat:function(e){if(!(e<1)){var t=game.HunluUpgradeCfg.getData(this.id,e);t&&(this.spriteStatInfo?this.spriteStatInfo.clear():this.spriteStatInfo=game.SpriteStatInfo.get(),this.spriteStatInfo.setData(t))}},_setCfgCardInfo:function(e){if(e&&!(e.length<1)){this._cardMap?(this._recycleCardInfo(),this._cardMap.clear()):this._cardMap=b8e.HashMap.get();for(var t=0,a=e.length,i=void 0,n=void 0;t<a;t++)(i=e[t])&&((n=game.HunluCardInfo.get()).id=i,n.index=t,n.combinationId=this.id,n.element=this.element,n.isActived=this.isActived,this._cardMap.set(i,n))}},updateCardInfo:function(e,t){if(this._cardMap){var a=this._cardMap.get(e);a&&(a.num=t)}},updateState:function(){this._updateActiveState(),this._updateUgradeState(),this._updateZhuhunState()},_updateActiveState:function(){this.isActived?this.isCanActive=!1:this.isCanActive=this._getIsEnough()},_updateUgradeState:function(){this.updateMaxLv(),this.isMaxLv?this.isCanUpgrade=!1:this.isActived&&this._cardMap&&(this.isCanUpgrade=this._getIsEnough())},_getIsEnough:function(){if(!this._cardMap)return!1;var e=this._getCostItems();if(!e||e.length<1)return!1;for(var t=0,a=void 0,i=!0,n=void 0,s=e.length;t<s;t++)if((a=e[t])&&(n=this._cardMap.get(a))&&n.num<1){i=!1;break}return i},_getCostItems:function(){var e=1;if(0<this.lv&&(e=this.lv),e<1)return null;var t=game.HunluUpgradeCfg.getData(this.id,e);return t?t.costItems:null},_updateZhuhunState:function(){this._cardMap&&this._cardMap.forEach(this._updateCardcall,this)},_updateCardcall:function(e,t){if(t){t.updateCostList();var a=game.HunluBaseCfg.getData(e);if(a){var i=game.UpgradeUtil.checkItemList(a.costItems,1,!1,!1);t.isCanZhuhun=i}}},isCanZhuhun:{get:function(){if(!this._cardMap)return!1;var a=!1;return this._cardMap.forEach(function(e,t){t&&t.isCanZhuhun&&!a&&(a=!0)},this),a}},isAlert:{get:function(){return this.isCanActive||this.isCanUpgrade||this.isCanZhuhun}},updateMaxLv:function(){if(!(this.lv<1)){var e=game.HunluUpgradeCfg.getData(this.id,this.lv);e&&(this.isMaxLv=e.isMax)}},updateSortIndex:function(e){this.sortIndex=e,this.isTop=-1<this.sortIndex},getCardInfoById:function(e){return this._cardMap?this._cardMap.get(e):null},isHasCrad:function(e){return this.getCardInfoById(e)},getCardList:function(){return this._cardMap?this._cardMap.values():null},getCardNum:function(e){var t=this.getCardInfoById(e);return t?t.num:0},_recycleCardInfo:function(){this._cardMap&&this._cardMap.forEach(function(e,t){t&&t.release()},this)},getSpriteStatList:function(){return this.spriteStatInfo?this.spriteStatInfo.getSpriteStatList():null}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$HunluInfo",e)}(),function(){var e=b8e.Object.extends({ctor:function(){var e=this;e._super(),e.ACHIEVEMENT=1,e.POINT=2,e.isShowRedDot=!1,e.curSelectCombinationInfo=0,e.totalZhuhunCount=0,e.curSelectElement=1,e.curSelectCardInfo=null,e.curSelectQiuZengInfo=null,e.startSelectId=0,e.curChatHunluIdx=0,e.curChathunluItemId=0,e.curChatQiuZengRoleId=0,e.curChatQiuZengRoleName=0,e.totalPoint=0,e.begCount=0,e.ZHUHUN_PANEL=1,e.ACTIVE_PANEL=2,e.UPGRADE_PANEL=3,e.curAwardPanel=0,e.COMBINATION=1,e.ZHU_HUN=2,e.isUpdateSpriteStat=!1,e.isInitHunluModelReq=!1},syncModelData:function(e){var t=this;t.begCount=e.begCount,t.totalPoint=e.totalPoint,t._setTopList(e),t._setHunluDataByType(e.combination,t.COMBINATION),t._setHunluDataByType(e.zhuhun,t.ZHU_HUN),t.updateCardList(e.cards),t._setReceivestByType(e.achievements,t.ACHIEVEMENT),t._setReceivestByType(e.pointRecord,t.POINT),t.updateAllElementState(),e.achievements&&0<e.achievements.length&&(t.isAlert()||t.initAchievementModel()),game.hunluData.isInitAchievementData||t.initAchievementModel(),t.updatePointState()},initAchievementModel:function(){this.initAchievementData(),this._InitAchievementState()},_InitAchievementState:function(){this._achievementMap&&this._achievementMap.forEach(this._achievementMapCall,this)},_achievementMapCall:function(e,t){t&&(this.isGetAchievement(e)?t.isGet=!0:this.getIsCanGetAchievement(e)&&(t.isCanGet=!0))},_setTopList:function(e){if(e.topLists&&!(e.topLists.length<1))for(var t=e.topLists,a=0,i=t.length,n=void 0;a<i;a++)(n=t[a])&&this.setHunluTopSort(n.element,n.list)},setHunluTopSort:function(e,t){if(t&&!(t.length<1))for(var a=0,i=t.length,n=void 0,s=void 0;a<i;a++)(n=t[a])&&(s=this.getHunluCombinationInfoById(n,e))&&s.updateSortIndex(a)},_setHunluDataByType:function(e,t){if(e&&!(e.length<1))for(var a=0,i=e.length,n=void 0,s=void 0;a<i;a++)if(n=e[a])switch(t){case this.COMBINATION:(s=this.getHunluCombinationInfoById(n.id))&&(s.isActived=!0,s.lv=n.value,s.updateMaxLv(),this._setElementProgress(s));break;case this.ZHU_HUN:(s=this.getHunluCombinationInfoById(n.id))&&(s.count=n.value,this._setElementZhuhunCount(s.element,n.value),this.totalZhuhunCount+=s.count)}},_setElementProgress:function(e){this._progress||(this._progress=[]);var t=0,a=this._progress[e.element];t=a?a+1:1,this._progress[e.element]=t},_setElementZhuhunCount:function(e,t){this._elementZhuhunCountList||(this._elementZhuhunCountList=[]);var a=this._elementZhuhunCountList[e];null==a&&(a=0),a+=t,this._elementZhuhunCountList[e]=a},setHunluActivateData:function(e,t){var a=this.curSelectCombinationInfo;a&&(a.id=e,a.isActived||(a.isActived=!0,a.lv=1),this.updateCardList(t),this._setElementProgress(a),this.updateAllElementState())},hunluUpgrade:function(e,t,a){var i=this.curSelectCombinationInfo;i&&(i.id=e,i.lv=t,i.updateSpriteStat(t),i.updateMaxLv(),this.updateCardList(a),this.updateAllElementState())},hunluZhuhun:function(e){var t=this.curSelectCombinationInfo;t&&(this.totalZhuhunCount++,t.count++,this._setElementZhuhunCount(t.element,1),this.updateAllCard(e),this.updateAchievementState(),this.updateAllElementState())},updateCardList:function(e){for(var t=0,a=e.length,i=void 0;t<a;t++)(i=e[t])&&this.updateAllCard(i)},updateAllCard:function(e){for(var t=1,a=game.HunluElementType.Max;t<a;t++)t&&this._updateAllCardByElement(t,e)},_updateAllCardByElement:function(e,t){var a=this.getHunluListByElement(e);if(a&&!(a.length<1))for(var i=0,n=a.length,s=void 0;i<n;i++)(s=a[i])&&s.isHasCrad(t.id)&&s.updateCardInfo(t.id,t.value)},_setReceivestByType:function(e,t){if(e&&!(e.length<1))for(var a=0,i=e.length,n=void 0;a<i;a++)(n=e[a])&&(t==this.ACHIEVEMENT?this.setReceiveAchievement(n):t==this.POINT&&this.setReceivePoint(n))},updateAchievementById:function(e){if(this._achievementMap){var t=this._achievementMap.get(e);t&&(t.isGet=!0,t.isCanGet=!1)}},setReceiveAchievement:function(e){this.setReceivesByType(this.ACHIEVEMENT,e)},setReceivePoint:function(e){this.setReceivesByType(this.POINT,e)},setReceivesByType:function(e,t){var a=void 0;this._receives&&(a=this._receives[e])&&0<a.length||(this._receives||(this._receives=[]),(a=this._receives[e])||(a=[],this._receives[e]=a)),a.push(t)},initAchievementData:function(){if(!this.isInitAchievementData){this.isInitAchievementData=!0;var e=game.HunluAchievementCfg.getDatas();if(e&&!(e.length<1))for(var t=0,a=e.length,i=void 0,n=void 0;t<a;t++)(i=e[t])&&(this._achievementMap||(this._achievementMap=b8e.HashMap.get()),(n=new game.HunluAchievementInfo).setData(i),0!=n.element?n.count=this.getElementZhuhunCount(n.element):n.count=this.totalZhuhunCount,this._achievementMap.set(n.id,n))}},updateAchievementState:function(){var i=this;i._achievementMap&&i._achievementMap.forEach(function(e,t){if(t&&t.cfg&&!t.isGet){var a=void 0;a=0==t.element?i.totalZhuhunCount:i.getElementZhuhunCount(t.element),t.count=a,t.isCanGet=a>=t.cfg.count}},i)},updateHunshiList:function(){var e=this.getHunshiList();if(e&&!(e.length<1))for(var t=0,a=e.length,i=void 0,n=void 0;t<a;t++)(i=e[t])&&(n=game.itemData.getNumById(i.id),i.count=n)},getProgress:function(e){return this._progress?(this._progress[e]||(this._progress[e]=0),this._progress[e]):0},getHunluCombinationInfoById:function(e,t){var a=1<arguments.length&&void 0!==t?t:null;if(!a){this._obj2||(this._obj2=b8e.createMap(),this._obj2.id=0),this._obj2.id=e;var i=game.HunluCombinationCfg.getData(this._obj2);if(!i)return null;a=i.element}var n=this.getHunluListByElement(a);return n&&0<n.length&&n.sort(this._onSort),game.SearchUtil.binSearch(n,e,"_$id")},getHunluListByElement:function(e){var t=this;e=null==e?game.HunluElementType.Water:e;var a=void 0;if(t._hunluList&&(a=t._hunluList[e])&&0<a.length)return a;t._obj1||(t._obj1=b8e.createMap(),t._obj1.element=0),t._obj1.element=e;var i=game.HunluCombinationCfg.getData(t._obj1,!0);if(!i||i.length<1)return null;t._hunluList||(t._hunluList=[]),a=[];for(var n=0,s=i.length,r=void 0,o=void 0;n<s;n++)(r=i[n])&&((o=new game.HunluInfo).setCfgData(r),a.push(o),t._setElementZhuhunCount(o.element,0));return t._hunluList[e]=a},_onSort:function(e,t){return e.id-t.id},getAchievementList:function(){return this._achievementMap?this._achievementMap.values():null},getHunshiList:function(){if(this._hunshiList)return this._hunshiList;var e=game.CfgUtil.getMiscValue(game.HunluMiscCfg,"hunshiItems",!0,"|",!0);if(!e||e.length<1)return null;for(var t=0,a=e.length,i=void 0,n=void 0,s=0;t<a;t++)(i=e[t])&&((n=new game.HunluHunshiInfo).id=i,s=game.itemData.getNumById(n.id),n.count=s,this._hunshiList||(this._hunshiList=[]),this._hunshiList.push(n));return this._hunshiList},getElementZhuhunCount:function(e){if(!this._elementZhuhunCountList)return 0;var t=this._elementZhuhunCountList[e];return null==t&&(t=0),t},getPointInfoByPoint:function(e){var t=this._getPointMap();return t?t.get(e):null},getFitTotalPoint:function(){var e=this._getPointMap();if(!e)return 400;var a=void 0;return e.forEach(function(e,t){a=(t.isCanGet&&t.isGet,t)},this),a?a.point:400},updatePointState:function(){var e=this._getPointMap();e&&e.forEach(this._updatePointStateCall,this)},_updatePointStateCall:function(e,t){this.isGetPoint(e)?(t.isGet=!0,t.isCanGet=!1):t.isCanGet=this.totalPoint>=e},updatePointStateByPoint:function(e){var t=this._getPointMap();if(t){var a=t.get(e);a&&(a.isGet=!0,a.isCanGet=!1)}},_getPointMap:function(){if(this._pointMap)return this._pointMap;var e=game.HunluPointAwardCfg.getDatas();if(!e||e.length<1)return null;this._pointMap=b8e.HashMap.get();for(var t=0,a=e.length,i=void 0,n=void 0;t<a;t++)(i=e[t])&&((n=b8e.createMap()).point=i.point,n.isGet=!1,n.isCanGet=!1,this._pointMap.set(i.point,n));return this._pointMap},getHunluDailyMaxBegCount:{get:function(){if(this._hunluDailyMaxBegCount)return this._hunluDailyMaxBegCount;var e=game.CfgUtil.getMiscValue(game.HunluMiscCfg,"hunluDailyMaxBegCount");return this._hunluDailyMaxBegCount=+e,this._hunluDailyMaxBegCount}},getHunluBegInterval:{get:function(){if(this._hunluBegInterval)return this._hunluBegInterval;var e=game.CfgUtil.getMiscValue(game.HunluMiscCfg,"hunluBegInterval");return this._hunluBegInterval=+e,this._hunluBegInterval}},setQiuZengCoolTime:function(){var e=game.SysTime.curTime;this.qiuzengEndTime=e+this.getHunluBegInterval*b8e.TimeUtil.SECOND_MICRO_SECONDS},getQiuZengCoolTime:function(){var e=game.SysTime.curTime;return this.qiuzengEndTime-e},getQiuZengCountdown:function(){return this.getQiuZengCoolTime()/1e3>>0},isCanQiuZeng:function(){return this.getQiuZengCountdown()<1},getQiuZengList:function(){var e=this;if(!e.curSelectCardInfo)return null;var t=e.curSelectCardInfo.id;if(e.startSelectId==t)return e._qiuZengList;e.startSelectId=t;var a=game.HunluBaseCfg.getData(t);if(!a)return null;var i=a.costItems;if(!i||i.length<1)return null;e._qiuZengList?e._recycleQiuZengList():e._qiuZengList=[];for(var n=0,s=i.length,r=void 0,o=void 0;n<s;n++)(r=i[n])&&game.itemData.getNumById(r.Id)<r.Num&&((o=e._getQiuZengInfo()).id=r.Id,o.num=r.Num,e._qiuZengList.push(o));return e._qiuZengList},_getQiuZengInfo:function(){return this._qiuzengPool&&0<this._qiuzengPool.length?this._qiuzengPool.pop():new game.HunluBaseInfo},_recycleQiuZengList:function(){if(this._qiuZengList&&!(this._qiuZengList.length<1))for(var e=void 0;this._qiuZengList.length;)(e=this._qiuZengList.pop())&&(e.reset(),this._qiuzengPool||(this._qiuzengPool=[]),this._qiuzengPool.push(e))},setSelectQiuZengInfo:function(e){this.curSelectQiuZengInfo?this.curSelectQiuZengInfo.id!=e?(this.curSelectQiuZengInfo&&(this.curSelectQiuZengInfo.select=!1),this._setSelectQiuZengInfo(e)):this.curSelectQiuZengInfo.select=!this.curSelectQiuZengInfo.select:this._setSelectQiuZengInfo(e)},_setSelectQiuZengInfo:function(e){var t=this.getZengSongInfoById(e);t&&((this.curSelectQiuZengInfo=t).select=!0)},setSelectCardInfo:function(e){this.curSelectCardInfo&&(this.curSelectCardInfo.select=!1),e&&((this.curSelectCardInfo=e).select=!0,this.curSelectCombinationInfo=this.getHunluCombinationInfoById(e.combinationId,e.element))},getCardInfo:function(e,t,a){var i=this.getHunluCombinationInfoById(t,e);return i?i.getCardInfoById(a):null},getZengSongInfoById:function(e){return game.SearchUtil.binSearch(this._qiuZengList,e,"_$id")},getTotalSpriteStatList:function(){var e=this;if(!e.isUpdateSpriteStat&&e._totalSpriteStatMap)return e._totalSpriteStatMap;e._totalSpriteStatMap?(e._recycleSpriteStat(),e._totalSpriteStatMap.clear()):e._totalSpriteStatMap=b8e.HashMap.get();for(var t=1,a=void 0,i=0,n=void 0,s=void 0,r=0,o=void 0,g=void 0,u=void 0,l=void 0,c=game.HunluElementType.Max;t<c;t++)if(t&&(a=e.getHunluListByElement(t))&&!(a.length<1))for(n=a.length,i=0;i<n;i++)if((s=a[i])&&s.isActived&&(o=s.getSpriteStatList())&&!(o.length<1))for(g=o.length,r=0;r<g;r++)(u=o[r])&&((l=e._totalSpriteStatMap.get(u.type))?(l.val+=u.val,l.clientVal+=u.clientVal,l.clientPer+=u.clientPer):((l=game.SpriteStatUnitInfo.get()).type=u.type,l.val=u.val,l.clientVal=u.clientVal,l.clientPer=u.clientPer,e._totalSpriteStatMap.set(u.type,l)));return e._totalSpriteStatMap},_recycleSpriteStat:function(){this._totalSpriteStatMap&&this._totalSpriteStatMap.forEach(function(e,t){t&&t.release()},this)},isGetAchievement:function(e){return this._isGet(this.ACHIEVEMENT,e)},getIsCanGetAchievement:function(e){var t=this._achievementMap.get(e);return!!t&&t.count>=t.cfg.count},isGetPoint:function(e){return this._isGet(this.POINT,e)},_isGet:function(e,t){if(!this._receives)return!1;var a=this._receives[e];return!(!a||a.length<1)&&-1!=a.indexOf(t)},updateAllElementState:function(){for(var e=1,t=game.HunluElementType.Max;e<t;e++)e&&this.updateElementStateByType(e)},updateElementStateByType:function(e){var t=this.getHunluListByElement(e);if(t&&!(t.length<1))for(var a=0,i=t.length,n=void 0;a<i;a++)(n=t[a])&&n.updateState()},getBtnInfos:function(){if(this._elementBtns&&0<this._elementBtns.length)return this._elementBtns;var e=game.HunluMiscCfg.getData("hunshiBtns");if(!e||!e.value)return null;var t=e.value.split("|");if(!t||t.length<1)return null;this._elementBtns=[];for(var a=0,i=t.length,n=void 0,s=void 0,r=void 0;a<i;a++)(n=t[a])&&(s=n.split(";"))&&((r=new game.HunluBaseInfo).id=s[0],r.str=s[1],0==a&&(r.select=!0,this.curSelectElement=r.id),this._elementBtns.push(r));return this._elementBtns},updateBtnInfoAlert:function(){var e=this.getBtnInfos();if(e&&!(e.length<1))for(var t=0,a=e.length,i=void 0;t<a;t++)(i=e[t])&&(i.alert=this.isElementAlert(i.id))},setSelectBtnInfo:function(e){var t=this.getBtnInfoById(this.curSelectElement),a=this.getBtnInfoById(e);t&&(t.select=!1),a.select=!0,this.curSelectElement=e},getBtnInfoById:function(e){var t=this.getBtnInfos();if(!t||t.length<1)return null;for(var a=0,i=t.length,n=void 0;a<i;a++)if((n=t[a])&&n&&n.id==e)return n;return null},isAlert:function(){if(!game.moduleOpen.checkOpen(game.ME.Hunlu))return!1;for(var e=1,t=game.HunluElementType.Max;e<t;e++)if(this.isElementAlert(e))return!0;return!1},isHasAchievementAlert:function(){return this.isAchievementAlert()||this.isHasGetPoint()},isAchievementAlert:function(){if(!this._achievementMap)return!1;var a=!1;return this._achievementMap.forEach(function(e,t){t&&t.isCanGet&&!a&&(a=!0)},this),a},isHasGetPoint:function(){var e=this._getPointMap();if(!e)return!1;var a=!1;return e.forEach(function(e,t){t&&t.isCanGet&&!a&&(a=!0)},this),a},isElementAlert:function(e){var t=this.getHunluListByElement(e);if(!t||t.length<1)return!1;for(var a=0,i=t.length,n=void 0;a<i;a++)if(n=t[a]){if(n.isCanZhuhun)return!0;if(n.isCanActive)return!0;if(n.isCanUpgrade)return!0}return!1}});game.hunluData=game.hunluData||new e}(),function(){var e=game.Control.extends({ctor:function(){this._super()},init:function(){this.spotAlert=game.spotAlert.set(game.SAE.HUNLU,game.SAE.HOME),this.spotAlert_main=game.spotAlert.set(game.SAE.HUNLU_HUNKA,game.SAE.MY_MAP),this.spotAlert_achievement=game.spotAlert.set(game.SAE.HUNLU_ACHIEVEMENT,game.SAE.MY_MAP)},ipc:function(){var e=this;e.evts={Back:{C_BACK_UPDATE_ITEMINFO:e.updateItem},MainRole:{C_LEVEL_UP:e.levelUp},MyMap:{C2C_HUNLU_MODEL_REQ:e._hunluModelReq}},e.handels={HunluModelResp:e.onHunluModelResp,HunluTopResp:e.onHunluTopResp,HunluActivateResp:e.onHunluActivateResp,HunluUpgradeResp:e.onHunluUpgradeResp,HunluBegResp:e.onHunluBegResp,HunluGiftResp:e.onHunluGiftResp,HunluZhuhunResp:e.onHunluZhuhunResp,HunluAchievementResp:e.onHunluAchievementResp,HunluPointRewardResp:e.onHunluPointRewardResp,HunluMsg:e.onHunluNotify}},notify:function(e,t){var a=this;switch(e){case a.Evts.V2C_HUNLU_MODEL_REQ:a._hunluModelReq();break;case a.Evts.V2C_HUNLU_HUNKA_TOP:a._setHunluTopOrder(t);break;case a.Evts.V2C_HUNLU_HUNKA_CANCEL_TOP:a._cancelHunluTop(t);break;case a.Evts.V2C_HUNLU_HUNKA_ACTIVE:a._activeHunlu(t);break;case a.Evts.V2C_HUNLU_HUNKA_UPGRADE:a._upgradeHunlu(t);break;case a.Evts.V2C_HUNLU_GET_ACHIEVEMENT:a.getAchievementAward(t);break;case a.Evts.V2C_HUNLU_SELECT_QIU_ZENG_INFO:a.updateSelectQiuZengInfo(t);break;case a.Evts.V2C_HUNLU_SELECT_CARD_INFO:a.updateSelectCradInfo(t);break;case a.Evts.V2C_SET_PREVIEW_AWARD:a.showAward(t);break;case a.Evts.V2C_HUNLU_SELECT_ELEMENT:a._selectElement(t)}},levelUp:function(){game.moduleOpen.checkOpen(game.ME.Hunlu)&&(game.hunluData.isInitHunluModelReq||this._hunluModelReq())},_hunluModelReq:function(){this.sender.HunluModelReq()},_setHunluTopOrder:function(e){game.hunluData.curSelectCombinationInfo=e;var t=this._getLastTopList(e);t.unshift(e.id),this.sender.HunluTopReq(e.element,t)},_getLastTopList:function(e){var t=game.hunluData.getHunluListByElement(e.element);if(!t||t.length<1)return null;for(var a=[],i=0,n=t.length,s=void 0;i<n;i++)(s=t[i])&&-1<s.sortIndex&&a.push(s.id);return a},_cancelHunluTop:function(e){game.hunluData.curSelectCombinationInfo=e;var t=this._getFitTopList(e);this.sender.HunluTopReq(e.element,t)},_getFitTopList:function(e){var t=game.hunluData.getHunluListByElement(e.element);if(!t||t.length<1)return null;for(var a=[],i=0,n=t.length,s=void 0;i<n;i++)(s=t[i])&&-1<s.sortIndex&&a.push(s.id);if(a&&0<a.length){i=0,n=a.length;for(var r=void 0;i<n;i++)if((r=a[i])&&r==e.id){a.splice(i,1);break}}return a},_activeHunlu:function(e){(game.hunluData.curSelectCombinationInfo=e).isCanActive&&this.sender.HunluActivateReq(e.id)},_upgradeHunlu:function(e){(game.hunluData.curSelectCombinationInfo=e).isCanUpgrade&&this.sender.HunluUpgradeReq(e.id)},onHunluModelResp:function(e){var t=e.readProtobuf(game.pb.HunluModel);0<t.code?game.notice.noticeError(t.code):(game.hunluData.isInitHunluModelReq=!0,game.hunluData.syncModelData(t),this.checkHunluMainAlert(),this.checkHunluAchievementAlert(),game.hunluData.updateBtnInfoAlert(),this.send(this.Evts.C2V_HUNLU_SYNC_MODEL_DATA))},onHunluTopResp:function(e){var t=e.readProtobuf(game.pb.HunluTopResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.element,i=t.list,n=game.hunluData.curSelectCombinationInfo;n&&n.updateSortIndex(-1),i&&0<i.length&&game.hunluData.setHunluTopSort(a,i),this.send(this.Evts.C2V_HUNLU_SET_SORT,a)}},onHunluActivateResp:function(e){var t=e.readProtobuf(game.pb.HunluActivateResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.FightAmount.inst().showTeamStatPower();var a=t.id,i=t.cards;game.hunluData.isUpdateSpriteStat=!0,game.hunluData.setHunluActivateData(a,i),game.hunluData.curAwardPanel=game.hunluData.ACTIVE_PANEL,b8e.module.isShowView(game.ME.HunluAward)||game.module.show(game.ME.HunluAward),this.checkHunluMainAlert(),game.hunluData.updateBtnInfoAlert(),this.send(this.Evts.C2V_HUNLU_ACTIVATE)}},onHunluUpgradeResp:function(e){var t=e.readProtobuf(game.pb.HunluUpgradeResponse);if(0<t.code)game.notice.noticeError(t.code);else{game.FightAmount.inst().showTeamStatPower();var a=t.id,i=t.lv,n=t.cards;game.hunluData.isUpdateSpriteStat=!0,game.hunluData.hunluUpgrade(a,i,n),game.hunluData.curAwardPanel=game.hunluData.UPGRADE_PANEL,b8e.module.isShowView(game.ME.HunluAward)||game.module.show(game.ME.HunluAward),this.checkHunluMainAlert(),game.hunluData.updateBtnInfoAlert(),this.send(this.Evts.C2V_HUNLU_UPGRADE)}},onHunluBegResp:function(e){var t=e.readProtobuf(game.pb.HunluBegResponse);0<t.code?game.notice.noticeError(t.code):(b8e.module.isShowView(game.ME.HunluQiuzeng)&&game.module.hide(game.ME.HunluQiuzeng),game.notice.show(51810),game.hunluData.setQiuZengCoolTime(),this.send(this.Evts.V2C_HUNLU_QIU_ZENG_COOL_TIME))},onHunluGiftResp:function(e){var t=e.readProtobuf(game.pb.HunluGiftResponse);0<t.code?game.notice.noticeError(t.code):(game.notice.show(51808),b8e.module.isShowView(game.ME.HunluZengSong)&&game.module.hide(game.ME.HunluZengSong))},onHunluZhuhunResp:function(e){var t=e.readProtobuf(game.pb.HunluZhuhunResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.card;game.hunluData.hunluZhuhun(a),game.hunluData.curAwardPanel=game.hunluData.ZHUHUN_PANEL,b8e.module.isShowView(game.ME.HunluAward)||game.module.show(game.ME.HunluAward),this.checkHunluMainAlert(),this.checkHunluAchievementAlert(),game.hunluData.updateBtnInfoAlert(),this.send(this.Evts.C2V_HUNLU_ZHU_HUN)}},onHunluAchievementResp:function(e){var t=e.readProtobuf(game.pb.HunluAchievementResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.point;game.hunluData.totalPoint=i,game.hunluData.updateAchievementById(a),game.hunluData.updatePointState(),this.checkHunluAchievementAlert();var n=game.HunluAchievementCfg.getData(a);if(n){var s=b8e.createMap();s.awards=n.awards,s.moduleEnum=game.ME.Hunlu,s.isNoHide=!0,s.toggle=1,this.dpt(this.Evts.C2C_SET_SHOW_AWARD,s)}this.send(this.Evts.C2V_HUNLU_ACHIEVEMENT)}},onHunluPointRewardResp:function(e){var t=e.readProtobuf(game.pb.HunluPointRewardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.point;game.hunluData.updatePointStateByPoint(a);var i=game.HunluPointAwardCfg.getData(a);if(i){var n=b8e.createMap();n.awards=i.awards,n.moduleEnum=game.ME.Hunlu,n.isNoHide=!0,n.toggle=1,this.dpt(this.Evts.C2C_SET_SHOW_AWARD,n)}this.send(this.Evts.C2V_HUNLU_POINT_REWARD)}},onHunluNotify:function(e){var t=e.readProtobuf(game.pb.HunluNotify);if(0<t.code)game.notice.noticeError(t.code);else{game.hunluData.curSelectQiuZengInfo=null;var a=t.begCount;game.hunluData.begCount=a,this.send(this.Evts.C2V_HUNLU_BEG)}},_selectElement:function(e){game.hunluData.setSelectBtnInfo(e.id),this.send(this.Evts.C2V_HUNLU_SELECT_ELEMENT)},hunka_arrowUpBtn:function(){this.send(this.Evts.C2V_HUNLU_HUNKA_UP_BTN)},hunka_arrowDownBtn:function(){this.send(this.Evts.C2V_HUNLU_HUNKA_DOWN_BTN)},btn_bonus:function(){b8e.module.isShowView(game.ME.HunluSpriteStat)||game.module.show(game.ME.HunluSpriteStat)},begBtn:function(){b8e.module.isShowView(game.ME.HunluQiuzeng)||game.module.show(game.ME.HunluQiuzeng)},selectBtn:function(){b8e.module.isShowView(game.ME.HunluSelect)||game.module.show(game.ME.HunluSelect)},zhuhunBtn:function(){var e=game.hunluData.curSelectCardInfo;if(e){var t=game.HunluBaseCfg.getData(e.id);if(t)game.UpgradeUtil.checkItemList(t.costItems,1)&&this.sender.HunluZhuhunReq(e.combinationId,e.id)}},confirmBtn:function(){game.hunluData.curSelectQiuZengInfo&&(b8e.module.isShowView(game.ME.HunluSelect)&&game.module.hide(game.ME.HunluSelect),this.send(this.Evts.C2V_HUNLU_UPDATE_QIU_ZENG_ITEM_INFO,game.hunluData.curSelectQiuZengInfo))},btn_confirm:function(){var e=game.hunluData.curChatQiuZengRoleId,t=game.hunluData.curChatHunluIdx,a=game.hunluData.curChathunluItemId;e&&t&&a&&this.sender.HunluGiftReq(e,t,a)},btn_world_qiuzhu:function(){this._sendQiuZeng(game.ChatChannelType.WORLD)},btn_buluo_qiuzhu:function(){this._sendQiuZeng(game.ChatChannelType.GUILD)},_sendQiuZeng:function(e){if(game.hunluData.isCanQiuZeng()){var t=game.hunluData.curSelectCardInfo;if(t){var a=game.hunluData.curSelectQiuZengInfo;a?this.sender.HunluBegReq(e,t.id,a.id):game.notice.show("\u8bf7\u9009\u62e9\u9700\u8981\u6c42\u8d60\u7684\u7269\u54c1")}}else{var i=game.hunluData.getQiuZengCountdown();game.notice.show(51809,i)}},achieveBtn:function(){var e=game.hunluData.getFitTotalPoint();game.hunluData.isGetPoint(e)?game.notice.show(51710):this.sender.HunluPointRewardReq(e)},unAchieveBtn:function(){game.notice.show(51709)},arrowUpBtn:function(){this.send(this.Evts.C2V_HUNLU_ACHIEVE_UP_BTN)},arrowDownBtn:function(){this.send(this.Evts.C2V_HUNLU_ACHIEVE_DOWN_BTN)},hunkaBtn:function(){this._selectPage(0)},hunluBtn:function(){this._selectPage(1)},_selectPage:function(e){this.send(this.Evts.C2V_HUNLU_SWITCH_PAGE,e)},triggerOpen:function(e){e==this.moduleEnum&&this.sender.HunluModelReq()},getAchievementAward:function(e){this.sender.HunluAchievementReq(e)},updateSelectQiuZengInfo:function(e){game.hunluData.setSelectQiuZengInfo(e),this.send(this.Evts.C2V_HUNLU_UPDATE_SELECT_INFO,e)},updateSelectCradInfo:function(e){game.hunluData.setSelectCardInfo(e),this.send(this.Evts.C2V_HUNLU_SELECT_CRAD_INFO,e)},updateItem:function(){game.moduleOpen.checkOpen(game.ME.Hunlu)&&(game.hunluData.updateAllElementState(),game.hunluData.updateHunshiList(),this.checkHunluMainAlert(),game.hunluData.updateBtnInfoAlert(),this.send(this.Evts.C2V_HUNLU_UPDATE_ITEMINFO))},checkHunluMainAlert:function(){this.spotAlert_main.alert=game.hunluData.isAlert()},checkHunluAchievementAlert:function(){this.spotAlert_achievement.alert=game.hunluData.isHasAchievementAlert()},showAward:function(e){if(e.cfg){var t=b8e.createMap();t.awards=e.cfg.awards,t.title=51753,t.btnStr=51754,t.okCall=this.sureBtn,(t.thisArg=this).dpt(this.Evts.C2C_SET_PREVIEW_AWARD,t)}},sureBtn:function(){game.module.hide(game.ME.AwardPreviewTip),b8e.module.isShowView(game.ME.Hunlu)||game.module.showToggle(game.ME.Hunlu,1)}}),t=game.Sender.extends({ipc:function(){this.msg={HunluModelReq:null,HunluTopReq:this.hunluTopReq,HunluActivateReq:this.hunluActivateReq,HunluUpgradeReq:this.hunluUpgradeReq,HunluBegReq:this.hunluBegReq,HunluGiftReq:this.hunluGiftReq,HunluZhuhunReq:this.hunluZhuhunReq,HunluAchievementReq:this.hunluAchievementReq,HunluPointRewardReq:this.hunluPointRewardReq}},hunluTopReq:function(e,t){var a=game.pb.HunluTopRequest;a.element=e,a.list=t,b8e.net.getBytes().writeProtobuf(a)},hunluActivateReq:function(e){var t=game.pb.HunluActivateRequest;t.id=e,b8e.net.getBytes().writeProtobuf(t)},hunluUpgradeReq:function(e){var t=game.pb.HunluUpgradeRequest;t.id=e,b8e.net.getBytes().writeProtobuf(t)},hunluBegReq:function(e,t,a){var i=game.pb.HunluBegRequest;i.chatType=e,i.cardId=t,i.itemId=a,b8e.net.getBytes().writeProtobuf(i)},hunluGiftReq:function(e,t,a){var i=game.pb.HunluGiftRequest;i.roleId=e,i.idx=t,i.itemId=a,b8e.net.getBytes().writeProtobuf(i)},hunluZhuhunReq:function(e,t){var a=game.pb.HunluZhuhunRequest;a.combinationId=e,a.cardId=t,b8e.net.getBytes().writeProtobuf(a)},hunluAchievementReq:function(e){var t=game.pb.HunluAchievementRequest;t.id=e,b8e.net.getBytes().writeProtobuf(t)},hunluPointRewardReq:function(e){var t=game.pb.HunluPointRewardRequest;t.point=e,b8e.net.getBytes().writeProtobuf(t)}}),a=[game.ME.HunluHunka,game.ME.HunluAchievement,game.ME.HunluZhuhun,game.ME.HunluSpriteStat,game.ME.HunluAward,game.ME.HunluQiuzeng,game.ME.HunluSelect,game.ME.HunluZengSong];b8e.module.registerControl(game.ME.Hunlu,e,game.HunluEvts,t,a)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1379),this.setSize(88,42)},init:function(){this._icon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_42),this._icon.addToParent(this.skin.item)},setData:function(){this.skin.num.string="*"+this.data.num,game.GridUtil.setItemIcon(this._icon,this.data,!1,game.IconLayoutEnum.SHOW_NONE)}}),b8e.RC("$$game","$$HunluAchievementAwardItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1316),this.setSize(601,117)},init:function(){var e=this,t=e.skin;e.Progress=new game.Progress(128,30,0),e.Progress.addToParent(t.progressNode),e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.prizeList.itemRender=game.HunluAchievementAwardItem,e.prizeList.layout.spacingX=-15,e.prizeList.addToParent(t.awardNode),e._icon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_84),e._icon.addToParent(t.icon),e._icon.setClickCb(e._showPreviewAward,e),e.prizeInfo=[]},setData:function(){var e=this.skin,t=this.data,a=t.cfg;if(a){var i=t.count<a.count?t.count:a.count;e.nameLab.string=t.name,e.countLab.string=game.Lang.get(a.lang,a.count),e.getBtn.active=t.isGet,e.unAchieveBtn.active=!t.isGet&&!t.isCanGet,e.achieveBtn.active=!t.isGet&&t.isCanGet,this.Progress.updatePro(i,a.count),e.pointLab.string="*"+a.point,this.updataPrize(a.awards)}},updataPrize:function(e){if(!this._isInitPrize&&e&&!(e.length<1)){this._isInitPrize=!0;for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)(a=e[n])&&game.ItemInfoCfg.getData(a.Id)&&((i=this.prizeInfo[n])||(i=game.ItemUtil.createPrizeInfo(a.Id,a.Num),this.prizeInfo[n]=i),i.setData(a.Id,a.Num));this.prizeList.setData(this.prizeInfo);var s=b8e.createMap();s.id=e[0].Id,s.num=e[0].Num,game.GridUtil.setItemIcon(this._icon,s,!1,game.IconLayoutEnum.SHOW_NONE)}},achieveBtn:function(){this.data&&this.send(game.HunluEvts.V2C_HUNLU_GET_ACHIEVEMENT,this.data.id)},_showPreviewAward:function(){this.data&&this.send(game.HunluEvts.V2C_SET_PREVIEW_AWARD,this.data)},unAchieveBtn:function(){game.notice.show(51709)},getBtn:function(){game.notice.show(51710)}}),b8e.RC("$$game","$$HunluAchievementListItem",e)}(),function(){var e=game.CultivateBaseModelView.extends({ctor:function(){this._super(1315)},init:function(){var e=this;e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._list.itemRender=game.HunluAchievementListItem,e._list.bindEnum=game.ME.Hunlu,e._list.addToParent(e.skin.list),e._list.setScrollViewCb(e.listCb,e),e.anim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anim.addToParent(e.skin.modelNode),e.anim.setVisible(!1),e.Progress=new game.Progress(335,30,0),e.Progress.addToParent(e.skin.progressNode)},notify:function(e){var t=this;switch(e){case t.Evts.C2V_HUNLU_ACHIEVEMENT:t.updataAward(),t.updataPage();break;case t.Evts.C2V_HUNLU_POINT_REWARD:t.updataPage();break;case t.Evts.C2V_HUNLU_ACHIEVE_UP_BTN:t.scrollAwardTop(),t.updataPageBtn();break;case t.Evts.C2V_HUNLU_ACHIEVE_DOWN_BTN:t.scrollAwardBottom(),t.updataPageBtn()}},onShow:function(){this.updataAward(),this.updataPage(),this.updataPageBtn()},updataAward:function(){this._awardNum=0,this._list.scrollToTop();var e=game.hunluData.getAchievementList();e&&(this._awardMax=e.length-5,e&&0<e.length&&e.sort(this.onSort),this._list.setData(e))},onSort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.sortId-t.sortId},updataPage:function(){var e=this.skin,t=game.hunluData.getFitTotalPoint();e.totalPointLab.string=game.hunluData.totalPoint,this.Progress.updatePro(game.hunluData.totalPoint,t),this.updataBtn(t),this.updataTitle(t)},updataBtn:function(e){var t=this.skin,a=game.hunluData.getPointInfoByPoint(e);a&&(a.isGet?(t.getBtn.active=!0,t.achieveBtn.active=!1,t.unAchieveBtn.active=!1):(t.getBtn.active=!1,t.achieveBtn.active=a.isCanGet,t.unAchieveBtn.active=!a.isCanGet))},updataTitle:function(e){var t=game.HunluPointAwardCfg.getData(e);t&&(this.skin.achievementPointLab.string=game.Lang.get(t.lang,e),t.anim?(this.anim.load(t.anim),this.anim.setVisible(!0),this.anim.play(null,0)):(this.anim.clear(),this.anim.setVisible(!1)))},scrollAwardTop:function(){this._awardNum-1<0||(this._awardNum--,this._list.scrollToTop(-130*this._awardNum,200))},scrollAwardBottom:function(){this._awardNum+1>this._awardMax||(this._awardNum++,this._list.scrollToBottom(-130*(this._awardMax-this._awardNum),200))},updataPageBtn:function(){this.skin.arrowUpBtn.active=0!=this._awardNum,this.skin.arrowDownBtn.active=this._awardNum<=this._awardMax},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.arrowUpBtn.active=n,this.topAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.topAlert=!0;break}if(n=0<(i=a.length),this.skin.arrowDownBtn.active=n,this.bottomAlert=!1,n)for(var r=0;r<i;r++)if(a[r].isAlert){this.bottomAlert=!0;break}this.updateTBBtnAlert(this.topAlert,this.bottomAlert)},updateTBBtnAlert:function(e,t){this.skin.top_alert.active=e,this.skin.bottom_alert.active=t},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HunluAchievement,e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1312),this.setSize(120,162)},setData:function(){var e=this.skin,t=this.data,a=void 0,i=game.HunluBaseCfg.getData(t.id);if(i){a=game.ResCfg.getUrl(10111,i.quality),e.qualityBg.loadTexture(a);var n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);e.nameLab.string=n}a=game.ResCfg.getUrl(10110,t.id),e.icon.loadTexture(a),e.icon.setScale(.8,.8);var s=t.num,r=0<s?game.Color.GREEN:game.Color.RED,o=game.HtmlUtil.getText(r,s)+"/1";e.numLab.string=o,e.redPoint.active=t.isCanZhuhun,game.ShaderUtil.setGray(e.icon,!(0<s))},onClickNode:function(){game.module.show(game.ME.HunluZhuhun),this.send(game.HunluEvts.V2C_HUNLU_SELECT_CARD_INFO,this.data)}})).poolCall=!0,b8e.RC("$$game","$$HunluCardListItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1378),this.setSize(330,35)},setData:function(){var e=this.skin,t=this.data,a=game.AttrRulesCfg.getData(t.type);a&&(e.lab_attr1.string=a.name+"+"+t.clientVal,e.lab_attr2.string=a.name+"+"+t.clientPer+"%")}}),b8e.RC("$$game","$$HunluCardSpriteStatListItem",e)}(),function(){var e;e=game.HunluCardSpriteStatListItem.extends({setData:function(){var e=this.skin,t=this.data,a=game.AttrRulesCfg.getData(t.type);if(a){var i=game.HtmlUtil,n=game.Color,s=i.getText(n.WHITE,a.name),r=s+i.getText(n.GREEN,"+"+t.clientVal),o=s+i.getText(n.GREEN,"+"+t.clientPer+"%");e.lab_attr1.string=r,e.lab_attr2.string=o}}}),b8e.RC("$$game","$$HunluCardSpriteStatListItem2",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1313),this.setSize(82,50)},setData:function(){var e=this.skin,t=this.data,a=game.ItemInfoCfg.getData(t.id);if(a){var i=game.ResCfg.getUrl(10113,a.icon);e.icon.loadTexture(i)}var n=game.CCommonUtil.replaceNum(t.count,0);e.numLab.string=n},icon:function(){if(this.data){var e=game.ItemInfoCfg.getData(this.data.id);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}}}),b8e.RC("$$game","$$HunluCostListItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1437),this.setSize(83,142)},setData:function(){var e=this.skin,t=this.data;e.btnSelectImg.active=t.select,e.red_spot.active=t.alert,e.labName.string=t.str},clickBtn:function(){this.data&&this.send(game.HunluEvts.V2C_HUNLU_SELECT_ELEMENT,this.data)}}),b8e.RC("$$game","$$HunluElementListItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1311),this.setSize(509,317)},init:function(){var e=this,t=e.skin;e._cardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._cardList.itemRender=game.HunluCardListItem,e._cardList.bindEnum=game.ME.Hunlu,e._cardList.layout.spacingX=10,e._cardList.layout.spacingY=0,e._cardList.layout.paddingLeft=0,e._cardList.layout.paddingTop=-10,e._cardList.addToParent(t.cardList),e._spriteStatList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._spriteStatList.itemRender=game.HunluCardSpriteStatListItem,e._spriteStatList.bindEnum=game.ME.Hunlu,e._spriteStatList.layout.paddingLeft=0,e._spriteStatList.layout.paddingTop=0,e._spriteStatList.layout.spacingX=0,e._spriteStatList.layout.spacingY=0,e._spriteStatList.addToParent(t.spriteStatList)},onHide:function(){this._starBar&&(this._starBar.release(),this._starBar=null)},setData:function(){var e=this.skin,t=this.data;e.lab_name.string=t.name,this.updateCardList(t),this.updateStar(t),this.setSptiteStatinfo(t),e.topBtn.active=!t.isTop,e.cancelTopBtn.active=t.isTop,t.isMaxLv?(e.maxLvBtn.active=t.isMaxLv,e.activeBtn.active=!1,e.upgradeBtn.active=!1):t.isActived?(e.activeBtn.active=!1,e.upgradeBtn.active=!0,game.ShaderUtil.setGray(e.upgradeBtn,!t.isCanUpgrade),e.red_spot_upgrade.active=t.isCanUpgrade):(e.activeBtn.active=!0,e.upgradeBtn.active=!1,game.ShaderUtil.setGray(e.activeBtn,!t.isCanActive),e.red_spot_active.active=t.isCanActive)},updateCardList:function(e){var t=e.getCardList();this._cardList.setData(t)},setSptiteStatinfo:function(e){var t=e.getSpriteStatList();this._spriteStatList.setData(t)},updateStar:function(e){this._starBar=game.StarBar.get(game.StarBarType.Hunlu),this._starBar.addToParent(this.skin.starNode),this._starBar.setData(e.lv)},topBtn:function(){this.send(game.HunluEvts.V2C_HUNLU_HUNKA_TOP,this.data)},cancelTopBtn:function(){this.send(game.HunluEvts.V2C_HUNLU_HUNKA_CANCEL_TOP,this.data)},activeBtn:function(){this.data.isCanActive&&this.send(game.HunluEvts.V2C_HUNLU_HUNKA_ACTIVE,this.data)},upgradeBtn:function(){this.data.isCanUpgrade&&this.send(game.HunluEvts.V2C_HUNLU_HUNKA_UPGRADE,this.data)},maxLvBtn:function(){}}),b8e.RC("$$game","$$HunluHunKaListItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1310)},init:function(){var e=this,t=e.skin;e._btnlist=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._btnlist.itemRender=game.HunluElementListItem,e._btnlist.bindEnum=game.ME.Hunlu,e._btnlist.layout.paddingLeft=0,e._btnlist.layout.paddingTop=0,e._btnlist.layout.spacingX=0,e._btnlist.layout.spacingY=10,e._btnlist.addToParent(t.btnList),e._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._list.itemRender=game.HunluHunKaListItem,e._list.bindEnum=game.ME.Hunlu,e._list.layout.paddingLeft=0,e._list.layout.paddingTop=0,e._list.layout.spacingX=0,e._list.layout.spacingY=5,e._list.addToParent(t.hunkaList),e._list.setScrollViewCb(e.listCb,e),e._costList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._costList.itemRender=game.HunluCostListItem,e._costList.bindEnum=game.ME.Hunlu,e._costList.layout.spacingX=2,e._costList.layout.spacingY=0,e._costList.layout.paddingLeft=0,e._costList.layout.paddingTop=0,e._costList.addToParent(t.costList)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_HUNLU_SELECT_ELEMENT:a._list&&a._list.scrollToTop(),a.updateElementInfo(),a.updateBtnState();break;case a.Evts.C2V_HUNLU_HUNKA_UP_BTN:a.scrollAwardTop();break;case a.Evts.C2V_HUNLU_HUNKA_DOWN_BTN:a.scrollAwardBottom();break;case a.Evts.C2V_HUNLU_ACTIVATE:case a.Evts.C2V_HUNLU_UPGRADE:a.updateElementInfo(),a.updateBtnState();break;case a.Evts.C2V_HUNLU_ZHU_HUN:case a.Evts.C2V_HUNLU_UPDATE_ITEMINFO:a.updateElementInfo(),a.updateBtnState(),a.updateHunshiInfo();break;case a.Evts.C2V_HUNLU_SET_SORT:a.updateElementList(t)}},onShow:function(){this.updateElementInfo(),this.updateBtnState(),this.updateHunshiInfo(),this._list.scrollToTop()},scrollAwardTop:function(){this._list&&this._list.scrollContainerTop()},scrollAwardBottom:function(){this._list&&this._list.scrollContainerBottom()},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.hunka_arrowUpBtn.active=n,this.topAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.topAlert=!0;break}if(n=0<(i=a.length),this.skin.hunka_arrowDownBtn.active=n,this.bottomAlert=!1,n)for(var r=0;r<i;r++)if(a[r].isAlert){this.bottomAlert=!0;break}this.updateTBBtnAlert(this.topAlert,this.bottomAlert)},updateTBBtnAlert:function(e,t){this.skin.top_alert.active=e,this.skin.bottom_alert.active=t},updateElementInfo:function(){var e=game.hunluData,t=e.curSelectElement?e.curSelectElement:HunluElementType.Water,a=this.skin;this.updateElementList(t);var i=game.hunluData.getProgress(t),n=game.hunluData.getHunluListByElement(t);a.progressLab.string=game.Lang.get(51800,i,n.length)},updateElementList:function(e){var t=game.hunluData.getHunluListByElement(e);t&&0<t.length&&t.sort(this.onSort),this._list.setData(t)},onSort:function(e,t){return e.isCanActive&&!t.isCanActive?-1:!e.isCanActive&&t.isCanActive?1:e.isCanUpgrade&&!t.isCanUpgrade?-1:!e.isCanUpgrade&&t.isCanUpgrade?1:e.isAlert&&!t.isAlert?-1:!e.isAlert&&t.isAlert?1:e.isTop&&!t.isTop?-1:!e.isTop&&t.isTop?1:e.isTop&&t.isTop?e.sortIndex>t.sortIndex:e.lv>t.lv?-1:e.lv<t.lv?1:e.isMaxLv&&!t.isMaxLv?1:!e.isMaxLv&&t.isMaxLv?-1:e.id-t.id},updateBtnState:function(){var e=game.hunluData.getBtnInfos();this._btnlist.setData(e)},updateHunshiInfo:function(){var e=game.hunluData.getHunshiList();this._costList.setData(e)},waterAlert:function(e){this.skin.red_spot_water.node.active=e.alert},windAlert:function(e){this.skin.red_spot_wind.node.active=e.alert},earthAlert:function(e){this.skin.red_spot_earth.node.active=e.alert},fireAlert:function(e){this.skin.red_spot_fire.node.active=e.alert},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HunluHunka,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1322),this.setSize(540,126)},init:function(){this.item=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this.item.addToParent(this.skin.icon)},setData:function(){var e=this.skin,t=this.data,a=t.id,i=t.num,n=game.ItemInfoCfg.getData(a);if(n){game.GridUtil.setItemIcon(this.item,n,!1,game.IconLayoutEnum.SHOW_NONE);var s=game.HtmlUtil.getColorStrByQuality(n.quality,n.name,!0);e.nameLab.string=s;var r=game.itemData.getNumById(a);e.numLab.string=game.Lang.get(51803,r,i)}e.selectImg.active=t.select},check_btn:function(){this.data&&this.send(game.HunluEvts.V2C_HUNLU_SELECT_QIU_ZENG_INFO,this.data.id)}}),b8e.RC("$$game","$$HunluSelectListItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1321)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.HunluSelectListItem,this._list.bindEnum=game.ME.Hunlu,this._list.layout.paddingLeft=3,this._list.layout.paddingTop=0,this._list.layout.spacingX=0,this._list.layout.spacingY=5,this._list.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_HUNLU_UPDATE_SELECT_INFO:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=game.hunluData.getQiuZengList(),a=t&&0<t.length;e.no_tip.active=!a,e.confirmBtn.active=a,this._list.setData(t)}});b8e.module.registerView(game.ME.HunluSelect,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1318),this.setSize(291,331)},init:function(){var e=this.skin;this._model=b8e.Animator.get(1,1),this._model.addToParent(e.model),this._model.setScale(.7,.7)},setData:function(){var e=this.skin,t=this.data,a=t.id,i=game.HunluBaseCfg.getData(a);if(i){var n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);e.nameLab.string=n;var s=t.num,r=0<s?game.Color.GREEN:game.Color.RED,o=game.HtmlUtil.getText(r,s)+"/1";e.numLab.string=o,this._model&&(this._model.load(game.ResCfg.getUrl(5e3,i.UIModel)),this._model.play(),game.ShaderUtil.setGray(this._model,!(0<s))),e.selectImg.active=t.select}else this._model&&this._model.clear()},onClickNode:function(){var e=this.data;e&&(this.curSelectCardInfo&&this.curSelectCardInfo.id==e.id||this.send(game.HunluEvts.V2C_HUNLU_SELECT_CARD_INFO,e))}}),b8e.RC("$$game","$$HunluZhuhunCardListItem",e)}(),function(){var e;e=game.GameItemIcon.extends({ctor:function(e){this._super(e),b8e.evt.onC(this,this._fnOnClickGrid,this)},setData:function(e){if(this.data=e){var t=e.id,a=game.ItemInfoCfg.getData(t);if(a){this.setBgImage(game.ResCfg.getQualityBg(a.quality));var i=a.icon;i&&""!=i&&"0"!=i||(i="1"),this.setIcon(game.ResCfg.getUrl(137,i)),this.setHunluQualityImg(a),this._setNum(e),this.setEffect(a.qualityEffect)}}else this.setBgImage(game.ResCfg.getQualityBg(0))},setHunluQualityImg:function(e){var t=this;if(e&&e.itemType==game.ItemType.Hunlu){if(t._hunluQualityImg||(t._hunluQualityImg=b8e.Sprite.get(),t._hunluQualityImg.setAnchor(.5,.5)),!t._hunluQualityImg.parent&&t._iconImg&&(t._iconImg.addChild(t._hunluQualityImg),t._hunluQualityImg.setPosition(0,-2)),t._hunluQualityImg){var a=game.ResCfg.getUrl(271,e.quality);t._hunluQualityImg.loadTexture(a)}}else t._hunluQualityImg&&(t._hunluQualityImg.unloadTexture(),t._hunluQualityImg.removeFromParent())},_setNum:function(e){var t=this,a=game.itemData.getNumById(e.id),i=a>=e.num?game.Color.GREEN:game.Color.RED,n=game.CCommonUtil.replaceNum(a,0),s=game.HtmlUtil.getText(i,n)+"/"+e.num;t._numTextString!=s&&(t._numTextString=s,t._numText||(t._labBg=b8e.Sprite.get(),t.addChild(t._labBg),t._labBg.setStyle(b8e.SpriteStyle.SLICED),t._labBg.setAnchor(1,0),t._labBg.scale9Inset={top:8,bottom:8,left:11,right:11},t._labBg.loadTexture(game.ResCfg.getUrl(239)),t._numText=b8e.RichText.get(),t.addChild(t._numText),t._numText.setFontSize(20),t._numText.setLineHeight(24)),t._numText.setText(s),t.setLabBgPos(),t.setLabBgSize(),t.setLabNumPos())},setLabBgPos:function(){if(this._labBg){var e=game.IconSizeEnum.GRID_SIZE_105,t=(game.IconWidthSizeEnumMap[e]>>1)-11,a=14-(e>>1);this._labBg.setPosition(t,a)}},setLabBgSize:function(){this._numText&&this._labBg.setSize(this._numText.width+12,24)},setLabNumPos:function(e,t){var a=0<arguments.length&&void 0!==e?e:0,i=1<arguments.length&&void 0!==t?t:0;if(this._numText){var n=game.IconSizeEnum.GRID_SIZE_105,s=(game.IconWidthSizeEnumMap[n]>>1)-17-this._numText.width,r=13-(n>>1);this._numText.setPosition(s+a,r+i)}},setEffect:function(e){var t=this;if(e&&""!=e){t._effect||(t._effect=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1)),t._effect&&!t._effect.parent&&t.addChild(t._effect);var a=game.ResCfg.getUrl(5022,e);t._effect.load(a),t._effect.play()}else t._effect&&(t._effect.clear(),t._effect.parent&&t._effect.removeFromParent())},_fnOnClickGrid:function(){if(this.data){game.tipsData.setInfo(this.data);var e=game.ItemInfoCfg.getCfgTypeById(this.data.id),t=game.ItemCfgType;switch(e){case t.Equip:game.module.show(game.ME.EquipTips);break;case t.Amount:case t.ShowItem:case t.EffectItem:case t.NormalItem:default:game.module.show(game.ME.ItemTips)}}}});b8e.RC("$$game","$$HunluZhuhunCostIcon",e)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(),this.setSize(100,110)},init:function(){this._icon=new game.HunluZhuhunCostIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.setAnchor(.5,.5),this._icon.setPosition(50,-52),this._icon.addToParent(this)},setData:function(){this._icon&&this._icon.setData(this.data)}})).poolCall=!0,b8e.RC("$$game","$$HunluZhuhunCostIconListItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1320),this.setSize(530,52)},setData:function(){var e=this.skin,t=this.data,a=game.AttrRulesCfg.getData(t.type);if(a){var i=game.HtmlUtil,n=game.Color,s=a.name+i.getText(n.GREEN,"+"+t.clientVal),r=a.name+i.getText(n.GREEN,"+"+t.clientPer+"%");e.nameLab.string=s,e.perLab.string=r}}}),b8e.RC("$$game","$$HunluSpriteStatListItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1319)},init:function(){var e=this.skin;this._spriteStatList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._spriteStatList.itemRender=game.HunluSpriteStatListItem,this._spriteStatList.bindEnum=game.ME.Hunlu,this._spriteStatList.layout.paddingLeft=3,this._spriteStatList.layout.paddingTop=2,this._spriteStatList.layout.spacingX=5,this._spriteStatList.layout.spacingY=8,this._spriteStatList.addToParent(e.list),game.hunluData.isUpdateSpriteStat=!0},onShow:function(){var e=game.hunluData.getTotalSpriteStatList();if(e){var t=e.values(),a=t&&0<t.length;this.skin.tipsNode.active=!a,a&&t.sort(this.onSort),this._spriteStatList.setData(t)}},onSort:function(e,t){return e.type-t.type},onHide:function(){game.hunluData.isUpdateSpriteStat=!1}});b8e.module.registerView(game.ME.HunluSpriteStat,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1317)},init:function(){var e=this,t=e.skin;e._cardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._cardList.itemRender=game.HunluZhuhunCardListItem,e._cardList.bindEnum=game.ME.Hunlu,e._cardList.layout.spacingX=10,e._cardList.layout.spacingY=0,e._cardList.layout.paddingLeft=0,e._cardList.layout.paddingTop=0,e._cardList.addToParent(t.cardList),e._awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._awardList.itemRender=game.PrizeListItem,e._awardList.layout.spacingX=5,e._awardList.addToParent(t.awardList),e._costList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._costList.itemRender=game.HunluZhuhunCostIconListItem,e._costList.bindEnum=game.ME.Hunlu,e._costList.layout.paddingLeft=0,e._costList.layout.paddingTop=0,e._costList.layout.spacingX=12,e._costList.layout.spacingY=5,e._costList.addToParent(t.costList)},notify:function(e){switch(e){case this.Evts.C2V_HUNLU_ZHU_HUN:case this.Evts.C2V_HUNLU_SELECT_CRAD_INFO:this.updateAllInfo();break;case this.Evts.C2V_HUNLU_UPDATE_ITEMINFO:this.updateCostInfo()}},onShow:function(){this._curCardInfo=game.hunluData.curSelectCardInfo,this.updateAllInfo()},updateAllInfo:function(){this._curCardInfo=game.hunluData.curSelectCardInfo,this._curSelectCombinationInfo=game.hunluData.curSelectCombinationInfo,this.updateCardInfo(),this.updateAward(),this.updateInfo()},updateInfo:function(){if(this._curCardInfo){var e=this.skin;this.updateCostInfo(),e.cardLab.string=game.Lang.get(51804,this._curCardInfo.num),this._curSelectCombinationInfo&&(e.countLab.string=game.Lang.get(51805,this._curSelectCombinationInfo.count)),this.updateBtnState()}},updateBtnState:function(){if(this._curCardInfo){var e=this.skin;game.ShaderUtil.setGray(e.zhuhunBtn,!this._curCardInfo.isCanZhuhun),e.red_spot_zhuhun.active=this._curCardInfo.isCanZhuhun}},updateCardInfo:function(){if(this._curSelectCombinationInfo){var e=this._curSelectCombinationInfo.getCardList();if(this._cardList.setData(e),e&&2<e.length){var t=this._curCardInfo.index,a=t>e.length-2?t-1:t;this._cardList.scrollToRight(291*a)}}},updateAward:function(){var e=this.skin;if(this._curCardInfo){var t=this._curCardInfo.getPrizeList();this._awardList.setData(t);var a=void 0,i=game.HunluBaseCfg.getData(this._curCardInfo.id);if(i){a=game.ResCfg.getUrl(10111,i.quality),e.qualityBg.loadTexture(a);var n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);e.cardNameLab.string=n}a=game.ResCfg.getUrl(10110,this._curCardInfo.id),e.icon.loadTexture(a),e.icon.setScale(.8,.8),e.cardNumLab.string="1/1"}},updateCostInfo:function(){if(this._curCardInfo){var e=this._curCardInfo.getCostList();this._costList.setData(e),this.updateBtnState()}}});b8e.module.registerView(game.ME.HunluZhuhun,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1323)},notify:function(e,t){switch(e){case this.Evts.C2V_HUNLU_BEG:this.updateInfo();break;case this.Evts.V2C_HUNLU_QIU_ZENG_COOL_TIME:this.startTime();break;case this.Evts.C2V_HUNLU_UPDATE_QIU_ZENG_ITEM_INFO:this.updateItemInfo(t)}},onShow:function(){this.skin.timeLab.string="",this.updateInfo(),game.hunluData.isCanQiuZeng()||this.startTime(),this.updateItemInfo()},onHide:function(){this.skin.timeLab.string="",this.stopTime(),this.skin.icon.unloadTexture()},updateInfo:function(){var e=this.skin,t=game.hunluData,a=t.begCount,i=t.getHunluDailyMaxBegCount;e.countLab.string=game.Lang.get(51801,a,i)},updateItemInfo:function(e){if(e){var t=game.ItemInfoCfg.getData(e.id);if(t){var a=game.ResCfg.getUrl(137,t.icon);this.skin.icon.loadTexture(a)}}else this.skin.icon.unloadTexture()},startTime:function(){this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},stopTime:function(){this.timer&&this.timer.stop()},updateTime:function(){var e=this.skin,t=game.hunluData.getQiuZengCoolTime();if(t<1)return e.timeLab.string="",void this.stopTime();e.timeLab.string=game.Lang.get(53029,game.TimeUtil.formatTimeSpace(t))}});b8e.module.registerView(game.ME.HunluQiuzeng,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1314),this.countDownTime=30},init:function(){var e=this,t=e.skin;e._spriteStatList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e._spriteStatList.itemRender=game.HunluCardSpriteStatListItem2,e._spriteStatList.bindEnum=game.ME.Hunlu,e._spriteStatList.layout.paddingLeft=0,e._spriteStatList.layout.paddingTop=0,e._spriteStatList.layout.spacingX=5,e._spriteStatList.layout.spacingY=5,e._spriteStatList.addToParent(t.spriteStatList),e.gridList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e.gridList.itemRender=game.AwardTipIcon,e.gridList.addToParent(e.skin.scrollGrid),e.gridList.layout.spacingX=40,e.gridList.layout.spacingY=40,e.posArray=[275,206,130,61]},onShow:function(){var e=this,t=e.skin,a=game.hunluData,i=a.curAwardPanel;switch(e._starBar&&(e._starBar.release(),e._starBar=null),i){case a.ZHUHUN_PANEL:t.scrollGrid.active=!0,t.spriteStatList.active=!1,e.setZhuhunAward();break;case a.ACTIVE_PANEL:case a.UPGRADE_PANEL:t.scrollGrid.active=!1,t.spriteStatList.active=!0,e.setSptiteStatinfo(),e.setStar()}game.TweenUtil.rotationEffect(e.skin.light);var n=game.ResCfg.getUrl(10112,i);t.title_get.loadTexture(n),e.skin.time.string=game.Lang.get(51892,e.countDownTime),e.startTime()},onHide:function(){this.stopTime(),b8e.Tween.kill(this.skin.light),this._starBar&&(this._starBar.release(),this._starBar=null)},startTime:function(){this.countDownTime=30,this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},stopTime:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null,this.countDownTime=30)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51892,this.countDownTime),this.countDownTime<-1&&game.module.hide(game.ME.HunluAward)},setZhuhunAward:function(){var e=this.skin,t=game.hunluData.curSelectCardInfo;if(t){var a=game.HunluBaseCfg.getData(t.id);if(a&&a.clientGiveItems){var i=a.clientGiveItems;if(!(i.length<1)){for(var n=[],s=0,r=i.length,o=void 0,g=void 0;s<r;s++)(o=i[s])&&(g=game.ItemUtil.createBaseItemInfo(o.Id,o.Num),n.push(g));if(n&&!(n.length<1)){this.gridList.setData(n),r=n.length,this._sizeY=4<r?400:339;var u=4<r?-435:-500,l=r>this.posArray.length?this.posArray[3]:this.posArray[r-1];e.scrollGrid.setPosition(l,u),this.layoutGray(),e.huawen_3.width=e.huawen_1.width=722,e.pathNode.setPosition(325,e.gray.y-e.gray.height)}}}}},setSptiteStatinfo:function(){var e=game.hunluData.curSelectCombinationInfo;if(e){var t=e.getSpriteStatList();this._spriteStatList.setData(t)}},setStar:function(){var e=game.hunluData.curSelectCombinationInfo;e&&(this._starBar=game.StarBar.get(game.StarBarType.Hunlu),this._starBar.addToParent(this.skin.starNode),this._starBar.setData(e.lv))},layoutGray:function(){this.skin&&this.skin.gray.setSize(b8e.stageWidth,this._sizeY)},onStageResize:function(){this.layoutGray(),this._super()}});b8e.module.registerView(game.ME.HunluAward,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1324)},onShow:function(){var e=this.skin,t=game.hunluData,a=t.curChathunluItemId,i=game.ItemInfoCfg.getData(a);if(i){var n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name,!0),s=t.curChatQiuZengRoleName,r=game.Lang.get(51802,n,s);e.labDesc.string=r;var o=game.itemData.getNumById(a),g=0<o?game.Color.GREEN:game.Color.RED,u=game.CCommonUtil.replaceNum(o,0),l=game.HtmlUtil.getText(g,u)+"/1";e.numLab.string=l;var c=game.ResCfg.getUrl(137,i.icon);e.icon.loadTexture(c)}}});b8e.module.registerView(game.ME.HunluZengSong,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1309),this.toggles={hunkaBtnSelect:game.ME.HunluHunka,hunluBtnSelect:game.ME.HunluAchievement},this.spotAlerts={HUNLU_HUNKA:this.hunkaAlert,HUNLU_ACHIEVEMENT:this.achievementAlert}},notify:function(e,t){switch(e){case this.Evts.C2V_HUNLU_SWITCH_PAGE:this.toggleSelect(t)}},onShow:function(){this.toggleSelect(0),game.hunluData.isInitHunluModelReq?game.hunluData.isInitAchievementData||game.hunluData.initAchievementModel():this.send(this.Evts.V2C_HUNLU_MODEL_REQ)},hunkaAlert:function(e){this.skin.red_spot_1.node.active=e.alert},achievementAlert:function(e){this.skin.red_spot_2.node.active=e.alert}});b8e.module.registerView(game.ME.Hunlu,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C2V_SWITCH_PAGE:-1,V2C_SELECT_ID:-1,V2C_GET_TAGET_AWARD:-1,C2V_GET_TAGET_AWARD_SUCCESS:-1,C2C_REQ_RACE_RANKINFO:-1,C2V_UPDATE_RANK_LIST:-1,C2V_UPDATE_TITLE_LIST:-1,C2C_RACETARGET_RESP:-1}),b8e.RC("$$game","$$OpenCompetitionEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,setData:function(e){e&&(this.cfg=e,this.id=e.id)},getPrizeList:function(){return this.prizeList?this.prizeList:this.cfg?(this.prizeList=game.CfgUtil.getPrizeListInfo(this.cfg.award,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84).items,this.prizeList):null},getExtraPrizeList:function(){return this.extraPrizeList?this.extraPrizeList:this.cfg?(this.extraPrizeList=game.CfgUtil.getPrizeListInfo(this.cfg.extraAward,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84).items,this.extraPrizeList):null}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OCRankAwardInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,canGet:!1,isGet:!1,progress:0,ocId:0,setData:function(e){e&&(this.cfg=e,this.id=e.id,this.canGet=!1,this.isGet=!1,this.progress=0,this.serverStart=e.serverStart,this.serverEnd=e.serverEnd)},getPrizeList:function(){return this.prizeList?this.prizeList:this.cfg?(this.prizeList=game.CfgUtil.getPrizeListInfo(this.cfg.award).items,this.prizeList):null},recycle:function(){this.reset(),this._super()},reset:function(){this.cfg=null,this.id=0,this.canGet=!1,this.isGet=!1,this.progress=0,this.prizeList=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,64),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$OCTargetInfo",t)}(),function(){var e;e=b8e.Object.extends({id:0,isAlert:!1,select:!1,setData:function(e){e&&(this.cfg=e,this.id=e.id,this.isAlert=!1,this.select=!1)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OCTitleInfo",e)}(),function(){var e=b8e.Object.extends({curSelectId:0,ctor:function(){this._super(),this.targetMap=b8e.HashMap.get(),this.targetTitleMap=b8e.HashMap.get(),this.titleTypeMap=b8e.HashMap.get()},setOpenList:function(){var e=this,t=e.getRaceRankCfgsByClientType(1);if(t&&!(t.length<1)){e.openList||(e.openList=[]),e.openList.length=0,e.openPool||(e.openPool=[]),e.targetTitleMap.clear(),e.titleTypeMap.clear();for(var a=void 0,i=void 0,n=void 0,s=t.length,r=game.miscData.openServerDay,o=0;o<s;o++)a=t[o],i=(i=e.openPool[o])||(e.openPool[o]=new game.OCTitleInfo),a.serverStart>r||a.serverEnd<=r?e.clearTargetList(a.raceType,a.id):(i.setData(a),e.targetTitleMap.set(i.id,i),(n=e.titleTypeMap.get(a.raceType))||(n=[],e.titleTypeMap.set(a.raceType,n)),n.push(i),e.openList.push(i),e.setTargetList(a));e.openList.sort(e.onSort),!e.curSelectId&&e.openList&&0<e.openList.length&&e.selectPage(e.openList[0].id)}},onSort:function(e,t){return e.id-t.id},setTargetList:function(e){var t=this.getRaceRankTargetCfgByType(e.id);if(t&&!(t.length<1)){var a,i=void 0,n=void 0,s=void 0,r=this.targetMap.get(e.raceType),o=e.id;r||(r=b8e.HashMap.get(),this.targetMap.set(e.raceType,r));var g=r.get(o);if(!(g&&0<g.length))for(g=[],r.set(o,g),a=t.length,i=0;i<a;i++)(n=t[i]).serverStart==e.serverStart&&n.serverEnd==e.serverEnd&&((s=game.OCTargetInfo.get()).ocId=o,s.setData(n),g.push(s))}},clearTargetList:function(e,t){if(this.targetMap){var a=this.targetMap.get(e);if(a){var i=a.get(t);if(i&&!(i.length<1)){for(var n=i.length,s=0;s<n;s++)game.OCTargetInfo.put(i[s]);i.length=0,a.del(t)}}}},setupData:function(e,t){if(this.raceTargetAwards=e,this.rankProgressMap||(this.rankProgressMap=b8e.HashMap.get()),t&&!(t.length<1)){this.raceTypeMap||(this.raceTypeMap=b8e.HashMap.get());for(var a=void 0,i=t.length,n=0;n<i;n++)a=t[n],this.rankProgressMap.set(a.id,a.progress)}},selectPage:function(e){var t=void 0;e!=this.curSelectId&&(this.curSelectId&&(t=this.targetTitleMap.get(this.curSelectId))&&(t.select=!1),(t=this.targetTitleMap.get(e))&&(t.select=!0,this.curSelectId=e))},checkAllAlert:function(e){var t=this.openList;if(!t||t.length<1)return!1;for(var a=void 0,i=!1,n=t.length,s=0;s<n;s++)if((a=t[s])&&a.cfg&&(a.isAlert=this.checkAlert(a.cfg.raceType,a.id,e),i=i||a.isAlert,!e&&i))return i;return i},checkAlertByType:function(e,t){if(!this.titleTypeMap)return!1;var a=this.titleTypeMap.get(e);if(!a)return!1;for(var i=void 0,n=!1,s=a.length,r=0;r<s;r++)if((i=a[r])&&i.cfg&&(i.isAlert=this.checkAlert(i.cfg.raceType,i.id,t),n=n||i.isAlert,!t&&n))return n;return n},checkAlert:function(e,t,a){if(!this.targetMap)return!1;var i=this.targetMap.get(e);if(!i)return!1;var n=i.get(t);if(!n||n.length<1)return!1;for(var s=void 0,r=void 0,o=!1,g=n.length,u=0;u<g;u++)if((r=n[u])&&r.cfg&&(s=r.cfg,r.progress=this.getCondition(e,r.ocId),r.canGet=r.progress>=s.condition,r.isGet=this.raceTargetAwards&&-1<this.raceTargetAwards.indexOf(r.id),(o=o||r.canGet&&!r.isGet)&&!a))return o;return o},setTargetGet:function(e){this.raceTargetAwards||(this.raceTargetAwards=[]),this.raceTargetAwards.push(e)},getCondition:function(e,t){var a=void 0,i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=this,u=0,l=void 0,c=game.OpenCompetitionType;switch(e){case c.SUMMON:var h=game.partnerData.getRacePartners();if(!h||h.length<1)return 0;var m=void 0;for(i=h.length,a=0;a<i;a++)l=h[a],(m=game.RaceSummonScoreCfg.getData(l.cfg.quality,l.star))&&(u+=m.score);return u;case c.EQUIP:for(a=1;a<5;a++)if((r=game.partnerEquipData.getAllInfosByPos(a,!0))&&!(r.length<1))for(s=r.length,n=0;n<s;n++)o=r[n],(0==u||u<o.totalFight)&&(u=o.totalFight);return u;case c.SHENHUN:return g.getFosterScoreByType(game.NewFosterType.SHENHUN);case c.MOUNT:return g.getFosterScoreByType(game.NewFosterType.MOUNT);case c.HALO:var d=game.fosterData.getFosterActiveIds(game.NewFosterType.HALO);if(!d||d.length<1)return 0;for(i=d.length,a=0;a<i;a++)u+=d[a].lv;return u;case c.COST:case c.RECHARGE:case c.RECHARGE:return g.rankProgressMap&&g.rankProgressMap.get(t)||0;case c.POWER:return game.mainRoleData.power;case c.SHENHUN_POWER:return g.getFosterAllScoreByType(game.NewFosterType.SHENHUN);case c.MOUNT_POWER:return g.getFosterAllScoreByType(game.NewFosterType.MOUNT);case c.AOYI_POWER:return g.getFosterAllScoreByType(game.NewFosterType.ZHANJI);case c.WING_POWER:return g.getFosterAllScoreByType(game.NewFosterType.WING);case c.HALO_POWER:return g.getFosterAllScoreByType(game.NewFosterType.HALO);case c.ZHENXING_POWER:return game.zhenXingData.getAllScore();default:b8e.error("\u8bd5\u56fe\u83b7\u53d6\u672a\u5b9e\u73b0\u6761\u4ef6\u7684raceType\u6570\u636e:",e)}return u},updatePayCount:function(i){var n=this,e=n.targetMap.get(game.OpenCompetitionType.COST);e&&0<e.count()&&e.forEach(function(e,t){var a=n.rankProgressMap.get(e);a=a?a+i:i,n.rankProgressMap.set(e,a)},n)},updataRechargeMoney:function(i){var n=this,e=n.targetMap.get(game.OpenCompetitionType.RECHARGE);e&&0<e.count()&&e.forEach(function(e,t){var a=n.rankProgressMap.get(e);a=a?a+i:i,n.rankProgressMap.set(e,a)},n)},getFosterScoreByType:function(e){var t=game.fosterData.getFosterActiveIds(e);if(!t||t.length<1)return 0;for(var a=void 0,i=void 0,n=0,s=0,r=t.length,o=0;o<r;o++)a=(i=t[o]).getPower(),(0==n||n<a)&&(n=a,s=i.id);return 0!=s&&(n=game.fosterData.getPower(e,s)),n},getFosterAllScoreByType:function(e){return game.fosterData.getFosterAllScoreByType(e)},getTitleInfoList:function(){return this.openList},getKempInfo:function(e){return game.raceRankData.getFirstRankTypeInfo(e)},getSelfRankInfo:function(e){return game.raceRankData.getSelfRankInfo(e)},getScoreDesc:function(e,t,a,i){var n=!(3<arguments.length&&void 0!==i)||i,s=this.getRaceRankCfgById(e);if(!s)return"";var r=game.OpenCompetitionType;if(s.raceType!=r.COST&&s.raceType!=r.RECHARGE)return n?game.Lang.get(s.conditionDesc2,t):t;var o=this.getRankLength(e),g=this.getSelfRankInfo(e),u="????";return g&&g.rank==a.rank?n?game.Lang.get(s.conditionDesc2,t):t:(u=!g||!g.rank||100<g.rank?a.rank==o?t:"????":g.rank==a.rank-1||g.rank==a.rank+1?t:"????",n?game.Lang.get(s.conditionDesc2,u):u)},getRankLength:function(e){var t=game.raceRankData.getRankInfoArrByType(e);return t&&t.length||0},getConditionDesc:function(e){var t=this.getRaceRankCfgById(e);return t?game.Lang.get(t.conditionDesc,t.condition):""},getKempPrizeList:function(e){var t=this.getFirstRankInfo(e);return t?t.getPrizeList():null},getEndTime:function(e){var t=this.targetTitleMap.get(e);if(!t||!t.cfg)return 0;var a=t.cfg.serverEnd-game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,a)},getTargetList:function(e){var t=this.getRaceRankCfgById(e);if(!t)return null;var a=this.targetMap.get(t.raceType);return a&&a.get(e)},getRankList:function(e){return game.raceRankData.getRankInfoArrByType(e)},getTopRankList:function(e){this._topRankList||(this._topRankList=[]),this._topRankList.length=0;var t=this.getRankList(e);if(!t||t.length<1)return null;for(var a=3<t.length?3:t.length,i=0;i<a;i++)this._topRankList.push(t[i]);return this._topRankList},getShowRankList:function(e){this.showList||(this.showList=[]),this.showList.length=0;var t=this.getRankList(e);return t.length<4||(this.showList=t.slice(3)),this.showList},getRankAwardList:function(e){this.rankAwardMap||(this.rankAwardMap=b8e.HashMap.get());var t=this.rankAwardMap.get(e);if(t)return t;t=[],this.rankAwardMap.set(e,t);var a=this.getRaceRankAwardCfgById(e);if(!a||a.length<1)return t;for(var i=void 0,n=void 0,s=a.length,r=0;r<s;r++)n=a[r],(i=new game.OCRankAwardInfo).setData(n),t.push(i);return t.sort(this.awardSort),t},awardSort:function(e,t){return e.startRank-t.startRank},getRankAwardInfos:function(e){var t=this.getRankAwardList(e);if(!t||t.length<1)return null;this.rankAwardInfos||(this.rankAwardInfos=[]),this.rankAwardInfos.length=0;for(var a=t.length,i=1;i<a;i++){var n=t[i];this.rankAwardInfos.push(n)}return this.rankAwardInfos},getFirstRankInfo:function(e){var t=this.getRankAwardList(e);return!t||t.length<1?null:t[0]},getIsOpen:function(){return this.openList&&0<this.openList.length},getIsOpenById:function(e){return this.targetTitleMap.get(e)},getRaceRankCfgById:function(e){return this.cfgObj1||(this.cfgObj1=b8e.createMap()),this.cfgObj1.id=e,game.RaceRankCfg.getData(this.cfgObj1)},getRaceRankCfgsByClientType:function(e){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.clientType=e,game.RaceRankCfg.getData(this.cfgObj2,!0)},getRaceRankAwardCfgById:function(e){return this.cfgObj3||(this.cfgObj3=b8e.createMap()),this.cfgObj3.id=e,game.RaceAwardCfg.getData(this.cfgObj3,!0)},getRaceRankTargetCfgById:function(e){return this.cfgObj4||(this.cfgObj4=b8e.createMap()),this.cfgObj4.id=e,game.RaceTargetCfg.getData(this.cfgObj4)},getRaceRankTargetCfgByType:function(e){return this.cfgObj5||(this.cfgObj5=b8e.createMap()),this.cfgObj5.rankId=e,game.RaceTargetCfg.getData(this.cfgObj5,!0)}});game.openCompetitionData=game.openCompetitionData||new e}(),function(){var e;e=b8e.Enum({NONE:0,SUMMON:1,SHENHUN:2,EQUIP:3,MOUNT:4,HALO:5,COST:6,RECHARGE:7,XbMount:8,XbShenhun:9,SCRATCH:10,XbFormation:12,XbProper:13,XbAoyi:14,XbHalo:15,XbWing:16,POWER:17,SHENHUN_POWER:18,MOUNT_POWER:19,AOYI_POWER:20,WING_POWER:21,HALO_POWER:22,ZHENXING_POWER:23,MIBAO:24}),b8e.RC("$$game","$$OpenCompetitionType",e)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.OPEN_COMPETITION_ALERT,game.SAE.HOME)},ipc:function(){var e=this;e.evts={Rank:{C2C_GET_RACE_RANK_INFO:e.updateRankInfo},OpenServer:{C2C_INIT_OPENSERVER:e.initOpenserver},PartnerStar:{V_UPDATE_STAR:e.updatePartner},Foster:{C2C_UPDATE_POWER:e.updateFoster,C2C_FOSTER_DATA_INIT:e.updateAllFoster},EquipForge:{C2C_UPDATE_EQUIP_POWER:e.updateEquip},PartnerEquipChange:{C2C_UPDATE_EQUIP_POWER:e.updateEquip},Back:{C2C_REMOVE_AMOUNT:e.removeAmount},Recharge:{C_RECHARGE_SUCCESS:e.updateRecharge},MainRole:{C_INIT_SERVER_DATA:e.initOpenList,C_RESET_DAILY:e.resetDaily,C_POWER_CHANGE:e.updatePower},Partner:{C_UPDATE_ACTIVE:e.updatePartner,C_INIT_DATA:e.updatePartner},PartnerChange:{C_UPDATE_BATTLE:e.updateAllFoster},ZhenXing:{C2C_SYS_DATA:e.updateZhenXing},ZhenXingLv:{C2C_UPDATE_LV:e.updateZhenXing},ZhenXingStar:{C2C_STAR_SUCCESS:e.updateZhenXing},ZhenXingActive:{C2C_UPDATE_ACTIVE:e.updateZhenXing},ZhenXingAttrItem:{C2C_UPDATE_ATTR:e.updateZhenXing},StarSoul:{C2C_UPDATE_FORMATION_AWAKE:e.updateZhenXing}},e.handels={RaceTargetResp:e.raceTargetResp}},resetDaily:function(){this.setOpenList();var e=game.openCompetitionData;if(b8e.module.isShowView(this.moduleEnum)&&!e.getIsOpen())return game.module.hide(this.moduleEnum),game.module.hide(game.ME.OCRank),void game.module.hide(game.ME.OCRankAward);if(!e.getIsOpenById(e.curSelectId)){var t=e.getTitleInfoList();t&&0<t.length&&(e.selectPage(t[0].id),this.send(this.Evts.C2V_SWITCH_PAGE),game.module.hide(game.ME.OCRank),game.module.hide(game.ME.OCRankAward))}},raceTargetResp:function(e){var t=e.readProtobuf(game.pb.RaceTargetResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.openCompetitionData;a.setTargetGet(t.id);var i=a.getRaceRankTargetCfgById(t.id);i&&a.checkAlert(i.raceType,i.rankId,!0),this.checkAllAlert(),this.send(this.Evts.C2V_GET_TAGET_AWARD_SUCCESS),this.dpt(this.Evts.C2C_RACETARGET_RESP,t),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}},notify:function(e,t){var a=this;switch(e){case a.Evts.V2C_SELECT_ID:t&&(game.openCompetitionData.selectPage(t),a.send(a.Evts.C2V_SWITCH_PAGE),a.dpt(a.Evts.C2C_REQ_RACE_RANKINFO,t));break;case a.Evts.V2C_GET_TAGET_AWARD:a.sender.RaceTargetReq(t);break;case a.Evts.V2C_SHOW_VIEW:a.checkAllAlert(!0),a.dpt(a.Evts.C2C_REQ_RACE_RANKINFO,game.openCompetitionData.curSelectId)}},triggerOpen:function(){this.initOpenList()},initOpenserver:function(e){if(e&&e.data){this.initOpenList();var t=e.data.raceTargetAwards,a=e.data.rankProgress;game.openCompetitionData.setupData(t,a),this.checkAllAlert()}},initOpenList:function(){this.initOpen||(this.initOpen=!0,this.setOpenList())},setOpenList:function(){game.openCompetitionData.setOpenList(),this.checkAllAlert(),this.send(this.Evts.C2V_UPDATE_TITLE_LIST),this.dptG(game.ActiveBarGEvts.REFRESH_BTNS)},updateRankInfo:function(){this.send(this.Evts.C2V_UPDATE_RANK_INFO)},updatePartner:function(){this.checkAlert(game.OpenCompetitionType.SUMMON)},updateAllFoster:function(){this.checkAlert(game.OpenCompetitionType.MOUNT),this.checkAlert(game.OpenCompetitionType.SHENHUN),this.checkAlert(game.OpenCompetitionType.HALO),this.checkAlert(game.OpenCompetitionType.SHENHUN_POWER),this.checkAlert(game.OpenCompetitionType.MOUNT_POWER),this.checkAlert(game.OpenCompetitionType.AOYI_POWER),this.checkAlert(game.OpenCompetitionType.WING_POWER),this.checkAlert(game.OpenCompetitionType.HALO_POWER)},updateFoster:function(e){if(e&&e.data){var t=game.NewFosterType;switch(e.data){case t.MOUNT:this.checkAlert(game.OpenCompetitionType.MOUNT),this.checkAlert(game.OpenCompetitionType.MOUNT_POWER);break;case t.SHENHUN:this.checkAlert(game.OpenCompetitionType.SHENHUN),this.checkAlert(game.OpenCompetitionType.SHENHUN_POWER);break;case t.HALO:this.checkAlert(game.OpenCompetitionType.HALO),this.checkAlert(game.OpenCompetitionType.HALO_POWER);break;case t.ZHANJI:this.checkAlert(game.OpenCompetitionType.AOYI_POWER);break;case t.WING:this.checkAlert(game.OpenCompetitionType.WING_POWER)}}},updateEquip:function(){this.checkAlert(game.OpenCompetitionType.EQUIP)},updateAmount:function(e){var t=!!e.data;game.openCompetitionData.updatePayCount(t),this.checkAlert(game.OpenCompetitionType.COST)},removeAmount:function(e){if(e&&e.data){game.openCompetitionData.updatePayCount(e.data),this.checkAlert(game.OpenCompetitionType.COST)}},updateRecharge:function(e){if(e&&e.data){var t=e.data,a=0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;game.openCompetitionData.updataRechargeMoney(a),this.checkAlert(game.OpenCompetitionType.RECHARGE)}},updatePower:function(){this.checkAlert(game.OpenCompetitionType.POWER)},updateZhenXing:function(){this.checkAlert(game.OpenCompetitionType.ZHENXING_POWER)},checkAlert:function(e){var t=b8e.module.isShowView(this.moduleEnum),a=game.openCompetitionData.checkAlertByType(e,t);a&&(this.spotAlert.alert=a)},checkAllAlert:function(e){this.spotAlert.alert=game.openCompetitionData.checkAllAlert(!!e)},checkOpen:function(){return game.moduleOpen.checkOpen(this.moduleEnum)},awardBtn:function(){game.module.show(game.ME.OCRankAward)},rankBtn:function(){game.module.show(game.ME.OCRank)}}),t=[game.ME.OCRank,game.ME.OCRankAward],a=game.Sender.extends({ipc:function(){this.msg={RaceTargetReq:this.raceTargetReq}},raceTargetReq:function(e){var t=game.pb.RaceTargetRequest;t.id=e,b8e.net.getBytes().writeProtobuf(t)}});b8e.module.registerControl(game.ME.OpenCompetition,e,game.OpenCompetitionEvts,a,t)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1421),this.setSize(601,178)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=5,e.layout.paddingTop=8,e.layout.paddingLeft=0;var t=this.extraPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(this.skin.list2),t.layout.spacingX=5,t.layout.paddingTop=8,t.layout.paddingLeft=0},setData:function(){var e=this.data;if(e&&e.cfg){var t=this.skin,a=e.cfg,i=a.startRank,n=a.endRank;t.rank_1.active=1==i,t.rank_2.active=2==i,t.rank_3.active=3==i,t.rank.active=3<i,t.rank.string=game.Lang.get(52122,i,n);var s=i==n?i:game.Lang.get(53740,i,n),r=game.openCompetitionData.getRaceRankCfgById(a.id);if(r){var o=game.Lang.get(r.conditionDesc3);t.descLab.string=game.Lang.get(53739,s,o,a.condition);var g=e.getPrizeList();this.prizeList.setData(g);var u=e.getExtraPrizeList();u&&this.extraPrizeList.setData(u)}}}})).poolCall=!0,b8e.RC("$$game","$$OCRankAwardItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1422)},init:function(){var e=this.list=new game.List;e.itemRender=game.OCTargetItem,e.addToParent(this.skin.list),e.bindEnum=game.ME.OpenCompetition,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.C2V_GET_TAGET_AWARD_SUCCESS:this.onShow()}},onShow:function(){var e=game.openCompetitionData,t=e.curSelectId,a=e.getTargetList(t);a&&0<a.length&&(a.sort(this.onSort),this.list.setData(a))},onSort:function(e,t){return e.isGet==t.isGet?e.id-t.id:e.isGet?1:-1}});b8e.module.registerView(game.ME.OCRankAward,e)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1423),this.setSize(540,95)},setData:function(){var e=this.data;if(e){var t=this.skin,a=game.ResCfg.getHead(e.isMale);t.headIcon.loadTexture(a),t.score.string=game.openCompetitionData.getScoreDesc(e.ocId,game.CCommonUtil.replaceNum(e.score,1),e,!1),t.name.string=e.name,t.rank.string=e.rank}}})).poolCall=!0,b8e.RC("$$game","$$OCRankItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1424)},init:function(){var e=this.list=new game.List;e.itemRender=game.OCRankItem,e.addToParent(this.skin.list),e.bindEnum=this.moduleEnum,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5},onShow:function(){this.curSelectId=game.openCompetitionData.curSelectId,this.updateTopModel(),this.updateMineInfo(),this.updateRankList(),this.updateTopDesc()},onHide:function(){this.clearModel()},clearModel:function(){if(!(!this.roleList||this.roleList.length<1||!this.roleDataList||this.roleDataList.length<1))for(var e=void 0,t=void 0,a=this.roleList.length,i=0;i<a;i++)(t=this.roleDataList[i])&&t.heroModel.clear(),(e=this.roleList[i])&&e.setVisible(!1)},updateTopDesc:function(){var e=game.openCompetitionData.getRaceRankCfgById(this.curSelectId);this.skin.topDesc3.string=e?game.Lang.get(e.conditionDesc3):""},updateMineInfo:function(){var e=game.openCompetitionData,t=e.getSelfRankInfo(this.curSelectId);this.skin.mineRank.string=!t||0==t.rank||100<t.rank?game.Lang.get(52119):game.Lang.get(52120,t.rank);var a=e.getConditionDesc(this.curSelectId);this.skin.rankCondition.string=game.Lang.get(52114,a)},updateRankList:function(){var e=game.openCompetitionData.getShowRankList(this.curSelectId);this.list.setData(e)},updateTopModel:function(){var e=void 0,t=this,a=game.openCompetitionData.getTopRankList(t.curSelectId);if(!a||a.length<1)for(t.clearModel(),e=0;e<3;e++)t.setEmpty(e);else{t.modelList||(t.roleList=[]),t.roleDataList||(t.roleDataList=[]);var i=void 0,n=void 0,s=void 0,r=void 0,o=a.length,g=game.CCommonUtil.replaceNum;for(e=0;e<o;e++)r=a[e],s=(s=t.roleDataList[e])||(t.roleDataList[e]=game.BaseRoleData.get(game.RoleType.Hero,e)),(i=t.roleList[e])||(i=t.roleList[e]=game.sceneRoleCreate.createUIRole(s)).addToParent(t.getComponent("modelNode_"+e)),i.setVisible(!0),s.heroModel.type=game.RoleType.Hero,s.setMale(r.isMale),s.heroModel.setSurface(r.surface),game.AvatarUtil.updateUIModel(i,1,!0),i.transition(game.RoleStateType.ACTION_IDLE),n=game.openCompetitionData.getScoreDesc(t.curSelectId,g(r.score,1),r,!1),t.getComponent("name_"+e).string=game.Lang.get(52121,r.name,n);if(o<3)for(e=2;o-1<e;e--)t.setEmpty(e),(s=t.roleDataList[e])&&s.heroModel.clear(),(i=t.roleList[e])&&i.setVisible(!1)}},setEmpty:function(e){this.getComponent("name_"+e).string=game.Lang.get(52115)}});b8e.module.registerView(game.ME.OCRank,e)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1425),this.setSize(541,141)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=30,e.layout.paddingLeft=0},setData:function(){var e=this.data;if(e&&e.cfg){var t=this.skin,a=this.cfg=e.cfg;t.getBtn.active=!e.isGet&&e.canGet,t.gotoBtn.active=!e.isGet&&!e.canGet,t.getImg.active=e.isGet;var i=e.canGet?52117:52118,n=game.CCommonUtil.replaceNum;t.curProgress.string=game.Lang.get(i,n(e.progress,1),n(a.condition,1)),t.title.string=a.name;var s=e.getPrizeList();this.prizeList.setData(s)}},getBtn:function(){this.send(game.OpenCompetitionEvts.V2C_GET_TAGET_AWARD,this.data.id)},gotoBtn:function(){if(this.cfg){var e=this.cfg,t=e.gotoME;if(e.toggle)game.module.showToggle(t,e.toggle-1);else{if(!game.moduleOpen.checkOpenWithTips(t))return;game.module.show(t)}}}})).poolCall=!0,b8e.RC("$$game","$$OCTargetItem",e)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1426),this.setSize(105,125)},setData:function(){var e=this.data;if(e&&e.cfg){var t=this.skin;t.selectImg.active=e.select,t.red_spot.active=e.isAlert,t.icon.loadTexture(game.ResCfg.getUrl(10122,e.cfg.titleImg))}},clickBtn:function(){this.send(game.RecruitEvts.V2C_SELECT_ID,this.data.id)}})).poolCall=!0,b8e.RC("$$game","$$OCTitleItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1427),this.spotAlerts={OPEN_COMPETITION_ALERT:this.updateRewRedPoint}},updateRewRedPoint:function(e){this.skin.redPoint.active=e.alert},init:function(){var e=this,t=e.targetList=new game.List;t.itemRender=game.OCRankAwardItem,t.addToParent(e.skin.list),t.bindEnum=e.moduleEnum,t.layout.paddingLeft=0,t.layout.spacingX=0,t.layout.spacingY=5;var a=e.titleList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.OCTitleItem,a.addToParent(e.skin.titleList),a.bindEnum=e.moduleEnum,a.layout.paddingLeft=0,a.layout.spacingX=10,a.layout.spacingY=0;var i=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);i.itemRender=game.PrizeListItem,i.addToParent(e.skin.prizeList),i.layout.spacingX=5,i.layout.paddingTop=8,i.layout.paddingLeft=0;var n=e.extraPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);n.itemRender=game.PrizeListItem,n.addToParent(e.skin.extraPrizeList),n.layout.spacingX=5,n.layout.paddingTop=8,n.layout.paddingLeft=0,e.roleData=game.BaseRoleData.get(game.RoleType.Hero,1),e.roleData.heroModel.type=game.RoleType.Hero,e.role=game.sceneRoleCreate.createUIRole(e.roleData),e.role.addToParent(e.skin.modelNode)},notify:function(e){switch(e){case this.Evts.C2V_SWITCH_PAGE:this.updatePage();break;case this.Evts.C2V_UPDATE_RANK_INFO:this.updateKempInfo(),this.updateMineRankInfo();break;case this.Evts.C2V_UPDATE_TITLE_LIST:this.updateTitle()}},onShow:function(){this.updateTitle(),this.updatePage(),this.send(this.Evts.V2C_SHOW_VIEW)},onHide:function(){var e=this.skin;e.kempScore.string="",e.kempName.string="",e.time.string="",e.mineRank.string="",this.role&&this.role.setVisible(!1)},updateTitle:function(){var e=game.openCompetitionData.getTitleInfoList();this.titleList.setData(e)},updatePage:function(){var e=this.skin,t=game.openCompetitionData,a=this.selectId=t.curSelectId,i=t.getKempPrizeList(a);i&&this.prizeList.setData(i);var n=t.getRaceRankCfgById(a);if(n){var s=game.Lang.get(n.conditionDesc,n.condition);e.bottomDesc1.string=game.Lang.get(52114,s),e.bottomDesc3.string=n.bottomDesc?game.Lang.get(n.bottomDesc):"",e.title.loadTexture(game.ResCfg.getUrl(10236,n.title))}this.updateKempInfo(),this.updateMineRankInfo(),this.updateTargetList(),this.updateEndTime(),this.targetList.scrollToTop()},updateTargetList:function(){var e=game.openCompetitionData,t=e.getRankAwardInfos(this.selectId);if(t&&!(t.length<1)){this.targetList.setData(t);var a=e.getRaceRankCfgById(this.selectId);if(a){var i=e.getFirstRankInfo(this.selectId);if(i){var n=game.Lang.get(a.conditionDesc3),s=game.CCommonUtil.replaceNum(i.cfg.condition,1);this.skin.scoreLab.string=game.Lang.get(53739,1,n,s);var r=i.getExtraPrizeList();r&&this.extraPrizeList.setData(r)}}}},updateKempInfo:function(){var e=this.skin,t=this.role,a=game.openCompetitionData.getKempInfo(this.selectId);if(!(e.fightNode.active=a))return e.kempScore.string="",e.kempName.string=game.Lang.get(52115),void(t&&t.setVisible(!1));e.fightLab.string=a.power,e.kempName.string=a.name,e.kempScore.string=game.openCompetitionData.getScoreDesc(this.selectId,game.CCommonUtil.replaceNum(a.score,1),a);var i=this.roleData;i.setMale(a.isMale),i.heroModel.setSurface(a.surface),game.AvatarUtil.updateUIModel(t,1,!0),t.transition(game.RoleStateType.ACTION_IDLE),t.setVisible(!0)},updateMineRankInfo:function(){var e=this.skin,t=game.openCompetitionData.getSelfRankInfo(this.selectId);e.mineRank.string=!t||0==t.rank||100<t.rank?game.Lang.get(52123):game.Lang.get(52124,t.rank)},updateEndTime:function(){var e=this;if((e.endTime=game.openCompetitionData.getEndTime(e.selectId))<game.SysTime.curTime)e.stopTime();else{var t=e.endTime-game.SysTime.curTime;e.skin.time.string=game.Lang.get(52116,b8e.TimeUtil.formatTime(t)),e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),e._timer.reset(),e._timer.start()}},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return this.stopTime(),void(e.time.string="");var t=this.endTime-game.SysTime.curTime;if(t<1)return this.stopTime(),void(e.time.string="");e.time.string=game.Lang.get(52116,b8e.TimeUtil.formatTime(t))},stopTime:function(){this._timer&&this._timer.stop()}});b8e.module.registerView(game.ME.OpenCompetition,e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_VIEW:-1,V2C_GET_AWARD:-1}),b8e.RC("$$game","$$PartnerGiftEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,cfg:null,isGet:!1,isCanGet:!1,setData:function(e,t,a){this.id=e.id,this.isGet=t,this.isCanGet=a,this.cfg=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerGiftInfo",e)}(),function(){var e=b8e.Object.extends({endTime:0,canGetCount:0,initInfos:function(){var e=this.giftInfoMap;(e=e||(this.giftInfoMap=b8e.HashMap.get())).clear();for(var t=game.miscData.openServerDay,a=(game.SysTime.curTime,game.PartnerAwardCfg.getDatas()),i=void 0,n=void 0,s=0,r=a.length;s<r;s++)t<(n=a[s]).serverStart||t>=n.serverEnd||((i=new game.PartnerGiftInfo).setData(n),e.set(n.id,i));this.calEndTime(n)},calEndTime:function(e){if(e){var t=game.miscData.openServerDay;t>=e.serverStart&&t<e.serverEnd?this.endTime=b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(e.serverEnd-t)*b8e.TimeUtil.DAY_MICRO_SECONDS:this.endTime=0}},setAllStates:function(){var i=this;i.canGetCount=0;var n=i.partnerAwards;i.giftInfoMap&&i.giftInfoMap.forEach(function(e,t){var a=game.partnerData.getInfoById(t.cfg.partnerId);t.isCanGet=a&&a.active,t.isGet=n&&-1<n.indexOf(e),t.isCanGet&&!t.isGet&&i.canGetCount++},i)},setPartnerActive:function(e){var t=game.PartnerAwardCfg.getDataByPartnerId(e);if(t&&this.giftInfoMap){var a=this.giftInfoMap.get(t.id);a&&(a.isCanGet=!0,this.canGetCount++)}},setPartnerAward:function(e){if(this.giftInfoMap){var t=this.giftInfoMap.get(e);t&&(t.isGet=!0,this.canGetCount--)}},isOpen:function(){return 0<this.endTime},getCountdown:function(){return this.endTime-game.SysTime.curTime}});game.partnerGiftData=game.partnerGiftData||new e}(),function(){var e=game.Control.extends({init:function(){this.partnerGiftSpot=game.spotAlert.set(game.SAE.PARTNER_GIFT_ALERT),this.data=game.partnerGiftData},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.syncData},Partner:{C_UPDATE_ACTIVE:this.setPartnerActive,C_INIT_DATA:this.setAllStates},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={GetPartnerAwardResp:this.onGetPartnerAwardResp}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_AWARD:this.sender.GetPartnerAwardReq(t)}},checkAlert:function(){this.partnerGiftSpot.alert=0<this.data.canGetCount},syncData:function(e){e&&e.data&&(this.data.initInfos(),this.data.partnerAwards=e.data.partnerAwards,this.data.setAllStates(),this.checkAlert(),this.dptG(game.ActiveBarGEvts.REFRESH_BTNS))},setAllStates:function(){this.data.setAllStates(),this.checkAlert(),this.dptG(game.ActiveBarGEvts.REFRESH_BTNS)},setPartnerActive:function(e){if(e&&e.data){this.data.setPartnerActive(e.data),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW)}},resetDaily:function(){this.data.initInfos();this.data.setAllStates(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW),this.data.endTime<1&&game.module.hide(game.ME.PartnerGift),this.dptG(game.ActiveBarGEvts.REFRESH_BTNS)},onGetPartnerAwardResp:function(e){var t=e.readProtobuf(game.pb.GetPartnerAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.data.setPartnerAward(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}}}),t=game.Sender.extends({ipc:function(){this.msg={GetPartnerAwardReq:this.getPartnerAwardReq}},getPartnerAwardReq:function(e){var t=game.pb.GetPartnerAwardRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.PartnerGift,e,game.PartnerGiftEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("partnerGift/PartnerGiftItem"),this.setSize(604,200)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.layout.paddingLeft=20,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=0,e.layout.spacingY=0,e.addToParent(this.skin.list),e.touchMovable=!1,this.partnerIcon=new game.CultivateBaseIcon,this.partnerIcon.addToParent(this.skin.partnerNode),this.partnerData=game.RecruitPreviewInfo.get()},setData:function(){var e=this.data,t=e.cfg,a=this.skin,i=game.PartnerCfg.getData(t.partnerId);if(i){var n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);a.desc.string=game.Lang.get(52101,n),this.partnerData.setData(t.partnerId),this.partnerIcon.setData(this.partnerData)}else a.desc.string="";a.acceptedBtn.active=!1,a.receiveBtn.active=!1,a.gotoBtn.active=!1,a.redPoint.active=!1,e.isCanGet?e.isGet?(a.acceptedBtn.active=!0,a.owned.active=!0):(a.owned.active=!0,a.receiveBtn.active=!0,a.redPoint.active=!0):(a.gotoBtn.active=!0,a.owned.active=!1),a.gotoLab.string=t.desc;var s=game.CfgUtil.getPrizeListInfo(t.award,game.IconLayoutEnum.SHOW_ALL);s&&this.prizeList.setData(s.items)},receiveBtn:function(){var e=this.data;e&&e.isCanGet&&this.send(game.PartnerGiftEvts.V2C_GET_AWARD,this.data.id)},gotoBtn:function(){var e=this.data.cfg;0<e.moduleId&&game.module.show(e.moduleId)},partnerBtn:function(){var e=this.data.cfg;game.partnerData.setShowInfo(e.partnerId),game.module.show(game.ME.PartnerDetails)}}),b8e.RC("$$game","$$PartnerGiftItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partnerGift/PartnerGiftView")},init:function(){var e=this,t=e.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.PartnerGiftItem,t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=0,t.layout.spacingX=0,t.bindEnum=game.ME.PartnerGift,t.addToParent(e.skin.list),t.setScrollViewCb(e.listCb,e),e.banner=b8e.Sprite.get(),e.banner.setAnchor(0,1),e.banner.loadTexture(game.ResCfg.getUrl(10124)),e.banner.addToParent(e.skin.bannerNode),e.timer=b8e.Timer.add(e,e.updateTime,1e3)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView()}},listCb:function(e,t,a){var i=0,n=null,s=!1;if(s=0<(i=e.length),this.skin.viewUpBtn.active=s)for(var r=0;r<i;r++)if((n=e[r]).isCanGet&&!n.isGet){!0;break}if(s=0<(i=a.length),this.skin.viewDownBtn.active=s)for(var o=0;o<i;o++)if((n=a[o]).isCanGet&&!n.isGet){!0;break}},onShow:function(){this.updateView(),this.list.scrollToTop()},updateView:function(){var e=game.partnerGiftData.giftInfoMap.values();e&&1<e.length&&e.sort(this._sort),this.list.setData(e),this.endTime=game.partnerGiftData.endTime,this.timer&&this.timer.start(),this.itemCount=e.length,this.itemMaxCount=e.length,this.updateTime()},updateTime:function(){var e=this.skin,t=this.endTime-game.SysTime.curTime,a=game.TimeUtil.formatTimeSpace(t,3);e.timeLab.string=game.Lang.get(52100,a)},viewUpBtn:function(){var e=this.list.getContainer(),t=e.height-this.list.height,a=e.y,i=3*(200+this.list.layout.spacingY),n=t-(a-=a%i%200)+i;this.list.scrollToBottom(-n,200)},viewDownBtn:function(){var e=this.list.getContainer(),t=e.height-this.list.height,a=e.y,i=3*(200+this.list.layout.spacingY),n=t-(a-=a%i%200)-i;this.list.scrollToBottom(-n,200)},onHide:function(){this.timer&&this.timer.stop()},_sort:function(e,t){return e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.id-t.id},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(e-this.width>>1,t-52)}});b8e.module.registerView(game.ME.PartnerGift,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_GET_PRIZE:b8e.enc(),C2V_UPDATE_VIEW:b8e.enc(),C2C_UPDATE_OPEN:b8e.enc()}),b8e.RC("$$game","$$RecruitRebateEvts",e)}(),function(){var e=b8e.Object.extends({recuitScore:0,ctor:function(){this._super(),this.infoMap=b8e.HashMap.get(),this.awardArr=[]},getInfoArr:function(){return this.infoMap.values()},getInfoById:function(e){return this.infoMap.get(e)},onSysData:function(e,t){this.recuitScore=e.recruitRebateScore,this.awardArr=e.recruitRebateAwards,this.group=t,this.createInfoMap()},resetDaily:function(e){this.recuitScore=0,this.awardArr.length=0,this.group=e,this.createInfoMap()},createInfoMap:function(){var e=game.RecruitRebateCfg.getData(this.group,!0);if(e&&!(e.length<1))for(var t=e.length,a=this.infoMap,i=void 0,n=0;n<t;n++)(i=new game.RecruitRebateInfo).setData(e[n]),a.set(i.id,i)},isGetAll:function(){var e=this.getInfoArr();return this.awardArr.length>=e.length},getOpenGroup:function(){for(var e=this.getMaxGroup(),t=void 0,a=game.miscData.openServerDay,i=1;i<=e;i++)if((t=this.getGroupFirstCfg(i))&&t.serverStart<=a&&a<t.serverEnd)return this.endDay=t.serverEnd,t.group;return 0},getGroupFirstCfg:function(e){this.gObj||(this.gObj={});var t=this.gObj;return t.id=1,t.group=e,game.RecruitRebateCfg.getData(t)},getMaxGroup:function(){if(!this.maxGroup){var e=game.OpenServiceMiscCfg.getData("recruitRebateGroup");e&&(this.maxGroup=0|e.value)}return this.maxGroup},onGetAward:function(e){this.getInfoById(e).updateCondition()},updateCondition:function(){for(var e=this.getInfoArr(),t=e.length,a=0;a<t;a++)e[a].updateCondition()},addAward:function(e){this.awardArr.push(e)},isHadGet:function(e){return-1<this.awardArr.indexOf(e)},updateRecuitScore:function(e){this.recuitScore+=e},getRecuitScore:function(){return this.recuitScore},checkAlert:function(){for(var e=this.getInfoArr(),t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},getSortInfoArr:function(){return this.getInfoArr().sort(this.sortFunc)},sortFunc:function(e,t){return!e.isHadGet&&t.isHadGet?-1:e.isHadGet&&!t.isHadGet?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.id-t.id},getCountdown:function(){var e=this.endDay,t=game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,e-t)-game.SysTime.curTime}});game.recruitRebateData=game.recruitRebateData||new e}(),function(){var e;e=b8e.Object.extends({isEnough:!1,isHadGet:!1,canGet:!1,myScore:0,setData:function(e){this.cfg=e,this.id=e.id,this.score=e.score,this.setAwardList(),this.updateCondition()},setAwardList:function(){for(var e=this.cfg.award,t=void 0,a=void 0,i=e.length,n=this.prizeList=[],s=0;s<i;s++)t=e[s],(a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,n.push(a)},updateCondition:function(){var e=game.recruitRebateData;this.isHadGet=e.isHadGet(this.id),this.myScore=e.getRecuitScore(),this.isEnough=this.myScore>=this.score,this.canGet=this.isEnough&&!this.isHadGet},getAwardList:function(){return this.prizeList}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RecruitRebateInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.recruitAlert=game.spotAlert.set(game.SAE.RECRUIT_REBATE,game.SAE.OPEN_SERVER_ALERT),this.data=game.recruitRebateData},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.onSysData},MainRole:{C_RESET_DAILY:this.resetDaily},Recruit:{C2C_UPDATE_FANLI_SCORE:this.updateRecuitScore}},this.handels={RecruitRebateAwardResp:this.onRecruitRebateAwardResp}},notify:function(e,t){switch(e){case this.Evts.V2C_GET_PRIZE:this.getPrize(t)}},updateOpen:function(e){this.openObj||(this.openObj={});var t=this.openObj;t.openServerType=game.OpenServerType.RECRUIT_REBATE,t.isActive=e,t.sae=game.SAE.RECRUIT_REBATE,this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,t),this.dpt(this.Evts.C2C_UPDATE_OPEN)},onSysData:function(e){var t=e?e.data:null;if(t){var a=this.data,i=a.getOpenGroup();if(i){a.onSysData(t,i),this.checkAlert();var n=a.isGetAll(),s=i&&!n;this.updateOpen(s)}}},resetDaily:function(){var e=this.data,t=e.group,a=e.getOpenGroup(),i=0<a;i&&t!=a&&(e.resetDaily(a),this.send(this.Evts.C2V_UPDATE_VIEW)),this.updateOpen(i)},onRecruitRebateAwardResp:function(e){var t=e.readProtobuf(game.pb.RecruitRebateAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.data;a.addAward(t.id),a.onGetAward(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW),a.isGetAll()&&this.updateOpen(!1),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}},updateRecuitScore:function(e){var t=e?e.data:null;if(t){var a=game.recruitData.getBaseCfgById(t);a&&(this.data.updateRecuitScore(a.score),this.data.updateCondition(),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW))}},checkAlert:function(){var e=this.data.checkAlert();this.recruitAlert.alert=e},getPrize:function(e){if(this.data.getInfoById(e).canGet)this.sender.RecruitRebateAwardReq(e);else{if(1e3==game.taskData.getTaskId())return void game.module.show(game.ME.RecruitSubA);game.module.toggleShow(game.ME.RecruitMain)}}}),t=game.Sender.extends({ipc:function(){this.msg={RecruitRebateAwardReq:this.recruitRebateAwardReq}},recruitRebateAwardReq:function(e){var t=game.pb.RecruitRebateAwardRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.RecruitRebate,e,game.RecruitRebateEvts,t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1382),this.setSize(601,177)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=6,e.layout.paddingTop=-5,e.layout.spacingX=15},setData:function(){var e=this.skin,t=this.data,a=t.getAwardList();this.prizeList.setData(a);var i=t.cfg.score;e.nameLab.string=game.Lang.get(51843,i),e.getBtn.active=!t.isHadGet,e.countLab.active=!t.isHadGet,e.hasGet.active=t.isHadGet;var n=t.canGet,s=n?51844:51845;e.btn_lbl.string=game.Lang.get(s);var r=n?51815:51816;e.countLab.string=game.Lang.get(r,t.myScore,i),e.redPoint.active=n},getBtn:function(){this.send(game.RecruitRebateEvts.V2C_GET_PRIZE,this.data.id)}}),b8e.RC("$$game","$$RecruitRebateItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1381)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.RecruitRebateItem,e.bindEnum=this.moduleEnum,e.layout.spacingY=5,e.layout.paddingTop=8,e.layout.paddingLeft=5,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateList(),this.createTimer()}},onShow:function(){this.updateList(),this.createTimer()},updateList:function(){var e=game.recruitRebateData.getSortInfoArr();!e||e.length<1||this.list.setData(e)},createTimer:function(){this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=game.recruitRebateData.getCountdown();if(e<0)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.time.string=t}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.RecruitRebate,e)}(),function(){var e;e=b8e.Enum({None:0,C_UPDATE_DATA:-1,V_UPDATE_VIEW:-1,V_UPDATE_LIST:-1,C_ISGET_STATE:-1,C_CARRY_STATE:-1,V_UPDATE_CASH_LIST:-1}),b8e.RC("$$game","$$QqRedPacketEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.qqRedPacketData,this.taskTypeEnum=game.QqRedPacketTaskType,this.spotAlert=game.spotAlert.set(game.SAE.QQ_REDPACKET)},ipc:function(){var e=this;e.evts={Welfare:{C_INIT_MODEL:e.initOpen},MainRole:{C_RESET_DAILY:e.resetDaily,C_LEVEL_UP:e.updateLevel},Recharge:{C_RECHARGE_SUCCESS:e.updateMoney},MainInstance:{C2C_CHALLENGE_WIN:e.updateMainTask},ZhaoQin:{C2C_UPDATE_AUTOFIGHT:e.updateZhaoqin},PublicBoss:{C2C_UPDATE_FINISH_COUNT:e.updatePublicBoss},Relation:{C_FOLLOW_CHANGE:e.updateRelation}},e.handels={QQHbServerDataResp:e.qQHbServerDataResp,QQHbTaskResp:e.qQHbTaskResp,QQHbCashResp:e.qQHbCashResp,QQHbCashLogResp:e.qQHbCashLogResp}},qQHbServerDataResp:function(e){var t=e.readProtobuf(game.pb.QQHbServerDataResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setTaskCompleteNum(t.taskDatas),this.moduleData.setCashCompleteNum(t.cashDatas),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_VIEW),this.send(this.Evts.V_UPDATE_CASH_LIST))},qQHbTaskResp:function(e){var t=e.readProtobuf(game.pb.QQHbTaskResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.setTaskComplete(t.id);var a=this.moduleData.getTaskIdInfo(t.id);this.moduleData.totalMoney+=a.money,this.moduleData.checkCash(),this.checkSpotAlert(),this.send(this.Evts.V_UPDATE_LIST)}},qQHbCashResp:function(e){var t=this,a=e.readProtobuf(game.pb.QQHbCashResponse);if(0<a.code)game.notice.noticeError(a.code);else{t.moduleData.cashLimit&&(t.moduleData.limitReceive=!1),t.moduleData.setCashComplete(a.id);var i=t.moduleData.getCashIdInfo(a.id);t.moduleData.cashMoney+=i.money,t.moduleData.checkCash(),t.checkSpotAlert(),t.send(t.Evts.V_UPDATE_CASH_LIST),t.send(t.Evts.V_UPDATE_LIST)}},qQHbCashLogResp:function(e){var t=e.readProtobuf(game.pb.QQHbCashLogResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setCashLog(t.logs),this.send(this.Evts.V_UPDATE_VIEW))},initOpen:function(e){if(this.moduleData.getIsOpen()){var t=e.data;this.moduleData.setData(t),this.moduleData.initData(),this.checkSpotAlert()}},notify:function(e,t){switch(e){case this.Evts.C_UPDATE_DATA:this.sender.QQHbServerDataReq(),this.sender.QQHbCashLogReq();break;case this.Evts.C_ISGET_STATE:this.sender.QQHbTaskReq(t);break;case this.Evts.C_CARRY_STATE:this.moduleData.limitReceive?this.sender.QQHbCashReq(t):game.notice.show(52268)}},updateDay:function(){this.updateProcess(this.taskTypeEnum.LOGIN_DAY)},updateMoney:function(){this.moduleData.checkCash(),this.updateProcess(this.taskTypeEnum.DAY_RECHARGE)},updateLevel:function(){this.updateProcess(this.taskTypeEnum.LEVE)},updateMainTask:function(){this.updateProcess(this.taskTypeEnum.MAIN_INS)},updateZhaoqin:function(){this.moduleData.zhaoQinCount++,this.updateProcess(this.taskTypeEnum.ZHAOQIN)},updatePublicBoss:function(){this.updateProcess(this.taskTypeEnum.PUBLIC_BOSS)},updateRelation:function(){this.updateProcess(this.taskTypeEnum.RELATION_NUM)},updateProcess:function(e){this.moduleData.updateTaskProcess(e),this.checkSpotAlert()},checkSpotAlert:function(){var e=this.moduleData.getDayTaskInfoList();if(e){for(var t=e.length,a=void 0,i=!1,n=this.moduleData.getCashAlert(),s=0;s<t&&(a=e[s]);s++)a.setAlert(),a.alert&&(i=!0);this.spotAlert.alert=i||n}},resetDaily:function(){this.moduleData.resetData(),this.moduleData.getIsOpen()&&this.updateTaskDaily(),game.module.hide(game.ME.QqRedPacket),game.module.hide(game.ME.QqRedPacketCarry)},updateTaskDaily:function(){var e=this.moduleData.days;if(e){var t=game.miscData.openServerDay,a=e.indexOf(t);if(-1!=a){var i=e[a],n=this.moduleData.getDayTaskInfo(i);if(n){var s=n.getDayInfoList();if(s){for(var r=s.length,o=void 0,g=0;g<r;g++)o=s[g],this.moduleData.updateTaskProcess(o.type);this.checkSpotAlert()}}}else this.moduleData.updateTaskProcess(this.taskTypeEnum.DAY_RECHARGE)}},btn_tixian:function(){game.module.show(game.ME.QqRedPacketCarry),this.sender.QQHbServerDataReq()},rightBtn:function(){var e=this.moduleData.days;if(e){var t=e.indexOf(this.moduleData.selectDay+1);-1!=t&&(this.moduleData.selectDay=e[t],this.send(this.Evts.V_UPDATE_LIST))}},leftBtn:function(){var e=this.moduleData.days;if(e){var t=e.indexOf(this.moduleData.selectDay-1);-1!=t&&(this.moduleData.selectDay=e[t],this.send(this.Evts.V_UPDATE_LIST))}}}),t=[game.ME.QqRedPacketCarry],a=game.Sender.extends({ipc:function(){this.msg={QQHbServerDataReq:null,QQHbTaskReq:this.qQHbTaskReq,QQHbCashReq:this.qQHbCashReq,QQHbCashLogReq:null}},qQHbTaskReq:function(e){var t=game.pb.QQHbTaskRequest;t.id=e,this.write(t)},qQHbCashReq:function(e){var t=game.pb.QQHbCashRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.QqRedPacket,e,game.QqRedPacketEvts,a,t)}(),function(){var e;e=b8e.Object.extends({id:0,cfg:null,numLimit:0,loginDays:0,rechargeLimit:0,money:0,isGet:!1,canGet:!1,cashNum:0,name:"",isSpeed:!1,isAll:!1,serverStar:0,serverEnd:0,ctor:function(){},setData:function(e){var t=this;t.cfg=e,t.id=e.id,t.money=e.money,t.numLimit=e.numLimit,t.loginDays=e.loginDays,t.rechargeLimit=e.rechargeLimit,t.name=e.name,t.isSpeed=e.speed,t.serverEnd=e.serverEnd,t.serverStar=e.serverStar},updateDayCash:function(){game.miscData.openServerDay},updateCarryCashNum:function(e){this.cashNum=e,0<this.numLimit&&!this.isGet&&this.cashNum==this.numLimit&&(this.updateCashComplete(),this.isAll=!0)},updateCashComplete:function(){this.isGet=!0,this.canGet=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$QqRedPacketCashInfo",e)}(),function(){var e=b8e.Object.extends({totalMoney:0,cashMoney:0,qqhbTaskRecords:null,qqhbCashRecords:null,selectDay:0,days:null,zhaoQinCount:0,endDay:0,limitReceive:!0,isInit:!1,cashLimit:!1,ctor:function(){this.qqhbTaskRecords=[],this.qqhbCashRecords=[],this.qqhbLogArr=[],this.listArr=[],this.qqhbTaskTypeMp=b8e.HashMap.get(),this.qqhbInfoMp=b8e.HashMap.get(),this.qqhbCashMp=b8e.HashMap.get(),this.qqhbTaskDayMp=b8e.HashMap.get()},setData:function(e){this.totalMoney=e.qqhbTotalMoney,this.cashMoney=e.qqhbCashMoney,this.qqhbTaskRecords=e.qqhbTaskRecords,this.qqhbCashRecords=e.qqhbCashRecords},initData:function(){this.zhaoQinCount=game.InsFunCountData.getChallengeCount(12),this.initTaskData(),this.initCashData()},setCashComplete:function(e){var t=this.getCashIdInfo(e);t&&(t.updateCashComplete(),0<t.numLimit&&t.cashNum++)},setTaskComplete:function(e){var t=this.getTaskIdInfo(e);t&&t.updateTaskComplete()},checkCash:function(){var e=this.totalMoney-this.cashMoney,t=this.getCashInfoList();if(t)for(var a=void 0,i=t.length,n=game.miscData.loginDay,s=game.rechargeData.rechargeMoneyDaily,r=0;r<i;r++)(a=t[r]).isGet||(a.canGet=e>=a.money,0<a.loginDays&&(a.canGet=n>=a.loginDays&&a.canGet),0<a.rechargeLimit&&(a.canGet=s>=a.rechargeLimit&&a.canGet))},getCashIdInfo:function(e){return this.qqhbCashMp.get(e)},getCashInfoList:function(){return this.qqhbCashMp.values()},getTaskIdInfo:function(e){return this.qqhbInfoMp.get(e)},getDayTaskInfo:function(e){return this.qqhbTaskDayMp.get(e)},getDayTaskInfoList:function(){return this.qqhbTaskDayMp.values()},getQQhbLogList:function(){return this.qqhbLogArr.length<1?0:this.qqhbLogArr},resetData:function(){var e=this;if(e.limitReceive=!0,!e.getIsOpen())return e.qqhbTaskRecords.length=0,e.qqhbCashRecords.length=0,e.qqhbLogArr.length=0,e.qqhbTaskTypeMp.clear(),e.qqhbInfoMp.clear(),e.qqhbCashMp.clear(),e.qqhbTaskDayMp.clear(),e.endDay=0,void(e.limitReceive=!1);e.qqhbCashMp.clear(),e.initCashData()},setTaskCompleteNum:function(e){if(!(e<1))for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++){if(a=e[n],!(i=this.getTaskIdInfo(a.id)))return;i.updateTaskNum(a.num)}},setCashCompleteNum:function(e){if(!(e<1))for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++){if(a=e[n],!(i=this.getCashIdInfo(a.id)))return;i.updateCarryCashNum(a.num)}},getCashDayList:function(){var e=game.QQHbCashCfg.getDatas();if(!e)return null;for(var t=e.length,a=game.miscData.openServerDay,i=this.listArr.length=0;i<t;i++){var n=e[i];a>=n.serverStar&&a<n.serverEnd&&this.listArr.push(n)}return this.listArr},initCashData:function(){var e=this.getCashDayList();if(e)for(var t=e.length,a=void 0,i=this.totalMoney-this.cashMoney,n=game.miscData.loginDay,s=game.rechargeData.rechargeMoneyDaily,r=0;r<t;r++){var o=e[r];if(!o)return;(a=new game.QqRedPacketCashInfo).setData(o),this.qqhbCashMp.set(o.id,a),-1<this.qqhbCashRecords.indexOf(a.cfg.id)&&(a.isGet=!0,a.canGet=!1),a.isGet||(a.canGet=i>=a.money,0<a.loginDays&&(a.canGet=n>=a.loginDays&&a.canGet),0<a.rechargeLimit&&(a.canGet=s>=a.rechargeLimit&&a.canGet))}},setCashLog:function(e){if(e){this.clearList(this.qqhbLogArr);for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)i=e[n],(a=game.QqRedPacketLogInfo.get()).setData(i),this.qqhbLogArr.push(a)}},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},initTaskData:function(){var e=this,t=e.getCurOpenCfg();if(t){var a=t.days.length;e.days=t.days;for(var i=game.miscData.openServerDay,n=void 0,s=0;s<a;s++){var r=t.days[s];n=new game.QqRedPacketDayInfo,e.qqhbTaskDayMp.set(r,n),n.initData(r)}-1==e.days.indexOf(i)?e.selectDay=e.days[e.days.length-1]:e.selectDay=e.days[e.days.indexOf(i)]}},initTaskState:function(e){-1<this.qqhbTaskRecords.indexOf(e.cfg.id)&&(e.isGet=!0,e.canGet=!1);var t=e.type,a=this.getqqTaskProcess(t,e);e.updateProcess(a||0)},updateTaskProcess:function(e){var t=this.qqhbTaskTypeMp.get(e);if(t)for(var a=t.length,i=void 0,n=void 0,s=0;s<a;s++){if(!(i=t[s]))return;n=this.getqqTaskProcess(e,i),i.updateProcess(n)}},getqqTaskProcess:function(e,t){var a=game.QqRedPacketTaskType,i=0;switch(e){case a.LOGIN_DAY:i=game.miscData.loginDay;break;case a.DAY_RECHARGE:i=game.rechargeData.rechargeMoneyDaily;break;case a.LEVE:i=game.mainRoleData.lv;break;case a.MAIN_INS:i=game.mainInstanceData.id;break;case a.ZHAOQIN:i=this.zhaoQinCount;break;case a.PUBLIC_BOSS:i=game.publicBossData.getCount();break;case a.RELATION_NUM:i=game.relationData.getTabTypeMap(game.RelationTabType.FOLLOW)._count;break;default:i=this.taskProcessMap.get(t.type)}return i||0},leftIsAlert:function(){var e=this.getDayTaskInfoList();if(!e)return!1;for(var t=void 0,a=e.length,i=0;i<a;i++){if(!(t=e[i]))return!1;if(!(this.selectDay<=t.day)&&t.alert)return!0}return!1},rightIsAlert:function(){var e=this.getDayTaskInfoList();if(!e)return!1;for(var t=void 0,a=e.length,i=0;i<a;i++){if(!(t=e[i]))return!1;if(!(this.selectDay>=t.day)&&t.alert)return!0}return!1},getCashAlert:function(){var e=this.getCashInfoList();if(!e)return!1;for(var t=e.length,a=void 0,i=0;i<t;i++){if(!(a=e[i]))return!1;if(a.canGet)return!0}return!1},isChannelId:function(e){if(!e)return!1;var t=e.gameChannelId;if(!t||t.length<1)return!0;var a=+game.LoginConfig.gameChannelId;return-1<t.indexOf(a)},getCurOpenCfg:function(){var e=game.QQHbOpenCfg.getDatas();if(!e)return null;for(var t=e.length,a=void 0,i=0;i<t;i++){if(!(a=e[i]))return 0;if(this.checkIsOpen(a))return 0==this.endDay&&(this.endDay=a.serverEnd,this.cashLimit=a.cashLimit),a}return null},getIsOpen:function(){return(!b8e.isWeChatGame||b8e.weChatEnv==b8e.WeChatEnv.RELEASE)&&!!this.getCurOpenCfg()},getCountDown:function(){var e=this.endDay,t=game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,e-t)-game.SysTime.curTime},checkIsOpen:function(e){if(!this.isChannelId(e))return!1;var t=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),a=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),i=game.SysTime.curTime;if(i<t||a<=i)return!1;var n=e.serverStart,s=e.serverEnd,r=game.miscData.openServerDay;return n<=r&&r<s}});game.qqRedPacketData=game.qqRedPacketData||new e}(),function(){var e;e=b8e.Object.extends({day:0,alert:!1,ctor:function(){this.qqhbTaskDayMp=b8e.HashMap.get()},initData:function(e){this.day=e;var t=game.QQHbTaskCfg.getData(e,!0);if(t)for(var a=game.qqRedPacketData,i=t.length,n=void 0,s=void 0,r=0;r<i;r++){if(!(s=t[r]))return;var o=s.taskType;s.serverStart==e&&((n=new game.QqRedPacketInfo).setData(s),a.qqhbInfoMp.set(s.id,n)),a.initTaskState(n);var g=a.qqhbTaskTypeMp.get(o);g||(g=[],a.qqhbTaskTypeMp.set(o,g)),g.push(n),this.qqhbTaskDayMp.set(s.id,n)}},getDayInfoList:function(){return this.qqhbTaskDayMp.values()},setAlert:function(){var e=this.getDayInfoList();if(e){for(var t=e.length,a=0;a<t;a++)if(e[a].canGet)return void(this.alert=!0);this.alert=!1}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$QqRedPacketDayInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,type:0,cfg:null,isGet:!1,canGet:!1,taskNum:0,name:null,condition:0,process:0,isSpeed:!1,isNumLimit:!1,ctor:function(){},setData:function(e){this.cfg=e,this.type=e.taskType,this.condition=e.condition,this.name=e.name,this.money=e.money,this.isSpeed=e.speed,this.id=e.id,this.numLimit=e.numLimit},updateProcess:function(e){var t=game.miscData.openServerDay;this.process=e,this.isGet||(t>=this.cfg.serverStart&&t<this.cfg.serverEnd?this.canGet=!this.isGet&&e>=this.cfg.condition:this.canGet=!1)},updateTaskNum:function(e){this.taskNum=e,0<this.numLimit&&!this.isGet&&this.taskNum==this.numLimit&&(this.updateTaskComplete(),this.isNumLimit=!0)},updateTaskComplete:function(){this.isGet=!0,this.canGet=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$QqRedPacketInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",money:0,ctor:function(){},setData:function(e){this.name=e.name,this.money=e.money},recycle:function(){this.reset(),this._super()},reset:function(){this.name="",this.money=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$QqRedPacketLogInfo",t)}(),function(){var e;e=b8e.Enum({$$NONE:0,$$LOGIN_DAY:1,$$DAY_RECHARGE:2,$$LEVE:3,$$MAIN_INS:4,$$ZHAOQIN:5,$$PUBLIC_BOSS:6,$$RELATION_NUM:7}),b8e.RC("$$game","$$QqRedPacketTaskType",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1440),this.setSize(559,76)},setData:function(e){var t=this.skin;e.isSpeed?t.name.string=e.canGet?game.Lang.get(52257,e.name,e.cashNum,e.numLimit):game.Lang.get(52258,e.name,e.cashNum,e.numLimit):t.name.string=e.name,t.num.string=game.Lang.get(52259,e.money/100),t.not_btn.active=!e.canGet&&!e.isGet,t.canGetBtn.active=e.canGet&&!e.isGet,t.isGetLab.string=e.isAll?game.Lang.get(52267):game.Lang.get(1353)},canGetBtn:function(){this.send(game.QqRedPacketEvts.C_CARRY_STATE,this.data.id)}}),b8e.RC("$$game","$$QqRedPacketCarryItme",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1442),this.setSize(479,77)},setData:function(e){var t=this.skin;e.isSpeed?0<e.numLimit?t.taskName.string=e.canGet?game.Lang.get(52265,e.name,e.process,e.condition,e.numLimit,e.taskNum,e.numLimit):game.Lang.get(52266,e.name,e.process,e.condition,e.numLimit,e.taskNum,e.numLimit):t.taskName.string=e.canGet?game.Lang.get(52257,e.name,e.process,e.condition):game.Lang.get(52258,e.name,e.process,e.condition):t.taskName.string=e.name,t.num.string=game.Lang.get(52259,e.money/100),t.not_btn.active=!e.canGet&&!e.isGet,t.canGet_btn.active=e.canGet&&!e.isGet,t.goTo.active=e.type==game.QqRedPacketTaskType.DAY_RECHARGE,t.isGetLab.string=e.isNumLimit?game.Lang.get(52267):game.Lang.get(1353)},canGet_btn:function(){this.send(game.QqRedPacketEvts.C_ISGET_STATE,this.data.id)},goTo:function(){game.module.hide(game.ME.QqRedPacket),game.module.hide(game.ME.QqRedPacketCarry),game.module.show(this.data.cfg.moduleId)}}),b8e.RC("$$game","$$QqRedPacketItme",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1443),this.setSize(260,25)},setData:function(e){var t=this.skin;t.name.string=e.name,t.carry.string=game.Lang.get(52255,e.money/100)}}),b8e.RC("$$game","$$QqRedPacketLogItme",e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1441)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.QqRedPacketItme,t.addToParent(e.list),t.bindEnum=this.moduleEnum;var a=this.list_text=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.QqRedPacketLogItme,a.addToParent(e.list_text),a.bindEnum=this.moduleEnum,a.touchMovable=!1,this.moduleData=game.qqRedPacketData},notify:function(e){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateListLog(),this.updateList();break;case this.Evts.V_UPDATE_LIST:this.updateList()}},onShow:function(){var e=this,t=game.miscData.openServerDay,a=e.moduleData.days.indexOf(t),i=e.moduleData.days;e.moduleData.selectDay=-1==a?i[i.length-1]:i[a],e.send(e.Evts.C_UPDATE_DATA),e.timer||(e.timer=b8e.Timer.add(e,e.updateActTime,1e3))},updateListLog:function(){var e=this.moduleData.getQQhbLogList();this.list_text.setData(e),3<e.length&&this.setListTime(e.length)},setListTime:function(e){this.scrollY=-30,this.list_text.scrollToTop(0),this.patrolTime=game.SysTime.curTime+1500*e,this.patrolTimer?(this.patrolTimer.reset(),this.patrolTimer.start()):this.patrolTimer=b8e.Timer.add(this,this.updateTimer,50)},updateActTime:function(){var e=this.moduleData.getCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.time.string=game.Lang.get(51819,t)):(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateTimer:function(){if(0<this.patrolTime-game.SysTime.curTime)this.scrollY+=1,this.list_text.scrollToBottom(this.scrollY);else if(this.patrolTimer){this.patrolTimer.stop();var e=this.moduleData.getQQhbLogList();if(!e||e.length<1)return void this.clearPatrolTimer();this.setListTime(e.length)}},onHide:function(){this.clearTimer(),this.clearPatrolTimer()},clearPatrolTimer:function(){this.patrolTimer&&(b8e.Timer.remove(this,this.updateTimer),this.patrolTimer=null)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateList:function(){var e=this,t=e.skin,a=e.moduleData.selectDay,i=e.moduleData.getDayTaskInfo(a).getDayInfoList();e.list.setData(i),e.skin.day.string=game.Lang.get(52260,a),t.isGet_lab.string=game.Lang.get(52254,e.moduleData.totalMoney/100),t.isCarry_lab.string=game.Lang.get(52253,e.moduleData.cashMoney/100),t.leftBtn.active=-1!=e.moduleData.days.indexOf(a-1),t.rightBtn.active=-1!=e.moduleData.days.indexOf(a+1),t.redPoint1.active=e.moduleData.rightIsAlert(),t.redPoint2.active=e.moduleData.leftIsAlert(),t.redPoint3.active=e.moduleData.getCashAlert()}});b8e.module.registerView(game.ME.QqRedPacket,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1439)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.QqRedPacketCarryItme,t.addToParent(e.list),t.bindEnum=game.ME.QqRedPacket,t.layout.paddingTop=0,t.layout.spacingX=8,t.layout.spacingY=4,this.moduleData=game.qqRedPacketData},notify:function(e){switch(e){case this.Evts.V_UPDATE_CASH_LIST:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.moduleData.getCashInfoList();this.list.setData(e);var t=(this.moduleData.totalMoney-this.moduleData.cashMoney)/100;this.skin.num.string=game.Lang.get(52256,t)}});b8e.module.registerView(game.ME.QqRedPacketCarry,e)}(),function(){var e;e=b8e.Enum({None:0,V_TOGGLECHANGE:b8e.enc(),C2V_SAVE_DATA_UPDATE:b8e.enc(),C2V_TASK_DATA_UPDATE:b8e.enc(),C2V_JIN_SEL_CHANGE:b8e.enc(),C2V_YIN_SEL_CHANGE:b8e.enc(),C2V_DAY_REFRESH:b8e.enc(),C2V_PROGRESS_REFRESH:b8e.enc()}),b8e.RC("$$game","$$CoffersEvts",e)}(),function(){var e=game.View.extends({_showModel:!0,isSave:!0,proImgMax:402,isFirstLoad:!1,ctor:function(){this._super("coffers/CoffersView"),this.toggles={btn1_selectd:null,btn2_selectd:null},this.spotAlerts={COFFERS_SAVE_JIN:this.jinBtnAlert,COFFERS_SAVE_YIN:this.yinBtnAlert,COFFERS_TASK:this.taskBtnAlert}},jinBtnAlert:function(e){this.skin.redPoint1.active=e.alert},yinBtnAlert:function(e){this.skin.redPoint2.active=e.alert},taskBtnAlert:function(e){this.skin.task_red.active=e.alert},init:function(){this.data=game.coffersData},onShow:function(){var e=this;e.actData=e.data.getCurActCfg(),e.actData&&(e.isFirstLoad||e.initView(),e.taskData=e.data.getAcquireData(e.actData.id),e.updateTabBtnShowOrHide(),e.timer||(e.timer=b8e.Timer.add(e,e.updateTime,1e3)),e.timer.start())},onHide:function(){this.timer&&this.timer.stop()},notify:function(e,t){var a=this;switch(e){case a.Evts.V_TOGGLECHANGE:a.setSelcted(t);break;case a.Evts.C2V_SAVE_DATA_UPDATE:a.updateDataForSave();break;case a.Evts.C2V_JIN_SEL_CHANGE:a.jinSelChange();break;case a.Evts.C2V_YIN_SEL_CHANGE:a.yinSelChange();break;case a.Evts.C2V_TASK_DATA_UPDATE:a.updateDataForTask();break;case a.Evts.C2V_DAY_REFRESH:a.dayUpdate();break;case a.Evts.C2V_PROGRESS_REFRESH:a.updateProgress()}},dayUpdate:function(){this.actData=this.data.getCurActCfg(),this.actData&&(this.taskData=this.data.getAcquireData(this.actData.id),this.updateTabBtnShowOrHide())},initView:function(){var e=this.skin;e.excLab1.string=game.Lang.get(52232,this.data.goldExcPoint),e.excLab2.string=game.Lang.get(52233,this.data.silvExcerPoint),e.saveTipsLab1.string=game.Lang.get(52234,this.data.excGold),e.saveTipsLab2.string=game.Lang.get(52235,this.data.excSilver)},resetSelNum:function(){var e=this,t=e.actData.saveMax-e.actData.totalNum;e.data.selJinNum=e.data.getJinMaxCanSel(t,e.actData.lostJin),e.data.selYinNum=e.data.getYinMaxCanSel(t,e.actData.lostYin),e.jinSelChange(),e.yinSelChange()},updateTabBtnShowOrHide:function(){var e=this.skin,t=this.actData.getDay<=game.miscData.openServerDay;e.btn1.setVisible(!t),e.btn2.y=t?e.btn1.y:-229,this.setSelcted(t?1:0)},setSelcted:function(e){this.isSave=0==e,this.updateView()},updateView:function(){var e=this.skin;this.isSave?(e.saveNode.active=!0,e.taskNode.active=!1,e.tipsLab.string=game.Lang.get(52228),this.updateDataForSave()):(e.saveNode.active=!1,e.taskNode.active=!0,e.tipsLab.string=game.Lang.get(52229),this.updateDataForTask()),this.updateProgress(),this.updateTime()},updateTime:function(){var e=this.skin,t=0,a=void 0;this.isSave?(t=this.data.getCountDown(this.actData.getDay-1),a=b8e.TimeUtil.formatTime(t),e.timeLab.string=game.Lang.get(52230,a)):(t=this.data.getCountDown(this.actData.endDay-1),a=b8e.TimeUtil.formatTime(t),e.timeLab.string=game.Lang.get(52231,a))},updateDataForSave:function(){var e=this.skin;e.haveNumLab1.string=game.Lang.get(52236,this.actData.lostJin),e.haveNumLab2.string=game.Lang.get(52237,this.actData.lostYin),this.resetSelNum(),this.updateProgress()},updateDataForTask:function(){var e=this.skin;if(0<=this.actData.getedDay.indexOf(game.miscData.openServerDay))e.taskNumLab.string="0",e.getedNode.active=!0,e.taskBtn.active=!1;else{if(!this.taskData)return;e.taskNumLab.string=Math.round(this.actData.totalNum*this.taskData.rate/100),e.getedNode.active=!1,e.taskBtn.active=!0}e.lostNumLab.string=this.data.getCoffersLostPoint(this.actData)},updateProgress:function(){var e=this.skin,t=void 0,a=void 0;if(this.isSave)t=this.actData.totalNum,a=this.actData.saveMax;else{if(!this.taskData)return;t=game.dailyExploitData.experienceExpDaily,a=this.taskData.dailyExp}e.proLab.string=t+"/"+a,e.proMask.width=Math.min(t/a,1)*this.proImgMax},jinSelChange:function(){this.skin.saveNumLab1.string=this.data.selJinNum.toString()},yinSelChange:function(){this.skin.saveNumLab2.string=this.data.selYinNum.toString()}});b8e.module.registerView(game.ME.Coffers,e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.coffersData;var e=game.spotAlert;this.saveJinAlert=e.set(game.SAE.COFFERS_SAVE_JIN,game.SAE.COFFERS),this.saveYinAlert=e.set(game.SAE.COFFERS_SAVE_YIN,game.SAE.COFFERS),this.taskAlert=e.set(game.SAE.COFFERS_TASK,game.SAE.COFFERS)},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.syncData},Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess},Back:{C2C_REMOVE_AMOUNT:this.updateAmount},MainRole:{C_RESET_DAILY:this.resetDaily},DailyExploit:{C_DAILYEXPLOIT_EXP:this.dailyProgressUpdate}},this.handels={TreasurySaveResp:this.treasurySaveResp,TreasuryTakeResp:this.treasuryTakeResp}},syncData:function(e){e&&e.data&&(this.data.setInitData(e.data),this.currData=this.data.getCurActCfg(),this.currData&&this.checkAlert())},rechargeSuccess:function(e){this.currData&&e&&e.data&&(this.currData.getDay<=game.miscData.openServerDay||this.updataAccuNum(e.data))},updataAccuNum:function(e){if(this.currData){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);a&&(this.currData.recharge+=a.money,this.send(this.Evts.C2V_SAVE_DATA_UPDATE),this.checkAlert())}}},updateAmount:function(e){if(this.currData&&!(this.currData.getDay<=game.miscData.openServerDay)){var t=e.data||0;0<t&&(this.currData.cost+=t,this.send(this.Evts.C2V_SAVE_DATA_UPDATE),this.checkAlert())}},resetDaily:function(){this.currData=this.data.getCurActCfg(),this.currData?(this.checkAlert(),this.send(this.Evts.C2V_DAY_REFRESH)):b8e.module.isShowView(game.ME.Coffers)&&game.module.hide(game.ME.Coffers)},treasurySaveResp:function(e){var t=this;if(t.currData){var a=e.readProtobuf(game.pb.TreasurySaveResponse);0<a.code?game.notice.noticeError(a.code):(a.isGold?(t.data.selJinNum-=a.num,t.send(t.Evts.C2V_JIN_SEL_CHANGE)):(t.data.selYinNum-=a.num,t.send(t.Evts.C2V_YIN_SEL_CHANGE)),t.data.setSaveData(t.currData.id,a),t.send(t.Evts.C2V_SAVE_DATA_UPDATE),t.checkAlert())}},treasuryTakeResp:function(e){if(this.currData){var t=e.readProtobuf(game.pb.TreasuryTakeResponse);0<t.code?game.notice.noticeError(t.code):(this.currData.getedDay.push(t.day),this.send(this.Evts.C2V_TASK_DATA_UPDATE),this.checkAlert(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive))}},dailyProgressUpdate:function(){this.currData&&(this.checkAlert(),this.send(this.Evts.C2V_PROGRESS_REFRESH))},btn1:function(){},btn2:function(){this.currData.getDay>game.miscData.openServerDay?game.notice.show(52242):this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)},cutBtn1:function(){this.data.selJinNum<=0||(this.data.selJinNum--,this.send(this.Evts.C2V_JIN_SEL_CHANGE))},addBtn1:function(){this.data.selJinNum>=this.currData.lostJin?game.notice.show(52244):(this.data.selJinNum++,this.send(this.Evts.C2V_JIN_SEL_CHANGE))},saveBtn1:function(){if(0!=this.data.selJinNum){var e=this.currData.saveMax-this.currData.totalNum,t=Math.ceil(e/this.data.goldExcPoint);this.data.selJinNum>t?game.notice.show(52246):this.sender.TreasurySaveReq(!0,this.data.selJinNum)}else game.notice.show(52243)},cutBtn2:function(){this.data.selYinNum<=0||(this.data.selYinNum--,this.send(this.Evts.C2V_YIN_SEL_CHANGE))},addBtn2:function(){this.data.selYinNum>=this.currData.lostYin?game.notice.show(52244):(this.data.selYinNum++,this.send(this.Evts.C2V_YIN_SEL_CHANGE))},saveBtn2:function(){if(0!=this.data.selYinNum){var e=this.currData.saveMax-this.currData.totalNum,t=Math.ceil(e/this.data.silvExcerPoint);this.data.selYinNum>t?game.notice.show(52246):this.sender.TreasurySaveReq(!1,this.data.selYinNum)}else game.notice.show(52243)},taskBtn:function(){var e=game.miscData.openServerDay;if(!(this.currData.getDay>e)){var t=this.data.getAcquireData(this.currData.id);t&&(game.dailyExploitData.experienceExpDaily<t.dailyExp?game.notice.show(52248):0<=this.currData.getedDay.indexOf(e)?game.notice.show(52245):this.sender.TreasuryTakeReq())}},checkAlert:function(){var e=this,t=game.miscData.openServerDay;if(e.currData.getDay>t){var a=e.currData.saveMax-e.currData.totalNum;e.saveJinAlert.alert=0<e.data.getJinMaxCanSel(a,e.currData.lostJin),e.saveYinAlert.alert=0<e.data.getYinMaxCanSel(a,e.currData.lostYin),e.taskAlert.alert=!1}else{e.saveJinAlert.alert=!1,e.saveYinAlert.alert=!1;var i=e.data.getAcquireData(e.currData.id);e.taskAlert.alert=i&&game.dailyExploitData.experienceExpDaily>=i.dailyExp&&e.currData.getedDay.indexOf(t)<0&&0<e.currData.totalNum}}}),t=game.Sender.extends({ipc:function(){this.msg={TreasurySaveReq:this.TreasurySaveReq,TreasuryTakeReq:null}},TreasurySaveReq:function(e,t){var a=game.pb.TreasurySaveRequest;a.isGold=e,a.num=t,this.write(a)}});b8e.module.registerControl(game.ME.Coffers,e,game.CoffersEvts,t)}(),function(){var e=b8e.Object.extends({goldExcPoint:null,silvExcerPoint:null,excSilver:null,excGold:null,actDic:null,acquireDic:null,selJinNum:0,selYinNum:0,ctor:function(){this._super()},initConfig:function(){var e=this,t=void 0;if((t=game.TreasuryMiscCfg)&&(e.goldExcPoint=+t.getData("goldExchange").value,e.silvExcerPoint=+t.getData("silverExchange").value,e.excSilver=+t.getData("costExchange").value,e.excGold=+t.getData("rechargeExchange").value,t=game.TreasuryOpenCfg)){var a=t.getDatas(),i=a.length,n=void 0;e.actDic={};for(var s=0;s<i;s++)if(n=a[s],!e.actDic[n.id]){var r=new game.CoffersInfo;r.id=n.id,r.getedDay=[],r.startDay=n.serverStart,r.endDay=n.serverEnd,r.getDay=n.takeStart,r.saveMax=n.sum,e.actDic[n.id]=r}if(t=game.TreasuryTakeCfg){i=(a=t.getDatas()).length,e.acquireDic={};for(var o=0;o<i;o++){n=a[o],e.acquireDic[n.treasuryId]||(e.acquireDic[n.treasuryId]={}),e.acquireDic[n.treasuryId][n.serverSart]={dailyExp:n.dailyExp,rate:n.percentage}}}}},setInitData:function(e){this.actDic||this.initConfig();var t=e.treasuryId;if(t){var a=this.actDic[t];a?(a.recharge=e.treasuryRecharge,a.cost=e.treasuryCost,a.totalNum=e.treasurySum,a.getedDay=e.treasuryReceived):b8e.error("\u6ca1\u6709\u5f53\u524d\u6d3b\u52a8id\u7684\u914d\u7f6e\uff0c "+t)}},setSaveData:function(e,t){var a=t.num,i=this.actDic[e];if(i){var n=0;n=t.isGold?(i.costJin+=a,a*this.goldExcPoint):(i.costYin+=a,a*this.silvExcerPoint),i.totalNum+=n,i.totalNum>i.saveMax&&(i.totalNum=i.saveMax)}else b8e.error("Don't have curr actId "+e)},getCurActCfg:function(){var e=this.actDic,t=void 0,a=game.miscData.openServerDay;for(var i in e)if((t=e[i])&&a>=t.startDay&&a<t.endDay)return t;return null},getAcquireData:function(e){var t=this.acquireDic[e];return t?t[game.miscData.openServerDay]:(b8e.error("The activity id is not configured!  "+e),null)},getCoffersLostPoint:function(e){var t=0,a=this.acquireDic[e.id];if(!a)return b8e.error("\u6ca1\u6709\u5f53\u524d\u6d3b\u52a8\u7684\u53d6\u51fa\u914d\u7f6e\uff0cid= "+e.id),t;for(var i=e.getedDay,n=0,s=void 0,r=void 0,o=0;o<i.length;o++)(r=a[s=i[o]])?n+=r.rate:b8e.error("\u6ca1\u6709\u5f53\u524d\u5929\u6570\u7684\u53d6\u51fa\u914d\u7f6e\uff0cday= "+s);return t=Math.round(e.totalNum*(100-n)/100)},getCountDown:function(e){var t=game.SysTime.curTime;return b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(e-game.miscData.openServerDay+1)*b8e.TimeUtil.DAY_MICRO_SECONDS-t},getJinMaxCanSel:function(e,t){var a=Math.ceil(e/this.goldExcPoint);return a<t?a:t},getYinMaxCanSel:function(e,t){var a=Math.ceil(e/this.silvExcerPoint);return a<t?a:t}});game.coffersData=game.coffersData||new e}(),function(){var e;e=b8e.Object.extends({id:0,startDay:0,endDay:0,getDay:0,saveMax:0,recharge:0,cost:0,totalNum:0,getedDay:null,costJin:0,costYin:0,lostJin:{get:function(){return Math.floor(this.recharge/game.coffersData.excGold)-this.costJin}},lostYin:{get:function(){return Math.floor(this.cost/game.coffersData.excSilver)-this.costYin}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$CoffersInfo",e)}(),function(){var e;e=b8e.Enum({None:0,SHOW_LVUP_VIEW:-1,ON_VIEW_HIDE:-1,V_ALREADY_ROLE_LVUP:-1,G_SHOW_POPUP:-1,V_UPDATE_VIEW:-1,C2V_UPDATE_LV_STAT:-1}),b8e.RC("$$game","$$RoleLvUpEvts",e)}(),function(){var e=void 0;e=b8e.Object.extends({addLv:0,addLvArr:null,showFightAmount:!1,ctor:function(){this.addLvArr=[]}}),game.roleLvUpData=game.roleLvUpData||new e,b8e.RC("$$game","$$RoleLvUpData",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.roleLvUpData},ipc:function(){this.evts={MainRole:{C_LEVEL_UP:this.onLvUp},InstanceSuccess:{V_SHOW_INS_SUCCESS:this.playStop},ArenaFinish:{V_SHOW_INS_SUCCESS:this.playStop},Guaji:{V_SHOW_INS_SUCCESS:this.playStop}}},notify:function(e){switch(e){case this.Evts.ON_VIEW_HIDE:this.dpt(this.Evts.ON_VIEW_HIDE)}},onLvUp:function(){var e=this.moduleData.addLv;if(0!=e){if(game.mainRole){var t=game.ResCfg.getUrl(5019,1077);game.mainRole.showEffect(t)}this.moduleData.addLvArr.push(e),game.playBack.isInstanceFighting(!1)||b8e.module.isShowView(game.ME.QuickBattleAward)||(game.gamePopupMgr.show(game.ME.RoleLvUp),this.dpt(this.Evts.V_ALREADY_ROLE_LVUP))}},updateLv:function(){this.moduleData.showFightAmount=!0,this.send(this.Evts.C2V_UPDATE_LV_STAT)},playStop:function(){0<this.moduleData.addLvArr.length&&game.gamePopupMgr.show(game.ME.RoleLvUp)},onClick:function(){game.module.hide(game.ME.RoleLvUp)}});b8e.module.registerControl(game.ME.RoleLvUp,e,game.RoleLvUpEvts)}(),function(){var e=game.View.extends({time:4,ctor:function(){this._super(1461)},init:function(){this.moduleData=game.roleLvUpData,this.item=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this.item.addToParent(this.skin.itemNode)},notify:function(e){switch(e){case this.Evts.SHOW_LVUP_VIEW:break;case this.Evts.C2V_UPDATE_LV_STAT:this.showFightAmount()}},onShow:function(){this.updateView(),this.showEffect(),this.time=4,this.updateCountDown(),this.timer||(this.timer=b8e.Timer.add(this,this.updateCountDown,1e3)),game.TweenUtil.rotationEffect(this.skin.light)},onHide:function(){this.timer&&(b8e.Timer.remove(this,this.updateCountDown),this.timer=null),this.dptG(game.PushTipEvts.V2C_SHOW_TIP),this.send(this.Evts.ON_VIEW_HIDE),game.GameGuideMgr.inst().level(game.mainRoleData.lv)},showFightAmount:function(){this.moduleData.showFightAmount&&(this.moduleData.showFightAmount=!1)},updateView:function(){var e=this.skin,t=this.moduleData.addLvArr.pop();if(t){var a=game.mainRoleData.lv,i=(e.lvLab.string=a)-t,n=game.RoleLvUpCfg.getData(i);if(n){var s=game.RoleLvUpCfg.getData(a);if(s){var r=s.awardNum-n.awardNum;this.itemInfo=game.ItemUtil.createBaseItemInfo(21,r,this.itemInfo),game.GridUtil.setItemIcon(this.item,this.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM),0==s.openLv?(e.titleNode2.active=e.noticeNode.active=!1,e.bg.height=308,e.bottomNode.y=-714):(e.titleNode2.active=e.noticeNode.active=!0,e.bg.height=468,e.bottomNode.y=-873,this.updateNotice(s))}}}},updateNotice:function(e){var t=this.skin,a=e.openLv,i=game.RoleLvUpCfg.getData(a);i&&(t.icon.loadTexture(game.ResCfg.getUrl(10044,i.moduleId)),t.moduleNameLab.string=i.moduleName,t.openLvLab.string=game.Lang.get(52336,a),t.descLab.string=i.desc)},updateCountDown:function(){this.time--,this.skin.timeLab.string=game.Lang.get(52263,this.time),this.time<1&&game.module.hide(game.ME.RoleLvUp)},showEffect:function(){var e=this;e.effect||(e.effect=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.effect.load(game.ResCfg.getUrl(5019,1096)),e.effect.addToParent(e.skin.effectNode),e.effect.addFinishCallback(e.onEffectFinish,e)),e.effect.active=!0,e.effect.play(null,0)},onEffectFinish:function(){this.effect.active=!1},onStageResize:function(){this._super(),this.skin.bg.width=b8e.stageWidth,this.skin.line2.width=b8e.stageWidth,this.skin.line1.width=b8e.stageWidth,this.skin.onClick.width=b8e.stageWidth,this.skin.onClick.height=b8e.stageHeight}});b8e.module.registerView(game.ME.RoleLvUp,e)}(),function(){var e=b8e.Object.extends({storyLangs:null,getBattleLog:function(){return{units:[{id:1,roleId:0x394dc985bd21a,type:1,hp:1e4,maxhp:1e4,mp:4,maxmp:40,level:200,attack:!0,pos:2,ismale:!0,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[1502],mount:4,wing:0,halo:0,shenqi:7,shenhun:0,roleQuality:4},name:game.mainRoleData.name},{id:2,roleId:4,type:2,hp:5e3,maxhp:5e3,mp:4,maxmp:40,level:1,attack:!0,pos:4,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:0},name:"\u706b\u70c8\u9e1f"},{id:3,roleId:9,type:2,hp:5e3,maxhp:5e3,mp:4,maxmp:40,level:1,attack:!0,pos:1,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:0},name:"\u5251\u9f7f\u864e"},{id:4,roleId:10,type:2,hp:5e3,maxhp:5e3,mp:4,maxmp:40,level:1,attack:!0,pos:3,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:0},name:"\u70c8\u706b\u731b\u72b8"},{id:5,roleId:26,type:2,hp:5e3,maxhp:5e3,mp:4,maxmp:40,level:400,attack:!0,pos:5,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:0},name:"\u51b0\u539f\u65a9\u98ce\u9f99"},{id:6,roleId:60,type:2,hp:5e3,maxhp:5e3,mp:4,maxmp:40,level:1,attack:!0,pos:6,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:0},name:"\u7ffc\u624b\u730e\u9f99"},{id:7,roleId:99999998,type:9,hp:5e4,maxhp:5e4,mp:4,maxmp:40,level:200,attack:!1,pos:2,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:5,shenhun:6,roleQuality:4},name_:{offset:20,length:18}},{id:8,roleId:99999999,type:9,hp:1e5,maxhp:1e5,mp:4,maxmp:40,level:172,attack:!1,pos:4,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:0,surface:null,name_:{offset:352,length:9}},{id:9,roleId:99999997,type:9,hp:5e4,maxhp:5e4,mp:4,maxmp:40,level:172,attack:!1,pos:6,ismale:!1,shield:0,maxShield:0,speed:0,element:0,formation:0,surface:null,name_:{offset:387,length:9}}],actions:[{type:90,round:1,buffs:[],spellCast:[],units:[],chat:[{unitId:1,chatId:52309,showTime:1500,beginWaitTime:0,endWaitTime:0},{unitId:7,chatId:52337,showTime:1500,beginWaitTime:0,endWaitTime:0}]},{type:1,round:1,buffs:[],spellCast:[{unitId:8,spellId:2036,combine:[],mp:0,targets:[{unitId:2,effect:{type:2,value:4564}},{unitId:1,effect:{type:1,value:3285}},{unitId:3,effect:{type:2,value:4625}},{unitId:4,effect:{type:2,value:4564}},{unitId:5,effect:{type:2,value:4685}},{unitId:6,effect:{type:2,value:4625}}],buffs:[],attachEffect:0}],units:[]},{type:1,round:1,buffs:[],spellCast:[{unitId:7,spellId:2112,combine:[],mp:0,targets:[{unitId:2,effect:{type:2,value:4364}},{unitId:1,effect:{type:1,value:3185}},{unitId:3,effect:{type:2,value:4125}},{unitId:4,effect:{type:2,value:4264}},{unitId:5,effect:{type:2,value:4185}},{unitId:6,effect:{type:2,value:4325}}],buffs:[],attachEffect:0}],units:[]},{type:1,round:1,buffs:[],spellCast:[{unitId:1,spellId:1001,combine:[],mp:0,targets:[{unitId:7,effect:{type:2,value:5785}},{unitId:8,effect:{type:1,value:3658}},{unitId:9,effect:{type:1,value:3568}}],buffs:[],attachEffect:0}],units:[]},{type:1,round:1,buffs:[],spellCast:[{unitId:9,spellId:2076,combine:[],mp:0,targets:[{unitId:1,effect:{type:1,value:3015}}],buffs:[],attachEffect:0}],units:[]},{type:90,round:2,buffs:[],spellCast:[],units:[],chat:[{unitId:1,chatId:52338,showTime:1e3,beginWaitTime:0,endWaitTime:500}]},{type:91,round:1,buffs:[],spellCast:[],units:[{id:10,roleId:13,type:2,hp:1e6,maxhp:1e6,mp:4,maxmp:40,level:200,attack:!0,pos:1,ismale:!0,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:4},name:"\u7ea2\u66b4\u9f99"},{id:11,roleId:14,type:2,hp:1e6,maxhp:1e6,mp:4,maxmp:40,level:200,attack:!0,pos:3,ismale:!0,shield:0,maxShield:0,speed:0,element:0,formation:3,surface:{nickname:0,skins:[],mount:0,wing:0,halo:0,shenqi:0,shenhun:0,roleQuality:4},name:"\u6012\u706b\u4eba\u9f99"}]},{type:90,round:2,buffs:[],spellCast:[],units:[],chat:[{unitId:10,chatId:52312,showTime:1e3,beginWaitTime:0,endWaitTime:0}]},{type:1,round:2,buffs:[],spellCast:[{unitId:8,spellId:2035,combine:[],mp:1,targets:[{unitId:10,effect:{type:2,value:5680}}],buffs:[],attachEffect:0}],units:[]},{type:1,round:2,buffs:[],spellCast:[{unitId:10,spellId:1037,combine:[11],mp:0,targets:[{unitId:8,effect:{type:2,value:109532}},{unitId:7,effect:{type:1,value:8876}}],buffs:[],attachEffect:0}],units:[]},{type:1,round:2,buffs:[],spellCast:[{unitId:10,spellId:1037,combine:[11],mp:0,targets:[{unitId:9,effect:{type:2,value:59532}}],buffs:[],attachEffect:3}],units:[]},{type:90,round:2,buffs:[],spellCast:[],units:[],chat:[{unitId:7,chatId:52310,showTime:1e3,beginWaitTime:0,endWaitTime:0}]}],win:!0,damage:-5682986,roundLimit:10,rounds:10,story_langs:[52313]}}});game.StoryData=game.StoryData||new e}(),function(){var e=game.Control.extends({ipc:function(){this.gevts={SceneGEvts:{STORY_BATTLE:this.storyBattle},InstanceEvts:{G_STOP_PLAY:this.battleEnd}}},storyBattle:function(){game.LoginConfig.isStory=!0;var e=game.StoryData.getBattleLog();game.StoryData.storyLangs=e.story_langs;var t={type:game.InstanceType.STORT_BATTLE};game.playBack.play(e,t)},battleEnd:function(){game.LoginConfig.isStory&&game.sdk.traceLog(3)}});b8e.module.registerControl(game.ME.Story,e)}(),function(){var e=game.View.extends({ctor:function(){this._super("story/story_view")},init:function(){this._storyText=""},onShow:function(){this._storyText="",this._storyLangs=game.StoryData.storyLangs,this.skin.storyLab.y=0,this._showStory()},onHide:function(){var e=this.skin.storyLab;this._storyText=null,e.setText(""),b8e.Tween.kill(this.skin.storyLab),b8e.Tween.kill(this),this._storyLangs=null,game.StoryData.storyLangs=null},_showStory:function(){var e=this;if(!e._storyLangs||e._storyLangs.length<1)return b8e.Tween.kill(e),void b8e.Tween.get(e).wait(1500).call(e._showEnd,e);var t=e.skin.storyLab,a=e._storyLangs.shift(),i=game.Lang.get(a);e._storyText+=i+"\n",t.setAlpha(0),t.setText(e._storyText);t.x,t.y;b8e.Tween.kill(t),b8e.Tween.get(t).to({alpha:1},1500);var n=e.skin.viewSkipBtn;n.setAlpha(0),b8e.Tween.get(n).to({alpha:1},1500),b8e.Tween.kill(e),b8e.Tween.get(e).wait(1500).call(e._showStory,e)},_showEnd:function(){game.module.hide(game.ME.Story),game.LoginConfig.isStory&&(game.LoginConfig.isStory=!1,game.manyFirstChargeData.isNeedManyCD(!0),game.LoginConfig.hasHeroData=!0,game.module.showMainView(),game.GameLevelMgr.inst().enterScene(),b8e.evt.dptG(game.SceneGEvts.ENTER_SCENE))},viewStoryBtn:function(){},viewSkipBtn:function(){this._skip()},_skip:function(){var e=this.skin.storyLab,t=this._storyLangs;if(b8e.Tween.kill(e),b8e.Tween.kill(this),0<t.length){for(var a="",i=0,n=0,s=t.length;n<s;n++)a=game.Lang.get(t[n]),this._storyText+=a+"\n",e.setText(this._storyText),i+=20;e.y+=i,b8e.Tween.get(this).wait(2e3).call(this._showEnd,this),t.length=0}else this._showEnd()},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.skin&&this.skin.bg&&this.skin.bg.setSize(e,t),this.setPosition(e>>1,t>>1)}});b8e.module.registerView(game.ME.Story,e)}(),function(){var e;e=b8e.Enum({None:0,V_SHOW:-1,UPDATE_LOGS:-1,C2V_SET_PASSANIM:-1,CHOU_JIANG_SUCCESS:-1,PLAY_ANIM:-1,V2C_ON_ANI_END:-1,CASH_BACK_RECEIVED:-1,C2V_UPDATE_RWARDS:-1,C2C_GET_AWARDS:-1,C2V_SAVE_MONEY_UPDATE:-1,C2V_SELECT_UPDATE:-1,SHOW_SELECT_IMAGE:-1,CLOSE_SELECT_IMAGE:-1,C2V_BOTTOM_BTN:-1,C2V_TOP_BTN:-1,C2V_REFRESH_VIEW:-1}),b8e.RC("$$game","$$ValueRebateEvts",e)}(),function(){var e=b8e.Object.extends({selectId:1,passAnim:!1,rewardResult:null,cacheLog:null,cashBackRecharge:0,actDic:null,ctor:function(){this.chaoZhiMap=b8e.HashMap.get(),this.rewardResult=[],this.awardArr=[],this.logArr=[],this.cashBackReceived=[]},setCfgData:function(){var e=game.CashBackOpenCfg.getDatas();if(e&&!(e.length<1)){var t=e.length,a=void 0,i=this.chaoZhiMap;this.actDic={};for(var n=0;n<t;n++)(a=new game.ValueRebateInfo).cashBackRecharge=0,a.cashBackNum=0,a.cashBackReceived=[],a.setCfgData(e[n]),i.set(a.actId,a),this.actDic[a.actId]=a}},getCurActCfg:function(){var e=this.actDic,t=void 0,a=void 0,i=void 0,n=game.SysTime.curTime,s=game.miscData.openServerDay;for(var r in e)if((a=e[r])&&a.cfg)if(t=a.cfg,a.startTime){if(a.startTime>n||a.endTime<=n)continue;if((i=game.TimeUtil.getOpenDayByStr(t.startTime))>=t.serverStart&&i<t.serverEnd)return r}else if(s>=t.serverStart&&s<t.serverEnd)return r;return null},setNetData:function(e){if(e&&!(e.length<1)){var t=e,a=this.getCurInfo();a&&a.setNetData(t)}},onChouJiangSuccess:function(e){var t=this.getCurInfo();t.cashBackNum=e?t.cashBackNum+1:t.cashBackNum+10},overrideLogs:function(e){this.clearLogInfos();for(var t=0;t<e.length;t++){var a=e[t],i=a.name,n=a.itemId,s=a.itemNum,r=game.ValueRebateLogInfo.get();r.setData(i,n,s),this.logArr.push(r)}},clearLogInfos:function(){this.logArr.forEach(function(e){e.release()}),this.logArr.length=0},getLog:function(){return this.logArr},getMoneyByActId:function(e){var t=0,a=game.CashBackOpenCfg.getData(e);return a?t=a.num:t},getTimeByActId:function(e){var t=0,a=game.CashBackOpenCfg.getData(e);if(!a)return t;var i=0;if(a.endTime)i=b8e.TimeUtil.dateParse(a.endTime,"yyyy-MM-dd hh:mm:ss").getTime();else{var n=a.serverEnd,s=game.miscData.openServerDay;i=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,n-s)}return t=i-game.SysTime.curTime},getCurInfo:function(){return this.chaoZhiMap.get(this.selectId||1)},initShowItems:function(){for(var e=this.showInfos=[],t=void 0,a=0;a<14;a++)t=new game.ValueRebateGridInfo,e.push(t)},getCurShowItems:function(){this.showInfos||this.initShowItems();var e=this.getCurInfo();if(e){var t=this.getDisplayCfg(e.store);if(t){for(var a=this.showInfos,i=(t.award,a.length),n=0;n<i;n++)a[n].setCfg(t[n]);return a}}},getCurShowItemsID:function(){var e=this.getCurInfo();if(e){var t=this.getDisplayCfg(e.store);if(t){for(var a=[],i=t.length,n=0;n<i;n++)a.push(t[n].id);return a}}},getDisplayCfg:function(e){return this.dObj||(this.dObj={}),this.dObj.store=e,game.CashBackPoolCfg.getData(this.dObj,!0)},getDisplayByIdCfg:function(e){return this.iObj||(this.iObj={}),this.iObj.id=e,game.CashBackPoolCfg.getData(this.iObj)},getAwardCfg:function(e){var t=this.getCurInfo();if(t)return e=t.awardId,this.sObj||(this.sObj={}),this.sObj.store=e,game.CashBackAwardCfg.getData(this.sObj,!0)},getAwardByNumCfg:function(e){return this.dObj||(this.dObj={}),this.dObj.num=e,game.CashBackAwardCfg.getData(this.dObj)},updataRwardArr:function(e){var t=this.getCurInfo().cashBackReceived;t.push(e),t.sort()},getScroll:function(e){e=e||1;for(var t=this.getAwardCfg(e),a=t.length,i=void 0,n=this.awardArr=[],s=this.getCurInfo(),r=s.cashBackReceived,o=s.cashBackNum,g=!1,u=!1,l=0;l<a;l++){i=new game.ValueRebateRewardInfo,g=u=!1;var c=t[l].num;0<=r.indexOf(c)&&c<=o?g=!0:r.indexOf(c)<0&&c<=o&&(u=!0),i.setData(t[l],g,u),n.push(i)}return n.sort(this.onSort),n},onSort:function(e,t){return!e.isCanGet&&t.isCanGet?1:e.isCanGet&&!t.isCanGet?-1:e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:void 0}});game.valueRebateData=game.valueRebateData||new e}(),function(){var e;e=b8e.Object.extends({setCfg:function(e){var t=e.award[0]||null;t&&(this.id=t.Id,this.num=t.Num,this.tagId=e.record?2:0)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ValueRebateGridInfo",e)}(),function(){var e;e=b8e.Object.extends({isFirstBatch:!1,setCfgData:function(e){if(this.cfg=e,this.name=e.name,this.actId=e.id,this.store=e.store,this.awardId=e.awardId,e.startTime){var t=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd hh:mm:ss").getTime();this.startTime=1e3*(t/1e3>>0)}if(e.endTime){var a=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime();this.endTime=1e3*(a/1e3>>0)}},setNetData:function(e){this.cashBackRecharge=e.cashBackRecharge,this.cashBackNum=e.cashBackNum||0,this.cashBackReceived=e.cashBackReceived||[]},updataRecharge:function(e){this.cashBackRecharge+=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ValueRebateInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:0,itemId:0,itemNum:0,setData:function(e,t,a){this.name=e,this.itemId=t,this.itemNum=a}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ValueRebateLogInfo",t)}(),function(){var e;e=b8e.Object.extends({setData:function(e,t,a){this.cfg=e,this.num=e.num,this.isGet=t,this.isCanGet=a,this.createPrize()},createPrize:function(){var e=this.cfg.award[0];this.itemInfo=game.ItemUtil.createBaseItemInfo(e.Id,e.Num)},getPrizeItems:function(){return this.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ValueRebateRewardInfo",e)}(),function(){var e=game.Control.extends({ctor:function(){this._super()},init:function(){this.data=game.valueRebateData,this.isLockClick=!1,this.valueChouAlert=game.spotAlert.set(game.SAE.VALUE_CHOU_ALERT,game.SAE.VALUE_REBATE_ALL),this.valueChouAlert2=game.spotAlert.set(game.SAE.VALUE_CHOU_ALERT2,game.SAE.VALUE_REBATE_ALL),this.valueRwardAlert=game.spotAlert.set(game.SAE.VALUE_RWARD_ALERT,game.SAE.VALUE_REBATE_ALL)},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.syncData},Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily}},e.gevts={BoonRechargeEvts:{HORSERACELAMP_SELECTED:e.selChanged}},e.handels={CashBackResp:e.cashBackResp,CashBackReceiveResp:e.cashBackReceiveResp,CashBackLogResp:e.cashBackLogResp}},resetDaily:function(){var e=this.data.getCurActCfg();(this.data.selectId=e)?(this.send(this.Evts.C2V_REFRESH_VIEW),this.checkAlert()):b8e.module.isShowView(game.ME.ValueRebate)&&game.module.hide(game.ME.ValueRebate)},rechargeSuccess:function(e){this.data&&e&&e.data&&this.data.getCurActCfg()&&this.updataAccuNum(e.data)},updataAccuNum:function(e){if(this.data){var t=e.id;if(0<t){var a=game.RechargeCfg.getDataById(t);if(a)this.data.getCurInfo().updataRecharge(a.money),this.send(this.Evts.C2V_SAVE_MONEY_UPDATE),this.checkAlert()}}},notify:function(e,t){switch(e){case this.Evts.V2C_ON_ANI_END:this.delayTimer||(this.delayTimer=b8e.setTimeout(this.onAniEnd,this,500));break;case this.Evts.C2C_GET_AWARDS:this.sender.CashBackReceiveReq(t);break;case this.Evts.V_SHOW:this.sender.CashBackLogReq()}},syncData:function(e){var t=e?e.data:null;if(t){var a=this.data;a.cashBackRecharge=t.cashBackRecharge,this.data.selectId=t.cashBackId,a.setCfgData(),a.setNetData(t),0!=this.data.selectId&&this.checkAlert()}},cashBackResp:function(e){var t=this,a=e.readProtobuf(game.pb.CashBackResponse);if(0<a.code)return t.isLockClick=!1,void game.notice.noticeError(a.code);t.data.onChouJiangSuccess(a.once),t.send(t.Evts.CHOU_JIANG_SUCCESS);for(var i=a.award.length,n=[],s=0;s<i;s++){var r=a.award[s],o=t.data.getDisplayByIdCfg(r);if(o){var g=o.award[0];n.push({Id:g.Id,Num:g.Num})}}t.data.rewardResult=n;var u=a.award[0],l=t.data.getCurShowItemsID().indexOf(u);l<0&&(l=0),t.data.passAnim?(game.awardsData.setInfo(t.data.rewardResult),game.module.show(game.ME.AwardShowTip)):(t.isLockClick=!0,t.startPlay(l)),t.checkAlert()},startPlay:function(e){var t=this;t.send(t.Evts.SHOW_SELECT_IMAGE),t.runPlug||(t.runPlug=new game.HorseRaceLampPlug,t.runPlug.maxLen=14,t.runPlug.bindEnum=t.moduleEnum),t.runPlug.start(e,t.onAniEnd,t)},onAniEnd:function(){var e=this;e.send(e.Evts.CLOSE_SELECT_IMAGE),b8e.setTimeout(function(){game.awardsData.setInfo(e.data.rewardResult),game.module.show(game.ME.AwardShowTip),e.delayTimer&&(b8e.clearTimeout(e.delayTimer),e.delayTimer=null),e.isLockClick=!1},e,1e3)},selChanged:function(e){var t=e.data;t.bindEnum==this.moduleEnum&&this.send(this.Evts.C2V_SELECT_UPDATE,t.index)},cashBackReceiveResp:function(e){var t=e.readProtobuf(game.pb.CashBackReceiveResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updataRwardArr(t.num),this.send(this.Evts.C2V_UPDATE_RWARDS),this.checkAlert())},cashBackLogResp:function(e){var t=e.readProtobuf(game.pb.CashBackLogResponse);0<t.code?game.notice.noticeError(t.code):(this.data.cacheLog=t.wholeLogs,this.data.overrideLogs(t.wholeLogs),this.send(this.Evts.UPDATE_LOGS))},passAnimBtn:function(){this.data.passAnim=!this.data.passAnim,this.send(this.Evts.C2V_SET_PASSANIM)},topBtn:function(){this.send(this.Evts.C2V_TOP_BTN)},bottomBtn:function(){this.send(this.Evts.C2V_BOTTOM_BTN)},oneBtn:function(){this.sendChouJiang(!0)},tenBtn:function(){this.sendChouJiang(!1)},sendChouJiang:function(e){if(!this.isLockClick){var t=this.data,a=t.getMoneyByActId(t.selectId),i=t.getCurInfo(),n=i.cashBackNum,s=i.cashBackRecharge/a-n||0;e&&s<1?game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE):!e&&s<10?game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE):(this.sender.CashBackReq(e),this.sender.CashBackLogReq())}},rwardBtn:function(){game.module.show(game.ME.ValueRebateReward)},checkAlert:function(){var e=this.data;if(0!=e.selectId){for(var t=e.getCurInfo(),a=e.getMoneyByActId(e.selectId),i=e.getAwardCfg(e.selectId),n=i.length,s=t.cashBackNum,r=t.cashBackRecharge,o=t.cashBackReceived||[],g=r/a-s>>0,u=!1,l=0;l<n;l++){var c=i[l].num;if(o.indexOf(c)<0&&c<=s){u=!0;break}}this.valueChouAlert.alert=0<g,this.valueChouAlert2.alert=10<=g,this.valueRwardAlert.alert=u}}}),t=game.Sender.extends({ipc:function(){this.msg={CashBackReq:this.cashBackReq,CashBackReceiveReq:this.cashBackReceiveReq,CashBackLogReq:null}},cashBackReq:function(e){var t=game.pb.CashBackRequest;t.once=e,this.write(t)},cashBackReceiveReq:function(e){var t=game.pb.CashBackReceiveRequest;t.num=e,this.write(t)}}),a=[game.ME.ValueRebateReward];b8e.module.registerControl(game.ME.ValueRebate,e,game.ValueRebateEvts,t,a)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1447),this.spotAlerts={VALUE_CHOU_ALERT:this.valueChouAlert,VALUE_CHOU_ALERT2:this.valueChouAlert2,VALUE_RWARD_ALERT:this.valueRwardAlert}},valueChouAlert:function(e){this.skin.redPoint1.active=e.alert},valueChouAlert2:function(e){this.skin.redPoint2.active=e.alert},valueRwardAlert:function(e){this.skin.redPoint3.active=e.alert},init:function(){this.data=game.valueRebateData;this.skin;var e=this.iconArr=[],t=game.IconSizeEnum,a=void 0,i=void 0,n=0;for(n=0;n<14;n++)a=game.GridUtil.createItemIcon(t.GRID_SIZE_105),i=this.getComponent("iconNode"+(n+1)),a.addToParent(i),e.push(a);var s=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);s.itemRender=game.ValueRebateLogItem,s.layout.paddingLeft=0,s.layout.spacingY=5,s.addToParent(this.skin.listNode),this.barLen=384},notify:function(e,t){var a=this;switch(e){case a.Evts.UPDATE_LOGS:a.updateLog();break;case a.Evts.C2V_SET_PASSANIM:a.updatePassAnim();break;case a.Evts.CHOU_JIANG_SUCCESS:case a.Evts.C2V_UPDATE_RWARDS:case a.Evts.C2V_SAVE_MONEY_UPDATE:case a.Evts.C2V_REFRESH_VIEW:a.updateScorePro();break;case a.Evts.C2V_SELECT_UPDATE:a.selectedChanged(t);break;case a.Evts.SHOW_SELECT_IMAGE:a.showSelect();break;case a.Evts.CLOSE_SELECT_IMAGE:a.closeSelect()}},onShow:function(){this.send(this.Evts.V_SHOW),this.createItemGrid(),this.createTimer(),this.showMoney(),this.updateScorePro(),this.updateLog(),this.updatePassAnim()},showSelect:function(){this.skin.selectImg.active=!0},closeSelect:function(){var e=this.skin;b8e.setTimeout(function(){e.selectImg.active=!1},this,1e3)},selectedChanged:function(e){console.log(e);var t=this.skin;t.selectImg.x=this.getComponent("icon"+(e+1))._pos.x,t.selectImg.y=this.getComponent("icon"+(e+1))._pos.y},updatePassAnim:function(){this.skin.check.setVisible(this.data.passAnim)},updateLog:function(){var e=this.data.getLog();this.list.setData(e)},updateScorePro:function(){var e=this.data,t=this.skin,a=e.getCurInfo();if(a){for(var i=e.getMoneyByActId(e.selectId),n=e.getAwardCfg(e.selectId),s=a.cashBackNum||0,r=a.cashBackRecharge||0,o=a.cashBackReceived||[],g=r/i-s>>0,u=[],l=0;l<n.length;l++)u.push(n[l].num);for(var c=u[0],h=void 0,m=0;m<u.length;m++)if((h=m+1)>=u.length&&(h=m),s>=u[m]&&o.indexOf(u[h])<0){c=u[h];break}t.pro.width=Math.min(this.barLen,this.barLen*s/c),t.proLab.string=s+"/"+c,t.numLab.string=game.Lang.get(52276,g)}},showMoney:function(){var e=this.data,t=e.getMoneyByActId(e.selectId);this.skin.moneyLab.string=game.Lang.get(52275,t)},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=this.data,t=e.getTimeByActId(e.selectId);if(t<1)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);this.skin.timeLab.string=game.Lang.get(51900,a)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},createItemGrid:function(){var e=this.data.getCurShowItems();if(e&&!(e.length<1))for(var t=this.iconArr,a=t.length,i=void 0,n=game.IconLayoutEnum.SHOW_NUM,s=0;s<a;s++)i=e[s],t[s].setItemInfo(i,!1,n)}});b8e.module.registerView(game.ME.ValueRebate,e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1449),this.setSize(450,22)},setData:function(e){if(e){var t=e.itemId;if(t){var a=game.ItemInfoCfg.getData(t);a&&(this.skin.labHint.string=game.Lang.get(52277,e.name,a.name,e.itemNum))}}}})).poolCall=!0,b8e.RC("$$game","$$ValueRebateLogItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1448)},init:function(){this.data=game.valueRebateData;this.skin;var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ValueRebateRewardItem,e.bindEnum=game.ME.ValueRebate,e.layout.paddingLeft=0,e.layout.spacingY=5,e.addToParent(this.skin.scrollView),e.setScrollViewCb(this.listCb,this)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_RWARDS:this.updataScroll();break;case this.Evts.C2V_TOP_BTN:this.list.scrollToTop(0,200);break;case this.Evts.C2V_BOTTOM_BTN:this.list.scrollToBottom(0,200)}},listCb:function(e,t,a){var i=this.skin;i.topBtn.active=0<e.length,i.bottomBtn.active=0<a.length},onShow:function(){this.updataScroll()},updataScroll:function(){this.list.scrollToTop();var e=this.data.getScroll(this.data.selectId);this.list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width)-6,.5*(t+this.height)+20)}});b8e.module.registerView(game.ME.ValueRebateReward,e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1450),this.setSize(540,127)},init:function(){(this.grid=game.GridUtil.createItemIcon()).addToParent(this.skin.iconNode)},setData:function(e){var t=this;if(e){var a=e.num;if(a){t.data=e,game.GridUtil.setItemIcon(t.grid,e.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM),t.otherData=game.valueRebateData;var i=t.otherData.getCurInfo();t.skin.getBtn.node.active=t.data.isCanGet,t.skin.gray_btn.node.active=!t.data.isCanGet&&!t.data.isGet,t.skin.finish.node.active=t.data.isGet,t.data.isCanGet||t.data.isGet?t.skin.lbl_title.string=game.Lang.get(52278,a,i.cashBackNum,a):t.data.isCanGet||t.data.isGet||(t.skin.lbl_title.string=game.Lang.get(52286,a,i.cashBackNum,a))}}},getBtn:function(){this.send(game.ValueRebateEvts.C2C_GET_AWARDS,this.data.num)},gray_btn:function(){game.notice.show(7240)}})).poolCall=!0,b8e.RC("$$game","$$ValueRebateRewardItem",e)}(),function(){var e;e=b8e.Enum({C2V_SELECT_UPDATE:b8e.enc(),C2V_GRADE_UPDTAE:b8e.enc(),C2V_SELECTED_END:b8e.enc(),C2V_AWARD_COUNT_UPDATE:b8e.enc(),C2V_LOGS_UPDATE:b8e.enc(),V_SHOW:-1,C2C_POINT_ADD:b8e.enc(),HORSERACELAMP_SELECTED:b8e.enc()}),b8e.RC("$$game","$$BoonRechargeEvts",e)}(),function(){var e;e=b8e.Object.extends({id:0,grade:0,awardId:0,costNum:0,startDay:0,endDay:0,count:0,logs:null}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BoonRechargeActInfo",e)}(),function(){var e=b8e.Object.extends({needPoint:0,itemNum:10,actDataDic:null,awardDic:null,initGrade:0,ctor:function(){this._super(),this.awardDic={}},setInitData:function(e){this.actDataDic||this.initConfig();var t=e.boonRechargeId,a=this.actDataDic[t];a?(a.grade=e.boonRechargeGrade,a.awardId=e.boonRechargeAward,a.costNum=e.boonRechargeNum):b8e.error("\u6ca1\u6709\u5f53\u524d\u6d3b\u52a8id\u7684\u914d\u7f6e\uff0c "+t)},initConfig:function(){var e=void 0;if(e=game.BoonRechargeMiscCfg){var t=e.getData("boonRechargeRefresh");t&&(this.needPoint=+t.value)}if(e=game.BoonRechargeOpenCfg)for(var a=e.getDatas(),i=void 0,n=0;n<a.length;n++)if(this.actDataDic||(this.actDataDic={}),i=a[n],!this.actDataDic[i.id]){var s=new game.BoonRechargeActInfo;s.id=i.id,s.startDay=i.serverStart,s.endDay=i.serverEnd,s.count=i.num,s.startTime=i.startTime,s.endTime=i.endTime,this.actDataDic[i.id]=s}},getCurActCfg:function(){this.actDataDic||this.initConfig();var e=this.actDataDic,t=void 0,a=void 0,i=void 0,n=void 0,s=game.miscData.openServerDay,r=game.SysTime.curTime;for(var o in e)if(t=e[o])if(t.startTime){if(n=1e3*((n=b8e.TimeUtil.dateParse(t.startTime,"yyyy-MM-dd hh:mm:ss").getTime())/1e3>>0),i=1e3*((i=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd hh:mm:ss").getTime())/1e3>>0),r<n||i<=r)continue;if((a=game.TimeUtil.getOpenDayByStr(t.startTime))>=t.startDay&&a<t.endDay)return t}else if(s>=t.startDay&&s<t.endDay)return t;return null},getAwardListByGradeId:function(e){if(!this.awardDic[e]){var t=game.BoonRechargeAwardCfg.getData(e,!0)||[];t.sort(this.sortById);for(var a=[],i=0;i<t.length;i++)a.push(t[i].gold);this.awardDic[e]=a}return this.awardDic[e]},sortById:function(e,t){return e.id<t.id?-1:1}});game.boonRechargeData=game.boonRechargeData||new e}(),function(){var e;e=b8e.Object.extends({currIndex:0,currTurns:0,speed:0,enter:0,maxEnter:0,isRuning:!1,frame:0,needFrame:0,targetTurns:2,thisArg:null,func:null,slowCount:5,addSpeed:50,slowRate:1,maxLen:0,bindEnum:0,start:function(e,t,a){var i=1<arguments.length&&void 0!==t?t:null,n=2<arguments.length&&void 0!==a?a:null,s=this;s.isRuning||(s.maxEnter=e+s.targetTurns*s.maxLen+1,s.func=i,s.thisArg=n,s.currTurns=0,s.currIndex=0,s.speed=s.slowCount,s.enter=0,s.isRuning=!0,s.frame=0,s.needFrame=0,s.timer||(s.timer=b8e.Timer.add(s,s.slowRun,10*s.slowRate),s.slowRun()),s.timer.start())},slowRun:function(){var e=this;if(e.frame<e.needFrame)e.frame++;else{if(e.frame=0,b8e.evt.dptG(game.BoonRechargeEvts.HORSERACELAMP_SELECTED,{bindEnum:e.bindEnum,index:e.currIndex}),e.enter++,e.currIndex++,e.enter>=e.maxLen*(e.currTurns+1)&&(e.currTurns++,e.currIndex=0),e.enter>=e.maxEnter)return e.thisArg&&e.func&&e.func.apply(e.thisArg),e.isRuning=!1,void e.timer.stop();e.enter<=e.slowCount&&e.speed--,e.enter>e.maxEnter-e.slowCount&&e.speed++;var t=e.speed*e.addSpeed;e.needFrame=Math.max(Math.floor(t/10),1)}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$HorseRaceLampPlug",e)}(),function(){var e=game.Control.extends({currData:null,itemNum:10,lastId:null,init:function(){this.data=game.boonRechargeData,this._alertOptions={lang:52289,title:game.Lang.get(52298),okcb:this.sureRefresh,thisArg:this},this.params={itemId:0}},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.syncData},MainRole:{C_RESET_DAILY:e.resetDaily},Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess}},e.gevts={BoonRechargeEvts:{HORSERACELAMP_SELECTED:e.selChanged}},e.handels={BoonRechargeResp:e.takeResp,BoonRechargeRefreshResp:e.gradeRefreshResp,BoonRechargeLogResp:e.logResp,BoonRechargeGradeMsg:e.gradeInitResp}},notify:function(e){switch(e){case this.Evts.V_SHOW:this.getCurData(),this.sender.BoonRechargeLogReq()}},getCurData:function(){this.currData=this.data.getCurActCfg(),this.currData?this.currData.grade<=0&&0<this.data.initGrade&&(this.currData.grade=this.data.initGrade):b8e.module.isShowView(game.ME.BoonRecharge)&&game.module.hide(game.ME.BoonRecharge)},syncData:function(e){e&&e.data&&e.data.boonRechargeId&&this.data.setInitData(e.data)},resetDaily:function(){this.getCurData(),this.currData&&(this.lastId&&this.currData.id!=this.lastId?b8e.module.isShowView(game.ME.BoonRecharge)&&game.module.hide(game.ME.BoonRecharge):this.lastId=this.currData.id)},rechargeSuccess:function(e){var t=this;if(t.currData&&t.currData.awardId&&e&&e.data){var a=e.data.id;if(0<a){var i=game.RechargeCfg.getDataById(a);if(i&&i.rechargeType==game.RechargeType.NORMAL&&i.money==t.currData.grade){t.currData.costNum++,t.awardData||(t.awardData={}),t.awardData.id=t.currData.awardId,t.awardData.grade=t.currData.grade;var n=game.BoonRechargeAwardCfg.getData(t.awardData);n&&(game.amount.changeAmount(game.AmountType.YUAN_BAO,n.gold),game.notice.show(52295,n.gold),t.dpt(t.Evts.C2C_POINT_ADD)),t.currData.awardId=null,t.send(t.Evts.C2V_AWARD_COUNT_UPDATE),t.sender.BoonRechargeLogReq()}}}},takeResp:function(e){var t=e.readProtobuf(game.pb.BoonRechargeResponse);if(0<t.code)game.notice.noticeError(t.code);else if(this.currData&&(this.currData.awardId=t.awardId),this.currData.awardId){var a=this.currData.awardId%this.itemNum;0==a&&(a=this.itemNum),this.runPlug.start(a-1,this.takeEnd,this)}},gradeRefreshResp:function(e){var t=e.readProtobuf(game.pb.BoonRechargeRefreshResponse);0<t.code?game.notice.noticeError(t.code):this.currData&&(this.currData.grade=t.grade,this.currData.awardId=null,this.send(this.Evts.C2V_GRADE_UPDTAE))},gradeInitResp:function(e){var t=e.readProtobuf(game.pb.BoonRechargeGradeNotify);0<t.code?game.notice.noticeError(t.code):(this.data.initGrade=t.grade,this.currData&&this.currData.grade<=0&&(this.currData.grade=t.grade,this.send(this.Evts.C2V_GRADE_UPDTAE)))},logResp:function(e){var t=e.readProtobuf(game.pb.BoonRechargeLogsResponse);0<t.code?game.notice.noticeError(t.code):(this.currData&&(this.currData.logs=t.logs),this.send(this.Evts.C2V_LOGS_UPDATE))},selChanged:function(e){var t=e.data;t.bindEnum==this.moduleEnum&&this.send(this.Evts.C2V_SELECT_UPDATE,t.index)},takeBtn:function(){var e=this;e.currData&&(e.currData.grade<=0||(e.runPlug||(e.runPlug=new game.HorseRaceLampPlug,e.runPlug.maxLen=e.itemNum,e.runPlug.bindEnum=e.moduleEnum),e.currData.costNum>=e.currData.count?game.notice.show(52297):e.runPlug.isRuning||(e.currData.awardId?e.recharge():e.sender.BoonRechargeReq())))},recharge:function(){var e=game.rechargeData.getIdByMonerAndType(this.currData.grade);this.params.itemId=e,game.sdk.pay(this.params)},takeEnd:function(){this.send(this.Evts.C2V_SELECTED_END)},refreshBtn:function(){this.currData.costNum>=this.currData.count?game.notice.show(52297):(this._alertOptions.langArgs=this.data.needPoint,game.alert.showTwo(this._alertOptions))},sureRefresh:function(){game.UpgradeUtil.checkAmountByType(game.AmountType.YUAN_BAO,this.data.needPoint)&&this.sender.BoonRechargeRefreshReq()}}),t=game.Sender.extends({ipc:function(){this.msg={BoonRechargeReq:null,BoonRechargeRefreshReq:null,BoonRechargeLogReq:null}}});b8e.module.registerControl(game.ME.BoonRecharge,e,game.BoonRechargeEvts,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("boonRecharge/BoonRechargeView")},init:function(){this.data=game.boonRechargeData},onShow:function(){this.send(this.Evts.V_SHOW),this.initData(),this.initView()},onHide:function(){this.timer&&this.timer.stop()},notify:function(e,t){var a=this;switch(e){case a.Evts.C2V_SELECT_UPDATE:a.selectedChanged(t);break;case a.Evts.C2V_GRADE_UPDTAE:a.gradeUpdateView(),a.updateGray();break;case a.Evts.C2V_SELECTED_END:a.updateGray();break;case a.Evts.C2V_AWARD_COUNT_UPDATE:a.updateAwardCount(),a.updateGray();break;case a.Evts.C2V_LOGS_UPDATE:a.updateLogs()}},initData:function(){this.currData=this.data.getCurActCfg(),this.currData&&this.currData.grade<=0&&0<this.data.initGrade&&(this.currData.grade=this.data.initGrade)},initView:function(){var e=this;e.currData&&(e.gradeUpdateView(),e.updateAwardCount(),e.updateGray(),e.updateLogs(),e.timer||(e.timer=b8e.Timer.add(e,e.updateTime,1e3)),e.timer.start(),e.updateTime())},gradeUpdateView:function(){if(this.currData){var e=this.skin,t=this.currData.grade;e.gradeLab.string=game.Lang.get(52287,t);for(var a=this.data.getAwardListByGradeId(t),i=void 0,n=0;n<a.length;n++)i=a[n],this.getComponent("num"+(n+1)).string=i}},updateGray:function(){var e=this;if(e.currData){var t=e.skin,a=void 0,i=e.data.getAwardListByGradeId(e.currData.grade).length;if(e.currData.awardId){a=game.ResCfg.getUrl(10139,e.currData.grade);var n=e.currData.awardId%i;0==n&&(n=i);for(var s=void 0,r=1;r<=i;r++)s=r!=n,game.ShaderUtil.setGray(e.getComponent("pointNode"+r),s);game.ShaderUtil.setGray(t.boonPan,!0),t.boonSel.active=!0,e.selectedChanged(n-1)}else{a=game.ResCfg.getUrl(10139,"no");for(var o=1;o<=i;o++)game.ShaderUtil.setGray(e.getComponent("pointNode"+o),!1);game.ShaderUtil.setGray(t.boonPan,!1),t.boonSel.active=!1}t.descImg.loadTexture(a)}},updateAwardCount:function(){this.currData&&(this.skin.countLab.string=game.Lang.get(52288,this.currData.count-this.currData.costNum))},updateLogs:function(){if(this.currData){var e="";if(this.currData.logs&&0<this.currData.logs.length)for(var t=this.currData.logs,a=void 0,i=0;i<t.length;i++)a=t[i],e+=game.Lang.get(52290,a.name,a.grade,a.num)+(i==t.length-1?"":"\n");this.skin.logsLab.string=e,this.skin.content.height=this.skin.logsLab.height}},selectedChanged:function(e){var t=this.skin;t.boonSel.active=!0,t.boonSel.rotation=36*e-90},updateTime:function(){var e=0;this.currData.endTime?e=b8e.TimeUtil.dateParse(this.currData.endTime,"yyyy-MM-dd hh:mm:ss").getTime()-game.SysTime.curTime:e=game.TimeUtil.getCountDown(this.currData.endDay);this.skin.timeLab.string=game.Lang.get(52296,game.TimeUtil.formatTimeSpace(e))}});b8e.module.registerView(game.ME.BoonRecharge,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_RESET_DAILY:b8e.enc(),V2C_GET_AWARDS:b8e.enc(),C2V_UPDATE_AWARDS_LIST:b8e.enc(),V2C_ON_SHOW:b8e.enc(),C2C_CLICK_SHELL_ICON:b8e.enc(),C2V_OPEN_SHELL:b8e.enc(),C2V_FRESH_SHELL:b8e.enc(),C2V_UPDATE_LOG:b8e.enc()}),b8e.RC("$$game","$$ShellEvts",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this.id=0,this.openDayNum=0,this.reqArr=[],this.logs=[],this.shellAwardArr=[],this.shellNumAward=[],this.shellMap=b8e.HashMap.get(),this.noticeAwardsArr=[]},getOpenId:function(){var e=game.ShellOpenCfg.getDatas();if(!e||e.length<1)return 0;for(var t=void 0,a=void 0,i=void 0,n=void 0,s=game.SysTime.curTime,r=game.miscData.openServerDay,o=e.length,g=this.endTime=0;g<o;g++)if((t=e[g]).startTime){if(n=1e3*((n=b8e.TimeUtil.dateParse(t.startTime,"yyyy-MM-dd hh:mm:ss").getTime())/1e3>>0),i=1e3*((i=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd hh:mm:ss").getTime())/1e3>>0),s<n||i<=s)continue;if((a=game.TimeUtil.getOpenDayByStr(t.startTime))>=t.serverStart&&a<t.serverEnd)return this.endTime=i,t.id}else if(t.serverStart<=r&&r<t.serverEnd)return this.endDay=t.serverEnd,t.id;return 0},createData:function(e){this.id=e,this.openDayNum=0;var t=this.shellMap;t.clear();for(var a=void 0,i=1;i<7;i++)a=new game.ShellInfo(i),t.set(i,a);this.createAwardArr()},createAwardArr:function(){var e=game.ShellNumAwardCfg.getDatas();if(e&&!(e.length<1))for(var t=e.length,a=this.shellAwardArr,i=void(a.length=0),n=void 0,s=0;s<t;s++)n=e[s],(i=new game.ShellAwardInfo).setData(n),a.push(i)},onSysData:function(e){this.openDayNum=e.shellDayNum,this.setShellOpen(e.shellData),this.shellNumAward=e.shellNumAward,this.updateAwards()},updateAwards:function(){for(var e=this.shellAwardArr,t=e.length,a=0;a<t;a++)e[a].updateInfo()},getAwardInfos:function(){return this.shellAwardArr.sort(this.awardsSort)},awardsSort:function(e,t){return!e.isHadGet&&t.isHadGet?-1:e.isHadGet&&!t.isHadGet?1:e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.num-t.num},onShellResp:function(e){this.openDayNum=e.shellDayNum,this.setNoticeAwards(e.shellData),this.setShellOpen(e.shellData),this.updateAwards()},setNoticeAwards:function(e){if(e&&!(e.length<1)){var t=this.noticeAwardsArr;t.length=0;for(var a=e.length,i=this.shellMap,n=void 0,s=void 0,r=0;r<a;r++)n=e[r],(s=i.get(n.id))&&!s.isOpen&&t.push(n)}},getNoticeAwards:function(){return this.noticeAwardsArr},setShellOpen:function(e){if(e&&!(e.length<1))for(var t=e.length,a=this.shellMap,i=void 0,n=void 0,s=0;s<t;s++)i=e[s],(n=a.get(i.id))&&n.setOpen(i)},onShellResetResp:function(){var e=this.getInfoArr();if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)e[a].setClose()},onGetShellNumAwardResp:function(e){this.shellNumAward.push(e.num),this.updateAwards()},setLogs:function(e){var t=e.logs;if(t&&t.length){var a=this.logs;a.length=0;for(var i=t.length,n=void 0,s=0;s<i;s++)n=this.getLogStr(t[s]),a.push(n)}},getLogStr:function(e){var t="",a=game.ItemInfoCfg.getData(e.itemId);return a?(t=game.HtmlUtil.getColorStrByQuality(a.quality,a.name+"*"+e.itemNum),t=game.Lang.get(52285,e.name,t)):t},getLogs:function(){return this.logs},getInfoByPos:function(e){return this.shellMap.get(e)},getSinglePosReqArr:function(e){var t=this.reqArr;return t.length=0,t.push(e),t},getReqArr:function(){for(var e=this.getInfoArr(),t=e.length,a=this.reqArr,i=void(a.length=0),n=0;n<t;n++)(i=e[n]).isOpen||a.push(i.pos);return a},getInfoArr:function(){return this.shellMap.values()},resetDaily:function(){this.previewAwards=null,this.openDayNum=0,this.updateAwards()},getSingleCost:function(){return this.singleCost||(this.singleCost=0|game.CfgUtil.getMiscValue(game.ShellMiscCfg,"shellCostGold")),this.singleCost},getFreshCost:function(){return this.freshCost||(this.freshCost=0|game.CfgUtil.getMiscValue(game.ShellMiscCfg,"shellResetGold")),this.freshCost},checkAwardsAlert:function(){for(var e=this.shellAwardArr,t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},getPreviewAwards:function(){if(!this.previewAwards){var e=game.ShellOpenCfg.getData(this.id);if(!e)return;var t=new game.CfgPrizeInfo;t.setup(e.previewAwards),this.previewAwards=t.items}return this.previewAwards},getEndRemainTime:function(){var e=0,t=game.SysTime.curTime;if(this.endTime)e=this.endTime;else{var a=this.endDay,i=game.miscData.openServerDay;e=b8e.TimeUtil.getNextDateTime(t,a-i)}return e-t},getFreeRemainTime:function(){var e=game.SysTime.curTime;return b8e.TimeUtil.getNextDateTime(e)-e}});game.shellData=game.shellData||new e}(),function(){var e;e=b8e.Object.extends({isOpen:!1,highest:!1,itemId:0,itemNum:0,ctor:function(e){this.pos=e},setOpen:function(e){this.isOpen=!0,this.itemId=e.itemId,this.itemNum=e.itemNum,this.highest=e.highest},setClose:function(){this.isOpen=!1,this.itemId=0,this.itemNum=0,this.highest=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShellInfo",e)}(),function(){var e;e=b8e.Object.extends({isHadGet:!1,canGet:!1,itemInfo:null,setData:function(e){this.cfg=e,this.num=e.num;var t=e.giveItems;if(t&&t.length){var a=t[0];this.itemInfo=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)}},updateInfo:function(){var e=game.shellData,t=e.shellNumAward;if(this.isHadGet=-1<t.indexOf(this.num),this.isHadGet)this.canGet=!1;else{var a=e.openDayNum;this.canGet=a>=this.num}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ShellAwardInfo",e)}(),function(){var e=game.Control.extends({init:function(){var e=this,t=game.spotAlert,a=game.SAE;e.shellAlert=t.set(a.SHELL),e.freeAlert=t.set(a.SHELL_FREE,a.SHELL),e.freshAlert=t.set(a.SHELL_FRESH,a.SHELL),e.awardsAlert=t.set(a.SHELL_AWARDS,a.SHELL),e.data=game.shellData,e.openOption={key:game.ME.Shell,lang:0,btn:game.Lang.get(9059),okcb:e.onOpenAlert,thisArg:e,args:[],langArgs:[],showtips:!0};var i=e.data.getFreshCost();e.freshOption={key:game.ME.ShellAward,lang:52274,btn:game.Lang.get(9059),okcb:e.onFreshAlert,thisArg:e,langArgs:[i],showtips:!0}},notify:function(e,t){switch(e){case this.Evts.V2C_ON_SHOW:this.sender.ShellLogReq();break;case this.Evts.V2C_GET_AWARDS:this.sender.GetShellNumAwardReq(t)}},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.onSysData},MainRole:{C_RESET_DAILY:e.resetDaily}},e.handels={ShellResp:e.onShellResp,ShellResetResp:e.onShellResetResp,GetShellNumAwardResp:e.onGetShellNumAwardResp,ShellLogResp:e.onShellLogResp},e.gevts={ShellEvts:{C2C_CLICK_SHELL_ICON:e.clickShell}}},onOpenAlert:function(e){this.sender.ShellReq(e)},onFreshAlert:function(){this.sender.ShellResetReq()},onSysData:function(e){if(e&&e.data){var t=this.data.getOpenId();if(t){var a=e.data,i=this.data;i.createData(t),i.onSysData(a),this.checkAlert()}}},resetDaily:function(){var e=this.data,t=e.getOpenId();t?(e.id!=t?e.createData(t):e.resetDaily(),this.checkAlert(),this.send(this.Evts.C2V_RESET_DAILY)):game.module.hide(this.moduleEnum)},clickShell:function(e){if(e&&e.data){var t=e.data,a=this.data.getSinglePosReqArr(t);this.openOption.lang=52294,this.openReq(a)}},openAllBtn:function(){var e=this.data,t=e.getReqArr(),a=0==e.openDayNum;this.openOption.lang=a?52272:52273,this.openReq(t)},openReq:function(e){if(e&&!(e.length<1)){var t=this.data,a=e.length,i=0==t.openDayNum;if(i&&1==a)this.sender.ShellReq(e);else{var n=t.getSingleCost(),s=n*a;if(s=i?s-n:s,game.amount.get(game.AmountType.YUAN_BAO)<s)game.notice.show(52271);else{var r=this.openOption;r.args[0]=e,r.langArgs[0]=s,game.alert.show(r)}}}},onShellResp:function(e){var t=e.readProtobuf(game.pb.ShellResponse);0<t.code?game.notice.noticeError(t.code):(this.data.onShellResp(t),this.checkAlert(),this.send(this.Evts.C2V_OPEN_SHELL),b8e.setTimeout(this.showNotice,this,800))},showNotice:function(){var e=this.data.getNoticeAwards();if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++)a=e[s],(i=game.ItemInfoCfg.getData(a.itemId))&&(n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),game.notice.show(52307,n,a.itemNum))},checkAlert:function(){this.checkFreeAlert(),this.checkFreshAlert(),this.checkAwardsAlert()},checkFreeAlert:function(){this.freeAlert.alert=this.data.openDayNum<1},checkFreshAlert:function(){var e=this.data.getReqArr();!e||e.length<1?this.freshAlert.alert=!0:this.freshAlert.alert=!1},checkAwardsAlert:function(){this.awardsAlert.alert=this.data.checkAwardsAlert()},freshBtn:function(){game.alert.show(this.freshOption)},freeFreshBtn:function(){this.sender.ShellResetReq()},onShellResetResp:function(e){var t=e.readProtobuf(game.pb.ShellResetResponse);0<t.code?game.notice.noticeError(t.code):(this.data.onShellResetResp(),this.checkFreshAlert(),this.send(this.Evts.C2V_FRESH_SHELL))},onShellLogResp:function(e){var t=e.readProtobuf(game.pb.ShellLogResponse);0<t.code?game.notice.noticeError(t.code):(this.data.setLogs(t),this.send(this.Evts.C2V_UPDATE_LOG))},onGetShellNumAwardResp:function(e){var t=e.readProtobuf(game.pb.GetShellNumAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.data.onGetShellNumAwardResp(t),this.checkAwardsAlert(),this.send(this.Evts.C2V_UPDATE_AWARDS_LIST))},awardBtn:function(){game.module.show(game.ME.ShellAward)}}),t=game.Sender.extends({ipc:function(){this.msg={ShellReq:this.shellReq,ShellResetReq:null,GetShellNumAwardReq:this.getShellNumAwardReq,ShellLogReq:null}},shellReq:function(e){var t=game.pb.ShellRequest;t.ids=e,this.write(t)},getShellNumAwardReq:function(e){var t=game.pb.GetShellNumAwardRequest;t.num=e,this.write(t)}}),a=[game.ME.ShellAward];b8e.module.registerControl(game.ME.Shell,e,game.ShellEvts,t,a)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1444),this.spotAlerts={SHELL_AWARDS:this.awardAlert}},awardAlert:function(e){this.skin.awardRed.active=e.alert},init:function(){var e=this.skin;this.data=game.shellData;var t=this.previewList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.layout.paddingLeft=12,t.layout.paddingTop=-6,t.layout.spacingX=25,t.addToParent(e.previewList);var a=game.IconSizeEnum.GRID_SIZE_42,i=game.GridUtil.createViewClickIcon(a);i.addToParent(e.freshIcon),i.setItemId(21);var n=game.GridUtil.createViewClickIcon(a);n.setItemId(21),n.addToParent(e.openAllIcon),e.freshCost.string=this.data.getFreshCost(),this.createIcons(),this.initLogsPara();var s=this.fingerAnima=b8e.Animator.get(game.AnimType.UI_EFFECT,1);s.addToParent(e.shellNode1),s.load(game.ResCfg.getUrl(5019,1001))},createIcons:function(){for(var e=this.iconList=[],t=void 0,a=void 0,i=1;i<7;i++)(a=this.data.getInfoByPos(i))&&((t=new game.ShellIcon).addToParent(this.getComponent("shellNode"+i)),t.setData(a),e.push(t))},initLogsPara:function(){var e=this;e.zeroY=e.skin.logsNode.y,e.tweenTime=5e3,e.space=50,e.itemNum=6,e.iconPos=1,e.infoIndex=e.itemNum-1,e.endY=e.zeroY+e.space},notify:function(e){var t=this;switch(e){case t.Evts.C2V_UPDATE_LOG:t.setLog();break;case t.Evts.C2V_OPEN_SHELL:case t.Evts.C2V_FRESH_SHELL:t.updateNum(),t.updateIcon();break;case t.Evts.C2V_RESET_DAILY:t.updateNum(),t.updatePreview()}},onShow:function(){this.updateNum(),this.showIcon(),this.updatePreview(),this.createTimer(),this.send(this.Evts.V2C_ON_SHOW)},updateNum:function(){var e=this.skin,t=this.data,a=t.openDayNum;e.countLab.string=a;var i=0==t.openDayNum;this.fingerAnima.setVisible(i),i&&this.fingerAnima.play(null,0);var n=t.getReqArr();if(n){var s=n.length,r=0==s;e.freeFreshBtn.active=r,e.nomalNode.active=!r;var o=r?52283:52282,g=t.getSingleCost();if(e.descLab.string=game.Lang.get(o,g),!r){var u=g*s;u=i?u-g:u,e.openAllCost.string=u}}},showIcon:function(){for(var e=this.iconList,t=e.length,a=0;a<t;a++)e[a].showIcon()},updateIcon:function(){for(var e=this.iconList,t=e.length,a=0;a<t;a++)e[a].updateIcon()},updatePreview:function(){var e=this.data.getPreviewAwards();!e||e.length<1||(this.previewList.setData(e),this.previewList.scrollToLeft(0))},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.skin,t=this.data.getEndRemainTime();if(t<0)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);e.endTimeLab.string=game.Lang.get(52280,a);var i=e.freeTimeLab;if(this.data.openDayNum){t=this.data.getFreeRemainTime();var n=game.TimeUtil.formatTimeSpace(t,3);i.string=game.Lang.get(52284,n)}else i.string=game.Lang.get(52281)}},setLog:function(){for(var e=this.logs=this.data.getLogs(),t=e.length,a=void 0,i=void 0,n=1;n<7;n++)i=n<t+1,((a=this.getComponent("logItem"+n)).active=i)&&(a.string=e[n-1]||0);5<t&&b8e.Tween.get(this.skin.logsNode).to({y:this.endY},this.tweenTime).call(this._scroll,this)},_scroll:function(){var e=this,t=e.logs,a=t.length,i=e.getComponent("logItem"+e.iconPos);i&&(i.y-=e.space*e.itemNum,e.iconPos++,e.infoIndex++,e.iconPos=e.iconPos>e.itemNum?1:e.iconPos,e.infoIndex=e.infoIndex>a-1?0:e.infoIndex,e.endY+=e.space,i.string=t[e.infoIndex],b8e.Tween.get(e.skin.logsNode).to({y:e.endY},e.tweenTime).call(e._scroll,e))},onHide:function(){this.clearTimer(),this.resetPos()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},resetPos:function(){var e=this,t=e.skin;b8e.Tween.kill(t.logsNode),t.logsNode.y=e.zeroY,e.iconPos=1,e.infoIndex=e.itemNum-1,e.endY=e.zeroY+e.space;for(var a=e.space,i=1;i<7;i++)e.getComponent("logItem"+i).y=-a*(i-1)}});b8e.module.registerView(game.ME.Shell,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1445)},init:function(){var e=this.skin;this.data=game.shellData;var t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.ShellAwardItem,t.bindEnum=game.ME.Shell,t.layout.paddingLeft=5,t.layout.paddingTop=3,t.layout.spacingY=6,t.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_AWARDS_LIST:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.data.getAwardInfos();this.list.setData(e)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(.5*(e-this.width)-6,.5*(t+this.height)+20)}});b8e.module.registerView(game.ME.ShellAward,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1446),this.setSize(540,126)},init:function(){this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.itemIcon)},setData:function(){var e=this.skin,t=this.data,a=t.itemInfo;if(a){this.icon.setItemInfo(t.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM);var i=game.ItemInfoCfg.getData(a.id);i&&(e.itemName=game.HtmlUtil.getColorStrByQuality(i.quality,i.name))}var n=game.shellData.openDayNum,s=t.num;e.countLab.string=game.Lang.get(52291,s);var r=n<s?52293:52292;e.countDesc.string=game.Lang.get(r,n,s),e.hsaGet.active=t.isHadGet,e.countDesc.active=!t.isHadGet,e.getBtn.active=t.canGet,e.gray.active=!t.isHadGet&&!t.canGet},getBtn:function(){this.send(game.ShellEvts.V2C_GET_AWARDS,this.data.num)}}),b8e.RC("$$game","$$ShellAwardItem",e)}(),function(){var e;e=b8e.BaseDisplay.extends({ctor:function(){this._super(),this.setSize(149,126),this.setAnchor(.5,.5),this.setPosition(0,0),b8e.evt.onC(this,this._fnOnClickGrid,this)},_fnOnClickGrid:function(){this.data&&(this.data.isOpen||b8e.evt.dptG(game.ShellEvts.C2C_CLICK_SHELL_ICON,this.data.pos))},setClickOpen:function(){this.openClick=!0},setData:function(e){this.data=e},showIcon:function(){var e=this.data;e&&(e.isOpen?this.setOpen():this.setClose())},updateIcon:function(){var e=this.data;e&&(e.isOpen&&!this._isOpen&&this.playOpenAnima(),!e.isOpen&&this._isOpen&&this.setClose())},playOpenAnima:function(){if(this.data){var e=this._openAnima;e||((e=this._openAnima=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).addFinishCallback(this.onComplete,this),e.load(game.ResCfg.getUrl(5019,1095)),e.setPosition(0,0),e.addToParent(this)),e.setVisible(!0),e.play(null,0),this._isOpen=!0}},onComplete:function(){this._openAnima.setVisible(!1),this.setOpen()},setOpen:function(){var e=this,t=e.data;if(t){e._closeImg&&e._closeImg.setVisible(!1);var a=e._openImg;if(!a){(a=e._openImg=b8e.Sprite.get()).setAnchor(.5,.5),a.addToParent(e),a.setPosition(0,0);var i=game.ResCfg.getUrl(10141);a.loadTexture(i)}a.setVisible(!0);var n=e._highestAnima;n||((n=e._highestAnima=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).load(game.ResCfg.getUrl(5019,1091)),n.setPosition(0,0),n.addToParent(e)),n.setVisible(t.highest),t.highest&&n.play(null,0),e.setLabBg(),e.showIconItem(),e._isOpen=!0}},setLabBg:function(){var e=this._labBg;e||((e=this._labBg=b8e.Sprite.get()).setStyle(b8e.SpriteStyle.SLICED),e.setAnchor(.5,.5),e.scale9Inset={top:8,bottom:8,left:11,right:11},e.loadTexture(game.ResCfg.getUrl(239)),e.setPosition(0,-54),e.setSize(84,24),e.addToParent(this)),e.setVisible(!0)},showIconItem:function(){var e=this.data;if(e&&e.itemId){var t=game.ItemUtil.createBaseItemInfo(e.itemId,e.itemNum,this.itemInfo),a=this._icon;a||((a=this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84)).setAnchor(.5,.5),a.setPosition(0,0),a.addToParent(this)),this._icon.setVisible(!0),game.GridUtil.setItemIcon(a,t,!1,game.IconLayoutEnum.SHOW_ALL);var i=game.ItemInfoCfg.getData(e.itemId);if(i&&i.name&&i.name.length){var n=5<i.name.length?6:i.name.length;n=12*n+30,this._labBg&&this._labBg.setSize(n,24)}}},setClose:function(){var e=this;e._openImg&&e._openImg.setVisible(!1),e._labBg&&e._labBg.setVisible(!1),e._highestAnima&&e._highestAnima.setVisible(!1),e._openAnima&&e._openAnima.setVisible(!1),e._icon&&e._icon.setVisible(!1);var t=e._closeImg;if(!t){(t=e._closeImg=b8e.Sprite.get()).setAnchor(.5,.5),t.addToParent(e),t.setPosition(0,0);var a=game.ResCfg.getUrl(10140);t.loadTexture(a)}t.setVisible(!0),e._isOpen=!1}});b8e.RC("$$game","$$ShellIcon",e)}(),function(){var e;e=b8e.Enum({NONE:0,SWITCH_PAGE:-1,V_UPDATE_VIEW:-1,V_PLAY_TWEEN:-1,C_SET_RANK_DATA:-1,C2C_REQUEST_RANKINFO:-1,V_UPDATE_RANK:-1,V2C_STOP_ANIM:-1}),b8e.RC("$$game","$$ScratchEvts",e)}(),function(){var e=game.Control.extends({isScratch:!1,init:function(){this.moduleData=game.surpriseScratchData,this.spotAlert=game.spotAlert.set(game.SAE.SCRATCH)},ipc:function(){this.evts={OpenServer:{C2C_INIT_OPENSERVER:this.setInitData},Back:{C2C_REMOVE_AMOUNT:this.removeAmount},MainRole:{C_RESET_DAILY:this.resetDaily},Rank:{C2C_GET_RACE_RANK_INFO:this.updateRankInfo}},this.handels={ScratchLogResp:this.scratchLogResp,ScratchDoResp:this.scratchDoResp,ScratchPushMsg:this.scratchPushMsg}},resetDaily:function(){this.checkOpen(),this.moduleData.resetData(),game.module.hide(game.ME.SurpriseScratch)},checkOpen:function(){var e=this.moduleData.checkActIsOpen(),t={openServerType:game.OpenServerType.SCRATCH,isActive:e,sae:game.SAE.SCRATCH};this.dptG(game.OpenServerGEvts.C2C_CHANGE_OPENSERVER,t)},setInitData:function(e){var t=e.data;this.checkOpen(),this.moduleData.setData(t),this.sender.ScratchLogReq(),this.checkAlert()},scratchLogResp:function(e){var t=e.readProtobuf(game.pb.ScratchLogResponse);0<t.code?game.notice.noticeError(t.code):this.moduleData.setScratchLog(t.logs)},scratchDoResp:function(e){var t=this,a=e.readProtobuf(game.pb.ScratchDoResponse);if(0<a.code)return game.notice.noticeError(a.code),t.moduleData.passAnim=!1,void(t.isScratch=!1);t.moduleData.number=a.number,t.items=a.award,t.logs=a.logs,t.moduleData.setScratchLog(a.logs),t.moduleData.passAnim?(t.moduleData.scratchTimes+=10,t.showAward()):(t.send(t.Evts.V_PLAY_TWEEN),t.moduleData.scratchTimes++),t.checkAlert()},showAward:function(){if(!this.getIsItems())return game.notice.show(52305),this.isScratch=!1,void this.send(this.Evts.V_UPDATE_VIEW);this.isScratch=!1,game.awardsData.setItemsByArray(this.items,!1),game.module.show(game.ME.AwardShowTip),this.send(this.Evts.V_UPDATE_VIEW)},getIsItems:function(){if(!this.logs)return!1;for(var e=this.logs.length,t=0;t<e;t++){if(0<this.logs[t].lucky.length)return!0}return!1},scratchPushMsg:function(e){var t=e.readProtobuf(game.pb.ScratchNumberNotify);0<t.code?game.notice.noticeError(t.code):(this.moduleData.scratchNumber=t.number+"",this.send(this.Evts.V_UPDATE_VIEW))},notify:function(e){switch(e){case this.Evts.C_SET_RANK_DATA:this.requestRank();break;case this.Evts.V2C_STOP_ANIM:this.showAward()}},requestRank:function(){var e=this.moduleData.rankId;this.dpt(this.Evts.C2C_REQUEST_RANKINFO,e)},updateRankInfo:function(e){var t=this.moduleData.rankId;e.data==t&&this.send(this.Evts.V_UPDATE_RANK)},scratchBtn:function(){this.moduleData.getSurplusTimes()<1?game.notice.show(52303):(this.moduleData.passAnim=!1,this.sendScratch(1))},sendScratch:function(e){this.isScratch||(this.sender.ScratchDoReq(e),this.isScratch=!0)},manyScratchBtn:function(){this.moduleData.getSurplusTimes()<10?game.notice.show(52304):(this.moduleData.passAnim=!0,this.sendScratch(2))},removeAmount:function(e){if(e&&e.data){this.moduleData.checkActIsOpen()&&(this.moduleData.setCurCont(e.data),this.checkAlert(),this.send(this.Evts.V_UPDATE_VIEW))}},record_btn:function(){game.module.show(game.ME.ScratchRecord)},checkAlert:function(){this.spotAlert.alert=0<this.moduleData.getSurplusTimes()},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},btn_3:function(){this.selectToggle(2)},btn_4:function(){this.selectToggle(3)},selectToggle:function(e){this.send(this.Evts.SWITCH_PAGE,e)}}),t=[game.ME.Scratch,game.ME.ScratchRank,game.ME.ScratchRecord,game.ME.ScratchRankReward,game.ME.ScratchLuckyRecord],a=game.Sender.extends({ipc:function(){this.msg={ScratchLogReq:null,ScratchDoReq:this.scratchDoReq}},scratchDoReq:function(e){var t=game.pb.ScratchDoRequest;t.doType=e,this.write(t)}});b8e.module.registerControl(game.ME.SurpriseScratch,e,game.ScratchEvts,a,t)}(),function(){var e=b8e.Object.extends({id:0,scratchNumber:0,scratchTimes:0,scratchGold:0,endDay:0,scratchLog:null,awardArr:null,rankRewardArr:null,luckyRecordArr:null,number:0,rankId:0,passAnim:!1,ctor:function(){this.scratchLog=[],this.awardArr=[],this.rankRewardArr=[],this.luckyRecordArr=[]},setData:function(e){e&&(this.id=e.scratchId,this.scratchNumber=e.scratchNumber.toString(),this.scratchTimes=e.scratchTimes,this.scratchGold=e.scratchGold,this.scratchLog.length=0,this.rankRewardArr.length=0,this.luckyRecordArr.length=0)},getSurplusTimes:function(){var e=game.ScratchMiscCfg.getData("scratchNeedGold");if(!e)return 0;var t=e.value;return Math.floor(this.scratchGold/t)-this.scratchTimes},getCurCfg:function(){var e=game.ScratchOpenCfg.getDatas();if(!e||e.length<1)return null;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.checkIsOpen(i))return 0==this.rankId&&(this.rankId=i.rankId),i.id}return null},setScratchLog:function(e){if(e)for(var t=e.length-1;0<=t;t--)this._addLog(e[t])},_addLog:function(e){var t=void 0,a=void 0;50<=this.scratchLog.length?(a=this.scratchLog[0],this.scratchLog.splice(0,1),a.setData(e),this.scratchLog.push(a)):((t=game.ScratchLogInfo.get()).setData(e),this.scratchLog.push(t))},getRankReward:function(){if(0<this.rankRewardArr.length)return this.rankRewardArr;var e=game.openCompetitionData.getRaceRankCfgById(this.rankId);if(!e)return 0;var t=game.openCompetitionData.getRaceRankAwardCfgById(e.awardId);if(!t)return 0;for(var a=t.length,i=void 0,n=0;n<a;n++){var s=t[n];(i=new game.ScratchRewardInfo).isType=!0,i.setData(s),this.rankRewardArr.push(i)}return this.rankRewardArr},getluckyRecord:function(){if(0<this.luckyRecordArr.length)return this.luckyRecordArr;var e=game.ScratchLuckyAwardCfg.getData(this.id,!0);if(!e)return 0;for(var t=e.length,a=void 0,i=0;i<t;i++){var n=e[i];(a=new game.ScratchRewardInfo).isType=!1,a.setData(n),this.luckyRecordArr.push(a)}return this.luckyRecordArr},getScratchLogList:function(){return this.scratchLog.length<1?0:this.scratchLog},checkActIsOpen:function(){return!!this.getCurCfg()},setCurCont:function(e){this.scratchGold+=e},resetData:function(){this.rankId=0;var e=this.getCurCfg();if(e){if(e==this.id)return;this.id=e}this.clearList(this.scratchLog),this.scratchLog.length=0,this.rankRewardArr.length=0,this.luckyRecordArr.length=0},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0},checkIsOpen:function(e){var t=game.miscData.openServerDay;return t>=e.serverStart&&t<e.serverEnd&&(0==this.endDay&&(this.endDay=e.serverEnd),!0)},getCountDown:function(){var e=this.endDay,t=game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,e-t)-game.SysTime.curTime}});game.surpriseScratchData=game.surpriseScratchData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({number:0,opTime:0,lucky:null,luckyLv:0,numberStr:"",ctor:function(){},setData:function(e){this.number=e.number,this.opTime=e.opTime,this.lucky=e.lucky,this.setLuckyLv(),this.setNumberStr()},setLuckyLv:function(){var e=this.lucky.length,t=game.surpriseScratchData;this.luckyLv=e<1?0:t.scratchNumber.length-(e-1)},setNumberStr:function(){if(this.lucky.length<1)this.numberStr=this.number;else{for(var e=this.number.toString().length,t=game.Color.RED,a="",i=1;i<=e;i++){var n=this.number.toString()[i-1];a+=-1!=this.lucky.indexOf(i)?game.HtmlUtil.getText(t,n):n}this.numberStr=a}},recycle:function(){this.reset(),this._super()},reset:function(){this.number=0,this.opTime=0,this.lucky=null,this.luckyLv=0,this.numberStr=""}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ScratchLogInfo",t)}(),function(){var e;e=b8e.Object.extends({prize:0,award:null,id:0,isType:!1,endRank:0,rank:0,ctor:function(){},setData:function(e){this.isType?this.rank=e.startRank<e.endRank?e.startRank+"-"+e.endRank:e.startRank:(this.prize=e.prize,this.rank=e.rank,this.id=e.id),this.award=e.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ScratchRewardInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1456),this.setSize(600,177)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Grid),this.list.itemRender=game.PrizeListItem,this.list.layout.spacingX=20,this.list.addToParent(this.skin.list)},setData:function(e){this.skin.name.string=e.isType?game.Lang.get(52300,e.rank):game.Lang.get(52301,e.rank,e.prize);var t=game.CfgUtil.getPrizeListInfo(e.award,null,game.IconSizeEnum.GRID_SIZE_105);t&&this.list.setData(t.items)}}),b8e.RC("$$game","$$ScratchRankRewardItme",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1455),this.setSize(600,127)},setData:function(){this.onClear();var e=this.data;if(e){var t=this.skin;t.rank.node.active=3<e.rank,t.rank.string=e.rank+"",t.name.string=e.name,t.score.string=e.score+"";var a=e.rank;if(3<a){this.skin.rank4.node.active=!0}else this.getComponent("rank"+a).node.active=!0}else;},onClear:function(){this.skin;for(var e=1;e<5;e++){this.getComponent("rank"+e).node.active=!1}}}),b8e.RC("$$game","$$ScratchRankItme",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1457),this.setSize(560,65)},setData:function(e){var t=this.skin;if(t.num.string=e.numberStr,t.biaoqian.active=0<e.luckyLv,0<e.luckyLv){var a=game.ResCfg.getUrl(10142,e.luckyLv);t.lvReward.loadTexture(a)}t.time.string=b8e.TimeUtil.formatTimestamp(1e3*e.opTime)}}),b8e.RC("$$game","$$ScratchRecordItme",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1451),this.toggles={toggle_btn_1:game.ME.Scratch,toggle_btn_2:game.ME.ScratchRank,toggle_btn_3:game.ME.ScratchRankReward,toggle_btn_4:game.ME.ScratchLuckyRecord},this.spotAlerts={SCRATCH:this.scratchAlert}},scratchAlert:function(e){this.skin.red_spot_1.active=e.alert},onShow:function(){this.toggleSelect(0)},notify:function(e,t){switch(e){case game.MyMapEvts.SWITCH_PAGE:this.toggleSelect(t)}},toggleSelect:function(e){this._super(e)},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.SurpriseScratch,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1458)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ScratchRecordItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.SurpriseScratch},onShow:function(){var e=this.skin,t=game.surpriseScratchData.getScratchLogList();this.list.setData(t),e.huawen_1.width=b8e.stageWidth+100,e.pathNode.setPosition(325,e.gray.y-e.gray.height)},onStageResize:function(){this._super(),this.skin.gray.setSize(b8e.stageWidth+50,690)}});b8e.module.registerView(game.ME.ScratchRecord,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1453)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ScratchRankItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.SurpriseScratch,this.moduleData=game.surpriseScratchData},onShow:function(){this.send(this.Evts.C_SET_RANK_DATA)},notify:function(e){switch(e){case this.Evts.V_UPDATE_RANK:this.updateList()}},updateList:function(){var e=this.moduleData.rankId,t=game.raceRankData.getRankInfoArrByType(e);this.list.setData(t);var a=game.raceRankData.getSelfRankInfo(e);a&&(this.skin.rankNum.string=a.rank,this.skin.rankName.string=a.name,this.skin.rankScore.string=a.score,this.skin.rank_node.active=a.rank,this.skin.rank_lab.active=!a.rank)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ScratchRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1452)},init:function(){this.moduleData=game.surpriseScratchData},onShow:function(){this.updateView(),this.skin.bg_3.width=415,this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3)),this.skin.des.string=game.Lang.get(52302)},notify:function(e){switch(e){case this.Evts.V_PLAY_TWEEN:this.startAnim(),this.updateView();break;case this.Evts.V_UPDATE_VIEW:this.updateView()}},updateActTime:function(){var e=this.moduleData.getCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.time.string=game.Lang.get(51819,t)):(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},startAnim:function(){var e=this.skin;e.bg_3.width=415,b8e.Tween.kill(e.bg_3),b8e.Tween.get(e.bg_3).to({width:0},1e3).call(this.stopAnim,this)},stopAnim:function(){var e=this.skin;b8e.Tween.kill(e.bg_3),this.send(this.Evts.V2C_STOP_ANIM)},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateView:function(){var e=this.skin;e.lucky_num.string=this.moduleData.scratchNumber,e.surplusTimes.string=game.Lang.get(52299,this.moduleData.getSurplusTimes()),e.num.string=this.moduleData.number,e.redPoint1.active=0<this.moduleData.getSurplusTimes(),e.redPoint2.active=10<=this.moduleData.getSurplusTimes()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.Scratch,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1454)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ScratchRankRewardItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.SurpriseScratch},onShow:function(){var e=game.surpriseScratchData.getluckyRecord();this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ScratchLuckyRecord,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1454)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.ScratchRankRewardItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.SurpriseScratch},onShow:function(){var e=game.surpriseScratchData.getRankReward();this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.ScratchRankReward,e)}(),function(){var e;e=b8e.Enum({NONE:0,SWITCH_PAGE:-1,V_BATTLE_SELECT_CHANGE:-1,V_SURVIVAL_SELECT_CHANGE:-1,V_UPDATE_LIST:-1,SHOW_SKILL_DETAILS:-1,C_SEND_ASSIST:-1,C_JIA:-1,C_JIAN:-1,V_UIDATE_NUM:-1,C_SEND_SPEED:-1,C2V_UPDATE_TIME:-1,V_UPDATE_ASSIST_VIEW:-1,C_UPDATE_TIME:-1,C_UPDATE_ASSIST:-1,C2V_UPDATE_ALERT:-1,C2V_SEND_ASSIST:-1}),b8e.RC("$$game","$$TribalResearchEvts",e)}(),function(){var e=game.Control.extends({btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.SWITCH_PAGE,e)}});b8e.module.registerControl(game.ME.TribalResearch,e,game.TribalResearchEvts)}(),function(){var e=game.Control.extends({speedId:0,init:function(){this.spotAlert=game.spotAlert.set(game.SAE.TRIBAL_RESEARCH,game.SAE.GUILD),this.battleAlert=game.spotAlert.set(game.SAE.TRIBAL_BATTLE,game.SAE.TRIBAL_RESEARCH),this.survivalAlert=game.spotAlert.set(game.SAE.TRIBAL_SURVIVAL,game.SAE.TRIBAL_RESEARCH),this.assistAlert=game.spotAlert.set(game.SAE.TRIBAL_ASSIST,game.SAE.GUILD),this.moduleData=game.tribalResearchData,this.roleId=game.mainRole.id,this.noticeAlert={lang:52424,btn:game.Lang.get(9059),okcb:this.expedite,thisArg:this,args:[],langArgs:[],showtips:!1,defaultSelect:!0,align:b8e.HorizontalAlign.CENTER}},ipc:function(){var e=this;e.evts={MainRole:{C_RESET_DAILY:e.resetDaily},Back:{C_BACK_SYN_BACK_INFO:e.updateItme,C_BACK_UPDATE_ITEMINFO:e.updateItme},Guild:{C_UPDATE_GUILD:e.checkAlert}},e.handels={TribesTechStudyResp:e.tribesTechStudyResp,TribesTechStudyNotify:e.tribesTechStudyNotify,TribesTechStudyDoneResp:e.tribesTechStudyDoneResp,TribesTechAccelerateResp:e.tribesTechAccelerateResp,TribesTechTimeNotify:e.tribesTechTimeNotify,TribesTechAssistantResp:e.tribesTechAssistantResp,TribesTechAssistantMsg:e.tribesTechAssistantMsg,TribesTechAssistMsg:e.tribesTechAssistMsg}},notify:function(e,t){var a=this;switch(e){case a.Evts.SHOW_SKILL_DETAILS:a.moduleData.setSelsct(t),game.module.show(game.ME.TribalSkillDetails);break;case a.Evts.C_JIA:a.updateNnm(t,!0);break;case a.Evts.C_JIAN:a.updateNnm(t,!1);break;case a.Evts.C_SEND_SPEED:a.sendAccelerate(t);break;case a.Evts.C_SEND_ASSIST:a.sendAssist(t);break;case a.Evts.C2V_UPDATE_ALERT:a.checkAlert();break;case a.Evts.C2V_SEND_ASSIST:a.dpt(a.Evts.C_UPDATE_ASSIST)}},resetDaily:function(){this.moduleData.assistantNum=0},checkAlert:function(){this.spotAlert.alert=this.moduleData.isGetAlear,this.checkSurvivalAlert(),this.checkBattleAlert(),this.checkAssistAlert()},checkSurvivalAlert:function(){this.survivalAlert.alert=this.moduleData.isGetAlear},checkBattleAlert:function(){this.battleAlert.alert=this.moduleData.isGetAlear},checkAssistAlert:function(){var e=this.moduleData.getAssistList().length,t=this.moduleData.dailyNum-this.moduleData.assistantNum;this.assistAlert.alert=0<e&&0<t},updateNnm:function(e,t){var a=this.moduleData.getSkillSpeedInfo(e),i=game.itemData.getNumById(a.itmeId);if(a){if(t)0<i?a.num<i&&a.num++:a.num++;else{if(1==a.num)return;a.num--}this.send(this.Evts.V_UIDATE_NUM)}},updateItme:function(){if(b8e.module.isShowView(game.ME.TribalSkillSpeed)&&0<this.speedId){var e=this.moduleData.getSkillSpeedInfo(this.speedId),t=game.itemData.getNumById(e.itmeId);e.count=t,this.send(this.Evts.V_UIDATE_NUM)}},expedite:function(e,t){var a=this.moduleData.getSkillSpeedInfo(e);a&&(1==t?this.sender.TribesTechAccelerateReq(a.id,a.num,0):this.sender.TribesTechAccelerateReq(a.id,0,a.num),this.speedId=a.id)},sendAccelerate:function(e){var t=this,a=t.moduleData.getSkillSpeedInfo(e);if(a){var i=game.itemData.getNumById(a.itmeId),n=t.moduleData.getCountDown(),s=a.num*a.price;t.number=0;var r=a.num*a.reduceMin*b8e.TimeUtil.MINUTE_MICRO_SECONDS;n<0?game.notice.show(52427):0<i?n<=r?(t.noticeAlert.args[0]=e,t.noticeAlert.args[1]=2,game.alert.show(t.noticeAlert)):(t.sender.TribesTechAccelerateReq(a.id,0,a.num),t.speedId=a.id):game.amount.get(game.AmountType.YUAN_BAO)<s?game.notice.show(116):n<=r?(t.noticeAlert.args[0]=e,t.noticeAlert.args[1]=1,game.alert.show(t.noticeAlert)):(t.sender.TribesTechAccelerateReq(a.id,a.num,0),t.speedId=a.id)}},sendAssist:function(e){var t=this.moduleData.getAssistInfo(e);if(t)if(game.SysTime.curTime>=t.completeTime)game.notice.show(52439);else{var a=[];a.push(e),this.sender.TribesTechAssistantReq(a)}},sendFastAssist:function(){var e=[],t=this.moduleData.getAssistList();if(t){var a=t.length,i=game.SysTime.curTime;if(!(a<1)){for(var n=0;n<a;n++){var s=t[n];i>=s.completeTime?game.notice.show(52439):e.push(s.memberId)}this.sender.TribesTechAssistantReq(e)}}},tribesTechStudyResp:function(e){var t=e.readProtobuf(game.pb.TechStudyResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.moduleData.selectId,i=this.moduleData.type;this.moduleData.conductType=i,this.moduleData.conductId=a,this.moduleData.isStudy=!0,game.module.hide(game.ME.TribalSkillDetails),this.send(this.Evts.C2V_UPDATE_TIME)}},tribesTechStudyNotify:function(e){var t=this,a=e.readProtobuf(game.pb.StudyTech);0<a.code?game.notice.noticeError(a.code):(t.moduleData.setAssistInfoData(a),t.checkAlert(),t.send(t.Evts.V_UPDATE_ASSIST_VIEW),t.send(t.Evts.C2V_UPDATE_TIME),t.dpt(t.Evts.C_UPDATE_TIME),0<t.moduleData.dailyNum-t.moduleData.assistantNum&&t.dpt(t.Evts.C_UPDATE_ASSIST))},tribesTechTimeNotify:function(e){var t=this,a=e.readProtobuf(game.pb.TechUpdateNotify);0<a.code?game.notice.noticeError(a.code):(a.memberId==t.roleId?t.moduleData.setCompleteTime(a.completeTime):(t.moduleData.updateAssist(a),t.send(t.Evts.V_UPDATE_ASSIST_VIEW)),t.checkAlert(),t.send(t.Evts.C2V_UPDATE_TIME),t.dpt(t.Evts.C_UPDATE_TIME),0<t.moduleData.dailyNum-t.moduleData.assistantNum&&t.dpt(t.Evts.C_UPDATE_ASSIST))},tribesTechStudyDoneResp:function(e){var t=e.readProtobuf(game.pb.TechDoneResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.moduleData.conductType,i=this.moduleData.conductId;this.moduleData.setSkillLv(a,i),this.moduleData.isStudy=!1,game.FightAmount.inst().showTeamStatPower(),game.module.hide(game.ME.TribalSkillDetails),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_TIME),this.dpt(this.Evts.C_UPDATE_TIME)}},tribesTechAccelerateResp:function(e){var t=e.readProtobuf(game.pb.TechAccelerateResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.moduleData.conductType,i=this.moduleData.conductId,n=this.moduleData.getInfo(a,i);n&&(t.free&&(n.free=t.free,game.notice.show(52423)),this.send(this.Evts.C2V_UPDATE_TIME))}},tribesTechAssistantResp:function(e){var t=e.readProtobuf(game.pb.TechAssistantResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.assistantNum+=t.targetsId.length,game.awardsData.setItemsByArray(t.items,!1),this.moduleData.clearAssistList(t.targetsId),game.module.show(game.ME.AwardShowTip),this.send(this.Evts.V_UPDATE_ASSIST_VIEW),this.send(this.Evts.C2V_UPDATE_TIME),this.dpt(this.Evts.C_UPDATE_ASSIST))},tribesTechAssistantMsg:function(e){var t=this,a=e.readProtobuf(game.pb.TechAssistantBatchNotify);0<a.code?game.notice.noticeError(a.code):(t.moduleData.updateAssistList(a.msgs),t.checkAlert(),t.send(t.Evts.C2V_UPDATE_TIME),t.dpt(t.Evts.C_UPDATE_TIME),0<t.moduleData.dailyNum-t.moduleData.assistantNum&&t.dpt(t.Evts.C_UPDATE_ASSIST))},tribesTechAssistMsg:function(e){var t=e.readProtobuf(game.pb.TechAssistMsg);0<t.code?game.notice.noticeError(t.code):game.notice.show(52422,t.name)},survivalSpeedBtn:function(){this.openSkillSpeed()},battleSpeedBtn:function(){this.openSkillSpeed()},detailsSpeedBtn:function(){game.module.hide(game.ME.TribalSkillDetails),this.openSkillSpeed()},openSkillSpeed:function(){game.module.show(game.ME.TribalSkillSpeed)},completeBtn:function(){this.sendComplete(),game.module.hide(game.ME.TribalSkillSpeed)},researchBtn:function(){var e=this.moduleData.selectId,t=this.moduleData.type,a=this.moduleData.getInfo(t,e),i=this.moduleData.getCfg(t,a.id,a.lv+1);a&&i&&(game.amount.get(game.AmountType.KEJI_DIAN)<i.costItems[0].Num?game.notice.show(52421):this.sender.TribesTechStudyReq(t,e))},preBtn:function(){game.module.show(game.ME.TribalSkillTips)},fastBtn:function(){this.sendFastAssist()},battleFreeSpeedBtn:function(){this.sendFreeSpeed()},survivalFreeSpeedBtn:function(){this.sendFreeSpeed()},detailsFreeBtn:function(){game.module.hide(game.ME.TribalSkillDetails),this.sendFreeSpeed()},sendFreeSpeed:function(){this.sender.TribesTechAccelerateReq(0,0,0)},battleCompleteBtn:function(){this.sendComplete()},survivalCompleteBtn:function(){this.sendComplete()},studyCompleteBtn:function(){this.sendComplete()},sendComplete:function(){this.sender.TribesTechStudyDoneReq()},btn_1:function(){this.battleSelectChange(0)},btn_2:function(){this.battleSelectChange(1)},btn_3:function(){this.battleSelectChange(2)},btn_4:function(){this.battleSelectChange(3)},btn_5:function(){this.battleSelectChange(4)},survivalBtn_1:function(){this.survivalSelectChange(0)},survivalBtn_2:function(){this.survivalSelectChange(1)},battleSelectChange:function(e){this.moduleData.battleSelectId=e+1,this.send(this.Evts.V_BATTLE_SELECT_CHANGE,e)},survivalSelectChange:function(e){this.moduleData.surviveSelectId=e+1,this.send(this.Evts.V_SURVIVAL_SELECT_CHANGE,e)}}),t=[game.ME.TribalSurvival,game.ME.TribalSkillSpeed,game.ME.TribalAssist,game.ME.TribalSkillDetails,game.ME.TribalSkillTips],a=game.Sender.extends({ipc:function(){this.msg={TribesTechStudyReq:this.tribesTechStudyReq,TribesTechStudyDoneReq:null,TribesTechAccelerateReq:this.tribesTechAccelerateReq,TribesTechAssistantReq:this.tribesTechAssistantReq}},tribesTechStudyReq:function(e,t){var a=game.pb.TechStudyRequest;a.types=e,a.techId=t,this.write(a)},tribesTechAccelerateReq:function(e,t,a){var i=game.pb.TechAccelerateRequest;i.id=e,i.buyNum=t,i.itemNum=a,this.write(i)},tribesTechAssistantReq:function(e){var t=game.pb.TechAssistantRequest;t.targetsId=e,this.write(t)}});b8e.module.registerControl(game.ME.TribalBattle,e,game.TribalResearchEvts,a,t)}(),function(){var e;e=b8e.Object.extends({memberId:0,studyType:0,studyTechId:0,studyLv:0,completeTime:0,num:0,leave:!1,name:"",ctor:function(){},setData:function(e){e&&(this.memberId=e.memberId,this.studyType=e.studyType,this.studyTechId=e.studyTechId,this.studyLv=e.studyLv,this.completeTime=e.studyComplete,this.num=e.num)},updateData:function(e){this.leave=e.leave,this.completeTime=e.completeTime,0!=e.num&&(this.num=e.num)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalAssistInfo",e)}(),function(){var e;e=b8e.Enum({$$NONE:0,$$MAIN_TASK_EXP:1,$$QUAN_MINBOSS_EXP:2,$$QUICK_BATTLE_EXP:3,$$QUICK_BATTLE_GOLD:4,$$TEAM_INS_EXP:5,$$EXP_INS_EXP:6,$$PERSON_BOSS_EXTRA:7,$$GOLD_INS_EXTRA:8,$$QIANGHUA_INS_EXTRA:9,$$PARTNER_INS_EXTRA:10,$$BREAK_INS_EXTRA:11,$$CHUILIAN_INS_EXTRA:12,$$ARENA_EXTRA:13,$$TIME_REDUCE:14,$$HOUSE_INS_EXTRA:15,$$GUARD_INS_EXTRA:16,$$instanceSilver:17,$$expINSExtra:18}),b8e.RC("$$game","$$TribalPrivilegeType",e)}(),function(){var e;e=b8e.Object.extends({stage:0,group:0,ctor:function(){this.battleInfoMap=b8e.HashMap.get()},initData:function(e){if(e)for(var t=e.length,a=void 0,i=game.tribalResearchData,n=0;n<t;n++){var s=e[n];(a=new game.TribalBattleInfo).initData(s),a.group=this.group,i.battleInfoMap.set(s.id,a),this.battleInfoMap.set(s.id,a)}},getInfo:function(e){return this.battleInfoMap.get(e)},getList:function(){return this.battleInfoMap.values()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalBattleStageInfo",e)}(),function(){var e;e=b8e.Object.extends({stage:0,name:"",group:0,ctor:function(){this.surviveInfoMp=b8e.HashMap.get()},initData:function(e){if(e)for(var t=e.length,a=void 0,i=game.tribalResearchData,n=0;n<t;n++){var s=e[n];(a=new game.TribalSurviveInfo).initData(s),this.name=s.name,a.group=this.group,i.surviveInfoMp.set(s.id,a),this.surviveInfoMp.set(s.id,a)}},getInfo:function(e){return this.surviveInfoMp.get(e)},getList:function(){return this.surviveInfoMp.values()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalSurviveStageInfo",e)}(),function(){var e;e=b8e.Object.extends({group:0,alert:!1,name:"",stage:0,id:0,ctor:function(){this.stageMp=b8e.HashMap.get(),this.stageInfoMp=b8e.HashMap.get()},initData:function(e){this.group=e;var t=game.TribesTechBattleBaseCfg.getData(e,!0);if(t){for(var a=t.length,i=void 0,n=0;n<a;n++){if(!(i=t[n]))return;var s=i.stage;this.name=i.name;var r=this.stageMp.get(s);r||(r=[],this.stageMp.set(s,r)),r.push(i)}this.setStageData()}},setStageData:function(){var e=this.getStageList();if(e){var t=e.length;if(!(t<1))for(var a=void 0,i=0;i<t;i++){var n=e[i],s=i+1;(a=new game.TribalBattleStageInfo).stage=s,a.group=this.group,a.initData(n),this.stageInfoMp.set(s,a)}}},getStageInfoList:function(){return this.stageInfoMp.values()},getStageList:function(){return this.stageMp.values()},getStageInfo:function(e){return this.stageInfoMp.get(e)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalBattleGroupInfo",e)}(),function(){var e;e=b8e.Object.extends({group:0,id:0,lv:0,conditionId:null,costItems:null,costTime:0,skillId:0,stage:0,itemId:0,num:0,type:1,name:"",active:!1,maxLv:0,skillIcon:0,canGet:!1,isGet:!1,free:!1,endTime:0,quality:0,width:0,posX:0,maxStage:!1,abchor:!1,ctor:function(){},initData:function(e){var t=this,a=game.tribalResearchData;t.id=e.id,t.stage=e.stage,t.maxLv=e.maxLv,t.skillIcon=e.skillIcon,t.quality=e.quality,t.posX=e.posX,t.width=e.width,t.maxStage=e.maxStage,t.abchor=e.abchor;var i=a.getBattleCfg(t.id,t.lv);i&&(i.conditionId.length<1&&(t.active=!0),t.conditionId=i.conditionId,t.costTime=i.costTime,t.name=i.name,i.costItems[0]&&(t.itemId=i.costItems[0].Id,t.num=i.costItems[0].Num))},setData:function(e){var t=this,a=game.tribalResearchData;t.id=e.id,t.lv=e.lv,t.active=!0;var i=a.getBattleCfg(t.id,t.lv);i&&(t.conditionId=i.conditionId,t.costTime=i.costTime,t.itemId=i.costItems[0].Id,t.num=i.costItems[0].Num,t.name=i.name)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalBattleInfo",e)}(),function(){var e=b8e.Object.extends({battleTech:null,surviveGroup:null,assistantNum:0,studyingTech:null,battleSelectId:0,surviveSelectId:0,assistArr:null,freeAccelerate:!1,startTime:0,endTime:0,type:1,selectId:0,conductType:1,conductId:0,isInit:!1,isStudy:!1,isGetAlear:!1,dailyNum:0,ctor:function(){this.battleMap=b8e.HashMap.get(),this.surviveMap=b8e.HashMap.get(),this.surviveInfoMp=b8e.HashMap.get(),this.battleInfoMap=b8e.HashMap.get(),this.skillSpeedMp=b8e.HashMap.get(),this.assistMap=b8e.HashMap.get(),this.roleAssistMap=b8e.HashMap.get()},setData:function(e){this.roleId=game.mainRole.id,this.battleTech=e.battleTech,this.surviveTech=e.surviveTech,this.assistantNum=e.assistantNum,this.freeAccelerate=e.freeAccelerate;var t=game.TribesTechMiscCfg.getData("tribesTechDailyNum");t&&(this.dailyNum=t.value)},initData:function(){this.initBattleData(),this.initSurviveData(),this.setBattleData(),this.setSurviveData(),this.setStudyingTech()},initBattleData:function(){var e=game.TribesTechMiscCfg.getData("battleMaxTab");if(e)for(var t=e.value,a=void 0,i=0;i<t;i++){var n=i+1;0==this.battleSelectId&&(this.battleSelectId=n),(a=new game.TribalBattleGroupInfo).initData(n),this.battleMap.set(n,a)}},initSurviveData:function(){var e=game.TribesTechMiscCfg.getData("surviveMaxTab");if(e)for(var t=e.value,a=void 0,i=0;i<t;i++){var n=i+1;0==this.surviveSelectId&&(this.surviveSelectId=n),(a=new game.TribalSurviveGroupInfo).initData(n),this.surviveMap.set(n,a)}},setBattleData:function(){var e=this.battleTech.length;if(!(e<1))for(var t=void 0,a=0;a<e;a++){var i=this.battleTech[a];(t=this.getBattleInfo(i.id))&&(t.setData(i),this.updateActive(t,1))}},setSurviveData:function(){var e=this.surviveTech.length;if(!(e<1))for(var t=void 0,a=0;a<e;a++){var i=this.surviveTech[a];(t=this.getSurviveInfo(i.id))&&(t.setData(i),this.updateActive(t,2))}},setStudyingTech:function(){var e=this,t=e.studyingTech;if(t)if(e.isInit){e.conductType=t.studyType,e.conductId=t.studyTechId,e.isStudy=!0;var a=e.getInfo(e.conductType,e.conductId);a&&(a.free||(a.free=e.freeAccelerate),e.setCompleteTime(t.studyComplete))}else e.endTime=t.studyComplete},updateActive:function(e,t){var a=this.getConditionList(e,t);if(a)for(var i=a.length,n=void 0,s=0;s<i;s++)n=a[s],this.isActive(n,t)&&(n.active=!0)},getConditionList:function(e,t){var a=void 0,i=void 0;if(!(a=1==t?this.getBattleGroupInfo(e.group):this.getSurviveGroupInfo(e.group)))return null;if(!(i=a.stageInfoMp.get(e.stage+1))){if(!(a=1==t?this.getBattleGroupInfo(e.group+1):this.getSurviveGroupInfo(e.group+1)))return null;i=a.stageInfoMp.get(1)}return i?i.getList():null},isActive:function(e,t){if(!e)return!1;var a=e.conditionId.length;if(a<1)return!0;for(var i=0;i<a;i++){var n=e.conditionId[i],s=game.TribesTechConditionCfg.getData(n),r=this.getInfo(t,s.techId);if(!s)return!1;if(r.lv<s.lv)return!1}return!0},setSkillLv:function(e,t){var a=this.getInfo(e,t);if(a){if(a.lv++,a.isGet=!1,a.canGet=!1,a.free=!1,this.isGetAlear=!1,this.conductType=0,this.conductId=0,2==e){var i=this.getSurviveCfg(t,a.lv);a.privilegeId=i.privilegeId}this.updateActive(a,e)}},setCompleteTime:function(e){this.endTime=e;var t=this.endTime-game.SysTime.curTime,a=this.getInfo(this.conductType,this.conductId);a&&(t<0?(a.isGet=!0,a.free=!0,this.isGetAlear=!0,a.canGet=!1):(a.isGet=!1,this.isGetAlear=!1,a.canGet=!0))},setIsGet:function(e){e.isGet=!0,e.canGet=!1,this.isGetAlear=!0},getCountDown:function(){return this.endTime-game.SysTime.curTime},getUpInfo:function(){return this.getInfo(this.conductType,this.conductId)},setSelsct:function(e){this.type=e.type,this.selectId=e.id},getCfg:function(e,t,a){return 1==e?this.getBattleCfg(t,a):this.getSurviveCfg(t,a)},getInfo:function(e,t){return 1==e?this.getBattleInfo(t):this.getSurviveInfo(t)},getBattleInfo:function(e){return this.battleInfoMap.get(e)},getSurviveInfo:function(e){return this.surviveInfoMp.get(e)},getSurviveGroupInfo:function(e){return this.surviveMap.get(e)},getSurviveGroupList:function(){return this.surviveMap.values()},getBattleGroupList:function(){return this.battleMap.values()},getBattleGroupInfo:function(e){return this.battleMap.get(e)},getBattleCfg:function(e,t){this.gObj||(this.gObj={});var a=this.gObj;return a.id=e,a.lv=t,game.TribesTechBattleCfg.getData(a)},getSurviveCfg:function(e,t){this.gObj||(this.gObj={});var a=this.gObj;return a.id=e,a.lv=t,game.TribesTechSurviveCfg.getData(a)},setSkillSpeed:function(){var e=game.TribesTechAccelerateCfg.getDatas();if(e){var t=e.length;if(!(t<1))for(var a=void 0,i=0;i<t;i++){var n=e[i];(a=this.skillSpeedMp.get(n.id))||(a=new game.TribalSkillSpeedInfo,this.skillSpeedMp.set(n.id,a)),a.setData(n)}}},getSkillSpeedInfo:function(e){return this.skillSpeedMp.get(e)},getSkillSpeedList:function(){return this.skillSpeedMp.values()},setAssistData:function(e){if(e){var t=e.length;if(t<1)this.assistMap.clear();else for(var a=void 0,i=game.mainRole.id,n=0;n<t;n++){var s=e[n];s.memberId!=i?((a=this.assistMap.get(s.memberId))||(a=new game.TribalAssistInfo,this.assistMap.set(s.memberId,a)),a.setData(s)):(this.studyingTech=s,this.setStudyingTech())}}},setAssistInfoData:function(e){if(e.memberId==this.roleId)return this.isInit||(this.isInit=!0,this.conductType=e.studyType,this.conductId=e.studyTechId,this.initData()),void this.setCompleteTime(e.studyComplete);var t=this.assistMap.get(e.memberId);t||(t=new game.TribalAssistInfo,this.assistMap.set(e.memberId,t)),t.setData(e)},getAssistList:function(){return this.assistMap.values()},getAssistInfo:function(e){return this.assistMap.get(e)},clearAssistList:function(e){if(e){var t=e.length;if(!(t<1))for(var a=0;a<t;a++)this.clearAssist(e[a])}},updateAssist:function(e){var t=this.assistMap.get(e.memberId);if(t){t.updateData(e);var a=game.SysTime.curTime,i=game.TribesTechMiscCfg.getData("maxAssistCount");i&&(a>=t.completeTime||t.num==i.value||e.leave)&&this.clearAssist(t.memberId)}},clearAssist:function(e){this.assistMap.get(e)&&this.assistMap.del(e)},changeAssistList:function(){var e=this.getAssistList();this.updateAssistList(e)},updateAssistList:function(e){if(e){var t=e.length,a=game.SysTime.curTime,i=game.TribesTechMiscCfg.getData("maxAssistCount");if(i&&!(t<1))for(var n=void 0,s=0;s<t;s++){var r=e[s];if(n=this.assistMap.get(r.memberId),this.roleId!=r.memberId){if(!n)return;a>=r.completeTime||r.num==i.value||r.leave?this.clearAssist(n.memberId):(n.completeTime=r.completeTime,n.num=r.num)}else this.isInit||(this.isInit=!0,this.initData()),this.setCompleteTime(r.completeTime)}}},getPrivilegeField:function(e,t){var a=game.TribalPrivilegeType,i=void 0,n=void 0;switch(e.privilegeType){case a.MAIN_TASK_EXP:i=e.mainTaskExp,n=52375;break;case a.QUAN_MINBOSS_EXP:i=e.quanMinBossExp,n=52376;break;case a.QUICK_BATTLE_EXP:i=e.quickBattleExp,n=52377;break;case a.QUICK_BATTLE_GOLD:i=e.quickBattleGold,n=52378;break;case a.TEAM_INS_EXP:i=e.teamINSExp,n=52379;break;case a.EXP_INS_EXP:i=e.expINSExp,n=52380;break;case a.PERSON_BOSS_EXTRA:i=e.personBossExtra,n=52381;break;case a.GOLD_INS_EXTRA:i=e.goldINSExtra,n=52382;break;case a.QIANGHUA_INS_EXTRA:i=e.qianghuaINSExtra,n=52383;break;case a.PARTNER_INS_EXTRA:i=e.partnerINSExtra,n=52384;break;case a.BREAK_INS_EXTRA:i=e.breakINSExtra,n=52385;break;case a.CHUILIAN_INS_EXTRA:i=e.chuilianINSExtra,n=52386;break;case a.ARENA_EXTRA:i=e.arenaExtra,n=52387;break;case a.TIME_REDUCE:i=e.timeReduce,n=52388;break;case a.GUARD_INS_EXTRA:i=e.guardINSExtra,n=53019;break;case a.HOUSE_INS_EXTRA:i=e.HouseINSExtra,n=53018;break;case a.instanceSilver:i=e.instanceSilver,n=53223;break;case a.expINSExtra:i=e.expINSExtra,n=53224}return t?i:n},setStr:function(e,a,i,n,t,s){var r=4<arguments.length&&void 0!==t?t:"+",o=5<arguments.length&&void 0!==s?s:"";if(!e)return"";var g=e.getSpriteStats();if(!g)return"";var u=void 0,l="";return g.forEach(function(e,t){2==(u=game.AttrRulesCfg.getData(+e)).format?t=1e3*t*a/10+"%":t*=a,l+=game.HtmlUtil.getText(i,o+u.name+r)+game.HtmlUtil.getText(n,t)},this),l}});game.tribalResearchData=game.tribalResearchData||new e}(),function(){var e;e=b8e.Object.extends({id:0,itmeId:0,price:0,reduceMin:0,num:1,count:0,ctor:function(){},setData:function(e){this.id=e.id,this.itmeId=e.itmeId,this.price=e.price,this.reduceMin=e.reduceMin}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalSkillSpeedInfo",e)}(),function(){var e;e=b8e.Object.extends({group:0,alert:!1,name:"",ctor:function(){this.stageMp=b8e.HashMap.get(),this.stageInfoMp=b8e.HashMap.get()},initData:function(e){this.group=e;var t=game.TribesTechSurviveBaseCfg.getData(e,!0);if(t){for(var a=t.length,i=void 0,n=0;n<a;n++){if(!(i=t[n]))return;var s=i.stage;this.name=i.name;var r=this.stageMp.get(s);r||(r=[],this.stageMp.set(s,r)),r.push(i)}this.setStageData()}},setStageData:function(){var e=this.getStageList();if(e){var t=e.length;if(!(t<1))for(var a=void 0,i=0;i<t;i++){var n=e[i],s=i+1;(a=new game.TribalSurviveStageInfo).group=this.group,a.initData(n),this.stageInfoMp.set(s,a)}}},getStageInfoList:function(){return this.stageInfoMp.values()},getStageList:function(){return this.stageMp.values()},getStageInfo:function(e){return this.stageInfoMp.get(e)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalSurviveGroupInfo",e)}(),function(){var e;e=b8e.Object.extends({group:0,id:0,lv:0,name:"",conditionId:null,costItems:null,costTime:0,skillId:0,active:!1,stage:0,itemId:0,num:0,type:2,maxLv:0,skillIcon:0,canGet:!1,isGet:!1,free:!1,endTime:0,quality:0,width:0,posX:0,maxStage:!1,abchor:!1,privilegeId:0,ctor:function(){},initData:function(e){var t=this,a=game.tribalResearchData;t.id=e.id,t.maxLv=e.maxLv,t.skillIcon=e.skillIcon,t.quality=e.quality,t.posX=e.posX,t.width=e.width,t.maxStage=e.maxStage,t.abchor=e.abchor;var i=a.getSurviveCfg(t.id,t.lv);i&&(t.conditionId=i.conditionId,t.conditionId.length<1&&(t.active=!0),t.privilegeId=i.privilegeId,t.costTime=i.costTime,t.skillId=i.skillId,t.stage=i.stage,t.name=i.name,i.costItems[0]&&(t.itemId=i.costItems[0].Id,t.num=i.costItems[0].Num))},setData:function(e){var t=this,a=game.tribalResearchData;t.id=e.id,t.lv=e.lv,t.active=!0;var i=a.getSurviveCfg(t.id,t.lv);i&&(t.privilegeId=i.privilegeId,t.conditionId=i.conditionId,t.costTime=i.costTime,t.skillId=i.skillId,t.stage=i.stage,t.itemId=i.costItems[0].Id,t.num=i.costItems[0].Num,t.name=i.name)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$TribalSurviveInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1484),this.setSize(600,150)},setData:function(e){var t=this.skin,a=game.guildData.membersMap.get(e.memberId);if(a){var i=game.tribalResearchData.getCfg(e.studyType,e.studyTechId,e.studyLv);if(i){t.name.string=a.name,t.skill_lv.string=i.name+"Lv."+e.studyLv;for(var n=0;n<5;n++){var s=n+1;this.getComponent("energy_"+s).active=e.num>=s}}}},assistBtn:function(){this.send(game.TribalResearchEvts.C_SEND_ASSIST,this.data.memberId)}}),b8e.RC("$$game","$$TribalAssistItme",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1485)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TribalAssistItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.TribalBattle,this.moduleData=game.tribalResearchData},notify:function(e){switch(e){case this.Evts.V_UPDATE_ASSIST_VIEW:this.updateList()}},onShow:function(){this.updateList(),this.send(this.Evts.C2V_SEND_ASSIST)},updateList:function(){var e=this.skin,t=game.TribesTechMiscCfg.getData("tribesTechDailyNum");if(t){var a=t.value-this.moduleData.assistantNum;this.moduleData.changeAssistList(),e.assistCount.string=game.Lang.get(52396,a);var i=this.moduleData.getAssistList();this.list.setData(i)}}});b8e.module.registerView(game.ME.TribalAssist,e)}(),function(){var e=game.View.extends({w:394,costTime:0,ctor:function(){this._super(1486)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TribalSkillListView,e.addToParent(this.skin.list),e.layout.spacingY=-3,e.bindEnum=game.ME.TribalBattle,this.moduleData=game.tribalResearchData},notify:function(e){switch(e){case this.Evts.V_BATTLE_SELECT_CHANGE:this.updateList(),this.changeSelsct();break;case this.Evts.C2V_UPDATE_TIME:this.updateTime()}},onShow:function(){this.updateList(),this.updateTime(),this.changeSelsct()},updateList:function(){var e=this.moduleData.battleSelectId,t=this.moduleData.getBattleGroupInfo(e).getStageInfoList();t&&this.list.setData(t)},updateTime:function(){var e=this,t=e.skin;e.clearTimer();var a=e.moduleData.getCountDown(),i=e.moduleData.getUpInfo();if(i?(t.lab.active=!1,t.battle.active=!0,t.battleCompleteBtn.active=i.isGet,t.battleFreeSpeedBtn.active=!i.free&&!i.isGet,t.battleSpeedBtn.active=!t.battleFreeSpeedBtn.active&&(0<a||i.free)&&!i.isGet,t.skill_mame.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name)):(t.battle.active=!1,t.lab.active=!0),e.skin.proLab.string="",0<a){var n=e.moduleData.getCfg(i.type,i.id,i.lv+1);if(!n)return;e.costTime=n.costTime*b8e.TimeUtil.MINUTE_MICRO_SECONDS,e.timer||(e.timer=b8e.Timer.add(e,e.updateActTime,1e3)),t.proLab.string=b8e.TimeUtil.formatTime(a)}else e.skin.pro.width=e.w},clearTimer:function(){this.costTime=0,this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateActTime:function(){var e=this,t=e.moduleData.getCountDown(),a=e.skin;if(0<t)e.skin.proLab.string=b8e.TimeUtil.formatTime(t),e.setProgressVal(t,e.costTime);else{var i=e.moduleData.getUpInfo();e.moduleData.setIsGet(i),a.battleCompleteBtn.active=!0,a.battleFreeSpeedBtn.active=!1,a.battleSpeedBtn.active=!1,e.send(e.Evts.C2V_UPDATE_ALERT),b8e.Timer.remove(e,e.updateActTime),e.timer=null}},changeSelsct:function(){var e=this.moduleData.getBattleGroupList();if(e){var t=e.length;if(!(t<1))for(var a=0;a<t;a++){var i=a+1,n=e[a];this.getComponent("btn_lab"+i).string=n.name,this.getComponent("select_"+i).active=n.group==this.moduleData.battleSelectId}}},setProgressVal:function(e,t){this.skin.pro.width=(1-e/t)*this.w},onHide:function(){this.clearTimer(),this.costTime=0},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TribalBattle,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1487),this.toggles={toggle_btn_1:game.ME.TribalBattle,toggle_btn_2:game.ME.TribalSurvival},this.spotAlerts={TRIBAL_BATTLE:this.battleAlert,TRIBAL_SURVIVAL:this.survivalAlert}},init:function(){this.moduleData=game.tribalResearchData,this.moduleData.isInit||(this.moduleData.isInit=!0,this.moduleData.initData())},battleAlert:function(e){this.skin.red_spot_1.active=e.alert},survivalAlert:function(e){this.skin.red_spot_2.active=e.alert},onShow:function(){this.toggleSelect(0)},notify:function(e,t){switch(e){case game.TribalResearchEvts.SWITCH_PAGE:this.toggleSelect(t)}},toggleSelect:function(e){this._super(e)}});b8e.module.registerView(game.ME.TribalResearch,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1489),this.setSize(116,212)},setData:function(e){var t=this.skin;0!=e.posX&&this.setPosition(e.posX,0),e.abchor?(t.len2.setAnchor(.5,.5),t.len1.setAnchor(.5,.5)):(t.len2.setAnchor(0,.5),t.len1.setAnchor(0,.5)),t.len2.width=e.width,t.len1.width=e.width,t.len1.active=!e.active,t.len2.active=e.active,t.lien_1.active=1!=e.stage&&!e.active,t.lien_2.active=e.active&&1!=e.stage,t.skill_bg2.active=!e.active,t.lien_3.active=!e.maxStage,t.lien_4.active=e.active&&!e.maxStage,t.name.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),t.lv.string="Lv:"+e.lv+"/"+e.maxLv;var a=game.ResCfg.getUrl(10148,e.skillIcon);t.item.loadTexture(a)},touchIcon:function(){this.send(game.TribalResearchEvts.SHOW_SKILL_DETAILS,this.data)}}),b8e.RC("$$game","$$TribalSkillItme",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1490),this.setSize(600,212)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.TribalSkillItme,e.layout.spacingX=34,e.bindEnum=game.ME.TribalBattle,e.addToParent(this.skin.list)},setData:function(e){var t=e.getList();this.list.setData(t)}}),b8e.RC("$$game","$$TribalSkillListView",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1491),this.setSize(540,126)},init:function(){(this._itemGrid=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105)).addToParent(this.skin.item)},setData:function(e){var t=this.skin,a=game.itemData.getNumById(e.itmeId);t.lab.active=0<a,t.count.active=a<1,t.icon.active=a<1,t.timeDes.string=game.Lang.get(52397,e.num*e.reduceMin,a),t.reduceTime.string=game.Lang.get(52398,e.num*e.reduceMin),t.count.string=e.num*e.price,t.num.string=e.num,this.itemInfo=game.ItemUtil.createBaseItemInfo(e.itmeId,0,this.itemInfo),game.GridUtil.setItemIcon(this._itemGrid,this.itemInfo,!1,2)},jia:function(){this.send(game.TribalResearchEvts.C_JIA,this.data.id)},jian:function(){this.send(game.TribalResearchEvts.C_JIAN,this.data.id)},btn:function(){this.send(game.TribalResearchEvts.C_SEND_SPEED,this.data.id)}}),b8e.RC("$$game","$$TribalSkillSpeedItme",e)}(),function(){var e=game.View.extends({_showModel:!0,costTime:0,w:332,ctor:function(){this._super(1492)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TribalSkillSpeedItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.TribalBattle,this.moduleData=game.tribalResearchData,this.moduleData.setSkillSpeed()},notify:function(e){switch(e){case this.Evts.V_UIDATE_NUM:this.updateList();break;case this.Evts.C2V_UPDATE_TIME:this.updateTime()}},onShow:function(){this.updateList(),this.updateTime()},updateList:function(){var e=this.moduleData.getSkillSpeedList();e&&this.list.setData(e)},updateTime:function(){var e=this,t=e.skin;e.clearTimer();var a=e.moduleData.getCountDown(),i=e.moduleData.getUpInfo();if(i?(t.isCompleteBtn.active=!i.isGet,t.completeBtn.active=i.isGet,t.skill_mame.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name)):t.isCompleteBtn.active=!0,e.skin.proLab.string="",0<a){var n=e.moduleData.getCfg(i.type,i.id,i.lv+1);if(!n)return;e.costTime=n.costTime*b8e.TimeUtil.MINUTE_MICRO_SECONDS,e.timer||(e.timer=b8e.Timer.add(e,e.updateActTime,1e3)),t.proLab.string=b8e.TimeUtil.formatTime(a)}else t.pro.width=e.w},updateActTime:function(){var e=this,t=e.moduleData.getCountDown(),a=void 0;if(0<t)a=b8e.TimeUtil.formatTime(t),e.skin.proLab.string=a,e.setProgressVal(t,e.costTime);else{var i=e.moduleData.getUpInfo();e.moduleData.setIsGet(i),e.skin.isCompleteBtn.active=!i.isGet,e.skin.completeBtn.active=i.isGet,b8e.Timer.remove(e,e.updateActTime),e.timer=null}},setProgressVal:function(e,t){this.skin.pro.width=(1-e/t)*this.w},onHide:function(){this.costTime=0,this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)}});b8e.module.registerView(game.ME.TribalSkillSpeed,e)}(),function(){var e=game.View.extends({w:394,costTime:0,ctor:function(){this._super(1494)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.TribalSkillListView,e.addToParent(this.skin.list),e.layout.spacingY=-3,e.bindEnum=game.ME.TribalBattle,this.moduleData=game.tribalResearchData},onShow:function(){this.updateList(),this.updateTime(),this.changeSelsct()},notify:function(e){switch(e){case this.Evts.V_SURVIVAL_SELECT_CHANGE:this.updateList(),this.changeSelsct();break;case this.Evts.C2V_UPDATE_TIME:this.updateTime()}},updateList:function(){var e=this.moduleData.surviveSelectId,t=this.moduleData.getSurviveGroupInfo(e).getStageInfoList();t&&this.list.setData(t)},changeSelsct:function(){var e=this.moduleData.getSurviveGroupList();if(e){var t=e.length;if(!(t<1))for(var a=0;a<t;a++){var i=a+1,n=e[a];this.getComponent("btn_lab"+i).string=n.name,this.getComponent("select_"+i).active=n.group==this.moduleData.surviveSelectId}}},updateTime:function(){var e=this,t=e.skin,a=e.moduleData.getCountDown();e.clearTimer();var i=e.moduleData.getUpInfo();if(i?(t.lab.active=!1,t.battle.active=!0,t.survivalCompleteBtn.active=i.isGet,t.survivalFreeSpeedBtn.active=!i.free&&!i.isGet,t.survivalSpeedBtn.active=!t.survivalFreeSpeedBtn.active&&(0<a||i.free)&&!i.isGet,t.skill_mame.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name)):(t.battle.active=!1,t.lab.active=!0),e.skin.proLab.string="",0<a){var n=e.moduleData.getCfg(i.type,i.id,i.lv+1);if(!n)return;e.costTime=n.costTime*b8e.TimeUtil.MINUTE_MICRO_SECONDS,e.timer||(e.timer=b8e.Timer.add(e,e.updateActTime,1e3)),t.proLab.string=b8e.TimeUtil.formatTime(a)}else e.skin.pro.width=e.w},clearTimer:function(){this.costTime=0,this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateActTime:function(){var e=this,t=e.moduleData.getCountDown();if(e.moduleData.getUpInfo()){var a=e.skin;if(0<t)a.proLab.string=b8e.TimeUtil.formatTime(t),e.setProgressVal(t,e.costTime);else{var i=e.moduleData.getUpInfo();e.moduleData.setIsGet(i),a.survivalSpeedBtn.active=!1,a.survivalFreeSpeedBtn.active=!1,a.survivalCompleteBtn.active=!0,e.send(e.Evts.C2V_UPDATE_ALERT),b8e.Timer.remove(e,e.updateActTime),e.timer=null}}},setProgressVal:function(e,t){this.skin.pro.width=(1-e/t)*this.w},onHide:function(){this.clearTimer(),this.costTime=0},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.TribalSurvival,e)}(),function(){var e=game.View.extends({_showModel:!0,costTime:0,w:332,ctor:function(){this._super(1488)},init:function(){this.moduleData=game.tribalResearchData,this.costIcon=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),this.costIcon.addToParent(this.skin.icon)},onShow:function(){this.updateView()},updateView:function(){var e=this,t=e.skin,a=e.moduleData.type,i=e.moduleData.selectId,n=e.moduleData.getInfo(a,i);if(n){var s=void 0;s=n.lv==n.maxLv?n.lv:n.lv+1,t.max.active=n.lv==n.maxLv;var r=e.moduleData.getCfg(a,n.id,s);if(r){var o=e.moduleData.getCountDown(),g=r.costItems[0];t.skill_bg2.active=!n.active,t.skill_name.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name);var u=game.ResCfg.getUrl(10148,n.skillIcon);if(t.itemSkill.loadTexture(u),t.nowLv.string=game.Lang.get(52392,n.lv),t.skill_lv.string="Lv"+n.lv+"/"+n.maxLv,n.active&&e.moduleData.isActive(r,a)){var l=game.amount.get(game.AmountType.KEJI_DIAN);e.moduleData.conductType==a&&e.moduleData.conductId==i?(t.consume_node.active=!n.isGet&&o<0&&n.lv<n.maxLv,e.updateTime(),t.isResearch.active=!1):(t.consume_node.active=!n.isGet&&n.lv<n.maxLv,t.isResearch.active=e.moduleData.isStudy,t.researchBtn.active=!e.moduleData.isStudy,t.btn_node.active=!1),t.condition.active=!1,t.time.string=game.Lang.get(52391)+b8e.TimeUtil.formatTime(r.costTime*b8e.TimeUtil.MINUTE_MICRO_SECONDS),t.count.string=l+"/"+g.Num}else t.consume_node.active=!1,t.condition.active=!0,e.setCondition(n,r,a),t.btn_node.active=!1;e.costIcon.setItemId(g.Id),t.studyCompleteBtn.active=n.isGet;var c=void 0;c=1==a?i:r.privilegeId,e.setAttr(a,c,n)}}},updateTime:function(){var e=this,t=e.skin;e.clearTimer();var a=e.moduleData.getCountDown(),i=e.moduleData.getUpInfo();if(t.detailsSpeedBtn.active=i.free,t.detailsFreeBtn.active=!i.free,0<a){t.btn_node.active=!0;var n=e.moduleData.getCfg(i.type,i.id,i.lv+1);if(!n)return;e.costTime=n.costTime*b8e.TimeUtil.MINUTE_MICRO_SECONDS,e.timer||(e.timer=b8e.Timer.add(e,e.updateActTime,1e3)),t.proLab.string=b8e.TimeUtil.formatDayTime(a)}else t.pro.width=e.w,t.btn_node.active=!1},updateActTime:function(){var e=this.moduleData.getCountDown(),t=void 0;if(0<e)t=e<=b8e.TimeUtil.HOUR_MICRO_SECONDS?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.proLab.string=t,this.setProgressVal(e,this.costTime);else{var a=this.moduleData.getUpInfo();a&&(a.isGet=!0,a.canGet=!1),b8e.Timer.remove(this,this.updateActTime),this.timer=null}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},setProgressVal:function(e,t){this.skin.pro.width=(1-e/t)*this.w},setAttr:function(e,t,a){var i=this,n=1==e?game.TribesTechSkillCfg.getData(t):game.TribesTechPrivilegeCfg.getData(t),s=void 0;if(s=a.lv==a.maxLv?a.maxLv:a.lv+1,1==e)i.skillSpriteStat||(i.skillSpriteStat=game.SpriteStat.get()),i.skillSpriteStat.clear(),i.skillSpriteStat.setupByCfg(n),i.skin.nowEffect.string=game.Lang.get(52389)+i.moduleData.setStr(i.skillSpriteStat,a.lv,game.Color.BLACK,game.Color.GREEN),i.skin.nextEffect.string=a.lv==a.maxLv?game.Lang.get(574):game.Lang.get(52390)+i.moduleData.setStr(i.skillSpriteStat,s,game.Color.BLACK,game.Color.GREEN);else if(1==n.arrType){var r=0;if(0<a.lv){var o=game.TribesTechPrivilegeCfg.getData(a.privilegeId);r=i.moduleData.getPrivilegeField(o,!0)}else r=0;var g=i.moduleData.getPrivilegeField(n,!0);i.skin.nowEffect.string=game.Lang.get(52389)+game.Lang.get(i.moduleData.getPrivilegeField(n,!1),r),i.skin.nextEffect.string=a.lv==a.maxLv?game.Lang.get(574):game.Lang.get(52390)+game.Lang.get(i.moduleData.getPrivilegeField(n,!1),g)}else{var u=void 0;if(0<a.lv){var l=game.TribesTechPrivilegeCfg.getData(a.privilegeId);u=i.moduleData.getPrivilegeField(l,!0)}var c=i.moduleData.getPrivilegeField(n,!0);if(!c)return void game.notice.show(52415);var h=game.ItemInfoCfg.getData(c[0].Id);i.skin.nowEffect.string=u?game.Lang.get(52389)+game.Lang.get(i.moduleData.getPrivilegeField(n,!1),"\n"+h.name,u[0].Num):game.Lang.get(52389)+game.Lang.get(i.moduleData.getPrivilegeField(n,!1),"\n"+h.name,0),i.skin.nextEffect.string=a.lv==a.maxLv?game.Lang.get(574):game.Lang.get(52390)+game.Lang.get(i.moduleData.getPrivilegeField(n,!1),"\n"+h.name,c[0].Num)}},setCondition:function(e,t,a){var i=t.conditionId.length;if(!(i<1)){var n="";this.skin.condition.string=e.active?game.Lang.get(52394):game.Lang.get(52393);for(var s=0;s<i;s++){var r=t.conditionId[s],o=game.TribesTechConditionCfg.getData(r);n+=(1==a?this.moduleData.getBattleInfo(o.techId):this.moduleData.getSurviveInfo(o.techId)).name+game.Lang.get(52395,o.lv)+"\n"}e.active?this.skin.text.setPosition(143.5,0):this.skin.text.setPosition(100,0),this.skin.text.string=n}},onHide:function(){this.costTime=0,this.clearTimer()}});b8e.module.registerView(game.ME.TribalSkillDetails,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1493)},onShow:function(){var e=this;e.moduleData=game.tribalResearchData;var t=e.moduleData.type,a=e.moduleData.selectId,i=e.moduleData.getInfo(t,a);if(i){var n=void 0;n=i.lv==i.maxLv?i.lv:i.lv+1;var s=e.moduleData.getCfg(t,i.id,n);if(s){var r=1==t?game.TribesTechSkillCfg.getData(a):game.TribesTechPrivilegeCfg.getData(s.privilegeId);if(r){for(var o="",g=0;g<i.maxLv;g++)o+=e.getSting(i,r,t,g+1)+"\n";e.skin.textString.string=o,e.skin.name.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);var u=game.ResCfg.getUrl(10148,i.skillIcon);e.skin.item.loadTexture(u),e.skin.bg.height=e.skin.textString.height+110,e.skin.bg.width=e.skin.textString.width+20,e.height=e.skin.bg.height,e.width=e.skin.bg.width}}}},getSting:function(e,t,a,i){var n=this,s="",r=game.Color.WHITE;if(i<e.lv?r=game.Color.GREEN:i==e.lv&&(r=game.Color.YELLOW),1==a){n.skillSpriteStat||(n.skillSpriteStat=game.SpriteStat.get()),n.skillSpriteStat.clear(),n.skillSpriteStat.setupByCfg(t);var o="Lv."+i+":";s=n.moduleData.setStr(n.skillSpriteStat,i,r,r,"+",o)}else{var g=n.moduleData.getCfg(a,e.id,i),u=game.TribesTechPrivilegeCfg.getData(g.privilegeId);if(1==t.arrType){var l=n.moduleData.getPrivilegeField(u,!0),c="Lv."+i+":"+game.Lang.get(n.moduleData.getPrivilegeField(t,!1),Math.floor(l));s=game.HtmlUtil.getText(r,c)}else{var h=n.moduleData.getPrivilegeField(u,!0);if(!h)return void game.notice.show(52415);var m=game.ItemInfoCfg.getData(h[0].Id),d="Lv."+i+":"+game.Lang.get(n.moduleData.getPrivilegeField(t,!1),m.name,Math.floor(h[0].Num));s=game.HtmlUtil.getText(r,d)}}return s},onStageResize:function(){var e=.5*(b8e.stageWidth-this.width),t=.5*(b8e.stageHeight+this.height);this.setPosition(e,t)}});b8e.module.registerView(game.ME.TribalSkillTips,e)}(),function(){var e=game.CultivateBaseView.extends({ctor:function(){this._super("equipForge/EquipFuseView")},init:function(){this._super(),this.moduleData=game.equipForgeData,this.forgeData=game.equipFuseData,this.forgeType=game.EquipForgeType.FUSE,this.skin.starSkillBtn.loadTexture(game.ResCfg.getUrl(10085,"starSkill"))},onShow:function(){this.updateData(),this.send(this.Evts.V_ONSHOW)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE:this.updateData()}},updateData:function(){var e=this,t=e.skin;e.updateSuolian();var a=e.moduleData.getCurEquipInfo();if(a){var i=0!=a.equipId;if(t.noEquip.setVisible(!i),!i)return t.showNode.setVisible(!1),void t.lbl_noqua.setVisible(!1);var n=a.quality>=game.Quality.Q_UNPARALLELED;if(t.lbl_noqua.setVisible(!n),t.showNode.setVisible(n),n){e.curLv=a.fuseLv||0;for(var s=0;s<6;s++)e.getComponent("starIcon"+(s+1)).active=s<e.curLv;var r=a.isTreasure?e.forgeData.treasureMaxLv:e.forgeData.maxLv,o=e.curLv>=r;t.isMax_cost.setVisible(o),t.isNoMax_cost.setVisible(!o),e.updateAttr(a,o);var g=e.moduleData.getCostInfoArrByForgeType(a,e.forgeType);e.updateCost(g),e.updateRedPoint(a),e.forgeData.suolianBtn||(e.forgeData.suolianBtn=e.skin.btn_suolian)}}},updateSuolian:function(){var e=this.skin,t=this.moduleData.getCurRoleSuolianInfo(this.forgeType);if(t){e.lbl_stage.string=game.Lang.get(51394,t.suolianStageLv);var a=game.ResCfg.getUrl(10085,this.forgeType);e.icon_suolian.loadTexture(a);var i=t.suoliancfg,n=i?i.upgradeLv:0,s=i?i.lv+1:1,r=this.forgeData.suoLianMaxLv;r<s&&(s=r);var o=game.ForgeMasterCfg.getMasterConfig(this.forgeData.masterType,s);o&&(n=o.upgradeLv),e.lbl_suolianlv.string=t.suolianlv+"/"+n}},updateCost:function(e){var t=this.skin;if(e){var a=e[0];if(a){var i,n=a.costItem,s=a.costNum,r=game.equipData.getItemNumById(n);this.forgeData.getEquipInfoById(n,s),t.costIcon2.setVisible(this.forgeData.currSelEquipData.isForge);var o=this.forgeData.currSelEquipData.equipData;if(o){var g=this.cost;g||((g=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105)).addToParent(t.costIcon),this.cost=g),g.setItemInfo(o,!1,!1)}var u=game.ItemInfoCfg.getData(n);i=game.HtmlUtil.getColorStrByQuality(u.quality,u.name),t.costName.string=i;var l=s<=r?51389:51388;t.costNum.string=game.Lang.get(l,r,s)}}},updateRedPoint:function(e){var t=e.checkAlertByForgeType(this.forgeType);this.skin.redPoint_up.setVisible(t)},updateAttr:function(e,t){var a=this.skin;a.arrow.setVisible(!t),a.curNode.x=t?358:245;var i=this.curLv,n=this.getAttr(e,0==i?1:i);if(a.cur_attr.string=this.getAttrStrByArr(n,0==i),a.cur_lv.string=game.Lang.get(52325,i),this.skin.nextNode.setVisible(!t),!t){var s=this.getAttr(e,i+1);a.next_attr.string=this.getAttrStrByArr(s),a.next_lv.string=game.Lang.get(52325,i+1)}},getAttr:function(e,t){if(e){var a=e.equipId;if(a)return game.ForgeFuseCfg.getShowAttr(a,t)}},getAttrStrByArr:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i="";if(!e||e.length<=0)return i;for(var n=void 0,s=0,r=0;r<e.length;r++)if(n=e[r],a||(s=n.value),n.type){var o=game.AttrRulesCfg.getData(n.type);if(!o)continue;n.isPer&&(s/=10),i+=game.Lang.get(51390,o.name,s+(n.isPer?"%":"")),r<e.length-1&&(i+="\n")}return i}});b8e.module.registerView(game.ME.EquipFuse,e)}(),function(){var e=game.ForgeData.extends({currSelEquipData:null,costIdx:null,setup:function(){this.forgeNameLangKey=52327,this.forgeType=game.EquipForgeType.FUSE,this.masterType=game.EquipForgeMasterType.FUSE,this._super()},getEquipInfoById:function(e,t){var a=this,i=game.equipData._itemIdsMap.get(e),n=void 0;if(a.currSelEquipData={},!i||i.length<t)return a.currSelEquipData.equipData=game.ItemInfoCfg.getData(e),void(a.currSelEquipData.isForge=!1);var s=0;a.costIdx||(a.costIdx=[]);for(var r=a.costIdx.length=0;r<i.length;r++)if(0<(n=game.equipData.getPetEquipInfoByIdx(i[r].idx)).intensifylv||0<n.refinelv||0<n.purifylv||0<n.gemlv||0<n.zhulinglv||0<n.zhulingExp||0<n.fuseLv)a.currSelEquipData.equipData=n;else if(s++,a.costIdx.push(n.idx),t<=s)break;a.currSelEquipData.equipData||(a.currSelEquipData.equipData=game.ItemInfoCfg.getData(e)),a.currSelEquipData.isForge=a.costIdx.length<t},getEquipList:function(){var e=game.partnerData.getCurSlotInfo();if(!e)return null;var t=e.forgeInfo.slotMap.values();if(!t)return null;for(var a=void 0,i=[],n=0;n<t.length;n++)(a=t[n])&&(a.equipId<=0||4<a.slotId||a.quality<game.Quality.Q_UNPARALLELED||i.push(a));return i}});game.equipFuseData=game.equipFuseData||new e}(),function(){var e=game.ForgeControl.extends({init:function(){this.forgeInfo=game.equipFuseData,this.forgeType=game.EquipForgeType.FUSE,this.forgeAlert=game.spotAlert.set(game.SAE.EQUIP_FUSE,game.SAE.EQUIP_FORGE)},upBtn:function(){this.efData=game.equipForgeData;var e=this.efData.getCurEquipInfo();if(e){var t=e.costFuseCfg;if(t)if(game.equipData.getItemNumById(t.equipId)<t.num)game.notice.show(52328);else if(this.forgeInfo.currSelEquipData.isForge)game.notice.show(52329);else{var a=game.equipForgeData.getHuobanInfoByHuobanId(e.id);if(a&&a.battlePos){var i={slot:a.battlePos,equipSlot:e.slotId,idx:this.forgeInfo.costIdx};this.dpt(this.Evts.C_REQ_FORGE,i)}}}},costIcon2:function(){this.forgeInfo.currSelEquipData.equipData&&(game.tipsData.setInfo(this.forgeInfo.currSelEquipData.equipData),game.module.show(game.ME.EquipDetailsTips))},starSkillBtn:function(){var e=this.forgeInfo.getEquipList();!e||e.length<=0?game.notice.show(52345):game.module.show(game.ME.EquipFuseStarSkillTips)}}),t=[game.ME.EquipFuseStarSkillTips];b8e.module.registerControl(game.ME.EquipFuse,e,game.EquipForgeEvts,null,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("equipForge/EquipFuseStarSkillTips")},onShow:function(){this.updateView()},updateView:function(){var e=this,t="",a=game.equipFuseData.getEquipList();if(a&&0<a.length){for(var i=void 0,n=void 0,s=3<a.length?6:0,r={},o=0;o<a.length;o++)i=a[o],s=Math.min(i.fuseLv,s),i.itemCfg&&(r[n=i.itemCfg.suit]||(r[n]={},r[n].num=0,r[n].id=n),r[n].num++);var g=0,u=void 0,l=0;for(var c in r)(u=r[c]).num>g?(g=u.num,l=u.id):u.num==g&&u.id>l&&(l=u.id);for(var h=void 0,m=void 0,d=1;d<=6;d++)(h=game.ForgeFuseSuitCfg.getData(l,d))&&(m=game.Lang.get(52346,h.name,d)+"\n",m+=e.getStrByCfg(h),d<=s&&(m=game.HtmlUtil.getText(game.Color.GREEN,m)),t+=m+(6==d?"":"\n"))}e.skin.descLab.string=t,e.skin.bgImg.height=-(2*e.skin.descLab.y-e.skin.descLab.height),e.skin.bgImg.width=2*e.skin.descLab.x+e.skin.descLab.width,e.skin.tipsImg.y=-(e.skin.bgImg.height+25),e.skin.tipsImg.x=e.skin.bgImg.width>>1,e.width=e.skin.bgImg.width,e.height=14-e.skin.tipsImg.y,e.onStageResize()},getStrByCfg:function(e){var t="";if(!e)return t;for(var a=game.SpriteDefine,i=a.length,n=void 0,s=void 0,r=void 0,o=0,g=void 0,u=0;u<i;u++)if(r=a[u]){if(s=r.type,g=!1,!(n=e[b8e.getNormP(r.clientKey)])||n<=0){if(!(n=e[b8e.getNormP(r.clientPer)])||n<=0)continue;g=!0}var l=game.AttrRulesCfg.getData(s);l&&(0<o&&(t+="\t"),0<o&&o%3==0&&(t+="\n"),t+=l.name+"+"+(g?n/10+"%":n),o++)}return t}});b8e.module.registerView(game.ME.EquipFuseStarSkillTips,e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo}},this.handels={PartnerHuanhuaResp:this.partnerHuanhuaResp,PartnerSkinResp:this.partnerSkinResp}},updateItemInfo:function(){this.send(this.Evts.V_UPDATE_DATA)},partnerSkinResp:function(e){var t=e.readProtobuf(game.pb.PartnerSkinResponse);0<t.code?game.notice.noticeError(t.code):(this.data.activeSkin(t.id,t.skinId),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.C_UPDATE_SKIN),game.module.show(game.ME.PartnerSkinActive))},partnerHuanhuaResp:function(e){var t=e.readProtobuf(game.pb.PartnerHuanhuaResponse);0<t.code?game.notice.noticeError(t.code):(this.data.huanhuaSkin(t.id,t.skinId),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.C_UPDATE_SKIN))},useBtn:function(){var e=this.data.getCurSlotInfo().info;e.selectSkin&&(e.selectSkin.useIng?this.sender.PartnerHuanhuaReq(e.id,0):!e.selectSkin.useIng&&e.selectSkin.active?this.sender.PartnerHuanhuaReq(e.id,e.selectSkin.id):!e.selectSkin.active&&e.selectSkin.isAlert&&this.sender.PartnerSkinReq(e.id,e.selectSkin.id))},right_btn:function(){this.send(this.Evts.V_SCROLLRIGHT)},left_btn:function(){this.send(this.Evts.V_SCROLLLEFT)},notify:function(e,t){switch(e){case this.Evts.C_SELECTCHANGE:var a=this.data.getCurSlotInfo().info;if(!a)return;a.selectSkinInfoById(t.id),this.send(this.Evts.V_UPDATE_DATA)}}});var t=game.Sender.extends({ipc:function(){this.msg={PartnerHuanhuaReq:this.partnerHuanhuaReq,PartnerSkinReq:this.partnerSkinReq}},partnerHuanhuaReq:function(e,t){var a=game.pb.PartnerHuanhuaRequest;a.id=e,a.skinId=t,this.write(a)},partnerSkinReq:function(e,t){var a=game.pb.PartnerSkinRequest;a.id=e,a.skinId=t,this.write(a)}}),a=[game.ME.PartnerSkinActive];b8e.module.registerControl(game.ME.PartnerSkin,e,game.PartnerEvts,t,a),b8e.RC("$$game","$$PartnerSkinControl",e)}(),function(){var e;e=b8e.Object.extends({isAlert:!1,active:!1,id:0,cfg:null,select:!1,useIng:!1,spriteStat:null,power:0});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerSkinInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("partner/PartnerSkinListItem"),this.setSize(175,240)},init:function(){this.modelIcon=b8e.Sprite.get(),this.modelIcon.setAnchor(.5,.5),this.skin.modelNode.addChild(this.modelIcon)},setData:function(e){var t=this.skin;t.box.loadTexture(game.ResCfg.getUrl(10145,e.cfg.quality)),this.modelIcon.loadTexture(game.ResCfg.getUrl(10146,e.cfg.id)),t.selectBox.active=e.select,t.useIng.active=e.active&&e.useIng,t.redPoint.active=e.isAlert;var a=0,i=void 0;a=e.active?(i=game.Color.GREEN,52353):!e.active&&e.isAlert?(i=game.Color.GREEN,52354):(i=game.Color.BLACK,52355),t.timeLab.setColor(i),t.timeLab.string=game.Lang.get(a)},touchIcon:function(){this.send(game.PartnerEvts.C_SELECTCHANGE,this.data)}}),b8e.RC("$$game","$$PartnerSkinListItem",e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerSkinView")},init:function(){this.initModel({type:game.RoleType.Partner,node:this.skin.modelNode});var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PartnerSkinListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=0,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.listNode),e.setScrollViewCb(this.listCb,this),this.data=game.partnerData},notify:function(e){switch(e){case this.Evts.V_SCROLLLEFT:this.scrollLeft();break;case this.Evts.V_SCROLLRIGHT:this.scrollRight();break;case this.Evts.V_UPDATE_DATA:this.updateData()}},listCb:function(e,t,a){var i=0,n=!1;if(n=0<(i=e.length),this.skin.left_btn.node.active=n,this.leftAlert=!1,n)for(var s=0;s<i;s++)if(e[s].isAlert){this.leftAlert=!0;break}if(n=0<(i=a.length),this.skin.right_btn.node.active=n,this.rightAlert=!1,n)for(s=0;s<i;s++)if(a[s].isAlert){this.rightAlert=!0;break}this.updateLRBtnAlert(this.leftAlert,this.rightAlert)},scrollLeft:function(){this.list.scrollContainerLeft()},scrollRight:function(){this.list.scrollContainerRight()},updateData:function(){var e=this,t=e.data.getCurSlotInfo();if(t){var a=t.info.selectSkin,i=e.skin,n=1,s=game.SpriteStatType;n+=e.setStatStr(i.addProLab1,s.Attack,n,a.cfg.atk,a.cfg.clientAtk),n+=e.setStatStr(i.addProLab2,s.Defense,n,a.cfg.def,a.cfg.clientDef),n+=e.setStatStr(i.addProLab3,s.Health,n,a.cfg.hp,a.cfg.clientHp),n+=e.setStatStr(i.addProLab4,s.Damage,n,a.cfg.damage),n+=e.setStatStr(i.addProLab5,s.DamageRes,n,a.cfg.damageRes);for(var r=n+=e.setStatStr(i.addProLab6,s.Speed,n,a.cfg.speed);r<7;r++)e.getComponent("addProLab"+r).active=!1;var o=0;o=a.useIng?52349:!a.useIng&&a.active?52350:!a.active&&a.isAlert?52351:52352,i.btn_lbl.string=game.Lang.get(o),i.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.cfg.quality,t.info.name+"  "+a.cfg.name),e._updateModel()}},setStatStr:function(e,t,a,i,n){var s=4<arguments.length&&void 0!==n?n:0;if(!i&&!s)return 0;var r=game.AttrRulesCfg.getData(t),o=s?s/10+"%":2==r.format?i/10+"%":i;return e.string=game.Lang.get(51448,r.name,o),e.active=!0,1},_updateModel:function(){var e=this.data.getCurSlotInfo();if(e){var t=e.info,a=t.cfg.UIModel;t.selectSkin&&(a=t.selectSkin.cfg.UIModel),this.updateModel2(game.RoleType.Partner,a)}},updateHeadList:function(){var e=this.data.getCurSlotInfo();e&&this.list.setData(e.info.getSkinsList())},updateLRBtnAlert:function(e,t){this.skin.left_redPoint.node.active=e,this.skin.right_redPoint.node.active=t},onShow:function(){this.list.scrollToLeft(0),this.updateHeadList(),this.updateData()}});b8e.module.registerView(game.ME.PartnerSkin,e)}(),function(){var e=game.CultivateBaseModelView.extends({_itemInfo:null,_cfg:null,_showModel:!0,_modelTouchClose:!0,ctor:function(){this._super("partner/PartnerActiveSkinView")},init:function(){this.initModel({type:game.RoleType.Partner,node:this.skin.model}),this.timer=b8e.Timer.add(this,this.updateTime,500),this._lightEffect=new game.LightEffect},onShow:function(){var e=this;e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.anima),e._lightEffect.setVisible(!0)),e._tipsInfo=game.partnerData.activeSkinInfo,e._tipsInfo&&e.setData(),e.endTime=game.SysTime.curTime+1e4,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(1e4)),e.timer.reset(),e.timer.start()},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.timer&&this.timer.stop()},updateTime:function(){var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},setData:function(){var e=this.skin,t=this._tipsInfo.cfg;this.updateModel(game.RoleType.Partner,t),e.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name,!1)}});b8e.module.registerView(game.ME.PartnerSkinActive,e)}(),function(){var e;e=b8e.Enum({NONE:0,V2C_BIND_SUCCESS:-1,C2C_BIND_SUCCESS:-1}),b8e.RC("$$game","$$MobileBindEvts",e)}(),function(){var e=b8e.Object.extends({isBind:!1,remainTime:0,getRemainTime:function(){return this.remainTime-game.SysTime.curTime},setRemainTime:function(){this.remainTime=game.SysTime.curTime+6e4},checkOpen:function(){return game.channelInfo.open_mobile_bind&&game.sdk.canMobileBind()}});game.MobileBindData=game.MobileBindData||new e}(),function(){var e=game.Control.extends({init:function(){game.sdk.checkMobileBind(this.checkMobileBind,this)},notify:function(e){switch(e){case this.Evts.V2C_BIND_SUCCESS:this.bindSuccess()}},bindSuccess:function(){game.MobileBindData.isBind=!0,this.dpt(this.Evts.C2C_BIND_SUCCESS,game.VerifyAwardType.VerifyHutong)},checkMobileBind:function(e){game.MobileBindData.isBind=e&&e.data&&0==e.data.code}});b8e.module.registerControl(game.ME.MobileBind,e,game.MobileBindEvts)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("mobile_bind/mobile_bind_view")},init:function(){var e=this;e.skin;e.data=game.MobileBindData;var t=game.ResCfg.getUrl(10143);e._bg=b8e.Sprite.get(),e._bg.loadTexture(t),e._bg.setAnchor(.5,.5),e.skin.bg1.addChild(e._bg),game.LabelUtil.setEditBoxDefault(e.skin.e_phone_num,52317,game.Color.BLACK,e,0),game.LabelUtil.setEditBoxDefault(e.skin.e_verify_code,52318,game.Color.BLACK,e,0),e._prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e._prizeList.itemRender=game.ShowItemListItem,e._prizeList.layout.paddingLeft=0,e._prizeList.layout.paddingTop=0,e._prizeList.layout.paddingBottom=5,e._prizeList.layout.spacingX=30,e._prizeList.addToParent(e.skin.prizeList)},getMobileNumber:function(){var e=this.skin.e_phone_num.string;return e&&11==e.length?e:(game.notice.show(52321),null)},getVerifyCode:function(){var e=this.skin.e_verify_code.string;return e&&6==e.length?e:(game.notice.show(52322),null)},viewOkBtn:function(){var e=this.getMobileNumber();if(e){var t=this.getVerifyCode();t&&game.sdk.userMobileBind(e,t,this._bindCallback,this)}},_bindCallback:function(e){e&&e.data&&(1==e.data.code?(this.send(this.Evts.V2C_BIND_SUCCESS),game.notice.show(52323),game.MobileBindData.isBind=!0,this.updateBtn()):game.notice.show(e.data.msg))},viewCaptchaBtn:function(){if(!game.MobileBindData.isBind){if(!(0<this.data.getRemainTime())){var e=this.getMobileNumber();e&&game.sdk.sendMobileCaptcha(e,this._sendCaptchaCallback,this)}}},_sendCaptchaCallback:function(e){e&&e.data&&(1==e.data.code?(this.data.setRemainTime(),this.setCaptchaBtnActive(!1),this.createTimer()):game.notice.show(e.data.msg))},setCaptchaBtnActive:function(e){this.skin.viewCaptchaBtn;var t=this.skin.btn_sprite1;game.ShaderUtil.setGray(t,!e),e&&(this.skin.captchaLab.string=game.Lang.get(52319))},viewCopyLink:function(){this.viewCopyBtn()},viewCopyBtn:function(){var e=game.channelInfo;e&&e.web_url&&game.CCommonUtil.setClipboardData(e.web_url)},onShow:function(){this.createTimer(),this.updateView(),this.updateBtn()},updateBtn:function(){var e=game.MobileBindData.isBind;this.skin.bindPanel.active=!e,this.skin.copyPanel.active=e},updateView:function(){this.skin;var e=game.channelInfo;e&&e.web_url&&(this.skin.urlLab.string=game.HtmlUtil.getText(game.Color.GREEN,game.HtmlUtil.getulText(e.web_url)));var t=game.VerifyAwardCfg.getData(game.VerifyAwardType.VerifyHutong);if(t){var a=game.CfgUtil.getPrizeListInfo(t.award,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84);a&&this._prizeList.setData(a.items)}},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.data.getRemainTime();e<0?this.clearTimer():this.skin.captchaLab.string=this.skin.captchaLab.string=game.Lang.get(52320,.001*e|0)},clearTimer:function(){this.setCaptchaBtnActive(!0),this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(e-this.width>>1,t-(t-this.height>>1)+50)}});b8e.module.registerView(game.ME.MobileBind,e)}(),function(){var e,t;t=b8e.Enum({None:0,C_TOGGLE_CHANGE:-1,C_UPDATE_HUNTING_VIEW:-1,C_UPDATE_TASK_VIEW:-1,C_UPDATE_GIFT_VIEW:-1,C_UPDATE_RANK_VIEW:-1,C_SWITCH_PARTNER:-1,V_GET_SCORE_REWARD:-1,V_UPDATE_SCORE_VIEW:-1,V_GET_TASK_REWARD:-1,V_BUY_GIFT:-1,C2C_SHOW_PARTNER:-1,C_UPDATE_JUMP_BTN:-1,V_DAILY_RESET:-1,C2C_ACTIVE_PARTNER:-1,V_SHOW_VIEW:-1,C2C_REQ_RANK_DATA:-1,C_GIFT_LIMITED:-1,C2C_RECHARGE:-1,C_UPDATE_LIMITED_VIEW:-1}),e=b8e.Enum({DIAMOND:1,ITEM:2}),b8e.RC("$$game","$$HuntingContestEvts",t),b8e.RC("$$game","$$HuntingCostType",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.huntingContestData;var e=game.spotAlert;this.spotAlert=e.set(game.SAE.HUNTING_CONTEST),this.scoreSpotAlert=e.set(game.SAE.HUNTING_CONTEST_SCORE,game.SAE.HUNTING_CONTEST_BUY),this.buySpotAlert=e.set(game.SAE.HUNTING_CONTEST_BUY,game.SAE.HUNTING_CONTEST),this.taskSpotAlert=e.set(game.SAE.HUNTING_CONTEST_TASK,game.SAE.HUNTING_CONTEST),this.giftSpotAlert=e.set(game.SAE.HUNTING_CONTEST_GIFT,game.SAE.HUNTING_CONTEST),this.noticeAlert={lang:52363,btn:game.Lang.get(9059),key:game.AlertKey.HUNTING_CONTEST,okcb:this.sureBuy,thisArg:this,args:[],langArgs:[],showtips:!0,defaultSelect:!0,align:b8e.HorizontalAlign.CENTER}},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.initOpenServer},MainRole:{C_RESET_DAILY:e.resetDaily},Partner:{C2C_SHOW_ACTIVETIPS_COMPLETE:e.showPartnerComplete},Back:{C_BACK_UPDATE_ITEMINFO:e.updateItemInfo},Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},Rank:{C2C_GET_RACE_RANK_INFO:e.updateRankData}},e.handels={HuntingDoResp:e.huntingDoResp,HuntingFinishTaskResp:e.huntingFinishTaskResp,HuntingBuyGiftResp:e.huntingBuyGiftResp,HuntingScoreExchangeResp:e.huntingScoreExchangeResp,HuntingTaskProcessMsg:e.huntingTaskProcessNotify,HuntingSelectLuckyAwardResp:e.huntingSelPartnerResp}},notify:function(e,t){var a=this;switch(e){case a.Evts.V_GET_SCORE_REWARD:a.sender.HuntingScoreExchangeReq(t);break;case a.Evts.V_GET_TASK_REWARD:a.sender.HuntingFinishTaskReq(t);break;case a.Evts.V_BUY_GIFT:a.onBuyGift(t);break;case a.Evts.V_SHOW_VIEW:a.reqRankData();break;case a.Evts.C_GIFT_LIMITED:a.onBuyGifyLimited(t)}},initOpenServer:function(e){var t=e.data;this.moduleData.setData(t),this.moduleData.getIsOpen()&&this.checkAllRedPoint()},resetDaily:function(){if(this.moduleData.getIsOpen()){var e=this.moduleData.getCurOpenCfg();e&&this.moduleData.id==e.id||game.module.hide(game.ME.HuntingMain),this.moduleData.resetData(),this.checkAllRedPoint(),this.send(this.Evts.V_DAILY_RESET)}else game.module.hide(this.moduleEnum)},huntingDoResp:function(e){var t=e.readProtobuf(game.pb.HuntingDoResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.updateScore(t.score);for(var a=t.partners,i=this.showItems=t.item,n=void 0,s=void 0,r=i.length,o=!1,g=game.partnerData.partnerActiveTips.length=0;g<r;g++)if(n=i[g],s=game.ItemInfoCfg.getData(n.id)){var u=s.partnerId;if(u&&s.isPartner){var l={};l.id=u,l.num=n.num,l.repeat=a.indexOf(u)<0,game.partnerData.partnerActiveTips.push(l),o=!0,l.repeat||(game.partnerData.recruitActiveId=u)}}a&&0<a.length&&this.dpt(this.Evts.C2C_ACTIVE_PARTNER,a),this.showPartnerComplete(o&&this.showPartner),this.reqRankData()}},showPartnerComplete:function(e){this.showItems&&(game.awardsData.title="",game.awardsData.setItemsByArray(this.showItems,!1),game.awardsData.setCompleteCb(e,this),game.module.show(game.ME.RecruitShowItem),this.showItems=null)},showPartner:function(){this.dpt(this.Evts.C2C_SHOW_PARTNER)},huntingFinishTaskResp:function(e){var t=e.readProtobuf(game.pb.HuntingFinishTaskResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateCompleteTask(t),this.checkTaskRedPoint(),this.send(this.Evts.C_UPDATE_TASK_VIEW))},huntingBuyGiftResp:function(e){var t=e.readProtobuf(game.pb.HuntingBuyGiftResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateGiftInfo(t),this.checkGiftRedPoint(),this.send(this.Evts.C_UPDATE_GIFT_VIEW))},huntingScoreExchangeResp:function(e){var t=e.readProtobuf(game.pb.HuntingScoreExchangeResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateScoreExchangeData(t),this.checkScoreRedPoint(),this.send(this.Evts.V_UPDATE_SCORE_VIEW))},huntingTaskProcessNotify:function(e){var t=e.readProtobuf(game.pb.HuntingTaskNotify);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateTaskProcess(t.task),this.checkTaskRedPoint(),this.send(this.Evts.C_UPDATE_TASK_VIEW))},huntingSelPartnerResp:function(e){var t=e.readProtobuf(game.pb.HuntingSelectLuckyAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updatePartnerSel(),this.send(this.Evts.C_UPDATE_HUNTING_VIEW),game.module.hide(game.ME.HuntingPartner))},rechargeSuccess:function(e){if(this.moduleData.getIsOpen()&&e&&e.data){var t=e.data;if(t.id){var a=game.RechargeCfg.getDataById(t.id);a&&(this.moduleData.limitedRechId==t.id&&(this.moduleData.updataLimitedBuyNum(t.id),this.send(this.Evts.C_UPDATE_LIMITED_VIEW)),this.moduleData.updateTotalRepeatNum(a.money),this.checkTaskRedPoint(),this.send(this.Evts.C_UPDATE_TASK_VIEW))}}},updateRankData:function(){this.send(this.Evts.C_UPDATE_RANK_VIEW)},reqRankData:function(){var e=this.moduleData.currCfg.raceRankId;this.dpt(this.Evts.C2C_REQ_RANK_DATA,e)},updateItemInfo:function(){this.moduleData.getIsOpen()&&(this.checkScoreRedPoint(),this.checkHuntingRedPoint(),this.send(this.Evts.C_UPDATE_HUNTING_VIEW))},onBuyGift:function(e){if(e){0!=e.currentPrice?(this.noticeAlert.args[0]=e,this.noticeAlert.langArgs[0]=e.currentPrice,game.alert.show(this.noticeAlert)):this.sender.HuntingBuyGiftReq(e.id,1)}},sureBuy:function(e){game.amount.get(game.AmountType.YUAN_BAO)<e.currentPrice?game.notice.show(116):this.sender.HuntingBuyGiftReq(e.id,1)},huntingBtn:function(){this.selectToggle(0)},taskBtn:function(){this.selectToggle(1)},scoreBtn:function(){this.selectToggle(2)},rankBtn:function(){this.selectToggle(3)},timeBtn:function(){this.selectToggle(4)},selectToggle:function(e){this.send(this.Evts.C_TOGGLE_CHANGE,e)},buyBtn1:function(){this.huntingDoReq(1)},buyBtn2:function(){this.huntingDoReq(10)},scoreRewardBtn:function(){game.module.show(game.ME.HuntingScoreReward)},expectPartnerBtn:function(){game.module.show(game.ME.HuntingPartner)},jumpBtn:function(){this.moduleData.isJumpTween=!this.moduleData.isJumpTween,game.recruitData.setSkipById(game.ME.HuntingMain),this.send(this.Evts.C_UPDATE_JUMP_BTN)},left_btn:function(){this.send(this.Evts.C_SWITCH_PARTNER,!0)},right_btn:function(){this.send(this.Evts.C_SWITCH_PARTNER,!1)},selectBtn:function(){var e=this.moduleData.storCfgs[this.moduleData.selPartnerIndex];e&&this.sender.HuntingSelectLuckyAwardReq(e.awardId)},rankInfoBtn:function(){this.selectToggle(3)},huntingDoReq:function(e){if(this.moduleData.checkItemEnough(game.HuntingCostType.ITEM,e)){var t=1==e?0:10;this.sender.HuntingDoReq(t)}else game.notice.show(113)},checkScoreRedPoint:function(){this.scoreSpotAlert.alert=this.moduleData.checkScoreRedPoint()},checkHuntingRedPoint:function(){this.buySpotAlert.alert=this.moduleData.checkHuntingRedPoint()},checkTaskRedPoint:function(){this.taskSpotAlert.alert=this.moduleData.checkTaskRedPoint()},checkGiftRedPoint:function(){this.giftSpotAlert.alert=this.moduleData.checkGiftRedPoint()},checkAllRedPoint:function(){this.checkScoreRedPoint(),this.checkHuntingRedPoint(),this.checkTaskRedPoint(),this.checkGiftRedPoint()},onBuyGifyLimited:function(e){this.moduleData.limitedRechId=e,this.dpt(this.Evts.C2C_RECHARGE,e)}}),t=[game.ME.HuntingContest,game.ME.HuntingTask,game.ME.HuntingGift,game.ME.HuntingPartner,game.ME.HuntingScoreReward,game.ME.HuntingContestRank,game.ME.HuntingLimitedGift],a=game.Sender.extends({ipc:function(){this.msg={HuntingDoReq:this.huntingDoReq,HuntingFinishTaskReq:this.huntingFinishTaskReq,HuntingBuyGiftReq:this.huntingBuyGiftReq,HuntingScoreExchangeReq:this.huntingScoreExchangeReq,HuntingSelectLuckyAwardReq:this.huntingSelectLuckyAwardReq}},huntingDoReq:function(e){var t=game.pb.HuntingDoRequest;t.doType=e,this.write(t)},huntingFinishTaskReq:function(e){var t=game.pb.HuntingFinishTaskRequest;t.taskId=e,this.write(t)},huntingBuyGiftReq:function(e,t){var a=game.pb.HuntingBuyGiftRequest;a.giftId=e,a.num=t,this.write(a)},huntingScoreExchangeReq:function(e){var t=game.pb.HuntingScoreExchangeRequest;t.scoreId=e,this.write(t)},huntingSelectLuckyAwardReq:function(e){var t=game.pb.HuntingSelectLuckyAwardRequest;t.awardId=e,this.write(t)}});b8e.module.registerControl(game.ME.HuntingMain,e,game.HuntingContestEvts,a,t)}(),function(){var e=b8e.Object.extends({id:0,score:0,selPartnerId:0,tasks:null,taskRecords:null,gifts:null,scoreExchange:null,repeatRechargeNum:0,repeatRechargeGetNum:0,huntingRechargeTotal:0,huntingRecharges:null,endDay:0,selPartnerIndex:0,currCfg:null,isJumpTween:!1,limitedRechId:0,ctor:function(){var e=this;e.tasks=[],e.taskRecords=[],e.gifts=[],e.scoreExchange=[],e.storCfgs=[],e.scoreRewardInfos=[],e.rankRewardInfos=[],e.taskIdMap=b8e.HashMap.get(),e.taskTypeMap=b8e.HashMap.get(),e.taskProcessMap=b8e.HashMap.get(),e.giftInfoMap=b8e.HashMap.get(),e.limitedInfoMap=b8e.HashMap.get()},setData:function(e){var t=this;t.score=e.huntingScore,t.selPartnerId=e.huntingLuckySelect,t.tasks=e.huntingTasks,t.taskRecords=e.huntingTaskRecords,t.gifts=e.huntingGifts,t.huntingRecharges=e.huntingRecharges,t.scoreExchange=e.huntingScoreExchange,t.huntingRechargeTotal=e.huntingRechargeTotal,t.repeatRechargeGetNum=e.huntingRepeatedRecharge,t.repeatRechargeNum=Math.floor(t.huntingRechargeTotal/t.repeatRechargeVal)-t.repeatRechargeGetNum,t.initTaskProcessMap(),t.currCfg=t.getCurOpenCfg(),t.currCfg&&(t.id=t.currCfg.id),t.initLimitedGiftInfos()},resetData:function(){var e=this;e.endDay=0;var t=e.getCurOpenCfg();t&&t.id!=e.id&&(e.currCfg=t,e.id=t.id,e.score=0,e.selPartnerId=0,e.tasks.length=0,e.taskRecords.length=0,e.gifts.length=0,e.huntingRecharges.length=0,e.scoreExchange.length=0,e.selPartnerIndex=0,e.storCfgs.length=0,e.scoreRewardInfos.length=0,e.rankRewardInfos.length=0,e.repeatRechargeNum=0,e.repeatRechargeGetNum=0,e.taskIdMap.clear(),e.taskTypeMap.clear(),e.taskProcessMap.clear(),e.giftInfoMap.clear(),e.limitedInfoMap.clear()),e.resetDailyTask(),e.resetDailyGift(),e.resetDailyLimited()},resetDailyLimited:function(){var e=this.limitedInfoMap.values();if(e)for(var t=void 0,a=e.length,i=0;i<a;i++)1==(t=e[i]).cfg.types&&t.resetDaily()},resetDailyTask:function(){var e=this.getTaskInfos();if(e)for(var t=void 0,a=e.length,i=0;i<a;i++)(t=e[i]).cfg.isDaily&&t.resetDaily()},resetDailyGift:function(){var e=this.getGiftInfos();if(e)for(var t=void 0,a=e.length,i=0;i<a;i++)(t=e[i]).cfg.isDaily&&t.resetDaily()},updateScore:function(e){this.score=e,this.upateScoreRewardInfo()},updateScoreExchangeData:function(e){var t=e.scoreId;-1<this.scoreExchange.indexOf(t)||(this.scoreExchange.push(t),this.upateScoreRewardInfo())},updateCompleteTask:function(e){var t=this,a=e.taskId;t.tObj||(t.tObj=b8e.createMap()),t.tObj.id=a;var i=game.HuntingTaskCfg.getData(t.tObj);if(i)if(i.taskType==t.repeatTaskType)t.repeatRechargeGetNum+=t.repeatRechargeNum,t.repeatRechargeNum=0,t.updateRepeatTaskNum(0);else{var n=t.taskIdMap.get(a);n&&n.onGetReward()}},updateTaskProcess:function(e){var t=this.taskTypeMap.get(e.taskType);if(t)for(var a=t.length,i=0;i<a;i++)t[i].setData(e)},updateRepeatTaskNum:function(e){var t=this.taskTypeMap.get(this.repeatTaskType);if(t)for(var a=t.length,i=0;i<a;i++)t[i].updateRepeatNum(e)},updateTotalRepeatNum:function(e){this.huntingRechargeTotal+=e,this.repeatRechargeNum=Math.floor(this.huntingRechargeTotal/this.repeatRechargeVal)-this.repeatRechargeGetNum,this.updateRepeatTaskNum(this.repeatRechargeNum)},updatePartnerSel:function(){var e=this.storCfgs[this.selPartnerIndex];e&&(this.selPartnerId=e.awardId)},initTaskProcessMap:function(){for(var e=this.tasks.length,t=void 0,a=0;a<e;a++)t=this.tasks[a],this.taskProcessMap.set(t.taskType,t)},getCurOpenCfg:function(){var e=game.HuntingOpenCfg.getDatas();if(!e)return null;for(var t=e.length,a=0;a<t;a++){var i=e[a];if(this.checkIsOpen(i))return 0==this.endDay&&(this.endDay=i.serverEnd,this.costItemId=i.costItemId),i}return null},checkIsOpen:function(e){var t=e.serverStart,a=e.serverEnd;if(""==e.startTime){var i=game.miscData.openServerDay;return t<=i&&i<a}var n=game.TimeUtil.getOpenDayByStr(e.startTime,"yyyy-MM-dd hh:mm:ss"),s=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd hh:mm:ss").getTime(),r=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime(),o=game.SysTime.curTime;if(t<=n&&n<a&&s<=o&&o<r)return!0},getIsOpen:function(){return null!=this.getCurOpenCfg()},getCountDown:function(){if(!this.currCfg)return 0;if(""==this.currCfg.startTime){var e=this.endDay,t=game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,e-t)-game.SysTime.curTime}var a=game.SysTime.curTime;return b8e.TimeUtil.dateParse(this.currCfg.endTime,"yyyy-MM-dd hh:mm:ss").getTime()-a},getSelectStoreCfg:function(){var e=this.getStoreCfgs();if(!e||e.length<1)return null;var t=e[this.selPartnerIndex];return t||null},getCurrStoreCfg:function(){this.sObj||(this.sObj=b8e.createMap()),this.sObj.awardId=this.selPartnerId;var e=game.HuntingStoreCfg.getData(this.sObj);return e||null},getStoreCfgs:function(){return this.storCfgs.length<1&&(this.storCfgs=game.HuntingStoreCfg.getData(this.currCfg.luckyStore,!0)),this.storCfgs},getPartnerCfg:function(e){var t=e.giveItems,a=game.ItemInfoCfg.getData(t[0].Id);if(!a)return null;var i=game.PartnerCfg.getData(a.partnerId);return i||null},getTaskInfos:function(){this.taskIdMap.values().length<1&&this.initTaskInfo();var e=this.taskIdMap.values();return e.sort(this.sortHandler),e},initTaskInfo:function(){var e=game.HuntingTaskCfg.getData(this.id,!0);if(e)for(var t=e.length,a=void 0,i=void 0,n=void 0,s=void 0,r=0;r<t;r++)a=e[r],(i=new game.HuntingTaskInfo).cfg=a,this.taskIdMap.set(a.id,i),(n=this.taskTypeMap.get(a.taskType))||(n=[],this.taskTypeMap.set(a.taskType,n)),n.push(i),(s=this.taskProcessMap.get(a.taskType))&&i.setData(s),-1<this.taskRecords.indexOf(a.id)&&(i.isGet=!0,i.canGet=!1),a.taskType==this.repeatTaskType&&i.updateRepeatNum(this.repeatRechargeNum)},getScoreRewardInfos:function(){if(this.scoreRewardInfos.length<1){var e=game.HuntingScoreCfg.getData(this.id,!0);if(!e)return null;for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.HuntingScoreRewardInfo).cfg=a,this.scoreRewardInfos.push(i);this.upateScoreRewardInfo()}return this.scoreRewardInfos},initLimitedGiftInfos:function(){var e=game.HuntingRechargeCfg.getData(this.id,!0);if(!e)return null;for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++)a=e[s],(i=new game.HuntingLimitedGiftInfo).setData(a),(n=this.getInfoByRechargeId(a.rechargeId))&&i.updateBuyNum(n.times),this.limitedInfoMap.set(a.rechargeId,i)},getInfoByRechargeId:function(e){var t=this.huntingRecharges;if(!t)return null;for(var a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n]).giftId==e)return i},getLimitedGiftInfos:function(){var e=this.limitedInfoMap.values();return(!e||e.length<=0)&&this.initLimitedGiftInfos(),e},updataLimitedBuyNum:function(e){var t=this.limitedInfoMap.get(e);t&&t.updateBuyNum(1)},upateScoreRewardInfo:function(){for(var e=this.scoreRewardInfos.length,t=void 0,a=0;a<e;a++)t=this.scoreRewardInfos[a],-1<this.scoreExchange.indexOf(t.cfg.id)&&(t.isGet=!0),t.updateRewardState(this.score);this.scoreRewardInfos.sort(this.sortHandler)},getGiftInfos:function(){if(!this.currCfg)return null;this.giftInfoMap.values().length<1&&this.initGiftInfo();var e=this.giftInfoMap.values();return e.sort(this.giftSortHandler),e},initGiftInfo:function(){var e=game.HuntingGiftCfg.getData(this.id,!0);if(e){for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.HuntingGiftInfo).setData(a),this.giftInfoMap.set(a.id,i);t=this.gifts.length;for(var s=void 0,r=0;r<t;r++)s=this.gifts[r],(i=this.giftInfoMap.get(s.giftId))&&i.updateBuyTimes(s.times)}},updateGiftInfo:function(e){var t=e.giftId,a=this.giftInfoMap.get(t);a&&a.updateBuyTimes(e.num)},getRankRewardInfo:function(e){this.rankRewardInfos.length<1&&this.initRankRewardInfo();for(var t=void 0,a=this.rankRewardInfos.length,i=0;i<a&&!(e>=(t=this.rankRewardInfos[i]).startRank&&e<=t.endRank);i++);return t.getPrizeList()},initRankRewardInfo:function(){var e=game.openCompetitionData.getRaceRankCfgById(this.currCfg.raceRankId);if(e){var t=game.openCompetitionData.getRaceRankAwardCfgById(e.awardId);if(t)for(var a=void 0,i=t.length,n=0;n<i;n++)(a=new game.HuntingRankRewardInfo).setData(t[n]),this.rankRewardInfos.push(a)}},getTempRankList:function(e,t){var a=game.openCompetitionData.getRaceRankCfgById(t);if(a){var i=game.openCompetitionData.getRaceRankAwardCfgById(a.awardId);if(i){for(var n=0,s=0,r=i.length;s<r;s++)n=n<i[s].endRank?i[s].endRank:n;var o=void 0;if(n=50<n?50:n,!this.tempRankMap){this.tempRankMap=b8e.HashMap.get(),this.tempRankList=[];for(var g=0;g<50;g++)(o=new game.RankItemInfo).rank=g+1,this.tempRankMap.set(g+1,o)}for(var u=void(this.tempRankList.length=0),l=e.length>n?e.length:n,c=0;c<l;c++)l<=50?(o=this.tempRankMap.get(c+1),e.length>c?(u=e[c],o.rank=u.rank,o.score=u.score,o.name=u.name):(o.rank=c+1,o.score=0,o.name=""),this.tempRankList.push(o)):e.length>=l&&this.tempRankList.push(e[c]);return this.tempRankList}}},checkItemEnough:function(e,t){return t<=(e==game.HuntingCostType.ITEM?game.itemData.getCountById(this.costItemId):game.amount.get(game.AmountType.YUAN_BAO))},repeatRechargeVal:{get:function(){return this._repeatRechargeVal||(this._repeatRechargeVal=+game.CfgUtil.getMiscValue(game.HuntingMiscCfg,"repeatRechargeVal")),this._repeatRechargeVal}},repeatTaskType:{get:function(){return this._repeatTaskType||(this._repeatTaskType=+game.CfgUtil.getMiscValue(game.HuntingMiscCfg,"repeatTaskType")),this._repeatTaskType}},sortHandler:function(e,t){return e.isGet==t.isGet?e.canGet==t.canGet?e.cfg.id-t.cfg.id:e.canGet?-1:1:e.isGet?1:t.isGet?-1:void 0},giftSortHandler:function(e,t){return e.isBuyAll==t.isBuyAll?e.canFreeGet==t.canFreeGet?e.cfg.id-t.cfg.id:e.canFreeGet?-1:1:e.isBuyAll?1:-1},checkScoreRedPoint:function(){var e=this.getScoreRewardInfos();if(!e)return!1;for(var t=e.length,a=0;a<t;a++)if(e[a].canGet)return!0;return!1},checkTaskRedPoint:function(){var e=this.getTaskInfos();if(!e)return!1;for(var t=void 0,a=e.length,i=0;i<a;i++)if((t=e[i]).canGet||0<t.repeatNum)return!0;return!1},checkHuntingRedPoint:function(){return this.checkItemEnough(game.HuntingCostType.ITEM,1)},checkGiftRedPoint:function(){var e=this.getGiftInfos();if(!e)return!1;for(var t=e.length,a=0;a<t;a++)if(e[a].canFreeGet)return!0;return!1}});game.huntingContestData=game.huntingContestData||new e}(),function(){var e;e=b8e.Object.extends({cfg:null,buyTimes:0,isDaily:!1,isBuyAll:!1,canFreeGet:!1,setData:function(e){this.cfg=e,this.isDaily=e.isDaily,this.canFreeGet=0==e.currentPrice},updateBuyTimes:function(e){this.buyTimes+=e,this.isBuyAll=0<this.cfg.limitTimes&&this.buyTimes>=this.cfg.limitTimes,this.canFreeGet=0==this.cfg.currentPrice&&!this.isBuyAll},resetDaily:function(){this.buyTimes=0,this.isBuyAll=!1,this.canFreeGet=!0},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.cfg.award,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(i);return this.prizeList}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$HuntingGiftInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,isGet:!1,canGet:!1,updateRewardState:function(e){this.canGet=!this.isGet&&e>=this.cfg.score},getItemInfo:function(){if(!this.itemInfo){if(!this.cfg)return null;var e=this.cfg.award[0],t=e.Id,a=e.Num;this.itemInfo=game.ItemUtil.createBaseItemInfo(t,a)}return this.itemInfo}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$HuntingScoreRewardInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,dailyProcess:0,totalProcess:0,isGet:!1,canGet:!1,cfg:null,repeatNum:0,setData:function(e){this.dailyProcess=e.dailyProcess,this.totalProcess=e.totalProcess,this.updateProgress()},onGetReward:function(){this.canGet=!1,this.isGet=!0},updateProgress:function(){var e=0<this.cfg.isDaily?this.dailyProcess:this.totalProcess;e>this.cfg.condition&&(e=this.cfg.condition),this.canGet=e==this.cfg.condition&&!this.isGet},updateRepeatNum:function(e){this.repeatNum=e,this.canGet=!this.isGet&&0<this.repeatNum},resetDaily:function(){this.dailyProcess=0,this.totalProcess=0,this.isGet=!1,this.canGet=!1},getProcess:function(){return this.cfg.isDaily?this.dailyProcess:this.totalProcess},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.cfg.award,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(i);return this.prizeList}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$HuntingTaskInfo",e)}(),function(){var e;e=b8e.Object.extends({startRank:0,endRank:0,award:null,setData:function(e){this.startRank=e.startRank,this.endRank=e.endRank,this.award=e.award},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.award,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],i=game.ItemUtil.createPrizeInfo(a.Id,a.Num),this.prizeList.push(i);return this.prizeList}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$HuntingRankRewardInfo",e)}(),function(){var e;e=b8e.Object.extends({activityId:0,rechargeId:0,numLimit:0,types:0,oldMoney:0,nowMoney:0,buyNum:0,isGet:!1,cfg:null,setData:function(e){this.cfg=e,this.activityId=e.activityId,this.rechargeId=e.rechargeId,this.numLimit=e.numLimit,this.types=e.types,this.oldMoney=e.oldMoney,this.nowMoney=e.nowMoney},updateBuyNum:function(e){this.buyNum+=e,this.isGet=!this.isGet&&this.buyNum>=this.numLimit},resetDaily:function(){this.buyNum=0,this.isGet=!1},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.cfg.awards,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,this.prizeList.push(i);return this.prizeList}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$HuntingLimitedGiftInfo",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1466),this.spotAlerts={HUNTING_CONTEST_BUY:this.huntingAlert,HUNTING_CONTEST_TASK:this.taskAlert,HUNTING_CONTEST_GIFT:this.giftAlert},this.toggles={toggle_btn_1:game.ME.HuntingContest,toggle_btn_2:game.ME.HuntingTask,toggle_btn_3:game.ME.HuntingGift,toggle_btn_4:game.ME.HuntingContestRank,toggle_btn_5:game.ME.HuntingLimitedGift}},huntingAlert:function(e){this.skin.red_spot_1.active=e.alert},taskAlert:function(e){this.skin.red_spot_2.active=e.alert},giftAlert:function(e){this.skin.red_spot_3.active=e.alert},notify:function(e,t){switch(e){case this.Evts.C_TOGGLE_CHANGE:this.toggleTrigger(t)}},onShow:function(){this.toggleTrigger(0),game.recruitData.skipModuleId=game.ME.HuntingMain;var e=game.huntingContestData.currCfg,t=game.ResCfg.getUrl(10179,e.icon);this.skin.blueBtn_1.loadTexture(t);var a=game.ResCfg.getUrl(10179,e.title);this.skin.title.loadTexture(a)},toggleTrigger:function(e){if(this.toggleSelect(e)){var t=game.huntingContestData.currCfg,a=void 0;a=4==e?t.banner+"15":t.banner+""+(e+1);var i=game.ResCfg.getUrl(10153,a);this.skin.banner.loadTexture(i)}}});b8e.module.registerView(game.ME.HuntingMain,e)}(),function(){var e=game.CultivateBaseModelView.extends({ctor:function(){this._super(1469)},init:function(){var e=this.skin;this.initModel({type:game.RoleType.Partner,node:this.skin.modelNode}),this.moduleData=game.huntingContestData;var t=game.IconSizeEnum;this.costIcon1=game.GridUtil.createViewClickIcon(t.GRID_SIZE_42),this.costIcon1.addToParent(e.cost_1),this.costIcon2=game.GridUtil.createViewClickIcon(t.GRID_SIZE_42),this.costIcon2.addToParent(e.cost_2)},notify:function(e){switch(e){case this.Evts.V_UPDATE_SCORE_VIEW:case this.Evts.C_UPDATE_HUNTING_VIEW:this.updateView();break;case this.Evts.C_UPDATE_JUMP_BTN:this.updateJumpBtn();break;case this.Evts.C_UPDATE_RANK_VIEW:this.updateRank()}},onShow:function(){this.updateView(),this.updateActTime(),this.updateJumpBtn(),this.timer||(this.timer=b8e.Timer.add(this,this.updateActTime,1e3)),this.send(this.Evts.V_SHOW_VIEW)},onHide:function(){this.timer&&(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateView:function(){var e=this,t=e.skin,a=void 0;if(a=0==e.moduleData.selPartnerId?e.moduleData.getSelectStoreCfg():e.moduleData.getCurrStoreCfg()){var i=e.moduleData.getPartnerCfg(a);e.updateModel(game.RoleType.Partner,i);var n=game.ResCfg.getUrl(10050,i.element);t.elementTag.loadTexture(n);var s=e.moduleData.currCfg,r=game.ResCfg.getUrl(10179,s.text);t.desc_img.loadTexture(r),t.nameLab.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),t.scoreLab.string=game.Lang.get(52362,e.moduleData.score),t.redPoint_1.active=e.moduleData.checkScoreRedPoint(),t.redPoint_2.active=e.moduleData.checkItemEnough(game.HuntingCostType.ITEM,1),t.redPoint_3.active=e.moduleData.checkItemEnough(game.HuntingCostType.ITEM,10),e.updateCost()}},updateRank:function(){var e=this.skin,t=this.moduleData.currCfg.raceRankId,a=game.raceRankData.getRankInfoArrByType(t);if(a){for(var i=void 0,n=a.length,s="",r="",o=void 0,g=void 0,u=0;u<n&&3!=u;u++)g=(i=a[u]).rank,o=i.rank+" "+i.name,s+=this.getRankStr(g,o)+"\n",r+=this.getRankStr(g,i.score)+"\n";e.rankNameLab.string=s,e.rankScoreLab.string=r}},getRankStr:function(e,t){var a=game.Color,i=1==e?a.RED:2==e?a.PURPLE:a.BLUE;return game.HtmlUtil.getText(i,t)},updateCost:function(){var e=this.skin;this.moduleData.currCfg&&(this.setCost(this.costIcon1,1,e.costLab_1),this.setCost(this.costIcon2,10,e.costLab_2))},setCost:function(e,t,a){var i,n,s=t,r=this.moduleData.checkItemEnough(game.HuntingCostType.ITEM,t);n=this.moduleData.costItemId,i=game.itemData.getCountById(n),e.setItemId(n);var o=game.Color;a.color=r?o.GREEN:o.RED,a.string=game.Lang.get(1621,i,s),e.parent.x=a.x-a.width/2-15},updateActTime:function(){var e=this.moduleData.getCountDown(),t=void 0;0<e?(t=e<=6e4?b8e.TimeUtil.formatTime(e):b8e.TimeUtil.formatDayTime(e),this.skin.timeLab.string=game.Lang.get(52370,t)):(b8e.Timer.remove(this,this.updateActTime),this.timer=null)},updateJumpBtn:function(){this.skin.check1.active=this.moduleData.isJumpTween},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HuntingContest,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1468)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.HuntingTaskItem,t.bindEnum=game.ME.HuntingMain,t.layout.paddingLeft=10,t.layout.paddingTop=3,t.layout.spacingY=6,t.addToParent(e.rewList)},notify:function(e){switch(e){case this.Evts.V_DAILY_RESET:case this.Evts.C_UPDATE_TASK_VIEW:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.huntingContestData.getTaskInfos();e&&(this.list.setData(e),this.list.scrollToTop())},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HuntingTask,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1465)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.HuntingGiftItem,t.bindEnum=game.ME.HuntingMain,t.layout.paddingLeft=10,t.layout.paddingTop=3,t.layout.spacingY=6,t.addToParent(e.rewList)},notify:function(e){switch(e){case this.Evts.V_DAILY_RESET:case this.Evts.C_UPDATE_GIFT_VIEW:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.huntingContestData.getGiftInfos();e&&(this.list.setData(e),this.list.scrollToTop())},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HuntingGift,e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1467)},init:function(){this.moduleData=game.huntingContestData,this.initModel({type:game.RoleType.Partner,node:this.skin.modelNode})},notify:function(e,t){switch(e){case this.Evts.C_SWITCH_PARTNER:this.switchPartner(t)}},onShow:function(){this.updateView();var e=game.huntingContestData.currCfg,t=game.ResCfg.getUrl(10153,e.banner2);this.skin.bg2.loadTexture(t)},updateView:function(){var e=this.skin,t=this.moduleData.getStoreCfgs();if(t){this.length=t.length,e.left_btn.active=e.right_btn.active=1<this.length;var a=this.moduleData.getSelectStoreCfg();if(a){var i=a.awardId==this.moduleData.selPartnerId;e.isSelect.active=i,e.selectBtn.active=!i;var n=this.moduleData.getPartnerCfg(a);if(n){var s=game.ResCfg.getUrl(10050,n.element);e.elementTag.loadTexture(s),e.nameLab.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name),this.updateModel(game.RoleType.Partner,n)}}}},switchPartner:function(e){var t=e?-1:1,a=game.huntingContestData.selPartnerIndex;(a+=t)<0&&(a=this.length-1),a==this.length&&(a=0),game.huntingContestData.selPartnerIndex=a,this.updateView()}});b8e.module.registerView(game.ME.HuntingPartner,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1496)},init:function(){var e=this.skin;this.moduleData=game.huntingContestData;var t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.HuntingContestRankItem,t.bindEnum=game.ME.HuntingMain,t.layout.paddingLeft=10,t.layout.paddingTop=3,t.layout.spacingY=6,t.addToParent(e.rewList)},notify:function(e){switch(e){case this.Evts.C_UPDATE_RANK_VIEW:this.updateView()}},onShow:function(){this.send(this.Evts.V_SHOW_VIEW),this.updateView()},updateView:function(){var e=this,t=e.skin,a=e.moduleData.currCfg.raceRankId,i=game.raceRankData.getRankInfoArrByType(a);if(i=game.huntingContestData.getTempRankList(i,a)){e._maxRankNum||(e._maxRankNum=+game.CfgUtil.getMiscValue(game.HuntingMiscCfg,"maxRankNum")),i.length>e._maxRankNum&&(i.length=e._maxRankNum),t.notRankLab.active=i.length<1,e.list.setData(i);var n=game.raceRankData.getSelfRankInfo(a);n&&(t.myRankLab.string=game.Lang.get(52429,n.rank),t.myScoreLab.string=game.Lang.get(52430,e.moduleData.score),e._rankScore||(e._rankScore=+game.CfgUtil.getMiscValue(game.HuntingMiscCfg,"huntingRankScore")),t.descLab.string=game.Lang.get(52444,e._rankScore))}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HuntingContestRank,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1464),this.setSize(602,157)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=40},setData:function(e){var t=this.skin,a=e.cfg,i=game.Color,n=e.isBuyAll?i.RED:i.GREEN;t.buyNumLab.color=n;var s=a.limitTimes;t.buyNumLab.string=0<s?game.Lang.get(1621,s-e.buyTimes,s):game.Lang.get(52365),game.ShaderUtil.setGray(t.getRewBtn,e.isBuyAll),t.originalPriceLab.string=game.Lang.get(52366,a.originalPrice),t.currentPriceLab.string=game.Lang.get(52367,a.currentPrice),t.redPoint.active=e.canFreeGet,this.updateRewList()},updateRewList:function(){var e=this.data.getPrizeList();e&&this._list.setData(e)},getRewBtn:function(){this.data.isBuyAll||this.send(game.HuntingContestEvts.V_BUY_GIFT,this.data.cfg)}}),b8e.RC("$$game","$$HuntingGiftItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1446),this.setSize(540,126)},init:function(){this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.itemIcon)},setData:function(e){var t=this.skin,a=e.cfg,i=e.getItemInfo();if(i){this.icon.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NUM);var n=game.ItemInfoCfg.getData(i.id);n&&(t.itemName.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name))}var s=a.score;t.countLab.string=game.Lang.get(52360,s);var r=game.Color,o=e.canGet||e.isGet?r.GREEN:r.RED,g=game.HtmlUtil.getText(o,game.huntingContestData.score);t.countDesc.string=game.Lang.get(52361,g,s);var u=e.canGet;t.redPoint.active=u,game.ShaderUtil.setGray(t.getBtn,e.isGet),t.getLab.string=u?game.Lang.get(51860):game.Lang.get(51862),t.hsaGet.active=e.isGet,t.getBtn.active=t.countDesc.active=!e.isGet},getBtn:function(){this.data.canGet||this.data.isGet?this.send(game.HuntingContestEvts.V_GET_SCORE_REWARD,this.data.cfg.id):game.notice.show(52368)}}),b8e.RC("$$game","$$HuntingScoreRewardItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1497),this.setSize(602,94)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=16,this._list.layout.paddingTop=6,this._list.layout.paddingLeft=0},setData:function(e){var t=this.skin;t.rank1.active=1==e.rank,t.rank2.active=2==e.rank,t.rank3.active=3==e.rank,t.rankLab.string=e.rank,t.nameLab.string=e.name?e.name:"",t.scoreLab.string=e.score?e.score:"",this.updateRewList()},updateRewList:function(){var e=game.huntingContestData.getRankRewardInfo(this.data.rank);e&&(this._list.setData(e),this.skin.list.x=1==e.length?386+this.skin.list.width/2-35:this.skin.list.x=386)}}),b8e.RC("$$game","$$HuntingContestRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1445)},init:function(){var e=this.skin;e.titleLab.string=game.Lang.get(52369);var t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.HuntingScoreRewardItem,t.bindEnum=game.ME.HuntingMain,t.layout.paddingLeft=5,t.layout.paddingTop=3,t.layout.spacingY=6,t.addToParent(e.list)},notify:function(e){switch(e){case this.Evts.V_UPDATE_SCORE_VIEW:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.huntingContestData.getScoreRewardInfos();e&&this.list.setData(e)}});b8e.module.registerView(game.ME.HuntingScoreReward,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1463),this.setSize(602,178)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=40},setData:function(e){var t=this.skin,a=e.cfg,i=game.Color,n=e.canGet||e.isGet?i.GREEN:i.RED,s=game.HtmlUtil,r=s.getText(n,e.getProcess());t.processLab.string=game.Lang.get(52364,r,a.condition),t.titleLab.string=a.desc,t.processLab.x=t.titleLab.x+t.titleLab.width+10,t.btn_lbl.string=e.canGet?game.Lang.get(51860):game.Lang.get(51861),t.getRewBtn.active=!e.isGet,t.isGet.active=e.isGet,t.redPoint.active=e.canGet;var o=a.taskType==game.huntingContestData.repeatTaskType;if(t.processLab.active=!o,t.canGetNumLab.active=o){n=0<e.repeatNum?i.GREEN:i.RED;var g=s.getText(n,e.repeatNum);t.canGetNumLab.string=game.Lang.get(52428,g)}this.updateRewList()},updateRewList:function(){var e=this.data.getPrizeList();e&&this._list.setData(e)},getRewBtn:function(){var e=this.data.cfg;if(this.data.canGet)this.send(game.HuntingContestEvts.V_GET_TASK_REWARD,this.data.cfg.id);else{var t=e.moduleId;if(0==t&&game.module.hide(game.ME.HuntingMain),t==game.ME.Guild&&!game.guildData.hasGuild())return void game.notice.show(9037);game.module.showToggle(t,e.toggleId)}}}),b8e.RC("$$game","$$HuntingTaskItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1738),this.setSize(602,178)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=40},setData:function(){var e=this.data,t=this.skin,a=e.numLimit,i=e.types,n=e.oldMoney,s=e.nowMoney,r=a-e.buyNum,o=e.isGet;t.prev_price.string=game.Lang.get(53581,n),t.new_price.string=game.Lang.get(53582,s),t.canGetNumLab.string=o?game.Lang.get(53584,r,a):game.Lang.get(53583,r,a),t.dayImg.active=1==i,t.numImg.active=2==i,t.getBuyBtn.active=!o,t.isGet.active=o,this.updateRewList()},updateRewList:function(){var e=this.data.getPrizeList();e&&this._list.setData(e)},getBuyBtn:function(){this.data.isGet||this.send(game.HuntingContestEvts.C_GIFT_LIMITED,this.data.rechargeId)}}),b8e.RC("$$game","$$HuntingLimitedGiftItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1737)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.HuntingLimitedGiftItem,t.bindEnum=game.ME.HuntingMain,t.layout.paddingLeft=10,t.layout.paddingTop=3,t.layout.spacingY=6,t.addToParent(e.giftList)},notify:function(e){switch(e){case this.Evts.V_DAILY_RESET:case this.Evts.C_UPDATE_LIMITED_VIEW:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=game.huntingContestData.getLimitedGiftInfos();e&&(e.sort(this.onSort),this.list.setData(e),this.list.scrollToTop())},onSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:0},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.HuntingLimitedGift,e)}(),function(){var e;e=b8e.Enum({None:0,C2C_UPDATA_FREE_INFO:-1,SEND_BUY_GIFT:-1,SEND_BUY_GIFT2:-1,C2C_RECHARGE:-1,V_TOGGLECHANGE:-1,UPDATA_DAY_WEEK_VIEW:-1,UPDATA_RED_PIONT:-1,V2C_ON_HIDE:-1,C2C_CLOSR_ACT:-1}),b8e.RC("$$game","$$DayOrWeekGiftEvts",e)}(),function(){var e=b8e.Object.extends({selectId:1,actDicType:null,btnType:null,actById:null,redPiont:!0,endDay:0,allDic:null,fastBuyBol:!1,peizhiFast:!1,fastData:null,buyOneBol:!1,ctor:function(){this._super(),this.welfareBtns=[],this.welfareBtnsMap=b8e.HashMap.get()},updataDayInfo:function(){var e=this.actDicType[1],t=e.length;if(e&&0<t)for(var a=0;a<t;a++)e[a].updataFast(this.fastBuyBol)},periodic:function(e){for(var t=this.rpInfoMap=b8e.HashMap.get(),a=e.length,i=0;i<a;i++){var n=e[i],s=n.eventId;t.set(s,n)}},updataFristReq:function(e){this.buyOneBol=!1,this.fastBuyBol=!1,this.peizhiFast=!1,this.fastData=null;for(var t=this.rpInfoMap,a=0,i=t.values(),n=0;n<i.length;n++)a=i[n].eventId,this.allDic[a].types==e&&t.del(a)},setCfgData:function(){var e=this,t=game.PeriodicPrizeCfg.getDatas(),a=game.PeriodFastBuyCfg.getDatas();if(t&&!(t.length<1)){var i=t.length,n=game.miscData.openServerDay,s=void 0,r=void 0;e.actDicType={},e.actById={},e.btnType=[],e.allDic={};for(var o=0;o<i;o++)if(s=t[o]){if(n>=s.serverStart&&n<s.serverEnd){(r=new game.DayOrWeekGiftInfo).isbuyNum=0,r.isGetPrize=!1,r.fastBuyBol=!1;var g=e.rpInfoMap.get(s.id);g&&(r.isbuyNum=g.num,!e.fastBuyBol&&!e.buyOneBol&&0<s.money&&1==s.types&&(e.buyOneBol=!0)),r.setConfig(s),e.actDicType[s.types]||(e.actDicType[s.types]=[]),e.actDicType[s.types].push(r),e.actById[s.id]=r,e.btnType.indexOf(s.types)<0&&e.btnType.push(s.types),1==s.types&&0<s.money&&(r.fastBuyBol=e.fastBuyBol)}e.allDic[s.id]=s}if(e.btnType[0]&&(e.selectId=e.btnType[0]),e.actDicType[1]){var u=e.actDicType[1][0];if(u)for(var l=a.length,c=void 0,h=0;h<l;h++)(c=a[h]).serverStart>=u.config.serverStart&&c.serverEnd<=u.config.serverEnd&&n>=c.serverStart&&n<c.serverEnd&&(e.fastData=c,e.peizhiFast=!0)}}},getTimeDayOrWeek:function(e){var t=game.SysTime.curTime,a=0!=b8e.TimeUtil.getDay(t)?b8e.TimeUtil.getDay(t):7;if(1==e)return b8e.TimeUtil.getTodayTime(t)+b8e.TimeUtil.DAY_MICRO_SECONDS-t;if(2==e){var i=7-a;return b8e.TimeUtil.getTodayTime(t)+b8e.TimeUtil.DAY_MICRO_SECONDS-t+i*b8e.TimeUtil.DAY_MICRO_SECONDS}},getOpenAct:function(){var e=this.allDic,t=void 0,a=game.miscData.openServerDay;for(var i in e)if((t=e[i])&&a>=t.serverStart&&a<t.serverEnd)return i;return null},getGiftInfoById:function(e){return this.actById[e]},updataFreeInfo:function(e){var t=this.actDicType[this.selectId],a=t.length,i=void 0;if(t&&0<a)for(var n=0;n<a;n++)if(e==t[n].id){i=t[n];break}!this.buyOneBol&&1==i.type&&0<i.config.money&&(this.buyOneBol=!0),i.updataNum(1);var s={};s.eventId=e,s.num=i.isbuyNum,this.rpInfoMap.set(e,s)},getBtns:function(){return this.btnType},getitems:function(){var e=this.actDicType[this.selectId];return e&&0<e.length&&(e.sort(this.onSort),this.endDay=e[0].config.serverEnd),e},onSort:function(e,t){return!e.isGetPrize&&t.isGetPrize?-1:e.isGetPrize&&!t.isGetPrize?1:void 0},isBuyAnyDayGift:function(e){var t=!(0<arguments.length&&void 0!==e)||e?1:2;if(!this.actDicType)return!1;var a=this.actDicType[t];if(!a&&a.length<1)return!1;for(var i=a.length,n=0;n<i;n++)if(a[n].isbuyNum)return!0;return!1},setSelect:function(e){this.selectId=e}});game.dayOrWeekGiftData=game.DayOrWeekGiftData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,role_level:0,isGetPrize:!1,config:null,isbuyNum:0,type:0,fastBuyBol:!1,setConfig:function(e){this.config=e,this.id=e.id,this.type=e.types,this.isGetPrize=this.isbuyNum>=e.num},updataNum:function(e){this.isbuyNum+=e,this.isGetPrize=this.isbuyNum>=this.config.num},updataFast:function(e){this.fastBuyBol=e},getPrizeItems:function(){var e=this;if(!e.config){return null}if(e.awards){return e.awards}var t,a,i=e.config.giveItems,n=i.length;e.awards=[];for(var s=0;s<n;s++){t=i[s],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),e.awards.push(a)}return e.awards}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$DayOrWeekGiftInfo",t)}(),function(){var e=game.Control.extends({ctor:function(){this._super()},init:function(){this.data=game.dayOrWeekGiftData,this.allAlert=game.spotAlert.set(game.SAE.DAYORWEEK_ALL,game.SAE.RECHARGE_HALL_RECHARGE),this.dayAlert1=game.spotAlert.set(game.SAE.DAYORWEEK_BTN1,game.SAE.DAYORWEEK_ALL),this.dayAlert2=game.spotAlert.set(game.SAE.DAYORWEEK_BTN2,game.SAE.DAYORWEEK_ALL)},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess,C_INIT_MODEL:this.initRecharge},MainRole:{C_RESET_DAILY:this.resetDaily,C_RESET_WEEK:this.resetWeek}},this.handels={PeriodPrizeResp:this.periodPrizeResp}},notify:function(e,t){switch(e){case this.Evts.SEND_BUY_GIFT:this.buyGift(t);break;case this.Evts.SEND_BUY_GIFT2:this.buyGift2(t);break;case this.Evts.UPDATA_RED_PIONT:this.checkAlert();break;case this.Evts.V2C_ON_HIDE:this.dpt(this.Evts.C2C_CLOSR_ACT)}},buyGift2:function(e){var t=this.data.getGiftInfoById(e).config;t.money,t.rechargeId;this.lastBuyData=t,this.sender.PeriodPrizeReq(t.id)},buyGift:function(e){var t=this.data.getGiftInfoById(e).config,a=t.money>>0,i=t.rechargeId;this.lastBuyData=t,0==a?this.sender.PeriodPrizeReq(t.id):0<a&&(this.lastBuyData=t,this.dpt(this.Evts.C2C_RECHARGE,i))},getBtn:function(){var e=this.data.fastData;this.lastBuyData=e,this.fastId=e.rechargeId,this.dpt(this.Evts.C2C_RECHARGE,e.rechargeId)},initRecharge:function(){var e=game.rechargeData.periodic,t=game.rechargeData.periodFastBuy;e&&(this.data.periodic(e),this.data.fastBuyBol=t,this.data.setCfgData(),this.checkAlert())},rechargeSuccess:function(e){var t=this;if(e&&e.data){var a=e.data.id;t.lastBuyData&&(a==t.fastId?t.data.fastBuyBol||(t.data.fastBuyBol=!0,t.data.updataDayInfo(),t.send(t.Evts.C2C_UPDATA_FREE_INFO),t.checkAlert()):t.lastBuyData.rechargeId==a&&(t.data.updataFreeInfo(t.lastBuyData.id),t.send(t.Evts.C2C_UPDATA_FREE_INFO),t.checkAlert()))}},resetDaily:function(){this.data.getOpenAct()?(this.data.updataFristReq(1),this.data.setCfgData(),this.send(this.Evts.UPDATA_DAY_WEEK_VIEW,this.data.selectId),this.checkAlert()):b8e.module.isShowView(game.ME.DayOrWeekGift)&&game.module.hide(game.ME.RechargeHall)},resetWeek:function(){this.data.getOpenAct()?(this.data.updataFristReq(2),this.data.setCfgData(),this.send(this.Evts.UPDATA_DAY_WEEK_VIEW,this.data.selectId),this.checkAlert()):b8e.module.isShowView(game.ME.DayOrWeekGift)&&game.module.hide(game.ME.RechargeHall)},periodPrizeResp:function(e){var t=e.readProtobuf(game.pb.PeriodPrizeResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updataFreeInfo(t.id),this.send(this.Evts.C2C_UPDATA_FREE_INFO),this.checkAlert())},checkAlert:function(){if(this.data.getOpenAct()){var e=this.data.actById,t=this.data.btnType,a=void 0;for(var i in this.dayAlert1.alert=!1,this.dayAlert2.alert=!1,e)a=e[i].config,e[i].isGetPrize&&!this.data.redPiont||0<=t.indexOf(a.types)&&(1==a.types&&0==a.money||e[i].fastBuyBol?this.dayAlert1.alert=!0:2==a.types&&0==a.money&&(this.dayAlert2.alert=!0))}}}),t=game.Sender.extends({ipc:function(){this.msg={PeriodPrizeReq:this.PeriodPrizeReq}},PeriodPrizeReq:function(e){var t=game.pb.PeriodPrizeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.DayOrWeekGift,e,game.DayOrWeekGiftEvts,t)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1472),this.setSize(686,196)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.prize),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=17,t.layout.spacingY=-5},setData:function(){var e=this,t=e.skin,a=e.data.config;t.level.string=a.name;var i=e.data.getPrizeItems();this.prizeList.setData(i);var n,s=a.num,r=e.data.isbuyNum,o=s-r,g=a.discount>>0,u=void 0;n=game.ResCfg.getUrl(10155,g),9==g?u=game.ResCfg.getUrl(10155,"high"):7<=g&&g<=8?u=game.ResCfg.getUrl(10155,"amid"):5<=g&&g<=6?u=game.ResCfg.getUrl(10155,"general"):1<=g&&g<=4?u=game.ResCfg.getUrl(10155,"low"):0==g&&(u=game.ResCfg.getUrl(10155,"high")),e.skin.discountImg.loadTexture(u),e.skin.discountNum.loadTexture(n),e.skin.doubleNode.active=1==a.isDiamond,e.skin.redPoint.active=!1,0!=a.money||e.data.isGetPrize||(e.skin.redPoint.active=!0),r<s?(t.canGetLevel.string=game.Lang.get(52373,o,s),t.canGetLevel.active=!0,e.data.fastBuyBol?(0<a.money&&(e.skin.redPoint.active=!0),t.recBtn.active=!0,t.getBtn.active=!1):(t.recBtn.active=!1,t.getBtn.active=!0),0==a.money&&(t.recBtn.active=!1,t.getBtn.active=!0),t.getPrize.active=!1):(t.canGetLevel.active=!1,t.getPrize.active=!0,t.getBtn.active=!1,t.recBtn.active=!1),t.prev_name.string=game.Lang.get(52371,a.old),t.new_name.string=game.Lang.get(52372,a.money)},getBtn:function(){this.send(game.DayOrWeekGiftEvts.SEND_BUY_GIFT,this.data.id)},recBtn:function(){this.send(game.DayOrWeekGiftEvts.SEND_BUY_GIFT2,this.data.id)}})).poolCall=!0,b8e.RC("$$game","$$DayOrWeekGiftItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1471)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.DayOrWeekGiftItem,this.list.bindEnum=this.moduleEnum,this.list.layout.paddingLeft=6,this.list.layout.paddingTop=10,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list)},notify:function(e,t){switch(e){case this.Evts.C2C_UPDATA_FREE_INFO:this.updataView();break;case this.Evts.V_TOGGLECHANGE:case this.Evts.UPDATA_DAY_WEEK_VIEW:this.selectEffect(t),this.updataView(t)}},onShow:function(){var e=game.dayOrWeekGiftData.selectId;game.dayOrWeekGiftData.redPiont&&(game.dayOrWeekGiftData.redPiont=!1,this.send(game.DayOrWeekGiftEvts.UPDATA_RED_PIONT)),this.selectEffect(e),this.updataView()},updataView:function(){this.updataGiftSc(),this.updataBtnSc(),this.createTimer(),this.updataFastBuy()},updataFastBuy:function(){var e=game.dayOrWeekGiftData.fastBuyBol,t=game.dayOrWeekGiftData.fastData,a=game.dayOrWeekGiftData.buyOneBol;this.skin.fastBuyNode.active&&(this.skin.getBtn.active=!e&&!a,this.skin.getNotBtn.active=e||a,this.skin.prev_name.string=game.Lang.get(52371,t.old),this.skin.new_name.string=game.Lang.get(52372,t.money))},selectEffect:function(e){var t=game.dayOrWeekGiftData.peizhiFast;this.skin.fastBuyNode.active=!!t&&1==e},updataBtnSc:function(){},updataGiftSc:function(){this.list.scrollToTop(),this.items=game.dayOrWeekGiftData.getitems(),this.list.setData(this.items)},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.dayOrWeekGiftData.selectId,t=game.dayOrWeekGiftData.getTimeDayOrWeek(e);if(t<1)this.clearTimer();else{var a=game.TimeUtil.formatTimeSpace(t,3);this.skin.timeLab.string=game.Lang.get(51900,a)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.send(this.Evts.V2C_ON_HIDE)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.DayOrWeekGift,e)}(),function(){var e;e=b8e.Enum({SEND_BUY_FIND:-1,SEND_ALERT_TYPE_INFO:-1,CLOSE_ALERT:-1,UPDATA_VIEW:-1}),b8e.RC("$$game","$$RecRecoveryEvts",e)}(),function(){var e=b8e.Object.extends({selectType:null,selectInfo:null,canFindDic:null,canFindAry:null,ctor:function(){this._super()},updataItemsAry:function(e){if(0==e)this.canFindDic={};else for(var t in this.canFindDic)t==e&&delete this.canFindDic[e]},resData:function(e){for(var t=this.rpInfoMap=b8e.HashMap.get(),a=e.length,i=0;i<a;i++){var n=e[i],s=n.resType;t.set(s,n)}},setCfgData:function(){var e=game.ResFindCfg.getDatas();if(e&&!(e.length<1)){var t=e.length,a=void 0,i=void 0,n=void 0,s=game.mainRoleData.lv,r=game.guildData.hasGuild(),o=game.guildData.getGuildLevel();this.canFindDic={},this.canFindAry=[];for(var g=0;g<t;g++){if(!(a=e[g]))return;i=a.resType;var u=this.rpInfoMap.get(i);if(u&&(n=new game.RecRecoveryInfo,9!=i&&10!=i||!(s<a.level||s>=a.levelend))){if(11==i){if(!r)continue;if(a.level!=o)continue}n.findNum=u.count,n.setData(a),this.canFindDic[a.resType]=n,this.canFindAry.push(n)}}}},isRedPiont:function(){var e=this.canFindDic;for(var t in e)if(0<e[t].findNum)return!0;return!1},getitems:function(){var e=this.canFindDic,t=[];for(var a in e)t.push(e[a]);return t},getAllMoney:function(){var e=this.canFindDic,t=0;for(var a in e)t+=e[a].needMoney;return t}});game.recRecoveryData=game.recRecoveryData||new e}(),function(){var e;e=b8e.Object.extends({resType:0,level:0,insId:0,costNum:0,name:null,info:null,findNum:0,needMoney:0,ctor:function(){},setData:function(e){e&&(this.info=e,this.resType=e.resType,this.level=e.level,this.insId=e.insId,this.costNum=e.costNum,this.name=e.name,this.needMoney=this.findNum*e.costNum)},getViewItems:function(){if(!this.info){return null}if(this.awards){return this.awards}var e,t,a=this.info.items,i=a.length;this.awards=[];for(var n=this.findNum,s=0;s<i;s++){e=a[s],t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num*n),this.awards.push(t)}return this.awards},getAlertItems:function(){if(!this.info){return null}if(this.alerts){return this.alerts}return this.alerts={},this.alerts.items=this.info.items,this.alerts.findNum=this.findNum,this.alerts}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RecRecoveryInfo",e)}(),function(){var e=game.Control.extends({ctor:function(){this._super()},init:function(){this.data=game.recRecoveryData,this.dayAlert1=game.spotAlert.set(game.SAE.REC_RECOVERY_ALERT,game.SAE.DAILY_FULI)},ipc:function(){this.evts={DailyFuLi:{C_INIT_MODULE:this.initModule},MainRole:{C_RESET_DAILY:this.resetDaily,C_LEVEL_UP:this.mainUpdataLv},Guild:{C_UPDATE_GUILD:this.mainUpdataLv}},this.handels={ResFindResp:this.ResFindResp}},mainUpdataLv:function(){this.data.setCfgData(),this.checkAlert(),this.send(this.Evts.UPDATA_VIEW)},initModule:function(e){if(e&&e.data){var t=e.data.resDatas;this.data.resData(t),this.data.setCfgData(),this.checkAlert()}else;},notify:function(e,t){switch(e){case this.Evts.SEND_ALERT_TYPE_INFO:this.selectInfo(t)}},selectInfo:function(e){this.data.selectType=e.resType,this.data.selectInfo=e,game.module.show(game.ME.RecRecoveryAlert)},resetDaily:function(){this.sender.DailyDataReq(),this.send(this.Evts.UPDATA_VIEW)},ResFindResp:function(e){var t=e.readProtobuf(game.pb.ResFindResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.resType;this.data.updataItemsAry(a),this.send(this.Evts.UPDATA_VIEW),this.checkAlert()}},findResources:function(e){var t=e.type,a=e.isfree;this.sender.ResFindReq(t,a)},getBtn:function(){this.data.selectType=0,game.module.show(game.ME.RecRecoveryAlert)},freeBtn:function(){var e={};e.type=game.recRecoveryData.selectType,e.isfree=!0,this.findResources(e),this.send(this.Evts.CLOSE_ALERT)},moneyBtn:function(){var e={};e.type=game.recRecoveryData.selectType,e.isfree=!1,this.findResources(e),this.send(this.Evts.CLOSE_ALERT)},checkAlert:function(){var e=this.data.isRedPiont();this.dayAlert1.alert=e}}),t=game.Sender.extends({ipc:function(){this.msg={ResFindReq:this.resFindReq,DailyDataReq:null}},resFindReq:function(e,t){var a=game.pb.ResFindRequest;a.resType=e,a.isFree=t,this.write(a)}}),a=[game.ME.RecRecoveryAlert];b8e.module.registerControl(game.ME.RecRecovery,e,game.RecRecoveryEvts,t,a)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1482),this.setSize(601,177)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.prize),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=17,t.layout.spacingY=-5},setData:function(){var e=this.skin,t=this.data;e.name.string=t.name;var a=t.findNum;e.redPoint.active=0<a;var i=this.data.getViewItems();this.prizeList.setData(i)},getBtn:function(){this.send(game.RecRecoveryEvts.SEND_ALERT_TYPE_INFO,this.data)}})).poolCall=!0,b8e.RC("$$game","$$RecRecoveryItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(game.UIUrl.get(1481)),this.spotAlerts={REC_RECOVERY_ALERT:this.dayAlert1}},dayAlert1:function(e){this.skin.redPoint.active=e.alert},init:function(){this._gridList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._gridList.itemRender=game.RecRecoveryItem,this._gridList.bindEnum=this.moduleEnum,this._gridList.layout.paddingLeft=0,this._gridList.layout.spacingY=5,this._gridList.addToParent(this.skin.scrollGrid)},notify:function(e){switch(e){case this.Evts.UPDATA_VIEW:this.updataView()}},onShow:function(){this.updataView()},updataView:function(){var e=this;e._gridList.scrollToTop(),e.items=game.recRecoveryData.getitems(),e.skin.scrollGrid.active=!1,e.skin.noItem.active=!1,0<e.items.length?(e.skin.scrollGrid.active=!0,e._gridList.setData(e.items)):e.skin.noItem.active=!0;var t=game.recRecoveryData.getAllMoney();e.skin.money.string=t},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.RecRecovery,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(game.UIUrl.get(1483))},init:function(){},notify:function(e){switch(e){case this.Evts.CLOSE_ALERT:game.module.hide(this.moduleEnum)}},onShow:function(){this.updataView()},updataView:function(){var e=this.skin;if(e.oneTxt.active=!1,e.allTxt.active=!1,e.itemList.active=!1,0==game.recRecoveryData.selectType)e.allTxt.active=!0,e.allTxt.string=game.Lang.get(52420,game.recRecoveryData.getAllMoney()),e.tipsTitleLab.string=game.Lang.get(52431),e.money.string=game.recRecoveryData.getAllMoney();else{var t=game.recRecoveryData.selectInfo;e.oneTxt.active=!0,e.itemList.active=!0,e.tipsTitleLab.string=t.name,e.money.string=t.needMoney,this.prizeIconList=[],this.itemInfoList=[],this.skin.itemList.removeAllChildren();for(var a=t.getAlertItems(),i=a.items,n=a.findNum,s=game.IconSizeEnum.GRID_SIZE_105,r=i.length,o=116*(r-1)/2,g=this.prizeIconList,u=this.itemInfoList,l=this.skin.itemList,c=void 0,h=void 0,m=game.IconLayoutEnum.SHOW_NUM,d=0;d<r;d++)c=i[d],h=game.ItemUtil.createBaseItemInfo(c.Id,c.Num*n,u[d],!0),g[d]||(g[d]=game.GridUtil.createItemIcon(s),g[d].addToParent(l)),game.GridUtil.setItemIcon(g[d],h,!1,m),g[d].setPosition((s+16)*d-o,0)}}});b8e.module.registerView(game.ME.RecRecoveryAlert,e)}(),function(){var e;e=b8e.Enum({None:0,C2C_RECHARGE:-1,SEND_BUY_GIFT:-1,UPDATA_VIEW:-1,UPDATA_RECHARGE:-1,C2C_REFRESH_BTNS:-1}),b8e.RC("$$game","$$OneYuanBuyEvts",e)}(),function(){var e=b8e.Object.extends({yiyuan:!1,yiyuanExpireTime:null,yiyuanRecords:null,items:null,ctor:function(){this._super()},updataYiYuan:function(e){this.yiyuan=e},setCfgData:function(){var e=game.YiyuanBuyCfg.getDatas();if(e&&!(e.length<1)){var t=e.length,a=void 0;this.items=[];for(var i=void 0,n=0;n<t;n++)a=e[n],(i=new game.OneYuanBuyInfo).setConfig(a),this.items.push(i)}},updataBuyId:function(e){this.yiyuanRecords.indexOf(e)<0&&this.yiyuanRecords.push(e);for(var t=this.items.length,a=void 0,i=0;i<t;i++)(a=this.items[i]).config.id==e&&a.updataIndex()},updataBuyId2:function(){for(var e=this.items.length,t=0;t<e;t++)this.items[t].updataIndex()},getitems:function(){return this.items},checkAlert:function(){if(this.yiyuan){var e=game.YiyuanBuyCfg.getDatas();if(!e||e.length<1)return;for(var t=game.mainRoleData.power,a=this.yiyuanRecords,i=e.length,n=void 0,s=0;s<i;s++)if(n=e[s],a.indexOf(n.id)<0&&t>=n.power)return!0}return!1},getCountDown:function(){if(!game.moduleOpen.checkOpen(game.ME.OneYuanBuy))return 0;if(this.yiyuan)return 0;var e=this.yiyuanExpireTime-game.SysTime.curTime;return 0<e?e:0},checkActIsOpen:function(){if(this.yiyuanRecords){var e=this.yiyuanRecords.length;if(this.items){var t=this.items.length,a=game.oneYuanBuyData.yiyuanExpireTime,i=a-game.SysTime.curTime;return this.yiyuan?!(t<=e)||(b8e.module.isShowView(game.ME.OneYuanBuy)&&game.module.hide(game.ME.OneYuanBuy),!1):0==e&&0==a?(b8e.evt.dptG(game.OneYuanBuyEvts.UPDATA_RECHARGE),!1):0<i||(b8e.module.isShowView(game.ME.OneYuanBuy)&&game.module.hide(game.ME.OneYuanBuy),!1)}}}});game.oneYuanBuyData=game.OneYuanBuyData||new e}(),function(){var e;e=b8e.PoolObject.extends({config:null,index:0,setConfig:function(e){this.config=e},updataIndex:function(){this.index++},getItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e,t,a=this.config.giveItems,i=a.length;this.awards=[];for(var n=0;n<i;n++)e=a[n],t=game.ItemUtil.createBaseItemInfo(e.Id,e.Num),this.awards.push(t);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OneYuanBuyInfo",e)}(),function(){var e=game.Control.extends({ctor:function(){this._super()},init:function(){this.data=game.oneYuanBuyData,this.oneDay=game.spotAlert.set(game.SAE.ONE_YUAN_ALERT)},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess,C_INIT_MODEL:this.initRecharge},MainRole:{C_POWER_CHANGE:this.updataPower}},this.gevts={OneYuanBuyEvts:{UPDATA_RECHARGE:this.sendRecharge}},this.handels={YiyuanResp:this.yiyuanResp}},notify:function(e,t){switch(e){case this.Evts.SEND_BUY_GIFT:this.buyGift(t)}},sendRecharge:function(){this.sender.RechargeModelReq()},buyGift:function(e){this.sender.YiyuanReq(e)},initRecharge:function(){var e=game.rechargeData.yiyuan,t=game.rechargeData.yiyuanExpireTime,a=game.rechargeData.yiyuanRecords;this.data.yiyuan=e,this.data.yiyuanExpireTime=t,this.data.yiyuanRecords=a,this.data.setCfgData(),this.checkAlert(),0<t&&this.createTimer()},createTimer:function(){this.setCountDown();var e=game.oneYuanBuyData.yiyuanExpireTime-game.SysTime.curTime;this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,e)},setCountDown:function(){if(!this.data.yiyuan)return this.dpt(this.Evts.C2C_REFRESH_BTNS),void this.clearTimer();this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},rechargeSuccess:function(e){e&&e.data&&9619==e.data.id&&(this.data.updataYiYuan(!0),this.send(this.Evts.UPDATA_VIEW),this.data.updataBuyId2(1),this.checkAlert())},yiyuanResp:function(e){var t=e.readProtobuf(game.pb.YiyuanResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updataBuyId(t.id),this.send(this.Evts.UPDATA_VIEW),this.checkAlert(),this.dpt(this.Evts.C2C_REFRESH_BTNS))},buy01:function(){this.dpt(this.Evts.C2C_RECHARGE,9619)},updataPower:function(){this.checkAlert(),this.data.yiyuan&&this.send(this.Evts.UPDATA_VIEW)},checkAlert:function(){this.oneDay.alert=this.data.checkAlert()}}),t=game.Sender.extends({ipc:function(){this.msg={YiyuanReq:this.yiyuanReq,RechargeModelReq:null}},yiyuanReq:function(e){var t=game.pb.YiyuanRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.OneYuanBuy,e,game.OneYuanBuyEvts,t)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1504),this.setSize(654,143)},init:function(){var e=this,t=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(e.skin.prize),t.layout.paddingLeft=0,t.layout.paddingRight=0,t.layout.paddingTop=-5,t.layout.spacingX=17,t.layout.spacingY=-5},setData:function(){var e=this,t=e.skin,a=e.data.config,i=a.id;t.getBtn.active=!1,t.getPrize.active=!1,t.noBtn.active=!1,t.redPoint.active=!1;var n=game.oneYuanBuyData.yiyuan,s=game.oneYuanBuyData.yiyuanRecords,r=game.mainRoleData.power;n?0<=s.indexOf(i)?t.getPrize.active=!0:r>=a.power?(t.getBtn.active=!0,t.redPoint.active=!0):t.noBtn.active=!0:t.noBtn.active=!0;var o=e.data.getItems();e.prizeList.setData(o),1==a.id?t.level.string=game.Lang.get(53013):t.level.string=game.Lang.get(53014,a.power)},getBtn:function(){this.send(game.OneYuanBuyEvts.SEND_BUY_GIFT,this.data.config.id)}})).poolCall=!0,b8e.RC("$$game","$$OneYuanBuyItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1503)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.OneYuanBuyItem,this.list.bindEnum=this.moduleEnum,this.list.layout.paddingLeft=0,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2C_UPDATA_FREE_INFO:case this.Evts.UPDATA_VIEW:this.updataView()}},onShow:function(){this.updataView()},updataView:function(){this.updataGiftSc();var e=!1,t=!1,a=!1,i=!1;game.oneYuanBuyData.yiyuan?(i=!(a=!0),this.clearTimer()):(i=t=e=!0,this.createTimer()),this.skin.timeL.active=e,this.skin.buy01.active=t,this.skin.buy02.active=a,this.skin.timeL.active=i},updataGiftSc:function(){this.list.scrollToTop(),this.items=game.oneYuanBuyData.getitems(),this.list.setData(this.items)},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.oneYuanBuyData.yiyuanExpireTime-game.SysTime.curTime;if(e<1)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.timeL.string=game.Lang.get(53012,t)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)}});b8e.module.registerView(game.ME.OneYuanBuy,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1501)},init:function(){var e=this.skin,t=this.surfaceModel=new game.SurfaceModel;t.addToParent(this.skin.model),t.initModel(game.RoleType.Partner),t.roleData.heroModel.type=game.RoleType.Foster;var a=this.icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105);a.setAnchor(.5,.5),a.addToParent(e.itemIcon);var i=this.stageEffect=b8e.Animator.get(game.AnimType.UI_EFFECT,1);i.addToParent(e.light2),i.setScale(2.5,2.5);var n=this.cardEffectAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,3);n.setVisible(!1),n.addToParent(e.model),n.setScale(5,5),n.addFinishCallback(this.effectComplete,this),e.closeBtn.isButton=!1},effectComplete:function(){this.cardEffectAnim.setVisible(!1)},onShow:function(){var e=this.skin,t=this.partnerId=game.recruitData.showPartnerId,a=game.PartnerCfg.getData(t);if(a){game.AvatarUtil.updateModel(a,this.surfaceModel,game.RoleType.Partner);var i=this.stageEffect;i&&(i.load(game.ResCfg.getUrl(5019,a.lightEffect)),i.play());var n=this.cardEffectAnim;n&&(n.load(game.ResCfg.getUrl(5019,a.toplightEffect)),n.setVisible(!0),n.play(null,0)),e.delayNode.active=!1,e.delayNode2.active=!1,b8e.setTimeout(this.delayShow,this,500)}},delayShow:function(){game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeGet);var e=this.skin;e.delayNode.active=!0,e.delayNode2.active=!0;var t=this.partnerId=game.recruitData.showPartnerId,a=game.PartnerCfg.getData(t);if(a){var i=a.hunshiId,n=game.ItemInfoCfg.getData(i);n&&game.GridUtil.setItemIcon(this.icon,n,!1,game.IconLayoutEnum.SHOW_NAME),e.elementIcon.loadTexture(game.ResCfg.getUrl(10048,a.element)),e.jobDesc.string=a.jobDesc,e.name.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name,!0),e.time.string=game.Lang.get(51538,5),this.countDownTime=5,this.createCountDown()}},onHide:function(){this.clearCountDown(),this.send(this.Evts.V2C_CLOSE_PARTNER_VIEW),this.stageEffect&&this.stageEffect.stop()},view_detail_btn:function(){game.partnerData.setShowInfo(this.partnerId),game.module.show(game.ME.PartnerDetails)},createCountDown:function(){this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(this.moduleEnum)},onStageResize:function(){var e=this.skin;this._super();var t=b8e.stage.width+100;e.gray.width=t,e.closeBtn.width=e.huawen_1.width=e.huawen_3.width=t}});b8e.module.registerView(game.ME.RecruitPartner,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SCROLL_LEFT:b8e.enc(),C2V_SCROLL_RIGHT:b8e.enc(),C2C_SET_FORMATION:b8e.enc(),C2V_UPDATE_ALL_NUM:b8e.enc(),C2V_UPDATE_BUY_NUM:b8e.enc(),C2V_UPDATE_SWEEP:b8e.enc(),C2C_SPEND_NUM:b8e.enc(),C2C_BUY_NUM:b8e.enc(),C2C_UPDATE_NUM:b8e.enc(),C2V_UPDATE_NUM:b8e.enc(),C2V_UPDATE_BOX:b8e.enc(),C2V_UPDATE_RESET:b8e.enc(),C2C_SELECT_DIFF:b8e.enc(),C2V_SELECT_DIFF:b8e.enc(),C2C_CHECK_ALERT:b8e.enc(),C2C_RESET_DAILY:b8e.enc(),C2V_RESET_DAILY:b8e.enc(),C2C_UPDATE_ALERT:b8e.enc(),C2V_UPDATE_ALERT:b8e.enc(),C2C_CHALLENGE_SUCCEED:b8e.enc(),C2C_SYSYN_DATA:b8e.enc(),V2C_ON_SHOW:b8e.enc()}),b8e.RC("$$game","$$ZhuanJiEvts",e)}(),function(){var e=b8e.Object.extends({ctor:function(){var e=this;e._super(),e.curMaxId=1,e.maxSuccessId=0,e.curMaxDiff=1,e.selectDiff=1,e.readyBuyNum=1,e.lastBattleAlertId=1,e.diffMap=b8e.HashMap.get(),e.boxAwardsArr=[],e.maxStar=0},synData:function(e){var t=this;t.maxStar=0,t.hasNum=e.memoirChallenges,t.buyNum=e.memoirBuyNums,t.timeLeft=1e3*e.memoirRecoverTime,t.memoirs=e.memoirs,t.stars=e.memoirStars;var a=t.memoirs;if(a&&a.length){a.sort(t.sortNetData);var i=a[a.length-1];t.curMaxId=i.id,t.maxSuccessId=i.star<1?t.curMaxId-1:t.curMaxId;for(var n=a.length,s=0;s<n;s++)t.maxStar+=a[s].star}t.setEndTime(t.timeLeft)},addHasNum:function(e){this.hasNum+=e},setEndTime:function(e){this.endTime=game.SysTime.curTime+e},getEndRemainTime:function(){return this.endTime-game.SysTime.curTime},initData:function(){var e=game.MemoirDiffCfg.getDatas();if(e&&!(e.length<1)){for(var t=e.length,a=this.diffMap,i=void 0,n=void 0,s=0;s<t;s++)n=e[s],(i=new game.ZhuanJiDiffInfo).setData(n),a.set(n.id,i);this.initNetData(),this.setCurMaxId(this.curMaxId),this.setSelectDiff(this.curMaxDiff)}},initNetData:function(){var e=this.memoirs;if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=this.getInfoById(e[n].id))&&i.initNetData(a)},sortNetData:function(e,t){return e.id-t.id},onChallengeResp:function(e){var t=e.id;this.maxSuccessId=t>this.maxSuccessId?t:this.maxSuccessId;var a=this.getInfoById(t);a&&(this.maxStar-=a.star,a.updateNetData(e.Star),this.maxStar+=a.star),this.setCurMaxId(t)},onMemoirBuyResp:function(e){this.hasNum=e.challenges,this.buyNum=e.buyNums},onMemoirSweepResp:function(e){var t=this.getInfoById(e.id);t&&t.updateSweep(e.times)},onMemoirAwardResp:function(e){this.stars.push(e.id);var t=this.getSelectBoxInfo();t&&t.updateIsGet()},onMemoirResetResp:function(e){var t=this.getInfoById(e.id);t&&t.updateReset()},setCurMaxId:function(e){var t=this;t.curMaxId=e>t.curMaxId?e:t.curMaxId;var a=t.getInfoById(e);if(a&&a.cfg){var i=t.curMaxDiff,n=a.cfg.diffcultType;if(t.curMaxDiff=i<n?n:i,!(a.star<1)){var s=e+1;if(!(t.getMaxId()<s)){t.curMaxId=s>t.curMaxId?s:t.curMaxId;var r=t.getInfoById(s);r&&r.cfg&&(r.setOpen(),n=r.cfg.diffcultType,t.curMaxDiff=i<n?n:i)}}}},getInfoById:function(e){var t=game.MemoirCfg.getData(e);if(t){var a=this.diffMap.get(t.diffcultType);if(a){var i=a.getGroupInfo(t.group);if(i)return i.getInfoById(e)}}},getDiffiCount:function(){return this.diffCount||(this.diffCount=0|game.CfgUtil.getMiscValue(game.MemoirMiscCfg,"diffCount")),this.diffCount},getMaxId:function(){return this.maxId||(this.maxId=0|game.CfgUtil.getMiscValue(game.MemoirMiscCfg,"maxId")),this.maxId},getPerTimeCost:function(){return this.perTimeCost||(this.perTimeCost=0|game.CfgUtil.getMiscValue(game.MemoirMiscCfg,"memoirBuyCost")),this.perTimeCost},getNumLimit:function(){return this.numLimit||(this.numLimit=0|game.CfgUtil.getMiscValue(game.MemoirMiscCfg,"memoirNumLimit")),this.numLimit},getcdTime:function(){return this.cdTime||(this.cdTime=0|game.CfgUtil.getMiscValue(game.MemoirMiscCfg,"memoirRecover"),this.cdTime*=b8e.TimeUtil.MINUTE_MICRO_SECONDS),this.cdTime},getResetNum:function(){return this.resetNum||(this.resetNum=0|game.CfgUtil.getMiscValue(game.MemoirMiscCfg,"memoirResetNum")),this.resetNum},getDiffCfgs:function(e){return this.diffObj||(this.diffObj={}),this.diffObj.diffcultType=e,game.MemoirCfg.getData(this.diffObj,!0)},getBoxCfgsByGroup:function(e){return this.boxObj||(this.boxObj={}),this.boxObj.group=e,game.MemoirStarCfg.getData(this.boxObj,!0)},isGetAwards:function(e){var t=this.stars;if(t&&!(t.length<1))return-1<t.indexOf(e)},getCurDiffGroups:function(){var e=this.getCurDiffInfo();if(e){var t=e.getGroups();return t?t.values():null}},getDiffList:function(){return this.diffMap.values().sort(this.onSort)},onSort:function(e,t){return t.difficulty-e.difficulty},setSelectDiff:function(e){var t=this.diffMap,a=t.get(this.selectDiff);a&&a.setChoice(!1),this.selectDiff=e;var i=t.get(e);i&&i.setChoice(!0)},getCurDiffInfo:function(){return this.diffMap.get(this.selectDiff)},setCurGroupInfo:function(e){this.curGroupInfo=e},getCurGroupInfo:function(){return this.curGroupInfo},setCurInfo:function(e){this.curInfo=e},getCurInfo:function(){return this.curInfo},setSelectBoxInfo:function(e){this.selectBoxInfo=e},getSelectBoxInfo:function(){return this.selectBoxInfo},setReadyBuyNum:function(e){this.readyBuyNum=e},getReadyBuyNum:function(){return this.readyBuyNum},getCanBuyNum:function(){var e=game.VipCfg.getZhuanJiNum(game.mainRoleData.vipLevel)-this.buyNum;return e=e<1?0:e},updateBatteleAlert:function(e){var t=this.getInfoById(this.lastBattleAlertId);if(t&&t.setBattleAlert(!1),this.lastBattleAlertId=this.curMaxId,e){var a=this.getInfoById(this.lastBattleAlertId);a&&a.setBattleAlert(!0)}},checkBoxAlert:function(){for(var e=this.diffMap,t=this.curMaxDiff;0<t;t--)if(e.get(t).getBoxAlert())return!0;return!1},resetDaily:function(){this.buyNum=0;for(var e=this.diffMap,t=void 0,a=this.curMaxDiff;0<a;a--)(t=e.get(a))&&t.resetDaily()},getBoxAwardsArr:function(e){if(e&&e.userItem){var t=this.boxAwardsArr;t.length=0;var a=e.userItem,i=void 0,n=void 0,s=a.amounts,r=void 0;if(s&&0<s.length){r=s.length;for(var o=0;o<r;o++)i=s[o],(n=game.ItemInfo.get()).id=game.AmountCfg.getItemId(i.type),n.num=i.updateNum,n.iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,t.push(n)}if((s=a.items)&&0<s.length){r=s.length;for(var g=0;g<r;g++)i=s[g],(n=game.ItemInfo.get()).setData(i),n.iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,t.push(n)}return t}}});game.zhuanJiData=game.zhuanJiData||new e}(),function(){var e;e=b8e.Object.extends({isGet:!1,canGet:!1,setCfg:function(e){this.cfg=e,this.id=e.id,this.needStar=e.star},setGroupInfo:function(e){this.groupInfo=e},getAwardsList:function(){return this.awards||this.createAwards(),this.awards},createAwards:function(){var e=this.cfg.award;if(e&&!(e.length<1)){var t=game.IconLayoutEnum.SHOW_ALL,a=game.IconSizeEnum.GRID_SIZE_105;this.awards=game.CfgUtil.getPrizeListInfo(e,t,a).items}},updateIsGet:function(){this.isGet=game.zhuanJiData.isGetAwards(this.id),this.updateCanGet()},updateCanGet:function(){if(this.groupInfo){var e=this.groupInfo.groupStar;this.canGet=!this.isGet&&e>=this.needStar,this.groupInfo.updateBoxAlert()}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZhuanJiBoxInfo",e)}(),function(){var e;e=b8e.Object.extends({isOpen:!1,isChoice:!1,maxOpenGroupInfo:null,alert:!1,setData:function(e){this.diffCfg=e,this.difficulty=e.id,this.isOpen=1==this.difficulty,this.diffName=e.desc},getDiffAwards:function(){return this.awards||this.createAwards(),this.awards},createAwards:function(){var e=this.diffCfg.award;if(e&&!(e.length<1)){var t=game.IconLayoutEnum.SHOW_NONE,a=game.IconSizeEnum.GRID_SIZE_84;this.awards=game.CfgUtil.getPrizeListInfo(e,t,a).items}},getGroupInfo:function(e){return this.getGroups().get(e)},getGroups:function(){return this.groupMap||this.createGroups(),this.groupMap},createGroups:function(){var e=game.zhuanJiData.getDiffCfgs(this.difficulty);if(e&&!(e.length<1))for(var t=e.length,a=this.groupMap=b8e.HashMap.get(),i=void 0,n=void 0,s=void 0,r=0;r<t;r++)n=(i=e[r]).group,(s=a.get(n))||((s=new game.ZhuanJiGroupInfo(n)).setMapCfg(),s.setDiffInfo(this),a.set(n,s)),s.addInfo(i)},setOpen:function(){this.isOpen||(this.isOpen=!0)},setMaxGroupInfo:function(e){var t=this.maxOpenGroupInfo;t?t.group<e.group&&(this.maxOpenGroupInfo=e):this.maxOpenGroupInfo=e},setChoice:function(e){this.isChoice=e},updateAlert:function(){var e=this.getGroups().values();if(e&&!(e.length<1)){for(var t=e.length,a=!1,i=0;i<t;i++)if(e[i].alert){a=!0;break}this.alert!=a&&(this.alert=a)}},getBoxAlert:function(){var e=this.getGroups().values();if(!e||e.length<1)return!1;for(var t=e.length,a=0;a<t;a++)if(e[a].boxAlert)return!0;return!1},resetDaily:function(){var e=this.getGroups().values();if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=0;i<t;i++)(a=e[i])&&a.resetDaily()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZhuanJiDiffInfo",e)}(),function(){var e;e=b8e.Object.extends({isOpen:!1,groupStar:0,alert:!1,battleAlert:!1,boxAlert:!1,ctor:function(e){this.group=e,this.isOpen=1==this.group,this.infosMap=b8e.HashMap.get()},setMapCfg:function(){var e=game.MemoirMapCfg.getData(this.group);e&&(this.mapCfg=e)},setDiffInfo:function(e){this.diffInfo=e},addInfo:function(e){var t=new game.ZhuanJiInfo;t.setCfg(e),t.setGroupInfo(this),this.infosMap.set(t.id,t)},setOpen:function(){this.isOpen=!0;var e=this.diffInfo;e&&(e.setOpen(),e.setMaxGroupInfo(this))},addStar:function(e){this.groupStar+=e,this.updateBoxCanGet()},updateBoxCanGet:function(){var e=this.getBoxInfos().values();if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].updateCanGet();this.updateBoxAlert()}},getBoxInfos:function(){return this.boxMap||this.createBox(),this.boxMap},createBox:function(){var e=game.zhuanJiData.getBoxCfgsByGroup(this.group);if(e&&!(e.length<1))for(var t=e.length,a=this.boxMap=b8e.HashMap.get(),i=void 0,n=void 0,s=0;s<t;s++)i=e[s],(n=new game.ZhuanJiBoxInfo).setCfg(i),n.setGroupInfo(this),n.updateIsGet(),a.set(n.needStar,n)},getBoxByStar:function(e){return this.getBoxInfos().get(e)},getInfos:function(){return this.infosMap.values()},getInfoById:function(e){return this.infosMap.get(e)},setBattleAlert:function(e){this.battleAlert!=e&&(this.battleAlert=e,this.alert=this.battleAlert||this.boxAlert,this.diffInfo&&this.diffInfo.updateAlert())},updateBoxAlert:function(){var e=this.getBoxInfos().values();if(e&&!(e.length<1)){for(var t=e.length,a=!1,i=0;i<t;i++)if(e[i].canGet){a=!0;break}this.boxAlert!=a&&(this.boxAlert=a,this.alert=this.battleAlert||this.boxAlert,this.diffInfo&&this.diffInfo.updateAlert())}},resetDaily:function(){var e=this.getInfos();if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=0;i<t;i++)(a=e[i])&&a.resetDaily()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZhuanJiGroupInfo",e)}(),function(){var e;e=b8e.Object.extends({star:0,times:0,resetTimes:0,isOpen:!1,battleAlert:!1,setCfg:function(e){this.cfg=e,this.id=e.id,this.isOpen=1==this.id,this.times=e.challengeNum},setGroupInfo:function(e){this.groupInfo=e},initNetData:function(e){this.times-=e.challengeTimes,this.times=this.times<0?0:this.times,this.resetTimes=e.resetTimes,this.setStar(e.star),this.setOpen()},updateNetData:function(e){this.times--,this.times=this.times<0?0:this.times,this.setStar(e),this.setOpen()},updateSweep:function(e){this.times-=e,this.times=this.times<0?0:this.times},updateReset:function(){this.times=this.cfg.challengeNum,this.resetTimes++},setOpen:function(){this.isOpen=!0,this.groupInfo&&!this.groupInfo.isOpen&&this.groupInfo.setOpen()},setStar:function(e){var t=e-this.star;this.star=e,this.groupInfo&&t&&this.groupInfo.addStar(t)},getAwards:function(){return this.awards||this.createAwards(),this.awards},createAwards:function(){var e=this.cfg.award;if(e&&!(e.length<1))for(var t=this.awards=[],a=e.length,i=void 0,n=void 0,s=0;s<a;s++)i=e[s],(n=game.ItemUtil.createBaseItemInfo(i.Id,i.Num)).tagId=3,t.push(n)},getOtherAwards:function(){return this.otherAwards||this.createOtherAwards(),this.otherAwards},createOtherAwards:function(){var e=this.cfg.showItems;!e||e.length<1||(this.otherAwards=game.CfgUtil.getPrizeListInfo(e).items)},setBattleAlert:function(e){this.battleAlert!=e&&(this.battleAlert=e,this.groupInfo&&this.groupInfo.setBattleAlert(e))},resetDaily:function(){this.times=this.cfg.challengeNum,this.resetTimes=0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ZhuanJiInfo",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.zhuanJiData},ipc:function(){this.evts={Instance:{SYNC_INSTANCE_DATA:this.synData},ZhuanJiBattle:{C2C_SPEND_NUM:this.spendNum,C2C_BUY_NUM:this.buyNum,C2C_UPDATE_ALERT:this.updateAlert},MainRole:{C_RESET_DAILY:this.resetDaily}}},synData:function(e){if(e&&e.data){var t=e.data,a=this.data;a.synData(t),this.initData(),this.dpt(this.Evts.C2C_SYSYN_DATA);var i=a.getNumLimit();if(!(a.hasNum>=i)){var n=a.timeLeft;0<n&&(this.key=b8e.setTimeout(this.updateTime,this,n))}}},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.isInit||(this.isInit=!0,this.data.initData()),this.data.resetDaily(),this.dpt(this.Evts.C2C_RESET_DAILY))},notify:function(e,t){switch(e){case this.Evts.C2C_SELECT_DIFF:this.selectDiff(t);break;case this.Evts.V2C_ON_SHOW:this.onShow()}},onShow:function(){this.isInit||(this.isInit=!0,this.data.initData(),this.dpt(this.Evts.C2C_CHECK_ALERT))},selectDiff:function(e){this.data.setSelectDiff(e),this.send(this.Evts.C2V_SELECT_DIFF)},triggerOpen:function(e){e==this.moduleEnum&&(this.isOpen=!0)},initData:function(){this.isInit||this.isOpen&&(this.isInit=!0,this.data.initData(),this.dpt(this.Evts.C2C_CHECK_ALERT))},leftBtn:function(){this.send(this.Evts.C2V_SCROLL_LEFT)},rightBtn:function(){this.send(this.Evts.C2V_SCROLL_RIGHT)},addBtn:function(){game.module.show(game.ME.ZhuanJiTimesTips)},updateTime:function(){var e=this.data;this.clearTime();var t=e.getNumLimit();if(!(e.hasNum>=t)){if(e.addHasNum(1),e.hasNum<t){var a=e.getcdTime();0<a&&(e.setEndTime(a),this.key=b8e.setTimeout(this.updateTime,this,a))}else e.setEndTime(0);this.dpt(this.Evts.C2C_UPDATE_NUM),this.send(this.Evts.C2V_UPDATE_NUM)}},clearTime:function(){this.key&&(b8e.clearTimeout(this.key),this.key=null)},spendNum:function(e){if(e&&e.data){var t=this.data,a=e.data,i=t.hasNum;t.addHasNum(-1*a);var n=t.getNumLimit();if(n<=i&&t.hasNum<n){var s=t.getcdTime();0<s&&(this.clearTime(),t.setEndTime(s),this.key=b8e.setTimeout(this.updateTime,this,s))}this.dpt(this.Evts.C2C_UPDATE_NUM),this.send(this.Evts.C2V_UPDATE_NUM)}},buyNum:function(){var e=this.data,t=e.getNumLimit();e.hasNum>=t&&(this.clearTime(),e.setEndTime(0)),this.dpt(this.Evts.C2C_UPDATE_NUM),this.send(this.Evts.C2V_UPDATE_NUM)},updateAlert:function(){this.send(this.Evts.C2V_UPDATE_ALERT)}});b8e.module.registerControl(game.ME.ZhuanJi,e,game.ZhuanJiEvts)}(),function(){var e=game.Control.extends({init:function(){var e=game.spotAlert,t=game.SAE;this.zhuanJiAlert=e.set(t.ZHUANJI,t.INSTFUNC_HALL),this.battleAlert=e.set(t.ZHUANJI_BATTLE,t.ZHUANJI),this.boxAlert=e.set(t.ZHUANJI_BOX,t.ZHUANJI),this.data=game.zhuanJiData},ipc:function(){var e=this;e.evts={ZhuanJi:{C2C_CHECK_ALERT:e.checakAlert,C2C_UPDATE_NUM:e.updateNum,C2C_RESET_DAILY:e.resetDaily}},e.handels={MemoirChallengeResp:e.onChallengeResp,MemoirBuyResp:e.onMemoirBuyResp,MemoirSweepResp:e.onMemoirSweepResp,MemoirAwardResp:e.onMemoirAwardResp,MemoirResetResp:e.onMemoirResetResp}},checakAlert:function(){this.checkBattleAlert(),this.checkBoxAlert()},checkBattleAlert:function(){var e=this.data,t=this.battleAlert,a=0<e.hasNum,i=e.getMaxId(),n=e.curMaxId<i,s=a&&n;t.alert=s,e.updateBatteleAlert(s),this.dpt(this.Evts.C2C_UPDATE_ALERT),this.send(this.Evts.C2V_UPDATE_ALERT)},checkBoxAlert:function(){this.boxAlert.alert=this.data.checkBoxAlert(),this.dpt(this.Evts.C2C_UPDATE_ALERT),this.send(this.Evts.C2V_UPDATE_ALERT)},updateNum:function(){this.checakAlert(),this.send(this.Evts.C2V_UPDATE_NUM)},resetDaily:function(){this.send(this.Evts.C2V_RESET_DAILY)},onChallengeResp:function(e){var t=e.readProtobuf(game.pb.MemoirChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.battleLog.win,i={type:game.InstanceType.ZHUANJI,isWin:a,rewards:t.userItem,exp:t.exp};game.GameViewMgr.inst().hideUnStrongViews(),game.playBack.play(t.battleLog,i),a&&(this.data.onChallengeResp(t),this.dpt(this.Evts.C2C_SPEND_NUM,1),this.dpt(this.Evts.C2C_CHALLENGE_SUCCEED,1))}},onMemoirBuyResp:function(e){var t=e.readProtobuf(game.pb.MemoirBuyResponse);0<t.code?game.notice.noticeError(t.code):(game.notice.show(52440),this.data.onMemoirBuyResp(t),this.dpt(this.Evts.C2C_BUY_NUM))},onMemoirSweepResp:function(e){var t=e.readProtobuf(game.pb.MemoirSweepResponse);0<t.code?game.notice.noticeError(t.code):(this.data.onMemoirSweepResp(t),this.showItem(t),this.dpt(this.Evts.C2C_SPEND_NUM,t.times),this.dpt(this.Evts.C2C_CHALLENGE_SUCCEED,t.times),this.send(this.Evts.C2V_UPDATE_SWEEP))},onMemoirAwardResp:function(e){var t=e.readProtobuf(game.pb.MemoirAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.data.onMemoirAwardResp(t),game.module.hide(game.ME.ZhuanJiBoxTips);var a=this.data.getBoxAwardsArr(t);a&&a.length&&(game.awardsData.setItemsByArray(a,!1),game.module.show(game.ME.AwardShowTip)),this.checkBoxAlert(),this.send(this.Evts.C2V_UPDATE_BOX)}},onMemoirResetResp:function(e){var t=e.readProtobuf(game.pb.MemoirResetResponse);0<t.code?game.notice.noticeError(t.code):(game.notice.show(52441),game.module.hide(game.ME.ZhuanJiResetTimesTips),this.data.onMemoirResetResp(t),this.send(this.Evts.C2V_UPDATE_RESET))},showItem:function(e){var t={type:game.InstanceType.ZHUANJI,rewards:e.userItem,exp:e.exp,win:!0};b8e.evt.dptG(game.InstanceEvts.G_STOP_PLAY,t)},box1:function(){this._boxBtn(4)},box2:function(){this._boxBtn(8)},box3:function(){this._boxBtn(12)},_boxBtn:function(e){var t=this.data,a=t.getCurGroupInfo();if(a){var i=a.getBoxByStar(e);i&&(t.setSelectBoxInfo(i),game.module.show(game.ME.ZhuanJiBoxTips))}},addBtn:function(){game.module.show(game.ME.ZhuanJiTimesTips)},helpBtn:function(){game.RuleView.inst().showView(game.ME.ZhuanJiBattle)},saoDangOneBtn:function(){this._saoDangBtn(1)},saoDangAllBtn:function(){var e=this.data.getCurInfo();e&&this._saoDangBtn(e.times)},_saoDangBtn:function(e){if(this.checkChallengeTime(e)){var t=this.data.getCurInfo();t&&this.sender.MemoirSweepReq(t.id,e)}},checkChallengeTime:function(e){var t=0<arguments.length&&void 0!==e?e:1,a=this.data;if(a.hasNum<t)return game.notice.show(52437),!1;var i=a.getCurInfo();return!!i&&(!(i.times<1)||(game.module.show(game.ME.ZhuanJiResetTimesTips),!1))},challengeBtn:function(){if(this.checkChallengeTime()){var e=this.data.getCurInfo();if(e&&e.id){var t=e.id,a=game.ME.ZhuanJi;this.dpt(this.Evts.C2C_SET_FORMATION,[a,t,this.sender.MemoirChallengeReq,[t],this])}}},BattleTipsHelpBtn:function(){game.RuleView.inst().showView(game.ME.ZhuanJiBattleTips)},boxSureBtn:function(){var e=this.data.getSelectBoxInfo();e&&(e.canGet?this.sender.MemoirAwardReq(e.id):game.module.hide(game.ME.ZhuanJiBoxTips))},buyBtn:function(){if(this.isHasNum()){var e=this.data,t=e.getPerTimeCost(),a=e.getReadyBuyNum(),i=a*t;game.amount.get(game.AmountType.YUAN_BAO)<i?game.notice.show(52271):this.sender.MemoirBuyReq(a)}},cancelbuyBtn:function(){game.module.hide(game.ME.ZhuanJiTimesTips)},maxBtn:function(){if(this.isHasNum()){var e=this.data.getCanBuyNum();this._updateBuyNum(e)}},minBtn:function(){this.isHasNum()&&this._updateBuyNum(1)},addOneBtn:function(){if(this.isHasNum()){var e=this.data,t=e.getReadyBuyNum(),a=e.getCanBuyNum(),i=t+1;i=a<i?a:i,this._updateBuyNum(i)}},lessOneBtn:function(){if(this.isHasNum()){var e=this.data.getReadyBuyNum()-1;e=e<2?1:e,this._updateBuyNum(e)}},isHasNum:function(){var e=0<this.data.getCanBuyNum();return e||game.notice.show(52425),e},_updateBuyNum:function(e){var t=this.data;t.getReadyBuyNum()!=e&&(t.setReadyBuyNum(e),this.send(this.Evts.C2V_UPDATE_BUY_NUM))},resetCancelBtn:function(){game.module.hide(game.ME.ZhuanJiResetTimesTips)},resetSureBtn:function(){var e=this.data,t=e.getCurInfo();if(t&&t.id){var a=e.getResetNum();t.resetTimes>=a?game.notice.show(52442):this.sender.MemoirResetReq(t.id)}}}),t=[game.ME.ZhuanJiBattle,game.ME.ZhuanJiTimesTips,game.ME.ZhuanJiBoxTips,game.ME.ZhuanJiBattleTips,game.ME.ZhuanJiResetTimesTips],a=game.Sender.extends({ipc:function(){this.msg={MemoirChallengeReq:this.memoirChallengeReq,MemoirBuyReq:this.memoirBuyReq,MemoirSweepReq:this.memoirSweepReq,MemoirAwardReq:this.memoirAwardReq,MemoirResetReq:this.memoirResetReq}},memoirChallengeReq:function(e){var t=game.pb.MemoirChallengeRequest;t.id=e,this.write(t)},memoirBuyReq:function(e){var t=game.pb.MemoirBuyRequest;t.num=e,this.write(t)},memoirSweepReq:function(e,t){var a=game.pb.MemoirSweepRequest;a.id=e,a.times=t,this.write(a)},memoirAwardReq:function(e){var t=game.pb.MemoirAwardRequest;t.id=e,this.write(t)},memoirResetReq:function(e){var t=game.pb.MemoirResetRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.ZhuanJiBattle,e,game.ZhuanJiEvts,a,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(1462),this.spotAlerts={SPECIAL_WAR_MEMOIR_TOKEN:this.tokenAlert}},init:function(){var a=this,e=a.skin;a.data=game.zhuanJiData,a.send(a.Evts.V2C_ON_SHOW);var t=a.diffList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.ZhuanJiDiffItem,t.layout.spacingY=5,t.bindEnum=a.moduleEnum,t.addToParent(e.diffList);var i=a.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.ScrollBoxType.Horizontal);i.itemRender=game.PrizeListItem,i.layout.paddingLeft=0,i.layout.paddingTop=0,i.layout.spacingX=-5,i.bindEnum=a.moduleEnum,i.addToParent(e.prizeList);var n=a.mapLayer=b8e.BaseDisplay.get();n.addToParent(e.mapNode),a.mapItemList=[],a.itemEntityList=[];var s=a.scene=b8e.SceneMgr.inst().createScene("zhuanJi",n);s&&s._viewDisplay&&s._viewDisplay.setMask(cc.Mask.Type.RECT),s.setSize(e.mapNode.width,e.mapNode.height);var r=game.ResCfg.getUrl(10149);s.loadMap(r,function(e,t){e?b8e.error(e):a.loadMapComplete()},a);var o=s.getViewDisplay();b8e.evt.onTouchStart(o,a._onTouchBegan,a),b8e.evt.onTouchEnd(o,a._onTouchEnd,a),b8e.evt.onTouchCancel(o,a._onTouchCancelled,a),b8e.evt.onTouchMove(o,a._onTouchMove,a)},tokenAlert:function(e){this.skin.tokenSpotAlert.active=e.alert},_onTouchBegan:function(e){var t=e.target,a=e.touch.getLocation();t.hitTest(a)&&(this._startTouch||(this._startTouch=!0,this._lastPos=a))},_onTouchEnd:function(e){var t=e.target,a=e.touch.getLocation();t.hitTest(a)&&(this._lastPos=null,this._touchMoved&&e.stopPropagation(),this._startTouch=!1,this._touchMoved&&(this._touchMoved=!1))},_onTouchCancelled:function(){this._lastPos=null,this._startTouch=!1,this._touchMoved&&(this._touchMoved=!1)},_onTouchMove:function(e){var t=this,a=e.touch.getLocation();if(t._lastPos){t.location=a,t.offsetMapX=t._lastPos.x-a.x,t._lastPos=t.location,t._endPos=t.location,t._touchMoved=!0;var i=t.scene.getCamera(),n=i.focusX+t.offsetMapX,s=i.focusY;i.setFocus(n,s)}},loadMapComplete:function(){this.scene.startRender(),this.loadMapEnd=!0,this.updateView(),this.createTimer()},notify:function(e){var t=this;switch(e){case t.Evts.C2V_SCROLL_LEFT:t.scrollLeft();break;case t.Evts.C2V_SCROLL_RIGHT:t.scrollRight();break;case t.Evts.C2V_UPDATE_NUM:t.createTimer();break;case t.Evts.C2V_SELECT_DIFF:t.updateView();break;case t.Evts.C2V_UPDATE_ALERT:t.updateDiffList(),t.updateMapView()}},scrollLeft:function(){var e=this.scene.getCamera();e.setFocus(e.focusX-400,e.focusY)},scrollRight:function(){var e=this.scene.getCamera();e.setFocus(e.focusX+400,e.focusY)},onShow:function(){this.loadMapEnd&&(this.updateView(),this.createTimer())},updateView:function(){this.updateDiffList(),this.updatePrizeList(),this.updateMapView(),this.focusCurMap(),this.skin.view_tokenEnterBtn.active=game.specialWarTokenData.checkOpenByTokenType(game.SpecialWarTokenType.Memoir)},updateDiffList:function(){var e=this.data.getDiffList();!e||e.length<1||this.diffList.setData(e)},updatePrizeList:function(){var e=this.data.getCurDiffInfo().getDiffAwards();!e||e.length<1||this.prizeList.setData(e)},updateMapView:function(){var e=this.data.getCurDiffGroups();if(e&&!(e.length<1)){this.hideMapItems();for(var t=e.length,a=this.mapItemList,i=this.itemEntityList,n=void 0,s=void 0,r=void 0,o=void 0,g=0;g<t;g++)o=(r=e[g]).mapCfg,(n=a[g])||(this.createMapItem(),n=a[g]),s=i[g],n&&s&&(s.setScenePosition(o.itemPoint[0],o.itemPoint[1]),n.setVisible(!0),n.setData(r),n.updateItem())}},hideMapItems:function(){for(var e=this.mapItemList,t=e.length,a=0;a<t;a++)e[a].setVisible(!1)},createMapItem:function(){var e=new game.ZhuanJiMapItem;e.bindEnum=this.moduleEnum,this.mapItemList.push(e);var t=b8e.SceneDisplay.get();t.clearDisabled=!0,t.addDisplay(e),this.scene.addDisplay(t,-1e4,!1,!1,!1),this.itemEntityList.push(t)},focusCurMap:function(){var e=this.data.getCurDiffInfo();if(e&&e.maxOpenGroupInfo&&e.maxOpenGroupInfo.mapCfg){var t=e.maxOpenGroupInfo.mapCfg;this.scene.getCamera().setFocus(t.itemPoint[0],t.itemPoint[1])}},createTimer:function(){var e=this.data,t=e.getNumLimit();this.skin.countLab.string=game.Lang.get(52436,e.hasNum,t),this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.data.getEndRemainTime(),t=this.skin.timeLab;if(e<0)return t.string=game.Lang.get(52435),void this.clearTimer();var a=game.TimeUtil.formatTimeSpace(e,3);a=game.Lang.get(52434,a),t.string=a},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},$$getMapItem:function(e){return this.mapItemList&&this.mapItemList.length>e?this.mapItemList[e]:null},view_tokenEnterBtn:function(){game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.TOKEN_MEMOIR)}});b8e.module.registerView(game.ME.ZhuanJi,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1474)},init:function(){this.data=game.zhuanJiData,this.itemList=[],this.barLen=474},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_BOX:this.updateBox();break;case this.Evts.C2V_UPDATE_NUM:this.createTimer();break;case this.Evts.C2V_UPDATE_ALERT:this.updateItems()}},onShow:function(){this.updateItems(),this.updateBox(),this.createTimer()},updateItems:function(){var e=this.data.getCurGroupInfo();if(e){var t=e.getInfos();if(t&&4==t.length){for(var a=this.itemList,i=void 0,n=0;n<4;n++)(i=a[n])||(i=a[n]=new game.ZhuanJiBattleItem).addToParent(this.getComponent("node"+n)),i.setData(t[n]),i.updateItem();var s=game.zhuanJiData.getCurDiffInfo();s&&(this.skin.titleLab.string=e.mapCfg.name+"\xb7"+s.diffName)}}},updateBox:function(){var e=this.data.getCurGroupInfo();if(e){for(var t=void 0,a=1;a<4;a++)(t=e.getBoxByStar(4*a))&&(this.getComponent("hasget"+a).active=t.isGet,this.getComponent("red"+a).active=t.canGet);var i=this.barLen;this.skin.progress.width=Math.min(i,i*(e.groupStar/12))}},createTimer:function(){var e=this.data,t=e.getNumLimit();this.skin.countLab.string=game.Lang.get(52436,e.hasNum,t),this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.data.getEndRemainTime(),t=this.skin.timeLab;if(e<0)return t.string=game.Lang.get(52435),void this.clearTimer();var a=game.TimeUtil.formatTimeSpace(e,3);a=game.Lang.get(52434,a),t.string=a},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},$$getBossItem:function(e){return this.itemList&&this.itemList.length>e?this.itemList[e]:null}});b8e.module.registerView(game.ME.ZhuanJiBattle,e)}(),function(){var e;e=game.Widget.extends({ctor:function(){this._super(1470),this.iconList=[]},onShow:function(){this.updateItem()},setData:function(e){this.data=e},updateItem:function(){var e=this.data,t=this.skin;if(e&&t){var a=e.mapCfg,i=e.isOpen?10152:10151,n=game.ResCfg.getUrl(i,a.icon);this.mapItem||(this.mapItem=b8e.Sprite.get(),this.mapItem.setAnchor(.5,.5),this.mapItem.addToParent(t.mapNode)),this.mapItem.loadTexture(n),this.setPartnerIcon(),t.toPass.node.active=12<=e.groupStar,t.starLab.string=game.Lang.get(52432,e.groupStar),t.redPoint.active=e.alert;var s=game.zhuanJiData.getCurDiffInfo();s&&(t.nameLab.string=a.name+"\xb7"+s.diffName)}},setPartnerIcon:function(){var e=this.data.getInfos();if(e&&4==e.length)for(var t=this.iconList,a=void 0,i=void 0,n=void 0,s=0;s<4;s++)a=e[s],(i=t[s])||((i=t[s]=new game.CultivateBaseIcon).setIconSize(game.IconSizeEnum.GRID_SIZE_42),i.setIconScale(),i.addToParent(this.getComponent("icon"+s))),(n=game.partnerData.getInfoById(a.cfg.itme))&&i.setIconData(n)},onClick:function(){var e=this.data;e.isOpen?(game.zhuanJiData.setCurGroupInfo(e),game.module.show(game.ME.ZhuanJiBattle)):game.notice.show(52402)}}),b8e.RC("$$game","$$ZhuanJiMapItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1473),this.setSize(171,66)},setData:function(e){var t=this.skin,a=e.difficulty,i=e.isOpen,n=i?a:"gray",s=game.ResCfg.getUrl(10156,n);t.bg.loadTexture(s);var r=i?10158:10157,o=game.ResCfg.getUrl(r,a);t.words.loadTexture(o),t.ok.active=e.isChoice,t.redPoint.active=e.alert},onClick:function(){var e=this.data;e.isOpen?this.send(game.ZhuanJiEvts.C2C_SELECT_DIFF,e.difficulty):game.notice.show(52400)}}),b8e.RC("$$game","$$ZhuanJiDiffItem",e)}(),function(){var e;e=game.Widget.extends({ctor:function(){this._super(1475)},onShow:function(){this.updateItem()},setData:function(e){this.data=e},updateItem:function(){var e=this.data,t=this.skin;if(e&&t){var a=e.cfg,i=game.PartnerCfg.getData(a.itme);if(i){var n=i.UIModel;this.model||(this.model=new game.SurfaceModel,this.model.addToParent(t.modelNode),this.model.initModel());var s=a.uiScale?a.uiScale:1;t.modelNode.setScale(s,s),game.AvatarUtil.updateModel2(n,this.model,game.RoleType.Partner),game.ShaderUtil.setGray(t.modelNode,!e.isOpen),t.nameLab.string=i.name,t.redPoint.active=e.battleAlert;for(var r=e.star,o=0;o<3;o++)this.getComponent("starIcon"+o).active=o<r}}},onClick:function(){var e=this.data;e.isOpen?(game.zhuanJiData.setCurInfo(e),game.module.show(game.ME.ZhuanJiBattleTips)):game.notice.show(52403)}}),b8e.RC("$$game","$$ZhuanJiBattleItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1476)},init:function(){this.data=game.zhuanJiData},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_BUY_NUM:this.updateBuyNum();break;case this.Evts.C2V_UPDATE_NUM:case this.Evts.C2V_RESET_DAILY:this.updateAllNum()}},onShow:function(){this.resetBuyNum(),this.updateAllNum(),this.updateBuyNum()},updateAllNum:function(){var e=this.data,t=this.skin;t.curNum.string=e.hasNum,t.canBuyNum.string=e.getCanBuyNum()},updateBuyNum:function(){var e=this.data,t=this.skin,a=e.getPerTimeCost(),i=e.getReadyBuyNum();t.buyNum.string=i,t.amountNum.string=i*a},onHide:function(){this.resetBuyNum()},resetBuyNum:function(){var e=this.data,t=e.getCanBuyNum()<1?0:1;e.setReadyBuyNum(t)}});b8e.module.registerView(game.ME.ZhuanJiTimesTips,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1480)},init:function(){this.data=game.zhuanJiData},notify:function(e){switch(e){case this.Evts.C2V_RESET_DAILY:this.updateView()}},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=this.data,a=t.getCurInfo();if(a){var i=t.getResetNum(),n=a.resetTimes,s=i-n;e.curDesc.string=game.Lang.get(52438,s,i);var r=game.CostCfg.getCostCfg(game.CostType.ZHUANJI_COST,n+1);!r||!r.items||r.items.length<1||(e.amountNum.string=r.items[0].Num)}}});b8e.module.registerView(game.ME.ZhuanJiResetTimesTips,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1477)},init:function(){var e=this.skin;this.data=game.zhuanJiData,this.itemList=[],this.startX=298,this.maxLeft=60;var t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.layout.paddingLeft=0,t.layout.paddingTop=0,t.layout.spacingX=30,t.bindEnum=this.moduleEnum,t.addToParent(e.iconNode)},notify:function(e){},onShow:function(){this.setPrizeList()},setPrizeList:function(){var e=this.data.getSelectBoxInfo();if(e){var t=this.skin,a=e.canGet?53175:53174;t.sureLab.string=game.Lang.get(a);var i=e.getAwardsList();this.prizeList.setData(i);var n=i.length,s=game.IconSizeEnum.GRID_SIZE_105,r=this.startX-((s+16)*(n-1)+s)/2;r=r<this.maxLeft?this.maxLeft:r,t.iconNode.x=r}}});b8e.module.registerView(game.ME.ZhuanJiBoxTips,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1478)},init:function(){var e=this.skin;this.data=game.zhuanJiData,this.itemList=[];var t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.ScrollBoxType.Horizontal);t.itemRender=game.PrizeListItem,t.layout.spacingX=50,t.bindEnum=this.moduleEnum,t.addToParent(e.list1);var a=this.otherPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.ScrollBoxType.Horizontal);a.itemRender=game.PrizeListItem,a.layout.spacingX=50,a.bindEnum=this.moduleEnum,a.addToParent(e.list2)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_NUM:this.skin.quanNum.string=this.data.hasNum;break;case this.Evts.C2V_UPDATE_SWEEP:case this.Evts.C2V_UPDATE_RESET:case this.Evts.C2V_RESET_DAILY:this.updateView()}},onShow:function(){this.updateView(),this.updatePrizeList()},updateView:function(){var e=this.skin,t=this.data,a=t.getCurInfo();if(a){var i=a.star,n=a.times;e.quanNum.string=t.hasNum;var s=(e.challengeNum.string=n)<1?52443:52433;e.allLab.string=game.Lang.get(s,n),e.saoDangNode.active=2<i,e.challengeBtn.active=i<3;for(var r=0;r<3;r++)this.getComponent("starIcon"+r).active=r<i;var o=t.getCurDiffInfo();o&&(e.title.string=game.Lang.get(53003,a.id,o.diffName))}},updatePrizeList:function(){var e=this.data.getCurInfo();if(e){var t=e.getAwards();!t||t.length<1||(this.prizeList.setData(t),!(t=e.getOtherAwards())||t.length<1||this.otherPrizeList.setData(t))}}});b8e.module.registerView(game.ME.ZhuanJiBattleTips,e)}(),function(){var e;e=game.Widget.extends({ctor:function(){this._super(1479)},onShow:function(){this.setIcon()},setData:function(e,t){this.itemInfo=e,this.boxInfo=t},setIcon:function(){var e=this.skin;this.itemInfo&&this.boxInfo&&e&&(this._icon||(this._icon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(e.iconNode)),game.GridUtil.setItemIcon(this._icon,this.itemInfo),e.toPass.active=this.boxInfo.isGet)}}),b8e.RC("$$game","$$ZhuanJiBoxAwardItem",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SCROLL_LEFT:b8e.enc(),V_GET_EFFECT:b8e.enc(),V_CLICK_GRID:b8e.enc(),V_UPDATE_DICE:b8e.enc(),V_UPDATE_BUFF:b8e.enc(),V_UPDATE_SEL_CARD:b8e.enc(),V_UPDATE_DICE_NUM:b8e.enc(),V_UPDATE_SHOP:b8e.enc(),V_GET_LEVEL_AWARD:b8e.enc(),V2C_SELECT_CARD_ID:b8e.enc(),V2C_SELECT_SHOP_GOODS_ID:b8e.enc(),C2C_SET_FORMATION:b8e.enc(),C2C_SET_CHALLENGE:b8e.enc(),SCENE_MOVE_END:b8e.enc(),C2V_SHOW_GOLD_DICE:b8e.enc(),C2V_HIDE_GOLD_DICE:b8e.enc(),V2C_PLAY_DICE_END:b8e.enc(),C2V_UPDATE_SHOP_SHOW:b8e.enc(),C2V_SHOW_BUFF_DETAIL:b8e.enc(),C2V_SHOW_LUCKY_DAY_DETAIL:b8e.enc(),C2V_HIDE_TIPS:b8e.enc(),V2C_BUY_DICE:b8e.enc(),V2C_HIDE_VIEW:b8e.enc(),C2V_UPDATE_THROW_BTN:b8e.enc(),V2C_GO_OUT:b8e.enc(),S2V_UPDATE_REWARD_INFO:b8e.enc(),C2V_UPDATE_REWARD_INFO:b8e.enc(),C2V_SCENE_MOVE_END:b8e.enc(),HALO_EFFECT_END:b8e.enc(),BOX_EFFECT_END:b8e.enc(),C2C_USE_THROW:b8e.enc()}),b8e.RC("$$game","$$ExploreEvts",e)}(),function(){var e=b8e.Object.extends({realLevel:0,boxLevel:0,progress:0,route:0,pos:0,dice:0,buys:0,points:0,effect:0,grids:null,buffs:null,goods:null,effects:null,currPoints:0,cardId:0,cards:null,cardEffectsArr:null,hasLuckyDice:!1,isBattleEvent:0,currBossPos:0,effectData:0,maxPos:0,isHandleEnd:!0,levelUp:!1,historyTimes:0,ctor:function(){this._super(),this.gridInfoMap=b8e.HashMap.get(),this.buffInfoMap=b8e.HashMap.get(),this.shopGoodsInfos=[],this.enemyTeamMap=b8e.HashMap.get(),this.enemyIndexArr=[],this.rewardCountMap=b8e.HashMap.get(),this.itemTempMap=b8e.HashMap.get()},setData:function(e){var t=this;t.boxLevel=e.level,t.progress=e.progress,t.route=e.route,t.pos=e.pos,t.dice=e.dice,t.buys=e.buys,t.points=e.points,t.effect=e.effect,t.grids=e.grids,t.goods=e.goods,t.buffs=e.buffs,t.effects=e.effects,t.levelUp=e.levelup,t.historyTimes=e.historyDice;var a=game.ExploreRoutesCfg.getData(t.route);a&&(t.realLevel=a.level),t.enemyNum=a&&a.battleEvents?a.battleEvents.length:0,t.addShopGoods(t.goods),t.addHelpPartners(e.helpers),t.updateLuckyDice(),t.maxPos=t.pos+t.points;var i=e.todayItems;if(i&&0<i.length)for(var n=i.length,s=0;s<n;s++)t.rewardCountMap.set(i[s].id,i[s].num);t.rewardIdList||(t.rewardIdList=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"showRewardItems",!0,"|",!0))},resetData:function(){var e=this;e.gridInfoMap.clear(),e.shopGoodsInfos.length=0,e.enemyIndexArr.length=0,e.enemyTeamMap.clear(),e.currPoints=0,e.hasLuckyDice=!1,e.currBossPos=0,e.effectData=null,e.maxPos=0,e.resetDailyBuff(),e.battleInfo.resetData()},updateRollDiceData:function(e){var t=this;if(t.currPoints=e.points,t.progress=e.progress,t.historyTimes++,t.dice--,t.getGridInfoByPos(t.pos).isEndGrid)t.maxPos=t.currPoints;else{t.maxPos=t.pos+t.currPoints;var a=t.grids.length-1;t.maxPos=t.maxPos>=a?a:t.maxPos}},updateCardData:function(e){this.cardId=e.id,this.cards=e.cards,this.applyEffects=e.applyEffects},updateLevel:function(e){this.boxLevel=e.level,this.progress=e.progress},updateLuckyDice:function(){for(var e=this.effects.length,t=0;t<e;t++)if(this.effects[t].type==game.ExploreEffectTypes.LUCKY_DICE)return void(this.hasLuckyDice=!0)},getGridInfos:function(){return this.gridInfoMap.count()<1&&this.initGridInfo(),this.gridInfoMap.values()},initGridInfo:function(){var e=game.ExploreRoutesCfg.getData(this.route);if(e){var t=game.ExploreGridCfg.getData(e.clientRoadId,!0);if(t)for(var a=e.grids,i=void 0,n=void 0,s=void 0,r=void 0,o=1,g=game.ExploreEventTypes,u=this.getRandomList(),l=this.getMosterNameList(),c=this.getMosterDesc(),h=0;h<a;h++)(n=t[h])&&(i=new game.ExploreGridInfo,(s=this.grids[h])&&(i.setCfg(n),i.setData(s,h,a),s.type==g.BATTLE&&(i.setModelName(game.Lang.get(53026,o)),-1<(r=u[++o])&&i.setMonsterInfo(l[r],c[r]),this.enemyIndexArr.push(h)),s.type==g.BOSS_BATTLE&&(i.setModelName(game.Lang.get(53028)),r=u[u.length-1],i.setMonsterInfo(l[r],c[r]),this.enemyIndexArr.push(h)),this.gridInfoMap.set(h,i)))}},getRandomList:function(){if(this.randomList)return game.CCommonUtil.getRandomArr(this.randomList);var e=this.getMosterNameList();if(!e)return null;this.randomList=[];for(var t=e.length,a=0;a<t;a++)this.randomList[a]=a;return game.CCommonUtil.getRandomArr(this.randomList)},getMosterNameList:function(){return this.mosterNameList||(this.mosterNameList=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"mosterName",!0,"|")),this.mosterNameList},getMosterDesc:function(){return this.mosterDescList||(this.mosterDescList=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"mosterDesc",!0,"|")),this.mosterDescList},getGridInfoByPos:function(e){return this.gridInfoMap.count()<1&&this.initGridInfo(),this.gridInfoMap.get(e)},initBuffs:function(){if(!this.isInitBuff){var e=this.buffs;if(e&&!(e.length<1)){for(var t=e.length,a=this.buffInfoMap,i=void 0,n=void 0,s=0;s<t;s++)i=e[s],(n=new game.ExploreBuffInfo).setData(i),a.set(i.id,n);this.isInitBuff=!0}}},getBuffInfos:function(){return this.initBuffs(),this.buffInfoMap.values()},updateBuff:function(e){if(this.initBuffs(),e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=this.buffInfoMap,s=0;s<i;s++)if(t=e[s],a=n.get(t)){if(a.isForever)continue;a.updateDuration()}else(a=new game.ExploreBuffInfo).setCfg(t),n.set(t,a)},removeBuff:function(e){if(this.initBuffs(),e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=this.buffInfoMap,s=0;s<i;s++)t=e[s].id,(a=n.get(t))&&(a.minusDuration(),a.notHaveBuff()&&n.del(t),a.updateDuration())},resetDailyBuff:function(){this.isInitBuff=!1,this.buffs=null,this.buffInfoMap.clear()},updateMoveData:function(e){this.moveInfo.clear(),this.moveInfo.setData(e)},updateBattleInfo:function(e){this.battleInfo.clear(),this.battleInfo.setData(e)},getBattleInfo:function(){return this.exploreBattleInfo||(this.exploreBattleInfo=new game.ExploreBattleInfo),this.exploreBattleInfo},battleInfo:{get:function(){return this.exploreBattleInfo||(this.exploreBattleInfo=new game.ExploreBattleInfo),this.exploreBattleInfo}},moveInfo:{get:function(){return this.exploreMoveInfo||(this.exploreMoveInfo=new game.ExploreMoveInfo),this.exploreMoveInfo}},getIsHaveGoods:function(){var e=this.getShopGoodsInfos();return e&&0<e.length},getShopGoodsInfos:function(){return this.shopGoodsInfos},addShopGoods:function(e){if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)a=e[n],(t=game.ExploreShopGoodsInfo.get()).setData(a),this.shopGoodsInfos.push(t)},addHelpPartners:function(e){if(e&&!(e.length<1)&&this.battleInfo)for(var t=void 0,a=e.length,i=0;i<a;i++)t=e[i],this.battleInfo.addHelpPartner(t)},deletePartners:function(e){if(e&&!(e.length<1)&&this.battleInfo)for(var t=void 0,a=e.length,i=0;i<a;i++)0<(t=e[i]).helperId&&this.battleInfo.deleteHelpPartner(t)},deleteShopGoods:function(e){var t=void 0,a=this.shopGoodsInfos.length;if(!(a<1))for(var i=0;i<a;i++)if((t=this.shopGoodsInfos[i]).id==e){game.ExploreShopGoodsInfo.put(t),this.shopGoodsInfos.splice(i,1);break}},selectShopGoods:function(e){var t=void 0,a=this.shopGoodsInfos.length;if(!(a<1)){for(var i=0;i<a;i++)(t=this.shopGoodsInfos[i]).id==e&&(t.select=!0),t.id==this.shopSelectId&&(t.select=!1);this.shopSelectId=e}},getShopGoodsInfo:function(e){var t=void 0,a=this.shopGoodsInfos.length;if(!(a<1))for(var i=0;i<a;i++)if((t=this.shopGoodsInfos[i]).id==e)return t},checkIsBattleEvent:function(e){return 0<this.points?this.pos+this.points!=e:this.pos+this.currPoints!=e},checkTriggerMagnet:function(){return this.moveInfo.checkEffectByType(game.ExploreEffectTypes.MAGNET)},getEnemyTeamInfo:function(e){return this.enemyTeamMap.get(e)},updateEnemyTeamInfo:function(e){var t=this.enemyTeamMap.get(this.currBossPos);t||(t=new game.ExploreTeamInfo,this.enemyTeamMap.set(this.currBossPos,t)),t.setData(e)},updateEffectData:function(e){if(e){var t=(this.effectData=e).type,a=game.ExploreEffectTypes;switch(t){case a.MERCHANT:this.addShopGoods(e.goods);break;case a.GET_PARTNER:this.battleInfo.addHelpPartner(e.helper);break;case a.LUCKY_DICE:this.hasLuckyDice=!0}}else this.effectData=null},isHaveType:function(e){var t=this.effect;if(t&&t.type==e)return!0;var a=this.effectData;return!(!a||a.type!=e)},getCanBattlePartners:function(){var e=this.battleInfo.getHelpPartnerInfos(),t=game.partnerData.partnerInfoArr;return!e||e.length<1?t:(e.push.apply(e,t),e)},getArrayingInfos:function(){this.arrayinfInfos||(this.arrayinfInfos=[]),this.arrayinfInfos.length=0;var e=game.playBackFormationData,t=e.partnerFormations;if(t&&!(t.length<1)){for(var a=void 0,i=void 0,n=t.length,s=0;s<n;s++)a=e.getSlotInfoBySlot(t[s]),(i={}).id=a.id,i.helperId=a.info&&a.info.helperId||0,this.arrayinfInfos.push(i);return this.arrayinfInfos}},getLookBattleInfo:function(){return this.getGridInfoByPos(this.lookPos)},getItemEffect:function(e){return this.itemEffectMap||this.getItemEffectMap(),this.itemEffectMap.get(e)},getItemEffectMap:function(){var e=this.itemEffectMap=b8e.HashMap.get(),t=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"itemEffect",!0,"|");if(t&&!(t.length<1))for(var a=t.length,i=void 0,n=0;n<a;n++)i=t[n].split(","),e.set(i[0],i[1])},getMysteryId:function(){return this.mysteryId||(this.mysteryId=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"mysteryId")),this.mysteryId},hasSurplusPoint:function(){return 0<this.points||this.pos!=this.maxPos},setSelectBuffs:function(e){this.selectBuffs=e},getSelectBuffs:function(){var e=this.selectBuffs;if(e&&3==e.length){for(var t=this._getSelectBuffs(!0),a=0;a<3;a++)t[a].setCfg(e[a]);return t}},_getSelectBuffs:function(e){var t=0<arguments.length&&void 0!==e&&e,a=this.selectBuffArr;if(!a){a=this.selectBuffArr=[];for(var i=void 0,n=0;n<3;n++)i=new game.ExploreBuffInfo,a.push(i)}if(t)for(var s=this.isHaveType(game.ExploreEffectTypes.SELECT_ALL_BUFF),r=0;r<3;r++)a[r].setChioce(s);return a},choiceBuff:function(e){this.choiceBuffId=e;for(var t=this._getSelectBuffs(),a=void 0,i=0;i<3;i++)(a=t[i]).setChioce(a.id==e)},getCurBoxLevelCfg:function(){var e=this.routeObj;(e=e||(this.routeObj={})).level=this.boxLevel;var t=game.ExploreRoutesCfg.getData(e,!0);if(t&&t.length)return t[0]},getMaxLevel:function(){return this.maxLevel||(this.maxLevel=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"maxLevel"),this.maxLevel=+this.maxLevel),this.maxLevel},canGetLevelBox:function(){var e=this.getCurBoxLevelCfg();if(e)return this.progress>=e.condition},canShowBattleView:function(e){var t=game.ExploreEventTypes;return e!=t.BOX&&e!=t.MYSTERY&&e!=t.HALO},getCountDown:function(){var e=game.SysTime.curTime;return b8e.TimeUtil.getNextDateTime(e,1)-e},getAwardShow:function(){var e=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"showAwardItems",!0,"|");if(e&&!(e.length<1)){for(var t=void 0,a=void 0,i=[],n=0,s=e.length;n<s;n++)(t=e[n])&&((a=b8e.createMap()).Id=t,a.Num=1,i.push(a));return i}},initItemTempMap:function(){var e=this.rewardIdList;if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)t=e[n],a=game.itemData.getCountById(t),this.itemTempMap.set(t,a)},updateItem:function(){var e=this.rewardIdList;if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=void 0,n=void 0,s=e.length,r=0;r<s;r++)t=e[r],(a=game.itemData.getCountById(t))&&(i=this.itemTempMap.get(t),n=0|this.rewardCountMap.get(t),this.itemTempMap.set(t,a),a<i||(n+=a-i,this.rewardCountMap.set(t,n)))}});game.exploreData=game.exploreData||new e}(),function(){var e;e=b8e.Object.extends({type:0,effect:0,randomEvent:0,effectArr:0,buffEffects:null,buffs:null,partners:null,useritem:null,ctor:function(){this.buffEffects=[],this.buffs=[],this.partners=[],this.partnerInfos=[],this.partnerInfoMap=b8e.HashMap.get(),this.helpPartnerArr=[],this.partnerInfoPool=[],this._super()},setData:function(e){var t=this;t.type=e.type,t.effect=e.effect,t.effectArr=e.applyEffects,t.buffEffects=e.buffEffects,t.buffs=e.buffs,t.partners=e.partners,t.useritem=e.useritem,game.exploreData.updateEffectData(t.effect),t.updatePartnerState(),t.updateBuffEffect()},clear:function(){this.type=0,this.effect=0,this.buffEffects&&(this.buffEffects.length=0),this.buffs&&(this.buffs.length=0),this.partners&&(this.partners.length=0)},updatePartnerState:function(){if(this.partners)for(var e=void 0,t=void 0,a=this.partners.length,i=0;i<a;i++)0<(t=this.partners[i]).helperId||(e=game.partnerData.getInfoById(t.id))&&(e.exploreHp=t.hp,e.exploreMaxhp=t.maxhp)},updateBuffEffect:function(){if(this.buffEffects&&!(this.buffEffects.length<1))for(var e=this.buffEffects.length,t=0;t<e;t++){var a=this.buffEffects[t].partners;if(a)for(var i=void 0,n=void 0,s=a.length,r=0;r<s;r++)i=a[r],(n=game.partnerData.getInfoById(i.id))&&(n.exploreHp=i.hp,n.exploreMaxhp=i.maxhp)}},addHelpPartner:function(e){this.helpPartnerArr.push(e)},deleteHelpPartner:function(e){if(!(this.helpPartnerArr.length<1))for(var t=void 0,a=this.helpPartnerArr.length,i=0;i<a;i++)if((t=this.helpPartnerArr[i]).helperId&&0<t.helperId&&e.helperId==t.helperId){this.helpPartnerArr.splice(i,1);break}},getHelpPartnerInfos:function(){var e=this;if(e.helpPartnerInfos||(e.helpPartnerInfos=[]),e.helpPartnerInfos.length=0,e.helpPartnerArr.length<1)return null;for(var t=void 0,a=void 0,i=e.helpPartnerArr.length,n=void 0,s=0;s<i;s++)t=e.helpPartnerArr[s],(a=e.partnerInfoPool[s])||((a=new game.ExplorePartnerInfo).setActive(),e.partnerInfoPool.push(a)),n=game.PartnerCfg.getData(t.id),a.setCfgData(n),a.helperId=t.helperId,a.id=t.id,a.lv=t.level,a.star=t.srat,a.exploreHp=t.hp,a.exploreMaxhp=t.maxhp,a.name=n.name,e.helpPartnerInfos.push(a);return e.helpPartnerInfos},resetPartnerHp:function(){var e=game.partnerData.partnerInfoArr;if(e)for(var t=void 0,a=e.length,i=0;i<a;i++)(t=e[i]).exploreHp=t.exploreMaxhp=1},resetData:function(){this.resetPartnerHp(),this.helpPartnerArr&&(this.helpPartnerArr.length=0)}});b8e.RC("$$game","$$ExploreBattleInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,duration:0,cfg:null,isForever:!1,isChoice:!1,setData:function(e){this.id=e.id,this.duration=e.duration,this.cfg=game.ExploreBuffsCfg.getData(this.id),this.isForever=999==this.duration,this.setUrl()},setCfg:function(e){this.id=e,this.cfg=game.ExploreBuffsCfg.getData(this.id),this.duration=this.cfg.duration,this.isForever=999==this.duration,this.setUrl()},setUrl:function(){this.url=game.ResCfg.getUrl(10170,this.cfg.icon),this.bigUrl=game.ResCfg.getUrl(10177,this.cfg.icon),this.qualityUrl=game.ResCfg.getUrl(10176,this.cfg.quality)},updateDuration:function(){this.duration+=this.cfg.duration},minusDuration:function(){this.duration--},notHaveBuff:function(){return this.duration<1},setChioce:function(e){this.isChoice=e}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ExploreBuffInfo",e)}(),function(){var e;e=b8e.Object.extends({gridCfg:null,eventType:0,value:0,state:0,battleType:0,gridName:"",enemyName:"",mosterDesc:"",lastState:0,ctor:function(){this._super()},setCfg:function(e){this.gridCfg=e},setData:function(e,t,a){this.eventType=e.type,this.value=e.value,this.state=e.state,this.lastState=e.state,this.battleType=e.battleType,this.pos=t,this.isEndGrid=t==a-1},setModelName:function(e){this.gridName=e},clearInfo:function(){this.state++},setMonsterInfo:function(e,t){this.enemyName=e,this.mosterDesc=t},isBattleGrid:{get:function(){var e=game.ExploreEventTypes;return this.eventType==e.BATTLE||this.eventType==e.BOSS_BATTLE}}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ExploreGridInfo",e)}(),function(){var e;e=b8e.Object.extends({pos:0,event:0,randomEvent:null,effects:null,ctor:function(){this._super(),this.effects=[]},setData:function(e){this.pos=e.pos,this.event=e.event,this.effects=e.applyEffects,this.event&&this.event.effect?(this.randomEvent=this.event.effect,game.exploreData.updateEffectData(this.randomEvent)):game.exploreData.updateEffectData(null)},clear:function(){this.pos=0,this.event=0,this.effects&&(this.effects.length=0)},checkEffectByType:function(e){var t=this.effects;if(!t||t.length<1)return!1;for(var a=t.length,i=0;i<a;i++)if(t[i].type==e)return!0;return!1},hasHaloEvent:function(){return null!=this.randomEvent},getHaloEventType:function(){return this.hasHaloEvent()?this.randomEvent.type:null},getMoveEventType:function(){var e=this.pos,t=game.exploreData.getGridInfoByPos(e);return t?t.eventType:0}});b8e.RC("$$game","$$ExploreMoveInfo",e)}(),function(){var e;e=game.PartnerInfo.extends({helperId:0,setData:function(e){this.id=e.id,this.exploreHp=e.hp,this.exploreMaxhp=e.maxhp,this.helperId=e.helperId},setActive:function(){this._active=!0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ExplorePartnerInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,goodsId:0,num:0,select:!1,setData:function(e){this.id=e.id,this.goodsId=e.goodsId,this.num=e.num},clearData:function(){this.id=0,this.goodsId=0,this.num=0,this.select=!1},recycle:function(){this.reset(),this._super()},reset:function(){this.clearData()}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExploreShopGoodsInfo",t)}(),function(){var e;e=b8e.Object.extends({power:0,members:null,memberInfos:null,setData:function(e){var t=e.enemyTeam;if(t){this.power=t.power,this.members=t.members,this.memberInfos||(this.memberInfos=[]);for(var a=this.memberInfos.length,i=0;i<a;i++)game.ExploreTeamMemberInfo.put(this.memberInfos[i]);this.memberInfos.length=0}},getMumberInfos:function(){if(0<this.memberInfos.length)return this.memberInfos;if(!this.members)return null;for(var e=void 0,t=void 0,a=this.members.length,i=0;i<a;i++)t=this.members[i],(e=game.ExploreTeamMemberInfo.get()).setData(t),this.memberInfos.push(e);return this.memberInfos}});b8e.RC("$$game","$$ExploreTeamInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,name:null,maxHp:0,hp:0,element:0,isShowStar:!0,star:0,setData:function(e){this.id=e.id,this.name=e.name,this.maxHp=e.maxHp,this.hp=e.hp,this.element=e.element,this.star=e.star},clearData:function(){this.id=0,this.name=0,this.maxHp=0,this.hp=0,this.element=0,this.star=0},recycle:function(){this.reset(),this._super()},reset:function(){this.clearData()}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExploreTeamMemberInfo",t)}(),function(){var e;e=b8e.Object.extends({id:0,item:null,applyEffects:null,isGet:!1,turnCard:!1,ctor:function(e){this.id=e,this._super()},setData:function(e,t,a){this.isGet=this.id==e,this.item=t,this.applyEffects=this.isGet?a:null,game.exploreData.effect&&this.isGet?this.dayeffect=game.exploreData.effect.type:this.dayeffect=null},clearData:function(){this.item=null,this.applyEffects=0,this.isGet=!1,this.turnCard=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$ExploreCardInfo",e)}(),function(){var e,t,a;a=b8e.Enum({NONE:0,BATTLE:1,BOSS_BATTLE:2,ITEM:3,BOX:4,MYSTERY:5,HALO:6}),t=b8e.Enum({NONE:0,MERCHANT:1,MAGNET:2,AWARD_BONUS:3,LUCKY_DICE:4,SELECT_ALL_BUFF:5,GET_PARTNER:6,BATTLE_WIN:20,ORANGE_BUFF:21,AWARD_DOUBLE:22,DOUBLE_CHANCE:23,AWARD_CHANGE:24,TRIGGER_EVENT:25}),e=b8e.Enum({NONE:0,LOBBY:1,CHALLENGE:2,NIGHTMARE:3}),b8e.RC("$$game","$$ExploreEventTypes",a),b8e.RC("$$game","$$ExploreEffectTypes",t),b8e.RC("$$game","$$ExploreBattleTypes",e)}(),function(){var e=b8e.Object.extends({_scene:null,isInScene:!1,ctor:function(){this._super(),this._isChange=!1,this.roleHight=170,b8e.evt.addG(this,b8e.Event.STAGE_RESIZE,this.onStageResize)},activeScene:function(){var e=this.getScene();if(e){game.module.closeAll(),b8e.scene.getEntityLayer().setVisible(!1),e.getEntityLayer().setVisible(!0),e.getViewDisplay().setVisible(!0),game.GameViewMgr.inst().enterExpolre(),b8e.evt.dptG(game.SceneGEvts.ENTER_XEPLORE_SCENE),this.isInScene=!0,e.soundEffectsEnabled=!0;var t=b8e.scene.getViewSize();e.setSize(t.width,t.height);var a=game.ResCfg.getUrl(10182);b8e.SoundMgr.inst().playBackgroundMusic(a,!0);var i=game.ResCfg.getUrl(10167);e.loadMap(i,this._onLoadMapComplete,this),game.exploreData.initItemTempMap()}},getScene:function(){var e=this;if(!e._scene){e._scene=b8e.SceneMgr.inst().createScene("1019",b8e.layer.getSceneLayer());var t=e._scene.getViewDisplay();t.setLocalZOrder(4),b8e.evt.onTouchStart(t,e._onTouchBegan,e),b8e.evt.onTouchEnd(t,e._onTouchEnd,e),b8e.evt.onTouchCancel(t,e._onTouchCancelled,e),b8e.evt.onTouchMove(t,e._onTouchMove,e)}return e._scene},_onTouchBegan:function(e){var t=e.target,a=e.touch.getLocation();t.hitTest(a)&&(this._startTouch||(this._startTouch=!0,this._lastPos=a))},_onTouchEnd:function(e){var t=e.target,a=e.touch.getLocation();t.hitTest(a)&&(this._lastPos=null,this._touchMoved&&e.stopPropagation(),this._startTouch=!1,this._touchMoved&&(this._touchMoved=!1))},_onTouchCancelled:function(){this._lastPos=null,this._startTouch=!1,this._touchMoved&&(this._touchMoved=!1)},_onTouchMove:function(e){var t=this,a=e.touch.getLocation();if(t._lastPos){t.location=a,t.offsetMapX=t._lastPos.x-a.x,t.offsetMapY=a.y-t._lastPos.y,t._lastPos=t.location,t._endPos=t.location,t._touchMoved=!0;var i=t._scene.getCamera(),n=i.focusX+t.offsetMapX,s=i.focusY+t.offsetMapY;i.setFocus(n,s)}},unactiveScene:function(){var e=this.getScene();e&&(this.removeDisappearAnima(),e.clearEntity(),e.stopRender(),b8e.scene.getEntityLayer().setVisible(!0,!1),e.getEntityLayer().setVisible(!1),e.getViewDisplay().setVisible(!1),b8e.scene.playMusic(),game.GameViewMgr.inst().leaveExpolre(),b8e.evt.dptG(game.SceneGEvts.LEAVE_XEPLORE_SCENE),this.isInScene=!1)},_onLoadMapComplete:function(e,t){if(e)b8e.error("\u52a0\u8f7d\u56de\u653e\u5730\u56fe\u6570\u636e\u5931\u8d25",e);else{t.startRender();var a=b8e.scene.getViewSize();t.setSize(a.width,a.height),this.createFloor(),this.createGrid(),this.createRole()}},createFloor:function(){var e=this.getScene();if(e){var t=game.exploreData.getGridInfos(),a=t.length;if(!(a<1)){for(var i=game.RoleType.ExploreFloor,n=void 0,s=void 0,r=void 0,o=0;o<a;o++)s=(n=t[o]).gridCfg,(r=game.ExploreFloorEntity.get(i,n.pos)).setData(n),e.addDisplay(r,-1e4,!1,!1,!1),r.setScenePosition(s.posX,s.posY);this.firstGrid=e.getDisplayByTypeAndId(i,t[0].pos),this.lastGrid=e.getDisplayByTypeAndId(i,t[a-1].pos)}}},createGrid:function(){var e=this.getScene();if(e){var t=game.exploreData.getGridInfos(),a=t.length;if(!(a<1))for(var i=game.RoleType.ExploreGrid,n=void 0,s=void 0,r=void 0,o=0;o<a;o++)s=(n=t[o]).gridCfg,(r=game.ExploreGridEntity.get(i,n.pos)).setData(n),e.addDisplay(r,-1e4,!1,!1,!1),r.setScenePosition(s.posX,s.posY)}},createRole:function(){var e=this.getScene();if(e){var t=game.mainRoleData,a=this.role;a||((a=this.role=game.SceneRole.get(t.type,t.id)).data=t,a.isUniqueId=!0,a.clearDisabled=!0,e.addDisplay(a,void 0,!1,!t.isSelf,!t.isSelf,0),e.getCamera().setFocusTarget(a));var i=game.mainRole.getAnimator(game.AnimType.BODY,1);this.roleHight=i&&i.y?i.y+170+0:170;var n=a.roleArrow;if(n||(n=a.roleArrow=b8e.Sprite.get(),a.addChild(n),n.setAnchor(.5,.5),n.loadTexture(game.ResCfg.getUrl(10172)),n.setVisible(!0)),n.setPosition(0,this.roleHight),!a.itemAnim){var s=a.itemAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,2);a.addChild(s),s.setPosition(0,this.roleHight),s.setVisible(!1),s.setScale(.5,.5)}this.curGridPos=game.exploreData.pos;var r=e.getDisplayByTypeAndId(game.RoleType.ExploreGrid,this.curGridPos);if(r){var o=r.getScenePosition();if(o){var g=this.choiceRoleDirection(r.gridCfg.direction);a.setDirection(game.Direction.getAnimatDirection(g)),a.setScenePosition(o.x,o.y),e.getCamera().setFocus(o.x,o.y)}game.AvatarUtil.update(a),a.rmvNickName()}}},moveRoleToEndPos:function(e){if(this.isInExploreScene()){var t=this.getScene(),a=this.role;if(t&&a){var i=this.curGridPos;if(game.exploreData.getGridInfoByPos(i).isEndGrid)return this.playDisappear(),void(this.restartEndPos=e);if(e<=i)b8e.evt.dptG(game.ExploreEvts.SCENE_MOVE_END);else{for(var n=game.RoleType.ExploreFloor,s=i+1,r=this.pathPosArr=[],o=s;o<=e;o++)t.getDisplayByTypeAndId(n,o).showStepLightImg(),r.push(o);a.transition(game.RoleStateType.ACTION_WALK,null,!0),this.isMoving=!0;game.exploreData.checkTriggerMagnet();this.MoveOneGrid()}}}},MoveOneGrid:function(){var e=this.getScene(),t=this.role;if(e&&t){var a=this.pathPosArr.shift(),i=e.getDisplayByTypeAndId(game.RoleType.ExploreGrid,a),n=i.gridCfg,s=this.choiceRoleDirection(n.direction);i.preStep(),t.setDirection(game.Direction.getAnimatDirection(s)),b8e.Tween.get(t).to({x:i.x,y:i.y},500).call(this._moveComplete,this,[a])}},_moveComplete:function(e){var t=this.getScene(),a=this.role;if(t&&a){var i=0==this.pathPosArr.length,n=t.getDisplayByTypeAndId(game.RoleType.ExploreGrid,e),s=t.getDisplayByTypeAndId(game.RoleType.ExploreFloor,e),r=game.exploreData.checkTriggerMagnet();(i||r)&&this.showItemEffect(n),s.onArrive(i),n.onArrive(i),i?(a.transition(game.RoleStateType.ACTION_IDLE),this.isMoving=!1,this.curGridPos=e,b8e.evt.dptG(game.ExploreEvts.SCENE_MOVE_END)):this.MoveOneGrid()}},showItemEffect:function(e){var t=e.data;if(t&&!(0<t.state)&&t.eventType==game.ExploreEventTypes.ITEM){var a=this.role;if(a&&a.itemAnim&&a.roleArrow){a.roleArrow.setVisible(!1);var i=a.itemAnim;i.setVisible(!0);var n=game.exploreData.getItemEffect(t.value);i.load(game.ResCfg.getUrl(5019,n)),i.play();var s=this.roleHight+35;b8e.Tween.get(i).to({y:s,scaleX:.6,scaleY:.6},200).to({y:this.roleHight,scaleX:.5,scaleY:.5},200).call(this.itemEffectComplete,this)}}},itemEffectComplete:function(){var e=this.role;if(e&&e.itemAnim&&e.roleArrow){e.roleArrow.setVisible(!0);var t=e.itemAnim;t.setVisible(!1),t.y=this.roleHight,t.setScale(.5,.5)}},playDisappear:function(){var e=this.getScene(),t=this.role;if(e&&t){var a=this.disappearAnima;if(!a){(a=this.disappearAnima=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).addFinishCallback(this.disappearComplete,this),a.load(game.ResCfg.getUrl(5019,1118));var i=b8e.SceneDisplay.get();i.addDisplay(a),a.setPosition(0,10),e.addDisplay(i,-1e4,!1,!1,!1);var n=this.lastGrid.getScenePosition();i.setScenePosition(n.x,n.y)}a.setVisible(!0),a.play(null,0)}},disappearComplete:function(){this.disappearAnima.setVisible(!1);var e=this.role;e&&(this.isMoving=!0,e.setVisible(!1),b8e.Tween.get(e).to({x:this.firstGrid.x,y:this.firstGrid.y},1500).call(this.toStartPosComplete,this))},toStartPosComplete:function(){var e=this.role;e&&(this.isMoving=!1,e.setVisible(!0),this.curGridPos=0,this.moveRoleToEndPos(this.restartEndPos))},removeDisappearAnima:function(){this.disappearAnima&&(this.disappearAnima.removeFromParent(),this.disappearAnima=null)},isRoleMoving:function(){return this.isMoving},isInExploreScene:function(){return this.isInScene},choiceRoleDirection:function(e){var t=game.Direction,a=void 0;switch(e){case 1:a=t.DownRight;break;case 2:a=t.DownLeft;break;case 3:a=t.UpRight;break;case 4:default:a=t.UpLeft}return a},onStageResize:function(){this._scene&&this._scene.setSize(b8e.stageWidth,b8e.stageHeight)},setGridPos:function(e,t,a){var i=e-1;this.getScene().getDisplayByTypeAndId(game.RoleType.ExploreGrid,i).setScenePosition(t,a)}});game.exploreScene=game.exploreScene||new e}(),function(){var e=game.Control.extends({battleSettlement:!1,init:function(){this.moduleData=game.exploreData;var e=game.spotAlert,t=game.SAE;this.exploreAlert=e.set(t.EXPLORE,t.INSTFUNC_HALL),this.throwAlert=e.set(t.EXPLORE_THROW,t.EXPLORE),this.boxAlert=e.set(t.EXPLORE_BOX,t.EXPLORE)},ipc:function(){var e=this;e.evts={MainRole:{C_RESET_DAILY:e.resetDaily},Scene:{C2C_RECONNECT_ENTER_SCENE:e.reconnect},Back:{C_BACK_UPDATE_ITEMINFO:e.updateItemInfo}},e.gevts={ExploreEvts:{V_CLICK_GRID:e.onClickGrid,SCENE_MOVE_END:e.onMoveEnd,HALO_EFFECT_END:e.haloEventHandler,BOX_EFFECT_END:e.boxEventHandler},InstanceEvts:{G_STOP_PLAY:e.playStop}},e.handels={ExploreInfoResp:e.exploreInfoResp,ExploreRollDiceResp:e.exploreRollDiceResp,ExploreMoveResp:e.exploreMoveResp,ExploreEnemyTeamInfoResp:e.exploreEnemyTeamInfoResp,ExploreBattleResp:e.exploreBattleResp,ExploreSelectBuffResp:e.exploreSelectBuffResp,ExploreSelectCardResp:e.exploreSelectCardResp,ExploreBuyDiceResp:e.exploreBuyDiceResp,ExploreBuyGoodsResp:e.exploreBuyGoodsResp,ExploreCollectLevelRewardResp:e.exploreLevelRewardResp,ExploreEmbattleResp:e.exploreEmbattleResp}},reconnect:function(){this.moduleData.resetData(),this.sender.ExploreInfoReq()},resetDaily:function(){this.moduleData.resetData(),this.sender.ExploreInfoReq()},updateItemInfo:function(){game.exploreScene.isInExploreScene()&&(this.moduleData.updateItem(),this.send(this.Evts.C2V_UPDATE_REWARD_INFO))},notify:function(e,t){var a=this;switch(e){case a.Evts.V_GET_EFFECT:a.triggerEffect(t);break;case a.Evts.V2C_SELECT_CARD_ID:if(a.moduleData.turning)return;a.moduleData.turning=!0,a.sender.ExploreSelectCardReq(t);break;case a.Evts.V2C_SELECT_SHOP_GOODS_ID:a.moduleData.selectShopGoods(t);break;case a.Evts.V2C_BUY_DICE:a.sender.ExploreBuyDiceReq(t);break;case a.Evts.V2C_PLAY_DICE_END:a.isPlayThrow=!1,a.sender.ExploreMoveReq();break;case a.Evts.V2C_HIDE_VIEW:t?a.checkMoveReq():(b8e.removeTimeout(a.delayShowModule,a),b8e.setTimeout(a.delayShowModule,a,200));break;case a.Evts.V2C_GO_OUT:a.goOut()}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.ExploreInfoReq()},checkThrowAlert:function(){this.throwAlert.alert=0<this.moduleData.dice},checkBoxAlert:function(){this.boxAlert.alert=this.moduleData.canGetLevelBox()},exploreInfoResp:function(e){var t=e.readProtobuf(game.pb.ExploreInfoResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setData(t),this.checkBoxAlert(),this.checkThrowAlert())},exploreRollDiceResp:function(e){var t=this,a=e.readProtobuf(game.pb.ExploreRollDiceResponse);0<a.code?game.notice.noticeError(a.code):(t.isBattleEvent=!1,t.moduleData.updateRollDiceData(a),t.send(t.Evts.V_UPDATE_DICE),t.isPlayThrow=!0,t.moduleData.isHandleEnd=!1,t.moduleData.hasLuckyDice=!1,t.checkThrowAlert(),t.checkBoxAlert(),t.dpt(t.Evts.C2C_USE_THROW))},exploreMoveResp:function(e){var t=e.readProtobuf(game.pb.ExploreMoveResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateMoveData(t),game.exploreScene.moveRoleToEndPos(t.pos),this.battleSettlement=!0,this.send(this.Evts.C2V_UPDATE_THROW_BTN))},onMoveEnd:function(){var e=this,t=e.moduleData.moveInfo,a=t.pos;e.moduleData.pos=t.pos,e.moduleData.points=0;var i=e.moduleData.getGridInfoByPos(a),n=i.eventType;if(e.moduleData.isHandleEnd=!0,e.battleSettlement=!1,i.isEndGrid)return e.awardPopHandler(e.moduleData.moveInfo.event),void(e.moduleData.maxPos=a);if(e.moduleData.hasSurplusPoint()&&(n=game.ExploreEventTypes.BATTLE),n){if(n!=game.ExploreEventTypes.BATTLE&&0<i.lastState)return;e.triggerEvent(n),i.lastState++}},exploreEnemyTeamInfoResp:function(e){var t=e.readProtobuf(game.pb.ExploreEnemyTeamInfoResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateEnemyTeamInfo(t),game.module.show(game.ME.ExploreBattle))},exploreBattleResp:function(e){var t=this,a=e.readProtobuf(game.pb.ExploreBattleResponse);if(0<a.code)game.notice.noticeError(a.code);else{t.moduleData.updateBattleInfo(a);var i=game.exploreData.currBossPos,n=game.exploreData.getGridInfoByPos(i);n&&(n.battleType=a.type),t.moduleData.removeBuff(a.buffEffects),t.send(t.Evts.V_UPDATE_BUFF),t.moduleData.setSelectBuffs(a.buffs);var s=t.moduleData.effect==game.ExploreEffectTypes.BATTLE_WIN;if(a.type==game.ExploreBattleTypes.LOBBY||s)game.module.hide(game.ME.ExploreBattle),t.awardTipsHandler(!0),t.moduleData.hasSurplusPoint()&&(t.sender.ExploreMoveReq(),t.battleSettlement=!0);else if(t.moduleData.isHaveType(game.ExploreEffectTypes.BATTLE_WIN))t.onPlayStop();else{var r={type:game.InstanceType.EXPLORE,rewards:a.useritem,scene:game.ResCfg.getUrl(4100,"arena")};game.playBack.play(a.battlelog,r),t.inBattle=!0}}},exploreSelectBuffResp:function(e){var t=e.readProtobuf(game.pb.ExploreSelectBuffResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.updateBuff(t.ids),this.send(this.Evts.V_UPDATE_BUFF);var a=t.ids;if(a&&!(a.length<1))for(var i=a.length,n=void 0,s=void 0,r=0;r<i;r++)(s=game.ExploreBuffsCfg.getData(a[r]))&&(n=s.desc+s.descCount,n=game.HtmlUtil.getText(game.Color.GREEN,n),game.notice.show(n))}},exploreSelectCardResp:function(e){var t=e.readProtobuf(game.pb.ExploreSelectCardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateCardData(t),this.send(this.Evts.V_UPDATE_SEL_CARD))},exploreBuyDiceResp:function(e){var t=e.readProtobuf(game.pb.ExploreBuyDiceResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.dice+=t.num,this.moduleData.buys+=t.num,game.notice.show(53281),this.send(this.Evts.V_UPDATE_DICE_NUM),game.module.hide(game.ME.ExploreBuy),this.checkThrowAlert())},exploreBuyGoodsResp:function(e){var t=e.readProtobuf(game.pb.ExploreBuyGoodsResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.deleteShopGoods(t.id),this.moduleData.getIsHaveGoods()||(game.module.hide(game.ME.ExploreShop),this.send(this.Evts.C2V_UPDATE_SHOP_SHOW)),this.send(this.Evts.V_UPDATE_SHOP))},exploreLevelRewardResp:function(e){var t=e.readProtobuf(game.pb.ExploreCollectLevelRewardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.moduleData.getCurBoxLevelCfg();a&&(game.awardsData.setItemsByArray(a.levelAward,!0),game.module.show(game.ME.AwardShowTip)),this.moduleData.updateLevel(t),this.send(this.Evts.V_GET_LEVEL_AWARD),this.checkBoxAlert()}},exploreEmbattleResp:function(e){var t=e.readProtobuf(game.pb.ExploreEmbattleResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.deletePartners(t.partners),this.curBattleType&&this.sender.ExploreBattleReq(this.curBattleType))},playStop:function(e){if(e){var t=e.data;t.type==game.InstanceType.EXPLORE&&(this.inBattle=!1),t.win&&t.type==game.InstanceType.EXPLORE?this.onPlayStop():this.battleSettlement=!1}},onPlayStop:function(){var e=this;e.battleSettlement=!0,e._waitShowModule||(e._waitShowModule=[]),e._waitShowModule2||(e._waitShowModule2=[]),e._waitShowModule2.length=0,e._waitShowModule.length=0,e._waitShowModule.push(game.ME.ExploreTurnCard);var t=e.moduleData.getSelectBuffs();t&&3===t.length&&e._waitShowModule2.push(game.ME.ExploreSelectBuff);var a=game.ExploreEffectTypes,i=e.moduleData.effectData;i&&(e.moduleData.getIsHaveGoods()&&e.checkTypeSetME(i.type,a.MERCHANT,game.ME.ExploreShop),e.checkTypeSetME(i.type,a.GET_PARTNER,game.ME.ExploreMysticalEvent));var n=e.moduleData.effect;n&&(e.moduleData.getIsHaveGoods()&&e.checkTypeSetME(n.type,a.MERCHANT,game.ME.ExploreShop),e.checkTypeSetME(n.type,a.GET_PARTNER,game.ME.ExploreMysticalEvent)),e.delayShowModule()},checkTypeSetME:function(e,t,a){this._waitShowModule&&e==t&&this._waitShowModule.indexOf(a)<0&&this._waitShowModule.push(a)},delayShowModule:function(){var e=this;if(!e._waitShowModule||e._waitShowModule.length<1){if(e.moduleData.effectData&&e.moduleData.effectData.type){var t=e.moduleData.effectData.type,a=game.ExploreEffectTypes;if(t!=a.MERCHANT&&t!=a.GET_PARTNER){e.battleNoticeAlert||(e.battleNoticeAlert={btn:game.Lang.get(9115),cancelcb:e.noticeEndCb,closeNotCallCancel:!1,okcb:e.noticeEndCb,thisArg:e,isTouchClose:!1});var i=20<=t?t-13:t;return e.battleNoticeAlert.lang=game.Lang.get(53090,game.Lang.get(53078+i)),void game.alert.show(e.battleNoticeAlert)}}if(e._waitShowModule2&&0<e._waitShowModule2.length){var n=e._waitShowModule2.shift();return void game.module.show(n)}e.checkMoveReq()}else{var s=e._waitShowModule.shift();game.module.show(s)}},checkMoveReq:function(){this.moduleData.hasSurplusPoint()&&this.sender.ExploreMoveReq(),this.battleSettlement=!1},noticeEndCb:function(){if(this._waitShowModule2&&0<this._waitShowModule2.length){var e=this._waitShowModule2.shift();game.module.show(e)}else this.checkMoveReq()},triggerEvent:function(e){var t=game.ExploreEventTypes;switch(e){case t.BATTLE:case t.BOSS_BATTLE:this.battleEventHandler();break;case t.MYSTERY:game.module.show(game.ME.ExploreMysticalEvent);break;case t.HALO:break;case t.BOX:this.send(this.Evts.C2V_SCENE_MOVE_END);break;default:this.awardTipsHandler()}},battleEventHandler:function(){var e=this.moduleData.moveInfo.pos,t=this.moduleData.getGridInfoByPos(e),a=t.eventType;if(!this.moduleData.canShowBattleView(a)&&0==t.lastState&&0!=t.state)return t.lastState++,void this.triggerEvent(a);this.awardTipsHandler();var i=this.moduleData.getGridInfoByPos(e+1);i&&i.isBattleGrid&&0==i.state&&this.sender.ExploreEnemyTeamInfoReq(e+1),this.moduleData.currBossPos=e+1,this.moduleData.isBattleEvent=!0},haloEventHandler:function(){var e=this.moduleData.moveInfo;if(e.event&&(this.awardTipsHandler(),e.hasHaloEvent)){var t=e.getHaloEventType();this.triggerEffect(t)}},boxEventHandler:function(){var e=this.moduleData.moveInfo.event;e&&this.awardPopHandler(e)},triggerEffect:function(e){var t=game.ExploreEffectTypes;switch(e){case t.MERCHANT:this.shopTrigger();break;case t.GET_PARTNER:game.module.show(game.ME.ExploreMysticalEvent);break;default:this.randomEventTipsHandler(e)}},shopTrigger:function(){this.send(this.Evts.C2V_UPDATE_SHOP_SHOW),this.moduleData.getIsHaveGoods()&&game.module.show(game.ME.ExploreShop)},randomEventTipsHandler:function(e){if(e){this.noticeAlert||(this.noticeAlert={btn:game.Lang.get(9115)});var t=20<=e?e-13:e;this.noticeAlert.lang=game.Lang.get(53090,game.Lang.get(53078+t)),game.alert.show(this.noticeAlert)}},awardTipsHandler:function(e){var t=void 0;(t=0<arguments.length&&void 0!==e&&e?this.moduleData.battleInfo:this.moduleData.moveInfo.event)&&game.ServerItemUtil.analyzeItems(t,1)},awardPopHandler:function(e){if(e){var t=e.useritem;if(t){var a=[],i=t.amounts;if(i){for(var n=i.length,s=void 0,r=void 0,o=0;o<n;o++)s=i[o],r=game.AmountCfg.getItemId(s.type),a.push({id:r,num:s.updateNum});a=a.concat(t.items),this.moduleData.getGridInfoByPos(this.moduleData.pos).isEndGrid&&game.awardsData.setTitle("pass"),game.awardsData.setItemsByArray(a,!1),game.module.show(game.ME.AwardShowTip)}}}},backBtn:function(){this.moduleData.isHandleEnd?this.battleSettlement||(this.inBattle?game.notice.show(53107):(game.exploreScene.unactiveScene(),game.module.hide(this.moduleEnum))):game.notice.show(53107)},goOut:function(){this.moduleData.isHandleEnd&&(game.exploreScene.unactiveScene(),game.module.hide(this.moduleEnum),game.notice.show(53111))},onClickGrid:function(e){var t=e.data,a=this.moduleData.getGridInfoByPos(t),i=game.ExploreEventTypes,n=a.eventType;n!=i.BATTLE&&n!=i.BOSS_BATTLE||(this.moduleData.currBossPos=t,this.moduleData.isBattleEvent=!1,this.moduleData.getEnemyTeamInfo(t)&&0==a.battleType?game.module.show(game.ME.ExploreBattle):this.sender.ExploreEnemyTeamInfoReq(t))},exploreBattleReq:function(e){if((this.curBattleType=e)==game.ExploreBattleTypes.LOBBY)this.sender.ExploreBattleReq(e);else{if(this.moduleData.isHaveType(game.ExploreEffectTypes.BATTLE_WIN))return game.module.hide(game.ME.ExploreBattle),void this.sender.ExploreBattleReq(e);game.playBackFormationData.setModule(game.ME.Explore,0),this.dpt(this.Evts.C2C_SET_FORMATION,[game.ME.Explore,0,this.exploreEmbattleReq,null,this])}},exploreEmbattleReq:function(){var e=this.moduleData.getArrayingInfos();e&&this.sender.ExploreEmbattleReq(e)},exploreBuyDiceReq:function(){this.moduleData.dice<1?game.notice.show(53108):this.sender.ExploreRollDiceReq()},throwBtn:function(){var e=this;if(e.moduleData.dice<1)game.notice.show(53108);else if(game.exploreScene.isRoleMoving())game.notice.show(53107);else if(e.isPlayThrow)game.notice.show(53107);else if(e.moduleData.hasSurplusPoint()){var t=e.moduleData.getGridInfoByPos(e.moduleData.pos+1);0<t.battleType&&0==t.state?(e.moduleData.currBossPos=e.moduleData.pos+1,e.sender.ExploreEnemyTeamInfoReq(e.moduleData.pos+1)):e.sender.ExploreMoveReq()}else{e.moduleData.isHaveType(game.ExploreEffectTypes.LUCKY_DICE)||e.moduleData.hasLuckyDice?e.send(e.Evts.C2V_SHOW_GOLD_DICE):(e.sender.ExploreRollDiceReq(0),e.moduleData.isGoldThrow=!1)}},clickGold:function(e){this.send(this.Evts.C2V_HIDE_GOLD_DICE),this.sender.ExploreRollDiceReq(e),this.moduleData.isGoldThrow=!0},goldBtn1:function(){this.clickGold(1)},goldBtn2:function(){this.clickGold(2)},goldBtn3:function(){this.clickGold(3)},goldBtn4:function(){this.clickGold(4)},goldBtn5:function(){this.clickGold(5)},goldBtn6:function(){this.clickGold(6)},boxBtn:function(){var e=this.moduleData,t=e.getMaxLevel();e.boxlevel>=t?game.notice.show(53109):e.canGetLevelBox()?this.sender.ExploreCollectLevelRewardReq():game.module.show(game.ME.ExploreLevelBox)},showBuffBtn:function(){this.send(this.Evts.C2V_SHOW_BUFF_DETAIL)},luckyDayBtn:function(){this.send(this.Evts.C2V_SHOW_LUCKY_DAY_DETAIL)},hideTipsBtn:function(){this.send(this.Evts.C2V_HIDE_TIPS)},shopBtn:function(){game.module.show(game.ME.ExploreShop)},plusBtn:function(){game.module.show(game.ME.ExploreBuy)},lobbyBtn:function(){this._alertOptions||(this._alertOptions={lang:53053,okcb:this.exploreBattleReq,thisArg:this,args:game.ExploreBattleTypes.LOBBY,align:b8e.HorizontalAlign.LEFT}),game.alert.showTwo(this._alertOptions)},battleBtn:function(){var e=this.getCurBattleType();0==e||e!=game.ExploreBattleTypes.NIGHTMARE?this.exploreBattleReq(game.ExploreBattleTypes.CHALLENGE):game.notice.show(53052)},nightmareBtn:function(){var e=this.getCurBattleType();0==e||e!=game.ExploreBattleTypes.CHALLENGE?this.exploreBattleReq(game.ExploreBattleTypes.NIGHTMARE):game.notice.show(53052)},getCurBattleType:function(){var e=this.moduleData.currBossPos,t=game.exploreData.getGridInfoByPos(e);return t?t.battleType:0},buyBtn:function(){var e=game.exploreData.shopSelectId;if(e){var t=game.exploreData.getShopGoodsInfo(e);if(t){var a=game.ExploreGoodsCfg.getData(t.goodsId);a&&a.cost&&game.UpgradeUtil.checkItemInfo(a.cost.Id,a.cost.Num)&&this.sender.ExploreBuyGoodsReq(e)}}else game.notice.show(53051)},mysticalSureBtn:function(){game.module.hide(game.ME.ExploreMysticalEvent)},selectBuffBtn:function(){var e=this.moduleData,t=e.isHaveType(game.ExploreEffectTypes.SELECT_ALL_BUFF)?e.selectBuffs:[e.choiceBuffId];this.sender.ExploreSelectBuffReq(t),game.module.hide(game.ME.ExploreSelectBuff)},goShopBtn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.TRIAL_SHOP)}}),t=[game.ME.ExploreBattle,game.ME.ExploreTurnCard,game.ME.ExploreMysticalEvent,game.ME.ExploreSelectBuff,game.ME.ExploreShop,game.ME.ExploreBuy,game.ME.ExploreLevelBox,game.ME.ExploreAwardShow,game.ME.ExploreNew],a=game.Sender.extends({ipc:function(){this.msg={ExploreInfoReq:null,ExploreRollDiceReq:this.exploreRollDiceReq,ExploreMoveReq:null,ExploreEnemyTeamInfoReq:this.exploreEnemyTeamInfoReq,ExploreBattleReq:this.exploreBattleReq,ExploreSelectBuffReq:this.exploreSelectBuffReq,ExploreSelectCardReq:this.exploreSelectCardReq,ExploreBuyDiceReq:this.exploreBuyDiceReq,ExploreBuyGoodsReq:this.exploreBuyGoodsReq,ExploreCollectLevelRewardReq:null,ExploreEmbattleReq:this.exploreEmbattleReq}},exploreRollDiceReq:function(e){var t=game.pb.ExploreRollDiceRequest;t.points=e,this.write(t)},exploreEnemyTeamInfoReq:function(e){var t=game.pb.ExploreEnemyTeamInfoRequest;t.pos=e,this.write(t)},exploreBattleReq:function(e){var t=game.pb.ExploreBattleRequest;t.type=e,this.write(t)},exploreSelectBuffReq:function(e){var t=game.pb.ExploreSelectBuffRequest;t.ids=e,this.write(t)},exploreSelectCardReq:function(e){var t=game.pb.ExploreSelectCardRequest;t.id=e,this.write(t)},exploreBuyDiceReq:function(e){var t=game.pb.ExploreBuyDiceRequest;t.num=e,this.write(t)},exploreBuyGoodsReq:function(e){var t=game.pb.ExploreBuyGoodsRequest;t.id=e,this.write(t)},exploreEmbattleReq:function(e){var t=game.pb.ExploreEmbattleRequest;t.partners=e,this.write(t)}});b8e.module.registerControl(game.ME.Explore,e,game.ExploreEvts,a,t)}(),function(){var e=game.View.extends({ctor:function(){this._super(1505),this.spotAlerts={EXPLORE_BOX:this.boxAlert}},boxAlert:function(e){this.skin.boxRed.active=e.alert},init:function(){var e=this.skin;this.moduleData=game.exploreData;var t=this.buffList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.bindEnum=this.moduleEnum,t.itemRender=game.ExploreBuffItem,t.addToParent(e.buffList),t.layout.paddingLeft=15,t.layout.paddingTop=0,t.layout.spacingX=5,t.layout.spacingY=0,this.barLen=90},notify:function(e,t){var a=this,i=a.skin;switch(e){case a.Evts.C2V_SHOW_GOLD_DICE:i.goldNode.active=!0;break;case a.Evts.C2V_HIDE_GOLD_DICE:i.goldNode.active=!1;break;case a.Evts.V_UPDATE_DICE_NUM:i.hasNum.string=a.moduleData.dice;break;case a.Evts.V_UPDATE_DICE:a.playThrow(t),a.updateThrow();break;case a.Evts.C2V_UPDATE_SHOP_SHOW:a.updateShopShow();break;case a.Evts.V_UPDATE_BUFF:a.updateBuffs();break;case a.Evts.C2V_SHOW_BUFF_DETAIL:a.showBuff();break;case a.Evts.C2V_SHOW_LUCKY_DAY_DETAIL:a.luckyDayBtn();break;case a.Evts.C2V_HIDE_TIPS:a.hideTipsBtn();break;case a.Evts.V_GET_LEVEL_AWARD:a.updateThrow();break;case a.Evts.C2V_UPDATE_THROW_BTN:a.updateThrowBtn();break;case a.Evts.S2V_UPDATE_REWARD_INFO:case a.Evts.C2V_UPDATE_REWARD_INFO:a.updateRewardInfoPage();break;case a.Evts.C2V_SCENE_MOVE_END:a.addItemOpen()}},onShow:function(){var e=this;e.updateView(),e.updateBuffs(),e.updateThrow(),e.createTimer(),e.updateShopShow(),e.updateThrowBtn(),e.updateRewardInfoPage(),e.skin.helpBtn.y=e.skin.luckyBg2.active?-226:-150,e.moduleData.levelUp&&game.module.show(game.ME.ExploreNew)},updateView:function(){var e=this.skin,t=this.moduleData;if(t.effect){var a=game.ExploreLuckyDayDescCfg.getData(t.effect.type);a&&(e.tieLab.string=game.Lang.get(53030,t.realLevel),e.luckyDay1.active=1==a.icon,e.luckyDay2.active=1!=a.icon,e.luckyDesc1.string=game.Lang.get(53091,a.desc),e.luckyDesc2.string=a.descDetail)}},updateThrowBtn:function(){var e=this.skin,t=this.moduleData.isHaveType(game.ExploreEffectTypes.LUCKY_DICE)||this.moduleData.hasLuckyDice;e.throw1.active=!t,e.throw2.active=t},updateBuffs:function(){var e=this.skin,t=this.moduleData.getBuffInfos(),a=t.length;e.buffNode.active=0<a,e.buff1.active=0<a,e.buff2.active=1<a,0<a&&e.buff1.loadTexture(t[0].url),1<a&&e.buff2.loadTexture(t[1].url)},updateThrow:function(){var e=this.skin,t=this.moduleData,a=t.getCurBoxLevelCfg();if(a){var i=t.progress,n=a.condition;e.levelLab.string=t.boxLevel+"C",e.exploreNum.string=game.Lang.get(53031,n);var s=this.barLen;e.progress.width=Math.min(s,s*(i/n)),e.diceDountLab.string=i+"/"+n,e.hasNum.string=t.dice}},showBuff:function(){var e=this.skin;e.buffBg.active=!0,e.hideTipsBtn.active=!0;var t=this.moduleData.getBuffInfos(),a=t.length,i=a%2==1?a+1:a;i=i/2*60+10,e.buffBg.height=i,e.buffList.height=i,this.buffList.setData(t)},luckyDayBtn:function(){var e=this.skin;e.luckyBg2.active=!0,e.helpBtn.y=e.luckyBg2.active?-226:-150,e.hideTipsBtn.active=!0},hideTipsBtn:function(){var e=this.skin;e.buffBg.active=!1,e.hideTipsBtn.active=!1,e.luckyBg2.active=!1,e.helpBtn.y=e.luckyBg2.active?-226:-150},playThrow:function(){var e=this.skin,t=this.thorwAnim;t||((t=this.thorwAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).addFinishCallback(this.throwEnd,this),t.addToParent(e.animNode));var a=this.moduleData.isGoldThrow?1119:1110,i=game.ResCfg.getUrl(5019,a);t.load(i),t.setVisible(!0),t.play()},throwEnd:function(){var e=this.skin;this.thorwAnim.setVisible(!1);var t=this.moduleData.isGoldThrow?10175:10169,a=game.ResCfg.getUrl(t,this.moduleData.currPoints);e.animEndImg.active=!0,e.animEndImg.loadTexture(a),b8e.setTimeout(this.startGo,this,500)},startGo:function(){this.send(this.Evts.V2C_PLAY_DICE_END),b8e.setTimeout(this.hideDiceImg,this,800)},hideDiceImg:function(){this.skin.animEndImg.active=!1},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.skin,t=this.moduleData.getCountDown();t<5*b8e.TimeUtil.MINUTE_MICRO_SECONDS&&this.send(this.Evts.V2C_GO_OUT),e.timeLab.string=b8e.TimeUtil.formatTime(t)},updateShopShow:function(){var e=this.moduleData.getIsHaveGoods();this.skin.shopBtn.active=e},updateRewardInfoPage:function(){var e=void 0,t=void 0,a=this.skin,i=this.moduleData.rewardIdList;if(i&&0<i.length){t=i.length;var n=void 0,s=void 0,r=void 0,o=this.moduleData.rewardCountMap;for(e=0;e<t;e++)n=i[e],s=0|o.get(n),this.getComponent("reward_num_"+e).string=s,(r=game.ItemInfoCfg.getData(n))&&this.getComponent("reward_icon_"+e).loadTexture(game.ResCfg.getUrl(137,r.icon))}var g=0,u=void 0,l=this.moduleData.enemyIndexArr;if(l&&0<l.length){t=l.length;var c=void 0,h=this.moduleData.gridInfoMap;for(e=0;e<t;e++)c=l[e],(u=h.get(c)).isBattleGrid&&0!=u.state&&g++}a.monsterNum.string=game.Lang.get(53282,g,this.moduleData.enemyNum)},addItemOpen:function(){var e=this.boxAnim;e||(e=this.boxAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this.skin.boxNode.addChild(e),e.setScale(1.2,1.2),e.setPosition(0,0)),e.load(game.ResCfg.getUrl(5019,1129)),e.play(),e.addFinishCallback(this.resetBoxAnim,this)},resetBoxAnim:function(){b8e.evt.dptG(game.ExploreEvts.BOX_EFFECT_END),this.boxAnim&&(this.boxAnim.removeFromParent(),this.boxAnim.release(),this.boxAnim=null)},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onStageResize:function(){var e=this.skin,t=b8e.stageWidth,a=b8e.stageHeight;this.setPosition(0,a),e.middleNode.x=b8e.stageWidth>>1,e.rightNode.x=b8e.stageWidth-130,e.hideTipsBtn.setSize(t,a),e.shopBtn.x=80,e.boxNode.x=b8e.stageWidth>>1}});b8e.module.registerView(game.ME.Explore,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1515),this.setSize(240,60)},setData:function(e){var t=this.skin;t.buffIcon.loadTexture(e.url);var a=e.cfg.desc+e.cfg.descCount;t.buffDesc.string=game.HtmlUtil.getText(game.Color.GREEN,a)}}),b8e.RC("$$game","$$ExploreBuffItem",e)}(),function(){var e;e=game.Widget.extends({_icon:null,_data:null,ctor:function(){this._super(1537),this.setSize(146,189)},init:function(){this.bindEnum=game.ME.Explore},loadComplete:function(){if(this.hide(),this.data){this.show(this.data)}},onShow:function(){this.defaultShow()},onHide:function(){this.defaultShow()},defaultShow:function(){if(this.skin){var e=this.skin;e.luckyImg.active=!1,e.cardFront.active=!1,e.cardBack.active=!0,e.itemName.string="",e.itemNum.string="",e.getImg.active=!1,e.itemIcon.unloadTexture(),b8e.Tween.kill(e.cardNode),e.cardNode.scaleX=1}},setData:function(e){if(this.cardInfo=e,this.skin&&e){var t=this.skin,a=e.applyEffects,i=game.ExploreEffectTypes;if(a&&0<a.length){for(var n=void 0,s=a.length,r=!1,o=!1,g=0;g<s;g++)(n=a[g]).type==i.DOUBLE_CHANCE&&(r=!0),n.type==i.AWARD_BONUS&&(o=!0);t.luckyImg.active=r||o,t.luckyNum.string=r&&r?3:2}else t.luckyImg.active=!1;t.getImg.active=e.isGet;var u=e.item;if(!u)return t.itemName.string="",t.itemNum.string="",void t.itemIcon.unloadTexture();var l=u.id,c=game.CCommonUtil.replaceNum(u.num);t.itemNum.string=game.Lang.get(53110,c);var h=game.ItemInfoCfg.getData(l);h&&(t.itemName.string=game.HtmlUtil.getColorStrByQuality(h.quality,h.name),t.itemIcon.loadTexture(game.ResCfg.getUrl(137,h.icon)))}},clickBtn:function(){this.cardInfo&&this.send(game.ExploreEvts.V2C_SELECT_CARD_ID,this.cardInfo.id)},trunCard:function(){this.skin&&game.TweenUtil.trunCardEffect(this.skin.cardNode,this.trunBackCb,this.trunFrontCb,this)},trunBackCb:function(){var e=this.skin;e.cardBack.active=!1,e.cardFront.active=!0},trunFrontCb:function(){}}),b8e.RC("$$game","$$ExploreTurnCardItem",e)}(),function(){var e=game.AwardShowView.extends({ctor:function(){this._super(1538)},init:function(){for(var e=0,t=205,a=void 0,i=void 0,n=this.cardItemList=[],s=this.cardInfoList=[],r=0;r<6;r++)i=s[r]=new game.ExploreCardInfo(r+1),(a=n[r]=new game.ExploreTurnCardItem).setData(i),a.addToParent(this.skin.list),r%3==0?(e=0,t-=205):e+=191,a.setPosition(e,t)},notify:function(e){switch(e){case this.Evts.V_UPDATE_SEL_CARD:this.trunCard()}},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.curTrunCardId=0,this.trunComplete=!1,this.trunAllComplete=!1,this.skin.time.string=game.Lang.get(53092,15),this.countDownTime=15,this.createCountDown(),game.exploreData.turning=!1},onHide:function(){var e=this;game.exploreData.turning=!1,b8e.Tween.kill(e.skin.light);var t=e.cardItemList,a=e.cardInfoList,i=a.length;e.clearCountDown(),b8e.removeTimeout(e.trunRemainCard,e),b8e.removeTimeout(e.trunAllCard,e);for(var n=0;n<i;n++)a[n].clearData(),t[n]&&t[n].defaultShow();e.send(e.Evts.V2C_HIDE_VIEW,!1)},trunCard:function(){var e=game.exploreData,t=this.curTrunCardId=e.cardId,a=e.cards,i=e.applyEffects,n=this.cardInfoList,s=this.cardItemList;if(n&&!(n.length<1)){for(var r=n.length,o=0;o<r;o++)n[o].setData(t,a[o],i),s[o].setData(n[o]),o+1==t&&s[o]&&s[o].trunCard();this.trunComplete=!0,this.countDownTime=6,b8e.removeTimeout(this.trunRemainCard,this),b8e.setTimeout(this.trunRemainCard,this,1500)}},trunRemainCard:function(){for(var e=this.cardItemList,t=e.length,a=0;a<t;a++)a+1!=this.curTrunCardId&&e[a].trunCard();b8e.removeTimeout(this.trunAllCard,this),b8e.setTimeout(this.trunAllCard,this,600)},trunAllCard:function(){this.trunAllComplete=!0,this.countDownTime<1&&game.module.hide(this.moduleEnum)},updateTime:function(){var e=this;e.countDownTime--;var t=e.trunComplete?51538:53092;e.skin.time.string=game.Lang.get(t,e.countDownTime),e.countDownTime<1&&(e.trunAllComplete?(game.module.hide(e.moduleEnum),e.clearCountDown(),e.skin.time.string=""):(e.countDownTime=6,e.trunComplete||e.send(game.ExploreEvts.V2C_SELECT_CARD_ID,1)))},closeBtn:function(){this.trunAllComplete&&this._super()},onStageResize:function(){var e=this.skin;this._super(),e.huawen_3.width=e.huawen_1.width=b8e.stageWidth+50,e.gray.setSize(b8e.stageWidth+50,470)}});b8e.module.registerView(game.ME.ExploreTurnCard,e)}(),function(){var e;e=game.ListItem.extends({_icon:null,_data:null,ctor:function(){this._super(1532),this.setSize(105,125)},init:function(){this.headIcon=new game.CultivateBaseIcon,this.headIcon.addToParent(this.skin.icon),this.hpWidth=this.skin.hpBar.width-2},setData:function(){if(this.data){var e=this.data,t=game.PartnerCfg.getData(e.id);if(t){var a=this.headIcon;a.setBgImage(game.ResCfg.getQualityBg(t.quality)),a.setIcon(game.ResCfg.getUrl(72,t.icon)),a.setElement(t,!0),a.setStar(e,!0),this.skin.hp.width=e.hp/e.maxHp*this.hpWidth}}}}),b8e.RC("$$game","$$ExploreBattleItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1533)},init:function(){var e=this.skin,t=this.memberList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.itemRender=game.ExploreBattleItem,t.addToParent(e.formationList),t.layout.paddingLeft=0,t.layout.spacingX=45,t.layout.spacingY=15,this.battlePercent=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"battlePercent",!0,"|"),this.battlePercent&&2<this.battlePercent.length&&(e.awardPercent1.string=game.Lang.get(53047,this.battlePercent[0]),e.awardPercent2.string=game.Lang.get(53047,this.battlePercent[1]),e.awardPercent3.string=game.Lang.get(53047,this.battlePercent[2]))},onShow:function(){var e=game.exploreData.currBossPos;if(this.gridInfo=game.exploreData.getGridInfoByPos(e),this.gridInfo){this.showEnemyTeamInfo=game.exploreData.getEnemyTeamInfo(e);this.showEnemyTeamInfo?(this.isBossBattle=this.gridInfo.eventType==game.ExploreEventTypes.BOSS_BATTLE,this.setBtnState(),this.setTeamInfo()):b8e.error("\u8be5\u5750\u6807\u4e0b\u6ca1\u6709\u53ef\u67e5\u770b\u7684\u6311\u6218\u5bf9\u8c61 pos:",e)}else b8e.error("\u8be5\u5750\u6807\u4e0b\u6ca1\u6709\u683c\u5b50\u6570\u636e pos:",e)},onHide:function(){this.memberList.setData(null)},setBtnState:function(){var e=this.skin,t=this.gridInfo,a=this.isBossBattle;e.nightmareBtn.active=e.awardPercent3.active=a,e.lobbyBtn.x=e.awardPercent1.x=a?149:187,e.battleBtn.x=e.awardPercent2.x=a?298:415;var i=t.battleType==game.ExploreBattleTypes.NIGHTMARE,n=t.battleType==game.ExploreBattleTypes.CHALLENGE;game.ShaderUtil.setGray(e.battleBtn,a&&i),game.ShaderUtil.setGray(e.nightmareBtn,a&&n);var s=game.exploreData.currBossPos,r=game.exploreData.hasSurplusPoint()&&game.exploreData.pos+1==s||0!=t.battleType;e.btnNode.active=r,e.tipsBg.height=r?750:700,e.returnBtn.y=r?697:-660},setTeamInfo:function(){var e=this.skin,t=this.showEnemyTeamInfo,a=this.gridInfo;if(a.gridCfg){var i=game.PartnerCfg.getData(a.value);if(i){e.headIcon.loadTexture(game.ResCfg.getUrl(72,i.icon)),e.title.string=this.isBossBattle?game.Lang.get(53048):a.gridName,e.battleName.string=a.enemyName,e.desc.string=game.Lang.get(a.mosterDesc),e.power.string=t.power,e.powerBg.width=e.power.width+38;var n=t.getMumberInfos();this.memberList.setData(n)}}}});b8e.module.registerView(game.ME.ExploreBattle,e)}(),function(){var e;e=game.ListItem.extends({_icon:null,_data:null,ctor:function(){this._super(1535),this.setSize(181,237)},init:function(){this.itemIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this.itemIcon.addToParent(this.skin.icon)},setData:function(){if(this.data){var e=void 0,t=this.skin,a=this.data,i=game.ExploreGoodsCfg.getData(a.goodsId);if(i){t.selectImg.active=a.select;var n=i.items,s=i.cost;n&&s&&(e=game.ItemInfoCfg.getData(n.Id))&&(t.goodsName.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),this.itemInfo=game.ItemUtil.createBaseItemInfo(n.Id,n.Num,this.itemInfo),game.GridUtil.setItemIcon(this.itemIcon,this.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM),(e=game.ItemInfoCfg.getData(s.Id))&&(t.costIcon.loadTexture(game.ResCfg.getUrl(137,e.icon)),t.costNum.string=s.Num,t.discount.loadTexture(game.ResCfg.getUrl(126,i.discount))))}}},clickBtn:function(){this.data.select||this.send(game.ExploreEvts.V2C_SELECT_SHOP_GOODS_ID,this.data.id)}}),b8e.RC("$$game","$$ExploreShopItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1536)},init:function(){var e=this.skin,t=this.shopList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);t.bindEnum=game.ME.Explore,t.itemRender=game.ExploreShopItem,t.addToParent(e.list),t.layout.paddingLeft=0,t.layout.spacingX=-5,t.layout.spacingY=0},notify:function(e){switch(e){case this.Evts.V_UPDATE_SHOP:this.updateList()}},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.updateList()},onHide:function(){b8e.Tween.kill(this.skin.light),game.exploreData.selectShopGoods(0),game.exploreData.shopSelectId=0,this.send(this.Evts.V2C_HIDE_VIEW,!1)},updateList:function(){this.shopInfoList=game.exploreData.getShopGoodsInfos(),this.shopList.setData(this.shopInfoList)}});b8e.module.registerView(game.ME.ExploreShop,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1542)},init:function(){var e=this.skin,t=this.buffList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.bindEnum=this.moduleEnum,t.itemRender=game.ExploreSelectBuffItem,t.addToParent(e.listNode),t.layout.paddingLeft=5,t.layout.paddingTop=-15,t.layout.spacingX=10,t.touchMovable=!1},onShow:function(){var e=game.exploreData,t=e.getSelectBuffs();if(t&&3==t.length){var a=e.isHaveType(game.ExploreEffectTypes.SELECT_ALL_BUFF);a||e.choiceBuff(t[0].id),this.buffList.setData(t);var i=a?53113:53112;this.skin.lab.string=game.Lang.get(i)}},onHide:function(){this.send(this.Evts.V2C_HIDE_VIEW,!0)}});b8e.module.registerView(game.ME.ExploreSelectBuff,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1541),this.setSize(170,272)},setData:function(e){if(e&&e.cfg){var t=e.cfg,a=this.skin,i=t.desc,n=t.descCount;a.titleName.string=t.title,a.countLab.string=n,a.descLab.string=game.Lang.get(53044,i,n),a.qualityImg.loadTexture(e.qualityUrl),a.iconImg.loadTexture(e.bigUrl),a.selectImg.active=e.isChoice}},clcikBtn:function(){var e=this.data;game.exploreData.isHaveType(game.ExploreEffectTypes.SELECT_ALL_BUFF)||game.exploreData.choiceBuff(e.id)}}),b8e.RC("$$game","$$ExploreSelectBuffItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1540)},init:function(){this.skin;this.moduleData=game.exploreData,this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.itemNode)},onShow:function(){this.updateView()},onHide:function(){this.send(this.Evts.V2C_HIDE_VIEW,!1)},updateView:function(){var e=this.skin,t=this.moduleData.moveInfo;if(t)if(t.getMoveEventType()==game.ExploreEventTypes.MYSTERY){var a=t.event;if(!a||!a.useritem)return;var i=a.useritem.items[0];if(!i)return;this.itemInfo=game.ItemUtil.createBaseItemInfo(i.id,i.num,this.itemInfo),this.icon.setItemInfo(this.itemInfo,!1,game.IconLayoutEnum.SHOW_ALL),e.partnerNode.active=!1,e.itemNode.active=!0;var n=game.ItemInfoCfg.getData(i.id);if(!n)return;e.infoLab.string=game.Lang.get(53078,n.name)}else{e.partnerNode.active=!0,e.itemNode.active=!1;var s=this.moduleData.effectData;if(!s||!s.helper)return;var r=s.helper.id,o=game.PartnerCfg.getData(r);if(!o)return;e.headIcon.loadTexture(game.ResCfg.getUrl(72,o.icon)),e.nameLab.string=game.HtmlUtil.getColorStrByQuality(o.quality,o.name),e.infoLab.string=game.Lang.get(53077,o.name,s.helper.level)}}});b8e.module.registerView(game.ME.ExploreMysticalEvent,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1534)},init:function(){this.maxBuyCount=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"buys",!1,"",!0),this.cost=game.CfgUtil.getMiscValue(game.ExploreMiscCfg,"cost",!1,"",!0)},notify:function(e){switch(e){case this.Evts.V_UPDATE_DICE_NUM:this.updateView()}},onShow:function(){this.updateView()},onHide:function(){},updateView:function(){this.maxCount=this.maxBuyCount-game.exploreData.buys,this.count=0<this.maxCount?1:0,this.updateCount()},view_cancelBtn:function(){game.module.hide(this.moduleEnum)},view_sureBtn:function(){this.maxCount<1?game.notice.show(53049):this.send(this.Evts.V2C_BUY_DICE,this.count)},view_lessenBtn:function(){this.setValue(!1,1)},view_addBtn:function(){this.setValue(!0,1)},setValue:function(e,t){var a=void 0;this.maxCount<1||(a=e?(a=this.count+t)>this.maxCount?this.maxCount:a:(a=this.count-t)<1?1:a)!=this.count&&(this.count=a,this.updateCount())},updateCount:function(){var e=this.cost*this.count;this.skin.count.string=this.count+"/"+this.maxCount,this.skin.costDesc.string=game.Lang.get(53050,e,'"gold"',this.count)}});b8e.module.registerView(game.ME.ExploreBuy,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1539)},init:function(){this.iconList=[],this.barLen=384},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.updateProgress(),this.setPrizeList()},onHide:function(){b8e.Tween.kill(this.skin.light)},updateProgress:function(){var e=this.skin,t=game.exploreData,a=t.getCurBoxLevelCfg();if(a){var i=this.barLen,n=t.progress,s=a.condition;e.progress.width=Math.min(i,i*(n/s)),e.expLab.string=n+"/"+s,e.numDesc.string=game.Lang.get(53060,s)}},setPrizeList:function(){var e=game.exploreData.getCurBoxLevelCfg();if(e)for(var t=e.levelAward,a=game.IconSizeEnum.GRID_SIZE_105,i=this.iconList,n=i.length>t.length?i.length:t.length,s=(a+16)*(t.length-1)/2,r=this.skin.iconNode,o=game.GridUtil,g=void 0,u=void 0,l=void 0,c=0;c<n;c++)(l=i[c])||(l=i[c]=game.GridUtil.createPrizeIcon(a)).addToParent(r),g=t[c],l.setVisible(!!g),g&&(u=game.ItemUtil.createBaseItemInfo(g.Id,g.Num),o.setItemIcon(l,u),l.setPosition((a+16)*c-s,0))},onStageResize:function(){this._super();var e=this.skin;e.gray.width=e.huawen_3.width=e.huawen_1.width=b8e.stageWidth+50}});b8e.module.registerView(game.ME.ExploreLevelBox,e)}(),function(){var a=void 0;(a=b8e.SceneEntity.extends({ctor:function(e,t){var a=0<arguments.length&&void 0!==e?e:void 0,i=1<arguments.length&&void 0!==t?t:void 0;this._super(a,i),this.reset()},setData:function(e){this.data=e,this.gridCfg=e.gridCfg,this.pos=e.pos},onHierarchyVisible:function(e){this._super(e),e&&(this.addFloorImg(),this.addStepLightImg(),this.addHaloImg())},onArrive:function(e){this.data&&(this.hideStepLightImg(),e&&(this.resetHaloImg(),this.playHaloEffect()))},addFloorImg:function(){if(this.gridCfg&&!this.floorImg){var e=this.floorImg=b8e.Sprite.get();b8e.evt.onC(e,this.onClick,this),this.addChild(e),e.setAnchor(.5,.5),e.loadTexture(game.ResCfg.getUrl(10168,"grid"+this.gridCfg.imgId)),e.setPosition(0,0)}},resetFloorImg:function(){var e=this.floorImg;e&&(b8e.evt.offC(e,this.onClick,this),e.removeFromParent(),e.release(),this.floorImg=null)},addStepLightImg:function(){var e=this.stepLightImg;e||(e=this.stepLightImg=b8e.Sprite.get(),this.addChild(e),e.setAnchor(.5,.5),e.loadTexture(game.ResCfg.getUrl(10168,"stepLight")),e.setPosition(0,0)),e.setVisible(!1)},showStepLightImg:function(){this.stepLightImg&&this.stepLightImg.setVisible(!0)},hideStepLightImg:function(){this.stepLightImg&&this.stepLightImg.setVisible(!1)},resetStepLightImg:function(){var e=this.stepLightImg;e&&(e.removeFromParent(),e.release(),this.stepLightImg=null)},addHaloImg:function(){var e=this.data;if(e&&!(0<e.state)&&e.eventType==game.ExploreEventTypes.HALO){var t=this.haloImg;t||(t=this.haloImg=b8e.Sprite.get(),this.addChild(t),t.setAnchor(.5,.5),t.loadTexture(game.ResCfg.getUrl(10168,"halo")),t.setPosition(0,0)),t.setVisible(!0)}},resetHaloImg:function(){var e=this.haloImg;e&&(e.removeFromParent(),e.release(),this.haloImg=null)},playHaloEffect:function(){var e=this.data;if(e&&!(0<e.state)&&e.eventType==game.ExploreEventTypes.HALO){var t=this.haloEffect;t||(t=this.haloEffect=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this.addChild(t),t.addFinishCallback(this.haloEffectEnd,this)),t.setPosition(0,0),t.load(game.ResCfg.getUrl(5019,1126)),t.play()}},haloEffectEnd:function(){b8e.evt.dptG(game.ExploreEvts.HALO_EFFECT_END),this.haloEffect&&(this.haloEffect.removeFromParent(),this.haloEffect.release(),this.haloEffect=null)},onClick:function(){var e=this.data;if(e&&!(0<e.state)){var t=game.ExploreEventTypes;e.eventType==t.BATTLE||e.eventType==t.BOSS_BATTLE?b8e.evt.dptG(game.ExploreEvts.V_CLICK_GRID,e.pos):e.eventType==t.BOX&&game.module.show(game.ME.ExploreAwardShow)}},reset:function(){this.resetFloorImg(),this.resetStepLightImg(),this.resetHaloImg()},restore:function(e,t){this._super(e,t),this.reset()},release:function(){a.put(this)}})).pool=new b8e.Pool(a,128),a.get=function(e,t){return a.pool.get(e,t)},a.put=function(e){a.pool.put(e)},b8e.RC("$$game","$$ExploreFloorEntity",a)}(),function(){var a=void 0;(a=b8e.SceneEntity.extends({ctor:function(e,t){var a=0<arguments.length&&void 0!==e?e:void 0,i=1<arguments.length&&void 0!==t?t:void 0;this._super(a,i),this.reset()},setData:function(e){this.data=e,this.gridCfg=e.gridCfg,this.pos=e.pos},onHierarchyVisible:function(e){this._super(e),e&&this.updateGrid()},updateGrid:function(){var e=this.data;if(e&&!(0<e.state)){var t=game.ExploreEventTypes;switch(e.eventType){case t.BATTLE:case t.BOSS_BATTLE:this.addMonster();break;case t.ITEM:this.addItem();break;case t.BOX:this.addBox();break;case t.MYSTERY:this.addMystery();break;case t.HALO:this.addItem()}e.isEndGrid&&this.addBox()}},preStep:function(){var e=this.data;if(e&&!(0<e.state)){var t=game.ExploreEventTypes;e.eventType!=t.BATTLE&&e.eventType!=t.BOSS_BATTLE||(e.clearInfo(),b8e.module.sendToView(game.ME.Explore,[game.ExploreEvts.S2V_UPDATE_REWARD_INFO]),this.playBossDisappear())}},onArrive:function(e){var t=this.data;if(t&&!(0<t.state)){var a=game.exploreData.checkTriggerMagnet(),i=game.ExploreEventTypes;e?this.clearGrid():a&&(t.eventType!=i.ITEM&&t.eventType!=i.BOX||(t.clearInfo(),this.resetItemAnim()))}},clearGrid:function(){var e=this.data;if(e){e.clearInfo();var t=game.ExploreEventTypes;switch(e.eventType){case t.MYSTERY:this.resetModel();break;case t.ITEM:case t.BOX:case t.HALO:this.resetItemAnim()}e.isEndGrid&&this.resetItemAnim()}},addMonster:function(){var e=this.data;e&&this.addModel(e.value,e.gridName)},addMystery:function(){var e=game.exploreData.getMysteryId();this.addModel(e)},addModel:function(e,t){var a=game.PartnerCfg.getData(e);if(a&&this.gridCfg){var i=this.gridCfg,n=this.monsterModel;n||(n=this.monsterModel=new b8e.SceneEntity.get,this.addChild(n)),this.monsterModel.setVisible(!0);var s=n.getAnimator(game.AnimType.BODY,1);s=s||n.addAnimator(game.AnimType.BODY,1);var r=game.Direction,o=void 0;switch(i.direction){case 1:o=r.UpLeft;break;case 2:o=r.UpRight;break;case 3:o=r.DownLeft;break;case 4:o=r.DownRight;break;default:o=r.UpLeft}var g=game.ResCfg.getUrl(5e3,a.model);s.setDirection(game.Direction.getAnimatDirection(o)),s.load(g),s.play(),this.addMonsterNameBg();var u=t||game.Lang.get(53027);this.addMonsterNameLab(u)}},resetModel:function(){var e=this.monsterModel;e&&(e.removeFromParent(),e.release(),this.monsterModel=null);var t=this.monsterLabBg;t&&(t.removeFromParent(),t.release(),this.monsterLabBg=null);var a=this.monsterLab;a&&(a.removeFromParent(),a.release(),this.monsterLab=null)},addMonsterNameBg:function(){var e=this.monsterLabBg;e||((e=this.monsterLabBg=b8e.Sprite.get()).setStyle(b8e.SpriteStyle.SLICED),e.setAnchor(.5,.5),this.addChild(e)),e.scale9Inset={top:8,bottom:8,left:11,right:11},e.loadTexture(game.ResCfg.getUrl(239)),e.setPosition(0,-12),e.setSize(80,26)},addMonsterNameLab:function(e){var t=this.monsterLab;this.monsterLab||((t=this.monsterLab=b8e.Label.get()).setColor(game.Color.WHITE),t.setFontSize(20),t.setLineHeight(24),t.isBold(!0),t.setAnchor(.5,.5),t.setPosition(0,-13),this.addChild(t));var a=this.data;if(a){a.eventType==game.ExploreEventTypes.BOSS_BATTLE?t.setColor(game.Color.RED):t.setColor(game.Color.WHITE),t.setText(e);var i=this.monsterLabBg;i&&i.setSize(t.width+16,26)}},addItem:function(){var e=this.data;if(e){var t=game.exploreData.getItemEffect(e.value);this.addItemAnim(t)}},addBox:function(){var e=this.data;if(e){var t=e.isEndGrid?1121:1120;this.addItemAnim(t)}},addItemAnim:function(e){var t=this.itemAnim;t||(t=this.itemAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this.addChild(t),t.setPosition(0,0)),t.load(game.ResCfg.getUrl(5019,e)),t.play()},resetItemAnim:function(){this.itemAnim&&(this.itemAnim.removeFromParent(),this.itemAnim.release(),this.itemAnim=null)},playBossDisappear:function(){var e=this.disappearAnima;e||(e=this.disappearAnima=b8e.Animator.get(game.AnimType.UI_EFFECT,2),this.addChild(e),e.addFinishCallback(this.removeDisappearAnima,this),e.setPosition(0,10)),e.load(game.ResCfg.getUrl(5019,1118)),e.play(),b8e.setTimeout(this.disappearComplete,this,200)},disappearComplete:function(){this.resetModel()},removeDisappearAnima:function(){this.disappearAnima&&(this.disappearAnima.removeFromParent(),this.disappearAnima.release(),this.disappearAnima=null)},reset:function(){this.resetModel(),this.resetItemAnim(),this.removeDisappearAnima()},restore:function(e,t){this._super(e,t),this.reset()},release:function(){a.put(this)}})).pool=new b8e.Pool(a,128),a.get=function(e,t){return a.pool.get(e,t)},a.put=function(e){a.pool.put(e)},b8e.RC("$$game","$$ExploreGridEntity",a)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1586)},init:function(){this.iconList=[],this.skin.numDesc.string=game.Lang.get(53279)},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.setPrizeList()},onHide:function(){b8e.Tween.kill(this.skin.light)},setPrizeList:function(){var e=game.exploreData.getAwardShow();if(e&&!(e.length<1))for(var t=game.IconSizeEnum.GRID_SIZE_105,a=this.iconList,i=a.length>e.length?a.length:e.length,n=(t+16)*(e.length-1)/2,s=this.skin.iconNode,r=game.GridUtil,o=void 0,g=void 0,u=void 0,l=0;l<i;l++)(u=a[l])||(u=a[l]=game.GridUtil.createPrizeIcon(t)).addToParent(s),o=e[l],u.setVisible(!!o),o&&(g=game.ItemUtil.createBaseItemInfo(o.Id,o.Num),r.setItemIcon(u,g),u.setPosition((t+16)*l-n,0))},onStageResize:function(){this._super();var e=this.skin;e.gray.width=e.huawen_3.width=e.huawen_1.width=b8e.stageWidth+50}});b8e.module.registerView(game.ME.ExploreAwardShow,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1589)},onShow:function(){var e=this.skin;e.titleLab.string=game.Lang.get(53030,game.exploreData.realLevel),e.dec.string=game.Lang.get(53319),e.guajiNode.setAlpha(0),b8e.Tween.get(e.guajiNode).to({alpha:1},1e3).call(this.showDelite,this)},showDelite:function(){var e=this.skin;b8e.Tween.get(e.guajiNode).wait(3e3).to({alpha:0},1e3).call(this.hideDelite,this)},hideDelite:function(){game.exploreData.levelUp=!1,game.module.hide(this.moduleEnum)},onHide:function(){var e=this.skin;b8e.Tween.kill(e.guajiNode)}});b8e.module.registerView(game.ME.ExploreNew,e)}(),function(){var e;e=b8e.Enum({None:0,UPDATA_COUNT_MONEY:-1,V_TOGGLECHANGE:-1,C2C_REFRESH_BTNS:-1,NEW_CHARGE:-1,HIDE_GUIDE:-1,V_SELECT_GEAR_BTN:-1}),b8e.RC("$$game","$$NewFirstChargeEvts",e)}(),function(){var e=b8e.Object.extends({freeBol:!1,awardsIdAr:null,countMoney:0,actDicType:null,selectBtn:6,firstShow:!0,isFirstShow:!0,oneBtn:null,ctor:function(){this._super()},getBtnMoney:function(){var e=game.NewFirstRechargeCfg.getDatas(),t=e.length;this.selectBtn=e[t-1].rechargeMoney;for(var a=0;a<t;a++)if(this.countMoney<e[a].rechargeMoney){this.selectBtn=e[a].rechargeMoney;break}},updataIDAry:function(e){var t=this.actDicType,a=void 0;for(var i in this.awardsIdAr.indexOf(e)<0&&this.awardsIdAr.push(e),t)if(a=t[i],i==e)return void a.updataReceive(!0)},setCfgData:function(){var e=game.NewFirstRechargeCfg.getDatas();if(e&&!(e.length<1)){var t=e.length,a=void 0;this.actDicType={};for(var i=void 0,n=0;n<t;n++)a=e[n],(i=new game.NewFirstChargeInfo).receive=!1,0<=this.awardsIdAr.indexOf(a.id)&&(i.receive=!0),i.setConfig(a),this.actDicType[a.id]=i}},getItemsAry:function(e){var t=[],a=void 0,i=this.actDicType;for(var n in i)(a=i[n]).rechargeMoney==e&&t.push(a);return t},getFreeItem:function(){var e=game.RechargeMiscCfg.getData("firstRechargePrize").value.split(",");return game.ItemUtil.createBaseItemInfo(e[0],e[1]>>1)},getSendId:function(){for(var e=this.getItemsAry(this.selectBtn),t=void 0,a=e.length,i=this.awardsIdAr,n=0;n<a;n++)if(t=e[n],this.countMoney>=t.rechargeMoney&&i.indexOf(t.id)<0)return t.id},getReceiveStatus:function(){var e=this.getItemsAry(this.selectBtn),t=e[0].rechargeMoney,a=e.length,i=e[a-1].day,n=this.awardsIdAr,s=game.miscData.openServerDay,r=void 0;if(t>this.countMoney)return 1;for(var o=0;o<a;o++)if(r=e[o],this.countMoney>=r.rechargeMoney&&n.indexOf(r.id)<0){if(r.day>s)return 3;if(r.day==s||i<s)return 2}return 4},getRedPiont:function(e){for(var t=this.getItemsAry(e),a=t.length,i=t[a-1].day,n=this.awardsIdAr,s=game.miscData.openServerDay,r=void 0,o=0;o<a;o++)if(r=t[o],this.countMoney>=r.rechargeMoney&&n.indexOf(r.id)<0&&(r.day==s||i<s))return!0;return!1},getJumpId:function(){return this.getItemsAry(this.selectBtn)[0].jump},getJumpAct:function(){return this.getItemsAry(this.selectBtn)[0].isopenAct},checkAlert:function(){var e=this.actDicType,t=void 0,a=this.awardsIdAr,i=game.miscData.openServerDay;if(!this.freeBol)return!0;for(var n in e)if(t=e[n],this.countMoney>=t.rechargeMoney&&a.indexOf(t.id)<0&&i>=t.day)return!0;return!1},checkAlert2:function(){var e=this.actDicType,t=void 0,a=this.awardsIdAr,i=game.miscData.openServerDay;for(var n in e)if(t=e[n],this.countMoney>=t.rechargeMoney&&a.indexOf(t.id)<0&&i>=t.day)return this.oneBtn=t.rechargeMoney,!0;return!1},getIsOpen:function(){var e=this.actDicType,t=this.awardsIdAr;if(!this.freeBol)return!0;for(var a in e)if(e[a],t.indexOf(+a)<0)return!0;return b8e.module.isShowView(game.ME.NewFirstCharge)&&game.module.hide(game.ME.NewFirstCharge),!1},getBtnList:function(){for(var e=game.NewFirstRechargeCfg.getDatas(),t=e.length,a=[],i=0;i<t;i++){for(var n=a.length,s=!0,r=0;r<n;r++)if(a[r].rechargeMoney==e[i].rechargeMoney){s=!1;break}if(s){var o=new game.NewFirstChargeInfo;o.setConfig(e[i]),o.select=o.rechargeMoney==this.selectBtn,o.alert=this.getRedPiont(o.rechargeMoney),a.push(o)}}return a}});game.newFirstChargeData=game.newFirstChargeData||new e}(),function(){var e;e=b8e.Object.extends({id:0,day:0,title:null,rechargeMoney:0,config:null,receive:!1,jump:null,isopenAct:null,ctor:function(){this._super()},setConfig:function(e){this.config=e,this.id=e.id,this.day=e.day,this.title=e.title,this.jump=e.jump,this.isopenAct=e.isopenAct,this.rechargeMoney=e.rechargeMoney},updataReceive:function(e){this.receive=e},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e,t,a=this.config.giveItems,i=a.length;this.awards=[];for(var n=0;n<i;n++)e=a[n],t=game.ItemUtil.createPrizeInfo(e.Id,e.Num),this.awards.push(t);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$NewFirstChargeInfo",e)}(),function(){var e=game.Control.extends({ctor:function(){this._super()},init:function(){this.data=game.newFirstChargeData,this.newAlert=game.spotAlert.set(game.SAE.NEW_FIRST_CHARGE)},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess,C_INIT_MODEL:this.initRecharge},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={NewFirstRechargeResp:this.updataRechargeId}},resetDaily:function(){this.data.getIsOpen()?(this.send(this.Evts.UPDATA_COUNT_MONEY),this.checkAlert()):b8e.module.isShowView(game.ME.NewFirstCharge)&&game.module.hide(game.ME.NewFirstCharge)},initRecharge:function(){var e=this,t=game.rechargeData.firstRechargeFree,a=game.rechargeData.newFirstRechargeAwards,i=game.rechargeData.rechargeMoney;e.data.freeBol=t,e.data.awardsIdAr=a,e.data.countMoney=i,e.data.setCfgData(),e.data.getBtnMoney(),e.data.checkAlert2()&&e.data.firstShow&&(b8e.module.isShowView(game.ME.NewFirstCharge)||(e.data.selectBtn=e.data.oneBtn,game.gamePopupMgr.show(game.ME.NewFirstCharge))),e.data.firstShow&&(e.data.firstShow=!1),e.checkAlert()},rechargeSuccess:function(e){e&&e.data&&(this.data.countMoney=game.rechargeData.rechargeMoney,this.send(this.Evts.UPDATA_COUNT_MONEY),this.checkAlert())},updataRechargeId:function(e){var t=e.readProtobuf(game.pb.NewFirstRechargeResponse);0<t.code?game.notice.noticeError(t.code):(0==t.id?this.data.freeBol=!0:this.data.updataIDAry(t.id),this.send(this.Evts.UPDATA_COUNT_MONEY),this.dpt(this.Evts.C2C_REFRESH_BTNS),this.checkAlert())},notify:function(e,t){switch(e){case this.Evts.HIDE_GUIDE:this.hideGuide();break;case this.Evts.V_SELECT_GEAR_BTN:if(this.data.selectBtn==t)return;this.data.selectBtn=t,this.send(this.Evts.V_SELECT_GEAR_BTN)}},hideGuide:function(){this.dpt(this.Evts.NEW_CHARGE)},freeBtn:function(){0<=this.data.awardsIdAr.indexOf(0)||this.data.freeBol||this.sender.NewFirstRechargeReq(0)},chongzhi_btn1:function(){for(var e=this.data.getJumpId().split("|"),t=e.length,a=0;a<t;a++){if(9999==+e[a]){var i=this.data.getJumpAct().split(","),n=game.openServerData.getOpenserverInfoByType(i[0]);if(!n||n.length<1)continue;var s={openServerType:i[0],type:i[1]};return void b8e.evt.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,s)}var r=e[a].split(","),o=+r[0]>>0,g=+r[1]>>0,u=+r[2]>>0;if(game.moduleOpen.checkOpen(+u))return void game.module.showToggle(o,g)}game.module.showToggle(game.ME.RechargeHall,game.RechargeHallType.RECHARGE)},chongzhi_btn2:function(){var e=this.data.awardsIdAr,t=this.data.getSendId();0<=e.indexOf(t)||this.sender.NewFirstRechargeReq(t)},chongzhi_btn3:function(){game.module.hide(game.ME.Recharge)},btn1_no:function(){},btn2_no:function(){},selectToggle:function(e){e!=this.data.selectId&&(0==e?e=6:1==e&&(e=100),this.data.selectBtn=e,this.send(this.Evts.V_TOGGLECHANGE,e))},checkAlert:function(){this.newAlert.alert=this.data.checkAlert()}}),t=[game.ME.NewFirstChargeGuide],a=game.Sender.extends({ipc:function(){this.msg={NewFirstRechargeReq:this.newFirstRechargeReq}},newFirstRechargeReq:function(e){var t=game.pb.NewFirstRechargeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.NewFirstCharge,e,game.NewFirstChargeEvts,a,t)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1746),this.setSize(128,55)},setData:function(){var e=this.data;e&&(this.skin.image1.active=e.select,this.skin.image2.active=!e.select,this.skin.redPoint.active=e.alert,this.skin.descLabel.string=game.Lang.get(53673,e.rechargeMoney))},onClickBtn:function(){this.send(game.NewFirstChargeEvts.V_SELECT_GEAR_BTN,this.data.rechargeMoney)},onHide:function(){this.skin.image1.active=!1,this.skin.image2.active=!1,this.skin.redPoint.active=!1,this.skin.descLabel.string=""}})).poolCall=!0,b8e.RC("$$game","$$NewFirstChargeSelectItem",e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1517),this.setSize(234,155)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=0,e.layout.spacingX=5},setData:function(){var e=this.skin,t=this.data;e.countMoney.string=t.title;var a=this.data.getPrizeItems();this.prizeList.setData(a);var i=game.ResCfg.getUrl(10178,t.day);e.bg02.loadTexture(i);var n=t.receive;e.giveTrue.active=n}})).poolCall=!0,b8e.RC("$$game","$$NewFirstChargeItem",e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1516)},notify:function(e){switch(e){case this.Evts.UPDATA_COUNT_MONEY:case this.Evts.V_SELECT_GEAR_BTN:this.updataView()}},init:function(){var e=this;e.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.awardList.itemRender=game.NewFirstChargeItem,e.awardList.addToParent(e.skin.list),e.awardList.bindEnum=game.ME.NewFirstCharge,e.awardList.layout.spacingX=-24,e._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),e._icon.addToParent(e.skin.freeNode),e.btnList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.btnList.itemRender=game.NewFirstChargeSelectItem,e.btnList.addToParent(e.skin.selectList),e.btnList.bindEnum=game.ME.NewFirstCharge,e.btnList.layout.spacingY=3},onShow:function(){game.newFirstChargeData.isFirstShow?game.newFirstChargeData.isFirstShow=!1:game.newFirstChargeData.getBtnMoney(),b8e.module.isShowView(game.ME.NewFirstChargeGuide)&&game.module.hide(game.ME.NewFirstChargeGuide),this.updataView()},updataView:function(){this.updataFreeItem(),this.updataListShow(),this.updateSelectList(),this.updataSendBtn(),this.showGuide2()},showGuide2:function(){this.guid2||(this.guid2=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1)),this.guid2&&!this.guid2.parent&&this.skin.guid2.addChild(this.guid2);var e=game.ResCfg.getUrl(5019,1123);this.guid2.load(e),this.guid2.play()},updataSendBtn:function(){var e=this.skin,t=!1,a=!1,i=!1,n=!1,s=game.newFirstChargeData.getReceiveStatus();0!=s&&(1==s?t=!0:2==s?a=!0:3==s?i=!0:4==s&&(n=!0),e.chongzhi_btn1.active=t,e.chongzhi_btn2.active=a,e.chongzhi_btn3.active=i,e.chongzhi_btn4.active=n)},updataListShow:function(){var e=game.newFirstChargeData.countMoney;this.skin.countMoney.string=game.Lang.get(53043,e);var t=game.newFirstChargeData.getItemsAry(game.newFirstChargeData.selectBtn);this.awardList.setData(t),this.skin.bg1.loadTexture(game.ResCfg.getUrl(10225,game.newFirstChargeData.selectBtn))},updataFreeItem:function(){var e=this,t=e.skin,a=game.newFirstChargeData.freeBol;if(t.freebg_01.active=!a,a)e.guid&&(e.guid.clear(),e.guid.parent&&e.guid.removeFromParent());else{var i=game.newFirstChargeData.getFreeItem();game.GridUtil.setItemIcon(e._icon,i,!1,game.IconLayoutEnum.SHOW_NUM),e.guid||(e.guid=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1)),e.guid&&!e.guid.parent&&e.skin.guid.addChild(e.guid);var n=game.ResCfg.getUrl(5019,1001);e.guid.load(n),e.guid.play()}},updateSelectList:function(){var e=game.newFirstChargeData.getBtnList();this.btnList.setData(e)}});b8e.module.registerView(game.ME.NewFirstCharge,e)}(),function(){var e=game.View.extends({_specialLayer:!0,ctor:function(){this._super(1519),this.setLocalZOrder(game.GameViewMgr.LowLayerViewIndex)},init:function(){},onShow:function(){this.guid||(this.guid=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1)),this.guid&&!this.guid.parent&&this.skin.guid.addChild(this.guid);var e=game.ResCfg.getUrl(5019,1001);this.guid.load(e),this.guid.play()},onHide:function(){this.guid&&(this.guid.clear(),this.guid.parent&&this.guid.removeFromParent())},onStageResize:function(){}});b8e.module.registerView(game.ME.NewFirstChargeGuide,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C2V_SWITCH_PAGE:-1,V2C_SELECT_ID:-1,V2C_GET_TAGET_AWARD:-1,C2V_GET_TAGET_AWARD_SUCCESS:-1,C2C_REQ_RACE_RANKINFO:-1,C2V_UPDATE_RANK_LIST:-1,C2V_UPDATE_TITLE_LIST:-1,V_SELECT_CHANGE:-1}),b8e.RC("$$game","$$OpenCompetitionEvtsNew",e)}(),function(){var e;e=b8e.Object.extends({id:0,setData:function(e){e&&(this.cfg=e,this.id=e.id)},getPrizeList:function(){return this.prizeList?this.prizeList:this.cfg?(this.prizeList=game.CfgUtil.getPrizeListInfo(this.cfg.award,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84).items,this.prizeList):null}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OCRankAwardInfoNew",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,canGet:!1,isGet:!1,progress:0,ocId:0,setData:function(e){e&&(this.cfg=e,this.id=e.id,this.canGet=!1,this.isGet=!1,this.progress=0,this.serverStart=e.serverStart,this.serverEnd=e.serverEnd)},getPrizeList:function(){return this.prizeList?this.prizeList:this.cfg?(this.prizeList=game.CfgUtil.getPrizeListInfo(this.cfg.award).items,this.prizeList):null},recycle:function(){this.reset(),this._super()},reset:function(){this.cfg=null,this.id=0,this.canGet=!1,this.isGet=!1,this.progress=0,this.prizeList=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,64),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$OCTargetInfoNew",t)}(),function(){var e;e=b8e.Object.extends({id:0,isAlert:!1,select:!1,setData:function(e){e&&(this.cfg=e,this.id=e.id,this.isAlert=!1,this.select=!1)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OCTitleInfoNew",e)}(),function(){var e=b8e.Object.extends({curSelectId:0,ctor:function(){this._super(),this.targetMap=b8e.HashMap.get(),this.targetTitleMap=b8e.HashMap.get(),this.titleTypeMap=b8e.HashMap.get()},setOpenList:function(){var e=this,t=game.openCompetitionData.getRaceRankCfgsByClientType(2);if(t&&!(t.length<1)){e.openList||(e.openList=[]),e.openList.length=0,e.openPool||(e.openPool=[]),e.targetTitleMap.clear(),e.titleTypeMap.clear();for(var a=void 0,i=void 0,n=void 0,s=t.length,r=game.miscData.openServerDay,o=0;o<s;o++)a=t[o],i=(i=e.openPool[o])||(e.openPool[o]=new game.OCTitleInfoNew),a.serverStart>r||a.serverEnd<=r?e.clearTargetList(a.raceType,a.id):(i.setData(a),e.targetTitleMap.set(i.id,i),(n=e.titleTypeMap.get(a.raceType))||(n=[],e.titleTypeMap.set(a.raceType,n)),n.push(i),e.openList.push(i),e.setTargetList(a));e.openList.sort(e.onSort),!e.curSelectId&&e.openList&&0<e.openList.length&&e.selectPage(e.openList[0].id)}},onSort:function(e,t){return e.id-t.id},setTargetList:function(e){var t=game.openCompetitionData.getRaceRankTargetCfgByType(e.id);if(t&&!(t.length<1)){var a,i=void 0,n=void 0,s=void 0,r=this.targetMap.get(e.raceType),o=e.id;r||(r=b8e.HashMap.get(),this.targetMap.set(e.raceType,r));var g=r.get(o);if(!(g&&0<g.length))for(g=[],r.set(o,g),a=t.length,i=0;i<a;i++)(n=t[i]).serverStart==e.serverStart&&n.serverEnd==e.serverEnd&&((s=game.OCTargetInfoNew.get()).ocId=o,s.setData(n),g.push(s))}},clearTargetList:function(e,t){if(this.targetMap){var a=this.targetMap.get(e);if(a){var i=a.get(t);if(i&&!(i.length<1)){for(var n=i.length,s=0;s<n;s++)game.OCTargetInfoNew.put(i[s]);i.length=0,a.del(t)}}}},setupData:function(e,t){if(this.raceTargetAwards=e,this.rankProgressMap||(this.rankProgressMap=b8e.HashMap.get()),t&&!(t.length<1)){this.raceTypeMap||(this.raceTypeMap=b8e.HashMap.get());for(var a=void 0,i=t.length,n=0;n<i;n++)a=t[n],this.rankProgressMap.set(a.id,a.progress)}},selectPage:function(e){var t=void 0;e!=this.curSelectId&&(this.curSelectId&&(t=this.targetTitleMap.get(this.curSelectId))&&(t.select=!1),(t=this.targetTitleMap.get(e))&&(t.select=!0,this.curSelectId=e))},checkAllAlert:function(e){var t=this.openList;if(!t||t.length<1)return!1;for(var a=void 0,i=!1,n=t.length,s=0;s<n;s++)if((a=t[s])&&a.cfg&&(a.isAlert=this.checkAlert(a.cfg.raceType,a.id,e),i=i||a.isAlert,!e&&i))return i;return i},checkAlertByType:function(e,t){if(!this.titleTypeMap)return!1;var a=this.titleTypeMap.get(e);if(!a)return!1;for(var i=void 0,n=!1,s=a.length,r=0;r<s;r++)if((i=a[r])&&i.cfg&&(i.isAlert=this.checkAlert(i.cfg.raceType,i.id,t),n=n||i.isAlert,!t&&n))return n;return n},checkAlert:function(e,t,a){if(!this.targetMap)return!1;var i=this.targetMap.get(e);if(!i)return!1;var n=i.get(t);if(!n||n.length<1)return!1;for(var s=void 0,r=void 0,o=!1,g=n.length,u=0;u<g;u++)if((r=n[u])&&r.cfg&&(s=r.cfg,r.progress=this.getCondition(e,r.ocId),r.canGet=r.progress>=s.condition,r.isGet=this.raceTargetAwards&&-1<this.raceTargetAwards.indexOf(r.id),(o=o||r.canGet&&!r.isGet)&&!a))return o;return o},setTargetGet:function(e){this.raceTargetAwards||(this.raceTargetAwards=[]),this.raceTargetAwards.push(e)},getCondition:function(e,t){var a=void 0,i=void 0,n=0,s=void 0,r=game.OpenCompetitionType;switch(e){case r.SUMMON:var o=game.partnerData.getRacePartners();if(!o||o.length<1)return 0;var g=void 0;for(i=o.length,a=0;a<i;a++)s=o[a],(g=game.RaceSummonScoreCfg.getData(s.cfg.quality,s.star))&&(n+=g.score);return n;case r.EQUIP:for(var u=void 0,l=void 0,c=void 0,h=void 0,m=1;m<5;m++)if((c=game.partnerEquipData.getAllInfosByPos(m,!0))&&!(c.length<1))for(l=c.length,u=0;u<l;u++)h=c[u],(0==n||n<h.totalFight)&&(n=h.totalFight);return n;case r.SHENHUN:return this.getFosterScoreByType(game.NewFosterType.SHENHUN);case r.MOUNT:return this.getFosterScoreByType(game.NewFosterType.MOUNT);case r.HALO:var d=game.fosterData.getFosterActiveIds(game.NewFosterType.HALO);if(!d||d.length<1)return 0;for(i=d.length,a=0;a<i;a++)n+=d[a].lv;return n;case r.COST:case r.RECHARGE:case r.XbMount:case r.XbShenhun:case r.XbFormation:case r.XbProper:case r.XbAoyi:case r.XbHalo:case r.XbWing:return this.rankProgressMap&&this.rankProgressMap.get(t)||0;default:b8e.error("\u8bd5\u56fe\u83b7\u53d6\u672a\u5b9e\u73b0\u6761\u4ef6\u7684raceType\u6570\u636e:",e)}return n},updatePayCount:function(i){var n=this,e=n.targetMap.get(game.OpenCompetitionType.COST);e&&0<e.count()&&e.forEach(function(e,t){var a=n.rankProgressMap.get(e);a=a?a+i:i,n.rankProgressMap.set(e,a)},n)},updataXunBaoNum:function(e,i){var n=this,t=n.targetMap.get(e);t&&0<t.count()&&t.forEach(function(e,t){var a=n.rankProgressMap.get(e);a=a?a+i:i,n.rankProgressMap.set(e,a)},n)},updataRechargeMoney:function(i){var n=this,e=n.targetMap.get(game.OpenCompetitionType.RECHARGE);e&&0<e.count()&&e.forEach(function(e,t){var a=n.rankProgressMap.get(e);a=a?a+i:i,n.rankProgressMap.set(e,a)},n)},getProgressBuyId:function(e){return this.rankProgressMap.get(e)>>0},getFosterScoreByType:function(e){var t=game.fosterData.getFosterActiveIds(e);if(!t||t.length<1)return 0;for(var a=void 0,i=void 0,n=0,s=0,r=t.length,o=0;o<r;o++)a=(i=t[o]).getPower(),(0==n||n<a)&&(n=a,s=i.id);return 0!=s&&(n=game.fosterData.getPower(e,s)),n},getTitleInfoList:function(){return this.openList},getKempInfo:function(e){return game.raceRankData.getFirstRankTypeInfo(e)},getSelfRankInfo:function(e){return game.raceRankData.getSelfRankInfo(e)},getScoreDesc:function(e,t,a,i){var n=!(3<arguments.length&&void 0!==i)||i,s=this.getRaceRankCfgById(e);if(!s)return"";var r=game.OpenCompetitionType;if(s.raceType!=r.COST&&s.raceType!=r.RECHARGE)return n?game.Lang.get(s.conditionDesc2,t):t;var o=this.getRankLength(e),g=this.getSelfRankInfo(e),u="????";return g&&g.rank==a.rank?n?game.Lang.get(s.conditionDesc2,t):t:(u=!g||!g.rank||100<g.rank?a.rank==o?t:"????":g.rank==a.rank-1||g.rank==a.rank+1?t:"????",n?game.Lang.get(s.conditionDesc2,u):u)},getRankLength:function(e){var t=game.raceRankData.getRankInfoArrByType(e);return t&&t.length||0},getConditionDesc:function(e){var t=this.getRaceRankCfgById(e);return t?t.condition:""},getKempPrizeList:function(e){var t=this.getRankAwardList(e);return!t||t.length<1?null:t[0].getPrizeList()},getEndTime:function(e){var t=this.targetTitleMap.get(e);if(!t||!t.cfg)return 0;var a=t.cfg.serverEnd-game.miscData.openServerDay;return b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,a)},getTargetList:function(e){var t=this.getRaceRankCfgById(e);if(!t)return null;var a=this.targetMap.get(t.raceType);return a&&a.get(e)},getRankList:function(e){return game.raceRankData.getRankInfoArrByType(e)},getTopRankList:function(e){this._topRankList||(this._topRankList=[]),this._topRankList.length=0;var t=this.getRankList(e);if(!t||t.length<1)return null;for(var a=1<t.length?1:t.length,i=0;i<a;i++)this._topRankList.push(t[i]);return this._topRankList},getShowRankList:function(e){this.showList||(this.showList=[]),this.showList.length=0;var t=this.getRankList(e);return t.length<2||(this.showList=t.slice(1)),this.showList},getRankAwardList:function(e){this.rankAwardMap||(this.rankAwardMap=b8e.HashMap.get());var t=this.rankAwardMap.get(e);if(t)return t;t=[],this.rankAwardMap.set(e,t);var a=game.openCompetitionData.getRaceRankAwardCfgById(e);if(!a||a.length<1)return t;for(var i=void 0,n=void 0,s=a.length,r=0;r<s;r++)n=a[r],(i=new game.OCRankAwardInfo).setData(n),t.push(i);return t.sort(this.awardSort),t},awardSort:function(e,t){return e.startRank-t.startRank},getIsOpen:function(){return this.openList&&0<this.openList.length},getIsOpenById:function(e){return this.targetTitleMap.get(e)},getRaceRankCfgById:function(e){return game.openCompetitionData.getRaceRankCfgById(e)},getRaceRankTargetCfgById:function(e){return game.openCompetitionData.getRaceRankTargetCfgById(e)}});game.openCompetitionDataNew=game.openCompetitionDataNew||new e}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.OPEN_COMPETITION_ALERT_NEW,game.SAE.HOME)},ipc:function(){var e=this;e.evts={Rank:{C2C_GET_RACE_RANK_INFO:e.updateRankInfo},OpenServer:{C2C_INIT_OPENSERVER:e.initOpenserver},PartnerStar:{V_UPDATE_STAR:e.updatePartner},Foster:{C2C_UPDATE_POWER:e.updateFoster,C2C_FOSTER_DATA_INIT:e.updateAllFoster},EquipForge:{C2C_UPDATE_EQUIP_POWER:e.updateEquip},PartnerEquipChange:{C2C_UPDATE_EQUIP_POWER:e.updateEquip},Back:{C2C_REMOVE_AMOUNT:e.removeAmount},Recharge:{C_RECHARGE_SUCCESS:e.updateRecharge},MainRole:{C_INIT_SERVER_DATA:e.initOpenList,C_RESET_DAILY:e.resetDaily},Partner:{C_UPDATE_ACTIVE:e.updatePartner},PartnerChange:{C_UPDATE_BATTLE:e.updateAllFoster},XunBao:{C2C_XUNBAO_ID:e.updateXunBao},OpenCompetition:{C2C_RACETARGET_RESP:e.raceTargetResp}}},updateXunBao:function(e){if(e&&e.data){var t=game.TreasureCostCfg.getData(e.data);if(t){var a=t.count,i=game.xunBaoData.getCfgById(t.activityId);if(i){var n=0,s=game.OpenCompetitionType;switch(i.xunbaoType){case 1:n=s.XbMount;break;case 2:n=s.XbShenhun;break;case 3:n=s.XbFormation;break;case 4:n=s.XbProper;break;case 6:n=s.XbWing;break;case 7:n=s.XbAoyi;break;case 8:n=s.XbHalo}n&&(game.openCompetitionDataNew.updataXunBaoNum(n,a),this.checkAlert(n))}}}},resetDaily:function(){this.setOpenList();var e=game.openCompetitionDataNew;if(b8e.module.isShowView(this.moduleEnum)&&!e.getIsOpen())return game.module.hide(this.moduleEnum),game.module.hide(game.ME.OCRank),void game.module.hide(game.ME.OCRankAward);if(!e.getIsOpenById(e.curSelectId)){var t=e.getTitleInfoList();t&&0<t.length&&(e.selectPage(t[0].id),this.send(this.Evts.C2V_SWITCH_PAGE),game.module.hide(game.ME.OCRank),game.module.hide(game.ME.OCRankAward))}},raceTargetResp:function(e){var t=e.data;if(0<t.code)game.notice.noticeError(t.code);else{var a=game.openCompetitionDataNew;a.setTargetGet(t.id);var i=a.getRaceRankTargetCfgById(t.id);i&&a.checkAlert(i.raceType,i.rankId,!0),this.checkAllAlert(),this.send(this.Evts.C2V_GET_TAGET_AWARD_SUCCESS),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeReceive)}},notify:function(e,t){var a=this;switch(e){case a.Evts.V2C_SELECT_ID:t&&(game.openCompetitionDataNew.selectPage(t),a.send(a.Evts.C2V_SWITCH_PAGE),a.dpt(a.Evts.C2C_REQ_RACE_RANKINFO,t));break;case a.Evts.V2C_GET_TAGET_AWARD:a.sender.RaceTargetReq(t);break;case a.Evts.V2C_SHOW_VIEW:a.checkAllAlert(!0),a.dpt(a.Evts.C2C_REQ_RACE_RANKINFO,game.openCompetitionDataNew.curSelectId)}},triggerOpen:function(){this.initOpenList()},initOpenserver:function(e){if(e&&e.data){this.initOpenList();var t=e.data.raceTargetAwards,a=e.data.rankProgress;game.openCompetitionDataNew.setupData(t,a),this.checkAllAlert()}},initOpenList:function(){this.initOpen||(this.initOpen=!0,this.setOpenList())},setOpenList:function(){game.openCompetitionDataNew.setOpenList(),this.checkAllAlert(),this.send(this.Evts.C2V_UPDATE_TITLE_LIST),this.dptG(game.ActiveBarGEvts.REFRESH_BTNS)},updateRankInfo:function(){this.send(this.Evts.C2V_UPDATE_RANK_INFO)},updatePartner:function(){this.checkAlert(game.OpenCompetitionType.SUMMON)},updateAllFoster:function(){this.checkAlert(game.OpenCompetitionType.MOUNT),this.checkAlert(game.OpenCompetitionType.SHENHUN),this.checkAlert(game.OpenCompetitionType.HALO)},updateFoster:function(e){if(e&&e.data){var t=game.NewFosterType;switch(e.data){case t.MOUNT:this.checkAlert(game.OpenCompetitionType.MOUNT);break;case t.SHENHUN:this.checkAlert(game.OpenCompetitionType.SHENHUN);break;case t.HALO:this.checkAlert(game.OpenCompetitionType.HALO)}}},updateEquip:function(){this.checkAlert(game.OpenCompetitionType.EQUIP)},updateAmount:function(e){var t=!!e.data;game.openCompetitionDataNew.updatePayCount(t),this.checkAlert(game.OpenCompetitionType.COST)},removeAmount:function(e){if(e&&e.data){game.openCompetitionDataNew.updatePayCount(e.data),this.checkAlert(game.OpenCompetitionType.COST)}},updateRecharge:function(e){if(e&&e.data){var t=e.data,a=0;if(t.id){var i=game.RechargeCfg.getDataById(t.id);i&&(a=i.money)}else a=t.money;game.openCompetitionDataNew.updataRechargeMoney(a),this.checkAlert(game.OpenCompetitionType.RECHARGE)}},checkAlert:function(e){var t=b8e.module.isShowView(this.moduleEnum),a=game.openCompetitionDataNew.checkAlertByType(e,t);a&&(this.spotAlert.alert=a)},checkAllAlert:function(e){this.spotAlert.alert=game.openCompetitionDataNew.checkAllAlert(!!e)},checkOpen:function(){return game.moduleOpen.checkOpen(this.moduleEnum)},awardBtn:function(){game.module.show(game.ME.OCRankAwardNew)},btn_1:function(){this.send(this.Evts.V_SELECT_CHANGE,0)},btn_2:function(){this.send(this.Evts.V_SELECT_CHANGE,1)},selectToggle:function(e){this.send(this.Evts.V_SELECT_CHANGE,e)}}),t=[game.ME.OCRankNew,game.ME.OCRankAwardNew,game.ME.OpenCompetitionNew],a=game.Sender.extends({ipc:function(){this.msg={RaceTargetReq:this.raceTargetReq}},raceTargetReq:function(e){var t=game.pb.RaceTargetRequest;t.id=e,b8e.net.getBytes().writeProtobuf(t)}});b8e.module.registerControl(game.ME.OCCompetitionBase,e,game.OpenCompetitionEvtsNew,a,t)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1526),this.setSize(540,124)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=5,e.layout.paddingTop=8,e.layout.paddingLeft=0},setData:function(){var e=this.data;if(e&&e.cfg){var t=this.skin,a=e.cfg,i=a.startRank;t.rank_1.active=1==i,t.rank_2.active=2==i,t.rank_3.active=3==i,t.rank.active=3<i,t.rank.string=game.Lang.get(52122,i,a.endRank);var n=e.getPrizeList();this.prizeList.setData(n)}}})).poolCall=!0,b8e.RC("$$game","$$OCRankAwardItemNew",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1527)},init:function(){var e=this.list=new game.List;e.itemRender=game.OCRankAwardItemNew,e.addToParent(this.skin.list),e.bindEnum=this.moduleEnum,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5;var t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.addToParent(this.skin.prizeList),t.layout.spacingX=5,t.layout.paddingTop=8,t.layout.paddingLeft=0},onShow:function(){var e=this.skin,t=game.openCompetitionDataNew,a=t.getRankAwardList(t.curSelectId);this.list.setData(a);var i=t.curSelectId,n=t.getSelfRankInfo(i);e.rank.string=!n||0==n.rank||100<n.rank?game.Lang.get(52123):n.rank;for(var s=a.length,r=void 0,o=void 0,g=0;g<s;g++)if(r=a[g],n.rank>=r.cfg.startRank&&n.rank<=r.cfg.endRank){o=r.getPrizeList();break}o&&this.prizeList.setData(o)}});b8e.module.registerView(game.ME.OCRankAwardNew,e)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1528),this.setSize(540,83)},setData:function(){var e=this.data;if(e){var t=this.skin;t.score.string=game.openCompetitionDataNew.getScoreDesc(e.ocId,game.CCommonUtil.replaceNum(e.score,1),e,!1),t.name.string=e.name,t.rank_2.active=2==e.rank,t.rank_3.active=3==e.rank,t.rank.active=3<e.rank,t.rankBg.active=3<e.rank,t.rank.string=e.rank}}})).poolCall=!0,b8e.RC("$$game","$$OCRankItemNew",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1529)},init:function(){var e=this.list=new game.List;e.itemRender=game.OCRankItemNew,e.addToParent(this.skin.list),e.bindEnum=this.moduleEnum,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5},onShow:function(){this.curSelectId=game.openCompetitionDataNew.curSelectId,this.updateTopModel(),this.updateMineInfo(),this.updateRankList(),this.updateTopDesc()},onHide:function(){this.clearModel()},clearModel:function(){if(!(!this.roleList||this.roleList.length<1||!this.roleDataList||this.roleDataList.length<1))for(var e=void 0,t=void 0,a=this.roleList.length,i=0;i<a;i++)(t=this.roleDataList[i])&&t.heroModel.clear(),(e=this.roleList[i])&&e.setVisible(!1)},updateTopDesc:function(){var e=game.openCompetitionDataNew.getRaceRankCfgById(this.curSelectId);this.skin.topDesc3.string=e?game.Lang.get(e.conditionDesc3):""},updateMineInfo:function(){var e=game.openCompetitionDataNew,t=e.getSelfRankInfo(this.curSelectId);this.skin.mineRank.string=!t||0==t.rank||100<t.rank?game.Lang.get(52119):game.Lang.get(52120,t.rank);var a=e.getConditionDesc(this.curSelectId),i=e.getProgressBuyId(this.curSelectId);this.skin.minNum.string=game.Lang.get(53063,i,a)},updateRankList:function(){var e=game.openCompetitionDataNew.getShowRankList(this.curSelectId);this.list.setData(e)},updateTopModel:function(){var e=void 0,t=this,a=game.openCompetitionDataNew.getTopRankList(t.curSelectId);if(!a||a.length<1)for(t.clearModel(),e=0;e<1;e++)t.setEmpty(e);else{t.modelList||(t.roleList=[]),t.roleDataList||(t.roleDataList=[]);var i=void 0,n=void 0,s=void 0,r=void 0,o=a.length,g=game.CCommonUtil.replaceNum;for(e=0;e<o;e++)r=a[e],s=(s=t.roleDataList[e])||(t.roleDataList[e]=game.BaseRoleData.get(game.RoleType.Hero,e)),(i=t.roleList[e])||(i=t.roleList[e]=game.sceneRoleCreate.createUIRole(s)).addToParent(t.getComponent("modelNode_"+e)),i.setVisible(!0),s.heroModel.type=game.RoleType.Hero,s.setMale(r.isMale),s.heroModel.setSurface(r.surface),game.AvatarUtil.updateUIModel(i,1,!0),i.transition(game.RoleStateType.ACTION_IDLE),n=game.openCompetitionDataNew.getScoreDesc(t.curSelectId,g(r.score,1),r,!1),t.getComponent("name_"+e).string=game.Lang.get(52121,r.name,""),t.getComponent("score_"+e).string=game.Lang.get(53065,n);if(o<2)for(e=0;o-1<e;e--)t.setEmpty(e),(s=t.roleDataList[e])&&s.heroModel.clear(),(i=t.roleList[e])&&i.setVisible(!1)}},setEmpty:function(e){this.getComponent("name_"+e).string=game.Lang.get(52115)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OCRankNew,e)}(),function(){var e;(e=game.ListItem.extends({ctor:function(){this._super(1530),this.setSize(540,175)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=30,e.layout.paddingLeft=0},setData:function(){var e=this.data;if(e&&e.cfg){var t=this.skin,a=this.cfg=e.cfg;t.getBtn.active=!e.isGet&&e.canGet,t.gotoBtn.active=!e.isGet&&!e.canGet,t.getImg.active=e.isGet;var i=e.canGet?52117:52118,n=game.CCommonUtil.replaceNum;t.curProgress.string=game.Lang.get(i,n(e.progress,1),n(a.condition,1)),t.title.string=a.name;var s=e.getPrizeList();this.prizeList.setData(s)}},getBtn:function(){this.send(game.OpenCompetitionEvtsNew.V2C_GET_TAGET_AWARD,this.data.id)},gotoBtn:function(){if(this.cfg){var e=this.cfg,t=e.gotoME;if(1!=e.isxunbao)if(e.toggle)game.module.showToggle(t,e.toggle-1);else{if(!game.moduleOpen.checkOpenWithTips(t))return;game.module.show(t)}else b8e.evt.dptG(game.XunBaoEvts.C2C_SHOW_XUNBAO,e.toggle)}}})).poolCall=!0,b8e.RC("$$game","$$OCTargetItemNew",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1531)},init:function(){var e=this.targetList=new game.List;e.itemRender=game.OCTargetItemNew,e.addToParent(this.skin.list),e.bindEnum=game.ME.OCCompetitionBase,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.C2V_SWITCH_PAGE:this.updatePage();break;case this.Evts.C2V_GET_TAGET_AWARD_SUCCESS:this.updateTargetList();break;case this.Evts.C2V_UPDATE_RANK_INFO:this.updateKempInfo(),this.updateMineRankInfo();break;case this.Evts.C2V_UPDATE_TITLE_LIST:this.updateTitle()}},onShow:function(){this.updateTitle(),this.updatePage(),this.send(this.Evts.V2C_SHOW_VIEW)},onHide:function(){this.skin.time.string=""},updateTitle:function(){},updatePage:function(){var e=game.openCompetitionDataNew,t=this.selectId=e.curSelectId,a=e.getRaceRankCfgById(t),i=game.ResCfg.getUrl(10180,a.titleImg);this.skin.bg1.loadTexture(i),this.updateKempInfo(),this.updateMineRankInfo(),this.updateTargetList(),this.updateEndTime(),this.targetList.scrollToTop()},updateTargetList:function(){var e=game.openCompetitionDataNew.getTargetList(this.selectId);e&&0<e.length&&e.sort(this.onSort),this.targetList.setData(e)},onSort:function(e,t){return e.isGet==t.isGet?e.id-t.id:e.isGet?1:-1},updateKempInfo:function(){this.skin},updateMineRankInfo:function(){this.skin,game.openCompetitionDataNew.getSelfRankInfo(this.selectId)},updateEndTime:function(){var e=this;if((e.endTime=game.openCompetitionDataNew.getEndTime(e.selectId))<game.SysTime.curTime)e.stopTime();else{var t=e.endTime-game.SysTime.curTime;e.skin.time.string=game.Lang.get(52116,game.TimeUtil.formatTimeSpace(t)),e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),e._timer.reset(),e._timer.start()}},updateTime:function(){var e=this.skin;if(!this.endTime||this.endTime<1)return this.stopTime(),void(e.time.string="");var t=this.endTime-game.SysTime.curTime;if(t<1)return this.stopTime(),void(e.time.string="");e.time.string=game.Lang.get(52116,game.TimeUtil.formatTimeSpace(t))},stopTime:function(){this._timer&&this._timer.stop()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OpenCompetitionNew,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1524),this.toggles={toggle_btn_1:game.ME.OpenCompetitionNew,toggle_btn_2:game.ME.OCRankNew},this.spotAlerts={OPEN_COMPETITION_ALERT_NEW:this.dailyExploitAlert}},onShow:function(){this.toggleSelect(0)},dailyExploitAlert:function(e){this.skin.red_spot_1.active=e.alert},notify:function(e,t){switch(e){case this.Evts.V_SELECT_CHANGE:this.toggleSelect(t)}},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.OCCompetitionBase,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerSkillTips")},init:function(){var e=this.skin;this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.addChild(this.skillIcon)},onShow:function(){this.updateView()},updateView:function(){var e=game.partnerData.skillTipsInfo,t=e.info,a=this.skin,i=void 0;a.starNode.active=1!=e.index,a.pu.active=1==e.index,a.nu.active=2==e.index,a.he.active=3==e.index&&t.heSkill,a.fu.active=3==e.index&&!t.heSkill&&t.cfg.assistObj[0],a.he_node.active=!1,a.fu_node.active=!1,a.skill_node.active=!0;var n=4==e.index&&e.isCond;if(a.talentNode.active=n,a.talentCondLab.active=n,1==e.index&&(i=t.puSkill,t.isMainRole)){var s=game.shenQiData.getShenQiSkill();i=s||i}if(2==e.index&&(i=t.nuSkill,t.isMainRole)){var r=game.fosterData.getBattleSkillId(game.NewFosterType.ZHANJI);i=r||i,r&&!0}if(3==e.index){i=t.heSkill||t.fuSkill,t.cfg.unionObj[0]?this.updateSkill(t,i):a.skill_node.active=!1,this.setSkill(t),a.he_node.active&&a.fu_node.active?a.tipsbg.height=-1*a.fu_node.y+a.fu_node.height+5:(a.he_node.active&&(a.tipsbg.height=-1*a.he_node.y+a.he_node.height+5),a.fu_node.active&&(a.fu_node.y=-20,a.tipsbg.height=-1*a.fu_node.y+a.fu_node.height+15)),a.node.height=a.tipsbg.height}else{if(4==e.index&&(i=e.talentSkillId),this.updateSkill(t,i),n){a.talentNode.y=a.tipsDescLab.y-a.tipsDescLab.height+51;var o=void 0;if(e.taskInfo){var g=game.partnerData.getLangKeyByType(e.taskInfo.taskType);o=game.Lang.get(53412,game.Lang.get(g,e.taskInfo.progress))}else o=game.Lang.get(53413);a.talentCondLab.string=o}a.tipsbg.height=-1*a.tipsDescLab.y+a.tipsDescLab.height+5+(n?6:0),a.node.height=a.tipsbg.height}a.tipsDesc.y=-(a.tipsbg.height+22),this.setSize(a.node.width,a.node.height),this.onStageResize(),game.viewModule.updateLayout(this)},updateSkill:function(e,t){if(t){var a=this.skin,i=game.partnerData.skillTipsInfo,n=game.SkillCfg.getData(t);if(n){a.nameLab.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name),this.skillIcon.setData(t);var s=game.LangSkill.get(n.desc,n.descParam);if(s+="\n\n",2!=i.index&&3!=i.index||e.isMainRole)a.starNode.active=!1;else{var r=e.star;e.isMainRole,a.starNode.active=!0;for(var o=0;o<6;o++){this.getComponent("starIcon"+(o+1)).active=o<r;var g=0,u=game.PartnerStarCfg.getData(e.id,o+1);g=2==i.index?u.angerSkill:u.unionSkill||u.assistSkill;var l=game.SkillCfg.getData(g);if(l&&l.desc2){var c=game.Lang.get(53068,o+1),h=void 0;h=r==o+1?game.Color.YELLOW:o<r?game.Color.WHITE:game.Color.GRAY,s+=game.HtmlUtil.getText(h,c+game.LangSkill.get(l.desc2,l.descParam)+"\n")}}}a.tipsDescLab.string=s}else game.notice.show(53494)}},setSkill:function(e){var t=this.skin,a=e.cfg.unionObj.length,i=e.cfg.assistObj.length;if(0<a){t.he_node.active=!0;var n="";t.he_node.y=t.tipsDescLab.y+-t.tipsDescLab.height+22;for(var s=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),r=0;r<a;r++){var o=r+1,g=e.cfg.unionObj[r],u=game.PartnerCfg.getData(g);if(!u)return;n+=o==a?game.HtmlUtil.getColorStrByQuality(u.quality,u.name):game.HtmlUtil.getColorStrByQuality(u.quality,u.name)+","}t.he_lab.string=game.Lang.get(53459,s,n)}else t.he_node.active=!1;if(0<i){t.fu_node.active=!0;var l="";t.he_node.active&&(t.fu_node.y=t.he_node.y+-88);var c=game.HtmlUtil.getColorStrByQuality(e.quality,e.name);for(r=0;r<i;r++){var h=r+1,m=e.cfg.assistObj[r],d=game.PartnerCfg.getData(m);if(!d)return;l+=h==i?game.HtmlUtil.getColorStrByQuality(d.quality,d.name):game.HtmlUtil.getColorStrByQuality(d.quality,d.name)+","}e.cfg.assistDes?t.fu_lab.string=game.Lang.get(53460,c,e.cfg.assistDes):t.fu_lab.string=game.Lang.get(53460,c,l)}else t.fu_node.active=!1}});b8e.module.registerView(game.ME.PartnerSkillInfoTips,e)}(),function(){var e;e=b8e.Enum({NONE:0,C2C_SHOW_OPENSER:b8e.enc(),C2C_FINISH_CHOUJIANG:b8e.enc(),V2C_SHOW_TIP:b8e.enc(),V_SHOW_TIP:b8e.enc()}),b8e.RC("$$game","$$PushTipEvts",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.showMap=[],this.showModule=0},clearFinish:function(){this.showModule=0,this.showMap.length=0},checkModuleFinish:function(e){return-1<this.showMap.indexOf(e)},checkOpenTime:function(e){switch(e){case 999:return 1<game.miscData.loginDay&&game.dayOrWeekGiftData.getOpenAct();case game.ME.ZhanJiang:return game.openSerCarnivalData.getCurOpenId();case game.ME.RecruitSubB:return game.oneYuanBuyData.checkActIsOpen();case game.ME.QuickBattle:return game.moduleOpen.checkOpen(game.ME.Welfare);default:return!1}},checkModuleOpen:function(){var e=game.PushTipCfg.getDatas();if(e){for(var t=void 0,a=void 0,i=void 0,n=this.showModule=0,s=e.length;n<s;n++)if((a=e[n])&&(i=a.moduleEnum,(t=game.triggerData.getTimes(i))&&(2!=t||a.isRepeat)&&game.moduleOpen.checkOpen(a.chipModule)&&!(game.mainRoleData.lv<a.level)&&this.checkOpenTime(i))){this.showModule=i;break}return this.showModule}}});game.pushTipData=game.pushTipData||new e}(),function(){var e;e=game.Control.extends({ipc:function(){this.gevts={PushTipEvts:{V2C_SHOW_TIP:this.checkPushShow,C2C_FINISH_CHOUJIANG:this.setShowView}},this.evts={Back:{C_BACK_SYN_BACK_INFO:this.nextLoginDay}}},notify:function(e){switch(e){case this.Evts.V_SHOW_TIP:this.showView()}},showView:function(){var e=game.pushTipData.showModule,t=game.triggerData.getTimes(e);!t||1<t||(game.triggerData.saveTimes(e,2),this.sender.SaveClientTriggerReq(e,2))},checkPushShow:function(){game.pushTipData.checkModuleOpen()&&game.module.show(game.ME.PushTip)},setShowView:function(e){var t=e.data;t&&(game.triggerData.getTimes(t)||(game.triggerData.saveTimes(t,1),this.sender.SaveClientTriggerReq(t,1)))},nextLoginDay:function(){game.miscData.loginDay<2||game.triggerData.getTimes(999)||(game.triggerData.saveTimes(999,1),this.sender.SaveClientTriggerReq(999,1))},sureBtn:function(){var e=game.pushTipData.showModule,t=game.PushTipCfg.getData(e);t&&(t.moduleEnum==game.ME.ZhanJiang?(this.dpt(this.Evts.C2C_SHOW_OPENSER),game.module.show(t.chipModule)):t.chipToggle?game.module.showToggle(t.chipModule,t.chipToggle):game.module.show(t.chipModule),game.module.hide(this.moduleEnum))},cancelBtn:function(){game.module.hide(this.moduleEnum)}}),b8e.module.registerControl(game.ME.PushTip,e,game.PushTipEvts,game.TriggerSender),b8e.RC("$$game","$$PushTipControl",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1518)},onShow:function(){this.updataPage()},onHide:function(){game.pushTipData.clearFinish()},updataPage:function(){var e=game.PushTipCfg.getData(game.pushTipData.showModule);e&&(this.skin.lab_tips.string=game.Lang.get(e.lang),this.send(this.Evts.V_SHOW_TIP))}});b8e.module.registerView(game.ME.PushTip,e)}(),function(){var e;e=b8e.Enum({NONE:0,C_BUY_CARD:-1,C_GET_WEEK:-1,C2C_RECHARGE:-1,V_UPDATE_VIEW:-1,C2C_PRIVILEGE_UPDATE:-1,C2C_BUY_WEEK_CARD:-1,C2C_GET_WEEK_CARD:-1}),b8e.RC("$$game","$$PrivilegeShopEvts",e)}(),function(){var e=game.Control.extends({init:function(){},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess,C_GET_CARD_AWARD:this.getWeek},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={BuyPrivilegeResp:this.buyPrivilegeResp}},buyPrivilegeResp:function(e){var t=e.readProtobuf(game.pb.BuyPrivilegeResponse);0<t.code?game.notice.noticeError(t.code):(game.privilegeShopData.buySuccess(t.id),this.send(this.Evts.V_UPDATE_VIEW),this.dpt(this.Evts.C2C_PRIVILEGE_UPDATE))},rechargeSuccess:function(e){if(e&&e.data){var t=e.data.id;this.isWeek?game.privilegeShopData.updateWeek():this.cfg&&t==this.cfg.rechargeId&&(game.privilegeShopData.buySuccess(this.cfg.id),this.send(this.Evts.V_UPDATE_VIEW),this.dpt(this.Evts.C2C_PRIVILEGE_UPDATE))}},getWeek:function(){game.privilegeShopData.updateWeek()},resetDaily:function(){game.privilegeShopData.resetTime(),this.send(this.Evts.V_UPDATE_VIEW)},notify:function(e,t){var a=this;switch(e){case a.Evts.C_BUY_CARD:var i=a.cfg=t.cfg;if(a.isWeek=t.cardType==game.PrivilegeType.WEEK_CARD,a.isWeek)a.dpt(a.Evts.C2C_BUY_WEEK_CARD);else{var n=i.costItems;if(i)if(i.rechargeId)a.dpt(a.Evts.C2C_RECHARGE,i.rechargeId);else if(n&&0<n.length){if(!game.UpgradeUtil.checkItemList(n))return;a.sender.BuyPrivilegeReq(i.id)}}break;case a.Evts.C_GET_WEEK:a.dpt(a.Evts.C2C_GET_WEEK_CARD)}}}),t=game.Sender.extends({ipc:function(){this.msg={BuyPrivilegeReq:this.buyPrivilegeReq}},buyPrivilegeReq:function(e){var t=game.pb.BuyPrivilegeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.PrivilegeShop,e,game.PrivilegeShopEvts,t)}(),function(){var e=b8e.Object.extends({ctor:function(){this.itemMaps=b8e.HashMap.get()},setData:function(e){if(this.initList(),e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=this.itemMaps.get(a.id))&&(i.expireTime=a.expireTime)},initList:function(){var e=game.PrivilegeRechargeCfg.getDatas();if(e)for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++)i=(a=e[s]).id,(n=this.itemMaps.get(i))||((n=new game.privilegeShopItemInfo).cfg=a,n.cardType=a.cardType,n.id=a.id),this.itemMaps.set(i,n)},getItemList:function(){var e=this.itemMaps,t=e.get(game.PrivilegeType.WEEK_CARD);return t||((t=new game.privilegeShopItemInfo).setWeekData(),e.set(t.id,t)),e.values()},resetTime:function(){for(var e=this.itemMaps.values(),t=e.length,a=void 0,i=0;i<t;i++)0<(a=e[i]).expireTime&&a.expireTime<=game.SysTime.curTime&&a.clear();this.updateWeek()},buySuccess:function(e){var t=this.itemMaps.get(e);if(t){var a=t.cfg;0<a.validDays?t.expireTime=b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+a.validDays*b8e.TimeUtil.DAY_MICRO_SECONDS:t.expireTime=0}},updateWeek:function(){var e=this.itemMaps.get(game.PrivilegeType.WEEK_CARD);e&&e.idx++},isActByType:function(e){for(var t=void 0,a=this.itemMaps.values(),i=a.length,n=0;n<i;n++)if((t=a[n]).cardType==e)return 0==t.expireTime||0<t.expireTime-game.SysTime.curTime;return!1},getCfgByType:function(e){for(var t=void 0,a=this.itemMaps.values(),i=a.length,n=0;n<i;n++)if((t=a[n]).cardType==e)return t.cfg;return null},getMysteryFreeTimes:function(){var e=game.PrivilegeType.MYSTERY;if(!this.isActByType(e))return 0;var t=this.getCfgByType(e);return t?t.mysteryFreeTimes:0}});game.privilegeShopData=game.privilegeShopData||new e}(),function(){var e;e=b8e.PoolObject.extends({cfg:null,id:null,cardType:null,expireTime:null,idx:0,ctor:function(){this.id=0,this.cardType=0,this.expireTime=-1},setWeekData:function(){this.id=game.PrivilegeType.WEEK_CARD,this.cardType=game.PrivilegeType.WEEK_CARD,this.cfg=game.rechargeData.getCardRechargeCfg(game.CardType.WEEK)},clear:function(){this.expireTime=-1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$privilegeShopItemInfo",e)}(),function(){var e;e=b8e.Enum({NONE:0,QUICK_BATTLE:1,MYSTERY:2,WEEK_CARD:999}),b8e.RC("$$game","$$PrivilegeType",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("privilegeShop/PrivilegeShopItem"),this.setSize(686,196)},setData:function(){var e=this;if(e.data.cardType!=game.PrivilegeType.WEEK_CARD){var t=e.skin;t.getBtn.active=!1;var a=e.data.cfg;if(a){t.icon.loadTexture(game.ResCfg.getUrl(10181,a.iconUrl)),t.desc.loadTexture(game.ResCfg.getUrl(10181,a.descUrl)),t.lab.loadTexture(game.ResCfg.getUrl(10181,a.labUrl)),t.descLab.string=game.Lang.get(a.langKey);var i=e.data.expireTime;if(t.buyBtn.active=i<0,t.timeLab.active=0<i,t.isGet.active=0<i,i<0){var n="",s=a.costItems;if(a.rechargeId){e.rechargeId=a.rechargeId;var r=game.RechargeCfg.getDataById(e.rechargeId);r&&(n=game.Lang.get(1701,r.money))}else if(s&&0<s.length){var o=s[0].Id,g=game.ItemInfoCfg.getData(o);g&&(n=s[0].Num+g.name)}t.buyLab.string=n}else if(0<i){var u=game.TimeUtil.formatTimeSpace2(i-game.SysTime.curTime);t.timeLab.string=game.Lang.get(53097,u)}e.list||(e.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.list.itemRender=game.PrizeListItem,e.list.layout.spacingX=20,e.list.layout.paddingLeft=0,e.list.addToParent(t.prizeNode)),a.showGiveItems&&(e.prizeInfo||(e.prizeInfo=new game.ZhaoqinPrizeInfo),e.prizeInfo.setup(a.showGiveItems),e.list.setData(e.prizeInfo.items))}}else e.setWeekData()},setWeekData:function(){var e=this,t=e.skin,a=game.rechargeData.getCardRechargeCfg(game.CardType.WEEK);if(a){t.icon.loadTexture(game.ResCfg.getUrl(10181,"icon_999")),t.desc.loadTexture(game.ResCfg.getUrl(10181,"desc_999")),t.lab.loadTexture(game.ResCfg.getUrl(10181,"lab_999")),t.descLab.string=game.Lang.get(53280);var i=e.cardInfo=game.rechargeData.getCardInfoByType(game.CardType.WEEK),n=i&&game.SysTime.curTime<i.expireTime;if(t.timeLab.active=n,t.buyBtn.active=!n,t.getBtn.active=n&&!i.collectedDaily,t.isGet.active=n&&i.collectedDaily,!n){var s=0;e.rechargeId=a.rechargeId;var r=game.RechargeCfg.getDataById(e.rechargeId);r&&(s=r.money),t.buyLab.string=game.Lang.get(1701,s)}if(n){var o=game.TimeUtil.formatTimeSpace2(i.expireTime-game.SysTime.curTime);t.timeLab.string=game.Lang.get(53097,o)}e.list||(e.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.list.itemRender=game.PrizeListItem,e.list.layout.spacingX=20,e.list.layout.paddingLeft=0,e.list.addToParent(t.prizeNode));var g=game.CfgUtil.getPrizeListInfo(a.showDailyAward);e.list.setData(g.items)}},buyBtn:function(){this.send(game.PrivilegeShopEvts.C_BUY_CARD,this.data)},getBtn:function(){this.send(game.PrivilegeShopEvts.C_GET_WEEK,this.data)}}),b8e.RC("$$game","$$PrivilegeShopItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super("privilegeShop/PrivilegeShopView")},init:function(){var e=this,t=e.skin;e.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.itemList.itemRender=game.PrivilegeShopItem,e.itemList.bindEnum=e.moduleEnum,e.itemList.layout.paddingLeft=6,e.itemList.layout.paddingTop=10,e.itemList.layout.spacingY=8,e.itemList.addToParent(t.list),e.data=game.privilegeShopData},onShow:function(){this.updateList()},updateList:function(){var e=this.data.getItemList();this.itemList.setData(e)},onHide:function(){},notify:function(e){switch(e){case this.Evts.V_UPDATE_VIEW:this.updateList()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PrivilegeShop,e)}(),function(){var e;e=b8e.Enum({None:0,C2C_REFRESH_BTNS:-1,C2V_UPDATE_VIEW:-1}),b8e.RC("$$game","$$WelfareTargetEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.spotAlert=game.spotAlert.set(game.SAE.WELFARE_TARGET_ALERT,game.SAE.HOME),this.data=game.welfareTargetData},triggerOpen:function(e){e==this.moduleEnum&&this.checkOpen()},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.checkOpen,C_LEVEL_UP:this.checkOpen}},this.handels={WelfareTargetResp:this.welfareTargetResp}},checkOpen:function(){this.data.initData(),this.checkAlert(),this.dpt(this.Evts.C2C_REFRESH_BTNS)},checkAlert:function(){this.spotAlert.alert=this.data.checkAlert()},getAwardRequest:function(e){var t=this.data.cfgList[e];if(t){if(game.mainRoleData.lv<t.level)return void game.notice.show(9129);this.sender.WelfareTargetReq(t.id)}},welfareTargetResp:function(e){var t=e.readProtobuf(game.pb.WelfareTargetResponse);0<t.code?game.notice.noticeError(t.code):this.data.getIdList&&(this.data.getIdList.push(t.id),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW),this.dpt(this.Evts.C2C_REFRESH_BTNS))},get_btn_1:function(){this.getAwardRequest(0)},get_btn_2:function(){this.getAwardRequest(1)},get_btn_3:function(){this.getAwardRequest(2)}}),t=game.Sender.extends({ipc:function(){this.msg={WelfareTargetReq:this.welfareTargetReq}},welfareTargetReq:function(e){var t=game.pb.WelfareTargetRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.WelfareTarget,e,game.WelfareTargetEvts,t)}(),function(){var e=b8e.Object.extends({curGroup:0,curCfg:null,cfgList:null,ctor:function(){this.getIdList=[]},setWelfData:function(e){this.getIdList=e.welfareTargets},initData:function(){var e=game.miscData.openServerDay;if(this.curGroup=game.WelfareTargetCfg.getCurGroup(e),this.curCfg=null,this.curGroup){var t=game.WelfareTargetCfg.getListByDay(this.curGroup);if(t){this.cfgList=t.sort(this.sortById);for(var a=this.cfgList.length,i=void 0,n=game.mainRoleData.lv,s=0;s<a;s++)if(n<(i=this.cfgList[s]).level){this.curCfg=i;break}}}},sortById:function(e,t){return e.id-t.id},checkOpen:function(){if(!this.cfgList)return!1;for(var e=this.cfgList.length,t=void 0,a=0;a<e;a++)if(t=this.cfgList[a],this.getIdList.indexOf(t.id)<0)return!0;return!1},checkAlert:function(){if(!this.cfgList)return!1;for(var e=this.cfgList.length,t=void 0,a=0;a<e;a++)if(t=this.cfgList[a],game.mainRoleData.lv>=t.level&&this.getIdList.indexOf(t.id)<0)return!0;return!1}});game.welfareTargetData=game.welfareTargetData||new e}(),function(){var e=game.View.extends({MASK_RADIUS:200,ctor:function(){this._super("welfareTarget/WelfareTargetView")},init:function(){this.data=game.welfareTargetData,this.graphicsImg=[],this.maskG=[],this.poly=[]},onShow:function(){this.updateBtnView()},updateBtnView:function(){this.skin;var e=this.data.cfgList;if(e)for(var t=e.length,a=void 0,i=void 0,n=this.data.getIdList,s=void 0,r=void 0,o=void 0,g=void 0,u=0;u<t;u++)if(s=this.getComponent("get_btn_"+(u+1)),r=this.getComponent("geted"+(u+1)),o=this.getComponent("mask"+(u+1)),g=this.getComponent("redPoint"+(u+1)),s&&(a=e[u])&&(i=0<=n.indexOf(a.id),s.setVisible(!i),r.setVisible(i),o.setVisible(!i&&game.mainRoleData.lv<a.level),g.setVisible(!i&&game.mainRoleData.lv>=a.level),!i)){var l=this.getComponent("get_pro_"+(u+1));this.setProgress(l,s,a.level,u)}},setProgress:function(e,t,a,i){var n=this,s=n.graphicsImg[i];s||((s=b8e.Graphics.get()).setAnchor(.5,.5),s.addToParent(t),s.addChild(e),s.setMask(b8e.MaskType.GRAPH),n.poly=[]);var r=n.maskG[i];r=r||s.getMaskGraphics();var o=n.poly[i];o=o||[];var g=360*Math.min(1,game.mainRoleData.lv/a),u=180<g;o.length=0,g=180<g?360-g:-g,o.push(0,0);var l=Math.PI/180,c=0;o.push(Math.cos(c)*n.MASK_RADIUS,Math.sin(c)*n.MASK_RADIUS),c=g/2*l,o.push(Math.cos(c)*(n.MASK_RADIUS+20),Math.sin(c)*(n.MASK_RADIUS+20)),c=g*l,o.push(Math.cos(c)*n.MASK_RADIUS,Math.sin(c)*n.MASK_RADIUS),r.clear(),r.fillPoly(o),s._node.getComponent(cc.Mask).inverted=u},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateBtnView()}}});b8e.module.registerView(game.ME.WelfareTarget,e)}(),function(){var e;e=b8e.Enum({None:0,V2C_UPDATE_GJ:-1,C2V_UPDATE:-1,C_UPDATE_GJ:-1}),b8e.RC("$$game","$$wanFaZhiYinEvts",e)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={Guaji:{C2C_UPDATE_TOTAL_TIME:this.update}}},notify:function(e){switch(e){case this.Evts.V2C_UPDATE_GJ:this.dpt(this.Evts.C_UPDATE_GJ)}},update:function(){this.send(this.Evts.C2V_UPDATE)},btn_1:function(){game.module.show(game.ME.Guaji),this.moduleHide()},btn_2:function(){game.module.show(game.ME.QuickBattle),this.moduleHide()},moduleHide:function(){game.module.hide(game.ME.WanFaZhiYin)},btn_3:function(){game.module.show(game.ME.InstanceFunc),this.moduleHide()}});b8e.module.registerControl(game.ME.WanFaZhiYin,e,game.wanFaZhiYinEvts)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1525)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE:this.updateView()}},onShow:function(){this.send(this.Evts.V2C_UPDATE_GJ),this.updateView()},updateView:function(){var t=this.skin;t.text_lab1.string=this.getStr(1),t.text_lab2.string=this.getStr(2),game.mainInstanceData.getInstanceCfg(function(e){if(e){if(!e)return;t.des.string=game.Lang.get(53093,e.limitLv)}},this)},getStr:function(e){var t="";switch(e){case 1:var a=game.guajiData.totalTime,i=b8e.TimeUtil.formatTime(a);this.setTotalTime(a),t=i;break;case 2:var n=game.VipCfg.getData(game.mainRoleData.vipLevel);t=game.Lang.get(51515,game.mainInstanceData.quickCount,n.quickBattle)}return t},setTotalTime:function(e){if(!(e<0)){var t=game.VipCfg.getData(game.mainRoleData.vipLevel);this.totalTime=e,this.maxTime=60*t.offlineTime*1e3,this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)}},updateTime:function(){this.totalTime+=1e3;var e=void 0;this.maxTime<=this.totalTime?(e=this.maxTime,this.stopTime()):e=this.totalTime;var t=b8e.TimeUtil.formatTime(e);this.skin.text_lab1.string=t},stopTime:function(){this.timer&&this.timer.stop()},onHide:function(){this.stopTime()}});b8e.module.registerView(game.ME.WanFaZhiYin,e)}(),function(){var e;e=game.Control.extends({init:function(){var e=this,t=game.spotAlert;e.partnerBackAlert=t.set(game.SAE.PARTNER_BACK),e.partnerListAlert=t.set(game.SAE.PARTNER_BACK_TAB_LIST,game.SAE.PARTNER_BACK),e.partnerChipAlert=t.set(game.SAE.PARTNER_BACK_TAB_CHIP,game.SAE.PARTNER_BACK),e.partnerUpgradeAlert=t.set(game.SAE.PARTNER_BACK_UPGRADE,game.SAE.PARTNER_BACK_TAB_LIST),e.partnerBreakAlert=t.set(game.SAE.PARTNER_BACK_BREAK,game.SAE.PARTNER_BACK_TAB_LIST),e.partnerStarAlert=t.set(game.SAE.PARTNER_BACK_STAR,game.SAE.PARTNER_BACK_TAB_LIST),e.partnerJpAlert=t.set(game.SAE.PARTNER_BACK_JP,game.SAE.PARTNER_BACK_TAB_LIST),e.partnerAwakenAlert=t.set(game.SAE.PARTNER_BACK_AWAKEN,game.SAE.PARTNER_BACK_TAB_LIST),e.partnerTalentAlert=t.set(game.SAE.PARTNER_BACK_CUR_TALENT,game.SAE.PARTNER_BACK_TAB_LIST),e.partnerActiveAlert=t.set(game.SAE.PARTNER_BACK_ACTIVE,game.SAE.PARTNER_BACK_TAB_CHIP),e.partnerCurUpgradeAlert=t.set(game.SAE.PARTNER_BACK_CUR_UPGRADE),e.partnerCurBreakAlert=t.set(game.SAE.PARTNER_BACK_CUR_BREAK),e.partnerCurStarAlert=t.set(game.SAE.PARTNER_BACK_CUR_STAR),e.partnerCurJpAlert=t.set(game.SAE.PARTNER_BACK_CUR_JP),e.partnerCurTalentAlert=t.set(game.SAE.PARTNER_BACK_CUR_TALENT),e.partnerCurAwakenAlert=t.set(game.SAE.PARTNER_BACK_CUR_AWAKEN),e.data=game.partnerData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo,C_BACK_SYN_BACK_INFO:this.updateItemInfo},Partner:{C_INIT_DATA:this.initPartnerData,C_UPDATE_ACTIVE:this.updateList},PartnerTalent:{V_UPDATE_TALENT_ACT:this.updateItemInfo},PartnerChange:{C_UPDATE_BATTLE:this.updateItemInfo},PartnerHelp:{C_UPDATE_HELP:this.updateItemInfo}}},updateList:function(){this.send(this.Evts.V_UPDATE_DATA)},updateItemInfo:function(){this.data.isInit&&this.checkAllAlert()},initPartnerData:function(){this.checkAllAlert()},checkAllAlert:function(){var e=this;e.partnerUpgradeAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canUpgrade,e.data.partnerBacks),game.moduleOpen.checkOpen(game.ME.PartnerBreak)&&(e.partnerBreakAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canInfoUpgrade,e.data.partnerBacks,game.PartnerUpgradeTypes.BREAK)),game.moduleOpen.checkOpen(game.ME.PartnerStar)&&(e.partnerStarAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canStar,e.data.partnerBacks)),game.moduleOpen.checkOpen(game.ME.PartnerAwaken)&&(e.partnerAwakenAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canAwaken,e.data.partnerBacks)),game.moduleOpen.checkOpen(game.ME.PartnerSpirit)&&(e.partnerJpAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canSpirit,e.data.partnerBacks)),game.moduleOpen.checkOpen(game.ME.PartnerTalent)&&(e.partnerTalentAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canTalent,e.data.partnerBacks)),e.partnerActiveAlert.alert=e.data.checkAnyInfosCanAnyAlert(e.data.canActive,e.data.getPartnerBackActiveList()),e.data.updateAllInfoAlert(),e.checkCurAlert()},checkCurAlert:function(){var e=this;if(e.data.selectBackInfo){var t=e.data.selectBackInfo;e.partnerCurUpgradeAlert.alert=e.data.canUpgrade(t),game.moduleOpen.checkOpen(game.ME.PartnerBreak)&&(e.partnerCurBreakAlert.alert=e.data.canInfoUpgrade(t,game.PartnerUpgradeTypes.BREAK)),game.moduleOpen.checkOpen(game.ME.PartnerStar)&&(e.partnerCurStarAlert.alert=e.data.canStar(t)),game.moduleOpen.checkOpen(game.ME.PartnerAwaken)&&(e.partnerCurAwakenAlert.alert=e.data.canAwaken(t)),game.moduleOpen.checkOpen(game.ME.PartnerSpirit)&&(e.partnerCurJpAlert.alert=e.data.canSpirit(t)),game.moduleOpen.checkOpen(game.ME.PartnerTalent)&&(e.partnerCurTalentAlert.alert=e.data.canTalent(t))}},notify:function(e,t){var a=this;switch(e){case a.Evts.C_SELECTCHANGE:a.data.selectBackInfoById(t),a.checkCurAlert(),a.dpt(a.Evts.C_SELECTCHANGE),a.send(a.Evts.V_SELECTCHANGE),a.send(a.Evts.V_UPDATE_DATA);break;case a.Evts.C_ACTIVE_REQ:a.dpt(a.Evts.C_ACTIVE_REQ,t)}},btn1:function(){this.selectToggle(0)},btn2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)}});var t=[game.ME.PartnerBackList,game.ME.PartnerBackChip];b8e.module.registerControl(game.ME.PartnerBack,e,game.PartnerEvts,null,t),b8e.RC("$$game","$$PartnerBackControl",e)}(),function(){var e;e=game.Control.extends({btn1:function(){this.selectToggle(0)},btn2:function(){this.selectToggle(1)},btn3:function(){this.selectToggle(2)},btn4:function(){this.selectToggle(3)},btn5:function(){this.selectToggle(4)},selectToggle:function(e){this.send(this.Evts.V_TOGGLECHANGE,e)},left_btn:function(){this.send(this.Evts.C_SWITCH_PARTNER,!0),this.dpt(this.Evts.C_SELECTCHANGE)},right_btn:function(){this.send(this.Evts.C_SWITCH_PARTNER,!1),this.dpt(this.Evts.C_SELECTCHANGE)},modelBtn:function(){var e=game.partnerData,t=e.selectBackInfo;t&&(e.showInfo=t,game.module.show(game.ME.PartnerDetails))}}),b8e.module.registerControl(game.ME.PartnerBackOp,e,game.PartnerEvts),b8e.RC("$$game","$$PartnerBackOpControl",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("partnerBack/PartnerBackView"),this.toggles={tab1_select:game.ME.PartnerBackList,tab2_select:game.ME.PartnerBackChip},this.spotAlerts={PARTNER_BACK_TAB_LIST:this.tabBackListAlert,PARTNER_BACK_TAB_CHIP:this.tabBackChipAlert}},tabBackListAlert:function(e){this.skin.red_spot1.active=e.alert},tabBackChipAlert:function(e){this.skin.red_spot2.active=e.alert},onShow:function(){this.toggleSelect(0),this.updateView();var e=game.partnerData;e.selectPartnerInfo=e.selectBackInfo},notify:function(e,t){switch(e){case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t);break;case this.Evts.V_UPDATE_DATA:this.updateView()}},updateView:function(){this.skin.activeCountLab.string=game.Lang.get(53121,game.partnerData.activeCount-1)}});b8e.module.registerView(game.ME.PartnerBack,e)}(),function(){var e=game.View.extends({ctor:function(){this._super("partnerBack/PartnerBackListView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerBackListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.spacingX=0,e.bindEnum=game.ME.PartnerBack,e.addToParent(this.skin.listNode),this.data=game.partnerData},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateList()}},onShow:function(){this.data.selectBackInfoById(0),this.updateList(),this.list.scrollToTop()},updateList:function(){var e=this.data.getPartnerBackList();this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerBackList,e)}(),function(){var e;e=game.ListItem.extends({partnerIcon:null,ctor:function(){this._super("partnerBack/PartnerBackListItem"),this.setSize(601,157)},init:function(){this.partnerIcon=new game.CultivateBaseIcon,this.partnerIcon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+e.breakLv),this.partnerIcon.setData(e),t.lvLab.string=game.Lang.get(53115,e.lv),t.jpLab.string=game.Lang.get(53116,e.jpLv);var a=e.awakenLv%11;t.awakenLab.string=game.Lang.get(53117,e.awakenLv/11>>0,a);for(var i=0;i<6;i++)this.getComponent("starIcon"+(i+1)).active=i<e.star;if(t.shangzhen.active=0!=e.battlePos,t.zhuzhan.active=0!=e.helpPos,t.down_btn.active=!e.backSelect,t.up_btn.active=e.backSelect,t.opNode.active=e.backSelect,t.redPoint.active=e.isBackAlert,e.backSelect){var n=game.partnerData,s=game.moduleOpen.checkOpen(game.ME.PartnerUpgrade),r=game.moduleOpen.checkOpen(game.ME.PartnerBreak),o=game.moduleOpen.checkOpen(game.ME.PartnerStar),g=game.moduleOpen.checkOpen(game.ME.PartnerSpirit),u=game.moduleOpen.checkOpen(game.ME.PartnerTalent),l=game.PartnerAwakenCfg.getData(e.id).activateStar<=e.star;game.ShaderUtil.setGray(t.upgradeBtn,!s),game.ShaderUtil.setGray(t.breakBtn,!r),game.ShaderUtil.setGray(t.starBtn,!o),game.ShaderUtil.setGray(t.jpBtn,!g),game.ShaderUtil.setGray(t.awakenBtn,!l),game.ShaderUtil.setGray(t.tfBtn,!u),t.upgradeLabel.active=!s,t.breakLabel.active=!r,t.starLabel.active=!o,t.jpLabel.active=!g,t.awakenLabel.active=!l,t.upgrad_redPoint.active=n.canUpgrade(e),t.break_redPoint.active=n.canInfoUpgrade(e,game.PartnerUpgradeTypes.BREAK),t.star_redPoint.active=n.canStar(e),t.jp_redPoint.active=n.canSpirit(e),t.awaken_redPoint.active=n.canAwaken(e),t.tf_redPoint.active=n.canTalent(e),s||(t.upgradeLabel.string=game.Lang.get(53118,game.moduleOpen.getOpenLv(game.ME.PartnerUpgrade))),r||(t.breakLabel.string=game.Lang.get(53118,game.moduleOpen.getOpenLv(game.ME.PartnerBreak))),o||(t.starLabel.string=game.Lang.get(53118,game.moduleOpen.getOpenLv(game.ME.PartnerStar))),g||(t.jpLabel.string=game.Lang.get(53118,game.moduleOpen.getOpenLv(game.ME.PartnerSpirit))),t.tfLabel.string=u?"":game.Lang.get(53118,game.moduleOpen.getOpenLv(game.ME.PartnerTalent)),l||(t.awakenLabel.string=game.Lang.get(53131)),this.setSize(601,270)}else this.setSize(601,157);this.layout()},up_btn:function(){this.send(game.PartnerEvts.C_SELECTCHANGE,0)},down_btn:function(){this.send(game.PartnerEvts.C_SELECTCHANGE,this.data.id)},upgradeBtn:function(){game.moduleOpen.checkOpenWithTips(game.ME.PartnerUpgrade)&&(game.partnerData.selectBackInfo=this.data,game.module.showToggle(game.ME.PartnerBackOp,0))},breakBtn:function(){game.moduleOpen.checkOpenWithTips(game.ME.PartnerBreak)&&(game.partnerData.selectBackInfo=this.data,game.module.showToggle(game.ME.PartnerBackOp,1))},starBtn:function(){game.moduleOpen.checkOpenWithTips(game.ME.PartnerStar)&&(game.partnerData.selectBackInfo=this.data,game.module.showToggle(game.ME.PartnerBackOp,2))},jpBtn:function(){game.moduleOpen.checkOpenWithTips(game.ME.PartnerSpirit)&&(game.partnerData.selectBackInfo=this.data,game.module.showToggle(game.ME.PartnerBackOp,3))},tfBtn:function(){game.moduleOpen.checkOpenWithTips(game.ME.PartnerTalent)&&(game.partnerData.selectBackInfo=this.data,game.module.showToggle(game.ME.PartnerBackOp,4))},awakenBtn:function(){var e=this.data,t=game.PartnerAwakenCfg.getData(e.id);t.activateStar>e.star?game.notice.show(51524,t.activateStar):(game.partnerData.awakenInfo=e,game.module.show(game.ME.PartnerAwaken))},icon:function(){game.partnerData.showInfo=this.data,game.module.show(game.ME.PartnerDetails)},clickNode:function(){this.send(game.PartnerEvts.C_SELECTCHANGE,this.data.backSelect?0:this.data.id)}}),b8e.RC("$$game","$$PartnerBackListItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super("partnerBack/PartnerBackChipView")},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerBackChipListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.spacingX=0,e.bindEnum=game.ME.PartnerBack,e.addToParent(this.skin.listNode),this.data=game.partnerData},notify:function(e){switch(e){case this.Evts.V_UPDATE_DATA:this.updateList()}},onShow:function(){this.updateList(),this.list.scrollToTop()},updateList:function(){var e=this.data.getPartnerBackActiveList();this.list.setData(e),this.skin.emptyNode.active=!e||!e.length},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerBackChip,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super("partnerBack/PartnerBackChipListItem"),this.setSize(601,125)},init:function(){this.chipIcon=this.createCostIcon(this.skin.icon)},createCostIcon:function(e){var t=game.GridUtil.createItemIcon();return t.addToParent(e),t},setData:function(e){var t=this.skin,a=e.cfg.chipItems[0];t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.cfg.quality,e.cfg.name)+game.HtmlUtil.getText(game.Color.GREEN," +"+e.breakLv),this.itemInfo=game.ItemUtil.createBaseItemInfo(a.Id,1,this.itemInfo),this.chipIcon.setItemInfo(this.itemInfo,!1,game.IconLayoutEnum.SHOW_NONE);var i=game.itemData.getNumById(a.Id);t.costNum.string=game.Lang.get(a.Num>i?53120:53119,i,a.Num);var n=i/a.Num;n=1<n?1:n,t.pb1.width=266*n,t.gotoBtn.active=i<a.Num,t.activeBtn.active=i>=a.Num},activeBtn:function(){this.send(game.PartnerEvts.C_ACTIVE_REQ,this.data.cfg.id)},gotoBtn:function(){if(this.data&&this.data.cfg.chipItems&&this.data.cfg.chipItems.length){var e=this.data.cfg.chipItems[0],t=game.ItemInfoCfg.getData(e.Id);t&&(game.tipsData.setInfo(t),game.module.show(game.ME.ItemTips))}},clickNode:function(){var e=this.data.cfg.chipItems[0];game.itemData.getNumById(e.Id)<e.Num&&this.gotoBtn()}}),b8e.RC("$$game","$$PartnerBackChipListItem",e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1548),this.toggles={tab1_select:game.ME.PartnerBackUpgrade,tab2_select:game.ME.PartnerBackBreak,tab3_select:game.ME.PartnerBackStar,tab4_select:game.ME.PartnerBackSpirit,tab5_select:game.ME.PartnerBackTalent},this.spotAlerts={PARTNER_BACK_CUR_UPGRADE:this.tabUpgradeAlert,PARTNER_BACK_CUR_BREAK:this.tabBreakAlert,PARTNER_BACK_CUR_STAR:this.tabStarAlert,PARTNER_BACK_CUR_JP:this.tabSpiritAlert,PARTNER_BACK_CUR_TALENT:this.tabTalentAlert}},tabUpgradeAlert:function(e){this.skin.red_spot1.active=e.alert},tabStarAlert:function(e){this.skin.red_spot3.active=e.alert},tabBreakAlert:function(e){this.skin.red_spot2.active=e.alert},tabSpiritAlert:function(e){this.skin.red_spot4.active=e.alert},tabTalentAlert:function(e){this.skin.red_spot5.active=e.alert},init:function(){this.moduleData=game.partnerData,this.initModel({type:game.RoleType.Partner,node:this.skin.modelNode})},notify:function(e,t){switch(e){case this.Evts.C_SWITCH_PARTNER:this.switchPartner(t);break;case this.Evts.V_TOGGLECHANGE:this.toggleSelect(t)}},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=this.moduleData.selectBackInfo;if(t){var a=t.cfg.UIModel;if(t.useSkin){var i=t.skinInfoMap.get(t.useSkin);i&&(a=i.cfg.UIModel)}this.updateModel2(game.RoleType.Partner,a);var n=this.moduleData.backInfoIndex,s=this.moduleData.getPartnerBackList();if(s){var r=s.length;e.right_btn.active=n<r-1,e.left_btn.active=0<n}}},switchPartner:function(e){var t=this.moduleData.backInfoIndex,a=this.moduleData.getPartnerBackList();a&&(t+=e?-1:1,this.moduleData.backInfoIndex=t,this.moduleData.updateSelectInfo(a[t]),this.updateView())},toggleSelect:function(e){if(game.moduleOpen.checkOpenWithTips(this.getToggleIndex(e),!0)){var t=this.getToggleIndex(e)==game.ME.PartnerBackTalent;this.skin.bg1.active=!t,this.skin.bg2.active=t,this.skin.modelNode.y=t?-569:-669,this._super(e)}}});b8e.module.registerView(game.ME.PartnerBackOp,e)}(),function(){var e=game.PartnerUpgradeBaseView.extends({ctor:function(){this._super(1546),this.spotAlerts={PARTNER_BACK_CUR_UPGRADE:this.upgradeAlert}},init:function(){this.progressMaxW=341,this._super()},getPartnerInfo:function(){return game.partnerData.selectBackInfo},onHide:function(){this.data&&this.data.setMainRoleSlotGray(!1)}});b8e.module.registerView(game.ME.PartnerBackUpgrade,e)}(),function(){var e=game.PartnerBreakBaseView.extends({ctor:function(){this._super(1545),this.spotAlerts={PARTNER_BACK_CUR_BREAK:this.upgradeAlert}},getPartnerInfo:function(){return game.partnerData.selectBackInfo}});b8e.module.registerView(game.ME.PartnerBackBreak,e)}(),function(){var e=game.PartnerStarBaseView.extends({ctor:function(){this._super(1544),this.spotAlerts={PARTNER_BACK_CUR_STAR:this.upgradeAlert}},getPartnerInfo:function(){return game.partnerData.selectBackInfo},setCoinPos:function(){var e=this.skin;e.coin1.x=603-e.coinLab1.width}});b8e.module.registerView(game.ME.PartnerBackStar,e)}(),function(){var e=game.PartnerSpiritBaseView.extends({ctor:function(){this._super(1547),this.spotAlerts={PARTNER_BACK_CUR_JP:this.upgradeAlert}},getPartnerInfo:function(){return game.partnerData.selectBackInfo}});b8e.module.registerView(game.ME.PartnerBackSpirit,e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,select:!1,sortId:0,type:0,grade:0,recommend:!1,ctor:function(){this._super()},setData:function(e,t,a){e&&(this.id=e.id,this.type=e.type,this.grade=e.grade,this.sortId=e.sortId,this.select=t,this.recommend=a)},clearData:function(){this.id=0,this.type=0,this.grade=0,this.sortId=0,this.select=!1,this.recommend=!1},recycle:function(){this.reset(),this._super()},reset:function(){this.clearData()}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,16),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MaterialGradeInfo",t)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1550),this.setSize(600,152)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.ShowItemListItem,e.bindEnum=game.ME.InstanceMaterial,e.layout.paddingLeft=0,e.layout.spacingX=40,e.layout.paddingTop=-10,e.addToParent(this.skin.prizeList)},setData:function(){var e=this.data,t=this.skin,a=game.instFuncData.getMaterialCfgById(e.id);if(a){this.createIcon(a.reward),this.skin.diffcultImg.loadTexture(game.ResCfg.getUrl(101,a.grade));var i=this.materialInfo=game.instFuncData.getMatInfoByType(a.type);if(i){t.recommend.active=e.recommend,t.vipSweepNode.active=!1,t.red_spot.active=!1;var n=i.grade>=a.grade,s=a.openLv>game.mainRoleData.lv,r=a.openPower>game.mainRoleData.maxPower;if(!n&&(s||r))return t.canEnter_btn.active=!1,t.cantEnter_btn.active=!0,t.cost_root.active=!1,t.openLvLab.active=!0,t.enter_lab.string=t.enter_lab_1.string=game.Lang.get(50108),void(t.openLvLab.string=s?game.Lang.get(53126,a.openLv):game.Lang.get(53292,game.CCommonUtil.replaceNum(a.openPower,0)));t.openLvLab.active=!1;var o=game.VipCfg.getData(i.vipLv);if(o){var g=o.materialBuyTimes,u=g,l=a.Challengetime-i.useChallCount,c=u-i.useSweepCount;if(a.grade>i.grade)t.cost_root.active=!1,t.canEnter_btn.active=0<l,t.cantEnter_btn.active=l<=0,t.enter_lab_1.string=t.enter_lab.string=game.Lang.get(50108);else if(0<l)t.red_spot.active=!0,t.canEnter_btn.active=!0,t.cantEnter_btn.active=!1,t.cost_root.active=!1,a.grade<=i.grade?t.enter_lab_1.string=t.enter_lab.string=game.Lang.get(50113):t.enter_lab_1.string=t.enter_lab.string=game.Lang.get(50108);else if(0<c)t.canEnter_btn.active=!0,t.cantEnter_btn.active=!1,t.cost_root.active=!0,t.inst_cost_lab.string="X"+a.costNum,t.enter_lab_1.string=t.enter_lab.string=game.Lang.get(50115),t.vipSweepNode.active=!0,t.vipSweepDesc.string=game.Lang.get(50114,c);else{t.cost_root.active=!0,t.inst_cost_lab.string="X"+a.costNum;var h=game.VipCfg.getMaxLv();if(i.vipLv>=h)t.canEnter_btn.active=!1,t.cantEnter_btn.active=!0;else{var m=game.VipCfg.getNextMatTimesVipCfg(g);if(!m)return t.canEnter_btn.active=!1,t.cantEnter_btn.active=!0,void(t.enter_lab_1.string=t.enter_lab.string=game.Lang.get(50115));t.canEnter_btn.active=!1,t.cantEnter_btn.active=!0,t.vipSweepNode.active=!0;var d=m.materialBuyTimes-g;t.vipSweepDesc.string=game.Lang.get(50116,m.vipLv,d)}t.enter_lab_1.string=t.enter_lab.string=game.Lang.get(50108)}}}}},createIcon:function(e){if(!e||e.length<1)this.prizeList.clear();else{this.itemDatas||(this.itemDatas=[]);for(var t=[],a=void 0,i=void 0,n=e.length,s=0;s<n;s++)(i=e[s])&&((a=this.itemDatas[s])||(a=game.ItemUtil.createPrizeInfo(i.Id,i.Num,game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.CIRCLE_SIZE_104),this.itemDatas[s]=a),a.setData(i.Id,i.Num,game.IconLayoutEnum.SHOW_NUM,0,game.IconSizeEnum.CIRCLE_SIZE_104),t.push(a));this.prizeList.setData(t)}},canEnter_btn:function(){if(!game.UpgradeUtil.checkEquipTooMuch()){var e=this.data,t=this.materialInfo;if(t){var a=game.instFuncData.getMaterialCfgById(e.id);if(0<a.Challengetime-t.useChallCount)if(a.grade<=t.grade)this.send(game.InstanceFuncEvts.MAT_QUICK_SWEEP,{id:e.id,count:1});else{if(game.sceneData.isGuildMap())return;this.send(game.InstanceFuncEvts.MAT_CHALL,{id:e.id})}else this.send(game.InstanceFuncEvts.MAT_SWEEP,{id:e.id})}}},cantEnter_btn:function(){if(this.materialInfo){var e=game.instFuncData.getMaterialCfgById(this.data.id);e.openLv>game.mainRoleData.lv?game.notice.show(53297,e.openLv):e.openPower>game.mainRoleData.maxPower&&game.notice.show(53298,e.openPower)}}}),b8e.RC("$$game","$$MaterialGradeItem",e)}(),function(){var e=game.View.extends({matList:null,_showModel:!0,ctor:function(){this._super(1549)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.MaterialGradeItem,e.bindEnum=game.ME.InstanceMaterial,e.addToParent(this.skin.scrollList)},notify:function(e){switch(e){case game.InstanceFuncEvts.C2V_SELECT_GRADE:this.updateList()}},onShow:function(){this.updateList()},onHide:function(){game.instFuncData.clearGradeInfoArr(),this.list.clear()},updateList:function(){var e=game.instFuncData.getGradeInfoArr();this.list.setData(e)}});b8e.module.registerView(game.ME.MaterialGrade,e)}(),function(){var e=game.CultivateBaseModelView.extends({data:null,_showModel:!0,_modelTouchClose:!0,max:6,ctor:function(){this._super(1745)},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500),this.initModel({type:game.RoleType.Partner,node:this.skin.model},{type:game.RoleType.Hero,node:this.skin.model})},onShow:function(){var e=this;e.data=game.partnerBreakData,e.data&&(e.info=e.data.info,e.info&&(e._lightEffect||(e._lightEffect=new game.LightEffect,e._lightEffect.addToParent(e.skin.anima)),e.endTime=game.SysTime.curTime+5e3,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(3e3)),e.timer.reset(),e.timer.start(),e.data&&(e.setStar(),e.setArrtext())))},setArrtext:function(){var e=this.skin,t=this.data.info,a=game.SpriteStatType,i=t.breakSpriteStat,n=game.PartnerTopCfg.getData(t.breakLv);if(n){var s=game.AttrRulesCfg.getData(n.attrId);if(s){this.setStatStr(e.attr_1,a.Attack,i.getStatValue(a.Attack)),this.setStatStr(e.attr_2,a.Defense,i.getStatValue(a.Defense)),this.setStatStr(e.attr_3,a.Health,i.getStatValue(a.Health));var r=1==game.AttrPowerCoefCfg.getData(n.attrId).type?n.attrValue/10+"%":n.attrValue+"";e.skillName.string=game.Lang.get(51430,t.breakLv,s.name,r)}}},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t),s=game.CCommonUtil.replaceNum(a);e.string=game.Lang.get(51448,n.name,s),i&&i.setPosition(e.width+2,3)},setStar:function(){var e=void 0,t=this.data.info;t.isMainRole?this.updateRoleModel():this.updateModel(game.RoleType.Partner,t.cfg);for(var a=0;a<this.max;a++)e=a+1,this.getComponent("starIcon"+e).active=t.star>=e;this.skin.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name)},updateTime:function(){var e=this.endTime-game.SysTime.curTime;if(!this.endTime||e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},onHide:function(){this._lightEffect&&(this._lightEffect.removeFromParent(),this._lightEffect=null),this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.PartnerBackBreakTips,e)}(),function(){var e;e=b8e.Enum({None:0,C2C_SET_FORMATION:-1,V2C_UPDATE_VIEW:-1,C_CHOICE_DIFFICULTY:-1,C_CHALLENGE:-1,C2C_BUFF_SELECT:-1,C2V_GIFTS_UPDATE:-1,C2C_GIFT_MONEY_BUY:-1,C2C_GIFT_POINT_BUY:-1,C2C_RECHARGE:-1,C2V_UPDATE_AWARD:-1,V_ISGET_AWARD:-1,BarbarianResult:-1,CHANGE_RANK_LIST:-1,C_REQ_RANKINFO:-1,V_REQ_RANKINFO:-1,V2C_AWARD_SHOW:-1,C2C_SET_SHOW_AWARD:-1,C2V_PLAY_TWEEN:-1,V2C_PLAY_TWEEN:-1,C2C_CHALLENGE:-1,C2C_SYS_DATA_SUCCEED:-1,C2C_UPDATE_BATTLE:-1}),b8e.RC("$$game","$$BarbarianEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.barbarianData,this.spotAlert=game.spotAlert.set(game.SAE.BARBARIAN,game.SAE.BOSS),this.awardAlert=game.spotAlert.set(game.SAE.BARBARIAN_AWARD,game.SAE.BARBARIAN),this.reSetAlert=game.spotAlert.set(game.SAE.BARBARIAN_RESET,game.SAE.BARBARIAN)},ipc:function(){var e=this;e.evts={Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily,C_RECONNECT_MSIC_DATA:e.reconnect}},e.gevts={InstanceEvts:{G_STOP_PLAY:e.playStop}},e.handels={BarbarianModelResp:e.barbarianModelResp,BarbarianChallengeResp:e.barbarianChallengeResp,BarbarianResetResp:e.barbarianResetResp,BarbarianChoiceBuffResp:e.barbarianChoiceBuffResp,BarbarianPushGiftMsg:e.barbarianPushGiftMsg,BarbarianSweepResp:e.barbarianSweepResp,BarbarianAimsResp:e.barbarianAimsResp,BarbarianBuyDeathGiftResp:e.barbarianBuyDeathGiftResp}},triggerOpen:function(e){e==this.moduleEnum&&this.sender.BarbarianModelReq()},notify:function(e,t){var a=this;switch(e){case a.Evts.C_CHALLENGE:a.senderChallenge(t);break;case a.Evts.C2C_BUFF_SELECT:a.sender.BarbarianChoiceBuffReq(t);break;case a.Evts.C2C_GIFT_MONEY_BUY:a.dpt(a.Evts.C2C_RECHARGE,a.moduleData.selGiftId);break;case a.Evts.C2C_GIFT_POINT_BUY:a.sender.BarbarianBuyDeathGiftReq(a.moduleData.selGiftId);break;case a.Evts.V_ISGET_AWARD:a.senderAimsAward(t);break;case a.Evts.V2C_AWARD_SHOW:a.preShowAward();break;case a.Evts.C2V_PLAY_TWEEN:a.updateView()}},updateView:function(){this.send(this.Evts.V2C_UPDATE_VIEW)},reconnect:function(){this.sender.BarbarianModelReq()},rechargeSuccess:function(e){e&&e.data&&e.data.id==this.moduleData.selGiftId&&(this.moduleData.delGiftMap(1),this.send(this.Evts.C2V_GIFTS_UPDATE))},updateTime:function(){this.clearTime();var e=1e3*this.moduleData.getRemainTime();0<e&&(this.key=b8e.setTimeout(this.tiemEnd,this,e))},clearTime:function(){this.key&&(b8e.clearTimeout(this.key),this.key=null)},tiemEnd:function(){this.clearTime(),this.send(this.Evts.C2V_GIFTS_UPDATE)},senderAimsAward:function(e){this.sender.BarbarianAimsReq(e)},playStop:function(e){if(e){var t=e.data;this.showResultView(t)}},showResultView:function(e){e.type==game.InstanceType.BARBARIAN&&(game.module.show(game.ME.BarbarianResult),this.send(this.Evts.BarbarianResult,e))},resetDaily:function(){this.sender.BarbarianModelReq()},preShowAward:function(){this.preObj||(this.preObj=b8e.createMap()),this.preObj.moduleEnum=this.moduleData.hasBuffSel?game.ME.BarbarianBuffSelect:null,this.preObj.awards=this.moduleData.frontIdLayerItem,this.dpt(this.Evts.C2C_SET_SHOW_AWARD,this.preObj)},isGetBuff:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=this.moduleData.hasBuffSel=e&&0<e.length;a&&game.module.show(game.ME.BarbarianSweep),i&&this.moduleData.setChoiceBuff(e)},layerMopUp_Btn:function(){if(this.moduleData.getIsLayerMopUp()){if(this.moduleData.curChallengeId==this.moduleData.maxCheckpoint)if(this.moduleData.getInfoById(this.moduleData.curChallengeId).isClearance)return void game.notice.show(53246);this.sender.BarbarianSweepReq(1)}else game.notice.show(53245)},fastMopUp_Btn:function(){if(this.moduleData.getIsOneKeySweep()){if(this.moduleData.curChallengeId==this.moduleData.maxCheckpoint)if(this.moduleData.getInfoById(this.moduleData.curChallengeId).isClearance)return void game.notice.show(53246);this.sender.BarbarianSweepReq(2)}else game.notice.show(53245)},reset_btn:function(){var e=this,t=game.BarbarianMiscCfg.getData("barbarianResetTimes");if(t){var a=t.value;if(e.moduleData.resetTimes!=a){var i=e.moduleData.failMaxCount-e.moduleData.failTimes;if(0<i)return e.options||(e.options={lang:53284,btn:game.Lang.get(9059),okcb:e.sureReset,thisArg:e}),e.options.langArgs=i,void game.alert.show(e.options);e.sureReset()}else game.notice.show(53247)}},sureReset:function(){this.sender.BarbarianResetReq()},shop_btn:function(){this.dptG(game.ShopGEvts.SHOW_SHOP,game.ShopIdEnum.BARBARIAN_SHOP)},haoli_btn:function(){game.module.show(game.ME.BarbarianDieGifs)},yulan_btn:function(){game.module.show(game.ME.BarbarianLayerAward)},rank_btn:function(){game.module.show(game.ME.BarbarianRank)},btn_find:function(){game.module.show(game.ME.BarbarianAddAttr)},openDifficultyChoice:function(e){var t=this;if(game.BarbarianMiscCfg.getData("barbarianFailureTimes"))if(t.moduleData.failTimes>=t.moduleData.failMaxCount)game.notice.show(53248);else{var a=t.moduleData.getInfoList();if(2<a.length){if(a[e].id>t.moduleData.curChallengeId)return void game.notice.show(53249);if(a[e].id<t.moduleData.curChallengeId)return void game.notice.show(53250)}if(t.moduleData.curChallengeId==t.moduleData.maxCheckpoint)if(t.moduleData.getInfoById(t.moduleData.curChallengeId).isClearance)return void game.notice.show(53251);t.moduleData.setDifficultyList(),game.module.show(game.ME.BarbarianDifficulty)}},senderChallenge:function(e){var t=this.moduleData.curChallengeId;this.dpt(this.Evts.C2C_SET_FORMATION,[game.ME.Barbarian,t,this.sender.BarbarianChallengeReq,[e],this])},monModel_btn1:function(){this.openDifficultyChoice(0)},monModel_btn2:function(){this.openDifficultyChoice(1)},monModel_btn3:function(){this.openDifficultyChoice(2)},item_btn:function(){game.module.show(game.ME.BarbarianAwardPreview)},okBtn:function(){game.module.hide(game.ME.BarbarianSweep)},layerGetBtn:function(){game.module.hide(game.ME.BarbarianLayerGet)},details_btn:function(){game.module.show(game.ME.BattleDetails)},barbarianModelResp:function(e){var t=this,a=e.readProtobuf(game.pb.BarbarianDataResponse);0<a.code?game.notice.noticeError(a.code):(t.moduleData.initData(a),t.moduleData.setData(),t.updateTime(),t.checkAlert(),t.checkResetAlert(),t.send(t.Evts.V2C_UPDATE_VIEW),t.send(t.Evts.C2V_GIFTS_UPDATE),t.dpt(t.Evts.C2C_SYS_DATA_SUCCEED))},barbarianChallengeResp:function(e){var t=this,a=e.readProtobuf(game.pb.BarbarianChallengeResponse);if(0<a.code)game.notice.noticeError(a.code);else{if(t.moduleData.setCritMap2(t.moduleData.curChallengeId,a.crit),t.moduleData.frontIdLayerItem=a.layerItem,t.moduleData.isPlayBack=!1,a.battlelog){a.battlelog.win=a.success;var i=a.battlelog.win,n={type:game.InstanceType.BARBARIAN,isWin:i,rewards:a.userItem,exp:a.exp};game.playBack.play(a.battlelog,n),t.moduleData.isPlayBack=!0}a.success?(t.moduleData.setDifMapData(t.moduleData.curChallengeId,a.choice),t.moduleData.frontId++,t.moduleData.lastLayerStar=t.moduleData.getCurStar(),t.moduleData.curChallengeId<t.moduleData.maxCheckpoint&&t.moduleData.curChallengeId++,t.isGetBuff(a.buffIds),a.battlelog||(t.battleInfo||(t.battleInfo={},t.battleInfo.win=!0,t.battleInfo.type=game.InstanceType.BARBARIAN),game.module.hide(game.ME.PlayBackFormation),game.module.hide(game.ME.BarbarianDifficulty),game.notice.show(game.Lang.get(53271)),t.showResultView(t.battleInfo))):t.moduleData.failTimes++,t.checkAlert(),t.send(t.Evts.V2C_UPDATE_VIEW),t.dpt(t.Evts.C2C_CHALLENGE),t.dpt(t.Evts.C2C_UPDATE_BATTLE)}},barbarianResetResp:function(e){var t=e.readProtobuf(game.pb.BarbarianResetResponse);0<t.code?game.notice.noticeError(t.code):this.sender.BarbarianModelReq()},barbarianChoiceBuffResp:function(e){var t=e.readProtobuf(game.pb.BarbarianChoiceBuffResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateBuffData(t.buffId),this.changeData(),game.module.show(game.ME.BarbarianCloudTween))},barbarianPushGiftMsg:function(e){var t=e.readProtobuf(game.pb.BarbarianGift);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setDieGifsData(t.gift),this.moduleData.setEndTime(t.giftEndTime),this.updateTime(),this.send(this.Evts.C2V_GIFTS_UPDATE))},barbarianSweepResp:function(e){var t=this,a=e.readProtobuf(game.pb.BarbarianSweepResponse);0<a.code?game.notice.noticeError(a.code):(t.moduleData.setSweepData(a),t.isGetBuff(a.buffIds,!0),t.moduleData.frontId<t.moduleData.maxCheckpoint?t.moduleData.curChallengeId=t.moduleData.frontId+1:t.moduleData.curChallengeId=t.moduleData.frontId,(2==a.oper||a.buffIds.length<1)&&(t.moduleData.setData(),t.send(t.Evts.V2C_UPDATE_VIEW)))},barbarianAimsResp:function(e){var t=e.readProtobuf(game.pb.BarbarianAimsResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.BarbarianAimsCfg.getData(t.num);a&&(this.moduleData.setIsGet(t.num),game.awardsData.setItemsByArray(a.award,!0),game.module.show(game.ME.AwardShowTip),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_AWARD))}},barbarianBuyDeathGiftResp:function(e){var t=e.readProtobuf(game.pb.BarbarianBuyDeathGiftResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.delGiftMap(2),this.send(this.Evts.C2V_GIFTS_UPDATE))},checkAlert:function(){var e=game.barbarianData.getAimsAwardList();if(e){for(var t=e.length,a=!1,i=this.moduleData.histStar,n=0;n<t;n++){var s=e[n];if(!s.isGet)if(s.canGet)a=!0;else{if(i<s.num)break;i>=s.num&&(a=s.canGet=!0)}}this.awardAlert.alert=a}},checkResetAlert:function(){game.moduleOpen.checkOpenWithTips(game.ME.Boss,!1)?this.reSetAlert.alert=this.moduleData.resetTimes<1:this.reSetAlert.alert=!1},changeData:function(){this.moduleData.getInfoById(this.moduleData.curChallengeId)||(this.moduleData.lastLayerStar=this.moduleData.getCurStar(),this.moduleData.setData())}}),t=[game.ME.BarbarianLayerAward,game.ME.BarbarianDifficulty,game.ME.BarbarianAddAttr,game.ME.BarbarianSweep,game.ME.BarbarianBuffSelect,game.ME.BarbarianDieGifs,game.ME.BarbarianAwardPreview,game.ME.BarbarianResult,game.ME.BarbarianLayerGet,game.ME.BarbarianCloudTween],a=game.Sender.extends({ipc:function(){this.msg={BarbarianModelReq:null,BarbarianChallengeReq:this.barbarianChallengeReq,BarbarianResetReq:null,BarbarianChoiceBuffReq:this.barbarianChoiceBuffReq,BarbarianSweepReq:this.barbarianSweepReq,BarbarianAimsReq:this.barbarianAimsReq,BarbarianBuyDeathGiftReq:this.barbarianBuyDeathGiftRequest}},barbarianChallengeReq:function(e){var t=game.pb.BarbarianChallengeRequest;t.choice=e,this.write(t)},barbarianChoiceBuffReq:function(e){var t=game.pb.BarbarianChoiceBuffRequest;t.buffId=e,this.write(t)},barbarianSweepReq:function(e){var t=game.pb.BarbarianSweepRequest;t.oper=e,this.write(t)},barbarianAimsReq:function(e){var t=game.pb.BarbarianAimsRequest;t.num=e,this.write(t)},barbarianBuyDeathGiftRequest:function(e){var t=game.pb.BarbarianBuyDeathGiftRequest;t.giftId=e,this.write(t)}});b8e.module.registerControl(game.ME.Barbarian,e,game.BarbarianEvts,a,t)}(),function(){var e=game.Control.extends({ipc:function(){this.evts={Rank:{C_UPDATE_DATA:this.updateRankInfo}}},notify:function(e){switch(e){case this.Evts.V_REQ_RANKINFO:this.reqRankInfo()}},reqRankInfo:function(){this.dpt(this.Evts.C_REQ_RANKINFO,game.RankType.BarbarianWeek),this.dpt(this.Evts.C_REQ_RANKINFO,game.RankType.BarbarianHistory)},updateRankInfo:function(){this.send(this.Evts.CHANGE_RANK_LIST,0)},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},btn_3:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.CHANGE_RANK_LIST,e)}});b8e.module.registerControl(game.ME.BarbarianRank,e,game.BarbarianEvts)}(),function(){var e;e=b8e.Object.extends({startRank:0,endRank:0,awards:null,rankName:"",prizeListInfo:null,setData:function(e){this.startRank=e.startRank,this.endRank=e.endRank,this.awards=e.award,this.rankName=e.rankName,this.prizeListInfo=game.CfgUtil.getPrizeListInfo(this.awards,null,game.IconSizeEnum.GRID_SIZE_84)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BarbarianAwardRankInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,leftSection:0,rightSection:0,awards:null,setData:function(e){this.id=e.id,this.leftSection=e.leftSection,this.rightSection=e.rightSection,this.awards=e.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BarbarianLayerAwardInfo",e)}(),function(){var e;e=b8e.Object.extends({num:0,awards:null,isGet:!1,canGet:!1,prizeListInfo:null,setData:function(e){this.awards=e.award,this.num=e.num,this.prizeListInfo=game.CfgUtil.getPrizeListInfo(this.awards,null,game.IconSizeEnum.GRID_SIZE_84)},setComplete:function(){this.isGet=!0,this.canGet=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BarbarianAimsRewardInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:"",id:0,buffType:0,buffNum:0,baseNum:0,buffName:0,costStar:0,quality:0,icon:0,attrType:0,setData:function(e){var t=this;t.name=e.name,t.id=e.id,t.buffType=e.buffType,t.baseNum=.1*e.buffNum,t.buffName=e.buffName,t.costStar=e.costStar,t.quality=e.quality,t.icon=e.icon,t.attrType=e.attrType,t.setBuffNum(e.buffNum)},setBuffNum:function(e){this.buffNum+=.1*e},recycle:function(){this.reset(),this._super()},reset:function(){this.name="",this.id=0,this.buffType=0,this.buffNum=0,this.buffName=0,this.costStar=0,this.quality=0,this.icon=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$BarbarianBuffInfo",t)}(),function(){var e=b8e.Object.extends({frontId:0,curId:0,resetTimes:0,failTimes:0,buffs:null,currDif:null,histDif:null,aims:null,thisStar:0,weekStar:0,histStar:0,useStar:0,failMaxCount:0,curChallengeId:0,curAwardLayer:0,maxCheckpoint:0,curLayer:0,layerItem:null,sweepShowNum:0,sweepCostStar:0,sweepGetStar:0,isOneKey:!1,selGiftId:0,frontIdLayerItem:null,lastLayerStar:0,sweepStartId:0,hasBuffSel:!1,isPlayBack:!0,maxLayer:0,maxClearId:0,ctor:function(){var e=this;e.barbarianMap=b8e.HashMap.get(),e.buffMap=b8e.HashMap.get(),e.currDifMap=b8e.HashMap.get(),e.histDifMap=b8e.HashMap.get(),e.buffArr=[],e.difficultyMap=b8e.HashMap.get(),e.layerAwardArr=[],e.aimsRewardMap=b8e.HashMap.get(),e.critMap=b8e.HashMap.get(),e.giftsMap=b8e.HashMap.get(),e.layerItem=[],e.awardRankArr=[]},initData:function(e){var t=this;t.frontId=e.id,t.resetTimes=e.resetTimes,t.failTimes=e.failTimes,t.buffs=e.buffs,t.histDif=e.histDif,t.currDif=e.currDif,t.aims=e.aims,t.thisStar=e.thisStar,t.weekStar=e.weekStar,t.histStar=e.histStar,t.useStar=e.useStar,t.setDieGifsData(e.gifts),t.setEndTime(e.giftEndTime);var a=game.BarbarianMiscCfg.getData("barbarianFailureTimes");a&&(t.failMaxCount=a.value);var i=game.BarbarianMiscCfg.getData("maxCheckpoint");i&&(t.maxCheckpoint=i.value),t.curChallengeId=t.frontId==t.maxCheckpoint?t.maxCheckpoint:t.frontId+1,(a=game.BarbarianMiscCfg.getData("barbarianSweepShow"))&&(t.sweepShowNum=+a.value),t.setCurrDifData(),t.setHistDifData(),t.initAimsRewardData(),t.setAimsAwardData(),t.setBuffsData()},canUseStar:{get:function(){return this.thisStar-this.useStar}},setData:function(){var e=this,t=e.getLayerCfg(e.curChallengeId);if(t){var a=t.length;if(t.sort(e._sort),!(a<1)){var i=e.getInfoList();0<i.length&&e.clearList(i,e.barbarianMap);for(var n=void 0,s=0;s<a;s++){var r=t[s];(n=game.BarbarianDataInfo.get()).setData(r),e.barbarianMap.set(r.id,n);var o=e.currDifMap.get(r.id);if(o){n.isClearance=!0,n.difficulty=o;var g=game.BarbarianDifficultyCfg.getData(r.id,o);g&&(n.stars=r.boss?g.bossStar:g.generalStar)}0!=e.curChallengeId||n.isClearance||(e.curChallengeId=r.id),e.curLayer=r.layer}}}},setDieGifsData:function(e){if(this.giftsMap.clear(),this.nextEndTime=0,e&&!(e.length<1)){for(var t=e,a=t.length,i=void 0,n=void 0,s=0;s<a;s++)i=game.BarbarianDieGifsInfo.get(),n=t[s],i.setData(n),this.giftsMap.set(i.giftId,i);this.nextEndTime=t[0].endTime}},setEndTime:function(e){this.nextEndTime=e},delGiftMap:function(e){this.giftsMap.del(this.selGiftId);var t=void 0;1==e?t=game.BarbarianGiftCfg.getData(this.selGiftId):2==e&&(t=game.BarbarianDeathGiftCfg.getData(this.selGiftId)),t&&t.giveItems&&(game.awardsData.setItemsByArray(t.giveItems),game.module.show(game.ME.AwardShowTip))},getGiftList:function(){return this.giftsMap.values()},isShowGiftBtn:function(){return!(this.getGiftList().length<=0)&&!(this.getRemainTime()<=0)},getRemainTime:function(){return this.nextEndTime-game.SysTime.unixTime},setSweepData:function(e){var t=this;t.sweepStartId=t.frontId,t.frontId=e.id,t.layerItem=e.layerItem,t.setCritMap(e.crit),t.sweepCostStar=0,t.sweepGetStar=0,t.isOneKey=e.oper&&2==e.oper;var a=void 0,i=void 0,n=void 0;if(t.isOneKey){t.addBuffsData(e.buffs),t.useStar+=e.costStar,t.sweepCostStar=e.costStar;for(var s=t.sweepStartId+1;s<=t.frontId;s++)a=game.BarbarianDifficultyCfg.getData(s,3),i=(n=game.BarbarianCfg.getDataById(s)).boss?a.bossStar:a.generalStar,t.thisStar+=i,t.sweepGetStar+=i,t.currDifMap.set(s,3);t.weekStar=Math.max(t.thisStar,t.weekStar)}else{for(var r=t.getLayerCfg(t.frontId),o=r.length,g=0;g<o;g++)(n=r[g]).id<=t.sweepStartId||(a=game.BarbarianDifficultyCfg.getData(n.id,3),i=n.boss?a.bossStar:a.generalStar,t.thisStar+=i,t.sweepGetStar+=i,t.currDifMap.set(g+1,3));t.weekStar=Math.max(t.thisStar,t.weekStar)}},setCritMap:function(e){if(this.critMap.clear(),e)for(var t=e.length,a=void 0,i=0;i<t;i++)a=e[i],this.critMap.set(a.id,a.crit)},setCritMap2:function(e,t){this.critMap.set(e,t)},getConditionStr:function(e){var t=game.BarbarianCfg.getDataById(e);if(t){var a=void 0;return 0<t.roundLimit&&(a=game.Lang.get(53230,t.roundLimit)),0<=t.deathLimit&&(a?a+=","+game.Lang.get(53231,t.deathLimit):a=game.Lang.get(53231,t.deathLimit)),a=a||game.Lang.get(53232)}},setCurrDifData:function(){if(this.currDif){this.currDifMap.clear();var e=this.currDif.length;if(!(e<1))for(var t=0;t<e;t++){var a=this.currDif[t];this.currDifMap.set(a.id,a.difficulty)}}},setDifMapData:function(e,t){var a=this;a.currDifMap.set(e,t);var i=0,n=game.BarbarianCfg.getDataById(e),s=game.BarbarianDifficultyCfg.getData(e,t);n&&(a.maxLayer=n.layer>a.maxLayer?n.layer:a.maxLayer,a.maxClearId=n.id>a.maxClearId?n.id:a.maxClearId,s&&(i=n.boss?s.bossStar:s.generalStar)),a.thisStar+=i,a.weekStar=Math.max(a.thisStar,a.weekStar),a.histStar=a.weekStar>a.histStar?a.weekStar:a.histStar;var r=a.barbarianMap.get(e);r&&(r.isClearance=!0,r.difficulty=t,r.stars=i)},setHistDifData:function(){if(this.histDif){this.histDifMap.clear();var e=this.histDif.length;if(!(e<1))for(var t=0;t<e;t++){var a=this.histDif[t];this.histDifMap.set(a.id,a.difficulty);var i=game.BarbarianCfg.getDataById(a.id);i&&(i.layer>this.maxLayer&&(this.maxLayer=i.layer),i.id>this.maxClearId&&(this.maxClearId=i.id))}}},getIsLayerMopUp:function(){var e=this.getInfoList();if(!e)return!1;var t=e.length;if(t<1)return!1;for(var a=0;a<t;a++){var i=e[a];if(!(i.id<this.curChallengeId)&&(this.histDifMap.get(i.id)||0)<3)return!1}return!0},getIsOneKeySweep:function(){return!((this.histDifMap.get(this.curChallengeId)||0)<3)},setDifficultyList:function(){var e=game.BarbarianCfg.getDataById(this.curChallengeId);if(e)for(var t=0;t<3;t++){var a=t+1,i=game.BarbarianDifficultyCfg.getData(e.id,a),n=this.difficultyMap.get(a);n||(n=new game.BarbarianDifficultyInfo,this.difficultyMap.set(a,n)),n.id=e.id,n.isBoss=e.boss,n.difficulty=a,n.power=e.power*i.powerRate,n.goldCoin=e.goldCoin[t],n.warriorSpot=e.warriorSpot[t]}},getDifficultyList:function(){return this.difficultyMap.values()},_sort:function(e,t){return e.id-t.id},setCurChallengeId:function(e){this.curChallengeId=e},getLayerCfg:function(e){var t=game.BarbarianCfg.getDataById(e);if(t)return game.BarbarianCfg.getListByLayer(t.layer).sort(this._sort)},getInfoList:function(){return this.barbarianMap.values()},getInfoById:function(e){return this.barbarianMap.get(e)},setBuffsData:function(){if(this.buffs){var e=this.buffMap.values();0<e.length&&this.clearList(e,this.buffMap);for(var t=this.buffs.length,a=0;a<t;a++){var i=this.buffs[a],n=game.BarbarianBuffCfg.getData(i.buffId);if(n){var s=this.buffMap.get(n.attrType);s?s.setBuffNum(n.buffNum):((s=game.BarbarianBuffInfo.get()).setData(n),this.buffMap.set(n.attrType,s))}}}},addBuffsData:function(e){if(e)for(var t=e.length,a=void 0,i=0;i<t;i++){a=e[i];var n=game.BarbarianBuffCfg.getData(a.buffId);if(n){var s=this.buffMap.get(n.attrType);s?s.setBuffNum(n.buffNum):((s=game.BarbarianBuffInfo.get()).setData(n),this.buffMap.set(n.attrType,s))}}},updateBuffData:function(e){var t=game.BarbarianBuffCfg.getData(e);if(t){var a=t.attrType,i=this.buffMap.get(a);i?i.setBuffNum(t.buffNum):((i=game.BarbarianBuffInfo.get()).setData(t),this.buffMap.set(a,i)),this.useStar+=t.costStar,this.sweepCostStar=t.costStar}},setChoiceBuff:function(e){if(e){var t=e.length;if(!(t<1)){var a=void 0;this.clearList(this.buffArr);for(var i=this.buffArr.length=0;i<t;i++){var n=e[i],s=game.BarbarianBuffCfg.getData(n);s&&((a=game.BarbarianBuffInfo.get()).setData(s),this.buffArr.push(a))}}}},getBuffInfoList:function(){return this.buffMap.values()},initAimsRewardData:function(){var e=game.BarbarianAimsCfg.getDatas();if(e){var t=e.length,a=void 0;this.aimsRewardMap.clear();for(var i=0;i<t;i++){var n=e[i];(a=new game.BarbarianAimsRewardInfo).setData(n),this.aimsRewardMap.set(n.num,a)}}},setAimsAwardData:function(){if(this.aims){var e=this.aims.length;if(!(e<1)){for(var t=void 0,a=0;a<e;a++){var i=this.aims[a];(t=this.getAimsAwardInfo(i))&&t.setComplete()}var n=this.getAimsAwardList();n&&n.sort(this.aimsRewarSort)}}},setIsGet:function(e){var t=this.getAimsAwardInfo(e);if(t){t.setComplete();var a=this.getAimsAwardList();a&&a.sort(this.aimsRewarSort)}},getAimsAwardList:function(){return this.aimsRewardMap.values()},getAimsAwardInfo:function(e){return this.aimsRewardMap.get(e)},isGet:function(){var e=this.getAimsAwardList();if(!e)return!1;var t=e.length;if(t<1)return!1;for(var a=0;a<t;a++)if(!e[a].isGet)return!1;return!0},aimsRewarSort:function(e,t){return e.isGet==t.isGet?e.canGet==t.canGet?e.num-t.num:e.canGet?-1:1:e.isGet?1:t.isGet?-1:void 0},getLayerAward:function(){var e=this;if(e.curAwardLayer==e.curLayer)return e.layerAwardArr;e.curAwardLayer=e.curLayer;var t=game.BarbarianLayerAwardCfg.getData(e.curLayer,!0);if(!t)return 0;for(var a=t.length,i=void 0,n=0;n<a;n++){var s=t[n];(i=e.layerAwardArr[n])||(i=new game.BarbarianLayerAwardInfo,e.layerAwardArr.push(i)),i.setData(s)}return e.layerAwardArr.sort(e._sort),e.layerAwardArr},getCurStar:function(){for(var e=this.getInfoList(),t=e.length,a=0,i=0;i<t;i++){a+=e[i].stars}return a},getAwardRank:function(){if(0<this.awardRankArr.length)return this.awardRankArr;var e=game.BarbarianRankCfg.getDatas();if(!e)return 0;for(var t=e.length,a=0;a<t;a++){var i=e[a],n=new game.BarbarianAwardRankInfo;n.setData(i),this.awardRankArr.push(n)}return this.awardRankArr.sort(this._rankSort),this.awardRankArr},_rankSort:function(e,t){return e.startRank-t.startRank},clearList:function(e,t){for(var a=1<arguments.length&&void 0!==t?t:null,i=0,n=e.length;i<n;i++)e[i].release();a&&a.clear()}});game.barbarianData=game.barbarianData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({cfg:null,id:0,layer:0,stars:0,isClearance:!1,difficulty:0,setData:function(e){e&&(this.cfg=e,this.id=e.id,this.layer=e.layer)},recycle:function(){this.reset(),this._super()},reset:function(){this.cfg=null,this.id=0,this.layer=0,this.stars=0,this.isClearance=!1,this.difficulty=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$BarbarianDataInfo",t)}(),function(){var e;e=b8e.Object.extends({id:0,isBoss:!1,difficulty:0,power:0,goldCoin:0,warriorSpot:0}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$BarbarianDifficultyInfo",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1572)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.BarbarianDifficultyItem,e.bindEnum=game.ME.Barbarian,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){this.skin.huawen_3.width=b8e.stageWidth+100,this.skin.huawen_1.width=b8e.stageWidth+100,this.skin.gray.setSize(b8e.stageWidth+50,530);var e=game.barbarianData.curChallengeId,t=game.BarbarianCfg.getDataById(e);if(t){this.skin.condition.string=game.barbarianData.getConditionStr(e),this.skin.title.string="d"+t.id+"g",this.skin.fightAmountLbl.string=game.mainRoleData.power;var a=game.barbarianData.getDifficultyList();this.list.setData(a)}}});b8e.module.registerView(game.ME.BarbarianDifficulty,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1573),this.setSize(540,115)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.PrizeListItem,this.awardList.addToParent(this.skin.list)},setData:function(e){var t=game.CfgUtil.getPrizeListInfo(e.awards,null,game.IconSizeEnum.CIRCLE_SIZE_84);t&&this.awardList.setData(t.items),this.skin.num.string=game.Lang.get(53261,e.leftSection)}}),b8e.RC("$$game","$$BarbarianLayerAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1574)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.BarbarianLayerAwardItem,e.bindEnum=game.ME.Barbarian,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){this.skin.num.string=game.Lang.get(53260,game.barbarianData.getCurStar());var e=game.barbarianData.getLayerAward();this.list.setData(e)}});b8e.module.registerView(game.ME.BarbarianLayerAward,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1564)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.BarbarianAddAttrItem,e.layout.spacingY=40,e.layout.paddingLeft=20,e.layout.paddingTop=20,e.bindEnum=game.ME.Barbarian,e.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.barbarianData.getBuffInfoList();this.list.setData(e)}});b8e.module.registerView(game.ME.BarbarianAddAttr,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1571),this.setSize(225,350)},setData:function(e){var t=this.skin,a=game.BarbarianDifficultyCfg.getData(e.id,e.difficulty);t.star.string=e.isBoss?game.Lang.get(53262,a.bossStar):game.Lang.get(53262,a.generalStar),t.yongshi_dian.string=game.Lang.get(53263,e.warriorSpot);var i=game.ResCfg.getUrl(10191,"bg_"+e.difficulty);t.bg.loadTexture(i),t.jinbi.string=game.Lang.get(53264,e.goldCoin),t.power.string=game.Lang.get(53265,game.CCommonUtil.replaceNum(e.power))},btnChallenge:function(){this.send(game.BarbarianEvts.C_CHALLENGE,this.data.difficulty)}}),b8e.RC("$$game","$$BarbarianDifficultyItem",e)}(),function(){var e;e=game.Widget.extends({index:0,ctor:function(e){this._super(1580),this.bindEnum=e},init:function(){},onShow:function(){this.updateView()},setIndex:function(e){this.index=e,this.updateView()},updateView:function(){var e=this;if(e.index){var t=e.skin;if(t){t.layerLab.string=game.Lang.get(53188,e.index);var a=game.BarbarianCfg.getDataById(e.index);if(a){var i=a.hardAward;if(i&&!(i.length<1)){var n=void 0,s=void 0,r=1,o=void 0,g="",u=game.barbarianData.critMap.get(e.index);if(1<u){var l=game.BarbarianCritCfg.getData(u);l&&(g=game.Lang.get(2==u?53190:53191),r=l.rate)}n=i[0].Id,s=Math.floor(i[0].Num*r),e.amountIcon1||(e.amountIcon1=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42),e.amountIcon1.addToParent(e.skin.amountIcon1)),o=game.ItemInfoCfg.getData(n),e.skin.awardLab1.string=game.Lang.get(53189,o.name),e.amountIcon1.setItemInfo(n,s+g,game.Color.BLACK,24,!1,!1),e.skin.amountIcon1.x=e.skin.awardLab1.x+e.skin.awardLab1.width+26,n=i[1].Id,s=Math.floor(i[1].Num*r),e.amountIcon2||(e.amountIcon2=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42),e.amountIcon2.addToParent(e.skin.amountIcon2)),o=game.ItemInfoCfg.getData(n),e.skin.awardLab2.string=game.Lang.get(53189,o.name),e.amountIcon2.setItemInfo(n,s+g,game.Color.BLACK,24,!1,!1),e.skin.amountIcon2.x=e.skin.awardLab2.x+e.skin.awardLab2.width+26}}}}}}),b8e.RC("$$game","$$BarbarianSweepItem",e)}(),function(){var e=game.View.extends({itemList:null,maxLayer:0,_showModel:!0,ctor:function(){this._super(1581)},init:function(){this.itemList=[],this.gridList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.gridList.itemRender=game.PrizeListItem,this.gridList.addToParent(this.skin.awardList),this.gridList.layout.spacingX=12,this.gridList.layout.spacingY=12,this.gridList.layout.paddingLeft=0},onShow:function(){var e=this;e.skin.okBtn.active=!1,e.skin.endItem.active=!1,e.moduleData=game.barbarianData,e.nextY=0,e.showItemCount=0,e.maxLayer=e.moduleData.frontId,e.index=e.moduleData.sweepStartId,e.showNum=e.moduleData.sweepShowNum,e.skin.itemSc.height=e.skin.view.height=470,e.timer||(e.timer=b8e.Timer.add(e,e.showItem,500)),e.prizeInfo||(e.prizeInfo=new game.CfgPrizeInfo(game.IconLayoutEnum.SHOW_NUM,game.IconSizeEnum.GRID_SIZE_84)),e.prizeInfo.setup2(e.moduleData.layerItem);var t=e.prizeInfo.items;e.setListPos(t.length),e.gridList.setData(t),e.skin.descLab.string=game.Lang.get(53192,e.moduleData.sweepGetStar)+(e.moduleData.isOneKey?game.Lang.get(53269,e.moduleData.sweepCostStar):"")},setListPos:function(e){var t=.5*(540-100*Math.min(e,5));this.skin.awardList.x=t},showItem:function(){var e=this,t=void 0;if(e.index<e.maxLayer){if(e.showItemCount>=e.showNum)return e.updateIndex(),e.index++,void e.showItemCount++;(t=e.itemList[e.index])||(t=new game.BarbarianSweepItem(game.ME.BarbarianSweep),e.itemList.push(t)),t.setIndex(e.index+1),t.addToParent(e.skin.item),t.y=e.nextY,e.nextY=t.y-156,e.skin.content.height=-e.nextY,470<-e.nextY&&e.skin.itemSc._scrollView.scrollToBottom()}else e.skin.itemSc.height=e.skin.view.height=212,212<-e.nextY&&e.skin.itemSc._scrollView.scrollToBottom(),e.skin.endItem.active=!0,e.skin.okBtn.active=!0,e.clearTimer();e.index++,e.showItemCount++},updateIndex:function(){for(var e=this.itemList.length,t=0;t<e;t++)this.itemList[t].setIndex(this.index-e+2+t)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.showItem),this.timer=null)},removeItem:function(){for(var e=this.itemList.length,t=void 0,a=0;a<e;a++)(t=this.itemList[a]).parent&&t.removeFromParent()},onHide:function(){this.timer&&this.clearTimer(),this.removeItem(),game.barbarianData.hasBuffSel&&game.module.show(game.ME.BarbarianBuffSelect)}});b8e.module.registerView(game.ME.BarbarianSweep,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1565),this.setSize(540,169)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Grid),this.awardList.itemRender=game.PrizeListItem,this.awardList.addToParent(this.skin.awardList)},setData:function(e){var t=this.skin;t.canGet_Btn.active=e.canGet,t.isGet.active=e.isGet,t.name.string=game.Lang.get(53267,e.num),t.isCanGet.active=!e.canGet&&!e.isGet,this.awardList.setData(e.prizeListInfo.items)},canGet_Btn:function(){this.send(game.BarbarianEvts.V_ISGET_AWARD,this.data.num)}}),b8e.RC("$$game","$$BarbarianAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1566)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.BarbarianAwardItem,e.bindEnum=game.ME.Barbarian,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_AWARD:this.updateList()}},onShow:function(){this.list.scrollToTop(),this.updateList(),this.skin.starLab.string=game.Lang.get(53286,game.barbarianData.histStar)},updateList:function(){var e=game.barbarianData.getAimsAwardList();this.list.setData(e)}});b8e.module.registerView(game.ME.BarbarianAwardPreview,e)}(),function(){var e=game.View.extends({_modelList:null,cloudTween:null,ctor:function(){this._super(1582),this.spotAlerts={BARBARIAN_AWARD:this.awardAlert,BARBARIAN_RESET:this.reSetAlert}},awardAlert:function(e){this.skin.redPoint1.active=e.alert},reSetAlert:function(e){this.skin.redPoint2.active=e.alert},init:function(){this._modelList=[];for(var e=0;e<3;++e){var t=b8e.SceneEntity.get();t.addToParent(this.getComponent("monModel_"+e)),this._modelList.push(t)}this.icon=game.GridUtil.createItemIcon(game.IconSizeEnum.CIRCLE_SIZE_84),this.icon.addToParent(this.skin.item_icon);var a=this.anim=b8e.Animator.get(game.AnimType.UI_EFFECT,2);a.addToParent(this.skin.anim),a.load(game.ResCfg.getUrl(5019,1127)),a.play(null,0),this.moduleData=game.barbarianData},notify:function(e){switch(e){case this.Evts.V2C_UPDATE_VIEW:this.updateView();break;case this.Evts.C2V_GIFTS_UPDATE:this.updateGiftBtn();break;case this.Evts.C2V_UPDATE_AWARD:this.updateAward()}},onShow:function(){this.updateView(),this.updateGiftBtn()},updateView:function(){var e=this,t=e.skin;e.skin.usable_starNum.string=e.moduleData.canUseStar+")",t.layer.string=e.moduleData.curLayer+"c",t.failCount.string=game.Lang.get(53252,e.moduleData.failTimes),t.curLayer.string=game.Lang.get(53253,e.moduleData.curLayer),t.curPrestige.string=game.Lang.get(53256,game.amount.get(game.AmountType.WARRIOR)),t.curGetNum.string=e.moduleData.thisStar+"",t.weekHighestNum.string=e.moduleData.weekStar+"";var a=e.moduleData.getBuffInfoList();t.not_lab.active=a.length<1,t.attr_node.active=0<a.length,t.cur_attr1.string=a[0]?game.Lang.get(a[0].buffName,a[0].buffNum):"",t.cur_attr2.string=a[1]?game.Lang.get(a[1].buffName,a[1].buffNum):"";var i=game.BarbarianMiscCfg.getData("barbarianResetTimes");if(i){var n=i.value;t.reset_lab.string=game.Lang.get(53254,n-e.moduleData.resetTimes),e.updateMonsterList()}},updateMonsterList:function(){var s=this;s.clearAnim(),s.setClearance();var t=s.moduleData.getInfoList(),e=t[0]&&t[0].cfg.boss;s.moduleData.failTimes>=s.moduleData.failMaxCount?(s.skin.bg_1.active=!1,s.skin.is_battle.active=!1,s.skin.bubbleNode.active=!0,s.skin.bubbleLab.string=game.Lang.get(53287,s.moduleData.thisStar)):(s.skin.bg_1.active=!0,s.skin.is_battle.active=!0,s.skin.bubbleNode.active=!1);for(var a=t.length,i=0,n=function(e){var n=t[e];s.moduleData.curChallengeId==n.id&&(i=e),s.getComponent("clearance_"+e).active=n.isClearance,s.getComponent("monModel_btn"+(e+1)).active=!0,n.isClearance&&s.setStar(n,e),s._modelList[e].active=!n.isClearance,e<s._modelList.length&&game.CfgUtil.getMonsterCfgByMonGroup(n.cfg.monsterGroup,1,function(i){return function(e){var t=game.AvatarUtil;s.moduleData.curChallengeId==n.id&&(s.skin.name.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),s.skin.shut.string=game.Lang.get(53255,n.id));var a=t.getUIModel(e,1,!1);s.setAnim(game.ResCfg.getUrl(5e3,a),s._modelList[i])}}(e),s)},r=0;r<a;r++)n(r);s.setPosition(a,i),s.skin.boss_bg.active=e,s.skin.bg.active=!e,s.updateAward()},setStar:function(e,t){for(var a=0;a<3;a++){var i=a+1;this.getComponent("starIcon"+t+"_"+a).active=e.difficulty>=i,this.getComponent("star_lab"+a).active=e.difficulty>=i&&e.cfg.boss}},updateAward:function(){var e=this.skin,t=game.barbarianData.getAimsAwardList();if(t){var a=t[0],i=a.awards;if(i&&!(i.length<1)){this.moduleData.isGet()?(e.received.active=!0,e.aims_lab.active=!1):(e.received.active=!1,e.aims_lab.active=!0),this.skin.aims_lab.string=a.canGet?game.Lang.get(52357):game.Lang.get(53268,a.num);var n=i[0],s=game.ItemUtil.createBaseItemInfo(n.Id,n.Num,null);game.GridUtil.setItemIcon(this.icon,s,!1,game.IconLayoutEnum.SHOW_NUM)}}},setClearance:function(){for(var e=0;e<3;e++)this.getComponent("clearance_"+e).active=!1,this.getComponent("monModel_btn"+(e+1)).active=!1},updateGiftBtn:function(){this.skin.haoli_btn.active=this.moduleData.isShowGiftBtn()},setAnim:function(e,t){var a;e?((a=(a=t.getAnimator(game.AnimType.BODY,1))||t.addAnimator(game.AnimType.BODY,1)).load(e),a.play()):a&&a.clear()},setPosition:function(e,t){var a=this.skin;switch(e){case 1:a.monModel_0.x=322,a.is_battle.x=327,a.bg_1.x=329,a.clearance_0.x=327,a.monModel_btn1.x=254,a.bubbleNode.x=337;break;case 3:a.monModel_0.x=134,a.clearance_0.x=135,a.monModel_btn1.x=60,0==t&&(a.is_battle.x=132,a.bg_1.x=137,a.bubbleNode.x=142),1==t&&(a.is_battle.x=327,a.bg_1.x=329,a.bubbleNode.x=337),2==t&&(a.is_battle.x=520,a.bg_1.x=523,a.bubbleNode.x=530)}},onHide:function(){this.clearAnim()},clearAnim:function(){for(var e,t=0;t<this._modelList.length;++t)(e=this._modelList[t].getAnimator(game.AnimType.BODY,1))&&e.clear()}});b8e.module.registerView(game.ME.Barbarian,e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1568)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.BarbarianBuffSelectItem,e.bindEnum=game.ME.Barbarian,e.layout.spacingX=4,e.layout.paddingLeft=0,e.addToParent(this.skin.list)},onShow:function(){this.updateView()},updateView:function(){this.skin.numLab.string=game.barbarianData.canUseStar+")";var e=game.barbarianData.buffArr;this.list.setData(e)}});b8e.module.registerView(game.ME.BarbarianBuffSelect,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){var e=this;e._super(1567),e.setSize(174,256),b8e.evt.onTouchStart(e,e.showImg,e),b8e.evt.onTouchCancel(e,e.hideImg,e),b8e.evt.onTouchEnd(e,e.hideImg,e)},init:function(){this.skin.showImg.active=!1},showImg:function(){this.skin.showImg.active=!0},hideImg:function(){this.skin.showImg.active=!1},setData:function(e){this.data=e;var t=this.skin;t.showImg.active=!1,t.numLab.string=this.data.costStar+"";var a=this.data.quality;t.skillBg.loadTexture(game.ResCfg.getUrl(10176,a)),t.skillIcon.loadTexture(game.ResCfg.getUrl(10177,this.data.icon));var i=game.AttrRulesCfg.getData(this.data.attrType);t.skillName.string=i?i.name:"",t.skillValue.string=game.HtmlUtil.getText(game.HtmlUtil.getColorByQuality(a),game.Lang.get(53238,this.data.baseNum))},selectBtn:function(){this.data.costStar>game.barbarianData.canUseStar?game.notice.show(game.Lang.get(53239)):(this.send(game.BarbarianEvts.C2C_BUFF_SELECT,this.data.id),game.module.hide(game.ME.BarbarianBuffSelect))}}),b8e.RC("$$game","$$BarbarianBuffSelectItem",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({giftType:0,giftId:0,endTime:0,setData:function(e){this.giftType=e.giftType,this.giftId=e.giftId,this.endTime=e.endTime}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$BarbarianDieGifsInfo",t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1570)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.BarbarianDieGifsItem,e.bindEnum=game.ME.Barbarian,e.layout.spacingY=10,e.layout.paddingLeft=0,e.addToParent(this.skin.list)},onShow:function(){game.barbarianData.getRemainTime()<=0?game.module.hide(game.ME.BarbarianDieGifs):(this.createTimer(),this.updateList())},onHide:function(){this.clearTimer()},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=game.barbarianData.getRemainTime();if(e<=0)this.closeView();else{var t=b8e.TimeUtil.formatTime(1e3*e);this.skin.timeLab.string=game.Lang.get(51304,t)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},notify:function(e){switch(e){case this.Evts.C2V_GIFTS_UPDATE:this.updateList()}},updateList:function(){var e=game.barbarianData.getGiftList();this.list.setData(e),e.length<1&&this.closeView()},closeView:function(){game.module.hide(game.ME.BarbarianDieGifs)}});b8e.module.registerView(game.ME.BarbarianDieGifs,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1569),this.setSize(540,241)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.PrizeListItem,this.awardList.layout.spacingX=30,this.awardList.addToParent(this.skin.list)},setData:function(e){var t=this;t.data=e,t.skin.moneyBtn.active=1==t.data.giftType,t.skin.pointBtn.active=2==t.data.giftType;var a=void 0;if(1==t.data.giftType){a=game.BarbarianGiftCfg.getData(t.data.giftId);var i=game.RechargeCfg.getDataById(t.data.giftId);i&&(t.skin.moneyLab.string=game.Lang.get(1701,i.money))}else 2==t.data.giftType&&(a=game.BarbarianDeathGiftCfg.getData(t.data.giftId))&&(t.skin.pointLab.string=a.cost+"");a&&(a.giveItems&&(a.prizeInfo||(a.prizeInfo=game.CfgUtil.getPrizeListInfo(a.giveItems,null,game.IconSizeEnum.GRID_SIZE_105)),t.awardList.setData(a.prizeInfo.items)),t.skin.bgImg.loadTexture(game.ResCfg.getUrl(10186,a.type)))},moneyBtn:function(){game.barbarianData.selGiftId=this.data.giftId,this.send(game.BarbarianEvts.C2C_GIFT_MONEY_BUY)},pointBtn:function(){game.barbarianData.selGiftId=this.data.giftId,this.send(game.BarbarianEvts.C2C_GIFT_POINT_BUY)}}),b8e.RC("$$game","$$BarbarianDieGifsItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1563),this.setSize(160,22)},setData:function(e){this.skin.attr_lab.string=game.Lang.get(e.buffName,e.buffNum)}}),b8e.RC("$$game","$$BarbarianAddAttrItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1579)},init:function(){this.failList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.failList.itemRender=game.InstanceSuccessItme,this.failList.bindEnum=game.ME.InstanceSuccess,this.failList.layout.spacingX=50,this.failList.layout.spacingY=50,this.failList.layout.paddingLeft=50,this.failList.addToParent(this.skin.failList)},notify:function(e,t){switch(e){case this.Evts.BarbarianResult:this.data=t,b8e.hasTimeout(this.showView,this)||b8e.setTimeout(this.showView,this,100)}},onShow:function(){this.active=!1},showView:function(){var e=this,t=e.data;t?(e.active=!0,e.isWin=t.win,e.type=t.type,e.skin.huawen_3.width=b8e.stageWidth+100,e.skin.huawen_1.width=b8e.stageWidth+100,e.skin.gray.width=b8e.stageWidth+100,e.skin.details_btn.active=game.barbarianData.isPlayBack,e.isWin?e.showWin(t):e.showFailed(t),e.timer?(e.timer.reset(),e.timer.start()):e.timer=b8e.Timer.add(e,e.updateTime,1e3),e.enter=10):game.module.hide(e.moduleEnum)},updateTime:function(){this.enter--,this.enter<=0?game.module.hide(game.ME.BarbarianResult):this.skin.timeLab.string=game.Lang.get(51407,this.enter)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},showWin:function(){var e=this;e.showId=game.barbarianData.frontId;var t=e.skin;t.failedNode.active=!1,t.winNode.active=!0,e.skin.light.active=!0,e.isLayerAward=!1,e.isBuff=!1;for(var a=game.barbarianData.currDifMap.get(e.showId)||1,i=1;i<=3;i++)e.getComponent("starIcon"+i).active=i<=a;t.targetLab.string=game.Lang.get(53225,game.barbarianData.getConditionStr(e.showId));var n=game.BarbarianCfg.getDataById(e.showId);if(n){e.isLayerAward=!!n.award,e.isBuff=!!n.buff;var s=void 0;if(1==a?s=n.simpleAward:2==a?s=n.generalAward:3==a&&(s=n.hardAward),s&&!(s.length<1)){var r=void 0,o=void 0,g=1,u="",l=game.barbarianData.critMap.get(e.showId);if(1<l){var c=game.BarbarianCritCfg.getData(l);c&&(u=game.Lang.get(2==l?53190:53191),g=c.rate)}r=s[0].Id,o=Math.floor(s[0].Num*g),e.amountIcon1||(e.amountIcon1=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42),e.amountIcon1.addToParent(e.skin.amount1)),e.amountIcon1.setItemInfo(r,o+u,game.Color.WHITE,24,!1,!1),r=s[1].Id,o=Math.floor(s[1].Num*g),e.amountIcon2||(e.amountIcon2=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42),e.amountIcon2.addToParent(e.skin.amount2)),e.amountIcon2.setItemInfo(r,o+u,game.Color.WHITE,24,!1,!1),game.TweenUtil.rotationEffect(e.skin.light),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeVictory)}}},showFailed:function(){this.showId=game.barbarianData.curChallengeId,this.skin.winNode.active=!1,this.skin.failedNode.active=!0,this.skin.light.active=!1,this.skin.targetLab2.string=game.Lang.get(53226,game.barbarianData.getConditionStr(this.showId)),this.skin.failLab.string=game.Lang.get(53285,game.barbarianData.failMaxCount-game.barbarianData.failTimes),this.changeTargetsPos()},changeTargetsPos:function(){var e=game.InstanceSuccessCfg.getData(this.type);game.instanceSuccessData.setData(e);var t=game.instanceSuccessData.getFailList();this.failList.setData(t)},onHide:function(){this.clearTimer();var e=this.skin;e.winNode.active=!1,e.failedNode.active=!1,b8e.Tween.kill(e.light),this.send(this.Evts.V_ON_NIEW_HIDE),b8e.sound.stopAllEffectSound(),this.isWin&&(this.isLayerAward?game.module.show(game.ME.BarbarianLayerGet):this.isBuff&&game.module.show(game.ME.BarbarianBuffSelect))},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth;this.setPosition(.5*(t-this.width),.5*(e+this.height)+100)}});b8e.module.registerView(game.ME.BarbarianResult,e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1575)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.bindEnum=game.ME.BarbarianLayerGet,e.layout.spacingX=40,e.layout.paddingLeft=0,e.addToParent(this.skin.list)},onShow:function(){this.updateView()},updateView:function(){var e=game.barbarianData.lastLayerStar;this.skin.descLab2.string=game.Lang.get(53236,e),this.prizeListInfo?this.prizeListInfo.setup2(game.barbarianData.frontIdLayerItem):this.prizeListInfo=game.CfgUtil.getPrizeListInfo2(game.barbarianData.frontIdLayerItem,game.IconLayoutEnum.SHOW_ALL,game.IconSizeEnum.GRID_SIZE_105);var t=this.prizeListInfo.items;this.list.setData(t),this.setListPos(t.length)},setListPos:function(e){var t=.5*(600-(129*Math.min(e,4)-29));this.skin.list.x=Math.max(t,40)},onHide:function(){this.send(this.Evts.V2C_AWARD_SHOW)}});b8e.module.registerView(game.ME.BarbarianLayerGet,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1577),this.setSize(540,107)},setData:function(){this.onClear();var e=this.data;if(e){var t=this.skin;t.rank.node.active=3<e.rank,t.rank.string=e.rank+"",t.name.string=e.name;var a=e.rank;if(3<a){this.skin.rank4.node.active=!0}else this.getComponent("rank"+a).node.active=!0;game.RankType.BarbarianWeek==e.ocId?t.score.string=game.Lang.get(53257,e.score):t.score.string=game.Lang.get(53259,e.score)}else;},onClear:function(){this.skin;for(var e=1;e<5;e++){this.getComponent("rank"+e).node.active=!1}}}),b8e.RC("$$game","$$BarbarianRankItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1576),this.setSize(540,125)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Grid),this.awardList.itemRender=game.PrizeListItem,this.awardList.addToParent(this.skin.list)},setData:function(e){this.onClear(),e.startRank<=3?this.getComponent("rank"+e.startRank).node.active=!0:this.skin.rank.string=game.Lang.get(53244,e.startRank,e.endRank),this.awardList.setData(e.prizeListInfo.items)},onClear:function(){for(var e=1;e<4;e++){this.getComponent("rank"+e).node.active=!1}}}),b8e.RC("$$game","$$BarbarianRankAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1578)},init:function(){var e=this.weekRankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.BarbarianRankItem,e.bindEnum=game.ME.BarbarianRank,e.addToParent(this.skin.weekRankList);var t=this.weekAwardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.BarbarianRankAwardItem,t.bindEnum=game.ME.BarbarianRank,t.addToParent(this.skin.weekAwardList);var a=this.histRankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.BarbarianRankItem,a.bindEnum=game.ME.BarbarianRank,a.addToParent(this.skin.histRankList),this.moduleData=game.barbarianData},notify:function(e,t){switch(e){case this.Evts.CHANGE_RANK_LIST:this.updateRankList(t)}},onShow:function(){this.send(this.Evts.V_REQ_RANKINFO)},updateRankList:function(e){var t=this,a=t.skin;if(a.toggle_btn_1.active=0==e,a.toggle_btn_2.active=1==e,a.toggle_btn_3.active=2==e,a.weekRankList.active=0==e,a.weekAwardList.active=1==e,a.histRankList.active=2==e,a.des.string=game.Lang.get(53240),0==e){var i=game.rankData.getRankInfoArrByType(game.RankType.BarbarianWeek);t.weekRankList.setData(i);var n=game.rankData.getSelfRankInfo(game.RankType.BarbarianWeek);t.skin.rank_my.string=0==n.rank?game.Lang.get(9069):game.Lang.get(53241,n.rank),t.skin.maxStar_lab.string=game.Lang.get(53242,n.score)}if(1==e){var s=t.moduleData.getAwardRank();t.weekAwardList.setData(s);n=game.rankData.getSelfRankInfo(game.RankType.BarbarianWeek);t.skin.rank_my.string=0==n.rank?game.Lang.get(9069):game.Lang.get(53241,n.rank),t.skin.maxStar_lab.string=game.Lang.get(53242,n.score)}if(2==e){i=game.rankData.getRankInfoArrByType(game.RankType.BarbarianHistory);t.histRankList.setData(i);n=game.rankData.getSelfRankInfo(game.RankType.BarbarianHistory);t.skin.rank_my.string=0==n.rank?game.Lang.get(9069):game.Lang.get(53241,n.rank),t.skin.maxStar_lab.string=game.Lang.get(53243,n.score)}}});b8e.module.registerView(game.ME.BarbarianRank,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1583)},onShow:function(){this.startAnim()},startAnim:function(){var e=this.skin;e.yun_node1.active=!0,e.yun_node2.active=!0,b8e.Tween.kill(e.yun_node1),b8e.Tween.kill(e.yun_node2),b8e.Tween.get(e.yun_node1).to({x:760},350),b8e.Tween.get(e.yun_node2).to({x:-890},350).call(this.stopCentre,this)},stopCentre:function(){var e=this.skin;b8e.Tween.get(e.yun_node1).wait(350),b8e.Tween.get(e.yun_node2).wait(350).call(this.stopFallback,this)},stopAnim:function(){var e=this.skin;e.yun_node1.active=!1,e.yun_node2.active=!1,b8e.Tween.kill(e.yun_node1),b8e.Tween.kill(e.yun_node2),game.module.hide(game.ME.BarbarianCloudTween)},stopFallback:function(){var e=this.skin;b8e.Tween.get(e.yun_node1).to({x:0},350),b8e.Tween.get(e.yun_node2).to({x:0},350).call(this.stopAnim,this),this.send(this.Evts.C2V_PLAY_TWEEN)}});b8e.module.registerView(game.ME.BarbarianCloudTween,e)}(),function(){var e;e=b8e.GameConfig.extends({obj1:null,obj2:null,ctor:function(){this._super()},onInited:function(){this.obj1={id:0},this.obj2={layer:0}},getListByLayer:function(e){return this.obj2.layer=e,this.getData(this.obj2,!0)},getDataById:function(e){return this.obj1.id=e,this.getData(this.obj1)}}),b8e.RC("$$game","$$BarbarianCfg",e)}(),function(){var e;e=b8e.Enum({C2V_UPDATE_TIPS:b8e.enc(),V2C_ON_HIDE:b8e.enc(),V2C_BAN_TODAY_ID:b8e.enc(),C2C_ENTER_GUILD_CONFLICT:b8e.enc()}),b8e.RC("$$game","$$LoadActiveShowEvts",e)}(),function(){var e=b8e.Object.extends({nextShowCfg:null,showNext:!0,ctor:function(){this.showArr=[]},setData:function(e){this.banPushIds=e.banPushIds},checkShowArr:function(){var e=game.LoadActiveShowCfg.getDatas(),t=this.showArr;if(t.length=0,!e||e.length<1)return t;for(var a=e.length,i=void 0,n=0;n<a;n++)i=e[n],this.checkShow(i)&&t.push(i);t&&t.length&&t.sort(this._sort)},_sort:function(e,t){return e.sortId-t.sortId},checkShow:function(e){if(-1<this.banPushIds.indexOf(e.id))return!1;if(e.id==game.LoadActiveShowType.GUILD_CONFLICT)return game.guildConflictData.checkIsOpen();if(game.mainRoleData.lv<e.lv)return!1;if(e.startTime){var t=game.SysTime.curTime,a=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd hh:mm:ss").getTime();a=1e3*(a/1e3>>0);var i=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime();if(i=1e3*(i/1e3>>0),t<a||i<=t)return!1;var n=game.TimeUtil.getOpenDayByStr(e.startTime);return n>=e.serverStart&&n<e.serverEnd}var s=game.miscData.openServerDay;return!(s<e.serverStart||e.serverEnd<=s)&&!this.isBuy(e.id)},isBuy:function(e){var t=!1,a=game.LoadActiveShowType;switch(e){case a.DAILY_GIFT:t=game.dayOrWeekGiftData.isBuyAnyDayGift();break;case a.FUND:t=game.fundData.isPurchased();break;case a.MONTH_CARD:var i=game.rechargeData.getCardInfoByType(game.CardType.MONTH);t=i&&i.expireTime>game.SysTime.curTime;break;default:t=!1}return t},canShowView:function(){var e=this.showArr;return e&&e.length},setNextShowCfg:function(){var e=this.showArr;(e||e.length)&&(this.nextShowCfg=e.shift())},getCountDown:function(){var e=0;if(!this.nextShowCfg)return e;var t=this.nextShowCfg.serverEnd,a=game.miscData.openServerDay;return e=b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,t-a)-game.SysTime.curTime},showTodayView:function(e){this.todayAlertId=e;var t=this.banPushIds;return(!t||t.length<1||t.indexOf(e)<0)&&(game.module.show(game.ME.TodayAlert),!0)}});game.loadActiveShowData=game.loadActiveShowData||new e}(),function(){var e;e=b8e.Enum({NONE:0,DAILY_GIFT:1,KUANG_HUAN:2,FUND:3,MONTH_CARD:4,KUANG_HUAN2:5,FIX_SELECT_RECRUIT:6,GUILD_CONFLICT:10}),b8e.RC("$$game","$$LoadActiveShowType",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.loadActiveShowData},initShowView:function(){this.isLoadOpen=game.moduleOpen.checkOpen(this.moduleEnum),this.isLoadOpen?this.isHaveShow||(this.isHaveShow=!0,b8e.setTimeout(this.showView,this,1500)):game.gamePopupMgr.show(game.ME.GuajiTips)},ipc:function(){var e=this;e.evts={DayOrWeekGift:{C2C_CLOSR_ACT:e.hideAct},OpenSerCarnival:{C2C_CLOSR_ACT:e.hideAct},Recharge:{C2C_CLOSR_ACT:e.hideAct},FundMain:{C2C_CLOSR_ACT:e.hideAct},GuildConflictMain:{C2C_CLOSR_ACT:e.hideAct}},e.gevts={SceneGEvts:{FIRST_ENTER_SCENE:e.initShowView}},e.handels={BanPushResp:e.onBanPushResp}},onBanPushResp:function(e){var t=e.readProtobuf(game.pb.BanPushResponse);0<t.code&&game.notice.noticeError(t.code)},notify:function(e,t){switch(e){case this.Evts.V2C_ON_HIDE:this.onHideView(t);break;case this.Evts.V2C_BAN_TODAY_ID:this.data.banPushIds&&-1==this.data.banPushIds.indexOf(t)&&this.sender.BanPushReq(t)}},showView:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.data.checkShowArr(),this.openOneView())},openOneView:function(){this.data.canShowView()?game.gamePopupMgr.show(this.moduleEnum):game.gamePopupMgr.show(game.ME.GuajiTips)},hideAct:function(){b8e.setTimeout(this.openOneView,this,200)},onHideView:function(e){var t=this.data;t.showNext?b8e.setTimeout(this.openOneView,this,200):t.showNext=!0;var a=this.data.nextShowCfg;a&&a.id&&(-1==t.banPushIds.indexOf(a.id)&&e&&this.sender.BanPushReq(a.id),t.nextShowCfg=null)},gotoBtn:function(){var e=this.data.nextShowCfg;if(this.data.showNext=!1,game.module.hide(this.moduleEnum),e){if(e.id==game.LoadActiveShowType.GUILD_CONFLICT&&this.dpt(this.Evts.C2C_ENTER_GUILD_CONFLICT),0<e.openServerType){this.obj||(this.obj={});var t=this.obj;return t.openServerType=e.openServerType,void b8e.evt.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,t)}game.module.showToggle(e.moduleEnum,e.toggle)}},notShowBtn:function(){this.send(this.Evts.C2V_UPDATE_TIPS)}}),t=[game.ME.TodayAlert],a=game.Sender.extends({ipc:function(){this.msg={BanPushReq:this.banPushReq}},banPushReq:function(e){var t=game.pb.BanPushRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.LoadActiveShow,e,game.LoadActiveShowEvts,a,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1562)},init:function(){var e=this.skin;this.data=game.loadActiveShowData;var t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.layout.paddingLeft=20,t.layout.paddingTop=0,t.layout.spacingX=30,t.bindEnum=this.moduleEnum,t.addToParent(e.prizeList)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_TIPS:var t=this.skin.check;t.active=!t.active}},onShow:function(){this.data.setNextShowCfg(),this.updateView(),this.skin.check.active=!1},updateView:function(){var e=this.skin,t=this.data.nextShowCfg;if(t){if(e.bg.loadTexture(game.ResCfg.getUrl(10187,t.bg)),e.bg.setPosition(t.bgPos.X,t.bgPos.Y),e.prizeList.active=t.isList,t.isList){var a=t.award;if(!a||a.length<1)return;var i=game.IconLayoutEnum.SHOW_NONE,n=game.IconSizeEnum.GRID_SIZE_105;a=game.CfgUtil.getPrizeListInfo(a,i,n).items,this.prizeList.setData(a),e.prizeList.setPosition(t.listPos.X,t.listPos.Y)}e.timeNode.active=t.isShowTime,t.isShowTime&&this.createTimer()}},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=this.data.getCountDown();e<1?this.clearTimer():this.skin.timeLab.string=game.TimeUtil.formatTimeSpace(e,3)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer(),this.send(this.Evts.V2C_ON_HIDE,this.skin.check.active)}});b8e.module.registerView(game.ME.LoadActiveShow,e)}(),function(){var e;e=b8e.Enum({None:0,SWITCH_PAGE:-1,C2V_UPDATE_VIEW:-1,C2V_UPDATE_VIEW2:-1,C_SELECT_BTN:-1,C_BTN_ITEM_SELECT:-1,V2C_UPDATE_VIEW:-1,V_REQ_RANKINFO:-1,UPDATE_RANKVIEW:-1,C_REQ_RANKINFO:-1,C2C_UPDATE_SCORE:-1}),b8e.RC("$$game","$$MapAchieveEvts",e)}(),function(){var e=game.Control.extends({lockBol:!0,init:function(){this.recruitMapAlert=game.spotAlert.set(game.SAE.MAP_ACHIEVE,game.SAE.MY_MAP),this.moduleData=game.mapAchieveData,this.isInit=!1,this.lockBol=!1,this.countDownTime=0},ipc:function(){var e=this;e.evts={Back:{C_BACK_UPDATE_ITEMINFO:e.updateItemInfo,C_BACK_SYN_BACK_INFO:e.updateItemInfo},Partner:{C_INIT_DATA:e.updateListData,C_UPDATE_ACTIVE:e.updateActive},PartnerUpgrade:{V_UPDATE_LV:e.updateLv},PartnerStar:{V_UPDATE_STAR:e.updateStar},Rank:{C_UPDATE_DATA:e.updateRankInfo}},e.handels={IconAchUpgradeResp:e.iconAchUpgradeResp}},updateItemInfo:function(){this.isInit&&(this.checkAlert(),this.send(this.Evts.C2V_UPDATE_VIEW2))},updateActive:function(e){this.moduleData.setActive(e.data),this.dpt(this.Evts.C2C_UPDATE_SCORE),this.checkAlert()},updateListData:function(e){var t=e.data;this.isInit||this.moduleData.initData(),this.moduleData.setData(t.iconData),this.dpt(this.Evts.C2C_UPDATE_SCORE),this.checkAlert(),this.isInit=!0},updateLv:function(e){var t=e.data;this.moduleData.setUpLv(t.id,t),this.dpt(this.Evts.C2C_UPDATE_SCORE),this.send(this.Evts.C2V_UPDATE_VIEW)},checkAlert:function(){var e=this.moduleData.getList();if(e){for(var t=e.length,a=void 0,i=!1,n=0;n<t;n++)(a=e[n]).checkAlert(),a.alert&&!i&&(i=!0);game.moduleOpen.checkOpenWithTips(game.ME.MapAchieve,!1)||(i=!1),this.recruitMapAlert.alert=i}},updateStar:function(e){var t=e.data;t.id&&(this.moduleData.setUpStarLv(t.id),this.checkAlert(),this.dpt(this.Evts.C2C_UPDATE_SCORE),this.send(this.Evts.C2V_UPDATE_VIEW))},notify:function(e,t){switch(e){case this.Evts.V2C_UPDATE_VIEW:case this.Evts.C_SELECT_BTN:this.updateView(t);break;case this.Evts.SEND_ACT_DATA:this.sender.IconAchUpgradeReq(t);break;case this.Evts.V_REQ_RANKINFO:this.reqRankInfo()}},reqRankInfo:function(){this.dpt(this.Evts.C_REQ_RANKINFO,game.RankType.IconAch)},updateRankInfo:function(){this.send(this.Evts.UPDATE_RANKVIEW)},updateView:function(e){this.moduleData.selectId=e||1,this.send(this.Evts.C2V_UPDATE_VIEW,!0)},iconAchUpgradeResp:function(e){var t=e.readProtobuf(game.pb.IconAchUpgradeResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setAchUpLv(t.id,t),game.FightAmount.inst().showTeamStatPower(),this.send(this.Evts.C2V_UPDATE_VIEW),this.dpt(this.Evts.C2C_UPDATE_SCORE),this.checkAlert())},btn_rank:function(){game.module.show(game.ME.MapAchieveRank)},btn_allAttr:function(){game.module.show(game.ME.MapAchieveAllAttr)},btn_level:function(){game.module.show(game.ME.MapAchieveLevel)},iconShow:function(){var e=this.moduleData.lvupItemId;game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips)},btn_receive:function(){var e=this.moduleData.canlvUpData;e.maxStar||this.lockBol||(this.lockBol=!0,game.module.show(game.ME.MapAchieveLvPop),this.sender.IconAchUpgradeReq(e.id),this.createCountDown())},createCountDown:function(){this.timer||(this.countDownTime=0,this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime++,1<=this.countDownTime&&(this.lockBol=!1,this.clearCountDown())}}),t=[game.ME.MapAchieveRank,game.ME.MapAchieveLvUp,game.ME.MapAchieveLvPop,game.ME.MapAchieveLevel,game.ME.MapAchieveAllAttr,game.ME.MapAchieveActivaSucc,game.ME.MapAchieveValuePop],a=game.Sender.extends({ipc:function(){this.msg={IconAchUpgradeReq:this.iconAchUpgradeReq}},iconAchUpgradeReq:function(e){var t=game.pb.IconAchUpgradeRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.MapAchieve,e,game.MapAchieveEvts,a,t)}(),function(){var e=b8e.Object.extends({selectId:0,partners:null,starBox:null,allAchNum:0,succInfo:null,lvupInfo:null,lvupItemId:null,canlvUpData:null,idAry:null,attrAll:null,isfisrtValue:!0,isSecendValue:!0,isValueAry:null,showNum:0,countDownTime:0,ctor:function(){this.idAry=[],this.isValueAry=[],this.elementMap=b8e.HashMap.get()},initData:function(){var e=game.PartnerMiscCfg.getData("elementMax");if(e){for(var t=void 0,a=void 0,i=0;i<e.value;i++)a=i+1,0==i&&(this.selectId=a),(t=new game.MapAchieveInfo).element=a,this.elementMap.set(a,t),t.initData();this.attrAll=[];var n=game.IconAchCfg.getDatas();if(n)for(var s=n.length,r=void 0,o=0;o<s;o++)(r=new game.MapAchieveAllInfo).initData(n[o]),this.attrAll.push(r)}},setData:function(e){if(e){var t=e.length,a=void 0,i=void 0;this.idAry=[];for(var n=0;n<t;n++)1!=(i=e[n]).id&&((a=this.getItmeInfo(i.id)).active=!0,a.setData(i),this.idAry.push(i.id));this.setAchNum()}},setAchNum:function(){for(var e=this,t=e.idAry.length,a=void 0,i=void 0,n=e.attrAll.length,s=0,r=0,o=e.allAchNum=0;o<t;o++)a=e.getItmeInfo(e.idAry[o]),i=e.getAchById(a.id,a.starLv),e.allAchNum+=i;if(e.isfisrtValue){for(var g=0;g<n;g++)s=e.attrAll[g].cfg.maxValue,e.allAchNum>=s&&e.isValueAry.indexOf(s)<0&&e.isValueAry.push(s);e.isfisrtValue=!1}if(!e.isSecendValue&&e.allAchNum>=e.attrAll[0].cfg.maxValue)for(var u=0;u<n;u++)if(e.allAchNum>=e.attrAll[u].cfg.minValue-1&&e.allAchNum<e.attrAll[u].cfg.maxValue&&(r=e.attrAll[u].cfg.minValue-1,e.isValueAry.indexOf(r)<0)){e.isValueAry.push(r),e.showNum=r,e.createCountDown();break}e.isSecendValue=!1},createCountDown:function(){this.timer||(this.countDownTime=0,this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime++,b8e.module.isShowView(game.ME.MapAchieveLvPop)||b8e.module.isShowView(game.ME.MapAchieveActivaSucc)||(game.module.show(game.ME.MapAchieveValuePop),this.clearCountDown()),13<=this.countDownTime&&this.clearCountDown()},getBox:function(){var e=this.getSelectInfo(),t=game.PartnerBoxCfg.getData(e.element,!0);if(!t)return null;for(var a=t.length,i=0;i<a;i++)if(e.isGetstar<t[i].star)return t[i];return null},setAchUpLv:function(e,t){var a=this.getItmeInfo(e);a&&(this.idAry.indexOf(e)<0&&this.idAry.push(e),a.active||(a.active=!0),a.starLv=t.star,this.setAchNum(),a.updataValue())},setUpLv:function(e,t){var a=this.getItmeInfo(e);a&&(a.lv=t.lv,a.exp=t.exp)},setUpStarLv:function(e){var t=this.getItmeInfo(e);if(t){t.partStar+=1,t.setUpStar(t.starLv);var a=game.PartnerStarCfg.getData(e,t.partStar-1),i=0<t.partStar?t.speed-a.clientSpeed:t.speed;this.setInfoStar(e,i)}},setInfoStar:function(e,t){var a=this.getElemenInfo(e);a&&(a.allStar+=1,a.allSpeed+=t)},setActive:function(e){var t=this.getItmeInfo(e);t&&(t.lv=1,t.setActive())},getElemenInfo:function(e){var t=game.PartnerCfg.getData(e);return t?this.getInfo(t.element):null},getAchById:function(e,t){return game.IconAchStarCfg.getData(e,t).value},getAchAllValue:function(){return this.attrAll},getidAry:function(){return this.idAry},getList:function(){return this.elementMap.values()},getInfo:function(e){return this.elementMap.get(e)},getSelectInfo:function(){return this.elementMap.get(this.selectId)},getQualityList:function(){return this.getSelectInfo().getList()},getItmeList:function(e){return this.getSelectInfo().getInfo(e).getList()},getItmeInfo:function(e){var t=game.PartnerCfg.getData(e);return t?this.getInfo(t.element).getInfo(t.quality).getInfo(t.id):null},getElementCfg:function(e){this.obj||(this.obj={});var t=this.obj;return t.element=e,game.PartnerCfg.getData(t,!0)},getQualityCfg:function(e,t){this.gObj||(this.gObj={});var a=this.gObj;return a.element=e,a.quality=t,game.PartnerCfg.getData(a,!0)}});game.mapAchieveData=game.mapAchieveData||new e}(),function(){var e;e=b8e.Object.extends({element:0,alert:!1,cfg:null,isGetstar:0,allStar:0,select:!1,allSpeed:0,boxAlert:!1,ctor:function(){this.qualityMap=b8e.HashMap.get()},initData:function(){this.cfg=game.partnerMapData.getElementCfg(this.element),this.cfg&&this.setinfoData()},setinfoData:function(){for(var e=this.cfg.length,t=void 0,a=void 0,i=0;i<e;i++)a=this.cfg[i],(t=this.qualityMap.get(a.quality))||((t=new game.MapAchieveQualityInfo).element=this.element,t.quality=a.quality,this.qualityMap.set(a.quality,t),t.initData())},_sort:function(e,t){return t.quality-e.quality},getInfo:function(e){return this.qualityMap.get(e)},getList:function(){return this.qualityMap.values().sort(this._sort)},checkAlert:function(){var e=this.getList();if(e){for(var t=e.length,a=!1,i=0;i<t;i++)e[i].checkAlert()?a=e[i].alert=!0:e[i].alert=!1;this.alert=a}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$MapAchieveInfo",e)}(),function(){var e=void 0;e=b8e.Object.extends({element:0,active:!1,name:null,quality:0,icon:0,exp:0,lv:0,top:0,num:0,speed:0,alert:!1,itemIcon:0,itemId:0,id:0,value:0,starLv:0,partStar:0,maxStar:!1,tjAct:!1,maxStarNum:0,redPiont:!1,ctor:function(){},initData:function(e){this.element=e.element,this.name=e.name,this.quality=e.quality,this.id=e.id,this.icon=e.icon,this.itemIcon=e.item,this.updataValue()},setData:function(e){this.starLv=e.star,this.updataValue()},updataValue:function(){var e=this,t=game.partnerMapData.getItmeInfo(e.id);e.partStar=t.starLv,e.tjAct=t.active;var a=game.IconAchStarCfg.getData(e.id,e.starLv);e.itemId=a.itemId,e.num=a.itemNum,e.value=a.value,e.maxStarNum=a.maxStar,e.maxStar=e.starLv>=a.maxStar,e.checkRedpiont()},checkRedpiont:function(){!this.tjAct||this.active||this.maxStar?this.active&&!this.maxStar&&this.checkNeedNum()?this.redPiont=!0:this.redPiont=!1:this.redPiont=!0},checkNeedNum:function(){var e=this.starLv,t=e+1,a=this.maxStarNum;a<t&&(t=a);var i=this.getDataByStar(e),n=this.getDataByStar(t),s=i.itemNum,r=i.itemId,o=n.star,g=game.itemData.getNumById(r);return this.partStar>=o&&s<=g},getItemIcon:function(){return game.ItemUtil.createBaseItemInfo(this.itemIcon,1)},getDataByStar:function(e){return game.IconAchStarCfg.getData(this.id,e)},setUpStar:function(e){this.updataValue();game.PartnerStarCfg.getData(this.id,e)},setActive:function(){this.updataValue()}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$MapAchieveItmeInfo",e)}(),function(){var e;e=b8e.Object.extends({element:0,alert:!1,quality:0,ctor:function(){this.partnerMap=b8e.HashMap.get()},initData:function(){this.cfg=game.partnerMapData.getQualityCfg(this.element,this.quality),this.cfg&&this.setinfoData()},setinfoData:function(){for(var e=this.cfg.length,t=void 0,a=void 0,i=0;i<e;i++)a=this.cfg[i],t=new game.MapAchieveItmeInfo,this.partnerMap.set(a.id,t),t.initData(a)},getInfo:function(e){return this.partnerMap.get(e)},getList:function(){return this.partnerMap.values()},checkAlert:function(){var e=this.getList();if(e){for(var t=e.length,a=void 0,i=!1,n=0;n<t;n++)(a=e[n]).checkRedpiont();for(n=0;n<t;n++)if((a=e[n]).checkRedpiont(),a.redPiont)return!0;return i}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$MapAchieveQualityInfo",e)}(),function(){var e=void 0;e=b8e.Object.extends({cfg:null,ctor:function(){},initData:function(e){this.cfg=e}}),b8e.BindingUtil.bind(e),e.poolCall=!0,b8e.RC("$$game","$$MapAchieveAllInfo",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1560)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.MapAchieveHead,t.bindEnum=game.ME.MapAchieve,t.layout.spacingX=10,t.layout.paddingLeft=30,t.layout.paddingTop=-5,t.addToParent(e.list);var a=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);a.itemRender=game.MapAchieveListItem,a.bindEnum=game.ME.MapAchieve,a.layout.spacingY=10,a.addToParent(e.tiem_list),this.moduleData=game.mapAchieveData},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateList(),this.updateItmeList(t),this.updateView()}},onShow:function(){this.itemList.container.getNode().on(cc.Node.EventType.SIZE_CHANGED,this.onSize,this),this.send(this.Evts.V2C_UPDATE_VIEW),this.itemList.scrollToTop(),this.jumpToHeadItem()},onHide:function(){this.itemList.container.getNode().off(cc.Node.EventType.SIZE_CHANGED,this.onSize,this)},updateView:function(){var e=this.moduleData.selectId;this.moduleData.getSelectInfo();this.updatePro(),this.updateAllSpeed(e)},updateAllSpeed:function(e){var t=this.moduleData.getList();if(t)for(var a=t.length,i=void 0,n=0;n<a;n++)(i=t[n]).select=i.element==e},updatePro:function(){for(var e=this.moduleData.allAchNum,t=game.IconAchCfg.getDatas(),a=t.length,i=void 0,n=t[a-1].maxValue,s=0;s<a;s++)if(e+1>=t[s].minValue&&e+1<=t[s].maxValue){i=t[s].maxValue;break}n<=e&&(i=n),this.skin.pro.width=Math.min(230,e/i*230),this.skin.arrLable.string=e+"/"+i},updateList:function(){var e=this.moduleData.getList();this.list.setData(e)},updateItmeList:function(e){var t=this.moduleData.getQualityList();this.itemList.setData(t),e&&this.onSize()},onStageResize:function(){this.setPosition(0,0)},jumpToHeadItem:function(){var e=this.moduleData.getList(),t=e.length;if(e)for(var a=0;a<t;a++){var i=a+1;if(this.moduleData.getInfo(i).alert)return void this.send(game.MapAchieveEvts.C_SELECT_BTN,i)}},jumpToItem:function(e){this.itemList.scrollToTop();var t=0,a=this.moduleData.getQualityList(),i=this.itemList.getItemRender(a[e]);e==a.length-1?this.itemList.scrollToBottom(0,500):(t=Math.abs(i.y),this.itemList.scrollToPos({x:0,y:t},500))},onSize:function(){for(var e=this.moduleData.getQualityList(),t=0,a=e.length;t<a;t++)if(e[t].alert)return void this.jumpToItem(t);this.itemList.scrollToTop()}});b8e.module.registerView(game.ME.MapAchieve,e)}(),function(){var e=game.View.extends({countDownTime:10,_showModel:!0,ctor:function(){this._super(1551)},init:function(){this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.itemNode)},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.skin.time.string=game.Lang.get(51538,10),this.countDownTime=10,this.skin.gray.setSize(b8e.stageWidth+100,320),this.createCountDown(),this.setAward()},setAward:function(){var e=this.skin,t=game.mapAchieveData.succInfo;if(t){e.nameLab.string=game.Lang.get(53176,t.name),e.numlab.string=game.Lang.get(53177,t.value);var a=t.getItemIcon();game.GridUtil.setItemIcon(this._icon,a,!1,game.IconLayoutEnum.SHOW_NONE)}},onHide:function(){this.clearCountDown(),b8e.Tween.kill(this.skin.light)},createCountDown:function(){this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(game.ME.MapAchieveActivaSucc)}});b8e.module.registerView(game.ME.MapAchieveActivaSucc,e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1552)},onShow:function(){this.setValue()},setValue:function(){var e=this.skin,t=game.mapAchieveData.getAchAllValue(),a=game.mapAchieveData.getidAry(),i=game.mapAchieveData.allAchNum,n=i>=t[0].cfg.maxValue,s=0<a.length;e.noAttr1.active=!s,e.noAttr2.active=!n,e.havaAttrNode1.active=s,e.havaAttrNode2.active=n;var r=game.SpriteStatType,o=a.length;if(e.havaAttrNode1.active){for(var g=void 0,u=void 0,l=0,c=0,h=0,m=0;m<o;m++)l+=(u=(g=game.mapAchieveData.getItmeInfo(a[m])).getDataByStar(g.starLv)).teamAtk,c+=u.teamDef,h+=u.teamHp;this.setStatStr(e.oneAttr1,r.TeamAtk,l),this.setStatStr(e.oneAttr2,r.TeamDef,c),this.setStatStr(e.oneAttr3,r.TeamHp,h)}if(e.havaAttrNode2.active){for(var d=t.length,f=void 0,p=t[d-1].cfg.maxValue,v=0;v<d;v++)if(i+1>=t[v].cfg.minValue&&i+1<=t[v].cfg.maxValue){f=t[v].cfg.minValue;break}var E=void 0;E=p<=i?(f=p,game.IconAchCfg.getData(f)):game.IconAchCfg.getData(f-1),this.setStatStr(e.twoAttr1,r.TeamAtk,E.teamAtk),this.setStatStr(e.twoAttr2,r.TeamDef,E.teamDef),this.setStatStr(e.twoAttr3,r.TeamHp,E.teamHp),this.setStatStr(e.twoAttr4,r.TeamDamage,E.teamDamage),this.setStatStr(e.twoAttr5,r.TeamDamageRes,E.teamDamageRes)}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);911!=t&&912!=t||(a=a/10+"%"),e.string=game.Lang.get(53194,i.name,a)}});b8e.module.registerView(game.ME.MapAchieveAllAttr,e)}(),function(){var e=void 0;(e=game.ListItem.extends({max:6,ctor:function(){this._super(1553),this.setSize(186,227)},setData:function(){var e=this,t=e.skin,a=game.ResCfg.getUrl(10185,"quality_"+e.data.quality);t.quality_bg.loadTexture(a);var i=e.data.active?10088:10089,n=game.ResCfg.getUrl(i,e.data.icon);t.bg.loadTexture(n);var s=e.data.starLv,r=e.data.value,o=game.ResCfg.getUrl(10185,"num_"+s);t.numImg.loadTexture(o),t.numLab.string=game.Lang.get(53184,r);var g=!1,u=!1,l=!1,c=!1;e.data.active&&!e.data.maxStar?g=!0:e.data.maxStar?c=!0:e.data.active||e.data.tjAct?!e.data.active&&e.data.tjAct&&(u=!0):l=!0,t.btn_Up.active=g,t.btn_canAct.active=u,t.btn_noAct.active=l,t.btn_max.active=c,t.redPoint.active=e.data.redPiont},btn_canAct:function(){game.mapAchieveData.succInfo=this.data,this.send(game.MapAchieveEvts.SEND_ACT_DATA,this.data.id),game.module.show(game.ME.MapAchieveActivaSucc)},btn_max:function(){this.showLvUp()},btn_Up:function(){this.showLvUp()},showLvUp:function(){game.mapAchieveData.lvupInfo=this.data,game.module.show(game.ME.MapAchieveLvUp)}})).poolCall=!0,b8e.RC("$$game","$$MapAchieveItem",e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1554),this.setSize(530,105)},setData:function(){var e=this.skin,t=game.mapAchieveData.allAchNum,a=this.data.cfg.maxValue,i=a<=t?game.Color.GREEN:game.Color.BLACK,n=this.getShowAttr(this.data.cfg);e.oneAttr1.string=game.HtmlUtil.getText(i,game.Lang.get(53186,a)),this.setStatStr(e.oneAttr2,n[0].type,n[0].value,i),this.setStatStr(e.oneAttr3,n[1].type,n[1].value,i)},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);911!=t&&912!=t||(a=a/10+"%"),e.string=game.HtmlUtil.getText(i,game.Lang.get(53194,n.name,a))},getShowAttr:function(e){if(this.result||(this.result=[]),this.result.length=0,!e)return this.result;for(var t=game.SpriteDefine,a=t.length,i=void 0,n=void 0,s=void 0,r=0;r<a;r++){if(s=t[r])if(n=s.type,(i=e[b8e.getNormP(s.clientKey)])&&!(i<=0))game.AttrRulesCfg.getData(n)&&this.result.push({type:n,value:i})}return this.result}})).poolCall=!0,b8e.RC("$$game","$$MapAchieveLevelItem",e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1555)},init:function(){var e=this.skin,t=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);t.itemRender=game.MapAchieveLevelItem,t.bindEnum=game.ME.MapAchieveLevel,t.layout.paddingLeft=0,t.layout.spacingY=5,t.addToParent(e.list)},onShow:function(){this.list.scrollToTop(),this.setValue()},setValue:function(){var e=this.skin,t=game.mapAchieveData.getAchAllValue();this.list.setData(t);for(var a=game.mapAchieveData.allAchNum,i=t.length,n=void 0,s=0,r=t[i-1].cfg.maxValue,o=0;o<i;o++)if(a+1>=t[o].cfg.minValue&&a+1<=t[o].cfg.maxValue){n=t[o].cfg.maxValue,s=o-1;break}r<=a&&(n=r,s=i-1),s<0&&(s=0);var g=-110*s,u=-(105*i+105),l=g<u?u:g;this.list.scrollToTop(l),e.nowAchLab.string=game.Lang.get(53187,a,n)}});b8e.module.registerView(game.ME.MapAchieveLevel,e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1304),this.setSize(600,227)},init:function(){this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.itemList.itemRender=game.MapAchieveItem,this.itemList.bindEnum=game.ME.MapAchieve,this.itemList.addToParent(this.skin.list),this.itemList.touchMovable=!1},setData:function(){var e=this.skin,t=this.data.getList(),a=t.length,i=game.ResCfg.getUrl(10087,"title"+this.data.quality);e.name.loadTexture(i);var n=227*Math.ceil(a/3);this.setSize(600,40+n),this.itemList.setSize(600,n),this.layout(),this.itemList.setData(t)}})).poolCall=!0,b8e.RC("$$game","$$MapAchieveListItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1556)},init:function(){this._icon1=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon1.addToParent(this.skin.itemNode1),this._icon2=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon2.addToParent(this.skin.itemNode2)},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.skin.time.string=game.Lang.get(51538,10),this.countDownTime=10,this.skin.gray.setSize(b8e.stageWidth+100,475),this.createCountDown(),this.setAward()},setAward:function(){var e=this.skin,t=this.dataInfo=game.mapAchieveData.canlvUpData;if(t){var a=t.getItemIcon();game.GridUtil.setItemIcon(this._icon1,a,!1,game.IconLayoutEnum.SHOW_NONE),game.GridUtil.setItemIcon(this._icon2,a,!1,game.IconLayoutEnum.SHOW_NONE);var i=0==t.starLv;e.zeoNode.active=i,e.twoNode.active=!i,this.setLabValue()}},setLabValue:function(){var e=this,t=e.skin,a=e.dataInfo.maxStarNum,i=e.dataInfo.name,n=e.dataInfo.starLv,s=n+1;a<s&&(s=a);var r=e.dataInfo.getDataByStar(n),o=e.dataInfo.getDataByStar(s),g=r.value,u=o.value,l=u-g,c=(o.star,r.itemNum,r.itemId,game.SpriteStatType);t.nowName.string=game.Lang.get(53185,i,n),t.nextName.string=game.Lang.get(53185,i,s),t.nowNum.string=game.Lang.get(53184,g),t.nextNum.string=u,t.addNum.string=l,e.skin.zeoNode.active&&(e.setStatStr(t.zeroAttr1,c.TeamAtk,o.teamAtk),e.setStatStr(t.zeroAttr2,c.TeamDef,o.teamDef),e.setStatStr(t.zeroAttr3,c.TeamHp,o.teamHp)),e.skin.twoNode.active&&(e.setStatStr(t.nowAttr1,c.TeamAtk,r.teamAtk),e.setStatStr(t.nowAttr2,c.TeamDef,r.teamDef),e.setStatStr(t.nowAttr3,c.TeamHp,r.teamHp),t.nextAttr1.string=o.teamAtk,t.nextAttr2.string=o.teamDef,t.nextAttr3.string=o.teamHp,t.twoaddNum1.string=o.teamAtk-r.teamAtk,t.twoaddNum2.string=o.teamDef-r.teamDef,t.twoaddNum3.string=o.teamHp-r.teamHp)},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(53194,i.name,game.CCommonUtil.replaceNum(a))},onHide:function(){this.clearCountDown(),b8e.Tween.kill(this.skin.light)},createCountDown:function(){this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(game.ME.MapAchieveLvPop)}});b8e.module.registerView(game.ME.MapAchieveLvPop,e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1557)},init:function(){this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.itemNode)},onShow:function(){this.setAward()},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_VIEW:case this.Evts.C2V_UPDATE_VIEW2:this.setAward()}},setAward:function(){var e=this.dataInfo=game.mapAchieveData.lvupInfo,t=e.getItemIcon();game.GridUtil.setItemIcon(this._icon,t,!1,game.IconLayoutEnum.SHOW_NONE),this.skin.nameLab.string=e.name,this.skin.starLab.string=e.partStar;var a=!1,i=!1,n=!1,s=!1;0==e.starLv||e.maxStar?(n=a=!0,e.maxStar&&(n=!(s=!0))):n=i=!0,this.skin.oneMaxNode.active=a,this.skin.twoNode.active=i,this.skin.btnNode.active=n,this.skin.isMaxImg.active=s,this.setLabValue()},setLabValue:function(){var e=this,t=e.skin,a=e.dataInfo.maxStarNum,i=e.dataInfo.starLv,n=i+1;a<n&&(n=a);var s=e.dataInfo.getDataByStar(i),r=e.dataInfo.getDataByStar(n),o=s.value,g=r.value,u=g-o,l=r.star,c=s.itemNum,h=s.itemId,m=game.itemData.getNumById(h),d=game.SpriteStatType;if(e.skin.oneMaxNode.active&&(e.skin.onenameLab.string=game.Lang.get(53178,i+1),e.skin.oneLvLab.string=game.Lang.get(53181,g,u),e.setStatStr(t.oneAttr1,d.TeamAtk,r.teamAtk),e.setStatStr(t.oneAttr2,d.TeamDef,r.teamDef),e.setStatStr(t.oneAttr3,d.TeamHp,r.teamHp),e.dataInfo.maxStar&&(e.skin.onenameLab.string="")),e.skin.twoNode.active&&(t.nowLvLab.string=game.Lang.get(53178,i),t.nextLvLab.string=game.Lang.get(53178,n),t.nowAttr1.string=game.Lang.get(53184,o),t.nextAttr1.string=game.Lang.get(53184,g),e.setStatStr(t.nowAttr2,d.TeamAtk,s.teamAtk),e.setStatStr(t.nowAttr3,d.TeamDef,s.teamDef),e.setStatStr(t.nowAttr4,d.TeamHp,s.teamHp),e.setStatStr(t.nextAttr2,d.TeamAtk,r.teamAtk),e.setStatStr(t.nextAttr3,d.TeamDef,r.teamDef),e.setStatStr(t.nextAttr4,d.TeamHp,r.teamHp)),e.skin.btnNode.active){var f=e.dataInfo.partStar>=l?53179:53180,p=c<=m?53182:53183;t.conditionLab.string=game.Lang.get(f,e.dataInfo.partStar,l),t.consumeLab.string=game.Lang.get(p,m,c);var v=e.dataInfo.partStar>=l&&c<=m;t.btn_gray.active=!v,t.btn_receive.active=v;var E=game.ItemUtil.createBaseItemInfo(h,c);game.mapAchieveData.lvupItemId=E,game.mapAchieveData.canlvUpData=e.dataInfo}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(53194,i.name,game.CCommonUtil.replaceNum(a))}});b8e.module.registerView(game.ME.MapAchieveLvUp,e)}(),function(){var e=void 0;(e=game.ListItem.extends({_showModel:!0,ctor:function(){this._super(1558),this.setSize(547,95)},setData:function(){var e=this.data;if(e){var t=this.skin;t.rank_1.node.active=1==e.rank,t.rank_2.node.active=2==e.rank,t.rank_3.node.active=3==e.rank,t.rank.node.active=3<e.rank,t.rankBg.node.active=3<e.rank,t.rank.string=e.rank,t.name.string=e.name,t.lvLab.string=e.level,t.score.string=e.score}}})).poolCall=!0,b8e.RC("$$game","$$MapAchieveRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1559)},init:function(){var e=this;e.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.rankList.itemRender=game.MapAchieveRankItem,e.rankList.bindEnum=game.ME.MapAchieveRank,e.rankList.layout.paddingLeft=0,e.rankList.layout.paddingRight=0,e.rankList.layout.paddingTop=0,e.rankList.layout.spacingX=15,e.rankList.layout.spacingY=5,e.rankList.addToParent(e.skin.list)},notify:function(e){switch(e){case this.Evts.UPDATE_RANKVIEW:this.updateView()}},onShow:function(){this.send(this.Evts.V_REQ_RANKINFO)},updateView:function(){var e=game.rankData.getRankInfoArrByType(game.RankType.IconAch);this.rankList.setData(e);var t=game.rankData.getSelfRankInfo(game.RankType.IconAch);if(t){this.skin.mineRank.string=0==t.rank?game.Lang.get(9069):game.Lang.get(8642,t.rank),this.skin.mineRankNum.string=game.Lang.get(53193,t.score)}}});b8e.module.registerView(game.ME.MapAchieveRank,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1308),this.setSize(129,78)},setData:function(e){this.data=e;var t=game.ResCfg.getUrl(10087,e.element);this.skin.icon.loadTexture(t),this.skin.redPoint.active=e.alert;var a=game.ResCfg.getUrl(10087,"btn_"+e.element);this.skin.btn_bg.loadTexture(a),this.skin.btn_bg.active=e.select},touchIcon:function(){this.send(game.MapAchieveEvts.C_SELECT_BTN,this.data.element)}}),b8e.RC("$$game","$$MapAchieveHead",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1561)},init:function(){},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light),this.skin.time.string=game.Lang.get(51538,10),this.countDownTime=10,this.skin.gray.setSize(b8e.stageWidth+100,320),this.createCountDown(),this.setAward()},setAward:function(){var e=this.skin,t=game.mapAchieveData.showNum;e.labNum.string=game.Lang.get(53222,t);var a=game.IconAchCfg.getData(t),i=this.getShowAttr(a),n=game.Color.WHITE;this.setStatStr(e.AttrLab1,i[0].type,i[0].value,n),this.setStatStr(e.AttrLab2,i[1].type,i[1].value,n)},onHide:function(){this.clearCountDown(),b8e.Tween.kill(this.skin.light)},setStatStr:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);911!=t&&912!=t||(a=a/10+"%"),e.string=game.HtmlUtil.getText(i,game.Lang.get(53229,n.name,a))},getShowAttr:function(e){if(this.result||(this.result=[]),this.result.length=0,!e)return this.result;for(var t=game.SpriteDefine,a=t.length,i=void 0,n=void 0,s=void 0,r=0;r<a;r++){if(s=t[r])if(n=s.type,(i=e[b8e.getNormP(s.clientKey)])&&!(i<=0))game.AttrRulesCfg.getData(n)&&this.result.push({type:n,value:i})}return this.result},createCountDown:function(){this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(game.ME.MapAchieveValuePop)}});b8e.module.registerView(game.ME.MapAchieveValuePop,e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.payGuideData},ipc:function(){this.evts={Recharge:{C_RECHARGE_SUCCESS:this.onRecharge},MainRole:{C_LEVEL_UP:this.onLvUp},MainUIBottom:{C_GO_HOME:this.showView,C_GO_BATTLE:this.showView}}},onRecharge:function(){this.moduleData.isShow=!1},showView:function(){var e=game.playBack.isInstanceFighting(!1),t=game.sceneData.isCsScene();e||t||(this.moduleData.updateCondCfg(),this.moduleData.condCfg&&0==this.moduleData.isShow&&(game.module.show(game.ME.PayGuideCondition),this.moduleData.isShow=!0))},onLvUp:function(){this.moduleData.updatePreviewCfgs();var e=this.moduleData.preShowCfgs;e&&0<e.length&&game.gamePopupMgr.show(game.ME.PayGuidePreview)},rechargeBtn:function(){var e=this.moduleData.condCfg;if(e){var t=e.moduleId;0!=t?game.moduleOpen.checkOpenWithTips(t)&&(t==game.ME.OpenServer?(this.obj||(this.obj={}),this.obj={openServerType:e.toggleId},this.dptG(game.OpenServerGEvts.C2C_SHOW_OPENSERVER,this.obj)):game.module.showToggle(t,e.toggleId),game.module.hide(this.moduleEnum)):game.module.hide(this.moduleEnum)}},gotoBtn_1:function(){this.gotoView(0)},gotoBtn_2:function(){this.gotoView(1)},gotoBtn_3:function(){this.gotoView(2)},gotoView:function(e){var t=this.moduleData.preShowCfgs;if(t&&!(t.length<1)){var a=t[e];if(t){var i=a.moduleId;0==i?game.module.hide(this.moduleEnum):game.module.showToggle(i,a.toggleId)}}}}),t=[game.ME.PayGuidePreview];b8e.module.registerControl(game.ME.PayGuideCondition,e,null,null,t)}(),function(){var e;e=b8e.Enum({NONE:0,VIP:1,WEEK_CARD:2,MONTH_CARD:3,LIFELONG_CARD:4,FAST_FIGHT:5,GROWTH_FUND:6}),b8e.RC("$$game","$$PayGuideTypes",e)}(),function(){var e=b8e.Object.extends({condCfg:null,isShow:!0,updateCondCfg:function(){this.condCfg=this.getCondCfg()},getCondCfg:function(){var e=game.rechargeData.rechargeMoney;if(e>this.maxReachMoney)return null;this.conditionCfgs||(this.conditionCfgs=game.PayGuideConditionCfg.getDatas());for(var t=void 0,a=this.conditionCfgs.length,i=0;i<a;i++){if(t=this.conditionCfgs[i],game.mainRoleData.lv>=t.lv&&e>=t.triggerMoney&&e<=t.reachMoney)return t}return null},updatePreviewCfgs:function(){var e=this;if(e.preShowCfgs||(e.preShowCfgs=[]),e.preShowCfgs.length=0,!e.openLvs){var t=game.CfgUtil.getMiscValue(game.PayGuideMiscCfg,"openViewLv").split("|");e.openLvs=t.map(function(e){return+e})}if(e.openLvs.indexOf(game.mainRoleData.lv)<0)return null;e.previewCfgs||(e.previewCfgs=game.PayGuideOverviewCfg.getDatas(),e.previewCfgs.sort(function(e,t){e.sort,t.sort}));for(var a=void 0,i=e.previewCfgs.length,n=game.mainRoleData.lv,s=0,r=0;r<i&&((a=e.previewCfgs[r]).lv>n||e.checkIsGetByType(a.type)||(e.preShowCfgs.push(a),3!=++s));r++);return e.preShowCfgs},checkIsGetByType:function(e){var t=game.PayGuideTypes;switch(e){case t.VIP:return game.mainRoleData.vipLevel>=game.VipCfg.getMaxLv();case t.WEEK_CARD:return game.rechargeData.getCardIsHas(game.CardType.WEEK);case t.MONTH_CARD:return game.rechargeData.getCardIsHas(game.CardType.MONTH);case t.LIFELONG_CARD:return game.rechargeData.getCardIsHas(game.CardType.FOREVER);case t.FAST_FIGHT:return game.privilegeShopData.isActByType(game.PrivilegeType.QUICK_BATTLE);case t.GROWTH_FUND:return game.fundData.isPurchased()}},maxReachMoney:{get:function(){return this._maxReachMoney||(this._maxReachMoney=+game.CfgUtil.getMiscValue(game.PayGuideMiscCfg,"maxReachMoney")),this._maxReachMoney}},getCondAwardInfos:function(){if(this.awardInfos||(this.awardInfos=[]),this.clearList(this.awardInfos),this.condCfg){for(var e=this.condCfg.award,t=void 0,a=void 0,i=e.length,n=1;n<i;n++)t=e[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),this.awardInfos.push(a);return this.awardInfos}},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0}});game.payGuideData=game.payGuideData||new e}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("payGuide/PayGuideConditionView"),this.setLocalZOrder(game.GameViewMgr.WindowViewIndex)},init:function(){var e=this.skin;this.moduleData=game.payGuideData,this.icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this.icon.addToParent(e.awardNode),this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=40},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=this.moduleData.condCfg;if(t){e.bg.loadTexture(game.ResCfg.getUrl(10188)),e.showImg.loadTexture(game.ResCfg.getUrl(10189,t.show)),e.giftBagValueLab.string=t.giftBagValue;var a=t.award;if(this.itemInfo=game.ItemUtil.createBaseItemInfo(a[0].Id,a[0].Num,this.itemInfo),this.icon.setItemInfo(this.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM),t.triggerMoney!=t.reachMoney&&0<t.isShowPro){var i=game.rechargeData.rechargeMoney,n=e.proBg.width-84;e.proFront.width=i/t.reachMoney*n,e.proLab.string=game.Lang.get(53235,i,t.reachMoney+1),e.progressNode.active=!0}else e.progressNode.active=!1;this.updateRewList()}},updateRewList:function(){var e=this.moduleData.getCondAwardInfos();!e||e.length<1||this._list.setData(e)}});b8e.module.registerView(game.ME.PayGuideCondition,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("payGuide/PayGuidePreviewView")},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.payGuideData.preShowCfgs;if(t&&!(t.length<1)){var a=void 0,i=t.length;e.itemNode1.y=1==i?-328:2==i?-212:-100,e.closeBtn.y=1==i?-575:2==i?-687:-800,e.itemNode2.y=2==i?-440:-328,e.itemNode2.active=1<i,e.itemNode3.active=2<i;for(var n=void 0,s=0;s<i;s++)a=t[s],n=game.ResCfg.getUrl(10190,a.id),this.getComponent("bg_"+(s+1)).loadTexture(n)}}});b8e.module.registerView(game.ME.PayGuidePreview,e)}(),function(){var e=b8e.Object.extends({enemyTotalAttack:0,enemyTotalTakeDamage:0,enemyTotalTreatment:0,ownTotalAttack:0,ownTotalTakeDamage:0,ownTotalTreatment:0,ownInfos:null,enemyInfos:null,ownMainRoleId:0,enemyMainRoleId:0,ctor:function(){this.battleInfoMap=b8e.HashMap.get(),this.ownInfos=[],this.enemyInfos=[]},updateAllBattleInfos:function(){this.ownInfos.length=0,this.enemyInfos.length=0,this.initBattleInfos(),this.updateTotalValue()},getMaxInfos:function(){var e=this.ownInfos.length,t=this.enemyInfos.length;return this.maxType=t<e?1:2,1==this.maxType?this.ownInfos:this.enemyInfos},initBattleInfos:function(){var e=game.playBack.info,t=0,a=0;if(e){this.battleInfoMap.clear();var i=e.units;i.sort(function(e,t){return e.pos-t.pos});for(var n=game.RoleType,s=i.length,r=void 0,o=void 0,g=0;g<s;g++){r=i[g],(o=game.BattleDetailsInfo.get()).setData(r);var u=1==r.attack;(o.isOwn=u)?(o.index=t,o.unitType!=n.Shenhun&&(this.ownInfos.push(o),t++),o.unitType==n.Hero&&(this.ownMainRoleId=o.unitId)):(o.index=a,o.unitType!=n.Shenhun&&(this.enemyInfos.push(o),a++),o.unitType==n.Hero&&(this.enemyMainRoleId=o.unitId)),this.battleInfoMap.set(r.id,o)}var l=e.actions;if(l&&!(l.length<1))for(var c=void 0,h=l.length,m=0;m<h;m++)c=l[m],this.updateAllBuffEffect(c.buffs),this.updateSpellCastEffect(c.spellCast)}},updateAllBuffEffect:function(e){for(var t=void 0,a=e.length,i=0;i<a;i++)t=e[i],this.battleInfoMap.get(t.casterUnitId)&&this.updateBuffEffects(t)},updateSpellCastBuff:function(e,t){for(var a=void 0,i=t.length,n=0;n<i;n++)a=t[n],e&&(this.updateTargetEffect(e,a.targets),this.updateBuffEffects(a))},updateSpellCastEffect:function(e){for(var t=void 0,a=e.length,i=void 0,n=0;n<a;n++)t=e[n],(i=this.battleInfoMap.get(t.unitId))&&(this.updateTargetEffect(i,t.targets),this.updateSpellCastBuff(i,t.buffs))},updateTargetEffect:function(e,t){if(e){var a=game.RoleType;e.unitType==a.Shenhun&&(e=e.isOwn?this.battleInfoMap.get(this.ownMainRoleId):this.battleInfoMap.get(this.enemyMainRoleId));for(var i=void 0,n=t.length,s=0;s<n;s++){i=t[s];var r=this.battleInfoMap.get(i.unitId);r.unitType==a.Shenhun&&(r=r.isOwn?this.battleInfoMap.get(this.ownMainRoleId):this.battleInfoMap.get(this.enemyMainRoleId));var o=i.effect;this.updateEffectValue(o,e,r)}}},updateBuffEffects:function(e){var t=e.effects,a=void 0,i=t.length,n=this.battleInfoMap.get(e.casterUnitId),s=this.battleInfoMap.get(e.unitId);if(n&&s)for(var r=0;r<i;r++)a=t[r],this.updateEffectValue(a,n,s)},updateEffectValue:function(e,t,a){var i=e.type,n=e.value,s=game.BounceCharacterType;i==s.HEALTH?0<n?t.treatment+=n:(t.attack+=n,a.takeDamage+=n):i!=s.NORMALHIT&&i!=s.CRITHIT&&i!=s.WUSHUANG&&i!=s.DAMAGEADVANTAGE1&&i!=s.DAMAGEADVANTAGE2&&i!=s.POISON||(t.attack+=n,a.takeDamage+=n,a.updateDeathState())},updateTotalValue:function(){this.resetTotalValue();for(var e=this.battleInfoMap.values(),t=void 0,a=e.length,i=0;i<a;i++)(t=e[i]).isOwn?(this.ownTotalAttack+=t.attack,this.ownTotalTakeDamage+=t.takeDamage,this.ownTotalTreatment+=t.treatment):(this.enemyTotalAttack+=t.attack,this.enemyTotalTakeDamage+=t.takeDamage,this.enemyTotalTreatment+=t.treatment)},resetTotalValue:function(){this.ownTotalAttack=0,this.ownTotalTakeDamage=0,this.ownTotalTreatment=0,this.enemyTotalAttack=0,this.enemyTotalTakeDamage=0,this.enemyTotalTreatment=0}});game.battleDetailsData=game.battleDetailsData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({name:null,lv:0,star:0,awake:0,attack:0,takeDamage:0,treatment:0,isDeath:!1,isOwn:!1,index:0,isMainRole:!1,unitType:0,roleId:0,maxHp:0,unitId:0,surface:null,setData:function(e){this.name=e.name,this.isDeath=e.hp<1,this.unitType=e.type,this.roleId=e.roleId,this.maxHp=e.maxhp,this.unitId=e.id,this.surface=e.surface},updateDeathState:function(){this.isDeath=this.takeDamage>=this.maxHp}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$BattleDetailsInfo",t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1585)},init:function(){var e=this.skin;this.moduleData=game.battleDetailsData,this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.BattleDetailsItem,this._list.layout.paddingLeft=10,this._list.layout.paddingTop=6,this._list.layout.spacingY=6,this._list.addToParent(e.list)},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.playBack.info;e.defeat.x=t.win?356:235,e.win.x=t.win?235:356,this.moduleData.updateAllBattleInfos();var a=this.moduleData.getMaxInfos();a&&this._list.setData(a)}});b8e.module.registerView(game.ME.BattleDetails,e)}(),function(){var e=void 0;(e=game.ListItem.extends({ctor:function(){this._super(1584),this.setSize(540,116)},setData:function(){var e=this,t=e.skin,a=e.data;e.moduleData=game.battleDetailsData,e.maxWidth=124;var i=a.index,n=a.isOwn?e.moduleData.enemyInfos[i]:e.moduleData.ownInfos[i];a.isOwn?(e.updateOwnData(a),n&&(e.updateEnemyData(n),t.enemyDeath.active=n.isDeath),t.enemyNode.active=!!n,t.ownDeath.active=a.isDeath,t.ownNode.active=!0):(e.updateEnemyData(a),n&&(e.updateOwnData(n),t.ownDeath.active=n.isDeath),t.ownNode.active=!!n,t.enemyDeath.active=a.isDeath,t.enemyNode.active=!0)},updateOwnData:function(e){var t=this,a=t.skin,i=void 0;if(e.unitType==game.RoleType.Hero){var n=e.surface;if(!n)return;var s=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(n.roleQuality));a.ownHeadBg.loadTexture(s);var r=game.ResCfg.getHead(e.ismale);a.ownHeadIcon.loadTexture(r),i=n.roleQuality,a.ownHeadNode.active=!1,a.ownHeadBg.active=a.ownHeadIcon.active=!0}else{var o=game.PartnerCfg.getData(e.roleId);if(!o)return;var g=game.partnerData.getInfoById(o.id);if(!g)return;t.headIcon||(t.headIcon=new game.CultivateBaseIcon,t.headIcon.addToParent(a.ownHeadNode)),t.headIcon.setData(g),i=g.quality,a.ownHeadNode.active=!0,a.ownHeadBg.active=a.ownHeadIcon.active=!1}a.ownNameLab.string=game.HtmlUtil.getColorStrByQuality(i,e.name),a.ownProLab_1.string=game.CCommonUtil.replaceNum(e.attack,1),a.ownProLab_2.string=game.CCommonUtil.replaceNum(e.treatment,1),a.ownProLab_3.string=game.CCommonUtil.replaceNum(e.takeDamage,1),a.ownRed_bar_1.width=e.attack/t.moduleData.ownTotalAttack*t.maxWidth,a.ownGreen_bar_2.width=e.treatment/t.moduleData.ownTotalTreatment*t.maxWidth,a.ownYello_bar_3.width=e.takeDamage/t.moduleData.ownTotalTakeDamage*t.maxWidth},updateEnemyData:function(i){var e=this,t=e.skin,a=game.RoleType;if(i.unitType==a.Hero||i.unitType==a.Partner){var n=void 0;if(!(n=1==i.unitType?game.PartnerCfg.getData(1):game.PartnerCfg.getData(i.roleId)))return;var s=game.partnerData.getInfoById(n.id);if(!s)return;e.enemyHeadIcon||(e.enemyHeadIcon=new game.CultivateBaseIcon,e.enemyHeadIcon.addToParent(t.enemyHeadNode)),e.enemyHeadIcon.setData(s),t.enemyNameLab.string=game.HtmlUtil.getColorStrByQuality(n.quality,i.name),t.enemyHeadNode.active=!0,t.headBg.active=t.headIcon.active=t.element.active=!1}else game.MonsterCfg.getDataAsync(i.roleId,function(e){if(e){var t=this.skin,a=game.ResCfg.getQualityBg(e.quality);t.headBg.loadTexture(game.ResCfg.getUrl(240,a)),t.headIcon.loadTexture(game.ResCfg.getUrl(72,e.model)),t.element.loadTexture(game.ResCfg.getUrl(10048,e.element)),t.enemyNameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),t.enemyHeadNode.active=!1,t.headBg.active=t.headIcon.active=t.element.active=!0}else b8e.error("\u602a\u7269\u4e0d\u5b58\u5728id: ",i.roleId)},e);t.enemyProLab_1.string=game.CCommonUtil.replaceNum(i.attack,1),t.enemyProLab_2.string=game.CCommonUtil.replaceNum(i.treatment,1),t.enemyProLab_3.string=game.CCommonUtil.replaceNum(i.takeDamage,1),t.enemyRed_bar_1.width=i.attack/e.moduleData.enemyTotalAttack*e.maxWidth,t.enemyGreen_bar_2.width=i.treatment/e.moduleData.enemyTotalTreatment*e.maxWidth,t.enemyYello_bar_3.width=i.takeDamage/e.moduleData.enemyTotalTakeDamage*e.maxWidth}})).poolCall=!0,b8e.RC("$$game","$$BattleDetailsItem",e)}(),function(){var e;e=b8e.Enum({None:0,V2C_SELECT_BTN:b8e.enc(),V2C_SHOW_VIEW:b8e.enc(),V2C_HIDE_VIEW:b8e.enc(),C2V_UPDATE_SELECT:b8e.enc()}),b8e.RC("$$game","$$RechargeHallEvts",e)}(),function(){var e=b8e.Object.extends({selectId:0,ctor:function(){this._super(),this.btns=[],this.btnsMap=b8e.HashMap.get()},initBtns:function(){this.btnsMap.clear();var e=game.RechargeHallCfg.getDatas();if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)t=e[n],(a=new game.RechargeHallBtnInfo).setData(t),this.btnsMap.set(a.id,a)},getBtns:function(){return this.btnsMap.count()<1&&this.initBtns(),this.btns.length=0,this.btnsMap.forEach(this.setBtn,this),this.btns.sort(this.sortBtn),this.btns},setBtn:function(e,t){if(t&&t.cfg){var a=t.cfg;if(a.moduleEnum!=game.ME.SpecialWarToken||game.specialWarTokenData.checkOpenByAId(a.tokenActivityId)){this.btns[this.btns.length]=t}}},sortBtn:function(e,t){return e.sortId-t.sortId},getMap:function(){return this.btnsMap.count()<1&&this.initBtns(),this.btnsMap},selectPage:function(e){var t=this.getMap(),a=t.get(this.selectId);a&&(a.select=!1);var i=t.get(e);i&&(i.select=!0),this.selectId=e}});game.rechargeHallData=game.rechargeHallData||new e}(),function(){var e;e=b8e.Object.extends({select:!1,alert:!1,id:0,sortId:0,cfg:null,setData:function(e){this.id=e.id,this.sortId=e.sortId,this.cfg=e,this.bindAlert(this.id)},bindAlert:function(e){var t=game.RechargeHallType,a=void 0,i=game.SAE;switch(e){case t.VIP:a=i.VIP_ALERT;break;case t.MONTH_CARD:a=i.MONTH_CARD_ALERT;break;case t.PRIVILEGE:a=i.WEEK_CARD_ALERT;break;case t.WEEK_GIFT:a=i.DAYORWEEK_BTN2;break;case t.DAY_GIFT:a=i.DAYORWEEK_BTN1;break;case t.TOKEN_MAIN_TASK:case t.TOKEN_MEMOIR:case t.TOKEN_ZHANJIANG:case t.TOKEN_ZHAOQIN:case t.TOKEN_BARBARIAN:a=this.cfg.tokenAlertEnum}a&&game.spotAlert.setCb(a,this.updateAlert,this)},updateAlert:function(e){this.alert=e.alert}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RechargeHallBtnInfo",e)}(),function(){var e;e=b8e.Enum({NONE:0,RECHARGE:1,VIP:2,MONTH_CARD:3,PRIVILEGE:4,WEEK_GIFT:5,DAY_GIFT:6,TOKEN_MAIN_TASK:7,TOKEN_MEMOIR:8,TOKEN_ZHANJIANG:9,TOKEN_ZHAOQIN:10,TOKEN_BARBARIAN:11}),b8e.RC("$$game","$$RechargeHallType",e)}(),function(){var e=game.Control.extends({lastModuleEnum:0,init:function(){this.data=game.rechargeHallData},ipc:function(){this.evts={MainRole:{C_RESET_DAILY:this.resetDaily}}},resetDaily:function(){},notify:function(e,t){switch(e){case this.Evts.V2C_SELECT_BTN:this.selectBtn(t);break;case this.Evts.V2C_HIDE_VIEW:this.hideView()}},hideView:function(){this.lastModuleEnum&&game.module.hide(this.lastModuleEnum),this.lastModuleEnum=0},selectBtn:function(e){if(e){var t=game.RechargeHallCfg.getData(e);if(t){this.lastModuleEnum&&game.module.hide(this.lastModuleEnum);var a=t.moduleEnum;e==game.RechargeHallType.DAY_GIFT&&game.dayOrWeekGiftData.setSelect(1),e==game.RechargeHallType.WEEK_GIFT&&game.dayOrWeekGiftData.setSelect(2),a==game.ME.SpecialWarToken&&game.specialWarTokenData.selectActivityId(t.tokenActivityId),game.module.showTab(t.moduleEnum,this.moduleEnum),this.data.selectPage(e),this.lastModuleEnum=t.moduleEnum,this.send(this.Evts.C2V_UPDATE_SELECT)}}},selectToggle:function(e){if(game.RechargeHallCfg.getData(e)){var t=this.data.getBtns();!t||t.length<1?game.module.hide(this.moduleEnum):this.selectBtn(e)}}});b8e.module.registerControl(game.ME.RechargeHall,e,game.RechargeHallEvts)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super("rechargeHall/RechargeHallView")},init:function(){var e=this.btnList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.RechargeHallBtnItem,e.addToParent(this.skin.scrollView),e.bindEnum=this.moduleEnum,e.layout.spacingX=5},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_SELECT:this.updateBanner()}},onShow:function(){this.btns=game.rechargeHallData.getBtns(),this.btnList.setData(this.btns),this.updateBanner()},updateBanner:function(){var e=game.RechargeHallCfg.getData(game.rechargeHallData.selectId);if(e){var t=game.ResCfg.getUrl(10193,e.banner);this.skin.banner.loadTexture(t)}},onHide:function(){this.send(this.Evts.V2C_HIDE_VIEW)},onStageResize:function(){this._super()}});b8e.module.registerView(game.ME.RechargeHall,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("rechargeHall/RechargeHallBtnItem"),this.setSize(110,106)},init:function(){var e=this.btn=b8e.Sprite.get();e.addToParent(this.skin.btn),e.setAnchor(.5,.5)},setData:function(){var e=this.data;this.skin.btnSelect.active=e.select,this.btn.loadTexture(game.ResCfg.getUrl(10192,e.cfg.btnIcon)),this.skin.alert.active=e.alert},clickBtn:function(){var e=this.data.id;e!=game.rechargeHallData.selectId&&this.send(game.RechargeHallEvts.V2C_SELECT_BTN,e)}}),b8e.RC("$$game","$$RechargeHallBtnItem",e)}(),function(){var e;e=b8e.Enum({None:0,C_CHANGE_BTN_STATE:b8e.enc(),ROLE_MOVE:b8e.enc(),MOVE_END:b8e.enc(),SCENE_TOUCH_MOVE:b8e.enc(),C_ONSHOW_CITY:b8e.enc(),C_CHANGE_CITY_BOX:b8e.enc(),UPDATE_DATA_CITY_LIST:b8e.enc(),UPDATE_DATA_REFRESH_TIME:b8e.enc(),C_BUY_NUM_ADD:b8e.enc(),C_CITY_ITEM_CLICK:b8e.enc(),UPDATE_LOOK_PLAY_INFO:b8e.enc(),SHOW_FAIL_TIPS:b8e.enc(),BACK_BORN_CITY:b8e.enc(),SOMEONE_FAIL:b8e.enc(),C_SEND_RECEIVE_GOLD:b8e.enc(),C_SWEEP_BATTLE_FIVE:b8e.enc(),C_UPDATA_OUTPUT:b8e.enc(),C_UPDATA_NODE_RANK:b8e.enc(),C_UPDATA_MOVE_OLD:b8e.enc(),C_UPDATA_MOVE_NEW:b8e.enc(),C_UPDATE_LOOK_CITY_INFO:b8e.enc(),C_UPDATA_CITY_RATE:b8e.enc(),C_MOVE_MAIN_BOTTOM:b8e.enc(),SOMEONE_FAIL2:b8e.enc(),C_CLOSE_SEASETTLE:b8e.enc(),C_CLOSE_CITYVIEW:b8e.enc(),C_BATTLE_SITUATION:b8e.enc(),C_BATTLE_SITUATION2:b8e.enc(),V_UPDATE_CITY_VIEW:b8e.enc(),V_UPDATE_CITY_VIEW2:b8e.enc(),C2C_SET_FORMATION:b8e.enc(),C_UPDATE_RESOURCES:b8e.enc(),C_UPDATE_STAMINA:b8e.enc(),C_SELECT_CITY_TYPE:b8e.enc(),C_SELECT_CITY_OPEN:b8e.enc(),C_SELECT_CITY:b8e.enc(),C_GET_TASK_REWARD:b8e.enc(),C_GET_TASK_PRO_REWARD:b8e.enc(),C_UPDATE_TASK:b8e.enc(),C_UPDATE_TASK_PRO:b8e.enc(),C_BATTLE_SITUA_TOGGLE:b8e.enc(),C_RANK_TOGGLE:b8e.enc(),C_OCCUPY_TOGGLE:b8e.enc(),C_UPDATE_GATHER:b8e.enc(),V_COUNTER_ATTACK:b8e.enc(),C_UPDATE_MAIN_VIEW:b8e.enc(),UPDATE_BATTLELOG_ALERT:b8e.enc(),G_CITY_TOUCH_START:b8e.enc(),C2C_CLOSR_ACT:b8e.enc(),C_UPDATE_SEASON_STAGE:b8e.enc()}),b8e.RC("$$game","$$GuildConflictEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.guildConflictData,this.taskAlert=game.spotAlert.set(game.SAE.GUILD_CONFLICT_TASK),this.battleLogAlert=game.spotAlert.set(game.SAE.GUILD_CONFLICT_BATTLE_LOG),this.spotAlert=game.spotAlert.set(game.SAE.GUILD_CONFLICT_MAIN)},ipc:function(){var e=this;e.evts={MainUIBottom:{C_GO_BATTLE:e.showMainView},Home:{C_ENTER_GUILD_CONFLICT:e.enterGuildConflict},LoadActiveShow:{C2C_ENTER_GUILD_CONFLICT:e.enterGuildConflict},GuildConflictWarSitua:{UPDATE_BATTLELOG_ALERT:e.hideBattleLogAlert,V_COUNTER_ATTACK:e.counterAttack},Guild:{C2C_UPDATE_GUILD_ACTIVE:e.resetGatherId},GuildMember:{C2C_UPDATE_GUILD_ACTIVE:e.resetGatherId},MainRole:{C_RECONNECT_MSIC_DATA:e.reconnect}},e.gevts={GuildConflictEvts:{SCENE_TOUCH_MOVE:e.onSceneMove,G_CITY_TOUCH_START:e.onTouchCityStart,C_ONSHOW_CITY:e.onOpenCity,ROLE_MOVE:e.onRoleMove,MOVE_END:e.onMoveEnd,SHOW_FAIL_TIPS:e.onShowFailTip,BACK_BORN_CITY:e.onbackBronCity2,C_SEND_RECEIVE_GOLD:e.onRecriveGold,C_CITY_ITEM_CLICK:e.cityItemClick,SOMEONE_FAIL2:e.onSomeOneFail2,SOMEONE_FAIL:e.onSomeOneFail,V_UPDATE_CITY_VIEW:e.updataCityView},SceneGEvts:{ENTER_SCENE:e.onEnterScene,CLICK_HERO:e.clickRole},InstanceEvts:{G_STOP_PLAY:e.playStop},ChatEvts:{OPEN_CHAT2:e.openMianBottom},TriggerEvts:{C_TRIGGER_OPEN:e.moduleOpen}},e.handels={ClashDataResp:e.clashDataResp,ClashEnterResp:e.clashEnterResp,ClashLeaveResp:e.clashLeaveResp,ClashNodeNotify:e.clashNodeNotify,ClashBattleSituationResp:e.clashBattleSituationResp,ClashNodeViewResp:e.clashNodeViewResp,ClashMoveResp:e.clashMoveResp,ClashPlayerViewResp:e.clashPlayerViewResp,ClashBattleResp:e.clashBattleResp,ClashPersonCounterResp:e.clashCounterResp,ClashGuildCounterResp:e.clashCounterResp,ClashSupplyStaminaResp:e.clashSupplyStaminaResp,ClashBuyResp:e.clashBuyResp,ClashOutputNotify:e.clashOutputMsg,ClashNewBattle:e.clashNewBattle,ClashRankResp:e.clashRankResp,ClashNodeRankResp:e.clashNodeRankResp,ClashNodeRateNotify:e.clashNodeRateNotify,ClashReceiveResp:e.clashReceiveResp,ClashMoveNotify:e.clashMoveNotify,ClashUpdateSlotNotify:e.nodeNewPlayerNotify,ClashFirstOpenNotify:e.clashFirstOpenNotify,ClashGatherResp:e.clashGatherResp,ClashCancelGatherResp:e.clashCancelGatherResp,ClashGatherChanged:e.clashGatherChanged,ClashGroupResp:e.clashGroupResp,ClashTaskAwardResp:e.clashTaskAwardResp,ClashProgressAwardResp:e.clashProgressAwardResp,ClashEnemyMsg:e.clashEnemyMsg,ClashNewGuildEnemyMsg:e.clashNewGuildEnemyMsg}},reconnect:function(){this.sender.ClashDataReq()},updataCityView:function(){this.send(this.Evts.V_UPDATE_CITY_VIEW2)},openMianBottom:function(){this.send(this.Evts.C_MOVE_MAIN_BOTTOM)},triggerOpen:function(e){e==this.moduleEnum&&this.sender.ClashDataReq()},moduleOpen:function(e){e.data==this.moduleEnum&&this.sender.ClashDataReq()},notify:function(e,t,a){var i=this;switch(e){case i.Evts.C_SELECT_CITY:i.moduleData.updateGatherCity(t),i.send(i.Evts.C_SELECT_CITY);break;case i.Evts.C_GET_TASK_PRO_REWARD:i.sender.ClashProgressAwardReq(t);break;case i.Evts.C_GET_TASK_REWARD:i.sender.ClashTaskAwardReq(t);break;case i.Evts.V_COUNTER_ATTACK:i.counterAttack(t,a);break;case i.Evts.C_CLOSE_SEASETTLE:i.closeSeaSettle();break;case i.Evts.C_CLOSE_CITYVIEW:i.closeOpenCityView();break;case i.Evts.ENTER_SETTLEMENT:i.enterSettlement()}},closeOpenCityView:function(){this.sender.ClashNodeViewReq(this.moduleData.nodeId),game.module.show(game.ME.GuildConflictCity)},closeSeaSettle:function(){b8e.module.isShowView(game.ME.GuildConflictSeaSettle)&&game.module.hide(game.ME.GuildConflictSeaSettle)},enterGuildConflict:function(){var e=game.moduleOpen.checkOpenWithTips(this.moduleEnum);e&&(game.sceneData.isCsScene()?game.notice.show(53690):(this.moduleData.updateSeasonState(),e&&this.moduleData.seasonState==game.GuildConflictSeasonStates.SETTLEMENT?this.sender.ClashNodeRankReq():this.sender.ClashEnterReq()))},clashDataResp:function(e){var t=e.readProtobuf(game.pb.ClashDataResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setData(t),this.checkTaskSpotAlert(),this.spotAlert.alert=t.open,this.send(this.Evts.C_UPDATE_MAIN_VIEW),0<t.clashId&&(this.updataFood(),this.updataWarToken()))},clashNewGuildEnemyMsg:function(e){var t=e.readProtobuf(game.pb.ClashNewGuildEnemyNotify);0<t.code?game.notice.noticeError(t.code):this.moduleData.updatGuildEnemy(t)},clashEnemyMsg:function(e){var t=e.readProtobuf(game.pb.ClashEnemyNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.mainRoleData.id;t.roleId!=a&&this.moduleData.updataEnemyInfo(t)}},updataFood:function(){var e=this.moduleData.clashFoodInterval,t=this.moduleData.foodsRefreshTime+6e4*e,a=(this.moduleData.foodsRefreshTime=t)-game.SysTime.curTime;a<=0||(this.timer=b8e.setTimeout(this.setCountDown,this,a))},setCountDown:function(){this.moduleData.foods>=this.moduleData.clashFood||(this.moduleData.foods+=1,this.updataFood(),this.send(this.Evts.C_UPDATE_RESOURCES))},setCountDown2:function(){this.moduleData.warToken>=this.moduleData.clashWarToken||(this.moduleData.warToken+=1,this.updataWarToken(),this.send(this.Evts.C_UPDATE_RESOURCES))},updataWarToken:function(){var e=this.moduleData.clashWarTokenInterval,t=this.moduleData.warTokenRefreshTime+6e4*e,a=(this.moduleData.warTokenRefreshTime=t)-game.SysTime.curTime;a<=0||b8e.setTimeout(this.setCountDown2,this,a)},clashEnterResp:function(e){var t=this,a=e.readProtobuf(game.pb.ClashEnterResponse);0<a.code?game.notice.noticeError(a.code):(t.moduleData.gatherId=a.gatherId,t.moduleData.nodeId=a.nodeId,game.guildConflictScene.enterScene(),a.clashId!=t.moduleData.id&&(t.moduleData.resetData(),t.sender.ClashDataReq(),t.showSeasonStage()),0==t.moduleData.id&&t.sender.ClashDataReq(),t.sender.ClashBattleSituationReq(),t.moduleData.updateEnterData(a),t.checkTaskSpotAlert(),t.send(t.Evts.C_UPDATE_MAIN_VIEW))},clashLeaveResp:function(e){var t=e.readProtobuf(game.pb.ClashLeaveResponse);0<t.code&&game.notice.noticeError(t.code)},clashNodeNotify:function(e){var t=e.readProtobuf(game.pb.ClashNodeMsg);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateAllNode(t.allNode),this.send(this.Evts.C_UPDATE_GATHER))},onMoveEnd:function(){var e=this;e.moduleData.canClick=!0,e.moduleData.nodeId=e.moduleData.cityId,e.moduleData.updataMyCityGoldPiont(e.moduleData.aflertNodeId),e.moduleData.updataMyCityGoldPiont(e.moduleData.cityId),e.moduleData.needBackBronCity?(e.moduleData.needBackBronCity=!1,e.onbackBronCity(e.moduleData.backNodeId)):e.openCitySolt(e.moduleData.cityId)},clashBattleSituationResp:function(e){var t=e.readProtobuf(game.pb.ClashBattleSituationResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateBattleSituation(t),this.dpt(this.Evts.C_BATTLE_SITUATION))},clashNodeViewResp:function(e){var t=e.readProtobuf(game.pb.ClashNodeViewResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateCitySlotInfo(t),this.send(this.Evts.C_UPDATE_LOOK_CITY_INFO))},clashMoveResp:function(e){var t=e.readProtobuf(game.pb.ClashMoveResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateMoveData(t),this.moduleData.aflertNodeId=this.moduleData.nodeId,this.moduleData.canClick=!1,game.guildConflictScene.move(this.moduleData.cityId),b8e.module.isShowView(game.ME.GuildConflictCity)&&game.module.hide(game.ME.GuildConflictCity),this.updataFood(),this.send(this.Evts.C_UPDATE_RESOURCES))},clashPlayerViewResp:function(e){var t=e.readProtobuf(game.pb.ClashPlayerViewResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateViewPlayerInfo(t),this.send(this.Evts.UPDATE_LOOK_PLAY_INFO))},clashBattleResp:function(e){var t=e.readProtobuf(game.pb.ClashBattleResponse);if(0<t.code)game.notice.noticeError(t.code);else{if(this.moduleData.updateBattleResultInfo(t),1==t.types){if(t.battlelog){var a=1==t.win,i={type:game.InstanceType.guildConflict,isWin:a};game.playBack.play(t.battlelog,i)}this.moduleData.updateTaskPro(1)}else 5==t.types&&(b8e.module.isShowView(game.ME.GuildConflictSweep)||game.module.show(game.ME.GuildConflictSweep),this.moduleData.updateTaskPro(t.battleTimes),this.send(this.Evts.C_SWEEP_BATTLE_FIVE));b8e.module.isShowView(game.ME.GuildConflictBattle)&&game.module.hide(game.ME.GuildConflictBattle),this.checkTaskSpotAlert(),this.updataWarToken(),this.send(this.Evts.C_UPDATE_RESOURCES)}},clashCounterResp:function(e){var t=e.readProtobuf(game.pb.ClashCounterResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.types;if(0==t.nodeId)a==game.GuildConflictAttackTypes.RIVAL?game.notice.show(53502):game.notice.show(53503);else{var i=game.guildConflictScene;game.module.hide(game.ME.GuildConflictWarSitua);var n=i.getCityById(t.nodeId);i.setCameraFocus(n),this.openCityHandler(t.nodeId)}}},clashSupplyStaminaResp:function(e){var t=e.readProtobuf(game.pb.ClashSupplyStaminaResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateStamina(t),this.send(this.Evts.C_UPDATE_RESOURCES))},clashBuyResp:function(e){var t=e.readProtobuf(game.pb.ClashBuyResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateResources(t),this.send(this.Evts.C_UPDATE_RESOURCES))},clashOutputMsg:function(e){var t=e.readProtobuf(game.pb.ClashOutputMsg);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateOutput(t),this.send(this.Evts.C_UPDATA_OUTPUT))},clashNewBattle:function(e){var t=e.readProtobuf(game.pb.ClashNewBattleNotify);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.updateBattleLog(t);var a=t.node;if(0<a)game.sceneData.isGuildConflict()&&game.guildConflictScene.isRoleMoveing()?(this.moduleData.needBackBronCity=!0,this.moduleData.backNodeId=a):this.onbackBronCity(a);this.setBattleLogAlert(!0),this.send(this.Evts.C_UPDATE_STAMINA)}},clashRankResp:function(e){var t=e.readProtobuf(game.pb.ClashRankResponse);0<t.code?game.notice.noticeError(t.code):this.moduleData.updateRank(t)},clashNodeRankResp:function(e){var t=e.readProtobuf(game.pb.ClashNodeRankResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateNodeRank(t),game.module.show(game.ME.GuildConflictSeaSettle),this.send(this.Evts.C_UPDATA_NODE_RANK),this.spotAlert.alert=!1)},clashNodeRateNotify:function(e){var t=e.readProtobuf(game.pb.ClashNodeRateMsg);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateCityRate(t.state),this.send(this.Evts.C_UPDATA_CITY_RATE))},clashReceiveResp:function(e){var t=e.readProtobuf(game.pb.ClashReceiveResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateOutput2(0),this.send(this.Evts.C_UPDATA_OUTPUT))},clashMoveNotify:function(e){var t=e.readProtobuf(game.pb.ClashMoveMsg);0<t.code?game.notice.noticeError(t.code):(this.moduleData.nodeId=t.node,this.moduleData.updateCityMoveOld(t),this.send(this.Evts.C_UPDATA_MOVE_OLD))},nodeNewPlayerNotify:function(e){var t=e.readProtobuf(game.pb.ClashUpdateSlotMsg);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateCityMoveNew(t),this.send(this.Evts.C_UPDATA_MOVE_NEW))},clashFirstOpenNotify:function(e){e.readProtobuf(game.pb.ClashFirstOpenMsg)&&game.moduleOpen.checkOpen(this.moduleEnum)&&(this.moduleData.isFirstOpen=!0,this.spotAlert.alert=!0)},clashGatherResp:function(e){var t=e.readProtobuf(game.pb.ClashGatherResponse);0<t.code&&game.notice.noticeError(t.code)},clashCancelGatherResp:function(e){var t=e.readProtobuf(game.pb.ClashCancelGatherResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateGatherCity(0),this.moduleData.updateGatherCityInfo(),this.send(this.Evts.C_UPDATE_GATHER))},clashGatherChanged:function(e){var t=e.readProtobuf(game.pb.ClashGatherMsg);0<t.code?game.notice.noticeError(t.code):(this.moduleData.alfterGatherId=this.moduleData.gatherId,this.moduleData.updateGatherCityInfo2(this.moduleData.alfterGatherId),this.moduleData.gatherId=t.id,this.moduleData.updateGatherCity(t.id),this.moduleData.updateGatherCityInfo(),this.send(this.Evts.C_UPDATE_GATHER))},clashGroupResp:function(e){var t=e.readProtobuf(game.pb.ClashGroupResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.initGroupInfo(t.group),this.send(this.Evts.C_UPDATE_SEASON_STAGE))},clashTaskAwardResp:function(e){var t=e.readProtobuf(game.pb.ClashTaskAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateCompleteTask(t),this.checkTaskSpotAlert(),this.send(this.Evts.C_UPDATE_TASK))},clashProgressAwardResp:function(e){var t=e.readProtobuf(game.pb.ClashProgressAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.updateTaskProReward(t),this.checkTaskSpotAlert(),this.send(this.Evts.C_UPDATE_TASK_PRO);var a=game.ClashTaskAwardCfg.getData(t.num);a&&(game.awardsData.setItemsByArray(a.awards,!0),game.module.show(game.ME.AwardShowTip))}},enterSettlement:function(){this.sender.ClashLeaveReq(),game.guildConflictScene.leaveScene(),this.spotAlert.alert=!1},onSceneMove:function(){this.send(this.Evts.SCENE_TOUCH_MOVE)},onRoleMove:function(){this.send(this.Evts.ROLE_MOVE)},onEnterScene:function(){game.sceneData.getSceneType()==game.SceneType.GUILD_CONFLICT&&0==this.moduleData.id&&this.sender.ClashDataReq()},clickRole:function(){game.sceneData.getSceneType()==game.SceneType.GUILD_CONFLICT&&(game.guildConflictScene.isRoleMoveing()||this.openCitySolt(this.moduleData.nodeId))},showMainView:function(){var e=b8e.module.isShowView(game.ME.GuildConflictMain),t=b8e.module.isShowView(game.ME.GuidConflictChat);game.sceneData.getSceneType()==game.SceneType.GUILD_CONFLICT&&!e&&!t&&(game.module.show(this.moduleEnum),game.module.show(game.ME.GuidConflictChat))},counterAttack:function(e){var t=e.data,a=t.type,i=t.id;a==game.GuildConflictAttackTypes.RIVAL?this.sender.ClashPersonCounterReq(i):this.sender.ClashGuildCounterReq(i)},onbackBronCity:function(e){this.moduleData.alfterNodeId=this.moduleData.nodeId,this.moduleData.nodeId=e;var t=game.guildConflictScene;if(t.clearPathData(),game.sceneData.isGuildConflict()&&!game.playBack.isInstanceFighting()){var a=t.getCityById(e);a&&(game.mainRole.setPosition(a.x,a.y),this.moduleData.updataMyCityGoldPiont(this.moduleData.alfterNodeId),this.moduleData.updataMyCityGoldPiont(e))}},onbackBronCity2:function(){var e=game.guildConflictData.backBirthId;this.onbackBronCity(e)},onSomeOneFail:function(e){var t=e.data;b8e.module.isShowView(game.ME.GuildConflictCity)&&game.module.hide(game.ME.GuildConflictCity),this.onSomeOneFail2(),1==t?game.module.show(game.ME.GuildConflictFail):2==t&&game.notice.show(game.Lang.get(53423))},onSomeOneFail2:function(){b8e.module.isShowView(game.ME.GuildConflictSweep)&&game.module.hide(game.ME.GuildConflictSweep)},onRecriveGold:function(e){var t=e.data;this.sender.ClashReceiveReq(t)},resetGatherId:function(){this.moduleData.gatherId=0},narrowBtn:function(){game.guildConflictScene.setCameraDistance(800),this.send(this.Evts.C_CHANGE_BTN_STATE,2)},enlargeBtn:function(){game.guildConflictScene.setCameraDistance(1e3),this.send(this.Evts.C_CHANGE_BTN_STATE,1)},backBtn:function(){this.moduleData.canClick?(game.guildConflictScene.leaveScene(),this.sender.ClashLeaveReq(),this.dpt(this.Evts.C2C_CLOSR_ACT)):game.notice.show(53691)},gatherBtn:function(){game.module.show(game.ME.GuildConflictGather)},focusToGatherBtn:function(){var e=game.guildConflictScene,t=e.getCityById(this.moduleData.gatherId);t&&e.setCameraFocus(t)},taskBtn:function(){game.module.show(game.ME.GuildConflictTask)},battleDetailsBtn:function(){this.moduleData.clearRankInfo(),this.sender.ClashBattleSituationReq(),game.module.show(game.ME.GuildConflictWarSitua)},rankBtn:function(){this.sender.ClashRankReq(),game.module.show(game.ME.GuildConflictRank)},occupiedBtn:function(){game.module.show(game.ME.GuildConflictOccupyRank)},arrowBtn:function(){game.guildConflictScene.setCameraFocus(game.mainRole)},cityTypeBtn1:function(){this.send(this.Evts.C_SELECT_CITY_TYPE,2)},cityTypeBtn2:function(){this.send(this.Evts.C_SELECT_CITY_TYPE,3)},cityTypeBtn3:function(){this.send(this.Evts.C_SELECT_CITY_TYPE,4)},selGatherTypeDownBtn:function(){this.send(this.Evts.C_SELECT_CITY_OPEN,1)},selGatherTypeUpBtn:function(){this.send(this.Evts.C_SELECT_CITY_OPEN,2)},detailsBtn:function(){this.showSeasonStage()},showSeasonStage:function(){var e=this.moduleData.getGroupInfos();(!e||e.length<1)&&this.sender.ClashGroupReq(),game.module.show(game.ME.GuildConflictSeasonStage)},sureGatherBtn:function(){var e=this;if(game.guildData.isLeader()){var t=e.moduleData.curSelGatherId,a=e.moduleData.gatherId;if(t!=a||0==a)if(0!=t)if(game.amount.get(game.AmountType.YUAN_BAO)<e.moduleData.clashGather)game.notice.show(116);else{e.gatherAlert||(e.gatherAlert={btn:game.Lang.get(9059),okcb:e.alertSureGather,thisArg:e});var i=e.moduleData.getCityInfosById(t);if(i){var n=i.cfg,s=game.HtmlUtil.getColorStrByQuality(n.quality,n.name,!0);if(0<a){var r=e.moduleData.getCityInfosById(a);if(!r)return;var o=r.cfg,g=game.HtmlUtil.getColorStrByQuality(o.quality,o.name,!0);e.gatherAlert.lang=53455,e.gatherAlert.langArgs=[g,s]}else e.gatherAlert.lang=game.Lang.get(53454,s),e.gatherAlert.langArgs=s;game.alert.show(e.gatherAlert)}}else game.notice.show(53453);else game.notice.show(53564)}else game.notice.show(53452)},alertSureGather:function(){this.sender.ClashGatherReq(this.moduleData.curSelGatherId)},cancelGatherBtn:function(){if(game.guildData.isLeader()){this.cancelGatherAlert||(this.cancelGatherAlert={btn:game.Lang.get(9059),okcb:this.alertCancelGather,thisArg:this});var e=this.moduleData.gatherId,t=this.moduleData.getCityInfosById(e);if(t){var a=t.cfg,i=game.HtmlUtil.getColorStrByQuality(a.quality,a.name);this.cancelGatherAlert.lang=53504,this.cancelGatherAlert.langArgs=i,game.alert.show(this.cancelGatherAlert)}}else game.notice.show(53452)},alertCancelGather:function(){this.sender.ClashCancelGatherReq()},onOpenCity:function(e){if(this.moduleData.startTouchCity=!1,this.moduleData.touchMoved)this.moduleData.touchMoved=!1;else{var t=e.data;this.openCitySolt(t)}},onTouchCityStart:function(){this.moduleData.startTouchCity=!0},openCitySolt:function(e){this.openCityHandler(e)},openCityHandler:function(e){this.sender.ClashNodeViewReq(e),this.moduleData.cityId=e,b8e.module.isShowView(game.ME.GuildConflictCity)||game.module.show(game.ME.GuildConflictCity)},canAttackBtn:function(){this.selecIndex(1)},rivalBtn:function(){this.selecIndex(2)},selecIndex:function(e){e==this.moduleData.selectCityBox&&(e=0),game.guildConflictData.pageNum=1,this.moduleData.selectCityBox=e,this.send(this.Evts.C_CHANGE_CITY_BOX,e)},intoBtn:function(){0==this.moduleData.stamina?game.module.show(game.ME.GuildConflictAddPower):game.module.show(game.ME.GuildConflictCityMove)},cityItemClick:function(e){var t=e.data,a=this.moduleData.getSelfInClickCity(),i=this.moduleData.getClickIsSelf(t);if(t){if(i)return void game.notice.show(game.Lang.get(53416));this.sender.ClashPlayerViewReq(t.playerInfo.roleId),this.moduleData.cityClickData=t,game.module.show(game.ME.GuildConflictBattle)}else{if(a)return void game.notice.show(game.Lang.get(53417));this.intoBtn()}},left_btn:function(){this.moduleData.gotoPerRankPage(),this.send(this.Evts.UPDATE_DATA_CITY_LIST)},right_btn:function(){this.moduleData.gotoNextRankPage(),this.send(this.Evts.UPDATE_DATA_CITY_LIST)},addPowerBtn1:function(){this.sendAddPower(50),this.closePowerView()},addPowerBtn2:function(){this.sendAddPower(100),this.closePowerView()},closePowerView:function(){b8e.module.isShowView(game.ME.GuildConflictAddPower)&&game.module.hide(game.ME.GuildConflictAddPower)},sendAddPower:function(e){return this.moduleData.foods<e?(this.moduleData.openTpyeBuy=1,void game.module.show(game.ME.GuildConflictBuyFoods)):(this.sender.ClashSupplyStaminaReq(e),void(b8e.module.isShowView(game.ME.GuildConflictCityMove)&&game.module.hide(game.ME.GuildConflictCityMove)))},moveInSureBtn:function(){var e=this.moduleData.moveFood;if(this.moduleData.getSelfInClickCity())game.notice.show(game.Lang.get(53417));else{if(!e)return this.moduleData.openTpyeBuy=1,void game.module.show(game.ME.GuildConflictBuyFoods);var t=game.guildConflictScene.getMovePath(this.moduleData.cityId)||[];this.sender.ClashMoveReq(t),b8e.module.isShowView(game.ME.GuildConflictCityMove)&&game.module.hide(game.ME.GuildConflictCityMove)}},addBtn:function(){this.send(this.Evts.C_BUY_NUM_ADD,1)},lessBtn:function(){this.send(this.Evts.C_BUY_NUM_ADD,-1)},lessTenBtn:function(){this.send(this.Evts.C_BUY_NUM_ADD,-10)},addTenBtn:function(){this.send(this.Evts.C_BUY_NUM_ADD,10)},addMaxBtn:function(){this.send(this.Evts.C_BUY_NUM_ADD,999)},buyBtn2:function(){var e=game.guildConflictData.tiliBuyNum;game.guildConflictData.foods<e?(this.moduleData.openTpyeBuy=1,game.module.show(game.ME.GuildConflictBuyFoods)):this.sender.ClashSupplyStaminaReq(e),game.module.hide(game.ME.GuildConflictBuyGoods)},buyBtn:function(){var e=game.guildConflictData.tiliBuyNum,t=game.guildConflictData.openTpyeBuy;this.sender.ClashBuyReq(t,e),game.module.hide(game.ME.GuildConflictBuyFoods)},addBtnBat:function(){this.openZhanLinBuy()},openZhanLinBuy:function(){this.moduleData.openTpyeBuy=2,game.module.show(game.ME.GuildConflictBuyFoods)},gotoBtn:function(){this.intoBtn(),game.module.hide(game.ME.GuildConflictBattle)},battleBtn:function(){this.setBattle(1)},battleFiveBtn:function(){this.sweepFiveNum()},setBattle:function(e){var t=game.guildConflictData.warToken,a=this.moduleData.cityClickData;if(a){if(this.moduleData.getIsFirend(a))return game.notice.show(53419);var i=a.playerInfo.roleId;t<this.moduleData.getChangeNeedNum(1)?this.openZhanLinBuy():(this.senderChallenge(i,e),game.module.hide(game.ME.GuildConflictBattle))}},senderChallenge:function(e,t){var a=game.guildConflictData.getShorBirthId();this.dpt(this.Evts.C2C_SET_FORMATION,[game.ME.GuildConflictMain,e,this.sender.ClashBattleReq,[t,e,a],this])},playStop:function(e){if(e){var t=e.data;this.showResultView(t)}},showResultView:function(e){e.type==game.InstanceType.guildConflict&&(game.mainRole.onHierarchyVisible(!1),game.module.show(game.ME.GuildConflictResult))},details_btn:function(){game.module.show(game.ME.BattleDetails)},onShowFailTip:function(){game.module.show(game.ME.GuildConflictFail)},battleFiveBtn2:function(){this.sweepFiveNum()},sweepFiveNum:function(){var e=this.moduleData.warToken,t=this.moduleData.getChangeNeedNum(5),a=this.moduleData.cityClickData;if(a){if(this.moduleData.getIsFirend(a))return game.notice.show(53419);if(e<t)this.openZhanLinBuy();else{var i=a.playerInfo.roleId,n=game.guildConflictData.getShorBirthId();this.sender.ClashBattleReq(5,i,n),game.module.hide(game.ME.GuildConflictCity)}}},returnBtn2:function(){b8e.module.isShowView(game.ME.GuildConflictSweep)&&game.module.hide(game.ME.GuildConflictSweep)},rankBtnSea:function(){this.rankBtn()},occupiedBtnSea:function(){this.occupiedBtn()},warorderAddBtn:function(){this.openZhanLinBuy()},foodAddBtn:function(){this.moduleData.openTpyeBuy=1,game.module.show(game.ME.GuildConflictBuyFoods)},powerAddBtn:function(){var e=this.moduleData.stamina,t=this.moduleData.clashStamina,a=this.moduleData.nodeId,i=this.moduleData.getCityInfosById(a);t<=e?game.notice.show(game.Lang.get(53461)):e<t&&i.cfg.types!=game.GuildConflictCityTypes.NODE_BIRTH?game.notice.show(game.Lang.get(53462)):game.module.show(game.ME.GuildConflictBuyGoods)},checkTaskSpotAlert:function(){this.taskAlert.alert=this.moduleData.canGetTaskReward()||this.moduleData.canGetTaskProReward()},setBattleLogAlert:function(e){this.battleLogAlert.alert=e,this.checkTaskSpotAlert()},hideBattleLogAlert:function(){this.setBattleLogAlert(!1)}}),t=[game.ME.GuildConflictCity,game.ME.GuildConflictAddPower,game.ME.GuildConflictBuyGoods,game.ME.GuildConflictCityMove,game.ME.GuildConflictBuyFoods,game.ME.GuildConflictBattle,game.ME.GuildConflictSweep,game.ME.GuildConflictResult,game.ME.GuildConflictGather,game.ME.GuildConflictSeasonStage,game.ME.GuildConflictTask,game.ME.GuildConflictFail,game.ME.GuildConflictSeaSettle],a=game.Sender.extends({ipc:function(){var e=this;e.msg={ClashDataReq:null,ClashEnterReq:null,ClashBattleSituationReq:null,ClashNodeViewReq:e.clashNodeViewReq,ClashMoveReq:e.clashMoveReq,ClashPlayerViewReq:e.clashPlayerViewReq,ClashBattleReq:e.clashBattleReq,ClashPersonCounterReq:e.clashPersonCounterReq,ClashGuildCounterReq:e.clashGuildCounterReq,ClashSupplyStaminaReq:e.clashSupplyStaminaReq,ClashBuyReq:e.clashBuyReq,ClashRankReq:null,ClashNodeRankReq:null,ClashLeaveReq:null,ClashReceiveReq:e.clashReceiveReq,ClashGatherReq:e.clashGatherReq,ClashCancelGatherReq:null,ClashGroupReq:null,ClashTaskAwardReq:e.clashTaskAwardReq,ClashProgressAwardReq:e.clashProgressAwardReq}},clashNodeViewReq:function(e){var t=game.pb.ClashNodeViewRequest;t.nodeId=e,this.write(t)},clashMoveReq:function(e){var t=game.pb.ClashMoveRequest;t.route=e,this.write(t)},clashPlayerViewReq:function(e){var t=game.pb.ClashPlayerViewRequest;t.roleId=e,this.write(t)},clashBattleReq:function(e,t,a){var i=game.pb.ClashBattleRequest;i.types=e,i.roleId=t,i.near=a,this.write(i)},clashPersonCounterReq:function(e){var t=game.pb.ClashPersonCounterRequest;t.roleId=e,this.write(t)},clashGuildCounterReq:function(e){var t=game.pb.ClashGuildCounterRequest;t.guildId=e,this.write(t)},clashSupplyStaminaReq:function(e){var t=game.pb.ClashSupplyStaminaRequest;t.num=e,this.write(t)},clashBuyReq:function(e,t){var a=game.pb.ClashBuyRequest;a.types=e,a.num=t,this.write(a)},clashReceiveReq:function(e){var t=game.pb.ClashReceiveRequest;t.num=e,this.write(t)},clashTaskAwardReq:function(e){var t=game.pb.ClashTaskAwardRequest;t.id=e,this.write(t)},clashProgressAwardReq:function(e){var t=game.pb.ClashProgressAwardRequest;t.num=e,this.write(t)},clashGatherReq:function(e){var t=game.pb.ClashGatherRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.GuildConflictMain,e,game.GuildConflictEvts,a,t)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.guildConflictData},ipc:function(){this.evts={GuildConflictMain:{C_BATTLE_SITUATION:this.battleSitution}}},notify:function(e,t,a){switch(e){case this.Evts.UPDATE_BATTLELOG_ALERT:this.dpt(this.Evts.UPDATE_BATTLELOG_ALERT);break;case this.Evts.V_COUNTER_ATTACK:this.counterAttack(t,a)}},battleSitution:function(){this.send(this.Evts.C_BATTLE_SITUATION2)},battleLogBtn:function(){this.selectToggle(0)},rivalBtn:function(){this.selectToggle(1)},guildBtn:function(){this.selectToggle(2)},selectToggle:function(e){this.send(this.Evts.C_BATTLE_SITUA_TOGGLE,e)},counterAttack:function(e,t){this.data||(this.data={}),this.data.type=e,this.data.id=t,this.dpt(this.Evts.V_COUNTER_ATTACK,this.data)}}),t=[game.ME.GuildConflictBattleLog,game.ME.GuildConflictRival,game.ME.GuildConflictEnemie];b8e.module.registerControl(game.ME.GuildConflictWarSitua,e,game.GuildConflictEvts,null,t)}(),function(){var e;e=game.Control.extends({init:function(){this.moduleData=game.guildConflictData},marsRankBtn:function(){this.selectToggle(0)},richRankBtn:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.C_RANK_TOGGLE,e)}});var t=[game.ME.GuildConflictMarsRank,game.ME.GuildConflictRichRank];b8e.module.registerControl(game.ME.GuildConflictRank,e,game.GuildConflictEvts,null,t),b8e.RC("$$game","$$GuildConflictRankControl",e)}(),function(){var e;e=game.Control.extends({init:function(){this.moduleData=game.guildConflictData},cityOccupyBtn:function(){this.selectToggle(0)},occupyRewBtn:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.C_OCCUPY_TOGGLE,e)}});var t=[game.ME.GuildConflictCityOccupy,game.ME.GuildConflictOccupyRew];b8e.module.registerControl(game.ME.GuildConflictOccupyRank,e,game.GuildConflictEvts,null,t),b8e.RC("$$game","$$GuildConflictOccupyControl",e)}(),function(){var e=b8e.Object.extends({pathmatirx:null,shortPathTable:null,startPoint:0,moveIndex:0,movePathIndex:0,ctor:function(){this.pathmatirx=[],this.shortPathTable=[],this.startPoint=0,this.moveIndex=0},createCity:function(){var e=this;if(!e._scene){e._scene=b8e.scene;var t=e._scene.getViewDisplay();b8e.evt.onTouchStart(t,e._onTouchBegan,e),b8e.evt.onTouchEnd(t,e._onTouchEnd,e),b8e.evt.onTouchCancel(t,e._onTouchCancelled,e),b8e.evt.onTouchMove(t,e._onTouchMove,e)}var a=game.guildConflictData.getCityInfos();if(a)for(var i=void 0,n=void 0,s=void 0,r=a.length,o=0;o<r;o++)(i=(s=a[o]).cfg)&&((n=game.GuildConflictCity.get(game.RoleType.GuildConflictCity,i.id)).isUniqueId=!0,n.clearDisabled=!1,n.setTouchable(!0),n.setData(s),e._scene.addDisplay(n,-1e4,!1,!0,!0),n.setScenePosition(i.posX,i.posY))},getCityById:function(e){return this._scene.getDisplayByTypeAndId(game.RoleType.GuildConflictCity,e)},_onTouchBegan:function(e){var t=e.target,a=e.touch.getLocation();t.hitTest(a)&&(this._startTouch||(this._startTouch=!0,this._lastPos=a))},_onTouchEnd:function(e){var t=e.target,a=e.touch.getLocation();t.hitTest(a)&&(this._lastPos=null,this._touchMoved&&e.stopPropagation(),this._startTouch=!1,this._touchMoved&&(this._touchMoved=!1),this.moduleData.startTouchCity||(this.moduleData.touchMoved=!1))},_onTouchCancelled:function(){this._lastPos=null,this._startTouch=!1,this._touchMoved&&(this._touchMoved=!1)},_onTouchMove:function(e){var t=this,a=e.touch.getLocation();if(t._lastPos){t.location=a,t.offsetMapX=t._lastPos.x-a.x,t.offsetMapY=a.y-t._lastPos.y,t.moduleData.startTouchCity&&(0<Math.abs(t.offsetMapX)-5||0<Math.abs(t.offsetMapY)-5)&&(t.moduleData.touchMoved=!0),t._lastPos=t.location,t._endPos=t.location,t._touchMoved=!0;var i=t._scene.getCamera();t.glposX=i.focusX+t.offsetMapX,t.glposY=i.focusY+t.offsetMapY,i.setFocus(t.glposX,t.glposY),b8e.evt.dptG(game.GuildConflictEvts.SCENE_TOUCH_MOVE)}},enterScene:function(){this.moduleData=game.guildConflictData,game.mainProcess.runSceneProcess(this.moduleData.mapId),game.guildConflictScene.createCity(),game.mainRole.onHierarchyVisible(!1),game.sceneData.mapId=this.moduleData.mapId,this._isMapLoad?this.initEnterScene():b8e.scene.addEventListener(b8e.SceneEvent.SCENE_MAP_LOAD_COMPLETE,this.initEnterScene,this)},leaveScene:function(){game.sceneData.isGuildConflict()&&(game.mainRole.onHierarchyVisible(!0),this._scene.removeDisplayByType(game.RoleType.GuildConflictCity),game.mainProcess.runSceneProcess(game.mainInstanceData.mapId),this.glposX=this.glposY=null,this.moduleData.canClick=!0,this._isMapLoad&&b8e.scene.removeEventListener(b8e.SceneEvent.SCENE_MAP_LOAD_COMPLETE,this.initEnterScene,this))},initEnterScene:function(){var e=this.getCityById(this.moduleData.nodeId);if(e){var t=e.data.cfg;game.mainRole.setScenePosition(t.posX,t.posY),this.setCameraFocus(game.mainRole),this.setRoleFace(),this._isMapLoad=!0}},setCameraDistance:function(e){this._scene.getCamera().setDistance(e),this.setCameraFocus()},setCameraFocus:function(e){var t=0<arguments.length&&void 0!==e?e:null,a=this._scene.getCamera();if(t){var i=t.getScenePosition();a.setFocus(i.x,i.y),b8e.evt.dptG(game.GuildConflictEvts.SCENE_TOUCH_MOVE)}else this.glposX&&this.glposY&&a.setFocus(this.glposX,this.glposY)},setRoleFace:function(){var e=game.Direction.getRadian(game.Direction.DownRight);game.mainRole.setFaceRadian(e)},isRoleMoveing:function(){var e=game.mainRole.getStateMachine();return!!e&&e.isWalkMoving()},move:function(e){if(this.moduleData.currPathNodeId=this.moduleData.nodeId,this.movePathArr=this.getMovePath(e),this.movePathArr&&!(this.movePathArr.length<1)){var t=this.movePathArr[this.movePathIndex];this.moveToNext(t),b8e.evt.dptG(game.GuildConflictEvts.ROLE_MOVE)}},moveToNext:function(e){var t=this,a=t.moduleData.currPathNodeId,i=t.getCityById(e);if(i){var n=[i.gridX,i.gridY];t.pathPoints||(t.pathPoints=[]);var s=t.moduleData.getPathPoints(a,e);s&&t.pathPoints.push.apply(t.pathPoints,s),e<a&&t.pathPoints.reverse(),t.pathPoints.push(n),t.startMove()}},startMove:function(){var e=this.pathPoints[this.moveIndex];e&&(this.gridPos||(this.gridPos={}),this.gridPos.x=e[0],this.gridPos.y=e[1],game.moveTo.selfMove(this.gridPos,!0,this._selfMoveComplete,this))},_selfMoveComplete:function(){var e=this,t=e.pathPoints.length-1;if(e.moveIndex==t){e.moveIndex=0,e.pathPoints.length=0,e.moduleData.currPathNodeId=e.movePathArr[e.movePathIndex],e.movePathIndex++;var a=e.movePathArr.length;if(e.movePathIndex<a)return void e.moveToNext(e.movePathArr[e.movePathIndex]);e.moduleData.nodeId=e.movePathArr[e.movePathIndex-1],e.clearPathData(),b8e.evt.dptG(game.GuildConflictEvts.MOVE_END)}else e.moveIndex++,e.startMove()},initMovePath:function(e){var t=this;(!t.pathArr||t.pathArr.length<1)&&t.initPathData();var a=void 0,i=void 0,n=t.pathArr.length;t.finalArr||(t.finalArr=[]);for(var s=t.finalArr.length=0;s<n;s++){t.finalArr[s]=0;var r=t.pathArr[e][s];r=r||100,t.shortPathTable[s]=r,t.pathmatirx[s]=e}t.shortPathTable[e]=0,t.finalArr[e]=1;for(var o=0;o<n;o++){i=100;for(var g=0;g<n;g++)!t.finalArr[g]&&t.shortPathTable[g]<i&&(a=g,i=t.shortPathTable[g]);t.finalArr[a]=1;for(var u=0;u<n;u++)!t.finalArr[u]&&i+t.pathArr[a][u]<t.shortPathTable[u]&&(t.shortPathTable[u]=i+t.pathArr[a][u],t.pathmatirx[u]=a)}},getMovePath:function(e){var t=this.moduleData.nodeId;--t,e-=1,this.pathmatirx.length<1&&this.initMovePath(t,e);for(var a=[],i=void 0,n=this.pathmatirx.length,s=this.pathmatirx[t],r=0;r<n&&e!=s;r++)i=e+1,a.push(i),e=this.pathmatirx[e];return a.reverse()},clearPathData:function(){this.movePathIndex=0,this.shortPathTable.length=0,this.pathmatirx.length=0},getStepByEndId:function(e){var t=this.moduleData.nodeId;return this.shortPathTable.length<1&&this.initMovePath(t-1,e-1),this.shortPathTable[e-1]},initPathData:function(){this.pathArr||(this.pathArr=[]);var e=game.ClashNodeCfg.getDatas();if(e){e.sort(function(e,t){return e.id-t.id});for(var t=void 0,a=void 0,i=void 0,n=e.length,s=0;s<n;s++){t=this.pathArr[s]=[],i=(a=e[s].next).length;for(var r=0;r<i;r++)t[a[r]-1]=1}}},getRoleIsVisible:function(){var e=b8e.stageHeight,t=b8e.stageWidth,a=this._scene.getCamera(),i=a.focusX,n=a.focusY,s=1e3==a.getDistance()?1:.8,r=game.mainRole.getScenePosition(),o=t/2*s,g=e/2*s,u=r.x>i-o&&r.x<i+o,l=r.y>n-g&&r.y<n+g;return u&&l},setEntityPos:function(e,t,a){var i=this.getCityById(e);i&&i.setScenePosition(t,a)}});game.guildConflictScene=game.guildConflictScene||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({self:null,opposite:null,win:!1,time:0,ctor:function(){this._super()},setData:function(e){this.self=e.self,this.opposite=e.opposite,this.win=e.win,this.time=e.time},clearData:function(){this.self=null,this.opposite=null,this.win=!1,this.time=0},recycle:function(){this.clearData(),this._super()}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildConflictBattleInfo",t)}(),function(){var e;e=b8e.Object.extends({types:0,selfBefore:0,selfAfter:0,targetBefore:0,targetAfter:0,win:0,battlelog:null,node:0,battleLogs:null,battleTimes:0,ctor:function(){this._super()},setData:function(e){var t=this;t.types=e.types,t.selfBefore=e.selfBefore,t.selfAfter=e.selfAfter,t.targetAfter=e.targetAfter,t.targetBefore=e.targetBefore,t.win=e.win,t.node=e.node,t.battleLogs=e.battleLogs,t.battleTimes=e.battleTimes||0,t.battlelog=e.battlelog},clearData:function(){var e=this;e.types=0,e.selfBefore=0,e.selfAfter=0,e.targetBefore=0,e.targetAfter=0,e.win=0,e.battlelog=null,e.node=0,e.battleTimes=0,e.battleLogs=null}}),b8e.RC("$$game","$$GuildConflictBattleResultInfo",e)}(),function(){var e;e=b8e.Object.extends({id:0,count:0,rate:0,guildId:0,guildName:null,guildZone:0,guildColorId:0,exclusive:!1,overload:!1,isGatherCity:!1,name:"",cfg:null,slotInfos:null,ctor:function(){this._super(),this.slotInfos=[]},setData:function(e){this.id=e.id,this.count=e.count,this.rate=e.rate,this.guildId=e.guildId,this.guildName=e.guildName,this.guildZone=e.guildZone,this.guildColorId=e.guildColorId,this.exclusive=e.exclusive,this.overload=e.overload},updateSlotInfo:function(e){if(e){0<this.slotInfos.length&&game.guildConflictData.clearList(this.slotInfos);for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)t=e[n],(a=game.GuildConflictSlotInfo.get()).setData(t),this.slotInfos.push(a)}},updataRata:function(e){this.rate=e},deleteSlotByid:function(e){var t=this.slotInfos,a=t.length;if(0!=a)for(var i=0;i<a;i++)if(t[i].playerInfo.roleId==e){this.slotInfos.splice(i,1),this.count--;break}},pushInfoInSlot:function(e){var t=this.slotInfos,a=t.length;if(0==t.length){var i=game.GuildConflictSlotInfo.get();return i.setData(e),this.slotInfos.push(i),void this.count++}for(var n=void 0,s=0;s<a;s++)if((n=t[s]).playerInfo.roleId==e.playerInfo.roleId)return void n.setData(e);(n=game.GuildConflictSlotInfo.get()).setData(e),this.slotInfos.push(n),this.count++},getCanAttack:function(e){this.slotInfos||(this.slotInfos=[]);for(var t=this.slotInfos.length,a=game.mainRoleData.id,i=game.guildData.id,n=game.guildData.name,s=void 0,r=[],o=0;o<t;o++)s=this.slotInfos[o],1==e&&(0==i&&a!=s.playerInfo.roleId?r.push(s):a!=s.playerInfo.roleId&&n!=s.guildName&&r.push(s)),2==e&&s.enemy&&r.push(s);return r},getOccupyAwards:function(){return this.occupyAwards||(this.occupyAwards=[],this.getPrizeList(this.cfg.awards,this.occupyAwards)),this.occupyAwards},getBetterOccupyAwards:function(){return this.betterOccupyAwards||(this.betterOccupyAwards=[],this.getPrizeList(this.cfg.betterAwards,this.betterOccupyAwards)),this.betterOccupyAwards},getPrizeList:function(e,t){for(var a=e.length,i=void 0,n=void 0,s=0;s<a;s++)i=e[s],(n=game.ItemUtil.createBaseItemInfo(i.Id,i.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,n.iconSize=game.IconSizeEnum.SIZE_84,t.push(n)},clearData:function(){var e=this;e.id=0,e.count=0,e.rate=0,e.guildName="",e.guildZone=0,e.guildColorId=0,e.cfg=null,e.slotInfos=null,e.betterOccupyAwards.length=0,e.occupyAwards.length=0},recycle:function(){this.clearData(),this._super()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildConflictCityInfo",e)}(),function(){var e,t,a,i,n;n=b8e.Enum({$$NONE:0,$$NODE_BIRTH:1,$$NODE_COMMON:2,$$NODE_BIG:3,$$NODE_SUPER:4}),i=b8e.Enum({$$NONE:0,$$BATTLE_LOG:1,$$RIVAL:2,$$GUILD:3}),a=b8e.Enum({$$NONE:0,$$MARS:1,$$RICH:2}),t=b8e.Enum({$$NONE:0,$$OPENING:1,$$FIERCE:2,$$SETTLEMENT:3}),e=b8e.Enum({$$NONE:0,$$RIVAL:1,$$GUILD:2}),b8e.RC("$$game","$$GuildConflictCityTypes",n),b8e.RC("$$game","$$GuildConflictFoeTypes",i),b8e.RC("$$game","$$GuildConflictRankTypes",a),b8e.RC("$$game","$$GuildConflictSeasonStates",t),b8e.RC("$$game","$$GuildConflictAttackTypes",e)}(),function(){var e=b8e.Object.extends({id:0,isOpen:!1,tasks:null,seasonNum:0,seasonAwards:null,stamina:0,foods:0,foodsRefreshTime:0,warToken:0,warTokenRefreshTime:0,output:0,totalOutput:0,outputRefreshTime:0,win:0,isFirstOpen:!1,nodeId:1,gatherId:0,curSelGatherId:0,selGatherType:2,viewPlayerInfo:null,battleResultInfo:null,cityId:1,selectCityBox:0,pageNum:1,PER_PAGE_COUNT:9,moveFood:!1,seasonState:0,tiliBuyNum:0,openTpyeBuy:1,cityClickData:null,leader:null,nodeRankAry:null,nodeBirthAry:null,backBirthId:0,aflertNodeId:0,canClick:!0,alfterGatherId:0,alfterNodeId:0,isFirstRecCity:!0,personEnemyAfter:0,currPathNodeId:0,needBackBronCity:!1,backNodeId:0,mapId:500,ctor:function(){var e=this;e.cityInfoMap=b8e.HashMap.get(),e.cityTypeMap=b8e.HashMap.get(),e.battleLogInfos=[],e.personalEnemieInfos=[],e.guildEnemieInfos=[],e.marsRankInfos=[],e.richRankInfos=[],e.taskInfoMap=b8e.HashMap.get(),e.taskProRewInfos=[],e.tasks=[],e.seasonAwards=[],e.nodeRankAry=[],e.nodeBirthAry=[]},resetData:function(){var e=this;e.battleLogInfos.length=0,e.personalEnemieInfos.length=0,e.guildEnemieInfos.length=0,e.marsRankInfos.length=0,e.richRankInfos.length=0,e.taskInfoMap.clear(),e.taskProRewInfos.length=0,e.tasks.length=0,e.seasonAwards.length=0,e.nodeRankAry.length=0,e.nodeBirthAry.length=0,e.blesRefrechTime=0,e.seasonNum=0,e.win=0,e.totalOutput=0,e.foods=0,e.warToken=0,e.output=0,e.seasonNum=0,e.updateTaskOpenSate()},setData:function(e){var t=this;t.id=e.clashId,t.isOpen=e.open,t.tasks=e.tasks,t.seasonAwards=e.seasonAwards,t.stamina=e.stamina,t.foods=e.foods,t.foodsRefreshTime=e.foodsRefreshTime,t.warToken=e.warToken,t.warTokenRefreshTime=e.warTokenRefreshTime,t.output=e.output,t.totalOutput=e.totalOutput,t.outputRefreshTime=e.outputRefreshTime,t.win=e.win,t.seasonNum=e.seasonNum},updateEnterData:function(e){if(this.id=e.clashId,this.nodeId=e.nodeId||1,this.gatherId=e.gatherId,this.updateGatherCity(e.gatherId),this.updateAllNode(e.allNode),0<this.gatherId){var t=this.getCityInfoById(this.gatherId);if(!t)return;this.selGatherType=t.cfg.types}},updateAllNode:function(e){if(this.allNode=e,this.allNode)for(var t=void 0,a=void 0,i=this.allNode.length,n=0;n<i;n++)a=this.allNode[n],(t=this.getCityInfoById(a.id))&&(t.setData(a),this.updataCityShowExplicit(t))},updataCityShowExplicit:function(e){if(e&&game.sceneData.isGuildConflict()){var t=game.guildConflictScene.getCityById(e.id);t&&t.updataCityInfo(e)}},updataMyCityGoldPiont:function(e){var t=this.getCityInfoById(e);t&&this.updataCityShowExplicit(t)},updataMYInCityOutPut:function(){var e=this.getCityInfoById(this.nodeId);e&&this.updataCityShowExplicit(e)},updateCityRate:function(e){if(e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)i=e[n],(a=this.getCityInfoById(i.id))&&(a.updataRata(i.rate),this.updataCityShowExplicit(a))},updataEnemyInfo:function(e){e.roleId&&(this.updataPerEnemieInfos(e),this.updataMyCityGoldPiont(this.personEnemyAfter),this.updataMyCityGoldPiont(e.nodeId)),e.guildNode&&this.updataMyCityGoldPiont(e.guildNode)},updatGuildEnemy:function(e){var t=this.guildEnemieInfos,a=void 0;(a=game.GuildConflictGuildEnemyInfo.get()).setEnemyData(e),t.push(a),this.updataMyCityGoldPiont(e.guildNode)},updataPerEnemieInfos:function(e){for(var t=this.personalEnemieInfos,a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n]).playerInfo.roleId==e.roleId)return this.personEnemyAfter=i.node,void(i.node=e.nodeId)},updateOutput:function(e){this.output+=e.num,this.totalOutput+=e.num,this.outputRefreshTime=e.time,this.updataMYInCityOutPut()},updateOutput2:function(e){this.output=e,this.updataMYInCityOutPut()},updateBattleSituation:function(e){if(e){var t=this,a=e.battleLogs,i=e.personalEnemies,n=e.guildEnemies,s=game.GuildConflictFoeTypes;a&&0<a.length&&t.updateBattleInfos(t.battleLogInfos,a,s.BATTLE_LOG),i&&0<i.length&&t.updateBattleInfos(t.personalEnemieInfos,i,s.RIVAL),n&&0<n.length&&t.updateBattleInfos(t.guildEnemieInfos,n,s.GUILD),t.isFirstRecCity&&(t.isFirstRecCity=!1,t.updateAllNode(t.allNode))}},clearRankInfo:function(){var e=this.battleLogInfos,t=this.personalEnemieInfos,a=this.guildEnemieInfos;0<e.length&&this.clearList(e),0<t.length&&this.clearList(t),0<a.length&&this.clearList(a)},updateBattleLog:function(e){this.stamina=e.stamina,0<e.atkNode&&this.updataNewEnemy(e)},updataNewEnemy:function(e){var t=this.personalEnemieInfos,a=game.GuildConflictRivalInfo.get();a.setEnemyData(e),t.push(a),this.updataMyCityGoldPiont(e.atkNode)},updateRank:function(e){if(e){var t=e.marsRank,a=e.richRank,i=game.GuildConflictRankTypes;t&&0<t.length&&this.updateRankInfo(this.marsRankInfos,t,i.MARS),a&&0<a.length&&this.updateRankInfo(this.richRankInfos,a,i.RICH)}},updateNodeRank:function(e){if(e){var t=e.leader,a=e.nodes;if(this.leader=t,this.nodeRankAry.length=0,a){for(var i=a.length,n=void 0,s=0;s<i;s++)(n=new game.GuildConflictNodeRankInfo).setData(a[s]),this.nodeRankAry.push(n);this.nodeRankAry.sort(function(e,t){var a=e.cfg.types,i=t.cfg.types;return a==i?t.rate-e.rate:i-a})}}},getNodeRankAry:function(){return this.nodeRankAry},updateCitySlotInfo:function(e){var t=e.nodeId,a=this.cityInfoMap.get(t);a&&a.updateSlotInfo(e.slots)},updateViewPlayerInfo:function(e){this.viewPlayerInfo||(this.viewPlayerInfo=new game.GuildConflictPlayerInfo),this.viewPlayerInfo.setData(e)},updateBattleResultInfo:function(e){this.battleResultInfo||(this.battleResultInfo=new game.GuildConflictBattleResultInfo),this.win+=e.win,this.warToken=e.warToken,this.warTokenRefreshTime=e.warTokenRefreshTime,this.stamina=e.selfAfter,this.battleResultInfo.setData(e)},updateStamina:function(e){this.stamina=e.stamina,this.foods-=e.num},updateResources:function(e){1==e.types?this.foods+=e.num:this.warToken+=e.num},updateMoveData:function(e){this.foods=e.foods,this.foodsRefreshTime=e.foodsRefreshTime},updateGatherCity:function(e){var t=void 0;if(0!=this.curSelGatherId){if(!(t=this.getCityInfosById(this.curSelGatherId)))return;t.isGatherCity=!1}0!=(this.curSelGatherId=e)&&(t=this.getCityInfosById(e))&&(t.isGatherCity=!0)},updateGatherCityInfo:function(){var e=this.getCityInfoById(this.curSelGatherId);e&&this.updataCityShowExplicit(e)},updateGatherCityInfo2:function(e){var t=this.getCityInfoById(e);t&&this.updataCityShowExplicit(t)},initGroupInfo:function(e){this.groupInfos||(this.groupInfos=[]);for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)a=e[n],(t=new game.GuildConflictSeaStageInfo).group=a,this.groupInfos.push(t)},getGroupInfos:function(){return this.groupInfos},getCityInfos:function(){return this.cityInfoMap.count()<1&&this.initCityInfo(),this.cityInfoMap.values()},getCityInfosByType:function(e){return this.cityTypeMap.get(e)},getCityInfoById:function(e){return this.cityInfoMap.get(e)},initCityInfo:function(){var e=game.ClashNodeCfg.getDatas();if(e){e.sort(function(e,t){return t.types-e.types});for(var t=void 0,a=void 0,i=void 0,n=void 0,s=e.length,r=0;r<s;r++)t=e[r],(a=new game.GuildConflictCityInfo).cfg=t,this.cityInfoMap.set(t.id,a),1==(i=t.types)&&this.nodeBirthAry.push(t.id),(n=this.cityTypeMap.get(i))||(n=[],this.cityTypeMap.set(i,n)),n.push(a)}},updateBattleInfos:function(e,t,a){0<e.length&&this.clearList(e);for(var i=void 0,n=void 0,s=t.length,r=game.GuildConflictFoeTypes,o=0;o<s;o++)n=t[o],(i=a==r.BATTLE_LOG?game.GuildConflictBattleInfo.get():a==r.RIVAL?game.GuildConflictRivalInfo.get():game.GuildConflictGuildEnemyInfo.get()).setData(n),e.push(i)},updateRankInfo:function(e,t,a){0<e.length&&this.clearList(e);for(var i=void 0,n=void 0,s=t.length,r=game.GuildConflictRankTypes,o=0;o<s;o++)n=t[o],a==r.MARS?(i=game.GuildConflictMarsRankInfo.get()).type=r.MARS:a==r.RICH&&((i=game.GuildConflictRichRankInfo.get()).type=r.RICH),i.setData(n),e.push(i)},getMineRankInfoByType:function(e){var t=void 0,a=game.mainRoleData.id;if(!(t=e==game.GuildConflictRankTypes.MARS?this.marsRankInfos:this.richRankInfos))return null;for(var i=void 0,n=t.length,s=0;s<n;s++)if((i=t[s]).playerInfo.roleId==a)return i;return null},getCityInfosById:function(e){return this.cityInfoMap.get(e)},getTaskInfos:function(){if(this.taskInfoMap.count()<1){var e=game.ClashTaskCfg.getDatas();if(!e)return;for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)a=e[n],(t=new game.GuildConflictTaskInfo).cfg=a,this.taskInfoMap.set(a.id,t);var s=void 0;i=this.tasks.length;for(var r=0;r<i;r++)s=this.tasks[r],(t=this.taskInfoMap.get(s.id)).setData(s);this.updateTaskOpenSate()}return this.taskInfoMap.values().sort(this.taskSort),this.taskInfoMap.values()},taskSort:function(e,t){return e.canGet&&!t.canGet?-1:!e.canGet&&t.canGet?1:e.canGet&&t.canGet?e.id-t.id:e.isGet&&!t.isGet?1:!e.isGet&&t.isGet?-1:e.isOpen&&!t.isOpen?-1:!e.isOpen&&t.isOpen?1:e.id-t.id},updateTaskOpenSate:function(){var e=this.getTaskInfos();if(e)for(var t=void 0,a=e.length,i=game.SysTime.curTime,n=b8e.TimeUtil.getDay(i),s=void 0,r=0;r<a;r++)s=(t=e[r]).cfg.taskType,t.isOpen=0==s||0!=s&&s==n},getTaskProRewInfos:function(){if(0<this.taskProRewInfos.length)return this.taskProRewInfos;var e=game.ClashTaskAwardCfg.getDatas();if(!e)return null;if(e.sort(function(e,t){return e.id-t.id}),!e)return null;for(var t=e.length,a=void 0,i=0;i<t;i++)(a=new game.GuildConflictTaskAwardInfo).cfg=e[i],this.taskProRewInfos.push(a);return this.updateTaskProRewInfo(),this.taskProRewInfos},updateTaskProRewInfo:function(){for(var e=void 0,t=void 0,a=this.taskProRewInfos.length,i=0;i<a;i++)t=(e=this.taskProRewInfos[i]).cfg.num,-1<this.seasonAwards.indexOf(t)?(e.isGet=!0,e.canGet=!1):(e.isGet=!1,e.canGet=this.seasonNum>=t)},updateTaskPro:function(e){var t=this.getTaskInfos();if(t)for(var a=t.length,i=0;i<a;i++)t[i].updateNum(e)},updateCompleteTask:function(e){var t=e.id,a=this.taskInfoMap.get(t);a&&(a.onGetReward(),this.seasonNum++,this.updateTaskProRewInfo())},updateTaskProReward:function(e){var t=e.num;-1<this.seasonAwards.indexOf()||(this.seasonAwards.push(t),this.updateTaskProRewInfo())},getPathPoints:function(e,t){var a=Math.max(e,t),i=Math.min(e,t)+","+a;this.pathPointMap||(this.pathPointMap=b8e.HashMap.get());var n=this.pathPointMap.get(i);if(!n){n=[];var s=game.ClashPointCfg.getData(i);if(!s)return null;var r=s.pos,o=r.length;if(o<1)return null;for(var g=void 0,u=void 0,l=0;l<o;l++)g=r[l].split(","),g=[(u=b8e.scene.getGridPosByPixel(g[0],g[1])).x,u.y],n.push(g);this.pathPointMap.set(i,n)}return n},getIsFirend:function(e){var t=game.guildData.name;return t&&t==e.guildName},getMineGuildOccupy:function(){if(!game.guildData.hasGuild())return null;var e=game.GuildConflictSeasonStates,t=void 0;if(!(t=this.seasonState==e.SETTLEMENT?this.getNodeRankAry():this.getCityInfos()))return null;for(var a=game.guildData.id,i=void 0,n=void 0,s=void 0,r=t.length,o=0;o<r;o++)1!=(s=(i=t[o]).cfg.types)&&i.guildId==a&&(s>(n=n||i).cfg.types?n=i:s==n.cfg.types&&(n=i.rate>n.rate?i:n));return n},getPageCount:function(){var e=this.getCityInfosByCheckBox();if(e&&0<e.length){var t=e.length;return Math.ceil(t/this.PER_PAGE_COUNT)}return 1},gotoNextRankPage:function(){this.pageNum<1&&(this.pageNum=1);var e=this.getPageCount();this.pageNum<e&&this.pageNum++},gotoPerRankPage:function(){if(this.pageNum<1){this.pageNum=1}var e=this.getPageCount();this.pageNum-1<e&&1<this.pageNum&&this.pageNum--},getCityInfosByCheckBox:function(){var e=this.getCityInfosById(this.cityId);return 0==this.selectCityBox?e.slotInfos:e.getCanAttack(this.selectCityBox)||[]},getCityInfoArrByPageByType:function(){this.pageNum<=0&&(this.pageNum=1);var e=this.PER_PAGE_COUNT;if(e<=0)return null;var t=[],a=this.getCityInfosByCheckBox();if(a){var i=(this.pageNum-1)*e,n=this.pageNum*e,s=a.length;if(n=Math.min(n,s),i<s){t=[];for(var r=i;r<n;r++){var o=a[r];o&&t.push(o)}}return 0==t.length&&1<this.pageNum&&(this.pageNum--,b8e.evt.dptG(game.GuildConflictEvts.V_UPDATE_CITY_VIEW,this.id)),t.sort(this.sortPage),t}},sortPage:function(e,t){return e.slotId-t.slotId},getCityOccupyInfos:function(){var e=this.getCityInfos();if(!e)return null;this.occupyInfos||(this.occupyInfos=[]);for(var t=void(this.occupyInfos.length=0),a=e.length,i=0;i<a;i++)1<(t=e[i]).cfg.types&&this.occupyInfos.push(t);return this.occupyInfos.sort(function(e,t){return e.cfg.types==t.cfg.types?t.rate-e.rate:t.cfg.types-e.cfg.types}),this.occupyInfos},getCityOccupyRewInfos:function(){if(this.occupyRewInfoMap)return this.occupyRewInfoMap.values();this.occupyRewInfoMap=b8e.HashMap.get();var e=this.getCityInfos();if(!e)return null;for(var t=void 0,a=void 0,i=e.length,n=0;n<i;n++)1<(a=(t=e[n]).cfg.types)&&(this.occupyRewInfoMap.get(a)||this.occupyRewInfoMap.set(a,t));var s=this.occupyRewInfoMap.values();return s.sort(function(e,t){var a=e.cfg.types,i=t.cfg.types;return a==i?e.cfg.id-t.cfg.id:i-a}),s},getSelfInClickCity:function(){return this.nodeId==this.cityId},getClickIsSelf:function(e){return!!e&&game.mainRoleData.id==e.playerInfo.roleId},checkIsOpen:function(){var e=this.getCurrSeasonState()==game.GuildConflictSeasonStates.SETTLEMENT;return this.isOpen&&!e},updateSeasonState:function(){var e=game.GuildConflictSeasonStates,t=game.SysTime.curTime,a=b8e.TimeUtil.getDay(t);a=0==a?7:a;var i=void 0;this.startDay=+this.clashOpenTime.split("|")[0];var n=void 0;if(a<this.startDay){var s=game.TimeUtil.getTimeByWeekStr(this.clashEndTime);n=t<(i=game.TimeUtil.getTimeByWeekStr(this.clashFierceTime))?e.OPENING:i<=t&&t<s?e.FIERCE:e.SETTLEMENT}else n=(i=game.TimeUtil.getTimeByWeekStr(this.clashOpenTime))<t?e.OPENING:e.SETTLEMENT;this.seasonState=n},getCurrSeasonState:function(){return this.updateSeasonState(),this.seasonState},getCountDown:function(){var e=this.seasonState,t=game.SysTime.curTime,a=b8e.TimeUtil.getDay(t);a=0==a?7:a;var i=this.clashFierceTime.split("|"),n=game.GuildConflictSeasonStates,s=void 0;if(e==n.OPENING){var r=void 0;s=a>=this.startDay?(r=+i[0]+7,game.TimeUtil.getTimeByWeekStr(r+"|"+i[1])):game.TimeUtil.getTimeByWeekStr(this.clashFierceTime)}else s=e==n.FIERCE?game.TimeUtil.getTimeByWeekStr(this.clashEndTime):game.TimeUtil.getTimeByWeekStr(this.clashOpenTime);return s-t},getIntoCityNeedFood:function(e){var t=game.guildConflictScene.getMovePath(e);if(!t||t.length<1)return 0;var a=t.length;return this.clashMove*a*game.guildConflictData.clashPerFood},clashOpenTime:{get:function(){return this._clashOpenTime||(this._clashOpenTime=game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashOpenTime")),this._clashOpenTime}},clashFierceTime:{get:function(){return this._clashFierceTime||(this._clashFierceTime=game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashFierceTime")),this._clashFierceTime}},clashEndTime:{get:function(){return this._clashEndTime||(this._clashEndTime=game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashEndTime")),this._clashEndTime}},clashGather:{get:function(){return this._clashGather||(this._clashGather=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashGather")),this._clashGather}},clashStamina:{get:function(){return this._clashStamina||(this._clashStamina=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashStamina")),this._clashStamina}},clashMove:{get:function(){return this._clashMove||(this._clashMove=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashMove")),this._clashMove}},clashPerFood:{get:function(){return this._clashPerFood||(this._clashPerFood=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashPerFood")),this._clashPerFood}},clashOccupied:{get:function(){return this._clashOccupied||(this._clashOccupied=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashOccupied")),this._clashOccupied}},clashExclusive:{get:function(){return this._clashExclusive||(this._clashExclusive=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashExclusive")),this._clashExclusive}},clashDecrease:{get:function(){return this._clashDecrease||(this._clashDecrease=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashDecrease")),this._clashDecrease}},clashOutputInterval:{get:function(){return this._clashOutputInterval||(this._clashOutputInterval=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashOutputInterval")),this._clashOutputInterval}},clashOverload:{get:function(){return this._clashOverload||(this._clashOverload=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashOverload")),this._clashOverload}},clashLang:{get:function(){return this._clashLang||(this._clashLang=game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashLang")),this._clashLang}},clashItemId:{get:function(){return this._clashItemId||(this._clashItemId=game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashItemId")),this._clashItemId}},clashFoodPrice:{get:function(){return this._clashFoodPrice||(this._clashFoodPrice=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashFoodPrice")),this._clashFoodPrice}},clashWarTokenPrice:{get:function(){return this._clashWarTokenPrice||(this._clashWarTokenPrice=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashWarTokenPrice")),this._clashWarTokenPrice}},clashFoodMax:{get:function(){return this._clashFoodMax||(this._clashFoodMax=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashFoodMax")),this._clashFoodMax}},clashWarTokenMax:{get:function(){return this._clashWarTokenMax||(this._clashWarTokenMax=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashWarTokenMax")),this._clashWarTokenMax}},clashFoodInterval:{get:function(){return this._clashFoodInterval||(this._clashFoodInterval=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashFoodInterval")),this._clashFoodInterval}},clashWarTokenInterval:{get:function(){return this._clashWarTokenInterval||(this._clashWarTokenInterval=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashWarTokenInterval")),this._clashWarTokenInterval}},clashFood:{get:function(){return this._clashFood||(this._clashFood=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashFood")),this._clashFood}},clashWarToken:{get:function(){return this._clashWarToken||(this._clashWarToken=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashWarToken")),this._clashWarToken}},getSeasonStr:function(e){var t=game.GuildConflictSeasonStates;return e==t.OPENING?game.Lang.get(53495):e==t.FIERCE?game.Lang.get(53496):game.Lang.get(53497)},getCityTypeStr:function(e){var t=game.GuildConflictCityTypes;switch(e){case t.NODE_COMMON:return game.Lang.get(53498);case t.NODE_BIG:return game.Lang.get(53499);case t.NODE_SUPER:return game.Lang.get(53500)}},getItemTypeStr:function(e){switch(e){case 1:return game.Lang.get(53505);case 2:return game.Lang.get(53506);case 3:return game.Lang.get(53507)}},getBlessingCountDown:function(){var e=game.SysTime.curTime;if(this.blessingRefreshTime||(this.blessingRefreshTime=game.CfgUtil.getMiscValue(game.ClashMiscCfg,"blessingRefreshTime")),!this.blesRefrechTime||0==this.blesRefrechTime){var t=this.blessingRefreshTime.split(":"),a=b8e.TimeUtil.getNextDateTime(e,1);a-e>b8e.TimeUtil.DAY_MICRO_SECONDS/2?this.blesRefrechTime=b8e.TimeUtil.dateParse(this.blessingRefreshTime,"hh:mm").getTime():this.blesRefrechTime=a+t[0]*b8e.TimeUtil.HOUR_MICRO_SECONDS+t[1]*b8e.TimeUtil.MINUTE_MICRO_SECONDS}return this.blesRefrechTime-game.SysTime.curTime},getMaxProgress:function(){return 0==this.outputRefreshTime?0:1e3*this.outputRefreshTime+6e4*this.clashOutputInterval-game.SysTime.curTime},updataCityData:function(){var e=this.getCityInfos();if(e)for(var t=void 0,a=e.length,i=void 0,n=0;n<a;n++)t=e[n],(i=b8e.scene.getDisplayByTypeAndId(game.RoleType.GuildConflictCity,t.id))&&i.updataCityInfo()},getShorBirthId:function(){var e=this.nodeBirthAry;if(!e)return null;for(var t=e.length,a=void 0,i=void 0,n=999,s=1,r=0;r<t;r++)a=e[r],(i=game.guildConflictScene.getStepByEndId(a))<n&&(n=i,s=a);return s},updateCityMoveOld:function(e){var t=this.getCityInfoById(e.node);t&&(t.deleteSlotByid(e.roleId),this.updataCityShowExplicit(t))},updateCityMoveNew:function(e){if(e.info){var t=this.getCityInfoById(e.node);t&&(t.pushInfoInSlot(e.info),this.updataCityShowExplicit(t))}},canGetTaskReward:function(){var e=this.getTaskInfos();return e?this.checkRewardCanGet(e):null},canGetTaskProReward:function(){var e=this.getTaskProRewInfos();return e?this.checkRewardCanGet(e):null},checkRewardCanGet:function(e){if(!e)return!1;for(var t=e.length,a=0;a<t;a++){if(e[a].canGet)return!0}return!1},getEffect:function(e){var t=game.GuildConflictCityTypes;switch(e){case t.NODE_BIRTH:return 2146;case t.NODE_COMMON:return 2143;case t.NODE_BIG:return 2144;case t.NODE_SUPER:return 2145}},getRate:function(e){switch(e){case 0:case 1:return"";case 2:case 3:return game.Lang.get(53537)}},idGUildEnemies:function(e){var t=this.guildEnemieInfos;if(!t||t.length<1)return!1;if(!e)return!1;for(var a=t.length,i=0;i<a;i++)if(e==t[i].id)return!0;return!1},isCityHavaEnemy:function(e){var t=this.personalEnemieInfos;if(!t||t.length<1)return!1;if(!e)return!1;for(var a=t.length,i=0;i<a;i++)if(e==t[i].node)return!0;return!1},getChangeNeedNum:function(e){this._clashWarTokenNum||(this._clashWarTokenNum=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashWarTokenNum"));var t=this.getCityInfosById(this.cityId);if(t){var a=1<t.rate?.5:1;return this._clashWarTokenNum*e*a}},clearList:function(e){for(var t=0,a=e.length;t<a;t++)e[t].release();e.length=0}});game.guildConflictData=game.guildConflictData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,name:null,icon:0,zone:0,num:0,nodeId:0,time:0,setData:function(e){this.id=e.id,this.name=e.name,this.icon=e.icon,this.zone=e.zone,this.num=e.num,this.nodeId=e.nodeId,this.time=e.time},setEnemyData:function(e){this.id=e.guildId,this.nodeId=e.guildNode},clearData:function(){this.id=0,this.name="",this.icon=0,this.zone=0,this.num=0,this.nodeId=0,this.time=0},recycle:function(){this.clearData(),this._super()}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildConflictGuildEnemyInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({playerInfo:null,win:0,rate:0,rank:0,guildName:"",type:0,ctor:function(){this._super()},setData:function(e){this.playerInfo=e.playerInfo,this.win=e.win,this.rate=e.rate,this.rank=e.rank,this.guildName=e.guildName}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildConflictMarsRankInfo",t)}(),function(){var e;e=b8e.Object.extends({id:0,lv:0,top:0,star:0,slot:0,setData:function(e){this.id=e.id,this.lv=e.lv,this.top=e.top,this.star=e.star,this.slot=e.slot}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildConflictPartnerInfo",e)}(),function(){var e;e=b8e.Object.extends({roleId:0,power:0,name:"",isMale:!1,level:0,roleQuality:0,guildName:"",partners:null,isInit:!1,ctor:function(){this._super()},setData:function(e){var t=this;t.isInit&&t.clearData(),t.isInit=!0,t.roleId=e.roleId,t.power=e.power,t.name=e.name,t.isMale=e.isMale,t.level=e.level,t.roleQuality=e.roleQuality,t.guildName=e.guildName,t.partners=e.partners},getPartnerInfos:function(){var e=this;if(!e.partners||e.partners.length<1)return null;var t=void 0,a=void 0,i=e.partners.length;e.allInfos||(e.allInfos=[]),e.partnerInfos||(e.partnerInfos=[]);for(var n=e.partnerInfos.length=0;n<i;n++)t=e.partners[n],(a=e.allInfos[n])||(a=new game.GuildConflictPartnerInfo,e.allInfos.push(a)),a.setData(t),e.partnerInfos.push(a);return e.partnerInfos},clearData:function(){this.roleQuality=0,this.power=0,this.name="",this.isMale=!1,this.level=0,this.roleQuality=0,this.guildName="",this.partners=null}}),b8e.RC("$$game","$$GuildConflictPlayerInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({playerInfo:null,output:0,rank:0,guildName:"",type:0,ctor:function(){this._super()},setData:function(e){this.playerInfo=e.playerInfo,this.output=e.output,this.rank=e.rank,this.guildName=e.guildName}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildConflictRichRankInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({playerInfo:null,time:0,num:0,node:0,ctor:function(){this._super()},setData:function(e){this.playerInfo=e.playerInfo,this.time=e.time,this.num=e.num,this.node=e.node},setEnemyData:function(e){this.playerInfo={},this.playerInfo.roleId=e.atkId,this.nodeId=e.atkNode},clearData:function(){this.playerInfo=null,this.time=0,this.num=0},recycle:function(){this.clearData(),this._super()}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildConflictRivalInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({slotId:0,playerInfo:null,num:0,guildName:null,surface:null,enemy:!1,ctor:function(){this._super()},setData:function(e){this.slotId=e.slotId,this.playerInfo=e.playerInfo,this.num=e.num,this.guildName=e.guildName,this.surface=e.surface,e.enemy&&(this.enemy=e.enemy)},recycle:function(){this.reset(),this._super()},reset:function(){this.slot=0,this.playerInfo=null,this.num=0,this.guildName=null,this.surface=null,this.enemy=!1}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,1024),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildConflictSlotInfo",t)}(),function(){var e;e=b8e.PoolObject.extends({group:0,ctor:function(){this._super()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildConflictSeaStageInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,isGet:!1,canGet:!1,onGetReward:function(){this.canGetRew=!1,this.isGet=!0}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildConflictTaskAwardInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,id:0,num:0,flag:!1,isOpen:!1,canGet:!1,isGet:!1,setData:function(e){this.id=e.id,this.num=e.num,this.isGet=e.flag,this.canGet=!this.isGet&&this.num>=this.cfg.num},onGetReward:function(){this.isGet=!0,this.canGet=!1},updateNum:function(e){this.num+=e,this.canGet=this.isOpen&&!this.isGet&&this.num>=this.cfg.num},getPrizeList:function(){if(this.prizeList)return this.prizeList;this.prizeList=[];for(var e=this.cfg.awards,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,i.iconSize=game.IconSizeEnum.SIZE_84,this.prizeList.push(i);return this.prizeList}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildConflictTaskInfo",e)}(),function(){var e;e=b8e.PoolObject.extends({id:0,rate:0,guildId:0,guildName:0,guildZone:0,cfg:null,ctor:function(){this._super()},setData:function(e){this.id=e.id,this.rate=e.rate||0,this.guildId=e.guildId,this.guildName=e.guildName,this.guildZone=e.guildZone,this.cfg=game.ClashNodeCfg.getData(this.id)},getOccupyAwards:function(){return this.occupyAwards||(this.occupyAwards=[],this.getPrizeList(this.cfg.awards,this.occupyAwards)),this.occupyAwards},getBetterOccupyAwards:function(){return this.betterOccupyAwards||(this.betterOccupyAwards=[],this.getPrizeList(this.cfg.betterAwards,this.betterOccupyAwards)),this.betterOccupyAwards},getPrizeList:function(e,t){for(var a=e.length,i=void 0,n=void 0,s=0;s<a;s++)i=e[s],(n=game.ItemUtil.createBaseItemInfo(i.Id,i.Num)).iconLayoutEnum=game.IconLayoutEnum.SHOW_NUM,n.iconSize=game.IconSizeEnum.SIZE_84,t.push(n)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildConflictNodeRankInfo",e)}(),function(){var a=void 0;(a=b8e.SceneEntity.extends({canClick:!0,isOneTween:!0,ctor:function(e,t){this._super(e,t)},setData:function(e){this.data=e,this.addCityImg(e.cfg),this.creatNode(),this.setNodeInfo()},updataCityInfo:function(e){this.data=e,this.setNodeInfo()},creatNode:function(){var e=this;e.creatEffct(),e.creatGrayBg(),e.creatNameBg(),e.creatGuidNameLab(),e.creatGuidZoneLab(),e.creatClick(),e.creatBaohuBg(),e.creatTwoBg(),e.creatRoundBg(),e.creatMyGuidBg(),e.creatIsEnemyBg(),e.creatCityLab(),e.creatRoleNumLab(),e.creatGoldBgNode()},addCityImg:function(e){this._cityImg||(this._cityImg=b8e.Sprite.get(),this._cityImg.setAnchor(.5,.5),this.addChild(this._cityImg)),this._cityImg.loadTexture(game.ResCfg.getUrl(10204,e.types))},creatEffct:function(){this.effct||(this.effct=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this._cityImg.setAnchor(.5,.5),this.addChild(this.effct))},setNodeInfo:function(){var e=this,t=e.data.guildColorId,a=e.data.guildName,i=e.data.guildZone,n=game.guildConflictData,s=e.data.isGatherCity&&e.data.id==n.gatherId,r=e.data.count,o=e.data.rate,g=e.data.guildId,u=e.data.cfg,l=game.guildData.id,c=n.nodeId,h=e.numGold=n.output,m=0<l&&g==l,d=n.idGUildEnemies(e.data.guildId),f=n.isCityHavaEnemy(e.data.id),p=u.types==game.GuildConflictCityTypes.NODE_BIRTH;if(e.nameBg?0<r&&a?e.nameBg.loadTexture(game.ResCfg.getUrl(10205,"quality_"+t)):e.nameBg.unloadTexture():0<r&&a&&(e.creatNameBg(),e.nameBg.loadTexture(game.ResCfg.getUrl(10205,"quality_"+t))),e.guidNameLab?a&&0<r?e.guidNameLab.setText(a.slice(0,2)||""):e.guidNameLab.string="":a&&(e.creatGuidNameLab(),e.guidNameLab.setText(a.slice(0,2)||"")),e.guidZoneLab?i&&0<r?e.guidZoneLab.setText(game.Lang.get(53404,i)):e.guidZoneLab.string="":i&&(e.creatGuidZoneLab(),e.guidZoneLab.setText(game.Lang.get(53404,i))),e.baohuBg?p&&0<o&&e.data.id!=c?(e.baohuBg.loadTexture(game.ResCfg.getUrl(10205,"baohu")),e.tweenToX(e.baohuBg)):(e.killTween(e.baohuBg),e.baohuBg.unloadTexture()):p&&1==o&&e.data.id!=c&&(e.creatBaohuBg(),e.baohuBg.loadTexture(game.ResCfg.getUrl(10205,"baohu")),e.tweenToX(e.baohuBg)),e.twoBg?!p&&1<o?(e.twoBg.loadTexture(game.ResCfg.getUrl(10205,"rate_"+o)),e.tweenToX(e.twoBg)):(e.killTween(e.twoBg),e.twoBg.unloadTexture()):!p&&1<o&&(e.creatTwoBg(),e.twoBg.loadTexture(game.ResCfg.getUrl(10205,"rate_"+o)),e.tweenToX(e.twoBg)),e.effct)if(1==o&&p||1<o&&!p){var v=game.guildConflictData.getEffect(u.types);e.effct.load(game.ResCfg.getUrl(5001,v)),e.effct.active=!0,e.effct.play()}else e.effct.active=!1,e.effct.stop();e.roundBg?s?(e.roundBg.loadTexture(game.ResCfg.getUrl(10205,"round")),e.tweenToX(e.roundBg)):(e.killTween(e.roundBg),e.roundBg.unloadTexture()):s&&(e.creatRoundBg(),e.roundBg.loadTexture(game.ResCfg.getUrl(10205,"round")),e.tweenToX(e.roundBg)),e.myGuidBg?m?e.myGuidBg.loadTexture(game.ResCfg.getUrl(10205,"myGuid")):e.myGuidBg.unloadTexture():m&&(e.creatMyGuidBg(),e.myGuidBg.loadTexture(game.ResCfg.getUrl(10205,"myGuid"))),e.myGuidBg&&(!d||m||f?d||m||e.myGuidBg.unloadTexture():e.myGuidBg.loadTexture(game.ResCfg.getUrl(10205,"guildEnemy"))),e.enemyBg&&(!f||m||p?(f||m)&&!m&&p||e.enemyBg.unloadTexture():e.enemyBg.loadTexture(game.ResCfg.getUrl(10205,"enemy"))),e.roleNumLab&&e.roleNumLab.setText(game.Lang.get(53431,r||0)),e.goldBg&&(e.data.id==c&&0<h?(e.goldBg.loadTexture(game.ResCfg.getUrl(10205,"gold")),e.yuanBg.loadTexture(game.ResCfg.getUrl(10205,"yuan")),e.grayBg.loadTexture(game.ResCfg.getUrl(10205,"maskBg")),e.drawCurve(),e.isOneTween&&(e.isOneTween=!1,e.tweenToX(e.goldBg)),e.goldBg.active=!0,e.goldNumLab.setText(h)):(e.yuanBg.unloadTexture(),e.goldBg2.unloadTexture(),e.grayBg.unloadTexture(),e.goldBg.unloadTexture(),e.goldNumLab.string="",e.isOneTween=!0,e.killTween(e.goldBg),e.goldBg.active=!1,e.clearTimer()))},creatGrayBg:function(){this.grayBg||(this.grayBg=b8e.Sprite.get(),this.grayBg.setAnchor(.5,.5),this.grayBg.setPosition(10,-60),this.addChild(this.grayBg),this.grayBg.loadTexture(game.ResCfg.getUrl(10205,"gray")))},creatNameBg:function(){this.nameBg||(this.nameBg=b8e.Sprite.get(),this.nameBg.setAnchor(.5,.5),this.nameBg.setPosition(-80,-65),this.addChild(this.nameBg))},creatGuidNameLab:function(){this.guidNameLab||(this.guidNameLab=b8e.Label.get(),this.guidNameLab.setAnchor(.5,.5),this.guidNameLab.setPosition(0,20),this.guidNameLab.setColor(game.Color.WHITE),this.guidNameLab.setFontSize(26),this.nameBg.addChild(this.guidNameLab))},creatGuidZoneLab:function(){this.guidZoneLab||(this.guidZoneLab=b8e.RichText.get(),this.guidZoneLab.setAnchor(.5,.5),this.guidZoneLab.setPosition(0,-8),this.guidZoneLab.setColor(game.Color.WHITE),this.guidZoneLab.setFontSize(22),this.nameBg.addChild(this.guidZoneLab))},creatClick:function(){var e=this;e.clickBg||(e.clickBg=b8e.Sprite.get(),e.clickBg.setAnchor(.5,.5),e.clickBg.setPosition(0,0),e.clickBg.setSize(210,155),e.addChild(e.clickBg),b8e.evt.onTouchStart(e.clickBg,e._onTouchStart,e),b8e.evt.onTouchEnd(e.clickBg,e._onTouchEnd,e))},creatBaohuBg:function(){this.baohuBg||(this.baohuBg=b8e.Sprite.get(),this.baohuBg.setAnchor(.5,.5),this.baohuBg.setPosition(130,40),this.addChild(this.baohuBg))},creatTwoBg:function(){this.twoBg||(this.twoBg=b8e.Sprite.get(),this.twoBg.setAnchor(.5,.5),this.twoBg.setPosition(130,30),this.addChild(this.twoBg))},creatRoundBg:function(){this.roundBg||(this.roundBg=b8e.Sprite.get(),this.roundBg.setAnchor(.5,.5),this.roundBg.setPosition(140,100),this.addChild(this.roundBg))},creatMyGuidBg:function(){this.myGuidBg||(this.myGuidBg=b8e.Sprite.get(),this.myGuidBg.setAnchor(.5,.5),this.myGuidBg.setPosition(-145,-55),this.addChild(this.myGuidBg))},creatIsEnemyBg:function(){this.enemyBg||(this.enemyBg=b8e.Sprite.get(),this.enemyBg.setAnchor(.5,.5),this.enemyBg.setPosition(-145,-55),this.addChild(this.enemyBg))},creatCityLab:function(){var e=this;if(!e.cityLab){e.cityLab=b8e.Label.get(),e.cityLab.setAnchor(.5,.5),e.cityLab.setPosition(10,-43);var t=game.HtmlUtil.getColorByQuality(e.data.cfg.quality);e.cityLab.setColor(t),e.cityLab.setFontSize(22),e.addChild(e.cityLab)}var a=e.data.cfg;e.cityLab.setText(a.name)},creatRoleNumLab:function(){this.roleNumLab||(this.roleNumLab=b8e.RichText.get(),this.roleNumLab.setAnchor(.5,.5),this.roleNumLab.setPosition(10,-75),this.roleNumLab.setColor(game.Color.WHITE),this.roleNumLab.setFontSize(22),this.addChild(this.roleNumLab))},creatGoldBgNode:function(){var e=this;e.goldBg||(e.goldBg=b8e.Sprite.get(),e.goldBg.setAnchor(.5,.5),e.goldBg.setPosition(65,140),e.addChild(e.goldBg),b8e.evt.onC(e.goldBg,e.fnOnClickGold,e),e.yuanBg=b8e.Sprite.get(),e.yuanBg.setAnchor(.5,.5),e.yuanBg.setPosition(0,0),e.addChild(e.yuanBg),e.goldBg2=b8e.Sprite.get(),e.goldBg2.setAnchor(.5,.5),e.goldBg2.setPosition(0,0),e.goldBg2.addToParent(e.goldBg),e.grayBg=b8e.Sprite.get(),e.grayBg.setAnchor(.5,.5),e.grayBg.setPosition(0,-34),e.grayBg.setStyle(b8e.SpriteStyle.SLICED),e.grayBg.scale9Inset={top:7,bottom:7,left:7,right:7},e.grayBg.setSize(60,28),e.grayBg.clearDisabled=!0,e.grayBg.addToParent(e.goldBg),e.goldNumLab=b8e.Label.get(),e.goldNumLab.setAnchor(.5,.5),e.goldNumLab.setPosition(0,-35),e.goldNumLab.setColor(game.Color.WHITE),e.goldNumLab.setFontSize(22),e.goldNumLab.addToParent(e.goldBg))},tweenToX:function(e){this.baohuBg&&this.baohuBg.setPosition(130,40),this.twoBg&&this.twoBg.setPosition(130,30),this.roundBg&&this.roundBg.setPosition(140,100),this.goldBg&&this.goldBg.setPosition(65,140),b8e.Tween.get(e,{loop:!0}).to({y:e.y-20},2e3).to({y:e.y},2e3)},killTween:function(e){b8e.Tween.kill(e)},drawCurve:function(){var e=this;e.graphicsImg||(e.graphicsImg=b8e.Graphics.get(),e.graphicsImg.setAnchor(.5,.5),e.graphicsImg.addToParent(e.goldBg2),e.graphicsImg.addChild(e.yuanBg),e.graphicsImg.setMask(b8e.MaskType.GRAPH),e.maskG=e.graphicsImg.getMaskGraphics(),e.poly=[],e.maskRadius=200,e.crue()),e.createTimer()},crue:function(){var e=this,t=game.guildConflictData.getMaxProgress(),a=6e4*game.guildConflictData.clashOutputInterval,i=360*(a-t)/a,n=180<i,s=e.poly;s.length=0,i=180<i?360-i:-i,s.push(0,0);var r=Math.PI/180,o=0;s.push(Math.cos(o)*e.maskRadius,Math.sin(o)*e.maskRadius),o=i/2*r,s.push(Math.cos(o)*(e.maskRadius+20),Math.sin(o)*(e.maskRadius+20)),o=i*r,s.push(Math.cos(o)*e.maskRadius,Math.sin(o)*e.maskRadius),e.maskG.clear(),e.maskG.fillPoly(s);var g=e.graphicsImg.getNode();g&&(g.getComponent(cc.Mask).inverted=n)},createTimer:function(){this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.crue,5e3)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.crue),this.timer=null)},reset:function(){this.guidNameLab.string="",this.guidZoneLab.string="",this.roleNumLab.string="",this.goldNumLab.string="",this.cityLab.string=""},restore:function(e,t){this._super(e,t)},recycle:function(){this.reset()},release:function(){a.put(this)},dispose:function(){this._super(),this.reset()},destroy:function(){var e=this;e._super(),e.killTween(e.nameBg),e.killTween(e.baohuBg),e.killTween(e.twoBg),e.killTween(e.goldBg),e.killTween(e.roundBg),e.clearTimer()},_onTouchEnd:function(){game.guildConflictData.canClick&&b8e.evt.dptG(game.GuildConflictEvts.C_ONSHOW_CITY,this.id)},_onTouchStart:function(){b8e.evt.dptG(game.GuildConflictEvts.G_CITY_TOUCH_START)},fnOnClickGold:function(){game.guildConflictData.canClick&&b8e.evt.dptG(game.GuildConflictEvts.C_SEND_RECEIVE_GOLD,this.numGold)}})).pool=new b8e.Pool(a,128),a.get=function(e,t){return a.pool.get(e,t)},a.put=function(e){a.pool.put(e)},b8e.RC("$$game","$$GuildConflictCity",a)}(),function(){var e=game.View.extends({ctor:function(){this._super(1640),this.spotAlerts={GUILD_CONFLICT_TASK:this.taskAlert,GUILD_CONFLICT_BATTLE_LOG:this.battleLogAlert}},taskAlert:function(e){this.skin.redPoint_1.active=e.alert},battleLogAlert:function(e){this.skin.redPoint_2.active=e.alert},init:function(){this.moduleData=game.guildConflictData},notify:function(e,t){var a=this;switch(e){case a.Evts.C_CHANGE_BTN_STATE:a.changeBtnState(t);break;case a.Evts.SCENE_TOUCH_MOVE:a.setArrowLookAt();break;case a.Evts.ROLE_MOVE:a.onRoleMove();break;case a.Evts.C_UPDATE_MAIN_VIEW:case a.Evts.C_UPDATE_STAMINA:case a.Evts.C_UPDATE_RESOURCES:a.updateView();break;case a.Evts.C_UPDATE_GATHER:case a.Evts.C_UPDATE_MAIN_VIEW:a.updateGather();break;case a.Evts.C_MOVE_MAIN_BOTTOM:a.moveBottomLeft()}},moveBottomLeft:function(){var e=this.skin.moveBottom;b8e.Tween.kill(e),game.chatData.isOpenChat?b8e.Tween.get(e).to({x:e.x,y:e.y+30},200):b8e.Tween.get(e).to({x:e.x,y:e.y-30},200)},onShow:function(){this.updateCountDown(),this.countDownTimer||(this.countDownTimer=b8e.Timer.add(this,this.updateCountDown,1e3)),this.updateView(),this.updateGather();var e=game.chatData.isOpenChat,t=b8e.stageHeight;this.skin.moveBottom.y=e?260-t:230-t},onHide:function(){this.clearTimer()},updateView:function(){var e=this,t=e.skin;t.warorderNumLab.string=e.moduleData.warToken,t.foodNumLab.string=e.moduleData.foods;var a=game.mainRoleData.isMale;t.head_1.active=!a,t.head_2.active=a,e.clashStamina||(e.clashStamina=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashStamina")),t.powerLab.string=game.Lang.get(1621,e.moduleData.stamina,e.clashStamina),e.maxPro||(e.maxPro=t.pb_bg.width-30),t.power_progress.width=e.moduleData.stamina/e.clashStamina*e.maxPro,t.seasonLab.string=game.Lang.get(53685,e.moduleData.getSeasonStr(e.moduleData.seasonState))},updateGather:function(){var e=this.skin,t=this.moduleData.gatherId;if(e.gatherNode.active=0<t,0<t){var a=this.moduleData.getCityInfosById(t);if(!a)return;var i=a.cfg,n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name,!0);e.gatherGuildNameLab.string=game.Lang.get(53456,n);var s=a.guildId==game.guildData.id;e.fightStateLab.string=s?game.Lang.get(53687):game.Lang.get(53686)}},setArrowLookAt:function(){var e=this.skin,t=game.mainRole.localToGlobal(),a=-b8e.stageHeight+t.y;t.y=a;var i=e.arrowNode.getPosition(),n=b8e.MathUtil.getDegree(i.x,i.y,t.x,t.y);e.arrowNode.setRotation(0,0,90-n);var s=game.guildConflictScene.getRoleIsVisible()?-100:80;e.headNode.x=e.arrowNode.x=s},changeBtnState:function(e){var t=this.skin;t.enlargeBtn.active=2==e,t.narrowBtn.active=1==e,this.setArrowLookAt()},onRoleMove:function(){this.moveTimer?this.moveTimer.start():this.moveTimer=b8e.Timer.add(this,this.moveHandler,100)},clearTimer:function(){this.moveTimer&&(b8e.Timer.remove(this,this.moveHandler),this.moveTimer=null),this.countDownTimer&&(b8e.Timer.remove(this,this.updateCountDown),this.countDownTimer=null)},moveHandler:function(){game.guildConflictScene.isRoleMoveing()?this.setArrowLookAt():(this.moveTimer.stop(),game.guildConflictScene.setRoleFace())},updateCountDown:function(){var e=this,t=e.skin,a=e.moduleData.getCountDown(),i=void 0,n=e.moduleData.seasonState;if(0<a){i=a<=6e4?b8e.TimeUtil.formatTime(a):b8e.TimeUtil.formatDayTime(a);var s=e.moduleData.seasonState+1;3<s&&(s=1),t.timeLab.string=game.Lang.get(53469,i,e.moduleData.getSeasonStr(s))}else{if(e.moduleData.updateSeasonState(),e.moduleData.seasonState==game.GuildConflictSeasonStates.SETTLEMENT)return e.clearTimer(),void e.send(e.Evts.ENTER_SETTLEMENT);t.seasonLab.string=game.Lang.get(53470,e.moduleData.getSeasonStr(n))}var r=e.moduleData.getBlessingCountDown();0<r?t.refreshTimeLab.string=r<=6e4?game.Lang.get(53471,b8e.TimeUtil.formatTime(r)):game.Lang.get(53471,b8e.TimeUtil.formatDayTime(r)):(e.moduleData.blesRefrechTime=0,e.moduleData.updateSeasonState())},onStageResize:function(){var e=this.skin,t=b8e.stageWidth,a=b8e.stageHeight;this.setPosition(0,a),e.bottomRightNode.x=t,e.moveBottom.y=224-a,e.arrowNode.y=e.headNode.y=-a/2,e.topRightNode.x=t,e.topLeftNode.x=0,e.bottomLeftNode.x=0,this.setArrowLookAt(),game.guildConflictScene.setCameraFocus()}});b8e.module.registerView(game.ME.GuildConflictMain,e)}(),function(){var e=game.View.extends({_showModel:!0,idAry:null,foods:0,clashStamina:0,stamina:0,canAdd:0,num:0,ctor:function(){this._super(1632)},init:function(){this.idAry=game.guildConflictData.clashItemId,this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.icon)},notify:function(e,t){switch(e){case this.Evts.C_BUY_NUM_ADD:this.onAddCount(t)}},onAddCount:function(e){var t=this;999==e?t.num=t.canAdd:t.num+=e,t.num<1?t.num=1:t.num>t.canAdd&&(t.num=t.canAdd),game.guildConflictData.tiliBuyNum=t.num,t.showPowerAdd()},onShow:function(){var e=this.skin;this.num=0,e.count.active=!1,e.tiliNode.active=!0,this.getFoodNum(),this.onAddCount(this.canAdd),this.updataView()},updataView:function(){this.getFoodNum(),this.showPowerAdd(),this.getItemIcon()},getFoodNum:function(){this.foods=game.guildConflictData.foods,this.clashStamina=game.guildConflictData.clashStamina,this.stamina=game.guildConflictData.stamina,this.canAdd=this.clashStamina-this.stamina},showPowerAdd:function(){var e=this.skin;e.arrLable.string=game.Lang.get(1621,this.num,this.canAdd),e.pro.width=Math.min(150,this.num/this.canAdd*150),e.haveNum.string=game.Lang.get(53409,this.foods),e.amountNum.string=this.num},getItemIcon:function(){var e=this.skin,t=this.idAry.split("|")[0],a=game.guildConflictData.stamina,i=game.ItemUtil.createBaseItemInfo(t,1);game.GridUtil.setItemIcon(this._icon,i,!1,game.IconLayoutEnum.SHOW_NUM),e.limitBuyLab.string=game.Lang.get(53408,a),e.name.string=game.HtmlUtil.getText(game.Color.PURPLE,game.guildConflictData.getItemTypeStr(3))}});b8e.module.registerView(game.ME.GuildConflictBuyGoods,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1638),this.setSize(174,54)},setData:function(e){var t=this.skin,a=e.cfg.name;t.name.string=a,t.selectImg.active=e.isGatherCity},selBtn:function(){this.send(game.GuildConflictEvts.C_SELECT_CITY,this.data.cfg.id)}}),b8e.RC("$$game","$$GuildConflictGatherItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1639)},init:function(){this.moduleData=game.guildConflictData;var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.GuildConflictGatherItem,this.list.bindEnum=game.ME.GuildConflictMain,e.addToParent(this.skin.list),e.layout.paddingLeft=10,e.layout.spacingX=15,e.layout.spacingY=15},notify:function(e,t){var a=this;switch(e){case a.Evts.C_SELECT_CITY_TYPE:a.updateSelect(t);break;case a.Evts.C_SELECT_CITY_OPEN:a.updateSelViewState(t);break;case a.Evts.C_SELECT_CITY:a.updateList(a.moduleData.selGatherType);break;case a.Evts.C_UPDATE_GATHER:a.updateView(),a.updateList(a.moduleData.selGatherType)}},onShow:function(){this.updateView(),this.updateList(this.moduleData.selGatherType);var e=this.moduleData.gatherId;this.moduleData.updateGatherCity(e)},updateView:function(){var e=this.skin,t=this.moduleData.gatherId;if(0==t)e.cityName.string=game.Lang.get(53566);else{var a=this.moduleData.getCityInfoById(t);if(!a)return;var i=a.cfg,n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name,!0);e.cityName.string=n}e.selTypeLab.string=this.moduleData.getCityTypeStr(this.moduleData.selGatherType),e.moneyLab.string=this.moduleData.clashGather,e.cancelGatherBtn.active=0!=t},updateSelect:function(e){this.updateSelViewState(2),this.skin.selTypeLab.string=this.moduleData.getCityTypeStr(e),this.updateList(e),this.moduleData.selGatherType=e},updateList:function(e){var t=this.moduleData.getCityInfosByType(e);t&&this.list.setData(t)},updateSelViewState:function(e){var t=this.skin;t.selGatherTypeDownBtn.active=2!=e,t.selGatherTypeDownBtn.active=1!=e,t.typeNode.active=1==e}});b8e.module.registerView(game.ME.GuildConflictGather,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1642),this.setSize(600,305)},init:function(){var e=this.skin;this._list1=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list1.itemRender=game.ShowItemListItem,this._list1.addToParent(e.list_1),this._list1.layout.spacingX=40,this._list2=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list2.itemRender=game.ShowItemListItem,this._list2.addToParent(e.list_2),this._list2.layout.spacingX=40},setData:function(e){var t=this.skin,a=e.cfg,i=game.guildConflictData.getCityTypeStr(a.types);t.cityName_1.string=game.HtmlUtil.getColorStrByQuality(a.quality,game.Lang.get(53476,i)),t.cityName_2.string=game.HtmlUtil.getColorStrByQuality(a.quality,i),this.updateRewList1(),this.updateRewList2()},updateRewList1:function(){var e=this.data.getBetterOccupyAwards();e&&this._list1.setData(e)},updateRewList2:function(){var e=this.data.getOccupyAwards();e&&this._list2.setData(e)}}),b8e.RC("$$game","$$GuildConflictOccupyAawrdItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1643),this.setSize(600,146)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.addToParent(this.skin.list),this._list.layout.spacingX=20,this._list.layout.paddingLeft=0},setData:function(e){var t=this.skin,a=e.cfg;0<e.guildId?(t.guildNameLab.active=!0,t.zoneLab.active=!0,t.notOccupyLab.active=!1,t.guildNameLab.string=game.Lang.get(53477,e.guildName),t.zoneLab.string=game.Lang.get(53478,e.guildZone)):(t.guildNameLab.active=!1,t.zoneLab.active=!1,t.notOccupyLab.active=!0),t.cityImg.loadTexture(game.ResCfg.getUrl(10204,a.types));var i=a.name;i=1<e.rate?game.Lang.get(53476,i):i,t.cityName.string=game.HtmlUtil.getColorStrByQuality(a.quality,i),this.updateRewList()},updateRewList:function(){var e=void 0;(e=1<this.data.rate?this.data.getBetterOccupyAwards():this.data.getOccupyAwards())&&this._list.setData(e)}}),b8e.RC("$$game","$$GuildConflictOccupyRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1644),this.toggles={tab1_select:game.ME.GuildConflictCityOccupy,tab2_select:game.ME.GuildConflictOccupyRew}},notify:function(e,t){switch(e){case this.Evts.C_OCCUPY_TOGGLE:this.toggleSelect(t)}},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=game.guildConflictData.getMineGuildOccupy();if(t){var a=t.cfg.name;e.occLab.string=game.Lang.get(53480,a)}else e.occLab.string=game.Lang.get(53479)},toggleSelect:function(e){this._super(e)}});b8e.module.registerView(game.ME.GuildConflictOccupyRank,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1647),this.toggles={tab1_select:game.ME.GuildConflictMarsRank,tab2_select:game.ME.GuildConflictRichRank}},notify:function(e,t){switch(e){case this.Evts.C_RANK_TOGGLE:this.toggleSelect(t)}},toggleSelect:function(e){this._super(e)}});b8e.module.registerView(game.ME.GuildConflictRank,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1653),this.setSize(168,43)},setData:function(e){this.skin.name.string=game.Lang.get(53487,e.group)}}),b8e.RC("$$game","$$GuildConflictSeasonStageItem",e)}(),function(){var e=game.View.extends({_showModel:!0,maxPro:255,ctor:function(){this._super(1654)},init:function(){this.moduleData=game.guildConflictData;var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.GuildConflictSeasonStageItem,e.addToParent(this.skin.list),e.layout.paddingLeft=13,e.layout.spacingX=10,e.layout.spacingY=15},notify:function(e){switch(e){case this.Evts.C_UPDATE_SEASON_STAGE:this.onShow()}},onShow:function(){this.updateView(),this.updateList()},updateView:function(){var e=this.skin,t=game.GuildConflictSeasonStates,a=this.moduleData.seasonState;a==t.OPENING?(e.light_1.active=!0,e.light_2.active=!1,e.light_3.active=!1,e.pro.width=0):a==t.FIERCE?(e.light_1.active=!1,e.light_2.active=!0,e.light_3.active=!1,e.pro.width=127):(e.light_1.active=!1,e.light_2.active=!1,e.light_3.active=!0,e.pro.width=255),this.showTime()},showTime:function(){var e=this.moduleData.clashEndTime.split("|"),t=this.moduleData.clashFierceTime.split("|"),a=this.moduleData.clashOpenTime.split("|"),i=game.TimeUtil.getTimeByWeekStr(this.moduleData.clashOpenTime),n=+a[0],s=void 0,r=void 0,o=void 0;o=i<game.SysTime.curTime?(s=this.moduleData.clashOpenTime,r=+t[0]+7+"|"+t[1],+e[0]+7+"|"+e[1]):(s=n-7+"|"+a[1],r=+t[0]+"|"+t[1],+e[0]+"|"+e[1]),this.setLabStr(s,r,o)},setLabStr:function(e,t,a){var i=this.skin;i.txtLab_1.string=this.getTimeStr(e),i.txtLab_2.string=this.getTimeStr(t),i.txtLab_3.string=this.getTimeStr(a)},getTimeStr:function(e){var t=game.Lang.get(53488),a=game.TimeUtil.getTimeByWeekStr(e);return b8e.TimeUtil.formatTimestamp(a,t)},updateList:function(){var e=this.moduleData.getGroupInfos();e&&this.list.setData(e)}});b8e.module.registerView(game.ME.GuildConflictSeasonStage,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1659),this.setSize(601,148)},init:function(){this._list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this._list.itemRender=game.ShowItemListItem,this._list.layout.paddingLeft=-5,this._list.layout.spacingX=20,this._list.addToParent(this.skin.list)},setData:function(e){var t=this.skin,a=e.cfg;t.name.string=game.Lang.get(a.title),t.changeLab.string=game.Lang.get(53489,a.num);var i=game.Color,n=e.canGet||e.isGet?i.GREEN:i.RED;t.needNumLab.color=n,t.needNumLab.string=e.num+"/"+a.num,t.needNumLab.active=0==a.taskType||0<a.taskType&&e.isOpen,t.noOpenLab.active=0<a.taskType&&!e.isOpen,t.getImg.active=e.isGet,t.getBtn.active=e.isOpen&&e.canGet,0<a.taskType&&(t.noOpenLab.string=game.Lang.get(53490,game.CCommonUtil.replaceChineseNum(a.taskType))),this.updateRewList()},updateRewList:function(){var e=this.data.getPrizeList();e&&this._list.setData(e)},getBtn:function(){this.send(game.GuildConflictEvts.C_GET_TASK_REWARD,this.data.cfg.id)}}),b8e.RC("$$game","$$GuildConflictTaskItem",e)}(),function(){var e=game.View.extends({_showModel:!0,rewNum:3,ctor:function(){this._super(1660)},init:function(){var e=this,t=e.skin;e.moduleData=game.guildConflictData,e.rewList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),e.rewList.itemRender=game.GuildConflictTaskAwardItem,e.rewList.bindEnum=game.ME.GuildConflictMain,e.rewList.layout.spacingX=66,e.rewList.addToParent(t.rewList),e.tasklist=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.tasklist.itemRender=game.GuildConflictTaskItem,e.tasklist.bindEnum=game.ME.GuildConflictMain,e.tasklist.layout.paddingLeft=8,e.tasklist.layout.paddingTop=6,e.tasklist.layout.spacingY=6,e.tasklist.addToParent(t.list)},notify:function(e){switch(e){case this.Evts.C_UPDATE_TASK:this.updateList(),this.updateView();break;case this.Evts.C_UPDATE_TASK_PRO:this.updateRewList();break;case this.Evts.C_UPDATE_RESOURCES:this.updateView()}},onShow:function(){this.updateView(),this.updateList(),this.updateRewList()},updateView:function(){var e=this.skin,t=this.moduleData.getTaskProRewInfos();if(t){var a=t.length,i=t[a-1].cfg.num,n=e.pb_bg1.width-20,s=this.moduleData.seasonNum;i<s&&(s=i);for(var r=n/a,o=void 0,g=void 0,u=void 0,l=0;l<a;l++)if(o=0==l?0:t[l-1].cfg.num,g=t[l].cfg.num,o<s&&s<=g){u=r*l+(s-o)/(g-o)*r;break}e.pro.width=u}},updateList:function(){var e=this.moduleData.getTaskInfos();e&&this.tasklist.setData(e)},updateRewList:function(){var e=this.moduleData.getTaskProRewInfos();e&&this.rewList.setData(e)}});b8e.module.registerView(game.ME.GuildConflictTask,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1656),this.setSize(600,178)},setData:function(e){if(e){var t=this.skin,a=e.self,i=e.opposite;if(a&&i){var n=e.win;t.failImg.x=n?560:41,t.winImg.x=n?41:560,t.myWinBg.active=n,t.myFailBg.active=!n;var s=a.playerInfo,r=i.playerInfo;t.leftNameLab.string=game.HtmlUtil.getColorStrByQuality(s.roleQuality,s.name),t.rightNameLab.string=game.HtmlUtil.getColorStrByQuality(r.roleQuality,r.name),t.leftLoseLab.string=game.Lang.get(53491,a.lost),t.rightLoseLab.string=game.Lang.get(53491,i.lost);var o=t.left_pro_bg.width-18;t.left_pro.width=a.now/(a.now+a.lost)*o,t.right_pro.width=i.now/(i.now+i.lost)*o,t.leftLvLab.string=game.Lang.get(53481,s.level),t.rightLvLab.string=game.Lang.get(53481,r.level),t.left_starLab.string=s.topLv,t.right_starLab.string=r.topLv,t.left_arrLable.string=a.now+"/"+(a.now+a.lost),t.right_arrLable.string=i.now+"/"+(i.now+i.lost);var g=game.SysTime.curTime,u=b8e.TimeUtil.getLogoutTime(g-e.time);t.timeLab.string=u;var l=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(s.roleQuality));t.leftHeadBg.loadTexture(l),l=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(r.roleQuality)),t.rightHeadBg.loadTexture(l);var c=game.ResCfg.getHead(s.isMale);t.leftHeadIcon.loadTexture(c),c=game.ResCfg.getHead(r.isMale),t.rightHeadIcon.loadTexture(c),game.ShaderUtil.setGray(t.leftHeadNode,0==a.now),game.ShaderUtil.setGray(t.rightHeadNode,0==i.now)}}}}),b8e.RC("$$game","$$GuildConflictWarReportItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1661),this.setSize(600,147)},setData:function(e){var t=this.skin,a=e.playerInfo,i=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(a.roleQuality));t.headBg.loadTexture(i);var n=game.ResCfg.getHead(a.isMale);t.headIcon.loadTexture(n),t.lvLab.string=game.Lang.get(53481,a.level),t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.roleQuality,a.name),t.areaLab.string=game.Lang.get(53478,a.zone),t.attackNumLab.string=game.Lang.get(53492,e.num);var s=game.guildConflictData.getCityInfosById(e.node);if(s){var r=s.cfg,o=game.HtmlUtil.getColorStrByQuality(r.quality,r.name);t.palceLab.string=game.Lang.get(53493,o)}},attackBtn:function(){var e=game.GuildConflictAttackTypes.RIVAL;this.send(game.GuildConflictEvts.V_COUNTER_ATTACK,e,this.data.playerInfo.roleId)}}),b8e.RC("$$game","$$GuildConflictWarRivalItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1646),this.setSize(600,126)},setData:function(e){var t=this.skin,a=e.rank;t.rank_1.active=1==a,t.rank_2.active=2==a,t.rank_3.active=3==a;var i=e.playerInfo,n=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(i.roleQuality));t.headBg.loadTexture(n),n=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(i.roleQuality)),t.headBg.loadTexture(n),t.starLab.string=i.topLv,t.nameLab.string=i.name,t.tribeNameLab.string=e.guildName,t.areaNameLab.string=game.Lang.get(53478,i.zone),t.moneyNumLab.string=e.output,t.rank.string=e.rank;var s=game.GuildConflictRankTypes;e.type==s.MARS?(t.caiShenNode.active=!0,t.zhanShenNode.active=!1):(t.caiShenNode.active=!1,t.zhanShenNode.active=!0)}}),b8e.RC("$$game","$$GuildConflictRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1662),this.toggles={tab1_select:game.ME.GuildConflictBattleLog,tab2_select:game.ME.GuildConflictRival,tab3_select:game.ME.GuildConflictEnemie}},notify:function(e,t){switch(e){case this.Evts.C_BATTLE_SITUA_TOGGLE:this.toggleTrigger(t)}},onShow:function(){this.toggleTrigger(0)},toggleTrigger:function(e){this.toggleSelect(e)&&0==e&&this.send(this.Evts.UPDATE_BATTLELOG_ALERT)}});b8e.module.registerView(game.ME.GuildConflictWarSitua,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1663),this.setSize(600,147)},setData:function(e){var t=this.skin;if(t.icon.loadTexture(game.ResCfg.getUrl(10230,e.icon)),t.nameLab.string=e.name,t.areaLab.string=game.Lang.get(53478,e.zone),t.attackNumLab.string=game.Lang.get(53492,e.num),0==e.nodeId)t.palceLab.string=game.Lang.get(53493,game.HtmlUtil.getText(game.Color.RED,"\u65e0"));else{var a=game.guildConflictData.getCityInfosById(e.nodeId);if(!a)return;var i=a.cfg,n=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);t.palceLab.string=game.Lang.get(53493,n)}},attackBtn:function(){if(0!=this.data.nodeId){var e=game.GuildConflictAttackTypes.GUILD;this.send(game.GuildConflictEvts.V_COUNTER_ATTACK,e,this.data.id)}else game.notice.show(53688)}}),b8e.RC("$$game","$$GuildConflictWarTribeItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1628)},notify:function(e,t){switch(e){case this.Evts.C_CHANGE_BTN_STATE:this.changeBtnState(t)}},onShow:function(){this.updataView()},updataView:function(){var e=this.skin,t=game.guildConflictData.foods,a=50<=t?game.Color.GREEN:game.Color.RED,i=100<=t?game.Color.GREEN:game.Color.RED;e.costNumLab_1.string=game.HtmlUtil.getText(a,50),e.costNumLab_2.string=game.HtmlUtil.getText(i,100)}});b8e.module.registerView(game.ME.GuildConflictAddPower,e)}(),function(){var e=game.View.extends({_showModel:!0,viewPlayerInfo:null,cityClickData:null,headIconAry:null,clashStamina:0,ctor:function(){this._super(1630)},init:function(){this.moduleData=game.guildConflictData,this.headIcon=b8e.Sprite.get(),this.headIcon.setAnchor(.5,.5),this.headIcon.setSize(84,84),this.headIcon.addToParent(this.skin.ownHeadIcon),this.headIconAry=[]},notify:function(e){switch(e){case this.Evts.UPDATE_LOOK_PLAY_INFO:case this.Evts.C_UPDATE_RESOURCES:this.updateInfo()}},onShow:function(){this.updateInfo()},updateInfo:function(){var e=this;e.viewPlayerInfo=e.moduleData.viewPlayerInfo,e.viewPlayerInfo&&(e.cityClickData=e.moduleData.cityClickData,e.cityClickData&&(e.clashStamina=e.moduleData.clashStamina,e.loadHeadIcon(e.viewPlayerInfo.isMale),e.setLabInfo(),e.setList()))},setList:function(){var e=this,t=e.skin,a=e.viewPlayerInfo.partners;if(a){var i=a.length;e.headIconAry.length=0,t.list.removeAllChildren();for(var n=0;n<i;n++){var s=new game.PartnerInfo;if(!s)return;var r=game.PartnerCfg.getData(a[n].id);r&&(s.setCfgData(r),e.headIcon=e.headIconAry[n],s.id=a[n].id,s.lv=a[n].lv,s.top=a[n].top,s.star=a[n].star,s.slot=a[n].slot,s._active=!0,e.headIcon||(e.headIcon=new game.CultivateBaseIcon,e.headIcon.setPosition(107*n+52,-54),e.headIcon.addToParent(t.list),e.headIconAry[n]=e.headIcon),e.headIcon.setData(s))}}},setLabInfo:function(){var e=this,t=e.skin,a=e.moduleData.warToken;t.fightLab.string=e.viewPlayerInfo.power,t.lvLab.string=game.Lang.get(5902,e.viewPlayerInfo.level),t.powerLab.string=e.cityClickData.num+"/"+e.clashStamina,t.power_progress.width=Math.min(135,e.cityClickData.num/e.clashStamina*135),t.guildNameLab.string=e.viewPlayerInfo.guildName?game.Lang.get(53406,e.viewPlayerInfo.guildName,e.cityClickData.playerInfo.zone):game.Lang.get(53406,game.Lang.get(53566),e.cityClickData.playerInfo.zone);var i=e.moduleData.cityId,n=e.moduleData.nodeId,s=e.moduleData.getCityInfosById(i),r=e.moduleData.getIsFirend(e.cityClickData),o=1==s.cfg.types||r;t.notCanChange.active=o,t.gotoNode.active=i!=n&&!o,1==s.cfg.types?t.peaceCityLab.string=game.Lang.get(53418):r?t.peaceCityLab.string=game.Lang.get(53419):i!=n&&(t.gotoLab.string=game.Lang.get(53420));var g=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(e.viewPlayerInfo.roleQuality));t.ownHeadBg.loadTexture(g),t.canChange.active=!t.gotoNode.active&&!t.notCanChange.active,e.clashWarTokenNum||(e.clashWarTokenNum=+game.CfgUtil.getMiscValue(game.ClashMiscCfg,"clashWarTokenNum"));var u=e.moduleData.seasonState==game.GuildConflictSeasonStates.FIERCE||1<s.rate?.5:1;if(t.costNumLab_2.string=e.clashWarTokenNum*u,t.costNumLab_1.string=5*e.clashWarTokenNum*u,t.canChange.active){var l=1<=(t.warorderLab.string=a)?game.Color.GREEN:game.Color.RED,c=5<=a?game.Color.GREEN:game.Color.RED;game.HtmlUtil.getText(l,t.costNumLab_2),game.HtmlUtil.getText(c,t.costNumLab_1)}},loadHeadIcon:function(e){var t=game.ResCfg.getHead(e);this.skin.ownHeadIcon.loadTexture(t)},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth;this.setPosition(.5*(t-this.width),.5*(e+this.height))}});b8e.module.registerView(game.ME.GuildConflictBattle,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1633)},notify:function(e){switch(e){case this.Evts.C_UPDATE_RESOURCES:this.updataView()}},onShow:function(){this.updataView()},updataView:function(){var e=this.skin,t=game.guildConflictData,a=t.foods,i=t.getCityInfosById(t.cityId);if(i){var n=i.cfg.name,s=t.getIntoCityNeedFood(i.id);if(s&&0!=s){var r=game.HtmlUtil.getColorByQuality(i.cfg.quality,!0),o=s<=a?game.Color.GREEN:game.Color.RED;t.moveFood=s<=a,e.costNumLab.string=game.HtmlUtil.getText(o,s),e.tipsLab.string=game.Lang.get(53407,s,game.HtmlUtil.getText(r,n))}}},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth;this.setPosition(.5*(t-this.width),.5*(e+this.height))}});b8e.module.registerView(game.ME.GuildConflictCityMove,e)}(),function(){var e=game.View.extends({_showModel:!0,battleResultInfo:null,ctor:function(){this._super(1648)},init:function(){game.TweenUtil.rotationEffect(this.skin.light)},onShow:function(){var e=this;e.battleResultInfo=game.guildConflictData.battleResultInfo,e.updataView(),e.timer?(e.timer.reset(),e.timer.start()):e.timer=b8e.Timer.add(e,e.updateTime,1e3),e.skin.bg.width=b8e.stageWidth+100,e.enter=10},updateTime:function(){this.enter--,this.enter<=0?game.module.hide(game.ME.GuildConflictResult):this.skin.timeLab.string=game.Lang.get(51407,this.enter)},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updataView:function(){var e=this.skin;if(1==this.battleResultInfo.types){var t=1==this.battleResultInfo.win;e.winNode.active=t,e.failedNode.active=!t,this.showResulte();var a=game.playBack.info;a&&(e.roundLab.string=game.Lang.get(1621,a.rounds,a.roundLimit))}},showResulte:function(){var e=this.skin,t=this.battleResultInfo.selfBefore,a=this.battleResultInfo.selfAfter,i=this.battleResultInfo.targetBefore,n=this.battleResultInfo.targetAfter;e.ownPowerLab.string=game.Lang.get(53421,a),e.enemyPowerLab.string=game.Lang.get(53422,n),e.numLab1.string=game.Lang.get(53464,t-a),e.numLab2.string=game.Lang.get(53464,i-n)},onHide:function(){var e=this.battleResultInfo.selfAfter,t=this.battleResultInfo.targetAfter;0==e?(game.guildConflictData.backBirthId=this.battleResultInfo.node,b8e.evt.dptG(game.GuildConflictEvts.SHOW_FAIL_TIPS)):0==t&&game.notice.show(game.Lang.get(53423))},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth;this.setPosition(.5*(t-this.width),.5*(e+this.height))}});b8e.module.registerView(game.ME.GuildConflictResult,e)}(),function(){var e=game.View.extends({_showModel:!0,itemList:null,sweepInfo:null,battleLogs:null,type:0,index:0,node:0,ctor:function(){this._super(1657)},init:function(){this.itemList=[],this.index=0,this.node=0,this.sweepInfo=game.guildConflictData.battleResultInfo},notify:function(e){switch(e){case this.Evts.C_SWEEP_BATTLE_FIVE:this.updateData()}},onShow:function(){this.type=0,this.updateData()},updateData:function(){var e=this,t=e.skin;t.endItem.active=!1,t.battleFiveBtn2.active=!1,e.removeItem(),e.itemList=[],e.nextY=0,e.index=0,e.showNum=e.sweepInfo.battleTimes,e.showAll=e.showNum==e.sweepInfo.types,e.node=e.sweepInfo.node||0,e.battleLogs=e.sweepInfo.battleLogs;var a=(e.type=0)==e.sweepInfo.selfAfter,i=0==e.sweepInfo.targetAfter;a&&i?e.type=3:a?e.type=1:i&&(e.type=2),e.timer||(e.timer=b8e.Timer.add(e,e.showItem,500))},showItem:function(){var e=this,t=e.skin,a=void 0;e.index<e.showNum?((a=e.itemList[e.index])||(a=new game.GuildConflictSweepItem(game.ME.GuildConflictSweep),e.itemList.push(a)),a.setData(e.battleLogs[e.index],!1),a.addToParent(t.item),a.y=e.nextY,e.nextY=a.y-180,t.content.height=-e.nextY,671<-e.nextY&&t.itemSc._scrollView.scrollToBottom()):e.index>e.showNum&&(e.showAll&&(t.endItem.active=!0,t.battleFiveBtn2.active=!0,(a=e.itemList[e.index])||(a=new game.GuildConflictSweepItem(game.ME.GuildConflictSweep),e.itemList.push(a)),a.setData(e.sweepInfo,!0),a.addToParent(t.totalNode)),1<=e.type&&b8e.evt.dptG(game.GuildConflictEvts.SOMEONE_FAIL2),e.clearTimer()),e.index++},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.showItem),this.timer=null)},removeItem:function(){if(this.itemList)for(var e=this.itemList.length,t=void 0,a=0;a<e;a++)(t=this.itemList[a]).parent&&t.removeFromParent()},onHide:function(){var e=this;e.timer&&e.clearTimer(),e.removeItem();var t=game.guildConflictData;if(1==e.type){if(0!=e.node&&e.node!=t.nodeId)return t.backBirthId=e.node,void b8e.evt.dptG(game.GuildConflictEvts.SOMEONE_FAIL,1)}else{if(2==e.type)return void b8e.evt.dptG(game.GuildConflictEvts.SOMEONE_FAIL,2);if(3==e.type)return 0!=e.node&&e.node!=t.nodeId?(t.backBirthId=e.node,b8e.evt.dptG(game.GuildConflictEvts.SOMEONE_FAIL,1),void b8e.evt.dptG(game.GuildConflictEvts.SOMEONE_FAIL,2)):void 0}e.send(e.Evts.C_CLOSE_CITYVIEW)}});b8e.module.registerView(game.ME.GuildConflictSweep,e)}(),function(){var e=game.View.extends({_showModel:!0,tpye:1,idAry:null,foods:0,num:0,foosPrcie:0,foodMax:0,warTokenPrice:0,warTokenMax:0,havaMoney:0,isFirst:!0,ctor:function(){this._super(1631)},init:function(){this.idAry=game.guildConflictData.clashItemId,this.foosPrcie=game.guildConflictData.clashFoodPrice,this.warTokenPrice=game.guildConflictData.clashWarTokenPrice,this.foodMax=game.guildConflictData.clashFoodMax,this.warTokenMax=game.guildConflictData.clashWarTokenMax,this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.icon)},notify:function(e,t){switch(e){case this.Evts.C_BUY_NUM_ADD:this.onAddCount(t);break;case this.Evts.C_UPDATE_RESOURCES:this.updataView()}},onAddCount:function(e){var t=this;if(t.num+=e,t.num<1)t.num=1;else if(t.num>t.maxBuy){if(t.num=t.maxBuy,!t.isFirst)return void game.notice.show(game.Lang.get(53415));t.isFirst=!1}else t.num<t.maxBuy&&(t.isFirst||(t.isFirst=!0));return 1==t.tpye&&t.num>t.foodMax?(t.num=t.foodMax,void game.notice.show(game.Lang.get(53415))):2==t.tpye&&t.num>t.warTokenMax?(t.num=t.warTokenMax,void game.notice.show(game.Lang.get(53415))):(game.guildConflictData.tiliBuyNum=t.num,void t.showPowerAdd())},onShow:function(){this.num=0,this.skin.count.active=!0,this.skin.tiliNode.active=!1,this.type=game.guildConflictData.openTpyeBuy,this.getFoodNum(),this.onAddCount(1),this.updataView()},updataView:function(){this.getFoodNum(),this.showPowerAdd(),this.getItemIcon()},getFoodNum:function(){var e=this;e.havaMoney=game.amount.get(game.AmountType.YUAN_BAO),1==e.type?e.maxBuy=Math.floor(e.havaMoney/e.foosPrcie):2==e.type&&(e.maxBuy=Math.floor(e.havaMoney/e.warTokenPrice)),e.maxBuy<1&&(e.maxBuy=1)},showPowerAdd:function(){var e=this.skin;e.count2.string=this.num;var t=void 0;1==this.type?t=Math.floor(this.num*this.foosPrcie):2==this.type&&(t=Math.floor(this.num*this.warTokenPrice)),e.amountNum.string=t},getItemIcon:function(){var e=this.skin,t=this.idAry.split("|"),a=0,i=0,n=void 0;1==this.type?(a=t[1],i=game.guildConflictData.foods,n=10):2==this.type&&(a=t[2],i=game.guildConflictData.warToken,n=1);var s=game.ItemUtil.createBaseItemInfo(a,n);game.GridUtil.setItemIcon(this._icon,s,!1,game.IconLayoutEnum.SHOW_NUM),e.limitBuyLab.string=game.Lang.get(53408,i),e.name.string=game.HtmlUtil.getText(game.Color.PURPLE,game.guildConflictData.getItemTypeStr(this.type))},onHide:function(){this.isFirst=!0}});b8e.module.registerView(game.ME.GuildConflictBuyFoods,e)}(),function(){var e=game.View.extends({_showModel:!0,cityInfo:null,cityList:null,timeNum:10,ctor:function(){this._super(1635)},init:function(){this.cityList=[],this.moduleData=game.guildConflictData},notify:function(e,t){var a=this;switch(e){case a.Evts.C_CHANGE_CITY_BOX:a.setCheckBox(t),a.showView();break;case a.Evts.UPDATE_DATA_CITY_LIST:case a.Evts.C_UPDATE_LOOK_CITY_INFO:case a.Evts.C_UPDATA_MOVE_NEW:case a.Evts.C_UPDATA_MOVE_OLD:case a.Evts.C_UPDATE_RESOURCES:case a.Evts.V_UPDATE_CITY_VIEW2:case a.Evts.UPDATE_DATA_REFRESH_TIME:a.showView()}},onShow:function(){var e=this,t=e.skin;if(t.maskBg.active=!1,e.moduleData.pageNum=1,e.cityInfo=e.moduleData.getCityInfosById(e.moduleData.cityId),e.cityInfo){var a=e.cityInfo.cfg;t.titleLab.string=a.name,e.setCheckBox(e.moduleData.selectCityBox),e.showView()}},showView:function(){this.updateCityList(),this.updatePageNum(),this.updataLabVaule()},refeshBtnTime:function(){var e=this.skin;e.maskBg.active=!0,e.refresh_btn.active=!1,this.createTimer()},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){this.timeNum--,this.timeNum<1?this.clearTimer():this.skin.timeLab.string=this.timeNum},clearTimer:function(){var e=this.skin;this.timer&&(this.timeNum=10,b8e.Timer.remove(this,this.setCountDown),this.timer=null,e.maskBg.active=!1,e.refresh_btn.active=!0)},setCheckBox:function(e){var t=this.skin;t.check_1.active=1==e,t.check_2.active=2==e},updataLabVaule:function(){var e=this,t=e.skin,a=e.hasIn=!1,i=e.cityInfo.slotInfos,n=e.cityInfo.rate,s=e.cityInfo.overload,r=e.cityInfo.exclusive,o=e.cityInfo.count,g=e.cityInfo.cfg.output,u=e.cityInfo.guildId,l=e.cityInfo.guildName,c=game.guildData.id,h=e.cityInfo.cfg.types,m=game.mainRoleData.id;if(i)for(var d=i.length,f=0;f<d;f++)if(m==i[f].playerInfo.roleId){a=!0;break}for(var p=100*e.moduleData.clashOccupied,v=100*e.moduleData.clashExclusive,E=100*e.moduleData.clashDecrease,T=e.moduleData.clashOutputInterval,C=e.moduleData.clashOverload,I=e.moduleData.clashLang,S=h==game.GuildConflictCityTypes.NODE_BIRTH,_=0==o&&0!=c&&!S&&!l&&!r||r&&u==c,A=!S&&u==c&&0!=c&&!r||!S&&0<o&&0!=c&&!l,y=I.split("|"),D=y.length,L=void 0,b=void 0,R=0;R<D;R++)if((L=y[R].split("="))[0]==h){b=L[1];break}var w=0;s&&(w=1),a||s||(s=C<=o+1,w=0);var k=n,P=void 0;P=r&&u==c||_?100+p+v:0!=u&&u==c&&!S||A?100+p:100;var M,B=0;if(S&&0<n?B=1440/T*g:(!S&&0<n||_)&&(B=1440/T*g*k*(P-w*E)/100),M=w*E,t.hasIntoNode.active=!0,t.bg_4.active=!S,t.haveImg.active=!r&&0<o&&!S&&!_,t.oneImg.active=r&&0<o&&!S,t.myIntoNode.active=!a,t.noIntoNode.active=s&&!S,t.addNumBg.active=a&&!S||_||A,t.perAddLab.active=!S,a?(t.moveNode.y=S?-100:s?-82:-96,t.addNumBg.y=s?-95:-109,t.lab_2.string=game.Lang.get(53399),t.noIntoNode.active&&(t.jianLab.string=game.Lang.get(53402,M,o,C)),r&&u==c?t.perAddLab.string=game.Lang.get(53465,p,v):0!=u&&u==c&&h!=game.GuildConflictCityTypes.NODE_BIRTH?t.perAddLab.string=game.Lang.get(53511,p,v):t.perAddLab.string=game.Lang.get(53401,p,v)):(t.moveNode.y=S?-110:-82,t.lab_2.string=game.Lang.get(53398),t.jianLab.string=game.Lang.get(53402,M,o,C),t.perAddLab.string=_?game.Lang.get(53465,p,v):A?game.Lang.get(53511,p,v):game.Lang.get(53401,p,v),t.addNumBg.active&&(t.addNumBg.y=-96)),t.addNumBg.active){var N=(P-w*E)*k-100;t.addNumLab.string=game.Lang.get(53405,N),t.haveImg2.active=0<=N,t.haveImg3.active=N<0}if(t.multipleImg.active=1<n,1<n){var G=game.ResCfg.getUrl(10205,"rate_"+n);t.multipleImg.loadTexture(G)}if(t.nameLab.active=h!=game.GuildConflictCityTypes.NODE_BIRTH,t.nameLab.active&&(t.nameLab.string=0<o&&l?l:game.Lang.get(53403)),t.addMoneyLab.string=0==B?game.Lang.get(53566):game.Lang.get(53400,B),t.addNumBg.x=t.addMoneyLab.x+t.addMoneyLab._width-36,t.bg_5.active=t.lab_1.active=1<n,t.lab_1.string=game.Lang.get(b),!a){var U=e.moduleData.getIntoCityNeedFood(e.cityInfo.id)||0,V=U>=e.moduleData.foods?game.Color.RED:game.Color.GREEN;t.needNumLab.string=game.HtmlUtil.getText(V,game.Lang.get(1621,e.moduleData.foods,U))}},updateCityList:function(){var e=this.moduleData.getCityInfoArrByPageByType();e=e||[];for(var t=void 0,a=void 0,i=void 0,n=void 0,s=0;s<9;s++)t=e[s],(a=this.cityList[s])||(a=new game.GuildConflictSlotItem(game.ME.GuildConflictCity),i=s%3,n=Math.floor(s/3),a.setPosition(203*i+90,-210*n-114),a.addToParent(this.skin.list),a.show(),this.cityList[s]=a),a.type=this.cityInfo.cfg.types||0,a.setVisible(!0),a.setData(t)},updatePageNum:function(){var e=this.skin,t=this.moduleData.getPageCount(),a=this.moduleData.pageNum;e.inputNode.active=!(t<=1),e.page_lab.string=a+" / "+t}});b8e.module.registerView(game.ME.GuildConflictCity,e)}(),function(){var e;e=game.Widget.extends({type:0,ctor:function(){this._super(1655),this.setSize(446,116)},onShow:function(){this.setData(this._data)},setData:function(e){var t=this.skin;if(this._data=e,this.skin){if(!e){var a=game.ResCfg.getUrl(10205,"type_"+this.type+"_gray");return t.buildingImg.loadTexture(a),t.guildNameLab.string="",t.serverLab.string="",t.nameLab.string="",t.powerLab.string="",t.guildBg.active=!1,t.pro.width=0,t.powerBg.active=!1,t.powerBg.active=!1,t.mode.active=!1,t.enemyBg.unloadTexture(),void(t.enemyBg.active=!1)}t.guildBg.active=!0,t.powerBg.active=!0;var i=e.playerInfo,n=game.mainRoleData.id,s=game.guildConflictData.clashStamina,r=e.enemy;if(t.enemyBg.active=r){var o=game.ResCfg.getUrl(10205,"enemy");t.enemyBg.loadTexture(o)}var g=void 0;n==i.roleId?(g=0,t.guildNameLab.string="",t.serverLab.string=""):(g=i.roleQuality,t.guildNameLab.string=e.guildName.slice(0,2)||"",t.serverLab.string=game.Lang.get(53404,i.zone));var u=game.ResCfg.getUrl(10205,"quality_"+g);t.guildBg.loadTexture(u);var l=game.ResCfg.getUrl(10205,"type_"+this.type+"_light");t.buildingImg.loadTexture(l);var c=game.HtmlUtil.getColorByQuality(i.roleQuality);t.nameLab.color=c,t.nameLab.string=i.name,t.powerLab.string=e.num,t.pro.width=Math.min(123,e.num/s*123),this.moduleViw(e.surface,i.isMale)}},moduleViw:function(e,t){var a=this,i=a.skin,n=a.roleData,s=game.RoleType;if(a._data){i.mode.active=!0,n=n||(a.roleData=game.BaseRoleData.get(s.Hero,1)),a.model&&a.model.release(),a.model=game.sceneRoleCreate.createUIRole(a.roleData),a.model.addToParent(i.mode);var r=n.heroModel;if(r)if(r.clear(),e)if(r.setMale(t),r.setBody(s.Hero,1001),e)r.setSurface(e,game.RoleType.Hero,!0),game.AvatarUtil.updateUIModel(a.model),a.model.transition(game.RoleStateType.ACTION_IDLE);else a.model.clear();else a.model.active=!1}},clickBtn:function(){b8e.evt.dptG(game.GuildConflictEvts.C_CITY_ITEM_CLICK,this._data)}}),b8e.RC("$$game","$$GuildConflictSlotItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1658),this.setSize(100,120)},setData:function(e){var t=this.skin,a=e.cfg;this.item||(this.item=game.GridUtil.createItemIcon(game.IconSizeEnum.SIZE_70),this.item.addToParent(t.rewNode));var i=a.awards[0];this.itemInfo=game.ItemUtil.createBaseItemInfo(i.Id,i.Num,this.itemInfo),this.item.setItemInfo(this.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM),t.isGet.active=e.isGet,t.redPoint.active=!e.isGet&&e.canGet,t.numLab.string=a.num,t.clickBtn.active=e.canGet,t.isGet.active=e.isGet},clickBtn:function(){this.send(game.GuildConflictEvts.C_GET_TASK_PRO_REWARD,this.data.cfg.num)}}),b8e.RC("$$game","$$GuildConflictTaskAwardItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1629)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictWarReportItem,this.list.bindEnum=game.ME.GuildConflictBattleLog,this.list.layout.paddingLeft=4,this.list.layout.paddingTop=6,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_BATTLE_SITUATION2:this.updateList()}},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=this.moduleData.battleLogInfos;!t||t.length<1?(e.suDiNoTip.active=!0,e.suDiNoTip_lab.string=game.Lang.get(53466)):(e.suDiNoTip.active=!1,this.list.setData(t))},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictBattleLog,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1636)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictWarTribeItem,this.list.bindEnum=game.ME.GuildConflictWarSitua,this.list.layout.paddingLeft=4,this.list.layout.paddingTop=6,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=this.moduleData.guildEnemieInfos;!t||t.length<1?(e.suDiNoTip.active=!0,e.suDiNoTip_lab.string=game.Lang.get(53467)):(e.suDiNoTip.active=!1,this.list.setData(t))},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictEnemie,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1650)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictWarRivalItem,this.list.bindEnum=game.ME.GuildConflictWarSitua,this.list.layout.paddingLeft=4,this.list.layout.paddingTop=6,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=this.skin,t=this.moduleData.personalEnemieInfos;!t||t.length<1?(e.suDiNoTip.active=!0,e.suDiNoTip_lab.string=game.Lang.get(53486)):(e.suDiNoTip.active=!1,this.list.setData(t))},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictRival,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1641)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictRichRanItem,this.list.bindEnum=game.ME.GuildConflictMarsRank,this.list.layout.paddingLeft=7,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},onShow:function(){this.updateView(),this.updateList()},updateView:function(){var e=this.skin;e.winNumLab.active=!0,e.outputNode.active=!1;var t=this.moduleData.getMineRankInfoByType(game.GuildConflictRankTypes.MARS);e.mineRankLab.string=t?game.Lang.get(53474,t.rank):game.Lang.get(53473),e.winNumLab.string=game.Lang.get(53475,this.moduleData.win)},updateList:function(){var e=this.moduleData.marsRankInfos;e&&this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictMarsRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1649)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictRichRanItem,this.list.bindEnum=game.ME.GuildConflictRichRank,this.list.layout.paddingLeft=7,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},onShow:function(){this.updateList(),this.updateView()},updateView:function(){var e=this.skin;e.winNumLab.active=!1,e.outputNode.active=!0;var t=this.moduleData.getMineRankInfoByType(game.GuildConflictRankTypes.RICH);e.mineRankLab.string=t?game.Lang.get(53485,t.rank):game.Lang.get(53484),e.outputLab.string=game.CCommonUtil.replaceNum(this.moduleData.totalOutput,1)},updateList:function(){var e=this.moduleData.richRankInfos;e&&this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictRichRank,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1634)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictOccupyRankItem,this.list.bindEnum=game.ME.GuildConflictCityOccupyView,this.list.layout.paddingLeft=8,this.list.layout.paddingTop=6,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=void 0;(e=this.moduleData.seasonState==game.GuildConflictSeasonStates.SETTLEMENT?this.moduleData.getNodeRankAry():this.moduleData.getCityOccupyInfos())&&this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictCityOccupy,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1645)},init:function(){this.moduleData=game.guildConflictData,this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictOccupyAawrdItem,this.list.bindEnum=game.ME.GuildConflictOccupyRew,this.list.layout.paddingLeft=8,this.list.layout.paddingTop=6,this.list.layout.spacingY=10,this.list.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=this.moduleData.getCityOccupyRewInfos();e&&this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildConflictOccupyRew,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1637)},onShow:function(){var e=game.ResCfg.getUrl(10205,"failTips");this.skin.bg.loadTexture(e)},onHide:function(){b8e.evt.dptG(game.GuildConflictEvts.BACK_BORN_CITY)},onStageResize:function(){var e=b8e.stageHeight,t=b8e.stageWidth;this.setPosition(.5*(t-this.width),.5*(e+this.height))}});b8e.module.registerView(game.ME.GuildConflictFail,e)}(),function(){var e;e=game.Widget.extends({data:null,bol:!1,ctor:function(e){this._super(1656),this.bindEnum=e},onShow:function(){this.updateView()},setData:function(e,t){this.data=e,this.bol=t,this.updateView()},updateView:function(){var e=this.skin;e&&(e.timeLab.active=!1,e.myWinBg.active=!1,e.myFailBg.active=!1,this.bol?this.endItem(this.data):this.setItemData(this.data))},endItem:function(e){var t=this;t.selfBefore=e.selfBefore,t.selfAfter=e.selfAfter,t.targetBefore=e.targetBefore,t.targetAfter=e.targetAfter,t.myLost=t.selfBefore-t.selfAfter,t.targetLost=t.targetBefore-t.targetAfter,t.setItemData(e.battleLogs[0])},setItemData:function(e){var t=this,a=t.skin,i=e.self,n=e.opposite,s=e.win,r=game.guildConflictData.clashStamina,o=i.playerInfo.name,g=i.playerInfo.isMale,u=i.playerInfo.level,l=i.playerInfo.roleQuality,c=i.playerInfo.topLv,h=i.now,m=i.lost,d=n.playerInfo.name,f=n.playerInfo.isMale,p=n.playerInfo.level,v=n.playerInfo.roleQuality,E=n.playerInfo.topLv,T=n.now,C=n.lost;s?(a.winImg.x=41,a.failImg.x=560):(a.winImg.x=560,a.failImg.x=41),a.vsImg.y=-89;var I=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(l));a.leftHeadBg.loadTexture(I);var S=game.ResCfg.getHead(g);t.skin.leftHeadIcon.loadTexture(S),a.leftLvLab.string=game.Lang.get(5902,u);var _=game.HtmlUtil.getColorByQuality(l);a.leftNameLab.string=game.HtmlUtil.getText(_,o),a.left_starLab.string=c;var A=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(v));a.rightHeadBg.loadTexture(A);var y=game.ResCfg.getHead(f);t.skin.rightHeadIcon.loadTexture(y),a.rightLvLab.string=game.Lang.get(5902,p);var D=game.HtmlUtil.getColorByQuality(v);a.rightNameLab.string=game.HtmlUtil.getText(D,d),a.right_starLab.string=E,t.bol?(a.leftLoseLab.string=game.Lang.get(53512,t.myLost),a.left_arrLable.string=t.selfAfter+"/"+r,a.left_pro.width=Math.min(100,t.selfAfter/r*100),a.rightLoseLab.string=game.Lang.get(53512,t.targetLost),a.right_arrLable.string=t.targetAfter+"/"+r,a.right_pro.width=Math.min(100,t.targetAfter/r*100)):(a.leftLoseLab.string=game.Lang.get(53424,m),a.left_arrLable.string=h+"/"+r,a.left_pro.width=Math.min(100,h/r*100),a.rightLoseLab.string=game.Lang.get(53424,C),a.right_arrLable.string=T+"/"+r,a.right_pro.width=Math.min(100,T/r*100))}}),b8e.RC("$$game","$$GuildConflictSweepItem",e)}(),function(){var e=game.View.extends({_showModel:!0,rankAry:null,ctor:function(){this._super(1652)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.GuildConflictSeaSettleItem,this.list.bindEnum=game.ME.GuildConflictRichRank,this.list.layout.paddingLeft=10,this.list.layout.paddingTop=6,this.list.layout.spacingY=6,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_UPDATA_NODE_RANK:this.shwoInfo()}},onShow:function(){this.shwoInfo()},shwoInfo:function(){this.rankAry=game.guildConflictData.getNodeRankAry(),this.setLeaderInfo(),this.updateList(),this.createTimer()},updateList:function(){this.rankAry&&this.list.setData(this.rankAry)},setLeaderInfo:function(){var e=this.skin,t=game.guildConflictData.leader;if(this.rankAry&&this.rankAry.length&&t){var a=game.ClashNodeCfg.getData(t.nodeId);if(!a)return;e.nameLab.string=game.Lang.get(53441,t.name);var i=game.HtmlUtil.getColorByQuality(a.quality),n=game.HtmlUtil.getText(i,a.name);e.occupiedLab.string=game.Lang.get(53442,n),e.serveLab.string=game.Lang.get(53651,t.guildName,t.zone),this.moduleViw(t.surface,t.isMale)}},timeCount:function(){var e=game.guildConflictData.getCountDown(),t=b8e.TimeUtil.formatTime(e);e<=0&&this.clearTimer(),this.skin.timeLab.string=game.Lang.get(53533,t)},createTimer:function(){this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.timeCount,1e3)},clearTimer:function(){this.timer&&(this.send(this.Evts.C_CLOSE_SEASETTLE),b8e.Timer.remove(this,this.timeCount),this.timer=null)},moduleViw:function(e,t){var a=this,i=a.roleData,n=game.RoleType;i=i||(a.roleData=game.BaseRoleData.get(n.Hero,1)),a.model&&a.model.release(),a.model=game.sceneRoleCreate.createUIRole(a.roleData),a.model.addToParent(a.skin.modelNode);var s=i.heroModel;s&&(s.clear(),e?(s.setMale(t),s.setBody(n.Hero,1001),e?(s.setSurface(e,game.RoleType.Hero,!0),game.AvatarUtil.updateUIModel(a.model),a.model.transition(game.RoleStateType.ACTION_IDLE)):a.model.clear()):a.model.active=!1)}});b8e.module.registerView(game.ME.GuildConflictSeaSettle,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1651),this.setSize(600,147)},setData:function(e){var t=this.skin,a=e.cfg;t.cityImg.loadTexture(game.ResCfg.getUrl(10204,a.types));var i=game.guildConflictData.getRate(e.rate),n=game.HtmlUtil.getColorByQuality(a.quality),s=a.name+i;t.cityName.string=game.HtmlUtil.getText(n,s),t.guildNameLab.string=e.guildName?game.Lang.get(53536,e.guildName):game.Lang.get(53403),t.zoneLab.string=e.guildZone?game.Lang.get(53443,e.guildZone):game.Lang.get(53403)}}),b8e.RC("$$game","$$GuildConflictSeaSettleItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1646),this.setSize(600,126)},setData:function(e){var t=this.skin,a=e.rank;t.rank_1.active=1==a,t.rank_2.active=2==a,t.rank_3.active=3==a;var i=e.playerInfo,n=game.ResCfg.getUrl(60,game.ResCfg.getQualityBg(i.roleQuality));t.headBg.loadTexture(n),n=game.ResCfg.getHead(i.isMale),t.headIcon.loadTexture(n);var s=game.HtmlUtil.getColorByQuality(i.roleQuality);t.nameLab.string=game.HtmlUtil.getText(s,i.name),t.starLab.string=i.topLv,t.tribeNameLab.string=e.guildName?game.Lang.get(53655,e.guildName):"",t.areaNameLab.string=game.Lang.get(53478,i.zone),t.moneyNumLab.string=e.output,t.rank.string=e.rank,t.lvLab.string=game.Lang.get(53481,i.level);var r=game.GuildConflictRankTypes;e.type==r.MARS?(t.caiShenNode.active=!1,t.zhanShenNode.active=!0,t.winNumLab.string=game.Lang.get(53475,e.win),t.winPerLab.string=game.Lang.get(53482,Math.floor(e.rate/10)+"%")):(t.caiShenNode.active=!0,t.zhanShenNode.active=!1,t.moneyNumLab.string=game.Lang.get(53483,e.output))}}),b8e.RC("$$game","$$GuildConflictRichRanItem",e)}(),game.GamePanel.extends({ctor:function(){this._super("teamLeague/TeamLeagueView"),this.spotAlerts={TEAMLEAGUE_HALL:this.hallAlert,TEAMLEAGUE_MATCH:this.matchAlert},this.toggles={toggle_btn_1:game.ME.TestHallView,toggle_btn_2:game.TestListView2}},init:function(){this.moduleEvts={Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess}},this.mgrEvts={TestMgr:{TeamLeagueEvts:{C_UPDATE_TEAMLEAGUE:this.mgrTest}}},this.addEvent(game.TeamLeagueEvts.C_UPDATE_TEAMLEAGUE,this.updateData,this)},mgrTest:function(e){e.data},rechargeSuccess:function(e){e.data},updateData:function(e){b8e.log("\u6536\u5230\u4e8b\u4ef6",e.data.ide),this.removeEvent(game.TeamLeagueEvts.C_UPDATE_TEAMLEAGUE,this.updateData,this)},upgradeResp:function(e){var t=e.readProtobuf(game.pb.PartnerUpgradeResponse);0<t.code&&game.notice.noticeError(t.code)},hallAlert:function(e){this.skin.red_spot_1.node.active=e.alert},matchAlert:function(e){this.skin.red_spot_3.node.active=e.alert},onShow:function(){},btn_1:function(){this.toggleSelect(0),this.send(game.TeamLeagueEvts.C_UPDATE_TEAMLEAGUE,{ide:857})},btn_2:function(){this.toggleSelect(1);var e=game.pb.PartnerModel;this.sendPb(game.protoId.PartnerModelReq,e),this.removeListenerPb(game.protoId.PartnerUpgradeResp,this.upgradeResp)},btn_3:function(){}}),game.GamePanel.extends({ctor:function(){this._super("test/TestLisView")},onShow:function(){},applyListBtn:function(){b8e.log("\u70b9\u51fb\u6309\u94ae")},onStageResize:function(){this.setPosition(0,0)}}),function(){var e;e=game.GamePanel.extends({ctor:function(){this._super("teamLeague/TeamLeagueSettlementView")},onShow:function(){},applyListBtn:function(){s,b8e.log("\u70b9\u51fb\u6309\u94ae")},onStageResize:function(){this.setPosition(0,0)}}),b8e.RC("$$game","$$TestListView2",e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({init:function(){this._super()},_addEvents:function(){this._super()},triggerOpen:function(){},rechargeSuccess:function(e){e.data;this.send(game.TeamLeagueEvts.V_AGREE,{ids:[1,2,3]})},updateData:function(e){b8e.log("\u6536\u5230\u4e8b\u4ef6",e.data.ide),this.removeEvent(game.TeamLeagueEvts.C_UPDATE_TEAMLEAGUE,this.updateData,this)},upgradeResp:function(e){var t=e.readProtobuf(game.pb.PartnerUpgradeResponse);0<t.code&&game.notice.noticeError(t.code)}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$TestMgr",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_UPDATE_HP:b8e.enc(),C2C_SET_FORMATION:b8e.enc(),V_REQ_RANKINFO:-1,V_UPDATE_RANK_VIEW:-1,UPDATE_RANK_DATA:-1,CV2_VIP_LV_CHANGE:-1,C2V_UPDATE_BUY_NUM:-1,C2V_UPDATE_ADD_HURT:-1,V2C_SELECT_ITEM:-1,C2V_SELECT_ITEM:-1,C2V_SCROLL_LEFT:-1,C2V_SCROLL_RIGHT:-1,C2V_UPDATE_SWEEP:-1,C2V_RESET_DAILY:-1}),b8e.RC("$$game","$$GuildInstanceEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.guildInstanceData,this.guildInsAlert=game.spotAlert.set(game.SAE.GUILD_INSTANCE,game.SAE.GUILD)},triggerOpen:function(e){e==this.moduleEnum&&this.reqData()},ipc:function(){var e=this;e.evts={MainRole:{C_VIP_LEVEL_CHANGE:e.changeVipLevel,C_RESET_DAILY:e.resetDaily,C_RECONNECT_MSIC_DATA:e.reconnectRqeData},Guild:{C_UPDATE_GUILD:e.updateGuild,C2C_MERGE_SUCCESS:e.mergeSuccess},GuildRecommend:{C_JOIN_GUILD:e.rqeData},CreateGuild:{C_CREATE_GUILD:e.rqeData}},e.handels={GuildInsDataResp:e.onGuildInsDataResp,GuildInsChallengeResp:e.onGuildInsChallengeResp,GuildInsBuyChallengeTimesResp:e.onGuildInsBuyChallengeTimesResp,GuildInsBuyAddHurtResp:e.onGuildInsBuyAddHurtResp,GuildInsAddHurtMsg:e.onGuildInsAddHurtMsg,GuildInsHpMsg:e.onGuildInsHpMsg,GuildInsGetRankResp:e.onGuildInsGetRankResp}},notify:function(e,t){switch(e){case this.Evts.V_REQ_RANKINFO:this.sendRankInfo(t);break;case this.Evts.V2C_SELECT_ITEM:this.selectItem(t)}},resetDaily:function(){this.data.resetDaily(),this.send(this.Evts.C2V_RESET_DAILY),this.checkAlert()},selectItem:function(e){var t=this.data;t.pageNum=1,t.selectItem(e),this.send(this.Evts.C2V_SELECT_ITEM);var a=t.getSelectInfo();if(a){var i=t.getRankByChapter(t.selectChaptId);a.isDeath&&i||this.sendRankInfo(e)}},updateGuild:function(){this.reqData()},mergeSuccess:function(){game.module.hide(game.ME.Guild),this.rqeData()},rqeData:function(){this.sender.GuildInsDataReq(),this.hasReq=!0},reconnectRqeData:function(){0<game.guildData.id&&this.rqeData()},reqData:function(){this.hasReq||game.moduleOpen.checkOpen(this.moduleEnum)&&game.guildData.hasGuild()&&(this.sender.GuildInsDataReq(),this.hasReq=!0)},onGuildInsGetRankResp:function(e){var t=e.readProtobuf(game.pb.GuildInsGetRankResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updataRankInfo(t),this.send(this.Evts.V_UPDATE_RANK_VIEW))},onGuildInsDataResp:function(e){var t=e.readProtobuf(game.pb.GuildInsDataResponse);0<t.code?game.notice.noticeError(t.code):(this.data.initData(t),this.updateAddHurtTime(),this.checkAlert())},checkAlert:function(){this.guildInsAlert.alert=0<this.data.challengeTimes},updateAddHurtTime:function(){this.data.lessOne();var e=this.data.getNextTime();this.clearTime();var t=e-game.SysTime.curTime;0<t&&(this.key=b8e.setTimeout(this.updateAddHurtTime,this,t),this.send(this.Evts.C2V_UPDATE_ADD_HURT))},onGuildInsChallengeResp:function(e){var t=e.readProtobuf(game.pb.GuildInsChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.data.onChallengeResp(t);var a=t.battlelog;if(0==t.op){a.win=!0;var i={items:t.userItem},n={type:game.InstanceType.GUILD_INS,isWin:!0,rewards:i,damage:t.damage};game.playBack.play(a,n),game.InsFunCountData.addChallengeCount(game.InsFunCountType.GUILDINS)}else game.awardsData.setItemsByArray(t.userItem,!1),game.module.show(game.ME.AwardShowTip),this.send(this.Evts.C2V_UPDATE_SWEEP);this.checkAlert()}},onGuildInsBuyChallengeTimesResp:function(e){var t=e.readProtobuf(game.pb.GuildInsBuyChallengeTimesResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updateNum(t.num),this.checkAlert(),this.send(this.Evts.C2V_UPDATE_BUY_NUM),game.notice.show(53357))},onGuildInsBuyAddHurtResp:function(e){var t=e.readProtobuf(game.pb.GuildInsBuyAddHurtResponse);0<t.code?game.notice.noticeError(t.code):game.notice.show(53359)},onGuildInsAddHurtMsg:function(e){var t=e.readProtobuf(game.pb.GuildInsAddHurtNotify);0<t.code?game.notice.noticeError(t.code):(this.data.onAddHurt(t),this.updateAddHurtTime(),this.send(this.Evts.C2V_UPDATE_ADD_HURT))},onGuildInsHpMsg:function(e){var t=e.readProtobuf(game.pb.GuildInsHpNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.data;0==t.hp&&this.sendRankInfo(t.chapter),t.chapter!=a.chapterId&&this.sendRankInfo(t.chapter),a.updateHp(t),this.send(this.Evts.C2V_UPDATE_HP)}},clearTime:function(){this.key&&(b8e.clearTimeout(this.key),this.key=null)},sendRankInfo:function(e){this.sender.GuildInsGetRankReq(e)},left_btn:function(){this.data.gotoPerRankPage(),this.send(this.Evts.UPDATE_RANK_DATA)},right_btn:function(){this.data.gotoNextRankPage(),this.send(this.Evts.UPDATE_RANK_DATA)},leftBtn:function(){this.send(this.Evts.C2V_SCROLL_LEFT)},rightBtn:function(){this.send(this.Evts.C2V_SCROLL_RIGHT)},activeBtn:function(){this.activeAlert||(this.activeAlert={key:game.ME.GuildInstanceRank,lang:53327,btn:game.Lang.get(9059),okcb:this.activeReq,thisArg:this,showtips:!0,defaultSelect:!0});var e=this.data,t=e.getHurtCost(),a=e.getPerAdd(),i=e.addHurt,n=!i||i.length<1?0:i.length;this.activeAlert.langArgs=[t,a,a*n],game.alert.show(this.activeAlert)},activeReq:function(){var e=this.data,t=e.getMaxAddNum(),a=e.addHurt;a&&a.length>=t?game.notice.show(53361):this.sender.GuildInsBuyAddHurtReq()},rankAwardBtn:function(){game.module.show(game.ME.GuildInstanceAward)},saodangBtn:function(){var e=this.data;e.sweepHurt?e.challengeTimes<1?game.notice.show(53363):(this.saoDangAlert||(this.saoDangAlert={key:game.ME.GuildInstanceAward,lang:53328,btn:game.Lang.get(9059),okcb:this.saodangReq,thisArg:this,showtips:!0,defaultSelect:!0}),this.saoDangAlert.langArgs=[this.data.sweepHurt],game.alert.show(this.saoDangAlert)):game.notice.show(53358)},saodangReq:function(){this.sender.GuildInsChallengeReq(1)},challengeBtn:function(){var e=this.data;if(e.challengeTimes<1)game.notice.show(53363);else{var t=e.selectChaptId,a=this.moduleEnum;this.dpt(this.Evts.C2C_SET_FORMATION,[a,t,this.sender.GuildInsChallengeReq,[0],this])}},changeVipLevel:function(){this.send(this.Evts.CV2_VIP_LV_CHANGE)},addBtn:function(){if(!this.addAlert){var e=this.data.getCost();this.addAlert={key:game.ME.GuildInstance,lang:53329,btn:game.Lang.get(9059),okcb:this.buyNum,thisArg:this,langArgs:[e],showtips:!0,defaultSelect:!0}}game.alert.show(this.addAlert)},buyNum:function(){var e=this.data,t=game.VipCfg.getData(game.mainRoleData.vipLevel);t&&(t.guildInstance-e.buyTimes<1?game.notice.show(53362):this.sender.GuildInsBuyChallengeTimesReq(1))},allRankBtn:function(){game.module.show(game.ME.GuildInstanceRank)}}),t=[game.ME.GuildInstanceRank,game.ME.GuildInstanceAward],a=game.Sender.extends({ipc:function(){this.msg={GuildInsDataReq:null,GuildInsChallengeReq:this.guildInsChallengeReq,GuildInsBuyChallengeTimesReq:this.guildInsBuyChallengeTimesReq,GuildInsBuyAddHurtReq:null,GuildInsGetRankReq:this.guildInsGetRankReq}},guildInsChallengeReq:function(e){var t=game.pb.GuildInsChallengeRequest;t.op=e,this.write(t)},guildInsBuyChallengeTimesReq:function(e){var t=game.pb.GuildInsBuyChallengeTimesRequest;t.num=e,this.write(t)},guildInsGetRankReq:function(e){var t=game.pb.GuildInsGetRankRequest;t.chapter=e,this.write(t)}});b8e.module.registerControl(game.ME.GuildInstance,e,game.GuildInstanceEvts,a,t)}(),function(){var e=b8e.Object.extends({isAwardAry:null,rankInfoMap:null,selectChaptId:null,pageNum:1,PER_PAGE_COUNT:4,chapterId:0,currHp:0,maxHp:0,challengeTimes:0,buyTimes:0,sweepHurt:0,ctor:function(){this._super(),this.instanceMap=b8e.HashMap.get(),this.rankInfoMap=b8e.HashMap.get(),this.addHurt=[]},initData:function(e){var t=this;t.instanceMap.clear(),t.rankInfoMap.clear(),t.addHurt=[],t.chapterId=e.chapterId,t.currHp=e.currHp,t.maxHp=e.maxHp,t.challengeTimes=e.challengeTimes,t.buyTimes=e.buyTimes,t.setAddHurt(e.addHurt),t.selectItem(e.chapterId),t.sweepHurt=e.sweepHurt,t.creatAward()},setAddHurt:function(e){if(e&&!(e.length<1)){e.sort(this.sortHurt);for(var t=this.addHurt=[],a=e.length,i=game.SysTime.curTime,n=0;n<a;n++)i<e[n]&&t.push(e[n])}},getCDtime:function(){var e=this.addHurt;return!e||e.length<1?-1:e[e.length-1]-game.SysTime.curTime},getNextTime:function(){var e=this.addHurt;return!e||e.length<1?0:e[0]},sortHurt:function(e,t){return e-t},lessOne:function(){var e=this.addHurt;!e||e.length<1||this.setAddHurt(e)},creatAward:function(){this.isAwardAry={};var e=game.GuildInstanceRankCfg.getDatas();if(e)for(var t=e.length,a=void 0,i=0;i<t;i++)(a=new game.GuildInstanceAwardInfo).initData(e[i]),this.isAwardAry[a.cfg.chapter]||(this.isAwardAry[a.cfg.chapter]=[]),this.isAwardAry[a.cfg.chapter].push(a)},createChapter:function(){var e=this.instanceMap,t=game.GuildInstanceCfg.getDatas();if(t&&!(t.length<1)){for(var a=t.length,i=void 0,n=0;n<a;n++)(i=new game.GuildInstanceInfo).setCfg(t[n]),e.set(i.id,i);i=e.get(this.chapterId)}},getInstanceMap:function(){var e=this.instanceMap;return e.count()<1&&this.createChapter(),e},getInstanceArr:function(){return this.getInstanceMap().values().sort(this._sort)},getSelectInfo:function(){return this.getInstanceMap().get(this.selectChaptId)},_sort:function(e,t){return e.chapter-t.chapter},onChallengeResp:function(e){this.challengeTimes--,0==e.op&&(this.sweepHurt=e.damage),e.chapter=this.chapterId,this.updataRankInfo(e)},onAddHurt:function(e){this.setAddHurt(e.addHurt)},updateNum:function(e){this.challengeTimes+=e,this.buyTimes+=e},updateHp:function(e){this.currHp=e.hp,this.maxHp=e.maxHp;var t=e.chapter,a=this.getInstanceMap(),i=a.get(e.chapter);if(i)if(t==this.chapterId)0==e.hp&&i.setDeath();else{i.setOpen();var n=a.get(this.chapterId);n&&n.setDeath(),this.sweepHurt=0,this.chapterId=t,this.selectItem(this.chapterId)}},updataRankInfo:function(e){var t=e.chapter;if(this.rankInfoMap.get(t)){var a=this.getRankByChapter(t);a.initData(e),this.rankInfoMap.set(t,a)}else{var i=new game.GuildInstanceRankInfo;i.initData(e),this.rankInfoMap.set(t,i)}},getRankByChapter:function(e){return this.rankInfoMap.get(e)},getAwardAry:function(){return this.isAwardAry[this.selectChaptId]},getAwardAryByCR:function(e){var t=this.getAwardAry();if(t&&!(t.length<0)){var a=t.length,i=void 0;if(0==e)return t[a-1];for(var n=0;n<a&&!(e>=(i=t[n]).cfg.startRank&&e<=i.cfg.endRank);n++);return i}},getRankInfoArrByPageByType:function(){this.pageNum<=0&&(this.pageNum=1);var e=this.PER_PAGE_COUNT;if(e<=0)return null;var t=null,a=this.getRankByChapter(this.selectChaptId).GuildInsRank,i=(this.pageNum-1)*e,n=this.pageNum*e;if(!a||a.length<0)return t;var s=a.length;if(n=Math.min(n,s),i<s){t=[];for(var r=i;r<n;r++){var o=a[r];o&&t.push(o)}}return t},getPageCount:function(){var e=this.getRankByChapter(this.selectChaptId).GuildInsRank;if(e&&0<e.length){var t=e.length;return Math.ceil(t/this.PER_PAGE_COUNT)}return 1},gotoNextRankPage:function(){this.pageNum<1&&(this.pageNum=1);var e=this.PER_PAGE_COUNT,t=this.getRankByChapter(this.selectChaptId).GuildInsRank;this.pageNum*e<t.length&&this.pageNum++},gotoPerRankPage:function(){this.pageNum<1&&(this.pageNum=1);var e=this.PER_PAGE_COUNT,t=this.getRankByChapter(this.selectChaptId).GuildInsRank;(this.pageNum-1)*e<t.length&&1<this.pageNum&&this.pageNum--},getCost:function(){return this.costNum||(this.costNum=0|game.CfgUtil.getMiscValue(game.GuildMiscCfg,"guildInstanceChallengeTimesCost")),this.costNum},getHurtCost:function(){return this.hurtCost||(this.hurtCost=0|game.CfgUtil.getMiscValue(game.GuildMiscCfg,"guildInstanceAddHurtCost")),this.hurtCost},getMaxChapter:function(){return this.maxChapter||(this.maxChapter=0|game.CfgUtil.getMiscValue(game.GuildMiscCfg,"guilInsMaxId")),this.maxChapter},getPerAdd:function(){return this.perAdd||(this.perAdd=0|game.CfgUtil.getMiscValue(game.GuildMiscCfg,"guildInsPerAdd")),this.perAdd},getMaxAddNum:function(){return this.maxAddNum||(this.maxAddNum=0|game.CfgUtil.getMiscValue(game.GuildMiscCfg,"guildInsAddNum")),this.maxAddNum},getFreeNum:function(){return this.freeNum||(this.freeNum=0|game.CfgUtil.getMiscValue(game.GuildMiscCfg,"guildInstanceChallengeTimes")),this.freeNum},selectItem:function(e){var t=this.getInstanceMap();if(this.selectChaptId){var a=t.get(this.selectChaptId);a&&a.setSelect(!1)}if(this.selectChaptId=e){var i=t.get(e);i&&i.setSelect(!0)}},setDefinSelect:function(){this.selectItem(this.chapterId)},resetDaily:function(){this.sweepHurt=0,this.buyTimes=0,this.challengeTimes=this.getFreeNum()}});game.guildInstanceData=game.guildInstanceData||new e}(),function(){var e;e=b8e.Object.extends({isOpen:!1,select:!1,isDeath:!1,active:!0,normalUrl:72,grayUrl:72,setCfg:function(e){this.cfg=e,this.id=e.chapter,this.isOpen=this.id<=game.guildInstanceData.chapterId,this.select=this.id==game.guildInstanceData.chapterId,this.isDeath=this.id<game.guildInstanceData.chapterId,this.quality=e.quality},setDeath:function(){this.isDeath=!0},setOpen:function(){this.isOpen=!0},getKillprize:function(){var e=this.prize;if(!e){var t=this.cfg.finalHitAward;if(!t||t.length<1)return;var a=game.IconLayoutEnum.SHOW_NONE,i=game.IconSizeEnum.GRID_SIZE_105;e=this.prize=game.CfgUtil.getPrizeListInfo(t,a,i).items}return e},setSelect:function(e){this.select=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildInstanceInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,ctor:function(){},initData:function(e){this.cfg=e},getPrizeList:function(e){var t=0<arguments.length&&void 0!==e?e:game.IconSizeEnum.GRID_SIZE_84;return this.prizeList?(this.setSize(t),this.prizeList):this.cfg?(this.prizeList=game.CfgUtil.getPrizeListInfo(this.cfg.award).items,this.setSize(t),this.prizeList):null},setSize:function(e){var t=this.prizeList;if(t&&!(t.length<1))for(var a=t.length,i=0;i<a;i++)t[i].iconSize=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildInstanceAwardInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,chapter:null,userRank:null,GuildInsRank:null,ctor:function(){},initData:function(e){this.cfg=e,this.chapter=e.chapter,this.userRank=e.userRank,this.GuildInsRank=e.list},getPrizeList:function(){return this.GuildInsRank},getInfoByRank:function(e){return 0<=this.GuildInsRank.length?this.GuildInsRank[e-1]:null},getSelfRankDamge:function(){if(0==this.userRank)return 0;var e=this.userRank-1;return this.GuildInsRank[e].dmg}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildInstanceRankInfo",e)}(),function(){var e;e=b8e.Object.extends({cfg:null,name:null,isMale:null,level:null,dmg:null,power:null,vipLevel:null,Info:null,ctor:function(){},initData:function(e){this.cfg=e,this.name=e.name,this.isMale=e.isMale,this.level=e.level,this.dmg=e.dmg,this.power=e.power,this.vipLevel=e.vipLevel,this.Info=e.Info}}),b8e.BindingUtil.bind(game.GuildInstanceRankInfo),b8e.RC("$$game","$$GuildInstanceRankItemInfo",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1596),this.spotAlerts={GUILD_INSTANCE:this.challengeAlert}},init:function(){var e=this,t=e.skin;e.data=game.guildInstanceData;var a=e.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.GuildInstanceHeadItem,a.layout.spacingX=5,a.bindEnum=e.moduleEnum,a.addToParent(t.bossList),a.setScrollViewCb(e.listCb,e);var i=e.killPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);i.itemRender=game.PrizeListItem,i.layout.paddingLeft=8,i.layout.paddingTop=0,i.layout.spacingX=20,i.bindEnum=e.moduleEnum,i.addToParent(t.list2);var n=e.rankPrizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);n.itemRender=game.PrizeListItem,n.layout.paddingLeft=8,n.layout.paddingTop=0,n.layout.spacingX=20,n.bindEnum=e.moduleEnum,n.addToParent(t.list1),e.barLen=398},listCb:function(e,t,a){var i=this.skin;i.leftBtn.active=0<e.length,i.rightBtn.active=0<a.length},challengeAlert:function(e){this.skin.redPoint.active=e.alert},notify:function(e){var t=this;switch(e){case t.Evts.V_UPDATE_RANK_VIEW:t.updateRank();break;case t.Evts.CV2_VIP_LV_CHANGE:case t.Evts.C2V_UPDATE_BUY_NUM:t.updateNum();break;case t.Evts.C2V_UPDATE_ADD_HURT:t.createTimer();break;case t.Evts.C2V_UPDATE_HP:t.scrollBtnsList(),t.updatePrize(),t.updatetModel(),t.updateHp(),t.updateRank();break;case t.Evts.C2V_SELECT_ITEM:t.updatePrize(),t.updatetModel(),t.updateHp(),t.updateRank();break;case t.Evts.C2V_SCROLL_LEFT:t.scrollLeft();break;case t.Evts.C2V_SCROLL_RIGHT:t.scrollRight();break;case t.Evts.C2V_UPDATE_SWEEP:t.updateHp(),t.updateNum(),t.updateRank();break;case t.Evts.C2V_RESET_DAILY:t.updateNum()}},scrollLeft:function(){this.list.scrollContainerLeft()},scrollRight:function(){this.list.scrollContainerRight()},onShow:function(){var e=this;e.send(e.Evts.V_REQ_RANKINFO,e.data.selectChaptId),e.data.setDefinSelect(),e.scrollBtnsList(),e.updateList(),e.updatePrize(),e.updatetModel(),e.updateHp(),e.updateNum(),e.createTimer()},scrollBtnsList:function(){this.list.scrollToRight(113*this.data.selectChaptId-103)},updateList:function(){var e=this.data.getInstanceArr();this.list.setData(e)},updatePrize:function(){var e=this.data.getSelectInfo();if(e){var t=e.getKillprize();!t||t.length<1||this.killPrizeList.setData(t)}},updatetModel:function(){var e=this.data,t=this.skin,a=e.getSelectInfo();if(a&&a.cfg){var i=a.cfg,n=i.UIModel;this.model||(this.model=new game.SurfaceModel,this.model.addToParent(t.modelNode),this.model.initModel());var s=i.uiScale?i.uiScale:1;t.modelNode.setScale(s,s),game.AvatarUtil.updateModel2(n,this.model,game.RoleType.Partner);var r=game.HtmlUtil.getColorStrByQuality(i.quality,i.name);t.bossName.string=game.Lang.get(53355,i.chapter,r)}},updateRank:function(){var e=this.data,t=e.getRankByChapter(e.selectChaptId),a=void 0;if(t?(a=e.getAwardAryByCR(t.userRank),this.setRankInfo(t,1),this.setRankInfo(t,2),this.setRankInfo(t,3)):(a=e.getAwardAryByCR(0),this.setDefineRank()),a){var i=a.getPrizeList(game.IconSizeEnum.GRID_SIZE_105);if(!i||i.length<1)return;this.rankPrizeList.setData(i)}},setDefineRank:function(){for(var e=1;e<4;e++)this.getComponent("hasRank"+e).active=!1,this.getComponent("notHas"+e).active=!0},setRankInfo:function(e,t){var a=e.getInfoByRank(t);if(this.getComponent("hasRank"+t).active=!!a,this.getComponent("notHas"+t).active=!a,a){this.getComponent("name"+t).string=a.name;var i=game.CCommonUtil.replaceNum(a.dmg);this.getComponent("hurt"+t).string=game.Lang.get(53356,i)}},updateHp:function(){var e=this.data,t=this.skin,a=e.getSelectInfo();if(a&&(t.deathNode.active=a.isDeath,t.aliveNode.active=!a.isDeath,!a.isDeath)){var i=this.barLen;t.progress.width=Math.min(e.currHp/e.maxHp*i,i),t.expLab.string=game.CCommonUtil.toFixed(e.currHp/e.maxHp*100,2)+"%"}},updateNum:function(){var e=this.skin,t=this.data;e.lastTimes.string=t.challengeTimes;var a=game.VipCfg.getData(game.mainRoleData.vipLevel);if(a){var i=a.guildInstance-t.buyTimes;e.lastBuyTimes.string=0<i?i:0}},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.skin,t=this.data,a=t.getPerAdd(),i=t.addHurt;if(!i||i.length<1)return e.buffLab.string=game.Lang.get(53353,0),void this.clearTimer();var n=t.getCDtime();if(n<0)return e.buffLab.string=game.Lang.get(53353,0),void this.clearTimer();var s=b8e.TimeUtil.formatTime(n);s=game.Lang.get(53354,s);var r=game.Lang.get(53353,i.length*a);e.buffLab.string=r+s},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.GuildInstance,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1593),this.setSize(547,124)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=5,e.layout.paddingTop=8,e.layout.paddingLeft=0},setData:function(){var e=this.data;if(e&&e.cfg){var t=this.skin,a=e.cfg,i=a.startRank;t.rank_1.active=1==i,t.rank_2.active=2==i,t.rank_3.active=3==i,t.rank.active=3<i,t.rank.string=game.Lang.get(52122,i,a.endRank);var n=e.getPrizeList();this.prizeList.setData(n)}}}),game.MapAchieveRankItem.poolCall=!0,b8e.RC("$$game","$$GuildInstanceAwardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1594)},init:function(){var e=this;e.rankList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.rankList.itemRender=game.GuildInstanceAwardItem,e.rankList.bindEnum=game.ME.GuildInstanceAward,e.rankList.layout.paddingLeft=0,e.rankList.layout.paddingRight=0,e.rankList.layout.paddingTop=0,e.rankList.layout.spacingX=15,e.rankList.layout.spacingY=5,e.rankList.addToParent(e.skin.list)},onShow:function(){this.updateView()},updateView:function(){var e=game.guildInstanceData.getAwardAry();this.rankList.setData(e)}});b8e.module.registerView(game.ME.GuildInstanceAward,e)}(),function(){var e;e=game.Widget.extends({ctor:function(){this._super(1592),this.setSize(547,95)},onShow:function(){this.setData(this._data)},setData:function(e){if(e&&(this._data=e),e&&this.skin){var t=this.skin;t.rank_1.node.active=1==e.rank,t.rank_2.node.active=2==e.rank,t.rank_3.node.active=3==e.rank,t.rank.node.active=3<e.rank,t.rankBg.node.active=3<e.rank,t.name.string=e.name,t.rank.string=e.rank,t.lvLab.string=game.Lang.get(53322,e.level),t.zhanLab.string=game.Lang.get(53323,e.power);var a=game.CCommonUtil.replaceNum(e.dmg);t.score.string=game.Lang.get(53324,a)}}}),b8e.RC("$$game","$$GuildInstanceRankItem",e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1591)},init:function(){this.rankList=[]},notify:function(e){switch(e){case this.Evts.UPDATE_RANK_DATA:this.updataAll()}},onShow:function(){this.updataAll()},updataAll:function(){this.updataRoleAvter(),this.updateView(),this.updatePageNum(),this.updateRankList()},updateRankList:function(){var e=game.guildInstanceData.getRankInfoArrByPageByType(),t=0<(e=e||[]).length;this.skin.showRank.active=t,this.skin.noTip.active=!t;for(var a=void 0,i=void 0,n=0;n<4;n++)a=e[n],(i=this.rankList[n])||((i=new game.GuildInstanceRankItem).setPosition(0,-100*n),i.addToParent(this.skin.list),i.onShow(),this.rankList[n]=i),i.setVisible(!!a),a&&i.setData(a)},updateView:function(){var e=game.guildInstanceData.selectChaptId,t=game.guildInstanceData.getRankByChapter(e);if(t){var a=game.CCommonUtil.replaceNum(t.getSelfRankDamge());t&&(this.skin.mineRank.string=0==t.userRank?game.Lang.get(9069):game.Lang.get(53325,t.userRank,a))}else this.skin.mineRank.string=game.Lang.get(9069)},updatePageNum:function(){var e=game.guildInstanceData.getPageCount(),t=game.guildInstanceData.pageNum;this.skin.page_lab.string=t+" / "+e},updataRoleAvter:function(){var e=this,t=e.roleData,a=game.RoleType,i=game.guildInstanceData.selectChaptId;if(game.guildInstanceData.getRankByChapter(i)){var n=game.guildInstanceData.getRankByChapter(i).getInfoByRank(1);t=t||(e.roleData=game.BaseRoleData.get(a.Hero,1)),e.model&&e.model.release(),e.model=game.sceneRoleCreate.createUIRole(e.roleData),e.model.addToParent(e.skin.model);var s=t.heroModel;if(s)if(s.clear(),n)if(s.setMale(n.isMale),s.setBody(a.Hero,n.isMale?1001:1002),n.info){e.model.active=!0;var r=n.info;if(r)s.setSurface(r.surface,game.RoleType.Hero,!0),game.AvatarUtil.updateUIModel(e.model),e.model.transition(game.RoleStateType.ACTION_IDLE),e.skin.first_name_lab.string=n.name||"";else e.model.clear()}else e.model.active=!1;else e.model.active=!1}}});b8e.module.registerView(game.ME.GuildInstanceRank,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1595),this.setSize(108,122)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.setEffect=this.setEffect,this.icon.addToParent(this.skin.icon)},setData:function(e){this.icon.setData(e),this.updateItem()},updateItem:function(){var e=this.data,t=this.skin;t.headSelect.active=e.select,t.lock.active=!e.isOpen,t.killed.active=e.isDeath,t.mask.active=e.isDeath,game.ShaderUtil.setGray(t.icon,!e.isOpen),t.chapter.string="D"+e.id+"Z"},touchIcon:function(){if(this.data.isOpen){var e=this.data.id;e!=game.guildInstanceData.selectChaptId&&this.send(game.GuildInstanceEvts.V2C_SELECT_ITEM,e)}else game.notice.show(53360)}}),b8e.RC("$$game","$$GuildInstanceHeadItem",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SELECT_TOGGLE:-1,C2V_UPDATE_PAGE:-1,C2V_SCROLL_TOP:-1,C2V_SCROLL_BOTTOM:-1,V2C_BATTLE_RQE:-1,C2V_UPDATE_BATTLE:-1,C2V_UPDATE_VIEW:-1,C2C_UPDATE_HELP_ARMY:b8e.enc()}),b8e.RC("$$game","$$PartnerHelpArmyEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.partnerData;var e=game.spotAlert,t=game.SAE;this.helpArmyAlert=e.set(t.HELP_ARMY,t.PARTNER_HELP_BASE),this.changeAlert=e.set(t.HELP_ARMY_CHANGE,t.HELP_ARMY),this.pageOneAlert=e.set(t.HELP_ARMY_PAGE_ONE,t.HELP_ARMY),this.pageTwoAlert=e.set(t.HELP_ARMY_PAGE_TWO,t.HELP_ARMY)},ipc:function(){this.evts={PartnerChange:{C_UPDATE_BATTLE:this.updateBattle},Partner:{C_SELECTCHANGE:this.updateAlert},PartnerHelp:{C_UPDATE_HELP:this.updateAlert},PartnerUpgrade:{V_UPDATE_LV:this.updateView},PartnerBreak:{V_UPDATE_BREAK:this.updateView},PartnerStar:{V_UPDATE_STAR:this.updateView}},this.handels={PartnerAidResp:this.partnerAidResp}},partnerAidResp:function(e){var t=e.readProtobuf(game.pb.PartnerAidResponse);0<t.code?game.notice.noticeError(t.code):(game.FightAmount.inst().showTeamStatPower(),this.data.updateHelpArmyInfo(t),this.updateAlert(),this.dpt(this.Evts.C2C_UPDATE_HELP_ARMY),this.send(this.Evts.C2V_UPDATE_BATTLE))},notify:function(e,t){switch(e){case this.Evts.V2C_BATTLE_RQE:if(!t||!t.id)return;1==t.type&&this.sender.PartnerAidReq(this.data.selectHelpArmySlot,t.id),2==t.type&&this.sender.PartnerAidReq(this.data.selectHelpArmySlot,0)}},updateView:function(){this.send(this.Evts.C2V_UPDATE_VIEW)},updateAlert:function(){if(game.moduleOpen.checkOpen(game.ME.PartnerHelpArmy)){var e=this.data;this.changeAlert.alert=e.checkHelpArmyChangeAlert(),this.pageOneAlert.alert=e.checkCanAddAlertByPage(1),this.pageTwoAlert.alert=e.checkCanAddAlertByPage(2)}},updateBattle:function(){this.data.updateHelpArmyOpen(),this.updateAlert()},firstPageBtn:function(){this.selectPage(1)},secondPageBtn:function(){this.data.getHelpArmyPage2Open()?this.selectPage(2):game.notice.show(53450)},selectPage:function(e){this.data.helpArmyPage!=e&&(this.data.setHelpArmyPage(e),this.send(this.Evts.C2V_UPDATE_PAGE))},topBtn:function(){this.send(this.Evts.C2V_SCROLL_TOP)},bottomBtn:function(){this.send(this.Evts.C2V_SCROLL_BOTTOM)}}),t=game.Sender.extends({ipc:function(){this.msg={PartnerAidReq:this.partnerAidReq}},partnerAidReq:function(e,t){var a=game.pb.PartnerAidRequest;a.slot=e,a.id=t,this.write(a)}}),a=[game.ME.PartnerHelpArmySelect,game.ME.PartnerHelpArmyChain];b8e.module.registerControl(game.ME.PartnerHelpArmy,e,game.PartnerHelpArmyEvts,t,a)}(),function(){var e=game.Control.extends({init:function(){this.data=game.partnerData},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},selectToggle:function(e){this.send(this.Evts.C2V_SELECT_TOGGLE,e)}});b8e.module.registerControl(game.ME.PartnerHelpBase,e,game.PartnerHelpArmyEvts)}(),function(){var e;e=b8e.Object.extends({id:0,slot:0,info:null,cfg:null,isOpen:!1,page:1,isAlert:!1,setCfg:function(e){e&&(this.cfg=e,this.slot=e.slot,this.page=e.page)},setData:function(e){var t=this;t.info&&t.slot==t.info.helpArmyPos&&(t.info.helpArmyPos=0,t.info.updateHelpArmylStat(),t.info=null),t.id=e.id,t.id&&(t.info=game.partnerData.getInfoById(e.id),t.info.helpArmyPos=t.slot,t.info.updateHelpArmylStat()),t.isOpen=!0},getIsOpen:function(){return this.updateIsOpen(),this.isOpen},updateIsOpen:function(){this.isOpen=this.isOpen||game.partnerData.checkHelpArmySlotOpen(this.slot,this.cfg)}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$PartnerHelpArmyInfo",e)}(),function(){var e;e=game.Widget.extends({ctor:function(){this._super(1611)},onShow:function(){this.updateItem()},setData:function(e){this.data=e},updateItem:function(){var e=this,t=e.data,a=e.skin;if(t&&a){var i=t.cfg,n=t.getIsOpen();if(a.openNode.active=n,a.notOpenNode.active=!n,a.shadle.active=!0,a.grayRed.active=!0,a.grayGold.active=!0,a.grayColor.active=!0,n){var s=0<t.id;if(a.hasNode.active=s,a.notHasNode.active=!s,s&&t.info&&t.info.cfg){var r=t.info,o=r.cfg,g=o.UIModel;e.model||(e.model=new game.SurfaceModel,e.model.addToParent(a.modelNode),e.model.initModel()),a.modelNode.setScale(.7,.7),game.AvatarUtil.updateModel2(g,e.model,game.RoleType.Partner);var u=game.HtmlUtil.getColorStrByQuality(o.quality,o.name),l=game.HtmlUtil.getText(game.Color.GREEN,"+"+r.breakLv);a.nameLab.string=u+l,a.starLab.string=r.star,a.changeRed.active=game.partnerData.checkHelpArmyChange(t.info);var c=game.Quality;a.shadle.active=!1,a.grayRed.active=o.quality<c.Q_RED,a.grayGold.active=o.quality<c.Q_UNPARALLELED,a.grayColor.active=o.quality<c.Q_COLORFUL;var h=game.SpriteStatType,m=t.info.helpArmySpriteStat;m&&(e.setStatStr(a.addProLab1,h.TeamAtk,m),e.setStatStr(a.addProLab2,h.TeamDef,m),e.setStatStr(a.addProLab3,h.TeamHp,m))}}else a.notOpenLab.string=game.Lang.get(53440,i.num,i.qualityDesc)}},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t),n=game.CCommonUtil.replaceNum(a.getStatValue(t));e.string=game.Lang.get(53445,i.name,n)},onClick:function(){var e=this.data;e.getIsOpen()&&e.info&&(game.partnerData.setHelpArmySelectSlot(this.data.slot),game.module.show(game.ME.PartnerHelpArmyChain))},changeBtn:function(){game.partnerData.setHelpArmySelectSlot(this.data.slot),game.module.show(game.ME.PartnerHelpArmySelect)},plusBtn:function(){game.partnerData.setHelpArmySelectSlot(this.data.slot),game.module.show(game.ME.PartnerHelpArmySelect)}}),b8e.RC("$$game","$$PartnerHelpArmyItem",e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1612),this.setSize(540,126)},init:function(){this.icon=new game.CultivateBaseIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin,a=game.SpriteStatType;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),this.setStatStr(t.addProLab1,a.TeamAtk),this.setStatStr(t.addProLab2,a.TeamDef),this.setStatStr(t.addProLab3,a.TeamHp),t.starBtn.active=t.restBtn.active=t.curYJ.active=e.helpArmyPos,t.battleBtn.active=!e.helpArmyPos,this.icon.setData(e)},setStatStr:function(e,t){var a=game.AttrRulesCfg.getData(t),i=this.data.helpArmySpriteStat.getStatValue(t);i=game.CCommonUtil.replaceNum(i),e.string=game.Lang.get(53444,a.name,i)},battleBtn:function(){this.sendEvts(1)},restBtn:function(){this.sendEvts(2)},sendEvts:function(e){this.send(game.PartnerHelpArmyEvts.V2C_BATTLE_RQE,{type:e,id:this.data.id})},starBtn:function(){game.moduleOpen.checkOpenWithTips(game.ME.PartnerUpgrade)&&(game.partnerData.updateSelectInfo(this.data),game.module.showToggle(game.ME.PartnerBackOp,0))}}),b8e.RC("$$game","$$PartnerHelpArmySelectItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1613)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.PartnerHelpArmySelectItem,e.bindEnum=game.ME.PartnerHelpArmy,e.addToParent(this.skin.listNode),e.layout.spacingY=5,e.setScrollViewCb(this.listCb,this),this.data=game.partnerData},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_BATTLE:this.updateView();break;case this.Evts.C2V_SCROLL_TOP:this.scrollTop();break;case this.Evts.C2V_SCROLL_BOTTOM:this.scrollBottom()}},scrollTop:function(){this.list.scrollContainerTop()},scrollBottom:function(){this.list.scrollContainerBottom()},listCb:function(e,t,a){var i=this.skin;i.topBtn.active=0<e.length,i.bottomBtn.active=0<a.length},onShow:function(){this.updateView(),this.list.scrollToTop()},updateView:function(){var e=this.skin,t=this.data.getHelpArmyPartners();this.list.setData(t),e.emptyNode.active=!t||!t.length}});b8e.module.registerView(game.ME.PartnerHelpArmySelect,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1614),this.spotAlerts={HELP_ARMY_PAGE_ONE:this.pageOneAlert,HELP_ARMY_PAGE_TWO:this.pageTwoAlert}},pageOneAlert:function(e){this.skin.alertOne.active=e.alert},pageTwoAlert:function(e){this.skin.alertTwo.active=e.alert},init:function(){this.data=game.partnerData,this.itemList=[]},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_BATTLE:this.updateItems(),this.updateStat();break;case this.Evts.C2V_UPDATE_PAGE:this.updateItems();break;case this.Evts.C2V_UPDATE_VIEW:this.updateItems(),this.updateStat()}},onShow:function(){this.updateItems(),this.updateStat()},updateItems:function(){var e=this.skin,t=this.data;e.firstPageBtn.active=2==t.helpArmyPage,e.secondPageBtn.active=1==t.helpArmyPage;var a=t.getHelpArmyByPage();if(a&&5==a.length)for(var i=this.itemList,n=void 0,s=0;s<5;s++)(n=i[s])||(n=i[s]=new game.PartnerHelpArmyItem).addToParent(this.getComponent("model"+s)),n.setData(a[s]),n.updateItem()},updateStat:function(){var e=this.skin,t=game.SpriteStatType;this.setStatStr(e.addProLab1,t.TeamAtk),this.setStatStr(e.addProLab2,t.TeamDef),this.setStatStr(e.addProLab3,t.TeamHp)},setStatStr:function(e,t){var a=game.AttrRulesCfg.getData(t),i=this.data.getHelpArmyStat(),n=game.CCommonUtil.replaceNum(i.getStatValue(t));e.string=game.Lang.get(53444,a.name,n)},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.PartnerHelpArmy,e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1615),this.toggles={toggle_btn_1:game.ME.PartnerHelp,toggle_btn_2:game.ME.PartnerHelpArmy},this.spotAlerts={PARTNER_HELP:this.helpAlert,HELP_ARMY:this.helpArmyAlert}},helpAlert:function(e){this.skin.red_spot_1.active=e.alert},helpArmyAlert:function(e){this.skin.red_spot_2.active=e.alert},init:function(){this.data=game.partnerData},notify:function(e,t){switch(e){case this.Evts.C2V_SELECT_TOGGLE:this.toggleSelect(t)}},onShow:function(){this.toggleSelect(0),this.skin.btn_2.active=game.moduleOpen.checkOpen(game.ME.PartnerHelpArmy)},toggleSelect:function(e){this._super(e)}});b8e.module.registerView(game.ME.PartnerHelpBase,e)}(),function(){var e=game.CultivateBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1610)},init:function(){this.data=game.partnerData},notify:function(e){},onShow:function(){var e=this.data,t=this.skin,a=e.getSlotInfoByHelpArmy(e.selectHelpArmySlot);if(a&&a.info&&a.info.cfg){var i=a.info.cfg,n=e.getHelpArmyChainPageCfgs(a.cfg.page);if(n&&!(n.length<1)){var s=game.Quality;t.gray1.active=i.quality<s.Q_RED,t.gray2.active=i.quality<s.Q_UNPARALLELED,t.gray3.active=i.quality<s.Q_COLORFUL;for(var r=0;r<n.length;r++)this.setStat(n[r],r+1)}}},setStat:function(e,t){this.getComponent("atkValue"+t).string=game.HtmlUtil.getText(game.Color.GREEN,"+"+e.teamAtkClient),this.getComponent("defValue"+t).string=game.HtmlUtil.getText(game.Color.GREEN,"+"+e.teamDefClient),this.getComponent("hpValue"+t).string=game.HtmlUtil.getText(game.Color.GREEN,"+"+e.teamHpClient)}});b8e.module.registerView(game.ME.PartnerHelpArmyChain,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_SELECT_CHANGE:-1,C2V_AWARD_UPDATE_VIEW:-1,C2C_AWARD_CHECK:-1,C2V_GIFTS_UPDATE_VIEW:-1,C2C_GIFTS_BUY:-1,C2C_RECHARGE:-1,C2V_TASKS_UPDATE_VIEW:-1,C2C_TASKS_AWARD:-1}),b8e.RC("$$game","$$DailyWishEvts",e)}(),function(){var e=b8e.Object.extends({isGetDailyAward:null,fixedAward:null,checkNum:0,checkedIdList:null,selGift:null,isInit:!1,ctor:function(){this.wishAwardMaps=b8e.HashMap.get(),this.wishTaskMaps=b8e.HashMap.get(),this.wishGiftMaps=b8e.HashMap.get(),this.checkedIdList=[]},recycleMaps:function(e){if(e){for(var t=e.values(),a=0,i=t.length;a<i;a++)t[a].release();e.clear()}},initCfg:function(){var e,t,a,i,n=this;if(e=game.DailyWishCfg.getDatas(),n.recycleMaps(n.wishAwardMaps),e){t=e.length;for(var s=0;s<t;s++)a=e[s],(i=game.DailyWishAwardInfo.get()).setCfg(a),n.wishAwardMaps.set(a.id,i)}if(e=game.WishTaskCfg.getDatas(),n.recycleMaps(n.wishTaskMaps),e){t=e.length;for(var r=0;r<t;r++)a=e[r],(i=game.DailyWishTaskInfo.get()).setCfg(a),n.wishTaskMaps.set(a.taskType,i)}if(e=game.WishGiftBagCfg.getDatas(),n.recycleMaps(n.wishGiftMaps),e){t=e.length;for(var o=0;o<t;o++)a=e[o],(i=game.DailyWishGiftsInfo.get()).setCfg(a),n.wishGiftMaps.set(a.rechargeId,i)}(a=game.WishMiscCfg.getData("dailyWishFixedAward"))&&(n.fixedAward=a.value),(a=game.WishMiscCfg.getData("awardCheckNum"))&&(n.checkNum=a.value)},initData:function(e){var t,a,i=this;i.isInit||(i.initCfg(),i.isGetDailyAward=!!e.dailyWishAward,e.wishTask.forEach(function(e){(t=i.wishTaskMaps.get(e.taskType))&&t.setData(e)},i),e.wishGiftBag.forEach(function(e){(a=i.wishGiftMaps.get(e.rechargeId))&&a.setData(e)},i),i.isInit=!0)},dailyUpdate:function(){var e=b8e.TimeUtil.getDay(game.SysTime.curTime);this.isGetDailyAward=!1;for(var t=this.wishTaskMaps.values(),a=void 0,i=t.length,n=0;n<i;n++)1==(a=t[n]).wishType?(a.progress=0,a.isGet=!1):2==a.wishType&&1==e&&(a.progress=0,a.isGet=!1);i=(t=this.wishGiftMaps.values()).length;for(var s=0;s<i;s++)1==(a=t[s]).wishType?a.buyNum=0:2==a.wishType&&1==e&&(a.buyNum=0)},getAwardList:function(){var e=this.wishAwardMaps.values();return e.sort(this.sortById),e},sortById:function(e,t){return e.id-t.id},getCurCheckNum:function(){this.checkedIdList.length=0;for(var e=this.getAwardList(),t=0,a=e.length;t<a;t++){var i=e[t];i.isCheck&&this.checkedIdList.push(i.id)}return this.checkedIdList.length},getGiftsList:function(){var e=this.wishGiftMaps.values();return e.sort(this.giftSort),e},giftSort:function(e,t){return e.buyNum<e.limit&&t.buyNum>=t.limit?-1:e.buyNum>=e.limit&&t.buyNum<t.limit?1:e.wishType<t.wishType?-1:e.wishType>t.wishType?1:e.rechargeId-t.rechargeId},updataGiftData:function(e){var t=this.wishGiftMaps.get(e);t&&t.buyNum++},getTasksList:function(){var e=this.wishTaskMaps.values();return e.sort(this.taskSort),e},taskSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:e.wishType<t.wishType?-1:e.wishType>t.wishType?1:e.taskType-t.taskType},updateTaskPro:function(e){if(e){var t=this.wishTaskMaps.get(e.taskType);t&&(t.progress=e.progress)}},taskAwardGet:function(e){if(e){var t=this.wishTaskMaps.get(e);t&&(t.isGet=!0,game.awardsData.setItemsByArray(t.items),game.module.show(game.ME.AwardShowTip))}},tasksTabAlert:function(){for(var e=this.wishTaskMaps.values(),t=e.length,a=void 0,i=0;i<t;i++)if(!(a=e[i]).isGet&&a.progress>=a.needPro)return!0;return!1}});game.dailyWishData=game.dailyWishData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,items:null,isCheck:!1,itemInfo:null,setCfg:function(e){this.id=e.id,this.items=e.items},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.items=null,this.isCheck=!1,this.itemInfo&&this.itemInfo.release(),this.itemInfo=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$DailyWishAwardInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({wishType:0,rechargeId:0,buyNum:0,limit:0,items:null,setCfg:function(e){this.rechargeId=e.rechargeId,this.wishType=e.wishType,this.limit=e.limit,this.items=e.items},setData:function(e){this.buyNum=e.buyNum},recycle:function(){this.reset(),this._super()},reset:function(){this.wishType=0,this.rechargeId=0,this.buyNum=0,this.limit=0,this.items=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$DailyWishGiftsInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({wishType:0,taskType:0,needPro:0,items:null,progress:0,isGet:!1,titleKey:0,moduleId:0,toggle:0,openDay:null,openTime:null,openDesc:null,setCfg:function(e){this.wishType=e.wishType,this.taskType=e.taskType,this.needPro=e.progress,this.items=e.items,this.titleKey=e.titleKey,this.moduleId=e.moduleId,this.toggle=e.toggle,this.setOpenTime(e)},setData:function(e){this.progress=e.progress,this.isGet=e.isGet},recycle:function(){this.reset(),this._super()},setOpenTime:function(e){this.openDay=e.openDay||[],this.openTime=e.openTime||[],this.openDesc=e.timeText||""},checkOpen:function(){if(this.openDay.length<1){if(this.openTime.length<1)return!0;if(game.TimeUtil.isOpen(this.openTime,"hhmm"))return!0}else{var e=b8e.TimeUtil.getDay(game.SysTime.curTime);if(-1!=this.openDay.indexOf(e)&&game.TimeUtil.isOpen(this.openTime,"hhmm"))return!0}return!1},reset:function(){var e=this;e.wishType=0,e.taskType=0,e.needPro=0,e.items=null,e.progress=0,e.isGet=!1,e.titleKey=0,e.moduleId=0,e.toggle=0,e.openDay=null,e.openTime=null,e.openDesc=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$DailyWishTaskInfo",t)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.dailyWishData,this.awardTabAlert=game.spotAlert.set(game.SAE.DAILYWISH_AWARD,game.SAE.DAILYWISH),this.tasksTabAlert=game.spotAlert.set(game.SAE.DAILYWISH_TASKS,game.SAE.DAILYWISH)},ipc:function(){this.evts={DailyFuLi:{C_INIT_MODULE:this.initModule},Recharge:{C_RECHARGE_SUCCESS:this.rechargeSuccess},MainRole:{C_RESET_DAILY:this.resetDaily}},this.handels={DailyWishAwardResp:this.dailyWishAwardResp,WishTaskAwardResp:this.wishTaskAwardResp,WishTaskMsg:this.wishTaskMsg}},initModule:function(e){e&&e.data&&(this.moduleData.initData(e.data),this.checkAllAlert())},dailyWishAwardResp:function(e){var t=e.readProtobuf(game.pb.DailyWishAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.isGetDailyAward=!0,this.checkAwardTabAlert(),this.send(this.Evts.C2V_AWARD_UPDATE_VIEW))},wishTaskAwardResp:function(e){var t=e.readProtobuf(game.pb.WishTaskAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.taskAwardGet(t.taskType),this.checkTasksTabAlert(),this.send(this.Evts.C2V_TASKS_UPDATE_VIEW))},wishTaskMsg:function(e){var t=e.readProtobuf(game.pb.WishTaskNotify);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updateTaskPro(t.wishTask),this.checkTasksTabAlert(),this.send(this.Evts.C2V_TASKS_UPDATE_VIEW))},rechargeSuccess:function(e){if(e&&e.data&&this.moduleData.selGift){var t=e.data.id;t==this.moduleData.selGift.rechargeId&&(this.moduleData.updataGiftData(t),this.send(this.Evts.C2V_GIFTS_UPDATE_VIEW))}},resetDaily:function(){this.moduleData.dailyUpdate(),this.send(this.Evts.C2V_AWARD_UPDATE_VIEW),this.send(this.Evts.C2V_GIFTS_UPDATE_VIEW),this.send(this.Evts.C2V_TASKS_UPDATE_VIEW),this.checkAllAlert()},getBtn:function(){this.moduleData.isGetDailyAward||(this.moduleData.getCurCheckNum()<this.moduleData.checkNum?game.notice.show(53370):this.sender.DailyWishAwardReq(this.moduleData.checkedIdList))},btn_1:function(){this.selectToggle(0)},btn_2:function(){this.selectToggle(1)},btn_3:function(){this.selectToggle(2)},btn_4:function(){this.selectToggle(3)},selectToggle:function(e){this.send(this.Evts.C2V_SELECT_CHANGE,e)},notify:function(e,t){var a=this;switch(e){case a.Evts.C2C_AWARD_CHECK:a.send(a.Evts.C2V_AWARD_UPDATE_VIEW);break;case a.Evts.C2C_GIFTS_BUY:a.moduleData.selGift=t,a.dpt(a.Evts.C2C_RECHARGE,a.moduleData.selGift.rechargeId);break;case a.Evts.C2C_TASKS_AWARD:a.sender.WishTaskAwardReq(t.wishType,t.taskType)}},checkAllAlert:function(){this.checkAwardTabAlert(),this.checkTasksTabAlert()},checkAwardTabAlert:function(){this.awardTabAlert.alert=!this.moduleData.isGetDailyAward},checkTasksTabAlert:function(){this.tasksTabAlert.alert=this.moduleData.tasksTabAlert()}}),t=[game.ME.DailyWishAward,game.ME.DailyWishTasks,game.ME.DailyWishGifts],a=game.Sender.extends({ipc:function(){this.msg={DailyWishAwardReq:this.dailyWishAwardReq,WishTaskAwardReq:this.wishTaskAwardReq}},dailyWishAwardReq:function(e){var t=game.pb.DailyWishAwardRequest;t.id=e,this.write(t)},wishTaskAwardReq:function(e,t){var a=game.pb.WishTaskAwardRequest;a.wishType=e,a.taskType=t,this.write(a)}});b8e.module.registerControl(game.ME.DailyWish,e,game.DailyWishEvts,a,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1609),this.toggles={toggle_btn_1:game.ME.DailyWishAward,toggle_btn_2:game.ME.DailyWishTasks,toggle_btn_3:game.ME.DailyWishGifts,toggle_btn_4:game.ME.DailyWishShop},this.spotAlerts={DAILYWISH_AWARD:this.awardTabAlert,DAILYWISH_TASKS:this.tasksTabAlert}},awardTabAlert:function(e){this.skin.red_spot_1.node.active=e.alert},tasksTabAlert:function(e){this.skin.red_spot_2.node.active=e.alert},onShow:function(){this.toggleSelect(0)},notify:function(e,t){switch(e){case this.Evts.C2V_SELECT_CHANGE:this.toggleSelect(t)}}});b8e.module.registerView(game.ME.DailyWish,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1604)},init:function(){var e=this;e.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.awardList.itemRender=game.DailyWishAwardItem,e.awardList.layout.paddingTop=0,e.awardList.bindEnum=game.ME.DailyWish,e.awardList.addToParent(e.skin.list),e.fixedIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),e.fixedIcon.addToParent(e.skin.fixedIcon);var t=game.dailyWishData.fixedAward;if(t){var a=t.split(",");if(1<a.length){var i=+a[0],n=game.ItemUtil.createBaseItemInfo(i,+a[1]);game.GridUtil.setItemIcon(e.fixedIcon,n,!1,game.IconLayoutEnum.SHOW_NUM);var s=game.ItemInfoCfg.getData(i);e.skin.fixedName.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name)}}},onShow:function(){this.updateList(),this.updateView()},updateList:function(){var e=game.dailyWishData.getAwardList();this.awardList.setData(e)},updateView:function(){var e=this.skin;if(game.dailyWishData.isGetDailyAward)e.lab_status.active=!0,e.getNode.active=!1;else{e.lab_status.active=!1,e.getNode.active=!0;var t=game.dailyWishData.getCurCheckNum(),a=game.dailyWishData.checkNum,i=game.HtmlUtil.getText(a<=t?game.Color.BLACK:game.Color.RED,t);e.descLab.string=game.Lang.get(53368,i,a)}},notify:function(e){switch(e){case this.Evts.C2V_AWARD_UPDATE_VIEW:this.updateView()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.DailyWishAward,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1603),this.setSize(602,100)},init:function(){this.itemIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this.itemIcon.addToParent(this.skin.itemIcon)},setData:function(e){var t=this;if(t.data=e,t.data.items&&!(t.data.items.length<1)){var a=t.data.items[0].Id,i=t.data.items[0].Num;t.data.itemInfo||(t.data.itemInfo=game.ItemUtil.createBaseItemInfo(a,i)),game.GridUtil.setItemIcon(t.itemIcon,t.data.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM);var n=game.ItemInfoCfg.getData(a);t.skin.itemName.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name),t.skin.title_bg19.width=t.skin.itemName.width+50,t.skin.check.active=t.data.isCheck}},checkBtn:function(){if(!game.dailyWishData.isGetDailyAward){if(!this.data.isCheck){var e=game.dailyWishData.getCurCheckNum();if(game.dailyWishData.checkNum<=e)return void game.notice.show(53369)}this.data.isCheck=!this.data.isCheck,this.skin.check.active=this.data.isCheck,this.send(game.DailyWishEvts.C2C_AWARD_CHECK)}}}),b8e.RC("$$game","$$DailyWishAwardItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1608)},init:function(){this.tasksList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.tasksList.itemRender=game.DailyWishTasksItem,this.tasksList.layout.paddingTop=0,this.tasksList.bindEnum=game.ME.DailyWish,this.tasksList.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.dailyWishData.getTasksList();this.tasksList.setData(e)},notify:function(e){switch(e){case this.Evts.C2V_TASKS_UPDATE_VIEW:this.updateList()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.DailyWishTasks,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1607),this.setSize(602,202)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.PrizeListItem,this.awardList.layout.spacingX=0,this.awardList.layout.paddingLeft=0,this.awardList.addToParent(this.skin.list)},setData:function(e){var t=this;t.data=e;var a=t.skin;a.bgImg.loadTexture(game.ResCfg.getUrl(10203,"type"+t.data.taskType)),t.data.items&&(t.data.prizeInfo||(t.data.prizeInfo=game.CfgUtil.getPrizeListInfo(t.data.items,null,game.IconSizeEnum.GRID_SIZE_84)),t.awardList.setData(t.data.prizeInfo.items));var i=t.data.progress>=t.data.needPro;a.titleLab.string=game.Lang.get(t.data.titleKey,t.data.needPro,game.HtmlUtil.getText(i?game.Color.GREEN:game.Color.RED,t.data.progress),t.data.needPro),a.lab_daily_open.active=1==t.data.wishType,a.lab_weekly_open.active=2==t.data.wishType;var n=t.data.checkOpen(),s="";a.lab_doing.active=n,t.data.isGet?(a.grayBtn.active=!0,a.goBtn.active=!1,a.getBtn.active=!1):(a.grayBtn.active=!1,a.goBtn.active=n&&!i,a.getBtn.active=i,n||i||(s=t.data.openDesc)),a.openLab.string=s},getBtn:function(){this.send(game.DailyWishEvts.C2C_TASKS_AWARD,this.data)},goBtn:function(){var e=this.data.moduleId;!e||e<1||(e!=game.ME.Guild||game.guildData.hasGuild()?0<this.data.toggle?game.module.showToggle(e,this.data.toggle):game.module.show(e):game.notice.show(9037))}}),b8e.RC("$$game","$$DailyWishTasksItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1606)},init:function(){this.giftsList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.giftsList.itemRender=game.DailyWishGiftsItem,this.giftsList.layout.paddingTop=0,this.giftsList.bindEnum=game.ME.DailyWish,this.giftsList.addToParent(this.skin.list)},onShow:function(){this.updateList()},updateList:function(){var e=game.dailyWishData.getGiftsList();this.giftsList.setData(e)},notify:function(e){switch(e){case this.Evts.C2V_GIFTS_UPDATE_VIEW:this.updateList()}},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.DailyWishGifts,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1605),this.setSize(602,160)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.PrizeListItem,this.awardList.layout.spacingX=20,this.awardList.addToParent(this.skin.list)},setData:function(e){var t=this;t.data=e;var a=t.skin;t.data.items&&(t.data.prizeInfo||(t.data.prizeInfo=game.CfgUtil.getPrizeListInfo(t.data.items,null,game.IconSizeEnum.GRID_SIZE_105)),t.awardList.setData(t.data.prizeInfo.items)),a.dailyImg.active=1==t.data.wishType,a.weeklyImg.active=2==t.data.wishType;var i=t.data.buyNum>=t.data.limit;a.buyBtn.active=!i,a.grayBtn.active=i,a.buyNum.string=game.Lang.get(1==t.data.wishType?53377:53376,game.HtmlUtil.getText(i?game.Color.BLACK:game.Color.GREEN,t.data.buyNum),t.data.limit);var n=game.RechargeCfg.getDataById(t.data.rechargeId);a.lab_buy.string=game.Lang.get(1701,n.money),a.addLab.string=game.Lang.get(53378,n.addVipExp)},buyBtn:function(){this.send(game.DailyWishEvts.C2C_GIFTS_BUY,this.data)}}),b8e.RC("$$game","$$DailyWishGiftsItem",e)}(),function(){var e=game.CommonShopView.extends({ctor:function(){this._super(999)},setTitleImg:function(){var e=game.ResCfg.getUrl(10203,"shop_title");this.skin.title.loadTexture(e)}});b8e.module.registerView(game.ME.DailyWishShop,e)}(),function(){var e;e=b8e.Object.extends({id:0,selectId:0,setData:function(e,t){this.id=e,this.selectId=t}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$RecuritSelectInfo",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1404)},init:function(){var e=this.gridList=new game.List;e.itemRender=game.RecruitSelectItme,e.addToParent(this.skin.list),e.bindEnum=game.ME.Recruit,e.layout.paddingLeft=0,e.layout.spacingX=0,e.layout.spacingY=5},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_LIST:this.updateList()}},onShow:function(){this.updateList(),this.skin.mapBtn.active=!1},updateList:function(){var e=game.recruitData.activityId,t=game.recruitData.getLockId(e);t&&(this.lockList=game.recruitData.getFixSelectList(t),this.gridList.setData(this.lockList))},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.RecruitSelect,e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1403),this.toggles={toggle_btn_1:game.ME.RecruitSelect},this.spotAlerts={RECRUIT_SELECT:this.spotAlert}},onShow:function(){this.skin.btn_label_1.string=game.Lang.get(53371)},notify:function(e,t){switch(e){case this.Evts.C2V_SWITCH_PAGE:this.toggleSelect(t)}},spotAlert:function(e){this.skin.red_spot_1.active=e.alert}});b8e.module.registerView(game.ME.RecruitSelectMain,e)}();(function(){var e;(e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1601),this.setSize(620,237)},setData:function(){var e=this.data;if(e){var t=this.skin;game.recruitData.getInfoById(e.id)&&t.bg.loadTexture(game.ResCfg.getUrl(10202,e.selectId))}},clickBtn:function(){this.send(game.RecruitEvts.V2C_SELECT_AS_ID,this.data.id,this.data.selectId)}})).poolCall=!0,b8e.RC("$$game","$$RecruitSelectItme",e)})(),function(){var e=game.View.extends({ctor:function(){this._super(1602)},init:function(){this.skin.view_tipsBtn.isButton=!1},onShow:function(){var e=this.cfg=game.LoadActiveShowCfg.getData(game.loadActiveShowData.todayAlertId);e&&(this.isSelect=!0,this.skin.msgLbl.string=game.Lang.get(e.tipsLang),this.skin.tipsSelect.active=this.isSelect)},view_gotoBtn:function(){this.cfg&&this.cfg.moduleEnum&&(game.module.show(this.cfg.moduleEnum),this.checkBanId()),this.hideView()},view_cancelBtn:function(){this.checkBanId(),this.hideView()},checkBanId:function(){this.isSelect&&this.send(this.Evts.V2C_BAN_TODAY_ID,game.loadActiveShowData.todayAlertId)},view_tipsBtn:function(){this.isSelect=!this.isSelect,this.skin.tipsSelect.active=this.isSelect}});b8e.module.registerView(game.ME.TodayAlert,e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({init:function(){this._super()},_addEvents:function(){var e=this;e._super(),e.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,e.updateItemInfo),e.addListenerPb(game.protoId.WearFosterEquipResp,e.wearFosterEquipResp),e.addListenerPb(game.protoId.FosterCastEquipResp,e.fosterCastEquipResp),e.addListenerPb(game.protoId.FosterEquipQhResp,e.fosterEquipQhResp),e.addListenerPb(game.protoId.FosterEquipStarResp,e.fosterEquipStarResp),e.addListenerPb(game.protoId.FosterEquipWashLockResp,e.fosterEquipWashLockResp),e.addListenerPb(game.protoId.FosterEquipWashResp,e.fosterEquipWashResp)},triggerOpen:function(e){e==game.ME.FosterEquip&&this.send(game.FosterEquipEvts.FOSTER_UPDATE_EQUIP_ALERT)},updateItemInfo:function(){this.send(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON)},changeLock:function(e,t,a,i,n){this.slotTimeArr||(this.slotTimeArr=[]);var s=this.slotTimeArr[i];s&&this.lockSpaceTime+500>game.SysTime.curTime||(!n||game.fosterEquipData.checkRefineIsAllLock(e,t,a)?(s=this.slotTimeArr[i]=game.SysTime.curTime,this.fosterEquipWashLockReq(e,t,a,i)):game.notice.show(53515))},quickWear:function(e,t){var a=game.fosterEquipData.getQuickEquipIdxArr(e,t);!a||a.length<1||this.wearFosterEquipReq(e,t,a)},showEquipView:function(e,t){game.fosterEquipData.curFosterType=e,game.fosterEquipData.curFosterId=t,this.checkHideAndShow(game.ME.FosterEquip)},quickWearInInfoPage:function(){this.quickWear(game.fosterEquipData.curFosterType,game.fosterEquipData.curFosterId)},showEquip:function(e,t,a){game.fosterEquipData.showFoserId=e,game.fosterEquipData.showFosterType=t,game.fosterEquipData.showEquipInfo=a,game.fosterEquipData.isBack=!1,this.checkHideAndShow(game.ME.FosterEquipDetail)},showEquipNotChange:function(e){game.fosterEquipData.showEquipInfo=e,game.fosterEquipData.isBack=!0,this.checkHideAndShow(game.ME.FosterEquipDetail)},showEquipTips:function(e){var t=this.fosterEquipTipsInfo;(t=t||(this.fosterEquipTipsInfo=game.FosterEquipInfo.get())).setData(e),game.fosterEquipData.showEquipInfo=t,game.fosterEquipData.isBack=!0,this.checkHideAndShow(game.ME.FosterEquipDetail)},checkHideAndShow:function(e){b8e.app.isShowView(e)&&game.module.hide(e),game.module.show(e)},checkHideView:function(e){b8e.app.isShowView(e)&&game.module.hide(e)},selectEquipSlotId:function(e){game.fosterEquipData.selectEquipSlotId(e),this.send(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID)},changeFosterEquip:function(e){game.fosterEquipData.changeFosterId=game.fosterEquipData.showFoserId,game.fosterEquipData.changeFosterType=game.fosterEquipData.showFosterType,game.fosterEquipData.changeSlot=e,game.module.show(game.ME.FosterEquipWear)},removeEquip:function(e){this.fosterCastEquipReq(game.fosterEquipData.showFosterType,game.fosterEquipData.showFoserId,e)},wearEquip:function(e){this.wearFosterEquipReq(game.fosterEquipData.changeFosterType,game.fosterEquipData.changeFosterId,e)},intenifyEquip:function(){var e=game.fosterEquipData,t=e.curFosterType,a=e.curFosterId,i=e.isIntensifyAll,n=e.getIntenifyArr(t,a,i,!0);if(n&&!(n.length<1)){this.fosterEquipQhReq(t,a,n)}},upstarEquip:function(){var e=game.fosterEquipData,t=e.curFosterId,a=e.curFosterType,i=e.getCurSelectSlotInfo();if(i&&i.getFosterEquipInfo()){var n=i.getFosterEquipInfo();if(e.checkUpstarEnough(n,!0)){var s=e.getUpstarCfg(n.id,n.star);if(s&&!s.isMax){var r=e.getInitialEquipList(n.id,s.num);!r||r.length<1||this.fosterEquipStarReq(a,t,i.slot,r)}}}},kindRefine:function(){var e=game.fosterEquipData,t=e.curFosterId,a=e.curFosterType,i=e.getCurSelectSlotInfo();if(i){var n=i.getFosterEquipInfo();if(n){var s=n.getRefineInfoLockCostCfg();if((!(s&&s.costItems&&0<s.costItems.length)||game.UpgradeUtil.checkItemList(s.costItems))&&e.checKindRefinekEnough(!0)){this.fosterEquipWashReq(a,1,t,i.slot)}}}},attrRefine:function(){var e=game.fosterEquipData,t=e.curFosterId,a=e.curFosterType,i=e.getCurSelectSlotInfo();if(i){var n=i.getFosterEquipInfo();if(n){if(e.checAttrRefinekEnough(n,!0)){this.fosterEquipWashReq(a,2,t,i.slot)}}else game.notice.show(53518)}},wearFosterEquipResp:function(e){var t=e.readProtobuf(game.pb.WearFosterEquipResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.equips,n=t.fosterType;game.fosterEquipData.wearEquip(a,i,n),this.dptUpdateEvts(),this.dptPlayAnima(i),this.checkHideView(game.ME.FosterEquipWear),this.checkHideView(game.ME.FosterEquipDetail),game.FightAmount.inst().showTeamStatPower()}},fosterCastEquipResp:function(e){var t=e.readProtobuf(game.pb.FosterCastEquipResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.slot,n=t.fosterType;game.fosterEquipData.castEquip(a,i,n),this.dptUpdateEvts(),this.checkHideView(game.ME.FosterEquipDetail)}},fosterEquipQhResp:function(e){var t=e.readProtobuf(game.pb.FosterEquipQhResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.equips,n=t.fosterType;game.fosterEquipData.foterEquipQh(a,i,n),this.dptUpdateEvts(),this.dptPlayAnima2(i),game.FightAmount.inst().showTeamStatPower()}},fosterEquipStarResp:function(e){var t=e.readProtobuf(game.pb.FosterEquipStarResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.slot,n=t.equip,s=t.fosterType;game.fosterEquipData.foterEquipUpstar(a,i,n,s),this.dptUpdateEvts();var r=game.ItemInfoCfg.getData(n.id);r&&(this.send(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,[r.pos-1]),game.FightAmount.inst().showTeamStatPower())}},fosterEquipWashLockResp:function(e){var t=e.readProtobuf(game.pb.FosterEquipWashLockResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.slot,n=t.attrs,s=t.fosterType;game.fosterEquipData.foterEquipWashLock(a,i,n,s),this.send(game.FosterEquipEvts.FOSTER_EQUIP_REFINE_LOCK_CHANGE),game.FightAmount.inst().showTeamStatPower()}},fosterEquipWashResp:function(e){var t=e.readProtobuf(game.pb.FosterEquipWashResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.slot,n=t.attrs,s=t.washType,r=t.fosterType;game.fosterEquipData.foterEquipWash(a,i,n,r,s),this.send(game.FosterEquipEvts.FOSTER_EQUIP_REFINE_LOCK_CHANGE),game.FightAmount.inst().showTeamStatPower(),this.dptUpdateEvts()}},dptUpdateEvts:function(){this.send(game.FosterEquipEvts.FOSTER_EQUIP_WEAR_COMPLETE),this.send(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO),this.send(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_POWER),this.send(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON)},getTempList:function(){return this.tempList||(this.tempList=[]),this.tempList.length=0,this.tempList},dptPlayAnima:function(e){if(e&&!(e.length<1)){for(var t=this.getTempList(),a=void 0,i=void 0,n=e.length,s=0;s<n;s++)a=e[s],(i=game.ItemInfoCfg.getData(a.id))&&t.push(i.pos-1);this.send(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,t)}},dptPlayAnima2:function(e){if(e&&!(e.length<1)){for(var t=void 0,a=this.getTempList(),i=e.length,n=0;n<i;n++)t=e[n],a.push(t.slot-1);this.send(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,a)}},getFosterTypeToEquipType:function(e){return game.fosterEquipData.getFosterTypeToEquipType(e)},fosterEquipWashReq:function(e,t,a,i){var n=game.pb.FosterEquipWashRequest;n.fosterType=e,n.washType=t,n.id=a,n.slot=i,this.sendPb(game.protoId.FosterEquipWashReq,n)},fosterEquipWashLockReq:function(e,t,a,i){var n=game.pb.FosterEquipWashLockRequest;n.fosterType=e,n.id=t,n.slot=a,n.attrSlot=i,this.sendPb(game.protoId.FosterEquipWashLockReq,n)},fosterEquipStarReq:function(e,t,a,i){var n=game.pb.FosterEquipStarRequest;n.fosterType=e,n.id=t,n.slot=a,n.idx=i,this.sendPb(game.protoId.FosterEquipStarReq,n)},fosterEquipQhReq:function(e,t,a){var i=game.pb.FosterEquipQhRequest;i.fosterType=e,i.id=t,i.equips=a,this.sendPb(game.protoId.FosterEquipQhReq,i)},fosterCastEquipReq:function(e,t,a){var i=game.pb.FosterCastEquipRequest;i.fosterType=e,i.id=t,i.slot=a,this.sendPb(game.protoId.FosterCastEquipReq,i)},wearFosterEquipReq:function(e,t,a){var i=game.pb.WearFosterEquipRequest;i.fosterType=e,i.id=t,i.idx=a,this.sendPb(game.protoId.WearFosterEquipReq,i)}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$FosterEquipMgr",e)}(),function(){var e=b8e.Object.extends({curFosterType:0,curFosterId:0,isIntensifyAll:!1,maxSlotNum:{get:function(){return this._maxSlotNum||(this._maxSlotNum=+game.CfgUtil.getMiscValue(game.FosterEquipMiscCfg,"maxSlotNum")),this._maxSlotNum}},maxLvCoef:{get:function(){return this._maxLvCoef||(this._maxLvCoef=+game.CfgUtil.getMiscValue(game.FosterEquipMiscCfg,"maxLvCoef")),this._maxLvCoef}},tempSpriteStat:{get:function(){return this._tempSpriteStat||(this._tempSpriteStat=game.SpriteStat.get()),this._tempSpriteStat}},ctor:function(){this._super(),this.fosterEquipTypeMap=b8e.HashMap.get(),this.fosterEquipMap=b8e.HashMap.get()},setWashCostInfo:function(){var e=void 0;this.washValueId||(e=game.CfgUtil.getMiscValue(game.FosterEquipMiscCfg,"FosterEquipWashValueCost",!0,",",!0))&&1<e.length&&(this.washValueId=e[0],this.washValueNum=e[1]),this.washTypeId||(e=game.CfgUtil.getMiscValue(game.FosterEquipMiscCfg,"FosterEquipWashTypeCost",!0,",",!0))&&1<e.length&&(this.washTypeId=e[0],this.washTypeNum=e[1])},createEquipInfo:function(e,t){if(!e||!t)return null;var a=this.getFosterTypeToEquipType(e.types),i=this.fosterEquipTypeMap.get(a);i||(i=b8e.HashMap.get(),this.fosterEquipTypeMap.set(a,i));var n=i.get(e.pos);n||(n=[],i.set(e.pos,n));var s=game.FosterEquipInfo.get();return s.setData(t),n.push(s),this.fosterEquipMap.set(s.idx,s),s},delEquipByIdx:function(e){var t=this.fosterEquipMap.get(e);if(t){var a=this.fosterEquipTypeMap.get(t.fosterType);if(a){var i=a.get(t.pos);if(i&&!(i.length<1)){var n=i.indexOf(t);n<0||(i.splice(n,1),this.fosterEquipMap.del(e),t.release())}}}},showViewDefaultSelect:function(){var e=this.getCurFosterInfo();e&&e.defaultSelect()},selectEquipSlotId:function(e){var t=this.getCurFosterInfo();t&&t.setSelectEquip(e)},wearEquip:function(e,t,a){var i=game.fosterData.getFosterInfo(a,e);i&&i.wearEquip(e,t,a)},castEquip:function(e,t,a){var i=game.fosterData.getFosterInfo(a,e);i&&i.castEquip(t)},foterEquipQh:function(e,t,a){var i=game.fosterData.getFosterInfo(a,e);i&&i.foterEquipQh(t)},foterEquipUpstar:function(e,t,a,i){var n=game.fosterData.getFosterInfo(i,e);n&&n.foterEquipUpstar(t,a)},foterEquipWashLock:function(e,t,a,i){var n=game.fosterData.getFosterInfo(i,e);n&&n.foterEquipWashLock(t,a)},foterEquipWash:function(e,t,a,i,n){var s=game.fosterData.getFosterInfo(i,e);s&&s.foterEquipWash(t,a,n)},getCurFosterEquipPower:function(){var e=this.getCurEquipAllSpriteStat();return e?e.getTeamPower():0},getEquipList:function(e,t){var a=this.fosterEquipTypeMap.get(e);return a?a.get(t):null},getBestEquipByBag:function(e,t){var a=this.getEquipList(e,t);if(!a||a.length<1)return null;for(var i=void 0,n=null,s=a.length,r=0;r<s;r++)i=a[r],!n||i.sortId>n.sortId?n=i:i.sortId==n.sortId&&i.totalFight>n.totalFight&&(n=i);return n},getShowEquipInfo:function(){return this.showEquipInfo},getCurEquipAllSpriteStat:function(){var a=this,e=game.fosterData.getFosterInfo(a.curFosterType,a.curFosterId);if(!e)return null;a.tempSpriteStat.clear();var t=e.getFosterEquipMap();if(!t)return null;var i=void 0;return t.forEach(function(e,t){(i=t.getFosterEquipInfo())&&a.tempSpriteStat.addSpriteStat(i.allSpriteStat)},a),a.tempSpriteStat},getCurSelectSlotInfo:function(){var e=this.getCurFosterInfo();return e?e.getSelectInfo():null},getCurFosterInfo:function(){return game.fosterData.getFosterInfo(this.curFosterType,this.curFosterId)},getRebirthCosts:function(e){if(this.rebirthCostList||(this.rebirthCostList=[]),this.clearList(this.rebirthCostList),e){var t=void 0,a=void 0,i=void 0,n=this.getIntensifyCostCfg(e.fosterType,e.lv);if(n){var s=n.totalCostItems;for(a=s.length,t=0;t<a;t++)i=game.ItemUtil.createBaseItemInfo(s[t].Id,s[t].Num),this.rebirthCostList.push(i)}var r=this.getUpstarCfg(e.id,e.star);if(r){var o=r.recycleItems;for(a=o.length,t=0;t<a;t++)i=game.ItemUtil.createBaseItemInfo(o[t].Id,o[t].Num),this.rebirthCostList.push(i)}}return this.rebirthCostList},clearList:function(e){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0},getQuickEquipIdxArr:function(e,t){var a=game.fosterData.getFosterInfo(e,t);if(a){this.quickEquipIdxArr||(this.quickEquipIdxArr=[]);for(var i=void(this.quickEquipIdxArr.length=0),n=void 0,s=void 0,r=void 0,o=void 0,g=void 0,u=a.getFosterEquipMap(),l=0;l<this.maxSlotNum;l++)n=l+1,i=u.get(n),(r=this.getBestEquipByBag(e,n))&&(i&&(s=i.getFosterEquipInfo())&&(o=s.getPower(),g=r.getPower(),s.sortId>r.sortId||s.sortId==r.sortId&&g<o)||this.quickEquipIdxArr.push(r.idx));return this.quickEquipIdxArr}},getIntenifyArr:function(e,t,a,i){var n=3<arguments.length&&void 0!==i&&i,s=this,r=game.fosterData.getFosterInfo(e,t);if(!r)return null;s.tempEquipArr||(s.tempEquipArr=[]),s.intenifyArr||(s.intenifyArr=[]),s.intenifyArr.length=0,s.tempCostMap||(s.tempCostMap=b8e.HashMap.get());var o=void(s.intenifyArr.length=0);if(a){var g=r.getFosterEquipMap();g&&g.forEach(function(e,t){s.tempEquipArr.push(t)},s)}else(o=r.getSelectInfo())&&s.tempEquipArr.push(o);for(var u=void 0,l=void 0,c=void 0,h=void 0,m=!0,d=s.tempEquipArr.length,f=d<2?d:r.getNotEmptyCount(),p=game.mainRoleData.lv*s.maxLvCoef,v=0,E=0;E<5;E++){for(var T=v=0;T<d;T++)if(u=(o=s.tempEquipArr[T]).getFosterEquipInfo())if(u.lv>=p)v++;else if(!(p<(l=u.lv+E))&&(h=s.getIntensifyCostCfg(e,l))){if(s.setCostArr(h.costItems,s.tempCostMap),c=s.tempCostMap.values(),!(m=game.UpgradeUtil.checkItemList(c,1,!1)))break;s.setIntenifyEquip(u,E+1,s.intenifyArr)}if(!m||v==f)break}if(s.intenifyArr.length<1&&n)if(v==f)game.notice.show(53516);else if((c=s.tempCostMap.values())&&0<c.length){var C=c[0],I=game.ItemInfoCfg.getData(C.Id);I&&game.UpgradeUtil.showAccessTips(I)}return s.tempEquipArr.length=0,s.tempCostMap.clear(),s.intenifyArr},setIntenifyEquip:function(e,t,a){if(e&&a){for(var i=void 0,n=e.pos,s=a.length,r=0;r<s;r++)if((i=a[r]).slot==n)return void(i.lv=t);(i=this.getQhObj(s)).slot=n,i.lv=t,a[s]=i}},getQhObj:function(e){return this.qhObjPool||(this.qhObjPool=[]),this.qhObjPool[e]||(this.qhObjPool[e]=new game.pb.FosterEquipQh.ctor),this.qhObjPool[e]},setCostArr:function(e,t){if(e&&!(e.length<1)&&t){this.costObjPool||(this.costObjPool=[]);for(var a=void 0,i=void 0,n=void 0,s=e.length,r=0;r<s;r++)i=e[r],(a=this.costObjPool[i.Id])||((a=this.costObjPool[i.Id]=b8e.createMap()).Id=i.Id,a.Num=i.Num),(n=t.get(i.Id))?n.Num+=i.Num:(a.Num=i.Num,t.set(i.Id,a))}},getEquipTypeToFosterType:function(e){var t=game.NewFosterType,a=game.FosterEquipType;switch(e){case t.MOUNT:return a.MOUNT;case t.SHENHUN:return a.SHENHUN}return a.MOUNT},getFosterTypeToEquipType:function(e){var t=game.NewFosterType,a=game.FosterEquipType;switch(e){case a.MOUNT:return t.MOUNT;case a.SHENHUN:return t.SHENHUN}return t.MOUNT},getInitialEquipList:function(e,t){var a=1<arguments.length&&void 0!==t?t:0,i=this.initialEquipList;(i=i||(this.initialEquipList=[])).length=0;var n=game.equipData.getItemListById(e);if(!n||n.length<1)return i;for(var s=void 0,r=n.length,o=0;o<r&&(0<(s=n[o]).fosterEquipStar||0<s.fosterEquipLv||(i.push(s.idx),!(0<a&&i.length==a)));o++);return i},checkAlert:function(e,t){var a=1<arguments.length&&void 0!==t?t:15;if(!e)return!1;var i=e.getFosterEquipMap();if(!i)return!1;for(var n=void 0,s=void 0,r=void 0,o=!1,g=void 0,u=void 0,l=void 0,c=void 0,h=0;h<this.maxSlotNum;h++)if(n=h+1,(r=i.get(n))&&(s=r.getFosterEquipInfo(),g=a>>0&1&&this.checkEquipSlotAlert(s,e.fosterType,n),u=a>>1&1&&this.checkEquipIntenifyAlert(s),l=a>>2&1&&this.checkUpstarEnough(s),c=a>>3&1&&this.checAttrRefinekEnough(s),o=!!(g||u||l||c)))return o;return o},checkEquipSlotAlert:function(e,t,a){var i=this.getEquipList(t,a);if(!e&&(!i||i.length<1))return!1;var n=this.getBestEquipByBag(t,a);if(!n)return!1;if(!e)return!0;var s=e.getPower(),r=n.getPower();return!!(e&&e.sortId==n.sortId&&s<r)||e.sortId<n.sortId},checkEquipIntenifyAlert:function(e){if(!e)return!1;var t=game.mainRoleData.lv*this.maxLvCoef;if(e.lv>=t)return!1;var a=e.lv,i=this.getIntensifyCostCfg(e.fosterType,a);return!!i&&game.UpgradeUtil.checkItemList(i.costItems,1,!1)},checkUpstarEnough:function(e,t){var a=1<arguments.length&&void 0!==t&&t;if(!e)return!1;var i=this.getUpstarCfg(e.id,e.star);if(!i||i.isMax)return!1;var n=this.getInitialEquipList(e.id);return!n||n.length<1?(a&&game.notice.show(53517),!1):n.length>=i.num||(a&&game.notice.show(53517),!1)},checKindRefinekEnough:function(e){var t=0<arguments.length&&void 0!==e&&e;return this.setWashCostInfo(),game.UpgradeUtil.checkItemInfo(this.washTypeId,this.washTypeNum,t)},checAttrRefinekEnough:function(e,t){var a=1<arguments.length&&void 0!==t&&t;if(!e)return!1;var i=e.getRefineInfoList();if(!i||i.length<1)return!1;for(var n=void 0,s=i.length,r=0;r<s;r++)if((n=i[r]).attrMaxValue>n.attrValue)return this.setWashCostInfo(),game.UpgradeUtil.checkItemInfo(this.washValueId,this.washValueNum,a);return a&&game.notice.show(53519),!1},checkRefineIsAllLock:function(e,t,a){var i=game.fosterData.getFosterInfo(e,t);if(!i)return!1;var n=i.getFosterEquipInfoBySlot(a);if(!n)return!1;var s=n.getRefineInfoList();if(!s||s.length<2)return!1;for(var r=0,o=s.length,g=0;g<o;g++)if(!s[g].lock&&1<++r)return!0;return!1},getQhCfg:function(e){return game.FosterEquipQHCfg.getData(e)},getIntensifyCostCfg:function(e,t){var a=this.getEquipTypeToFosterType(e);return game.FosterEquipQHCostCfg.getData(a,t)},getUpstarCfg:function(e,t){return game.FosterEquipStarfg.getData(e,t)},getOpenCfg:function(e,t){var a=this.getEquipTypeToFosterType(e);return game.FosterEquipOpenCfg.getData(a,t)}});game.fosterEquipData=game.fosterEquipData||new e}(),function(){var t=void 0;t=b8e.PoolObject.extends({lock:!1,attrSlot:0,attrId:0,attrName:"",attrValue:0,attrMaxValue:0,fosterType:0,setData:function(e,t,a,i,n,s){this.fosterType=e,this.id=i,this.fosterId=t,this.slot=a,this.fosterEquipStar=n,this.updateLockData(s)},updateLockData:function(e){this.lock=e.lock,this.attrSlot=e.attrSlot;var t=e.attr;this.attrId=t.id;var a=game.AttrPowerCoefCfg.getData(this.attrId);this.attrValue=t.value,a&&1==a.type&&(this.attrValue=t.value/100),this.updateValue()},updateValue:function(){var e=this,t=game.ItemInfoCfg.getData(e.id);if(t){var a=game.FosterEquipWashLimitCfg.getData(t.types,t.quality,e.fosterEquipStar);if(a){if(!game.MaxKeyByStatType[e.attrId])return e.attrMaxValue="",void(e.attrName="");var i=b8e.getNormP(game.MaxKeyByStatType[e.attrId]);e.attrMaxValue=a[i];var n=game.AttrPowerCoefCfg.getData(e.attrId);n&&1==n.type&&(e.attrMaxValue=a[i]/10);var s=game.AttrRulesCfg.getData(e.attrId);e.attrName=s?s.name:""}}},getCfg:function(){if(this.fosterEquipInfo)return this.fosterEquipInfo.getCfg()},recycle:function(){this.reset(),this._super()},reset:function(){this.lock=!1,this.attrSlot=0,this.attrId=0,this.attrName="",this.attrValue=0,this.attrMaxValue=0,this.fosterType=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$FosterEquipRefineInfo",t)}(),function(){var e;e=b8e.PoolObject.extends({slot:0,fosterEquipInfo:null,select:!1,setFosterData:function(e,t,a){this.slot=e.slot,this.fosterId=t,this.fosterType=a,e.equip&&(this.fosterEquipInfo||(this.fosterEquipInfo=game.FosterEquipInfo.get()),this.fosterEquipInfo.setFosterData(e,t))},setEmptyData:function(e,t,a){this.slot=e,this.fosterId=t,this.fosterType=a},wearEquip:function(e,t,a,i){this.fosterId=t,this.fosterType=a,this.slot=i,this.fosterEquipInfo||(this.fosterEquipInfo=game.FosterEquipInfo.get()),this.fosterEquipInfo.wearEquip(e,t,this.slot)},castEquip:function(){this.fosterEquipInfo&&(this.fosterEquipInfo.release(),this.fosterEquipInfo=null)},getCfg:function(){if(this.fosterEquipInfo)return this.fosterEquipInfo.getCfg()},getFosterEquipInfo:function(){return this.fosterEquipInfo}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$FosterEquipSlotInfo",e)}(),function(){var e;e=b8e.Enum({MOUNT:1,SHENHUN:5}),b8e.RC("$$game","$$FosterEquipType",e)}(),function(){var e;e=b8e.Enum({FOSTER_EQUIP_WEAR_COMPLETE:b8e.enc(),FOSTER_EQUIP_UPDATE_INFO:b8e.enc(),FOSTER_EQUIP_UPDATE_POWER:b8e.enc(),FOSTER_EQUIP_SELECT_SLOTID:b8e.enc(),FOSTER_EQUIP_PLAY_UP_ANIM:b8e.enc(),FOSTER_EQUIP_REFINE_LOCK_CHANGE:b8e.enc(),FOSTER_EQUIP_UPDATE_ICON:b8e.enc(),FOSTER_UPDATE_EQUIP_ALERT:b8e.enc()}),b8e.RC("$$game","$$FosterEquipEvts",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1619)},init:function(){},onShow:function(){this.showEquipInfo=game.fosterEquipData.getShowEquipInfo(),this.showEquipInfo?(this.updateBaseInfo(),this.updateIntensifyInfo(),this.updateUpstarInfo(),this.updateRefineInfo()):game.module.hide(this.moduleEnum)},onHide:function(){},updateBaseInfo:function(){var e=this,t=e.skin,a=e.showEquipInfo;if(a){e.isBack=game.fosterEquipData.isBack,e._itemGrid||(e._itemGrid=game.GridUtil.createFosterEquipTipsIcon(),e._itemGrid.addToParent(t.icon)),e._itemGrid.setData(a,0,!1,!1);var i=a.getCfg();i&&(t.equipName.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name,!0),t.power.string=game.Lang.get(51475,game.HtmlUtil.getText(game.Color.GREEN,e.showEquipInfo.totalFight)),t.equipQuality.string=game.Lang.get(51476,game.HtmlUtil.getColorStrByQuality(i.quality,game.CCommonUtil.getQualityStr(i.quality))),t.star.string=game.Lang.get(53521,a.star),t.baseAttr.string=game.SpriteStatUtil.getSpriteStatDesc(e.showEquipInfo.baseSpriteStat,game.Color.BLACK,game.Color.GREEN,"<br/>",": ","      ",2),t.showBtn.active=!e.isBack)}},updateIntensifyInfo:function(){var e=this.skin,t=this.showEquipInfo;if(t){e.intensifyPage.y=e.baseAttr.y-e.baseAttr.height-5;var a=3*game.mainRoleData.lv;e.intensifyLv.string=game.Lang.get(53522,t.lv,a);var i=t.getCurIntensifySpriteStat();e.intensifyStat.string=i?this.getSpriteStatDesc(i):""}},updateUpstarInfo:function(){var e=this.skin,t=this.showEquipInfo;if(t){e.upstarPage.y=e.intensifyPage.y+e.intensifyStat.y-e.intensifyStat.height-10,e.upstarLv.string=game.Lang.get(53523,t.star);var a=t.getCurUpstarSpriteStat();e.upstarStat.string=a?this.getSpriteStatDesc(a):""}},updateRefineInfo:function(){var e=this.skin,t=this.showEquipInfo;if(t){e.refinePage.y=e.upstarPage.y+e.upstarStat.y-e.upstarStat.height-10;var a=t.getCurRefineSpriteStat();if(a){e.refineStat.string=this.getSpriteStatDesc(a);var i=e.refineStat.y-e.refineStat.height-10;e.tips_line_4.y=-122<i?-122:i}else e.refineStat.string=""}},getSpriteStatDesc:function(e){if(!e)return"";var a=void 0,i="";return e.getSpriteStats().forEach(function(e,t){e=+e,(a=game.AttrRulesCfg.getData(e))?(t=2==a.format?100*t+"%":game.CCommonUtil.replaceNum(0|t,0),i+=game.Lang.get(509,a.name,t)+"<br/>"):b8e.warn("\u6ca1\u6709\u5728\u5c5e\u6027\u89c4\u5219\u8868\u67e5\u5230\u5230\u8be5\u7c7b\u578b\u5c5e\u6027:",e,"\u6a21\u5757id",this.moduleEnum)},this),i},changeBtn:function(){this.showEquipInfo&&game.FosterEquipMgr.inst().changeFosterEquip(this.showEquipInfo.slot)},removeBtn:function(){this.showEquipInfo&&game.FosterEquipMgr.inst().removeEquip(this.showEquipInfo.slot)}});b8e.app.registerView(game.ME.FosterEquipDetail,e)}(),function(){var e=game.GamePanel.extends({rtSpaceY:30,rtSpaceX:400,ctor:function(){this._super(1620)},init:function(){},onShow:function(){this.updateInfoPage(),this.updateEquipIcon(),this.registerEvents()},onHide:function(){this.unRegisterEvents(),this.clearRtList()},registerEvents:function(){var e=game.FosterEquipMgr.inst();e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_WEAR_COMPLETE,this.updateInfoPage,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON,this.updateEquipIcon,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateEquipDetailBtn,this)},unRegisterEvents:function(){var e=game.FosterEquipMgr.inst();e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_WEAR_COMPLETE,this.updateInfoPage,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON,this.updateEquipIcon,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateEquipDetailBtn,this)},updateEquipIcon:function(){var e=game.fosterEquipData,t=e.getCurFosterInfo();this.skin.quickWearBtn.active=e.checkAlert(t,1)},updateEquipDetailBtn:function(){var e=game.fosterEquipData.getCurSelectSlotInfo();this.skin.equipDetailBtn.active=!(!e||!e.getFosterEquipInfo())},updateInfoPage:function(){var i=this;i.updateEquipDetailBtn(),i.clearRtList();var e=game.fosterEquipData.getCurEquipAllSpriteStat();if(e){var n=i.baseRtList;n=n||(i.baseRtList=[]);var s=i.highRtList;s=s||(i.highRtList=[]);var r=void 0,o=void 0,g=i.skin,u=i.rtSpaceY,t=e.getSpriteStats(),l=u;t.forEach(function(e,t){if(e=+e,r=game.AttrRulesCfg.getData(e))if(t=2==r.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(0|t,0),(o=i.getRichText()).string=game.Lang.get(507,r.name,t),1==r.attrType)o.addToParent(g.baseAttrStr),n.push(o),o.setPosition(0,-u*(n.length-1));else{o.addToParent(g.highAttrStr),s.push(o);var a=s.length%2==1?0:i.rtSpaceX;0==a&&(l-=u),o.setPosition(a,l)}else b8e.warn("\u6ca1\u6709\u5728\u5c5e\u6027\u89c4\u5219\u8868\u67e5\u5230\u5230\u8be5\u7c7b\u578b\u5c5e\u6027:",e,"\u6a21\u5757id",i.moduleEnum)},i),g.baseContent.height=n.length<1?40:40*n.length-10,g.highContent.height=s.length<1?40:40*Math.floor(s.length/2)-10}},getRichText:function(){var e=this.rtPool;if(0<(e=e||(this.rtPool=[])).length)return e.shift();var t=b8e.RichText.get();return t.setAnchor(0,1),t.setFontSize(22),t.setLineHeight(24),t},putRichText:function(e){e&&this.rtPool&&(e.string="",e.removeFromParent(),this.rtPool.push(e))},clearRtList:function(){var e=this;if(e.baseRtList&&0<e.baseRtList.length){for(var t=e.baseRtList.length,a=0;a<t;a++)e.putRichText(e.baseRtList[a]);e.baseRtList.length=0}if(e.highRtList&&0<e.highRtList.length){for(var i=e.highRtList.length,n=0;n<i;n++)e.putRichText(e.highRtList[n]);e.highRtList.length=0}},quickWearBtn:function(){game.FosterEquipMgr.inst().quickWearInInfoPage()},equipDetailBtn:function(){var e=game.fosterEquipData.getCurSelectSlotInfo();!e&&e.getFosterEquipInfo()||game.FosterEquipMgr.inst().showEquip(e.fosterId,e.fosterType,e.getFosterEquipInfo())},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.FosterEquipInfo,e)}(),function(){var e=game.GamePanel.extends({rtSpaceY:40,rtSpaceX:400,ctor:function(){this._super(1621)},init:function(){this.skin.selectBtn.touchEnabled=!1},onShow:function(){this.updateInfoPage(),this.registerEvents()},onHide:function(){this.unRegisterEvents()},registerEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.FosterEquipMgr.inst();e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateInfoPage,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,this.updateInfoPage,this)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.FosterEquipMgr.inst();e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,this.updateInfoPage,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateInfoPage,this)},updateEquipIcon:function(){var e=game.fosterEquipData,t=e.getCurFosterInfo();this.skin.red_spot.active=e.checkAlert(t,2)},updateInfoPage:function(){var a=this,e=a.skin,t=game.fosterEquipData.getCurSelectSlotInfo();if(!t)return e.costNode.active=!1,void(e.emptyDesc.active=!0);var i=t.getFosterEquipInfo();if(!i||!i.idx)return e.costNode.active=!1,void(e.emptyDesc.active=!0);e.selectImg.active=game.fosterEquipData.isIntensifyAll,e.costNode.active=!0,e.emptyDesc.active=!1;var n=void 0,s=void 0,r=i.getCurIntensifySpriteStat();r&&(s="",r.getSpriteStats().forEach(function(e,t){e=+e,t=game.CCommonUtil.replaceNum(0|t,0),(n=game.AttrRulesCfg.getData(e))?s+=game.Lang.get(507,n.name,t)+"<br/>":b8e.warn("\u6ca1\u6709\u5728\u5c5e\u6027\u89c4\u5219\u8868\u67e5\u5230\u5230\u8be5\u7c7b\u578b\u5c5e\u6027:",e,"\u6a21\u5757id",a.moduleEnum)},a),e.leftAttrStr.string=s),(r=i.getNextIntensifySpriteStat())&&(s="",r.getSpriteStats().forEach(function(e,t){e=+e,t=game.CCommonUtil.replaceNum(0|t,0),(n=game.AttrRulesCfg.getData(e))?s+=game.Lang.get(507,n.name,t)+"<br/>":b8e.warn("\u6ca1\u6709\u5728\u5c5e\u6027\u89c4\u5219\u8868\u67e5\u5230\u5230\u8be5\u7c7b\u578b\u5c5e\u6027:",e,"\u6a21\u5757id",a.moduleEnum)},a),e.rightAttrStr.string=s),a.skin.leftLv.string=game.Lang.get(53524,i.lv),a.skin.rightLv.string=game.Lang.get(53524,i.lv+1),a.updateCost()},updateCost:function(){var e=this.skin;this.updateEquipIcon();var t=game.fosterEquipData.getCurSelectSlotInfo();if(t){var a=t.getFosterEquipInfo();if(a&&a.idx){var i=a.getIntensifyCostCfg();if(i&&i.costItems&&!(i.costItems.length<1)){var n=i.costItems[0],s=n.Id,r=game.ItemInfoCfg.getData(s);if(r){this.costIcon||(this.costIcon=game.GridUtil.createCostItemIcon(),this.costIcon.addToParent(e.costIcon)),this.costIcon.setItemInfo(s);var o=n.Num,g=game.itemData.getCountById(s),u=g<o?503:504;e.costNum.string=game.Lang.get(u,g,o),e.costName.string=game.HtmlUtil.getColorStrByQuality(r.quality,r.name)}}}}},selectBtn:function(){game.fosterEquipData.isIntensifyAll=!game.fosterEquipData.isIntensifyAll,this.skin.selectImg.active=game.fosterEquipData.isIntensifyAll},intenifyBtn:function(){game.FosterEquipMgr.inst().intenifyEquip()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.FosterEquipIntensify,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1622),this.setSize(490,30)},init:function(){this.maxWidth=this.skin.barBg.width-18,this.skin.lockBtn.touchEnabled=!1},setData:function(){var e=this.skin,t=this.data;e.name.string=t.attrName,e.progress.string=t.attrValue,e.lockImg.active=t.lock,e.unlockImg.active=!t.lock,e.bar.width=this.maxWidth*t.attrValue/t.attrMaxValue},lockBtn:function(){var e=this.data;game.FosterEquipMgr.inst().changeLock(e.fosterType,e.fosterId,e.slot,e.attrSlot,!e.lock)}});b8e.RC("$$game","$$FosterEquipRefineItem",e)}(),function(){var e=game.GamePanel.extends({rtSpaceY:40,rtSpaceX:400,ctor:function(){this._super(1623)},init:function(){var e=game.fosterEquipData;e.setWashCostInfo(),this.washValueId=e.washValueId,this.washValueNum=e.washValueNum,this.washTypeId=e.washTypeId,this.washTypeNum=e.washTypeNum;var t=this.refineList=new game.List;t.itemRender=game.FosterEquipRefineItem,t.addToParent(this.skin.list),t.layout.spacingY=5,t.layout.paddingTop=0,this.skin.leftCostIcon.touchEnable=!1,this.skin.rightCostIcon.touchEnable=!1},onShow:function(){this.updateInfoPage(),this.registerEvents()},onHide:function(){this.unRegisterEvents()},registerEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.FosterEquipMgr.inst();e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,this.updateInfoPage,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_REFINE_LOCK_CHANGE,this.updateLockDesc,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateInfoPage,this)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.FosterEquipMgr.inst();e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,this.updateInfoPage,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_REFINE_LOCK_CHANGE,this.updateLockDesc,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateInfoPage,this)},updateEquipIcon:function(){var e=game.fosterEquipData,t=e.getCurFosterInfo();this.skin.red_spot.active=e.checkAlert(t,8)},updateInfoPage:function(){var e=this,t=e.skin;if(e.curSelectSlotInfo=game.fosterEquipData.getCurSelectSlotInfo(),e.curSelectSlotInfo){var a=e.fosterEquipInfo=e.curSelectSlotInfo.getFosterEquipInfo();if(!a||!a.idx)return t.costNode.active=!1,void(t.emptyDesc.active=!0);t.costNode.active=!0,t.emptyDesc.active=!1,e.refineInfoList=a.getRefineInfoList(),t.topBtn.active=t.bottomBtn.active=!!(e.refineInfoList&&4<e.refineInfoList.length),e.refineList.setData(e.refineInfoList),e.updateLockDesc(),e.updateCost()}},updateCost:function(){var e=this.skin,t=void 0,a=void 0,i=void 0;this.updateEquipIcon();var n=this.washTypeId,s=game.ItemInfoCfg.getData(n);s&&(e.leftCostIcon.loadTexture(game.ResCfg.getUrl(137,s.icon)),a=this.washTypeNum,i=(t=game.itemData.getCountById(n))<a?503:504,e.leftCostNum.string=game.Lang.get(i,game.CCommonUtil.replaceNum(t,0),a),this.setCentenNode(e.leftCostIcon,e.leftCostNum)),n=this.washValueId,(s=game.ItemInfoCfg.getData(n))&&(e.rightCostIcon.loadTexture(game.ResCfg.getUrl(137,s.icon)),a=this.washValueNum,i=(t=game.itemData.getCountById(n))<a?503:504,e.rightCostNum.string=game.Lang.get(i,game.CCommonUtil.replaceNum(t,0),a),this.setCentenNode(e.rightCostIcon,e.rightCostNum))},updateLockDesc:function(){this.skin.refineLockTips.string=this.fosterEquipInfo?this.fosterEquipInfo.getRefineLockDesc():""},leftRefineBtn:function(){game.FosterEquipMgr.inst().kindRefine()},rightRefineBtn:function(){game.FosterEquipMgr.inst().attrRefine()},topBtn:function(){this.refineList.scrollContainerTop()},bottomBtn:function(){this.refineList.scrollContainerBottom()},leftCostIcon:function(){var e=game.ItemInfoCfg.getData(this.washTypeId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))},rightCostIcon:function(){var e=game.ItemInfoCfg.getData(this.washValueId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))},onStageResize:function(){this.setPosition(0,0)},setCentenNode:function(e,t){var a=e.width+t.width+5>>1;e.x=(e.width>>1)-a,t.x=e.x+(e.width>>1)+5}});b8e.app.registerView(game.ME.FosterEquipRefine,e)}(),function(){var e;e=game.GameItemIcon.extends({battleIcon:null,nameLbl:null,lvLbl:null,info:null,ctor:function(){this._super(game.IconSizeEnum.GRID_SIZE_105),b8e.evt.onC(this,this._fnOnClickGrid,this)},setData:function(e){if(e){this.clearData();var t=(this.info=e).getCfg();if(t){var a=game.ResCfg.getQualityBg(t.quality),i=game.ResCfg.getUrl(60,a);this.setBgImage(i),this.addIconImage(),this.setLv(e.lv),this.setStar(e.star);var n="";t&&(n=game.ResCfg.getUrl(137,t.icon)),this.setIcon(n)}}},setSlotData:function(e){var t=this;if(e){var a=void 0;t.clearData();var i=(t.info=e).getFosterEquipInfo();if(!i){var n=game.fosterEquipData.getEquipTypeToFosterType(t.fosterType);return a=game.ResCfg.getUrl(10210,e.slot+"_"+n),void t.setBgImage(a)}var s=i.getCfg();if(s){var r=game.ResCfg.getQualityBg(s.quality);a=game.ResCfg.getUrl(60,r),t.setBgImage(a),t.addIconImage(),t.setLv(i.lv),t.setStar(i.star),t.setName(i);var o="";s&&(o=game.ResCfg.getUrl(137,s.icon)),t.setIcon(o)}}},setName:function(e){var t;t=e.quality;var a=e.getCfg(),i=a?a.name:"",n=game.HtmlUtil.getColorStrByQuality(t,i);this.addNameLbl(),this.nameLbl.setText(n),this.setLabBg();var s=.5*this.nameLbl.width;this.nameLbl.setPosition(-s,-81)},addNameLbl:function(){this.nameLbl||(this.nameLbl=b8e.RichText.get(),this.nameLbl.setFontSize(18)),this.nameLbl.parent||(this.addChild(this.nameLbl),this.nameLbl.setVisible(!0))},removeNameLbl:function(){this.nameLbl&&this.nameLbl.removeFromParent()},setLabBg:function(){this._labBg||(this._labBg=b8e.Sprite.get(),this._labBg.setStyle(b8e.SpriteStyle.SLICED)),this._labBg.setVisible(!0),this._labBg.scale9Inset={top:8,bottom:8,left:11,right:11},this._labBg.loadTexture(game.ResCfg.getUrl(239)),this.setLabBgPos(),this.setLabBgSize()},setLabBgPos:function(){if(this._labBg&&!this._labBg.parent&&this.addChild(this._labBg),this._labBg){var e=this.nameLbl.width>>1;this._labBg.setPosition(-e-6,-79)}},setLabBgSize:function(){this.nameLbl&&this._labBg.setSize(this.nameLbl.width+12,22)},removeLabBg:function(){this._labBg&&this._labBg.unloadTexture()},setLv:function(e){this.addLvLbl();var t="L"+e;this.lvLbl.setText(t)},addLvLbl:function(){if(!this.lvLbl){this.lvLbl=b8e.Label.get(),this.lvLbl.setAnchor(.5,0),this.lvLbl.setFontSize(35),this.lvLbl.setLineHeight(35),this.lvLbl.setFontFile(b8e.ResMgr.UI_ROOT+"/app/font/cultivateLv/cultivateLv.bbf")}if(!this.lvLbl.parent){this.addChild(this.lvLbl),this.lvLbl.setPosition(0,-65),this.lvLbl.setVisible(!0)}},removeLvLbl:function(){this.lvLbl&&this.lvLbl.removeFromParent()},addStar:function(){var e=this;e.starBg||(e.starBg=b8e.Sprite.get(),e.starBg.setAnchor(.5,.5),e.starBg.setScale(.7,.7),e.starBg.setPosition(45,-30),e.starBg.loadTexture(game.ResCfg.getUrl(10078))),e.starLab||(e.starLab=b8e.Label.get(),e.starLab.setAnchor(.5,.5),e.starLab.setPosition(45,-32),e.starLab.setColor(game.Color.BLACK),e.starLab.setFontSize(18)),e.starBg.parent||e.addChild(e.starBg),e.starLab.parent||e.addChild(e.starLab)},setStar:function(e){this.addStar(),this.starLab.setText(e)},removeStar:function(){this.starBg&&this.starBg.removeFromParent(),this.starLab&&this.starLab.removeFromParent()},clearData:function(){this.removeLvLbl(),this.removeNameLbl(),this.removeStar(),this.removeLabBg(),this._iconImg&&(this._iconResName="",this._iconImg.unloadTexture())},getBgUrl:function(e){return e},setClickCb:function(e,t){this._clickCb=e?{func:e,thisArg:t}:null},_fnOnClickGrid:function(){this._clickCb&&this._clickCb.thisArg&&this._clickCb.func.call(this._clickCb.thisArg,this)}}),b8e.RC("$$game","$$FosterEquipTipsIcon",e)}(),function(){var e=game.GamePanel.extends({rtSpaceY:40,rtSpaceX:400,ctor:function(){this._super(1624)},init:function(){},onShow:function(){this.updateInfoPage(),this.registerEvents()},onHide:function(){this.unRegisterEvents()},registerEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.FosterEquipMgr.inst();e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,this.updateInfoPage,this),e.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateInfoPage,this)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.FosterEquipMgr.inst();e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,this.updateInfoPage,this),e.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,this.updateInfoPage,this)},updateInfoPage:function(){var a=this,e=a.skin,t=game.fosterEquipData.getCurSelectSlotInfo();if(!t)return e.costNode.active=!1,void(e.emptyDesc.active=!0);var i=t.getFosterEquipInfo();if(!i||!i.idx)return e.costNode.active=!1,void(e.emptyDesc.active=!0);var n=i.getUpstarCfg();if(!n)return e.costNode.active=!1,void(e.emptyDesc.active=!0);n.unlockStar?e.unlockDesc.string=game.Lang.get(53525,n.unlockStar):e.unlockDesc.string="",e.costNode.active=!0,e.emptyDesc.active=!1;var s=void 0,r=i.getCurUpstarSpriteStat(),o=void 0;r&&(o="",r.getSpriteStats().forEach(function(e,t){e=+e,(s=game.AttrRulesCfg.getData(e))?(t=2==s.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(0|t,0),o+=game.Lang.get(507,s.name,t)+"<br/>"):b8e.warn("\u6ca1\u6709\u5728\u5c5e\u6027\u89c4\u5219\u8868\u67e5\u5230\u5230\u8be5\u7c7b\u578b\u5c5e\u6027:",e,"\u6a21\u5757id",a.moduleEnum)},a),e.leftAttrStr.string=o),e.leftLv.string=game.Lang.get(53526,i.star),e.upstarNode.active=!n.isMax,e.maxNode.active=n.isMax,n.isMax||((r=i.getNextUpstarSpriteStat())&&(o="",r.getSpriteStats().forEach(function(e,t){e=+e,(s=game.AttrRulesCfg.getData(e))?(t=2==s.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(0|t,0),o+=game.Lang.get(507,s.name,t)+"<br/>"):b8e.warn("\u6ca1\u6709\u5728\u5c5e\u6027\u89c4\u5219\u8868\u67e5\u5230\u5230\u8be5\u7c7b\u578b\u5c5e\u6027:",e,"\u6a21\u5757id",a.moduleEnum)},a),e.rightAttrStr.string=o),e.rightLv.string=game.Lang.get(53526,i.star+1),a.updateCost())},updateCost:function(){var e=this.skin,t=game.fosterEquipData.getCurSelectSlotInfo();if(t){var a=t.getFosterEquipInfo();if(a&&a.idx){var i=a.getUpstarCfg();if(i){var n=i.id,s=game.ItemInfoCfg.getData(n);if(s){this.costIcon||(this.costIcon=game.GridUtil.createCostItemIcon(),this.costIcon.addToParent(e.costIcon)),this.costIcon.setItemInfo(n);var r=i.num,o=game.fosterEquipData.getInitialEquipList(n),g=o?o.length:0,u=g<r?503:504;e.costNum.string=game.Lang.get(u,g,r),e.costName.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name),this.skin.red_spot.active=r<=g}}}}},upstarBtn:function(){game.FosterEquipMgr.inst().upstarEquip()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.FosterEquipUpstar,e)}(),function(){var e=game.GamePanel.extends({toggleIndex:0,ctor:function(){this._super(1618)},init:function(){this.toggles={toggle_btn_1:game.ME.FosterEquipInfo,toggle_btn_2:game.ME.FosterEquipIntensify,toggle_btn_3:game.ME.FosterEquipUpstar,toggle_btn_4:game.ME.FosterEquipRefine}},onShow:function(){this.fosterType=game.fosterEquipData.curFosterType,this.fosterId=game.fosterEquipData.curFosterId,this.curSelectFosterInfo=game.fosterData.getCurFosterInfo();var e=game.fosterData.getFosterClientCfgByType(this.fosterType);e&&e.equipImg&&this.skin.title.loadTexture(game.ResCfg.getUrl(10209,e.equipImg)),game.fosterEquipData.showViewDefaultSelect(),this.updatePower(),this.updateEquipIcon(),this.registerEvents()},onHide:function(){this.unRegisterEvents(),this.toggleIndex=0},registerEvents:function(){var e=this,t=game.FosterEquipMgr.inst();t.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_POWER,e.updatePower,e),t.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,e.updateEquipIcon,e),t.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,e.updateEquipIcon,e),t.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,e.playUpAnim,e),t.addEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON,e.updateEquipIcon,e)},unRegisterEvents:function(){var e=this,t=game.FosterEquipMgr.inst();t.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_POWER,e.updatePower,e),t.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_INFO,e.updateEquipIcon,e),t.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_SELECT_SLOTID,e.updateEquipIcon,e),t.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_PLAY_UP_ANIM,e.playUpAnim,e),t.removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_UPDATE_ICON,e.updateEquipIcon,e)},toggleSelect:function(e){this.toggleIndex=e,this.updateEquipIcon(),this._super(e)},updatePower:function(){var e=this.skin,t=game.fosterEquipData.getCurFosterEquipPower();e.fightAmountLbl.string=t,game.AutoLayoutUtil.layoutPower(e.power,e.fightAmountLbl,e.powerImg)},updateEquipIcon:function(){var e=this,t=e.curSelectFosterInfo,a=e.equipIconArr;if(e.updateSelectSlot(),e.updateAlert(),t){if(!a){a=e.equipIconArr=[],e.upAnimArr=[];for(var i=0;i<game.fosterEquipData.maxSlotNum;i++){var n=new game.NewFosterEquipIcon;n.bindEnum=e.moduleEnum;var s=e.getComponent("equipIcon_"+i);n.addToParent(s),a.push(n);var r=e.upAnimArr[i]=b8e.Animator.get(game.AnimType.UI_EFFECT,1);r.addToParent(s),r.load(game.ResCfg.getUrl(5019,1009)),r.addFinishCallback(e.animaCB,e,[i]),r.active=!1}}for(var o=Math.pow(2,e.toggleIndex),g=t.getFosterEquipMap(),u=0;u<a.length;u++){var l=u+1,c=a[u],h=g.get(l);c.show(h,l,e.fosterType,o)}}},updateAlert:function(){var e=this.skin,t=game.fosterEquipData,a=t.getCurFosterInfo();e.red_spot_1.active=t.checkAlert(a,1),e.red_spot_2.active=t.checkAlert(a,2),e.red_spot_3.active=t.checkAlert(a,4),e.red_spot_4.active=t.checkAlert(a,8)},updateSelectSlot:function(){var e=this.skin,t=game.Lang.get(53527);if(!this.equipIconArr)return e.equipImg.unloadTexture(),void(e.equipName.string=t);var a=game.fosterEquipData.getCurSelectSlotInfo();if(a&&0!=a.id){var i=a.getCfg();i?(e.equipImg.loadTexture(game.ResCfg.getUrl(10211,i.icon)),e.equipName.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name)):(e.equipImg.unloadTexture(),e.equipName.string=t)}else e.equipName.string=t,e.equipImg.unloadTexture()},playUpAnim:function(e){if(e&&e.data){var t=e.data;if(this.upAnimArr&&!(t.length<1))for(var a=this.upAnimArr.length,i=0;i<a;i++)-1<t.indexOf(i)&&(this.upAnimArr[i].play(null,0),this.upAnimArr[i].active=!0)}},animaCB:function(e,t){this.upAnimArr[t].active=!1},btn_1:function(){this.toggleSelect(0)},btn_2:function(){this.toggleSelect(1)},btn_3:function(){this.toggleSelect(2)},btn_4:function(){this.toggleSelect(3)}});b8e.app.registerView(game.ME.FosterEquip,e)}(),function(){var e;e=game.ListItem.extends({_itemGrid:null,ctor:function(){this._super(1625),this.setSize(540,126)},init:function(){},setData:function(){var e=this.skin,t=this.data;this._itemGrid||(this._itemGrid=game.GridUtil.createFosterEquipTipsIcon(),this._itemGrid.addToParent(e.icon)),this._itemGrid.setData(t,0,!1,!1);var a=game.ItemInfoCfg.getData(t.id);a&&(e.name.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name)),e.star.string=game.Lang.get(53521,t.star),e.power.string=game.Lang.get(53528,t.totalFight)},wearBtn:function(){game.FosterEquipMgr.inst().wearEquip(this.data.idx)},touchIcon:function(){game.FosterEquipMgr.inst().showEquipNotChange(this.data)}});b8e.RC("$$game","$$FosterEquipWearItem",e)}(),function(){var e=game.GamePanel.extends({rtSpaceY:40,rtSpaceX:400,ctor:function(){this._super(1626)},init:function(){var e=this.wearList=new game.List;e.itemRender=game.FosterEquipWearItem,e.addToParent(this.skin.list),e.layout.spacingY=5},onShow:function(){this.updateInfoPage(),this.registerEvents()},onHide:function(){this.unRegisterEvents()},registerEvents:function(){game.FosterEquipMgr.inst().addEvent(game.FosterEquipEvts.FOSTER_EQUIP_WEAR_COMPLETE,this.updateInfoPage,this)},unRegisterEvents:function(){game.FosterEquipMgr.inst().removeEvent(game.FosterEquipEvts.FOSTER_EQUIP_WEAR_COMPLETE,this.updateInfoPage,this)},updateInfoPage:function(){var e=game.fosterEquipData,t=game.fosterEquipData.getEquipList(e.changeFosterType,e.changeSlot);this.wearList.setData(t)}});b8e.app.registerView(game.ME.FosterEquipWear,e)}(),function(){var e;e=game.Widget.extends({_icon:null,ctor:function(){this._super(1627),this.setSize(186,227)},init:function(){},show:function(e,t,a,i){var n=3<arguments.length&&void 0!==i?i:15;this.info=e,this.slot=t,this.fosterType=a,this.alertEnum=n,this.updateEquipIcon(),this._super()},onShow:function(){this.updateEquipIcon()},onHide:function(){},updateEquipIcon:function(){var e=this,t=e.skin;if(t&&e.info){var a=e.fosterEquipInfo=e.info.getFosterEquipInfo();if(game.fosterEquipData.checkEquipSlotAlert(a,e.fosterType,e.slot),e.updateAlert(),e.bindEnum==game.ME.FosterEquip?e.updateSelect(e.info):e.skin.select.active=!1,!a||!a.idx){var i=game.fosterEquipData.getEquipTypeToFosterType(e.fosterType),n=game.ResCfg.getUrl(10210,e.slot+"_"+i);return t.empty_equipIcon.loadTexture(n),t.noEquip.active=!0,void(t.hasEquip.active=!1)}t.noEquip.active=!1,t.hasEquip.active=!0,e.updateIcon(),e.updateLv(),e.updateStar()}},updateSelect:function(e){e&&this.skin&&(this.skin.select.active=e.select)},updateStar:function(){var e=this.fosterEquipInfo.star;this.maxStar||(this.maxStar=6);for(var t=20+(this.skin.starNode.width-40*e>>1),a=0;a<this.maxStar;a++){var i=this.getComponent("starIcon_"+a);i.x=t+40*a,i.active=a<e}},updateLv:function(){var e=this.skin;e.lv.string=game.Lang.get(53529,this.fosterEquipInfo.lv),e.lvBg.width=e.lv.width+10},updateIcon:function(){var e=this.skin,t=this.fosterEquipInfo.getCfg();if(t){var a=game.ResCfg.getQualityBg(t.quality),i=this._iconBg;i||((i=this._iconBg=b8e.Sprite.get()).setAnchor(.5,.5),i.setStyle(b8e.SpriteStyle.SLICED),i.scale9Inset={top:19,bottom:23,left:20,right:20}),i&&!i.parent&&i.addToParent(e.bg_Icon);var n=game.IconSizeEnum.GRID_SIZE_105;i.setSize(game.IconWidthSizeEnumMap[n],n),i.loadTexture(game.ResCfg.getUrl(240,a)),e.icon.loadTexture(game.ResCfg.getUrl(137,t.icon))}else e.icon.unloadTexture()},updateAlert:function(){var e=this.fosterEquipInfo,t=game.fosterEquipData,a=this.alertEnum;this.skin.redPoint.active=!!(a>>0&1&&t.checkEquipSlotAlert(e,this.fosterType,this.slot)||a>>1&1&&t.checkEquipIntenifyAlert(e)||a>>2&1&&t.checkUpstarEnough(e)||a>>3&1&&t.checAttrRefinekEnough(e))},touchIcon:function(){var e=this.info,t=this.fosterEquipInfo;if(e){var a=game.FosterEquipMgr.inst();if(this.bindEnum==game.ME.Foster){if(!t||!t.idx)return void this.showWearView();a.showEquip(e.fosterId,e.fosterType,t)}else if(b8e.module.isShowView(game.ME.FosterEquipInfo)){if(!t||!t.idx)return void this.showWearView();a.showEquip(e.fosterId,e.fosterType,t)}else a.selectEquipSlotId(e.slot)}},showWearView:function(){var e=this.info,t=game.fosterEquipData;t.changeFosterId=e.fosterId,t.changeFosterType=e.fosterType,t.changeSlot=e.slot,game.module.show(game.ME.FosterEquipWear)}});b8e.RC("$$game","$$NewFosterEquipIcon",e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({currActId:0,selWelfareData:null,init:function(){var e=this;e._super(),e.addEventByModule(game.ME.OpenServer,game.OpenServerEvts.C2C_INIT_OPENSERVER,e.setData),e.addListenerPb(game.protoId.ExchangeDropMsg,e.dropNumUpdate),e.addListenerPb(game.protoId.ExchangeTaskMsg,e.taskUpdateHandler),e.addListenerPb(game.protoId.ExchangeTaskResp,e.taskFinishHandler),e.addListenerPb(game.protoId.ExchangeResp,e.convertUpdateHandler),e.addListenerPb(game.protoId.ExchangeRedPointResp,e.convertRedpointHandler),e.addListenerPb(game.protoId.ExchangeDiscountResp,e.discountUpdateHandler),e.taskTabAlert=game.spotAlert.set(game.SAE.EXCHANGE_TASK,game.SAE.EXCHANGE),e.convertTabAlert=game.spotAlert.set(game.SAE.EXCHANGE_CONVERT,game.SAE.EXCHANGE)},initData:function(){this.welfareMaps=b8e.HashMap.get(),this.convertMaps=b8e.HashMap.get(),this.dropMaps=b8e.HashMap.get(),this.taskMaps=b8e.HashMap.get(),this.discountMaps=b8e.HashMap.get(),this.taskTabList=[],this.convertTabList=[],this.addOtherEvent()},addOtherEvent:function(){this.addEventByModule(game.ME.MainRole,game.MainRoleEvts.C_RESET_DAILY,this.dailyUpdate),this.addEventByModule(game.ME.Back,game.BackEvts.C_UPDATE_AMOUNT,this.updateBackCount),this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateBackCount),this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_SYN_BACK_INFO,this.updateBackCount)},setData:function(e){if(e&&e.data){var t=this;if(!t.isInitData){t.isInitData=!0;var a,i=e.data;if(t.initData(),t.currActId=i.exchangeId,t.currActId)t.initCfgData(),i.exGoods&&i.exGoods.forEach(function(e){(a=t.convertMaps.get(e.id))&&a.setData(e)},t),i.exDrop&&i.exDrop.forEach(function(e){(a=t.dropMaps.get(e.types))&&a.setData(e)},t),i.exTask&&i.exTask.forEach(function(e){t.updateProgress(e)},t),i.exRecharge&&i.exRecharge.forEach(function(e){(a=t.welfareMaps.get(e.id))&&a.setData(e)},t),i.exDiscount&&i.exDiscount.forEach(function(e){(a=t.discountMaps.get(e.id))&&a.setData(e)},t),t.initConvertRedChoose(i.exRedPoints),t.initTaskRecord(i.exTaskRecord),t.checkTaskAlert(),t.checkConvertAlert()}}},getCurProceedId:function(){if(!game.moduleOpen.checkOpen(game.ME.ExchangePanel))return null;for(var e=game.ExchangeOpenCfg.getDatas(),t=e.length,a=(game.miscData.openServerDay,0);a<t;a++){var i=e[a];if(this.checkOpen(i.id))return i.id}return null},checkOpen:function(e){var t=game.ExchangeOpenCfg.getData(e);if(!t)return!1;var a=game.SysTime.curTime;if(t.startTime){var i=b8e.TimeUtil.dateParse(t.startTime,"yyyy-MM-dd hh:mm:ss").getTime();i=1e3*(i/1e3>>0);var n=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd hh:mm:ss").getTime();if(n=1e3*(n/1e3>>0),a<i||n<=a)return!1;var s=game.TimeUtil.getOpenDayByStr(t.startTime);return s>=t.serverStart&&s<t.serverEnd}var r=game.miscData.openServerDay;return!(t.serverStart>r||r>=t.serverEnd)},getCountDown:function(){var e=game.ExchangeOpenCfg.getData(this.currActId);if(!e)return 0;var t=game.SysTime.curTime;return(e.endTime?b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime():b8e.TimeUtil.getTodayTime(game.SysTime.curTime)+(e.serverEnd-game.miscData.openServerDay)*b8e.TimeUtil.DAY_MICRO_SECONDS)-t},dailyUpdate:function(){var e=this,t=e.getCurProceedId();if(t){if(t!=e.currActId)return e.currActId=t,e.recycleMaps(e.welfareMaps),e.recycleMaps(e.convertMaps),e.recycleMaps(e.dropMaps),e.recycleMaps(e.taskMaps),e.recycleMaps(e.discountMaps),e.taskTabList.length=0,e.convertTabList.length=0,e.selWelfareData=null,e.taskTabDic=null,e.convertTabDic=null,void e.initCfgData();for(var a=e.welfareMaps.values(),i=a.length,n=0;n<i;n++){var s=a[n];1==s.resetType&&(s.buyNum=0)}i=(a=e.dropMaps.values()).length;for(var r=0;r<i;r++)a[r].dropNum=0;e.send(game.ExchangeEvts.C2C_DAILY_RESRT_OVER)}},recycleMaps:function(e){if(e){for(var t=e.values(),a=0,i=t.length;a<i;a++)t[a].release();e.clear()}},initCfgData:function(){for(var e=this,t=game.ExchangeCashCfg.getData(e.currActId,!0),a=void 0,i=void 0,n=t?t.length:0,s=0;s<n;s++)i=t[s],(a=e.welfareMaps.get(i.rechargeId))||(a=game.ExchangeWelfareInfo.get(),e.welfareMaps.set(i.rechargeId,a)),a.setCfg(i);n=(t=game.ExchangeGoodsCfg.getData(e.currActId,!0))?t.length:0;for(var r=0;r<n;r++)i=t[r],(a=e.convertMaps.get(i.id))||(a=game.ExchangeConvertInfo.get(),e.convertMaps.set(i.id,a)),a.setCfg(i),e.convertTabList.indexOf(a.tab)<0&&e.convertTabList.push(a.tab);n=(t=game.ExchangeDropCfg.getData(e.currActId,!0))?t.length:0;for(var o=0;o<n;o++)i=t[o],(a=e.dropMaps.get(i.dropType))||(a=game.ExchangeDropInfo.get(),e.dropMaps.set(i.dropType,a)),a.setCfg(i);n=(t=game.ExchangeTaskCfg.getData(e.currActId,!0))?t.length:0;for(var g=0;g<n;g++)i=t[g],(a=e.taskMaps.get(i.id))||(a=game.ExchangeTaskInfo.get(),e.taskMaps.set(i.id,a)),a.setCfg(i),e.taskTabList.indexOf(a.tab)<0&&e.taskTabList.push(a.tab);n=(t=game.ExchangeDiscountCfg.getData(e.currActId,!0))?t.length:0;for(var u=0;u<n;u++)i=t[u],(a=e.discountMaps.get(i.id))||(a=game.ExchangeDiscountInfo.get(),e.discountMaps.set(i.id,a)),a.setCfg(i)},updateBackCount:function(){this.send(game.ExchangeEvts.C2V_DROP_UPDATE);for(var e=this.convertMaps.values(),t=0,a=e.length;t<a;t++)e[t].index++;this.checkConvertAlert(),this.send(game.ExchangeEvts.C2V_CONVERT_UPDATE)},getWelfareList:function(){return this.welfareMaps.values().sort(this.welfareSort)},welfareSort:function(e,t){var a=e.buyNum<e.numLimit||!e.numLimit,i=t.buyNum<t.numLimit||!t.numLimit;return a&&!i?-1:!a&&i?1:e.numLimit&&!t.numLimit?-1:!e.numLimit&&t.numLimit?1:e.rechargeId-t.rechargeId},updateWelfareInfo:function(e){var t=this.welfareMaps.get(e);t&&t.buyNum++},getDropList:function(){return this.dropMaps.values().sort(this.dropSort)},dropSort:function(e,t){return e.dropType-t.dropType},dropNumUpdate:function(e){var t=e.readProtobuf(game.pb.ExchangeDropNotify);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.dropMaps.get(t.types);a&&a.setData(t),this.send(game.ExchangeEvts.C2V_DROP_UPDATE),this.checkConvertAlert(),this.send(game.ExchangeEvts.C2V_CONVERT_UPDATE)}},getTaskListByTab:function(e){var t=void 0;if(e){if(this.taskTabDic||(this.taskTabDic={}),!this.taskTabDic[e]){this.taskTabDic[e]=[];for(var a=this.taskMaps.values(),i=0,n=a.length;i<n;i++)a[i].tab==e&&this.taskTabDic[e].push(a[i])}t=this.taskTabDic[e]}else t=this.taskMaps.values();return t.sort(this.taskSort)},taskSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:e.progress>=e.taskParam&&t.progress<t.taskParam?-1:e.progress<e.taskParam&&t.progress>=t.taskParam?1:e.id-t.id},initTaskRecord:function(e){if(e)for(var t=this.taskMaps.values(),a=0,i=t.length;a<i;a++)t[a].isGet=0<=e.indexOf(t[a].id)},updateProgress:function(e){if(e)for(var t=this.taskMaps.values(),a=0,i=t.length;a<i;a++)t[a].taskType==e.types&&t[a].updatePro(e.progress)},taskUpdateHandler:function(e){var t=e.readProtobuf(game.pb.ExchangeTaskNotify);0<t.code?game.notice.noticeError(t.code):(this.updateProgress(t),this.checkTaskAlert(),this.send(game.ExchangeEvts.C2V_TASK_UPDATE))},taskFinishHandler:function(e){var t=e.readProtobuf(game.pb.ExchangeTaskResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.taskMaps.get(t.id);a&&(a.isGet=!0,game.awardsData.setItemsByArray(a.awards),game.module.show(game.ME.AwardShowTip)),this.checkTaskAlert(),this.send(game.ExchangeEvts.C2V_TASK_UPDATE)}},requestGetTaskAward:function(e){var t=game.pb.ExchangeTaskRequest;t.id=e.id,this.sendPb(game.protoId.ExchangeTaskReq,t)},tabChangeHandler:function(e){this.send(game.ExchangeEvts.C2C_TAB_CHANGED,e)},checkTaskAlert:function(){this.taskTabAlert.alert=this.taskAlert()},taskAlert:function(e){for(var t=0<arguments.length&&void 0!==e?e:null,a=this.getTaskListByTab(t),i=void 0,n=0,s=a.length;n<s;n++)if(!(i=a[n]).isGet&&i.progress>=i.taskParam)return!0;return!1},getConvertListByTab:function(e){var t=void 0;if(e){if(this.convertTabDic||(this.convertTabDic={}),!this.convertTabDic[e]){this.convertTabDic[e]=[];for(var a=this.convertMaps.values(),i=0,n=a.length;i<n;i++)a[i].tab==e&&this.convertTabDic[e].push(a[i])}t=this.convertTabDic[e]}else t=this.convertMaps.values();return t.sort(this.convertSort)},convertSort:function(e,t){var a=e.convertNum<e.numLimit||!e.numLimit,i=t.convertNum<t.numLimit||!t.numLimit;return a&&!i?-1:!a&&i?1:e.numLimit&&!t.numLimit?-1:!e.numLimit&&t.numLimit?1:e.id-t.id},convertUpdateHandler:function(e){var t=e.readProtobuf(game.pb.ExchangeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.convertMaps.get(t.id);a&&(a.convertNum++,game.awardsData.setItemsByArray(a.awards),game.module.show(game.ME.AwardShowTip)),this.checkConvertAlert(),this.send(game.ExchangeEvts.C2V_CONVERT_UPDATE)}},requestConvertAward:function(e){var t=game.pb.ExchangeRequest;t.id=e.id,this.sendPb(game.protoId.ExchangeReq,t)},initConvertRedChoose:function(e){if(e)for(var t=this.convertMaps.values(),a=0,i=t.length;a<i;a++)t[a].isChoose=0<=e.indexOf(t[a].id)},convertRedPoint:function(e,t){var a=game.pb.ExchangeRedPointRequest;a.id=e,a.op=t,this.sendPb(game.protoId.ExchangeRedPointReq,a)},convertRedpointHandler:function(e){var t=e.readProtobuf(game.pb.ExchangeRedPointResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.convertMaps.get(t.id);a&&(a.isChoose=1==t.op),this.checkConvertAlert(),this.send(game.ExchangeEvts.C2V_CONVERT_UPDATE)}},checkConvertAlert:function(){this.convertTabAlert.alert=this.convertAlert()},convertAlert:function(e){for(var t=0<arguments.length&&void 0!==e?e:null,a=this.getConvertListByTab(t),i=void 0,n=0,s=a.length;n<s;n++)if((i=a[n]).isChoose&&!(i.numLimit&&i.convertNum>=i.numLimit)&&game.UpgradeUtil.checkItemList(i.costItems,1,!1))return!0;return!1},getDiscountList:function(){return this.discountMaps.values().sort(this.discountSort)},discountSort:function(e,t){var a=e.buyNum<e.numLimit||!e.numLimit,i=t.buyNum<t.numLimit||!t.numLimit;return a&&!i?-1:!a&&i?1:e.numLimit&&!t.numLimit?-1:!e.numLimit&&t.numLimit?1:e.id-t.id},discountUpdateHandler:function(e){var t=e.readProtobuf(game.pb.ExchangeDiscountResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.discountMaps.get(t.id);a&&(a.buyNum++,game.awardsData.setItemsByArray(a.awards),game.module.show(game.ME.AwardShowTip)),this.send(game.ExchangeEvts.C2V_DISCOUNT_UPDATE)}},requestDiscountBuy:function(e){var t=game.pb.ExchangeDiscountRequest;t.id=e,this.sendPb(game.protoId.ExchangeDiscountReq,t)}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$ExchangeActiveMgr",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super("exchange/ExchangePanelView"),this.spotAlerts={EXCHANGE_TASK:this.taskRedPoint,EXCHANGE_CONVERT:this.convertRedPoint}},init:function(){this.data=game.ExchangeActiveMgr.inst(),this.toggles={selected_1:game.ME.ExchangeWelfare,selected_2:game.ME.ExchangeDrop,selected_3:game.ME.ExchangeTask,selected_4:game.ME.ExchangeConvert,selected_5:game.ME.ExchangeDiscount},this.amountIconList=[],this.bgList=[]},taskRedPoint:function(e){this.skin.red_spot_3.active=e.alert},convertRedPoint:function(e){this.skin.red_spot_4.active=e.alert},addEventListener:function(){this.data.addEvent(game.ExchangeEvts.C2V_DROP_UPDATE,this.updateBottomNode,this),this.data.addEvent(game.ExchangeEvts.C2C_DAILY_RESRT_OVER,this.updateActiveData,this)},removeEventListener:function(){this.data.removeEvent(game.ExchangeEvts.C2V_DROP_UPDATE,this.updateBottomNode,this),this.data.removeEvent(game.ExchangeEvts.C2C_DAILY_RESRT_OVER,this.updateActiveData,this)},onShow:function(){this.data.currActId&&(this.toggleSelect(0),this.addEventListener(),this.updateActiveData())},onHide:function(){this.removeEventListener(),this.leftTimer&&(b8e.Timer.remove(this,this.updateTime),this.leftTimer=null)},updateTime:function(){var e=this.data.getCountDown();if(e<=0)return this.skin.timeLab.string="",void game.module.hide(game.ME.ExchangePanel);var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.timeLab.string=0<e?game.Lang.get(53451,t):""},updateActiveData:function(){var e=this;e.data.currActId&&(e.actCfg=game.ExchangeOpenCfg.getData(e.data.currActId),e.updateBanner(),e.updateBottomNode(),0<e.data.getCountDown()?(e.leftTimer=b8e.Timer.add(e,e.updateTime,1e3),e.updateTime()):(e.skin.timeLab.string="",e.leftTimer=null))},updateBanner:function(){var e=game.ResCfg.getUrl(10207,this.actCfg.banner);this.skin.bannerImg.loadTexture(e),e=game.ResCfg.getUrl(10206,this.actCfg.title),this.skin.title.loadTexture(e)},updateBottomNode:function(){var e=this,t=e.actCfg;if(t&&t.showAmount&&!(t.showAmount.length<1)){var a=void 0,i=e.amountIconList.length,n=t.showAmount,s=n.length;if(0<i)for(a=i-1;s<=a;a--)e.amountIconList[a].active=!1,e.bgList[a].active=!1;var r=void 0,o=void 0,g=void 0,u=0,l=void 0;for(a=0;a<s;a++)o=n[a],r=game.CCommonUtil.replaceNum(game.itemData.getCountById(o),1),g=e.amountIconList[a],(l=e.bgList[a])||(l=e.bgList[a]=game.shopData.getAmountBg()).addToParent(e.skin.amountIcon),g||(g=e.amountIconList[a]=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42)).addToParent(e.skin.amountIcon),l.active=!0,l.x=u,g.active=!0,g.setItemInfo(o,r,game.Color.BLACK,20,!1,!1),g.x=u+10,u+=(l.width?l.width:160)+40}},btn_1:function(){this.toggleSelect(0)},btn_2:function(){this.toggleSelect(1)},btn_3:function(){this.toggleSelect(2)},btn_4:function(){this.toggleSelect(3)},btn_5:function(){this.toggleSelect(4)}});b8e.app.registerView(game.ME.ExchangePanel,e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super("exchange/ExchangeListView1")},init:function(){var e=this;e.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.awardList.itemRender=game.ExchangeWelfareItem,e.awardList.layout.paddingTop=0,e.awardList.bindEnum=game.ME.ExchangeWelfare,e.awardList.addToParent(e.skin.list),e.tipsLab=b8e.Label.get(),e.tipsLab.setFontSize(22),e.tipsLab.setLineHeight(22),e.tipsLab.setAnchor(.5,.5),e.tipsLab.setColor(game.Color.BLACK),e.tipsLab.setPosition(332,-1042),e.tipsLab.setText(game.Lang.get(53458)),e.addChild(e.tipsLab),e.data=game.ExchangeActiveMgr.inst()},addEventListener:function(){this.addEventByModule(game.ME.Recharge,game.RechargeEvts.C_RECHARGE_SUCCESS,this.rechargeSuccess)},removeEventListener:function(){this.removeEventByModule(game.ME.Recharge,game.RechargeEvts.C_RECHARGE_SUCCESS,this.rechargeSuccess)},onShow:function(){this.addEventListener(),this.updateList()},updateList:function(){var e=this.data.getWelfareList();this.awardList.setData(e)},rechargeSuccess:function(e){if(e&&e.data&&this.data.selWelfareData){var t=e.data.id;t==this.data.selWelfareData.rechargeId&&(this.data.updateWelfareInfo(t),this.updateList())}},onHide:function(){this.removeEventListener()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.ExchangeWelfare,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("exchange/ExchangeWelfareItem"),this.setSize(600,156)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.PrizeListItem,this.awardList.layout.spacingX=20,this.awardList.addToParent(this.skin.list)},setData:function(e){var t=this;t.data=e;var a=t.skin;if(t.data.awards&&(t.data.prizeInfo||(t.data.prizeInfo=game.CfgUtil.getPrizeListInfo(t.data.awards,null,game.IconSizeEnum.GRID_SIZE_105)),t.awardList.setData(t.data.prizeInfo.items)),a.dailyImg.active=1==t.data.resetType,0<t.data.numLimit){var i=t.data.buyNum>=t.data.numLimit;a.buyBtn.active=!i,a.seal_red.active=i,a.buyNum.string=i?"":game.Lang.get(53426,game.HtmlUtil.getText(game.Color.GREEN,t.data.buyNum),t.data.numLimit)}else a.buyBtn.active=!0,a.seal_red.active=!1,a.buyNum.string=game.Lang.get(53425);var n=game.RechargeCfg.getDataById(t.data.rechargeId);a.lab_buy.string=game.Lang.get(1701,n.money)},buyBtn:function(){game.ExchangeActiveMgr.inst().selWelfareData=this.data,b8e.evt.dptG(game.ExchangeEvts.C2C_WELFARE_BUY,this.data.rechargeId)}}),b8e.RC("$$game","$$ExchangeWelfareItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super("exchange/ExchangeListView2")},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.ExchangeDropItem,this.awardList.layout.paddingTop=0,this.awardList.bindEnum=game.ME.ExchangeDrop,this.awardList.addToParent(this.skin.list),this.data=game.ExchangeActiveMgr.inst()},addEventListener:function(){this.data.addEvent(game.ExchangeEvts.C2V_DROP_UPDATE,this.updateList,this)},removeEventListener:function(){this.data.removeEvent(game.ExchangeEvts.C2V_DROP_UPDATE,this.updateList,this)},onShow:function(){this.addEventListener(),this.updateList()},updateList:function(){var e=this.data.getDropList();this.awardList.setData(e)},onHide:function(){this.removeEventListener()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.ExchangeDrop,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("exchange/ExchangeDropItem"),this.setSize(600,140)},setData:function(e){var t=this;t.data=e;var a=t.skin,i=game.ResCfg.getUrl(10206,"drop_type"+t.data.dropType);a.descIcon.loadTexture(i),a.dropName.string=t.data.dropName,a.title_bg19.width=t.skin.dropName.width+50,t.data.amountIcon||(t.data.amountIcon=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42));var n=t.data.dropNum>=t.data.numLimit,s=game.HtmlUtil.getText(n?game.Color.RED:game.Color.GREEN,t.data.dropNum)+"/"+t.data.numLimit,r=t.data.amountIcon;r.addToParent(a.amountIcon),r.setItemInfo(t.data.itemId,s,game.Color.BLACK,22,!1,!1)},goBtn:function(){var e=this.data.moduleId;!e||e<1||(0<this.data.toggle?game.module.showToggle(e,this.data.toggle):game.module.show(e))}}),b8e.RC("$$game","$$ExchangeDropItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super("exchange/ExchangeListView3")},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.ExchangeTaskItem,this.awardList.layout.paddingTop=0,this.awardList.bindEnum=game.ME.ExchangeTask,this.awardList.addToParent(this.skin.list),this.data=game.ExchangeActiveMgr.inst(),this.tabList=[]},addEventListener:function(){this.data.addEvent(game.ExchangeEvts.C2V_TASK_UPDATE,this.taskUpdateHandler,this),this.data.addEvent(game.ExchangeEvts.C2C_TAB_CHANGED,this.tabTouchHandler,this)},removeEventListener:function(){this.data.removeEvent(game.ExchangeEvts.C2V_TASK_UPDATE,this.taskUpdateHandler,this),this.data.removeEvent(game.ExchangeEvts.C2C_TAB_CHANGED,this.tabTouchHandler,this)},onShow:function(){this.addEventListener(),this.creatTabButtom()},creatTabButtom:function(){var e=this.data.taskTabList;if(!(e.length<1)){for(var t=e.length,a=this.tabList.length,i=Math.max(t,a),n=void 0,s=0;s<i;s++)n=this.tabList[s],t<=s?n.active=!1:(n||(n=new game.ExchangeTaskTabBtn(game.ME.ExchangeTask),this.tabList.push(n),n.addToParent(this.skin.tabNode)),n.x=118*s,n.active=!0,n.setTab(e[s]));this.updateTabRedPoint(),this.tabChangedHandler(this.data.taskTabList[0])}},tabTouchHandler:function(e){if(e){this.tabChangedHandler(e.data)}},tabChangedHandler:function(e){this.currTab=e;for(var t=this.data.taskTabList.length,a=0;a<t;a++){var i=this.tabList[a];if(!i)return;i.setSelect(this.currTab==i.tab)}this.updateList()},taskUpdateHandler:function(){this.updateTabRedPoint(),this.updateList()},updateTabRedPoint:function(){for(var e=this.data.taskTabList.length,t=void 0,a=0;a<e;a++){var i=this.tabList[a];if(!i)return;t=this.data.taskAlert(i.tab),i.updateRedPoint(t)}},updateList:function(){var e=this.data.getTaskListByTab(this.currTab);this.awardList.setData(e)},onHide:function(){this.removeEventListener()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.ExchangeTask,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("exchange/ExchangeTaskItem"),this.setSize(600,174)},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.awardList.itemRender=game.PrizeListItem,this.awardList.layout.spacingX=20,this.awardList.addToParent(this.skin.list)},setData:function(e){var t=this;t.data=e;var a=t.skin;t.data.awards&&(t.data.prizeInfo||(t.data.prizeInfo=game.CfgUtil.getPrizeListInfo(t.data.awards,null,game.IconSizeEnum.GRID_SIZE_105)),t.awardList.setData(t.data.prizeInfo.items));var i=t.data.isGet,n=t.data.progress>=t.data.taskParam;a.grayBtn.active=i,a.getBtn.active=!i&&n,a.goBtn.active=!i&&!n,a.proLab.string=game.Lang.get(902,game.HtmlUtil.getText(n?game.Color.GREEN:game.Color.RED,t.data.progress),t.data.taskParam),a.titleLab.string=game.Lang.get(t.data.titleKey,t.data.taskParam)},getBtn:function(){game.ExchangeActiveMgr.inst().requestGetTaskAward(this.data)},goBtn:function(){var e=this.data.moduleId;!e||e<1||(0<this.data.toggle?game.module.showToggle(e,this.data.toggle):game.module.show(e))}}),b8e.RC("$$game","$$ExchangeTaskItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super("exchange/ExchangeListView3")},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.ExchangeConvertItem,this.awardList.layout.paddingTop=0,this.awardList.bindEnum=game.ME.ExchangeConvert,this.awardList.addToParent(this.skin.list),this.data=game.ExchangeActiveMgr.inst(),this.tabList=[]},addEventListener:function(){this.data.addEvent(game.ExchangeEvts.C2V_CONVERT_UPDATE,this.convertUpdateHandler,this),this.data.addEvent(game.ExchangeEvts.C2C_TAB_CHANGED,this.tabTouchHandler,this)},removeEventListener:function(){this.data.removeEvent(game.ExchangeEvts.C2V_CONVERT_UPDATE,this.convertUpdateHandler,this),this.data.removeEvent(game.ExchangeEvts.C2C_TAB_CHANGED,this.tabTouchHandler,this)},onShow:function(){this.addEventListener(),this.creatTabButtom()},creatTabButtom:function(){var e=this.data.convertTabList;if(!(e.length<1)){for(var t=e.length,a=this.tabList.length,i=Math.max(t,a),n=void 0,s=0;s<i;s++)n=this.tabList[s],t<=s?n.active=!1:(n||(n=new game.ExchangeTaskTabBtn,this.tabList.push(n),n.addToParent(this.skin.tabNode)),n.x=118*s,n.active=!0,n.setTab(e[s]));this.updateTabRedPoint(),this.tabChangedHandler(this.data.convertTabList[0])}},tabTouchHandler:function(e){if(e){this.tabChangedHandler(e.data)}},tabChangedHandler:function(e){this.currTab=e;for(var t=this.data.convertTabList.length,a=0;a<t;a++){var i=this.tabList[a];if(!i)return;i.setSelect(this.currTab==i.tab)}this.updateList()},convertUpdateHandler:function(){this.updateTabRedPoint(),this.updateList()},updateTabRedPoint:function(){for(var e=this.data.convertTabList.length,t=void 0,a=0;a<e;a++){var i=this.tabList[a];if(!i)return;t=this.data.convertAlert(i.tab),i.updateRedPoint(t)}},updateList:function(){var e=this.data.getConvertListByTab(this.currTab);this.awardList.setData(e)},onHide:function(){this.removeEventListener()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.ExchangeConvert,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("exchange/ExchangeConvertItem"),this.setSize(600,174)},init:function(){this.itemIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),this.itemIcon.addToParent(this.skin.itemIcon)},setData:function(e){var t=this;t.data=e;var a=t.skin;if(t.data.awards&&0<t.data.awards.length){var i=t.data.awards[0].Id,n=t.data.awards[0].Num;t.data.itemInfo||(t.data.itemInfo=game.ItemUtil.createBaseItemInfo(i,n)),game.GridUtil.setItemIcon(t.itemIcon,t.data.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM)}if(t.data.costItems&&0<t.data.costItems.length){var s=t.data.costItems[0].Id,r=t.data.costItems[0].Num,o=game.itemData.getCountById(s),g=r<=o;t.data.costIcon1||(t.data.costIcon1=game.ItemUtil.createBaseItemInfo(s,r)),t.costIcon1||(t.costIcon1=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),t.costIcon1.addToParent(a.costIcon1)),game.GridUtil.setItemIcon(t.costIcon1,t.data.costIcon1,!1,game.IconLayoutEnum.SHOW_NONE),a.costIcon1.active=!0;var u=game.HtmlUtil.getText(g?game.Color.GREEN:game.Color.RED,o)+"/"+r;a.costLab1.string=game.HtmlUtil.getText(game.Color.BLACK,u)}else a.costIcon1.active=!1,a.costLab1.string="";if(t.data.costItems&&1<t.data.costItems.length){var l=t.data.costItems[1].Id,c=t.data.costItems[1].Num,h=game.itemData.getCountById(l),m=c<=h;t.data.costIcon2||(t.data.costIcon2=game.ItemUtil.createBaseItemInfo(l,c)),t.costIcon2||(t.costIcon2=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_84),t.costIcon2.addToParent(a.costIcon2)),game.GridUtil.setItemIcon(t.costIcon2,t.data.costIcon2,!1,game.IconLayoutEnum.SHOW_NONE),a.costIcon2.active=!0,a.gridbg2.active=!0;var d=game.HtmlUtil.getText(m?game.Color.GREEN:game.Color.RED,h)+"/"+c;a.costLab2.string=game.HtmlUtil.getText(game.Color.BLACK,d)}else a.costIcon2.active=!1,a.gridbg2.active=!1,a.costLab2.string="";if(0<t.data.numLimit){var f=t.data.convertNum>=t.data.numLimit;a.convertBtn.active=!f,a.grayBtn.active=f;var p=t.data.numLimit-t.data.convertNum;a.countLab.string=game.Lang.get(53433,game.HtmlUtil.getText(f?game.Color.RED:game.Color.GREEN,p),t.data.numLimit)}else a.convertBtn.active=!0,a.grayBtn.active=!1,a.countLab.string=game.Lang.get(53425);a.check.active=t.data.isChoose},checkBtn:function(){var e=this.data.isChoose?2:1;game.ExchangeActiveMgr.inst().convertRedPoint(this.data.id,e)},convertBtn:function(){game.UpgradeUtil.checkItemList(this.data.costItems,1,!1)?game.ExchangeActiveMgr.inst().requestConvertAward(this.data):game.notice.show(53438)}}),b8e.RC("$$game","$$ExchangeConvertItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super("exchange/ExchangeListView1")},init:function(){this.awardList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.awardList.itemRender=game.ExchangeDiscountItem,this.awardList.layout.paddingTop=0,this.awardList.bindEnum=game.ME.ExchangeDiscount,this.awardList.addToParent(this.skin.list),this.data=game.ExchangeActiveMgr.inst()},addEventListener:function(){this.data.addEvent(game.ExchangeEvts.C2V_DISCOUNT_UPDATE,this.updateList,this)},removeEventListener:function(){this.data.removeEvent(game.ExchangeEvts.C2V_DISCOUNT_UPDATE,this.updateList,this)},onShow:function(){this.addEventListener(),this.updateList()},updateList:function(){var e=this.data.getDiscountList();this.awardList.setData(e)},onHide:function(){this.removeEventListener()},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.ExchangeDiscount,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("exchange/ExchangeDiscountItem"),this.setSize(602,156)},init:function(){this.itemIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this.itemIcon.addToParent(this.skin.itemIcon)},setData:function(e){var t=this;t.data=e;var a=t.skin;if(t.data.awards&&!(t.data.awards.length<1)){var i=t.data.awards[0].Id,n=t.data.awards[0].Num;t.data.itemInfo||(t.data.itemInfo=game.ItemUtil.createBaseItemInfo(i,n)),game.GridUtil.setItemIcon(t.itemIcon,t.data.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM);var s=game.ItemInfoCfg.getData(i);if(a.itemName.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name),a.title_bg19.width=a.itemName.width+50,t.setAmount(t.data.costItems),0<t.data.numLimit){var r=t.data.buyNum>=t.data.numLimit;a.buyBtn.active=!r,a.seal_red.active=r,a.countLab.string=r?"":game.Lang.get(53439,game.HtmlUtil.getText(game.Color.GREEN,t.data.buyNum),t.data.numLimit)}else a.buyBtn.active=t.isReach,a.grayBtn.active=!t.isReach,a.seal_red.active=!1,a.countLab.string=game.Lang.get(53425);if(0<t.data.discount){var o=game.ResCfg.getUrl(105,t.data.discount);a.discountLab.loadTexture(o),a.discountLab.active=!0,a.hotLab.active=!1}else a.discountLab.active=!1,a.hotLab.active=!0}},setAmount:function(e){var t=this;if(t.isReach=!1,e&&!(e.length<1)){t.isReach=!0,t.data.amountIconList||(t.data.amountIconList=[]);var a=void 0,i=t.data.amountIconList.length,n=e.length;if(0<i)for(a=i-1;n<=a;a--)t.data.amountIconList[a].active=!1;var s=void 0,r=void 0,o=void 0,g=0;for(a=0;a<n;a++){r=e[a],s=game.CCommonUtil.replaceNum(r.Num,1),(o=t.data.amountIconList[a])||(o=t.data.amountIconList[a]=new game.AmountIcon(game.IconSizeEnum.GRID_SIZE_42)).addToParent(t.skin.amountIcon),o.active=!0,o.setItemInfo(r.Id,s,game.Color.BLACK,22,!1,!1),o.y=g,o.x=20,g=o.y-30;var u=game.itemData.getCountById(r.Id)>=r.Num;t.isReach&&(t.isReach=u)}t.skin.amountIcon.y=1<n?-90:-104}},buyBtn:function(){game.ExchangeActiveMgr.inst().requestDiscountBuy(this.data.id)}}),b8e.RC("$$game","$$ExchangeDiscountItem",e)}(),function(){var e;e=game.Widget.extends({tab:0,select:!1,isShowRed:!1,ctor:function(){this._super("exchange/ExchangeTaskTabBtn")},onShow:function(){this.setSelect(this.select),this.setTab(this.tab),this.updateRedPoint(this.isShowRed)},setTab:function(e){if(this.tab=e,this.skin){var t=game.ExchangeTabCfg.getData(this.tab);t&&(this.skin.titleLab.string=t.name)}},setSelect:function(e){this.select=e,this.skin&&(this.skin.toggle.active=this.select)},updateRedPoint:function(e){this.isShowRed=e,this.skin&&(this.skin.red_point.active=this.isShowRed)},touchBtn:function(){this.select||game.ExchangeActiveMgr.inst().tabChangeHandler(this.tab)}}),b8e.RC("$$game","$$ExchangeTaskTabBtn",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({activityId:0,id:0,awards:null,costItems:null,numLimit:0,convertNum:0,tab:0,itemInfo:null,costInfo1:null,costInfo2:null,index:0,isChoose:!1,setCfg:function(e){this.id=e.id,this.activityId=e.activityId,this.awards=e.awards,this.costItems=e.costItems,this.numLimit=e.numLimit,this.tab=e.tab},setData:function(e){this.convertNum=e.num},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.id=0,e.activityId=0,e.awards=null,e.costItems=null,e.numLimit=0,e.convertNum=0,e.tab=0,e.costInfo2=null,e.index=0,e.isChoose=!1,e.releaseInfo(e.itemInfo),e.releaseInfo(e.costInfo1),e.releaseInfo(e.costInfo2)},releaseInfo:function(e){e&&e.release(),e=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExchangeConvertInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,activityId:0,awards:null,costItems:null,numLimit:0,buyNum:0,itemInfo:null,discount:0,setCfg:function(e){this.id=e.id,this.activityId=e.activityId,this.awards=e.awards,this.costItems=e.costItems,this.numLimit=e.numLimit,this.discount=e.discount},setData:function(e){this.buyNum=e.num},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.id=0,e.activityId=0,e.awards=null,e.costItems=null,e.numLimit=0,e.buyNum=0,e.itemInfo&&e.itemInfo.release(),e.itemInfo=null,e.discount=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExchangeDiscountInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({activityId:0,dropType:0,itemId:0,numLimit:0,dropName:null,moduleId:0,toggle:0,dropNum:0,setCfg:function(e){this.activityId=e.activityId,this.dropType=e.dropType,this.itemId=e.itemId,this.numLimit=e.numLimit,this.moduleId=e.moduleId,this.toggle=e.toggle,this.dropName=e.dropName},setData:function(e){this.dropNum=e.num},recycle:function(){this.reset(),this._super()},reset:function(){this.dropType=0,this.activityId=0,this.itemId=0,this.numLimit=0,this.moduleId=0,this.toggle=0,this.dropNum=0,this.dropName=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExchangeDropInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,activityId:0,taskType:0,taskParam:0,awards:0,progress:0,tab:0,titleKey:0,index:0,isGet:!1,moduleId:0,toggle:0,setCfg:function(e){this.id=e.id,this.activityId=e.activityId,this.taskType=e.taskType,this.taskParam=e.taskParam,this.awards=e.awards,this.tab=e.tab,this.titleKey=e.titleKey,this.moduleId=e.moduleId,this.toggle=e.toggle},updatePro:function(e){this.progress=e},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.id=0,e.activityId=0,e.taskType=0,e.taskParam=0,e.awards=0,e.progress=0,e.tab=0,e.titleKey=0,e.index=0,e.isGet=!1,e.moduleId=0,e.toggle=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExchangeTaskInfo",t)}(),function(){var t=void 0;t=b8e.PoolObject.extends({activityId:0,rechargeId:0,numLimit:0,resetType:0,awards:null,buyNum:0,setCfg:function(e){this.activityId=e.activityId,this.rechargeId=e.rechargeId,this.numLimit=e.numLimit,this.resetType=e.resetType,this.awards=e.awards},setData:function(e){this.buyNum=e.num},recycle:function(){this.reset(),this._super()},reset:function(){this.activityId=0,this.rechargeId=0,this.numLimit=0,this.resetType=0,this.awards=null,this.buyNum=0}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ExchangeWelfareInfo",t)}(),function(){var e;e=b8e.Enum({None:0,C2C_WELFARE_BUY:b8e.enc(),C2C_RECHARGE:-1,C2C_DAILY_RESRT_OVER:-1,C2V_DROP_UPDATE:-1,C2V_TASK_UPDATE:-1,C2V_CONVERT_UPDATE:-1,C2V_DISCOUNT_UPDATE:-1,C2C_TAB_CHANGED:-1}),b8e.RC("$$game","$$ExchangeEvts",e)}(),function(){var e;e=b8e.Enum({NONE:-1,C2V_UPDATE_VIEW:-1,C2V_UPDATE_STAR:-1,C2C_UPDATE_JULING:-1}),b8e.RC("$$game","$$JuLingEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.juLingData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo}},this.handels={FosterSpiritResp:this.fosterSpiritResp,FosterSpiritOneKeyResp:this.fosterSpiritOneKeyResp}},triggerOpen:function(e){e==this.moduleEnum&&this.moduleData.initData()},updateItemInfo:function(){if(b8e.module.isShowView(this.moduleEnum)){var e=game.juLingData.getInfoById(this.moduleData.curId);e&&this.send(this.Evts.C2V_UPDATE_VIEW,e)}},fosterSpiritResp:function(e){var t=e.readProtobuf(game.pb.FosterSpiritResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.isAnim=!0,game.juLingData.upSpiritFoster(t.id,t.lv);var a=game.juLingData.getInfoById(t.id);if(a){game.FightAmount.inst().showTeamStatPower();var i=this.moduleData.getJuLingCurLvCfg(a.id,a.spiritLv);i&&(i.attach&&this.showJulingUnlockTips(),this.send(this.Evts.C2V_UPDATE_STAR,a),this.dpt(this.Evts.C2C_UPDATE_JULING))}}},fosterSpiritOneKeyResp:function(e){var t=e.readProtobuf(game.pb.FosterSpiritOneKeyResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.isAnim=!0,game.juLingData.upSpiritFoster(t.id,t.lv);var a=game.juLingData.getInfoById(t.id);if(a){game.FightAmount.inst().showTeamStatPower();var i=this.moduleData.getJuLingCurLvCfg(a.id,a.spiritLv);i&&(i.attach&&this.showJulingUnlockTips(),game.module.hide(game.ME.JuLingFast),this.send(this.Evts.C2V_UPDATE_STAR,a),this.dpt(this.Evts.C2C_UPDATE_JULING))}}},showJulingUnlockTips:function(){game.module.show(game.ME.JuLingUnlockTips)},btnFast:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);if(e)if(e.active){var t=this.moduleData.getJuLingCurLvCfg(e.id,e.spiritLv);if(t){var a=t.cost[0];game.itemData.getCountById(a.Id)<a.Num?game.notice.show(113):game.module.show(game.ME.JuLingFast)}}else game.notice.show(53545,e.name)},btnJuling:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);if(e)if(e.active){var t=this.moduleData.getJuLingCurLvCfg(e.id,e.spiritLv);if(t){var a=t.cost[0];if(game.itemData.getCountById(a.Id)<a.Num)game.notice.show(113);else{var i=game.fosterData.curFosterType;this.sender.FosterSpiritReq(i,e.id)}}}else game.notice.show(53545,e.name)},btnFind:function(){game.module.show(game.ME.JuLingPreview)},btnQuick:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);if(e)if(e.active){var t=this.moduleData.getJuLingCurLvCfg(e.id,e.spiritLv);if(t){var a=t.cost[0];if(game.itemData.getCountById(a.Id)<a.Num)game.notice.show(113);else{var i=game.fosterData.curFosterType;this.sender.FosterSpiritOneKeyReq(i,e.id)}}}else game.notice.show(53545,e.name)},btn_cancel:function(){game.module.hide(game.ME.JuLingFast)},left_btn:function(){this.moduleData.curId--;var e=this.moduleData.getInfoById(this.moduleData.curId);e&&(this.moduleData.isAnim=!1,this.send(this.Evts.C2V_UPDATE_VIEW,e))},right_btn:function(){this.moduleData.curId++;var e=this.moduleData.getInfoById(this.moduleData.curId);e&&(this.moduleData.isAnim=!1,this.send(this.Evts.C2V_UPDATE_VIEW,e))}}),t=[game.ME.JuLingPreview,game.ME.JuLingUnlockTips,game.ME.JuLingFast],a=game.Sender.extends({ipc:function(){this.msg={FosterSpiritReq:this.fosterSpiritReq,FosterSpiritOneKeyReq:this.fosterSpiritOneKeyReq}},fosterSpiritReq:function(e,t){var a=game.pb.FosterSpiritRequest;a.fosterType=e,a.id=t,this.write(a)},fosterSpiritOneKeyReq:function(e,t){var a=game.pb.FosterSpiritOneKeyRequest;a.fosterType=e,a.id=t,this.write(a)}});b8e.module.registerControl(game.ME.JuLing,e,game.JuLingEvts,a,t)}(),function(){var e=b8e.Object.extends({leftAlert:!1,rightAlert:!1,curId:0,attrPreview:null,maxLv:0,isAnim:!1,ctor:function(){this.attreMap=b8e.HashMap.get()},initData:function(){var e=game.HaloMiscCfg.getData("maxLv");e&&(this.maxLv=e.value)},getCurInfo:function(){return game.fosterData.getCurFosterInfo()},upSpiritFoster:function(e,t){var a=game.fosterData,i=a.getFosterInfo(a.curFosterType,e);i&&i.setSpirit(t)},getInfoById:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e);return a||null},leftActive:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e.id-1);return!!a&&(this.leftAlert=a.spiritAlert,!0)},rightActive:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e.id+1);return!!a&&(this.rightAlert=a.spiritAlert,!0)},getJuLingCfg:function(e){switch(game.fosterData.curFosterType){case game.NewFosterType.HALO:return e?game.HaloSpiritPreviewCfg:game.HaloSpiritCfg;default:return null}},getJuLingByIdCfgs:function(e,t){var a=1<arguments.length&&void 0!==t&&t,i=this.getJuLingCfg(a);return i?(this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.id=e,i.getData(this.cfgObj,!0)):null},getJuLingCurLvCfg:function(e,t,a){var i=2<arguments.length&&void 0!==a&&a,n=this.getJuLingCfg(i);return n?(this.cfgObj1||(this.cfgObj1=b8e.createMap()),this.cfgObj1.id=e,this.cfgObj1.lv=t,n.getData(this.cfgObj1)):null},getPreviewAttr:function(e){var t=this.attreMap.get(e);if(t)return t;var a=this.getJuLingByIdCfgs(e,!0);if(!a)return null;t=[];for(var i=a.length,n=0;n<i;n++){var s=a[n],r=new game.JuLingAttrInfo;r.setData(s),t.push(r)}return t.sort(this._sotr),this.attreMap.set(e,t),t},getAttrInfo:function(e){var t=this.getPreviewAttr(e.id);if(!t)return null;for(var a=t.length,i=0;i<a;i++){var n=t[i];if(n.lv==this.maxLv)return n;if(e.spiritLv<n.lv)return n}return null},_sort:function(e,t){return e.lv-t.lv}});game.juLingData=game.juLingData||new e}(),function(){var e;e=b8e.Object.extends({id:0,lv:0,attrId:0,attrVal:0,name:"",attrName:"",setData:function(e){this.id=e.id,this.lv=e.lv,this.attrId=e.attrId;var t=game.AttrRulesCfg.getData(this.attrId);t&&(2==t.format?this.attrVal=e.attrVal/1e3*100+"%":this.attrVal=game.CCommonUtil.replaceNum(e.attrVal),this.name=e.name,this.attrName=t.name)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$JuLingAttrInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1665),this.setSize(383,26)},setData:function(e){var t=game.juLingData.getInfoById(game.juLingData.curId);t&&(this.skin.attr_str.string=game.Lang.get(509,e.attrName,e.attrVal),this.skin.unlock_lv.string=t.spiritLv>=e.lv?game.Lang.get(1340):game.Lang.get(53541,e.lv))}}),b8e.RC("$$game","$$JuLingAttrItem",e)}(),function(){var e=game.View.extends({_showModel:!0,costMap:null,juLingMax:0,ctor:function(){this._super(1667)},init:function(){var e=this;e.item=new game.CultivateBaseIcon,e.item.addToParent(e.skin.item),e.costIcon1=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),e.costIcon1.addToParent(e.skin.icon1),e.costIcon2=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),e.costIcon2.addToParent(e.skin.icon2),e.moduleData=game.juLingData,e.costMap=b8e.HashMap.get()},onShow:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);e&&(this.skin.name.string=game.HtmlUtil.getColorStrByQuality(e.cfg.quality,e.name),this.skin.lv.string=game.Lang.get(53540,e.spiritLv),this.setConsume(e),this.item.setData(e))},setConsume:function(e){var t=this,a=t.moduleData.getJuLingByIdCfgs(e.id);if(a){t.costMap.clear();var i=void 0,n=game.HaloMiscCfg.getData("juLingCost");if(n&&!(n.costs.length<2)){var s=n.costs[0],r=n.costs[1];t.costIcon1.setItemId(s),t.costIcon2.setItemId(r);for(var o=game.itemData.getCountById(s),g=game.itemData.getCountById(r),u=0,l=a.length,c=0;c<l;c++){var h=a[c];if(!(h.lv<e.spiritLv)){if(h.lv==t.moduleData.maxLv){u=h.lv;break}var m=h.cost[0];if((i=t.costMap.get(m.Id))?i+=m.Num:i=m.Num,m.Id==s&&o<=i){u=h.lv;break}if(m.Id==r&&g<=i){u=h.lv;break}t.costMap.set(m.Id,i)}}t.skin.maxLv.string=game.Lang.get(53546,u);var d=t.costMap.get(s)?t.costMap.get(s):0;t.skin.count1.string=game.Lang.get(53547,d,o);var f=t.costMap.get(r)?t.costMap.get(r):0;t.skin.count2.string=game.Lang.get(53547,f,g)}}}});b8e.module.registerView(game.ME.JuLingFast,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1666)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.JuLingAttrItem,e.bindEnum=game.ME.JuLing,e.addToParent(this.skin.list),this.moduleData=game.juLingData},onShow:function(){var e=this,t=e.moduleData.getInfoById(e.moduleData.curId);if(t){var a=void 0;a=t.spiritLv<1?t.spiritLv+1:t.spiritLv;var i=e.moduleData.getJuLingCurLvCfg(t.id,a);if(i){e.juLingSpriteStat||(e.juLingSpriteStat=game.SpriteStat.get()),e.juLingSpriteStat.clear(),e.juLingSpriteStat.setupByCfg(i),e.setStr(e.juLingSpriteStat,t);var n=e.moduleData.getPreviewAttr(t.id);e.list.setData(n)}}},setStr:function(e,a){var i=this;if(!e)return"";var t=e.getSpriteStats();if(!t)return"";var n=void 0,s=0;t.forEach(function(e,t){n=game.AttrRulesCfg.getData(+e),s++,2==n.format&&(t=t/1e3*100+"%"),a.spiritLv<1?i.getComponent("attr_"+s).string=game.Lang.get(509,n.name,0):i.getComponent("attr_"+s).string=game.Lang.get(509,n.name,game.CCommonUtil.replaceNum(t))},i)},onHide:function(){}});b8e.module.registerView(game.ME.JuLingPreview,e)}(),function(){var e=game.View.extends({_showModel:!0,juLingMax:0,ctor:function(){this._super(1668)},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500),this.moduleData=game.juLingData},onShow:function(){var e=this,t=e.moduleData.getInfoById(e.moduleData.curId);if(t){var a=e.moduleData.getJuLingCurLvCfg(t.id,t.spiritLv);if(a){var i=game.AttrRulesCfg.getData(a.attrId);e.skin.whole_attr.string=game.Lang.get(507,i.name,a.attrVal),e.skin.unlock_lv.string=game.Lang.get(53541,t.spiritLv),e.skin.huawen_3.width=b8e.stageWidth+100,e.skin.huawen_1.width=b8e.stageWidth+100,e.skin.gray.setSize(b8e.stageWidth+50,281),e.endTime=game.SysTime.curTime+5e3,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(3e3)),e.timer.reset(),e.timer.start()}}},updateTime:function(){if(!this.endTime)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},onHide:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.JuLingUnlockTips,e)}(),function(){var e=game.CultivateBaseModelView.extends({juLingMax:0,ctor:function(){this._super(1664)},init:function(){this.moduleData=game.juLingData,this.costIcon=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),this.costIcon.addToParent(this.skin.icon),this.initModel({type:game.RoleType.Halo,node:this.skin.modelNode});var e=game.HaloMiscCfg.getData("juLingMax");e&&(this.juLingMax=e.value)},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_STAR:this.upodateStar(t);break;case this.Evts.C2V_UPDATE_VIEW:this.updateView(t),this.updateModule(),this.upodateStar(t)}},onShow:function(){var e=this.moduleData.getCurInfo();this.moduleData.curId=e.id,this.moduleData.isAnim=!1,this.updateView(e),this.upodateStar(e),this.updateModule()},updateView:function(e){var t=this.skin;t.left_btn.active=this.moduleData.leftActive(e),t.right_btn.active=this.moduleData.rightActive(e),t.redPoint1.active=this.moduleData.leftAlert,t.redPoint2.active=this.moduleData.rightAlert},upodateStar:function(e){var t=this,a=void 0;a=e.spiritLv>t.juLingMax?e.spiritLv%10==0?10:e.spiritLv%10:e.spiritLv;for(var i=0;i<t.juLingMax;i++){var n=i+1;t.getComponent("star_"+n).active=n<=a,t.getComponent("select_"+n).active=n==a+1,n<t.juLingMax&&(t.getComponent("lien_"+n).active=n<=a),t.moduleData.isAnim&&a==n?t.playAnima(n):t.removeAnima(n)}t.skin.redPoint.active=e.spiritAlert,t.skin.juling_lv.string=game.Lang.get(53539,e.spiritLv),t.upAttrStr(e)},playAnima:function(e){this.anims||(this.anims=[]);var t=this.anims[e];if(t||(t=this.createAnim(),this.anims[e]=t),!t.parent){var a=this.getComponent("eff_"+e);t.addToParent(a)}t.setVisible(!0),t.play(),t.addFinishCallback(this._effectFinished,this,[e])},_effectFinished:function(e,t){this.anims[t].setVisible(!1)},createAnim:function(){var e=b8e.Animator.get(game.AnimType.UI_EFFECT,1);return e.load(game.ResCfg.getUrl(5019,1130)),e.setScale(1,1),e},removeAnima:function(e){if(this.anims){var t=this.anims[e];t&&(t.setVisible(!1),t.removeFromParent()),t=null}},upAttrStr:function(e){var t=this,a=void 0;a=e.spiritLv<1?e.spiritLv+1:e.spiritLv,t.skin.up_node.active=e.spiritLv!=t.moduleData.maxLv,t.skin.fullLevel.active=e.spiritLv==t.moduleData.maxLv;var i=t.moduleData.getJuLingCurLvCfg(e.id,a);if(i){if(e.spiritLv!=t.moduleData.maxLv){var n=i.cost[0];t.costIcon.setItemId(n.Id);var s=game.itemData.getCountById(n.Id);t.skin.count.string=s>=n.Num?game.Lang.get(53543,s,n.Num):game.Lang.get(53544,s,n.Num)}t.juLingSpriteStat||(t.juLingSpriteStat=game.SpriteStat.get()),t.juLingSpriteStat.clear(),t.juLingSpriteStat.setupByCfg(i),t.setStr(t.juLingSpriteStat,e);var r=t.moduleData.getAttrInfo(e);r&&(t.skin.unlock_lv.string=e.spiritLv!=t.moduleData.maxLv?game.Lang.get(53541,r.lv):game.Lang.get(1340),t.skin.whole_attr.string=game.Lang.get(509,r.attrName,r.attrVal))}},updateModule:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getFosterBaseCfg(e,this.moduleData.curId);t&&(this.skin.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name),this.updateModel(game.RoleType.Halo,t))},setStr:function(e,a){var i=this;if(!e)return"";var t=e.getSpriteStats();if(!t)return"";var n=void 0,s=0;t.forEach(function(e,t){n=game.AttrRulesCfg.getData(+e),s++,2==n.format&&(t=t/1e3*100+"%"),a.spiritLv<1?i.getComponent("attr_"+s).string=game.Lang.get(509,n.name,0):i.getComponent("attr_"+s).string=game.Lang.get(509,n.name,game.CCommonUtil.replaceNum(t))},i)},onHide:function(){for(var e=1;e<=this.juLingMax;e++)this.removeAnima(e)}});b8e.module.registerView(game.ME.JuLing,e)}(),function(){var e;e=b8e.Enum({NONE:-1,C2V_UPDATE_VIEW:-1,C2V_UPDATE_STAR:-1,C2C_UPDATE_KEYIN:-1}),b8e.RC("$$game","$$KeYinEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.keYinData},ipc:function(){this.evts={Back:{C_BACK_UPDATE_ITEMINFO:this.updateItemInfo}},this.handels={FosterSealResp:this.fosterSealResp}},updateItemInfo:function(){if(b8e.module.isShowView(this.moduleEnum)){var e=game.juLingData.getInfoById(this.moduleData.curId);e&&this.send(this.Evts.C2V_UPDATE_VIEW,e)}},fosterSealResp:function(e){var t=e.readProtobuf(game.pb.FosterSealResponse);if(0<t.code)game.notice.noticeError(t.code);else{this.moduleData.setActive(t.id,t.sealId);var a=game.juLingData.getInfoById(t.id);a&&(game.FightAmount.inst().showTeamStatPower(),game.module.show(game.ME.KeYinActivateTips),this.send(this.Evts.C2V_UPDATE_VIEW,a),this.dpt(this.Evts.C2C_UPDATE_KEYIN))}},left_btn:function(){this.moduleData.curId--;var e=game.juLingData.getInfoById(this.moduleData.curId);e&&this.send(this.Evts.C2V_UPDATE_VIEW,e)},right_btn:function(){this.moduleData.curId++;var e=game.juLingData.getInfoById(this.moduleData.curId);e&&this.send(this.Evts.C2V_UPDATE_VIEW,e)},btn_activa:function(){var e=game.juLingData.getInfoById(this.moduleData.curId);if(e)if(e.active){var t=this.moduleData.getKeYinCurLvCfg(e.id,e.seal+1);if(t){var a=t.cost[0];if(game.itemData.getCountById(a.Id)<a.Num)game.notice.show(113);else if(e.star<t.limit)game.notice.show(53603);else{var i=game.fosterData.curFosterType;this.sender.FosterSealReq(i,e.id)}}}else game.notice.show(53545,e.name)},btn_find:function(){game.module.show(game.ME.KeYinPreview)}}),t=[game.ME.KeYinPreview,game.ME.KeYinActivateTips],a=game.Sender.extends({ipc:function(){this.msg={FosterSealReq:this.fosterSealReq}},fosterSealReq:function(e,t){var a=game.pb.FosterSealRequest;a.fosterType=e,a.id=t,this.write(a)}});b8e.module.registerControl(game.ME.KeYin,e,game.KeYinEvts,a,t)}(),function(){var e=b8e.Object.extends({curId:0,leftAlert:!1,rightAlert:!1,ctor:function(){this.imprintMap=b8e.HashMap.get()},getCurInfo:function(){return game.fosterData.getCurFosterInfo()},setActive:function(e,t){var a=game.fosterData,i=a.getFosterInfo(a.curFosterType,e);i&&i.setSeal(t)},getKeYinByIdCfgs:function(e){var t=this.getKeYinCfg();if(!t)return null;this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.id=e;var a=t.getData(this.cfgObj,!0);return a.sort(this._sort),a},getKeYinCfg:function(){switch(game.fosterData.curFosterType){case game.NewFosterType.HALO:return game.HaloSealCfg;default:return null}},getPreviewArr:function(e){var t=this.imprintMap.get(e);if(t)return t;var a=this.getKeYinByIdCfgs(e);if(!a)return null;t=[];for(var i=a.length,n=0;n<i;n++){var s=a[n];if(s.attach){var r=new game.KeYinImprintInfo;r.setData(s),t.push(r)}}return t.sort(this._sotr),this.imprintMap.set(e,t),t},getAttrInfo:function(e){var t=this.getPreviewArr(e.id);if(!t)return null;for(var a=void 0,i=t.length,n=0;n<i;n++){var s=t[n];if(e.seal<s.sealId)return s;a=s}return a},_sort:function(e,t){return e.sealId-t.sealId},getKeYinCurLvCfg:function(e,t){var a=this.getKeYinCfg();return a?(this.cfgObj1||(this.cfgObj1=b8e.createMap()),this.cfgObj1.id=e,this.cfgObj1.sealId=t,a.getData(this.cfgObj1)):null},leftActive:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e.id-1);return!!a&&(this.leftAlert=a.sealAlert,!0)},rightActive:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e.id+1);return!!a&&(this.rightAlert=a.sealAlert,!0)}});game.keYinData=game.keYinData||new e}(),function(){var e;e=b8e.Object.extends({name:"",attrVal:0,attrName:"",sealId:0,cfg:null,setData:function(e){this.sealId=e.sealId,this.name=e.name,this.cfg=e;var t=game.AttrRulesCfg.getData(e.attrId);t&&(2==t.format?this.attrVal=e.attrVal/1e3+"%":this.attrVal=game.CCommonUtil.replaceNum(e.attrVal),this.attrName=t.name)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$KeYinImprintInfo",e)}(),function(){var e=game.View.extends({_showModel:!0,juLingMax:0,ctor:function(){this._super(1670)},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500),this.moduleData=game.keYinData},onShow:function(){var e=this.skin,t=game.juLingData.getInfoById(this.moduleData.curId);if(t){var a=this.moduleData.getKeYinCurLvCfg(t.id,t.seal);if(a){if(a.attach){var i=game.AttrRulesCfg.getData(a.attrId);e.whole_attr.string=game.Lang.get(507,i.name,a.attrVal),e.unlock_lv.string=game.Lang.get(53602,a.name),e.gray.setSize(b8e.stageWidth+50,430),e.height_node.y=0}else e.gray.setSize(b8e.stageWidth+50,338),e.height_node.y=93;e.special_node.active=a.attach;var n=game.ResCfg.getUrl(10213,a.icon);e.icon.loadTexture(n);var s=game.ResCfg.getUrl(10213,a.iconNmae);e.icon_name.loadTexture(s),e.huawen_3.width=b8e.stageWidth+100,e.huawen_1.width=b8e.stageWidth+100,this.endTime=game.SysTime.curTime+5e3,e.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(3e3)),this.timer.reset(),this.timer.start(),this.updateAttr(t)}}},updateAttr:function(e){var t=this.moduleData.getKeYinCurLvCfg(e.id,e.seal);t&&(this.keYinSpriteStat||(this.keYinSpriteStat=game.SpriteStat.get()),this.keYinSpriteStat.clear(),this.keYinSpriteStat.setupByCfg(t),this.setStr(this.keYinSpriteStat,e))},setStr:function(e){var a=this;if(!e)return"";var t=e.getSpriteStats();if(!t)return"";var i=void 0,n=0;t.forEach(function(e,t){i=game.AttrRulesCfg.getData(+e),n++,2==i.format&&(t=t/1e3*100+"%"),a.getComponent("attr_"+n).string=game.Lang.get(507,i.name,game.CCommonUtil.replaceNum(t))},a)},updateTime:function(){if(!this.endTime)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},onHide:function(){this.timer&&this.timer.stop()}});b8e.module.registerView(game.ME.KeYinActivateTips,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1671),this.setSize(533,133)},setData:function(e){var t=this.skin,a=game.ResCfg.getUrl(10213,e.cfg.icon);t.icon.loadTexture(a);var i=game.ResCfg.getUrl(10213,e.cfg.iconNmae);t.icon_name.loadTexture(i),t.open_lab.string=game.Lang.get(53602,e.name),t.attr.string=game.Lang.get(509,e.attrName,e.attrVal)}}),b8e.RC("$$game","$$KeYinImprintItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1672)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.KeYinImprintItem,e.bindEnum=game.ME.KeYin,e.addToParent(this.skin.list),this.moduleData=game.keYinData},onShow:function(){var e=game.juLingData.getInfoById(this.moduleData.curId);if(e){var t=this.moduleData.getPreviewArr(e.id);t&&this.list.setData(t)}}});b8e.module.registerView(game.ME.KeYinPreview,e)}(),function(){var e=game.CultivateBaseModelView.extends({maxKeYin:8,ctor:function(){this._super(1669)},init:function(){this.initModel({type:game.RoleType.Halo,node:this.skin.modelNode}),this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.item),this.moduleData=game.keYinData},notify:function(e,t){switch(e){case this.Evts.C2V_UPDATE_VIEW:this.updateView(t),this.updateModule(),this.setKeYinPos(t)}},onShow:function(){var e=this.moduleData.getCurInfo();this.moduleData.curId=e.id,this.updateView(e),this.updateModule(),this.setKeYinPos(e)},setKeYinPos:function(e){var t=this,a=t.moduleData.getKeYinByIdCfgs(e.id);if(a&&!(a.length<1))for(var i=0;i<t.maxKeYin;i++){var n=i+1,s=a[i];if(t.getComponent("yinji_node_"+n).active=s){t.getComponent("yinji_node_"+n).setPosition(s.posX,s.posY),t.getComponent("open_lv_"+n).active=e.seal<s.sealId,t.getComponent("open_lv_"+n).string=s.limit?game.Lang.get(53601,s.limit):"",t.getComponent("unlock_bg"+n).active=e.seal<s.sealId,t.getComponent("selset_"+n).active=n==e.seal+1;var r=game.ResCfg.getUrl(10213,s.icon);t.getComponent("bg_"+n).loadTexture(r);var o=game.ResCfg.getUrl(10213,s.iconNmae);t.getComponent("name_"+n).loadTexture(o)}}},updateView:function(e){var t=this,a=t.skin;a.left_btn.active=t.moduleData.leftActive(e),a.right_btn.active=t.moduleData.rightActive(e),a.redPoint1.active=t.moduleData.leftAlert,a.redPoint2.active=t.moduleData.rightAlert,a.redPoint.active=e.sealAlert,a.btn_activa.active=e.sealAlert,a.not_activa.active=!e.sealAlert;var i=void 0,n=t.moduleData.getKeYinByIdCfgs(e.id),s=n.length;if(n){i=e.seal==s?e.seal:e.seal+1,a.active_node.active=e.seal!=s,a.fullLevel.active=e.seal==s;var r=t.moduleData.getKeYinCurLvCfg(e.id,i);if(r){var o=r.cost[0],g=game.ResCfg.getUrl(10213,r.icon);a.keyin_icon.loadTexture(g);var u=game.ResCfg.getUrl(10213,r.iconNmae);a.icon_name.loadTexture(u);var l=game.ItemUtil.createBaseItemInfo(o.Id,o.Num);t.icon.setItemInfo(l,!1,game.IconLayoutEnum.SHOW_NONE);var c=game.itemData.getCountById(o.Id);a.count.string=c>=o.Num?game.Lang.get(53543,c,o.Num):game.Lang.get(53544,c,o.Num),a.condition.string=r.limit?game.Lang.get(53601,r.limit):"";var h=t.moduleData.getAttrInfo(e);h&&(a.unlock_str.string=e.seal!=s?game.Lang.get(53602,h.name):game.Lang.get(1340),a.whole_attr.string=game.Lang.get(509,h.attrName,h.attrVal),t.updateAttr(e))}}},updateAttr:function(e){var t=void 0;t=e.seal<1?e.seal+1:e.seal;var a=this.moduleData.getKeYinCurLvCfg(e.id,t);a&&(this.keYinSpriteStat||(this.keYinSpriteStat=game.SpriteStat.get()),this.keYinSpriteStat.clear(),this.keYinSpriteStat.setupByCfg(a),this.setStr(this.keYinSpriteStat,e))},updateModule:function(){var e=game.fosterData.curFosterType,t=game.fosterData.getFosterBaseCfg(e,this.moduleData.curId);t&&(this.skin.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name),this.updateModel(game.RoleType.Halo,t))},setStr:function(e,a){var i=this;if(!e)return"";var t=e.getSpriteStats();if(!t)return"";var n=void 0,s=0;t.forEach(function(e,t){n=game.AttrRulesCfg.getData(+e),s++,2==n.format&&(t=t/1e3*100+"%"),a.seal<1?i.getComponent("attr_"+s).string=game.Lang.get(509,n.name,0):i.getComponent("attr_"+s).string=game.Lang.get(509,n.name,game.CCommonUtil.replaceNum(t))},i)}});b8e.module.registerView(game.ME.KeYin,e)}(),function(){var e;e=b8e.Enum({None:0,C2V_UPDATE_PAGE:-1,V2C_BUY_GIFT:-1,C2C_RECHARGE:-1,V2C_ON_SHOW:-1,REFRESHBTN_HOME:b8e.enc()}),b8e.RC("$$game","$$LimitSalePrizeEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.limitSalePrizeData,this.saleAlert=game.spotAlert.set(game.SAE.LIMIT_SALE_PRIZE)},ipc:function(){this.evts={Recharge:{C_INIT_MODEL:this.sysnDta,C_RECHARGE_SUCCESS:this.onRechargeSuccess},MainRole:{C_RESET_DAILY:this.resetDaily}}},sysnDta:function(){var e=this.data;e.checkLimitSaleOpen()&&(e.createDatas(),this.saleAlert.alert=!0,this.dpt(this.Evts.REFRESHBTN_HOME))},notify:function(e,t){switch(e){case this.Evts.V2C_BUY_GIFT:t&&this.dpt(this.Evts.C2C_RECHARGE,t);break;case this.Evts.V2C_ON_SHOW:this.saleAlert.alert=!1}},onRechargeSuccess:function(e){if(e&&e.data){var t=e.data.id;this.data.rechargeSuccess(t),this.data.updateInfo(t),this.send(this.Evts.C2V_UPDATE_PAGE),this.dpt(this.Evts.REFRESHBTN_HOME)}},btn1:function(){this.selectPage(game.LimitSalePrizeType.PAGE_ONE)},btn2:function(){this.selectPage(game.LimitSalePrizeType.PAGE_TWO)},selectPage:function(e){var t=this.data;if(t.selecId!=e){var a=t.getDatasByType(e);!a||a.length<1||(t.setSelectId(e),this.send(this.Evts.C2V_UPDATE_PAGE))}},resetDaily:function(){var e=this.data;game.module.hide(game.ME.LimitSalePrize),e.checkLimitSaleOpen()&&e.createDatas()}});b8e.module.registerControl(game.ME.LimitSalePrize,e,game.LimitSalePrizeEvts)}(),function(){var e;e=b8e.Enum({NONE:0,PAGE_ONE:1,PAGE_TWO:2}),b8e.RC("$$game","$$LimitSalePrizeType",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.limitMap=b8e.HashMap.get(),this.typeMap=b8e.HashMap.get(),this.selectId=1,this.page1Arr=[],this.page2Arr=[],this.limitSalePrize=[]},setData:function(e){this.limitSalePrize=e},checkLimitSaleOpen:function(){var e=game.LimitSalePrizeCfg.getDatas();if(!e||e.length<1)return!1;for(var t=e.length,a=0;a<t;a++)if(this.checkOpenByCfg(e[a]))return!0;return!1},checkOpenByCfg:function(e){if(!e)return!1;if(!game.CCommonUtil.getGameChannelIdOpen(e))return!1;if(e.startTime&&e.endTime){var t=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd  hh:mm:ss").getTime(),a=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd  hh:mm:ss").getTime(),i=game.SysTime.curTime;if(i<t||a<i)return!1}if(e.serverStart&&e.serverEnd){var n=void 0;if((n=e.startTime?game.TimeUtil.getOpenDayByStr(e.startTime,"yyyy-MM-dd  hh:mm:ss"):game.miscData.openServerDay)<e.serverStart||n>=e.serverEnd)return!1}return!0},createDatas:function(){var e=game.LimitSalePrizeCfg.getDatas();if(e&&!(e.length<1)){var t=e.length,a=this.page1Arr,i=this.page2Arr,n=this.limitMap;a.length=i.length=0,n.clear();for(var s=void 0,r=void 0,o=void 0,g=0;g<t;g++)s=e[g],this.checkOpenByCfg(s)&&(r=s.startTime&&s.endTime?a:i,(o=new game.LimitSalePrizeInfo).setCfg(s),o.setTimes(),n.set(o.rechargeId,o),r.push(o));this.typeMap.set(game.LimitSalePrizeType.PAGE_ONE,a),this.typeMap.set(game.LimitSalePrizeType.PAGE_TWO,i)}},getNum:function(e){var t=this.limitSalePrize;if(!t||t.length<1)return 0;for(var a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n]).id==e)return i.num;return 0},rechargeSuccess:function(e){var t=this.limitSalePrize;(!t||t.length<1)&&(t=this.limitSalePrize=[]);for(var a=t.length,i=void 0,n=0;n<a;n++)if((i=t[n]).id==e)return void i.num++;t.push({id:e,num:1})},updateInfo:function(e){var t=this.limitMap.get(e);t&&t.setTimes()},setShowSelect:function(){this.selectId=this.page1Arr.length?1:2},setSelectId:function(e){this.selectId=e},getDatasByType:function(e){return this.typeMap.get(e)},getRemainTime:function(){var e=this.getDatasByType(this.selectId);if(!e||e.length<1)return-1;var t=e[0];if(!t||!t.cfg)return-1;var a=t.cfg;return(a.startTime&&a.endTime?b8e.TimeUtil.dateParse(a.endTime,"yyyy-MM-dd  hh:mm:ss").getTime():b8e.TimeUtil.getNextDateTime(game.SysTime.curTime,a.serverEnd-game.miscData.openServerDay))-game.SysTime.curTime},getCurDatas:function(){return(this.selectId==game.LimitSalePrizeType.PAGE_ONE?this.page1Arr:this.page2Arr).sort(this._sort)},_sort:function(e,t){return 0==e.leftNum&&0!=t.leftNum?1:0!=e.leftNum&&0==t.leftNum?-1:e.rechargeCfg.money-t.rechargeCfg.money},isBuyAll:function(){var e=this.limitMap.values();if(!e||e.length<1)return!0;for(var t=e.length,a=0;a<t;a++)if(0<e[a].leftNum)return!1;return!0}});game.limitSalePrizeData=game.limitSalePrizeData||new e}(),function(){var e;e=b8e.Object.extends({rechargeId:0,numLimit:0,leftNum:0,num:0,setCfg:function(e){e&&(this.cfg=e,this.rechargeId=e.rechargeId,this.numLimit=e.numLimit,this.leftNum=this.numLimit,this.rechargeCfg=game.RechargeCfg.getDataById(this.rechargeId))},setTimes:function(){this.num=game.limitSalePrizeData.getNum(this.rechargeId),this.leftNum=this.numLimit-this.num},getAwardsList:function(){if(!this.awards){var e=game.IconLayoutEnum.SHOW_NUM,t=game.IconSizeEnum.GRID_SIZE_105;this.awards=game.CfgUtil.getPrizeListInfo(this.cfg.items,e,t).items}return this.awards}});b8e.BindingUtil.bind(e),b8e.RC("$$game","$$LimitSalePrizeInfo",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1616)},init:function(){var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.LimitSalePrizeItem,e.bindEnum=this.moduleEnum,e.addToParent(this.skin.listNode),e.layout.paddingTop=9,e.layout.paddingLeft=9,e.layout.spacingY=5,this.data=game.limitSalePrizeData},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_PAGE:this.updatePage(),this.createTimer()}},onShow:function(){this.data.setShowSelect(),this.updatePage(),this.createTimer(),this.send(this.Evts.V2C_ON_SHOW)},updatePage:function(){var e=this.skin,t=this.data,a=t.page1Arr,i=t.page2Arr,n=a&&a.length,s=i&&i.length;if(n||s){var r=e.pos1.x,o=e.pos2.x;e.btn1.active=n,e.btn2.active=s,e.btn2.x=n&&s?o:r,e.btnSelect.x=n&&s?t.selectId==game.LimitSalePrizeType.PAGE_ONE?r:o:r;var g=t.getCurDatas();this.list.setData(g)}},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.skin,t=this.data.getRemainTime();t<0?this.clearTimer():e.timeLab.string=game.TimeUtil.formatTimeSpace(t,3)},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)}});b8e.module.registerView(game.ME.LimitSalePrize,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1617),this.setSize(601,154)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=0,e.layout.paddingTop=0,e.layout.spacingX=20},setData:function(e){var t=this.skin,a=e.getAwardsList();this.prizeList.setData(a);var i=e.cfg;t.icon1.active=1==i.icon,t.icon2.active=2==i.icon;var n=e.leftNum;t.canBuyNode.active=0<n,t.hasBuyAllNode.active=n<1,t.timesLab.string=game.Lang.get(53509,n,e.numLimit),t.moneyLab.string=game.Lang.get(53510,e.rechargeCfg.money)},buyBtn:function(){this.send(game.LimitSalePrizeEvts.V2C_BUY_GIFT,this.data.rechargeId)}}),b8e.RC("$$game","$$LimitSalePrizeItem",e)}(),function(){var e;e=b8e.Enum({None:0,C2V_LV_UP:-1,C2V_SELECT_BOSS:-1,V2C_REQ_RANKINFO:-1,C2V_UPDATE_RANKINFO:-1,C2V_UPDATE_CHALLENGE:-1,C2V_UPDATE_RED:-1,C2V_UPDATE_OPEN:-1,C2V_RESET_DAILY:-1}),b8e.RC("$$game","$$GuildNewBossEvts",e)}(),function(){var e=game.Control.extends({init:function(){this.data=game.guildNewBossData,this.guildNewBossAlert=game.spotAlert.set(game.SAE.GUILD_NEW_BOSS,game.SAE.GUILD),this.challengeAlert=game.spotAlert.set(game.SAE.GUILD_NEW_BOSS_CHALLENGE,game.SAE.GUILD_NEW_BOSS),this.openAlert=game.spotAlert.set(game.SAE.GUILD_NEW_BOSS_OPEN,game.SAE.GUILD_NEW_BOSS)},ipc:function(){var e=this;e.evts={MainRole:{C_LEVEL_UP:e.levelUp,C_RESET_DAILY:e.resetDaily},Guild:{C_UPDATE_GUILD:e.updatePoint,C_INIT_MODEL:e.checkChallAlert}},e.gevts={ChatEvts:{C_CHAT_FUNC_GUILD_NEW_BOSS:e.onBoss2Open}},e.handels={GuildNewBossChallengeResp:e.onChallengeResp,GuildNewBossDmgRankResp:e.onGuildNewBossDmgRankResp,GuildNewBossOpenResp:e.onGuildNewBossOpenResp}},notify:function(e){switch(e){case this.Evts.V2C_REQ_RANKINFO:this.sendRankInfo()}},resetDaily:function(){this.data.resetDaily(),this.checkChallAlert(),this.send(this.Evts.C2V_RESET_DAILY)},updatePoint:function(){var e=this.data.checkChallAlertById(2),t=this.data.canOpenBoss2();this.openAlert.alert=e||t,this.send(this.Evts.C2V_UPDATE_RED)},checkChallAlert:function(){this.challengeAlert.alert=this.data.checkChallAlert(),this.send(this.Evts.C2V_UPDATE_RED)},onBoss2Open:function(){this.data.onGuildNewBossOpenResp(),this.updatePoint(),this.send(this.Evts.C2V_UPDATE_OPEN)},onChallengeResp:function(e){var t=e.readProtobuf(game.pb.GuildNewBossChallengeResponse);if(0<t.code)game.notice.noticeError(t.code);else{if(t.sweep)this.showItem(t);else{this.data.dmgValue=0;var a=t.battleLog;a.win=!0;var i={type:game.InstanceType.GUILD_NEW_BOSS,isWin:!0,rewards:t.userItem,damage:-1*a.damage};game.playBack.play(a,i)}this.data.onChallengeResp(t),this.checkChallAlert(),this.send(this.Evts.C2V_UPDATE_CHALLENGE)}},showItem:function(e){var t={type:game.InstanceType.GUILD_NEW_BOSS,rewards:e.userItem,win:!0,sweep:!0};b8e.evt.dptG(game.InstanceEvts.G_STOP_PLAY,t)},onGuildNewBossDmgRankResp:function(e){var t=e.readProtobuf(game.pb.GuildNewBossDmgRankResponse);0<t.code?game.notice.noticeError(t.code):(this.data.updataRankInfo(t),this.send(this.Evts.C2V_UPDATE_RANKINFO))},onGuildNewBossOpenResp:function(e){var t=e.readProtobuf(game.pb.GuildNewBossOpenResponse);0<t.code?game.notice.noticeError(t.code):(this.data.onGuildNewBossOpenResp(),this.updatePoint(),this.send(this.Evts.C2V_UPDATE_OPEN))},checkAlert:function(){this.guildInsAlert.alert=0<this.data.challengeTimes},sendRankInfo:function(){this.sender.GuildNewBossDmgRankReq(this.data.selectId)},leftBtn:function(){this.changeBoss(1)},rightBtn:function(){this.changeBoss(2)},openBtn:function(){this.sender.GuildNewBossOpenReq()},changeBoss:function(e){e!=this.data.selectId&&(this.data.setSelectId(e),this.send(this.Evts.C2V_SELECT_BOSS))},awardBtn:function(){game.module.show(game.ME.GuildNewBossAward)},logBtn:function(){game.module.show(game.ME.GuildNewBossLog)},saodangBtn:function(){var e=this.data.getSelectInfo();e.dmg?e.leftNum<1?game.notice.show(53363):(this.saoDangAlert||(this.saoDangAlert={key:game.ME.GuildNewBoss,lang:53627,btn:game.Lang.get(9059),okcb:this.saodangReq,thisArg:this,showtips:!0,defaultSelect:!0}),this.saoDangAlert.langArgs=[e.dmg],game.alert.show(this.saoDangAlert)):game.notice.show(53626)},saodangReq:function(){this.sender.GuildNewBossChallengeReq(this.data.selectId,!0)},challengeBtn:function(){this.data.getSelectInfo().leftNum<1?game.notice.show(53363):this.sender.GuildNewBossChallengeReq(this.data.selectId,!1)},levelUp:function(){this.data.levelUp(),this.send(this.Evts.C2V_LV_UP)}}),t=[game.ME.GuildNewBossSkill,game.ME.GuildNewBossAward,game.ME.GuildNewBossLog],a=game.Sender.extends({ipc:function(){this.msg={GuildNewBossOpenReq:null,GuildNewBossChallengeReq:this.guildNewBossChallengeReq,GuildNewBossDmgRankReq:this.guildNewBossDmgRankReq}},guildNewBossChallengeReq:function(e,t){var a=game.pb.GuildNewBossChallengeRequest;a.id=e,a.sweep=t,this.write(a)},guildNewBossDmgRankReq:function(e){var t=game.pb.GuildNewBossDmgRankRequest;t.id=e,this.write(t)}});b8e.module.registerControl(game.ME.GuildNewBoss,e,game.GuildNewBossEvts,a,t)}(),function(){var e=b8e.Object.extends({selectId:1,dmgValue:0,ctor:function(){this._super(),this.bossMap=b8e.HashMap.get()},updateBossOpen:function(e){var t=e.bossList;if(t&&!(t.length<1))for(var a=t.length,i=void 0,n=0;n<a;n++)i=t[n],this.getBossInfoById(i.id).updateOpen(i)},getBossInfoById:function(e){var t=this.bossMap,a=t.get(e);return a||((a=new game.GuildNewBossInfo).setCfg(e),t.set(e,a)),a},getPrize:function(){return this.getBossInfoById(this.selectId).getPrize()},updatechallengeInfo:function(e){if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=0;i<t;i++)a=e[i],this.getBossInfoById(a.id).updatechallengeInfo(a)},setSelectId:function(e){this.selectId=e},getSelectInfo:function(){return this.getBossInfoById(this.selectId)},levelUp:function(){var e=this.bossMap.values();if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)e[a].setPrize()},setShowBossId:function(){var e=this.getBossInfoById(1),t=this.getBossInfoById(2),a=e&&0<e.leftNum,i=t&&0<t.leftNum;this.setSelectId(1),!a&&i&&this.setSelectId(2),!i&&a&&this.setSelectId(1)},updataRankInfo:function(e){var t=this.getBossInfoById(e.id);t&&t.updataRankInfo(e.ranks)},getLogs:function(){return this.getSelectInfo().ranks},getHpPercent:function(e){for(var t=e/1e4,a=this.getSelectInfo().cfg.icons,i=a.length,n=void 0,s=0;s<i;s++)if(t<(n=a[s]).Damage)return n;return a[i-1]},getCountDown:function(){var e=this.getSelectInfo(),t=game.SysTime.curTime;return(1==e.id?b8e.TimeUtil.getNextDateTime(t,1):e.endTime)-t},onChallengeResp:function(e){this.getBossInfoById(e.id).onChallengeResp(e)},getOpenCost:function(){return this.getBossInfoById(2).cfg.costPoint},onGuildNewBossOpenResp:function(){this.getBossInfoById(2).setOpen()},checkChallAlert:function(){var e=this.bossMap.values();if(e&&!(e.length<1))for(var t=e.length,a=void 0,i=0;i<t;i++)if((a=e[i]).isOpen&&0<a.leftNum)return!0},checkChallAlertById:function(e){var t=this.getBossInfoById(e);return t.isOpen&&0<t.leftNum},canOpenBoss2:function(){var e=this.getBossInfoById(2),t=game.guildData.getMineRank(),a=game.GuildRankType,i=t==a.GUILDMASTER||t==a.ZHANGLAO,n=game.guildData.point,s=this.getOpenCost()<=n;return!e.isOpen&&i&&s},getDuration:function(){var e=game.GuildNewBossCfg.getData(1);return e?1e3*e.duration:0},resetDaily:function(){this.getBossInfoById(1).resetDaily()},clearData:function(){this.bossMap.clear()}});game.guildNewBossData=game.guildNewBossData||new e}(),function(){var e;e=b8e.Object.extends({isOpen:!1,endTime:0,id:0,cfg:null,challengeNum:0,challenges:0,leftNum:0,dmg:0,ctor:function(e){this._super(),this.id=e,this.ranks=[]},setCfg:function(e){var t=game.GuildNewBossCfg.getData(e);t&&(this.cfg=t,this.id=e,this.challenges=t.challenges,this.leftNum=this.challenges-this.challengeNum)},updateOpen:function(e){var t=e.openTime;if(1==this.id)this.isOpen=!0;else{if(t){var a=game.SysTime.curTime-1e3*t;this.isOpen=a<b8e.TimeUtil.DAY_MICRO_SECONDS}else this.isOpen=!1;this.endTime=this.isOpen?1e3*t+game.guildNewBossData.getDuration():0}},setOpen:function(){this.endTime=game.SysTime.curTime+game.guildNewBossData.getDuration(),this.isOpen=!0},updatechallengeInfo:function(e){this.challengeNum=e.num,this.dmg=e.dmg,this.leftNum=this.challenges-this.challengeNum},getPrize:function(){return this.prize||this.setPrize(),this.prize},setPrize:function(){var e=game.GuildNewBossRewardCfg.getData(this.id,!0);if(e&&!(e.length<1)){e.sort(this.sortLv);for(var t=e.length,a=game.mainRoleData.lv,i=void 0,n=0;n<t;n++)if(a<=e[n].level){i=e[n];break}var s=i.showAward;if(s&&!(s.length<1)){var r=game.IconLayoutEnum.SHOW_NONE,o=game.IconSizeEnum.GRID_SIZE_105;this.prize=game.CfgUtil.getPrizeListInfo(s,r,o).items}}},sortLv:function(e,t){return e.level-t.level},updataRankInfo:function(e){for(var t=this.ranks,a=t.length,i=game.GuildNewBossLogInfo,n=0;n<a;n++)i.put(t[n]);t.length=0,a=e.length;for(var s=void 0,r=0;r<a;r++)(s=i.get()).setData(this.id,e[r]),t.push(s);t.sort(this.rankSort)},rankSort:function(e,t){return t.dmg-e.dmg},onChallengeResp:function(e){this.challengeNum++,this.leftNum=this.challenges-this.challengeNum,e.sweep||(this.dmg=-1*e.battleLog.damage)},resetDaily:function(){1==this.id&&(this.isOpen=!0,this.leftNum=this.challenges,this.challengeNum=0,this.dmg=0)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GuildNewBossInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({bossId:0,name:"",male:"",dmg:0,prize:null,setData:function(e,t){this.name=t.name,this.male=t.male,this.dmg=t.dmg,this.bossId=e},recycle:function(){this.reset(),this._super()},reset:function(){this.name="",this.male="",this.dmg=0,this.prize=null,this.bossId=0},getPrize:function(){return this.prize||this.setPrize(),this.prize},setPrize:function(){var e=game.GuildNewBossFirstShowCfg.getData(this.bossId,!0);if(e&&!(e.length<1)){e.sort(this.sortDmg);for(var t=e.length,a=this.dmg,i=void 0,n=0;n<t;n++)if(a>=e[n].dmg){i=e[n];break}var s=(i=i||e[0]).showAward;if(s&&!(s.length<1)){var r=game.IconLayoutEnum.SHOW_NONE,o=game.IconSizeEnum.GRID_SIZE_105;this.prize=game.CfgUtil.getPrizeListInfo(s,r,o).items}}},sortDmg:function(e,t){return t.dmg-e.dmg}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,128),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GuildNewBossLogInfo",t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1739)},init:function(){var e=this,t=e.skin;e.data=game.guildNewBossData,e.iconBg=b8e.Sprite.get(),e.iconBg.addToParent(t.head),e.iconBg.setAnchor(.5,.5),e.headImg=b8e.Sprite.get(),e.headImg.addToParent(t.head),e.headImg.setAnchor(.5,.5),e.headImg.setSize(84,84),e.headImg.y=2;var a=e.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.PrizeListItem,a.layout.paddingLeft=5,a.layout.paddingTop=0,a.layout.spacingX=22,a.addToParent(t.prizeList)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_RANKINFO:this.updataView()}},onShow:function(){this.send(this.Evts.V2C_REQ_RANKINFO)},updataView:function(){var e=this.skin,t=this.data.getLogs(),a=t&&0<t.length;if(e.emptyNode.active=!a,e.hasNode.active=a){var i=t[0],n=game.ResCfg.getUrl(10221);this.iconBg.loadTexture(n);var s=game.ResCfg.getHead(i.male);this.headImg.loadTexture(s),e.name.string=i.name,e.damageLab.string=i.dmg;var r=i.getPrize();this.prizeList.setData(r)}}});b8e.module.registerView(game.ME.GuildNewBossAward,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1740),this.setSize(540,130)},init:function(){var e=this.skin;this.iconBg=b8e.Sprite.get(),this.iconBg.addToParent(e.head),this.iconBg.setAnchor(.5,.5),this.headImg=b8e.Sprite.get(),this.headImg.addToParent(e.head),this.headImg.setAnchor(.5,.5),this.headImg.setSize(84,84),this.headImg.y=2},setData:function(){var e=this.skin,t=this.data,a=game.ResCfg.getUrl(10221);this.iconBg.loadTexture(a);var i=game.ResCfg.getHead(t.male);this.headImg.loadTexture(i);var n=game.Color,s=t.name==game.mainRoleData.name;e.name.color=s?n.GREEN:n.RED,e.name.string=t.name,e.damageLab.string=t.dmg}}),b8e.RC("$$game","$$GuildNewBossLogItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1742)},init:function(){var e=this.skin;this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.addChild(this.skillIcon)},onShow:function(){this.setData()},setData:function(){var e=this.skin,t=game.guildNewBossData.skillId,a=game.SkillCfg.getData(t);a&&(this.skillIcon.setData(a.id),e.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name),e.tipsDescLab.string=game.LangSkill.get(a.desc,a.descParam))}});b8e.module.registerView(game.ME.GuildNewBossSkill,e)}(),function(){var e=game.View.extends({_showModel:!0,_modelTouchClose:!1,ctor:function(){this._super(1743),this.spotAlerts={GUILD_INSTANCE:this.challengeAlert}},init:function(){var e=this.skin;this.data=game.guildNewBossData;var t=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.PrizeListItem,t.layout.paddingLeft=5,t.layout.paddingTop=0,t.layout.spacingX=22,t.addToParent(e.prizeList),this.bg=b8e.Sprite.get(),this.bg.addToParent(e.bg),this.bg.setAnchor(.5,.5),this.initSkillIcons(),this.data.setShowBossId()},initSkillIcons:function(){for(var e=this.skillIcons=[],t=game.IconSizeEnum.CIRCLE_SIZE_104,a=void 0,i=0;i<3;i++)(a=game.GridUtil.createCultivateBaseSkillIcon(t,!1,!1)).setClickCallBack(this.clickSkillIcon,this),a.addToParent(this.getComponent("skillIcon"+i)),e.push(a)},clickSkillIcon:function(e){this.data.skillId=e.skillId,game.module.show(game.ME.GuildNewBossSkill)},challengeAlert:function(e){this.skin.redPoint.active=e.alert},notify:function(e){var t=this;switch(e){case t.Evts.C2V_LV_UP:t.updatePrize();break;case t.Evts.C2V_SELECT_BOSS:t.updatePrize(),t.updateSkills(),t.updatetModel(),t.updateChoice(),t.createTimer(),t.updateOpen();break;case t.Evts.C2V_UPDATE_CHALLENGE:case t.Evts.C2V_UPDATE_RED:t.updateOpen();break;case t.Evts.C2V_UPDATE_OPEN:t.updateOpen(),t.updateChoice();break;case t.Evts.C2V_RESET_DAILY:t.updatePrize(),t.createTimer(),t.updateOpen()}},onShow:function(){this.updateChoice(),this.createTimer(),this.updatePrize(),this.updateSkills(),this.updatetModel(),this.updateOpen()},updateOpen:function(){var e=this.skin,t=this.data.getSelectInfo(),a=t.isOpen;if(e.openNode.active=a,e.notOpenNode.active=!a,a)e.lastBuyTimes.string=game.Lang.get(53628,t.leftNum,t.challenges),e.redPoint.active=0<t.leftNum;else{var i=game.guildData.getMineRank(),n=game.GuildRankType,s=i==n.GUILDMASTER||i==n.ZHANGLAO,r=game.guildData.point,o=this.data.getOpenCost(),g=o<=r;e.openBtn.active=s&&g,e.notOpenBtn.active=!s||!g;var u=g?53648:53649;e.pointLab.string=game.Lang.get(u,r,o),e.openRed.active=g}},updateChoice:function(){var e=this.skin,t=this.data.selectId;e.rightBtn.active=1==t,e.leftBtn.active=2==t,e.tit1.active=1==t,e.tit2.active=2==t,e.leftRed.active=this.data.checkChallAlertById(1);var a=this.data.checkChallAlertById(2),i=this.data.canOpenBoss2();e.rightRed.active=a||i;var n=this.data.getSelectInfo(),s=game.ResCfg.getUrl(10223,n.cfg.bg);this.bg.loadTexture(s)},updateSkills:function(){var e=this.data.getSelectInfo();if(e&&e.cfg)for(var t=e.cfg.skills,a=this.skillIcons,i=a.length,n=0;n<i;n++)a[n].setData(t[n])},updatePrize:function(){var e=this.data.getPrize();!e||e.length<1||this.prizeList.setData(e)},updatetModel:function(){var e=this.data,t=this.skin,a=e.getSelectInfo();if(a&&a.cfg){var i=a.cfg.uiModel;this.model||(this.model=new game.SurfaceModel,this.model.addToParent(t.modelNode),this.model.initModel()),game.AvatarUtil.updateModel2(i,this.model,game.RoleType.Partner)}},createTimer:function(){this.updateTime(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.updateTime,1e3)},updateTime:function(){var e=this.skin,t=this.data;if(e.titBg.active=!0,t.getSelectInfo().isOpen){var a=this.data.getCountDown(),i=game.TimeUtil.formatTimeSpace(a,3);e.timeLab.string=game.Lang.get(53631,i)}else this.clearTimer()},onHide:function(){this.clearTimer()},clearTimer:function(){this.timer&&(this.skin.titBg.active=!1,b8e.Timer.remove(this,this.updateTime),this.timer=null)}});b8e.module.registerView(game.ME.GuildNewBoss,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1741)},init:function(){this.data=game.guildNewBossData;var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GuildNewBossLogItem,e.layout.paddingLeft=10,e.layout.paddingTop=10,e.layout.spacingY=10,e.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C2V_UPDATE_RANKINFO:this.updateList()}},onShow:function(){this.send(this.Evts.V2C_REQ_RANKINFO)},updateList:function(){var e=this.skin,t=this.data.getLogs(),a=t&&0<t.length;e.emptyNode.active=!a,(e.list.active=a)&&this.list.setData(t)}});b8e.module.registerView(game.ME.GuildNewBossLog,e)}(),function(){var e;e=b8e.Enum({None:0,SWITCH_PAGE:-1,C_UPDATA_FREEDRAW:-1,C_UPDATA_LUCK_ID:-1,C_UPDATA_NEXT_WAVE:-1,C_UPDATA_BUY_GIFT:-1,C_UPDATA_TASK:-1,C_UPDATA_VALUE_INFO:-1,C_SEND_BUY_GIFT:-1,C2C_RECHARGE:-1,C_TASK_JUMP_MODULE:-1,C_TASK_REC:-1,C_SHOP_BUY:-1,C_GO_NEXT:-1,C_SELECT_LOTTERY:-1,C_UPDATA_RESET_DAILY:-1,C_SEND_SELECT_BG_2:-1,C_SEND_SELECT_BG:-1,C_SEND_ACT:-1}),b8e.RC("$$game","$$OptionalLotteryEvts",e)}(),function(){var e=void 0;e=b8e.Object.extends({freeDrawId:0,freeDrawWave:0,luckySelect:0,luckyGet:!1,drawAwardMap:null,drawGiftdMap:null,drawTaskdMap:null,openInfo:null,simpleInfoAry:null,luckInfoAry:null,shopInfoAry:null,valueInfoAry:null,taskInfoAry:null,rewardInfoAry:null,taskIsGet:null,grid:0,awardId:0,award:0,selectLuckId:0,allSelectMap:null,drawAwardMapId:null,isTipsfirst:!0,ctor:function(){var e=this;e._super(),e.openInfo=null,e.taskIsGet=[],e.simpleInfoAry=b8e.HashMap.get(),e.luckInfoAry=b8e.HashMap.get(),e.taskInfoAry=b8e.HashMap.get(),e.shopInfoAry=b8e.HashMap.get(),e.valueInfoAry=b8e.HashMap.get(),e.rewardInfoAry=b8e.HashMap.get(),e.allSelectMap=b8e.HashMap.get(),e.drawAwardMap=b8e.HashMap.get(),e.drawAwardMapId=b8e.HashMap.get(),e.drawGiftdMap=b8e.HashMap.get(),e.drawTaskdMap=b8e.HashMap.get()},updataSelectBg:function(e){this.luckInfoAry.get(this.selectLuckId).selectBg=!1,this.selectLuckId=e,this.luckInfoAry.get(e).selectBg=!0},getInfosByType:function(e){var t=void 0;switch(e){case 1:t=this.simpleInfoAry.values();break;case 2:t=this.luckInfoAry.values();break;case 3:t=this.shopInfoAry.values();break;case 4:t=this.valueInfoAry.values();break;case 5:t=this.taskInfoAry.values();break;case 6:t=this.rewardInfoAry.values();break;case 7:t=this.allSelectMap.values()}return t},setSelectPoolAry:function(){var e=this.getInfosByType(1).length,t=void 0,a=void 0;this.allSelectMap.clear();for(var i=void 0,n=0;n<e;n++)(t=new game.OptionalLotterySelectInfo).grid=n+1,t.isSelect=!1,t.isSelectBig=!1,(i=this.drawAwardMapId.get(t.grid))&&(t.isSelect=!0,a=this.getPoolByValue(!0,i.awardId).giveItems[0].Id,t.gridId=a,this.luckySelect&&i.awardId==this.luckySelect&&(t.isSelectBig=!0,this.luckyGet=!0)),this.allSelectMap.set(t.grid,t)},initData:function(e){var t=this;t.freeDrawId=e.freeDrawId||1,t.freeDrawWave=e.freeDrawWave,t.luckySelect=e.freeDrawLuckySelect,t.luckyGet=e.freeDrawLuckyGet,t.taskIsGet=e.freeDrawTaskRecords;var a=e.freeDrawAwards,i=e.freeDrawGoods,n=e.freeDrawPrizes,s=e.freeDrawTasks,r=a.length,o=i.length,g=n.length,u=s.length,l=[];l.push(r),l.push(o),l.push(g),l.push(u);for(var c=Math.max.apply(null,l),h=void 0,m=0;m<c;m++)m<r&&(h=a[m],t.drawAwardMap.set(h.awardId,h),t.drawAwardMapId.set(h.grid,h)),m<o&&(h=i[m],t.drawGiftdMap.set(h.id,h)),m<g&&(h=n[m],t.drawGiftdMap.set(h.id,h)),m<u&&(h=s[m],t.drawTaskdMap.set(h.taskType,h))},setCfgData:function(){var e=this,t=game.FreeDrawOpenCfg.getDatas();if(t&&!(t.length<1)){var a=t.length,i=void 0,n=void 0;if(e.isOpenAct()){for(var s=0;s<a;s++)if(i=t[s],e.checkOpen(i.id)){(n=new game.OptionalLotteryOpenInfo).setConfig(i),e.freeDrawId=n.id,e.openInfo=n;break}e.setLotterySimplePool(),e.setLotteryLuckPool(),e.setTaskAry(),e.setSelectShop(),e.setSelectValue(),e.addLuckInfo(),e.setRewardNum()}}},updataNextWaveClear:function(){this.drawAwardMap.clear(),this.drawAwardMapId.clear(),this.rewardInfoAry.clear(),this.luckySelect=0,this.luckyGet=!1,this.setLotterySimplePool(),this.setLotteryLuckPool(),this.setRewardNum()},resetDailyUpdata:function(){this.drawTaskdMap.clear(),this.taskIsGet.length=0,this.setTaskAry()},addLuckInfo:function(){if(this.luckySelect){var e=this.getPoolByValue(!0,this.luckySelect),t=(e.giveItems[0].Num,void 0),a=this.rewardInfoAry.get(e.index);a?a.updataLast(1):((t=new game.OptionalLotteryRewardInfo).setConfig(e),this.rewardInfoAry.set(e.index,t))}},setAllPool:function(e){var t=this.getPoolByValue(!0,e),a=void 0;(a=new game.OptionalLotteryPoolInfo).setConfig(t),this.simpleInfoAry.set(a.config.awardId,t),this.setSelectPoolAry()},setRewardNum:function(){for(var e=this.drawAwardMap.values(),t=e.length,a=void 0,i=void 0,n=0;n<t;n++)(a=this.getPoolByValue(!0,e[n].awardId)).giveItems[0].Id,(i=this.rewardInfoAry.get(a.index))&&i.updataLast(1)},setSelectValue:function(){var e=game.FreeDrawCashCfg.getData(this.freeDrawId,!0);if(e){this.valueInfoAry.clear();for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++)a=e[s],i=new game.OptionalLotteryValueInfo,(n=this.drawGiftdMap.get(a.rechargeId))&&i.updataBuy(n.num||0),i.setConfig(a),this.valueInfoAry.set(a.rechargeId,i)}},getPoolByValue:function(e,t){return e?(this.obj||(this.obj={}),this.obj.awardId=t,game.FreeDrawStoreCfg.getData(this.obj)):game.FreeDrawStoreCfg.getData(t,!0)},setSelectShop:function(){var e=game.FreeDrawShopCfg.getData(this.freeDrawId,!0);if(e){this.shopInfoAry.clear();for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++)a=e[s],i=new game.OptionalLotteryShopInfo,n=this.drawGiftdMap.get(a.id),i.setConfig(a),n&&i.updataBuy(n.times||0),this.shopInfoAry.set(a.id,i)}},setLotterySimplePool:function(){var e=this,t=e.getLotteryPool(!0);if(t){var a=t.length;e.simpleInfoAry.clear(),e.rewardInfoAry.clear();for(var i=void 0,n=void 0,s=void 0,r=0;r<a;r++)i=t[r],n=new game.OptionalLotteryPoolInfo,e.rewardInfoAry.get(i.index)?(s=e.rewardInfoAry.get(i.index)).updataNum(1):((s=new game.OptionalLotteryRewardInfo).setConfig(i),e.rewardInfoAry.set(i.index,s)),n.setConfig(i),e.simpleInfoAry.set(i.awardId,n);e.luckySelect&&e.setAllPool(e.luckySelect)}},setLotteryLuckPool:function(){var e=this.getLotteryPool(!1);if(e){var t=e.length;this.luckInfoAry.clear();for(var a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=new game.OptionalLotteryPoolInfo).setConfig(a),this.luckInfoAry.set(a.awardId,i)}},getLotteryPool:function(e){var t=game.FreeDrawWaveCfg.getData(this.freeDrawId||1,this.freeDrawWave);if(t){var a=[],i=t.normalStore,n=this.openInfo.luckyStore;if(a=e?this.getPoolByValue(!1,i):this.getPoolByValue(!1,n))return a}},setTaskAry:function(){var e=this.getTaskByValue(!1,this.freeDrawId);if(e){this.taskInfoAry.clear();for(var t=e.length,a=void 0,i=void 0,n=void 0,s=0;s<t;s++){if(a=e[s],i=new game.OptionalLotteryTaskInfo,n=this.drawTaskdMap.get(a.taskType),i.updataIsGet(!1),i.setConfig(a),n){var r=n.process||0;a.taskType==game.OptionalLotteryTaskType.FREEDRAWTYPELOGIN&&(r=1),i.updataCondition(r)}0<=this.taskIsGet.indexOf(a.id)&&i.updataIsGet(!0),this.taskInfoAry.set(a.id,i)}}},getTaskByValue:function(e,t){return e?game.FreeDrawTaskCfg.getData(t):(this.obj2||(this.obj2={}),this.obj2.activityId=t,game.FreeDrawTaskCfg.getData(this.obj2,!0))},isOpenAct:function(){var e=game.FreeDrawOpenCfg.getDatas();if(e&&!(e.length<1)){for(var t=e.length,a=void 0,i=0;i<t;i++)if(a=e[i],this.checkOpen(a.id))return!0;return!1}},checkOpen:function(e){var t=game.FreeDrawOpenCfg.getData(e);if(!t)return!1;var a=game.SysTime.curTime;if(t.startTime){var i=b8e.TimeUtil.dateParse(t.startTime,"yyyy-MM-dd hh:mm:ss").getTime();i=1e3*(i/1e3>>0);var n=b8e.TimeUtil.dateParse(t.endTime,"yyyy-MM-dd hh:mm:ss").getTime();if(n=1e3*(n/1e3>>0),a<i||n<=a)return!1;var s=game.TimeUtil.getOpenDayByStr(t.startTime);return s>=t.serverStart&&s<t.serverEnd}var r=game.miscData.openServerDay;return!(t.serverStart>r||r>=t.serverEnd)},getTimeCountDown:function(){var e=game.FreeDrawOpenCfg.getData(this.freeDrawId);if(!e)return!1;var t=game.SysTime.curTime,a=game.miscData.openServerDay;return(e.startTime?1e3*(b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime()/1e3>>0):(e.serverEnd-a)*b8e.TimeUtil.DAY_MICRO_SECONDS+b8e.TimeUtil.getTodayTime(t))-t},updataFreeDrawResp:function(e){var t=this;if(e){t.grid=e.grid,t.awardId=e.awardId,t.award=e.award;var a=t.getPoolByValue(!0,t.awardId),i=t.rewardInfoAry.get(a.index);i&&i.updataLast(1);var n=t.allSelectMap.get(t.grid);n&&(n.isSelect=!0,n.gridId=e.award[0].id,t.luckySelect&&t.awardId==t.luckySelect&&(n.isSelectBig=!0,t.luckyGet=!0))}},updataLuckResp:function(e){this.luckySelect=e,this.setAllPool(e),this.addLuckInfo()},updataNextWave:function(e){this.freeDrawWave=e},updataBuyGift:function(e){var t=this.shopInfoAry.get(e);t&&t.updataBuy(1)},updataValue:function(e){var t=this.valueInfoAry.get(e);t&&t.updataBuy(1)},updataTaskOver:function(e){var t=this.taskInfoAry.get(e);t&&t.updataIsGet(!0)},updataTaskNum:function(e){for(var t=e.task.taskType,a=this.getInfosByType(5),i=a.length,n=void 0,s=0;s<i;s++)(n=a[s])&&n.taskType==t&&n.updataCondition(e.task.process)},redPiont:function(){var e=this.getInfosByType(5);if(!e||e.length<=0)return!1;for(var t=e.length,a=void 0,i=0;i<t;i++)if(!(a=e[i]).isGet&&a.process>=a.condition)return!0;return!1},redPiont2:function(){var e=this.openInfo;return!!e&&0<game.itemData.getNumById(e.costItemId)}}),game.optionalLotteryData=game.optionalLotteryData||new e,b8e.RC("$$game","$$OptionalLotteryData",e)}(),function(){var e;e=b8e.Object.extends({config:null,id:0,gridNum:0,openLucky:0,costItemId:0,title:null,banner:null,luckyStore:0,setConfig:function(e){this.config=e,this.id=e.id,this.gridNum=e.gridNum,this.openLucky=e.openLucky,this.costItemId=e.costItemId,this.title=e.title,this.banner=e.banner,this.luckyStore=e.luckyStore}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotteryOpenInfo",e)}(),function(){var e;e=b8e.Object.extends({config:null,id:0,selectBg:!1,setConfig:function(e){this.config=e,this.id=e.id},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e=this.config.giveItems,t=void 0,a=void 0,i=e.length;this.awards=[];for(var n=0;n<i;n++)t=e[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),this.awards.push(a);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotteryPoolInfo",e)}(),function(){var e;e=b8e.Object.extends({config:null,numAll:0,lastNum:0,setConfig:function(e){this.config=e,this.numAll=1},updataNum:function(e){this.numAll+=e},updataLast:function(e){this.lastNum+=e},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e=this.config.giveItems,t=void 0,a=void 0,i=e.length;this.awards=[];for(var n=0;n<i;n++)t=e[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),this.awards.push(a);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotteryRewardInfo",e)}(),function(){var e;e=b8e.Object.extends({grid:0,isSelect:!1,isSelectBig:!1,gridId:0,effect:null,setConfig:function(){},recycle:function(){this._super(),this.effect&&this.effect.clear(),this.grid=0,this.gridId=0,this.isSelect=!1,this.isSelectBig=!1}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotterySelectInfo",e)}(),function(){var e;e=b8e.Object.extends({config:null,id:0,costItems:null,limitTimes:0,buyNum:0,isGet:!1,setConfig:function(e){this.config=e,this.id=e.id,this.costItems=e.costItems,this.limitTimes=e.limitTimes,this.isGet=!1,this.buyNum=0},updataBuy:function(e){this.buyNum+=e,this.isGet=this.buyNum>=this.limitTimes},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e=this.config.award,t=void 0,a=void 0,i=e.length;this.awards=[];for(var n=0;n<i;n++)t=e[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),this.awards.push(a);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotteryShopInfo",e)}(),function(){var e;e=b8e.Object.extends({config:null,id:0,taskType:0,condition:0,moduleId:0,desc:null,process:0,canGet:!1,isGet:!1,setConfig:function(e){this.config=e,this.id=e.id,this.taskType=e.taskType,this.condition=e.condition,this.moduleId=e.moduleId,this.desc=e.desc,this.isGet=!1,this.canGet=!1},updataCondition:function(e){this.process=e,this.canGet=this.process>=this.condition},updataIsGet:function(e){this.isGet=e},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e=this.config.award,t=void 0,a=void 0,i=e.length;this.awards=[];for(var n=0;n<i;n++)t=e[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),this.awards.push(a);return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotteryTaskInfo",e)}(),function(){var e;e=b8e.Enum({FREEDRAWTYPENONE:0,FREEDRAWTYPELOGIN:1,FREEDRAWTYPERECHARGE:2,FREEDRAWTYPECOSTGOLD:3,FREEDRAWTYPECHAT:4,FREEDRAWTYPEQUICKBATTLE:5,FREEDRAWTYPEMATERIAL:6,FREEDRAWTYPEEXPLORE:7,FREEDRAWTYPEGUILDBOSS:8,FREEDRAWTYPEGUILDINS:9,FREEDRAWTYPEMEMOIR:10,FREEDRAWTYPEARENA:11,FREEDRAWTYPEMYSTERY:12,FREEDRAWTYPEGUILDDONATE:13,FREEDRAWTYPEBARBARIAN:14,FREEDRAWTYPEZHAOQIN:15}),b8e.RC("$$game","$$OptionalLotteryTaskType",e)}(),function(){var e;e=b8e.Object.extends({config:null,rechargeId:0,numLimit:0,buyNum:0,isGet:!1,setConfig:function(e){this.config=e,this.rechargeId=e.rechargeId,this.numLimit=e.numLimit,this.buyNum=0,this.canGet=!1},updataBuy:function(e){this.buyNum+=e,this.isGet=this.buyNum>=this.numLimit},getPrizeItems:function(){if(!this.config)return null;if(this.awards)return this.awards;var e=this.config.awards,t=void 0,a=void 0,i=e.length;this.awards=[];for(var n=0;n<i;n++){t=e[n],a=game.ItemUtil.createBaseItemInfo(t.Id,t.Num),this.awards.push(a)}return this.awards}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$OptionalLotteryValueInfo",e)}(),function(){var e=void 0;(e=game.ListItem.extends({id:0,canClick:!1,ctor:function(){this._super(1686),this.setSize(110,140)},init:function(){this.canClick=!1,this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.icon)},setData:function(){var e=this,t=e.skin,a=game.optionalLotteryData.freeDrawWave,i=e.data.config,n=i.wave;e.id=i.awardId,t.selectBg.active=e.data.selectBg,t.okBg.active=e.data.selectBg;var s=e.data.getPrizeItems();game.GridUtil.setItemIcon(e._icon,s[0],!1,game.IconLayoutEnum.SHOW_NUM);var r=e._icon._cfg.name;n<=a?(e.canClick=!0,t.gray_bg.active=!1,t.lab_lv.string=r):(e.canClick=!1,t.gray_bg.active=!0,t.lab_lv.string=game.Lang.get(53563,n))},getPrizeBtn:function(){this.canClick&&this.send(game.OptionalLotteryEvts.C_SEND_SELECT_BG,this.id)}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotteryFinalItem",e)}(),function(){var e=game.Control.extends({init:function(){this.moduleData=game.optionalLotteryData,this.allAlert=game.spotAlert.set(game.SAE.OPTION_LOTTERY_PIONT),this.allAlert1=game.spotAlert.set(game.SAE.OPTION_LOTTERY_LOTTERY,game.SAE.OPTION_LOTTERY_PIONT),this.allAlert2=game.spotAlert.set(game.SAE.OPTION_LOTTERY_TASK,game.SAE.OPTION_LOTTERY_PIONT)},ipc:function(){var e=this;e.evts={OpenServer:{C2C_INIT_OPENSERVER:e.onSysData,C2C_UPDATA_OPENSERVER:e.onSysData},Recharge:{C_RECHARGE_SUCCESS:e.rechargeSuccess},MainRole:{C_RESET_DAILY:e.resetDaily},Back:{C_BACK_UPDATE_ITEMINFO:e.updateItem,C_BACK_SYN_BACK_INFO:e.updateItem}},e.handels={FreeDrawResp:e.freeDrawResp,FreeDrawLuckyResp:e.freeDrawLuckyResp,FreeDrawNextWaveResp:e.freeDrawNextWaveResp,FreeDrawBuyGiftResp:e.freeDrawBuyGiftResp,FreeDrawTaskResp:e.freeDrawTaskResp,FreeDrawTaskMsg:e.freeDrawTaskMsg}},notify:function(e,t){var a=this;switch(e){case a.Evts.C_SEND_BUY_GIFT:a.buyGift(t);break;case a.Evts.C_TASK_JUMP_MODULE:a.jumpModule(t);break;case a.Evts.C_TASK_REC:a.taskRec(t);break;case a.Evts.C_SHOP_BUY:a.shopBuy(t);break;case a.Evts.C_GO_NEXT:a.gonext();break;case a.Evts.C_SELECT_LOTTERY:a.selectLottery(t);break;case a.Evts.C_SEND_SELECT_BG:a.selectLuckBg(t)}},updateItem:function(){this.moduleData.isOpenAct()&&(this.send(this.Evts.C_UPDATA_FREEDRAW),this.checkAlert())},selectLuckBg:function(e){this.moduleData.updataSelectBg(e),this.send(this.Evts.C_SEND_SELECT_BG_2)},resetDaily:function(){this.moduleData.isOpenAct()?(this.moduleData.resetDailyUpdata(),this.dpt(this.Evts.C_SEND_ACT),this.send(this.Evts.C_UPDATA_RESET_DAILY),this.checkAlert()):b8e.module.isShowView(game.ME.OptionalLottery)&&game.module.hide(game.ME.OptionalLottery)},checkAlert:function(){var e=this.moduleData.redPiont(),t=this.moduleData.redPiont2();this.allAlert1.alert=e,this.allAlert2.alert=t},selectLottery:function(e){this.sender.FreeDrawReq(e)},gonext:function(){this.options||(this.options={lang:53606,btn:game.Lang.get(9059),okcb:this.sureGoNext,thisArg:this}),game.alert.show(this.options)},sureGoNext:function(){this.sender.FreeDrawNextWaveReq()},shopBuy:function(e){this.sender.FreeDrawBuyGiftReq(e)},jumpModule:function(e){var t=e.split(",");if(1<t.length){var a=+t[0],i=+t[1];game.moduleOpen.checkOpen(a)&&game.module.showToggle(a,i)}else{var n=+t[0];if(game.moduleOpen.checkOpen(n))return void game.module.show(n)}},taskRec:function(e){this.sender.FreeDrawTaskReq(e)},buyGift:function(e){this.fastId=e,this.dpt(this.Evts.C2C_RECHARGE,e)},rechargeSuccess:function(e){if(e&&e.data){var t=e.data.id;t==this.fastId&&this.moduleData.updataValue(t),this.send(this.Evts.C_UPDATA_VALUE_INFO)}},triggerOpen:function(){this.moduleEnum},onSysData:function(e){var t=e?e.data:null;t&&(this.moduleData.initData(t),this.moduleData.setCfgData(),this.checkAlert())},freeDrawResp:function(e){var t=e.readProtobuf(game.pb.FreeDrawResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updataFreeDrawResp(t),this.send(this.Evts.C_UPDATA_FREEDRAW))},freeDrawLuckyResp:function(e){var t=e.readProtobuf(game.pb.FreeDrawLuckyResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updataLuckResp(t.awardId),this.send(this.Evts.C_UPDATA_LUCK_ID))},freeDrawNextWaveResp:function(e){var t=e.readProtobuf(game.pb.FreeDrawNextWaveResponse);0<t.code?game.notice.noticeError(t.code):(game.optionalLotteryData.isTipsfirst=!0,this.moduleData.updataNextWave(t.wave),this.moduleData.updataNextWaveClear(),this.send(this.Evts.C_UPDATA_NEXT_WAVE))},freeDrawBuyGiftResp:function(e){var t=e.readProtobuf(game.pb.FreeDrawBuyGiftResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updataBuyGift(t.id),this.send(this.Evts.C_UPDATA_BUY_GIFT))},freeDrawTaskResp:function(e){var t=e.readProtobuf(game.pb.FreeDrawTaskResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updataTaskOver(t.taskId),this.send(this.Evts.C_UPDATA_TASK),this.checkAlert())},freeDrawTaskMsg:function(e){var t=e.readProtobuf(game.pb.FreeDrawTaskNotify);0<t.code?game.notice.noticeError(t.code):(this.moduleData.updataTaskNum(t),this.send(this.Evts.C_UPDATA_TASK),this.checkAlert())},optionalBtn_1:function(){this.selectToggle(0)},optionalBtn_2:function(){this.selectToggle(1)},optionalBtn_3:function(){this.selectToggle(2)},optionalBtn_4:function(){this.selectToggle(3)},selectToggle:function(e){this.send(this.Evts.SWITCH_PAGE,e)},defineBtn:function(){var e=this.moduleData.selectLuckId;this.sender.FreeDrawLuckyReq(e),b8e.module.isShowView(game.ME.OptionalLotteryFinally)&&game.module.hide(game.ME.OptionalLotteryFinally)},laveBtn:function(){game.module.show(game.ME.OptionalLotteryReward)},selectLuckBtn:function(){game.module.show(game.ME.OptionalLotteryFinally)}}),t=[game.ME.OptionalLotterySelect,game.ME.OptionalLotteryValue,game.ME.OptionalLotteryShop,game.ME.OptionalLotteryTask,game.ME.OptionalLotteryFinally,game.ME.OptionalLotteryReward],a=game.Sender.extends({ipc:function(){this.msg={FreeDrawReq:this.freeDrawReq,FreeDrawLuckyReq:this.freeDrawLuckyReq,FreeDrawNextWaveReq:null,FreeDrawBuyGiftReq:this.freeDrawBuyGiftReq,FreeDrawTaskReq:this.freeDrawTaskReq}},freeDrawReq:function(e){var t=game.pb.FreeDrawRequest;t.grid=e,this.write(t)},freeDrawLuckyReq:function(e){var t=game.pb.FreeDrawLuckyRequest;t.awardId=e,this.write(t)},freeDrawBuyGiftReq:function(e){var t=game.pb.FreeDrawBuyGiftRequest;t.id=e,this.write(t)},freeDrawTaskReq:function(e){var t=game.pb.FreeDrawTaskRequest;t.taskId=e,this.write(t)}});b8e.module.registerControl(game.ME.OptionalLottery,e,game.OptionalLotteryEvts,a,t)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1687)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Grid),this.list.itemRender=game.OptionalLotteryFinalItem,this.list.bindEnum=game.ME.OptionalLottery,this.list.layout.spacingY=5,this.list.layout.spacingX=20,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_SEND_SELECT_BG_2:this.updataView()}},onShow:function(){this.updataView()},updataView:function(){this.list.scrollToTop();var e=game.optionalLotteryData.getInfosByType(2);if(e&&!(e.length<=0)){this.list.setData(e);var t=e[0].config.awardId;game.optionalLotteryData.isTipsfirst&&(game.optionalLotteryData.isTipsfirst=!1,game.optionalLotteryData.selectLuckId=t,this.send(game.OptionalLotteryEvts.C_SEND_SELECT_BG,t))}},onHide:function(){this.first=!0}});b8e.module.registerView(game.ME.OptionalLotteryFinally,e)}(),function(){var e=void 0;(e=game.ListItem.extends({id:0,ctor:function(){this._super(1688),this.setSize(547,120)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=17,e.layout.spacingY=-5},setData:function(){var e=this.skin,t=this.data.getPrizeItems();this.prizeList.setData(t);var a=this.data.numAll,i=this.data.lastNum;e.lastLab.string=game.Lang.get(1621,a-i,a)}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotteryRewardItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1689)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.OptionalLotteryRewardItem,this.list.bindEnum=game.ME.OptionalLottery,this.list.layout.spacingY=8,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_UPDATA_FREEDRAW:this.updataView()}},onShow:function(){this.updataView()},updataView:function(){this.list.scrollToTop();var e=game.optionalLotteryData.getInfosByType(6);e&&0<e.length&&(e.sort(this.onSort),this.list.setData(e))},onSort:function(e,t){return t.config.awardId-e.config.awardId}});b8e.module.registerView(game.ME.OptionalLotteryReward,e)}(),function(){var e=void 0;(e=game.ListItem.extends({grid:0,canClick:!1,isSelectBig:!1,ctor:function(){this._super(1690),this.setSize(110,105)},init:function(){this._icon=game.GridUtil.createCostItemIcon(),this._icon.addToParent(this.skin.icon)},setData:function(){var e=this,t=e.skin,a=e.data;e.grid=a.grid,e.isSelectBig=a.isSelectBig,t.light_bg.active=!0,t.gray_bg.active=!0,t.gray_bg.scaleX=0,t.effectNode.active=a.isSelectBig,t.selectBtn.active=!a.isSelectBig,t.effectBtn.active=a.isSelectBig,e.canClick=e.isSelectBig,e.isSelectBig?(t.light_bg.active=!1,t.gray_bg.active=!1,e.setEffect()):(e._icon&&(e._icon.active=!1),b8e.Tween.get(t.light_bg).to({scaleX:0},400).call(e.turnTo,e))},turnTo:function(){var e=this.skin;b8e.Tween.get(e.gray_bg).to({scaleX:1},400).call(this.turnTo2,this)},turnTo2:function(){var e=this.data,t=this.skin;if(t.light_bg.scaleX=1,t.gray_bg.scaleX=1,t.light_bg.active=!e.isSelect,t.gray_bg.active=!1,e.isSelect){this._icon.active=!0;var a=e.gridId;this._icon.setItemInfo(a,!1,game.IconLayoutEnum.SHOW_ALL,!1)}},setEffect:function(){var e=this.data.effect;(e=e||b8e.Animator.get(game.AnimType.ITEM_EFFECT,1))&&!e.parent&&this.skin.effect.addChild(e);var t=game.ResCfg.getUrl(5019,1131);e.load(t),e.play()},selectBtn:function(){this.data.isSelect||this.isSelectBig||this.send(game.OptionalLotteryEvts.C_SELECT_LOTTERY,this.grid)},effectBtn:function(){this.canClick&&this.send(game.OptionalLotteryEvts.C_GO_NEXT)}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotterySelectItem",e)}(),function(){var e=game.View.extends({rankList:null,selectList:null,ctor:function(){this._super(1691)},init:function(){this.moduleData=game.optionalLotteryData,this.rankList=[],this.list2=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),this.list2.itemRender=game.OptionalLotterySelectItem,this.list2.bindEnum=game.ME.OptionalLottery,this.list2.layout.spacingY=6,this.list2.layout.spacingX=8,this.list2.addToParent(this.skin.list2)},notify:function(e){switch(e){case this.Evts.C_UPDATA_LUCK_ID:this.updataView();break;case this.Evts.C_UPDATA_FREEDRAW:this.updataNum();break;case this.Evts.C_UPDATA_NEXT_WAVE:this.updataView()}},onShow:function(){this.updataView()},updataView:function(){var e=this,t=e.skin,a=e.moduleData.getInfosByType(1);if(a){var i=e.moduleData.freeDrawWave,n=e.moduleData.luckySelect,s=e.moduleData.luckyGet,r=e.moduleData.openInfo;e.id=r.costItemId;var o=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42);o.setItemId(r.costItemId),o.addToParent(e.skin.itemIcon),t.numLab.string=i,t.lab_1.string=game.Lang.get(53611),t.laveBtn.active=!0,t.selectLuckBtn.active=!1,t.list.active=!1,t.list2.active=!1,n||s?n&&!s?(t.list2.active=!0,e.setSelectInfo()):n&&s&&(e.setSelectInfo(),t.list2.active=!0):(t.list.active=!0,t.laveBtn.active=!1,t.selectLuckBtn.active=!0,e.setRewardShow(a)),e.updataNum(r.costItemId)}},updataNum:function(){var e=game.itemData.getNumById(this.id);this.skin.havaLab.string=e;var t=this.moduleData.luckySelect,a=this.moduleData.luckyGet;t&&a&&(this.skin.lab_1.string=game.Lang.get(53612))},setSelectInfo:function(){var e=game.optionalLotteryData.getInfosByType(7);this.list2.setData(e)},setRewardShow:function(e){var t=e.slice();t.splice(12,0,"");for(var a=t.length,i=void 0,n=void 0,s=0;s<a;s++)i=t[s],(n=this.rankList[s])||((n=new game.OptionalLotteryShowItem).setPosition(s%5*122,-109*Math.floor(s/5)),n.addToParent(this.skin.list),n.show(),this.rankList[s]=n),n.setVisible(!0),n.setData(i),11==s&&s++},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OptionalLotterySelect,e)}(),function(){var e=void 0;(e=game.ListItem.extends({id:0,ctor:function(){this._super(1692),this.setSize(608,160)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=17,e.layout.spacingY=-5},setData:function(){var e=this.skin,t=this.data.getPrizeItems();this.prizeList.setData(t),this.id=this.data.id;var a=this.data.costItems,i=this.data.limitTimes,n=this.data.buyNum,s=this.data.isGet;s||(e.canBuyLab.string=game.Lang.get(6094,i-n,i),e.getLbl.string=game.Lang.get(9146),e.goldLab.string=a[0].Num),e.getPrize.active=s,e.getBtn.active=!s,e.canBuyLab.active=!s,e.goldNode.active=!s},getBtn:function(){this.send(game.OptionalLotteryEvts.C_SHOP_BUY,this.id)}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotteryShopItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1693)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.OptionalLotteryShopItem,this.list.bindEnum=game.ME.OptionalLottery,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_UPDATA_BUY_GIFT:this.updataView()}},onShow:function(){this.updataView(),this.createTimer()},updataView:function(){this.list.scrollToTop();var e=game.optionalLotteryData.getInfosByType(3);e&&0<e.length&&(e.sort(this.onSort),this.list.setData(e))},onSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:void 0},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.optionalLotteryData.getTimeCountDown();if(e<1)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.timeLab.string=game.Lang.get(51900,t)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OptionalLotteryShop,e)}(),function(){var e=void 0;(e=game.ListItem.extends({id:0,moduleId:0,ctor:function(){this._super(1695),this.setSize(608,180)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=17,e.layout.spacingY=-5},setData:function(){var e=this,t=e.skin,a=e.data.getPrizeItems();e.prizeList.setData(a),e.id=e.data.id,e.moduleId=e.data.moduleId;var i=e.data.desc,n=e.data.condition,s=e.data.process,r=e.data.canGet,o=e.data.isGet;t.redPoint2.active=!o&&r,t.processLab.string=o?"":game.Lang.get(1621,s,n),t.getPrize.active=o,t.getBtn.active=!o&&!r,t.recBtn.active=!o&&r,t.nameLab.string=i},getBtn:function(){this.send(game.OptionalLotteryEvts.C_TASK_JUMP_MODULE,this.moduleId)},recBtn:function(){this.send(game.OptionalLotteryEvts.C_TASK_REC,this.id)}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotteryTaskItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1693)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.OptionalLotteryTaskItem,this.list.bindEnum=game.ME.OptionalLottery,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_UPDATA_TASK:case this.Evts.C_UPDATA_RESET_DAILY:this.updataView()}},onShow:function(){this.updataView(),this.createTimer()},updataView:function(){this.list.scrollToTop();var e=game.optionalLotteryData.getInfosByType(5);e&&0<e.length&&(e.sort(this.onSort),this.list.setData(e))},onSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:!e.canGet&&t.canGet?1:e.canGet&&!t.canGet?-1:t.id-e.id},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.optionalLotteryData.getTimeCountDown();if(e<1)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.timeLab.string=game.Lang.get(51900,t)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OptionalLotteryTask,e)}(),function(){var e=void 0;(e=game.ListItem.extends({rechargeId:0,ctor:function(){this._super(1692),this.setSize(608,160)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=17,e.layout.spacingY=-5},setData:function(){var e=this.skin;e.goldNode.active=!1;var t=this.data.getPrizeItems();this.prizeList.setData(t),this.rechargeId=this.data.rechargeId;var a=game.RechargeCfg.getDataById(this.rechargeId),i=this.data.numLimit,n=this.data.buyNum,s=this.data.isGet;s||(e.canBuyLab.string=game.Lang.get(6094,i-n,i),e.getLbl.string=game.Lang.get(53510,a.money)),e.getPrize.active=s,e.getBtn.active=!s,e.canBuyLab.active=!s},getBtn:function(){this.send(game.OptionalLotteryEvts.C_SEND_BUY_GIFT,this.rechargeId)}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotteryValueItem",e)}(),function(){var e=game.View.extends({ctor:function(){this._super(1693)},init:function(){this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this.list.itemRender=game.OptionalLotteryValueItem,this.list.bindEnum=game.ME.OptionalLottery,this.list.layout.spacingY=5,this.list.addToParent(this.skin.list)},notify:function(e){switch(e){case this.Evts.C_UPDATA_VALUE_INFO:this.updataView()}},onShow:function(){this.updataView(),this.createTimer()},updataView:function(){this.list.scrollToTop();var e=game.optionalLotteryData.getInfosByType(4);e&&0<e.length&&(e.sort(this.onSort),this.list.setData(e))},onSort:function(e,t){return!e.isGet&&t.isGet?-1:e.isGet&&!t.isGet?1:void 0},createTimer:function(){this.setCountDown(),this.timer?(this.timer.reset(),this.timer.start()):this.timer=b8e.Timer.add(this,this.setCountDown,1e3)},setCountDown:function(){var e=game.optionalLotteryData.getTimeCountDown();if(e<1)this.clearTimer();else{var t=game.TimeUtil.formatTimeSpace(e,3);this.skin.timeLab.string=game.Lang.get(51900,t)}},clearTimer:function(){this.timer&&(b8e.Timer.remove(this,this.setCountDown),this.timer=null)},onHide:function(){this.clearTimer()},onStageResize:function(){this.setPosition(0,0)}});b8e.module.registerView(game.ME.OptionalLotteryValue,e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1696),this.toggles={btnSelect_1:game.ME.OptionalLotterySelect,btnSelect_2:game.ME.OptionalLotteryValue,btnSelect_3:game.ME.OptionalLotteryShop,btnSelect_4:game.ME.OptionalLotteryTask},this.spotAlerts={OPTION_LOTTERY_LOTTERY:this.dayAlert1,OPTION_LOTTERY_TASK:this.dayAlert2}},dayAlert1:function(e){this.skin.red_piont_4.active=e.alert},dayAlert2:function(e){this.skin.red_piont_1.active=e.alert},init:function(){},notify:function(e,t){switch(e){case this.Evts.SWITCH_PAGE:this.toggleSelect(t),this.updataView(t)}},toggleSelect:function(e){this._super(e)},onShow:function(){this.toggleSelect(0),this.updataView(0)},updataView:function(e){var t=void 0;t=0==e?"opLo_1":"opLo_2";var a=game.ResCfg.getUrl(10215,t);this.skin.banner.loadTexture(a)},onHide:function(){}});b8e.module.registerView(game.ME.OptionalLottery,e)}(),function(){var e=void 0;(e=game.Widget.extends({ctor:function(){this._super(1694),this.setSize(110,140)},init:function(){this.canClick=!1,this._icon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),this._icon.addToParent(this.skin.icon)},onShow:function(){this.setData(this._data)},setData:function(e){if(e&&(this._data=e),this.skin&&e){var t=this._data.getPrizeItems();game.GridUtil.setItemIcon(this._icon,t[0],!1,game.IconLayoutEnum.SHOW_NUM)}}})).poolCall=!0,b8e.RC("$$game","$$OptionalLotteryShowItem",e)}(),function(){var e;e=b8e.Enum({MIBAO_REQUEST_SUCCESS:b8e.enc(),MIBAO_SELECT_LUCKY_AWARD:b8e.enc(),MIBAO_SELECT_ACCESS_TITLE:b8e.enc()}),b8e.RC("$$game","$$MibaoEvts",e)}(),function(){var e=void 0;(e=game.GameBaseMgr.extends({init:function(){this._super(),this.moduleEnum=game.ME.Mibao,this.moduleData=game.mibaoData,this.mibaoAlert=game.spotAlert.set(game.SAE.MIBAO,game.SAE.HOME),this.mibaoChangeAlert=game.spotAlert.set(game.SAE.MIBAO_CHANGE,game.SAE.MIBAO),this.mibaoTaskAlert=game.spotAlert.set(game.SAE.MIBAO_TASK,game.SAE.MIBAO),this.mibaoScoreAlert=game.spotAlert.set(game.SAE.MIBAO_SCORE,game.SAE.MIBAO)},_addEvents:function(){var e=this;e.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,e.updateItemInfo),e.addEventByModule(game.ME.OpenServer,game.OpenServerEvts.C2C_INIT_OPENSERVER,e.initMibaoData),e.addEventByModule(game.ME.MainRole,game.MainRoleEvts.C_RESET_DAILY,e.resetDaily),e.addEventByModule(game.ME.Recharge,game.RechargeEvts.C_RECHARGE_SUCCESS,e.rechargeSuccess),e.addListenerPb(game.protoId.MibaoResp,e.mibaoResp),e.addListenerPb(game.protoId.MibaoTaskResp,e.mibaoTaskResp),e.addListenerPb(game.protoId.MibaoBuyGiftResp,e.mibaoBuyGiftResp),e.addListenerPb(game.protoId.MibaoScoreAwardResp,e.mibaoScoreAwardResp),e.addListenerPb(game.protoId.MibaoTaskProcessMsg,e.mibaoTaskProcessMsg),e.addListenerPb(game.protoId.MibaoLuckyAwardResp,e.mibaoLuckyAwardResp)},triggerOpen:function(e){e==game.ME.Mibao&&this.checkAllAlert()},updateItemInfo:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&game.mibaoData.curCfg&&this.checkChangeAlert()},initMibaoData:function(e){if(e&&e.data){this.moduleData.initActivityData(e.data),game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkAllAlert()}},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(game.mibaoData.resetDaily(),this.checkAllAlert(),b8e.evt.dptG(game.ActiveBarGEvts.REFRESH_BTNS))},rechargeSuccess:function(e){if(e&&e.data){this.moduleData.rechargeSuccess(e.data),this.moduleData.repeatedRechargeInfo&&this.checkTaskAlert()}},mibaoResp:function(e){var t=e.readProtobuf(game.pb.MibaoResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.score,i=t.item;this.moduleData.setScore(a),game.awardsData.setItemsByArray(i,!1),game.module.show(game.ME.AwardShowTip),this.send(game.MibaoEvts.MIBAO_REQUEST_SUCCESS),this.checkScoreAlert()}},mibaoTaskResp:function(e){var t=e.readProtobuf(game.pb.MibaoTaskResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.taskId;this.moduleData.completeMibaoTask(a),this.checkTaskAlert()}},mibaoBuyGiftResp:function(e){var t=e.readProtobuf(game.pb.MibaoBuyGiftResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.giftId;this.moduleData.buyMibaoGift(a)}},mibaoScoreAwardResp:function(e){var t=e.readProtobuf(game.pb.MibaoScoreAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.scoreId;this.moduleData.exchangeScoreAward(a),this.checkScoreAlert()}},mibaoTaskProcessMsg:function(e){var t=e.readProtobuf(game.pb.MibaoTaskNotify).task;this.moduleData.updateTaskProcess(t),this.checkTaskAlert()},mibaoLuckyAwardResp:function(e){var t=e.readProtobuf(game.pb.MibaoLuckyAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.awardId;this.moduleData.updateMibaoLuckyAward(a),this.send(game.MibaoEvts.MIBAO_SELECT_LUCKY_AWARD),game.notice.show(53576),game.module.hide(game.ME.MibaoExpect)}},selectAccessTitle:function(e,t){this.moduleData.selectAccessTitle(e)&&this.send(game.MibaoEvts.MIBAO_SELECT_ACCESS_TITLE,t)},expectItem:function(){var e=this.moduleData.tempExpectId,t=this.moduleData.mibaoLuckySelect;e&&t!=e?this.mibaoLuckyAwardReq(e):game.notice.show(53577)},buyGift:function(e){this.noticeAlert||(this.noticeAlert={lang:53579,btn:game.Lang.get(53580),key:game.AlertKey.HUNTING_CONTEST,okcb:this.sureBuy,thisArg:this,args:[],langArgs:[],showtips:!0,defaultSelect:!0,align:b8e.HorizontalAlign.CENTER}),0!=e.currentPrice?(this.noticeAlert.args[0]=e,this.noticeAlert.langArgs[0]=e.currentPrice,game.alert.show(this.noticeAlert)):this.mibaoBuyGiftReq(e.id)},sureBuy:function(e){e&&(game.amount.get(game.AmountType.YUAN_BAO)<e.currentPrice?game.notice.show(116):this.mibaoBuyGiftReq(e.id))},checkAllAlert:function(){this.checkChangeAlert(),this.checkTaskAlert(),this.checkScoreAlert()},checkChangeAlert:function(){this.mibaoChangeAlert.alert=this.moduleData.checkChangeAlert()},checkTaskAlert:function(){this.mibaoTaskAlert.alert=this.moduleData.checkTaskAlert(),this.moduleData.taskTitleInfo&&(this.moduleData.taskTitleInfo.alert=this.mibaoTaskAlert.alert)},checkScoreAlert:function(){this.mibaoScoreAlert.alert=this.moduleData.checkScoreAlert(!0)},mibaoReq:function(e){var t=game.pb.MibaoRequest;t.types=e,this.sendPb(game.protoId.MibaoReq,t)},mibaoTaskReq:function(e){var t=game.pb.MibaoTaskRequest;t.taskId=e,this.sendPb(game.protoId.MibaoTaskReq,t)},mibaoBuyGiftReq:function(e){var t=game.pb.MibaoBuyGiftRequest;t.giftId=e,this.sendPb(game.protoId.MibaoBuyGiftReq,t)},mibaoScoreAwardReq:function(e){var t=game.pb.MibaoScoreAwardRequest;t.scoreId=e,this.sendPb(game.protoId.MibaoScoreAwardReq,t)},mibaoLuckyAwardReq:function(e){var t=game.pb.MibaoLuckyAwardRequest;t.awardId=e,this.sendPb(game.protoId.MibaoLuckyAwardReq,t)}}))._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$MibaoMgr",e)}(),function(){var e,t=e=b8e.PoolObject.extends({titleUrl:"",select:!1,titleIndex:-1,moduleEnum:0,alert:!1,setData:function(e,t,a){this.select=!1,this.titleIndex=e,this.moduleEnum=a,this.titleType=t,this.titleUrl=game.ResCfg.getUrl(10216,t)},recycle:function(){this.reset(),this._super()},reset:function(){this.titleUrl="",this.titleIndex=-1,this.select=!1,this.moduleEnum=0,this.alert=!1}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MibaoAccessTitleInfo",e)}(),function(){var e,t=e=b8e.PoolObject.extends({cashCfg:null,_buyCount:0,buyCount:{get:function(){return this._buyCount},set:function(e){this._buyCount=e}},sortId:-1,isBuyAll:!1,setData:function(e){this.cashCfg=e,this.sortId=e.sortId},setBuyCount:function(e){this.buyCount=e,this.isBuyAll=!(!this.cashCfg||this.cashCfg.numLimit<1)&&this.buyCount>=this.cashCfg.numLimit},rechargeSuccess:function(){this.setBuyCount(this.buyCount+1)},getAwardList:function(){if(this.cashCfg){var e=this.awardList;if(e&&0<e.length)return e;var t=this.przieListInfo;return t=t||(this.przieListInfo=game.CfgUtil.getPrizeListInfo(this.cashCfg.awards)),this.awardList=t.items,this.awardList}},recycle:function(){this.reset(),this._super()},reset:function(){this.cashCfg=null,this.sortId=0,this.isBuyAll=!1,this.awardList=null,this.buyCount=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MibaoCashInfo",e)}(),function(){var e=b8e.Object.extends({curSlectTitleIndex:0,curId:0,curCfg:null,mibaoLuckySelect:0,tempExpectId:0,mibaoScore:0,repeatedRechargeInfo:null,ctor:function(){this._super()},initActivityData:function(e){var t=this;if(t.setCurOpenCfg(),t.curCfg){t.mibaoScore=e.mibaoScore,t.mibaoLuckySelect=e.mibaoLuckySelect;var a=e.mibaoTasks;if(a&&0<a.length){t.setupTaskList();for(var i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=a.length,u=e.mibaoTaskRecords,l=0;l<g;l++)if(s=a[l],(r=t.taskTypeMap.get(s.taskType))&&0<r.length)for(n=r.length,i=0;i<n;i++)(o=r[i]).setServerData(s),o.isGet=-1<u.indexOf(o.id)}var c=e.mibaoNormalGifts;if(c&&0<c.length){t.setupGiftList();for(var h=void 0,m=void 0,d=c.length,f=0;f<d;f++)m=c[f],(h=t.giftInfoMap.get(m.giftId))&&h.setBuyCount(m.times)}var p=e.mibaoCashGifts;if(p&&0<p.length){t.setupCashList();for(var v=void 0,E=void 0,T=p.length,C=0;C<T;C++)E=p[C],(v=t.cashInfoMap.get(E.giftId))&&v.setBuyCount(E.times)}var I=e.mibaoScoreExchange;if(I&&0<I.length){t.setupScoreList();for(var S=void 0,_=I.length,A=0;A<_;A++)(S=t.scoreInfoMap.get(I[A]))&&(S.isGet=!0)}(0<e.mibaoRepeatedRecharge||0<e.mibaoRechargeTotal)&&(t.setupTaskList(),t.repeatedRechargeInfo&&t.repeatedRechargeInfo.setRechargeServerData(e.mibaoRepeatedRecharge,e.mibaoRechargeTotal))}},setCurOpenCfg:function(){var e=game.MibaoOpenCfg.getDatas();if(e&&!(e.length<1)){var t=void 0,a=e.length;this.curCfg=null;for(var i=0;i<a;i++)if(t=e[i],this.checkOpenByCfg(t)){this.curCfg=t;break}}},checkOpenByCfg:function(e){if(!e)return!1;var t=game.miscData.openServerDay;if(!e.startTime)return t>=e.serverStart&&t<e.serverEnd;var a=game.SysTime.curTime,i=b8e.TimeUtil.dateParse(e.startTime,"yyyy-MM-dd hh:mm:ss").getTime(),n=b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime(),s=game.TimeUtil.getOpenDayByStr(e.startTime);return i<=a&&a<n&&s>=e.serverStart&&s<e.serverEnd},resetDaily:function(){var e=this,t=e.curCfg?e.curCfg.id:0;if(e.setCurOpenCfg(),e.curCfg&&t==e.curCfg.id){if(e.setupTaskList(),e.taskList&&0<e.taskList.length)for(var a=e.taskList.length,i=0;i<a;i++)e.taskList[i].resetDailyData()}else e.curCfg&&(e.clearCashList(),e.clearExpectList(),e.clearTaskList(),e.clearGiftList(),e.clearScoreList(),e.clearTitleList(),e.mibaoScore=0,e.mibaoLuckySelect=0,e.curSlectTitleIndex=0,e.repeatedRechargeInfo=null,e.taskTitleInfo=null,e.endTime=0)},checkOpen:function(){return this.isInitOpen||(this.isInitOpen=!0,this.setCurOpenCfg()),!!this.curCfg},setScore:function(e){this.mibaoScore=e},rechargeSuccess:function(e){if(e){var t=game.RechargeCfg.getDataById(e.id);if(this.repeatedRechargeInfo){var a=e.money?e.money:t.money;this.repeatedRechargeInfo.rechargeSuccess(a)}if(t&&t.rechargeType==game.RechargeType.MIBAO_PRIZE){var i=this.cashInfoMap.get(e.id);i&&i.rechargeSuccess()}}},completeMibaoTask:function(e){var t=this.taskInfoMap.get(e);t&&(t.taskCfg&&t.taskCfg.taskType==game.MibaoTaskType.RepeatedRecharge?t.completeRepeatedRechargeTask():t.isGet=!0)},buyMibaoGift:function(e){var t=this.giftInfoMap.get(e);t&&t.buyMibaoGift()},exchangeScoreAward:function(e){var t=this.scoreInfoMap.get(e);t&&(t.isGet=!0)},updateTaskProcess:function(e){if(this.taskTypeMap){var t=this.taskTypeMap.get(e.taskType);if(t&&0<t.length)for(var a=t.length,i=0;i<a;i++)t[i].setServerData(e)}},updateMibaoLuckyAward:function(e){var t=this.expectInfoMap.get(this.mibaoLuckySelect);t&&(t.select=!1),(t=this.expectInfoMap.get(e))&&(t.select=!0),this.mibaoLuckySelect=e},selectExpectId:function(e){var t=this.expectInfoMap.get(this.mibaoLuckySelect);t&&(t.select=!1),(t=this.expectInfoMap.get(this.tempExpectId))&&(t.select=!1),(t=this.expectInfoMap.get(e))&&(t.select=!0),this.tempExpectId=e},resetExpectList:function(){var e=this.expectInfoMap.get(this.mibaoLuckySelect);e&&(e.select=!0),(e=this.expectInfoMap.get(this.tempExpectId))&&(e.select=!1),this.tempExpectId=0},getEndTime:function(){if(0<this.endTime)return this.endTime;var e=this.curCfg;if(!e)return 0;var t=void 0,a=game.SysTime.curTime;return t=""==e.startTime?b8e.TimeUtil.getNextDateTime(a,e.serverEnd-game.miscData.openServerDay):b8e.TimeUtil.dateParse(e.endTime,"yyyy-MM-dd hh:mm:ss").getTime(),this.endTime=t},getCountDown:function(){return this.getEndTime()-game.SysTime.curTime},getExpectItemId:function(){return this.mibaoLuckySelect},getAccessTitleList:function(){var e=this,t=e.curCfg;if(!t)return null;var a=e.titleList;return a&&0<a.length?(a[0].select=!0,e.curSlectTitleIndex&&(a[e.curSlectTitleIndex].select=!1),e.curSlectTitleIndex=0):(a=a||(e.titleList=[]),t.openTask&&(e.setTitleInfo(a,1,game.ME.MibaoTask),e.taskTitleInfo=a[a.length-1]),t.openGift&&e.setTitleInfo(a,2,game.ME.MibaoGift),t.openCash&&e.setTitleInfo(a,3,game.ME.MibaoCash),0<a.length&&(a[0].select=!0,e.curSlectTitleIndex=0)),a},setTitleInfo:function(e,t,a){var i=e.length;e[i]=game.MibaoAccessTitleInfo.get(),e[i].setData(i,t,a)},clearTitleList:function(){var e=this.titleList;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0}},selectAccessTitle:function(e){if(e==this.curSlectTitleIndex)return!1;var t=this.titleList;return!(!t||t.length<1||!t[e])&&(t[this.curSlectTitleIndex].select=!1,t[e].select=!0,this.curSlectTitleIndex=e,!0)},getCashList:function(){return this.setupCashList(),!this.cashList||this.cashList.length<1?null:(this.cashList.sort(this.onListSort),this.cashList)},onListSort:function(e,t){return e.isBuyAll==t.isBuyAll?e.isBuyAll?e.sortId-t.sortId:t.sortId-e.sortId:e.isBuyAll?1:-1},setupCashList:function(){var e=this.curCfg;if(e){var t=this.cashList;if(!(t&&0<t.length)){var a=game.MibaoCashCfg.getData(e.id,!0);if(a&&!(a.length<1)){var i=this.cashInfoMap;i=i||(this.cashInfoMap=b8e.HashMap.get()),t=t||(this.cashList=[]);for(var n=void 0,s=void 0,r=a.length,o=0;o<r;o++){if(!(n=a[o]))return;(s=t[o]=game.MibaoCashInfo.get()).setData(n),i.set(n.rechargeId,s)}}}}},clearCashList:function(){var e=this.cashList;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0,this.cashInfoMap.clear()}},getExpectList:function(){return this.setupExpectList(),!this.expectList||this.expectList.length<1?null:this.expectList},setupExpectList:function(){var e=this.curCfg;if(!e)return null;var t=this.expectList;if(t&&0<t.length)return t;var a=this.expectInfoMap;a=a||(this.expectInfoMap=b8e.HashMap.get());var i=this.getStoreCfgsByStoreId(e.luckyStore);if(!i||i.length<1)return null;t=t||(this.expectList=[]);for(var n=void 0,s=void 0,r=i.length,o=0;o<r;o++)n=i[o],(s=t[o]=game.MibaoExpectInfo.get()).setData(n,this.mibaoLuckySelect),a.set(n.awardId,s);t.sort(this.onExpectListSort)},clearExpectList:function(){var e=this.expectList;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0,this.expectInfoMap.clear()}},onExpectListSort:function(e,t){return e.sortId-t.sortId},getStoreCfgsByStoreId:function(e){return this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.storeId=e,game.MibaoStoreCfg.getData(this.cfgObj,!0)},getStoreCfgByAwardId:function(e){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.awardId=e,game.MibaoStoreCfg.getData(this.cfgObj2)},getGiftList:function(){return this.setupGiftList(),!this.giftList||this.giftList.length<1?null:(this.giftList.sort(this.onListSort),this.giftList)},setupGiftList:function(){var e=this.curCfg;if(e){var t=this.giftList;if(!(t&&0<t.length)){var a=game.MibaoGiftCfg.getData(e.id,!0);if(a&&!(a.length<1)){var i=this.giftInfoMap;i=i||(this.giftInfoMap=b8e.HashMap.get()),t=t||(this.giftList=[]);for(var n=void 0,s=void 0,r=a.length,o=0;o<r;o++){if(!(n=a[o]))return;(s=t[o]=game.MibaoGiftInfo.get()).setData(n),i.set(n.id,s)}}}}},clearGiftList:function(){var e=this.giftList;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0,this.giftInfoMap.clear()}},getRankAwardList:function(e){var t=this.curCfg;if(!t)return null;var a=t.raceRankId,i=this.rankAwardMap,n=(i=i||(this.rankAwardMap=b8e.HashMap.get())).get(a);n||(n=b8e.HashMap.get(),i.set(a,n));var s=n.get(e);if(s)return s;var r=game.openCompetitionData.getRaceRankAwardCfgById(a);if(!r||r.length<1)return null;var o=void 0,g=void 0,u=void 0;s=null;for(var l=r.length,c=0;c<l;c++)if((u=(o=r[c]).startRank)==(g=o.endRank)&&u==e||u!=g&&u<=e&&e<=g){s=(s=n.get(u))||game.CfgUtil.getPrizeListInfo(o.award).items,n.set(e,s);break}return s},getRankList:function(){var e=this.curCfg;if(!e)return null;var t=game.openCompetitionData.getRaceRankAwardCfgById(e.raceRankId);if(!t||t.length<1)return null;t.sort(this.onAwardCfgSort);var a=t[t.length-1].endRank;return game.raceRankData.makeRankListCompleteByRank(a,e.raceRankId)},onAwardCfgSort:function(e,t){return e.endRank-t.endRank},getMineRank:function(){var e=this.curCfg;return e?game.raceRankData.getSelfRank(e.raceRankId):""},getMineScore:function(){return this.mibaoScore},getScoreList:function(){return this.setupScoreList(),!this.scoreList||this.scoreList.length<1?null:(this.checkScoreAlert(),this.scoreList.sort(this.onScoreListSort),this.scoreList)},onScoreListSort:function(e,t){return e.canGet==t.canGet?e.isGet==t.isGet&&1==e.isGet?t.sortId-e.sortId:e.sortId-t.sortId:e.canGet?-1:1},setupScoreList:function(){var e=this.curCfg;if(e){var t=this.scoreList;if(!(t&&0<t.length)){var a=game.MibaoScoreCfg.getData(e.id,!0);if(a&&!(a.length<1)){var i=this.scoreInfoMap;i=i||(this.scoreInfoMap=b8e.HashMap.get()),t=t||(this.scoreList=[]);for(var n=void 0,s=void 0,r=a.length,o=0;o<r;o++){if(!(n=a[o]))return;(s=t[o]=game.MibaoScoreInfo.get()).setData(n),i.set(n.id,s)}}}}},clearScoreList:function(){var e=this.scoreList;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0,this.scoreInfoMap.clear()}},getTaskList:function(){return this.setupTaskList(),!this.taskList||this.taskList.length<1?null:(this.taskList.sort(this.onTaskListSort),this.taskList)},onTaskListSort:function(e,t){return e.canGet==t.canGet||e.isGet==t.isGet?e.sortId-t.sortId:e.isGet?1:t.isGet?-1:e.canGet?-1:1},setupTaskList:function(){var e=this.curCfg;if(e){var t=this.taskList;if(!(t&&0<t.length)){var a=game.MibaoTaskCfg.getData(e.id,!0);if(a&&!(a.length<1)){var i=this.taskTypeMap;i=i||(this.taskTypeMap=b8e.HashMap.get());var n=this.taskInfoMap;n=n||(this.taskInfoMap=b8e.HashMap.get()),t=t||(this.taskList=[]);for(var s=void 0,r=void 0,o=void 0,g=a.length,u=0;u<g;u++){if(!(s=a[u]))return;(r=t[u]=game.MibaoTaskInfo.get()).setData(s),s.taskType==game.MibaoTaskType.RepeatedRecharge&&(this.repeatedRechargeInfo=r),(o=i.get(s.taskType))||(o=[],i.set(s.taskType,o)),n.set(s.id,r),o[o.length]=r}}}}},clearTaskList:function(){var e=this.taskList;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0,this.taskTypeMap.clear(),this.taskInfoMap.clear()}},checkChangeAlert:function(){return!!this.curCfg&&game.UpgradeUtil.checkItemInfo(this.curCfg.costItemId,1,!1)},checkTaskAlert:function(){this.setupTaskList();var e=this.taskList;if(!e||e.length<1)return!1;for(var t=void 0,a=e.length,i=0;i<a;i++)if((t=e[i]).canGet&&!t.isGet)return!0;return!1},checkScoreAlert:function(e){this.setupScoreList();var t=this.scoreList;if(!t||t.length<1)return!1;for(var a=!1,i=t.length,n=0;n<i;n++)if((a=t[n].checkAlert(this.mibaoScore))&&e)return a;return a}});game.mibaoData=game.mibaoData||new e}(),function(){var e,t=e=b8e.PoolObject.extends({select:!1,sortId:0,setData:function(e,t){this.storeCfg=e,this.sortId=e.sortId,this.awardId=e.awardId,this.select=this.awardId==t},getPrizeInfo:function(){var e=this.storeCfg;if(!e||!e.giveItems||e.giveItems.length<1)return null;var t=e.giveItems[0];return this.prizeInfo||(this.prizeInfo=new game.PrizeInfo),this.prizeInfo.setData(t.Id,t.Num),this.prizeInfo},recycle:function(){this.reset(),this._super()},reset:function(){this.select=!1,this.sortId=0,this.storeCfg=null}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MibaoExpectInfo",e)}(),function(){var e,t=e=b8e.PoolObject.extends({giftCfg:null,buyCount:0,sortId:0,isBuyAll:!1,setData:function(e){this.giftCfg=e,this.sortId=e.sortId},setBuyCount:function(e){this.buyCount=e,this.isBuyAll=!(!this.giftCfg||this.giftCfg.limitTimes<1)&&this.buyCount>=this.giftCfg.limitTimes},buyMibaoGift:function(){this.setBuyCount(this.buyCount+1)},getAwardList:function(){if(this.giftCfg){var e=this.awardList;if(e&&0<e.length)return e;var t=this.przieListInfo;return t=t||(this.przieListInfo=game.CfgUtil.getPrizeListInfo(this.giftCfg.award)),this.awardList=t.items,this.awardList}},recycle:function(){this.reset(),this._super()},reset:function(){this.giftCfg=null,this.sortId=0,this.isBuyAll=!1,this.awardList=null,this.buyCount=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MibaoGiftInfo",e)}(),function(){var e,t=e=b8e.PoolObject.extends({sortId:0,score:0,isGet:!1,canGet:!1,setData:function(e){this.scoreCfg=e,this.sortId=e.sortId,this.id=e.id},getAwardCfg:function(){var e=this.scoreCfg;if(!e||!e.award||e.award.length<1)return null;var t=e.award[0];return this.prizeInfo||(this.prizeInfo=new game.PrizeInfo),this.prizeInfo.setData(t.Id,t.Num),this.prizeInfo},checkAlert:function(e){return this.score=e,this.canGet=!this.scoreCfg||this.score>=this.scoreCfg.score,this.canGet&&!this.isGet},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.isGet=!1,this.canGet=!1,this.sortId=0,this.scoreCfg=null,this.score=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MibaoScoreInfo",e)}(),function(){var e,t=e=b8e.PoolObject.extends({sortId:0,score:0,isGet:!1,canGet:!1,canGetCount:0,rechargeMoney:0,mibaoRepeatedRecharge:0,dailyProcess:0,totalProcess:0,setData:function(e){this.taskCfg=e,this.sortId=e.sortId,this.id=e.id,this.isDaily=e.isDaily},setServerData:function(e){this.dailyProcess=e.dailyProcess,this.totalProcess=e.totalProcess;var t=this.taskCfg?this.taskCfg.condition:0;this.canGet=this.isDaily?this.dailyProcess>=t:this.totalProcess>=t},setRechargeServerData:function(e,t){this.rechargeMoney=t,this.mibaoRepeatedRecharge=e;var a=this.taskCfg?this.taskCfg.condition:0;a?(this.canGetCount=this.rechargeMoney/a-e|0,this.canGet=0<this.canGetCount):b8e.warn("\u91cd\u590d\u5145\u503c\u4efb\u52a1\u6ca1\u6709\u914d\u7f6e\u6761\u4ef6")},completeRepeatedRechargeTask:function(){this.mibaoRepeatedRecharge=this.mibaoRepeatedRecharge+this.canGetCount,this.canGetCount=0,this.canGet=!1},rechargeSuccess:function(e){this.setRechargeServerData(this.mibaoRepeatedRecharge,this.rechargeMoney+e)},resetDailyData:function(){this.isDaily&&(this.dailyProcess=0,this.canGet=!1,this.isGet=!1)},getAwardList:function(){if(this.taskCfg){var e=this.awardList;if(e&&0<e.length)return e;var t=this.przieListInfo;return t=t||(this.przieListInfo=game.CfgUtil.getPrizeListInfo(this.taskCfg.award)),this.awardList=t.items,this.awardList}},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.id=0,e.isGet=!1,e.canGet=!1,e.sortId=0,e.taskCfg=null,e.awardList=null,e.canGetCount=0,e.rechargeMoney=0,e.score=0,e.dailyProcess=0,e.totalProcess=0,e.mibaoRepeatedRecharge=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$MibaoTaskInfo",e)}(),function(){var e;e=b8e.Enum({None:0,RepeatedRecharge:1,Barbarian:2,Explore:3,QuanminBoss:4,MaterialIns:5,QuickBattle:6,GuildIns:7}),b8e.RC("$$game","$$MibaoTaskType",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1673),this.setSize(106,138)},setData:function(){var e=this.skin,t=this.data;e.title.loadTexture(t.titleUrl),e.selectImg.active=t.select,e.alert.active=t.alert},clickBtn:function(){var e=this.data;game.MibaoMgr.inst().selectAccessTitle(e.titleIndex,e.moduleEnum)}}),b8e.RC("$$game","$$MibaoAccessTitleItem",e)}(),function(){var e=game.GamePanel.extends({lastTitleIndex:-1,ctor:function(){this._super(1674)},init:function(){var e=this.titleList=new game.List(b8e.LayoutType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.MibaoAccessTitleItem,e.addToParent(this.skin.list),e.layout.paddingLeft=20,e.layout.spacingX=20},onShow:function(){this.registerEvents();var e=game.mibaoData.getAccessTitleList();this.titleList.setData(e),e&&0<e.length&&this.selectTitle(e[0].moduleEnum)},onHide:function(){0<this.lastModuleEnum&&(game.GameViewMgr.inst().hideView(this.lastModuleEnum),this.lastModuleEnum=-1),this.titleList.setData(null),this.unRegisterEvents()},registerEvents:function(){game.MibaoMgr.inst().addEvent(game.MibaoEvts.MIBAO_SELECT_ACCESS_TITLE,this.selectTitleByMgr,this)},unRegisterEvents:function(){game.MibaoMgr.inst().removeEvent(game.MibaoEvts.MIBAO_SELECT_ACCESS_TITLE,this.selectTitleByMgr,this)},selectTitleByMgr:function(e){e&&e.data&&this.selectTitle(e.data)},selectTitle:function(e){this.lastModuleEnum!=e&&(0<this.lastModuleEnum&&game.GameViewMgr.inst().hideView(this.lastModuleEnum),0<e&&(this.lastModuleEnum=e,game.GameViewMgr.inst().showView(e,this.moduleEnum||this)))}});b8e.app.registerView(game.ME.MibaoAccess,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1675),this.setSize(600,176)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=30,e.layout.paddingLeft=0},setData:function(){var e=this.skin,t=this.data,a=this.cashCfg=t.cashCfg;if(a){var i=t.isBuyAll;e.buyBtn.active=!i,e.buyAllImg.active=i;var n=t.getAwardList();this.prizeList.setData(n),e.originalPrice.string=game.Lang.get(53581,a.originalPrice),e.redLine.width=e.originalPrice.width,e.currentPrice.x=e.originalPrice.x+e.originalPrice.width+50,e.currentPrice.string=game.Lang.get(53582,a.currentPrice);var s=t.buyCount,r=a.numLimit>s?53583:53584;e.canBuyCount.string=game.Lang.get(r,s,a.numLimit)}},buyBtn:function(){if(this.cashCfg){var e=b8e.module.getControl(game.ME.Recharge);e?e.recharge(this.cashCfg.rechargeId):b8e.warn("\u5145\u503c\u7684control\u6ca1\u6709\u6ce8\u518c")}}}),b8e.RC("$$game","$$MibaoCashItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1676)},init:function(){var e=this.cashList=new game.List;e.itemRender=game.MibaoCashItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.spacingY=15,this.skin.tips.string=game.Lang.get(53585)},onShow:function(){var e=game.mibaoData.getCashList();this.cashList.setData(e)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.MibaoCash,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1677),this.setSize(110,125)},setData:function(){var e=this,t=e.data.getPrizeInfo();t&&(e.itemIcon||(e.itemIcon=game.GridUtil.createItemIcon(),e.itemIcon.addToParent(e.skin.icon),e.itemIcon.setClickCb(e.clickBtn,e)),game.GridUtil.setItemIcon(e.itemIcon,t,!1,game.IconLayoutEnum.SHOW_ALL),e.skin.selectImg.active=e.data.select)},clickBtn:function(){var e=this.data;e.select||game.mibaoData.selectExpectId(e.awardId)}}),b8e.RC("$$game","$$MibaoExpectItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1678)},init:function(){var e=this.itemList=new game.List(b8e.LayoutType.Vertical,b8e.LayoutType.Grid);e.itemRender=game.MibaoExpectItem,e.addToParent(this.skin.list),e.layout.paddingLeft=10,e.layout.spacingX=20,e.layout.spacingY=15},onShow:function(){var e=game.mibaoData.getExpectList();this.itemList.setData(e)},onHide:function(){game.mibaoData.resetExpectList()},expectBtn:function(){game.MibaoMgr.inst().expectItem()}});b8e.app.registerView(game.ME.MibaoExpect,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1679),this.setSize(600,176)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=30,e.layout.paddingLeft=0},setData:function(){var e=this.skin,t=this.data,a=this.giftCfg=t.giftCfg;if(a){var i=t.isBuyAll;e.buyBtn.active=!i,e.buyAllImg.active=i;var n=t.getAwardList();this.prizeList.setData(n),e.originalPrice.string=game.Lang.get(53586,a.originalPrice),e.redLine.width=e.originalPrice.width,e.currentPrice.x=e.originalPrice.x+e.originalPrice.width+50,e.currentPrice.string=game.Lang.get(53587,a.currentPrice);var s=t.buyCount,r=a.limitTimes>s?53583:53584;e.canBuyCount.string=game.Lang.get(r,s,a.limitTimes)}else b8e.warn("\u6ca1\u6709\u53ef\u663e\u793a\u7684\u793c\u5305\u914d\u7f6e")},buyBtn:function(){this.giftCfg&&game.MibaoMgr.inst().buyGift(this.giftCfg)}}),b8e.RC("$$game","$$MibaoGiftItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1676)},init:function(){var e=this.giftList=new game.List;e.itemRender=game.MibaoGiftItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.spacingY=15},onShow:function(){var e=game.mibaoData.getGiftList();this.giftList.setData(e)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.MibaoGift,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1680),this.setSize(490,124)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=30,e.layout.paddingLeft=0},setData:function(){var e=this.data,t=this.skin,a=e.rank;t.rank_1.active=1==a,t.rank_2.active=2==a,t.rank_3.active=3==a,t.rank.active=t.rank_4.active=3<a,t.rank.string=a,t.name.string=e.name,t.score.string=0<e.score?game.CCommonUtil.replaceNum(e.score):"";var i=game.mibaoData.getRankAwardList(a);this.prizeList.setData(i),this.skin.list.x=i&&1<i.length?428:463}}),b8e.RC("$$game","$$MibaoRankItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1681)},init:function(){var e=this.rankList=new game.List;e.itemRender=game.MibaoRankItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.spacingY=15,this.skin.tips.string=game.Lang.get(53588,+game.CfgUtil.getMiscValue(game.MibaoMiscCfg,"mibaoRankScore"))},onShow:function(){this.registerEvents();var e=game.mibaoData.curCfg;if(e){var t=b8e.module.getControl(game.ME.Rank);t?(this.requestObj||(this.requestObj=b8e.createMap()),this.requestObj.data=e.raceRankId,t.onReqRaceRankInfo(this.requestObj)):b8e.warn("\u6392\u884c\u699c\u7684control\u6ca1\u6709\u6ce8\u518c")}else b8e.warn("\u5f53\u524d\u6ca1\u6709\u6b63\u5728\u8fdb\u884c\u7684\u6d3b\u52a8")},onHide:function(){this.unRegisterEvents()},registerEvents:function(){this.addEventByModule(game.ME.Rank,game.RankEvts.C2C_GET_RACE_RANK_INFO,this.setData)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Rank,game.RankEvts.C2C_GET_RACE_RANK_INFO,this.setData)},setData:function(){var e=this.skin,t=game.mibaoData,a=t.getRankList();this.rankList.setData(a);var i=0<t.getMineRank()?53589:53590;e.mineRank.string=game.Lang.get(i,t.getMineRank()),e.mineScore.string=game.Lang.get(53591,t.getMineScore())}});b8e.app.registerView(game.ME.MibaoRank,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1682),this.setSize(490,144)},init:function(){this.icon=game.GridUtil.createItemIcon(),this.icon.addToParent(this.skin.itemIcon)},setData:function(){var e=this.skin,t=this.data,a=t.scoreCfg,i=t.getAwardCfg();if(i){this.icon.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NUM);var n=game.ItemInfoCfg.getData(i.id);n&&(e.itemName.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name))}var s=a.score;e.countLab.string=game.Lang.get(53592,s);var r=t.canGet||t.isGet?53593:53594;e.countDesc.string=game.Lang.get(r,t.score,s),e.isGetImg.active=t.isGet,e.getBtn.active=t.canGet&&!t.isGet,e.cantGetBtn.active=!t.canGet,e.countDesc.active=!t.isGet},getBtn:function(){game.MibaoMgr.inst().mibaoScoreAwardReq(this.data.id)}}),b8e.RC("$$game","$$MibaoScoreAwardItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1683)},init:function(){var e=this.awardList=new game.List;e.itemRender=game.MibaoScoreAwardItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.spacingY=15},onShow:function(){var e=game.mibaoData.getScoreList();this.awardList.setData(e)},onHide:function(){}});b8e.app.registerView(game.ME.MibaoScoreAward,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1684),this.setSize(600,176)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.list),e.layout.spacingX=30,e.layout.paddingLeft=0},setData:function(){var e=this.skin,t=this.data,a=this.taskCfg=t.taskCfg;if(a){var i=a.taskType==game.MibaoTaskType.RepeatedRecharge;e.rechargeMoney.active=i,e.canGetCount.active=i;var n=t.canGet,s=t.isGet;if(e.gotoBtn.active=!n,e.getImg.active=n&&s,e.getBtn.active=n&&!s,i)e.rechargeMoney.string=game.Lang.get(53595,t.rechargeMoney),e.canGetCount.string=game.Lang.get(53596,t.canGetCount),e.desc.string=game.Lang.get(a.desc,a.condition);else{var r=a.isDaily?t.dailyProcess:t.totalProcess;r=r>=a.condition?game.HtmlUtil.getText(game.Color.GREEN,r):game.HtmlUtil.getText(game.Color.RED,r),e.desc.string=game.Lang.get(a.desc,a.condition,r,a.condition)}var o=t.getAwardList();this.prizeList.setData(o)}else b8e.warn("\u6ca1\u6709\u53ef\u663e\u793a\u7684\u4efb\u52a1\u914d\u7f6e")},gotoBtn:function(){var e=this.taskCfg;e&&e.moduleId&&(7!=e.taskType||0!=game.guildData.id?e.toggleId?game.module.showToggle(e.moduleId,e.toggleId):game.module.show(e.moduleId):game.notice.show(53578))},getBtn:function(){this.taskCfg&&game.MibaoMgr.inst().mibaoTaskReq(this.taskCfg.id)}}),b8e.RC("$$game","$$MibaoTaskItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1676)},init:function(){var e=this.taskList=new game.List;e.itemRender=game.MibaoTaskItem,e.addToParent(this.skin.list),e.layout.paddingLeft=0,e.layout.spacingY=15},onShow:function(){var e=game.mibaoData.getTaskList();this.taskList.setData(e)},onHide:function(){},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.MibaoTask,e)}(),function(){var e=game.GamePanel.extends({curId:0,ctor:function(){this._super(1685)},init:function(){var e=this;e.leftCostNodeX=e.skin.leftCostNode.x,e.rightCostNodeX=e.skin.rightCostNode.x,e.skin.emptyIcon.isButton=!1,e.skin.leftCostIcon.isButton=!1,e.skin.rightCostIcon.isButton=!1,e.spotAlerts={MIBAO_TASK:e.taskAlert,MIBAO_SCORE:e.scoreAlert}},onShow:function(){var e=this.curMibaoCfg=game.mibaoData.curCfg;e?(this.curId=e.id,this.skin.topDesc.loadTexture(game.ResCfg.getUrl(10217,e.text)),this.updateEndTime(),this.updateCostItem(),this.updateExpectIcon(),this.updateScore(),this.registerEvents()):b8e.warn("\u5f53\u524d\u6ca1\u6709\u6b63\u5728\u8fdb\u884c\u7684\u6d3b\u52a8")},onHide:function(){this.stopTime(),this.unRegisterEvents()},taskAlert:function(e){this.skin.accessAlert.active=e.alert},scoreAlert:function(e){this.skin.scoreAlert.active=e.alert},registerEvents:function(){var e=game.MibaoMgr.inst();this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCostItem),e.addEvent(game.MibaoEvts.MIBAO_REQUEST_SUCCESS,this.updateScore,this),e.addEvent(game.MibaoEvts.MIBAO_SELECT_LUCKY_AWARD,this.updateExpectIcon,this)},unRegisterEvents:function(){var e=game.MibaoMgr.inst();this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCostItem),e.removeEvent(game.MibaoEvts.MIBAO_REQUEST_SUCCESS,this.updateScore,this),e.removeEvent(game.MibaoEvts.MIBAO_SELECT_LUCKY_AWARD,this.updateExpectIcon,this)},updateEndTime:function(){var e=this;if(e.curMibaoCfg)if((e.endTime=game.mibaoData.getEndTime())<game.SysTime.curTime)e.stopTime();else{var t=e.endTime-game.SysTime.curTime;e.skin.endTime.string=game.Lang.get(53597,game.TimeUtil.formatTimeSpace(t,3)),e._timer||(e._timer=b8e.Timer.add(e,e.updateTime,500)),e._timer.reset(),e._timer.start()}},updateTime:function(){var e=this.skin,t=this.endTime;if(!t||t<game.SysTime.curTime)return this.stopTime(),void(e.endTime.string=game.Lang.get(53598));var a=t-game.SysTime.curTime;if(a<1)return this.stopTime(),void(e.endTime.string="");e.endTime.string=game.Lang.get(53599,game.TimeUtil.formatTimeSpace(a,3))},stopTime:function(){this._timer&&this._timer.stop()},updateCostItem:function(){var e=this.skin;if(this.curMibaoCfg){var t=this.curMibaoCfg.costItemId;if(t){var a=game.ItemInfoCfg.getData(t);if(a){var i=game.ResCfg.getUrl(137,a.icon);e.leftCostIcon.loadTexture(i),e.rightCostIcon.loadTexture(i);var n=game.itemData.getCountById(t),s=1<=n,r=s?504:503;e.leftCostRedSpot.active=s,e.leftCostNum.string=game.Lang.get(r,n,1),e.leftCostNode.x=this.leftCostNodeX-(e.leftCostNum.width>>1),r=(s=10<=n)?504:503,e.rightCostRedSpot.active=s,e.rightCostNum.string=game.Lang.get(r,n,10),e.rightCostNode.x=this.rightCostNodeX-(e.rightCostNum.width>>1)}else b8e.warn("\u9053\u5177\u8868\u6ca1\u6709\u8be5\u9053\u5177id:"+t)}else b8e.warn("\u6ca1\u6709\u914d\u7f6e\u6d88\u8017\u9053\u5177id")}},leftCostIcon:function(){this.showCostIconTips()},rightCostIcon:function(){this.showCostIconTips()},showCostIconTips:function(){if(this.curMibaoCfg&&this.curMibaoCfg.costItemId){var e=game.ItemInfoCfg.getData(this.curMibaoCfg.costItemId);e?(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips)):b8e.warn("\u9053\u5177\u8868\u6ca1\u6709\u8be5\u9053\u5177id:"+this.curMibaoCfg.costItemId)}},updateExpectIcon:function(){var e=this.skin,t=game.mibaoData.getExpectItemId();if(!t)return e.expectIcon.active=!1,void(e.emptyIcon.active=!0);e.expectIcon.active=!0,e.emptyIcon.active=!1;var a=game.mibaoData.getStoreCfgByAwardId(t);if(a&&a.giveItems&&!(a.giveItems.length<1)){var i=game.ItemInfoCfg.getData(a.giveItems[0].Id);if(i){var n=this.expectIcon;n||(n=this.expectIcon=game.GridUtil.createTipsIcon()).addToParent(e.expectIcon),game.GridUtil.setItemIcon(n,i,!1,game.IconLayoutEnum.SHOW_NAME)}}},updateScore:function(){var e=game.mibaoData.getMineScore();this.skin.score.string=game.Lang.get(53600,e)},rankBtn:function(){game.module.show(game.ME.MibaoRank)},expectBtn:function(){game.module.show(game.ME.MibaoExpect)},awardBtn:function(){game.module.show(game.ME.MibaoScoreAward)},accessBtn:function(){game.module.show(game.ME.MibaoAccess)},emptyIcon:function(){this.expectBtn()},singleBtn:function(){this.mibaoReq(1,1)},tenBtn:function(){this.mibaoReq(2,10)},mibaoReq:function(e,t){this.curMibaoCfg&&this.curMibaoCfg.costItemId&&game.UpgradeUtil.checkItemInfo(this.curMibaoCfg.costItemId,t)&&(game.UpgradeUtil.checkEquipTooMuch()||game.MibaoMgr.inst().mibaoReq(e))}});b8e.app.registerView(game.ME.Mibao,e)}(),function(){var e;e=b8e.Enum({NONE:0,V_UPDATE_VIEW:-1}),b8e.RC("$$game","$$QQVideoEvts",e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({currActId:0,selWelfareData:null,init:function(){this._super(),this.addEventByModule(game.ME.Welfare,game.WelfareEvts.C_INIT_MODEL,this.initModel),this.addListenerPb(game.protoId.QQVideoAwardResp,this.qqVideoAwardResp),this.qqVideoAlert=game.spotAlert.set(game.SAE.QQVIDEO,game.SAE.HOME),this.data=game.qqVideoData,this.evts=game.QQVideoEvts},initModel:function(e){if(e&&e.data){this.data.initData(e.data.qqVideoAwards),this.qqVideoAlert.alert=!this.data.isAllReceive(),this.send(this.evts.V_UPDATE_VIEW)}},qqVideoAwardResp:function(e){var t=e.readProtobuf(game.pb.QQVideoAwardResponse);0<t.code?game.notice.noticeError(t.code):(this.data.setIsGet(t.id),this.send(this.evts.V_UPDATE_VIEW))},qqVideoAwardReq:function(e){var t=game.pb.QQVideoAwardRequest;t.id=e,this.sendPb(game.protoId.QQVideoAwardReq,t)},closeSpotAlert:function(){this.qqVideoAlert.alert&&(this.qqVideoAlert.alert=!1)},playVideo:function(t){var a=this,e=b8e.getFPV(window,"qq");if(e){var i=b8e.getFPV(e,"createRewardedVideoAd")({adUnitId:"82b0f43f0fdda3b12c18c1be234c7ebf"});b8e.getFPV(i,"onError")(function(e){b8e.log("videoAd onError",e)}),b8e.getFPV(i,"onLoad")(function(e){b8e.log("videoAd onLoad",e)}),b8e.getFPV(i,"onClose")(function(e){b8e.getFPV(e,"isEnded")&&a.qqVideoAwardReq(t)}),b8e.getFPV(i,"load")().then(function(){b8e.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u6210\u529f"),b8e.getFPV(i,"show")().then(function(){b8e.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f")}).catch(function(e){b8e.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25")})}).catch(function(e){b8e.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25")})}else b8e.warn("\u4e0d\u5728QQ\u5c0f\u6e38\u620f\u574f\u5883")}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$QQVideoMgr",e)}(),function(){var e=b8e.Object.extends({_awardMap:null,ctor:function(){this._super()},initData:function(e){if(!this._awardMap){this._awardMap=b8e.HashMap.get(),this.awardInfos=[];var t=game.QQVideoCfg&&game.QQVideoCfg.getDatas();if(t&&t.length)for(var a=void 0,i=0,n=t.length;i<n;i++)(a=new game.QQVideoInfo).setData(t[i]),this._awardMap.set(a.id,a),this.awardInfos.push(a)}if(this.restAward(),e&&e.length)for(var s=void 0,r=0,o=e.length;r<o;r++){if(s=e[r],this._awardMap.has(s))this._awardMap.get(s).isGet=!0}},isAllReceive:function(){for(var e=0,t=this.awardInfos.length;e<t;e++)if(!this.awardInfos[e].isGet)return!1;return!0},restAward:function(){for(var e=0,t=this.awardInfos.length;e<t;e++)this.awardInfos[e].isGet=!1},setIsGet:function(e){this._awardMap.has(e)&&(this._awardMap.get(e).isGet=!0)}});game.qqVideoData=game.qqVideoData||new e}(),function(){var e;e=b8e.Object.extends({cfg:null,id:0,isGet:!1,setData:function(e){this.cfg=e,this.id=e.id},getPrizeList:function(){if(this.award)return this.award;this.award=[];for(var e=this.cfg.award,t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],i=game.ItemUtil.createBaseItemInfo(a.Id,a.Num),this.award.push(i);return this.award}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$QQVideoInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super("qqVideo/QQVideoItem"),this.setSize(600,176)},init:function(){var e=this.prizeList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.PrizeListItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=6,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=15},setData:function(){var e=this.skin,t=this.data;this.prizeInfoList=this.data.getPrizeList(),this.prizeList.setData(this.prizeInfoList),e.playBtn.active=!t.isGet,e.isGetImg.active=t.isGet},playBtn:function(){this.data&&game.QQVideoMgr.inst().playVideo(this.data.id)}}),b8e.RC("$$game","$$QQVideoItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super("qqVideo/QQVideoView")},init:function(){var e=this.list=new game.List;e.itemRender=game.QQVideoItem,e.layout.paddingTop=0,e.addToParent(this.skin.listNode),this.skin.descLab.string=game.Lang.get(53650),this.evts=game.QQVideoEvts,this.data=game.qqVideoData,this.mgr=game.QQVideoMgr.inst()},addEventListener:function(){this.mgr.addEvent(this.evts.V_UPDATE_VIEW,this.updateView,this)},removeEventListener:function(){this.mgr.removeEvent(this.evts.V_UPDATE_VIEW,this.updateView,this)},updateView:function(){this.list.setData(this.data.awardInfos)},onShow:function(){this.addEventListener(),this.mgr.closeSpotAlert(),this.updateView()},onHide:function(){this.removeEventListener()}});b8e.app.registerView(game.ME.QQVideo,e)}(),function(){var e=game.OpenSerCarnivalBaseView.extends({_showModel:!0,ctor:function(){this._super(1703)},init:function(){var e=this.skin;this.moduleData=game.openSerCarnivalData;var t=this.dayList=new game.List;t.itemRender=game.WeekBtnItem,t.addToParent(e.dayBtnList),t.bindEnum=game.ME.OpenSerCarnival,t.layout.paddingTop=5,t.layout.paddingLeft=5,t.layout.spacingX=0,t.layout.spacingY=0;var a=this.pageList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);a.itemRender=game.WeekSerTabBtnItem,a.addToParent(e.taskBtnList),a.bindEnum=game.ME.OpenSerCarnival,a.layout.spacingX=3,a.layout.paddingLeft=0,a.layout.paddingRight=0,a.layout.paddingTop=-10;var i=this.taskList=new game.List;i.itemRender=game.WeekSerTaskItem,i.bindEnum=game.ME.OpenSerCarnival,i.layout.paddingTop=6,i.layout.spacingY=6,i.addToParent(e.taskList);var n=this.scoreList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);n.itemRender=game.OpenSerScoreItem,n.bindEnum=game.ME.OpenSerCarnival,n.layout.paddingLeft=0,n.layout.paddingTop=0,n.layout.spacingX=3,n.addToParent(e.scoreList)}});b8e.module.registerView(game.ME.WeekActivity,e)}(),function(){var e;e=game.OpenSerDayBtnBaseItem.extends({ctor:function(){this._super(1702),this.setSize(152,98)}}),b8e.RC("$$game","$$WeekBtnItem",e)}(),function(){var e;e=game.OpenSerTabBtnBaseItem.extends({ctor:function(){this._super(1701),this.setSize(120,42)}}),b8e.RC("$$game","$$WeekSerTabBtnItem",e)}(),function(){var e;e=game.OpenSerTaskBaseItem.extends({ctor:function(){this._super(1700),this.setSize(522,153)}}),b8e.RC("$$game","$$WeekSerTaskItem",e)}(),function(){var e;e=b8e.Enum({REFRESH_AWARD_LIST:b8e.enc(),REFRESH_LV_LIST:b8e.enc(),REFRESH_TASK_PROGRESS:b8e.enc()}),b8e.RC("$$game","$$SpecialWarTokenEvts",e)}(),function(){var e=void 0;(e=game.GameBaseMgr.extends({init:function(){var e=this;e._super(),e.moduleEvts=game.SpecialWarTokenEvts,e.moduleData=game.specialWarTokenData,e.moduleEnum=game.ME.SpecialWarToken,e.specialWarTokenAlert1=game.spotAlert.set(game.SAE.SPECIAL_WAR_MAIN_TASK_TOKEN,game.SAE.RECHARGE_HALL_RECHARGE),e.specialWarTokenAlert2=game.spotAlert.set(game.SAE.SPECIAL_WAR_MEMOIR_TOKEN,game.SAE.RECHARGE_HALL_RECHARGE),e.specialWarTokenAlert3=game.spotAlert.set(game.SAE.SPECIAL_WAR_ZHANJIANG_TOKEN,game.SAE.RECHARGE_HALL_RECHARGE),e.specialWarTokenAlert4=game.spotAlert.set(game.SAE.SPECIAL_WAR_ZHAOQIN_TOKEN,game.SAE.RECHARGE_HALL_RECHARGE),e.specialWarTokenAlert5=game.spotAlert.set(game.SAE.SPECIAL_WAR_BARBARIAN_TOKEN,game.SAE.RECHARGE_HALL_RECHARGE),e.specialWarTokenAlert6=game.spotAlert.set(game.SAE.SPECIAL_WAR_MEMOIR_TOKEN2,game.SAE.ZHUANJI),e.specialWarTokenAlert7=game.spotAlert.set(game.SAE.SPECIAL_WAR_ZHANJIANG_TOKEN2,game.SAE.ZHANJIANG)},_addEvents:function(){var e=this;e.addEventByModule(game.ME.OpenServer,game.OpenServerEvts.C2C_INIT_OPENSERVER,e.initData),e.addEventByModule(game.ME.MainRole,game.MainRoleEvts.C_RESET_DAILY,e.resetDaily),e.addEventByModule(game.ME.Recharge,game.RechargeEvts.C_RECHARGE_SUCCESS,e.rechargeSuccess),e.addEventByModule(game.ME.MainRole,game.MainRoleEvts.C_LEVEL_UP,e.levelUp),e.addEventByModule(game.ME.MainInstance,game.MainInstanceEvts.C2C_SYNC_MAIN_INSTANCE,e.updateMainInstance),e.addEventByModule(game.ME.MainInstance,game.MainInstanceEvts.C_GET_MAIN_INSTANCE_AWARDS,e.updateMainInstance),e.addEventByModule(game.ME.ZhuanJi,game.ZhuanJiEvts.C2C_SYSYN_DATA,e.updateZhuanJi),e.addEventByModule(game.ME.ZhuanJiBattle,game.ZhuanJiEvts.C2C_CHALLENGE_SUCCEED,e.updateZhuanJi),e.addEventByModule(game.ME.ZhanJiang,game.ZhanJiangEvts.C2C_UPDATE_LAYER,e.updateZhanJiang),e.addEventByModule(game.ME.ZhaoQin,game.ZhaoqinEvts.C2C_SYS_DATA_SUCCEED,e.updateZhaoQin),e.addEventByModule(game.ME.ZhaoQin,game.ZhaoqinEvts.C2C_CHALLENGE_SUCCEED,e.updateZhaoQin),e.addEventByModule(game.ME.Barbarian,game.BarbarianEvts.C2C_SYS_DATA_SUCCEED,e.updateBarbarian),e.addEventByModule(game.ME.Barbarian,game.BarbarianEvts.C2C_UPDATE_BATTLE,e.updateBarbarian),e.addListenerPb(game.protoId.SpecialTokenAwardResp,e.specialTokenAwardResp)},triggerOpen:function(e){if(e==t.moduleEnum){var t=this;t.setupOpenList(),t.checkAlert()}},initData:function(e){if(e&&e.data){this.moduleData.setupOpenList(),this.moduleData.setupSeverData(e.data.specialToken),game.moduleOpen.checkOpen(this.moduleEnum)&&this.checkAlert()}},resetDaily:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(game.mibaoData.resetDaily(),this.checkAlert())},rechargeSuccess:function(e){if(e&&e.data){this.moduleData.rechargeSuccess(e.data),this.checkAlert(),this.send(this.moduleEvts.REFRESH_LV_LIST),this.send(this.moduleEvts.REFRESH_AWARD_LIST)}},levelUp:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.moduleData.setupOpenList(),this.checkAlert())},updateMainInstance:function(){this.setProgress(game.SpecialWarTokenType.MainTask,game.mainInstanceData.id)},updateZhuanJi:function(){this.setProgress(game.SpecialWarTokenType.Memoir,game.zhuanJiData.maxStar)},updateZhanJiang:function(){this.setProgress(game.SpecialWarTokenType.ZhanJiang,game.zhanjiangData.zhanJiangLayer)},updateZhaoQin:function(){this.setProgress(game.SpecialWarTokenType.ZhaoQin,game.zhaoqinData.maxLayer)},updateBarbarian:function(){this.setProgress(game.SpecialWarTokenType.Barbarian,game.barbarianData.maxClearId)},setProgress:function(e,t){this.moduleData.setProgress(e,t),this.checkAlertByTaskType(e),this.send(this.moduleEvts.REFRESH_TASK_PROGRESS)},specialTokenAwardResp:function(e){var t=e.readProtobuf(game.pb.SpecialTokenAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.tokenId;this.moduleData.setAward(a);var i=this.moduleData.getTokenInfoByTId(a);i&&this.checkAlertByTaskType(i.taskType),this.send(this.moduleEvts.REFRESH_LV_LIST),this.send(this.moduleEvts.REFRESH_AWARD_LIST)}},getAward:function(e){var t=game.pb.SpecialTokenAwardRequest;t.tokenId=e,this.sendPb(game.protoId.SpecialTokenAwardReq,t)},buyBtn:function(e,t){var a=this.moduleData.getLvInfoByAIdToLv(e,t);if(a)if(a.isBuyLuxury)game.notice.show(53637);else{var i=this.moduleData.getTokenRechargeCfgByAIdToLv(e,t);if(i){var n=b8e.module.getControl(game.ME.Recharge);n&&n.recharge(i.rechargeId)}}},selectLv:function(e,t){this.moduleData.selectLv(e,t),this.send(this.moduleEvts.REFRESH_AWARD_LIST),this.send(this.moduleEvts.REFRESH_LV_LIST)},resetSelectLv:function(e){this.moduleData.selectLv(e,1,!0)},checkAlert:function(){var e=this.moduleData.getOpenTypeList();if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)e[a]&&this.checkAlertByTaskType(e[a].taskType)},checkAlertByTaskType:function(e){var t=this.moduleData.checkAlertByType(e),a=game.SpecialWarTokenType;switch(e){case a.MainTask:this.specialWarTokenAlert1.alert=t;break;case a.Memoir:this.specialWarTokenAlert6.alert=this.specialWarTokenAlert2.alert=t;break;case a.ZhanJiang:this.specialWarTokenAlert7.alert=this.specialWarTokenAlert3.alert=t;break;case a.ZhaoQin:this.specialWarTokenAlert4.alert=t;break;case a.Barbarian:this.specialWarTokenAlert5.alert=t}}}))._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$SpecialWarTokenMgr",e)}(),function(){var e=b8e.Object.extends({ctor:function(){this._super(),this.lvMap=b8e.HashMap.get(),this.activityMap=b8e.HashMap.get(),this.tokenMap=b8e.HashMap.get(),this.selectLvList=[]},setupSeverData:function(e){if(e&&!(e.length<1))for(var t=void 0,a=void 0,i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,g=void 0,u=void 0,l=e.length,c=0;c<l;c++){if(t=(g=e[c]).lv,n=g.awards,o=g.activityId,this.getUnLockLv(o)<t&&this.setUnLockLv(o,t),(i=this.getLvInfoByAIdToLv(o,t))&&(i.awards=n),g.luxury){if(i&&(i.isBuyLuxury=!0),(u=this.getAwardInfoList(o,t))&&0<u.length)for(s=u.length,a=0;a<s;a++)u[a].setServerData(g)}else if(n&&0<n.length){for(s=n.length,a=0;a<s;a++)(r=this.getTokenInfoByTId(n[a]))&&r.setServerData(g);u=this.getAwardInfoList(o,t)}u&&0<u.length&&i&&i.awards&&i.awards.length>=u.length&&this.setUnLockLv(i.activityId,i.lv+1)}},setAward:function(e){var t=this.getTokenInfoByTId(e);if(t){t.setAward();var a=this.getLvInfoByAIdToLv(t.activityId,t.lv);if(a&&!a.isMax){a.setAward(e);var i=this.getAwardInfoList(a.activityId,a.lv);i&&0<i.length&&a.awards&&a.awards.length>=i.length&&this.setUnLockLv(a.activityId,a.lv+1)}}},selectActivityId:function(e){this.curActivityId=e},setProgress:function(e,t){this.taskProgress||(this.taskProgress=[]),this.taskProgress[e]=t},onSort:function(e,t){return e.lv-t.lv},getProgress:function(e){return this.taskProgress&&this.taskProgress[e]?this.taskProgress[e]:0},resetDaily:function(){this.setupOpenList()},rechargeSuccess:function(e){if(game.RechargeCfg.getDataById(e.id).rechargeType!=game.RechargeType.SPECIAL_TOKEN)return!1;var t=this.getTokenRechargeCfgByRId(e.id);if(!t)return!1;var a=t.activityId,i=t.lv,n=this.getLvInfoByAIdToLv(a,i);if(!n)return!1;n.isBuyLuxury=!0;var s=this.getAwardInfoList(a,i);if(s&&0<s.length)for(var r=s.length,o=0;o<r;o++)s[o].isBuyLuxury=!0},setupOpenList:function(){var e=this.openList;(e=e||(this.openList=[])).length=0;var t=this.openTypeList;(t=t||(this.openTypeList=[])).length=0;var a=game.SpecialTokenOpenCfg.getDatas();if(a&&!(a.length<1))for(var i=void 0,n=a.length,s=0;s<n;s++)i=a[s],this.checkOpenByConfig(i)&&(t[(e[e.length]=i).taskType]=i)},checkOpenByAId:function(e){var t=this.getOpenCfgByAId(e);return!!t&&this.checkOpenByConfig(t)},checkOpenByConfig:function(e){if(!e)return!1;var t=game.miscData.openServerDay;return e.lv<=game.mainRoleData.lv&&e.serverStart<=t&&e.serverEnd>t},checkOpenByTokenType:function(e){var t=this.getOpenCfgByType(e);return!!t&&this.checkOpenByConfig(t)},checkAllAlert:function(){var e=this.getOpenList();if(!e||e.length<1)return!1;for(var t=void 0,a=e.length,i=0;i<a;i++)if(t=e[i],this.checkAlertByAId(t.activityId))return!0;return!1},checkAlertByAId:function(e){for(var t=this.getUnLockLv(e)+1,a=1;a<t;a++)if(this.checkAlertIdToLv(e,a))return!0;return!1},checkAlertIdToLv:function(e,t){var a=this.getAwardInfoList(e,t);if(!a||a.length<1)return!1;for(var i=void 0,n=a.length,s=0;s<n&&(i=a[s]).canGet;s++)if(!(i.isBuyLuxury&&i.isLuxuryGet||!i.isBuyLuxury&&i.isNormalGet))return!0;return!1},checkAlertByType:function(e){if(!this.openTypeList||this.openTypeList.length<1)return!1;var t=this.openTypeList[e];return!!t&&this.checkAlertByAId(t.id)},selectLv:function(e,t,a){var i=2<arguments.length&&void 0!==a&&a;if(this.selectLvList&&!(this.selectLvList.length<1)){var n=this.selectLvList[e];if(n!=t){this.selectLvList[e]=t;var s=this.getLvInfoList(e,!1);if(s&&!(s.length<1))for(var r=void 0,o=s.length,g=0;g<o;g++){if((r=s[g]).lv==n&&(r.select=!1,i))return;r.lv==t&&(r.select=!0)}}}},getOpenList:function(){return this.openList||this.setupOpenList(),this.openList},getLvInfoList:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=void 0,n=void 0,s=void 0,r=this,o=r.lvMap.get(e);r.tempLvList||(r.tempLvList=[]),r.tempLvList.length=0;var g=r.getUnLockLv(e),u=r.getCurLvById(e);if(o)for(n=o.length,i=0;i<n;i++)s=o[i],r.setTempList(r.tempLvList,s,g,u,a);else{o=[],r.lvMap.set(e,o);var l=r.getOpenCfgByAId(e);if(!l)return null;var c=r.getIntervalCfgsByAId(e);for(n=c.length,c.sort(r.onSort),i=0;i<n;i++)(s=game.SpecialWarTokenLvInfo.get()).setCfgData(l,i+1),o[i]=s,r.setTempList(r.tempLvList,s,g,u,a)}return r.tempLvList},setTempList:function(e,t,a,i,n){t&&e&&t.lv<=a&&(n&&(t.alert=this.checkAlertIdToLv(t.activityId,t.lv)),t.select=t.lv==i,e[e.length]=t)},getLvInfoByAIdToLv:function(e,t){var a=this.getLvInfoList(e,!1);if(!a||a.length<1)return null;for(var i=void 0,n=a.length,s=0;s<n;s++)if((i=a[s]).lv==t)return i;return null},getUnLockLv:function(e){var t=this.unLockLvList;return(t=t||(this.unLockLvList=[]))[e]?t[e]:t[e]=1},setUnLockLv:function(e,t){var a=this.unLockLvList;(a=a||(this.unLockLvList=[]))[e]=a[e]<t?t:a[e]},getCurLvById:function(e){var t=this.selectLvList;return t[e]?t[e]:t[e]=1},getAwardInfoList:function(e,t){var a,i=void 0,n=void 0,s=this.activityMap.get(e);s||(s=b8e.HashMap.get(),this.activityMap.set(e,s));var r=s.get(t);if(r&&0<r.length){var o=r.length;for(i=0;i<o;i++)(n=r[i]).canGet=this.getProgress(n.taskType)>=n.progress;return r}r||(r=[],s.set(t,r));var g=this.getTaskCfgs(e,t);if(!g||g.length<1)return r;var u=void 0;for(a=g.length,i=0;i<a;i++)u=g[i],(n=this.getTokenInfoByTId(u.tokenId))&&(n.canGet=this.getProgress(n.taskType)>=n.progress,r[r.length]=n);return r},getTokenInfoByTId:function(e){var t=this.tokenMap.get(e);if(t)return t;var a=this.getTaskCfgByTId(e);return a?((t=game.SpecialWarTokenInfo.get()).setCfgData(a),this.tokenMap.set(e,t),t):(b8e.warn("\u6ca1\u6709\u8be5\u6218\u4ee4id\u7684\u914d\u7f6e,id:  "+e),null)},getCurLvIsBuy:function(e,t){var a=this.getLvInfoByAIdToLv(e,t);return!!a&&a.isBuyLuxury},getOpenTypeList:function(){return this.openTypeList},getTaskCfgs:function(e,t){return this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.activityId=e,this.cfgObj.lv=t,game.SpecialTokenTaskCfg.getData(this.cfgObj,!0)},getTaskCfgByTId:function(e){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.tokenId=e,game.SpecialTokenTaskCfg.getData(this.cfgObj2)},getTaskCfgsByAId:function(e){return this.cfgObj3||(this.cfgObj3=b8e.createMap()),this.cfgObj3.activityId=e,game.SpecialTokenTaskCfg.getData(this.cfgObj3,!0)},getOpenCfgByAId:function(e){return this.cfgObj4||(this.cfgObj4=b8e.createMap()),this.cfgObj4.id=e,game.SpecialTokenOpenCfg.getData(this.cfgObj4)},getOpenCfgByType:function(e){return this.cfgObj5||(this.cfgObj5=b8e.createMap()),this.cfgObj5.taskType=e,game.SpecialTokenOpenCfg.getData(this.cfgObj5,!1)},getIntervalCfgsByAId:function(e){return this.cfgObj6||(this.cfgObj6=b8e.createMap()),this.cfgObj6.activityId=e,game.SpecialLvIntervalCfg.getData(this.cfgObj6,!0)},getIntervalCfgByAIdToLv:function(e,t){return this.cfgObj7||(this.cfgObj7=b8e.createMap()),this.cfgObj7.activityId=e,this.cfgObj7.lv=t,game.SpecialLvIntervalCfg.getData(this.cfgObj7,!0)},getTokenRechargeCfgByRId:function(e){return this.cfgObj8||(this.cfgObj8=b8e.createMap()),this.cfgObj8.rechargeId=e,game.TokenRechargeCfg.getData(this.cfgObj8)},getTokenRechargeCfgByAIdToLv:function(e,t){return this.cfgObj8||(this.cfgObj8=b8e.createMap()),this.cfgObj8.activityId=e,this.cfgObj8.lv=t,game.TokenRechargeCfg.getData(this.cfgObj8)}});game.specialWarTokenData=game.specialWarTokenData||new e}(),function(){var e,t=e=b8e.PoolObject.extends({isBuyLuxury:!1,isNormalGet:!1,isLuxuryGet:!1,canGet:!1,taskDesc:0,progress:0,curProgress:0,setCfgData:function(e){e&&(this.tokenCfg=e,this.lv=e.lv,this.tokenId=e.tokenId,this.taskDesc=e.taskDesc,this.taskType=e.taskType,this.activityId=e.activityId,this.progress=e.progress)},setProgress:function(e){this.curProgress=e,this.canGet=!this.progress||this.curProgress>this.progress},setServerData:function(e){if(e){this.isBuyLuxury=e.luxury,this.isNormalGet=!!(e.awards&&-1<e.awards.indexOf(this.tokenId)),this.isLuxuryGet=!!(e.luxuryAwards&&-1<e.luxuryAwards.indexOf(this.tokenId))}},setAward:function(){this.isNormalGet=!0,this.isLuxuryGet=this.isBuyLuxury},getAwardList:function(){var e=this.awardList;if(e&&0<e.length)return e;if(this.tokenCfg){var t=this.awardPrzieListInfo;return t=t||(this.awardPrzieListInfo=game.CfgUtil.getPrizeListInfo(this.tokenCfg.award)),this.awardList=t.items,this.awardList}},getLuxuryAwardList:function(){var e=this.luxuryAwardList;if(e&&0<e.length)return e;if(this.tokenCfg){var t=this.luxuryPrizeListInfo;return t=t||(this.luxuryPrizeListInfo=game.CfgUtil.getPrizeListInfo(this.tokenCfg.luxuryAward)),this.luxuryAwardList=t.items,this.luxuryAwardList}},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.tokenCfg=null,e.taskDesc=0,e.isBuyLuxury=!1,e.canGet=!1,e.isLuxuryGet=!1,e.isNormalGet=!1,e.awardList=null,e.luxuryAwardList=null,e.progress=0,e.curProgress=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$SpecialWarTokenInfo",e)}(),function(){var e,t=e=b8e.PoolObject.extends({select:!1,alert:!1,lv:0,isBuyLuxury:!1,awards:null,isMax:!1,setCfgData:function(e,t){this.tokenOpenCfg=e,this.activityId=e.id,this.lv=t,this.isMax=this.lv>=e.maxLv},setAward:function(e){this.awards||(this.awards=[]),-1<this.awards.indexOf(e)||(this.awards[this.awards.length]=e)},recycle:function(){this.reset(),this._super()},reset:function(){this.tokenOpenCfg=null,this.select=!1,this.alert=!1,this.lv=0,this.isBuyLuxury=fasle,this.awards=null}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$SpecialWarTokenLvInfo",e)}(),function(){var e;e=b8e.Enum({None:0,MainTask:1,Memoir:2,ZhanJiang:3,ZhaoQin:4,Barbarian:5}),b8e.RC("$$game","$$SpecialWarTokenType",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1734),this.setSize(128,118)},setData:function(){var e=this.skin,t=this.data,a=t.canGet,i=t.isBuyLuxury,n=t.isNormalGet,s=t.isLuxuryGet;e.isGetImg.active=n&&s,e.getBtn.active=a&&(!n||!s),e.notGetBtn.active=!(a||n&&s),e.btn_lab.string=n?game.Lang.get(53634):game.Lang.get(53633),e.redPoint.active=i?a&&!s:a&&!n,e.tokenDesc.setHorizontalAlign(b8e.HorizontalAlign.CENTER),t.taskType!=game.SpecialWarTokenType.MainTask?e.tokenDesc.string=game.Lang.get(t.taskDesc,t.progress):game.InstanceCfg.getDataAsync(t.progress,this.setMainTaskProgress,this),this.resetPrizeIcon();var r=void(this.iconIndex=0);r=t.getAwardList(),this.setPrizeList(r,!0,e.leftPrizeList),r=t.getLuxuryAwardList(),this.setPrizeList(r,i,e.rightPrizeList),game.ShaderUtil.setGray(e.leftPrizeList,n),game.ShaderUtil.setGray(e.rightPrizeList,s)},setMainTaskProgress:function(e){this.skin.tokenDesc.string=e?game.Lang.get(this.data.taskDesc,e.name):""},setPrizeList:function(e,t,a){if(e&&!(e.length<1)){var i=void 0,n=this.iconPool;n=n||(this.iconPool=[]);for(var s=this.iconIndex,r=e.length,o=1<r?-44:0,g=0;g<r;g++)i=(i=n[s])||(n[s]=new game.SpecialWarTokenPrizeIcon),s++,i.setItemInfo(e[g]),i.setLockImg(!t),i.addToParent(a),i.setPosition(o+90*g,0);this.iconIndex=s}},resetPrizeIcon:function(){var e=this.iconPool;if(e&&!(e.length<1))for(var t=e.length,a=0;a<t;a++)e[a].removeFromParent()},getBtn:function(){var e=this.data;!e.isNormalGet||e.isBuyLuxury?game.SpecialWarTokenMgr.inst().getAward(e.tokenId):game.SpecialWarTokenMgr.inst().buyBtn(e.activityId,e.lv)}}),b8e.RC("$$game","$$SpecialWarTokenItem",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1735),this.setSize(140,70)},setData:function(){var e=this.skin,t=this.data;e.selectBg.active=t.select,e.redPoint.active=t.alert,e.levelLab.string=game.Lang.get(53632,t.lv)},btn:function(){var e=this.data;e.select||game.SpecialWarTokenMgr.inst().selectLv(e.activityId,e.lv)}}),b8e.RC("$$game","$$SpecialWarTokenLvItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1736)},init:function(){var e=this.awardList=new game.List;e.itemRender=game.SpecialWarTokenItem,e.addToParent(this.skin.prizeList),e.layout.paddingLeft=0,e.layout.paddingTop=0,e.layout.spacingY=5;var t=this.lvList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);t.itemRender=game.SpecialWarTokenLvItem,t.addToParent(this.skin.lvList),t.layout.paddingLeft=0,t.layout.spacingX=0,this.moduleData=game.specialWarTokenData,this.moduleMgr=game.SpecialWarTokenMgr.inst()},onShow:function(){this.curActivityId=this.moduleData.curActivityId,this.updateLvList(),this.updateAwardList(),this.registerEvents(),this.updateProgress()},onHide:function(){this.moduleMgr.resetSelectLv(this.curActivityId),this.unRegisterEvents()},registerEvents:function(){this.moduleMgr.addEvent(game.SpecialWarTokenEvts.REFRESH_AWARD_LIST,this.updateAwardList,this),this.moduleMgr.addEvent(game.SpecialWarTokenEvts.REFRESH_LV_LIST,this.updateLvList,this),this.moduleMgr.addEvent(game.SpecialWarTokenEvts.REFRESH_TASK_PROGRESS,this.updateProgress,this)},unRegisterEvents:function(){this.moduleMgr.removeEvent(game.SpecialWarTokenEvts.REFRESH_AWARD_LIST,this.updateAwardList,this),this.moduleMgr.removeEvent(game.SpecialWarTokenEvts.REFRESH_LV_LIST,this.updateLvList,this),this.moduleMgr.removeEvent(game.SpecialWarTokenEvts.REFRESH_TASK_PROGRESS,this.updateLvList,this)},updateProgress:function(){var e=this.openCfg=this.moduleData.getOpenCfgByAId(this.curActivityId);if(e){var t=this.moduleData.getProgress(e.taskType);e.taskType!=game.SpecialWarTokenType.MainTask?this.skin.curProgress.string=game.Lang.get(e.desc,t):game.mainInstanceData.getInstanceCfg(this.setMainTaskProgress,this)}},setMainTaskProgress:function(e){this.skin.curProgress.string=e?game.Lang.get(this.openCfg.desc,e.name):""},updateLvList:function(){var e=this.moduleData.getLvInfoList(this.curActivityId);this.lvList.setData(e)},updateAwardList:function(){var e=this.skin,t=this.curActivityId,a=this.moduleData.getCurLvById(t),i=this.moduleData.getAwardInfoList(t,a);this.awardList.setData(i);var n=this.moduleData.getCurLvIsBuy(t,a);e.buyBtn.active=!n,e.boughBtn.active=n,e.lock.active=!n;var s=game.Lang.get(53638),r=this.moduleData.getTokenRechargeCfgByAIdToLv(t,a);if(r){var o=game.RechargeCfg.getDataById(r.rechargeId);o&&(s=game.Lang.get(53639,o.money))}e.buyLab.string=s},buyBtn:function(){var e=this.moduleData.getCurLvById(this.curActivityId);this.moduleMgr.buyBtn(this.curActivityId,e)},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.SpecialWarToken,e)}(),function(){var e;(e=game.ItemIcon.extends({_cfg:null,itemInfo:null,isShowName:!0,isShowNum:!0,ctor:function(e){e=e||game.IconSizeEnum.GRID_SIZE_84,this._super(e)},setItemInfo:function(e,t,a,i){var n=1<arguments.length&&void 0!==t&&t,s=2<arguments.length&&void 0!==a?a:2,r=!(3<arguments.length&&void 0!==i)||i;this._super(e,n,s,r)},setLockImg:function(e){var t=this;if(e){if(!t._lockImg){t._lockImg=b8e.Sprite.get(),t._lockImg.setAnchor(.5,.5),t._lockImg.setPosition(42,42);var a=game.ResCfg.getImgUrl("icon/lockImg");t._lockImg.loadTexture(a,null,null),t._lockImg.setVisible(!1)}t._lockImg&&!t._lockImg.parent&&t.addChild(t._lockImg),t._lockImg.setVisible(e)}else t._lockImg&&t._lockImg.setVisible(e)},clearData:function(){this._super()}})).poolCall=!0,b8e.RC("$$game","$$SpecialWarTokenPrizeIcon",e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({init:function(){this._super(),this.showArr=[]},addEvents:function(){this._super()},pushShowArr:function(e){0==this.showArr.length&&this.showArr.push(e)},startShow:function(e,t){this.callback=e,this.caller=t,this.showPlay()},showPlay:function(){0<this.showArr.length?game.module.show(game.ME.BossShowView):this.callback&&this.callback.call(this.caller)}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$BossShowMgr",e)}(),function(){var e;e=b8e.Enum({}),b8e.RC("$$game","$$BossShowEvts",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1699)},init:function(){this.effect=b8e.Animator.get(game.AnimType.UI_EFFECT,1),this.effect.setScale(2,2),this.effect.addToParent(this.skin.effectNode),this.effect.load(game.ResCfg.getUrl(5019,1133)),this.effect.setVisible(!1)},onShow:function(){var n=this,s=game.BossShowMgr.inst().showArr.shift(),r=void 0;game.MonsterCfg.getDataAsync(s,function(e){if(e){r=e.model;var t=e.skills;if(0<t.length){var a=game.SkillCfg.getData(t[0]);n.skin.skillLabel.string=game.LangSkill.get(a.desc,a.descParam)}var i=e.isShow.split("_")[0].split("|");n.diffX=parseInt(i[0],10),n.diffY=parseInt(i[1],10)}else b8e.error("\u602a\u7269\u4e0d\u5b58\u5728id: ",s)}),n.skin.mainImage.loadTexture(game.ResCfg.getUrl(10220,r+"_1")),n.skin.skillImage.loadTexture(game.ResCfg.getUrl(10220,r+"_2")),n.skin.nameImage.loadTexture(game.ResCfg.getUrl(10220,r+"_3")),n.aniInit(),n.playAni()},onHide:function(){this.effect.stop(),this.effect.setVisible(!1),game.BossShowMgr.inst().showPlay()},playEnd:function(){game.module.hide(game.ME.BossShowView)},playAni:function(){var e=this;b8e.Tween.kill(e),b8e.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},250).call(e.showEffect,e).wait(1500).call(e.playEnd,e),b8e.Tween.kill(e.skin.bg),b8e.Tween.get(e.skin.bg).to({x:30,scaleX:1,scaleY:1},250);var t=60+e.diffX;b8e.Tween.kill(e.skin.mainImage),b8e.Tween.get(e.skin.mainImage).to({x:t},250),b8e.Tween.kill(e.skin.skillLabel),b8e.Tween.get(e.skin.skillLabel).wait(250).to({alpha:1},50),b8e.Tween.kill(e.skin.skillTitleImage),b8e.Tween.get(e.skin.skillTitleImage).wait(250).to({alpha:1},50),b8e.Tween.kill(e.skin.nameImage),b8e.Tween.get(e.skin.nameImage).wait(250).to({alpha:1},50)},aniInit:function(){var e=this;e.alpha=0,e.skin.bg.x=-1050,e.skin.mainImage.y=100+e.diffY,e.skin.mainImage.x=800,e.skin.skillLabel.alpha=0,e.skin.skillTitleImage.alpha=0,e.skin.nameImage.alpha=0,e.skin.bg.scaleX=0,e.skin.bg.scaleY=0},showEffect:function(){this.effect.play(),this.effect.setVisible(!0)}});b8e.app.registerView(game.ME.BossShowView,e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({init:function(){this._super(),this.showArr=[]},_addEvents:function(){this._super(),this.addEventByModule(game.ME.DailyExploit,game.DailyExploitEvts.C_DAILYEXPLOIT_EXP,this.onDayWeekTask),this.addEventByModule(game.ME.WeeklyExp,game.DailyExploitEvts.C_DAILYEXPLOIT_EXP2,this.onDayWeekTask),b8e.evt.addG(this,game.InstanceEvts.G_STOP_PLAY,this.battleEnd),this.addEventByModule(game.ME.Achieve,game.AchievementEvts.C2C_GET_NEW,this.onAchieveTask)},battleEnd:function(){this.startShow()},pushShowArr:function(e){this.showArr.push(e)},startShow:function(){var e=b8e.app.isShowView(game.ME.TopNotice);0<this.showArr.length&&!e&&!game.playBack.isInstanceFighting(!1)&&game.module.show(game.ME.TopNotice)},onDayWeekTask:function(e){if(game.moduleOpen.checkOpen(game.ME.TopNotice)&&e.data){var t=e.data.dailyType,a=e.data.dailyTask,i=void 0;if(1==t?i=game.dailyExploitData.expInfos.get(a.dailyExpType):2==t&&(i=game.dailyExploitData.expWeekInfos.get(a.dailyExpType)),i){if(i.isFinished&&!i.isGet){var n=game.DailyTaskCfg.getTaskDataByType(t,a.dailyExpType);n.isShow&&this.pushShowArr({mainType:t,cfg:n})}this.startShow()}}},onAchieveTask:function(e){if(game.moduleOpen.checkOpen(game.ME.TopNotice)){for(var t=e.data,a=t.length,i=0;i<a;i++){var n=t[i].cfg;n.isShow&&this.pushShowArr({mainType:3,cfg:n})}this.startShow()}}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$TopNoticeMgr",e)}(),function(){var e;e=b8e.Enum({}),b8e.RC("$$game","$$TopNoticeEvts",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1744)},init:function(){},onShow:function(){this.setLocalZOrder(9999),this.registerEvents(),this.updateView()},registerEvents:function(){b8e.evt.onC(this,this.onClick,this)},unRegisterEvents:function(){b8e.evt.offC(this,this.onClick,this)},_onTouchStart:function(e){var t=e.touch.getLocation();this.startY=t.y},_onTouchMove:function(e){var t=e.touch.getLocation();this.moveY=t.y,0<this.moveY-this.startY?this.dir=1:this.dir=-1},_onTouchEnd:function(e){var t=e.touch.getLocation();(this.endY=t.y,0<this.endY-this.startY)?40<=this.endY-this.startY&&this.playTween(!1):this.onClick()},_onTouchCancel:function(){0<this.dir&&this.playTween(!1)},onClick:function(){this.y=this.startY,game.module.showToggle(game.ME.DailyFuLi,this.type-1),this.showEnd()},onHide:function(){this.unRegisterEvents(),this._timer&&(b8e.Timer.remove(this,this.onClose),this._timer=null)},showEnd:function(){0<game.TopNoticeMgr.inst().showArr.length&&!game.playBack.isInstanceFighting(!1)?this.updateView():game.module.hide(game.ME.TopNotice)},updateView:function(){var e=this;e.playTween(!0);var t=game.TopNoticeMgr.inst().showArr.shift();switch(e.type=t.mainType,e.type){case 1:e.skin.titleLabel.string=game.Lang.get(53652),e.skin.descLabel.string=t.cfg.name;break;case 2:e.skin.titleLabel.string=game.Lang.get(53653),e.skin.descLabel.string=t.cfg.name;break;case 3:e.skin.titleLabel.string=game.Lang.get(53654);var a=game.Lang.get(t.cfg.lang,t.cfg.progress);e.skin.descLabel.string=a}e.skin.noticeIcon1.active=1==e.type,e.skin.noticeIcon2.active=2==e.type,e.skin.noticeIcon3.active=3==e.type;e._timer||(e._timer=b8e.Timer.add(e,e.onClose,4e3)),e._timer.reset(),e._timer.start()},onClose:function(){this.playTween(!1)},playTween:function(e){b8e.Tween.kill(this),e?(this.y=this.startY,b8e.Tween.get(this).to({y:this.endY},500)):b8e.Tween.get(this).to({y:this.startY},500).call(this.showEnd,this)},onStageResize:function(){var e=b8e.stageWidth,t=b8e.stageHeight;this.setPosition(e/2,t+50),this.startY=this.y+100,this.endY=this.y-100}});b8e.app.registerView(game.ME.TopNotice,e)}(),function(){var e=void 0;(e=game.GameBaseMgr.extends({init:function(){this._super(),this.moduleEnum=game.ME.AoyiExpand,this.moduleData=game.aoyiExpandData,this.Evts=game.AoyiExpandEvts,this.runeAlert=game.spotAlert.set(game.SAE.AOYI_RUNE,game.SAE.FOSTER_ZHANJI),this.enchAlert=game.spotAlert.set(game.SAE.AOYI_ENCH,game.SAE.FOSTER_ZHANJI)},_addEvents:function(){var e=this;e.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,e.updateItemInfo),e.addEventByModule(game.ME.Foster,game.BackEvts.C2C_FOSTER_DATA_INIT,e.initFosterData),e.addEventByModule(game.ME.Foster,game.BackEvts.C2C_FOSTER_ACTIVE,e.activeFoster),e.addEventByModule(game.ME.Foster,game.BackEvts.C2C_FOSTER_UPGRADE,e.upgradeFoster),e.addEventByModule(game.ME.Foster,game.BackEvts.C2C_FOSTER_UPSTAR,e.upstarFoster),e.addListenerPb(game.protoId.ActivateRunesResp,e.activateRunesResp),e.addListenerPb(game.protoId.AoyiEnchantmentResp,e.aoyiEnchantmentResp)},triggerOpen:function(e){e==game.ME.AoyiRune&&this.checkRuneAlert(),e==game.ME.AoyiEnch&&this.checkEnchAlert()},updateItemInfo:function(){game.moduleOpen.checkOpen(this.moduleEnum)&&(this.checkEnchAlert(),this.checkRuneAlert())},initFosterData:function(){this.refreshActiveList()},activeFoster:function(e){e&&e.data&&e.data==game.NewFosterType.ZHANJI&&this.refreshActiveList()},refreshActiveList:function(){this.activeList=game.fosterData.getFosterActiveIds(game.NewFosterType.ZHANJI),!this.activeList||this.activeList.length<1||(this.checkEnchAlert(),this.checkRuneAlert())},upgradeFoster:function(e){if(e&&e.data&&e.data==game.NewFosterType.ZHANJI){this.checkEnchAlert(),this.checkRuneAlert()}},upstarFoster:function(e){if(e&&e.data&&e.data==game.NewFosterType.ZHANJI){this.checkEnchAlert(),this.checkRuneAlert(),this.send(this.Evts.FOSTER_UPSTAR_SUCCESS)}},activateRunesResp:function(e){var t=e.readProtobuf(game.pb.ActivateRunesResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.slot,n=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,a);if(n){var s=n.runes;(s=s||(n.runes=[]))[s.length]=i,b8e.app.isShowView(game.ME.AoyiRuneInsert)&&game.module.hide(game.ME.AoyiRuneInsert),game.module.show(game.ME.AoyiRuneInsertSuccess),this.send(this.Evts.INSERT_RUNES_SUCCESS),this.checkRuneAlert(),this.updateFosterPower(),game.FightAmount.inst().showTeamStatPower()}else b8e.warn("\u6ca1\u6709\u8be5id\u7684\u5965\u4e49:   "+a)}},aoyiEnchantmentResp:function(e){var t=e.readProtobuf(game.pb.AoyiEnchantmentResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,a);if(i){i.enchLv++;var n=game.aoyiExpandData.getEnchCfg(i.enchLv);n&&n.isUnlockMaster&&game.module.show(game.ME.AoyiEnchUnlockSuccess),this.send(this.Evts.ENCH_SUCCESS_ANIM),this.send(this.Evts.AOYI_ENCH_UPDATE_INFO),this.checkEnchAlert(),this.isAuto&&b8e.setTimeout(this.autoEnch,this,500),this.updateFosterPower(),game.FightAmount.inst().showTeamStatPower()}else b8e.warn("\u6ca1\u6709\u8be5id\u7684\u5965\u4e49:   "+a)}},updateFosterPower:function(){if(b8e.module.isShowView(game.ME.Foster)&&game.fosterData.curFosterType==game.NewFosterType.ZHANJI){var e=b8e.module.getView(game.ME.Foster);e&&e.updatePower()}},autoEnch:function(){var e=this.moduleData.curAoyiId,t=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);this.moduleData.checkCanEnchantment(t,!0)?this.aoyiEnchantmentReq(e):this.send(this.Evts.STOP_AUTO_ENCH_AOYI)},aoyiEnchantment:function(e){this.aoyiEnchantmentReq(e)},setAutoEnch:function(e){(this.isAuto=e)||b8e.removeTimeout(this.autoEnch,this)},checkRuneAlert:function(){this.runeAlert.alert=this.checkAlert(!0)},checkEnchAlert:function(){this.enchAlert.alert=this.checkAlert(!0)},checkAlert:function(e){var t=!1;if(!this.activeList||this.activeList.length<1)return t;if(!game.moduleOpen.checkOpen(this.moduleEnum))return t;for(var a=this.activeList.length,i=void 0,n=void 0,s=0;s<a&&(i=this.activeList[s],!(n=game.AoyiExpandOpenCfg.getData(i.id))||i.lv<n.lv||i.star<n.star||!(t=e?this.moduleData.checkRuneAlert(i):this.moduleData.checkCanEnchantment(i)));s++);return t},aoyiEnchantmentReq:function(e){var t=game.pb.AoyiEnchantmentRequest;t.id=e,this.sendPb(game.protoId.AoyiEnchantmentReq,t)},activateRunesReq:function(e,t){var a=game.pb.ActivateRunesRequest;a.id=e,a.slot=t,this.sendPb(game.protoId.ActivateRunesReq,a)}}))._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$AoyiExpandMgr",e)}(),function(){var e,t=e=b8e.PoolObject.extends({unlockStar:0,spriteValue:0,spriteStatType:0,ctor:function(){this._super()},setCfgData:function(e,t){var a=this.spriteStat;(a=a||(this.spriteStat=game.SpriteStat.get())).setupByCfg(e),a.getSpriteStats().forEach(this.setSpriteStat,this);var i=game.aoyiExpandData.getEnchCfg(e.lv);i&&(this.unlockStar=i.star,this.isLock=t<e.lv)},setSpriteStat:function(e,t){this.spriteStatType=e,this.spriteValue=t},recycle:function(){this.reset(),this._super()},reset:function(){this.spriteValue=0,this.spriteStatType=0,this.isLock=!1,this.unlockStar=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$AoyiEnchDetailInfo",e)}(),function(){var e=b8e.Object.extends({curAoyiId:0,curRuneSlot:1,ctor:function(){this._super()},getOpenList:function(){var e=this.openList;(e=e||(this.openList=[])).length=0;var t=game.fosterData.getFosterActiveIds(game.NewFosterType.ZHANJI);if(!t||t.length<1)return e;for(var a=void 0,i=void 0,n=t.length,s=0;s<n;s++)a=t[s],!(i=game.AoyiExpandOpenCfg.getData(a.id))||a.lv<i.lv||a.star<i.star||(e[e.length]=a);return e},checkOpen:function(e){if(!e||!e.active)return!1;if(!game.moduleOpen.checkOpen(game.ME.AoyiExpand))return!1;var t=game.AoyiExpandOpenCfg.getData(e.id);return!(!t||e.lv<t.lv||e.star<t.star)},checkCanEnchantment:function(e,t){var a=1<arguments.length&&void 0!==t&&t;if(!e)return!1;if(!game.moduleOpen.checkOpen(game.ME.AoyiExpand))return!1;var i=this.getEnchCfg(e.enchLv);return!i||i.isMax?(a&&game.notice.show(53683),!1):!!game.UpgradeUtil.checkItemInfo(i.itemId,i.itemNum,a)},checkRuneAlert:function(e){if(!e)return!1;if(!game.moduleOpen.checkOpen(game.ME.AoyiExpand))return!1;var t=this.getRunesCfgByQuality(e.quality);return!!t&&(!(e.runes&&e.runes.length>=t.slotNum)&&!!game.UpgradeUtil.checkItemInfo(t.itemId,t.itemNum,!1))},getMasterAttrInfoList:function(e){var t=this.masterAttrInfoList,a=void 0,i=void 0;if((t=t||(this.masterAttrInfoList=[]))&&0<t.length){for(i=t.length,a=0;a<i;a++)t[a].release();t.length=0}var n=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e),s=game.fosterData.getFosterBaseCfg(game.NewFosterType.ZHANJI,e);if(s&&n){var r=this.getEnchMasterCfgs(s.quality);if(r&&!(r.length<1)){var o=n.enchLv;for(i=r.length,a=0;a<i;a++)t[a]=game.AoyiEnchDetailInfo.get(),t[a].setCfgData(r[a],o);return t}}},getEnchSpriteStatById:function(e){var t=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);if(!t)return null;var a=this.getTempSpriteStat(),i=this.getEnchCfg(t.enchLv);return i?(a.setupByCfg(i),a):void 0},getTempSpriteStat:function(){return this.tempSpriteStat||(this.tempSpriteStat=game.SpriteStat.get()),this.tempSpriteStat.clear(),this.tempSpriteStat},switchPage:function(e){this.curAoyiId=e},getEnchPos:function(e){if(e=6==e?0:e,this.posList&&this.posList[e])return this.posList[e];var t=game.CfgUtil.getMiscValue(game.AoyiExpandMiscCfg,"enchPos",!0,"|",!1);if(!t||t.length<1)return b8e.warn("\u6ca1\u6709\u914d\u7f6e\u5965\u4e49\u9644\u9b54\u5750\u6807\u70b9"),null;this.posList=[];for(var a=void 0,i=void 0,n=t.length,s=0;s<n;s++)!(a=t[s].split(","))||a.length<2?b8e.warn("\u5965\u4e49\u9644\u9b54\u5750\u6807\u70b9\u914d\u7f6e\u4e2a\u6570\u5f02\u5e38,\u5f02\u5e38\u7d22\u5f15\uff1a",s):((i=b8e.createMap()).x=+a[0],i.y=+a[1],this.posList[s]=i);return this.posList[e]},getRuneSpriteStat:function(e){if(!e||!e.runes||e.runes.length<1)return null;var t=void 0,a=void 0,i=this.getTempSpriteStat(),n=e.runes,s=n.length;for(t=0;t<s;t++)(a=this.getAoyiRunesAttrCfg(e.quality,n[t]))&&i.addByCfg(a);var r=this.getAoyiRunesMasterCfgs(e.quality);if(!r||r.length<1)return i;var o=void 0,g=r.length;for(t=0;t<g;t++)(o=r[t]).num>s||i.addByCfg(o);return i},getEnchSpriteStat:function(e){if(!e||!e.enchLv)return null;var t=e.enchLv,a=this.getTempSpriteStat(),i=this.getEnchCfg(t);i&&a.addByCfg(i);var n=this.getEnchMasterCfgs(e.quality);if(!n||n.length<1)return a;for(var s=void 0,r=n.length,o=0;o<r;o++)(s=n[o]).lv>t||a.addByCfg(s);return a},getEnchCfg:function(e){return game.AoyiEnchCfg.getData(e)},getEnchMasterCfgs:function(e){return this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.quality=e,game.AoyiEnchMasterCfg.getData(this.cfgObj,!0)},getEnchMasterCfgByQToLv:function(e,t){return this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.lv=t,this.cfgObj2.quality=e,game.AoyiEnchMasterCfg.getData(this.cfgObj2)},getRunesCfgByQuality:function(e){return this.cfgObj3||(this.cfgObj3=b8e.createMap()),this.cfgObj3.quality=e,game.AoyiRunesCfg.getData(this.cfgObj3)},getAoyiRunesMasterCfg:function(e,t){return this.cfgObj4||(this.cfgObj4=b8e.createMap()),this.cfgObj4.quality=e,this.cfgObj4.slotNum=t,game.AoyiRunesMasterCfg.getData(this.cfgObj4)},getAoyiRunesMasterCfgs:function(e){return this.cfgObj5||(this.cfgObj5=b8e.createMap()),this.cfgObj5.quality=e,game.AoyiRunesMasterCfg.getData(this.cfgObj5,!0)},getAoyiRunesAttrCfg:function(e,t){return this.cfgObj6||(this.cfgObj6=b8e.createMap()),this.cfgObj6.quality=e,this.cfgObj6.slot=t,game.AoyiRunesAttrCfg.getData(this.cfgObj6)}});game.aoyiExpandData=game.aoyiExpandData||new e}(),function(){var e;e=b8e.Enum({AOYI_ENCH_UPDATE_INFO:b8e.enc(),STOP_AUTO_ENCH_AOYI:b8e.enc(),ENCH_SUCCESS_ANIM:b8e.enc(),INSERT_RUNES_SUCCESS:b8e.enc(),FOSTER_UPSTAR_SUCCESS:b8e.enc()}),b8e.RC("$$game","$$AoyiExpandEvts",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1747),this.setSize(380,26)},setData:function(){var e=this.data,t=this.skin,a=game.AttrRulesCfg.getData(e.spriteStatType);if(a){var i=e.spriteValue;i=2==a.format?(100*i>>0)+"%":game.CCommonUtil.replaceNum(0|i,0),t.spriteStat.string=game.Lang.get(509,a.name,i),t.desc.string=e.isLock?game.Lang.get(53674,e.unlockStar):game.Lang.get(53675)}}}),b8e.RC("$$game","$$AoyiEnchDetailItem",e)}(),function(){var e=game.GamePanel.extends({rtSpaceX:200,rtSpaceY:30,ctor:function(){this._super(1748)},init:function(){var e=this.detailList=new game.List;e.itemRender=game.AoyiEnchDetailItem,e.addToParent(this.skin.masterList),e.layout.paddingLeft=0,e.layout.paddingTop=0,e.layout.spacingY=5,this.moduleData=game.aoyiExpandData,this.rtArr=[]},onShow:function(){this.updateView(),this.registerEvents()},onHide:function(){this.resetRichText(),this.unRegisterEvents()},registerEvents:function(){game.AoyiExpandMgr.inst().addEvent(game.AoyiExpandEvts.AOYI_ENCH_UPDATE_INFO,this.updateView,this)},unRegisterEvents:function(){game.AoyiExpandMgr.inst().removeEvent(game.AoyiExpandEvts.AOYI_ENCH_UPDATE_INFO,this.updateView,this)},updateView:function(){var e=this.moduleData.curAoyiId,t=this.moduleData.getMasterAttrInfoList(e);this.detailList.setData(t);var a=this.moduleData.getEnchSpriteStatById(e);a&&(this.tempY=this.rtSpaceY,a.getSpriteStats().forEach(this.setSpriteStat,this))},setSpriteStat:function(e,t){var a=this.getRichText(),i=this.rtArr;i[i.length]=a;var n=i.length%2==1?0:this.rtSpaceX;0==n&&(this.tempY-=this.rtSpaceY),a.parent||a.addToParent(this.skin.rtList);var s=game.AttrRulesCfg.getData(e);s&&(t=2==s.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(0|t,0),a.string=game.Lang.get(509,s.name,t),a.setPosition(n,this.tempY))},getRichText:function(){var e=b8e.RichText.get();return e.setAnchor(0,1),e.setFontSize(22),e.setLineHeight(24),e},resetRichText:function(){var e=this.rtArr;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0}}});b8e.app.registerView(game.ME.AoyiEnchDetail,e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1749)},onShow:function(){game.TweenUtil.rotationEffect(this.skin.light);var e=game.aoyiExpandData.curAoyiId,t=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);if(t){var a=t.enchLv,i=game.aoyiExpandData.getEnchMasterCfgByQToLv(t.quality,a),n=game.aoyiExpandData.getEnchCfg(a);if(i&&n){var s=this.spriteStat;(s=s||(this.spriteStat=game.SpriteStat.get())).setupByCfg(i),s.getSpriteStats().forEach(this.setSpriteStat,this),this.skin.unlockDesc.string=game.Lang.get(53676,n.star),this.createCountDown()}}},onHide:function(){this.clearCountDown(),b8e.Tween.kill(this.skin.light)},setSpriteStat:function(e,t){var a=game.AttrRulesCfg.getData(e);a&&(2==a.format&&(t=(100*t>>0)+"%"),this.skin.spriteStat.string=game.Lang.get(507,a.name,t))},createCountDown:function(){this.countDownTime=5,this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(this.moduleEnum)},onTouchNode:function(){game.module.hide(this.moduleEnum)},setBg:function(){var e=this.skin;e.huawen_3.width=e.huawen_1.width=e.gray.width=b8e.stage.width+100},onStageResize:function(){this._super(),this.setBg()}});b8e.app.registerView(game.ME.AoyiEnchUnlockSuccess,e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1750)},init:function(){var e=this.surfaceModel=new game.SurfaceModel;e.addToParent(this.skin.fosterAnim),e.initModel(),e.roleData.heroModel.type=game.RoleType.Zhanji,this.moduleData=game.aoyiExpandData,this.rtArr=[],this.skin.costIcon.isButton=!1},onShow:function(){this.activeList=this.moduleData.getOpenList(),this.skin.leftBtn.active=this.skin.rightBtn.active=!!(this.activeList&&1<this.activeList.length),this.updateView(),this.updateStar(),this.registerEvents()},onHide:function(){this.unRegisterEvents(),this.stopAnim(),this.stopAutoEnch(),b8e.removeTimeout(this.updateStar,this)},registerEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.AoyiExpandMgr.inst();e.addEvent(game.AoyiExpandEvts.AOYI_ENCH_UPDATE_INFO,this.updateView,this),e.addEvent(game.AoyiExpandEvts.ENCH_SUCCESS_ANIM,this.playAnim,this),e.addEvent(game.AoyiExpandEvts.STOP_AUTO_ENCH_AOYI,this.stopAutoEnch,this)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.AoyiExpandMgr.inst();e.removeEvent(game.AoyiExpandEvts.AOYI_ENCH_UPDATE_INFO,this.updateView,this),e.removeEvent(game.AoyiExpandEvts.ENCH_SUCCESS_ANIM,this.playAnim,this),e.removeEvent(game.AoyiExpandEvts.STOP_AUTO_ENCH_AOYI,this.stopAutoEnch,this)},stopAnim:function(){var e=this.upAnim;e&&(e.active=!1,e.stop())},updateView:function(){var e=this,t=e.skin,a=e.moduleData.curAoyiId,i=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,a);if(i){var n=i.cfg;if(n){e.updateModel(n),e.skin.fosterName.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name);var s=i.enchLv,r=e.enchCfg=e.moduleData.getEnchCfg(s);if(r){t.enchNode.active=!r.isMax,t.maxNode.active=r.isMax,e.updateCost();var o=e.spriteStat;(o=o||(e.spriteStat=game.SpriteStat.get())).setupByCfg(r);var g=o.getSpriteStats(),u=g.count();e.spaceX=t.enchSpriteStat.width/(u+1),e.xx=e.spaceX;e.resetRichText(),g.forEach(e.setSpriteStat,e,!1);var l=game.AttrRulesCfg.getData(r.curAttrId);if(l){var c=i.enchLv%7,h=e.moduleData.getEnchPos(c);t.curAttrBg.active=!0,h&&t.curAttrBg.setPosition(h);var m=r.curAttrValue;2==l.format?m+="%":m=game.CCommonUtil.replaceNum(m>>0,0),t.curAttr.string=game.Lang.get(507,l.name,m)}else t.curAttrBg.active=!1;var d=e.moduleData.getEnchMasterCfgs(i.quality);if(!d||d.length<1)t.masterUnLockDesc.string="";else{var f=void 0;d.sort(e.onSort);for(var p=d.length,v=0;v<p&&!((f=d[v]).lv>s);v++);var E=e.moduleData.getEnchCfg(f.lv);if(f&&E){var T=e.masterSpriteStat;(T=T||(e.masterSpriteStat=game.SpriteStat.get())).setupByCfg(f),(g=T.getSpriteStats()).forEach(e.setMasterSpriteStat,e),t.masterUnLockDesc.string=f.lv>s?game.Lang.get(53674,E.star):game.Lang.get(53677)}}}}}},onSort:function(e,t){return e.lv-t.lv},updateModel:function(e){if(e){var t=this.surfaceModel;t.y=e.uiOffsetY?e.uiOffsetY:0;var a=e.uiScale?e.uiScale:1,i=t.role;i&&((i.getAnimator(game.AnimType.BODY,1)||i.addAnimator(game.AnimType.BODY,1)).setScale(a,a),game.AvatarUtil.updateModel(e,t,game.RoleType.Zhanji))}},updateCost:function(){if(this.enchCfg&&!this.enchCfg.isMax){var e=this.enchCfg.itemId,t=this.enchCfg.itemNum,a=game.ItemInfoCfg.getData(e);if(a){var i=this.skin,n=i.costIcon,s=i.costNum;n.loadTexture(game.ResCfg.getUrl(137,a.icon));var r=game.itemData.getCountById(e),o=r<t?503:504;s.string=game.Lang.get(o,game.CCommonUtil.replaceNum(r,0),t);var g=n.width+s.width+5>>1;n.x=(n.width>>1)-g,s.x=n.x+(n.width>>1)+5,this.updateAlert()}}},playAnim:function(){var e=this,t=e.moduleData.curAoyiId,a=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,t);if(a){var i=e.upAnim;i||((i=e.upAnim=b8e.Animator.get(game.AnimType.UI_EFFECT,1)).addToParent(e.skin.angleLightNode),i.addFinishCallback(e.animaCB,e));var n=0,s=a.enchLv%7;if(0==s)i.load(game.ResCfg.getUrl(5019,1136)),i.setRotation(0,0,0),i.setPosition(0,0),n=350;else{s--;var r=e.getComponent("light_"+s);i.setPosition(r.x,r.y);var o=r.getRotation();i.setRotation(o),i.load(game.ResCfg.getUrl(5019,1135)),n=500}i.active=!0,i.play(null,0),b8e.hasTimeout(e.updateStar,e)&&(e.updateStar(),b8e.removeTimeout(e.updateStar,e)),b8e.setTimeout(e.updateStar,e,n)}},animaCB:function(){this.upAnim.active=!1},updateStar:function(){var e=this;if(e.enchCfg){e.starImgPool||(e.starImgPool=[]),e.resetStar();for(var t=void 0,a=10<e.enchCfg.star?10:e.enchCfg.star,i=0;i<a;i++)(t=e.starImgPool[i])||((t=e.starImgPool[i]=b8e.Sprite.get()).setAnchor(0,.5),t.setScale(.8,.8),t.addToParent(e.skin.starNode),t.setPosition(40*i,0),t.loadTexture(game.ResCfg.getUrl(10078))),t.active=!0;10<e.enchCfg.star?e.skin.starNum.string="X"+e.enchCfg.star:e.skin.starNum.string="";for(var n=e.enchCfg.lv%7,s=0;s<6;s++)e.getComponent("light_"+s).active=s<n}},resetStar:function(){if(this.starImgPool&&!(this.starImgPool.length<1))for(var e=this.starImgPool.length,t=0;t<e;t++)this.starImgPool[t].active=!1},setSpriteStat:function(e,t,a,i){var n=this.getRichText(i),s=this.rtArr;s[s.length]=n;var r=game.AttrRulesCfg.getData(e);r&&(t=2==r.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(t>>0,0),n.string=game.Lang.get(509,r.name,t),n.addToParent(this.skin.enchSpriteStat),n.setPosition(this.xx,0),this.xx+=this.spaceX)},setMasterSpriteStat:function(e,t){e=+e;var a=game.AttrRulesCfg.getData(e);a&&(t=2==a.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(t>>0,0),this.skin.enchMasterSpriteStat.string=game.Lang.get(509,a.name,t))},getRichText:function(e){var t=b8e.RichText.get();return e?t.setAnchor(0,.5):t.setAnchor(.5,.5),t.setFontSize(22),t.setLineHeight(24),t},resetRichText:function(){var e=this.rtArr;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0}},leftBtn:function(){this.switchPage(!0)},rightBtn:function(){this.switchPage(!1)},switchPage:function(e){var t=this;if(t.activeList&&!(t.activeList.length<2)){for(var a=t.moduleData.curAoyiId,i=t.activeList.length,n=0,s=0;s<i;s++)if(t.activeList[s]&&t.activeList[s].id==a){n=s;break}n=e?0<n?n-1:i-1:n<i-1?n+1:0;var r=t.activeList[n];t.moduleData.switchPage(r.id),t.updateView(),t.updateStar(),t.stopAutoEnch(),t.stopAnim(),b8e.removeTimeout(t.updateStar,t)}},autoEnchBtn:function(){var e=this.moduleData.curAoyiId,t=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);this.moduleData.checkCanEnchantment(t,!0)&&(this.setAutoEnchBtn(!this.isAuto),this.isAuto&&game.AoyiExpandMgr.inst().aoyiEnchantment(t.id))},setAutoEnchBtn:function(e){this.isAuto=e,game.AoyiExpandMgr.inst().setAutoEnch(e),this.skin.btnLab2.string=e?game.Lang.get(53678):game.Lang.get(53679)},stopAutoEnch:function(){this.setAutoEnchBtn(!1)},enchBtn:function(){if(this.isAuto)game.notice.show(53680);else{var e=this.moduleData.curAoyiId,t=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);this.moduleData.checkCanEnchantment(t,!0)&&game.AoyiExpandMgr.inst().aoyiEnchantment(t.id,!1)}},checkMasterBtn:function(){game.module.show(game.ME.AoyiEnchDetail)},costIcon:function(){if(this.enchCfg){var e=game.ItemInfoCfg.getData(this.enchCfg.itemId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}},updateAlert:function(){var e=this.moduleData.curAoyiId,t=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);t&&(this.skin.redPoint.active=this.moduleData.checkCanEnchantment(t))}});b8e.app.registerView(game.ME.AoyiEnch,e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1751)},onShow:function(){var e=this;game.TweenUtil.rotationEffect(e.skin.light);var t=game.aoyiExpandData,a=t.curAoyiId,i=t.curRuneSlot,n=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,a);if(n){var s=e.aoyiRunesCfg=t.getRunesCfgByQuality(n.quality),r=t.getAoyiRunesAttrCfg(n.quality,i);if(s&&r){var o=e.spriteStat;(o=o||(e.spriteStat=game.SpriteStat.get())).setupByCfg(r);var g=o.getSpriteStats();e.xx=0,e.spaceX=e.skin.spriteStat.width/(g.count()+1),e.resetRichText(),g.forEach(e.setSpriteStat,e),e.skin.runeIconBg.loadTexture(game.ResCfg.getUrl(10227,n.quality)),e.skin.runeIcon.loadTexture(game.ResCfg.getUrl(10226,s.runeImg)),e.createCountDown()}}},onHide:function(){this.clearCountDown(),b8e.Tween.kill(this.skin.light)},setSpriteStat:function(e,t){var a=this.getRichText();this.xx+=this.spaceX;var i=this.rtArr;(i=i||(this.rtArr=[]))[i.length]=a;var n=game.AttrRulesCfg.getData(e);n&&(t=2==n.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(t>>0,0),a.string=game.Lang.get(507,n.name,t),a.addToParent(this.skin.spriteStat),a.setPosition(this.xx,0))},getRichText:function(){var e=b8e.RichText.get();return e.setAnchor(.5,.5),e.setFontSize(22),e.setLineHeight(24),e},resetRichText:function(){var e=this.rtArr;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0}},createCountDown:function(){this.countDownTime=5,this.timer||(this.timer=b8e.Timer.add(this,this.updateTime,1e3)),this.timer.reset(),this.timer.start()},clearCountDown:function(){this.timer&&(b8e.Timer.remove(this,this.updateTime),this.timer=null)},updateTime:function(){this.countDownTime--,this.skin.time.string=game.Lang.get(51538,this.countDownTime),this.countDownTime<1&&game.module.hide(this.moduleEnum)},onTouchNode:function(){game.module.hide(this.moduleEnum)},setBg:function(){var e=this.skin;e.huawen_3.width=e.huawen_1.width=e.gray.width=b8e.stage.width+100},onStageResize:function(){this._super(),this.setBg()}});b8e.app.registerView(game.ME.AoyiRuneInsertSuccess,e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1752)},onShow:function(){var e=game.aoyiExpandData.curAoyiId,t=game.aoyiExpandData.curRuneSlot,a=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,e);if(a){var i=a.quality,n=this.aoyiRunesCfg=game.aoyiExpandData.getRunesCfgByQuality(i),s=game.aoyiExpandData.getAoyiRunesAttrCfg(i,t);if(n&&s){this.updateCost();var r=this.spriteStat;(r=r||(this.spriteStat=game.SpriteStat.get())).setupByCfg(s),r.getSpriteStats().forEach(this.setSpriteStat,this),this.skin.runeIconBg.loadTexture(game.ResCfg.getUrl(10227,i)),this.skin.runeIcon.loadTexture(game.ResCfg.getUrl(10226,n.runeImg)),this.registerEvents()}}},onHide:function(){this.unRegisterEvents()},registerEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost)},updateCost:function(){if(this.aoyiRunesCfg){var e=this.aoyiRunesCfg.itemId,t=this.aoyiRunesCfg.itemNum,a=game.ItemInfoCfg.getData(e);if(a){var i=this.skin,n=i.costIcon,s=i.costNum;n.loadTexture(game.ResCfg.getUrl(137,a.icon));var r=game.itemData.getCountById(e),o=r<t?503:504;s.string=game.Lang.get(o,game.CCommonUtil.replaceNum(r,0),t)}}},setSpriteStat:function(e,t){e=+e;var a=game.AttrRulesCfg.getData(e);if(a){t=2==a.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(t>>0,0);var i=this.skin.spriteStat;""!=i.string&&(i.string+="<br/>"),i.string=game.Lang.get(509,a.name,t)}},insertBtn:function(){var e=this.aoyiRunesCfg;if(e)return!!game.UpgradeUtil.checkItemInfo(e.itemId,e.itemNum)&&void game.AoyiExpandMgr.inst().activateRunesReq(game.aoyiExpandData.curAoyiId,game.aoyiExpandData.curRuneSlot)},costIcon:function(){if(this.aoyiRunesCfg){var e=game.ItemInfoCfg.getData(this.aoyiRunesCfg.itemId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}}});b8e.app.registerView(game.ME.AoyiRuneInsert,e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1753)},init:function(){var e=this.surfaceModel=new game.SurfaceModel;e.addToParent(this.skin.fosterAnim),e.initModel(),e.roleData.heroModel.type=game.RoleType.Zhanji,this.moduleData=game.aoyiExpandData,this.rtArr=[],this.skin.itemIcon.isButton=!1,this.skin.itemAddBtn.isButton=!1},onShow:function(){this.activeList=this.moduleData.getOpenList(),this.skin.leftBtn.active=this.skin.rightBtn.active=!!(this.activeList&&1<this.activeList.length),this.updateView(),this.registerEvents()},onHide:function(){this.unRegisterEvents()},registerEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.AoyiExpandMgr.inst();e.addEvent(game.AoyiExpandEvts.INSERT_RUNES_SUCCESS,this.updateView,this),e.addEvent(game.AoyiExpandEvts.FOSTER_UPSTAR_SUCCESS,this.updateView,this)},unRegisterEvents:function(){this.removeEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateCost);var e=game.AoyiExpandMgr.inst();e.removeEvent(game.AoyiExpandEvts.INSERT_RUNES_SUCCESS,this.updateView,this),e.removeEvent(game.AoyiExpandEvts.FOSTER_UPSTAR_SUCCESS,this.updateView,this)},updateView:function(){var e=this,t=e.moduleData.curAoyiId,a=e.aoyiInfo=game.fosterData.getFosterInfo(game.NewFosterType.ZHANJI,t);if(a&&a.cfg){var i=a.cfg;if(e.updateModel(i),e.setStar(),e.skin.fosterName.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),e.runesCfg=e.moduleData.getRunesCfgByQuality(a.quality)){e.setSlot(),e.updateCost(),e.resetRichText();var n=a.runes?a.runes.length:0,s=e.moduleData.getAoyiRunesMasterCfgs(a.quality);if(s&&!(s.length<1)){var r=void(e.yy=0),o=s.length,g=e.masterSpriteStat;g=g||(e.masterSpriteStat=game.SpriteStat.get()),s.sort(e.onSort);var u=e.paramsArr;u=u||(e.paramsArr=[]);for(var l=e.skin.masterSpriteStat.width=0;l<o;l++){r=s[l],g.setupByCfg(r);var c=g.getSpriteStats();u[l]||(u[l]=b8e.createMap()),u[l].activeNum=n,u[l].num=r.num,c.forEach(e.setMasterSpriteStat,e,u[l])}e.skin.masterSpriteStat.x=332-(e.skin.masterSpriteStat.width>>1)}}}},onSort:function(e,t){return e.num-t.num},setMasterSpriteStat:function(e,t,a,i){var n=this.getRichText(),s=this.rtArr;s[s.length]=n,e=+e;var r=game.AttrRulesCfg.getData(e);if(r){2==r.format&&(t=(100*t>>0)+"%");var o=i.activeNum>=i.num?53681:53682;n.string=game.Lang.get(o,i.num,r.name,t),n.addToParent(this.skin.masterSpriteStat),n.setPosition(0,this.yy),this.yy-=30;var g=this.skin.masterSpriteStat.width;this.skin.masterSpriteStat.width=g>n.width?g:n.width}},setSlot:function(){var e=this,t=e.aoyiInfo,a=e.runesCfg;if(a&&t){var i=a.slotNum,n=a.slotPos;if(!n||n.length<i)b8e.warn("\u69fd\u4f4d\u6570\u91cf\u5c11\u4e8e\u53ef\u8bbe\u7f6e\u7684\u69fd\u4f4d\u5750\u6807\u6570\u91cf");else{e.resetSlot();var s=void 0,r=t.runes,o=e.skin.slotNode.width-18*i>>1,g=e.slotSpriteStat;g=g||(e.slotSpriteStat=game.SpriteStat.get());for(var u=void 0,l=void 0,c=void 0,h=void 0,m=game.UpgradeUtil.checkItemInfo(a.itemId,a.itemNum,!1),d=0;d<i;d++)u=d+1,c=!!r&&-1<r.indexOf(u),(l=e.getComponent("slot_btn_"+u)).active=!0,l.isButton=!c,l.setPosition(n[d].X,n[d].Y),e.getComponent("slot_bg_"+u).loadTexture(game.ResCfg.getUrl(10227,t.quality)),e.getComponent("slot_icon_"+u).loadTexture(game.ResCfg.getUrl(10226,a.runeImg)),e.getComponent("slot_attr_gray_"+u).active=!c,e.getComponent("add_btn_"+u).active=m&&!c,e.getComponent("slot_attr_"+u).string="",h=e.moduleData.getAoyiRunesAttrCfg(t.quality,u),g.setupByCfg(h),g.getSpriteStats().forEach(e.setSlotSprite,e,u),(s=e.getComponent("sslot_"+u)).active=!0,s.x=o+18*d,e.getComponent("sslot_light_"+u).active=c}}},setSlotSprite:function(e,t,a,i){e=+e;var n=game.AttrRulesCfg.getData(e);if(n){t=2==n.format?(100*t>>0)+"%":game.CCommonUtil.replaceNum(t>>0,0);var s=this.getComponent("slot_attr_"+i);""!=s.string&&(s.string+="<br/>"),s.string+=game.Lang.get(507,n.name,t)}},resetSlot:function(){for(var e=void 0,t=0;t<8;t++)e=t+1,this.getComponent("sslot_"+e).active=!1,this.getComponent("slot_btn_"+e).active=!1},updateModel:function(e){if(e){var t=this.surfaceModel;t.y=e.uiOffsetY?e.uiOffsetY:0;var a=e.uiScale?e.uiScale:1,i=t.role;i&&((i.getAnimator(game.AnimType.BODY,1)||i.addAnimator(game.AnimType.BODY,1)).setScale(a,a),game.AvatarUtil.updateModel(e,t,game.RoleType.Zhanji))}},updateCost:function(){var e=this.skin,t=this.runesCfg;if(t&&t.itemId){var a=t.itemId,i=game.ItemInfoCfg.getData(a);i&&(e.itemIcon.loadTexture(game.ResCfg.getUrl(137,i.icon)),e.itemName.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),e.itemNum.string=game.itemData.getCountById(a))}},itemIcon:function(){if(this.runesCfg){var e=game.ItemInfoCfg.getData(this.runesCfg.itemId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}},itemAddBtn:function(){if(this.runesCfg){var e=game.ItemInfoCfg.getData(this.runesCfg.itemId);e&&game.UpgradeUtil.showAccessTips(e,!1)}},setStar:function(){if(this.aoyiInfo){this.starArr||(this.starArr=[]),this.resetStar();for(var e=void 0,t=this.aoyiInfo.star,a=this.skin.starNode,i=a.width-40*t>>1,n=0;n<t;n++)(e=b8e.Sprite.get()).setAnchor(0,.5),e.setScale(.8,.8),e.addToParent(a),e.loadTexture(game.ResCfg.getUrl(10078)),e.x=i+40*n,this.starArr[n]=e}},resetStar:function(){var e=this.starArr;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0}},getRichText:function(){var e=b8e.RichText.get();return e.setAnchor(0,1),e.setFontSize(22),e.setLineHeight(24),e},resetRichText:function(){var e=this.rtArr;if(e&&!(e.length<1)){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0}},slot_btn_1:function(){this.onSlotClick(1)},slot_btn_2:function(){this.onSlotClick(2)},slot_btn_3:function(){this.onSlotClick(3)},slot_btn_4:function(){this.onSlotClick(4)},slot_btn_5:function(){this.onSlotClick(5)},slot_btn_6:function(){this.onSlotClick(6)},slot_btn_7:function(){this.onSlotClick(7)},slot_btn_8:function(){this.onSlotClick(8)},onSlotClick:function(e){!this.aoyiInfo||this.aoyiInfo.runes&&-1<this.aoyiInfo.runes.indexOf(e)||(this.moduleData.curRuneSlot=e,game.module.show(game.ME.AoyiRuneInsert))},leftBtn:function(){this.switchPage(!0)},rightBtn:function(){this.switchPage(!1)},switchPage:function(e){if(this.activeList&&!(this.activeList.length<2)){for(var t=this.moduleData.curAoyiId,a=this.activeList.length,i=0,n=0;n<a;n++)if(this.activeList[n]&&this.activeList[n].id==t){i=n;break}i=e?0<i?i-1:a-1:i<a-1?i+1:0;var s=this.activeList[i];this.moduleData.switchPage(s.id),this.updateView()}}});b8e.app.registerView(game.ME.AoyiRune,e)}(),function(){var e;e=b8e.Object.extends({bagSelect:0,id:0,lv:0,exp:0,star:0,addRate:0,cfg:null,quality:0,name:null,slot:0,fightAmount:0,isBackAlert:!1,lvAlert:!1,starAlert:!1,starCfg:null,ctor:function(){this._super(),this.baseSpriteStat=game.SpriteStat.get(),this.levelSpriteStat=game.SpriteStat.get(),this.starSpriteStat=game.SpriteStat.get(),this.bookSpriteStat=game.SpriteStat.get(),this.allSpriteStat=game.SpriteStat.get()},setData:function(e){var t=this;t.bagSelect=!1,t.id=e.id,t.cfg=game.MythBaseCfg.getData(t.id),e.lv&&(t.lv=e.lv),e.exp&&(t.exp=e.exp),e.star&&(t.star=e.star),t.cfg&&(t.quality=t.cfg.quality,t.name=t.cfg.name,t.baseSpriteStat.setupByCfg(t.cfg)),t.updateLvSpriteStat(),t.updateStarSprite(),t.checkBookSprite(),t.updateAllStat()},updateLv:function(e,t){var a=0<arguments.length&&void 0!==e?e:0,i=1<arguments.length&&void 0!==t?t:0;this.lv=a,this.exp=i,this.updateLvSpriteStat(),this.updateAllStat()},updateLvSpriteStat:function(){var e=this;if(e.levelSpriteStat.clear(),e.cfg){var t=Math.floor(e.cfg.perTeamAtk*e.lv*e.addRate),a=Math.floor(e.cfg.perTeamDef*e.lv*e.addRate),i=Math.floor(e.cfg.perTeamHp*e.lv*e.addRate);e.levelSpriteStat.setStatValue(game.SpriteStatType.TeamAtk,t),e.levelSpriteStat.setStatValue(game.SpriteStatType.TeamDef,a),e.levelSpriteStat.setStatValue(game.SpriteStatType.TeamHp,i)}},updateStar:function(e){this.star=e,this.updateStarSprite(),this.updateAllStat()},updateStarSprite:function(){this.starSpriteStat.clear();var e=this.starCfg=game.MythStarCfg.getOneData(this.id,this.star);e&&(this.addRate=.001*e.addRate+1,this.starSpriteStat.setStatValue(game.SpriteStatType.TeamAtk,e.teamAtk),this.starSpriteStat.setStatValue(game.SpriteStatType.TeamDef,e.teamDef),this.starSpriteStat.setStatValue(game.SpriteStatType.TeamHp,e.teamHp),this.updateLvSpriteStat())},checkBookSprite:function(){var e=game.MythFettersCfg.getData(this.id);if(e){var t=e.ids;if(t&&!(t.length<2)){var a=t[1];a==this.id&&(a=t[0]);var i=game.GodAnimalMgr.inst().getGodAnimalInfoById(a);i&&(i.updateBookSprite(),this.updateBookSprite())}}},updateBookSprite:function(){this.bookSpriteStat.clear();var e=game.MythFettersCfg.getData(this.id);e&&(this.bookSpriteStat.setupByCfg(e),this.updateAllStat())},getAllSpriteStat:function(){this.allSpriteStat.clear(),this.allSpriteStat.addSpriteStat(this.baseSpriteStat),this.allSpriteStat.addSpriteStat(this.levelSpriteStat),this.allSpriteStat.addSpriteStat(this.starSpriteStat),this.allSpriteStat.addSpriteStat(this.bookSpriteStat)},updateAllStat:function(){this.getAllSpriteStat(),this.fightAmount=this.allSpriteStat.getPower()}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalInfo",e)}(),function(){var o=void 0;o=game.GameBaseMgr.extends({defaultSlot:0,curSelectSlot:0,willSlot:0,selPos:0,bagSelectIndex:0,bagSelectId:0,wearStrongSel:0,defaultSelEquipIdx:0,bagStrongSelIdx:0,totalExpAddPre:0,strongMaxLv:0,upgradeMaxLv:0,starMaxNum:0,isShowStrongAlert:!0,allEquipItemExp:0,showType:0,skillShowInfo:null,starTipsShowInfo:null,isInit:!1,init:function(){var e=this;e._super(),e.modelRequest(),e.addListenerPb(game.protoId.MythModelResp,e.moduleData);var t=game.spotAlert;e.godAnimalAlert=t.set(game.SAE.GOD_ANIMAL,game.SAE.YANGCHENG_ALERT),e.godAnimalMessageAlert=t.set(game.SAE.GOD_ANIMAL_MESSAGE,game.SAE.GOD_ANIMAL),e.godAnimalBagAlert=t.set(game.SAE.GOD_ANIMAL_BAG),e.godAnimalBagActAlert=t.set(game.SAE.GOD_ANIMAL_BAG_ACT,game.SAE.GOD_ANIMAL_BAG),e.godAnimalBagChipAlert=t.set(game.SAE.GOD_ANIMAL_BAG_CHIP,game.SAE.GOD_ANIMAL_BAG),e._costList=[];for(var a=game.MythBookCfg.getDatas(),i=void 0,n=0,s=a.length;n<s;n++)(i={}).cfg=a[n],i.num=game.itemData.getNumById(i.cfg.id),e._costList.push(i);e.itemExpDic=b8e.createMap(),e.itemExpIdList=[];var r=game.MythEquipExpCfg.getDatas();if(r)for(var o=r.length,g=void 0,u=0;u<o;u++)g=r[u],e.itemExpDic[g.id]=g.val,e.itemExpIdList.push(g.id)},addPbEvent:function(){var e=this;e.addListenerPb(game.protoId.MythBattleResp,e.mythBattleRespHandler),e.addListenerPb(game.protoId.MythEquipResp,e.mythEquipRespHandler),e.addListenerPb(game.protoId.MythCastEquipResp,e.mythCastEquipRespHandler),e.addListenerPb(game.protoId.MythActiveResp,e.mythActiveRespHandler),e.addListenerPb(game.protoId.MythEquipForgeResp,e.mythEquipForgeRespHandler),e.addListenerPb(game.protoId.MythBagEquipForgeResp,e.mythBagEquipForgeRespHandler),e.addListenerPb(game.protoId.MythUpgradeResp,e.mythUpgradeRespHandler),e.addListenerPb(game.protoId.MythStarResp,e.mythStarRespHandler)},addOtherEvent:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateBackCount),this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_SYN_BACK_INFO,this.updateBackCount)},initData:function(){var e=this;e.isInit=!0,e.slotInfoList=[],e.animalInfoMaps=b8e.HashMap.get(),e.selStrongInfoList=b8e.LinkedList.get(),e.bookSpriteStat=game.SpriteStat.get(),e.activeTipsId=[],e.detailList=[],e.bookList=[],e.skillInfos=[],e.initSlot(),e.addPbEvent(),e.addOtherEvent();var t=game.MythMiscCfg.getData("lvMax");t&&(e.upgradeMaxLv=+t.value),(t=game.MythMiscCfg.getData("starMax"))&&(e.starMaxNum=+t.value),(t=game.MythMiscCfg.getData("strongMax"))&&(e.strongMaxLv=+t.value),e.createBookInfo(),e.dropList=[]},moduleData:function(e){var t=e.readProtobuf(game.pb.MythModel);0<t.code?game.notice.noticeError(t.code):(this.initData(),this.godAnimalInfoInit(t.myths),this.slotInfoInit(t.slots))},updateBackCount:function(){this.allEquipItemExp=0;for(var e=this.itemExpIdList.length,t=void 0,a=void 0,i=0;i<e;i++)t=this.itemExpIdList[i],a=game.itemData.getCountById(t)*this.itemExpDic[t]||0,this.allEquipItemExp+=a;this.checkAlert(),this.send(game.GodAnimalEvts.BACK_ITEM_UPDATE)},godAnimalInfoInit:function(e){if(e)for(var t=e.length,a=void 0,i=0;i<t;i++)a=e[i],this.activeAnimalInfo(a.id,a)},activeAnimalInfo:function(e,t){var a=void 0;this.animalInfoMaps.has(e)||((a=new game.GodAnimalInfo).setData(t),this.animalInfoMaps.set(e,a))},getGodAnimalInfoById:function(e){return this.animalInfoMaps.get(e)},getNotBattleAnimalList:function(){this.notBattleList||(this.notBattleList=[]);var e=void 0;this.notBattleList.length=0;for(var t=this.animalInfoMaps.values(),a=0,i=t.length;a<i;a++)(e=t[a]).slot||this.notBattleList.push(e);return this.notBattleList.sort(this.changeSort),this.notBattleList},changeSort:function(e,t){return t.fightAmount-e.fightAmount},checkBagActAlert:function(){for(var e=void 0,t=this.animalInfoMaps.values(),a=t.length,i=0;i<a;i++)if((e=t[i])&&(this.canUpgrade(e)||this.canStar(e)))return!0;return!1},checkBagChipAlert:function(){for(var e=this.getChipList(),t=e.length,a=void 0,i=void 0,n=void 0,s=void 0,r=0;r<t;r++)if((a=e[r])&&(i=a.cfg)){var o=void 0;if(n=this.getGodAnimalInfoById(i.id)){if(!n.starCfg)continue;if(n.starCfg.isMax)return!1;o=n.starCfg.itemId,s=n.starCfg.num}else{var g=i.chipItems[0];o=g.Id,s=g.Num}if(s<=game.itemData.getNumById(o))return!0}return!1},checkCanBattleAlert:function(){for(var e=void 0,t=0,a=0,i=this.slotInfoList.length,n=0;n<i;n++)(e=this.slotInfoList[n])&&(e.info?a++:e.needLevel<=game.mainRoleData.lv&&t++);return 0<this.animalInfoMaps.count()-a&&0<t},checkAlert:function(){var e=this;if(game.moduleOpen.checkOpen(game.ME.GodAnimalPanel)){for(var t=e.checkBagActAlert(),a=e.checkBagChipAlert(),i=e.checkCanBattleAlert(),n=!1,s=void 0,r=void 0,o=e.slotInfoList.length,g=0;g<o;g++)(s=e.slotInfoList[g])&&(s.isBattleAlert=i,(r=s.info)&&(r.lvAlert=e.canUpgrade(r),r.starAlert=e.canStar(r)),s.checkAllAlert(),n=n||s.equipAlert);e.godAnimalBagActAlert.alert=t,e.godAnimalBagChipAlert.alert=a,e.godAnimalMessageAlert.alert=n||t||a||i}},openEquipExList:function(e){this.selPos=e,game.module.show(game.ME.GodAnimalExChange)},setWearStrongSelect:function(e){this.wearStrongSel!=e&&(this.wearStrongSel=e,this.send(game.GodAnimalEvts.EQUIP_STRONG_SLOT_CHANGE))},getStrongSelSlotInfo:function(){return this.wearStrongSel?this.getSlotInfoBySlot(this.wearStrongSel):null},getStrongCostList:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this;if(a.strongInfoList||(a.strongInfoList=[]),!t)return a.strongInfoList;var i=a.strongInfoList.slice(),n=a.itemExpIdList.length,s=void 0;a.strongInfoList.length=0,a.resetStrongPreData();for(var r=0;r<n;r++)for(var o=a.itemExpIdList[r],g=game.itemData.getCountById(o),u=0;u<g;u++)(s=(s=i.pop())||game.GodAnimalStrongCostInfo.get()).id=o,s.idx=0,s.offerExp=a.itemExpDic[o],s.order=0,s.isSelect=!1,a.strongInfoList.push(s);var l=game.equipData.godAnimalEquipMap.values();n=l.length;for(var c=void 0,h=0;h<n;h++)(c=l[h]).idx!=a.bagStrongSelIdx&&((s=(s=i.pop())||game.GodAnimalStrongCostInfo.get()).idx=c.idx,s.id=0,s.offerExp=c.exp+c.cfg.exp+c.strongCfg.totalExp,s.order=c.cfg.order,s.isSelect=!1,a.strongInfoList.push(s));for(var m=0,d=i.length;m<d;m++)i[m].release();return a.strongInfoList},chooseMaterials:function(e,t){t?this.addMaterals(e):this.selStrongInfoList.has(e)&&(this.selStrongInfoList.remove(e),this.totalExpAddPre-=e.offerExp),this.send(game.GodAnimalEvts.EQUIP_STRONG_SELECT_CHANGE)},addMaterals:function(e){this.selStrongInfoList.has(e)||(this.selStrongInfoList.append(e),this.totalExpAddPre+=e.offerExp)},setAlertCallBack:function(e,t,a,i){var n=this;n.clickCallBack||(n.clickCallBack=b8e.createMap()),n.clickCallBack.callBack=e,n.clickCallBack.cancelBack=t,n.clickCallBack.thisArg=a,n.alertOption||(n.alertOption={thisArg:n,okcb:n.sureHandler,cancelcb:n.cancelHandler,showtips:!0,lang:null,defaultSelect:!0}),n.alertOption.lang=i,game.alert.showTwo(n.alertOption)},sureHandler:function(e){this.isShowStrongAlert=!e,this.clickCallBack.callBack&&this.clickCallBack.callBack.call(this.clickCallBack.thisArg,!0)},cancelHandler:function(){this.clickCallBack.cancelBack&&this.clickCallBack.cancelBack.call(this.clickCallBack.thisArg)},resetStrongPreData:function(){for(var e=this.selStrongInfoList.values(),t=e.length,a=void 0,i=0;i<t;i++)(a=e[i])&&(a.isSelect=!1);this.selStrongInfoList.clear(),this.totalExpAddPre=0},strongSelDataFormat:function(){var e=this,t=e.selStrongInfoList.values(),a=t.length,i=void 0;if(e.itemsList||(e.itemsList=[]),e.objSaveList||(e.objSaveList=[]),e.equipIdxList||(e.equipIdxList=[]),e.equipIdxList.length=0,a<=(e.itemsList.length=0))game.notice.show(53695);else for(var n=0,s=0;s<a;s++)if((i=t[s]).idx)e.equipIdxList.push(i.idx);else if(i.id){for(var r=i.id,o=!1,g=e.itemsList.length,u=0;u<g;u++){var l=e.itemsList[u];l.id==r&&(o=!0,l.num++)}if(!o){var c=e.objSaveList[n];(c=c||(e.objSaveList[n]={})).id=r,c.num=1,n++,e.itemsList.push(c)}}},sortByExp:function(e,t){return e.offerExp<t.offerExp?-1:e.offerExp>t.offerExp?1:e.order-t.order},autoAddInfoByLv:function(e,t){if(e&&!(e.length<1)){this.resetStrongPreData();for(var a=void 0,i=void 0,n=void 0,s=void 0,r=0,o=void 0,g=!1,u=this.isShowStrongAlert,l=0,c=e.length;l<c;l++)i=(a=e[l]).lv,n=Math.min(this.strongMaxLv,i+t),(s=game.MythEquipUpgradeCfg.getData(n))&&(o=a.exp+a.strongCfg.totalExp,r+=s.totalExp-o);for(var h=this.strongInfoList.sort(this.sortByExp),m=h.length,d=void 0,f=0;f<m;f++){if(d=h[f],this.addMaterals(d),u&&d.idx){if(!(a=game.equipData.getGodAnimalEquipInfoByIdx(d.idx)))continue;(0<a.lv||0<a.exp)&&(g=!(u=!1))}if(this.totalExpAddPre>=r)break}return g}},setAutoSelListChoose:function(){for(var e=this.selStrongInfoList.values(),t=e.length,a=void 0,i=0;i<t;i++)(a=e[i])&&(a.isSelect=!0)},setBagStrongSelByIdx:function(e){var t=game.equipData.getGodAnimalEquipInfoByIdx(this.bagStrongSelIdx);t&&(t.isBagStrongSel=!1);var a=game.equipData.getGodAnimalEquipInfoByIdx(e);a&&(a.isBagStrongSel=!0),this.bagStrongSelIdx=e,this.send(game.GodAnimalEvts.EQUIP_BAG_SELECT_CHANGE)},resetBagStrongSelIdx:function(){var e=game.equipData.getGodAnimalEquipInfoByIdx(this.bagStrongSelIdx);e&&(e.isBagStrongSel=!1),this.bagStrongSelIdx=0},getBagStrongSelEquipInfo:function(){return game.equipData.getGodAnimalEquipInfoByIdx(this.bagStrongSelIdx)},getDropNameList:function(){var e=this,t=void 0,a=void 0,i=0;e.showDropList||(e.showDropList=[]);for(var n=e.showDropList.length=0,s=e.slotInfoList.length;n<s;n++)(t=e.slotInfoList[n])&&t.info&&t.slot!=e.wearStrongSel&&(t.posEquipMap.count()<1||((a=(a=e.dropList[i])||(e.dropList[i]=new game.GodAnimalDropInfo)).setData(t.info),i++,e.showDropList.push(a)));return e.showDropList},setBagSelect:function(e){var t=this.animalInfoMaps.get(this.bagSelectId);t&&(t.bagSelect=!1);var a=this.bagSelectId==e?0:e;if(this.bagSelectId=a,this.bagSelectId){var i=this.animalInfoMaps.get(this.bagSelectId);i&&(i.bagSelect=!0)}this.send(game.GodAnimalEvts.BAG_SELECT_CHANGE)},getChipList:function(){var e=this,t=void 0;if(!e.chipList){e.chipList=[];var a=game.MythBaseCfg.getDatas(),i=void 0,n=void 0;t=a.length;for(var s=0;s<t;s++)i=a[s],(n=new game.GodAnimalChipInfo).setData(i),e.chipList.push(n)}t=e.chipList.length;for(var r=0;r<t;r++)e.chipList[r].updateHaveNum();return e.chipList&&e.chipList.sort(e.chipListSort),e.checkAllGodAnimalAlert(),e.chipList},chipListSort:function(e,t){return e.canActive()&&!t.canActive()?-1:!e.canActive()&&t.canActive()?1:e.canActive()&&t.canActive()?t.godAnimalId-e.godAnimalId:e.animalInfo&&!t.animalInfo?-1:!e.animalInfo&&t.animalInfo?1:e.animalInfo&&t.animalInfo?e.animalInfo.starAlert&&!t.animalInfo.starAlert?-1:!e.animalInfo.starAlert&&t.animalInfo.starAlert?1:t.godAnimalId-e.godAnimalId:e.haveNum&&!t.haveNum?-1:!e.haveNum&&t.haveNum?1:t.godAnimalId-e.godAnimalId},checkAllGodAnimalAlert:function(){for(var e=this.animalInfoMaps.values(),t=void 0,a=0,i=e.length;a<i;a++)(t=e[a])&&(t.lvAlert=this.canUpgrade(t),t.starAlert=this.canStar(t),t.isBackAlert=t.lvAlert||t.starAlert)},getGodAnimalBagList:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this.animalInfoMaps.values();return t&&this.checkAllGodAnimalAlert(),a.sort(this.bagListSort),a},bagListSort:function(e,t){return e.slot&&t.slot?e.isBackAlert&&!t.isBackAlert?-1:!e.isBackAlert&&t.isBackAlert?1:e.slot-t.slot:e.slot&&!t.slot?-1:!e.slot&&t.slot?1:e.isBackAlert&&!t.isBackAlert?-1:!e.isBackAlert&&t.isBackAlert?1:t.id-e.id},getCurBagSelect:function(){return this.animalInfoMaps.get(this.bagSelectId)},checkSelectIndex:function(e){for(var t=this.getGodAnimalBagList(!1),a=void 0,i=0,n=t.length;i<n;i++)if((a=t[i])&&a.id==e){this.bagSelectIndex=i,this.bagSelectId=e;break}},showActiveTips:function(){this.activeTipsId&&this.activeTipsId.length&&!b8e.module.isShowView(game.ME.GodAnimalActive)&&game.module.show(game.ME.GodAnimalActive)},getActiveViewShowInfo:function(){var e=this.activeTipsId.shift();return this.getGodAnimalInfoById(e)},activeViewClose:function(){this.activeTipsId&&this.activeTipsId.length&&b8e.setTimeout(this.showActiveTips,this,100)},slotInfoInit:function(e){if(e)for(var t=e.length,a=void 0,i=void 0,n=0;n<t;n++)a=e[n],(i=this.getSlotInfoBySlot(a.slot))&&(i.updataBattleInfo(a.id),i.setEquips(a.equips),i.updateAllSprite())},initSlot:function(){for(var e=game.MythBattleCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)this.slotInfoList[a]||((t=new game.GodAnimalSlotInfo).setCfg(e[a]),this.slotInfoList[a]=t)},getSlotList:function(){return this.slotInfoList},selectSlotInfoBySlot:function(e){var t=0<arguments.length&&void 0!==e?e:1;this.defaultSlot&&(t=this.defaultSlot,this.defaultSlot=0);var a=this.getSlotInfoBySlot(this.curSelectSlot),i=this.getSlotInfoBySlot(t);a&&(a.isSelected=!1),i.isSelected=!0,this.curSelectSlot=t,this.send(game.GodAnimalEvts.SLOT_SELECT_CHANGE)},getSlotInfoBySlot:function(e){return e>this.slotInfoList.length||e<1?null:this.slotInfoList[e-1]},getCurSlotInfo:function(){return 0<this.curSelectSlot?this.slotInfoList[this.curSelectSlot-1]:null},getCanBattleSlot:function(){for(var e=void 0,t=this.slotInfoList.length,a=0;a<t;a++)if((e=this.slotInfoList[a])&&!(e.needLevel>game.mainRoleData.lv||e.info))return e.slot;return null},slotSpriteUpdate:function(e){if(e){var t=this.getSlotInfoBySlot(e);t&&(game.FightAmount.inst().setNomalStat(t.allSpriteStat,!0),t.updateAllSprite(),game.FightAmount.inst().setUpdatedStat(t.allSpriteStat))}},createBookInfo:function(){var e=game.MythFettersCfg.getDatas();if(e)for(var t=void 0,a=void 0,i=0,n=e.length;i<n;i++)(t=e[i])&&((a=this.bookList[i])||(a=new game.GodAnimalBookInfo,this.bookList[i]=a),a.setData(t))},getSkillInfos:function(e){var t=game.MythStarCfg.getDataById(e);if(t){t.sort(this.sortByStar);var a=void 0,i=void 0,n=this.getGodAnimalInfoById(e),s=0;n&&(s=n.star);for(var r=0,o=t.length;r<o;r++)(a=t[r])&&((i=this.skillInfos[r])||(i=new game.GodAnimalSkillInfo,this.skillInfos[r]=i),i.setData(a),i.isEqual=a.star==s);return this.skillInfos}},sortByStar:function(e,t){return e.star-t.star},getDetailsInfo:function(e){for(var t=o.inst().getGodAnimalInfoById(e),a=t?t.star:1,i=game.GodAnimalDetailsEnum,n=void 0,s=void 0,r=1;r<=4;r++){switch((n=this.detailList[r-1])||(n=new game.GodAnimalDetailsInfo,this.detailList[r-1]=n),r){case i.STAT:s=game.MythBaseCfg.getData(e);break;case i.SKILL:s=game.MythStarCfg.getOneData(e,a);break;case i.FATE:case i.FATE_STAT:s=game.MythFettersCfg.getData(e)}n.setData(s),n.type=r,t&&(n.info=t)}return this.detailList},getBookList:function(){return this.bookList},updateBookGodInfoSprite:function(e){var t=game.MythFettersCfg.getData(e);if(t){var a=t.ids;if(a&&!(a.length<2)){var i=a[1];i==this.id&&(i=a[0]);var n=this.getGodAnimalInfoById(i);if(n){n.updateBookSprite();var s=this.getGodAnimalInfoById(e);s&&s.updateBookSprite();var r=this.getSlotInfoBySlot(n.slot);r&&r.updateAllSprite(),this.bookSpriteStat.clear(),game.FightAmount.inst().setNomalStat(this.bookSpriteStat,!0),this.bookSpriteStat.addSpriteStat(s.bookSpriteStat),this.bookSpriteStat.addSpriteStat(n.bookSpriteStat),game.FightAmount.inst().setUpdatedStat(this.bookSpriteStat)}}}},updateCost:function(){for(var e=void 0,t=0,a=this._costList.length;t<a;t++)(e=this._costList[t]).num=game.itemData.getNumById(e.cfg.id)},getCostItems:function(e){var t=this;t.updateCost();var a=t._costList,i=t.getCurSlotInfo().info,n=i.lv,s=1==e?n+1:t.upgradeMaxLv,r=void 0,o=0;t.costs||(t.costs=[]);for(var g=void(t.costs.length=0),u=n;u<s;u++)o+=game.MythUpgradeCfg.getData(u).exp;o-=i.exp;for(var l=0,c=a.length;l<c;l++){r=a[l],(g={}).id=r.cfg.id;for(var h=g.num=0,m=r.num;h<m;h++)if(o-=r.cfg.exp,g.num+=1,r.num-=1,o<=0)return g.num&&t.costs.push(g),t.costs;g.num&&t.costs.push(g)}return t.costs},canUpgrade:function(e){if(!e)return!1;if(e.lv>=this.upgradeMaxLv)return!1;var t=game.MythBookCfg.getDatas();if(!t||!t.length)return!1;for(var a=void 0,i=game.MythUpgradeCfg.getData(e.lv).exp-e.exp,n=0,s=t.length;n<s;n++)if(a=t[n],i<=game.itemData.getNumById(a.id)*a.exp)return!0;return!1},canStar:function(e){if(!e)return!1;if(e.star>=this.starMaxNum)return!1;var t=game.MythStarCfg.getOneData(e.id,e.star);return!(!t||t.isMax)&&game.UpgradeUtil.checkItemInfo(t.itemId,t.num,!1)},modelRequest:function(){this.sendPb(game.protoId.MythModelReq,null)},mythBattleRequest:function(e){var t=game.pb.MythBattleRequest;t.slot=this.willSlot,t.id=e,this.sendPb(game.protoId.MythBattleReq,t)},mythBattleRespHandler:function(e){var t=e.readProtobuf(game.pb.MythBattleResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getSlotInfoBySlot(t.slot);a&&a.updataBattleInfo(t.id),this.checkAlert(),this.slotSpriteUpdate(t.slot),this.send(game.GodAnimalEvts.SLOT_SELECT_CHANGE)}},exchangeEquipRequest:function(e){var t=game.pb.MythEquipRequest;t.slot=this.curSelectSlot,game.CCommonUtil.isArray(e)?this.idxList=e:(this.idxList||(this.idxList=[]),this.idxList.length=0,this.idxList.push(e)),t.idx=this.idxList,this.sendPb(game.protoId.MythEquipReq,t)},mythEquipRespHandler:function(e){var t=e.readProtobuf(game.pb.MythEquipResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getSlotInfoBySlot(t.slot);a&&a.setEquips(t.equips,!0),this.slotSpriteUpdate(t.slot),this.send(game.GodAnimalEvts.SLOT_EQUIP_UPDATE)}},removeEquipRequest:function(e){var t=game.pb.MythCastEquipRequest;t.slot=this.curSelectSlot,t.pos=e,this.sendPb(game.protoId.MythCastEquipReq,t)},mythCastEquipRespHandler:function(e){var t=e.readProtobuf(game.pb.MythCastEquipResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getSlotInfoBySlot(t.slot);a&&a.removeEquipByPos(t.pos),this.slotSpriteUpdate(t.slot),this.send(game.GodAnimalEvts.SLOT_EQUIP_UPDATE)}},activeGoaAnimalRequest:function(e){var t=game.pb.MythActiveRequest;t.id=e,this.sendPb(game.protoId.MythActiveReq,t)},mythActiveRespHandler:function(e){var t=e.readProtobuf(game.pb.MythActiveResponse);0<t.code?game.notice.noticeError(t.code):(this.activeData||(this.activeData=b8e.createMap()),this.activeData.id=t.id,this.activeAnimalInfo(t.id,this.activeData),this.updateBookGodInfoSprite(t.id),this.activeTipsId.push(t.id),this.showActiveTips(),this.send(game.GodAnimalEvts.ACTIVE_INFORM))},wearEquipForgeRequest:function(e){this.strongSelDataFormat();var t=game.pb.MythEquipForgeRequest;t.slot=this.wearStrongSel,t.equipSlot=e,this.itemsList.length<=0&&this.equipIdxList.length<=0||(t.items=this.itemsList,t.idx=this.equipIdxList,this.sendPb(game.protoId.MythEquipForgeReq,t))},mythEquipForgeRespHandler:function(e){var t=e.readProtobuf(game.pb.MythEquipForgeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getSlotInfoBySlot(t.slot);if(a){var i=t.equips;if(!i)return;for(var n=void 0,s=void 0,r=0,o=i.length;r<o;r++)n=i[r],(s=a.getEquipInfoByPos(n.slot))&&(s.updateLvExp(n.mythEquipLv,n.mythEquipExp),s.updateAllSpriteStat());this.resetStrongPreData(),this.send(game.GodAnimalEvts.EQUIP_WEAR_STRONG_UPDATE)}this.slotSpriteUpdate(t.slot)}},bagEquipForgeRequest:function(e){this.strongSelDataFormat();var t=game.pb.MythBagEquipForgeRequest;t.equipId=e,this.itemsList.length<=0&&this.equipIdxList.length<=0||(t.items=this.itemsList,t.idx=this.equipIdxList,this.sendPb(game.protoId.MythBagEquipForgeReq,t))},mythBagEquipForgeRespHandler:function(e){var t=e.readProtobuf(game.pb.MythBagEquipForgeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=game.equipData.getGodAnimalEquipInfoByIdx(t.equipId);a&&(a.updateLvExp(t.mythEquipLv,t.mythEquipExp),a.updateAllSpriteStat()),this.resetStrongPreData(),this.send(game.GodAnimalEvts.EQUIP_BAG_STRONG_UPDATE)}},GoaAnimalUpgradeRequest:function(e,t){var a=this.getCostItems(t);if(a.length<1){var i=game.ItemInfoCfg.getData(this._costList[2].cfg.id);i&&(game.tipsData.setInfo(i),game.module.show(game.ME.ItemTips))}else{var n=game.pb.MythUpgradeRequest;n.id=e,n.items=a,this.sendPb(game.protoId.MythUpgradeReq,n)}},mythUpgradeRespHandler:function(e){var t=e.readProtobuf(game.pb.MythUpgradeResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getGodAnimalInfoById(t.id);a&&(a.updateLv(t.lv,t.exp),this.slotSpriteUpdate(a.slot),this.send(game.GodAnimalEvts.LEVEL_INFORM))}},GoaAnimalStarRequest:function(e){var t=game.pb.MythStarRequest;t.id=e,this.sendPb(game.protoId.MythStarReq,t)},mythStarRespHandler:function(e){var t=e.readProtobuf(game.pb.MythStarResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getGodAnimalInfoById(t.id);if(a){var i=a.star+1;a.updateStar(i),this.slotSpriteUpdate(a.slot),this.starTipsShowInfo=a,game.module.show(game.ME.GodAnimalStarTips),this.send(game.GodAnimalEvts.STAR_INFORM)}}}});o._instance=null,o._singleton=!0,o.inst=function(){return null==o._instance&&(o._singleton=!1,o._instance=new o,o._singleton=!0),o._instance},b8e.RC("$$game","$$GodAnimalMgr",o)}(),function(){var e;e=b8e.Object.extends({slot:0,needLevel:0,isSelected:!1,info:null,equipAlert:!1,upgradeAlert:!1,starAlert:!1,isBattleAlert:!1,showAlert:!1,_fightAmount:0,fightAmount:{get:function(){return(game.partnerData.getToBattleCount()+1)*this._fightAmount}},ctor:function(){this._super(),this.posEquipMap=b8e.HashMap.get(),this.equipPosAlertDic={},this.allSpriteStat=game.SpriteStat.get()},setCfg:function(e){if(e){this.slot=e.slot,this.needLevel=e.level}},setEquips:function(e,t){var a=1<arguments.length&&void 0!==t&&t;if(e)for(var i=e.length,n=void 0,s=0;s<i;s++)n=e[s],this.updataEquipInfo(a?n:n.item)},updataEquipInfo:function(e){var t=game.ItemInfoCfg.getData(e.id);if(t){var a=t.pos,i=this.posEquipMap.get(a),n=game.godAnimalEquipData.getNewWearEquipInfo(a,e,i);n.wearSlot=this.slot,this.posEquipMap.set(a,n)}},removeEquipByPos:function(e){var t=this.posEquipMap.get(e);t&&(this.posEquipMap.del(e),game.godAnimalEquipData.removeWearEquipByPosAndIdx(e,t.idx))},getEquipInfoByPos:function(e){return this.posEquipMap.get(e)},checkEquipAlertByPos:function(e){var t=this.getEquipInfoByPos(e),a=game.godAnimalEquipData.getInfoListByPos(e,!1),i=a?a.length:0,n=!1,s=!1;if(t){for(var r=void 0,o=void 0,g=t.cfg.quality,u=0;u<i;u++){if(g<(o=(r=a[u]).cfg.quality)){n=!0;break}if(o==g&&r.fight>t.fight){n=!0;break}}var l=t.strongCfg;if(!l||l.isMax)s=!1;else{var c=game.GodAnimalMgr.inst().allEquipItemExp;s=l.exp-t.exp<=c}}else n=0<i;return this.equipPosAlertDic[e]||(this.equipPosAlertDic[e]={}),this.equipPosAlertDic[e].isExAlert=n,this.equipPosAlertDic[e].isStrongAlert=s,n||s},getPosEquipAlertData:function(e){return this.equipPosAlertDic[e]},checkAllAlert:function(){var e=this;if(e.info){var t=e.checkEquipAlertByPos(1),a=e.checkEquipAlertByPos(2),i=e.checkEquipAlertByPos(3);e.equipAlert=t||a||i,e.upgradeAlert=e.info.lvAlert,e.starAlert=e.info.starAlert,e.showAlert=e.equipAlert||e.upgradeAlert||e.starAlert}else e.upgradeAlert=!1,e.starAlert=!1,e.equipAlert=!1},updataBattleInfo:function(e){this.info&&(this.info.slot=0);var t=game.GodAnimalMgr.inst().getGodAnimalInfoById(e);t&&(t.slot=this.slot,this.info=t)},updateAllSprite:function(){this.allSpriteStat.clear(),this._fightAmount=0,this.info&&this.allSpriteStat.addSpriteStat(this.info.allSpriteStat);for(var e=this.posEquipMap.values(),t=0,a=e.length;t<a;t++)this.allSpriteStat.addSpriteStat(e[t].allSpriteStat);this._fightAmount+=game.CCommonUtil.getPower(this.allSpriteStat)}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalSlotInfo",e)}(),function(){var e=b8e.Object.extends({showIdIdx:0,showId:0,selectBackInfo:0,isShowOpBtn:!1,ctor:function(){this.wearInfoMap=b8e.HashMap.get(),this.notWearInfoMap=b8e.HashMap.get(),this.posInfoMap=b8e.HashMap.get(),this.allWearInfoMap=b8e.HashMap.get()},createEquipInfo:function(e,t){if(!e)return null;var a=game.GodAnimalEquipInfo.get();return a.setData(e,t),a},getNewWearEquipInfo:function(e,t,a){var i=this.wearInfoMap.get(e);i||(i=b8e.HashMap.get(),this.wearInfoMap.set(e,i));var n=void 0;return n=a?(i.del(a.idx),this.allWearInfoMap.del(a.idx),a.reset(),a.setData(t,e),a):this.createEquipInfo(t,e),i.set(t.idx,n),this.allWearInfoMap.set(t.idx,n),n},removeWearEquipByPosAndIdx:function(e,t){var a=this.wearInfoMap.get(e);if(a){var i=a.get(t);i&&(i.release(),a.del(t),this.allWearInfoMap.del(t))}},getNotWearEquipInfo:function(e,t){var a=this.notWearInfoMap.get(e);a||(a=b8e.HashMap.get(),this.notWearInfoMap.set(e,a));var i=this.createEquipInfo(t,e);return a.set(t.idx,i),i},delNotWearEquipByIdx:function(e){var t=game.equipData.getGodAnimalEquipInfoByIdx(e);if(t){var a=t.pos,i=this.notWearInfoMap.get(a);i&&i.has(e)&&(t.release(),i.del(e))}},getInfoListByPos:function(e,t){var a=void 0,i=void 0;return(a=t?this.wearInfoMap.get(e):this.notWearInfoMap.get(e))&&(i=a.values()).sort(this.equipSortHandler),i},equipSortHandler:function(e,t){return e.cfg.quality>t.cfg.quality?-1:e.cfg.quality<t.cfg.quality?1:t.fight-e.fight},getAllEquipInfo:function(){var e=this.allWearInfoMap.values(),t=game.equipData.getAllGodAnimalEquipList(),a=e.concat(t);return a.sort(this.allEquipSort),a},allEquipSort:function(e,t){return e.wearSlot&&t.wearSlot?-1:!e.wearSlot&&t.wearSlot?1:t.cfg.quality-e.cfg.quality},getEquipInfoByIdx:function(e){var t=this.allWearInfoMap.get(e);return t=t||game.equipData.getGodAnimalEquipInfoByIdx(e)},getRebirthCosts:function(e){if(this.rebirthCostList||(this.rebirthCostList=[]),this.clearList(this.rebirthCostList),e){var t=e.strongCfg.totalExp+e.exp,a=game.GodAnimalMgr.inst(),i=a.itemExpIdList,n=a.itemExpDic,s=void 0,r=void 0,o=void 0,g=void 0;if(i){i.sort(this.sortById);for(var u=i.length,l=0;l<u;l++)(g=n[r=i[l]])&&(o=Math.floor(t/g),t%=g,0<o&&(s=game.ItemUtil.createBaseItemInfo(r,o),this.rebirthCostList.push(s)))}return this.rebirthCostList}},clearList:function(e){for(var t=e.length,a=0;a<t;a++)e[a].release();e.length=0},sortById:function(e,t){return t-e}});game.godAnimalEquipData=game.godAnimalEquipData||new e}(),function(){var t=void 0;t=game.BaseItemInfo.extends({pos:0,isEquip:!0,lv:0,exp:0,taleAttr:null,wearSlot:0,strongCfg:null,_fight:0,allSpriteStat:null,isBagStrongSel:!1,cfg:null,quality:0,fight:{get:function(){return(game.partnerData.getToBattleCount()+1)*this._fight}},ctor:function(){this._super(),this.gems=[],this.baseSpriteStat=game.SpriteStat.get(),this.strongSpriteStat=game.SpriteStat.get(),this.taleSpriteStat=game.SpriteStat.get(),this.allSpriteStat=game.SpriteStat.get()},setData:function(e,t){var a=this;a._super(e);var i=e.equip;i&&(a.lv=i.mythEquipLv,a.exp=i.mythEquipExp,a.taleAttr=i.mythLegendAttrs,(!a.taleAttr||a.taleAttr.length<1)&&(a.taleAttr=null)),a.pos=t,a.cfg=game.ItemInfoCfg.getData(a.id),a.quality=a.cfg.quality,a.updateStrongSpriteStat(),a.updateTaleSpriteStat(),a.updateAllSpriteStat()},getTaleAttrStr:function(){var e=this.taleAttr,t="",a=0,i=void 0,n=void 0,s=void 0;if(e)for(var r=e.length,o=0;o<r;o++)s=e[o],i=game.MythEquipAttrCfg.getData(s),n=game.AttrRulesCfg.getData(i.attrId),0!=a&&(t+="\n"),t+=game.Lang.get(402,n.name,i.clientValue),a++;return t},updateLvExp:function(e,t){this.exp=t,this.lv!=e&&(this.lv=e,this.updateStrongSpriteStat())},updateStrongSpriteStat:function(){var e=this;if(e.strongSpriteStat.clear(),e.strongCfg=game.MythEquipUpgradeCfg.getData(e.lv),e.cfg){var t=e.cfg.perTeamAtk*e.lv,a=e.cfg.perTeamDef*e.lv,i=e.cfg.perTeamHp*e.lv;e.strongSpriteStat.setStatValue(game.SpriteStatType.TeamAtk,t),e.strongSpriteStat.setStatValue(game.SpriteStatType.TeamDef,a),e.strongSpriteStat.setStatValue(game.SpriteStatType.TeamHp,i)}},updateTaleSpriteStat:function(){this.taleSpriteStat.clear();var e=void 0,t=void 0;if(this.taleAttr)for(var a=this.taleAttr.length,i=0;i<a;i++)t=this.taleAttr[i],e=game.MythEquipAttrCfg.getData(t),this.taleSpriteStat.addSpriteStateByType(e.attrId,e.attrVal)},updateAllSpriteStat:function(){var e=this;e.allSpriteStat.clear(),e.baseSpriteStat.clear(),e._fight=0,e.baseSpriteStat.addSpriteStat(e.cfg.spriteStat),e.baseSpriteStat.addSpriteStat(e.strongSpriteStat),e.allSpriteStat.addSpriteStat(e.baseSpriteStat),e.allSpriteStat.addSpriteStat(e.taleSpriteStat),e._fight+=game.CCommonUtil.getPower(e.allSpriteStat)},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.idx=0,e.id=0,e.pos=0,e.lv=0,e.exp=0,e.taleAttr=null,e.wearSlot=0,e._cfg=null,e._fight=0,e.cfg=null,e.quality=0,e.isBagStrongSel=!1}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GodAnimalEquipInfo",t)}(),function(){var e;e=b8e.Object.extends({cfg:null,chipId:0,haveNum:0,activeNum:0,index:0,godAnimalId:0,isActive:!1,animalInfo:{get:function(){return game.GodAnimalMgr.inst().getGodAnimalInfoById(this.godAnimalId)}},setData:function(e){e&&(this.cfg=e).chipItems[0]&&(this.chipId=e.chipItems[0].Id,this.activeNum=e.chipItems[0].Num,this.godAnimalId=e.id)},updateHaveNum:function(){this.haveNum=game.itemData.getNumById(this.chipId)},canActive:function(){return!this.animalInfo&&this.haveNum>=this.activeNum}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalChipInfo",e)}(),function(){var t=void 0;t=b8e.PoolObject.extends({id:0,idx:0,offerExp:0,itemInfo:null,order:0,isSelect:!1,setCfg:function(e){this.id=e.id},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.idx=0,this.offerExp=0,this.order=0,this.isSelect=!1,this.itemInfo&&this.itemInfo.release(),this.itemInfo=null}}),b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$GodAnimalStrongCostInfo",t)}(),function(){var e;e=b8e.Object.extends({cfg:null,id:0,setData:function(e){this.cfg=e,this.cfg&&(this.id=this.cfg.ids[0])},godAnimalInfo1:{get:function(){return this.cfg&&this.cfg.ids[0]?game.GodAnimalMgr.inst().getGodAnimalInfoById(this.cfg.ids[0]):null}},godAnimalInfo2:{get:function(){return this.cfg&&this.cfg.ids[1]?game.GodAnimalMgr.inst().getGodAnimalInfoById(this.cfg.ids[1]):null}}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalBookInfo",e)}(),function(){var e;e=b8e.Object.extends({type:0,cfg:null,info:null,setData:function(e){this.cfg=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalDetailsInfo",e)}(),function(){var e;e=b8e.Object.extends({star:0,cfg:null,isEqual:!1,setData:function(e){this.star=e.star,this.cfg=e}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalSkillInfo",e)}(),function(){var e;e=b8e.Object.extends({name:null,slot:0,setData:function(e){this.name=e.name,this.slot=e.slot}}),b8e.BindingUtil.bind(e),b8e.RC("$$game","$$GodAnimalDropInfo",e)}(),function(){var e,t,a,i;i=b8e.Enum({NONE:0,SLOT_LIST_UPDATE:-1,SLOT_SELECT_CHANGE:-1,SLOT_EQUIP_UPDATE:-1,BAG_SELECT_CHANGE:-1,BACK_ITEM_UPDATE:-1,ACTIVE_INFORM:-1,EQUIP_STRONG_SLOT_CHANGE:-1,EQUIP_STRONG_SELECT_CHANGE:-1,EQUIP_WEAR_STRONG_UPDATE:-1,EQUIP_BAG_STRONG_UPDATE:-1,EQUIP_BAG_SELECT_CHANGE:-1,LEVEL_INFORM:-1,STAR_INFORM:-1,V_UPDATE_DATA:-1,C_SELECTCHANGE:-1}),a=b8e.Enum({None:0,UPGRADE:1,STAR:2}),t=b8e.Enum({None:0,STAT:1,SKILL:2,FATE:3,FATE_STAT:4}),e=b8e.Enum({MESSAGE:1,UPGRADE:2,STAR:3}),b8e.RC("$$game","$$GodAnimalEvts",i),b8e.RC("$$game","$$GodAnimalUpgradeTypes",a),b8e.RC("$$game","$$GodAnimalDetailsEnum",t),b8e.RC("$$game","$$GodAnimalModuleTypes",e)}(),function(){var e;e=game.GameItemIcon.extends({_nameLbl:null,_lvLbl:null,_starLab:null,_effect:null,info:null,ctor:function(){this._super(game.IconSizeEnum.GRID_SIZE_105)},setCfg:function(e,t,a,i){var n=!(1<arguments.length&&void 0!==t)||t,s=!(2<arguments.length&&void 0!==a)||a,r=this;if(e){3<arguments.length&&void 0!==i&&i||(r.removeLv(),r.removeStar()),n?r.setName():r.removeNameLbl();var o=e.quality;r.setBgImage(game.ResCfg.getQualityBg(o));var g=game.ResCfg.getUrl(10212,e.icon);r.setIcon(g),r.addIconImage(),s?r.setEffect():r._effect&&r._effect.clear()}else r.clearData()},setData:function(e,t,a){var i=!(1<arguments.length&&void 0!==t)||t,n=!(2<arguments.length&&void 0!==a)||a;(this.info=e)?(this.setCfg(e.cfg,i,n,!0),this.setLv(e.lv),this.setStar(e.star)):this.clearData()},setName:function(){var e=this,t=0;t=e.info&&null!=e.info.quality&&e.info.quality?e.info.quality:e.info.cfg.quality;var a=game.HtmlUtil.getColorStrByQuality(t,e.info.name||e.info.cfg.name);e.addNameLbl(),e._nameLbl.setText(a);var i=.5*e._nameLbl.width;e._nameLbl.setPosition(-i,-81)},addNameLbl:function(){this._nameLbl||(this._nameLbl=b8e.RichText.get(),this._nameLbl.setFontSize(20)),this._nameLbl.parent||(this.addChild(this._nameLbl),this._nameLbl.setVisible(!0))},removeNameLbl:function(){this._nameLbl&&this._nameLbl.removeFromParent()},setLv:function(e){this.addLvLbl();var t="L"+e;this._lvLbl.setText(t)},addLvLbl:function(){var e=this._lvLbl;e||((e=this._lvLbl=b8e.Label.get()).setAnchor(.5,0),e.setFontSize(35),e.setLineHeight(35),e.setFontFile(b8e.ResMgr.UI_ROOT+"/app/font/cultivateLv/cultivateLv.bbf")),e.parent||(this.addChild(e),e.setPosition(0,-65),e.setVisible(!0))},removeLv:function(){this._lvLbl&&this._lvLbl.removeFromParent()},clearData:function(){this.setIcon(),this.setBgImage(),this.removeLv(),this.removeStar(),this._nameLbl&&this._nameLbl.removeFromParent(),this._effect&&this._effect.clear()},setIconImgPos:function(){this.iconImg&&this.iconImg.parent&&this.iconImg.setPosition(0,2)},setStar:function(e){this.addStar(),this._starLab.setText(e)},addStar:function(){var e=this;e.starBg||(e.starBg=b8e.Sprite.get(),e.starBg.setAnchor(.5,.5),e.starBg.setScale(.7,.7),e.starBg.setPosition(45,-30),e.starBg.loadTexture(game.ResCfg.getUrl(10078))),e._starLab||(e._starLab=b8e.Label.get(),e._starLab.setAnchor(.5,.5),e._starLab.setPosition(45,-32),e._starLab.setColor(game.Color.BLACK),e._starLab.setFontSize(18)),e.starBg.parent||e.addChild(e.starBg),e._starLab.parent||e.addChild(e._starLab)},removeStar:function(){this.starBg&&this.starBg.removeFromParent(),this._starLab&&this._starLab.removeFromParent()},setEffect:function(){var e=this;if(e.info){var t=e.info.cfg,a=game.CCommonUtil.getqualityEffect(t.quality);if(a){e._effect||(e._effect=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1)),e._effect&&!e._effect.parent&&e.addChild(e._effect);var i=game.ResCfg.getUrl(5022,a);i&&(e._effect.setVisible(!0),e._effect.load(i),e._effect.play())}else e._effect&&(e._effect.setVisible(!1),e._effect.stop())}}}),b8e.RC("$$game","$$GodAnimalHeadIcon",e)}(),function(){var e;e=game.GameItemIcon.extends({_nameLbl:null,_effect:null,info:null,ctor:function(){this._super(game.IconSizeEnum.GRID_SIZE_105),b8e.evt.onC(this,this.fnOnClickGrid,this)},setCfg:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t;if(e){var i=e.quality;this.setBgImage(game.ResCfg.getQualityBg(i));var n=game.ResCfg.getUrl(10212,e.icon);this.setIcon(n),this.addIconImage(),a?this.setEffect():this._effect&&this._effect.clear(),this.setTouchEnable()}else this.clearData()},setData:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t;(this.cfg=e)?this.setCfg(e,a):this.clearData()},clearData:function(){this.setIcon(),this.setBgImage(),this._effect&&this._effect.clear()},setIconImgPos:function(){this.iconImg&&this.iconImg.parent&&this.iconImg.setPosition(0,2)},setEffect:function(){var e=this,t=e.cfg,a=game.CCommonUtil.getqualityEffect(t.quality);if(a){e._effect||(e._effect=b8e.Animator.get(game.AnimType.ITEM_EFFECT,1)),e._effect&&!e._effect.parent&&e.addChild(e._effect);var i=game.ResCfg.getUrl(5022,a);i&&(e._effect.setVisible(!0),e._effect.load(i),e._effect.play())}else e._effect&&(e._effect.setVisible(!1),e._effect.stop())},setTouchEnable:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this._touch=t},fnOnClickGrid:function(){this._touch&&(game.godAnimalEquipData.showId=this.cfg.id,game.module.show(game.ME.GodAnimalDetails))}}),b8e.RC("$$game","$$GodAnimalBookIcon",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1724)},init:function(){var e=this;e.data=game.GodAnimalMgr.inst(),e.skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_84),e.skillIcon.setShowMainSkillIcon(!1),e.skillIcon.setShowPassiveSkillIcon(!1),e.skillIcon.addToParent(e.skin.skillNode),e.skillIcon.setClickCallBack(e.skillShow,e),e.spotAlerts={GOD_ANIMAL_BAG:e.bagAlert},e.equipIcon=[],e.skin.noAnimalLab.string=game.Lang.get(53605)},bagAlert:function(e){this.skin.bagRedPoint.active=e.alert},skillShow:function(){var e=this.getCurGodAnimalInfo();e&&(this.data.skillShowInfo=e,game.module.show(game.ME.GodAnimalSkillTip))},addEventListener:function(){this.data.addEvent(game.GodAnimalEvts.SLOT_EQUIP_UPDATE,this.equipUpdateHandler,this),this.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.checkAlert,this),this.data.addEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,this.slotChangeHandler,this)},removeEventListener:function(){this.data.removeEvent(game.GodAnimalEvts.SLOT_EQUIP_UPDATE,this.equipUpdateHandler,this),this.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.checkAlert,this),this.data.removeEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,this.slotChangeHandler,this)},checkAlert:function(){var e=this.data.getCurSlotInfo();if(e)for(var t=1;t<=3;t++){var a=this.getComponent("redPoint"+t),i=e.getPosEquipAlertData(t);i?a.setVisible(i.isExAlert||i.isStrongAlert):a.setVisible(!1)}},slotChangeHandler:function(){var e=this,t=e.data.getCurSlotInfo();if(!t||!t.info)return e.skin.noAnimalLab.active=!0,e.skin.tipsDescLab.string="",void(e.skin.skillNameLab.string="");e.skin.noAnimalLab.active=!1;var a=t.info.starCfg,i=game.SkillCfg.getData(a.skillId);i&&(e.skillIcon.setData(a.skillId),e.skin.skillNameLab.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name,!1),e.skin.tipsDescLab.string=game.HtmlUtil.getText(game.Color.BLACK,game.LangSkill.get(i.desc,i.descParam)),e.equipUpdateHandler(),e.checkAlert())},equipUpdateHandler:function(){var e=this.data.getCurSlotInfo();if(e)for(var t=1;t<=3;t++){var a=e.getEquipInfoByPos(t),i=this.equipIcon[t],n=this.getComponent("bg"+t),s=this.getComponent("addBtn"+t);a?(i||((i=this.equipIcon[t]=game.GridUtil.createGodAnimalEquipIcon(game.IconSizeEnum.GRID_SIZE_84)).isShowOpBtn=!0),i.parent||i.addToParent(this.getComponent("icon"+t)),i.setData(a,!1)):i&&i.removeFromParent(),n.setVisible(!a),s.setVisible(!a)}},onShow:function(){this.addEventListener(),this.slotChangeHandler(),this.checkAlert()},onHide:function(){this.removeEventListener()},onStageResize:function(){this.setPosition(0,0)},openEquipExChangeView:function(e){this.getCurGodAnimalInfo()?this.data.openEquipExList(e):game.notice.show(53605)},getCurGodAnimalInfo:function(){var e=this.data.getCurSlotInfo();return e?e.info:null},equipBtn:function(){game.module.show(game.ME.GodAnimalEquipBag)},bgBtn:function(){game.module.show(game.ME.GodAnimalBag)},albumBtn:function(){game.module.show(game.ME.GodAnimalBook)},changeBtn:function(){this.getCurGodAnimalInfo()?(this.data.willSlot=this.data.curSelectSlot,game.module.show(game.ME.GodAnimalChange)):game.notice.show(53605)},addBtn1:function(){this.openEquipExChangeView(1)},addBtn2:function(){this.openEquipExChangeView(2)},addBtn3:function(){this.openEquipExChangeView(3)}});b8e.app.registerView(game.ME.GodAnimalMain,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1725),this.setSize(114,160)},init:function(){this.icon=new game.GodAnimalHeadIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){this.data=e;var t=this.skin;this.isUnlock=e.needLevel>game.mainRoleData.lv;var a=e.info;t.headSelect.active=e.isSelected&&!!a,this.icon.setData(a),t.lockBg.active=!a,t.addImg.active=!this.isUnlock&&!a,t.lockLab.string=this.isUnlock?game.Lang.get(514,e.needLevel):"",t.mask1.active=this.isUnlock,t.lock.active=this.isUnlock;var i=e.isBattleAlert&&!this.isUnlock&&!a;t.redPoint.active=e.showAlert||i},touchIcon:function(){if(this.isUnlock)game.notice.show(game.Lang.get(514,this.data.needLevel));else if(this.data.info)this.data.isSelected||game.GodAnimalMgr.inst().selectSlotInfoBySlot(this.data.slot);else{var e=game.GodAnimalMgr.inst().getCanBattleSlot();e&&(game.GodAnimalMgr.inst().willSlot=e,game.module.show(game.ME.GodAnimalChange))}}}),b8e.RC("$$game","$$GodAnimalPanelItem",e)}(),function(){var e=game.CultivateNewBaseModelView.extends({_showModel:!0,_modelTouchClose:!1,slotInfo:null,index:-1,ctor:function(){this._super(1726),this.spotAlerts={GOD_ANIMAL_MESSAGE:this.messageAlert},this.toggles={toggle_btn_1:game.ME.GodAnimalMain,toggle_btn_2:game.ME.GodAnimalUpgrade,toggle_btn_3:game.ME.GodAnimalStar}},messageAlert:function(e){this.skin.red_spot_1.active=e.alert},init:function(){this.data=game.GodAnimalMgr.inst();var e=this.headList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal);e.itemRender=game.GodAnimalPanelItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.paddingTop=-5,e.layout.spacingX=2,e.addToParent(this.skin.headList),e.setScrollViewCb(this.listCb,this),this.initModel({type:game.RoleType.GodAnimal,node:this.skin.modelNode})},listCb:function(e,t,a){this.skin.leftBtn.active=0<e.length,this.skin.rightBtn.active=0<a.length},addEventListener:function(){var e=this;e.data.addEvent(game.GodAnimalEvts.SLOT_LIST_UPDATE,e.slotListUpdate,e),e.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.backItemUpdate,e),e.data.addEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.slotInfoUpdata,e),e.data.addEvent(game.GodAnimalEvts.LEVEL_INFORM,e.slotInfoUpdata,e),e.data.addEvent(game.GodAnimalEvts.STAR_INFORM,e.slotInfoUpdata,e),e.data.addEvent(game.GodAnimalEvts.SLOT_EQUIP_UPDATE,e.updatePower,e),e.data.addEvent(game.GodAnimalEvts.EQUIP_WEAR_STRONG_UPDATE,e.updatePower,e),e.data.addEvent(game.GodAnimalEvts.ACTIVE_INFORM,e.updatePower,e)},removeEventListener:function(){var e=this;e.data.removeEvent(game.GodAnimalEvts.SLOT_LIST_UPDATE,e.slotListUpdate,e),e.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.backItemUpdate,e),e.data.removeEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.slotInfoUpdata,e),e.data.removeEvent(game.GodAnimalEvts.LEVEL_INFORM,e.slotInfoUpdata,e),e.data.removeEvent(game.GodAnimalEvts.STAR_INFORM,e.slotInfoUpdata,e),e.data.removeEvent(game.GodAnimalEvts.SLOT_EQUIP_UPDATE,e.updatePower,e),e.data.removeEvent(game.GodAnimalEvts.EQUIP_WEAR_STRONG_UPDATE,e.updatePower,e),e.data.removeEvent(game.GodAnimalEvts.ACTIVE_INFORM,e.updatePower,e)},backItemUpdate:function(){this.slotListUpdate(),this.updateTabAlert()},slotListUpdate:function(){var e=this.data.getSlotList();this.headList.setData(e)},slotInfoUpdata:function(){var e=this;if(e.slotInfo=e.data.getCurSlotInfo(),e.slotInfo&&e.slotInfo.info){var t=e.slotInfo.info;e.skin.nameLab.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name),e.updateModel(game.RoleType.GodAnimal,t.cfg),e.skin.modelNode.active=!0,e.skin.bg4.active=!1}else e.skin.nameLab.string=game.HtmlUtil.getText(game.Color.BLACK,game.Lang.get(3720)),e.skin.modelNode.active=!1,e.skin.bg4.active=!0;e.updateStar(),e.updatePower(),e.updateTabAlert()},updateTabAlert:function(){this.skin.red_spot_2.active=this.slotInfo&&this.slotInfo.upgradeAlert,this.skin.red_spot_3.active=this.slotInfo&&this.slotInfo.starAlert},updatePower:function(){var e=0;this.slotInfo&&(e=this.slotInfo.fightAmount);var t=this.skin;t.fightAmountLbl.string=e,game.AutoLayoutUtil.layoutPower(t.power,t.fightAmountLbl,t.powerImg,t.search)},updateStar:function(){var e=0;this.slotInfo&&this.slotInfo.info&&(e=this.slotInfo.info.star);for(var t=0;t<6;t++)this.getComponent("starIcon"+(t+1)).active=t<e},onShow:function(){this.data.isInit?(this.addEventListener(),this.data.selectSlotInfoBySlot(),this.slotListUpdate()):b8e.error("\u670d\u52a1\u5668\u672a\u4e0b\u53d1\u521d\u59cb\u6a21\u5757\u6570\u636e\uff0c\u6570\u636e\u672a\u521d\u59cb\u5316\uff01")},onHide:function(){this.removeEventListener(),this.index=-1},toggleSelect:function(e){0<e&&(this.slotInfo&&this.slotInfo.info||(e=0,game.notice.show(53605))),e!=this.index&&(this.index=e,this._super(e))},changeShow:function(e){this.toggleSelect(e-1),this.slotListUpdate()},btn_1:function(){this.changeShow(game.GodAnimalModuleTypes.MESSAGE)},btn_2:function(){this.changeShow(game.GodAnimalModuleTypes.UPGRADE)},btn_3:function(){this.changeShow(game.GodAnimalModuleTypes.STAR)},leftBtn:function(){this.headList.scrollContainerLeft()},rightBtn:function(){this.headList.scrollContainerRight()}});b8e.app.registerView(game.ME.GodAnimalPanel,e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1715)},init:function(){this.data=game.GodAnimalMgr.inst();var e=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GodAnimalChangeItem,e.addToParent(this.skin.listNode),e.layout.spacingY=5},updateList:function(){var e=this.data.getNotBattleAnimalList();this.itemList.setData(e,!1),this.skin.emptyNode.active=!e||!e.length},onShow:function(){this.updateList()}});b8e.app.registerView(game.ME.GodAnimalChange,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1714),this.setSize(540,126)},init:function(){this.icon=new game.GodAnimalHeadIcon,this.icon.addToParent(this.skin.icon)},setData:function(e){this.info=e;var t=this.skin;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),this.icon.setData(e,!1),t.powerLab.string=game.Lang.get(53548,e.fightAmount)},battleBtn:function(){game.GodAnimalMgr.inst().mythBattleRequest(this.info.id),game.module.hide(game.ME.GodAnimalChange)}}),b8e.RC("$$game","$$GodAnimalChangeItem",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,_index:0,ctor:function(){this._super(1723)},init:function(){var e=this.skin;this._list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),this._list.itemRender=game.GodAnimalExChangeItem,this._list.layout.paddingLeft=6,this._list.layout.paddingTop=0,this._list.layout.spacingY=6,this._list.addToParent(e.list)},updateListByIndex:function(e){if(e!=this._index){this._index=e,this.skin.toggle_btn_1.active=1==this._index,this.skin.toggle_btn_2.active=2==this._index;var t=game.GodAnimalMgr.inst().selPos,a=2==this._index,i=game.godAnimalEquipData.getInfoListByPos(t,a);this._list.setData(i),this.skin.noInfoNode.active=!a&&(!i||i.length<1)}},onShow:function(){this._index=0,this.updateListByIndex(1)},notWearBtn:function(){this.updateListByIndex(1)},wearBtn:function(){this.updateListByIndex(2)}});b8e.app.registerView(game.ME.GodAnimalExChange,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1722),this.setSize(542,128)},init:function(){this.icon=game.GridUtil.createGodAnimalEquipIcon(),this.icon.addToParent(this.skin.iconNode)},setData:function(e){var t=this.skin;this.data=e,this.icon.setData(e,!1);var a=e.cfg;if(a){this.data=e;var i=a.quality;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(i,a.name,!0),t.fightLab.string=game.Lang.get(1008,e.fight);var n=!!e.wearSlot;if(t.targetLab.active=n,t.wearBtn.active=!n,n){var s=game.GodAnimalMgr.inst().getSlotInfoBySlot(e.wearSlot);if(!s||!s.info)return void(t.targetLab.string="");t.targetLab.string=game.Lang.get(51465,s.info.name)}var r=game.GodAnimalMgr.inst().getCurSlotInfo();if(r){var o=r.getEquipInfoByPos(e.pos);if(o){var g=o.cfg.quality<i,u=o.cfg.quality==i&&o.fight<e.fight;t.redPoint.active=g||u}else t.redPoint.active=!0}e.taleAttr?t.attrLab.string=e.getTaleAttrStr():t.attrLab.string=game.Lang.get(53604)}},wearBtn:function(){game.GodAnimalMgr.inst().exchangeEquipRequest(this.data.idx),game.module.hide(game.ME.GodAnimalExChange)}}),b8e.RC("$$game","$$GodAnimalExChangeItem",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,belongSlot:0,defaultSelEquipIdx:0,ctor:function(){this._super(1721)},init:function(){this.icon=game.GridUtil.createGodAnimalEquipIcon(),this.icon.addToParent(this.skin.itemNode),this.icon.canClick=!1;var e=game.ResCfg.getUrl(10218);this.skin.attrbg_1.loadTexture(e),this.skin.attrbg_2.loadTexture(e),e=game.ResCfg.getUrl(10219,1),this.skin.title_1.loadTexture(e),e=game.ResCfg.getUrl(10219,2),this.skin.title_2.loadTexture(e)},updateView:function(){var e=this,t=e.skin,a=game.godAnimalEquipData.showIdIdx,i=void 0,n=!1,s=game.godAnimalEquipData.getEquipInfoByIdx(a),r=void 0;if(e.belongSlot=0,e.defaultSelEquipIdx=0,t.redPoint_1.active=!1,t.redPoint_3.active=!1,s){e.icon.setData(s,!1);var o=s.taleAttr;if(e.skin.attrLab_2.string=s.getTaleAttrStr(),e.updateLayout(!!o),t.fightLab.string=game.Lang.get(1008,s.fight),n=!!s.wearSlot,i=s.cfg,e.belongSlot=s.wearSlot,e.defaultSelEquipIdx=s.idx,r=s.baseSpriteStat,n){var g=game.GodAnimalMgr.inst().getSlotInfoBySlot(s.wearSlot);if(g){var u=g.getPosEquipAlertData(s.pos);t.redPoint_1.active=u.isExAlert,t.redPoint_3.active=u.isStrongAlert}}}else{if(!(i=game.ItemInfoCfg.getData(a)))return;e.icon.setCfg(i),e.updateLayout(!1,!1),t.fightLab.string=game.Lang.get(1008,i.power),r=i.spriteStat}e.cfg=i,e.setSpriteStat(r);var l=i.quality;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(l,i.name);var c=game.HtmlUtil.getStrByQuality(l,i.name);t.qualityLab.string=game.Lang.get(53565,game.HtmlUtil.getColorStrByQuality(l,c)),t.changeBtn.active=t.removeBtn.active=n&&game.godAnimalEquipData.isShowOpBtn,t.strengBtn.active=!!s},setSpriteStat:function(e){if(this.attrStr="",e){var t=e.getSpriteStats();t&&(this.attrIndex=0,t.forEach(this.setAttrStr,this))}this.skin.attrLab_1.string=this.attrStr},setAttrStr:function(e,t){var a=game.AttrRulesCfg.getData(+e);0!=this.attrIndex&&(this.attrStr+="\n"),this.attrStr+=game.Lang.get(402,a.name,t),this.attrIndex++},updateLayout:function(e){var t=this.skin;t.node_2.active=e,this.nodeHeight=0,this.updateItemLayout(t.attrbg_1,t.attrLab_1,t.node_1),e&&this.updateItemLayout(t.attrbg_2,t.attrLab_2,t.node_2),t.bg_3.height=343+this.nodeHeight+t.node_1.y,t.bg_2.height=t.bg_3.height+10,this.height=t.bg_2.height+188,t.bg.height=this.height,t.changeBtn.y=t.removeBtn.y=t.returnBtn.y=52-this.height},updateItemLayout:function(e,t,a){var i=void 0;i=!t.height<=112?142:t.height+30,a.height=i,e.y=t.y=-i>>1,this.nodeHeight+=i},onShow:function(){this.updateView()},changeBtn:function(){this.cfg&&(game.GodAnimalMgr.inst().openEquipExList(this.cfg.pos),game.module.hide(game.ME.GodAnimalEquipTips))},removeBtn:function(){this.cfg&&(game.GodAnimalMgr.inst().removeEquipRequest(this.cfg.pos),game.module.hide(game.ME.GodAnimalEquipTips))},strengBtn:function(){this.defaultSelEquipIdx&&(game.GodAnimalMgr.inst().defaultSelEquipIdx=this.defaultSelEquipIdx,this.belongSlot?(game.GodAnimalMgr.inst().wearStrongSel=this.belongSlot,game.module.show(game.ME.GodAnimalWearStrong)):game.module.show(game.ME.GodAnimalBagStrong),game.module.hide(game.ME.GodAnimalEquipTips))}});b8e.app.registerView(game.ME.GodAnimalEquipTips,e)}(),function(){var e;e=game.ListItem.extends({icon:null,PRO_WIDTH:266,ctor:function(){this._super(1705),this.setSize(600,125)},init:function(){this.chipIcon=game.GridUtil.createItemIcon(),this.chipIcon.addToParent(this.skin.icon)},setData:function(e){var t=this.skin,a=this.cfg=e.cfg;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name),this.itemInfo=game.ItemUtil.createBaseItemInfo(e.chipId,1,this.itemInfo),this.chipIcon.setItemInfo(this.itemInfo,!1,game.IconLayoutEnum.SHOW_NONE);var i=e.haveNum,n=e.animalInfo,s=void 0;n?(s=n.starCfg.num,t.starBtn.active=!n.starCfg.isMax,t.redPoint2.active=n.starAlert,t.gotoBtn.active=!1,t.maxBtn.active=n.starCfg.isMax):(s=e.activeNum,t.starBtn.active=!1,t.gotoBtn.active=i<s,t.maxBtn.active=!1),t.costNum.string=game.Lang.get(i<s?53120:53119,i,s);var r=i/s;r=1<r?1:r,t.pb1.width=r*this.PRO_WIDTH,t.activeBtn.active=e.canActive()},activeBtn:function(){this.data.animalInfo||game.GodAnimalMgr.inst().activeGoaAnimalRequest(this.cfg.id)},clickNode:function(){if(this.data){var e=game.ItemInfoCfg.getData(this.data.chipId);e&&(game.tipsData.setInfo(e),game.module.show(game.ME.ItemTips))}},gotoBtn:function(){game.notice.show(53689)},starBtn:function(){game.GodAnimalMgr.inst().checkSelectIndex(this.cfg.id),game.module.showToggle(game.ME.GodAnimalBagOp,1),game.module.hide(game.ME.GodAnimalBag)}}),b8e.RC("$$game","$$GodAnimalBagChipItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1706)},init:function(){this.data=game.GodAnimalMgr.inst();var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GodAnimalBagChipItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.spacingX=0,e.addToParent(this.skin.listNode),this.skin.emptyNode.active=!1},addEventListener:function(){this.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.updateList,this)},removeEventListener:function(){this.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.updateList,this)},onHide:function(){this.removeEventListener()},onShow:function(){this.addEventListener(),this.updateList(),this.list.scrollToTop()},updateList:function(){var e=this.data.getChipList();this.list.setData(e)},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.GodAnimalBagChip,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1707),this.setSize(600,128)},init:function(){this.animalIcon=new game.GodAnimalHeadIcon,this.animalIcon.addToParent(this.skin.icon)},setData:function(e){this.data=e;var t=this.skin;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),this.animalIcon.setData(e,!1),t.lvLab.string=game.Lang.get(53567,e.lv);for(var a=e.star,i=0;i<6;i++)this.getComponent("starIcon"+(i+1)).active=i<a;t.shangzhen.active=!!e.slot;var n=e.bagSelect;t.down_btn.active=!n,t.up_btn.active=n,t.opNode.active=n,t.redPoint.active=e.isBackAlert,n?(t.upgrad_redPoint.active=e.lvAlert,t.star_redPoint.active=e.starAlert,this.setSize(600,240)):this.setSize(600,128),this.layout()},up_btn:function(){this.clickNode()},down_btn:function(){this.clickNode()},upgradeBtn:function(){game.GodAnimalMgr.inst().checkSelectIndex(this.data.id),game.module.showToggle(game.ME.GodAnimalBagOp,0)},starBtn:function(){game.GodAnimalMgr.inst().checkSelectIndex(this.data.id),game.module.showToggle(game.ME.GodAnimalBagOp,1)},clickNode:function(){this.data.index++,game.GodAnimalMgr.inst().setBagSelect(this.data.id)}}),b8e.RC("$$game","$$GodAnimalBagListItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1708)},init:function(){this.data=game.GodAnimalMgr.inst();var e=this.list=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GodAnimalBagListItem,e.layout.paddingLeft=0,e.layout.paddingRight=0,e.layout.spacingX=0,e.addToParent(this.skin.listNode)},addEventListener:function(){this.data.addEvent(game.GodAnimalEvts.BAG_SELECT_CHANGE,this.updateList,this),this.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.updateList,this)},removeEventListener:function(){this.data.removeEvent(game.GodAnimalEvts.BAG_SELECT_CHANGE,this.updateList,this),this.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.updateList,this)},onShow:function(){this.data.setBagSelect(0),this.addEventListener(),this.updateList(),this.list.scrollToTop()},onHide:function(){this.removeEventListener()},updateList:function(){var e=this.data.getGodAnimalBagList();this.list.setData(e),this.skin.emptyNode.active=!e||!e.length},onStageResize:function(){this.setPosition(0,0)}});b8e.app.registerView(game.ME.GodAnimalBagList,e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1711),this.spotAlerts={GOD_ANIMAL_BAG_ACT:this.actAnimalAlert,GOD_ANIMAL_BAG_CHIP:this.chipAlert},this.toggles={toggle_btn_1:game.ME.GodAnimalBagList,toggle_btn_2:game.ME.GodAnimalBagChip}},actAnimalAlert:function(e){this.skin.red_spot_1.active=e.alert},chipAlert:function(e){this.skin.red_spot_2.active=e.alert},init:function(){this.data=game.GodAnimalMgr.inst()},onShow:function(){this.toggleSelect(0)},btn_1:function(){this.toggleSelect(0)},btn_2:function(){this.toggleSelect(1)}});b8e.app.registerView(game.ME.GodAnimalBag,e)}(),function(){var e,t=e=game.GamePanel.extends({progressMaxW:485,ctor:function(){this._super(1732)},init:function(){this.data=game.GodAnimalMgr.inst(),this._costList=[];for(var e=game.MythBookCfg.getDatas(),t=void 0,a=0,i=e.length;a<i;a++)this.getComponent("costNode"+(a+1))&&((t={}).cfg=e[a],t.icon=this.createCostIcon(t.cfg.id,this.getComponent("costNode"+(a+1))),t.num=game.itemData.getNumById(t.cfg.id),this._costList.push(t),this.getComponent("costLab"+(a+1)).string=game.Lang.get(51429,t.cfg.exp))},addEventListener:function(){var e=this;e.data.addEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.updateView,e),e.data.addEvent(game.GodAnimalEvts.LEVEL_INFORM,e.updateView,e),e.data.addEvent(game.GodAnimalEvts.BAG_SELECT_CHANGE,e.updateView,e),e.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.updateView,e)},removeEventListener:function(){var e=this;e.data.removeEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.updateView,e),e.data.removeEvent(game.GodAnimalEvts.LEVEL_INFORM,e.updateView,e),e.data.removeEvent(game.GodAnimalEvts.BAG_SELECT_CHANGE,e.updateView,e),e.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.updateView,e)},onShow:function(){this.addEventListener(),this.updateView()},onHide:function(){this.removeEventListener()},getCurInfo:function(){return this.data.getCurSlotInfo().info},updateView:function(){var e=this;e.godAnimalInfo=e.getCurInfo(),e.updateCost();var t=e.skin,a=e.godAnimalInfo;if(a){var i=game.MythUpgradeCfg.getData(a.lv);if(i){var n=game.SpriteStatType,s=i.isMax?0:a.exp,r=i.exp;t.lvLab.string="Lv."+a.lv,t.expLab.string=s+"/"+r,e.setProgressVal(s/r);var o=a.cfg;if(o){var g=a.addRate,u=o.perTeamAtk*g,l=o.perTeamDef*g,c=o.perTeamHp*g;e.setStatStr(t.addProLab1,n.TeamAtk,u*a.lv),e.setStatStr(t.addProLab2,n.TeamDef,l*a.lv),e.setStatStr(t.addProLab3,n.TeamHp,c*a.lv);var h=a.starCfg;h&&(e.setStatStr(t.addProLab4,h.attrId,h.attrVal,null,!0),e.setStatStr(t.nextProLab4,h.attrId,h.attrVal,t.arrow4,!0));var m=i.isMax;if(t.noMax.active=!m,t.upgradeBtn.active=!m,t.autoUpgradeBtn.active=!m,t.isMax.active=m,t.maxImg.active=m,t.redPoint1.active=!m&&e._isEnough,!m){var d=a.lv+1;e.setStatStr(t.nextProLab1,n.TeamAtk,u*d,t.arrow1),e.setStatStr(t.nextProLab2,n.TeamDef,l*d,t.arrow2),e.setStatStr(t.nextProLab3,n.TeamHp,c*d,t.arrow3)}}}}},setStatStr:function(e,t,a,i,n){var s=4<arguments.length&&void 0!==n&&n,r=game.AttrRulesCfg.getData(t);if(r){var o=s?a+"%":game.CCommonUtil.replaceNum(a,1);e.string=game.Lang.get(51448,r.name,o),i&&i.setPosition(e.width+8,e.y+3)}},setProgressVal:function(e){b8e.Tween.kill(this.skin.progress),b8e.Tween.get(this.skin.progress).to({width:e*this.progressMaxW},150)},createCostIcon:function(e,t){var a=game.GridUtil.createItemIcon(game.IconSizeEnum.SIZE_84);a.addToParent(t);var i=game.ItemUtil.createBaseItemInfo(e,1);return a.setItemInfo(i,!1,game.IconLayoutEnum.SHOW_NONE),a},updateCost:function(){var e=void 0,t=void 0;this._isEnough=!1;for(var a=0,i=this._costList.length;a<i;a++)t=(e=this._costList[a]).icon,e.num=game.itemData.getNumById(e.cfg.id),t.setNum(e.num,0<e.num?game.Color.GREEN:game.Color.RED,20,!0,0,!0),!this._isEnough&&0<e.num&&(this._isEnough=!0)},onStageResize:function(){this.setPosition(0,0)},upgradeBtn:function(){var e=this.godAnimalInfo;e&&(e.lv>=this.data.upgradeMaxLv||this.data.GoaAnimalUpgradeRequest(e.id,1))},autoUpgradeBtn:function(){var e=this.godAnimalInfo;e&&(e.lv>=this.data.upgradeMaxLv||this.data.GoaAnimalUpgradeRequest(e.id,2))},costNode1:function(){this.showCostTips(1)},costNode2:function(){this.showCostTips(2)},costNode3:function(){this.showCostTips(3)},costNode4:function(){this.showCostTips(4)},showCostTips:function(e){var t=game.MythBookCfg.getDatas();if(!(e>=t.length)){var a=game.ItemInfoCfg.getData(t[e-1].id);a&&(game.tipsData.setInfo(a),game.module.show(game.ME.ItemTips))}}});b8e.app.registerView(game.ME.GodAnimalUpgrade,t),b8e.RC("$$game","$$GodAnimalUpgradeView",e)}(),function(){var e,t=e=game.GamePanel.extends({ctor:function(){this._super(1730)},init:function(){this.data=game.GodAnimalMgr.inst(),this.skillIcon=new game.CultivateBaseSkillIcon,this.skillIcon.setShowMainSkillIcon(!1),this.skillIcon.setShowPassiveSkillIcon(!1),this.skillIcon.addToParent(this.skin.skillNode),this.skillIcon.setClickCallBack(this.skillShow,this)},addEventListener:function(){var e=this;e.data.addEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.updateView,e),e.data.addEvent(game.GodAnimalEvts.STAR_INFORM,e.updateView,e),e.data.addEvent(game.GodAnimalEvts.BAG_SELECT_CHANGE,e.updateView,e),e.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.updateView,e)},removeEventListener:function(){var e=this;e.data.removeEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.updateView,e),e.data.removeEvent(game.GodAnimalEvts.STAR_INFORM,e.updateView,e),e.data.removeEvent(game.GodAnimalEvts.BAG_SELECT_CHANGE,e.updateView,e),e.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.updateView,e)},onShow:function(){this.addEventListener(),this.updateView()},onHide:function(){this.removeEventListener()},getCurInfo:function(){return this.data.getCurSlotInfo().info},updateView:function(){var e=this;e.godAnimalInfo=e.getCurInfo();var t=e.skin,a=e.godAnimalInfo;if(a){var i=game.MythStarCfg.getOneData(a.id,a.star);if(i){var n=game.SkillCfg.getData(i.skillId);if(n){e.skillIcon.setData(i.skillId),e.skillIcon.setName(n.name,n.quality),e.costIcon||(e.costIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_105),e.costIcon.addToParent(e.skin.costNode));var s=i.itemId;e.itemInfo=game.ItemUtil.createBaseItemInfo(s,1,e.itemInfo),e.costIcon.setItemInfo(e.itemInfo,!1,game.IconLayoutEnum.SHOW_NONE);var r=game.itemData.getNumById(s),o=game.ItemInfoCfg.getData(s);if(o){var g=r>=i.num?53607:53608;t.costLab.string=game.HtmlUtil.getColorStrByQuality(o.quality,o.name),t.costNum.string=game.Lang.get(g,r,i.num);var u=game.SpriteStatType,l=a.starSpriteStat;e.setStatStr(t.addProLab1,u.TeamAtk,l.getStatValue(u.TeamAtk)),e.setStatStr(t.addProLab2,u.TeamDef,l.getStatValue(u.TeamDef)),e.setStatStr(t.addProLab3,u.TeamHp,l.getStatValue(u.TeamHp)),e.setStatStr(t.addProLab4,i.attrId,i.attrVal,null,!0),t.addProLab5.string=game.Lang.get(53609,n.name,a.star);var c=!!i.isMax;if(t.noMax.active=!c,t.isMax.active=c,t.costNode.active=!c,t.costLab.active=!c,t.costNum.active=!c,t.upgradeBtn.active=!c,t.maxImg.active=c,t.redPoint1.active=!c&&r>=i.num,!i.isMax){var h=game.MythStarCfg.getOneData(a.id,a.star+1);h&&(e.setStatStr(t.nextProLab1,u.TeamAtk,h.teamAtk,t.arrow1),e.setStatStr(t.nextProLab2,u.TeamDef,h.teamDef,t.arrow2),e.setStatStr(t.nextProLab3,u.TeamHp,h.teamHp,t.arrow3),e.setStatStr(t.nextProLab4,h.attrId,h.attrVal,t.arrow4,!0),t.nextProLab5.string=game.Lang.get(53609,n.name,a.star+1))}}}}}},setStatStr:function(e,t,a,i,n){var s=4<arguments.length&&void 0!==n&&n,r=game.AttrRulesCfg.getData(t);if(r){var o=s?a+"%":game.CCommonUtil.replaceNum(a,1);e.string=game.Lang.get(51448,r.name,o),i&&i.setPosition(e.width+8,e.y+3)}},onStageResize:function(){this.setPosition(0,0)},upgradeBtn:function(){var e=this.godAnimalInfo;if(e&&!(e.star>=this.data.starMaxNum)){var t=e.starCfg;game.UpgradeUtil.checkItemInfo(t.itemId,t.num)&&this.data.GoaAnimalStarRequest(e.id)}},skillShow:function(){this.godAnimalInfo&&(this.data.skillShowInfo=this.godAnimalInfo,game.module.show(game.ME.GodAnimalSkillTip))},costNode:function(){}});b8e.app.registerView(game.ME.GodAnimalStar,t),b8e.RC("$$game","$$GodAnimalStarView",e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1712),this.setSize(601,291)},init:function(){var e=this;e.moduleData=game.GodAnimalMgr.inst(),e.icon1=new game.GodAnimalBookIcon,e.icon1.addToParent(e.skin.icon1),e.icon2=new game.GodAnimalBookIcon,e.icon2.addToParent(e.skin.icon2),e._model=new game.SurfaceModel,e._model.addToParent(e.skin.modelNode),e._model.initModel(),e._model.roleData.heroModel.type=game.RoleType.GodAnimal},setData:function(e){var t=this,a=t.skin,i=e.cfg;if(i&&(a.nameLab.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),2==i.ids.length)){var n=game.MythBaseCfg.getData(i.ids[0]);if(n){t.mainId=i.ids[0];var s=e.godAnimalInfo1;if(t.icon1.setData(n,!!s),game.AvatarUtil.updateModel(n,t._model,game.RoleType.GodAnimal),game.ShaderUtil.setGray(t.icon1,!s),game.ShaderUtil.setGray(t._model,!s),n=game.MythBaseCfg.getData(i.ids[1])){var r=e.godAnimalInfo2;t.icon2.setData(n,!!r),game.ShaderUtil.setGray(t.icon2,!r);var o=s&&r;a.addProLab1.string=t.setGreenValue(i.strAtk,o),a.addProLab2.string=t.setGreenValue(i.strDef,o),a.addProLab3.string=t.setGreenValue(i.strHp,o)}}}},setGreenValue:function(e,t){if(t){var a=e.split(":");if(0<a.length&&a[1]){var i=game.HtmlUtil.getText(game.Color.GREEN,a[1]);e=a[0]+":"+i}}return e},modelBtn:function(){this.mainId&&(game.godAnimalEquipData.showId=this.mainId,game.module.show(game.ME.GodAnimalDetails))}}),b8e.RC("$$game","$$GodAnimalBookItem",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1713)},init:function(){var e=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GodAnimalBookItem,e.addToParent(this.skin.listNode),e.layout.spacingY=5,e.setScrollViewCb(this.listCb,this),this.data=game.GodAnimalMgr.inst()},listCb:function(e,t,a){var i=!1;i=0<e.length,this.skin.arrowUpBtn.active=i,i=0<a.length,this.skin.arrowDownBtn.active=i},updateList:function(){var e=this.data.getBookList();e.sort(this.bookSort),this.itemList.setData(e),this.itemList.scrollToTop()},bookSort:function(e,t){var a=e.godAnimalInfo1&&e.godAnimalInfo2,i=t.godAnimalInfo1&&t.godAnimalInfo2;return a&&!i?-1:!a&&i?1:e.id-t.id},onShow:function(){this.updateList()},arrowUpBtn:function(){this.itemList&&this.itemList.scrollContainerTop()},arrowDownBtn:function(){this.itemList&&this.itemList.scrollContainerBottom()}});b8e.app.registerView(game.ME.GodAnimalBook,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1716),this.setSize(535,100)},init:function(){},setData:function(e){var t=this.skin,a=game.GodAnimalDetailsEnum;t.proNode.active=e.type==a.STAT&&this.updateStat(),t.skillNode.active=e.type==a.SKILL&&this.updateSkill(),t.fateNode.active=e.type==a.FATE&&this.updateFate(),t.breakNode.active=e.type==a.FATE_STAT&&this.updateFateStat()},updateStat:function(){var e=this,t=e.skin,a=e.data,i=game.SpriteStatType,n=a.info,s=a.cfg,r=0;if(n){var o=n.allSpriteStat;e.setStatStr(t.addProLab1,i.TeamAtk,o.getStatValue(i.TeamAtk)),e.setStatStr(t.addProLab2,i.TeamHp,o.getStatValue(i.TeamHp)),e.setStatStr(t.addProLab3,i.TeamDef,o.getStatValue(i.TeamDef)),r=n.star}else e.setStatStr(t.addProLab1,i.TeamAtk,s.teamAtk),e.setStatStr(t.addProLab2,i.TeamHp,s.teamHp),e.setStatStr(t.addProLab3,i.TeamDef,s.teamDef);var g=game.MythStarCfg.getOneData(s.id,r);return g&&e.setStatStr(t.addProLab4,g.attrId,g.attrVal+"%"),t.tips_line.y=-92,e.setSize(535,-1*t.tips_line.y+2),e.layout(),!0},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);i&&(e.string=game.Lang.get(51428,i.name,a))},updateSkill:function(){var e=this.skin,t=this.data.cfg,a=game.SkillCfg.getData(t.skillId);if(a){var i=this._skillIcon;return i||((i=this._skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_84)).setShowMainSkillIcon(!1),i.setShowPassiveSkillIcon(!1),i.addToParent(this.skin.skill)),i.setSkillData(a),e.skillLab.string=game.LangSkill.get(a.desc,a.descParam),e.tips_line.y=-207,this.setSize(535,-1*e.tips_line.y+2),this.layout(),!0}},updateFate:function(){var e=this,t=e.skin,a=e.data.cfg,i=game.MythBaseCfg.getData(a.ids[0]);if(i){var n=e._iconLeft;if(n||(n=e._iconLeft=new game.GodAnimalBookIcon).addToParent(e.skin.icon1),n.setData(i),n.setTouchEnable(!1),i=game.MythBaseCfg.getData(a.ids[1])){var s=e._iconRight;return s||(s=e._iconRight=new game.GodAnimalBookIcon).addToParent(e.skin.icon2),s.setData(i),s.setTouchEnable(!1),t.tips_line.y=-159,e.setSize(535,-1*t.tips_line.y+2),e.layout(),!0}}},updateFateStat:function(){var e=this.skin,t=this.data.cfg;return e.bookProLab1.string=t.strAtk,e.bookProLab2.string=t.strDef,e.bookProLab3.string=t.strHp,e.tips_line.y=-108,e.tips_line.active=!1,this.setSize(535,-1*e.tips_line.y+2),this.layout(),!0},lookBtn:function(){game.module.show(game.ME.GodAnimalSkillInfoTip)}}),b8e.RC("$$game","$$GodAnimalDetailsItem",e)}(),function(){var e=game.CultivateNewBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1717)},init:function(){this.data=game.GodAnimalMgr.inst();var e=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GodAnimalDetailsItem,e.addToParent(this.skin.listNode),this.initModel({type:game.RoleType.GodAnimal,node:this.skin.modelNode})},onShow:function(){this.updateList(),this.itemList.scrollToTop()},onHide:function(){this.hideAllStar()},updateList:function(){var e=this.skin,t=game.godAnimalEquipData.showId,a=this.data.getDetailsInfo(t);this.itemList.setData(a);var i=this.data.getGodAnimalInfoById(t),n=0,s=0,r=!1,o=!0;i&&(n=i.star,s=i.lv,r=this.data.canStar(i),o=i.starCfg.isMax),e.redPoint.active=r,e.upgradeBtn.active=!o;for(var g=0;g<6;g++)this.getComponent("starIcon"+(g+1)).active=g<n;var u=game.MythBaseCfg.getData(t);u&&(e.nameLab.string=game.Lang.get(51436,u.name,s),this.updateModel(game.RoleType.GodAnimal,u))},hideAllStar:function(){for(var e=0;e<6;e++)this.getComponent("starIcon"+(e+1)).active=!1},upgradeBtn:function(){var e=game.godAnimalEquipData.showId;game.GodAnimalMgr.inst().checkSelectIndex(e),game.module.showToggle(game.ME.GodAnimalBagOp,1),game.module.hide(game.ME.GodAnimalBag)}});b8e.app.registerView(game.ME.GodAnimalDetails,e)}(),function(){var e;e=game.ListItem.extends({icon:null,ctor:function(){this._super(1727),this.setSize(535,240)},setData:function(e){for(var t=this.skin,a=0;a<6;a++)this.getComponent("starIcon"+(a+1)).active=a<e.star;var i=e.cfg;t.tips_line.active=!i.isMax,this.skillIcon||(this.skillIcon=new game.CultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_84),this.skillIcon.setShowMainSkillIcon(!1),this.skillIcon.setShowPassiveSkillIcon(!1),this.skillIcon.addToParent(this.skin.iconNode)),this.skillIcon.setData(i.skillId);var n=game.SkillCfg.getData(i.skillId);if(n){var s=game.LangSkill.get(n.desc,n.descParam),r=game.Lang.get(53692,n.name,s),o=game.GodAnimalMgr.inst().getGodAnimalInfoById(i.id),g=0;o&&(g=o.star);var u=e.star<=g?game.Color.RED:game.Color.BLACK;t.skillLab.string=game.HtmlUtil.getText(u,r)}}}),b8e.RC("$$game","$$GodAnimalSkillInfoItem",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1728)},init:function(){var e=this.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);e.itemRender=game.GodAnimalSkillInfoItem,e.addToParent(this.skin.listNode),e.layout.spacingY=5,this.data=game.GodAnimalMgr.inst()},onShow:function(){this.updateView()},updateView:function(){var e=game.godAnimalEquipData.showId,t=this.data.getSkillInfos(e);t&&t.sort(this.sortByStar),this.itemList.setData(t)},sortByStar:function(e,t){return e.isEqual&&!t.isEqual?-1:!e.isEqual&&t.isEqual?1:e.star-t.star}});b8e.app.registerView(game.ME.GodAnimalSkillInfoTip,e)}(),function(){var e=game.CultivateNewBaseModelView.extends({_showModel:!0,ctor:function(){this._super(1704),this.toggles={toggle_btn_1:game.ME.GodAnimalBagUpgrade,toggle_btn_2:game.ME.GodAnimalBagStar}},init:function(){this.data=game.GodAnimalMgr.inst(),this.initModel({type:game.RoleType.GodAnimal,node:this.skin.modelNode})},addEventListener:function(){var e=this;e.data.addEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.slotInfoUpdata,e),e.data.addEvent(game.GodAnimalEvts.LEVEL_INFORM,e.slotInfoUpdata,e),e.data.addEvent(game.GodAnimalEvts.STAR_INFORM,e.slotInfoUpdata,e),e.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.backUpdateHandler,e)},removeEventListener:function(){var e=this;e.data.removeEvent(game.GodAnimalEvts.SLOT_SELECT_CHANGE,e.slotInfoUpdata,e),e.data.removeEvent(game.GodAnimalEvts.LEVEL_INFORM,e.slotInfoUpdata,e),e.data.removeEvent(game.GodAnimalEvts.STAR_INFORM,e.slotInfoUpdata,e),e.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,e.backUpdateHandler,e)},backUpdateHandler:function(){this.checkTabAlert()},checkTabAlert:function(){if(this.slotInfo){var e=this.slotInfo;e.lvAlert=this.data.canUpgrade(e),e.starAlert=this.data.canStar(e),this.skin.red_spot_1.active=e.lvAlert,this.skin.red_spot_2.active=e.starAlert}},onShow:function(){this.addEventListener(),this.slotInfoUpdata()},onHide:function(){this.removeEventListener()},slotInfoUpdata:function(){this.slotInfo=this.data.getCurBagSelect();var e=this.slotInfo;e&&(this.skin.nameLab.string=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),this.updateStar(),this.updateModel(game.RoleType.GodAnimal,e.cfg),this.updatePower(),this.checkTabAlert())},updatePower:function(){if(this.slotInfo){var e=this.skin,t=this.slotInfo.fightAmount;e.fightAmountLbl.string=t,game.AutoLayoutUtil.layoutPower(e.power,e.fightAmountLbl,e.powerImg,e.search)}},updateStar:function(){if(this.slotInfo)for(var e=this.slotInfo.star,t=0;t<6;t++)this.getComponent("starIcon"+(t+1)).active=t<e},switchInfo:function(e){var t=this.data.bagSelectIndex,a=this.data.getGodAnimalBagList();if(a&&((t+=e?-1:1)<0&&(t=a.length-1),t>=a.length&&(t=0),t!=this.data.bagSelectIndex)){var i=a[this.data.bagSelectIndex=t];i&&(this.data.setBagSelect(i.id),this.slotInfoUpdata())}},btn_1:function(){this.toggleSelect(0)},btn_2:function(){this.toggleSelect(1)},right_btn:function(){this.switchInfo(!1)},left_btn:function(){this.switchInfo(!0)}});b8e.app.registerView(game.ME.GodAnimalBagOp,e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1720)},init:function(){var e=this;e.data=game.GodAnimalMgr.inst(),e.itemList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.itemList.itemRender=game.GodAnimalEquipBagItem,e.itemList.layout.paddingLeft=6,e.itemList.layout.paddingTop=0,e.itemList.layout.spacingY=6,e.itemList.addToParent(e.skin.list),e.itemList.setScrollViewCb(e.listCb,e)},addEventListener:function(){this.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.updateList,this)},removeEventListener:function(){this.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.updateList,this)},listCb:function(e,t,a){this.skin.upBtn.active=0<e.length,this.skin.downBtn.active=0<a.length},onShow:function(){this.updateList(),this.addEventListener(),this.itemList.scrollToTop()},onHide:function(){this.removeEventListener()},updateList:function(){var e=game.godAnimalEquipData.getAllEquipInfo();this.itemList.setData(e);var t=!e||e.length<1;(this.skin.noInfoNode.active=t)&&this.listCb(0,0,0)},downBtn:function(){this.itemList&&this.itemList.scrollContainerBottom()},upBtn:function(){this.itemList&&this.itemList.scrollContainerTop()}});b8e.app.registerView(game.ME.GodAnimalEquipBag,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1719),this.setSize(542,128)},init:function(){this.icon=game.GridUtil.createGodAnimalEquipIcon(),this.icon.addToParent(this.skin.iconNode)},setData:function(e){var t=this.skin;this.data=e,this.icon.setData(e,!1);var a=e.cfg;if(this.data=e,a){var i=a.quality;t.nameLab.string=game.HtmlUtil.getColorStrByQuality(i,a.name,!0),t.fightLab.string=game.Lang.get(1008,e.fight);var n=!!e.wearSlot;if(t.targetLab.active=n,t.wornImg.active=n){var s=game.GodAnimalMgr.inst().getSlotInfoBySlot(e.wearSlot);if(!s||!s.info)return void(t.targetLab.string="");t.targetLab.string=game.Lang.get(51465,s.info.name)}e.taleAttr?t.attrLab.string=e.getTaleAttrStr():t.attrLab.string=game.Lang.get(53604)}},strongBtn:function(){game.GodAnimalMgr.inst().defaultSelEquipIdx=this.data.idx,this.data.wearSlot?(game.GodAnimalMgr.inst().wearStrongSel=this.data.wearSlot,game.module.show(game.ME.GodAnimalWearStrong)):game.module.show(game.ME.GodAnimalBagStrong),game.module.hide(game.ME.GodAnimalEquipBag)}}),b8e.RC("$$game","$$GodAnimalEquipBagItem",e)}(),function(){var e;e=game.GamePanel.extends({_showModel:!0,selEquipInfo:null,PROGRESS_MAX_WIDTH:584,LV_MAX:0,HAS_MATERAL:!1,init:function(){var e=this;e.data=game.GodAnimalMgr.inst(),e.costList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Grid),e.costList.itemRender=game.GodAnimalStrongItem,e.costList.layout.paddingLeft=0,e.costList.layout.paddingTop=4,e.costList.layout.spacingY=10,e.costList.layout.spacingX=20,e.costList.addToParent(e.skin.costList),e.LV_MAX=e.data.strongMaxLv,e.selEquipInfoList=[]},addEventListener:function(){this.data.addEvent(game.GodAnimalEvts.EQUIP_STRONG_SELECT_CHANGE,this.setPreProgressView,this),this.data.addEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.itemUpdateHandler,this)},removeEventListener:function(){this.data.removeEvent(game.GodAnimalEvts.EQUIP_STRONG_SELECT_CHANGE,this.setPreProgressView,this),this.data.removeEvent(game.GodAnimalEvts.BACK_ITEM_UPDATE,this.itemUpdateHandler,this)},itemUpdateHandler:function(){this.updataList()},onShow:function(){this.addEventListener()},onHide:function(){this.removeEventListener()},setCurLvView:function(){var e=this.skin;if(!this.selEquipInfo)return e.curAttrLab.string="",void(e.nextAttrLab.string="");var t=this.selEquipInfo.lv;e.curAttrLab.string=this.setAttrStrByLv(t);var a=this.selEquipInfo.strongCfg;if(a){var i=a.exp,n=this.selEquipInfo.exp;e.expLab.string=n+"/"+i,this.setProgressImg(n,i,e.progress);var s=a.isMax;e.nextAttrLab.string=s?"":this.setAttrStrByLv(t+1),e.costList.active=!s,e.maxTipsLab.active=s,e.attrMaxLab.active=s}},setPreProgressView:function(){if(this.selEquipInfo){var e=this.selEquipInfo.strongCfg,t=this.selEquipInfo.lv,a=this.selEquipInfo.exp+this.data.totalExpAddPre,i=this.getPreAddLv(a),n=0<i?game.Lang.get(53618,i):"";this.skin.lvLab.string=game.Lang.get(53614,t)+n,this.setProgressImg(a,e.exp,this.skin.preProgress)}},getPreAddLv:function(e){for(var t=void 0,a=0,i=0,n=this.selEquipInfo.lv;n<this.LV_MAX&&(t=game.MythEquipUpgradeCfg.getData(n))&&!(e<(a+=t.exp));n++)i++;return i},setProgressImg:function(e,t,a){var i=Math.min(e/t,1);a.width=this.PROGRESS_MAX_WIDTH*i},setAttrStrByLv:function(e){var t="";if(this.selEquipInfo){var a=this.selEquipInfo.cfg;if(a){var i=a.perTeamAtk*e+a.teamAtk,n=a.perTeamDef*e+a.teamDef,s=a.perTeamHp*e+a.teamHp;t+=this.setAttrStr(game.SpriteStatType.TeamAtk,i)+"\n",t+=this.setAttrStr(game.SpriteStatType.TeamDef,n)+"\n",t+=this.setAttrStr(game.SpriteStatType.TeamHp,s)}return t}},setAttrStr:function(e,t){var a="",i=game.AttrRulesCfg.getData(+e);return i&&(a+=game.Lang.get(507,i.name,game.CCommonUtil.replaceNum(t))),a},updataList:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this.data.getStrongCostList(t);a&&a.sort(this.sortByExp),this.costList.setData(a),this.HAS_MATERAL=a&&0<a.length,this.costList.scrollToTop()},sortByExp:function(e,t){return e.id&&!t.id?-1:!e.id&&t.id?1:e.offerExp>t.offerExp?-1:e.offerExp<t.offerExp?1:t.order-e.order},fiveBtn:function(){var e=this;e.selEquipInfo&&(e.selEquipInfo.strongCfg.isMax?game.notice.show(53693):e.HAS_MATERAL?(e.selEquipInfoList.length=0,e.selEquipInfoList.push(e.selEquipInfo),e.data.autoAddInfoByLv(e.selEquipInfoList,5)?e.data.setAlertCallBack(e.sureAddHandler,e.cancelHandler,e,53624):e.sureAddHandler()):game.notice.show(53694))},sureAddHandler:function(){this.data.setAutoSelListChoose(),this.updataList(!1),this.setPreProgressView()},cancelHandler:function(){this.data.resetStrongPreData()}}),b8e.RC("$$game","$$GodAnimalStrongBase",e)}(),function(){var e=game.GodAnimalStrongBase.extends({ctor:function(){this._super(1733)},init:function(){var e=this;e._super(),e.selPosList=[],e.dropList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical),e.dropList.itemRender=game.GodAnimalDropItem,e.dropList.layout.paddingLeft=0,e.dropList.layout.paddingTop=0,e.dropList.layout.spacingY=0,e.dropList.addToParent(e.skin.itemList),e.equipIconList=[]},addEventListener:function(){this._super(),this.data.addEvent(game.GodAnimalEvts.EQUIP_STRONG_SLOT_CHANGE,this.slotChangeHandler,this),this.data.addEvent(game.GodAnimalEvts.EQUIP_WEAR_STRONG_UPDATE,this.strongUpdateHandler,this)},removeEventListener:function(){this._super(),this.data.removeEvent(game.GodAnimalEvts.EQUIP_STRONG_SLOT_CHANGE,this.slotChangeHandler,this),this.data.removeEvent(game.GodAnimalEvts.EQUIP_WEAR_STRONG_UPDATE,this.strongUpdateHandler,this)},itemUpdateHandler:function(){this._super(),this.checkEquipAlert()},checkEquipAlert:function(){var e=this.data.getStrongSelSlotInfo();if(e)for(var t=1;t<=3;t++){var a=this.getComponent("redPoint"+t),i=e.getPosEquipAlertData(t);a.setVisible(i.isStrongAlert)}},slotChangeHandler:function(){var e=this.data.getStrongSelSlotInfo();if(e&&e.info){if(this.skin.selNameLab.string=e.info.name,this.setDropListStat(!1),this.equipUpdateHandler(),this.data.defaultSelEquipIdx){var t=game.godAnimalEquipData.getEquipInfoByIdx(this.data.defaultSelEquipIdx);if(this.data.defaultSelEquipIdx=0,t&&t.pos)return void this.setSelect(t.pos)}for(var a=1;a<=3;a++){if(e.getEquipInfoByPos(a)){this.setSelect(a);break}}}},strongUpdateHandler:function(){var e=this;e.equipUpdateHandler(),e.setSelect(e.pos,!1),e.actEff||(e.actEff=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.actEff.addToParent(e.skin.icon4),e.actEff.load(game.ResCfg.getUrl(5019,1088)),e.actEff.addFinishCallback(e.actEffCB,e)),e.actEff.play(null,0)},actEffCB:function(){this.actEff&&(this.actEff.unload(),this.actEff.parent&&this.actEff.removeFromParent(),this.actEff=null)},equipUpdateHandler:function(){var e=this.data.getStrongSelSlotInfo();if(e)for(var t=1;t<=3;t++){var a=e.getEquipInfoByPos(t),i=this.equipIconList[t],n=this.getComponent("bg"+t),s=this.getComponent("btn"+t),r=this.getComponent("redPoint"+t);a?((i=i||(this.equipIconList[t]=game.GridUtil.createGodAnimalEquipIcon())).parent||i.addToParent(this.getComponent("icon"+t)),i.setData(a)):i&&i.removeFromParent();var o=e.getPosEquipAlertData(t);r.setVisible(o.isStrongAlert),n.setVisible(!a),s.setVisible(!!a)}},onShow:function(){this._super(),this.slotChangeHandler()},onHide:function(){this._super()},setSelect:function(e,t){var a=!(1<arguments.length&&void 0!==t)||t,i=this;if(e){i.pos=e;var n=i.skin,s=i.getComponent("equipNode"+e);n.select3.x=s.x;var r=i.data.getStrongSelSlotInfo();if(r){i.selEquipInfo=r.getEquipInfoByPos(e);var o=i.selEquipIcon;i.selEquipInfo?(o||((o=i.selEquipIcon=game.GridUtil.createGodAnimalEquipIcon()).canClick=!1),o.parent||o.addToParent(i.skin.icon4),o.setData(i.selEquipInfo)):o&&o.removeFromParent(),n.bg4.setVisible(!i.selEquipInfo),a&&i.updataList(),i.setCurLvView(),i.setPreProgressView()}else i.selEquipInfo=null}},setDropListStat:function(e){if(e){var t=this.data.getDropNameList();this.dropList.setData(t)}this.skin.selNode.setVisible(e),this.skin.dropCloseBtn.setVisible(e),this.skin.dropOpenBtn.setVisible(!e)},btn1:function(){1!=this.pos&&this.setSelect(1)},btn2:function(){2!=this.pos&&this.setSelect(2)},btn3:function(){3!=this.pos&&this.setSelect(3)},dropOpenBtn:function(){this.setDropListStat(!0)},dropCloseBtn:function(){this.setDropListStat(!1)},strongBtn:function(){this.selEquipInfo&&(this.selEquipInfo.strongCfg.isMax?game.notice.show(53693):this.HAS_MATERAL?(this.selPosList.length=0,this.selPosList.push(this.selEquipInfo.pos),this.data.wearEquipForgeRequest(this.selPosList)):game.notice.show(53694))},strongAllBtn:function(){var e=this,t=e.data.getStrongSelSlotInfo();if(t)if(e.HAS_MATERAL){e.selEquipInfoList.length=0,e.selPosList.length=0;for(var a=1;a<=3;a++){var i=t.getEquipInfoByPos(a);i&&(i.lv>=e.LV_MAX||(e.selEquipInfoList.push(i),e.selPosList.push(i.pos)))}e.data.autoAddInfoByLv(e.selEquipInfoList,1)?e.data.setAlertCallBack(e.sureAddHandler2,e.cancelHandler,e,53624):e.sureAddHandler2()}else game.notice.show(53694)},sureAddHandler2:function(){this.data.wearEquipForgeRequest(this.selPosList)}});b8e.app.registerView(game.ME.GodAnimalWearStrong,e)}(),function(){var e;e=game.ListItem.extends({isShowAlert:!1,ctor:function(){this._super(1731),this.setSize(100,104)},setData:function(e){var t=this;if(t.isShowAlert=!1,e.idx){var a=e.equipIcon;a||((a=e.equipIcon=game.GridUtil.createGodAnimalEquipIcon()).canClick=!1),a.addToParent(t.skin.itemIcon);var i=game.equipData.getGodAnimalEquipInfoByIdx(e.idx);i&&(a.setData(i,!1),t.isShowAlert=0<i.lv||0<i.exp)}else t.data.equipIcon&&t.data.equipIcon.parent&&t.data.equipIcon.removeFromParent();if(e.id){var n=e.itemIcon;(n=n||(e.itemIcon=game.GridUtil.createItemIcon())).addToParent(t.skin.itemIcon);var s=e.itemInfo;(s=s||(e.itemInfo=game.ItemInfo.get())).id=e.id,n.setItemInfo(s,!1,game.IconLayoutEnum.SHOW_NONE)}else t.data.itemIcon&&t.data.itemIcon.parent&&t.data.itemIcon.removeFromParent();t.skin.chooseImg.active=t.data.isSelect},setChoose:function(e){this.data.isSelect=e,this.skin.chooseImg.active=e,game.GodAnimalMgr.inst().chooseMaterials(this.data,e)},clickBtn:function(){var e=!this.skin.chooseImg.active;e&&this.isShowAlert&&game.GodAnimalMgr.inst().isShowStrongAlert?game.GodAnimalMgr.inst().setAlertCallBack(this.setChoose,null,this,53623):this.setChoose(e)}}),b8e.RC("$$game","$$GodAnimalStrongItem",e)}(),function(){var e=game.GodAnimalStrongBase.extends({ctor:function(){this._super(1710)},init:function(){this._super(),this.selList=new game.List(b8e.ScrollBoxType.Horizontal,b8e.LayoutType.Horizontal),this.selList.itemRender=game.GodAnimalBagStrongItem,this.selList.layout.paddingLeft=0,this.selList.layout.paddingTop=-5,this.selList.layout.spacingX=0,this.selList.addToParent(this.skin.selList)},addEventListener:function(){this._super(),this.data.addEvent(game.GodAnimalEvts.EQUIP_BAG_STRONG_UPDATE,this.strongUpdateHandler,this),this.data.addEvent(game.GodAnimalEvts.EQUIP_BAG_SELECT_CHANGE,this.updateView,this)},removeEventListener:function(){this._super(),this.data.removeEvent(game.GodAnimalEvts.EQUIP_BAG_STRONG_UPDATE,this.strongUpdateHandler,this),this.data.removeEvent(game.GodAnimalEvts.EQUIP_BAG_SELECT_CHANGE,this.updateView,this)},itemUpdateHandler:function(){this._super(),this.selListUpdate()},updateView:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this.selListUpdate(),this.setSelect(t)},strongUpdateHandler:function(){var e=this;e.updateView(!1),e.actEff||(e.actEff=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.actEff.addToParent(e.skin.icon4),e.actEff.load(game.ResCfg.getUrl(5019,1088)),e.actEff.addFinishCallback(e.actEffCB,e)),e.actEff.play(null,0)},actEffCB:function(){this.actEff&&(this.actEff.unload(),this.actEff.parent&&this.actEff.removeFromParent(),this.actEff=null)},selListUpdate:function(){var e=game.equipData.getAllGodAnimalEquipList();e&&e.sort(this.sortByOrder),this.selList.setData(e)},sortByOrder:function(e,t){return t.cfg.order-e.cfg.order},onShow:function(){this._super(),this.data.setBagStrongSelByIdx(this.data.defaultSelEquipIdx),this.data.defaultSelEquipIdx=0},onHide:function(){this._super(),this.data.resetBagStrongSelIdx()},setSelect:function(e){var t=!(0<arguments.length&&void 0!==e)||e,a=this,i=a.skin;a.selEquipInfo=a.data.getBagStrongSelEquipInfo();var n=a.selEquipIcon;a.selEquipInfo?(n||((n=a.selEquipIcon=game.GridUtil.createGodAnimalEquipIcon()).canClick=!1),n.parent||n.addToParent(a.skin.icon4),n.setData(a.selEquipInfo)):n&&n.removeFromParent(),i.bg4.setVisible(!a.selEquipInfo),t&&a.updataList(),a.setCurLvView(),a.setPreProgressView()},strongBtn:function(){this.selEquipInfo&&(this.selEquipInfo.strongCfg.isMax?game.notice.show(53693):this.HAS_MATERAL?this.data.bagEquipForgeRequest(this.selEquipInfo.idx):game.notice.show(53694))},leftBtn:function(){this.selList.scrollContainerLeft()},rightBtn:function(){this.selList.scrollContainerRight()}});b8e.app.registerView(game.ME.GodAnimalBagStrong,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1709),this.setSize(110,114)},init:function(){this._super(),this.equipIcon=game.GridUtil.createGodAnimalEquipIcon(),this.equipIcon.addToParent(this.skin.itemIcon)},setData:function(e){this.equipIcon.setData(e),this.skin.chooseImg.active=this.data.isBagStrongSel},clickBtn:function(){var e=game.GodAnimalMgr.inst();e.bagStrongSelIdx!=this.data.idx&&e.setBagStrongSelByIdx(this.data.idx)}}),b8e.RC("$$game","$$GodAnimalBagStrongItem",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1729)},init:function(){var e=this.skin;this.data=game.GodAnimalMgr.inst(),this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.addChild(this.skillIcon)},onShow:function(){this.updateView()},updateView:function(){var e=this.skin,t=this.data.skillShowInfo;if(t){var a=t.starCfg.skillId;this.updateSkill(t,a),e.tipsDesc.y=-(e.tipsbg.height+22),this.setSize(e.node.width,e.node.height),this.onStageResize(),game.viewModule.updateLayout(this)}},updateSkill:function(e,t){if(t){var a=this.skin,i=game.SkillCfg.getData(t);if(i){a.nameLab.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),this.skillIcon.setData(t);var n=game.LangSkill.get(i.desc,i.descParam);n+="\n\n";for(var s=e.star,r=0;r<6;r++)this.getComponent("starIcon"+(r+1)).active=r<s;var o=this.data.getSkillInfos(e.id);if(o){for(var g=o.length,u=0;u<g;u++){var l=o[u].cfg.skillId,c=game.SkillCfg.getData(l);if(c&&c.desc2){var h=game.Lang.get(53068,u),m=void 0;m=s==u?game.Color.YELLOW:u<s?game.Color.WHITE:game.Color.GRAY,n+=game.HtmlUtil.getText(m,h+game.LangSkill.get(c.desc2,c.descParam)+"\n")}}a.tipsDescLab.string=n,a.content.height=a.tipsDescLab.height}}else game.notice.show(53494)}}});b8e.app.registerView(game.ME.GodAnimalSkillTip,e)}(),function(){var e=game.GodAnimalUpgradeView.extends({getCurInfo:function(){return game.GodAnimalMgr.inst().getCurBagSelect()}});b8e.app.registerView(game.ME.GodAnimalBagUpgrade,e)}(),function(){var e=game.GodAnimalStarView.extends({getCurInfo:function(){return game.GodAnimalMgr.inst().getCurBagSelect()}});b8e.app.registerView(game.ME.GodAnimalBagStar,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){var e=this;e._super(1718),e.setSize(150,32),b8e.evt.onTouchStart(e,e.showImg,e),b8e.evt.onMouseEnter(e,e.showImg,e),b8e.evt.onTouchCancel(e,e.hideImg,e),b8e.evt.onMouseLeave(e,e.hideImg,e)},showImg:function(){this.skin.nameBg.active=!0},hideImg:function(){this.skin.nameBg.active=!1},setData:function(e){this.skin.nameLab.string=e.name,this.skin.nameBg.active=!1},touchBtn:function(){game.GodAnimalMgr.inst().setWearStrongSelect(this.data.slot)}}),b8e.RC("$$game","$$GodAnimalDropItem",e)}(),function(){var e=game.CultivateNewBaseModelView.extends({_showModel:!0,_modelTouchClose:!0,ctor:function(){this._super("godAnimal/GodAnimalActiveView")},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500),this.initModel({type:game.RoleType.GodAnimal,node:this.skin.model})},onShow:function(){var e=this;e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.anima),e._lightEffect.setVisible(!0)),e._godAnimalInfo=game.GodAnimalMgr.inst().getActiveViewShowInfo(),e._godAnimalInfo&&e.setData(),e.endTime=game.SysTime.curTime+1e4,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(1e4)),e.timer.reset(),e.timer.start(),game.SoundEffectMgr.inst().playSoundByType(game.SoundEffectType.SoundTypeGet)},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.timer&&this.timer.stop(),game.GodAnimalMgr.inst().activeViewClose()},updateTime:function(){var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},setData:function(){var e=this.skin,t=this._godAnimalInfo.cfg;t&&(this.updateModel(game.RoleType.GodAnimal,t),e.name.string=game.HtmlUtil.getColorStrByQuality(t.quality,t.name,!1))}});b8e.app.registerView(game.ME.GodAnimalActive,e)}(),function(){var e=game.CultivateNewBaseModelView.extends({_showModel:!0,_modelTouchClose:!0,STAR_MAX:6,ctor:function(){this._super("godAnimal/GodAnimalStarTipsView")},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500),this.initModel({type:game.RoleType.GodAnimal,node:this.skin.model})},onShow:function(){var e=this;e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.anima),e._lightEffect.setVisible(!0)),e.endTime=game.SysTime.curTime+5e3,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(3e3)),e.timer.reset(),e.timer.start(),e._godAnimalInfo=game.GodAnimalMgr.inst().starTipsShowInfo,e._godAnimalInfo&&(e.setStar(),e.setArrtext())},setArrtext:function(){var e=this.skin,t=this._godAnimalInfo,a=t.starCfg,i=game.SkillCfg.getData(a.skillId),n=game.SpriteStatType,s=t.starSpriteStat;this.setStatStr(e.addProLab1,n.TeamAtk,s.getStatValue(n.TeamAtk)),this.setStatStr(e.addProLab2,n.TeamDef,s.getStatValue(n.TeamDef)),this.setStatStr(e.addProLab3,n.TeamHp,s.getStatValue(n.TeamHp)),this.setStatStr(e.addProLab4,a.attrId,a.attrVal,null,!0),e.addProLab5.string=game.Lang.get(53609,i.name,t.star)},setStatStr:function(e,t,a,i,n){var s=4<arguments.length&&void 0!==n&&n,r=game.AttrRulesCfg.getData(t);if(r){var o=s?a+"%":game.CCommonUtil.replaceNum(a,1);e.string=game.Lang.get(51448,r.name,o),i&&i.setPosition(e.width+8,e.y+3)}},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.timer&&this.timer.stop()},updateTime:function(){if(!this.endTime)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},setStar:function(){var e=void 0,t=this._godAnimalInfo,a=t.cfg;this.updateModel(game.RoleType.GodAnimal,a);for(var i=0;i<this.STAR_MAX;i++)e=i+1,this.getComponent("starIcon"+e).active=t.star>=e;this.skin.name.string=game.HtmlUtil.getColorStrByQuality(a.quality,a.name,!1)}});b8e.app.registerView(game.ME.GodAnimalStarTips,e)}(),function(){var e=void 0;(e=game.GameBaseMgr.extends({init:function(){this._super(),this.moduleEnum=game.ME.YuHua,this.moduleData=game.yuHuaData},_addEvents:function(){this.addEventByModule(game.ME.Back,game.BackEvts.C_BACK_UPDATE_ITEMINFO,this.updateBackCount),this.addListenerPb(game.protoId.FosterFeatherActiveResp,this.fosterFeatherActiveResp),this.addListenerPb(game.protoId.FosterFeatherRefineResp,this.fosterFeatherRefineResp)},updateBackCount:function(){b8e.app.isShowView(this.moduleEnum)&&this.send(game.YuHuaEvts.C2V_UPDATE_ITME)},fosterFeatherActiveResp:function(e){var t=e.readProtobuf(game.pb.FosterFeatherActivateResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setActiveFeather(t.wingId,t.id),game.FightAmount.inst().showTeamStatPower(!0),this.send(game.YuHuaEvts.C2V_UPDATE_VIEW))},fosterFeatherRefineResp:function(e){var t=e.readProtobuf(game.pb.FosterFeatherRefineResponse);0<t.code?game.notice.noticeError(t.code):(this.moduleData.setRefineAttr(t.wingId,t.attr),game.FightAmount.inst().showTeamStatPower(),this.send(game.YuHuaEvts.C2V_UPDATE_TIME))},requestActive:function(e,t){var a=game.pb.FosterFeatherActivateRequest;a.wingId=e,a.id=t,this.sendPb(game.protoId.FosterFeatherActiveReq,a)},requestRefine:function(e,t){var a=game.pb.FosterFeatherRefineRequest;a.wingId=e,a.num=t,this.sendPb(game.protoId.FosterFeatherRefineReq,a)}}))._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$YuHuaMgr",e)}(),function(){var e;e=b8e.Enum({NONE:0,C2V_UPDATE_VIEW:-1,C2V_UPDATE_TIME:-1,C2V_UPDATE_ITME:-1}),b8e.RC("$$game","$$YuHuaEvts",e)}(),function(){var e=b8e.Object.extends({curId:0,leftAlert:!1,rightAlert:!1,curNum:0,endTime:0,getCurInfo:function(){return game.fosterData.getCurFosterInfo()},setActiveFeather:function(e,t){var a=game.fosterData,i=a.getFosterInfo(a.curFosterType,e);i&&(i.setFeatherStar(t),i.setFeatherAttr())},setRefineAttr:function(e,t){var a=game.fosterData,i=a.getFosterInfo(a.curFosterType,e);i&&(this.setAttrAddValue(i,t),i.setFeatherAttr(t))},getInfoById:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e);return a||null},leftActive:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e.id-1);return!!a&&(this.leftAlert=a.featherAlert,!0)},rightActive:function(e){var t=game.fosterData,a=t.getFosterInfo(t.curFosterType,e.id+1);return!!a&&(this.rightAlert=a.featherAlert,!0)},getFeatherRefineCfg:function(e,t,a){var i=game.WingFeatherRefineCfg;if(!i)return null;this.cfgObj||(this.cfgObj=b8e.createMap()),this.cfgObj.id=e,this.cfgObj.starId=t,this.cfgObj.num=a;var n=i.getData(this.cfgObj);return n||null},getFeatherRefineCfgs:function(e,t){var a=game.WingFeatherRefineCfg;if(!a)return null;this.cfgObj2||(this.cfgObj2=b8e.createMap()),this.cfgObj2.id=e,this.cfgObj2.starId=t;var i=a.getData(this.cfgObj2,!0);return i||null},getFeatherCfg:function(e,t){var a=game.WingFeatherCfg;if(!a)return null;this.cfgObj1||(this.cfgObj1=b8e.createMap()),this.cfgObj1.id=e,this.cfgObj1.starId=t;var i=a.getData(this.cfgObj1);return i||null},getIsActive:function(e){var t=this.getInfoById(e);if(!t||!t.featherAttr)return!1;var a=t.featherAttr.length;if(a<1)return!1;var i=game.SpriteStatType,n=this.getFeatherRefineCfg(t.id,t.featherStar,1);if(!n)return!1;this.attrMap||(this.attrMap=b8e.HashMap.get()),this.attrMap.clear();for(var s=0;s<a;s++){var r=t.featherAttr[s];this.attrMap.set(r.id,r.value);var o=this.attrMap.get(r.id);if(r.id==i.TeamAtk&&n.teamAtk[0]!=o)return!1;if(r.id==i.TeamDef&&n.teamDef[0]!=o)return!1;if(r.id==i.TeamHp&&n.teamHp[0]!=o)return!1}return!0},getAttrValue:function(e){var t=this.getInfoById(this.curId);if(!t||!t.featherAttr)return 0;var a=t.featherAttr.length;if(a<1)return 0;for(var i=0;i<a;i++){var n=t.featherAttr[i];if(n.id==e)return n.value}return 0},setAttrAddValue:function(e,t){if(t&&!(t.length<1)){this.addAttrMap||(this.addAttrMap=b8e.HashMap.get()),this.addAttrMap.clear();for(var a=t.length,i=0;i<a;i++){var n=t[i];this.addAttrMap.set(n.id,n.value)}if(e.featherAttr&&!(e.featherAttr.length<1))for(var s=e.featherAttr.length,r=0;r<s;r++){var o=e.featherAttr[r],g=this.addAttrMap.get(o.id);if(g){var u=g-o.value;this.addAttrMap.set(o.id,u)}}}},getAttrAddValue:function(e){return this.addAttrMap.get(e)?this.addAttrMap.get(e):0}});game.yuHuaData=game.yuHuaData||new e}(),function(){var e=game.GamePanel.extends({_showModel:!0,max:8,refineCfgs:null,count:0,ctor:function(){this._super(1763)},init:function(){var e=this,t=e.skin;e.yuHuaMgr=game.YuHuaMgr.inst(),e.moduleData=game.yuHuaData,e.item=new game.CultivateBaseIcon,e.item.addToParent(t.item),e.costIcon1=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),e.costIcon1.addToParent(t.icon1),e.costIcon2=game.GridUtil.createViewClickIcon(game.IconSizeEnum.GRID_SIZE_42),e.costIcon2.addToParent(t.icon2),e.progress1=new game.Progress(409,30,0),e.progress1.addToParent(t.progress1),e.progress2=new game.Progress(409,30,0),e.progress2.addToParent(t.progress2),e.progress3=new game.Progress(409,30,0),e.progress3.addToParent(t.progress3),e.anim=b8e.Animator.get(game.AnimType.UI_EFFECT,1),e.anim.addToParent(t.anim),e.anim.load(game.ResCfg.getUrl(5019,1032)),e.anim.setAnchor(.5,0),e.anim.setScale(.5,.7),e.anim.play()},onShow:function(){var e=this.moduleData.getCurInfo();e&&(this.moduleData.curId=e.id,this.updateView(e),this.refineCfgs&&this.refineCfgs[0]&&(this.selectBtn(this.refineCfgs[0].num,0),this.addEventListener()))},addEventListener:function(){this.yuHuaMgr.addEvent(game.YuHuaEvts.C2V_UPDATE_VIEW,this.updateInfoPage,this),this.yuHuaMgr.addEvent(game.YuHuaEvts.C2V_UPDATE_TIME,this.updateInfoTime,this),this.yuHuaMgr.addEvent(game.YuHuaEvts.C2V_UPDATE_ITME,this.updateItem,this)},removeEventListener:function(){this.yuHuaMgr.removeEvent(game.YuHuaEvts.C2V_UPDATE_VIEW,this.updateInfoPage,this),this.yuHuaMgr.removeEvent(game.YuHuaEvts.C2V_UPDATE_TIME,this.updateInfoTime,this),this.yuHuaMgr.removeEvent(game.YuHuaEvts.C2V_UPDATE_ITME,this.updateItem,this)},updateItem:function(){this.updateItemNum()},updateInfoTime:function(){var e=this,t=e.skin;if(!e.attrTimes){var a=game.WingMiscCfg.getData("attrTime");if(!a)return;e.attrTimes=a.value}var i=game.SpriteStatType;t.attr_add1.active=!0,t.attr_add2.active=!0,t.attr_add3.active=!0,t.attr_add1.string="+"+game.CCommonUtil.replaceNum(e.moduleData.getAttrAddValue(i.TeamAtk)),t.attr_add2.string="+"+game.CCommonUtil.replaceNum(e.moduleData.getAttrAddValue(i.TeamDef)),t.attr_add3.string="+"+game.CCommonUtil.replaceNum(e.moduleData.getAttrAddValue(i.TeamHp)),e.moduleData.endTime=game.SysTime.curTime+e.attrTimes,e.time?(e.time.reset(),e.time.start()):e.time=b8e.Timer.add(e,e.updateTime,e.attrTimes),e.updateInfoPage()},updateTime:function(){this.moduleData.endTime-game.SysTime.curTime<0&&(this.stopTime(),this.skin.attr_add1.active=!1,this.skin.attr_add2.active=!1,this.skin.attr_add3.active=!1)},rightUp:function(e,t){var a,i=this.skin;0==e?i.anim.y=-82:a=1/t*78*e-82;b8e.Tween.kill(i.anim),b8e.Tween.get(i.anim).to({y:a},200)},stopTime:function(){this.time&&this.time.stop()},updateInfoPage:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);e&&this.updateView(e)},updateStar:function(e){var t=this,a=game.WingFeatherCfg.getData(e.id,!0);if(a){var i=void 0;i=0==e.featherStar?e.featherStar+1:e.featherStar,a.sort(t._sortId);for(var n=a.length,s=0;s<n;s++){var r=a[s],o=s+1;t.getComponent("star_"+s).active=e.featherStar>=o,t.getComponent("attr_"+s).string=r.attrStr;var g=game.ResCfg.getUrl(10228,r.starIcon);t.getComponent("name_"+s).loadTexture(g),t.getComponent("select_"+s).active=e.featherStar+1==o,o<t.max&&(t.getComponent("lien_"+s).active=o<=i)}var u=void 0;u=e.featherStar+1>t.max?t.max:e.featherStar+1;var l=t.moduleData.getFeatherCfg(e.id,u),c=game.ResCfg.getUrl(10228,l.starIcon);t.skin.title_img.loadTexture(c),t.updateAttr(e,i)}},updateAttr:function(e,t){var a=this,i=a.skin,n=a.moduleData.getFeatherCfg(e.id,t);if(n.max){i.active_node.active=!1,i.refining_node.active=!1,i.maxStar.active=!0;var s=a.moduleData.getFeatherRefineCfg(e.id,e.featherStar-1,1);if(!s)return;a.progress1.updatePro(s.teamAtk[0],s.teamAtk[0]),a.progress2.updatePro(s.teamDef[0],s.teamDef[0]),a.progress3.updatePro(s.teamHp[0],s.teamHp[0]);var r=s.teamAtk[0]+s.teamDef[0]+s.teamHp[0];a.rightUp(r,r)}else{var o=a.moduleData.getFeatherRefineCfg(e.id,e.featherStar,1);if(!o)return;i.maxStar.active=!1;var g=game.SpriteStatType;if(a.moduleData.getIsActive(e.id)){i.active_node.active=!0,i.refining_node.active=!1;var u=a.moduleData.getFeatherCfg(e.id,e.featherStar+1);if(!u)return;var l=u.costItem[0];a.costIcon2.setItemId(l.Id);var c=game.itemData.getCountById(l.Id);i.redPoint3.active=e.active&&c>=l.Num,i.num2.string=c>=l.Num?game.Lang.get(53543,c,l.Num):game.Lang.get(53544,c,l.Num)}else{i.active_node.active=!1,i.refining_node.active=!0,a.costIcon1.setItemId(o.costItem[0].Id);var h=game.itemData.getCountById(o.costItem[0].Id);i.redPoint4.active=e.active&&h>=o.costItem[0].Num}var m=a.moduleData.getAttrValue(g.TeamAtk),d=a.moduleData.getAttrValue(g.TeamDef),f=a.moduleData.getAttrValue(g.TeamHp);a.progress1.updatePro(m,o.teamAtk[0]),a.progress2.updatePro(d,o.teamDef[0]),a.progress3.updatePro(f,o.teamHp[0]);var p=o.teamAtk[0]+o.teamDef[0]+o.teamHp[0],v=m+d+f;a.rightUp(v,p)}a.item.setData(e),a.item.nameLbl.active=!1,i.name.string=game.HtmlUtil.getColorStrByQuality(e.cfg.quality,e.cfg.name);var E=void 0;E=n.max?e.featherStar-1:e.featherStar,a.refineCfgs=a.moduleData.getFeatherRefineCfgs(e.id,E),a.refineCfgs&&(a.refineCfgs.sort(a._sort),i.count1.string=game.Lang.get(583,a.refineCfgs[0].num),i.count2.string=game.Lang.get(583,a.refineCfgs[1].num),i.count3.string=game.Lang.get(583,a.refineCfgs[2].num))},_sort:function(e,t){return e.num-t.num},_sortId:function(e,t){return e.starId-t.starId},updateView:function(e){var t=this.skin;t.left_btn.active=this.moduleData.leftActive(e),t.right_btn.active=this.moduleData.rightActive(e),t.redPoint1.active=this.moduleData.leftAlert,t.redPoint2.active=this.moduleData.rightAlert,this.updateStar(e)},btnRefining:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);if(e)if(e.active){var t=this.moduleData.getFeatherRefineCfg(e.id,e.featherStar,this.moduleData.curNum);if(t){var a=t.costItem[0];game.itemData.getCountById(a.Id)<a.Num?game.notice.show(113):this.yuHuaMgr.requestRefine(e.id,this.moduleData.curNum)}}else game.notice.show(51623,e.name)},btnActive:function(){var e=this.moduleData.getInfoById(this.moduleData.curId);if(e){var t=this.moduleData.getFeatherCfg(e.id,e.featherStar+1);if(t){var a=t.costItem[0];game.itemData.getCountById(a.Id)<a.Num?game.notice.show(113):this.yuHuaMgr.requestActive(e.id,e.featherStar+1)}}},left_btn:function(){this.moduleData.curId--;var e=this.moduleData.getInfoById(this.moduleData.curId);e&&this.updateView(e)},right_btn:function(){this.moduleData.curId++;var e=this.moduleData.getInfoById(this.moduleData.curId);e&&this.updateView(e)},check_btn1:function(){this.refineCfgs[0]&&this.selectBtn(this.refineCfgs[0].num,0)},check_btn2:function(){this.refineCfgs[1]&&this.selectBtn(this.refineCfgs[1].num,1)},check_btn3:function(){this.refineCfgs[2]&&this.selectBtn(this.refineCfgs[2].num,2)},selectBtn:function(e,t){var a=this.skin;a.ok1.active=e==this.refineCfgs[0].num,a.ok2.active=e==this.refineCfgs[1].num,a.ok3.active=e==this.refineCfgs[2].num,this.updateItemNum(t),this.moduleData.curNum=e},updateItemNum:function(e){null!=e&&(this.count=e);var t=this.refineCfgs[this.count].costItem[0],a=game.itemData.getCountById(t.Id);this.skin.num1.string=a>=t.Num?game.Lang.get(53543,a,t.Num):game.Lang.get(53544,a,t.Num)},onHide:function(){this.removeEventListener(),b8e.Tween.kill(this.skin.anim)}});b8e.app.registerView(game.ME.YuHua,e)}(),function(){var e,t=e=b8e.PoolObject.extends({lv:0,active:!0,isShowName:!1,isShowLv:!0,normalUrl:164,isShowEffect:!0,ctor:function(){this._super()},setFosterData:function(e){if(e){var t=this;t.type=e.type,t.id=e.id,t.lv=e.lv,t.star=e.star,t.lvType=1,t.isShowStar=!0;var a=game.fosterData.getFosterClientCfgByType(t.type);a&&(t.normalUrl=a.iconUrl,t.grayUrl=a.grayIconUrl),t.cfg=game.fosterData.getFosterBaseCfg(t.type,t.id)}},setShenqiData:function(e){if(e){this.id=e.id,this.lv=e.lv,this.lvType=2,this.normalUrl=164,this.cfg=game.ShenQiCfg.getData(this.id),this.isShowStar=!1}},setFormationData:function(e){if(e){this.id=e.id,this.lv=e.lv,this.star=e.star,this.lvType=1,this.normalUrl=10090,this.cfg=game.FormationBaseCfg.getData(this.id),this.isShowStar=!0}},getShowStepOrLv:function(){return this.lvType},recycle:function(){this.reset(),this._super()},reset:function(){this.id=0,this.lv=0,this.star=0,this.lvType=1,this.cfg=null}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,8),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ChatPlayerFosterInfo",e)}(),function(){var e,t=e=b8e.PoolObject.extends({lv:0,active:!0,isShowName:!1,isShowLv:!0,normalUrl:72,isShowStar:!0,isShowEffect:!0,ctor:function(){this._super()},setData:function(e){if(e){this.slot=e.slot,this.proper=e.proper,this.equips=e.equips,this.attrs=e.attrs,this.power=e.power,this.setPartnerData(e.partner)}},setPartnerData:function(e){if(e){var t=this;t.id=e.id,t.isMainRole=1==t.id,t.lv=e.lv,t.exp=e.exp,t.breakLv=e.top,t.star=e.star,t.awakenStar=e.awakenStar,t.jpLv=e.jpLv,t.useSkin=e.useSkin,t.skins=e.skins,t.qualityNum=e.quality;var a=t.cfg=game.PartnerCfg.getData(t.id);a&&(t.puSkill=a.skill,t.name=a.name,t.quality=a.quality);var i=game.PartnerStarCfg.getData(t.id,t.star);i&&(t.heSkill=i.unionSkill,t.nuSkill=i.angerSkill,t.fuSkill=i.assistSkill)}},getShowStepOrLv:function(){return 1},recycle:function(){this.reset(),this._super()},reset:function(){var e=this;e.id=0,e.lv=0,e.star=0,e.lvType=1,e.cfg=null,e.slot=null,e.proper=null,e.equips=null,e.attrs=null,e.power=0,e.id=0,e.lv=0,e.exp=0,e.top=0,e.star=0,e.awakenStar=0,e.jpLv=0,e.useSkin=!1,e.skins=null,e.quality=0,e.cfg=null}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,6),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$ChatPlayerPartnerInfo",e)}(),function(){var e=game.View.extends({_showModel:!0,ctor:function(){this._super(1772)},init:function(){this._statTypes=game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"partnerInfoAttrIds",!0,",",!0)},getAllAttr:function(e){var t=this.showSpriteStat;return t=t||(this.showSpriteStat=game.SpriteStat.get()),!e||!e.attrs||e.attrs.length<1||(t.clear(),t.updateStat(e,!0)),t},updateView:function(){for(var e=this.skin,t=game.chatData.playerInfo.getCurLookInfo(),a=this.getAllAttr(t),i="",n="",s="",r="",o=1,g=1,u=void 0,l=void 0,c=void 0,h=void 0,m=void 0,d=0,f=this._statTypes.length;d<f;d++)c=this._statTypes[d],u=game.AttrRulesCfg.getData(c),l=game.AttrPowerCoefCfg.getData(c),h=a.getStatValue(c),m=game.Lang.get(51428,u.name,1==l.type?game.CCommonUtil.accMul(h,100)+"%":h+"")+"<br/>",1==u.attrType?(o%2!=0?i+=m:n+=m,o++):(g%2!=0?s+=m:r+=m,g++);e.statLab1.string=i,e.statLab2.string=n,e.statLab3.string=s,e.statLab4.string=r;var p=e.statLab1.height>e.statLab2.height?e.statLab1.height+-1*e.statLab1.y:e.statLab2.height+-1*e.statLab2.y;e.tips_line.y=-(p+23),e.statTitle2.y=e.tips_line.y-30,e.statLab3.y=e.statLab4.y=e.statTitle2.y-23,e.bg2.height=-1*e.statLab3.y+e.statLab3.height-49,e.tipsBg.height=e.bg2.height+186,e.returnBtn.y=-(e.tipsBg.height-51),this.setSize(600,e.tipsBg.height)},onShow:function(){this.updateView()}});b8e.app.registerView(game.ME.ChatPartnerSpriteStat,e)}(),function(){var e;e=game.CultivateBaseListItem.extends({icon:null,ctor:function(){this._super(159),this.setSize(114,155)},init:function(){this.icon=new game.CultivateBaseIcon(game.IconSizeEnum.GRID_SIZE_84),this.icon.addToParent(this.skin.icon)},setData:function(){if(this.data){var e=this.data;this.icon.setData(e),this.setStar(e,e.active),this.skin.headSelect.active=!1,this.skin.redPoint.active=!1,this.skin.icon.y=-50}},touchIcon:function(){}}),b8e.RC("$$game","$$ChatPlayerFosterListItem",e)}(),function(){var e=game.GamePanel.extends({ctor:function(){this._super(1771)},init:function(){var e=this,t=e.skin;e._equipList=[];for(var a=void 0,i=0;i<7;i++)(a=new game.PartnerEquipIcon(game.IconSizeEnum.GRID_SIZE_84)).setClickCallBack(e.onClickIcon,e),e.getComponent("equipPos"+(i+1)).addChild(a),e._equipList.push(a);e.puSkillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_70,!1,!1),e.puSkillIcon.setClickCallBack(e.clickSkillIcon1,e),t.skillIcon1.addChild(e.puSkillIcon),e.nuSkillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_70,!1,!1),e.nuSkillIcon.setClickCallBack(e.clickSkillIcon2,e),t.skillIcon2.addChild(e.nuSkillIcon),e.heSkillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_70,!1,!1),e.heSkillIcon.setClickCallBack(e.clickSkillIcon3,e),t.skillIcon3.addChild(e.heSkillIcon),e.headIcon=new game.CultivateBaseIcon,e.headIcon.addToParent(e.skin.sp_head)},onShow:function(){this.updateInfo()},onHide:function(){},getEquipMap:function(e){var t=this.equipMap;(t=t||(this.equipMap=b8e.HashMap.get())).clear();var a=void 0,i=e.equips;if(i&&0<i.length){var n=this.equipPool;n=n||(this.equipPool=[]);for(var s=void 0,r=i.length,o=0;o<r;o++)s=i[o],a=(a=n[o])||(n[o]=new game.PartnerEquipInfo),s&&(a.setData(s.item),a.type=game.partnerEquipData.getTypeByPos(s.slot),t.set(s.slot,a))}return e.proper&&((a=(a=this.excEquipInfo)||(this.excEquipInfo=new game.PartnerEquipExcInfo)).setData(e.proper),a.type=game.PartnerEquipType.Exclusive,t.set(game.EquipPosType.POS_7,a)),t},getAllAttr:function(e){var t=this.showSpriteStat;return t=t||(this.showSpriteStat=game.SpriteStat.get()),!e||!e.attrs||e.attrs.length<1||(t.clear(),t.updateStat(e,!0)),t},updateInfo:function(){var e=this,t=game.chatData.playerInfo,a=t.getCurLookInfo();if(a){if(e.headIcon.setData(a),a.isMainRole){var i=game.ResCfg.getHead(t.isMale);e.headIcon.setIcon(i)}for(var n=e.skin,s=e.getEquipMap(a),r=void 0,o=void 0,g=0,u=e._equipList.length;g<u;g++){var l=g+1;o=s.get(l),(r=e._equipList[g]).setData(o,l,!1),o&&o.cfg&&o.cfg.qualityEffect?r.setEffect(o.cfg.qualityEffect):r.setEffect(""),g<6&&(e.getComponent("starIcon"+l).active=g<a.star)}n.starNode.active=!a.isMainRole,n.power_lab.string=a.power,n.powerBg.width=n.power_lab.width+70;var c=void 0,h=void 0;h=a.isMainRole?(c=t.name,game.Quality.Q_WHITE):(c=a.cfg?a.cfg.name:"",a.cfg?game.Quality.Q_WHITE:a.cfg.quality),n.nameLab.string=game.HtmlUtil.getColorStrByQuality(h,c,!0)+game.HtmlUtil.getText(game.Color.GREEN," +"+a.breakLv);var m=game.SpriteStatType,d=e.getAllAttr(a),f=game.AttrRulesCfg.getData(m.Attack);n.addProLab1.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Attack))),f=game.AttrRulesCfg.getData(m.Defense),n.addProLab2.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Defense))),f=game.AttrRulesCfg.getData(m.Health),n.addProLab3.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Health))),f=game.AttrRulesCfg.getData(m.Speed),n.addProLab4.string=game.Lang.get(51428,f.name,game.CCommonUtil.replaceNum(d.getStatValue(m.Speed)));var p=a.puSkill;if(a.isMainRole){var v=t.getShenQiSkill();p=v||p}e.puSkillIcon.setData(p);var E=a.nuSkill;if(a.isMainRole){var T=t.getZhanjiSkill();E=T||E}e.nuSkillIcon.setData(E),n.skillNode3.active=a.heSkill||a.fuSkill,n.he.active=a.heSkill,n.fu.active=!a.heSkill&&a.fuSkill,n.skillNode1.x=n.skillNode3.active?-130:-65,n.skillNode2.x=n.skillNode3.active?0:65;var C=game.PartnerMiscCfg.getData("assistSkill");C&&e.heSkillIcon.setData(a.heSkill||C.value)}},lookDetail:function(){game.chatData.playerInfo.getCurLookInfo()&&game.module.show(game.ME.ChatPartnerSpriteStat)},clickSkillIcon1:function(){this.showSkillTips(1)},clickSkillIcon2:function(){this.showSkillTips(2)},clickSkillIcon3:function(){this.showSkillTips(3)},showSkillTips:function(e){var t=game.chatData.playerInfo;t.index=e,t.getCurLookInfo()&&game.module.show(game.ME.ChatSkillInfoTips)},onClickIcon:function(e){var t=game.chatData.playerInfo.getCurLookInfo();if(t){var a=this.getEquipMap(t).get(e);if(a){if(a.type==game.PartnerEquipType.Exclusive)return game.tipsData.setInfo(a),void game.module.show(game.ME.ExcEquipDetailsTips);game.tipsData.setInfo(a),game.module.show(game.ME.EquipDetailsTips)}}}});b8e.app.registerView(game.ME.ChatPlayerPartnerInfo,e)}(),function(){var e;e=game.CultivateBaseListItem.extends({icon:null,ctor:function(){this._super(159),this.setSize(114,155)},init:function(){this.icon=new game.CultivateBaseIcon(game.IconSizeEnum.GRID_SIZE_84),this.icon.addToParent(this.skin.icon)},setData:function(){if(this.data){var e=this.data;if(this.icon.setData(e),e.isMainRole){var t=game.ResCfg.getHead(game.chatData.playerInfo.isMale);this.icon.setIcon(t)}this.setStar(e,e.active),this.skin.headSelect.active=!1,this.skin.redPoint.active=!1,this.skin.icon.y=-50}},touchIcon:function(){game.chatData.playerInfo.lookSlot=this.data.slot,game.module.show(game.ME.ChatPlayerPartnerInfo)}}),b8e.RC("$$game","$$ChatPlayerPartnerListItem",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super(1773)},init:function(){var e=this.skin;this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.addChild(this.skillIcon)},onShow:function(){this.updateView()},updateView:function(){var e=game.chatData.playerInfo,t=e.getCurLookInfo();if(t){var a=this.skin,i=void 0,n=e.index;a.starNode.active=1!=n,a.pu.active=1==n,a.nu.active=2==n,a.he.active=3==n&&t.heSkill,a.fu.active=3==n&&!t.heSkill&&t.cfg.assistObj[0],a.he_node.active=!1,a.fu_node.active=!1;a.skill_node.active=!0;if(a.talentNode.active=!1,a.talentCondLab.active=!1,1==n&&(i=t.puSkill,t.isMainRole)){var s=e.getShenQiSkill();i=s||i}if(2==n&&(i=t.nuSkill,t.isMainRole)){var r=e.getZhanjiSkill();i=r||i}if(3==n)i=t.heSkill||t.fuSkill,t.cfg.unionObj[0]?this.updateSkill(t,i):a.skill_node.active=!1,this.setSkill(t),a.he_node.active&&a.fu_node.active?a.tipsbg.height=-1*a.fu_node.y+a.fu_node.height+5:(a.he_node.active&&(a.tipsbg.height=-1*a.he_node.y+a.he_node.height+5),a.fu_node.active&&(a.fu_node.y=-20,a.tipsbg.height=-1*a.fu_node.y+a.fu_node.height+15)),a.node.height=a.tipsbg.height;else this.updateSkill(t,i),a.tipsbg.height=-1*a.tipsDescLab.y+a.tipsDescLab.height+5+0,a.node.height=a.tipsbg.height;a.tipsDesc.y=-(a.tipsbg.height+22),this.setSize(a.node.width,a.node.height),this.onStageResize(),game.viewModule.updateLayout(this)}},updateSkill:function(e,t){var a=game.chatData.playerInfo;if(t&&a){var i=this.skin,n=(game.partnerData.skillTipsInfo,a.index),s=game.SkillCfg.getData(t);if(s){i.nameLab.string=game.HtmlUtil.getColorStrByQuality(s.quality,s.name),this.skillIcon.setData(t);var r=game.LangSkill.get(s.desc,s.descParam);if(r+="\n\n",2!=n&&3!=n||e.isMainRole)i.starNode.active=!1;else{var o=e.star;a.zhanjiInfo;e.isMainRole,0,i.starNode.active=!0;for(var g=0;g<6;g++){this.getComponent("starIcon"+(g+1)).active=g<o;var u=0,l=game.PartnerStarCfg.getData(e.id,g+1);u=2==n?l.angerSkill:l.unionSkill||l.assistSkill;var c=game.SkillCfg.getData(u);if(c&&c.desc2){var h=game.Lang.get(53068,g+1),m=void 0;m=o==g+1?game.Color.YELLOW:g<o?game.Color.WHITE:game.Color.GRAY,r+=game.HtmlUtil.getText(m,h+game.LangSkill.get(c.desc2,c.descParam)+"\n")}}}i.tipsDescLab.string=r}else game.notice.show(53494)}},setSkill:function(e){var t=this.skin,a=e.cfg.unionObj.length,i=e.cfg.assistObj.length;if(0<a){t.he_node.active=!0;var n="";t.he_node.y=t.tipsDescLab.y+-t.tipsDescLab.height+22;for(var s=game.HtmlUtil.getColorStrByQuality(e.quality,e.name),r=0;r<a;r++){var o=r+1,g=e.cfg.unionObj[r],u=game.PartnerCfg.getData(g);if(!u)return;n+=o==a?game.HtmlUtil.getColorStrByQuality(u.quality,u.name):game.HtmlUtil.getColorStrByQuality(u.quality,u.name)+","}t.he_lab.string=game.Lang.get(53459,s,n)}else t.he_node.active=!1;if(0<i){t.fu_node.active=!0;var l="";t.he_node.active&&(t.fu_node.y=t.he_node.y+-88);var c=game.HtmlUtil.getColorStrByQuality(e.quality,e.name);for(r=0;r<i;r++){var h=r+1,m=e.cfg.assistObj[r],d=game.PartnerCfg.getData(m);if(!d)return;l+=h==i?game.HtmlUtil.getColorStrByQuality(d.quality,d.name):game.HtmlUtil.getColorStrByQuality(d.quality,d.name)+","}e.cfg.assistDes?t.fu_lab.string=game.Lang.get(53460,c,e.cfg.assistDes):t.fu_lab.string=game.Lang.get(53460,c,l)}else t.fu_node.active=!1}});b8e.app.registerView(game.ME.ChatSkillInfoTips,e)}(),function(){var e;e=game.Control.extends({init:function(){this.data=game.partnerData},ipc:function(){this.handels={MasterFetterResp:this.masterFetterResp}},masterFetterResp:function(e){var t=e.readProtobuf(game.pb.MasterFetterResponse);0<t.code?game.notice.noticeError(t.code):(this.data.masterFetterId=t.id,this.data.updateQualityFetterStat(),this.data.updateAllSlotStat(),game.module.show(game.ME.PartnerUpFetter),this.send(this.Evts.V_UPDATE_DATA),this.dpt(this.Evts.C_UPDATE_FETTER))},upgradeBtn:function(){this.sender.MasterFetterReq()},fetterBtn:function(){game.module.show(game.ME.PartnerQualityFetterTips)},icon1:function(){this.openDetails(1)},icon2:function(){this.openDetails(2)},icon3:function(){this.openDetails(3)},icon4:function(){this.openDetails(4)},icon5:function(){this.openDetails(5)},openDetails:function(e){this.send(this.Evts.V_SHOW_DETAILS,e)}});var t=game.Sender.extends({ipc:function(){this.msg={MasterFetterReq:null}}});b8e.module.registerControl(game.ME.PartnerFetter,e,game.PartnerEvts,t),b8e.RC("$$game","$$PartnerFetterControl",e)}(),function(){var e;e=b8e.Enum({MAIN_INSTANCE:1,BARBARIAN:2,STARMAP:3,ENDLESS:4}),b8e.RC("$$game","$$PartnerStarconditionType",e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerSkillTips2")},init:function(){var e=this.skin;this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),e.skillIcon.addChild(this.skillIcon)},onShow:function(){this.updateView()},updateView:function(){var e=game.partnerData.masterSkillTipsInfo.skillId,t=game.partnerData.masterSkillTipsInfo.skillParam,a=this.skin,i=game.SkillCfg.getData(e);i&&(a.nameLab.string=game.HtmlUtil.getColorStrByQuality(i.quality,i.name),this.skillIcon.setData(e),a.descLab.string=game.LangSkill.get(i.desc,i.descParam),a.activeLab.active=t.isActive,a.noActiveNode.active=!t.isActive,t.isActive||(a.starNumLab.string=t.star),a.tipsbg.height=-1*a.descLab.y+a.descLab.height+15,a.tipsDesc.y=-(a.tipsbg.height+22),a.node.height=a.tipsbg.height+20,this.setSize(a.node.width,a.node.height),this.onStageResize(),game.viewModule.updateLayout(this))}});b8e.app.registerView(game.ME.PartnerSkillInfoTips2,e)}(),function(){var e=game.CultivateBaseModelView.extends({_itemInfo:null,_cfg:null,_showModel:!0,_modelTouchClose:!0,ctor:function(){this._super("partner/PartnerUpStarView")},init:function(){this.initModel({type:game.RoleType.Hero,node:this.skin.model}),this.timer=b8e.Timer.add(this,this.updateTime,500),this._lightEffect=new game.LightEffect,this.skillIcon=game.GridUtil.createCultivateBaseSkillIcon(game.IconSizeEnum.CIRCLE_SIZE_104,!1,!1),this.skin.skillIcon.addChild(this.skillIcon)},onShow:function(){var e=this;e._lightEffect||(e._lightEffect=new game.LightEffect),e._lightEffect.parent||(e._lightEffect.addToParent(e.skin.anima),e._lightEffect.setVisible(!0)),e.setData(),e.endTime=game.SysTime.curTime+1e4,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(1e4)),e.timer.reset(),e.timer.start()},onHide:function(){this._lightEffect&&this._lightEffect.removeFromParent(),this.timer&&this.timer.stop()},updateTime:function(){var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},setData:function(){var e=this.skin,t=game.mainRoleData,a=game.partnerData.getMainRoleInfo(),i=game.MasterStarCfg.getData(a.star),n=game.SkillCfg.getData(i.showSkill);this.updateRoleModel(),e.name.string=game.HtmlUtil.getColorStrByQuality(a.quality,t.name,!1);for(var s=1;s<7;s++)this.getComponent("starIcon"+s).active=a.star>=s;this.skillIcon.setData(i.showSkill),e.skillNameLab.string=game.HtmlUtil.getColorStrByQuality(n.quality,n.name)}});b8e.module.registerView(game.ME.PartnerUpStar,e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,ctor:function(){this._super("partner/PartnerUpFetterView")},init:function(){this.timer=b8e.Timer.add(this,this.updateTime,500)},onShow:function(){this.updateView()},onHide:function(){this.timer&&this.timer.stop()},updateTime:function(){var e=this.endTime-game.SysTime.curTime;if(e<=0)return this.skin.time.string=game.Lang.get(9053),void this.stopTime();this.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(e))},stopTime:function(){this.timer&&this.timer.stop(),game.module.hide(this.moduleEnum)},updateView:function(){var e=this,t=e.skin,a=(game.MasterQualityFetterCfg.getDatas(),game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"masterQualityFetterMax"),game.partnerData.getMainRoleInfo()),i=game.partnerData.masterFetterId,n=game.MasterQualityFetterCfg.getData(i),s=1<i?game.MasterQualityFetterCfg.getData(i-1):null,r=a.allSpriteStat,o=game.SpriteStatType;t.resonanceIcon1.active=!1,t.resonanceIcon2.active=!1,t.resonanceIcon3.active=!1,t.select_arrows.active=!1;var g=void 0,u=void 0;g=e.getComponent("resonanceIcon"+n.id),s?((u=e.getComponent("resonanceIcon"+s.id)).active=!0,u.x=205,g.active=!0,g.x=428,t.select_arrows.active=!0):(g.active=!0,g.x=314),t.curAddPerLab.string=game.Lang.get(53664,s?s.clientPer/10:0),t.nextAddPerLab.string=n.clientPer/10+"%",t.curAddLab1.string=game.Lang.get(53666,r.getStatValue(o.Attack)-n.atk),t.curAddLab2.string=game.Lang.get(53667,r.getStatValue(o.Defense)-n.def),t.curAddLab3.string=game.Lang.get(53668,r.getStatValue(o.Health)-n.hp),t.nextAddLab1.string=r.getStatValue(o.Attack),t.nextAddLab2.string=r.getStatValue(o.Defense),t.nextAddLab3.string=r.getStatValue(o.Health),e.labelOffset(t.up_arrow1,t.curAddPerLab,14),e.labelOffset(t.nextAddPerLab,t.up_arrow1,7),e.labelOffset(t.up_arrow2,t.curAddLab1,14),e.labelOffset(t.up_arrow3,t.curAddLab2,14),e.labelOffset(t.up_arrow4,t.curAddLab3,14),e.labelOffset(t.nextAddLab1,t.up_arrow2,7),e.labelOffset(t.nextAddLab2,t.up_arrow3,7),e.labelOffset(t.nextAddLab3,t.up_arrow4,7),e.endTime=game.SysTime.curTime+1e4,e.skin.time.string=game.Lang.get(9598,game.TimeUtil.formatTimeSpace(1e4)),e.timer.reset(),e.timer.start()},labelOffset:function(e,t,a){e.x=t.x+t.width+a}});b8e.app.registerView(game.ME.PartnerUpFetter,e)}(),function(){var e=game.View.extends({_iconList:null,_showModel:!0,ctor:function(){this._super("partner/PartnerFetterView")},init:function(){this.data=game.partnerData;this.skin;this._iconList=[];for(var e=void 0,t=0;t<5;t++)(e=new game.CultivateBaseIcon).addToParent(this.getComponent("icon"+(t+1))),this._iconList.push(e)},notify:function(e,t){switch(e){case this.Evts.V_UPDATE_DATA:this.updateView();break;case this.Evts.V_SHOW_DETAILS:this.showDetails(t)}},showDetails:function(e){if(this._iconList&&this._iconList.length>=e){var t=this._iconList[e-1];t.info&&(game.partnerData.showInfo=t.info,game.module.show(game.ME.PartnerDetails))}},updateView:function(){for(var e=this,t=e.data.partnerSlots,a=e.skin,i=1,n=void 0,s=void 0,r=game.SpriteStatType,o=game.mainRoleData,g=0,u=0,l=0,c=0,h=0,m=t.length;h<m;h++)if(!(n=t[h]).info||!n.info.isMainRole)if(n.info){if(!(s=game.MasterBattleFetterCfg.getData(n.info.quality,n.info.star)))continue;e.getComponent("partnerNode"+i).active=!0,e._iconList[i-1].setData(n.info),e.getComponent("starNumLab"+i).string=n.info.star,e.setStatStr(e.getComponent("addProLab"+i+"_1"),r.Attack,s.atk),e.setStatStr(e.getComponent("addProLab"+i+"_2"),r.Defense,s.def),e.setStatStr(e.getComponent("addProLab"+i+"_3"),r.Health,s.hp),e.getComponent("addPerLab"+i).string=game.Lang.get(53744,s.clientPer/10),e.getComponent("nameLab"+i).string=game.HtmlUtil.getColorStrByQuality(n.info.quality,n.info.name),g+=s.atk,u+=s.def,l+=s.hp,c+=s.clientPer,i++}else e.getComponent("partnerNode"+i).active=!1,i++;a.man.active=o.isMale,a.nv.active=!o.isMale,c/=10,e.setStatStr2(a.addProLab1,r.Attack,g,c),e.setStatStr2(a.addProLab2,r.Defense,u,c),e.setStatStr2(a.addProLab3,r.Health,l,c);var d=game.partnerData.masterFetterId,f=d?game.MasterQualityFetterCfg.getData(d):null;a.resonanceIcon1.active=1==d||0==d,a.resonanceIcon2.active=2==d,a.resonanceIcon3.active=3==d,a.addPerLab.string=f?f.clientPer/10+"%":"0%";var p=game.partnerData.canUpQualityFetter(),v=d<+game.CfgUtil.getMiscValue(game.PartnerMiscCfg,"masterQualityFetterMax")?game.MasterQualityFetterCfg.getData(d+1):null;(a.upgradeBtn.active=p)&&(a.upgradeBtnLab.string=game.Lang.get(53670,game.HtmlUtil.getStrByQuality(v.quality))),a.conditionLab.active=!p&&v,v&&(a.conditionLab.string=game.Lang.get(53671,game.HtmlUtil.getStrByQuality(v.quality)))},setStatStr:function(e,t,a){var i=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(51448,i.name,a)},setStatStr2:function(e,t,a,i){var n=game.AttrRulesCfg.getData(t);e.string=game.Lang.get(53669,n.name,a,i)},onShow:function(){this.updateView()}});b8e.module.registerView(game.ME.PartnerFetter,e)}(),function(){var e=game.GamePanel.extends({_showModel:!0,_NUM_MAX:3,ctor:function(){this._super("partner/PartnerQualityFetterTips")},onShow:function(){this.updateView()},updateView:function(){this.skin;var e=game.MasterQualityFetterCfg.getDatas(),t=void 0;e.sort(this.sortFetter);for(var a=game.partnerData,i=0,n=e.length;i<n;i++)if(i<this._NUM_MAX){t=e[i];var s=this.getComponent("descLab"+(i+1)),r=this.getComponent("addPerLab"+(i+1)),o=t.id<=a.masterFetterId;s.string=o?game.Lang.get(53665,game.HtmlUtil.getStrByQuality(t.quality)):game.Lang.get(53663,game.HtmlUtil.getStrByQuality(t.quality),a.getBattleQualityCount(t.quality)),r.string=game.HtmlUtil.getText(o?game.Color.GREEN:game.Color.GRAY,game.Lang.get(53664,t.clientPer/10))}},sortFetter:function(e,t){return e.id-t.id}});b8e.app.registerView(game.ME.PartnerQualityFetterTips,e)}(),function(){var e,t=e=b8e.PoolObject.extends({cfg:null,score:0,canGet:!1,isGet:!1,ctor:function(){this._super()},setData:function(e){this.cfg=e,this.id=e.id,this.score=e.score,this.isInitPrize=!1},getPrizeInfo:function(){if(this.prizeInfo&&this.isInitPrize)return this.prizeInfo;var e=this.cfg;if(!e||!e.award||e.award.length<1)return null;var t=e.award[0];return this.prizeInfo?this.prizeInfo.setData(t.Id,t.Num):this.prizeInfo=game.ItemUtil.createPrizeInfo(t.Id,t.Num),this.isInitPrize=!0,this.prizeInfo},recycle:function(){this.reset(),this._super()},reset:function(){this.cfg=null,this.isInitPrize=!1,this.score=0,this.id=0}});b8e.BindingUtil.bind(t),t.pool=new b8e.Pool(t,512),t.get=function(){return t.pool.get()},t.put=function(e){t.pool.put(e)},b8e.RC("$$game","$$OpenSerCarnivalScoreInfo",e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1782),this.setSize(86,114)},init:function(){var e=this.prizeIcon=game.GridUtil.createPrizeIcon(game.IconSizeEnum.GRID_SIZE_84);e.addToParent(this.skin.prizeIcon),e.setClickCb(this.onClickBtn,this)},setData:function(){var e=this.skin,t=this.data;e.score.string=game.Lang.get(53730,t.score),e.isGetImg.active=t.isGet;var a=t.getPrizeInfo();a&&this.prizeIcon.setItemInfo(a,!1,2,!0),e.spotAlert.active=t.canGet&&!t.isGet},onClickBtn:function(){var e=this.data;e.canGet&&!e.isGet?this.send(game.OpenSerCarnivalEvts.V2C_GET_SCORE_AWARD,this.data.id):this.prizeIcon.fnOnClickGrid()}}),b8e.RC("$$game","$$OpenSerScoreItem",e)}(),function(){var e=void 0;e=game.GameBaseMgr.extends({showCfg:null,hasAddEvt:!1,init:function(){var e=this;e._super(),e.initMgrData(),e.addEventByModule(game.ME.Welfare,game.WelfareEvts.C_INIT_MODEL,e.initModel),e.addListenerPb(game.protoId.QMStarTaskResp,e.QmStarTaskRespHandle),e.addListenerPb(game.protoId.QMStarAwardResp,e.QmStarAwardRespHandle);var t=game.spotAlert;e.qmStarAlert1=t.set(game.SAE.QM_STAR_1),e.qmStarAlert2=t.set(game.SAE.QM_STAR_2),e.evts=game.QmStarEvts},addModuleEvent:function(){var e=this;e.hasAddEvt=!0,e.addEventByModule(game.ME.Partner,game.PartnerEvts.C_INIT_DATA,e.updateTaskProgress),e.addEventByModule(game.ME.Partner,game.PartnerEvts.C_UPDATE_ACTIVE,e.updateTaskProgress),e.addEventByModule(game.ME.PartnerUpgrade,game.PartnerEvts.V_UPDATE_LV,e.updateTaskProgress),e.addEventByModule(game.ME.PartnerStar,game.PartnerEvts.C2C_UPDATE_STAR_TASK,e.updateTaskProgress),e.addEventByModule(game.ME.PartnerBreak,game.PartnerEvts.V_UPDATE_BREAK,e.updateTaskProgress),e.addEventByModule(game.ME.PartnerSpirit,game.PartnerEvts.V_UPDATE_SPIRIT,e.updateTaskProgress),e.addEventByModule(game.ME.Foster,game.FosterEvts.C2C_FOSTER_UPSTAR,e.updateTaskProgress),e.addEventByModule(game.ME.Foster,game.FosterEvts.C2C_FOSTER_ACTIVE,e.updateTaskProgress),e.addEventByModule(game.ME.Foster,game.FosterEvts.C2C_FOSTER_DATA_INIT,e.updateTaskProgress),e.addEventByModule(game.ME.ShenQiActive,game.ShenQiEvts.C2C_UPDATE_ACTIVE,e.updateTaskProgress),e.addEventByModule(game.ME.ShenQiJinJie,game.ShenQiEvts.C2C_JINJIE_SUCCESS,e.updateTaskProgress),e.addEventByModule(game.ME.ZhenXingActive,game.ZhenXingEvts.C2C_UPDATE_ACTIVE,e.updateTaskProgress),e.addEventByModule(game.ME.ZhenXingStar,game.ZhenXingEvts.C2C_STAR_SUCCESS,e.updateTaskProgress),e.addEventByModule(game.ME.EquipForge,game.EquipForgeEvts.C2C_FORGE_SUCCEED,e.updateTaskProgress),e.addEventByModule(game.ME.PartnerEquipChange,game.PartnerEquipEvts.C2C_EQUIP_CHANGE,e.updateTaskProgress),e.addEventByModule(game.ME.PartnerEquipChange,game.PartnerEquipEvts.C2C_EXC_EQUIP_CHANGE,e.updateTaskProgress)},initModel:function(e){if(e&&e.data){this.initData(e.data.qmStar),this.updateTaskProgress(),this.removeEventByModule(game.ME.Welfare,game.WelfareEvts.C_INIT_MODEL,this.initModel)}},initMgrData:function(){this.actDotMaps=b8e.createMap(),this.taskAwardedMaps=b8e.createMap(),this.targetAwardedMaps=b8e.createMap(),this.cfgsMaps=b8e.createMap(),this.pageMaps=b8e.createMap(),this.taskInfoMaps=b8e.createMap()},initData:function(e){if(e)for(var t=e.length,a=void 0,i=0;i<t;i++)if(a=e[i]){var n=a.id;if(this.setActDot(n,a.points||0),this.targetAwardedMaps[n]=a.awards||[],a.tasks)for(var s=a.tasks,r=s.length,o=void 0,g=0;g<r;g++)(o=s[g])&&this.setTaskData(n,o.group,o.taskId)}},initPageMaps:function(e){var t=this.pageMaps[e];t=t||(this.pageMaps[e]=[]);var a=game.QuanminStarTaskCfg.getData(e,!0);if(a)for(var i=a.length,n=void 0,s=0;s<i;s++)if(n=a[s]){var r=n.group;t.indexOf(r)<0&&t.push(r);var o=this.cfgsMaps[e],g=(o=o||(this.cfgsMaps[e]=b8e.createMap()))[r];(g=g||(o[r]=[])).push(n)}},setTaskData:function(e,t,a){var i=this.taskAwardedMaps[e];(i=i||(this.taskAwardedMaps[e]=b8e.createMap()))[t]=a},updateTaskProgress:function(){this.checkAlert(1),this.checkAlert(2),this.send(this.evts.TASK_PROGRESS_UPDATE)},checkOpenByActiveId:function(e){var t=!1,a=this.getOpenCfgByActiveId(e);return!!a&&((t=game.miscData.openServerDay>=a.serverStart&&this.checkHaveAwardCanGet(e))&&!this.hasAddEvt&&this.addModuleEvent(),t)},checkHaveAwardCanGet:function(e){var t=this.getTargetAwardedList(e);if(!t||t.length<6)return!0;var a=this.getAllShowTaskById(e);if(!a)return!1;for(var i=a.length,n=0;n<i;n++)if(!a[n].isGeted)return!0;return!1},checkAlert:function(e){var t=!1;if(this.checkOpenByActiveId(e)){for(var a=this.getActDot(e),i=this.getTargetAwardedList(e),n=this.getTargetCfgListById(e),s=void 0,r=void 0,o=0;o<6;o++)if((s=n[o])&&(r=s.points,i.indexOf(r)<0&&r<=a)){t=!0;break}if(!t){var g=this.getAllShowTaskById(e);if(g)for(var u=g.length,l=void 0,c=0;c<u;c++)if(!(l=g[c]).isGeted&&l.curProgress>=l.process){t=!0;break}}}1==e?this.qmStarAlert1.alert=t:2==e&&(this.qmStarAlert2.alert=t)},getOpenCfgByActiveId:function(e){return game.QuanminStarOpenCfg.getData(e)},getActDot:function(e){var t=this.actDotMaps[e];return null==t&&(t=this.actDotMaps[e]=0),t},setActDot:function(e,t){this.actDotMaps[e]=t},getTargetCfgListById:function(e){this.targetCfgMap||(this.targetCfgMap=b8e.createMap());var t=this.targetCfgMap[e];return t=t||(this.targetCfgMap[e]=game.QuanminStarAwardCfg.getData(e,!0))},getTargetAwardedList:function(e){var t=this.targetAwardedMaps[e];return t=t||(this.targetAwardedMaps[e]=[])},getTaskListByTabId:function(e,t){var a=this.getAllShowTaskById(e);this.pageShowList||(this.pageShowList=[]),this.pageShowList.length=0;for(var i=a.length,n=void 0,s=0;s<i;s++)(n=a[s])&&n.pageId==t&&this.pageShowList.push(n);return this.pageShowList.sort(this.taskSort)},taskSort:function(e,t){return!e.isGeted&&t.isGeted?-1:e.isGeted&&!t.isGeted?1:e.curProgress>=e.process&&t.curProgress<t.process?-1:e.curProgress<e.process&&t.curProgress>=t.process?1:e.taskId-t.taskId},getAllShowTaskById:function(e){var t=this.pageMaps[e];t||(this.initPageMaps(e),t=this.pageMaps[e]);var a=this.taskInfoMaps[e];a=a||(this.taskInfoMaps[e]=b8e.HashMap.get());for(var i=t.length,n=void 0,s=void 0,r=0;r<i;r++)if(s=t[r],n=this.getCurCfgByGroup(e,s)){var o=a.get(s);o||(o=game.QmStarTaskInfo.get(),a.set(s,o)),o.setData(n);var g=this.getTaskProgressByType(o);o.setProgress(g)}return a.values()},getTaskInfoMapById:function(e){return this.taskInfoMaps[e]},getCurCfgByGroup:function(e,t){for(var a=this.getCfgListByTabId(e,t),i=a.length,n=void 0,s=this.getTaskAwardedList(e,t),r=0;r<i&&s>=(n=a[r]).taskId;r++)n.isGeted=!0;return n},getCfgListByTabId:function(e,t){var a=this.cfgsMaps[e];if(a)return a[t].sort(this.sortByTaskId)},sortByTaskId:function(e,t){return e.taskId-t.taskId},getTaskAwardedList:function(e,t){var a=this.taskAwardedMaps[e];return a?a[t]:0},getTaskProgressByType:function(e){var t=game.QmStarTaskType,a=0;switch(e.taskType){case t.PARTNER_QUALITY:a=game.partnerData.getPartnerNumByQuaAndCondition(e.param1);break;case t.PARTNER_QUALITY_STAR:a=game.partnerData.getPartnerNumByQuaAndCondition(e.param1,1,e.param2);break;case t.PARTNER_QUALITY_TOP:a=game.partnerData.getPartnerNumByQuaAndCondition(e.param1,3,e.param2);break;case t.PARTNER_QUALITY_JP:a=game.partnerData.getPartnerNumByQuaAndCondition(e.param1,4,e.param2);break;case t.PARTNER_LEVEL:a=game.partnerData.getPartnerNumByQuaAndCondition(null,2,e.param1);break;case t.MOUNT_QUALITY:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.MOUNT,e.param1);break;case t.WING_QUALITY:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.WING,e.param1);break;case t.ZHANJI_QUALITY:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.ZHANJI,e.param1);break;case t.HALO_QUALITY:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.HALO,e.param1);break;case t.SHENHUN_QUALITY:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.SHENHUN,e.param1);break;case t.SHENQI_QUALITY:a=game.shenQiData.getQuaActNum(e.param1);break;case t.FORMATION_QUALITY:a=game.zhenXingData.getQuaAndCondition(e.param1);break;case t.MOUNT_QUALITY_STAR:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.MOUNT,e.param1,1,e.param2);break;case t.WING_QUALITY_STAR:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.WING,e.param1,1,e.param2);break;case t.ZHANJI_QUALITY_STAR:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.ZHANJI,e.param1,1,e.param2);break;case t.HALO_QUALITY_STAR:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.HALO,e.param1,1,e.param2);break;case t.SHENHUN_QUALITY_STAR:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.SHENHUN,e.param1,1,e.param2);break;case t.FORMATION_QUALITY_STAR:a=game.zhenXingData.getQuaAndCondition(e.param1,1,e.param2);break;case t.MOUNT_QUALITY_LEVEL:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.MOUNT,e.param1,2,e.param2);break;case t.WING_QUALITY_LEVEL:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.WING,e.param1,2,e.param2);break;case t.ZHANJI_QUALITY_LEVEL:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.ZHANJI,e.param1,2,e.param2);break;case t.HALO_QUALITY_LEVEL:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.HALO,e.param1,2,e.param2);break;case t.SHENHUN_QUALITY_LEVEL:a=game.fosterData.getFosterQuaAndCondition(game.NewFosterType.SHENHUN,e.param1,2,e.param2);break;case t.FORMATION_QUALITY_LEVEL:a=game.zhenXingData.getQuaAndCondition(e.param1,2,e.param2);break;case t.EQUIP_STRENGTH:a=game.partnerData.getAllPartnerIntensifylv();break;case t.EQUIP_GEM:a=game.partnerData.getAllPantnerGemTotalLv();break;case t.EQUIP_CHUILIAN:a=game.partnerData.getAllPartnerRefinelv()}return a},requestGetTaskAward:function(e,t,a){var i=game.pb.QMStarTaskRequest;i.id=e,i.group=t,i.taskId=a,this.sendPb(game.protoId.QMStarTaskReq,i)},requestGetTargetAward:function(e,t){var a=game.pb.QMStarAwardRequest;a.id=e,a.num=t,this.sendPb(game.protoId.QMStarAwardReq,a)},QmStarTaskRespHandle:function(e){var t=e.readProtobuf(game.pb.QMStarTaskResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=t.id,i=t.group;this.setTaskData(a,i,t.taskId);var n=this.getTaskInfoMapById(a);if(n){var s=n.get(i);if(s){var r=this.getActDot(a);this.setActDot(a,r+s.points)}}this.checkAlert(a),this.send(this.evts.TASK_AWARD_UPDATE),b8e.evt.dptG(game.ActiveBarGEvts.REFRESH_BTNS)}},QmStarAwardRespHandle:function(e){var t=e.readProtobuf(game.pb.QMStarAwardResponse);if(0<t.code)game.notice.noticeError(t.code);else{var a=this.getTargetAwardedList(t.id);if(a&&a.push(t.num),this.checkAlert(t.id),this.showCfg){var i=this.showCfg.award;i&&(game.awardsData.setItemsByArray(i),game.module.show(game.ME.AwardShowTip))}this.send(this.evts.TARGET_AWARD_UPDATE),b8e.evt.dptG(game.ActiveBarGEvts.REFRESH_BTNS)}}});e._instance=null,e._singleton=!0,e.inst=function(){return null==e._instance&&(e._singleton=!1,e._instance=new e,e._singleton=!0),e._instance},b8e.RC("$$game","$$QmStarMgr",e)}(),function(){var e=void 0;e=b8e.PoolObject.extends({id:0,taskType:0,group:0,taskId:0,pageId:0,process:0,param1:0,param2:0,award:null,points:0,desc:null,curProgress:0,isGeted:!1,reset:function(){var e=this;e.id=0,e.taskType=0,e.group=0,e.taskId=0,e.pageId=0,e.process=0,e.param1=0,e.param2=0,e.award=null,e.points=0,e.desc=null,e.curProgress=0,e.isGeted=!1},setData:function(e){var t=this;t.id=e.openId,t.taskType=e.taskType,t.group=e.group,t.taskId=e.taskId,t.pageId=e.pageId,t.process=e.process,t.param1=e.param1,t.param2=e.param2,t.award=e.award,t.points=e.points,t.desc=e.desc,t.isGeted=!!e.isGeted},setProgress:function(e){this.curProgress=e},recycle:function(){this.reset(),this._super()}}),b8e.BindingUtil.bind(e),e.pool=new b8e.Pool(e,256),e.get=function(){return e.pool.get()},e.put=function(e){ame.QmStarTaskInfo.pool.put(e)},b8e.RC("$$game","$$QmStarTaskInfo",e)}(),function(){var e;e=b8e.Enum({$$NONE:0,PARTNER_QUALITY:1,PARTNER_QUALITY_STAR:2,PARTNER_QUALITY_TOP:3,PARTNER_QUALITY_JP:4,PARTNER_LEVEL:5,MOUNT_QUALITY:6,WING_QUALITY:7,ZHANJI_QUALITY:8,HALO_QUALITY:9,SHENHUN_QUALITY:10,SHENQI_QUALITY:11,FORMATION_QUALITY:12,MOUNT_QUALITY_STAR:13,WING_QUALITY_STAR:14,ZHANJI_QUALITY_STAR:15,HALO_QUALITY_STAR:16,SHENHUN_QUALITY_STAR:17,FORMATION_QUALITY_STAR:18,MOUNT_QUALITY_LEVEL:19,WING_QUALITY_LEVEL:20,ZHANJI_QUALITY_LEVEL:21,HALO_QUALITY_LEVEL:22,SHENHUN_QUALITY_LEVEL:23,FORMATION_QUALITY_LEVEL:24,EQUIP_STRENGTH:25,EQUIP_GEM:26,EQUIP_CHUILIAN:27}),b8e.RC("$$game","$$QmStarTaskType",e)}(),function(){var e;e=b8e.Enum({TARGET_AWARD_UPDATE:-1,TASK_AWARD_UPDATE:-1,TASK_PROGRESS_UPDATE:-1}),b8e.RC("$$game","$$QmStarEvts",e)}(),function(){var e,t=e=game.GamePanel.extends({_showModel:!0,activeId:1,openCfg:null,targetCfgList:null,PRO_MAX:0,pageId:0,ctor:function(){this._super(1783)},init:function(){var e=this;e.data=game.QmStarMgr.inst(),e.toggles={qm_sel_tab1:null,qm_sel_tab2:null,qm_sel_tab3:null};var t=e.data.getOpenCfgByActiveId(e.activeId);t&&(e.skin.bannerIcon.loadTexture(game.ResCfg.getUrl(10233,t.banner)),e.skin.moduleIcon.loadTexture(game.ResCfg.getUrl(10233,t.moduleIcon)),e.skin.moduleIcon.x+=t.moduleOffectX,e.skin.moduleIcon.y+=t.moduleOffectY,e.skin.unselLab1.string=e.skin.selLab1.string=t.tabName1,e.skin.unselLab2.string=e.skin.selLab2.string=t.tabName2,e.skin.unselLab3.string=e.skin.selLab3.string=t.tabName3);var a=e.data.getTargetCfgListById(e.activeId);e.targetCfgList=[],e.initTargetAward(a);var i=e.targetCfgList[e.targetCfgList.length-1];i&&(e.PRO_MAX=i.points);var n=e.taskList=new game.List(b8e.ScrollBoxType.Vertical,b8e.LayoutType.Vertical);n.itemRender=game.QmStarTaskItem,n.layout.paddingLeft=0,n.layout.paddingTop=0,n.layout.spacingY=12,n.addToParent(e.skin.taskList),n.setScrollViewCb(e.listCb,e)},listCb:function(e,t,a){this.skin.upBtn.active=0<e.length,this.skin.downBtn.active=0<a.length},initTargetAward:function(e){if(e){if(6==e.length){e.sort(this.sortByPoint);for(var t=void 0,a=void 0,i=void 0,n=void 0,s=void 0,r=0;r<6;r++)if(s=r+1,t=e[r]){if(a=this.getComponent("targetLab"+s),i=this.getComponent("awardIcon"+s),n=this.getComponent("numLab"+s),a.string=t.points,this.targetCfgList.push(t),i.loadTexture(game.ResCfg.getUrl(10233,t.awardIcon)),t.award[0]){var o=t.award[0].Num;n.string=0<o?game.Lang.get(53743,o):""}}else b8e.error("\u76ee\u6807\u5956\u52b1\u914d\u7f6e\u5f02\u5e38\uff0c\u4f4d\u7f6e\u4e3a\uff1a"+s)}else b8e.error("\u754c\u9762\u67096\u4e2a\u76ee\u6807\u5956\u52b1\uff0c\u8bf7\u7b56\u5212\u68c0\u67e5\u914d\u7f6e\uff01")}},updateTargetState:function(){for(var e=this.data.getActDot(this.activeId),t=this.data.getTargetAwardedList(this.activeId),a=void 0,i=void 0,n=void 0,s=1;s<=6;s++)if(n=this.targetCfgList[s-1]){a=this.getComponent("maskNode"+s),i=this.getComponent("redPoint"+s);var r=n.points,o=0<=t.indexOf(r),g=r<=e;a.setVisible(o),i.setVisible(!o&&g)}},sortByPoint:function(e,t){return e.points-t.points},updateAllDot:function(){var e=this.data.getActDot(this.activeId);this.skin.targetLab.string=game.Lang.get(52131,e,this.PRO_MAX),this.skin.proNode.height=434*Math.min(1,e/this.PRO_MAX)},addEventListener:function(){this.data.addEvent(game.QmStarEvts.TARGET_AWARD_UPDATE,this.updateTargetState,this),this.data.addEvent(game.QmStarEvts.TASK_AWARD_UPDATE,this.taskUpdate,this),this.data.addEvent(game.QmStarEvts.TASK_PROGRESS_UPDATE,this.taskProUpdate,this)},removeEventListener:function(){this.data.removeEvent(game.QmStarEvts.TARGET_AWARD_UPDATE,this.updateTargetState,this),this.data.removeEvent(game.QmStarEvts.TASK_AWARD_UPDATE,this.taskUpdate,this),this.data.removeEvent(game.QmStarEvts.TASK_PROGRESS_UPDATE,this.taskProUpdate,this)},onShow:function(){this.addEventListener(),this.updateTargetState(),this.updateAllDot(),this.checkTabAlert()},onHide:function(){this.removeEventListener()},taskUpdate:function(){this.updateTargetState(),this.updateTaskList(),this.updateAllDot(),this.checkTabAlert()},taskProUpdate:function(){this.updateTaskList(),this.checkTabAlert()},selectChangedHandle:function(e){this.pageId=e+1,this.updateTaskList()},updateTaskList:function(){var e=this.data.getTaskListByTabId(this.activeId,this.pageId);this.taskList.setData(e)},getTargetAward:function(e){var t=this,a=t.targetCfgList[e];if(a){var i=a.points,n=t.data.getTargetAwardedList(t.activeId),s=t.data.getActDot(t.activeId);if(!(0<=n.indexOf(i))&&i<=s)t.data.showCfg=a,t.data.requestGetTargetAward(t.activeId,i);else{var r=a.award[0];r&&(t.itemInfo=game.ItemUtil.createBaseItemInfo(r.Id,r.Num,t.itemInfo),game.tipsData.setInfo(t.itemInfo),game.module.show(game.ME.ItemTips))}}},checkTabAlert:function(){this.skin.tabRed1.active=!1,this.skin.tabRed2.active=!1,this.skin.tabRed3.active=!1;var e=this.data.getAllShowTaskById(this.activeId),t=void 0;if(e)for(var a=e.length,i=void 0,n=0;n<a;n++)i=e[n],(t=this.getComponent("tabRed"+i.pageId))&&!t.active&&!i.isGeted&&i.curProgress>=i.process&&(t.active=!0)},tabBtn1:function(){this.toggleSelect(0)},tabBtn2:function(){this.toggleSelect(1)},tabBtn3:function(){this.toggleSelect(2)},awardBtn1:function(){this.getTargetAward(0)},awardBtn2:function(){this.getTargetAward(1)},awardBtn3:function(){this.getTargetAward(2)},awardBtn4:function(){this.getTargetAward(3)},awardBtn5:function(){this.getTargetAward(4)},awardBtn6:function(){this.getTargetAward(5)},upBtn:function(){this.taskList.scrollContainerTop()},downBtn:function(){this.taskList.scrollContainerBottom()}});b8e.app.registerView(game.ME.QmStar1,t),b8e.RC("$$game","$$QmStarView1",e)}(),function(){var e=game.QmStarView1.extends({activeId:2});b8e.app.registerView(game.ME.QmStar2,e)}(),function(){var e;e=game.ListItem.extends({ctor:function(){this._super(1784),this.setSize(369,104)},init:function(){this.awardIcon=game.GridUtil.createItemIcon(game.IconSizeEnum.GRID_SIZE_69),this.awardIcon.addToParent(this.skin.awardIcon)},setData:function(e){if(e){var t=this.skin;if(t.actDotLab.string=e.points,t.titleLab.string=e.desc,t.proImg.width=140*Math.min(e.curProgress/e.process,1),t.proLab.string=game.Lang.get(53726,e.curProgress,e.process),e.award){var a=e.award[0];this.itemInfo=game.ItemUtil.createBaseItemInfo(a.Id,a.Num,this.itemInfo),this.awardIcon.setItemInfo(this.itemInfo,!1,game.IconLayoutEnum.SHOW_NUM)}var i=e.curProgress>=e.process,n=e.isGeted;t.getBtn.setVisible(!n&&i),t.noGetBtn.setVisible(!n&&!i),t.getedImg.setVisible(n)}},getBtn:function(){this.data&&game.QmStarMgr.inst().requestGetTaskAward(this.data.id,this.data.group,this.data.taskId)}}),b8e.RC("$$game","$$QmStarTaskItem",e)}(),function(){var e=game.GameMenuBarData.extends({ctor:function(){this._super(8)},getDatas:function(){return game.HomeRightTopBarCfg.getDatas()},getData:function(e){return game.HomeRightTopBarCfg.getData(e)}});game.homeRightTopData=game.homeRightTopData||new e}(),function(){var e=game.GamePanel.extends({curId:0,barHeight:0,ctor:function(){this._super(1785),this.addNodeTouch=!1},init:function(){this.moduleEvts={ActiveBar:{C2C_ACTIVE_BAR_DATA:this.refreshBtns}},this._miscId=8,this._barDatas=game.homeRightTopData,this.btnPool=[],this.shrink=!0},onShow:function(){this._layout(),this._updatePosition()},onHide:function(){b8e.Tween.kill(this)},shrinkBtn:function(){var e=this.skin,t=game.GameBarMiscCfg.getData(this._miscId),a=t.iconHeight,i=t.tweenTime;this.shrink?this.shrink=!1:(this.shrink=!0,a=this.barHeight),b8e.Tween.get(e.maskNode).to({height:a},i),b8e.Tween.get(e.bg).to({height:a+100},i),b8e.Tween.get(e.shrinkNode).to({y:-a-50},i)},refreshBtns:function(){b8e.hasTimeout(this._delayRefresh,this)||b8e.setTimeout(this._delayRefresh,this,500)},_delayRefresh:function(){this._layout(),this._updatePosition()},_layout:function(){var e=this,t=e.skin,a=game.GameBarMiscCfg.getData(e._miscId);if(a){e.btns=e._barDatas.getBtns();for(var i=a.spacingY,n=e.btns.length>e.btnPool.length?e.btns.length:e.btnPool.length,s=-a.iconHeight,r=void 0,o=void 0,g=0,u=0;u<n;u++)o=e.btns[u],r=e.btnPool[u],o?(r?r.setVisible(!0):(r=game.MenuBarItem.get(),t.maskNode.addChild(r),e.btnPool[u]=r),r.setData(o),r.x=0+o.offsetX,r.y=s+o.offsetY,s-=o.height+i,g+=o.height+i):r&&r.setVisible(!1);e.barHeight=g,e.shrink&&(e.setSize(t.bg.width,g+100),t.bg.height=g+100,t.shrinkNode.y=-g-50,t.maskNode.height=g)}},_updatePosition:function(){var e=0,t=0,a=game.GameBarMiscCfg.getData(this._miscId);a&&(0<a.marginLeft?e=a.marginLeft:0<a.marginRight&&(e=this.parent.width-a.marginRight-this.width),0<a.marginTop?t=-a.marginTop:0<a.marginBottom&&(t=-(this.parent.height-a.marginBottom))),this.setPosition(e,t)},onStageResize:function(){this._layout(),this._updatePosition()}});b8e.app.registerView(game.ME.HomeRightTop,e)}()},{}]},{},[1]);